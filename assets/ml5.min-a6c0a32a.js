var t5={exports:{}};(function(n5,iV){(function(Oe,A){n5.exports=A()})(window,function(){return function(Oe){var A={};function a(b){if(A[b])return A[b].exports;var $=A[b]={i:b,l:!1,exports:{}};return Oe[b].call($.exports,$,$.exports,a),$.l=!0,$.exports}return a.m=Oe,a.c=A,a.d=function(b,$,U){a.o(b,$)||Object.defineProperty(b,$,{configurable:!1,enumerable:!0,get:U})},a.r=function(b){Object.defineProperty(b,"__esModule",{value:!0})},a.n=function(b){var $=b&&b.__esModule?function(){return b.default}:function(){return b};return a.d($,"a",$),$},a.o=function(b,$){return Object.prototype.hasOwnProperty.call(b,$)},a.p="/",a(a.s=581)}([function(Oe,A,a){a.r(A),function(b,$,U,B){a.d(A,"AdadeltaOptimizer",function(){return Je}),a.d(A,"AdagradOptimizer",function(){return at}),a.d(A,"AdamOptimizer",function(){return yt}),a.d(A,"AdamaxOptimizer",function(){return xt}),a.d(A,"Add",function(){return _l}),a.d(A,"AddN",function(){return jh}),a.d(A,"BroadcastTo",function(){return Ec}),a.d(A,"DataStorage",function(){return Tt}),a.d(A,"Div",function(){return Lo}),a.d(A,"ENV",function(){return ee}),a.d(A,"Environment",function(){return q}),a.d(A,"FromPixels",function(){return km}),a.d(A,"FusedBatchNorm",function(){return Bh}),a.d(A,"Identity",function(){return _f}),a.d(A,"KernelBackend",function(){return Wt}),a.d(A,"MaxPoolWithArgmax",function(){return Fl}),a.d(A,"MomentumOptimizer",function(){return It}),a.d(A,"NonMaxSuppressionV5",function(){return Kc}),a.d(A,"OneHot",function(){return Lh}),a.d(A,"Optimizer",function(){return Ze}),a.d(A,"PadV2",function(){return Cc}),a.d(A,"RMSPropOptimizer",function(){return Jt}),a.d(A,"Rank",function(){return ge}),a.d(A,"Reduction",function(){return Wa}),a.d(A,"SGDOptimizer",function(){return kt}),a.d(A,"Square",function(){return Ph}),a.d(A,"SquaredDifference",function(){return Dl}),a.d(A,"Tensor",function(){return Mt}),a.d(A,"TensorBuffer",function(){return Wi}),a.d(A,"Tile",function(){return Nl}),a.d(A,"Transpose",function(){return Tl}),a.d(A,"Variable",function(){return gt}),a.d(A,"abs",function(){return Es}),a.d(A,"acos",function(){return Oc}),a.d(A,"acosh",function(){return Ra}),a.d(A,"add",function(){return ra}),a.d(A,"addN",function(){return Wf}),a.d(A,"addStrict",function(){return Bl}),a.d(A,"all",function(){return fp}),a.d(A,"any",function(){return ll}),a.d(A,"argMax",function(){return Yg}),a.d(A,"argMin",function(){return em}),a.d(A,"asin",function(){return Ac}),a.d(A,"asinh",function(){return Uu}),a.d(A,"atan",function(){return Df}),a.d(A,"atan2",function(){return Rf}),a.d(A,"atanh",function(){return Tf}),a.d(A,"avgPool",function(){return nd}),a.d(A,"avgPool3d",function(){return Hm}),a.d(A,"backend",function(){return xm}),a.d(A,"backend_util",function(){return Hr}),a.d(A,"basicLSTMCell",function(){return Qg}),a.d(A,"batchNorm",function(){return ql}),a.d(A,"batchNorm2d",function(){return R0}),a.d(A,"batchNorm3d",function(){return ol}),a.d(A,"batchNorm4d",function(){return Hf}),a.d(A,"batchNormalization",function(){return ro}),a.d(A,"batchNormalization2d",function(){return I0}),a.d(A,"batchNormalization3d",function(){return Hl}),a.d(A,"batchNormalization4d",function(){return Yh}),a.d(A,"batchToSpaceND",function(){return Ld}),a.d(A,"booleanMaskAsync",function(){return Lg}),a.d(A,"broadcastTo",function(){return $l}),a.d(A,"browser",function(){return oe}),a.d(A,"buffer",function(){return bi}),a.d(A,"cast",function(){return zd}),a.d(A,"ceil",function(){return Xc}),a.d(A,"clipByValue",function(){return Vd}),a.d(A,"clone",function(){return Gl}),a.d(A,"complex",function(){return ho}),a.d(A,"concat",function(){return Po}),a.d(A,"concat1d",function(){return Ih}),a.d(A,"concat2d",function(){return Pd}),a.d(A,"concat3d",function(){return Al}),a.d(A,"concat4d",function(){return Rh}),a.d(A,"conv1d",function(){return Wg}),a.d(A,"conv2d",function(){return Jf}),a.d(A,"conv2dTranspose",function(){return Jp}),a.d(A,"conv3d",function(){return j0}),a.d(A,"conv3dTranspose",function(){return Vm}),a.d(A,"cos",function(){return Wu}),a.d(A,"cosh",function(){return Em}),a.d(A,"cumsum",function(){return Ud}),a.d(A,"customGrad",function(){return N}),a.d(A,"deprecationWarn",function(){return Cf}),a.d(A,"depthToSpace",function(){return Rp}),a.d(A,"depthwiseConv2d",function(){return Wm}),a.d(A,"diag",function(){return Zl}),a.d(A,"disableDeprecationWarnings",function(){return Np}),a.d(A,"dispose",function(){return No}),a.d(A,"disposeVariables",function(){return Ol}),a.d(A,"div",function(){return Yo}),a.d(A,"divNoNan",function(){return Up}),a.d(A,"divStrict",function(){return nr}),a.d(A,"dot",function(){return qm}),a.d(A,"dropout",function(){return Ev}),a.d(A,"elu",function(){return eh}),a.d(A,"enableDebugMode",function(){return Tp}),a.d(A,"enableProdMode",function(){return xu}),a.d(A,"engine",function(){return Fd}),a.d(A,"env",function(){return P}),a.d(A,"equal",function(){return Kp}),a.d(A,"equalStrict",function(){return Pm}),a.d(A,"erf",function(){return qd}),a.d(A,"exp",function(){return Il}),a.d(A,"expandDims",function(){return zu}),a.d(A,"expm1",function(){return jp}),a.d(A,"eye",function(){return Fc}),a.d(A,"fft",function(){return Mc}),a.d(A,"fill",function(){return ws}),a.d(A,"findBackend",function(){return Rd}),a.d(A,"findBackendFactory",function(){return Fp}),a.d(A,"floor",function(){return Nf}),a.d(A,"floorDiv",function(){return $a}),a.d(A,"frame",function(){return sm}),a.d(A,"fused",function(){return _n}),a.d(A,"gather",function(){return cp}),a.d(A,"gatherND",function(){return om}),a.d(A,"gather_util",function(){return Eu}),a.d(A,"getBackend",function(){return bs}),a.d(A,"getGradient",function(){return K}),a.d(A,"getKernel",function(){return ie}),a.d(A,"getKernelsForBackend",function(){return de}),a.d(A,"grad",function(){return Pl}),a.d(A,"grads",function(){return Bf}),a.d(A,"greater",function(){return Lm}),a.d(A,"greaterEqual",function(){return sp}),a.d(A,"greaterEqualStrict",function(){return zm}),a.d(A,"greaterStrict",function(){return Xp}),a.d(A,"hammingWindow",function(){return nh}),a.d(A,"hannWindow",function(){return vp}),a.d(A,"ifft",function(){return Ka}),a.d(A,"imag",function(){return Ua}),a.d(A,"image",function(){return Xe}),a.d(A,"inTopKAsync",function(){return Ym}),a.d(A,"io",function(){return y}),a.d(A,"irfft",function(){return gp}),a.d(A,"isFinite",function(){return jl}),a.d(A,"isInf",function(){return If}),a.d(A,"isNaN",function(){return $d}),a.d(A,"keep",function(){return Dh}),a.d(A,"leakyRelu",function(){return dp}),a.d(A,"less",function(){return Mg}),a.d(A,"lessEqual",function(){return sl}),a.d(A,"lessEqualStrict",function(){return M0}),a.d(A,"lessStrict",function(){return jg}),a.d(A,"linalg",function(){return _}),a.d(A,"linspace",function(){return Fh}),a.d(A,"localResponseNormalization",function(){return mp}),a.d(A,"log",function(){return Yc}),a.d(A,"log1p",function(){return Hd}),a.d(A,"logSigmoid",function(){return zh}),a.d(A,"logSoftmax",function(){return Ge}),a.d(A,"logSumExp",function(){return tm}),a.d(A,"logicalAnd",function(){return Nu}),a.d(A,"logicalNot",function(){return Jh}),a.d(A,"logicalOr",function(){return $f}),a.d(A,"logicalXor",function(){return al}),a.d(A,"losses",function(){return Ir}),a.d(A,"matMul",function(){return dc}),a.d(A,"math",function(){return z}),a.d(A,"max",function(){return $m}),a.d(A,"maxPool",function(){return pc}),a.d(A,"maxPool3d",function(){return Qp}),a.d(A,"maxPoolWithArgmax",function(){return Gg}),a.d(A,"maximum",function(){return xa}),a.d(A,"maximumStrict",function(){return Hi}),a.d(A,"mean",function(){return Ic}),a.d(A,"memory",function(){return Sh}),a.d(A,"min",function(){return nm}),a.d(A,"minimum",function(){return ku}),a.d(A,"minimumStrict",function(){return ac}),a.d(A,"mod",function(){return qs}),a.d(A,"modStrict",function(){return sc}),a.d(A,"moments",function(){return Jg}),a.d(A,"movingAverage",function(){return Rc}),a.d(A,"mul",function(){return Xo}),a.d(A,"mulStrict",function(){return Vu}),a.d(A,"multiRNNCell",function(){return P0}),a.d(A,"multinomial",function(){return ts}),a.d(A,"neg",function(){return ba}),a.d(A,"nextFrame",function(){return vn}),a.d(A,"norm",function(){return Km}),a.d(A,"notEqual",function(){return up}),a.d(A,"notEqualStrict",function(){return Bg}),a.d(A,"oneHot",function(){return fc}),a.d(A,"ones",function(){return lu}),a.d(A,"onesLike",function(){return us}),a.d(A,"op",function(){return wt}),a.d(A,"outerProduct",function(){return Hg}),a.d(A,"pad",function(){return Fu}),a.d(A,"pad1d",function(){return fu}),a.d(A,"pad2d",function(){return Qh}),a.d(A,"pad3d",function(){return Wp}),a.d(A,"pad4d",function(){return jm}),a.d(A,"pool",function(){return lp}),a.d(A,"pow",function(){return Hs}),a.d(A,"powStrict",function(){return so}),a.d(A,"prelu",function(){return rs}),a.d(A,"print",function(){return oa}),a.d(A,"prod",function(){return hp}),a.d(A,"profile",function(){return _h}),a.d(A,"rand",function(){return Bm}),a.d(A,"randomGamma",function(){return Hp}),a.d(A,"randomNormal",function(){return Rg}),a.d(A,"randomUniform",function(){return $p}),a.d(A,"range",function(){return oc}),a.d(A,"ready",function(){return Id}),a.d(A,"real",function(){return ca}),a.d(A,"reciprocal",function(){return Rl}),a.d(A,"registerBackend",function(){return Ip}),a.d(A,"registerGradient",function(){return Ae}),a.d(A,"registerKernel",function(){return pe}),a.d(A,"relu",function(){return rm}),a.d(A,"relu6",function(){return Gm}),a.d(A,"removeBackend",function(){return ic}),a.d(A,"reshape",function(){return ks}),a.d(A,"reverse",function(){return Yl}),a.d(A,"reverse1d",function(){return B0}),a.d(A,"reverse2d",function(){return ed}),a.d(A,"reverse3d",function(){return td}),a.d(A,"reverse4d",function(){return Jl}),a.d(A,"rfft",function(){return id}),a.d(A,"round",function(){return Cs}),a.d(A,"rsqrt",function(){return Ml}),a.d(A,"scalar",function(){return fr}),a.d(A,"scatterND",function(){return Zg}),a.d(A,"scatter_util",function(){return Wh}),a.d(A,"selu",function(){return pp}),a.d(A,"separableConv2d",function(){return cl}),a.d(A,"serialization",function(){return Re}),a.d(A,"setBackend",function(){return Of}),a.d(A,"setPlatform",function(){return wm}),a.d(A,"setdiff1dAsync",function(){return Ni}),a.d(A,"sigmoid",function(){return Ff}),a.d(A,"sign",function(){return Uh}),a.d(A,"signal",function(){return Xm}),a.d(A,"sin",function(){return Gd}),a.d(A,"sinh",function(){return Kd}),a.d(A,"slice",function(){return ns}),a.d(A,"slice1d",function(){return Kg}),a.d(A,"slice2d",function(){return rd}),a.d(A,"slice3d",function(){return Xg}),a.d(A,"slice4d",function(){return Zp}),a.d(A,"slice_util",function(){return jf}),a.d(A,"softmax",function(){return Be}),a.d(A,"softplus",function(){return tn}),a.d(A,"spaceToBatchND",function(){return $c}),a.d(A,"sparseToDense",function(){return e0}),a.d(A,"spectral",function(){return im}),a.d(A,"split",function(){return Ri}),a.d(A,"sqrt",function(){return Vs}),a.d(A,"square",function(){return Kl}),a.d(A,"squaredDifference",function(){return Gp}),a.d(A,"squaredDifferenceStrict",function(){return cs}),a.d(A,"squeeze",function(){return Is}),a.d(A,"stack",function(){return ru}),a.d(A,"step",function(){return Un}),a.d(A,"stft",function(){return yp}),a.d(A,"stridedSlice",function(){return th}),a.d(A,"sub",function(){return _a}),a.d(A,"subStrict",function(){return ls}),a.d(A,"sum",function(){return fl}),a.d(A,"sumOutType",function(){return Jn}),a.d(A,"tan",function(){return Os}),a.d(A,"tanh",function(){return io}),a.d(A,"tensor",function(){return ko}),a.d(A,"tensor1d",function(){return Us}),a.d(A,"tensor2d",function(){return nu}),a.d(A,"tensor3d",function(){return Hc}),a.d(A,"tensor4d",function(){return Ws}),a.d(A,"tensor5d",function(){return Nh}),a.d(A,"tensor6d",function(){return jd}),a.d(A,"tensor_util",function(){return Ot}),a.d(A,"test_util",function(){return Yf}),a.d(A,"tidy",function(){return Ii}),a.d(A,"tile",function(){return Kf}),a.d(A,"time",function(){return bm}),a.d(A,"topk",function(){return L0}),a.d(A,"train",function(){return Qt}),a.d(A,"transpose",function(){return ft}),a.d(A,"truncatedNormal",function(){return Zh}),a.d(A,"unregisterGradient",function(){return je}),a.d(A,"unregisterKernel",function(){return Te}),a.d(A,"unsortedSegmentSum",function(){return Yp}),a.d(A,"unstack",function(){return Mh}),a.d(A,"util",function(){return Qr}),a.d(A,"valueAndGrad",function(){return Q}),a.d(A,"valueAndGrads",function(){return G}),a.d(A,"variable",function(){return Bd}),a.d(A,"variableGrads",function(){return C}),a.d(A,"version_core",function(){return Me}),a.d(A,"webgl",function(){return We}),a.d(A,"where",function(){return Nc}),a.d(A,"whereAsync",function(){return Gf}),a.d(A,"zeros",function(){return Ki}),a.d(A,"zerosLike",function(){return ii});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var re=function(p,c){return(re=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,l){o.__proto__=l}||function(o,l){for(var g in l)l.hasOwnProperty(g)&&(o[g]=l[g])})(p,c)};function J(p,c){function o(){this.constructor=p}re(p,c),p.prototype=c===null?Object.create(c):(o.prototype=c.prototype,new o)}function R(p,c,o,l){return new(o||(o=Promise))(function(g,S){function j(ae){try{ne(l.next(ae))}catch(me){S(me)}}function V(ae){try{ne(l.throw(ae))}catch(me){S(me)}}function ne(ae){ae.done?g(ae.value):new o(function(me){me(ae.value)}).then(j,V)}ne((l=l.apply(p,c||[])).next())})}function W(p,c){var o,l,g,S,j={label:0,sent:function(){if(1&g[0])throw g[1];return g[1]},trys:[],ops:[]};return S={next:V(0),throw:V(1),return:V(2)},typeof Symbol=="function"&&(S[Symbol.iterator]=function(){return this}),S;function V(ne){return function(ae){return function(me){if(o)throw new TypeError("Generator is already executing.");for(;j;)try{if(o=1,l&&(g=2&me[0]?l.return:me[0]?l.throw||((g=l.return)&&g.call(l),0):l.next)&&!(g=g.call(l,me[1])).done)return g;switch(l=0,g&&(me=[2&me[0],g.value]),me[0]){case 0:case 1:g=me;break;case 4:return j.label++,{value:me[1],done:!1};case 5:j.label++,l=me[1],me=[0];continue;case 7:me=j.ops.pop(),j.trys.pop();continue;default:if(!(g=(g=j.trys).length>0&&g[g.length-1])&&(me[0]===6||me[0]===2)){j=0;continue}if(me[0]===3&&(!g||me[1]>g[0]&&me[1]<g[3])){j.label=me[1];break}if(me[0]===6&&j.label<g[1]){j.label=g[1],g=me;break}if(g&&j.label<g[2]){j.label=g[2],j.ops.push(me);break}g[2]&&j.ops.pop(),j.trys.pop();continue}me=c.call(p,j)}catch(Ee){me=[6,Ee],l=0}finally{o=g=0}if(5&me[0])throw me[1];return{value:me[0]?me[1]:void 0,done:!0}}([ne,ae])}}}var q=function(){function p(c){this.global=c,this.flags={},this.flagRegistry={},this.urlFlags={},this.populateURLFlags()}return p.prototype.setPlatform=function(c,o){this.platform!=null&&console.warn("Platform "+this.platformName+" has already been set. Overwriting the platform with "+o+"."),this.platformName=c,this.platform=o},p.prototype.registerFlag=function(c,o,l){if(this.flagRegistry[c]={evaluationFn:o,setHook:l},this.urlFlags[c]!=null){var g=this.urlFlags[c];console.warn("Setting feature override from URL "+c+": "+g+"."),this.set(c,g)}},p.prototype.get=function(c){return c in this.flags?this.flags[c]:(this.flags[c]=this.evaluateFlag(c),this.flags[c])},p.prototype.getNumber=function(c){return this.get(c)},p.prototype.getBool=function(c){return this.get(c)},p.prototype.getFlags=function(){return this.flags},Object.defineProperty(p.prototype,"features",{get:function(){return this.flags},enumerable:!0,configurable:!0}),p.prototype.set=function(c,o){if(this.flagRegistry[c]==null)throw new Error("Cannot set flag "+c+" as it has not been registered.");this.flags[c]=o,this.flagRegistry[c].setHook!=null&&this.flagRegistry[c].setHook(o)},p.prototype.evaluateFlag=function(c){if(this.flagRegistry[c]==null)throw new Error("Cannot evaluate flag '"+c+"': no evaluation function found.");return this.flagRegistry[c].evaluationFn()},p.prototype.setFlags=function(c){this.flags=Object.assign({},c)},p.prototype.reset=function(){this.flags={},this.urlFlags={},this.populateURLFlags()},p.prototype.populateURLFlags=function(){var c=this;if(this.global!==void 0&&this.global.location!==void 0&&this.global.location.search!==void 0){var o,l,g=(o=this.global.location.search,l={},o.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,function(S){for(var j=[],V=1;V<arguments.length;V++)j[V-1]=arguments[V];return function(ne,ae,me){ne[decodeURIComponent(ae)]=decodeURIComponent(me||"")}(l,j[0],j[1]),j.join("=")}),l);"tfjsflags"in g&&g.tfjsflags.split(",").forEach(function(S){var j=S.split(":"),V=j[0],ne=j[1];c.urlFlags[V]=function(ae,me){if((me=me.toLowerCase())==="true"||me==="false")return me==="true";if(""+ +me===me)return+me;throw new Error("Could not parse value flag value "+me+" for flag "+ae+".")}(V,ne)})}},p}();function P(){return ee}var ee=null,I=new Map,se=new Map;function ie(p,c){var o=we(p,c);return I.get(o)}function K(p){return se.get(p)}function de(p){for(var c=I.entries(),o=[];;){var l=c.next(),g=l.done,S=l.value;if(g)break;var j=S[0],V=S[1];j.split("_")[0]===p&&o.push(V)}return o}function pe(p){var c=p.kernelName,o=p.backendName,l=we(c,o);if(I.has(l))throw new Error("The kernel '"+c+"' for backend '"+o+"' is already registered");I.set(l,p)}function Ae(p){var c=p.kernelName;se.has(c)&&console.warn("Overriding the gradient for '"+c+"'"),se.set(c,p)}function Te(p,c){var o=we(p,c);if(!I.has(o))throw new Error("The kernel '"+p+"' for backend '"+c+"' is not registered");I.delete(o)}function je(p){if(!se.has(p))throw new Error("The gradient '"+p+"' for backend is not registered");se.delete(p)}function we(p,c){return c+"_"+p}function ot(p){for(var c=p.length,o=0,l=0;c>0;)l=Math.random()*c|0,o=p[--c],p[c]=p[l],p[l]=o}function _t(p,c,o){return Math.max(p,Math.min(c,o))}function Ut(p){return p%2==0?p:p+1}function Xt(p){for(var c=0,o=0;o<p.length;o++)c+=p[o];return c}function ke(p,c){if(!p)throw new Error(typeof c=="string"?c:c())}function Ft(p,c,o){o===void 0&&(o=""),ke(ln(p,c),function(){return o+" Shapes "+p+" and "+c+" must match"})}function Gt(p){ke(p!=null,function(){return"The input to the tensor constructor must be a non-null value."})}function jt(p,c,o){if(c===void 0&&(c=[]),o===void 0&&(o=!1),c==null&&(c=[]),Array.isArray(p)||pt(p)&&!o)for(var l=0;l<p.length;++l)jt(p[l],c,o);else c.push(p);return c}function Ye(p){if(p.length===0)return 1;for(var c=p[0],o=1;o<p.length;o++)c*=p[o];return c}function ln(p,c){if(p===c)return!0;if(p==null||c==null||p.length!==c.length)return!1;for(var o=0;o<p.length;o++)if(p[o]!==c[o])return!1;return!0}function nn(p){return p%1==0}function Bt(p){if(Math.tanh!=null)return Math.tanh(p);if(p===1/0)return 1;if(p===-1/0)return-1;var c=Math.exp(2*p);return(c-1)/(c+1)}function Pt(p){var c=Math.ceil(Math.sqrt(p));return[c,Math.ceil(p/c)]}function gn(p,c){return c<=p.length?p:p+" ".repeat(c-p.length)}function Dt(p,c,o){return c===void 0&&(c=function(l){return 0}),new Promise(function(l,g){var S=0,j=function(){if(p())l();else{var V=c(++S);o!=null&&S>=o?g():setTimeout(j,V)}};j()})}function St(p,c){for(var o=1,l=-1,g=0;g<p.length;++g)if(p[g]>=0)o*=p[g];else if(p[g]===-1){if(l!==-1)throw Error("Shapes can only have 1 implicit size. Found -1 at dim "+l+" and dim "+g);l=g}else if(p[g]<0)throw Error("Shapes can not be < 0. Found "+p[g]+" at dim "+g);if(l===-1){if(c>0&&c!==o)throw Error("Size("+c+") must match the product of shape "+p);return p}if(o===0)throw Error("Cannot infer the missing size in ["+p+"] when there are 0 elements");if(c%o!=0)throw Error("The implicit shape can't be a fractional number. Got "+c+" / "+o);var S=p.slice();return S[l]=c/o,S}function wn(p,c){var o=c.length;return ke((p=p==null?c.map(function(l,g){return g}):[].concat(p)).every(function(l){return l>=-o&&l<o}),function(){return"All values in axis param must be in range [-"+o+", "+o+") but got axis "+p}),ke(p.every(function(l){return nn(l)}),function(){return"All values in axis param must be integers but got axis "+p}),p.map(function(l){return l<0?o+l:l})}function Bn(p,c){for(var o=[],l=[],g=c!=null&&Array.isArray(c)&&c.length===0,S=c==null||g?null:wn(c,p).sort(),j=0,V=0;V<p.length;++V){if(S!=null){if(S[j]===V&&p[V]!==1)throw new Error("Can't squeeze axis "+V+" since its dim '"+p[V]+"' is not 1");(S[j]==null||S[j]>V)&&p[V]===1&&(o.push(p[V]),l.push(V)),S[j]<=V&&j++}p[V]!==1&&(o.push(p[V]),l.push(V))}return{newShape:o,keptDims:l}}function Hn(p,c){var o=null;if(p==null||p==="float32")o=new Float32Array(c);else if(p==="int32")o=new Int32Array(c);else{if(p!=="bool")throw new Error("Unknown data type "+p);o=new Uint8Array(c)}return o}function hn(p,c){var o=null;if(p==null||p==="float32")o=new Float32Array(c);else if(p==="int32")o=new Int32Array(c);else if(p==="bool")o=new Uint8Array(c);else{if(p!=="string")throw new Error("Unknown data type "+p);o=new Array(c)}return o}function Ve(p,c){for(var o=0;o<p.length;o++){var l=p[o];if(isNaN(l)||!isFinite(l))throw Error("A tensor of type "+c+" being uploaded contains "+l+".")}}function Qe(p){return p==="bool"||p==="complex64"||p==="float32"||p==="int32"||p==="string"}function He(p,c){return!(c==="complex64"||c==="float32"&&p!=="complex64"||c==="int32"&&p!=="float32"&&p!=="complex64"||c==="bool"&&p==="bool")}function pt(p){return p instanceof Float32Array||p instanceof Int32Array||p instanceof Uint8Array}function Lt(p){if(p==="float32"||p==="int32")return 4;if(p==="complex64")return 8;if(p==="bool")return 1;throw new Error("Unknown dtype "+p)}function zt(p){if(p==null)return 0;var c=0;return p.forEach(function(o){return c+=o.length}),c}function Tn(p){return typeof p=="string"||p instanceof String}function xn(p){return typeof p=="boolean"}function Kn(p){return typeof p=="number"}function be(p){return Array.isArray(p)?be(p[0]):p instanceof Float32Array?"float32":p instanceof Int32Array||p instanceof Uint8Array?"int32":Kn(p)?"float32":Tn(p)?"string":xn(p)?"bool":"float32"}function Yn(p){return!!(p&&p.constructor&&p.call&&p.apply)}function Dr(p,c){for(var o=c;o<p;++o)if(p%o==0)return o;return p}function pr(p){var c=p.length;if(c<2)return[];var o=new Array(c-1);o[c-2]=p[c-1];for(var l=c-3;l>=0;--l)o[l]=o[l+1]*p[l+1];return o}function Nr(p,c,o){if(c==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(p)&&(p=jt(p)),o&&Ve(p,c),function(S,j){return S instanceof Float32Array&&j==="float32"||S instanceof Int32Array&&j==="int32"||S instanceof Uint8Array&&j==="bool"}(p,c))return p;if(c==null||c==="float32"||c==="complex64")return new Float32Array(p);if(c==="int32")return new Int32Array(p);if(c==="bool"){for(var l=new Uint8Array(p.length),g=0;g<l.length;++g)Math.round(p[g])!==0&&(l[g]=1);return l}throw new Error("Unknown data type "+c)}function Fr(p,c){if(p.length===0)return c[0];var o=p.reduce(function(l,g){return l*g});if(o===0)return[];if(o!==c.length)throw new Error("["+p+"] does not match the input size.");return function l(g,S,j){var V=new Array;if(S.length===1)for(var ne=S[0],ae=0;ae<ne;ae++)V[ae]=j[g+ae];else{ne=S[0];var me=S.slice(1),Ee=me.reduce(function(Se,Ne){return Se*Ne});for(ae=0;ae<ne;ae++)V[ae]=l(g+ae*Ee,me,j)}return V}(0,p,c)}function an(p,c){for(var o=Kt(p,c),l=0;l<o.length;l++)o[l]=1;return o}function Kt(p,c){if(c==null||c==="float32"||c==="complex64")return new Float32Array(p);if(c==="int32")return new Int32Array(p);if(c==="bool")return new Uint8Array(p);throw new Error("Unknown data type "+c)}function Zt(){return P().platform.now()}function $n(p){p.forEach(function(c){ke(Number.isInteger(c)&&c>=0,function(){return"Tensor must have a shape comprised of positive integers but got shape ["+p+"]."})})}function Dn(p,c){return c===void 0&&(c="utf-8"),c=c||"utf-8",P().platform.encode(p,c)}function hr(p,c){return c===void 0&&(c="utf-8"),c=c||"utf-8",P().platform.decode(p,c)}function wr(p,c,o){if(c===0)return 0;if(c===1)return p[0];for(var l=p[p.length-1],g=0;g<p.length-1;++g)l+=o[g]*p[g];return l}function gr(p,c,o){if(c===0)return[];if(c===1)return[p];for(var l=new Array(c),g=0;g<l.length-1;++g)l[g]=Math.floor(p/o[g]),p-=l[g]*o[g];return l[l.length-1]=p,l}var Qr=Object.freeze({shuffle:ot,clamp:_t,nearestLargerEven:Ut,sum:Xt,randUniform:function(p,c){var o=Math.random();return c*o+(1-o)*p},distSquared:function(p,c){for(var o=0,l=0;l<p.length;l++){var g=Number(p[l])-Number(c[l]);o+=g*g}return o},assert:ke,assertShapesMatch:Ft,assertNonNull:Gt,flatten:jt,sizeFromShape:Ye,isScalarShape:function(p){return p.length===0},arraysEqual:ln,isInt:nn,tanh:Bt,sizeToSquarishShape:Pt,createShuffledIndices:function(p){for(var c=new Uint32Array(p),o=0;o<p;++o)c[o]=o;return ot(c),c},rightPad:gn,repeatedTry:Dt,inferFromImplicitShape:St,parseAxisParam:wn,squeezeShape:Bn,getTypedArrayFromDType:Hn,getArrayFromDType:hn,checkConversionForErrors:Ve,isValidDtype:Qe,hasEncodingLoss:He,isTypedArray:pt,bytesPerElement:Lt,bytesFromStringArray:zt,isString:Tn,isBoolean:xn,isNumber:Kn,inferDtype:be,isFunction:Yn,nearestDivisor:Dr,computeStrides:pr,toTypedArray:Nr,toNestedArray:Fr,makeOnesTypedArray:an,makeZerosTypedArray:Kt,now:Zt,assertNonNegativeIntegerDimensions:$n,fetch:function(p,c){return P().platform.fetch(p,c)},encodeString:Dn,decodeString:hr,locToIndex:wr,indexToLoc:gr}),ti=function(){function p(c,o){this.backendTimer=c,this.logger=o,o==null&&(this.logger=new Mr)}return p.prototype.profileKernel=function(c,o,l){var g,S=this,j=this.backendTimer.time(function(){g=l()});return g.forEach(function(V){V.data().then(function(ne){(function(ae,me,Ee){if(me!=="float32")return!1;for(var Se=0;Se<ae.length;Se++){var Ne=ae[Se];if(isNaN(Ne)||!isFinite(Ne))return console.warn("Found "+Ne+" in the result of '"+Ee+"'"),!0}})(ne,V.dtype,c),j.then(function(ae){var me="";ae.getExtraProfileInfo!=null&&(me=ae.getExtraProfileInfo()),S.logger.logKernelProfile(c,V,ne,ae.kernelMs,o,me)})})}),g},p}(),Mr=function(){function p(){}return p.prototype.logKernelProfile=function(c,o,l,g,S,j){var V=typeof g=="number"?gn(g+"ms",9):g.error,ne=gn(c,25),ae=o.rank,me=o.size,Ee=gn(o.shape.toString(),14),Se="";for(var Ne in S){var ze=S[Ne].shape||o.shape,$e=ze.length;Se+=Ne+": "+$e+"D "+($e>0?ze:"")+" "}console.log("%c"+ne+"	%c"+V+"	%c"+ae+"D "+Ee+"	%c"+me+"	%c"+Se+"	%c"+j,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")},p}(),di=20,Yr=3,Xr=7;function fi(p,c,o){return gn(Array.isArray(p)?parseFloat(p[0].toFixed(Xr))+" + "+parseFloat(p[1].toFixed(Xr))+"j":Tn(p)?"'"+p+"'":o==="bool"?oi(p):parseFloat(p.toFixed(Xr)).toString(),c)}function oi(p){return p===0?"false":"true"}function Ao(p){for(var c=[],o=0;o<p.length;o+=2)c.push([p[o],p[o+1]]);return c}var Wi=function(){function p(c,o,l){var g=this;if(this.dtype=o,this.shape=c.slice(),this.size=Ye(c),l!=null){var S=l.length;ke(S===this.size,function(){return"Length of values '"+S+"' does not match the size inferred by the shape '"+g.size+"'."})}if(o==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=l||hn(o,this.size),this.strides=pr(c)}return p.prototype.set=function(c){for(var o=this,l=[],g=1;g<arguments.length;g++)l[g-1]=arguments[g];l.length===0&&(l=[0]),ke(l.length===this.rank,function(){return"The number of provided coordinates ("+l.length+") must match the rank ("+o.rank+")"});var S=this.locToIndex(l);this.values[S]=c},p.prototype.get=function(){for(var c=[],o=0;o<arguments.length;o++)c[o]=arguments[o];c.length===0&&(c=[0]);for(var l=0,g=0,S=c;g<S.length;g++){var j=S[g];if(j<0||j>=this.shape[l]){var V="Requested out of range element at "+c+".   Buffer shape="+this.shape;throw new Error(V)}l++}for(var ne=c[c.length-1],ae=0;ae<c.length-1;++ae)ne+=this.strides[ae]*c[ae];return this.values[ne]},p.prototype.locToIndex=function(c){if(this.rank===0)return 0;if(this.rank===1)return c[0];for(var o=c[c.length-1],l=0;l<c.length-1;++l)o+=this.strides[l]*c[l];return o},p.prototype.indexToLoc=function(c){if(this.rank===0)return[];if(this.rank===1)return[c];for(var o=new Array(this.shape.length),l=0;l<o.length-1;++l)o[l]=Math.floor(c/this.strides[l]),c-=o[l]*this.strides[l];return o[o.length-1]=c,o},Object.defineProperty(p.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),p.prototype.toTensor=function(){return Ei().makeTensor(this.values,this.shape,this.dtype)},p}(),Ei=null,bt=null,Lr=null,Mt=function(){function p(c,o,l,g){this.kept=!1,this.isDisposedInternal=!1,this.shape=c.slice(),this.dtype=o||"float32",this.size=Ye(c),this.strides=pr(c),this.dataId=l,this.id=g,this.rankType=this.rank<5?this.rank.toString():"higher"}return p.prototype.flatten=function(){return this.throwIfDisposed(),this.as1D()},p.prototype.asScalar=function(){return this.throwIfDisposed(),ke(this.size===1,function(){return"The array must have only 1 element."}),this.reshape([])},p.prototype.as1D=function(){return this.throwIfDisposed(),this.reshape([this.size])},p.prototype.as2D=function(c,o){return this.throwIfDisposed(),this.reshape([c,o])},p.prototype.as3D=function(c,o,l){return this.throwIfDisposed(),this.reshape([c,o,l])},p.prototype.as4D=function(c,o,l,g){return this.throwIfDisposed(),this.reshape([c,o,l,g])},p.prototype.as5D=function(c,o,l,g,S){return this.throwIfDisposed(),this.reshape([c,o,l,g,S])},p.prototype.asType=function(c){return this.throwIfDisposed(),bt.cast(this,c)},Object.defineProperty(p.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),p.prototype.buffer=function(){return R(this,void 0,void 0,function(){var c;return W(this,function(o){switch(o.label){case 0:return[4,this.data()];case 1:return c=o.sent(),[2,bt.buffer(this.shape,this.dtype,c)]}})})},p.prototype.bufferSync=function(){return bt.buffer(this.shape,this.dtype,this.dataSync())},p.prototype.array=function(){return R(this,void 0,void 0,function(){var c;return W(this,function(o){switch(o.label){case 0:return[4,this.data()];case 1:return c=o.sent(),[2,Fr(this.shape,c)]}})})},p.prototype.arraySync=function(){return Fr(this.shape,this.dataSync())},p.prototype.data=function(){return R(this,void 0,void 0,function(){var c,o;return W(this,function(l){switch(l.label){case 0:return this.throwIfDisposed(),c=Ei().read(this.dataId),this.dtype!=="string"?[3,2]:[4,c];case 1:o=l.sent();try{return[2,o.map(function(g){return hr(g)})]}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}l.label=2;case 2:return[2,c]}})})},p.prototype.dataSync=function(){this.throwIfDisposed();var c=Ei().readSync(this.dataId);if(this.dtype==="string")try{return c.map(function(o){return hr(o)})}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return c},p.prototype.bytes=function(){return R(this,void 0,void 0,function(){var c;return W(this,function(o){switch(o.label){case 0:return this.throwIfDisposed(),[4,Ei().read(this.dataId)];case 1:return c=o.sent(),this.dtype==="string"?[2,c]:[2,new Uint8Array(c.buffer)]}})})},p.prototype.dispose=function(){this.isDisposed||(Ei().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(p.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!0,configurable:!0}),p.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},p.prototype.toFloat=function(){return this.asType("float32")},p.prototype.toInt=function(){return this.asType("int32")},p.prototype.toBool=function(){return this.asType("bool")},p.prototype.print=function(c){return c===void 0&&(c=!1),bt.print(this,c)},p.prototype.reshape=function(c){return this.throwIfDisposed(),bt.reshape(this,c)},p.prototype.reshapeAs=function(c){return this.throwIfDisposed(),this.reshape(c.shape)},p.prototype.expandDims=function(c){return c===void 0&&(c=0),bt.expandDims(this,c)},p.prototype.cumsum=function(c,o,l){return c===void 0&&(c=0),o===void 0&&(o=!1),l===void 0&&(l=!1),bt.cumsum(this,c,o,l)},p.prototype.squeeze=function(c){return this.throwIfDisposed(),bt.squeeze(this,c)},p.prototype.clone=function(){return this.throwIfDisposed(),bt.clone(this)},p.prototype.toString=function(c){return c===void 0&&(c=!1),function(o,l,g,S){var j=pr(l),V=function(Ee,Se,Ne,ze){var $e=Ye(Se),qe=ze[ze.length-1],tt=new Array(qe).fill(0),lt=Se.length,ht=Ne==="complex64"?Ao(Ee):Ee;if(lt>1)for(var vt=0;vt<$e/qe;vt++)for(var Ct=vt*qe,Vt=0;Vt<qe;Vt++)tt[Vt]=Math.max(tt[Vt],fi(ht[Ct+Vt],0,Ne).length);return tt}(o,l,g,j),ne=l.length,ae=function Ee(Se,Ne,ze,$e,qe,tt){tt===void 0&&(tt=!0);var lt=ze==="complex64"?2:1,ht=Ne[0],vt=Ne.length;if(vt===0)return ze==="complex64"?[fi(Ao(Se)[0],0,ze)]:ze==="bool"?[oi(Se[0])]:[Se[0].toString()];if(vt===1){if(ht>di){var Ct=Yr*lt,Vt=Array.from(Se.slice(0,Ct)),Yt=Array.from(Se.slice((ht-Yr)*lt,ht*lt));return ze==="complex64"&&(Vt=Ao(Vt),Yt=Ao(Yt)),["["+Vt.map(function(ur,or){return fi(ur,qe[or],ze)}).join(", ")+", ..., "+Yt.map(function(ur,or){return fi(ur,qe[ht-Yr+or],ze)}).join(", ")+"]"]}return["["+(ze==="complex64"?Ao(Se):Array.from(Se)).map(function(ur,or){return fi(ur,qe[or],ze)}).join(", ")+"]"]}var qt=Ne.slice(1),$t=$e.slice(1),yn=$e[0]*lt,On=[];if(ht>di){for(var Cn=0;Cn<Yr;Cn++){var Xn=(er=Cn*yn)+yn;On.push.apply(On,Ee(Se.slice(er,Xn),qt,ze,$t,qe,!1))}for(On.push("..."),Cn=ht-Yr;Cn<ht;Cn++)Xn=(er=Cn*yn)+yn,On.push.apply(On,Ee(Se.slice(er,Xn),qt,ze,$t,qe,Cn===ht-1))}else for(Cn=0;Cn<ht;Cn++){var er;Xn=(er=Cn*yn)+yn,On.push.apply(On,Ee(Se.slice(er,Xn),qt,ze,$t,qe,Cn===ht-1))}var sr=vt===2?",":"";for(On[0]="["+On[0]+sr,Cn=1;Cn<On.length-1;Cn++)On[Cn]=" "+On[Cn]+sr;var lr=`,
`;for(Cn=2;Cn<vt;Cn++)lr+=`
`;return On[On.length-1]=" "+On[On.length-1]+"]"+(tt?"":lr),On}(o,l,g,j,V),me=["Tensor"];return S&&(me.push("  dtype: "+g),me.push("  rank: "+ne),me.push("  shape: ["+l+"]"),me.push("  values:")),me.push(ae.map(function(Ee){return"    "+Ee}).join(`
`)),me.join(`
`)}(this.dataSync(),this.shape,this.dtype,c)},p.prototype.gather=function(c,o){return o===void 0&&(o=0),this.throwIfDisposed(),bt.gather(this,c,o)},p.prototype.matMul=function(c,o,l){return o===void 0&&(o=!1),l===void 0&&(l=!1),this.throwIfDisposed(),bt.matMul(this,c,o,l)},p.prototype.dot=function(c){return this.throwIfDisposed(),bt.dot(this,c)},p.prototype.norm=function(c,o,l){return c===void 0&&(c="euclidean"),o===void 0&&(o=null),l===void 0&&(l=!1),this.throwIfDisposed(),bt.norm(this,c,o,l)},p.prototype.slice=function(c,o){return this.throwIfDisposed(),bt.slice(this,c,o)},p.prototype.reverse=function(c){return this.throwIfDisposed(),bt.reverse(this,c)},p.prototype.concat=function(c,o){return o===void 0&&(o=0),this.throwIfDisposed(),c instanceof p&&(c=[c]),bt.concat([this].concat(c),o)},p.prototype.split=function(c,o){return o===void 0&&(o=0),this.throwIfDisposed(),bt.split(this,c,o)},p.prototype.stack=function(c,o){return o===void 0&&(o=0),bt.stack([this,c],o)},p.prototype.unstack=function(c){return c===void 0&&(c=0),bt.unstack(this,c)},p.prototype.batchNormalization=function(c,o,l,g,S){return l===void 0&&(l=.001),Lr("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon"),this.batchNorm(c,o,S,g,l)},p.prototype.all=function(c,o){return c===void 0&&(c=null),o===void 0&&(o=!1),this.throwIfDisposed(),bt.all(this,c,o)},p.prototype.any=function(c,o){return c===void 0&&(c=null),o===void 0&&(o=!1),this.throwIfDisposed(),bt.any(this,c,o)},p.prototype.logSumExp=function(c,o){return c===void 0&&(c=null),o===void 0&&(o=!1),this.throwIfDisposed(),bt.logSumExp(this,c,o)},p.prototype.sum=function(c,o){return c===void 0&&(c=null),o===void 0&&(o=!1),this.throwIfDisposed(),bt.sum(this,c,o)},p.prototype.prod=function(c,o){return c===void 0&&(c=null),o===void 0&&(o=!1),this.throwIfDisposed(),bt.prod(this,c,o)},p.prototype.mean=function(c,o){return c===void 0&&(c=null),o===void 0&&(o=!1),this.throwIfDisposed(),bt.mean(this,c,o)},p.prototype.min=function(c,o){return c===void 0&&(c=null),o===void 0&&(o=!1),this.throwIfDisposed(),bt.min(this,c,o)},p.prototype.max=function(c,o){return c===void 0&&(c=null),o===void 0&&(o=!1),this.throwIfDisposed(),bt.max(this,c,o)},p.prototype.argMin=function(c){return c===void 0&&(c=null),this.throwIfDisposed(),bt.argMin(this,c)},p.prototype.argMax=function(c){return c===void 0&&(c=null),this.throwIfDisposed(),bt.argMax(this,c)},p.prototype.cast=function(c){return this.throwIfDisposed(),bt.cast(this,c)},p.prototype.addStrict=function(c){return this.throwIfDisposed(),bt.addStrict(this,c)},p.prototype.atan2=function(c){return this.throwIfDisposed(),bt.atan2(this,c)},p.prototype.sub=function(c){return this.throwIfDisposed(),bt.sub(this,c)},p.prototype.subStrict=function(c){return this.throwIfDisposed(),bt.subStrict(this,c)},p.prototype.pow=function(c){return this.throwIfDisposed(),bt.pow(this,c)},p.prototype.powStrict=function(c){return this.throwIfDisposed(),bt.powStrict(this,c)},p.prototype.mul=function(c){return this.throwIfDisposed(),bt.mul(this,c)},p.prototype.mulStrict=function(c){return this.throwIfDisposed(),bt.mulStrict(this,c)},p.prototype.floorDiv=function(c){return this.throwIfDisposed(),bt.floorDiv(this,c)},p.prototype.divStrict=function(c){return this.throwIfDisposed(),bt.divStrict(this,c)},p.prototype.minimum=function(c){return this.throwIfDisposed(),bt.minimum(this,c)},p.prototype.minimumStrict=function(c){return this.throwIfDisposed(),bt.minimumStrict(this,c)},p.prototype.maximum=function(c){return this.throwIfDisposed(),bt.maximum(this,c)},p.prototype.maximumStrict=function(c){return this.throwIfDisposed(),bt.maximumStrict(this,c)},p.prototype.mod=function(c){return this.throwIfDisposed(),bt.mod(this,c)},p.prototype.modStrict=function(c){return this.throwIfDisposed(),bt.modStrict(this,c)},p.prototype.squaredDifferenceStrict=function(c){return this.throwIfDisposed(),bt.squaredDifferenceStrict(this,c)},p.prototype.notEqual=function(c){return this.throwIfDisposed(),bt.notEqual(this,c)},p.prototype.notEqualStrict=function(c){return this.throwIfDisposed(),bt.notEqualStrict(this,c)},p.prototype.less=function(c){return this.throwIfDisposed(),bt.less(this,c)},p.prototype.lessStrict=function(c){return this.throwIfDisposed(),bt.lessStrict(this,c)},p.prototype.equal=function(c){return this.throwIfDisposed(),bt.equal(this,c)},p.prototype.equalStrict=function(c){return this.throwIfDisposed(),bt.equalStrict(this,c)},p.prototype.lessEqual=function(c){return this.throwIfDisposed(),bt.lessEqual(this,c)},p.prototype.lessEqualStrict=function(c){return this.throwIfDisposed(),bt.lessEqualStrict(this,c)},p.prototype.greater=function(c){return this.throwIfDisposed(),bt.greater(this,c)},p.prototype.greaterStrict=function(c){return this.throwIfDisposed(),bt.greaterStrict(this,c)},p.prototype.greaterEqual=function(c){return this.throwIfDisposed(),bt.greaterEqual(this,c)},p.prototype.greaterEqualStrict=function(c){return this.throwIfDisposed(),bt.greaterEqualStrict(this,c)},p.prototype.logicalAnd=function(c){return this.throwIfDisposed(),bt.logicalAnd(this,c)},p.prototype.logicalOr=function(c){return this.throwIfDisposed(),bt.logicalOr(this,c)},p.prototype.logicalNot=function(){return this.throwIfDisposed(),bt.logicalNot(this)},p.prototype.logicalXor=function(c){return this.throwIfDisposed(),bt.logicalXor(this,c)},p.prototype.where=function(c,o){return this.throwIfDisposed(),bt.where(c,this,o)},p.prototype.neg=function(){return this.throwIfDisposed(),bt.neg(this)},p.prototype.ceil=function(){return this.throwIfDisposed(),bt.ceil(this)},p.prototype.floor=function(){return this.throwIfDisposed(),bt.floor(this)},p.prototype.sign=function(){return this.throwIfDisposed(),bt.sign(this)},p.prototype.isNaN=function(){return this.throwIfDisposed(),bt.isNaN(this)},p.prototype.isInf=function(){return this.throwIfDisposed(),bt.isInf(this)},p.prototype.isFinite=function(){return this.throwIfDisposed(),bt.isFinite(this)},p.prototype.exp=function(){return this.throwIfDisposed(),bt.exp(this)},p.prototype.expm1=function(){return this.throwIfDisposed(),bt.expm1(this)},p.prototype.log=function(){return this.throwIfDisposed(),bt.log(this)},p.prototype.log1p=function(){return this.throwIfDisposed(),bt.log1p(this)},p.prototype.sqrt=function(){return this.throwIfDisposed(),bt.sqrt(this)},p.prototype.rsqrt=function(){return this.throwIfDisposed(),bt.rsqrt(this)},p.prototype.square=function(){return this.throwIfDisposed(),bt.square(this)},p.prototype.reciprocal=function(){return this.throwIfDisposed(),bt.reciprocal(this)},p.prototype.abs=function(){return this.throwIfDisposed(),bt.abs(this)},p.prototype.clipByValue=function(c,o){return this.throwIfDisposed(),bt.clipByValue(this,c,o)},p.prototype.relu=function(){return this.throwIfDisposed(),bt.relu(this)},p.prototype.relu6=function(){return this.throwIfDisposed(),bt.relu6(this)},p.prototype.elu=function(){return this.throwIfDisposed(),bt.elu(this)},p.prototype.selu=function(){return this.throwIfDisposed(),bt.selu(this)},p.prototype.leakyRelu=function(c){return c===void 0&&(c=.2),this.throwIfDisposed(),bt.leakyRelu(this,c)},p.prototype.prelu=function(c){return this.throwIfDisposed(),bt.prelu(this,c)},p.prototype.sigmoid=function(){return this.throwIfDisposed(),bt.sigmoid(this)},p.prototype.logSigmoid=function(){return this.throwIfDisposed(),bt.logSigmoid(this)},p.prototype.softplus=function(){return this.throwIfDisposed(),bt.softplus(this)},p.prototype.zerosLike=function(){return this.throwIfDisposed(),bt.zerosLike(this)},p.prototype.onesLike=function(){return this.throwIfDisposed(),bt.onesLike(this)},p.prototype.sin=function(){return this.throwIfDisposed(),bt.sin(this)},p.prototype.cos=function(){return this.throwIfDisposed(),bt.cos(this)},p.prototype.tan=function(){return this.throwIfDisposed(),bt.tan(this)},p.prototype.asin=function(){return this.throwIfDisposed(),bt.asin(this)},p.prototype.acos=function(){return this.throwIfDisposed(),bt.acos(this)},p.prototype.atan=function(){return this.throwIfDisposed(),bt.atan(this)},p.prototype.sinh=function(){return this.throwIfDisposed(),bt.sinh(this)},p.prototype.cosh=function(){return this.throwIfDisposed(),bt.cosh(this)},p.prototype.tanh=function(){return this.throwIfDisposed(),bt.tanh(this)},p.prototype.asinh=function(){return this.throwIfDisposed(),bt.asinh(this)},p.prototype.acosh=function(){return this.throwIfDisposed(),bt.acosh(this)},p.prototype.atanh=function(){return this.throwIfDisposed(),bt.atanh(this)},p.prototype.erf=function(){return this.throwIfDisposed(),bt.erf(this)},p.prototype.round=function(){return this.throwIfDisposed(),bt.round(this)},p.prototype.step=function(c){return c===void 0&&(c=0),this.throwIfDisposed(),bt.step(this,c)},p.prototype.softmax=function(c){return c===void 0&&(c=-1),this.throwIfDisposed(),bt.softmax(this,c)},p.prototype.logSoftmax=function(c){return c===void 0&&(c=-1),this.throwIfDisposed(),bt.logSoftmax(this,c)},p.prototype.resizeBilinear=function(c,o){return o===void 0&&(o=!1),this.throwIfDisposed(),bt.image.resizeBilinear(this,c,o)},p.prototype.resizeNearestNeighbor=function(c,o){return o===void 0&&(o=!1),this.throwIfDisposed(),bt.image.resizeNearestNeighbor(this,c,o)},p.prototype.conv1d=function(c,o,l,g,S,j){return g===void 0&&(g="NWC"),S===void 0&&(S=1),this.throwIfDisposed(),bt.conv1d(this,c,o,l,g,S,j)},p.prototype.conv2d=function(c,o,l,g,S,j){return g===void 0&&(g="NHWC"),S===void 0&&(S=[1,1]),this.throwIfDisposed(),bt.conv2d(this,c,o,l,g,S,j)},p.prototype.conv2dTranspose=function(c,o,l,g,S){return this.throwIfDisposed(),bt.conv2dTranspose(this,c,o,l,g,S)},p.prototype.depthwiseConv2D=function(c,o,l,g,S,j){return g===void 0&&(g="NHWC"),S===void 0&&(S=[1,1]),this.throwIfDisposed(),bt.depthwiseConv2d(this,c,o,l,g,S,j)},p.prototype.separableConv2d=function(c,o,l,g,S,j){return S===void 0&&(S=[1,1]),j===void 0&&(j="NHWC"),this.throwIfDisposed(),bt.separableConv2d(this,c,o,l,g,S,j)},p.prototype.avgPool=function(c,o,l,g){return this.throwIfDisposed(),bt.avgPool(this,c,o,l,g)},p.prototype.maxPool=function(c,o,l,g){return this.throwIfDisposed(),bt.maxPool(this,c,o,l,g)},p.prototype.localResponseNormalization=function(c,o,l,g){return c===void 0&&(c=5),o===void 0&&(o=1),l===void 0&&(l=1),g===void 0&&(g=.5),bt.localResponseNormalization(this,c,o,l,g)},p.prototype.pool=function(c,o,l,g,S){return this.throwIfDisposed(),bt.pool(this,c,o,l,g,S)},p.prototype.variable=function(c,o,l){return c===void 0&&(c=!0),this.throwIfDisposed(),Ei().makeVariable(this,c,o,l)},p.prototype.unsortedSegmentSum=function(c,o){return this.throwIfDisposed(),bt.unsortedSegmentSum(this,c,o)},p.prototype.batchToSpaceND=function(c,o){return this.throwIfDisposed(),bt.batchToSpaceND(this,c,o)},p.prototype.spaceToBatchND=function(c,o){return this.throwIfDisposed(),bt.spaceToBatchND(this,c,o)},p.prototype.topk=function(c,o){return c===void 0&&(c=1),o===void 0&&(o=!0),this.throwIfDisposed(),bt.topk(this,c,o)},p.prototype.stridedSlice=function(c,o,l,g,S,j,V,ne){return g===void 0&&(g=0),S===void 0&&(S=0),j===void 0&&(j=0),V===void 0&&(V=0),ne===void 0&&(ne=0),this.throwIfDisposed(),bt.stridedSlice(this,c,o,l,g,S,j,V,ne)},p.prototype.depthToSpace=function(c,o){return this.throwIfDisposed(),bt.depthToSpace(this,c,o)},p.prototype.fft=function(){return this.throwIfDisposed(),bt.spectral.fft(this)},p.prototype.ifft=function(){return this.throwIfDisposed(),bt.spectral.ifft(this)},p.prototype.rfft=function(){return this.throwIfDisposed(),bt.spectral.rfft(this)},p.prototype.irfft=function(){return this.throwIfDisposed(),bt.spectral.irfft(this)},p}();Object.defineProperty(Mt,Symbol.hasInstance,{value:function(p){return!!p&&p.dataId!=null&&p.shape!=null&&p.dtype!=null}});var ge,le,ye,_e,et,gt=function(p){function c(o,l,g,S){var j=p.call(this,o.shape,o.dtype,o.dataId,S)||this;return j.trainable=l,j.name=g,j}return J(c,p),c.prototype.assign=function(o){if(o.dtype!==this.dtype)throw new Error("dtype of the new value ("+o.dtype+") and previous value ("+this.dtype+") must match");if(!ln(o.shape,this.shape))throw new Error("shape of the new value ("+o.shape+") and previous value ("+this.shape+") must match");Ei().disposeTensor(this),this.dataId=o.dataId,Ei().incRef(this,null)},c.prototype.dispose=function(){Ei().disposeVariable(this),this.isDisposedInternal=!0},c}(Mt);Object.defineProperty(gt,Symbol.hasInstance,{value:function(p){return p instanceof Mt&&p.assign!=null&&p.assign instanceof Function}}),function(p){p.R0="R0",p.R1="R1",p.R2="R2",p.R3="R3",p.R4="R4",p.R5="R5",p.R6="R6"}(ge||(ge={})),function(p){p.float32="float32",p.int32="int32",p.bool="int32",p.complex64="complex64"}(le||(le={})),function(p){p.float32="float32",p.int32="int32",p.bool="bool",p.complex64="complex64"}(ye||(ye={})),function(p){p.float32="float32",p.int32="float32",p.bool="float32",p.complex64="complex64"}(_e||(_e={})),function(p){p.float32="complex64",p.int32="complex64",p.bool="complex64",p.complex64="complex64"}(et||(et={}));var Rt={float32:_e,int32:le,bool:ye,complex64:et};function fn(p,c){if(p==="string"||c==="string"){if(p==="string"&&c==="string")return"string";throw new Error("Can not upcast "+p+" with "+c)}return Rt[p][c]}function Jn(p){return fn(p,"int32")}function An(p,c){if(p.dtype===c.dtype)return[p,c];var o=fn(p.dtype,c.dtype);return[p.cast(o),c.cast(o)]}function Ln(p,c){ke(p.dtype===c.dtype,function(){return"The dtypes of the first("+p.dtype+") and second("+c.dtype+") input must match"})}function qn(p){var c=[];return function o(l,g,S){if(l!=null){if(l instanceof Mt)g.push(l);else if(j=l,Array.isArray(j)||typeof j=="object"){var j,V=l;for(var ne in V){var ae=V[ne];S.has(ae)||(S.add(ae),o(ae,g,S))}}}}(p,c,new Set),c}var Nt,Ot=Object.freeze({makeTypesMatch:An,assertTypesMatch:Ln,isTensorInList:function(p,c){return c.some(function(o){return o.id===p.id})},getTensorsInContainer:qn}),pn=function(){function p(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null}}return p.prototype.dispose=function(){for(var c in this.registeredVariables)this.registeredVariables[c].dispose()},p}(),Ht=function(){function p(c){this.ENV=c,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new pn}return p.prototype.ready=function(){return R(this,void 0,void 0,function(){var c,o,l;return W(this,function(g){switch(g.label){case 0:if(this.pendingBackendInit!=null)return[2,this.pendingBackendInit.then(function(){})];if(this.backendInstance!=null)return[2];c=this.getSortedBackends(),o=0,g.label=1;case 1:return o<c.length?(l=c[o],[4,this.initializeBackend(l).success]):[3,5];case 2:return g.sent()?[4,this.setBackend(l)]:[3,4];case 3:return g.sent(),[2];case 4:return o++,[3,1];case 5:throw new Error("Could not initialize any backends, all backend initializations failed.")}})})},Object.defineProperty(p.prototype,"backend",{get:function(){if(this.pendingBackendInit!=null)throw new Error("Backend '"+this.backendName+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");if(this.backendInstance==null){var c=this.initializeBackendsAndReturnBest(),o=c.name;if(c.asyncInit)throw new Error("The highest priority backend '"+o+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(o)}return this.backendInstance},enumerable:!0,configurable:!0}),p.prototype.backendNames=function(){return Object.keys(this.registryFactory)},p.prototype.findBackend=function(c){return!(c in this.registry)&&(!(c in this.registryFactory)||this.initializeBackend(c).asyncInit)?null:this.registry[c]},p.prototype.findBackendFactory=function(c){return c in this.registryFactory?this.registryFactory[c].factory:null},p.prototype.registerBackend=function(c,o,l){return l===void 0&&(l=1),c in this.registryFactory?(console.warn(c+" backend was already registered. Reusing existing backend factory."),!1):(this.registryFactory[c]={factory:o,priority:l},!0)},p.prototype.setBackend=function(c){return R(this,void 0,void 0,function(){var o,l,g;return W(this,function(S){switch(S.label){case 0:if(this.registryFactory[c]==null)throw new Error("Backend name '"+c+"' not found in registry");return this.backendName=c,this.registry[c]!=null?[3,4]:(this.backendInstance=null,o=this.initializeBackend(c),l=o.success,o.asyncInit?[4,l]:[3,2]);case 1:return g=S.sent(),[3,3];case 2:g=l,S.label=3;case 3:if(!g)return[2,!1];S.label=4;case 4:return this.backendInstance=this.registry[c],this.setupRegisteredKernels(),this.profiler=new ti(this.backendInstance),[2,!0]}})})},p.prototype.setupRegisteredKernels=function(){var c=this;de(this.backendName).forEach(function(o){o.setupFunc!=null&&o.setupFunc(c.backendInstance)})},p.prototype.disposeRegisteredKernels=function(c){var o=this;de(c).forEach(function(l){l.disposeFunc!=null&&l.disposeFunc(o.registry[c])})},p.prototype.initializeBackend=function(c){var o=this,l=this.registryFactory[c];if(l==null)throw new Error("Cannot initialize backend "+c+", no registration found.");try{var g=l.factory();if(Promise.resolve(g)===g){var S=++this.pendingBackendInitId,j=g.then(function(V){return!(S<o.pendingBackendInitId||(o.registry[c]=V,o.pendingBackendInit=null,0))}).catch(function(V){return!(S<o.pendingBackendInitId||(o.pendingBackendInit=null,console.warn("Initialization of backend "+c+" failed"),console.warn(V.stack||V.message),1))});return this.pendingBackendInit=j,{success:j,asyncInit:!0}}return this.registry[c]=g,{success:!0,asyncInit:!1}}catch(V){return console.warn("Initialization of backend "+c+" failed"),console.warn(V.stack||V.message),{success:!1,asyncInit:!1}}},p.prototype.removeBackend=function(c){if(!(c in this.registryFactory))throw new Error(c+" backend not found in registry");this.backendName===c&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,c in this.registry&&(this.disposeRegisteredKernels(c),this.registry[c].dispose(),delete this.registry[c]),delete this.registryFactory[c],this.backendName===c&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)},p.prototype.getSortedBackends=function(){var c=this;if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort(function(o,l){return c.registryFactory[l].priority-c.registryFactory[o].priority})},p.prototype.initializeBackendsAndReturnBest=function(){for(var c=this.getSortedBackends(),o=0;o<c.length;o++){var l=c[o],g=this.initializeBackend(l),S=g.success,j=g.asyncInit;if(j||S)return{name:l,asyncInit:j}}throw new Error("Could not initialize any backends, all backend initializations failed.")},p.prototype.moveData=function(c,o){var l=this.state.tensorInfo.get(o),g=l.backend,S=this.readSync(o);g.disposeData(o),l.backend=c,c.move(o,S,l.shape,l.dtype),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++},p.prototype.tidy=function(c,o){var l,g=this,S=null;if(o==null){if(typeof c!="function")throw new Error("Please provide a function to tidy()");o=c}else{if(typeof c!="string"&&!(c instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof o!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");S=c}return this.scopedRun(function(){return g.startScope(S)},function(){return g.endScope(l)},function(){return(l=o())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),l})},p.prototype.scopedRun=function(c,o,l){c();try{var g=l();return o(),g}catch(S){throw o(),S}},p.prototype.nextTensorId=function(){return p.nextTensorId++},p.prototype.nextVariableId=function(){return p.nextVariableId++},p.prototype.clone=function(c){var o=this.makeTensorFromDataId(c.dataId,c.shape,c.dtype),l={x:c};return this.addTapeNode(this.state.activeScope.name,l,[o],function(g){return{x:function(){return g.toFloat()}}},[],{}),o},p.prototype.runKernel=function(c,o,l,g,S){return this.runKernelFunc(null,o,null,c,l,g,S)},p.prototype.shouldCheckForMemLeaks=function(){return this.ENV.getBool("IS_TEST")},p.prototype.checkKernelForMemLeak=function(c,o,l){var g=this.backend.numDataIds(),S=0;l.forEach(function(ne){S+=ne.dtype==="complex64"?3:1});var j=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],V=g-o-S-j;if(V>0)throw new Error("Backend '"+this.backendName+"' has an internal memory leak ("+V+" data ids) after running '"+c+"'")},p.prototype.runKernelFunc=function(c,o,l,g,S,j,V){var ne,ae=this,me=[],Ee=this.isTapeOn();g==null&&(g=this.state.activeScope!=null?this.state.activeScope.name:"");var Se,Ne=this.state.numBytes,ze=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);var $e,qe=ie(g,this.backendName);if(qe!=null)Se=function(){var lt=ae.backend.numDataIds();$e=qe.kernelFunc({inputs:o,attrs:S,backend:ae.backend});var ht=Array.isArray($e)?$e:[$e];ae.shouldCheckForMemLeaks()&&ae.checkKernelForMemLeak(g,lt,ht);var vt=ht.map(function(Yt){var qt=Yt.dataId,$t=Yt.shape,yn=Yt.dtype;return ae.makeTensorFromDataId(qt,$t,yn)});if(Ee){var Ct=ae.getTensorsForGradient(g,o,vt);if(Ct==null){V==null&&(V=[]);var Vt=vt.filter(function(Yt,qt){return V[qt]});Ct=(j||[]).slice().concat(Vt)}me=ae.saveTensorsForBackwardMode(Ct)}return vt};else{var tt=function(lt){Ee&&(me=lt.map(function(ht){return ae.keep(ae.clone(ht))}))};Se=function(){var lt=ae.backend.numDataIds();$e=ae.tidy(function(){return c(ae.backend,tt)});var ht=Array.isArray($e)?$e:[$e];return ae.shouldCheckForMemLeaks()&&ae.checkKernelForMemLeak(g,lt,ht),ht}}return this.scopedRun(function(){return ae.state.kernelDepth++},function(){return ae.state.kernelDepth--},function(){ne=ae.ENV.getBool("DEBUG")?ae.profiler.profileKernel(g,o,function(){return Se()}):Se()}),Ee&&this.addTapeNode(g,o,ne,l,me,S),this.state.profiling&&this.state.activeProfile.kernels.push({name:g,bytesAdded:this.state.numBytes-Ne,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-ze,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(o).map(function(lt){return o[lt].shape}),outputShapes:ne.map(function(lt){return lt.shape})}),Array.isArray($e)?ne:ne[0]},p.prototype.saveTensorsForBackwardMode=function(c){var o=this;return c.map(function(l){return o.keep(o.clone(l))})},p.prototype.getTensorsForGradient=function(c,o,l){var g=K(c);if(g!=null){var S=g.inputsToSave||[],j=g.outputsToSave||[],V=void 0;g.saveAllInputs?(ke(Array.isArray(o),function(){return"saveAllInputs is true, expected inputs to be an array."}),V=Object.keys(o).map(function(ae){return o[ae]})):V=S.map(function(ae){return o[ae]});var ne=l.filter(function(ae,me){return j[me]});return V.concat(ne)}return null},p.prototype.makeTensor=function(c,o,l,g){if(c==null)throw new Error("Values passed to engine.makeTensor() are null");l=l||"float32",g=g||this.backend;var S=c;l==="string"&&Tn(c[0])&&(S=c.map(function(me){return Dn(me)}));var j=g.write(S,o,l),V=new Mt(o,l,j,this.nextTensorId());if(this.incRef(V,g),l==="string"){var ne=this.state.tensorInfo.get(j),ae=zt(S);this.state.numBytes+=ae-ne.bytes,ne.bytes=ae}return V},p.prototype.makeTensorFromDataId=function(c,o,l,g){var S=new Mt(o,l=l||"float32",c,this.nextTensorId());return this.incRef(S,g),S},p.prototype.makeVariable=function(c,o,l,g){o===void 0&&(o=!0),l=l||this.nextVariableId().toString(),g!=null&&g!==c.dtype&&(c=c.asType(g));var S=new gt(c,o,l,this.nextTensorId());if(this.state.registeredVariables[S.name]!=null)throw new Error("Variable with name "+S.name+" was already registered");return this.state.registeredVariables[S.name]=S,this.incRef(S,this.backend),S},p.prototype.incRef=function(c,o){var l=this.state.tensorInfo.has(c.dataId)?this.state.tensorInfo.get(c.dataId).refCount:0;if(this.state.numTensors++,c.dtype==="string"&&this.state.numStringTensors++,l===0){this.state.numDataBuffers++;var g=0;c.dtype!=="complex64"&&c.dtype!=="string"&&(g=c.size*Lt(c.dtype)),this.state.tensorInfo.set(c.dataId,{backend:o||this.backend,dtype:c.dtype,shape:c.shape,bytes:g,refCount:0}),this.state.numBytes+=g}this.state.tensorInfo.get(c.dataId).refCount++,c instanceof gt||this.track(c)},p.prototype.disposeTensor=function(c){if(this.state.tensorInfo.has(c.dataId)){this.state.numTensors--,c.dtype==="string"&&this.state.numStringTensors--;var o=this.state.tensorInfo.get(c.dataId);o.refCount<=1?(c.dtype!=="complex64"&&(this.state.numBytes-=o.bytes),this.state.numDataBuffers--,o.backend.disposeData(c.dataId),this.state.tensorInfo.delete(c.dataId)):this.state.tensorInfo.get(c.dataId).refCount--}},p.prototype.disposeVariables=function(){for(var c in this.state.registeredVariables){var o=this.state.registeredVariables[c];this.disposeVariable(o)}},p.prototype.disposeVariable=function(c){this.disposeTensor(c),this.state.registeredVariables[c.name]!=null&&delete this.state.registeredVariables[c.name]},p.prototype.memory=function(){var c=this.backend.memory();return c.numTensors=this.state.numTensors,c.numDataBuffers=this.state.numDataBuffers,c.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(c.unreliable=!0,c.reasons==null&&(c.reasons=[]),c.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),c},p.prototype.profile=function(c){return R(this,void 0,void 0,function(){var o,l;return W(this,function(g){return this.state.profiling=!0,o=this.state.numBytes,l=this.state.numTensors,this.state.activeProfile.kernels=[],this.state.activeProfile.result=c(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,this.state.activeProfile.kernels.map(function(S){return S.totalBytesSnapshot})),this.state.activeProfile.newBytes=this.state.numBytes-o,this.state.activeProfile.newTensors=this.state.numTensors-l,[2,this.state.activeProfile]})})},p.prototype.isTapeOn=function(){return this.state.gradientDepth>0&&this.state.kernelDepth===0},p.prototype.addTapeNode=function(c,o,l,g,S,j){var V=this,ne={id:this.state.nextTapeNodeId++,kernelName:c,inputs:o,outputs:l,saved:S},ae=K(c);ae!=null&&(g=ae.gradFunc),g!=null&&(ne.gradient=function(me){return me=me.map(function(Ee,Se){if(Ee==null){var Ne=l[Se],ze=Kt(Ne.size,Ne.dtype);return V.makeTensor(ze,Ne.shape,Ne.dtype)}return Ee}),g(me.length>1?me:me[0],S,j)}),this.state.activeTape.push(ne)},p.prototype.keep=function(c){return c.kept=!0,c},p.prototype.startTape=function(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++},p.prototype.endTape=function(){this.state.gradientDepth--},p.prototype.startScope=function(c){var o={track:[],name:"unnamed scope",id:this.state.nextScopeId++};c&&(o.name=c),this.state.scopeStack.push(o),this.state.activeScope=o},p.prototype.endScope=function(c){for(var o=this,l=qn(c),g=new Set(l.map(function(ne){return ne.id})),S=0;S<this.state.activeScope.track.length;S++){var j=this.state.activeScope.track[S];j.kept||g.has(j.id)||j.dispose()}var V=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],l.forEach(function(ne){ne.kept||ne.scopeId!==V.id||o.track(ne)})},p.prototype.gradients=function(c,o,l,g){var S=this;if(g===void 0&&(g=!1),ke(o.length>0,function(){return"gradients() received an empty list of xs."}),l!=null&&l.dtype!=="float32")throw new Error("dy must have 'float32' dtype, but has '"+l.dtype+"'");var j=this.scopedRun(function(){return S.startTape()},function(){return S.endTape()},function(){return S.tidy("forward",c)});ke(j instanceof Mt,function(){return"The result y returned by f() must be a tensor."});var V=function(ne,ae,me){for(var Ee={},Se={},Ne=0;Ne<ae.length;Ne++)Ee[ae[Ne].id]=!0;for(Ne=0;Ne<ne.length;Ne++){var ze=(Vt=ne[Ne]).inputs;for(var $e in ze){for(var qe=ze[$e],tt=!1,lt=0;lt<ae.length;lt++)if(Ee[qe.id]){Vt.outputs.forEach(function(yn){return Ee[yn.id]=!0}),tt=!0,Se[Vt.id]=!0;break}if(tt)break}}var ht={};ht[me.id]=!0;var vt={};for(Ne=ne.length-1;Ne>=0;Ne--)for(ze=(Vt=ne[Ne]).inputs,lt=0;lt<Vt.outputs.length;lt++)if(ht[Vt.outputs[lt].id]){for(var $e in ze)ht[ze[$e].id]=!0,vt[Vt.id]=!0;break}var Ct=[];for(Ne=0;Ne<ne.length;Ne++){var Vt;if(Se[(Vt=ne[Ne]).id]&&vt[Vt.id]){var Yt={};for(var $e in Vt.inputs){var qt=Vt.inputs[$e];Ee[qt.id]&&(Yt[$e]=qt)}var $t=Object.assign({},Vt);$t.inputs=Yt,$t.outputs=Vt.outputs,Ct.push($t)}}return Ct}(this.state.activeTape,o,j);if(!g&&V.length===0&&o.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",function(){var ne,ae,me={};me[j.id]=l??(ae=an(Ye(ne=j.shape),"float32"),Ue.makeTensor(ae,ne,"float32")),function(Se,Ne,ze){for(var $e=function(tt){var lt=Ne[tt],ht=[];if(lt.outputs.forEach(function(Yt){var qt=Se[Yt.id];qt!=null?ht.push(qt):ht.push(null)}),lt.gradient==null)throw new Error("Cannot compute gradient: gradient function not found for "+lt.kernelName+".");var vt=lt.gradient(ht),Ct=function(Yt){if(!(Yt in vt))throw new Error("Cannot backprop through input "+Yt+". Available gradients found: "+Object.keys(vt)+".");var qt=ze(function(){return vt[Yt]()});if(qt.dtype!=="float32")throw new Error("Error in gradient for op "+lt.kernelName+". The gradient of input "+Yt+" must have 'float32' dtype, but has '"+qt.dtype+"'");var $t=lt.inputs[Yt];if(!ln(qt.shape,$t.shape))throw new Error("Error in gradient for op "+lt.kernelName+". The gradient of input '"+Yt+"' has shape '"+qt.shape+"', which does not match the shape of the input '"+$t.shape+"'");if(Se[$t.id]==null)Se[$t.id]=qt;else{var yn=Se[$t.id];Se[$t.id]=yn.add(qt),yn.dispose()}};for(var Vt in lt.inputs)Ct(Vt)},qe=Ne.length-1;qe>=0;qe--)$e(qe)}(me,V,function(Se){return S.tidy(Se)});var Ee=o.map(function(Se){return me[Se.id]});return S.state.gradientDepth===0&&(S.state.activeTape.forEach(function(Se){for(var Ne=0,ze=Se.saved;Ne<ze.length;Ne++)ze[Ne].dispose()}),S.state.activeTape=null),{value:j,grads:Ee}})},p.prototype.customGrad=function(c){var o=this;return ke(Yn(c),function(){return"The f passed in customGrad(f) must be a function."}),function(){for(var l,g=[],S=0;S<arguments.length;S++)g[S]=arguments[S];ke(g.every(function(V){return V instanceof Mt}),function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"});var j={};return g.forEach(function(V,ne){j[ne]=V}),o.runKernelFunc(function(V,ne){return ke((l=c.apply(void 0,g.concat([ne]))).value instanceof Mt,function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"}),ke(Yn(l.gradFunc),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."}),l.value},j,function(V,ne){var ae=l.gradFunc(V,ne),me=Array.isArray(ae)?ae:[ae];ke(me.length===g.length,function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."}),ke(me.every(function(Se){return Se instanceof Mt}),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."});var Ee={};return me.forEach(function(Se,Ne){Ee[Ne]=function(){return Se}}),Ee})}},p.prototype.readSync=function(c){return this.state.tensorInfo.get(c).backend.readSync(c)},p.prototype.read=function(c){return this.state.tensorInfo.get(c).backend.read(c)},p.prototype.time=function(c){return R(this,void 0,void 0,function(){var o,l;return W(this,function(g){switch(g.label){case 0:return o=Zt(),[4,this.backend.time(c)];case 1:return(l=g.sent()).wallMs=Zt()-o,[2,l]}})})},p.prototype.track=function(c){return this.state.activeScope!=null&&(c.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(c)),c},Object.defineProperty(p.prototype,"registeredVariables",{get:function(){return this.state.registeredVariables},enumerable:!0,configurable:!0}),p.prototype.reset=function(){for(var c in this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new pn,this.registry)this.disposeRegisteredKernels(c),this.registry[c].dispose(),delete this.registry[c];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null},p.nextTensorId=0,p.nextVariableId=0,p}(),Ue=function(){var p=function(){if(Nt==null){var o=void 0;if(typeof window<"u")o=window;else if(b!==void 0)o=b;else if($!==void 0)o=$;else{if(typeof self>"u")throw new Error("Could not find a global object");o=self}Nt=o}return Nt}();if(p._tfengine==null){var c=new q(p);p._tfengine=new Ht(c)}return function(o){ee=o}(p._tfengine.ENV),Ei=function(){return p._tfengine},p._tfengine}();function Mn(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}var Gn=P();Gn.registerFlag("DEBUG",function(){return!1},function(p){p&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")}),Gn.registerFlag("IS_BROWSER",function(){return Mn()}),Gn.registerFlag("IS_NODE",function(){return $!==void 0&&$.versions!==void 0&&$.versions.node!==void 0}),Gn.registerFlag("IS_CHROME",function(){return typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)}),Gn.registerFlag("PROD",function(){return!1}),Gn.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",function(){return Gn.getBool("DEBUG")}),Gn.registerFlag("DEPRECATION_WARNINGS_ENABLED",function(){return!0}),Gn.registerFlag("IS_TEST",function(){return!1});var Zn,ir,zr,vr={},pi={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function fo(p,c){vr[p]=c}function ui(p){p in vr||(vr[p]=function(o){if(o!==1&&o!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var l=function(g){if(typeof OffscreenCanvas<"u"&&g===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}(o);return l.addEventListener("webglcontextlost",function(g){g.preventDefault(),delete vr[o]},!1),o===1?l.getContext("webgl",pi)||l.getContext("experimental-webgl",pi):l.getContext("webgl2",pi)}(p));var c=vr[p];return c.isContextLost()?(delete vr[p],ui(p)):(c.disable(c.DEPTH_TEST),c.disable(c.STENCIL_TEST),c.disable(c.BLEND),c.disable(c.DITHER),c.disable(c.POLYGON_OFFSET_FILL),c.disable(c.SAMPLE_COVERAGE),c.enable(c.SCISSOR_TEST),c.enable(c.CULL_FACE),c.cullFace(c.BACK),vr[p])}function Zi(p,c){return[c,p]}function Ti(p){var c=Ye(p);return Pt(Math.ceil(c/4))}function qr(p,c){return[Math.max(1,Math.ceil(c/2)),Math.max(1,Math.ceil(p/2))]}function jr(p,c){var o,l,g,S,j,V,ne,ae,me,Ee=p;return P().getNumber("WEBGL_VERSION")===2?(o=Ee.R32F,l=Ee.R16F,g=Ee.RGBA16F,S=Ee.RGBA32F,j=Ee.RED,V=4,ne=1,ae=Ee.HALF_FLOAT,me=Ee.FLOAT):(o=p.RGBA,l=p.RGBA,g=p.RGBA,S=Ee.RGBA,j=p.RGBA,V=4,ne=4,ae=c!=null?c.HALF_FLOAT_OES:null,me=p.FLOAT),{internalFormatFloat:o,internalFormatHalfFloat:l,internalFormatPackedHalfFloat:g,internalFormatPackedFloat:S,textureFormatFloat:j,downloadTextureFormat:p.RGBA,downloadUnpackNumChannels:V,defaultNumChannels:ne,textureTypeHalfFloat:ae,textureTypeFloat:me}}function jn(p,c,o){var l=o();return c&&function(g){var S=g.getError();if(S!==g.NO_ERROR)throw new Error("WebGL Error: "+ao(g,S))}(p),l}(function(p){p[p.DENSE=0]="DENSE",p[p.SHARED_BATCH=1]="SHARED_BATCH"})(Zn||(Zn={})),function(p){p[p.RENDER=0]="RENDER",p[p.UPLOAD=1]="UPLOAD",p[p.PIXELS=2]="PIXELS",p[p.DOWNLOAD=3]="DOWNLOAD"}(ir||(ir={})),function(p){p[p.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",p[p.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",p[p.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",p[p.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",p[p.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(zr||(zr={}));var ri=596e-10,Vi=65504;function Rr(p){return!!(P().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||p===0||ri<Math.abs(p)&&Math.abs(p)<Vi)}function ao(p,c){switch(c){case p.NO_ERROR:return"NO_ERROR";case p.INVALID_ENUM:return"INVALID_ENUM";case p.INVALID_VALUE:return"INVALID_VALUE";case p.INVALID_OPERATION:return"INVALID_OPERATION";case p.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case p.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case p.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code "+c}}function yo(p,c,o){return ua(p,c,function(){return p.getExtension(o)},'Extension "'+o+'" not supported on this browser.')}function eo(p,c,o){var l=ua(p,c,function(){return p.createShader(p.VERTEX_SHADER)},"Unable to create vertex WebGLShader.");if(jn(p,c,function(){return p.shaderSource(l,o)}),jn(p,c,function(){return p.compileShader(l)}),p.getShaderParameter(l,p.COMPILE_STATUS)===!1)throw console.log(p.getShaderInfoLog(l)),new Error("Failed to compile vertex shader.");return l}function bo(p,c,o){var l=ua(p,c,function(){return p.createShader(p.FRAGMENT_SHADER)},"Unable to create fragment WebGLShader.");if(jn(p,c,function(){return p.shaderSource(l,o)}),jn(p,c,function(){return p.compileShader(l)}),p.getShaderParameter(l,p.COMPILE_STATUS)===!1)throw function(g,S){var j=Eh.exec(S);if(j==null)return console.log("Couldn't parse line number in error: "+S),void console.log(g);for(var V=+j[1],ne=g.split(`
`),ae=ne.length.toString().length+2,me=ne.map(function(qe,tt){return gn((tt+1).toString(),ae)+qe}),Ee=0,Se=0;Se<me.length;Se++)Ee=Math.max(me[Se].length,Ee);var Ne=me.slice(0,V-1),ze=me.slice(V-1,V),$e=me.slice(V);console.log(Ne.join(`
`)),console.log(S.split(`
`)[0]),console.log("%c "+gn(ze[0],Ee),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log($e.join(`
`))}(o,p.getShaderInfoLog(l)),new Error("Failed to compile fragment shader.");return l}var Na,vs,Eh=/ERROR: [0-9]+:([0-9]+):/g;function qi(p,c){return ua(p,c,function(){return p.createProgram()},"Unable to create WebGLProgram.")}function ec(p,c,o){if(jn(p,c,function(){return p.linkProgram(o)}),p.getProgramParameter(o,p.LINK_STATUS)===!1)throw console.log(p.getProgramInfoLog(o)),new Error("Failed to link vertex and fragment shaders.")}function bu(p,c,o){if(jn(p,c,function(){return p.validateProgram(o)}),p.getProgramParameter(o,p.VALIDATE_STATUS)===!1)throw console.log(p.getProgramInfoLog(o)),new Error("Shader program validation failed.")}function bc(p,c,o){var l=ua(p,c,function(){return p.createBuffer()},"Unable to create WebGLBuffer");return jn(p,c,function(){return p.bindBuffer(p.ARRAY_BUFFER,l)}),jn(p,c,function(){return p.bufferData(p.ARRAY_BUFFER,o,p.STATIC_DRAW)}),l}function Bu(p,c,o){var l=ua(p,c,function(){return p.createBuffer()},"Unable to create WebGLBuffer");return jn(p,c,function(){return p.bindBuffer(p.ELEMENT_ARRAY_BUFFER,l)}),jn(p,c,function(){return p.bufferData(p.ELEMENT_ARRAY_BUFFER,o,p.STATIC_DRAW)}),l}function xc(p,c){return ua(p,c,function(){return p.createTexture()},"Unable to create WebGLTexture.")}function Dd(p,c){var o=P().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(p<=0||c<=0){var l="["+p+"x"+c+"]";throw new Error("Requested texture size "+l+" is invalid.")}if(p>o||c>o)throw l="["+p+"x"+c+"]",new Error("Requested texture size "+l+" greater than WebGL maximum on this browser / GPU ["+o+"x"+o+"].")}function as(p,c){return ua(p,c,function(){return p.createFramebuffer()},"Unable to create WebGLFramebuffer.")}function vf(p,c,o,l,g,S,j,V){var ne=p.getAttribLocation(o,l);return ne!==-1&&(jn(p,c,function(){return p.bindBuffer(p.ARRAY_BUFFER,g)}),jn(p,c,function(){return p.vertexAttribPointer(ne,S,p.FLOAT,!1,j,V)}),jn(p,c,function(){return p.enableVertexAttribArray(ne)}),!0)}function Td(p,c,o,l){tc(p,l),jn(p,c,function(){return p.activeTexture(p.TEXTURE0+l)}),jn(p,c,function(){return p.bindTexture(p.TEXTURE_2D,o)})}function Pu(p,c,o,l){return ua(p,c,function(){return p.getUniformLocation(o,l)},'uniform "'+l+'" not present in program.')}function yf(p,c,o){return p.getUniformLocation(c,o)}function Ch(p,c,o,l,g,S){jn(p,c,function(){return Td(p,c,l,S)}),jn(p,c,function(){return p.uniform1i(g,S)})}function wc(p,c,o,l){jn(p,c,function(){return p.bindFramebuffer(p.FRAMEBUFFER,l)}),jn(p,c,function(){return p.framebufferTexture2D(p.FRAMEBUFFER,p.COLOR_ATTACHMENT0,p.TEXTURE_2D,o,0)})}function El(p,c,o){jn(p,c,function(){return p.bindFramebuffer(p.FRAMEBUFFER,o)}),jn(p,c,function(){return p.framebufferTexture2D(p.FRAMEBUFFER,p.COLOR_ATTACHMENT0,p.TEXTURE_2D,null,0)})}function Fa(p){var c=p.checkFramebufferStatus(p.FRAMEBUFFER);if(c!==p.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+Vc(p,c))}function Vc(p,c){switch(c){case p.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case p.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case p.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case p.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error "+c}}function ua(p,c,o,l){var g=jn(p,c,function(){return o()});if(g==null)throw new Error(l);return g}function tc(p,c){var o=p.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,l=c+p.TEXTURE0;if(l<p.TEXTURE0||l>o)throw new Error("textureUnit must be in [gl.TEXTURE0, gl.TEXTURE"+o+"].")}function ss(p,c){return c===void 0&&(c=2),Ye(p.slice(0,p.length-c))}function Ca(p){if(p.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[p.length>1?p[p.length-2]:1,p[p.length-1]]}function nc(p){var c=[1,1,1];return p.length===0||p.length===1&&p[0]===1||(c=[ss(p)].concat(Ca(p))),c}function Cl(p,c){var o;c===void 0&&(c=!1);var l=P().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(c&&(l*=2,(p=p.map(function(ae,me){return me>=p.length-2?Ut(p[me]):p[me]})).length===1&&(p=[2,p[0]])),p.length!==2){var g=Bn(p);p=g.newShape}var S=Ye(p);if(p.length<=1&&S<=l)return[1,S];if(p.length===2&&p[0]<=l&&p[1]<=l)return p;if(p.length===3&&p[0]*p[1]<=l&&p[2]<=l)return[p[0]*p[1],p[2]];if(p.length===3&&p[0]<=l&&p[1]*p[2]<=l)return[p[0],p[1]*p[2]];if(p.length===4&&p[0]*p[1]*p[2]<=l&&p[3]<=l)return[p[0]*p[1]*p[2],p[3]];if(p.length===4&&p[0]<=l&&p[1]*p[2]*p[3]<=l)return[p[0],p[1]*p[2]*p[3]];if(c){var j=ss(p),V=2,ne=2;return p.length&&(V=(o=Ca(p))[0],ne=o[1]),Pt(S=j*(V/2)*(ne/2)).map(function(ae){return 2*ae})}return Pt(S)}function rc(p){return p%2==0}function cu(p,c){if(ln(p=p.slice(-2),c=c.slice(-2))||!p.length||!c.length||p[0]===0||p[1]===0||c[0]===0||c[1]===0)return!0;if(p.length!==c.length){var o=p.slice(-1)[0],l=c.slice(-1)[0];if(o===l||rc(o)&&rc(l)&&(p[0]===1||c[0]===1))return!0}return p[1]===c[1]&&rc(p[0])&&rc(c[0])}function Oh(p){if(Na==null){var c=ui(p);Na=c.getParameter(c.MAX_TEXTURE_SIZE)}return Na}function bf(p){if(vs==null){var c=ui(p);vs=c.getParameter(c.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,vs)}function xf(p){if(p===0)return 0;var c=ui(p);return fa(c,"EXT_disjoint_timer_query_webgl2")&&p===2?2:fa(c,"EXT_disjoint_timer_query")?1:0}function fa(p,c){return p.getExtension(c)!=null}function Ah(p){try{if(ui(p)!=null)return!0}catch{return!1}return!1}function Nd(p){if(p===0)return!1;var c=ui(p);if(p===1){if(!fa(c,"OES_texture_float"))return!1}else if(!fa(c,"EXT_color_buffer_float"))return!1;return kf(c)}function wf(p){if(p===0)return!1;var c=ui(p);return p!==1?fa(c,"EXT_color_buffer_float")?kf(c):!!fa(c,"EXT_color_buffer_half_float")&&function(o,l){var g=jr(o,l),S=o.createTexture();o.bindTexture(o.TEXTURE_2D,S),o.texImage2D(o.TEXTURE_2D,0,g.internalFormatHalfFloat,1,1,0,g.textureFormatFloat,g.textureTypeHalfFloat,null);var j=o.createFramebuffer();o.bindFramebuffer(o.FRAMEBUFFER,j),o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,S,0);var V=o.checkFramebufferStatus(o.FRAMEBUFFER)===o.FRAMEBUFFER_COMPLETE;return o.bindTexture(o.TEXTURE_2D,null),o.bindFramebuffer(o.FRAMEBUFFER,null),o.deleteTexture(S),o.deleteFramebuffer(j),V}(c,c.getExtension("EXT_color_buffer_half_float")):!!fa(c,"OES_texture_float")&&!!fa(c,"WEBGL_color_buffer_float")&&kf(c)}function kf(p){var c=jr(p),o=p.createTexture();p.bindTexture(p.TEXTURE_2D,o),p.texImage2D(p.TEXTURE_2D,0,c.internalFormatFloat,1,1,0,c.textureFormatFloat,c.textureTypeFloat,null);var l=p.createFramebuffer();p.bindFramebuffer(p.FRAMEBUFFER,l),p.framebufferTexture2D(p.FRAMEBUFFER,p.COLOR_ATTACHMENT0,p.TEXTURE_2D,o,0);var g=p.checkFramebufferStatus(p.FRAMEBUFFER)===p.FRAMEBUFFER_COMPLETE;return p.bindTexture(p.TEXTURE_2D,null),p.bindFramebuffer(p.FRAMEBUFFER,null),p.deleteTexture(o),p.deleteFramebuffer(l),g}function ys(p){return p===2&&ui(p).fenceSync!=null}var Ef=Object.freeze({callAndCheck:jn,canBeRepresented:Rr,getWebGLErrorMessage:ao,getExtensionOrThrow:yo,createVertexShader:eo,createFragmentShader:bo,createProgram:qi,linkProgram:ec,validateProgram:bu,createStaticVertexBuffer:bc,createStaticIndexBuffer:Bu,getNumChannels:function(){return P().getNumber("WEBGL_VERSION")===2?1:4},createTexture:xc,validateTextureSize:Dd,createFramebuffer:as,bindVertexBufferToProgramAttribute:vf,bindTextureUnit:Td,unbindTextureUnit:function(p,c,o){tc(p,o),jn(p,c,function(){return p.activeTexture(p.TEXTURE0+o)}),jn(p,c,function(){return p.bindTexture(p.TEXTURE_2D,null)})},getProgramUniformLocationOrThrow:Pu,getProgramUniformLocation:yf,bindTextureToProgramUniformSampler:Ch,bindCanvasToFramebuffer:function(p,c){jn(p,c,function(){return p.bindFramebuffer(p.FRAMEBUFFER,null)}),jn(p,c,function(){return p.viewport(0,0,p.canvas.width,p.canvas.height)}),jn(p,c,function(){return p.scissor(0,0,p.canvas.width,p.canvas.height)})},bindColorTextureToFramebuffer:wc,unbindColorTextureFromFramebuffer:El,validateFramebuffer:Fa,getFramebufferErrorMessage:Vc,getBatchDim:ss,getRowsCols:Ca,getShapeAs3D:nc,getTextureShapeFromLogicalShape:Cl,isReshapeFree:cu,getWebGLMaxTextureSize:Oh,resetMaxTextureSize:function(){Na=null},resetMaxTexturesInShader:function(){vs=null},getMaxTexturesInShader:bf,getWebGLDisjointQueryTimerVersion:xf,hasExtension:fa,isWebGLVersionEnabled:Ah,isCapableOfRenderingToFloatTexture:Nd,isDownloadFloatTextureEnabled:wf,isWebGLFenceEnabled:ys}),ar=P();function xu(){P().set("PROD",!0)}function Tp(){P().set("DEBUG",!0)}function Np(){P().set("DEPRECATION_WARNINGS_ENABLED",!1),console.warn("TensorFlow.js deprecation warnings have been disabled.")}function Cf(p){P().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(p+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function Ol(){Ue.disposeVariables()}function Fd(){return Ue}function Sh(){return Ue.memory()}function _h(p){return Ue.profile(p)}function Ii(p,c){return Ue.tidy(p,c)}function No(p){qn(p).forEach(function(c){return c.dispose()})}function Dh(p){return Ue.keep(p)}function bm(p){return Ue.time(p)}function Of(p){return Ue.setBackend(p)}function Id(){return Ue.ready()}function bs(){return Ue.backendName}function ic(p){Ue.removeBackend(p)}function Rd(p){return Ue.findBackend(p)}function Fp(p){return Ue.findBackendFactory(p)}function Ip(p,c,o){return o===void 0&&(o=1),Ue.registerBackend(p,c,o)}function xm(){return Ue.backend}function wm(p,c){P().setPlatform(p,c)}function qc(){for(var p=[],c=0;c<arguments.length;c++)p[c]=arguments[c];P().getBool("IS_TEST")||console.warn.apply(console,p)}function za(p,c){var o=p;if(pt(p))return c==="string"?[]:[p.length];if(!Array.isArray(p))return[];for(var l=[];Array.isArray(o)||pt(o)&&c!=="string";)l.push(o.length),o=o[0];return Array.isArray(p)&&P().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&function g(S,j,V){if(V=V||[],Array.isArray(S)||pt(S)){ke(j.length>0,function(){return"Element arr["+V.join("][")+"] should be a primitive, but is an array of "+S.length+" elements"}),ke(S.length===j[0],function(){return"Element arr["+V.join("][")+"] should have "+j[0]+" elements, but has "+S.length+" elements"});for(var ne=j.slice(1),ae=0;ae<S.length;++ae)g(S[ae],ne,V.concat(ae))}else ke(j.length===0,function(){return"Element arr["+V.join("][")+"] is a primitive, but should be an array/TypedArray of "+j[0]+" elements"})}(p,l,[]),l}function Th(p,c,o,l){if(p!=null&&(p!=="numeric"&&p!==c||p==="numeric"&&c==="string"))throw new Error("Argument '"+o+"' passed to '"+l+"' must be "+p+" tensor, but got "+c+" tensor")}function Ke(p,c,o,l){if(l===void 0&&(l="numeric"),p instanceof Mt)return Th(l,p.dtype,c,o),p;var g=be(p);if(g!=="string"&&["bool","int32","float32"].indexOf(l)>=0&&(g=l),Th(l,g,c,o),p==null||!pt(p)&&!Array.isArray(p)&&typeof p!="number"&&typeof p!="boolean"&&typeof p!="string"){var S=p==null?"null":p.constructor.name;throw new Error("Argument '"+c+"' passed to '"+o+"' must be a Tensor or TensorLike, but got '"+S+"'")}var j=za(p,g);pt(p)||Array.isArray(p)||(p=[p]);var V=g!=="string"?Nr(p,g,P().getBool("DEBUG")):jt(p,[],!0);return Ue.makeTensor(V,j,g)}function Lu(p,c,o,l){if(l===void 0&&(l="numeric"),!Array.isArray(p))throw new Error("Argument "+c+" passed to "+o+" must be a `Tensor[]` or `TensorLike[]`");return p.map(function(g,S){return Ke(g,c+"["+S+"]",o)},l)}function Af(p,c){for(var o=0;o<p.length;++o)if(p[p.length-o-1]!==c-1-o)return!1;return!0}function Md(p,c,o){for(var l=p.length+c.length,g=[],S=0,j=0,V=0;V<l;V++)o.indexOf(V)===-1?g.push(p[S++]):g.push(c[j++]);return g}function So(p,c){for(var o=[],l=p.length,g=0;g<l;g++)c.indexOf(g)===-1&&o.push(p[g]);return[o,c.map(function(S){return p[S]})]}function _o(p,c){return Md(p,c.map(function(o){return 1}),c)}function Ko(p,c,o){ke(Af(c,o),function(){return p+" supports only inner-most axes for now. Got axes "+c+" and rank-"+o+" input."})}function Oa(p,c){if(Af(p,c))return null;for(var o=[],l=0;l<c;++l)p.indexOf(l)===-1&&o.push(l);return p.forEach(function(g){return o.push(g)}),o}function wu(p){return p.map(function(c,o){return[o,c]}).sort(function(c,o){return c[1]-o[1]}).map(function(c){return c[0]})}function Aa(p,c){for(var o=[],l=c-p;l<c;++l)o.push(l);return o}function kc(p,c){var o=p[0].length;p.forEach(function(g,S){ke(g.length===o,function(){return"Error in concat"+o+"D: rank of tensors["+S+"] must be the same as the rank of the rest ("+o+")"})}),ke(c>=0&&c<o,function(){return"Error in concat"+o+"D: axis must be between 0 and "+(o-1)+"."});var l=p[0];p.forEach(function(g,S){for(var j=0;j<o;j++)ke(j===c||g[j]===l[j],function(){return"Error in concat"+o+"D: Shape of tensors["+S+"] ("+g+") does not match the shape of the rest ("+l+") along the non-concatenated axis "+S+"."})})}function tu(p,c){for(var o=p[0].slice(),l=1;l<p.length;l++)o[c]+=p[l][c];return o}function wt(p){var c=Object.keys(p);if(c.length!==1)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+c.length+" keys.");var o=c[0],l=p[o];o.endsWith("_")&&(o=o.substring(0,o.length-1));var g=function(){for(var S=[],j=0;j<arguments.length;j++)S[j]=arguments[j];Ue.startScope(o);try{var V=l.apply(void 0,S);return V instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),Ue.endScope(V),V}catch(ne){throw Ue.endScope(null),ne}};return Object.defineProperty(g,"name",{value:o,configurable:!0}),g}ar.registerFlag("HAS_WEBGL",function(){return ar.getNumber("WEBGL_VERSION")>0}),ar.registerFlag("WEBGL_VERSION",function(){return Ah(2)?2:Ah(1)?1:0}),ar.registerFlag("WEBGL_BUFFER_SUPPORTED",function(){return ar.get("WEBGL_VERSION")===2}),ar.registerFlag("WEBGL_CPU_FORWARD",function(){return!0}),ar.registerFlag("WEBGL_FORCE_F16_TEXTURES",function(){return!1}),ar.registerFlag("WEBGL_PACK",function(){return ar.getBool("HAS_WEBGL")}),ar.registerFlag("WEBGL_PACK_NORMALIZATION",function(){return ar.getBool("WEBGL_PACK")}),ar.registerFlag("WEBGL_PACK_CLIP",function(){return ar.getBool("WEBGL_PACK")}),ar.registerFlag("WEBGL_PACK_DEPTHWISECONV",function(){return!1}),ar.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",function(){return ar.getBool("WEBGL_PACK")}),ar.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",function(){return ar.getBool("WEBGL_PACK")}),ar.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",function(){return ar.getBool("WEBGL_PACK")}),ar.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",function(){return ar.getBool("WEBGL_PACK")}),ar.registerFlag("WEBGL_PACK_REDUCE",function(){return ar.getBool("WEBGL_PACK")}),ar.registerFlag("WEBGL_LAZILY_UNPACK",function(){return ar.getBool("WEBGL_PACK")}),ar.registerFlag("WEBGL_CONV_IM2COL",function(){return ar.getBool("WEBGL_PACK")}),ar.registerFlag("WEBGL_MAX_TEXTURE_SIZE",function(){return Oh(ar.getNumber("WEBGL_VERSION"))}),ar.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",function(){return bf(ar.getNumber("WEBGL_VERSION"))}),ar.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",function(){var p=ar.getNumber("WEBGL_VERSION");return p===0?0:xf(p)}),ar.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",function(){return ar.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&(p=navigator.userAgent||navigator.vendor||window.opera,!(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(p)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(p.substr(0,4))));var p}),ar.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",function(){return Nd(ar.getNumber("WEBGL_VERSION"))}),ar.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",function(){return!ar.getBool("WEBGL_FORCE_F16_TEXTURES")&&ar.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")}),ar.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",function(){return wf(ar.getNumber("WEBGL_VERSION"))}),ar.registerFlag("WEBGL_FENCE_API_ENABLED",function(){return ys(ar.getNumber("WEBGL_VERSION"))}),ar.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",function(){return ar.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0}),Lr=Cf;var ho=wt({complex_:function(p,c){var o=Ke(p,"real","complex"),l=Ke(c,"imag","complex");return Ft(o.shape,l.shape,"real and imag shapes, "+o.shape+" and "+l.shape+", must match in call to tf.complex()."),Ue.runKernelFunc(function(g){return g.complex(o,l)},{$real:o,$imag:l})}}),ca=wt({real_:function(p){var c=Ke(p,"input","real");return Ue.runKernelFunc(function(o){return o.real(c)},{$input:c})}}),Ua=wt({imag_:function(p){var c=Ke(p,"input","imag");return Ue.runKernelFunc(function(o){return o.imag(c)},{$input:c})}});function ko(p,c,o){return xs(p,c,za(p,o),o)}function xs(p,c,o,l){if(l==null&&(l=be(p)),l==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!pt(p)&&!Array.isArray(p)&&typeof p!="number"&&typeof p!="boolean"&&typeof p!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(c!=null){$n(c);var g=Ye(c),S=Ye(o);ke(g===S,function(){return"Based on the provided shape, ["+c+"], the tensor should have "+g+" values but has "+S});for(var j=0;j<o.length;++j){var V=o[j],ne=j!==o.length-1||V!==Ye(c.slice(j));ke(o[j]===c[j]||!ne,function(){return"Error creating a new Tensor. Inferred shape ("+o+") does not match the provided shape ("+c+"). "})}}return pt(p)||Array.isArray(p)||(p=[p]),c=c||o,p=l!=="string"?Nr(p,l,P().getBool("DEBUG")):jt(p,[],!0),Ue.makeTensor(p,c,l)}function fr(p,c){if((pt(p)&&c!=="string"||Array.isArray(p))&&c!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(c==="string"&&pt(p)&&!(p instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return xs(p,[],[],c)}function Us(p,c){Gt(p);var o=za(p,c);if(o.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return xs(p,null,o,c)}function nu(p,c,o){if(Gt(p),c!=null&&c.length!==2)throw new Error("tensor2d() requires shape to have two numbers");var l=za(p,o);if(l.length!==2&&l.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(l.length===1&&c==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return xs(p,c,l,o)}function Hc(p,c,o){if(Gt(p),c!=null&&c.length!==3)throw new Error("tensor3d() requires shape to have three numbers");var l=za(p,o);if(l.length!==3&&l.length!==1)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(l.length===1&&c==null)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return xs(p,c,l,o)}function Ws(p,c,o){if(Gt(p),c!=null&&c.length!==4)throw new Error("tensor4d() requires shape to have four numbers");var l=za(p,o);if(l.length!==4&&l.length!==1)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(l.length===1&&c==null)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return xs(p,c,l,o)}function Nh(p,c,o){if(Gt(p),c!=null&&c.length!==5)throw new Error("tensor5d() requires shape to have five numbers");var l=za(p,o);if(l.length!==5&&l.length!==1)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(l.length===1&&c==null)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return xs(p,c,l,o)}function jd(p,c,o){if(Gt(p),c!=null&&c.length!==6)throw new Error("tensor6d() requires shape to have six numbers");var l=za(p,o);if(l.length!==6&&l.length!==1)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(l.length===1&&c==null)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return xs(p,c=c||l,l,o)}function Bd(p,c,o,l){return c===void 0&&(c=!0),Ue.makeVariable(p,c,o,l)}function lu(p,c){if(c===void 0&&(c="float32"),c==="complex64"){var o=lu(p,"float32"),l=Ki(p,"float32");return ho(o,l)}var g=an(Ye(p),c);return Ue.makeTensor(g,p,c)}function Ki(p,c){if(c===void 0&&(c="float32"),c==="complex64"){var o=Ki(p,"float32"),l=Ki(p,"float32");return ho(o,l)}var g=Kt(Ye(p),c);return Ue.makeTensor(g,p,c)}function ws(p,c,o){return Ue.runKernelFunc(function(l){return l.fill(p,c,o)},{})}function Fh(p,c,o){if(o<=0)throw new Error("The number of values should be positive.");return Ue.runKernelFunc(function(l){return l.linspace(p,c,o)},{})}function oc(p,c,o,l){if(o===void 0&&(o=1),l===void 0&&(l="float32"),o===0)throw new Error("Cannot have a step of zero");if(p===c||p<c&&o<0||c<p&&o>1)return Ki([0],l);var g=Kt(Math.abs(Math.ceil((c-p)/o)),l);c<p&&o===1&&(o=-1),g[0]=p;for(var S=1;S<g.length;S++)g[S]=g[S-1]+o;return Us(g,l)}var us=wt({onesLike_:function(p){var c=Ke(p,"x","onesLike");if(c.dtype==="complex64"){var o=us(ca(c)),l=ii(Ua(c));return ho(o,l)}return Ue.runKernelFunc(function(g){return g.onesLike(c)},{x:c},function(g,S){return{x:function(){return ii(g)}}},"OnesLike")}}),ii=wt({zerosLike_:function(p){var c=Ke(p,"x","zerosLike");return Ue.runKernelFunc(function(o){return o.zerosLike(c)},{x:c},function(o,l){return{x:function(){return ii(o)}}},"ZerosLike")}}),Po=wt({concat_:function(p,c){c===void 0&&(c=0),ke(p.length>=1,function(){return"Pass at least one tensor to concat"});var o=Lu(p,"tensors","concat");o[0].dtype==="complex64"&&o.forEach(function(V){if(V.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype `+V.dtype+". ")}),c=wn(c,o[0].shape)[0];var l=tu(o.map(function(V){return V.shape}),c);if(Ye(l)===0)return ko([],l);if((o=o.filter(function(V){return V.size>0})).length===1)return o[0];var g=o.map(function(V){return V.shape});kc(g,c);var S=o,j={axis:c};return Ue.runKernelFunc(function(V){return V.concat(o,c)},S,function(V){var ne=g.map(function(ae){return ae[c]});return Ri(V,ne,c).map(function(ae){return function(){return ae}})},"Concat",j)}}),Ih=wt({concat1d_:function(p){return Po(p,0)}}),Pd=wt({concat2d_:function(p,c){return Po(p,c)}}),Al=wt({concat3d_:function(p,c){return Po(p,c)}}),Rh=wt({concat4d_:function(p,c){return Po(p,c)}}),Ri=wt({split_:function(p,c,o){o===void 0&&(o=0);var l,g=Ke(p,"x","split");return o=wn(o,g.shape)[0],typeof c=="number"?(ke(g.shape[o]%c==0,function(){return"Number of splits must evenly divide the axis."}),l=new Array(c).fill(g.shape[o]/c)):(ke(g.shape[o]===c.reduce(function(S,j){return S+j}),function(){return"The sum of sizes must match the size of the axis dimension."}),l=c),Ue.runKernelFunc(function(S){return S.split(g,l,o)},{$x:g},function(S){return{$x:function(){return Po(S,o)}}})}});function bi(p,c,o){return c===void 0&&(c="float32"),c=c||"float32",$n(p),new Wi(p,c,o)}function oa(p,c){c===void 0&&(c=!1),console.log(p.toString(c))}var Ld=wt({batchToSpaceND_:function(p,c,o){var l=Ke(p,"x","batchToSpaceND"),g=c.reduce(function(S,j){return S*j});return ke(l.rank>=1+c.length,function(){return"input rank is "+l.rank+" but should be > than blockShape.length "+c.length}),ke(o.length===c.length,function(){return"crops.length is "+o.length+" but should be equal to blockShape.length  "+c.length}),ke(l.shape[0]%g==0,function(){return"input tensor batch is "+l.shape[0]+" but is not divisible by the product of the elements of blockShape "+c.join(" * ")+" === "+g}),Ue.runKernelFunc(function(S){return S.batchToSpaceND(l,c,o)},{$x:l},function(S){return{$x:function(){return S.spaceToBatchND(c,o)}}})}}),zd=wt({cast_:function(p,c){var o=Ke(p,"x","cast");if(!Qe(c))throw new Error("Failed to cast to unknown dtype "+c);if(c==="string"&&o.dtype!=="string"||c!=="string"&&o.dtype==="string")throw new Error("Only strings can be casted to strings");var l={dtype:c};return Ue.runKernelFunc(function(g){return g.cast(o,c)},{x:o},function(g){return{x:function(){return g.clone()}}},"Cast",l)}}),Ud=wt({cumsum_:function(p,c,o,l){c===void 0&&(c=0),o===void 0&&(o=!1),l===void 0&&(l=!1);var g=Ke(p,"x","cumsum"),S=Oa([c|=0],g.rank),j=g;S!=null&&(j=g.transpose(S));var V=Aa(1,g.rank)[0],ne=Ue.runKernelFunc(function(ae){return ae.cumsum(j,V,o,l)},{permutedX:j},function(ae){return{permutedX:function(){return ae.cumsum(c,o,!l)}}});return S!=null&&(ne=ne.transpose(S)),ne}}),Rp=wt({depthToSpace_:function(p,c,o){o===void 0&&(o="NHWC");var l=Ke(p,"x","depthToSpace"),g=o==="NHWC"?l.shape[1]:l.shape[2],S=o==="NHWC"?l.shape[2]:l.shape[3],j=o==="NHWC"?l.shape[3]:l.shape[1];return ke(g*c>=0,function(){return`Negative dimension size caused by overflow when multiplying
      `+g+" and "+c+`  for depthToSpace with input shape
      `+l.shape}),ke(S*c>=0,function(){return`Negative dimension size caused by overflow when multiplying
      `+S+" and "+c+` for depthToSpace with input shape
          `+l.shape}),ke(j%(c*c)==0,function(){return"Dimension size must be evenly divisible by "+c*c+" but is "+j+" for depthToSpace with input shape "+l.shape}),Ue.runKernelFunc(function(V){return V.depthToSpace(l,c,o)},{$x:l})}}),zu=wt({expandDims_:function(p,c){c===void 0&&(c=0);var o=Ke(p,"x","expandDims",null);ke(c<=o.rank,function(){return"Axis must be <= rank of the tensor"});var l=o.shape.slice();return c<0&&(ke(-(o.rank+1)<=c,function(){return"Axis must be in the interval ["+-(o.rank+1)+", "+o.rank+"]"}),c=o.rank+c+1),l.splice(c,0,1),ks(o,l)}}),ks=wt({reshape_:function(p,c){var o=Ke(p,"x","reshape",null);c=St(c,o.size),ke(o.size===Ye(c),function(){return"new shape and old shape must have the same number of elements."});var l={shape:c};return Ue.runKernelFunc(function(g){return g.reshape(o,c)},{x:o},function(g){return{x:function(){return g.reshape(o.shape)}}},"Reshape",l)}}),$c=wt({spaceToBatchND_:function(p,c,o){var l=Ke(p,"x","spaceToBatchND");return ke(l.rank>=1+c.length,function(){return"input rank "+l.rank+" should be > than [blockShape] "+c.length}),ke(o.length===c.length,function(){return"paddings.shape[0] "+o.length+" must be equal to [blockShape] "+c.length}),ke(l.shape.reduce(function(g,S,j){return j>0&&j<=c.length?g&&(S+o[j-1][0]+o[j-1][1])%c[j-1]==0:g},!0),function(){return"input spatial dimensions "+l.shape.slice(1)+" with paddings "+o.toString()+" must be divisible by blockShapes "+c.toString()}),Ue.runKernelFunc(function(g){return g.spaceToBatchND(l,c,o)},{$x:l},function(g){return{$x:function(){return g.batchToSpaceND(c,o)}}})}}),Is=wt({squeeze_:function(p,c){var o=Ke(p,"x","squeeze");return ks(o,Bn(o.shape,c).newShape)}}),ru=wt({stack_:function(p,c){c===void 0&&(c=0);var o=Lu(p,"tensors","stack");if(ke(o.length>=1,function(){return"Pass at least one tensor to tf.stack"}),o.length===1)return o[0].expandDims(c);var l=o[0].rank,g=o[0].shape,S=o[0].dtype;ke(c<=l,function(){return"Axis must be <= rank of the tensor"}),o.forEach(function(V){Ft(g,V.shape,"All tensors passed to stack must have matching shapes")}),o.forEach(function(V){ke(S===V.dtype,function(){return"All tensors passed to stack must have matching dtypes"})});var j=o.map(function(V){return V.expandDims(c)});return Po(j,c)}}),Mh=wt({unstack_:function(p,c){c===void 0&&(c=0),c=c||0;var o=Ke(p,"x","unstack");ke(c>=-o.shape.length&&c<o.shape.length,function(){return"Axis = "+c+" is not in [-"+o.shape.length+", "+o.shape.length+")"}),c<0&&(c+=o.shape.length);var l={axis:c};return Ue.runKernelFunc(function(g){return g.unstack(o,c)},{x:o},function(g){return{x:function(){return ru(g,c)}}},"Unpack",l)}}),Ni=function(p,c){return R(this,void 0,void 0,function(){var o,l,g,S,j,V,ne,ae,me,Ee;return W(this,function(Se){switch(Se.label){case 0:return o=Ke(p,"x","setdiff1d"),l=Ke(c,"y","setdiff1d"),ke(o.dtype===l.dtype,function(){return"x and y should have the same dtype, but got x ("+o.dtype+") and y ("+l.dtype+")."}),ke(o.rank===1,function(){return"x should be 1D tensor, but got x ("+o.shape+")."}),ke(l.rank===1,function(){return"y should be 1D tensor, but got y ("+l.shape+")."}),[4,o.data()];case 1:return g=Se.sent(),[4,l.data()];case 2:for(S=Se.sent(),j=new Set(S),V=0,me=0;me<g.length;me++)j.has(g[me])||V++;for(ne=new Wi([V],o.dtype),ae=new Wi([V],"int32"),me=0,Ee=0;me<g.length;me++)j.has(g[me])||(ne.values[Ee]=g[me],ae.values[Ee]=me,Ee++);return[2,[ne.toTensor(),ae.toTensor()]]}})})};function Sf(p,c,o,l){l===void 0&&(l=!0);var g=[];if(l)(g=g.concat(c.slice(0))).push(p[0]/o),g=g.concat(p.slice(1));else{g=g.concat(p[0]);for(var S=c.length,j=0;j<S;++j)g=g.concat([p[j+1]/c[j],c[j]]);g=g.concat(p.slice(S+1))}return g}function Gc(p,c,o){o===void 0&&(o=!0);var l=[];if(o){l.push(c);for(var g=c+1;g<p;++g)g<=2*c?(l.push(g),l.push(g-(c+1))):l.push(g)}else{var S=[],j=[];for(g=1;g<p;++g)g>=2*c+1||g%2==1?j.push(g):S.push(g);l.push.apply(l,S),l.push(0),l.push.apply(l,j)}return l}function Sl(p,c,o,l){l===void 0&&(l=!0);var g=[];l?g.push(p[0]/o):g.push(p[0]*o);for(var S=1;S<p.length;++S)S<=c.length?l?g.push(c[S-1]*p[S]):g.push(p[S]/c[S-1]):g.push(p[S]);return g}function Wd(p,c){for(var o=[0],l=0;l<c;++l)o.push(p[l][0]);return o}function Mp(p,c,o){for(var l=p.slice(0,1),g=0;g<o;++g)l.push(p[g+1]-c[g][0]-c[g][1]);return l}var _l="Add",jh="AddN",Lo="Div",Bh="FusedBatchNorm",Dl="SquaredDifference",Ph="Square",Tl="Transpose",Kc="NonMaxSuppressionV5",Ec="BroadcastTo",Lh="OneHot",_f="Identity",Nl="Tile",Cc="PadV2",km="FromPixels",Fl="MaxPoolWithArgmax",ra=wt({add_:function(p,c){var o,l=Ke(p,"a","add"),g=Ke(c,"b","add");o=An(l,g),l=o[0],g=o[1];var S={a:l,b:g};return Ue.runKernelFunc(function(j,V){var ne=j.add(l,g);return V([l,g]),ne},S,null,_l)}});function Sa(p,c){for(var o=p.length,l=[],g=0;g<o;g++){var S=o-1-g,j=p[S]||1;(c[c.length-1-g]||1)>1&&j===1&&l.unshift(S)}return l}function Ia(p,c){for(var o=[],l=0;l<c.length;l++){var g=p[p.length-l-1],S=c.length-l-1,j=c[S];(g==null||g===1&&j>1)&&o.unshift(S)}return o}function Mi(p,c){for(var o=[],l=Math.max(p.length,c.length),g=0;g<l;g++){var S=p[p.length-g-1];S==null&&(S=1);var j=c[c.length-g-1];if(j==null&&(j=1),S===1)o.unshift(j);else if(j===1)o.unshift(S);else{if(S!==j)throw Error("Operands could not be broadcast together with shapes "+p+" and "+c+".");o.unshift(S)}}return o}var Es=wt({abs_:function(p){var c=Ke(p,"x","abs");return c.dtype==="complex64"?Ue.runKernelFunc(function(o){return o.complexAbs(c)},{$x:c}):Ue.runKernelFunc(function(o,l){var g=o.abs(c);return l([c]),g},{x:c},function(o,l){var g=l[0];return{x:function(){return o.mul(g.toFloat().step(-1))}}},"Abs")}}),Oc=wt({acos_:function(p){var c=Ke(p,"x","acos");return Ue.runKernelFunc(function(o,l){var g=o.acos(c);return l([c]),g},{$x:c},function(o,l){var g=l[0];return{$x:function(){return o.divStrict(fr(1).sub(g.toFloat().square()).sqrt()).neg()}}})}}),Ra=wt({acosh_:function(p){var c=Ke(p,"x","acosh");return Ue.runKernelFunc(function(o,l){var g=o.acosh(c);return l([c]),g},{$x:c},function(o,l){var g=l[0];return{$x:function(){return o.divStrict(g.toFloat().square().sub(1).sqrt())}}})}}),Ac=wt({asin_:function(p){var c=Ke(p,"x","asin");return Ue.runKernelFunc(function(o,l){var g=o.asin(c);return l([c]),g},{$x:c},function(o,l){var g=l[0];return{$x:function(){return o.divStrict(fr(1).sub(g.toFloat().square()).sqrt())}}})}}),Uu=wt({asinh_:function(p){var c=Ke(p,"x","asinh");return Ue.runKernelFunc(function(o,l){var g=o.asinh(c);return l([c]),g},{$x:c},function(o,l){var g=l[0];return{$x:function(){return o.divStrict(fr(1).add(g.toFloat().square()).sqrt())}}})}}),Df=wt({atan_:function(p){var c=Ke(p,"x","atan");return Ue.runKernelFunc(function(o,l){var g=o.atan(c);return l([c]),g},{$x:c},function(o,l){var g=l[0];return{$x:function(){return o.div(g.toFloat().square().add(1))}}})}}),Tf=wt({atanh_:function(p){var c=Ke(p,"x","atanh");return Ue.runKernelFunc(function(o,l){var g=o.atanh(c);return l([c]),g},{$x:c},function(o,l){var g=l[0];return{$x:function(){return o.div(fr(1).sub(g.toFloat().square()))}}})}}),Xc=wt({ceil_:function(p){var c=Ke(p,"x","ceil");return Ue.runKernelFunc(function(o){return o.ceil(c)},{$x:c},function(o){return{$x:function(){return ii(o)}}})}}),Vd=wt({clipByValue_:function(p,c,o){var l=Ke(p,"x","clipByValue");ke(c<=o,function(){return"Error in clip: min ("+c+") must be less than or equal to max ("+o+")."});var g=[l],S={min:c,max:o};return Ue.runKernelFunc(function(j,V){var ne=j.clip(l,c,o);return V([l]),ne},{x:l},function(j,V){var ne=V[0];return{x:function(){return j.where(ne.greaterEqual(c).logicalAnd(ne.lessEqual(o)),ii(j))}}},"ClipByValue",S,g)}}),Wu=wt({cos_:function(p){var c=Ke(p,"x","cos"),o=[c];return Ue.runKernelFunc(function(l,g){var S=l.cos(c);return g([c]),S},{x:c},function(l,g){var S=g[0];return{x:function(){return S.toFloat().sin().neg().mul(l)}}},"Cos",{},o)}}),Em=wt({cosh_:function(p){var c=Ke(p,"x","cosh");return Ue.runKernelFunc(function(o,l){var g=o.cosh(c);return l([c]),g},{$x:c},function(o,l){var g=l[0];return{$x:function(){return g.toFloat().sinh().mulStrict(o)}}})}}),qd=wt({erf_:function(p){var c=Ke(p,"x","erf");return ke(c.dtype==="int32"||c.dtype==="float32",function(){return"Input dtype must be `int32` or `float32`."}),c.dtype==="int32"&&(c=c.toFloat()),Ue.runKernelFunc(function(o,l){var g=o.erf(c);return l([c]),g},{$x:c},function(o,l){var g=l[0];return{$x:function(){return o.mul(g.square().neg().exp().mul(2/Math.sqrt(Math.PI)))}}})}}),Il=wt({exp_:function(p){var c=Ke(p,"x","exp");return Ue.runKernelFunc(function(o,l){var g=o.exp(c);return l([g]),g},{x:c},function(o,l){return{x:function(){return o.mulStrict(l[0])}}},"Exp",{},[],[!0])}}),jp=wt({expm1_:function(p){var c=Ke(p,"x","expm1");return Ue.runKernelFunc(function(o,l){var g=o.expm1(c);return l([c]),g},{$x:c},function(o,l){var g=l[0];return{$x:function(){return o.mul(g.exp())}}})}}),Nf=wt({floor_:function(p){var c=Ke(p,"x","floor");return Ue.runKernelFunc(function(o){return o.floor(c)},{$x:c},function(o){return{$x:function(){return ii(o)}}})}}),Yc=wt({log_:function(p){var c=Ke(p,"x","log"),o=[c];return Ue.runKernelFunc(function(l,g){var S=l.log(c);return g([c]),S},{x:c},function(l,g){var S=g[0];return{x:function(){return l.div(S.toFloat())}}},"Log",{},o)}}),Hd=wt({log1p_:function(p){var c=Ke(p,"x","log1p");return Ue.runKernelFunc(function(o,l){var g=o.log1p(c);return l([c]),g},{$x:c},function(o,l){var g=l[0];return{$x:function(){return o.div(g.add(1))}}})}}),zh=wt({logSigmoid_:function(p){var c=Ke(p,"x","logSigmoid");return Ue.runKernelFunc(function(o,l){var g=o.softplus(c.neg()).neg();return l([c]),g},{$x:c},function(o,l){var g=l[0];return{$x:function(){return o.mul(g.neg().sigmoid())}}})}}),ba=wt({neg_:function(p){var c=Ke(p,"x","neg"),o=[c];return Ue.runKernelFunc(function(l){return l.neg(c)},{x:c},function(l){return{x:function(){return l.neg()}}},"Neg",{},o)}}),Rl=wt({reciprocal_:function(p){var c=Ke(p,"x","reciprocal");return Ue.runKernelFunc(function(o,l){var g=o.reciprocal(c);return l([c]),g},{$x:c},function(o,l){var g=l[0];return{$x:function(){return o.div(g.square().neg())}}})}}),Cs=wt({round_:function(p){var c=Ke(p,"x","round");return Ue.runKernelFunc(function(o){return o.round(c)},{$x:c},function(o){return{$x:function(){return ii(o)}}})}}),Ml=wt({rsqrt_:function(p){var c=Ke(p,"x","rsqrt"),o=[c];return Ue.runKernelFunc(function(l,g){var S=l.rsqrt(c);return g([c]),S},{x:c},function(l,g){var S=g[0];return{x:function(){return l.div(S.pow(1.5).mul(2)).neg()}}},"Rsqrt",{},o)}}),Ff=wt({sigmoid_:function(p){var c=Ke(p,"x","sigmoid");return Ue.runKernelFunc(function(o,l){var g=o.sigmoid(c);return l([g]),g},{x:c},function(o,l){var g=l[0];return{x:function(){return o.mul(g.mul(fr(1).sub(g)))}}},"Sigmoid")}}),Uh=wt({sign_:function(p){var c=Ke(p,"x","sign");return Ue.runKernelFunc(function(o){return o.sign(c)},{$x:c},function(o){return{$x:function(){return ii(o)}}})}}),$d=wt({isNaN_:function(p){var c=Ke(p,"x","isNaN");return Ue.runKernelFunc(function(o){return o.isNaN(c)},{$x:c},function(o){return{$x:function(){return ii(o)}}})}}),If=wt({isInf_:function(p){var c=Ke(p,"x","isInf");return Ue.runKernelFunc(function(o){return o.isInf(c)},{$x:c},function(o){return{$x:function(){return ii(o)}}})}}),jl=wt({isFinite_:function(p){var c=Ke(p,"x","isFinite");return Ue.runKernelFunc(function(o){return o.isFinite(c)},{$x:c},function(o){return{$x:function(){return ii(o)}}})}}),Gd=wt({sin_:function(p){var c=Ke(p,"x","sin"),o=[c];return Ue.runKernelFunc(function(l,g){var S=l.sin(c);return g([c]),S},{x:c},function(l,g){var S=g[0];return{x:function(){return S.toFloat().cos().mul(l)}}},"Sin",{},o)}}),Kd=wt({sinh_:function(p){var c=Ke(p,"x","sinh");return Ue.runKernelFunc(function(o,l){var g=o.sinh(c);return l([c]),g},{$x:c},function(o,l){var g=l[0];return{$x:function(){return g.toFloat().cosh().mulStrict(o)}}})}}),tn=wt({softplus_:function(p){var c=Ke(p,"x","softplus");return Ue.runKernelFunc(function(o,l){var g=o.softplus(c);return l([c]),g},{$x:c},function(o,l){var g=l[0];return{$x:function(){return o.mul(g.sigmoid())}}})}}),Vs=wt({sqrt_:function(p){var c=Ke(p,"x","sqrt");return Ue.runKernelFunc(function(o,l){var g=o.sqrt(c);return l([c]),g},{$x:c},function(o,l){var g=l[0];return{$x:function(){return o.div(g.toFloat().sqrt().mul(2))}}})}}),Un=wt({step_:function(p,c){c===void 0&&(c=0);var o=Ke(p,"x","step");return Ue.runKernelFunc(function(l){return l.step(o,c)},{$x:o},function(l){return{$x:function(){return ii(l)}}})}}),Os=wt({tan_:function(p){var c=Ke(p,"x","tan");return Ue.runKernelFunc(function(o,l){var g=o.tan(c);return l([c]),g},{$x:c},function(o,l){var g=l[0];return{$x:function(){return o.div(g.cos().square())}}})}}),io=wt({tanh_:function(p){var c=Ke(p,"x","tanh");return Ue.runKernelFunc(function(o,l){var g=o.tanh(c);return l([g]),g},{x:c},function(o,l){var g=l[0];return{x:function(){return fr(1).sub(g.square()).mulStrict(o)}}},"Tanh",{},null,[!0])}}),Bl=wt({addStrict_:function(p,c){var o=Ke(p,"a","addStrict"),l=Ke(c,"b","addStrict");return Ft(o.shape,l.shape,"Error in addStrict: "),o.add(l)}}),Rf=wt({atan2_:function(p,c){var o,l=Ke(p,"a","atan2"),g=Ke(c,"b","atan2");o=An(l,g),l=o[0],g=o[1];var S=Mi(l.shape,g.shape);return Ue.runKernelFunc(function(j,V){var ne=j.atan2(l,g);return V([l,g]),ne},{$a:l,$b:g},function(j,V){var ne=V[0],ae=V[1];return{$a:function(){var me=ra(ne.square(),ae.square()),Ee=j.mul(ae.div(me)),Se=Ia(ne.shape,S);return Se.length>0&&(Ee=Ee.sum(Se)),Ee.reshape(ne.shape)},$b:function(){var me=ra(ne.square(),ae.square()),Ee=ba(j.mul(ne.div(me))),Se=Ia(ae.shape,S);return Se.length>0&&(Ee=Ee.sum(Se)),Ee.reshape(ae.shape)}}})}}),nr=wt({divStrict_:function(p,c){var o=Ke(p,"a","div"),l=Ke(c,"b","div");return Ft(o.shape,l.shape,"Error in divideStrict: "),o.div(l)}}),$a=wt({floorDiv_:function(p,c){var o,l=Ke(p,"a","floorDiv"),g=Ke(c,"b","floorDiv");o=An(l,g),l=o[0],g=o[1];var S=Mi(l.shape,g.shape);return Ue.runKernelFunc(function(j,V){var ne=j.floorDiv(l,g);return V([l,g]),ne},{a:l,b:g},function(j,V){var ne=V[0],ae=V[1];return{a:function(){var me=j.div(ae.toFloat()),Ee=Ia(ne.shape,S);return Ee.length>0?me.sum(Ee).reshape(ne.shape):me},b:function(){var me=j.mul(ne.toFloat()),Ee=Ia(ae.shape,S);Ee.length>0&&(me=me.sum(Ee).reshape(ae.shape));var Se=ae.square();return me.div(Se.toFloat()).neg()}}},"FloorDiv")}}),xa=wt({maximum_:function(p,c){var o,l=Ke(p,"a","maximum"),g=Ke(c,"b","maximum");return o=An(l,g),l=o[0],g=o[1],l.dtype==="bool"&&(l=l.toInt(),g=g.toInt()),Mi(l.shape,g.shape),Ue.runKernelFunc(function(S,j){var V=S.maximum(l,g);return j([l,g]),V},{a:l,b:g},function(S,j){var V=j[0],ne=j[1];return{a:function(){return S.mul(V.greaterEqual(ne).toFloat())},b:function(){return S.mul(V.less(ne).toFloat())}}},"Maximum")}}),Hi=wt({maximumStrict_:function(p,c){var o=Ke(p,"a","maximumStrict"),l=Ke(c,"b","maximumStrict");return Ft(o.shape,l.shape,"Error in maximumStrict: "),o.maximum(l)}}),ku=wt({minimum_:function(p,c){var o,l=Ke(p,"a","minimum"),g=Ke(c,"b","minimum");return o=An(l,g),l=o[0],g=o[1],l.dtype==="bool"&&(l=l.toInt(),g=g.toInt()),Mi(l.shape,g.shape),Ue.runKernelFunc(function(S,j){var V=S.minimum(l,g);return j([l,g]),V},{a:l,b:g},function(S,j){var V=j[0],ne=j[1];return{a:function(){return S.mul(V.lessEqual(ne).toFloat())},b:function(){return S.mul(V.greater(ne).toFloat())}}},"Minimum")}}),ac=wt({minimumStrict_:function(p,c){var o=Ke(p,"a","minimumStrict"),l=Ke(c,"b","minimumStrict");return Ft(o.shape,l.shape,"Error in minimumStrict: "),o.minimum(l)}}),qs=wt({mod_:function(p,c){var o,l=Ke(p,"a","mod"),g=Ke(c,"b","mod");o=An(l,g),l=o[0],g=o[1];var S=Mi(l.shape,g.shape);return Ue.runKernelFunc(function(j,V){var ne=j.mod(l,g);return V([l,g]),ne},{$a:l,$b:g},function(j,V){var ne=V[0],ae=V[1];return{$a:function(){var me=Ia(ne.shape,S);return me.length>0?j.sum(me).reshape(ne.shape):j},$b:function(){var me=j.mul(ne.div(ae).floor().neg()),Ee=Ia(ae.shape,S);return Ee.length>0?me.sum(Ee).reshape(ae.shape):me}}})}}),sc=wt({modStrict_:function(p,c){var o=Ke(p,"a","modStrict"),l=Ke(c,"b","modStrict");return Ft(o.shape,l.shape,"Error in modStrict: "),o.mod(l)}}),Xo=wt({mul_:function(p,c){var o,l=Ke(p,"a","mul"),g=Ke(c,"b","mul");o=An(l,g),l=o[0],g=o[1];var S=Mi(l.shape,g.shape);return Ue.runKernelFunc(function(j,V){var ne=j.multiply(l,g);return V([l,g]),ne},{a:l,b:g},function(j,V){var ne=V[0],ae=V[1];return{a:function(){var me=j.mul(ae.toFloat()),Ee=Ia(ne.shape,S);return Ee.length>0?me.sum(Ee).reshape(ne.shape):me},b:function(){var me=j.mul(ne.toFloat()),Ee=Ia(ae.shape,S);return Ee.length>0?me.sum(Ee).reshape(ae.shape):me}}},"Mul")}}),Vu=wt({mulStrict_:function(p,c){var o=Ke(p,"a","mul"),l=Ke(c,"b","mul");return Ft(o.shape,l.shape,"Error in multiplyStrict: "),o.mul(l)}}),Hs=wt({pow_:function(p,c){var o,l=Ke(p,"base","pow"),g=Ke(c,"exp","pow");o=An(l,g),l=o[0],g=o[1];var S=Mi(l.shape,g.shape),j=[l,g];return Ue.runKernelFunc(function(V,ne){var ae=V.pow(l,g);return ne([l,g,ae]),ae},{a:l,b:g},function(V,ne){var ae=ne[0],me=ne[1],Ee=ne[2];return{a:function(){var Se=me.toFloat(),Ne=V.mul(Se.mul(ae.pow(Se.sub(fr(1))))),ze=Ia(ae.shape,S);return ze.length>0&&(Ne=Ne.sum(ze)),Ne.reshape(ae.shape)},b:function(){var Se=ae.greater(0),Ne=ae.log().where(Se,ii(ae)),ze=V.mul(Ee.mul(Ne)),$e=Ia(me.shape,S);return $e.length>0&&(ze=ze.sum($e)),ze.reshape(me.shape)}}},"Pow",{},j,[!0])}}),so=wt({powStrict_:function(p,c){return Ft(p.shape,c.shape,"Error in powStrict: "),p.pow(c)}}),cs=wt({squaredDifferenceStrict_:function(p,c){var o=Ke(p,"a","squaredDifferenceStrict"),l=Ke(c,"b","squaredDifferenceStrict");return Ft(o.shape,l.shape,"Error in squaredDifferenceStrict: "),o.squaredDifference(l)}}),_a=wt({sub_:function(p,c){var o,l=Ke(p,"a","sub"),g=Ke(c,"b","sub");o=An(l,g),l=o[0],g=o[1];var S=Mi(l.shape,g.shape);return Ue.runKernelFunc(function(j){return j.subtract(l,g)},{a:l,b:g},function(j){return{a:function(){var V=j,ne=Ia(l.shape,S);return ne.length>0&&(V=V.sum(ne)),V.reshape(l.shape)},b:function(){var V=j,ne=Ia(g.shape,S);return ne.length>0&&(V=V.sum(ne)),V.neg().reshape(g.shape)}}},"Sub")}}),ls=wt({subStrict_:function(p,c){var o=Ke(p,"a","subStrict"),l=Ke(c,"b","subStrict");return Ft(o.shape,l.shape,"Error in subStrict: "),o.sub(l)}}),Yo=wt({div_:function(p,c){var o,l=Ke(p,"a","div"),g=Ke(c,"b","div");if(o=An(l,g),l=o[0],g=o[1],l.dtype==="int32"&&g.dtype==="int32")return $a(l,g);var S={a:l,b:g};return Ue.runKernelFunc(function(j,V){var ne=j.realDivide(l,g);return V([l,g]),ne},S,null,Lo,{})}});function $s(p,c){if(p.rank<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher, but the rank was "+p.rank+".");if(c.rank<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher, but the rank was "+c.rank+".");if(c.dtype!=="int32")throw new Error("tf.gatherND() expects the indices to be int32 type, but the dtype was "+c.dtype+".");if(c.shape[c.rank-1]>p.rank)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+c.shape[c.rank-1]+" vs. "+p.rank);if(p.size===0)throw new Error("Requested more than 0 entries, but input is empty. Input shape: "+p.shape+".");for(var o=c.shape,l=o[o.length-1],g=1,S=0;S<o.length-1;++S)g*=o[S];var j=p.shape,V=o.slice();V.pop();var ne=1;for(S=l;S<p.rank;++S)ne*=j[S],V.push(j[S]);var ae=pr(p.shape).map(function(me){return me/ne}).concat([1]).slice(0,l);return[V,g,ne,ae]}var Eu=Object.freeze({prepareAndValidate:$s}),qu=30;function uc(p){return p<=qu?p:Dr(p,Math.floor(Math.sqrt(p)))}function Cu(p,c,o){var l=c.rank>1?c.shape[c.rank-1]:1,g=c.rank>1?c.rank-1:1,S="Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: "+o.shape+", indices.shape: "+c.shape+", shape: "+p+", sliceDim: "+l+", and batchDim: "+g+".";if(o.rank<g)throw new Error(S+" update.rank < "+g+". ");if(p.length<l+(o.rank-g))throw new Error(S+" Output shape length < "+(l+(o.rank-g)));if(o.rank!==g+p.length-l)throw new Error(S+" update.rank != "+(g+p.length-l));for(var j=0;j<g;++j)if(o.shape[j]!==c.shape[j])throw new Error(S+" updates.shape["+j+"] ("+o.shape[j]+") != indices.shape["+j+"] ("+c.shape[j]+").");for(j=0;j<o.rank-g;++j)if(o.shape[j+g]!==p[j+l])throw new Error(S+" updates.shape["+(j+g)+"] ("+o.shape[j+g]+") != shape["+(j+g)+"] ("+p[j+g]+")")}function Jc(p,c,o){if(c.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher, but the rank was "+c.rank+".");if(p.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher, but the rank was "+p.rank+".");if(c.dtype!=="int32")throw new Error("The dtype of 'indices' should be int32, but got dtype: "+c.dtype);if(o.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: "+o);if(o.length===0){if(c.size===0)throw new Error("Indices specified for empty output. indices shape: "+c.shape);if(p.size===0)throw new Error("Updates specified for empty output. updates shape: "+p.shape)}Cu(o,c,p)}function Qc(p,c,o){for(var l=c.shape.length,g=l>1?c.shape[l-1]:1,S=o.length,j=1,V=g;V<S;++V)j*=o[V];var ne=g<1?1:g;return{sliceRank:g,numUpdates:Ye(c.shape)/ne,sliceSize:j,strides:pr(o.slice(0,g)).concat([1]),outputSize:Ye(o)}}var Wh=Object.freeze({validateUpdateShape:Cu,validateInput:Jc,calculateShapes:Qc});function Zc(p,c,o){ke(p.rank===c.length,function(){return"Error in slice"+p.rank+"D: Length of begin "+c+" must match the rank of the array ("+p.rank+")."}),ke(p.rank===o.length,function(){return"Error in slice"+p.rank+"D: Length of size "+o+" must match the rank of the array ("+p.rank+")."});for(var l=function(S){ke(c[S]+o[S]<=p.shape[S],function(){return"Error in slice"+p.rank+"D: begin["+S+"] + size["+S+"] ("+(c[S]+o[S])+") would overflow input.shape["+S+"] ("+p.shape[S]+")"})},g=0;g<p.rank;++g)l(g)}function Gs(p){for(var c=[],o=0;p>0;)1&p&&c.push(o),p/=2,o++;return c}function Ou(p,c,o){for(var l=[],g=0;g<p.length;g++)l[g]=Math.ceil((c[g]-p[g])/o[g]);return l}function Au(p,c,o,l,g){var S=c[g],j=o[g]||1;(p&1<<g||S==null)&&(S=j>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);var V=l[g];return S<0&&(S+=V),_t(0,S,V-1)}function iu(p,c,o,l,g){var S=c[g],j=o[g]||1;(p&1<<g||S==null)&&(S=j>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);var V=l[g];return S<0&&(S+=V),j>0?_t(0,S,V):_t(-1,S,V-1)}function Vh(p,c,o){for(var l=o.length,g=0;g<o.length;g++)if(o[g]>1){l=g;break}for(g=l+1;g<o.length;g++)if(c[g]>0||o[g]!==p[g])return!1;return!0}function Mf(p,c){for(var o=p.length>0?p[p.length-1]:1,l=0;l<p.length-1;l++)o+=p[l]*c[l];return o}var jf=Object.freeze({assertParamsValid:Zc,maskToAxes:Gs,computeOutShape:Ou,startForAxis:Au,stopForAxis:iu,isSliceContinous:Vh,computeFlatOffset:Mf});function Pl(p){return ke(Yn(p),function(){return"The f passed in grad(f) must be a function"}),function(c,o){var l=Ke(c,"x","tf.grad",null),g=o!=null?Ke(o,"dy","tf.grad"):null;return Ue.tidy(function(){var S=Ue.gradients(function(){return p(l)},[l],g),j=S.value,V=S.grads;return g!=null&&Ft(j.shape,g.shape,"The shape of dy passed in grad(f)(x, dy) must match the shape returned by f(x)"),te(V),V[0]})}}function Bf(p){return ke(Yn(p),function(){return"The f passed in grads(f) must be a function"}),function(c,o){ke(Array.isArray(c),function(){return"The args passed in grads(f)(args) must be an array of `Tensor`s or `TensorLike`s"});var l=Lu(c,"args","tf.grads",null),g=o!=null?Ke(o,"dy","tf.grads"):null;return Ue.tidy(function(){var S=Ue.gradients(function(){return p.apply(void 0,l)},l,g),j=S.value,V=S.grads;return g!=null&&Ft(j.shape,g.shape,"The shape of dy passed in grads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),te(V),V})}}function Q(p){return ke(Yn(p),function(){return"The f passed in valueAndGrad(f) must be a function"}),function(c,o){ke(c instanceof Mt,function(){return"The x passed in valueAndGrad(f)(x) must be a tensor"}),ke(o==null||o instanceof Mt,function(){return"The dy passed in valueAndGrad(f)(x, dy) must be a tensor"});var l=Ue.gradients(function(){return p(c)},[c],o),g=l.grads,S=l.value;return te(g),{grad:g[0],value:S}}}function G(p){return ke(Yn(p),function(){return"The f passed in valueAndGrads(f) must be a function"}),function(c,o){ke(Array.isArray(c)&&c.every(function(g){return g instanceof Mt}),function(){return"The args passed in valueAndGrads(f)(args) must be array of tensors"}),ke(o==null||o instanceof Mt,function(){return"The dy passed in valueAndGrads(f)(args, dy) must be a tensor"});var l=Ue.gradients(function(){return p.apply(void 0,c)},c,o);return o!=null&&Ft(l.value.shape,o.shape,"The shape of dy passed in valueAndGrads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),te(l.grads),l}}function C(p,c){ke(Yn(p),function(){return"The f passed in variableGrads(f) must be a function"}),ke(c==null||Array.isArray(c)&&c.every(function(me){return me instanceof gt}),function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"});var o=c!=null;if(!o)for(var l in c=[],Ue.registeredVariables)c.push(Ue.registeredVariables[l]);var g=o?c.filter(function(me){return!me.trainable}):null,S=c.length;ke((c=c.filter(function(me){return me.trainable})).length>0,function(){return"variableGrads() expects at least one of the input variables to be trainable, but none of the "+S+" variables is trainable."});var j=Ue.gradients(p,c,null,!0),V=j.value,ne=j.grads;ke(ne.some(function(me){return me!=null}),function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."}),ke(V.rank===0,function(){return"The f passed in variableGrads(f) must return a scalar, but it returned a rank-"+V.rank+" tensor"});var ae={};return c.forEach(function(me,Ee){ne[Ee]!=null&&(ae[me.name]=ne[Ee])}),g!=null&&g.forEach(function(me){return ae[me.name]=null}),{value:V,grads:ae}}function N(p){return Ue.customGrad(p)}function te(p){if(p.filter(function(c){return c==null}).length>0)throw new Error(`Cannot compute gradient of y=f(x) with respect to x. Make sure that
    the f you passed encloses all operations that lead from x to y.`)}var Be=wt({softmax_:function(p,c){c===void 0&&(c=-1);var o=Ke(p,"logits","softmax","float32");if(c===-1&&(c=o.rank-1),c!==o.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank "+o.rank+" and dim was "+c);return Ue.runKernelFunc(function(l,g){var S=l.softmax(o,c);return g([S]),S},{logits:o},function(l,g){var S=g[0],j=l.mul(S);return{logits:function(){return j.sub(j.sum([c],!0).mul(S))}}},"Softmax",{dim:c},[],[!0])}}),Ge=wt({logSoftmax_:function(p,c){c===void 0&&(c=-1);var o=Ke(p,"logits","logSoftmax");if(c===-1&&(c=o.rank-1),c!==o.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. Logits was rank "+o.rank+" and axis was "+c);return N(function(l,g){var S=l.max(c,!0),j=l.sub(S),V=j.toFloat().sub(j.exp().sum(c,!0).log());return g([V]),{value:V,gradFunc:function(ne,ae){var me=ae[0].exp();return ne.sub(ne.sum(c,!0).mul(me))}}})(o)}}),ft=wt({transpose_:function(p,c){var o=Ke(p,"x","transpose");if(c==null&&(c=o.shape.map(function(g,S){return S}).reverse()),ke(o.rank===c.length,function(){return"Error in transpose: rank of input "+o.rank+" must match length of perm "+c+"."}),c.forEach(function(g){ke(g>=0&&g<o.rank,function(){return"All entries in 'perm' must be between 0 and "+(o.rank-1)+" but got "+c})}),o.rank<=1)return o.clone();var l={perm:c};return Ue.runKernelFunc(function(g){return g.transpose(o,c)},{x:o},null,"Transpose",l)}}),Tt=function(){function p(c,o){this.backend=c,this.dataMover=o,this.data=new WeakMap,this.dataIdsCount=0}return p.prototype.get=function(c){return this.data.has(c)||this.dataMover.moveData(this.backend,c),this.data.get(c)},p.prototype.set=function(c,o){this.dataIdsCount++,this.data.set(c,o)},p.prototype.has=function(c){return this.data.has(c)},p.prototype.delete=function(c){return this.dataIdsCount--,this.data.delete(c)},p.prototype.numDataIds=function(){return this.dataIdsCount},p}(),Wt=function(){function p(){}return p.prototype.time=function(c){return ct("time")},p.prototype.read=function(c){return ct("read")},p.prototype.readSync=function(c){return ct("readSync")},p.prototype.numDataIds=function(){return ct("numDataIds")},p.prototype.disposeData=function(c){return ct("disposeData")},p.prototype.write=function(c,o,l){return ct("write")},p.prototype.move=function(c,o,l,g){return ct("move")},p.prototype.memory=function(){return ct("memory")},p.prototype.floatPrecision=function(){return ct("floatPrecision")},p.prototype.epsilon=function(){return this.floatPrecision()===32?1e-7:1e-4},p.prototype.batchMatMul=function(c,o,l,g){return ct("batchMatMul")},p.prototype.fusedBatchMatMul=function(c){return c.a,c.b,c.transposeA,c.transposeB,c.bias,c.activation,c.preluActivationWeights,ct("fusedBatchMatMul")},p.prototype.slice=function(c,o,l){return ct("slice")},p.prototype.stridedSlice=function(c,o,l,g){return ct("stridedSlice")},p.prototype.unstack=function(c,o){return ct("unstack")},p.prototype.reverse=function(c,o){return ct("reverse")},p.prototype.concat=function(c,o){return ct("concat")},p.prototype.neg=function(c){return ct("neg")},p.prototype.add=function(c,o){return ct("add")},p.prototype.addN=function(c){return ct("addN")},p.prototype.subtract=function(c,o){return ct("subtract")},p.prototype.multiply=function(c,o){return ct("multiply")},p.prototype.realDivide=function(c,o){return ct("realDivide")},p.prototype.floorDiv=function(c,o){return ct("floorDiv")},p.prototype.sum=function(c,o){return ct("sum")},p.prototype.prod=function(c,o){return ct("prod")},p.prototype.unsortedSegmentSum=function(c,o,l){return ct("unsortedSegmentSum")},p.prototype.argMin=function(c,o){return ct("argMin")},p.prototype.argMax=function(c,o){return ct("argMax")},p.prototype.equal=function(c,o){return ct("equal")},p.prototype.notEqual=function(c,o){return ct("notEqual")},p.prototype.less=function(c,o){return ct("less")},p.prototype.lessEqual=function(c,o){return ct("lessEqual")},p.prototype.greater=function(c,o){return ct("greater")},p.prototype.greaterEqual=function(c,o){return ct("greaterEqual")},p.prototype.logicalNot=function(c){return ct("logicalNot")},p.prototype.logicalAnd=function(c,o){return ct("logicalAnd")},p.prototype.logicalOr=function(c,o){return ct("logicalOr")},p.prototype.where=function(c){return ct("where")},p.prototype.select=function(c,o,l){return ct("select")},p.prototype.topk=function(c,o,l){return ct("topk")},p.prototype.min=function(c,o){return ct("min")},p.prototype.minimum=function(c,o){return ct("minimum")},p.prototype.mod=function(c,o){return ct("mod")},p.prototype.max=function(c,o){return ct("max")},p.prototype.maximum=function(c,o){return ct("maximum")},p.prototype.all=function(c,o){return ct("all")},p.prototype.any=function(c,o){return ct("any")},p.prototype.squaredDifference=function(c,o){return ct("squaredDifference")},p.prototype.ceil=function(c){return ct("ceil")},p.prototype.floor=function(c){return ct("floor")},p.prototype.round=function(c){return ct("round")},p.prototype.sign=function(c){return ct("sign")},p.prototype.isNaN=function(c){return ct("isNaN")},p.prototype.isInf=function(c){return ct("isInf")},p.prototype.isFinite=function(c){return ct("isFinite")},p.prototype.pow=function(c,o){return ct("pow")},p.prototype.exp=function(c){return ct("exp")},p.prototype.expm1=function(c){return ct("expm1")},p.prototype.softmax=function(c,o){return ct("softmax")},p.prototype.log=function(c){return ct("log")},p.prototype.log1p=function(c){return ct("log1p")},p.prototype.sqrt=function(c){return ct("sqrt")},p.prototype.rsqrt=function(c){return ct("rsqrt")},p.prototype.square=function(c){return ct("square")},p.prototype.reciprocal=function(c){return ct("reciprocal")},p.prototype.relu=function(c){return ct("relu")},p.prototype.relu6=function(c){return ct("relu6")},p.prototype.prelu=function(c,o){return ct("prelu")},p.prototype.elu=function(c){return ct("elu")},p.prototype.eluDer=function(c,o){return ct("eluDer")},p.prototype.selu=function(c){return ct("selu")},p.prototype.int=function(c){return ct("int")},p.prototype.clip=function(c,o,l){return ct("clip")},p.prototype.abs=function(c){return ct("abs")},p.prototype.complexAbs=function(c){return ct("complexAbs")},p.prototype.sigmoid=function(c){return ct("sigmoid")},p.prototype.softplus=function(c){return ct("softplus")},p.prototype.sin=function(c){return ct("sin")},p.prototype.cos=function(c){return ct("cos")},p.prototype.tan=function(c){return ct("tan")},p.prototype.asin=function(c){return ct("asin")},p.prototype.acos=function(c){return ct("acos")},p.prototype.atan=function(c){return ct("atan")},p.prototype.atan2=function(c,o){return ct("atan2")},p.prototype.sinh=function(c){return ct("sinh")},p.prototype.cosh=function(c){return ct("cosh")},p.prototype.tanh=function(c){return ct("tanh")},p.prototype.asinh=function(c){return ct("asinh")},p.prototype.acosh=function(c){return ct("acosh")},p.prototype.atanh=function(c){return ct("atanh")},p.prototype.erf=function(c){return ct("erf")},p.prototype.step=function(c,o){return ct("step")},p.prototype.fusedConv2d=function(c){return c.input,c.filter,c.convInfo,c.bias,c.activation,c.preluActivationWeights,ct("fusedConv2d")},p.prototype.conv2d=function(c,o,l){return ct("conv2d")},p.prototype.conv2dDerInput=function(c,o,l){return ct("conv2dDerInput")},p.prototype.conv2dDerFilter=function(c,o,l){return ct("conv2dDerFilter")},p.prototype.fusedDepthwiseConv2D=function(c){return c.input,c.filter,c.convInfo,c.bias,c.activation,c.preluActivationWeights,ct("fusedDepthwiseConv2D")},p.prototype.depthwiseConv2D=function(c,o,l){return ct("depthwiseConv2D")},p.prototype.depthwiseConv2DDerInput=function(c,o,l){return ct("depthwiseConv2DDerInput")},p.prototype.depthwiseConv2DDerFilter=function(c,o,l){return ct("depthwiseConv2DDerFilter")},p.prototype.conv3d=function(c,o,l){return ct("conv3d")},p.prototype.conv3dDerInput=function(c,o,l){return ct("conv3dDerInput")},p.prototype.conv3dDerFilter=function(c,o,l){return ct("conv3dDerFilter")},p.prototype.maxPool=function(c,o){return ct("maxPool")},p.prototype.maxPoolBackprop=function(c,o,l,g){return ct("maxPoolBackprop")},p.prototype.avgPool=function(c,o){return ct("avgPool")},p.prototype.avgPoolBackprop=function(c,o,l){return ct("avgPoolBackprop")},p.prototype.avgPool3d=function(c,o){return ct("avgPool3d")},p.prototype.avgPool3dBackprop=function(c,o,l){return ct("avgPool3dBackprop")},p.prototype.maxPool3d=function(c,o){return ct("maxPool3d")},p.prototype.maxPool3dBackprop=function(c,o,l,g){return ct("maxPool3dBackprop")},p.prototype.reshape=function(c,o){return ct("reshape")},p.prototype.cast=function(c,o){return ct("cast")},p.prototype.tile=function(c,o){return ct("tile")},p.prototype.pad=function(c,o,l){return ct("pad")},p.prototype.transpose=function(c,o){return ct("transpose")},p.prototype.gather=function(c,o,l){return ct("gather")},p.prototype.gatherND=function(c,o){return ct("gatherND")},p.prototype.scatterND=function(c,o,l){return ct("scatterND")},p.prototype.batchToSpaceND=function(c,o,l){return ct("batchToSpaceND")},p.prototype.spaceToBatchND=function(c,o,l){return ct("spaceToBatchND")},p.prototype.resizeBilinear=function(c,o,l,g){return ct("resizeBilinear")},p.prototype.resizeBilinearBackprop=function(c,o,l){return ct("resizeBilinearBackprop")},p.prototype.resizeNearestNeighbor=function(c,o,l,g){return ct("resizeNearestNeighbor")},p.prototype.resizeNearestNeighborBackprop=function(c,o,l){return ct("resizeNearestNeighborBackprop")},p.prototype.batchNormalization=function(c,o,l,g,S,j){return ct("batchNormalization")},p.prototype.localResponseNormalization4D=function(c,o,l,g,S){return ct("localResponseNormalization4D")},p.prototype.LRNGrad=function(c,o,l,g,S,j,V){return ct("LRNGrad")},p.prototype.multinomial=function(c,o,l,g){return ct("multinomial")},p.prototype.oneHot=function(c,o,l,g){return ct("oneHot")},p.prototype.cumsum=function(c,o,l,g){return ct("cumsum")},p.prototype.nonMaxSuppression=function(c,o,l,g,S){return ct("nonMaxSuppression")},p.prototype.fft=function(c){return ct("fft")},p.prototype.ifft=function(c){return ct("ifft")},p.prototype.complex=function(c,o){return ct("complex")},p.prototype.real=function(c){return ct("real")},p.prototype.imag=function(c){return ct("imag")},p.prototype.cropAndResize=function(c,o,l,g,S,j){return ct("cropAndResize")},p.prototype.depthToSpace=function(c,o,l){return ct("depthToSpace")},p.prototype.split=function(c,o,l){return ct("split")},p.prototype.sparseToDense=function(c,o,l,g){return ct("sparseToDense")},p.prototype.diag=function(c){return ct("diag")},p.prototype.fill=function(c,o,l){return ct("fill")},p.prototype.onesLike=function(c){return ct("onesLike")},p.prototype.zerosLike=function(c){return ct("zerosLike")},p.prototype.linspace=function(c,o,l){return ct("linspace")},p.prototype.dispose=function(){return ct("dispose")},p}();function ct(p){throw new Error("'"+p+"' not yet implemented or not found in the registry. Did you forget to import the kernel?")}function bn(p,c,o,l,g,S,j){j===void 0&&(j="channelsLast");var V,ne=tr(c),ae=ne[0],me=ne[1];if(j==="channelsLast")V=[ae,me,p[3],p[3]];else{if(j!=="channelsFirst")throw new Error("Unknown dataFormat "+j);V=[ae,me,p[1],p[1]]}return Nn(p,V,o,l,g,S,!1,j)}function Sn(p,c,o,l,g,S,j){j===void 0&&(j="NDHWC");var V,ne,ae=rr(c),me=ae[0],Ee=ae[1],Se=ae[2];if(j==="NDHWC")ne="channelsLast",V=[me,Ee,Se,p[4],p[4]];else{if(j!=="NCDHW")throw new Error("Unknown dataFormat "+j);ne="channelsFirst",V=[me,Ee,Se,p[1],p[1]]}return Wn(p,V,o,l,g,!1,ne,S)}function Nn(p,c,o,l,g,S,j,V){j===void 0&&(j=!1),V===void 0&&(V="channelsLast");var ne=[-1,-1,-1,-1],ae=ne[0],me=ne[1],Ee=ne[2],Se=ne[3];if(V==="channelsLast")ae=p[0],me=p[1],Ee=p[2],Se=p[3];else{if(V!=="channelsFirst")throw new Error("Unknown dataFormat "+V);ae=p[0],Se=p[1],me=p[2],Ee=p[3]}var Ne,ze=c[0],$e=c[1],qe=c[3],tt=tr(o),lt=tt[0],ht=tt[1],vt=tr(l),Ct=vt[0],Vt=vt[1],Yt=dr(ze,Ct),qt=dr($e,Vt),$t=function(er,sr,lr,ur,or,Er,kr,Ur){var Zr,mi,co;if(typeof er=="number"){Zr={top:er,bottom:er,left:er,right:er,type:er===0?"VALID":"NUMBER"};var lo=function(Xi,Co,Vo,au,js){au==null&&(au=Rn(Xi,Co,Vo));var Bs=Xi[1],hd=Tr((Xi[0]-Co+2*au)/Vo+1,js);ke(nn(hd),function(){return"The output # of rows ("+hd+") must be an integer. Change the stride and/or zero pad parameters"});var dd=Tr((Bs-Co+2*au)/Vo+1,js);return ke(nn(dd),function(){return"The output # of columns ("+dd+") must be an integer. Change the stride and/or zero pad parameters"}),[hd,dd]}([sr,lr],Er,ur,er,Ur);mi=lo[0],co=lo[1]}else if(er==="same"){mi=Math.ceil(sr/ur),co=Math.ceil(lr/or);var Eo=Math.max(0,(mi-1)*ur+Er-sr),wo=Math.max(0,(co-1)*or+kr-lr),Bo=Math.floor(Eo/2),ta=Eo-Bo,Pa=Math.floor(wo/2);Zr={top:Bo,bottom:ta,left:Pa,right:wo-Pa,type:"SAME"}}else{if(er!=="valid")throw Error("Unknown padding parameter: "+er);Zr={top:0,bottom:0,left:0,right:0,type:"VALID"},mi=Math.ceil((sr-Er+1)/ur),co=Math.ceil((lr-kr+1)/or)}return{padInfo:Zr,outHeight:mi,outWidth:co}}(g,me,Ee,lt,ht,Yt,qt,S),yn=$t.padInfo,On=$t.outHeight,Cn=$t.outWidth,Xn=j?qe*Se:qe;return V==="channelsFirst"?Ne=[ae,Xn,On,Cn]:V==="channelsLast"&&(Ne=[ae,On,Cn,Xn]),{batchSize:ae,dataFormat:V,inHeight:me,inWidth:Ee,inChannels:Se,outHeight:On,outWidth:Cn,outChannels:Xn,padInfo:yn,strideHeight:lt,strideWidth:ht,filterHeight:ze,filterWidth:$e,effectiveFilterHeight:Yt,effectiveFilterWidth:qt,dilationHeight:Ct,dilationWidth:Vt,inShape:p,outShape:Ne,filterShape:c}}function Wn(p,c,o,l,g,S,j,V){S===void 0&&(S=!1),j===void 0&&(j="channelsLast");var ne=[-1,-1,-1,-1,-1],ae=ne[0],me=ne[1],Ee=ne[2],Se=ne[3],Ne=ne[4];if(j==="channelsLast")ae=p[0],me=p[1],Ee=p[2],Se=p[3],Ne=p[4];else{if(j!=="channelsFirst")throw new Error("Unknown dataFormat "+j);ae=p[0],Ne=p[1],me=p[2],Ee=p[3],Se=p[4]}var ze,$e=c[0],qe=c[1],tt=c[2],lt=c[4],ht=rr(o),vt=ht[0],Ct=ht[1],Vt=ht[2],Yt=rr(l),qt=Yt[0],$t=Yt[1],yn=Yt[2],On=dr($e,qt),Cn=dr(qe,$t),Xn=dr(tt,yn),er=function(kr,Ur,Zr,mi,co,lo,Eo,wo,Bo,ta,Pa){var Xi,Co,Vo,au;if(typeof kr=="number"){Xi={top:kr,bottom:kr,left:kr,right:kr,front:kr,back:kr,type:kr===0?"VALID":"NUMBER"};var js=function(a0,Ep,Ix,Dv,md,Zy){md==null&&(md=Rn(a0,Ep,Dv));var Rx=a0[1],Mx=a0[2],e1=Tr((a0[0]-Ep+2*md)/Dv+1,Zy);ke(nn(e1),function(){return"The output # of depths ("+e1+") must be an integer. Change the stride and/or zero pad parameters"});var t1=Tr((Rx-Ep+2*md)/Dv+1,Zy);ke(nn(t1),function(){return"The output # of rows ("+t1+") must be an integer. Change the stride and/or zero pad parameters"});var n1=Tr((Mx-Ep+2*md)/Dv+1,Zy);return ke(nn(n1),function(){return"The output # of columns ("+n1+") must be an integer. Change the stride and/or zero pad parameters"}),[e1,t1,n1,1]}([Ur,Zr,mi,1],wo,0,co,kr,Pa);Co=js[0],Vo=js[1],au=js[2]}else if(kr==="same"){var Bs=((Co=Math.ceil(Ur/co))-1)*co+wo-Ur,hd=((Vo=Math.ceil(Zr/lo))-1)*lo+Bo-Zr,dd=((au=Math.ceil(mi/Eo))-1)*Eo+ta-mi,kp=Math.floor(Bs/2),mu=Bs-kp,Qm=Math.floor(hd/2),o0=hd-Qm,pd=Math.floor(dd/2);Xi={top:Qm,bottom:o0,left:pd,right:dd-pd,front:kp,back:mu,type:"SAME"}}else{if(kr!=="valid")throw Error("Unknown padding parameter: "+kr);Xi={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},Co=Math.ceil((Ur-wo+1)/co),Vo=Math.ceil((Zr-Bo+1)/lo),au=Math.ceil((mi-ta+1)/Eo)}return{padInfo:Xi,outDepth:Co,outHeight:Vo,outWidth:au}}(g,me,Ee,Se,vt,Ct,Vt,On,Cn,Xn,V),sr=er.padInfo,lr=er.outDepth,ur=er.outHeight,or=er.outWidth,Er=S?lt*Ne:lt;return j==="channelsFirst"?ze=[ae,Er,lr,ur,or]:j==="channelsLast"&&(ze=[ae,lr,ur,or,Er]),{batchSize:ae,dataFormat:j,inDepth:me,inHeight:Ee,inWidth:Se,inChannels:Ne,outDepth:lr,outHeight:ur,outWidth:or,outChannels:Er,padInfo:sr,strideDepth:vt,strideHeight:Ct,strideWidth:Vt,filterDepth:$e,filterHeight:qe,filterWidth:tt,effectiveFilterDepth:On,effectiveFilterHeight:Cn,effectiveFilterWidth:Xn,dilationDepth:qt,dilationHeight:$t,dilationWidth:yn,inShape:p,outShape:ze,filterShape:c}}function Rn(p,c,o,l){l===void 0&&(l=1);var g=dr(c,l);return Math.floor((p[0]*(o-1)-o+g)/2)}function tr(p){return typeof p=="number"?[p,p,p]:p.length===2?[p[0],p[1],1]:p}function rr(p){return typeof p=="number"?[p,p,p]:p}function dr(p,c){return c<=1?p:p+(p-1)*(c-1)}function Tr(p,c){if(!c)return p;switch(c){case"round":return Math.round(p);case"ceil":return Math.ceil(p);case"floor":return Math.floor(p);default:throw new Error("Unknown roundingMode "+c)}}function Vr(p){var c=tr(p),o=c[0],l=c[1],g=c[2];return o===1&&l===1&&g===1}function xr(p,c){return Vr(p)||Vr(c)}function $r(p){if(p==="NHWC")return"channelsLast";if(p==="NCHW")return"channelsFirst";throw new Error("Unknown dataFormat "+p)}function Wr(p,c,o){if(c==="complex64"){if(p.dtype==="complex64")return p.clone();var l=Ki(p.shape),g=p.toFloat(),S=o.complex(g,l);return l.dispose(),g.dispose(),S}if(!He(p.dtype,c))return Ue.makeTensorFromDataId(p.dataId,p.shape,c);if(p.dtype==="complex64"){var j=o.real(p);return S=j.cast(c),j.dispose(),S}if(c==="int32")return o.int(p);if(c==="bool"){var V=fr(0,p.dtype);return S=o.notEqual(p,V),V.dispose(),S}throw new Error("Error in Cast: failed to cast "+p.dtype+" to "+c)}function ai(p,c){return Ue.makeTensorFromDataId(p.dataId,c,p.dtype)}function li(p,c,o){var l=(c-p)/(o-1),g=Kt(o,"float32");g[0]=p;for(var S=1;S<g.length;S++)g[S]=g[S-1]+l;return Us(g,"float32")}var Hr=Object.freeze({castTensor:Wr,reshapeTensor:ai,linspaceImpl:li,upcastType:fn,axesAreInnerMostDims:Af,combineLocations:Md,computeOutAndReduceShapes:So,expandShapeToKeepDim:_o,assertAxesAreInnerMostDims:Ko,getAxesPermutation:Oa,getUndoAxesPermutation:wu,getInnerMostAxes:Aa,getBroadcastDims:Sa,getReductionAxes:Ia,assertAndGetBroadcastShape:Mi,assertParamsConsistent:kc,computeOutShape:tu,computePool2DInfo:bn,computePool3DInfo:Sn,computeConv2DInfo:Nn,computeConv3DInfo:Wn,computeDefaultPad:Rn,tupleValuesAreOne:Vr,eitherStridesOrDilationsAreOne:xr,convertConv2DDataFormat:$r,PARALLELIZE_THRESHOLD:qu,computeOptimalWindowSize:uc});function ni(p,c){if(p.length!==c.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+p.length+", imag: "+c.length+".");for(var o=new Float32Array(2*p.length),l=0;l<o.length;l+=2)o[l]=p[l/2],o[l+1]=c[l/2];return o}function to(p,c){return{real:p[2*c],imag:p[2*c+1]}}function Qi(p,c,o,l){p[2*l]=c,p[2*l+1]=o}function zo(p,c,o){var l=(o?2:-2)*Math.PI*(p/c);return{real:Math.cos(l),imag:Math.sin(l)}}function ji(p,c,o){var l=function(S,j,V){return function(ne,ae,me){for(var Ee=0,Se=ne.length,Ne=0,ze=!1;Ee<Se;){var $e=me(ae,ne[Ne=Ee+(Se-Ee>>>1)]);$e>0?Ee=Ne+1:(Se=Ne,ze=!$e)}return ze?Ee:-Ee-1}(S,j,V||no)}(p,c,o),g=l<0?-(l+1):l;p.splice(g,0,c)}function no(p,c){return p>c?1:p<c?-1:0}function ia(p,c,o,l,g){return Jo(p,c,o,l,g,0).selectedIndices}function jo(p,c,o,l,g,S){var j=Jo(p,c,o,l,g,S);return j.numValidOutputs.dispose(),{selectedIndices:j.selectedIndices,selectedScores:j.selectedScores}}function Jo(p,c,o,l,g,S,j,V){V===void 0&&(V=!1);for(var ne=Array.from(c).map(function(vt,Ct){return{score:vt,boxIndex:Ct,suppressBeginIndex:0}}).filter(function(vt){return vt.score>g}).sort(mo),ae=S>0?-.5/S:0,me=[],Ee=[];me.length<o&&ne.length>0;){var Se=ne.pop(),Ne=Se.score,ze=Se.boxIndex,$e=Se.suppressBeginIndex;if(Ne<g)break;for(var qe=!1,tt=me.length-1;tt>=$e;--tt){var lt=Fi(p,ze,me[tt]);if(lt>=l){qe=!0;break}if(Se.score=Se.score*Di(l,ae,lt),Se.score<=g)break}Se.suppressBeginIndex=me.length,qe||(Se.score===Ne?(me.push(ze),Ee.push(Se.score)):Se.score>g&&ji(ne,Se,mo))}var ht=me.length;return V&&(me.fill(0,ht),Ee.fill(0,ht)),{selectedIndices:Us(me,"int32"),selectedScores:Us(Ee,"float32"),numValidOutputs:fr(ht,"int32")}}function Fi(p,c,o){var l=p.subarray(4*c,4*c+4),g=p.subarray(4*o,4*o+4),S=Math.min(l[0],l[2]),j=Math.min(l[1],l[3]),V=Math.max(l[0],l[2]),ne=Math.max(l[1],l[3]),ae=Math.min(g[0],g[2]),me=Math.min(g[1],g[3]),Ee=Math.max(g[0],g[2]),Se=Math.max(g[1],g[3]),Ne=(V-S)*(ne-j),ze=(Ee-ae)*(Se-me);if(Ne<=0||ze<=0)return 0;var $e=Math.max(S,ae),qe=Math.max(j,me),tt=Math.min(V,Ee),lt=Math.min(ne,Se),ht=Math.max(tt-$e,0)*Math.max(lt-qe,0);return ht/(Ne+ze-ht)}function Di(p,c,o){var l=Math.exp(c*o*o);return o<=p?l:0}function mo(p,c){return p.score-c.score||p.score===c.score&&c.boxIndex-p.boxIndex}function la(p,c,o){var l=new Array(p.rank).fill(0),g=p.shape.slice();return c.map(function(S){g[o]=S;var j=p.slice(l,g);return l[o]+=S,j})}function ha(p,c){for(var o=new Array(p.rank),l=0;l<o.length;l++)o[l]=p.shape[l]*c[l];var g=bi(o,p.dtype);for(l=0;l<g.values.length;++l){for(var S=g.indexToLoc(l),j=new Array(p.rank),V=0;V<j.length;V++)j[V]=S[V]%p.shape[V];var ne=p.locToIndex(j);g.values[l]=p.values[ne]}return g.toTensor()}function aa(p,c,o,l,g){for(var S=c[c.length-1],j=[p.length/S,S],V=j[0],ne=j[1],ae=Hn(o,V*l),me=Hn("int32",V*l),Ee=0;Ee<V;Ee++){for(var Se=Ee*ne,Ne=p.subarray(Se,Se+ne),ze=[],$e=0;$e<Ne.length;$e++)ze.push({value:Ne[$e],index:$e});ze.sort(function(vt,Ct){return Ct.value-vt.value});var qe=Ee*l,tt=ae.subarray(qe,qe+l),lt=me.subarray(qe,qe+l);for($e=0;$e<l;$e++)tt[$e]=ze[$e].value,lt[$e]=ze[$e].index}var ht=c.slice();return ht[ht.length-1]=l,[ko(ae,ht,o),ko(me,ht,"int32")]}function Qo(p,c){for(var o=[],l=0;l<c.length;l++)c[l]&&o.push(l);var g=bi(p,"int32"),S=bi([o.length,p.length],"int32");for(l=0;l<o.length;l++){var j=g.indexToLoc(o[l]),V=l*p.length;S.values.set(j,V)}return S.toTensor()}function Za(p,c){return["x","y","z","w","u","v"].slice(0,c).map(function(o){return p+"."+o})}function da(p,c){return c===1?[p]:Za(p,c)}function go(){var p,c,o,l,g,S,j,V,ne,ae;return P().getNumber("WEBGL_VERSION")===2?(p="#version 300 es",c="in",o="out",l="in",g="texture",S="outputColor",j="out vec4 outputColor;",V=`
      bool isnan_custom(float val) {
        return (val > 0.0 || val < 0.0) ? false : val != 0.0;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `,ne="",ae=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(p="",c="attribute",o="varying",l="varying",g="texture2D",S="gl_FragColor",j="",V=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,ne=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,ae=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:p,attribute:c,varyingVs:o,varyingFs:l,texture2D:g,output:S,defineOutput:j,defineSpecialNaN:V,defineSpecialInf:ne,defineRound:ae}}function wa(p,c,o){o===void 0&&(o="index");var l=pr(c);return l.map(function(g,S){return"int "+p[S]+" = "+o+" / "+g+"; "+(S===l.length-1?"int "+p[S+1]+" = "+o+" - "+p[S]+" * "+g:"index -= "+p[S]+" * "+g)+";"}).join("")}function Su(p){var c=pr(p).map(function(o){return o.toString()});return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * `+c[0]+" + coords.y * "+c[1]+` + coords.z;
  }
`}var fs=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`;function Ma(p,c,o,l){var g=[];p.forEach(function(Ne){var ze=Ye(Ne.shapeInfo.logicalShape);Ne.shapeInfo.isUniform?g.push("uniform float "+Ne.name+(ze>1?"["+ze+"]":"")+";"):(g.push("uniform sampler2D "+Ne.name+";"),g.push("uniform int offset"+Ne.name+";"))});var S,j,V=g.join(`
`),ne=p.map(function(Ne){return function(ze,$e,qe){qe===void 0&&(qe=!1);var tt="";tt+=qe?function vt(Ct){var Vt,Yt,qt;switch(Ct.shapeInfo.logicalShape.length){case 0:return Vt=Ct.name,Yt="get"+Vt.charAt(0).toUpperCase()+Vt.slice(1),qt=go(),`
    vec4 `+Yt+`() {
      return `+qt.texture2D+"("+Vt+`, halfCR);
    }
  `;case 1:return function($t){var yn=$t.name,On="get"+yn.charAt(0).toUpperCase()+yn.slice(1),Cn=$t.shapeInfo.texShape,Xn=[Math.ceil(Cn[0]/2),Math.ceil(Cn[1]/2)],er=go();return`
    vec4 `+On+`(int index) {
      vec2 uv = packedUVfrom1D(
        `+Xn[0]+", "+Xn[1]+`, index);
      return `+er.texture2D+"("+yn+`, uv);
    }
  `}(Ct);case 2:return function($t){var yn=$t.shapeInfo.logicalShape,On=$t.name,Cn="get"+On.charAt(0).toUpperCase()+On.slice(1),Xn=$t.shapeInfo.texShape,er=Xn[0],sr=Xn[1],lr=go();if(Xn!=null&&ln(yn,Xn))return`
      vec4 `+Cn+`(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(`+sr+".0, "+er+`.0);

        return `+lr.texture2D+"("+On+`, uv);
      }
    `;var ur=[Math.ceil(Xn[0]/2),Math.ceil(Xn[1]/2)],or=Math.ceil(yn[1]/2);return`
    vec4 `+Cn+`(int row, int col) {
      vec2 uv = packedUVfrom2D(`+or+", "+ur[0]+", "+ur[1]+`, row, col);
      return `+lr.texture2D+"("+On+`, uv);
    }
  `}(Ct);case 3:return function($t){var yn=$t.shapeInfo.logicalShape,On=$t.name,Cn="get"+On.charAt(0).toUpperCase()+On.slice(1),Xn=$t.shapeInfo.texShape,er=[Math.ceil(Xn[0]/2),Math.ceil(Xn[1]/2)];if(yn[0]===1){var sr=yn.slice(1),lr=As($t,sr);return`
        `+vt(lr)+`
        vec4 `+Cn+`(int b, int row, int col) {
          return `+Cn+"("+hs(["b","row","col"],[1,2])+`);
        }
      `}var ur=er[0],or=er[1],Er=Math.ceil(yn[2]/2),kr=Er*Math.ceil(yn[1]/2),Ur=go();return`
    vec4 `+Cn+`(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        `+ur+", "+or+", "+kr+", "+Er+`, b, row, col);
      return `+Ur.texture2D+"("+On+`, uv);
    }
  `}(Ct);default:return function($t){for(var yn=$t.shapeInfo.logicalShape,On=yn.length,Cn=$t.name,Xn="get"+Cn.charAt(0).toUpperCase()+Cn.slice(1),er=$t.shapeInfo.texShape,sr=[Math.ceil(er[0]/2),Math.ceil(er[1]/2)],lr=sr[0],ur=sr[1],or=Math.ceil(yn[On-1]/2),Er=or*Math.ceil(yn[On-2]/2),kr="int b, int row, int col",Ur="b * "+Er+" + (row / 2) * "+or+" + (col / 2)",Zr=2;Zr<On-1;Zr++)kr="int b"+Zr+", "+kr,Er*=yn[On-Zr-1],Ur="b"+Zr+" * "+Er+" + "+Ur;var mi=go();return`
    vec4 `+Xn+"("+kr+`) {
      int index = `+Ur+`;
      int texR = index / `+ur+`;
      int texC = index - texR * `+ur+`;
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+ur+", "+lr+`);
      return `+mi.texture2D+"("+Cn+`, uv);
    }
  `}(Ct)}}(ze):function vt(Ct){var Vt=Ct.shapeInfo.logicalShape;switch(Vt.length){case 0:return function(Yt){var qt=Yt.name,$t="get"+qt.charAt(0).toUpperCase()+qt.slice(1);if(Yt.shapeInfo.isUniform)return"float "+$t+"() {return "+qt+";}";var yn=Yt.shapeInfo.texShape,On=yn[0],Cn=yn[1];if(On===1&&Cn===1)return`
      float `+$t+`() {
        return sampleTexture(`+qt+`, halfCR);
      }
    `;var Xn=Yt.shapeInfo.texShape,er=Xn[0],sr=Xn[1],lr=Zo(qt);return`
    float `+$t+`() {
      vec2 uv = uvFromFlat(`+er+", "+sr+", "+lr+`);
      return sampleTexture(`+qt+`, uv);
    }
  `}(Ct);case 1:return function(Yt){var qt=Yt.name,$t="get"+qt.charAt(0).toUpperCase()+qt.slice(1);if(Yt.shapeInfo.isUniform)return`
      float `+$t+`(int index) {
        `+Ms(Yt)+`
      }
    `;var yn=Yt.shapeInfo.texShape,On=yn[0],Cn=yn[1];if(Cn===1&&On===1)return`
      float `+$t+`(int index) {
        return sampleTexture(`+qt+`, halfCR);
      }
    `;var Xn=Zo(qt);return Cn===1?`
      float `+$t+`(int index) {
        vec2 uv = vec2(0.5, (float(index + `+Xn+") + 0.5) / "+On+`.0);
        return sampleTexture(`+qt+`, uv);
      }
    `:On===1?`
      float `+$t+`(int index) {
        vec2 uv = vec2((float(index + `+Xn+") + 0.5) / "+Cn+`.0, 0.5);
        return sampleTexture(`+qt+`, uv);
      }
    `:`
    float `+$t+`(int index) {
      vec2 uv = uvFromFlat(`+On+", "+Cn+", index + "+Xn+`);
      return sampleTexture(`+qt+`, uv);
    }
  `}(Ct);case 2:return function(Yt){var qt=Yt.shapeInfo.logicalShape,$t=Yt.name,yn="get"+$t.charAt(0).toUpperCase()+$t.slice(1),On=Yt.shapeInfo.texShape;if(On!=null&&ln(qt,On)){var Cn=On[0],Xn=On[1];return`
    float `+yn+`(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(`+Xn+".0, "+Cn+`.0);
      return sampleTexture(`+$t+`, uv);
    }
  `}var er=Bn(qt),sr=er.newShape,lr=er.keptDims,ur=sr;if(ur.length<qt.length){var or=As(Yt,ur);return`
      `+vt(or)+`
      float `+yn+`(int row, int col) {
        return `+yn+"("+hs(["row","col"],lr)+`);
      }
    `}if(Yt.shapeInfo.isUniform)return`
      float `+yn+`(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(`+qt[1]+`, 1)));
        `+Ms(Yt)+`
      }
    `;var Er=On[0],kr=On[1],Ur=Zo($t);return kr===1?`
    float `+yn+`(int row, int col) {
      float index = dot(vec3(row, col, `+Ur+"), vec3("+qt[1]+`, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / `+Er+`.0);
      return sampleTexture(`+$t+`, uv);
    }
  `:Er===1?`
    float `+yn+`(int row, int col) {
      float index = dot(vec3(row, col, `+Ur+"), vec3("+qt[1]+`, 1, 1));
      vec2 uv = vec2((index + 0.5) / `+kr+`.0, 0.5);
      return sampleTexture(`+$t+`, uv);
    }
  `:`
  float `+yn+`(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * `+qt[1]+" + col + "+Ur+`;
    vec2 uv = uvFromFlat(`+Er+", "+kr+`, index);
    return sampleTexture(`+$t+`, uv);
  }
`}(Ct);case 3:return function(Yt){var qt=Yt.shapeInfo.logicalShape,$t=Yt.name,yn="get"+$t.charAt(0).toUpperCase()+$t.slice(1),On=qt[1]*qt[2],Cn=qt[2],Xn=Bn(qt),er=Xn.newShape,sr=Xn.keptDims,lr=er;if(lr.length<qt.length){var ur=As(Yt,lr);return`
        `+vt(ur)+`
        float `+yn+`(int row, int col, int depth) {
          return `+yn+"("+hs(["row","col","depth"],sr)+`);
        }
      `}if(Yt.shapeInfo.isUniform)return`
      float `+yn+`(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(`+On+", "+Cn+`, 1)));
        `+Ms(Yt)+`
      }
    `;var or=Yt.shapeInfo.texShape,Er=or[0],kr=or[1],Ur=Yt.shapeInfo.flatOffset;if(kr===On&&Ur==null)return`
        float `+yn+`(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(`+Cn+`, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(`+kr+".0, "+Er+`.0);
          return sampleTexture(`+$t+`, uv);
        }
      `;if(kr===Cn&&Ur==null)return`
    float `+yn+`(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(`+qt[1]+`, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+kr+".0, "+Er+`.0);
      return sampleTexture(`+$t+`, uv);
    }
  `;var Zr=Zo($t);return`
      float `+yn+`(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * `+On+" + col * "+Cn+" + depth + "+Zr+`;
        vec2 uv = uvFromFlat(`+Er+", "+kr+`, index);
        return sampleTexture(`+$t+`, uv);
      }
  `}(Ct);case 4:return function(Yt){var qt=Yt.shapeInfo.logicalShape,$t=Yt.name,yn="get"+$t.charAt(0).toUpperCase()+$t.slice(1),On=qt[3],Cn=qt[2]*On,Xn=qt[1]*Cn,er=Bn(qt),sr=er.newShape,lr=er.keptDims;if(sr.length<qt.length){var ur=As(Yt,sr);return`
      `+vt(ur)+`
      float `+yn+`(int row, int col, int depth, int depth2) {
        return `+yn+"("+hs(["row","col","depth","depth2"],lr)+`);
      }
    `}if(Yt.shapeInfo.isUniform)return`
      float `+yn+`(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(`+Xn+", "+Cn+", "+On+`, 1)));
        `+Ms(Yt)+`
      }
    `;var or=Yt.shapeInfo.flatOffset,Er=Yt.shapeInfo.texShape,kr=Er[0],Ur=Er[1];if(Ur===Xn&&or==null)return`
      float `+yn+`(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(`+Cn+", "+On+`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+Ur+".0, "+kr+`.0);
        return sampleTexture(`+$t+`, uv);
      }
    `;if(Ur===On&&or==null)return`
      float `+yn+`(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(`+qt[1]*qt[2]+", "+qt[2]+`, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+Ur+".0, "+kr+`.0);
        return sampleTexture(`+$t+`, uv);
      }
    `;var Zr=Zo($t);return`
    float `+yn+`(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+Xn+" + col * "+Cn+` +
          depth * `+On+` + depth2;
      vec2 uv = uvFromFlat(`+kr+", "+Ur+", index + "+Zr+`);
      return sampleTexture(`+$t+`, uv);
    }
  `}(Ct);case 5:return function(Yt){var qt=Yt.shapeInfo.logicalShape,$t=Yt.name,yn="get"+$t.charAt(0).toUpperCase()+$t.slice(1),On=qt[4],Cn=qt[3]*On,Xn=qt[2]*Cn,er=qt[1]*Xn,sr=Bn(qt),lr=sr.newShape,ur=sr.keptDims;if(lr.length<qt.length){var or=As(Yt,lr);return`
      `+vt(or)+`
      float `+yn+`(int row, int col, int depth, int depth2, int depth3) {
        return `+yn+"("+hs(["row","col","depth","depth2","depth3"],ur)+`);
      }
    `}if(Yt.shapeInfo.isUniform)return`
      float `+yn+`(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(`+er+", "+Xn+", "+Cn+", "+On+`)) +
          depth3;
        `+Ms(Yt)+`
      }
    `;var Er=Yt.shapeInfo.flatOffset,kr=Yt.shapeInfo.texShape,Ur=kr[0],Zr=kr[1];if(Zr===er&&Er==null)return`
      float `+yn+`(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(`+Xn+", "+Cn+", "+On+`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+Zr+".0, "+Ur+`.0);
        return sampleTexture(`+$t+`, uv);
      }
    `;if(Zr===On&&Er==null)return`
      float `+yn+`(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(`+qt[1]*qt[2]*qt[3]+`,
               `+qt[2]*qt[3]+", "+qt[3]+`, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+Zr+".0, "+Ur+`.0);
        return sampleTexture(`+$t+`, uv);
      }
    `;var mi=Zo($t);return`
    float `+yn+`(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+er+" + col * "+Xn+" + depth * "+Cn+` +
          depth2 * `+On+" + depth3 + "+mi+`;
      vec2 uv = uvFromFlat(`+Ur+", "+Zr+`, index);
      return sampleTexture(`+$t+`, uv);
    }
  `}(Ct);case 6:return function(Yt){var qt=Yt.shapeInfo.logicalShape,$t=Yt.name,yn="get"+$t.charAt(0).toUpperCase()+$t.slice(1),On=Bn(qt),Cn=On.newShape,Xn=On.keptDims;if(Cn.length<qt.length){var er=As(Yt,Cn);return`
      `+vt(er)+`
      float `+yn+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return `+yn+"("+hs(["row","col","depth","depth2","depth3","depth4"],Xn)+`);
      }
    `}var sr=qt[5],lr=qt[4]*sr,ur=qt[3]*lr,or=qt[2]*ur,Er=qt[1]*or;if(Yt.shapeInfo.isUniform)return`
      float `+yn+`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(`+Er+", "+or+", "+ur+", "+lr+`)) +
          dot(
            vec2(depth3, depth4),
            vec2(`+sr+`, 1)));
        `+Ms(Yt)+`
      }
    `;var kr=Yt.shapeInfo.flatOffset,Ur=Yt.shapeInfo.texShape,Zr=Ur[0],mi=Ur[1];if(mi===Er&&kr==null)return`
      float `+yn+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(`+or+", "+ur+", "+lr+", "+sr+`)) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+mi+".0, "+Zr+`.0);
        return sampleTexture(`+$t+`, uv);
      }
    `;if(mi===sr&&kr==null)return`
      float `+yn+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(`+qt[1]*qt[2]*qt[3]*qt[4]+`,
               `+qt[2]*qt[3]*qt[4]+`,
               `+qt[3]*qt[4]+`,
               `+qt[4]+`)) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+mi+".0, "+Zr+`.0);
        return sampleTexture(`+$t+`, uv);
      }
    `;var co=Zo($t);return`
    float `+yn+`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+Er+" + col * "+or+" + depth * "+ur+` +
          depth2 * `+lr+" + depth3 * "+sr+" + depth4 + "+co+`;
      vec2 uv = uvFromFlat(`+Zr+", "+mi+`, index);
      return sampleTexture(`+$t+`, uv);
    }
  `}(Ct);default:throw new Error(Vt.length+"-D input sampling is not yet supported")}}(ze);var lt=ze.shapeInfo.logicalShape,ht=$e.logicalShape;return lt.length<=ht.length&&(tt+=qe?function(vt,Ct){var Vt,Yt=vt.name,qt=Yt.charAt(0).toUpperCase()+Yt.slice(1),$t="get"+qt+"AtOutCoords",yn=vt.shapeInfo.logicalShape.length,On=Ct.logicalShape.length,Cn=Sa(vt.shapeInfo.logicalShape,Ct.logicalShape),Xn=Io(On),er=On-yn,sr=["x","y","z","w","u","v"];Vt=yn===0?"":On<2&&Cn.length>=1?"coords = 0;":Cn.map(function(Zr){return"coords."+sr[Zr+er]+" = 0;"}).join(`
`);var lr;lr=On<2&&yn>0?"coords":vt.shapeInfo.logicalShape.map(function(Zr,mi){return"coords."+sr[mi+er]}).join(", ");var ur="return outputValue;",or=Ye(vt.shapeInfo.logicalShape)===1,Er=Ye(Ct.logicalShape)===1;if(yn!==1||or||Er){if(or&&!Er)ur=On===1?`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:`
        return vec4(outputValue.x);
      `;else if(Cn.length){var kr=yn-2,Ur=yn-1;Cn.indexOf(kr)>-1&&Cn.indexOf(Ur)>-1?ur="return vec4(outputValue.x);":Cn.indexOf(kr)>-1?ur="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":Cn.indexOf(Ur)>-1&&(ur="return vec4(outputValue.xx, outputValue.zz);")}}else ur=`
      return vec4(outputValue.xy, outputValue.xy);
    `;return`
    vec4 `+$t+`() {
      `+Xn+` coords = getOutputCoords();
      `+Vt+`
      vec4 outputValue = get`+qt+"("+lr+`);
      `+ur+`
    }
  `}(ze,$e):function(vt,Ct){var Vt=vt.name,Yt=Vt.charAt(0).toUpperCase()+Vt.slice(1),qt="get"+Yt+"AtOutCoords",$t=Ct.texShape,yn=vt.shapeInfo.texShape,On=vt.shapeInfo.logicalShape.length,Cn=Ct.logicalShape.length;if(!vt.shapeInfo.isUniform&&On===Cn&&vt.shapeInfo.flatOffset==null&&ln(yn,$t))return`
      float `+qt+`() {
        return sampleTexture(`+Vt+`, resultUV);
      }
    `;var Xn=Io(Cn),er=Sa(vt.shapeInfo.logicalShape,Ct.logicalShape),sr=Cn-On,lr=["x","y","z","w","u","v"];return`
    float `+qt+`() {
      `+Xn+` coords = getOutputCoords();
      `+(On===0?"":Cn<2&&er.length>=1?"coords = 0;":er.map(function(ur){return"coords."+lr[ur+sr]+" = 0;"}).join(`
`))+`
      return get`+Yt+"("+(Cn<2&&On>0?"coords":vt.shapeInfo.logicalShape.map(function(ur,or){return"coords."+lr[or+sr]}).join(", "))+`);
    }
  `}(ze,$e)),tt}(Ne,c,l)}).join(`
`),ae=c.texShape,me=go(),Ee=`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return `+me.texture2D+`(textureSampler, uv).r;
    }
  `,Se=function(Ne){return Ne.version+`
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    `+Ne.varyingFs+` vec2 resultUV;
    `+Ne.defineOutput+`
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    `+Ne.defineSpecialNaN+`
    `+Ne.defineSpecialInf+`
    `+Ne.defineRound+`

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    `+Fo+`
    `+cc+`
    `+Ks+`
  `}(me);return c.isPacked?(S=function(Ne,ze){switch(Ne.length){case 0:return`
    int getOutputCoords() {
      return 0;
    }
  `;case 1:return function(vt,Ct){var Vt=[Math.ceil(Ct[0]/2),Math.ceil(Ct[1]/2)];return Vt[0]===1?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * `+Vt[1]+`.0);
      }
    `:Vt[1]===1?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * `+Vt[0]+`.0);
      }
    `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+Vt[0]+", "+Vt[1]+`));
      return 2 * (resTexRC.x * `+Vt[1]+` + resTexRC.y);
    }
  `}(0,ze);case 2:return function(vt,Ct){var Vt=[Math.ceil(Ct[0]/2),Math.ceil(Ct[1]/2)];if(ln(vt,Ct))return`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(`+Vt[0]+", "+Vt[1]+`));
      }
    `;var Yt=Math.ceil(vt[1]/2);return`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+Vt[0]+", "+Vt[1]+`));

      int index = resTexRC.x * `+Vt[1]+` + resTexRC.y;
      int r = 2 * (index / `+Yt+`);
      int c = imod(index, `+Yt+`) * 2;

      return ivec2(r, c);
    }
  `}(Ne,ze);case 3:return $e=Ne,qe=ze,tt=[Math.ceil(qe[0]/2),Math.ceil(qe[1]/2)],ht=(lt=Math.ceil($e[2]/2))*Math.ceil($e[1]/2),`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+tt[0]+", "+tt[1]+`));
      int index = resTexRC.x * `+tt[1]+` + resTexRC.y;

      int b = index / `+ht+`;
      index -= b * `+ht+`;

      int r = 2 * (index / `+lt+`);
      int c = imod(index, `+lt+`) * 2;

      return ivec3(b, r, c);
    }
  `;default:return function(vt,Ct){for(var Vt=[Math.ceil(Ct[0]/2),Math.ceil(Ct[1]/2)],Yt=Math.ceil(vt[vt.length-1]/2),qt=Yt*Math.ceil(vt[vt.length-2]/2),$t=qt,yn="",On="b, r, c",Cn=2;Cn<vt.length-1;Cn++)yn=`
      int b`+Cn+" = index / "+($t*=vt[vt.length-Cn-1])+`;
      index -= b`+Cn+" * "+$t+`;
    `+yn,On="b"+Cn+", "+On;return`
    ivec`+vt.length+` getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+Vt[0]+", "+Vt[1]+`));
      int index = resTexRC.x * `+Vt[1]+` + resTexRC.y;

      `+yn+`

      int b = index / `+qt+`;
      index -= b * `+qt+`;

      int r = 2 * (index / `+Yt+`);
      int c = imod(index, `+Yt+`) * 2;

      return ivec`+vt.length+"("+On+`);
    }
  `}(Ne,ze)}var $e,qe,tt,lt,ht}(c.logicalShape,ae),j=`
    void setOutput(vec4 val) {
      `+me.output+` = val;
    }
  `):(S=function(Ne,ze){switch(Ne.length){case 0:return`
    int getOutputCoords() {
      return 0;
    }
  `;case 1:return function(tt,lt){return lt[0]===1?`
      int getOutputCoords() {
        return int(resultUV.x * `+lt[1]+`.0);
      }
    `:lt[1]===1?`
      int getOutputCoords() {
        return int(resultUV.y * `+lt[0]+`.0);
      }
    `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+lt[0]+", "+lt[1]+`));
      return resTexRC.x * `+lt[1]+` + resTexRC.y;
    }
  `}(0,ze);case 2:return function(tt,lt){return ln(tt,lt)?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(`+lt[0]+", "+lt[1]+`));
      }
    `:tt[1]===1?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`+lt[0]+", "+lt[1]+`));
        int index = resTexRC.x * `+lt[1]+` + resTexRC.y;
        return ivec2(index, 0);
      }
    `:tt[0]===1?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`+lt[0]+", "+lt[1]+`));
        int index = resTexRC.x * `+lt[1]+` + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+lt[0]+", "+lt[1]+`));
      int index = resTexRC.x * `+lt[1]+` + resTexRC.y;
      int r = index / `+tt[1]+`;
      int c = index - r * `+tt[1]+`;
      return ivec2(r, c);
    }
  `}(Ne,ze);case 3:return $e=ze,qe=wa(["r","c","d"],Ne),`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+$e[0]+", "+$e[1]+`));
      int index = resTexRC.x * `+$e[1]+` + resTexRC.y;
      `+qe+`
      return ivec3(r, c, d);
    }
  `;case 4:return function(tt,lt){var ht=wa(["r","c","d","d2"],tt);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`+lt[0]+", "+lt[1]+`));
      int index = resTexRC.x * `+lt[1]+` + resTexRC.y;
      `+ht+`
      return ivec4(r, c, d, d2);
    }
  `}(Ne,ze);case 5:return function(tt,lt){var ht=wa(["r","c","d","d2","d3"],tt);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(`+lt[0]+`,
                             `+lt[1]+`));

      int index = resTexRC.x * `+lt[1]+` + resTexRC.y;

      `+ht+`

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `}(Ne,ze);case 6:return function(tt,lt){var ht=wa(["r","c","d","d2","d3","d4"],tt);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`+lt[0]+", "+lt[1]+`));
      int index = resTexRC.x * `+lt[1]+` + resTexRC.y;

      `+ht+`

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `}(Ne,ze);default:throw new Error(Ne.length+"-D output sampling is not yet supported")}var $e,qe}(c.logicalShape,ae),j=`
    void setOutput(float val) {
      `+me.output+` = vec4(val, 0, 0, 0);
    }
  `),l&&(Se+=Rs),[Se,Ee,j,V,S,ne,o].join(`
`)}var Fo=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,cc=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,Ks=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,Rs=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function Zo(p){return"offset"+p}function Ms(p){var c=p.name,o=Ye(p.shapeInfo.logicalShape);return o<2?"return "+c+";":`
    for (int i = 0; i < `+o+`; i++) {
      if (i == index) {
        return `+c+`[i];
      }
    }
  `}function Io(p){if(p<=1)return"int";if(p===2)return"ivec2";if(p===3)return"ivec3";if(p===4)return"ivec4";if(p===5)return"ivec5";if(p===6)return"ivec6";throw Error("GPU for rank "+p+" is not yet supported")}function As(p,c){var o=JSON.parse(JSON.stringify(p));return o.shapeInfo.logicalShape=c,o}function hs(p,c){return c.map(function(o){return p[o]}).join(", ")}var oo=function(p,c,o){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=Mi(c,o),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        `+p+`
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `},Ss="return a + b;",Ga="return a - b;",Xs="return a * b;",Sc="return (a < 0.) ? b * a : a;",Uo=function(p,c,o){this.variableNames=["A","B"],this.outputShape=Mi(c,o),this.userCode=`
      float binaryOperation(float a, float b) {
        `+p+`
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `},es=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`,ja=function(p,c,o,l){l===void 0&&(l=!1),this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=Mi(c,o);var g=this.outputShape.length,S="";if(l)if(g===0||Ye(this.outputShape)===1)S=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else if(S=`
          `+Io(g)+` coords = getOutputCoords();
        `,g===1)S+=`
            result.y = (coords + 1) >= `+this.outputShape[0]+` ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `;else{var j=da("coords",g);S+=`
            bool nextRowOutOfBounds =
              (`+j[g-2]+" + 1) >= "+this.outputShape[g-2]+`;
            bool nextColOutOfBounds =
              (`+j[g-1]+" + 1) >= "+this.outputShape[g-1]+`;
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        `+p+`
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        `+S+`

        setOutput(result);
      }
    `},lc=function(){function p(c){this.variableNames=["A"],this.outputShape=c,this.userCode=`
      uniform float minVal;
      uniform float maxVal;

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}return p.prototype.getCustomSetupFunc=function(c,o){var l=this;return function(g,S){l.minLoc==null&&(l.minLoc=g.getUniformLocationNoThrow(S,"minVal"),l.maxLoc=g.getUniformLocationNoThrow(S,"maxVal")),g.gl.uniform1f(l.minLoc,c),g.gl.uniform1f(l.maxLoc,o)}},p}(),el=function(){function p(c){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=c,this.userCode=`
      uniform float minVal;
      uniform float maxVal;

      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}return p.prototype.getCustomSetupFunc=function(c,o){var l=this;return function(g,S){l.minLoc==null&&(l.minLoc=g.getUniformLocationNoThrow(S,"minVal"),l.maxLoc=g.getUniformLocationNoThrow(S,"maxVal")),g.gl.uniform1f(l.minLoc,c),g.gl.uniform1f(l.maxLoc,o)}},p}();function ci(p,c,o){var l=p.indexOf(c);return p.map(function(g,S){return S===l?g+" - "+o:g}).join()}var Xd=function(p,c,o,l){c===void 0&&(c=!1),o===void 0&&(o=null),l===void 0&&(l=!1),this.variableNames=["x","W"],this.outputShape=p.outShape;var g=p.padInfo.top,S=p.padInfo.left,j=p.strideHeight,V=p.strideWidth,ne=p.dilationHeight,ae=p.dilationWidth,me=p.filterHeight,Ee=p.filterWidth,Se=4*Math.floor(p.inChannels/4),Ne=p.inChannels%4,ze=p.dataFormat==="channelsLast",$e=ze?1:2,qe=ze?2:3,tt=ze?3:1,lt="",ht="";o&&(lt=l?`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          `+o+`
        }`:`
          float activation(float x) {
            `+o+`
          }
        `,ht="result = activation(result);");var vt=c?"result += getBiasAtOutCoords();":"";c&&this.variableNames.push("bias"),l&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+lt+`

      const ivec2 strides = ivec2(`+j+", "+V+`);
      const ivec2 pads = ivec2(`+g+", "+S+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[`+tt+`];

        ivec2 xRCCorner =
            ivec2(coords[`+$e+"], coords["+qe+`]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+me+`; wR++) {
          int xR = xRCorner + wR * `+ne+`;

          if (xR < 0 || xR >= `+p.inHeight+`) {
            continue;
          }

          for (int wC = 0; wC < `+Ee+`; wC++) {
            int xC = xCCorner + wC * `+ae+`;

            if (xC < 0 || xC >= `+p.inWidth+`) {
              continue;
            }

            for (int d1 = 0; d1 < `+Se+`; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (`+ze+`) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (`+(Ne===1)+`) {

              if (`+ze+`) {
                dotProd +=
                    getX(batch, xR, xC, `+Se+`) *
                    getW(wR, wC, `+Se+`, d2);
              } else {
                dotProd +=
                    getX(batch, `+Se+`, xR, xC) *
                    getW(wR, wC, `+Se+`, d2);
              }

            } else if (`+(Ne===2)+`) {
              vec2 wValues = vec2(
                getW(wR, wC, `+Se+`, d2),
                getW(wR, wC, `+Se+` + 1, d2)
              );

              if (`+ze+`) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, `+Se+`),
                  getX(batch, xR, xC, `+Se+` + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, `+Se+`, xR, xC),
                  getX(batch, `+Se+` + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (`+(Ne===3)+`) {
              vec3 wValues = vec3(
                getW(wR, wC, `+Se+`, d2),
                getW(wR, wC, `+Se+` + 1, d2),
                getW(wR, wC, `+Se+` + 2, d2)
              );

              if (`+ze+`) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, `+Se+`),
                  getX(batch, xR, xC, `+Se+` + 1),
                  getX(batch, xR, xC, `+Se+` + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, `+Se+`, xR, xC),
                  getX(batch, `+Se+` + 1, xR, xC),
                  getX(batch, `+Se+` + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        `+vt+`
        `+ht+`
        setOutput(result);
      }
    `},tl=function(p,c,o,l){c===void 0&&(c=!1),o===void 0&&(o=null),l===void 0&&(l=!1),this.variableNames=["x","W"],this.outputShape=p.outShape;var g=p.inHeight,S=p.inWidth,j=p.padInfo.top,V=p.padInfo.left,ne=p.strideHeight,ae=p.strideWidth,me=p.dilationHeight,Ee=p.dilationWidth,Se=p.filterHeight,Ne=p.filterWidth,ze=p.outChannels/p.inChannels,$e="",qe="";o&&($e=l?`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          `+o+`
        }`:`
          float activation(float x) {
            `+o+`
          }
        `,qe="result = activation(result);");var tt=c?"result += getBiasAtOutCoords();":"";c&&this.variableNames.push("bias"),l&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+$e+`

      const ivec2 strides = ivec2(`+ne+", "+ae+`);
      const ivec2 pads = ivec2(`+j+", "+V+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / `+ze+`;
        int q = d2 - d1 * `+ze+`;

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < `+Se+`; wR++) {
          int xR = xRCorner + wR * `+me+`;

          if (xR < 0 || xR >= `+g+`) {
            continue;
          }

          for (int wC = 0; wC < `+Ne+`; wC++) {
            int xC = xCCorner + wC * `+Ee+`;

            if (xC < 0 || xC >= `+S+`) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        `+tt+`
        `+qe+`
        setOutput(result);
      }
    `},Ll=function(p,c,o,l){c===void 0&&(c=!1),o===void 0&&(o=null),l===void 0&&(l=!1),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=p.outShape;for(var g=p.inHeight,S=p.inWidth,j=p.padInfo.top,V=p.padInfo.left,ne=p.strideHeight,ae=p.strideWidth,me=p.dilationHeight,Ee=p.dilationWidth,Se=p.filterHeight,Ne=p.filterWidth,ze=Ne,$e="int xR; int xC; int xCOffset;",qe=0;qe<Se;qe++)for(var tt=0;tt<Ne;tt++)$e+=`
          vec4 xTexelR`+qe+"C"+2*tt+` = vec4(0.);
          vec4 wR`+qe+"C"+tt+` = vec4(0.);
          vec4 xR`+qe+"C"+tt+" = vec4(0.);";for(qe=0;qe<Se;qe++)for(var lt=0;lt<ze;lt++){if($e+=`
          xR = xRCorner + `+qe*me+`;
          xC = xCCorner + `+(tt=2*lt)*Ee+`;
        `,ae===1){if(tt<Ne&&($e+=V%2==1?`
                xCOffset = xC + 1;
                if(xR >= 0 && xR < `+g+" && xCOffset >= 0 && xCOffset < "+S+`) {
                  xTexelR`+qe+"C"+tt+` = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if(xCOffset + 1 >= `+S+`) {
                    xTexelR`+qe+"C"+tt+`.zw = vec2(0.);
                  }
                } else {
                  xTexelR`+qe+"C"+tt+` = vec4(0.);
                }

                xCOffset = xC + 1 - 2;
                if(xR >= 0 && xR < `+g+" && xCOffset >= 0 && xCOffset < "+S+`) {
                  vec4 previous = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if(xCOffset + 1 >= `+S+`) {
                    previous.zw = vec2(0.);
                  }

                  xR`+qe+"C"+tt+" = vec4(previous.zw, xTexelR"+qe+"C"+tt+`.xy);
                } else {
                  xR`+qe+"C"+tt+" = vec4(0, 0, xTexelR"+qe+"C"+tt+`.xy);
                }
              `:`
                if(xR >= 0 && xR < `+g+" && xC >= 0 && xC < "+S+`) {
                  xTexelR`+qe+"C"+tt+` = getX(batch, xR, xC, d1);
                } else {
                  xTexelR`+qe+"C"+tt+` = vec4(0.);
                }

                xR`+qe+"C"+tt+" = xTexelR"+qe+"C"+tt+`;
              `,tt+1<Ne)){var ht=V%2==0?Ut(Ee):Ee;Ee%2==0&&V%2==1||Ee%2!=0&&V%2!=1?($e+=`
                  xCOffset = xC + `+V%2+" + "+ht+`;

                  if(xR >= 0 && xR < `+g+` &&
                    xCOffset >= 0 && xCOffset < `+S+`) {
                    xTexelR`+qe+"C"+(tt+2)+` = getX(batch, xR, xCOffset, d1);
                  }
                `,Ee>1&&($e+=`
                    xCOffset -= 2;
                    if(xR >= 0 && xR < `+g+` &&
                      xCOffset >= 0 && xCOffset < `+S+`) {
                      xTexelR`+qe+"C"+tt+` = getX(batch, xR, xCOffset, d1);
                    } else {
                      xTexelR`+qe+"C"+tt+` = vec4(0.);
                    }
                  `),$e+=`
                  xR`+qe+"C"+(tt+1)+` = vec4(
                    xTexelR`+qe+"C"+tt+".zw, xTexelR"+qe+"C"+(tt+2)+`.xy);
                `):$e+=`
                  xCOffset = xC + `+ht+`;

                  if(xR >= 0 && xR < `+g+` &&
                    xCOffset >= 0 && xCOffset < `+S+`) {
                    xTexelR`+qe+"C"+(tt+2)+` = getX(batch, xR, xCOffset, d1);
                  }

                  xR`+qe+"C"+(tt+1)+" = xTexelR"+qe+"C"+(tt+2)+`;
                `}}else tt<Ne&&($e+=`
              if(xR >= 0 && xR < `+g+`) {
            `,V%2==1?($e+=`
                xCOffset = xC + 1 - `+ae+`;
                if(xCOffset >= 0 && xCOffset < `+S+`) {
                  xTexelR`+qe+"C"+tt+` = getX(batch, xR, xCOffset, d1);
                } else {
                  xTexelR`+qe+"C"+tt+` = vec4(0.);
                }

                if(xC + 1 >= 0 && xC + 1 < `+S+`) {
                  xTexelR`+qe+"C"+(tt+2)+` = getX(batch, xR, xC + 1, d1);
                } else {
                  xTexelR`+qe+"C"+(tt+2)+` = vec4(0.);
                }

                xR`+qe+"C"+tt+` = vec4(
                  xTexelR`+qe+"C"+tt+".zw, xTexelR"+qe+"C"+(tt+2)+`.zw);
              `,tt+1<Ne&&($e+=`
                  vec4 final = vec4(0.);
                  xCOffset = xC + 1 + `+ae+`;
                  if(xCOffset >= 0 && xCOffset < `+S+`) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xR`+qe+"C"+(tt+1)+" = vec4(xTexelR"+qe+"C"+(tt+2)+`.xy, final.xy);
                `)):($e+=`
                if(xC >= 0 && xC < `+S+`) {
                  xTexelR`+qe+"C"+tt+` = getX(batch, xR, xC, d1);
                } else {
                  xTexelR`+qe+"C"+tt+` = vec4(0.);
                }

                xCOffset = xC + `+ae+`;
                if(xCOffset >= 0 && xCOffset < `+S+`) {
                  xTexelR`+qe+"C"+(tt+2)+` = getX(batch, xR, xCOffset, d1);
                } else {
                  xTexelR`+qe+"C"+(tt+2)+` = vec4(0.);
                }

                xR`+qe+"C"+tt+` = vec4(
                  xTexelR`+qe+"C"+tt+".xy, xTexelR"+qe+"C"+(tt+2)+`.xy);
              `,tt+1<Ne&&($e+=`
                  xR`+qe+"C"+(tt+1)+` = vec4(
                    xTexelR`+qe+"C"+tt+".zw, xTexelR"+qe+"C"+(tt+2)+`.zw);
                `)),$e+="}");tt<Ne&&($e+=`
            vec4 wTexelR`+qe+"C"+tt+" = getW("+qe+", "+tt+`, d1, q);
            wR`+qe+"C"+tt+" = vec4(wTexelR"+qe+"C"+tt+".xz, wTexelR"+qe+"C"+tt+`.xz);
          `,tt+1<Ne&&($e+=`
              vec4 wTexelR`+qe+"C"+(tt+1)+" = getW("+qe+", "+(tt+1)+`, d1, q);
              wR`+qe+"C"+(tt+1)+` =
                vec4(wTexelR`+qe+"C"+(tt+1)+".xz, wTexelR"+qe+"C"+(tt+1)+".xz);"))}for(qe=0;qe<Se;qe++)for(tt=0;tt<Ne;tt++)$e+="dotProd += xR"+qe+"C"+tt+" * wR"+qe+"C"+tt+";";var vt="",Ct="";o&&(vt=l?`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          `+o+`
        }`:`vec4 activation(vec4 x) {
          `+o+`
        }`,Ct="result = activation(result);");var Vt=c?"result += getBiasAtOutCoords();":"";c&&this.variableNames.push("bias"),l&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+vt+`

      const ivec2 strides = ivec2(`+ne+", "+ae+`);
      const ivec2 pads = ivec2(`+j+", "+V+`);

      void main() {

        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2;
        int q = 0;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        vec4 dotProd = vec4(0.);

        `+$e+`

        vec4 result = dotProd;
        `+Vt+`
        `+Ct+`
        setOutput(result);
      }
    `};function vg(p,c){if(p===1)return""+c;if(p===2)return c+".y";if(p===3)return c+".z";if(p===4)return c+".w";throw Error("Cumulative sum for rank "+p+" is not yet supported")}var yg=function(){function p(c,o,l){this.variableNames=["x"],this.outputShape=[],this.outputShape=c,this.blockSize=o,this.dataFormat=l,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = `+this.getHeightCoordString()+`;
      int w = `+this.getWidthCoordString()+`;
      int d = `+this.getDepthCoordString()+`;

      int in_h = h / `+o+`;
      int offset_h = imod(h, `+o+`);
      int in_w = w / `+o+`;
      int offset_w = imod(w, `+o+`);
      int offset_d = (offset_h * `+o+` + offset_w) *
        `+this.getOutputDepthSize()+`;
      int in_d = d + offset_d;

      float result = `+this.getInputSamplingString()+`;
      setOutput(result);
    }
  `}return p.prototype.getHeightCoordString=function(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"},p.prototype.getWidthCoordString=function(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"},p.prototype.getDepthCoordString=function(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"},p.prototype.getOutputDepthSize=function(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]},p.prototype.getInputSamplingString=function(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"},p}(),Cm=function(p,c,o){this.variableNames=["real","imag"];var l=c[1];this.outputShape=c;var g=o?"2.0 * "+Math.PI:"-2.0 * "+Math.PI,S=o?l+".0":"1.0";this.userCode=`
      const float exponentMultiplier = `+g+`;

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        `+p+`
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(`+l+`);
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < `+l+`; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / `+S+`;
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `},Om=function(){function p(c,o){this.outputShape=[],this.variableNames=["x"],this.outputShape=c,this.userCode=`
      uniform float value;
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}return p.prototype.getCustomSetupFunc=function(c){var o=this;return function(l,g){o.valueLoc==null&&(o.valueLoc=l.getUniformLocationNoThrow(g,"value")),l.gl.uniform1f(o.valueLoc,c)}},p}();function bg(p,c){var o=go();return eo(p,c,o.version+`
    precision highp float;
    `+o.attribute+` vec3 clipSpacePos;
    `+o.attribute+` vec2 uv;
    `+o.varyingVs+` vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`)}function Am(p,c){return bc(p,c,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function xg(p,c){return Bu(p,c,new Uint16Array([0,1,2,2,1,3]))}function Pf(p,c,o,l,g,S,j){Dd(o,l);var V=xc(p,c),ne=p.TEXTURE_2D;return jn(p,c,function(){return p.bindTexture(ne,V)}),jn(p,c,function(){return p.texParameteri(ne,p.TEXTURE_WRAP_S,p.CLAMP_TO_EDGE)}),jn(p,c,function(){return p.texParameteri(ne,p.TEXTURE_WRAP_T,p.CLAMP_TO_EDGE)}),jn(p,c,function(){return p.texParameteri(ne,p.TEXTURE_MIN_FILTER,p.NEAREST)}),jn(p,c,function(){return p.texParameteri(ne,p.TEXTURE_MAG_FILTER,p.NEAREST)}),jn(p,c,function(){return p.texImage2D(ne,0,g,o,l,0,S,j,null)}),jn(p,c,function(){return p.bindTexture(p.TEXTURE_2D,null)}),V}function Yd(p,c,o,l,g){var S=Zi(o,l);return Pf(p,c,S[0],S[1],g.internalFormatFloat,g.textureFormatFloat,p.FLOAT)}function wg(p,c,o,l,g){var S=Zi(o,l);return Pf(p,c,S[0],S[1],g.internalFormatHalfFloat,g.textureFormatFloat,g.textureTypeHalfFloat)}function kg(p,c,o,l,g){var S=Zi(o,l);return Pf(p,c,S[0],S[1],p.RGBA,p.RGBA,p.UNSIGNED_BYTE)}function Eg(p,c,o,l,g){var S=qr(o,l);return Pf(p,c,S[0],S[1],g.internalFormatPackedFloat,p.RGBA,p.FLOAT)}function _c(p,c,o,l,g){var S=qr(o,l);return Pf(p,c,S[0],S[1],g.internalFormatPackedHalfFloat,p.RGBA,g.textureTypeHalfFloat)}function Lf(p,c,o,l){return jn(p,c,function(){return p.bindBuffer(p.ARRAY_BUFFER,l)}),vf(p,c,o,"clipSpacePos",l,3,20,0)&&vf(p,c,o,"uv",l,2,20,12)}function Jd(p,c,o,l,g,S,j){var V,ne,ae;jn(p,c,function(){return p.bindTexture(p.TEXTURE_2D,o)}),S instanceof Uint8Array?(V=new Uint8Array(l*g*4),ne=p.UNSIGNED_BYTE,ae=p.RGBA):(V=new Float32Array(l*g*4),ne=p.FLOAT,ae=j.internalFormatPackedFloat),V.set(S),jn(p,c,function(){return p.texImage2D(p.TEXTURE_2D,0,ae,l,g,0,p.RGBA,ne,V)}),jn(p,c,function(){return p.bindTexture(p.TEXTURE_2D,null)})}function Sm(p,c,o,l){jn(p,c,function(){return p.bindTexture(p.TEXTURE_2D,o)}),l.data instanceof Uint8Array?jn(p,c,function(){return p.texImage2D(p.TEXTURE_2D,0,p.RGBA,l.width,l.height,0,p.RGBA,p.UNSIGNED_BYTE,l.data)}):jn(p,c,function(){return p.texImage2D(p.TEXTURE_2D,0,p.RGBA,p.RGBA,p.UNSIGNED_BYTE,l)}),jn(p,c,function(){return p.bindTexture(p.TEXTURE_2D,null)})}function _m(p,c,o,l,g){var S=p.createBuffer();jn(p,c,function(){return p.bindBuffer(p.PIXEL_PACK_BUFFER,S)});var j=16*o*l;return jn(p,c,function(){return p.bufferData(p.PIXEL_PACK_BUFFER,j,p.STREAM_READ)}),jn(p,c,function(){return p.readPixels(0,0,l,o,p.RGBA,p.FLOAT,0)}),jn(p,c,function(){return p.bindBuffer(p.PIXEL_PACK_BUFFER,null)}),S}function T0(p,c,o){var l=p,g=new Float32Array(o);return l.bindBuffer(l.PIXEL_PACK_BUFFER,c),l.getBufferSubData(l.PIXEL_PACK_BUFFER,0,g),l.bindBuffer(l.PIXEL_PACK_BUFFER,null),g}function Dm(p,c,o,l,g){var S=Zi(o,l),j=S[0],V=S[1],ne=new Uint8Array(o*l*4);return jn(p,c,function(){return p.readPixels(0,0,j,V,g.downloadTextureFormat,p.UNSIGNED_BYTE,ne)}),new Float32Array(ne.buffer)}function qh(p,c,o,l,g,S,j,V){var ne=p,ae=new Float32Array(function(me,Ee){var Se=qr(S,j);return Se[0]*Se[1]*4}());return ne.bindBuffer(ne.PIXEL_PACK_BUFFER,c),ne.getBufferSubData(ne.PIXEL_PACK_BUFFER,0,ae),ne.bindBuffer(ne.PIXEL_PACK_BUFFER,null),ae}function zf(p,c,o,l){var g=new Float32Array(o*l*4);return jn(p,c,function(){return p.readPixels(0,0,l,o,p.RGBA,p.FLOAT,g)}),g}var Dc=Object.freeze({createVertexShader:bg,createVertexBuffer:Am,createIndexBuffer:xg,createFloat32MatrixTexture:Yd,createFloat16MatrixTexture:wg,createUnsignedBytesMatrixTexture:kg,createPackedMatrixTexture:Eg,createFloat16PackedMatrixTexture:_c,bindVertexProgramAttributeStreams:Lf,uploadDenseMatrixToTexture:Jd,uploadPixelDataToTexture:Sm,createBufferFromOutputTexture:_m,downloadFloat32MatrixFromBuffer:T0,downloadByteEncodedFloatMatrixFromOutputTexture:Dm,downloadPackedMatrixFromBuffer:qh,downloadMatrixFromPackedOutputTexture:zf}),Tm=function(){function p(c){this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];var o=P().getNumber("WEBGL_VERSION");c!=null?(this.gl=c,fo(o,c)):this.gl=ui(o);var l="WEBGL_color_buffer_float";if(P().getNumber("WEBGL_VERSION")===1){if(this.textureFloatExtension=yo(this.gl,this.debug,"OES_texture_float"),fa(this.gl,"OES_texture_half_float"))this.textureHalfFloatExtension=yo(this.gl,this.debug,"OES_texture_half_float");else if(P().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(l),fa(this.gl,"EXT_color_buffer_half_float"))this.colorBufferHalfFloatExtension=yo(this.gl,this.debug,"EXT_color_buffer_half_float");else if(P().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(l="EXT_color_buffer_float",fa(this.gl,l))this.colorBufferFloatExtension=this.gl.getExtension(l);else{if(!fa(this.gl,"EXT_color_buffer_half_float"))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension("EXT_color_buffer_half_float")}this.vertexBuffer=Am(this.gl,this.debug),this.indexBuffer=xg(this.gl,this.debug),this.framebuffer=as(this.gl,this.debug),this.textureConfig=jr(this.gl,this.textureHalfFloatExtension)}return Object.defineProperty(p.prototype,"debug",{get:function(){return P().getBool("DEBUG")},enumerable:!0,configurable:!0}),p.prototype.dispose=function(){var c=this;if(!this.disposed){this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var o=this.gl;jn(o,this.debug,function(){return o.finish()}),jn(o,this.debug,function(){return o.bindFramebuffer(o.FRAMEBUFFER,null)}),jn(o,this.debug,function(){return o.deleteFramebuffer(c.framebuffer)}),jn(o,this.debug,function(){return o.bindBuffer(o.ARRAY_BUFFER,null)}),jn(o,this.debug,function(){return o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,null)}),jn(o,this.debug,function(){return o.deleteBuffer(c.indexBuffer)}),this.disposed=!0}},p.prototype.createFloat32MatrixTexture=function(c,o){return this.throwIfDisposed(),Yd(this.gl,this.debug,c,o,this.textureConfig)},p.prototype.createFloat16MatrixTexture=function(c,o){return this.throwIfDisposed(),wg(this.gl,this.debug,c,o,this.textureConfig)},p.prototype.createUnsignedBytesMatrixTexture=function(c,o){return this.throwIfDisposed(),kg(this.gl,this.debug,c,o,this.textureConfig)},p.prototype.uploadPixelDataToTexture=function(c,o){this.throwIfDisposed(),Sm(this.gl,this.debug,c,o)},p.prototype.uploadDenseMatrixToTexture=function(c,o,l,g){this.throwIfDisposed(),Jd(this.gl,this.debug,c,o,l,g,this.textureConfig)},p.prototype.createFloat16PackedMatrixTexture=function(c,o){return this.throwIfDisposed(),_c(this.gl,this.debug,c,o,this.textureConfig)},p.prototype.createPackedMatrixTexture=function(c,o){return this.throwIfDisposed(),Eg(this.gl,this.debug,c,o,this.textureConfig)},p.prototype.deleteMatrixTexture=function(c){var o=this;this.throwIfDisposed(),this.outputTexture===c&&(El(this.gl,this.debug,this.framebuffer),this.outputTexture=null),jn(this.gl,this.debug,function(){return o.gl.deleteTexture(c)})},p.prototype.downloadByteEncodedFloatMatrixFromOutputTexture=function(c,o,l){var g=this;return this.downloadMatrixDriver(c,function(){return Dm(g.gl,g.debug,o,l,g.textureConfig)})},p.prototype.downloadPackedMatrixFromBuffer=function(c,o,l,g,S,j){return qh(this.gl,c,0,0,0,S,j,this.textureConfig)},p.prototype.downloadFloat32MatrixFromBuffer=function(c,o){return T0(this.gl,c,o)},p.prototype.createBufferFromTexture=function(c,o,l){this.bindTextureToFrameBuffer(c);var g=_m(this.gl,this.debug,o,l,this.textureConfig);return this.unbindTextureToFrameBuffer(),g},p.prototype.createAndWaitForFence=function(){var c=this.createFence(this.gl);return this.pollFence(c)},p.prototype.createFence=function(c){var o,l,g=this;if(P().getBool("WEBGL_FENCE_API_ENABLED")){var S=c,j=S.fenceSync(S.SYNC_GPU_COMMANDS_COMPLETE,0);c.flush(),l=function(){var V=S.clientWaitSync(j,0,0);return V===S.ALREADY_SIGNALED||V===S.CONDITION_SATISFIED},o=j}else P().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(o=this.beginQuery(),this.endQuery(),l=function(){return g.isQueryAvailable(o,P().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):l=function(){return!0};return{query:o,isFencePassed:l}},p.prototype.downloadMatrixFromPackedTexture=function(c,o,l){var g=this;return this.downloadMatrixDriver(c,function(){return zf(g.gl,g.debug,o,l)})},p.prototype.createProgram=function(c){this.throwIfDisposed();var o=this.gl,l=bo(o,this.debug,c),g=bg(o,this.debug),S=qi(o,this.debug);return jn(o,this.debug,function(){return o.attachShader(S,g)}),jn(o,this.debug,function(){return o.attachShader(S,l)}),ec(o,this.debug,S),this.debug&&bu(o,this.debug,S),this.vertexAttrsAreBound||(this.setProgram(S),this.vertexAttrsAreBound=Lf(o,this.debug,this.program,this.vertexBuffer)),S},p.prototype.deleteProgram=function(c){var o=this;this.throwIfDisposed(),c===this.program&&(this.program=null),c!=null&&jn(this.gl,this.debug,function(){return o.gl.deleteProgram(c)})},p.prototype.setProgram=function(c){var o=this;this.throwIfDisposed(),this.program=c,this.program!=null&&this.debug&&bu(this.gl,this.debug,this.program),jn(this.gl,this.debug,function(){return o.gl.useProgram(c)})},p.prototype.getUniformLocation=function(c,o,l){return l===void 0&&(l=!0),this.throwIfDisposed(),l?Pu(this.gl,this.debug,c,o):yf(this.gl,c,o)},p.prototype.getAttributeLocation=function(c,o){var l=this;return this.throwIfDisposed(),jn(this.gl,this.debug,function(){return l.gl.getAttribLocation(c,o)})},p.prototype.getUniformLocationNoThrow=function(c,o){return this.throwIfDisposed(),this.gl.getUniformLocation(c,o)},p.prototype.setInputMatrixTexture=function(c,o,l){this.throwIfDisposed(),this.throwIfNoProgram(),Ch(this.gl,this.debug,this.program,c,o,l)},p.prototype.setOutputMatrixTexture=function(c,o,l){this.setOutputMatrixTextureDriver(c,l,o)},p.prototype.setOutputPackedMatrixTexture=function(c,o,l){this.throwIfDisposed();var g=qr(o,l),S=g[0],j=g[1];this.setOutputMatrixTextureDriver(c,S,j)},p.prototype.setOutputMatrixWriteRegion=function(c,o,l,g){this.setOutputMatrixWriteRegionDriver(l,c,g,o)},p.prototype.setOutputPackedMatrixWriteRegion=function(c,o,l,g){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")},p.prototype.debugValidate=function(){this.program!=null&&bu(this.gl,this.debug,this.program),Fa(this.gl)},p.prototype.executeProgram=function(){this.throwIfDisposed(),this.throwIfNoProgram();var c=this.gl;this.debug&&this.debugValidate(),jn(c,this.debug,function(){return c.drawElements(c.TRIANGLES,6,c.UNSIGNED_SHORT,0)})},p.prototype.blockUntilAllProgramsCompleted=function(){var c=this;this.throwIfDisposed(),jn(this.gl,this.debug,function(){return c.gl.finish()})},p.prototype.getQueryTimerExtension=function(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=yo(this.gl,this.debug,P().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension},p.prototype.getQueryTimerExtensionWebGL2=function(){return this.getQueryTimerExtension()},p.prototype.getQueryTimerExtensionWebGL1=function(){return this.getQueryTimerExtension()},p.prototype.beginQuery=function(){if(P().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){var c=this.gl,o=this.getQueryTimerExtensionWebGL2(),l=c.createQuery();return c.beginQuery(o.TIME_ELAPSED_EXT,l),l}var g=this.getQueryTimerExtensionWebGL1(),S=g.createQueryEXT();return g.beginQueryEXT(g.TIME_ELAPSED_EXT,S),S},p.prototype.endQuery=function(){if(P().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")!==2){var c=this.getQueryTimerExtensionWebGL1();c.endQueryEXT(c.TIME_ELAPSED_EXT)}else{var o=this.gl,l=this.getQueryTimerExtensionWebGL2();o.endQuery(l.TIME_ELAPSED_EXT)}},p.prototype.waitForQueryAndGetTime=function(c){return R(this,void 0,void 0,function(){var o=this;return W(this,function(l){switch(l.label){case 0:return[4,Dt(function(){return o.disposed||o.isQueryAvailable(c,P().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))})];case 1:return l.sent(),[2,this.getQueryTime(c,P().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))]}})})},p.prototype.getQueryTime=function(c,o){if(o===0)return null;if(o===2){var l=this.gl;return l.getQueryParameter(c,l.QUERY_RESULT)/1e6}var g=this.getQueryTimerExtensionWebGL1();return g.getQueryObjectEXT(c,g.QUERY_RESULT_EXT)/1e6},p.prototype.isQueryAvailable=function(c,o){if(o===0)return!0;if(o===2){var l=this.gl,g=this.getQueryTimerExtensionWebGL2(),S=l.getQueryParameter(c,l.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(g.GPU_DISJOINT_EXT)),S&&!this.disjoint}return S=(g=this.getQueryTimerExtensionWebGL1()).getQueryObjectEXT(c,g.QUERY_RESULT_AVAILABLE_EXT),this.disjoint==null&&(this.disjoint=this.gl.getParameter(g.GPU_DISJOINT_EXT)),S&&!this.disjoint},p.prototype.pollFence=function(c){var o=this;return new Promise(function(l){o.addItemToPoll(function(){return c.isFencePassed()},function(){return l()})})},p.prototype.pollItems=function(){for(var c=function(l){for(var g=0;g<l.length&&l[g]();++g);return g-1}(this.itemsToPoll.map(function(l){return l.isDoneFn})),o=0;o<=c;++o)(0,this.itemsToPoll[o].resolveFn)();this.itemsToPoll=this.itemsToPoll.slice(c+1)},p.prototype.addItemToPoll=function(c,o){var l=this;this.itemsToPoll.push({isDoneFn:c,resolveFn:o}),this.itemsToPoll.length>1||Dt(function(){return l.pollItems(),l.itemsToPoll.length===0})},p.prototype.bindTextureToFrameBuffer=function(c){this.throwIfDisposed(),wc(this.gl,this.debug,c,this.framebuffer),this.debug&&Fa(this.gl)},p.prototype.unbindTextureToFrameBuffer=function(){this.outputTexture!=null?(wc(this.gl,this.debug,this.outputTexture,this.framebuffer),this.debug&&Fa(this.gl)):El(this.gl,this.debug,this.framebuffer)},p.prototype.downloadMatrixDriver=function(c,o){this.bindTextureToFrameBuffer(c);var l=o();return this.unbindTextureToFrameBuffer(),l},p.prototype.setOutputMatrixTextureDriver=function(c,o,l){this.throwIfDisposed();var g=this.gl;wc(g,this.debug,c,this.framebuffer),this.debug&&Fa(g),this.outputTexture=c,jn(g,this.debug,function(){return g.viewport(0,0,o,l)}),jn(g,this.debug,function(){return g.scissor(0,0,o,l)})},p.prototype.setOutputMatrixWriteRegionDriver=function(c,o,l,g){var S=this;this.throwIfDisposed(),jn(this.gl,this.debug,function(){return S.gl.scissor(c,o,l,g)})},p.prototype.throwIfDisposed=function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")},p.prototype.throwIfNoProgram=function(){if(this.program==null)throw new Error("No GPU program is currently set.")},p}();function Nm(p,c){if(p.length!==c.length)throw Error("Binary was compiled with "+p.length+" inputs, but was executed with "+c.length+" inputs");p.forEach(function(o,l){var g=o.logicalShape,S=c[l],j=S.shape;if(!ln(g,j))throw Error("Binary was compiled with different shapes than the current args. Shapes "+g+" and "+j+" must match");if(!o.isUniform||!S.isUniform){var V=o.texShape,ne=S.isUniform?null:S.texData.texShape;if(!ln(V,ne))throw Error("Binary was compiled with different texture shapes than the current args. Shape "+V+" and "+ne+" must match")}})}var _u=function(p,c,o,l,g,S,j){o===void 0&&(o=!1),l===void 0&&(l=!1),g===void 0&&(g=!1),S===void 0&&(S=null),j===void 0&&(j=!1),this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=c;var V=o?p[1]:p[2],ne=Math.ceil(V/2),ae=o?"i * 2, rc.y":"rc.y, i * 2",me=l?"rc.z, i * 2":"i * 2, rc.z",Ee=o?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],Se=l?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],Ne="",ze="";S&&(Ne=j?`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          `+S+`
        }`:`vec4 activation(vec4 x) {
          `+S+`
        }`,ze="result = activation(result);");var $e=g?"result += getBiasAtOutCoords();":"";g&&this.variableNames.push("bias"),j&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+Ne+`

      const float sharedDimension = `+ne+`.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        for (int i = 0; i < `+ne+`; i++) {
          vec4 a = getMatrixA(rc.x, `+ae+`);
          vec4 b = getMatrixB(rc.x, `+me+`);

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (`+Ee[0]+" * "+Se[0]+`);
          result += (`+Ee[1]+" * "+Se[1]+`);
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        `+$e+`

        `+ze+`

        setOutput(result);
      }
    `},Fm=function(){function p(c,o,l){this.variableNames=["probs"],this.outputShape=[c,l],this.userCode=`
      uniform float seed;

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < `+(o-1)+`; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(`+(o-1)+`));
      }
    `}return p.prototype.getCustomSetupFunc=function(c){var o=this;return function(l,g){o.seedLoc==null&&(o.seedLoc=l.getUniformLocation(g,"seed")),l.gl.uniform1f(o.seedLoc,c)}},p}(),Hh=function(p,c,o,l,g){if(l===void 0&&(l=!1),g===void 0&&(g=!1),this.variableNames=["x"],c==="avg"&&o)throw new Error("Cannot compute positions for average pool.");var S=p.filterWidth,j=p.strideHeight,V=p.strideWidth,ne=p.dilationHeight,ae=p.dilationWidth,me=p.effectiveFilterHeight,Ee=p.effectiveFilterWidth,Se=p.padInfo.top,Ne=p.padInfo.left;this.outputShape=p.outShape;var ze=c==="avg",$e="((batch  * "+p.inHeight+" + xR) * "+p.inWidth+" + xC) * "+p.inChannels+" + d",qe="(xR * "+p.inWidth+" + xC) * "+p.inChannels+" + d",tt="0.0";if(ze||(tt="-1.0 / 1e-20"),o)this.userCode=`
        const ivec2 strides = ivec2(`+j+", "+V+`);
        const ivec2 pads = ivec2(`+Se+", "+Ne+`);

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < `+me+`;
              wR += `+ne+`) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= `+p.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+Ee+`;
                wC += `+ae+`) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= `+p.inWidth+`) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value >= currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = `+(l?g?$e:qe:"wR * "+Ee+" + wC")+`;
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;else{var lt=c+"("+c+"("+c+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";c==="avg"&&(lt="avgValue / count");var ht=4*Math.floor(S/4),vt=S%4,Ct=`
      if (`+ze+`) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = max(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(`+j+", "+V+`);
      const ivec2 pads = ivec2(`+Se+", "+Ne+`);
      const float initializationValue = `+tt+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= `+p.inWidth+`) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(`+tt+`);
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < `+me+`;
            wR += `+ne+`) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= `+p.inHeight+`) {
            continue;
          }

          for (int wC = 0; wC < `+ht+`; wC += 4) {
            int xC = xCCorner + wC * `+ae+`;

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+ae+`, d),
              getValue(batch, xR, xC + 2 * `+ae+`, d),
              getValue(batch, xR, xC + 3 * `+ae+`, d)
            );

            `+Ct+`
          }

          int xC = xCCorner + `+ht+`;
          if (`+(vt===1)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            `+Ct+`
          } else if (`+(vt===2)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+ae+`, d),
              initializationValue,
              initializationValue
            );

            `+Ct+`
          } else if (`+(vt===3)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+ae+`, d),
              getValue(batch, xR, xC + 2 * `+ae+`, d),
              initializationValue
            );

            `+Ct+`
          }
        }
        setOutput(`+lt+`);
      }
    `}},Qd=function(p,c,o,l,g){if(l===void 0&&(l=!1),g===void 0&&(g=!1),this.variableNames=["x"],c==="avg"&&o)throw new Error("Cannot compute positions for average pool.");var S=p.filterWidth,j=p.strideDepth,V=p.strideHeight,ne=p.strideWidth,ae=p.dilationDepth,me=p.dilationHeight,Ee=p.dilationWidth,Se=p.effectiveFilterDepth,Ne=p.effectiveFilterHeight,ze=p.effectiveFilterWidth,$e=p.padInfo.front,qe=p.padInfo.top,tt=p.padInfo.left;this.outputShape=p.outShape;var lt=c==="avg",ht="0.0";if(lt||(ht="-1.0 / 1e-20"),o)this.userCode=`
        const ivec3 strides =
            ivec3(`+j+", "+V+", "+ne+`);
        const ivec3 pads = ivec3(`+$e+", "+qe+", "+tt+`);

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < `+Se+`;
              wD += `+ae+`) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= `+p.inDepth+`) {
              continue;
            }

            for (int wR = 0; wR < `+Ne+`;
                wR += `+me+`) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= `+p.inHeight+`) {
                continue;
              }

              for (int wC = 0; wC < `+ze+`;
                  wC += `+Ee+`) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= `+p.inWidth+`) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value >= currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition = `+(l?g?"(((batch * "+p.inDepth+" + xD) * "+p.inHeight+" + xR) * "+p.inWidth+" + xC) * "+p.inChannels+" + ch":"((xD * "+p.inHeight+" + xR) * "+p.inWidth+" + xC) * "+p.inChannels+" + ch":"wD * "+Ne+" * "+ze+` +
                      wR * `+ze+" + wC")+`;
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;else{var vt=c+"("+c+"("+c+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";c==="avg"&&(vt="avgValue / count");var Ct=4*Math.floor(S/4),Vt=S%4,Yt=`
      if (`+lt+`) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = max(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec3 strides =
        ivec3(`+j+", "+V+", "+ne+`);
      const ivec3 pads = ivec3(`+$e+", "+qe+", "+tt+`);
      const float initializationValue = `+ht+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= `+p.inWidth+`) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(`+ht+`);
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < `+Se+`;
            wD += `+ae+`) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= `+p.inDepth+`) {
            continue;
          }

          for (int wR = 0; wR < `+Ne+`;
            wR += `+me+`) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= `+p.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+Ct+`; wC += 4) {
              int xC = xCCorner + wC * `+Ee+`;

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+Ee+`, ch),
                getValue(batch, xD, xR, xC + 2 * `+Ee+`, ch),
                getValue(batch, xD, xR, xC + 3 * `+Ee+`, ch)
              );

              `+Yt+`
            }

            int xC = xCCorner + `+Ct+`;
            if (`+(Vt===1)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              `+Yt+`
            } else if (`+(Vt===2)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+Ee+`, ch),
                initializationValue,
                initializationValue
              );

              `+Yt+`
            } else if (`+(Vt===3)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+Ee+`, ch),
                getValue(batch, xD, xR, xC + 2 * `+Ee+`, ch),
                initializationValue
              );

              `+Yt+`
            }
          }
          setOutput(`+vt+`);
        }
      }
    `}},N0=function(p,c,o,l,g,S,j){this.variableNames=["updates","indices","defaultValue"],this.outputShape=S;var V=Io(g.length),ne=Io(S.length),ae="";o===1?ae="i":o===2&&(ae="i, j");var me="getIndices("+ae+")",Ee="";l===1?Ee="i":l===2&&(Ee="i, coords[1]");var Se="getUpdates("+Ee+")",Ne=c>1?"strides[j]":"strides";this.userCode=`
        `+V+" strides = "+V+"("+g+`);

        void main() {
          `+ne+` coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < `+p+`; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < `+c+`; j++) {
              int index = round(`+me+`);
              flattenedIndex += index * `+Ne+`;
            }
            if (flattenedIndex == coords[0]) {
              sum += `+Se+`;
              found = true;
            }
          }
          setOutput(mix(getDefaultValue(), sum, float(found)));
        }
      `},Zd=function(){function p(c){this.variableNames=["source"],this.outputShape=c,this.rank=c.length;var o,l=Io(this.rank),g="uniform int start["+this.rank+"];",S=function(j){if(j===1)return"sourceLoc";if(j<=6)return Tc.slice(0,j).map(function(V){return"sourceLoc."+V}).join(",");throw Error("Slicing for rank "+j+" is not yet supported")}(this.rank);o=`
        `+l+` sourceLoc;
        `+l+` coords = getOutputCoords();
        `+c.map(function(j,V){return"sourceLoc."+Tc[V]+" = start["+V+"] + coords."+Tc[V]+";"}).join(`
`)+`
      `,this.userCode=`
      `+g+`
      void main() {
        `+o+`
        setOutput(getSource(`+S+`));
      }
    `}return p.prototype.getCustomSetupFunc=function(c){var o=this;if(c.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+c.length+")");return function(l,g){o.startLoc==null&&(o.startLoc=l.getUniformLocationNoThrow(g,"start"),o.startLoc==null)||l.gl.uniform1iv(o.startLoc,c)}},p}(),Tc=["x","y","z","w","u","v"],ep=function(){function p(c){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=c,this.rank=c.length;var o=Io(this.rank),l=da("coords",this.rank),g=da("sourceLoc",this.rank),S=this.rank===1?"sourceLoc":"vec2("+g.slice(-2).join()+")",j="getChannel(getSource("+g.join()+"), "+S+")",V=`
      result.x = `+j+`;
      if (++`+l[this.rank-1]+" < "+c[this.rank-1]+`) {
        ++`+g[this.rank-1]+`;
        result.y = `+j+`;
        --`+g[this.rank-1]+`;
      }
    `,ne=this.rank===1?"":`
      --`+l[this.rank-1]+`;
      if (++`+l[this.rank-2]+" < "+c[this.rank-2]+`) {
        ++`+g[this.rank-2]+`;
        result.z = `+j+`;
        if (++`+l[this.rank-1]+" < "+c[this.rank-1]+`) {
          ++`+g[this.rank-1]+`;
          result.w = `+j+`;
        }
      }
    `,ae=this.rank<=4?`sourceLoc = coords +
            `+o+"("+c.map(function(me,Ee){return"start["+Ee+"]"}).join()+");":c.map(function(me,Ee){return g[Ee]+" = "+l[Ee]+" + start["+Ee+"];"}).join(`
`);this.userCode=`
      uniform int start[`+this.rank+`];
      void main() {
        `+o+` coords = getOutputCoords();
        `+o+` sourceLoc;
        `+ae+`
        vec4 result = vec4(0.);
        `+V+`
        `+ne+`
        setOutput(result);
      }
    `}return p.prototype.getCustomSetupFunc=function(c){var o=this;if(c.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+c.length+")");return function(l,g){o.startLoc==null&&(o.startLoc=l.getUniformLocationNoThrow(g,"start"),o.startLoc==null)||l.gl.uniform1iv(o.startLoc,c)}},p}(),Cg=function(){function p(c){this.gpgpu=c,this.numUsedTextures=0,this.numFreeTextures=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return p.prototype.acquireTexture=function(c,o,l){var g,S=Og(o,l),j=Im(c,S,l);if(j in this.freeTextures||(this.freeTextures[j]=[]),j in this.usedTextures||(this.usedTextures[j]=[]),this.freeTextures[j].length>0){this.numFreeTextures--,this.numUsedTextures++,this.log();var V=this.freeTextures[j].shift();return this.usedTextures[j].push(V),V}return this.numUsedTextures++,this.log(),S===zr.PACKED_2X2_FLOAT32?g=this.gpgpu.createPackedMatrixTexture(c[0],c[1]):S===zr.PACKED_2X2_FLOAT16?g=this.gpgpu.createFloat16PackedMatrixTexture(c[0],c[1]):S===zr.UNPACKED_FLOAT32?g=this.gpgpu.createFloat32MatrixTexture(c[0],c[1]):S===zr.UNPACKED_FLOAT16?g=this.gpgpu.createFloat16MatrixTexture(c[0],c[1]):S===zr.PACKED_4X1_UNSIGNED_BYTE&&(g=this.gpgpu.createUnsignedBytesMatrixTexture(c[0],c[1])),this.usedTextures[j].push(g),g},p.prototype.releaseTexture=function(c,o,l,g){if(this.freeTextures!=null){var S=Im(o,Og(l,g),g);S in this.freeTextures||(this.freeTextures[S]=[]),this.freeTextures[S].push(c),this.numFreeTextures++,this.numUsedTextures--;var j=this.usedTextures[S],V=j.indexOf(c);if(V<0)throw new Error("Cannot release a texture that was never provided by this texture manager");j.splice(V,1),this.log()}},p.prototype.log=function(){if(this.logEnabled){var c=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",this.numFreeTextures+" / "+this.numUsedTextures,"("+c+")")}},p.prototype.getNumUsedTextures=function(){return this.numUsedTextures},p.prototype.getNumFreeTextures=function(){return this.numFreeTextures},p.prototype.dispose=function(){var c=this;if(this.freeTextures!=null){for(var o in this.freeTextures)this.freeTextures[o].forEach(function(l){c.gpgpu.deleteMatrixTexture(l)});for(var o in this.usedTextures)this.usedTextures[o].forEach(function(g){c.gpgpu.deleteMatrixTexture(g)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0}},p}();function Og(p,c){if(p===ir.UPLOAD)return zr.PACKED_2X2_FLOAT32;if(p===ir.RENDER||p==null)return function(o){return P().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?o?zr.PACKED_2X2_FLOAT32:zr.UNPACKED_FLOAT32:o?zr.PACKED_2X2_FLOAT16:zr.UNPACKED_FLOAT16}(c);if(p===ir.DOWNLOAD||p===ir.PIXELS)return zr.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type "+p)}function Im(p,c,o){return p[0]+"_"+p[1]+"_"+c+"_"+o}var bv=1.7580993408473768,xv=1.0507009873554805,uo=function(p,c){this.variableNames=["A"],this.outputShape=p,this.userCode=`
      float unaryOperation(float x) {
        `+c+`
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `},Ag="if (isnan(x)) return x;",Sg="return x;",Bp="return abs(x);",_g=Ag+`
  return (x < 0.0) ? 0.0 : x;
`,tp=Ag+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,nl="return (x >= 0.0) ? x : (exp(x) - 1.0);",rl="return -x;",Dg="return ceil(x);",Tg="return floor(x);",$h="return exp(x);",Uf="return exp(x) - 1.0;",Gh="return x;",wv="return x;",Pp=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,il=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,Du=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,zl=function(p,c){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=p,this.userCode=`
      vec4 unaryOperation(vec4 x) {
        `+c+`
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `},Ul={};function Wl(p,c){if(c===void 0&&(c=!1),p==="linear")return c?wv:Sg;if(p==="relu")return c?Pp:_g;if(p==="elu")return c?Du:nl;if(p==="relu6")return c?il:tp;if(p==="prelu")return c?es:Sc;throw new Error("Activation "+p+" has not been implemented for the WebGL backend.")}var Ng=600,Lp=function(p){function c(o){var l,g=p.call(this)||this;if(g.pendingRead=new WeakMap,g.pendingDisposal=new WeakSet,g.dataRefCount=new WeakMap,g.numBytesInGPU=0,g.uploadWaitMs=0,g.downloadWaitMs=0,g.warnedAboutMemory=!1,g.pendingDeletes=0,g.disposed=!1,!P().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");if(o==null){var S=ui(P().getNumber("WEBGL_VERSION"));g.binaryCache=((l=P().getNumber("WEBGL_VERSION"))in Ul||(Ul[l]={}),Ul[l]),g.gpgpu=new Tm(S),g.canvas=S.canvas,g.gpgpuCreatedLocally=!0}else g.gpgpu=o,g.binaryCache={},g.gpgpuCreatedLocally=!1,g.canvas=o.gl.canvas;return g.textureManager=new Cg(g.gpgpu),g.numMBBeforeWarning=P().global.screen==null?1024:P().global.screen.height*P().global.screen.width*window.devicePixelRatio*Ng/1024/1024,g.texData=new Tt(g,Ue),g}return J(c,p),c.prototype.numDataIds=function(){return this.texData.numDataIds()+(this.cpuBackend?this.cpuBackend.numDataIds():0)-this.pendingDeletes},c.prototype.write=function(o,l,g){if(P().getBool("DEBUG")&&this.checkNumericalProblems(o),g==="complex64"&&o!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");var S={};return this.texData.set(S,{shape:l,dtype:g,values:o,usage:ir.UPLOAD}),S},c.prototype.move=function(o,l,g,S){if(P().getBool("DEBUG")&&this.checkNumericalProblems(l),S==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(o,{shape:g,dtype:S,values:l,usage:ir.UPLOAD})},c.prototype.readSync=function(o){var l=this.texData.get(o),g=l.values,S=l.dtype,j=l.complexTensors,V=l.slice,ne=l.shape,ae=l.isPacked;if(V!=null){var me;me=ae?new zl(ne,Gh):new uo(ne,Gh);var Ee=this.runWebGLProgram(me,[{dataId:o,shape:ne,dtype:S}],S),Se=this.readSync(Ee.dataId);return this.disposeData(Ee.dataId),Se}if(g!=null)return this.convertAndCacheOnCPU(o);if(S==="string")return g;var Ne,ze,$e=this.activeTimers!=null;return $e&&(Ne=Zt()),ze=S==="complex64"?ni(j.real.dataSync(),j.imag.dataSync()):this.getValuesFromTexture(o),$e&&(this.downloadWaitMs+=Zt()-Ne),this.convertAndCacheOnCPU(o,ze)},c.prototype.read=function(o){return R(this,void 0,void 0,function(){var l,g,S,j,V,ne,ae,me,Ee,Se,Ne,ze,$e,qe,tt,lt,ht,vt,Ct,Vt,Yt,qt;return W(this,function($t){switch($t.label){case 0:if(this.pendingRead.has(o))return l=this.pendingRead.get(o),[2,new Promise(function(yn){return l.push(yn)})];if(g=this.texData.get(o),S=g.values,j=g.shape,V=g.slice,ne=g.dtype,ae=g.complexTensors,me=g.isPacked,V!=null)return Ee=void 0,Ee=me?new zl(j,Gh):new uo(j,Gh),Se=this.runWebGLProgram(Ee,[{dataId:o,shape:j,dtype:ne}],ne),Ne=this.read(Se.dataId),this.disposeData(Se.dataId),[2,Ne];if(S!=null)return[2,this.convertAndCacheOnCPU(o)];if(!P().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&P().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");return ze=null,ne!=="complex64"&&P().get("WEBGL_BUFFER_SUPPORTED")&&($e=this.decode(o),qe=this.texData.get($e.dataId),ze=(qt=this.gpgpu).createBufferFromTexture.apply(qt,[qe.texture].concat(Ti(j)))),this.pendingRead.set(o,[]),ne==="complex64"?[3,2]:[4,this.gpgpu.createAndWaitForFence()];case 1:$t.sent(),$t.label=2;case 2:return ne!=="complex64"?[3,4]:[4,Promise.all([ae.real.data(),ae.imag.data()])];case 3:return lt=$t.sent(),ht=lt[0],vt=lt[1],tt=ni(ht,vt),[3,5];case 4:ze==null?tt=this.getValuesFromTexture(o):(Ct=Ye(j),tt=this.gpgpu.downloadFloat32MatrixFromBuffer(ze,Ct)),$t.label=5;case 5:return $e!=null&&this.disposeData($e.dataId),Vt=this.convertAndCacheOnCPU(o,tt),Yt=this.pendingRead.get(o),this.pendingRead.delete(o),Yt.forEach(function(yn){return yn(Vt)}),this.pendingDisposal.has(o)&&(this.pendingDisposal.delete(o),this.disposeData(o),this.pendingDeletes--),[2,Vt]}})})},c.prototype.checkNumericalProblems=function(o){if(o!=null)for(var l=0;l<o.length;l++){var g=o[l];if(!Rr(g))throw P().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error("The value "+g+" cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'"):Error("The value "+g+" cannot be represented on this device.")}},c.prototype.getValuesFromTexture=function(o){var l,g=this.texData.get(o),S=g.shape,j=g.dtype,V=g.isPacked,ne=Ye(S);if(P().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){var ae=this.decode(o),me=this.texData.get(ae.dataId),Ee=(l=this.gpgpu).downloadMatrixFromPackedTexture.apply(l,[me.texture].concat(Ti(S))).subarray(0,ne);return this.disposeData(ae.dataId),Ee}var Se=P().getBool("WEBGL_PACK")&&V===!0,Ne=Se?nc(S):S,ze=Se?new function(lt){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=ir.DOWNLOAD;var ht=go();this.outputShape=lt,this.userCode=`
      `+fs+`

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        `+ht.output+` = encode_float(x);
      }
    `}(Ne):new function(lt){this.variableNames=["A"],this.outTexUsage=ir.DOWNLOAD;var ht=go();this.outputShape=lt,this.userCode=`
      `+fs+`

      void main() {
        float x = getAAtOutCoords();
        `+ht.output+` = encode_float(x);
      }
    `}(Ne),$e=this.runWebGLProgram(ze,[{shape:Ne,dtype:j,dataId:o}],"float32"),qe=this.texData.get($e.dataId),tt=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(qe.texture,qe.texShape[0],qe.texShape[1]).subarray(0,ne);return this.disposeData($e.dataId),tt},c.prototype.time=function(o){return R(this,void 0,void 0,function(){var l,g,S,j,V,ne,ae;return W(this,function(me){switch(me.label){case 0:return l=this.activeTimers,g=[],S=!1,this.programTimersStack==null?(this.programTimersStack=g,S=!0):this.activeTimers.push(g),this.activeTimers=g,o(),j=jt(this.activeTimers.map(function(Ee){return Ee.query})).filter(function(Ee){return Ee!=null}),V=jt(this.activeTimers.map(function(Ee){return Ee.name})).filter(function(Ee){return Ee!=null}),this.activeTimers=l,S&&(this.programTimersStack=null),ne={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null},P().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[4,Promise.all(j)]:[3,2];case 1:return ae=me.sent(),ne.kernelMs=Xt(ae),ne.getExtraProfileInfo=function(){return ae.map(function(Ee,Se){return{name:V[Se],ms:Ee}}).map(function(Ee){return Ee.name+": "+Ee.ms}).join(", ")},[3,3];case 2:ne.kernelMs={error:"WebGL query timers are not supported in this environment."},me.label=3;case 3:return this.uploadWaitMs=0,this.downloadWaitMs=0,[2,ne]}})})},c.prototype.memory=function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU}},c.prototype.startTimer=function(){return P().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:Zt(),endMs:null}},c.prototype.endTimer=function(o){return P().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),o):(o.endMs=Zt(),o)},c.prototype.getQueryTime=function(o){return R(this,void 0,void 0,function(){var l;return W(this,function(g){return P().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[2,this.gpgpu.waitForQueryAndGetTime(o)]:[2,(l=o).endMs-l.startMs]})})},c.prototype.disposeData=function(o){if(!this.pendingDisposal.has(o)){if(this.pendingRead.has(o))return this.pendingDisposal.add(o),void this.pendingDeletes++;if(this.texData.has(o)){this.releaseGPUData(o);var l=this.texData.get(o).complexTensors;l!=null&&(l.real.dispose(),l.imag.dispose()),this.texData.delete(o)}}},c.prototype.releaseGPUData=function(o){var l=this.texData.get(o),g=l.texture,S=l.dtype,j=l.texShape,V=l.usage,ne=l.isPacked,ae=l.slice,me=ae&&ae.origDataId||o,Ee=this.dataRefCount.get(me);Ee>1?this.dataRefCount.set(me,Ee-1):(this.dataRefCount.delete(me),g!=null&&(this.numBytesInGPU-=this.computeBytes(j,S),this.textureManager.releaseTexture(g,j,V,ne)));var Se=this.texData.get(o);Se.texture=null,Se.texShape=null,Se.isPacked=!1,Se.slice=null},c.prototype.getTexture=function(o){return this.uploadToGPU(o),this.texData.get(o).texture},c.prototype.getDataInfo=function(o){return this.texData.get(o)},c.prototype.getCPUBackend=function(){return P().getBool("WEBGL_CPU_FORWARD")?(this.cpuBackend==null&&(this.cpuBackend=Ue.findBackend("cpu")),this.cpuBackend):null},c.prototype.shouldExecuteOnCPU=function(o,l){var g=this;return l===void 0&&(l=128),this.getCPUBackend()!=null&&o.every(function(S){return g.texData.get(S.dataId).texture==null&&Ye(S.shape)<l})},c.prototype.getGPGPUContext=function(){return this.gpgpu},c.prototype.complex=function(o,l){var g=this.makeOutput(o.shape,"complex64");return this.texData.get(g.dataId).complexTensors={real:Ue.keep(o.clone()),imag:Ue.keep(l.clone())},g},c.prototype.real=function(o){return this.texData.get(o.dataId).complexTensors.real.clone()},c.prototype.imag=function(o){return this.texData.get(o.dataId).complexTensors.imag.clone()},c.prototype.slice=function(o,l,g){if(this.shouldExecuteOnCPU([o]))return this.cpuBackend.slice(o,l,g);if(Ye(g)===0)return ko([],g,o.dtype);var S=this.texData.get(o.dataId).isPacked,j=Vh(o.shape,l,g);if(S||!j){var V=P().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new ep(g):new Zd(g),ne=V.getCustomSetupFunc(l);return this.compileAndRun(V,[o],null,ne)}return this.uploadToGPU(o.dataId),this.shallowSlice(o,l,g)},c.prototype.shallowSlice=function(o,l,g){var S=this.texData.get(o.dataId),j=this.makeOutput(g,o.dtype),V=this.texData.get(j.dataId);Object.assign(V,S),V.shape=g,V.dtype=o.dtype;var ne=Mf(l,o.strides);S.slice&&(ne+=S.slice.flatOffset),V.slice={flatOffset:ne,origDataId:S.slice&&S.slice.origDataId||o.dataId};var ae=this.dataRefCount.get(V.slice.origDataId)||1;return this.dataRefCount.set(V.slice.origDataId,ae+1),j},c.prototype.stridedSlice=function(o,l,g,S){if(this.shouldExecuteOnCPU([o]))return this.cpuBackend.stridedSlice(o,l,g,S);var j=Ou(l,g,S);if(j.some(function(ne){return ne===0}))return ko([],j);var V=new function(ne,ae,me){this.variableNames=["x"],this.outputShape=me;var Ee=me.length,Se=Io(me.length),Ne=Io(me.length),ze="";if(Ee===1)ze="coords * strides + begin";else{var $e=0;ze=me.map(function(qe,tt){return $e++,me.length===1?"coords * strides["+tt+"] + begin["+tt+"]":"coords["+($e-1)+"] * strides["+tt+"] + begin["+tt+"]"}).join(",")}this.userCode=`
      `+Se+" begin = "+Se+"("+ne+`);
      `+Se+" strides = "+Se+"("+ae+`);

      void main() {
        `+Ne+` coords = getOutputCoords();
        setOutput(getX(`+ze+`));
      }
    `}(l,S,j);return this.compileAndRun(V,[o])},c.prototype.reverse=function(o,l){var g=P().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new function(S,j){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;var V=S.length;if(V>4)throw new Error("WebGL backend: Reverse of rank-"+V+" tensor is not yet supported");this.outputShape=S;var ne=da("rc",V),ae=ne[V-1]+" + 1 < "+this.outputShape[V-1],me=ne[V-2]+" + 1 < "+this.outputShape[V-2],Ee=Io(V);function Se(Ne){var ze=S.map(function($e,qe){return function(tt,lt){return j.indexOf(tt)!==-1&&S[tt]!==1?S[tt]+" - "+lt[tt]+" - 1":""+lt[tt]}(qe,Ne)});return"getChannel(getX("+ze.join(",")+"), vec2("+ze.slice(-2).join(",")+"))"}this.userCode=V===1?`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(`+S[0]+` - rc - 1),
            `+S[0]+` - rc - 1);
          if(`+ae+`){
              result.g = getChannel(getX(`+S[0]+` - (rc  + 1) - 1),
                `+S[0]+` - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `:`
        void main() {
          `+Ee+` rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = `+Se(ne.slice())+`;
          if(`+ae+`){
            result.g = `+function(Ne){return Ne[V-1]="("+Ne[V-1]+" + 1)",Se(Ne)}(ne.slice())+`;
          }
          if(`+me+`) {
            result.b = `+function(Ne){return Ne[V-2]="("+Ne[V-2]+" + 1)",Se(Ne)}(ne.slice())+`;
            if(`+ae+`) {
              result.a = `+function(Ne){return Ne[V-1]="("+Ne[V-1]+" + 1)",Ne[V-2]="("+Ne[V-2]+" + 1)",Se(Ne)}(ne.slice())+`;
            }
          }
          setOutput(result);
        }
    `}(o.shape,l):new function(S,j){this.variableNames=["x"];var V=S.length;if(V>4)throw new Error("WebGL backend: Reverse of rank-"+V+" tensor is not yet supported");if(this.outputShape=S,V!==1){var ne=S.map(function(me,Ee){return function(Se){return j.indexOf(Se)!==-1&&S[Se]!==1?S[Se]+" - coords["+Se+"] - 1":"coords["+Se+"]"}(Ee)}).join(","),ae=Io(V);this.userCode=`
      void main() {
        `+ae+` coords = getOutputCoords();
        setOutput(getX(`+ne+`));
      }
    `}else this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(`+S[0]+` - coord - 1));
        }
      `}(o.shape,l);return this.compileAndRun(g,[o])},c.prototype.concat=function(o,l){if(o[0].dtype==="complex64"){var g=o.map(function(Ne){return ca(Ne)}),S=o.map(function(Ne){return Ua(Ne)});return ho(this.concat(g,l),this.concat(S,l))}if(this.shouldExecuteOnCPU(o))return this.cpuBackend.concat(o,l);if(o.length===1)return o[0];if(o.length>P().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){var j=Math.floor(o.length/2),V=this.concat(o.slice(0,j),l),ne=this.concat(o.slice(j),l);return this.concat([V,ne],l)}if(P().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&o[0].rank>1){var ae=new function(Ne,ze){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=tu(Ne,ze);var $e=this.outputShape,qe=$e.length,tt=Io(qe),lt=da("coords",qe),ht=["x","y","z","w","u","v"].slice(0,qe);this.variableNames=Ne.map(function(Xn,er){return"T"+er});var vt=new Array(Ne.length-1);vt[0]=Ne[0][ze];for(var Ct=1;Ct<vt.length;Ct++)vt[Ct]=vt[Ct-1]+Ne[Ct][ze];var Vt=ht[ze],Yt=ht.slice(-2),qt=ht.join(),$t="if ("+Vt+" < "+vt[0]+`) {
        return getChannel(
            getT0(`+qt+"), vec2("+Yt.join()+`));
        }`;for(Ct=1;Ct<vt.length;Ct++){var yn=vt[Ct-1];$t+=`
        if (`+Vt+" < "+vt[Ct]+"  && "+Vt+" >= "+vt[Ct-1]+`) {
          return getChannel(
            getT`+Ct+"("+ci(ht,Vt,yn)+`),
            vec2(`+ci(Yt,Vt,yn)+`));
        }`}var On=vt.length,Cn=vt[vt.length-1];$t+=`
        return getChannel(
          getT`+On+"("+ci(ht,Vt,Cn)+`),
          vec2(`+ci(Yt,Vt,Cn)+"));",this.userCode=`
      float getValue(`+ht.map(function(Xn){return"int "+Xn})+`) {
        `+$t+`
      }

      void main() {
        `+tt+` coords = getOutputCoords();
        vec4 result = vec4(getValue(`+lt+`), 0., 0., 0.);

        `+lt[qe-1]+" = "+lt[qe-1]+` + 1;
        if (`+lt[qe-1]+" < "+$e[qe-1]+`) {
          result.g = getValue(`+lt+`);
        }

        `+lt[qe-2]+" = "+lt[qe-2]+` + 1;
        if (`+lt[qe-2]+" < "+$e[qe-2]+`) {
          result.a = getValue(`+lt+`);
        }

        `+lt[qe-1]+" = "+lt[qe-1]+` - 1;
        if (`+lt[qe-2]+" < "+$e[qe-2]+` &&
            `+lt[qe-1]+" < "+$e[qe-1]+`) {
          result.b = getValue(`+lt+`);
        }
        setOutput(result);
      }
    `}(o.map(function(Ne){return Ne.shape}),l);return this.compileAndRun(ae,o)}var me=tu(o.map(function(Ne){return Ne.shape}),l),Ee=o.map(function(Ne){return Ne.as2D(-1,Ye(Ne.shape.slice(l)))}),Se=new function(Ne){this.outputShape=[],this.outputShape=tu(Ne,1),this.variableNames=Ne.map(function(vt,Ct){return"T"+Ct});var ze=new Array(Ne.length-1);ze[0]=Ne[0][1];for(var $e=1;$e<ze.length;$e++)ze[$e]=ze[$e-1]+Ne[$e][1];var qe=["if (yC < "+ze[0]+") setOutput(getT0(yR, yC));"];for($e=1;$e<ze.length;$e++){var tt=ze[$e-1];qe.push("else if (yC < "+ze[$e]+") setOutput(getT"+$e+"(yR, yC-"+tt+"));")}var lt=ze.length,ht=ze[ze.length-1];qe.push("else setOutput(getT"+lt+"(yR, yC-"+ht+"));"),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        `+qe.join(`
        `)+`
      }
    `}(Ee.map(function(Ne){return Ne.shape}));return this.compileAndRun(Se,Ee).reshape(me)},c.prototype.neg=function(o){if(this.shouldExecuteOnCPU([o]))return this.cpuBackend.neg(o);if(P().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(o,rl,o.dtype);var l=new uo(o.shape,rl);return this.compileAndRun(l,[o])},c.prototype.batchMatMul=function(o,l,g,S){var j=g?o.shape[2]:o.shape[1],V=S?l.shape[1]:l.shape[2],ne=g?o.shape[1]:o.shape[2],ae=o.shape[0];if((j===1||V===1)&&ne>1e3){g&&(o=ft(o,[0,2,1])),S&&(l=ft(l,[0,2,1]));var me=V===1?o:o.as3D(ae,ne,1),Ee=V===1?2:1,Se=V===1?l.as3D(ae,1,ne):l;return this.multiply(me,Se).sum(Ee,!0)}var Ne=fn(o.dtype,l.dtype),ze=new _u(o.shape,[ae,j,V],g,S);return this.compileAndRun(ze,[o,l],Ne)},c.prototype.fusedBatchMatMul=function(o){var l=o.a,g=o.b,S=o.transposeA,j=o.transposeB,V=o.bias,ne=o.activation,ae=o.preluActivationWeights,me=S?l.shape[2]:l.shape[1],Ee=j?g.shape[1]:g.shape[2],Se=l.shape[0],Ne=fn(l.dtype,g.dtype),ze=V!=null,$e=ae!=null,qe=ne?Wl(ne,!0):null,tt=new _u(l.shape,[Se,me,Ee],S,j,ze,qe,$e),lt=[l,g];return V&&lt.push(V),ae&&lt.push(ae),this.compileAndRun(tt,lt,Ne)},c.prototype.multiply=function(o,l){if(o.dtype==="complex64"){var g=this.texData.get(o.dataId),S=this.texData.get(l.dataId),j=new oo("return areal * breal - aimag * bimag;",o.shape,l.shape),V=new oo("return areal * bimag + aimag * breal;",o.shape,l.shape),ne=[this.makeComplexComponentTensorInfo(o,g.complexTensors.real),this.makeComplexComponentTensorInfo(o,g.complexTensors.imag),this.makeComplexComponentTensorInfo(l,S.complexTensors.real),this.makeComplexComponentTensorInfo(l,S.complexTensors.imag)],ae=this.compileAndRun(j,ne),me=this.compileAndRun(V,ne),Ee=this.complex(ae,me);return ae.dispose(),me.dispose(),Ee}if(this.shouldExecuteOnCPU([o,l]))return this.cpuBackend.multiply(o,l);if(P().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(o,l,Xs,o.dtype);var Se=new Uo(Xs,o.shape,l.shape);return this.compileAndRun(Se,[o,l],o.dtype)},c.prototype.batchNormalization=function(o,l,g,S,j,V){var ne=[o,l,g],ae=null;V!=null&&(ae=V.shape,ne.push(V));var me=null;if(j!=null&&(me=j.shape,ne.push(j)),P().getBool("WEBGL_PACK_NORMALIZATION")){var Ee=new function(Ne,ze,$e,qe,tt,lt){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],Mi(Ne,ze),Mi(Ne,$e);var ht="vec4(0.0)";qe!=null&&(Mi(Ne,qe),this.variableNames.push("offset"),ht="getOffsetAtOutCoords()");var vt="vec4(1.0)";tt!=null&&(Mi(Ne,tt),this.variableNames.push("scale"),vt="getScaleAtOutCoords()"),this.outputShape=Ne,this.userCode=`
      void main() {
        vec4 offset = `+ht+`;
        vec4 scale = `+vt+`;

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(`+lt+`));

        setOutput((x - mean) * inv + offset);
      }
    `}(o.shape,l.shape,g.shape,ae,me,S);return this.compileAndRun(Ee,ne)}var Se=new function(Ne,ze,$e,qe,tt,lt){this.outputShape=[],this.variableNames=["x","mean","variance"],Mi(Ne,ze),Mi(Ne,$e);var ht="0.0";qe!=null&&(Mi(Ne,qe),this.variableNames.push("offset"),ht="getOffsetAtOutCoords()");var vt="1.0";tt!=null&&(Mi(Ne,tt),this.variableNames.push("scale"),vt="getScaleAtOutCoords()"),this.outputShape=Ne,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = `+ht+`;
        float scale = `+vt+`;
        float inv = scale * inversesqrt(variance + float(`+lt+`));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `}(o.shape,l.shape,g.shape,ae,me,S);return this.compileAndRun(Se,ne)},c.prototype.localResponseNormalization4D=function(o,l,g,S,j){var V=P().getBool("WEBGL_PACK_NORMALIZATION")?new function(ne,ae,me,Ee,Se){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;var Ne,ze=ae,$e=ne[3]-1;this.outputShape=ne;var qe="float("+me+") + float("+Ee+") * sum";Ne=Se===.5?"inversesqrt("+qe+")":Se===1?"1.0/("+qe+")":"exp(log("+qe+") * float(-"+Se+"));",this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < `+this.outputShape[3]+`;
        bool hasNextRow = c < `+this.outputShape[2]+`;

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - `+ze+`;
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - `+ze+"; j <= "+ze+`; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(`+$e+`));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * `+Ne+`;
        setOutput(result);
      }
    `}(o.shape,l,g,S,j):new function(ne,ae,me,Ee,Se){this.variableNames=["x"],this.outputShape=[];var Ne,ze=ae,$e=ne[3]-1;this.outputShape=ne;var qe="float("+me+") + float("+Ee+") * sum";Ne=Se===.5?"inversesqrt("+qe+")":Se===1?"1.0/("+qe+")":"exp(log("+qe+") * float(-"+Se+"));",this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -`+ze+"; j <= "+ze+`; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  `+$e+`) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * `+Ne+`;
        setOutput(val);
      }
    `}(o.shape,l,g,S,j);return this.compileAndRun(V,[o])},c.prototype.LRNGrad=function(o,l,g,S,j,V,ne){var ae=new function(me,Ee,Se,Ne,ze){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=me,this.depth=me[3],this.depthRadius=Ee,this.bias=Se,this.alpha=Ne,this.beta=ze,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < `+this.depth+`; ++d) {
          int depthBegin = int(max(0.0, float(d - `+Ee+`)));
          int depthEnd = int(min(float(`+this.depth+`),
              float(d + `+Ee+` + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = `+this.depth+`;

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(`+Ne+") * norm + float("+Se+`);

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(`+Ne+`)
                * float(`+ze+`)
                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * `+ze+`);
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `}(l.shape,S,j,V,ne);return this.compileAndRun(ae,[l,g,o])},c.prototype.tile=function(o,l){if(o.dtype==="string"){var g=this.readSync(o.dataId).map(function(j){return hr(j)});return ha(bi(o.shape,o.dtype,g),l)}var S=new function(j,V){this.variableNames=["A"];for(var ne=new Array(j.length),ae=0;ae<ne.length;ae++)ne[ae]=j[ae]*V[ae];this.outputShape=ne,this.rank=ne.length;var me=Io(this.rank),Ee=function(Se){var Ne=Se.length;if(Ne>5)throw Error("Tile for rank "+Ne+" is not yet supported");if(Ne===1)return"imod(resRC, "+Se[0]+")";for(var ze=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],$e=[],qe=0;qe<Se.length;qe++)$e.push("imod("+ze[qe]+", "+Se[qe]+")");return $e.join()}(j);this.userCode=`
      void main() {
        `+me+` resRC = getOutputCoords();
        setOutput(getA(`+Ee+`));
      }
    `}(o.shape,l);return this.compileAndRun(S,[o])},c.prototype.pad=function(o,l,g){var S=P().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new function(j,V,ne){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=V.map(function(Vt,Yt){return Vt[0]+j[Yt]+Vt[1]});for(var ae=j.length,me=Io(ae),Ee=V.map(function(Vt){return Vt[0]}).join(","),Se=V.map(function(Vt,Yt){return Vt[0]+j[Yt]}).join(","),Ne=da("rc",ae),ze=da("source",ae),$e=Ne[ae-1]+" < "+this.outputShape[ae-1],qe=ae===1?"source":"vec2("+ze.slice(-2).join()+")",tt=[me+" rc = outputLoc;",Ne[ae-1]+` += 1;
       if(`+$e+`) {
      `,ae===1?"":`}
       rc = outputLoc;
       `+Ne[ae-2]+` += 1;
       if(`+Ne[ae-2]+" < "+this.outputShape[ae-2]+") {",ae===1?"":"  "+Ne[ae-1]+` += 1;
         if(`+$e+") {"],lt=ae===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",ht="",vt=0,Ct=ae===1?2:4;vt<Ct;vt++)ht+=`
        `+tt[vt]+`
        if (`+lt+`) {
          result[`+vt+"] = float("+ne+`);
        } else {
          `+me+` source = rc - start;
          result[`+vt+"] = getChannel(getX("+ze.join()+"), "+qe+`);
        }
      `;ht+=ae===1?"} ":"}}",this.userCode=`
      const `+me+" start = "+me+"("+Ee+`);
      const `+me+" end = "+me+"("+Se+`);

      void main() {
        `+me+` outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        `+ht+`
        setOutput(result);
      }
    `}(o.shape,l,g):new function(j,V,ne){this.variableNames=["x"],this.outputShape=V.map(function(ze,$e){return ze[0]+j[$e]+ze[1]});var ae=j.length,me=Io(ae),Ee=V.map(function(ze){return ze[0]}).join(","),Se=V.map(function(ze,$e){return ze[0]+j[$e]}).join(","),Ne=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,ae);this.userCode=ae!==1?`
      `+me+" start = "+me+"("+Ee+`);
      `+me+" end = "+me+"("+Se+`);

      void main() {
        `+me+` outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(float(`+ne+`));
        } else {
          `+me+` coords = outC - start;
          setOutput(getX(`+Ne+`));
        }
      }
    `:`
        int start = `+Ee+`;
        int end = `+Se+`;

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(float(`+ne+`));
          } else {
            setOutput(getX(outC - start));
          }
        }
      `}(o.shape,l,g);return this.compileAndRun(S,[o])},c.prototype.gather=function(o,l,g){if(this.shouldExecuteOnCPU([o,l]))return this.cpuBackend.gather(o,l,g);var S=new function(j,V,ne){this.variableNames=["A","indices"];var ae=j.slice();ae[ne]=V,this.outputShape=ae,this.rank=ae.length;var me=Io(this.rank),Ee=function(Se,Ne){var ze=Se.length;if(ze>4)throw Error("Gather for rank "+ze+" is not yet supported");if(ze===1)return"int(getIndices(resRC))";for(var $e=["resRC.x","resRC.y","resRC.z","resRC.w"],qe=[],tt=0;tt<Se.length;tt++)tt===Ne?qe.push("int(getIndices("+$e[tt]+"))"):qe.push(""+$e[tt]);return qe.join()}(j,ne);this.userCode=`
      void main() {
        `+me+` resRC = getOutputCoords();
        setOutput(getA(`+Ee+`));
      }
    `}(o.shape,l.size,g);return this.compileAndRun(S,[o,l])},c.prototype.batchToSpaceND=function(o,l,g){ke(o.rank<=4,function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"});var S=l.reduce(function(Ee,Se){return Ee*Se}),j=Sf(o.shape,l,S),V=Gc(j.length,l.length),ne=Sl(o.shape,l,S),ae=Wd(g,l.length),me=Mp(ne,g,l.length);return ft(o.reshape(j),V).reshape(ne).slice(ae,me)},c.prototype.spaceToBatchND=function(o,l,g){ke(o.rank<=4,function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"});var S=l.reduce(function(Se,Ne){return Se*Ne}),j=[[0,0]];j.push.apply(j,g);for(var V=1+l.length;V<o.shape.length;++V)j.push([0,0]);var ne=o.pad(j),ae=Sf(ne.shape,l,S,!1),me=Gc(ae.length,l.length,!1),Ee=Sl(ne.shape,l,S,!1);return ft(ne.reshape(ae),me).reshape(Ee)},c.prototype.reduce=function(o,l,g){var S=o.shape[0],j=o.shape[1],V=new function(ae,me){this.variableNames=["x"];var Ee=ae.windowSize,Se=ae.batchSize,Ne=ae.inSize,ze=Math.ceil(Ne/Ee);this.outputShape=[Se,ze];var $e="0.0",qe="";me==="prod"?$e="1.0":me==="min"?($e="1.0 / 1e-20",qe="min"):me==="max"&&($e="-1.0 / 1e-20",qe="max");var tt=me+"("+me+"("+me+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";me==="sum"?tt="sumValue":me==="prod"?tt="prodValue":me==="all"?tt="allValue":me==="any"&&(tt="anyValue");var lt=4*Math.floor(Ee/4),ht=Ee%4,vt=`
      if (`+(me==="sum")+`) {
        sumValue += dot(values, ones);
      } else if (`+(me==="prod")+`) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = `+qe+`(values, minMaxValue);
      }
    `,Ct="vec4";me==="all"?($e="1.0",vt=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,Ct="bvec4"):me==="any"&&($e="0.0",vt=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,Ct="bvec4");var Vt="";Ne%Ee>0&&(Vt=`
        if (inIdx < 0 || inIdx >= `+Ne+`) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = `+$e+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        `+Vt+`
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `+Ee+`;

        vec4 minMaxValue = vec4(`+$e+`);
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < `+lt+`; i += 4) {
          int inIdx = inOffset + i;
          `+Ct+" values = "+Ct+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          `+vt+`
        }

        int inIdx = inOffset + `+lt+`;
        if (`+(ht===1)+`) {
          `+Ct+" values = "+Ct+`(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          `+vt+`
        } else if (`+(ht===2)+`) {
          `+Ct+" values = "+Ct+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          `+vt+`
        } else if (`+(ht===3)+`) {
          `+Ct+" values = "+Ct+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          `+vt+`
        }
        setOutput(`+tt+`);
      }
    `}({windowSize:uc(j),inSize:j,batchSize:S},l),ne=this.compileAndRun(V,[o],g);return ne.shape[1]===1?ne:this.reduce(ne,l,g)},c.prototype.argReduce=function(o,l,g){g===void 0&&(g=null);var S=o.shape[0],j=o.shape[1];g!=null&&(S=g.shape[0],j=g.shape[1]);var V=new function(me,Ee,Se){this.variableNames=["A"];var Ne=me.windowSize,ze=me.batchSize,$e=me.inSize,qe=Math.ceil($e/Ne);Se||this.variableNames.push("bestIndicesA"),this.outputShape=[ze,qe];var tt=Ee==="max"?">":"<",lt=Se?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `+Ne+`;

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < `+Ne+`; i++) {
          int inIdx = `+lt+`;
          float candidate = getA(batch, inIdx);
          if (candidate `+tt+` bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `}({windowSize:uc(j),inSize:j,batchSize:S},l,g==null),ne=[o];g!=null&&ne.push(g);var ae=this.compileAndRun(V,ne,"int32");return ae.shape[1]===1?ae:this.argReduce(o,l,ae)},c.prototype.argReducePacked=function(o,l,g){g===void 0&&(g=null);var S=g!=null?g.shape:o.shape,j=new function(ae,me,Ee,Se){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,ke(ae.length>2,function(){return"Packed arg"+(Ee.charAt(0).toUpperCase()+Ee.slice(1))+" supports only inputs with rank above 2."});var Ne=ae[ae.length-1],ze=Math.ceil(Ne/me);this.outputShape=ae.slice(0,-1),ze>1&&this.outputShape.push(ze),Se||this.variableNames.push("bestIndicesA");var $e,qe,tt=this.outputShape,lt=tt.length,ht=Io(lt),vt=da("coords",lt);if(ze===1){var Ct=Io(qe=lt+1);$e=`
        `+Ct+" sourceLocR = "+Ct+"("+vt.join()+`, 0);
        ++`+vt[lt-1]+`;
        `+Ct+" sourceLocG = "+Ct+"("+vt.join()+`, 0);
        ++`+vt[lt-2]+`;
        `+Ct+" sourceLocA = "+Ct+"("+vt.join()+`, 0);
        --`+vt[lt-1]+`;
        `+Ct+" sourceLocB = "+Ct+"("+vt.join()+`, 0);
        --`+vt[lt-2]+";"}else qe=lt,$e=`
        `+ht+` sourceLocR = coords;
        ++`+vt[lt-1]+`;
        `+ht+` sourceLocG = coords;
        ++`+vt[lt-2]+`;
        `+ht+` sourceLocA = coords;
        --`+vt[lt-1]+`;
        `+ht+` sourceLocB = coords;
        --`+vt[lt-2]+";";var Vt=["x","y","z","w","u","v"].slice(0,qe),Yt="."+Vt[qe-1],qt=Vt.map(function(ur){return"int "+ur}),$t=da("sourceLocR",qe-1).concat("inIdx.r"),yn=da("sourceLocG",qe-1).concat("inIdx.g"),On=da("sourceLocB",qe-1).concat("inIdx.b"),Cn=da("sourceLocA",qe-1).concat("inIdx.a"),Xn=Ee==="max"?"greaterThan":"lessThan",er=Se?"":`
          inIdx = round(vec4(getBestIndicesAChannel(`+$t.join()+`),
                             getBestIndicesAChannel(`+yn.join()+`),
                             getBestIndicesAChannel(`+On.join()+`),
                             getBestIndicesAChannel(`+Cn.join()+")));",sr=`vec4(
            getAChannel(`+$t.join()+`),
            hasNextCol ? getAChannel(`+yn.join()+`) : 0.,
            hasNextRow ? getAChannel(`+On.join()+`) : 0.,
            hasNextRow && hasNextCol ? getAChannel(`+Cn.join()+") : 0.)",lr=Se?"":`
      float getBestIndicesAChannel(`+qt.join()+`) {
        return getChannel(getBestIndicesA(`+Vt.join()+`),
                                          vec2(`+Vt.slice(-2).join()+`));
      }`;this.userCode=`
      float getAChannel(`+qt.join()+`) {
        return getChannel(getA(`+Vt.join()+`),
                               vec2(`+Vt.slice(-2).join()+`));
      }
      `+lr+`
      void main() {
        `+ht+` coords = getOutputCoords();
        bool hasNextCol = `+vt[lt-1]+" < "+(tt[lt-1]-1)+`;
        bool hasNextRow = `+vt[lt-2]+" < "+(tt[lt-2]-1)+`;
        `+$e+`
        ivec4 srcIdx = ivec4(sourceLocR`+Yt+", sourceLocG"+Yt+`,
          sourceLocB`+Yt+", sourceLocA"+Yt+") * "+me+`;
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = `+sr+`;

        for (int i = 0; i < `+me+`; i++) {
          inIdx = srcIdx;
          `+er+`
          vec4 candidate = `+sr+`;
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(`+Xn+`(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `}(S,uc(S[S.length-1]),l,g==null),V=g==null?[o]:[o,g],ne=this.compileAndRun(j,V,"int32");return ne.rank===o.rank?this.argReducePacked(o,l,ne):ne},c.prototype.sum=function(o,l){Ko("sum",l,o.rank);var g=So(o.shape,l),S=g[0],j=Ye(g[1]),V=o.as2D(-1,j),ne=Jn(o.dtype);return this.reduce(V,"sum",ne).reshape(S)},c.prototype.prod=function(o,l){if(this.shouldExecuteOnCPU([o]))return this.cpuBackend.prod(o,l);var g=So(o.shape,l),S=g[0],j=Ye(g[1]),V=o.as2D(-1,j),ne=Jn(o.dtype);return this.reduce(V,"prod",ne).reshape(S)},c.prototype.unsortedSegmentSum=function(o,l,g){var S=0,j=Oa([S],o.rank),V=o;j!=null&&(V=ft(o,j),S=Aa(1,o.rank)[0]);var ne=function(Ne,ze,$e){for(var qe=[],tt=Ne.length,lt=0;lt<tt;lt++)lt!==ze?qe.push(Ne[lt]):qe.push($e);return qe}(V.shape,S,g),ae=Ye([V.shape[S]]),me=V.as2D(-1,ae),Ee=Jn(o.dtype),Se=this.segOpCompute(me,"unsortedSegmentSum",l,Ee,g).reshape(ne);return j!=null&&(Se=ft(Se,wu(j))),Se},c.prototype.segOpCompute=function(o,l,g,S,j){var V=o.shape[0],ne=o.shape[1],ae=function(Se,Ne){var ze,$e=!1;for(Se<=qu?(ze=Se,$e=!0):ze=Dr(Se,Math.floor(Math.sqrt(Se)));!$e;)ze>Ne||ze===Se?$e=!0:ze=Dr(Se,ze+1);return ze}(ne,j),me=new function(Se,Ne){this.variableNames=["x","segmentIds"];var ze=Se.windowSize,$e=Se.batchSize,qe=Se.inSize,tt=Se.numSegments,lt=tt*Math.ceil(qe/ze);this.outputShape=[$e,lt];var ht=4*Math.floor(ze/4),vt=ze%4,Ct=`
        sumValue += dot(values, segFilter);
    `,Vt="";qe%ze>0&&(Vt=`
        if (inIdx < 0 || inIdx >= `+qe+`) {
          return initializationValue;
        }
      `);var Yt="";qe%ze>0&&(Yt=`
        if (inIdx < 0 || inIdx >= `+qe+`) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = 0.0;

      float getValue(int batch, int inIdx) {
        `+Vt+`
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        `+Yt+`
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          `+tt+")) * float("+ze+`));
        int currentSeg = int(mod(float(outIdx), float(`+tt+`)));

        float sumValue = 0.0;

        for (int i = 0; i < `+ht+`; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          `+Ct+`
        }

        int inIdx = inOffset + `+ht+`;
        if (`+(vt===1)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          `+Ct+`
        } else if (`+(vt===2)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          `+Ct+`
        } else if (`+(vt===3)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          `+Ct+`
        }
        setOutput(sumValue);
      }
    `}({windowSize:ae,inSize:ne,batchSize:V,numSegments:j}),Ee=this.compileAndRun(me,[o,g],S);return Ee.shape[1]===j?Ee:(g=oc(0,j).tile([ne/ae]),this.segOpCompute(Ee,l,g,S,j))},c.prototype.argMinMaxReduce=function(o,l,g){var S=[l];if(Ko("arg"+g.charAt(0).toUpperCase()+g.slice(1),S,o.rank),!P().getBool("WEBGL_PACK_REDUCE")||o.rank<=2){var j=So(o.shape,S),V=j[0],ne=Ye(j[1]),ae=o.as2D(-1,ne);return this.argReduce(ae,g).reshape(V)}return this.argReducePacked(o,g)},c.prototype.argMin=function(o,l){return this.argMinMaxReduce(o,l,"min")},c.prototype.argMax=function(o,l){return this.argMinMaxReduce(o,l,"max")},c.prototype.cumsum=function(o,l,g,S){if(l!==o.rank-1)throw new Error("WebGL cumsum shader expects an inner-most axis="+(o.rank-1)+" but got axis="+l);var j=new function(V,ne,ae){this.variableNames=["x"],this.outputShape=V;var me=V.length,Ee=V[V.length-1],Se=ae?"<":">";this.userCode=`
      int getIndex(int i) {
        `+(ae?"return "+Ee+" -i - 1;":"return i;")+`
      }

      void main() {
        `+Io(me)+` coords = getOutputCoords();
        int end = `+vg(me,"coords")+`;
        float val = 0.0;
        for (int i = `+Ee+` - 1; i >= 0; i -= 1) {
          int idx = getIndex(i);
          if (idx `+Se+` end) {
            continue;
          }
          if (idx == end && `+ne+`) {
            continue;
          }
          `+vg(me,"coords")+` = idx;
          val += getX(`+function(Ne,ze){if(Ne===1)return""+ze;if(Ne===2)return ze+".x, "+ze+".y";if(Ne===3)return ze+".x, "+ze+".y, "+ze+".z";if(Ne===4)return ze+".x, "+ze+".y, "+ze+".z, "+ze+".w";throw Error("Cumulative sum for rank "+Ne+" is not yet supported")}(me,"coords")+`);
        }
        setOutput(val);
      }
    `}(o.shape,g,S);return this.compileAndRun(j,[o])},c.prototype.equal=function(o,l){if(P().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(o,l,`
  return vec4(equal(a, b));
`,"bool");var g=new Uo("return float(a == b);",o.shape,l.shape);return this.compileAndRun(g,[o,l],"bool")},c.prototype.notEqual=function(o,l){if(P().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(o,l,`
  return vec4(notEqual(a, b));
`,"bool");var g=new Uo("return float(a != b);",o.shape,l.shape);return this.compileAndRun(g,[o,l],"bool")},c.prototype.less=function(o,l){if(this.shouldExecuteOnCPU([o,l]))return this.cpuBackend.less(o,l);if(P().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(o,l,`
  return vec4(lessThan(a, b));
`,"bool");var g=new Uo("return float(a < b);",o.shape,l.shape);return this.compileAndRun(g,[o,l],"bool")},c.prototype.lessEqual=function(o,l){if(P().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(o,l,`
  return vec4(lessThanEqual(a, b));
`,"bool");var g=new Uo("return float(a <= b);",o.shape,l.shape);return this.compileAndRun(g,[o,l],"bool")},c.prototype.greater=function(o,l){if(this.shouldExecuteOnCPU([o,l]))return this.cpuBackend.greater(o,l);if(P().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(o,l,`
  return vec4(greaterThan(a, b));
`,"bool");var g=new Uo("return float(a > b);",o.shape,l.shape);return this.compileAndRun(g,[o,l],"bool")},c.prototype.greaterEqual=function(o,l){if(P().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(o,l,`
  return vec4(greaterThanEqual(a, b));
`,"bool");var g=new Uo("return float(a >= b);",o.shape,l.shape);return this.compileAndRun(g,[o,l],"bool")},c.prototype.logicalNot=function(o){var l=new uo(o.shape,"return float(!(x >= 1.0));");return this.compileAndRun(l,[o])},c.prototype.logicalAnd=function(o,l){if(P().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(o,l,`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,"bool");var g=new Uo("return float(a >= 1.0 && b >= 1.0);",o.shape,l.shape);return this.compileAndRun(g,[o,l],"bool")},c.prototype.logicalOr=function(o,l){if(P().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(o,l,`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,"bool");var g=new Uo("return float(a >= 1.0 || b >= 1.0);",o.shape,l.shape);return this.compileAndRun(g,[o,l],"bool")},c.prototype.select=function(o,l,g){var S=new function(j,V,ne){var ae,me;if(this.variableNames=["c","a","b"],this.outputShape=V,ne>4)throw Error("Where for rank "+ne+" is not yet supported");if(ne===1)me="resRC",ae="resRC";else{for(var Ee=["resRC.x","resRC.y","resRC.z","resRC.w"],Se=[],Ne=[],ze=0;ze<V.length;ze++)Ne.push(""+Ee[ze]),ze<j&&Se.push(""+Ee[ze]);ae=Se.join(),me=Ne.join()}var $e=Io(ne);this.userCode=`
      void main() {
        `+$e+` resRC = getOutputCoords();
        float cVal = getC(`+ae+`);
        if (cVal >= 1.0) {
          setOutput(getA(`+me+`));
        } else {
          setOutput(getB(`+me+`));
        }
      }
    `}(o.rank,l.shape,l.rank);return this.compileAndRun(S,[o,l,g],fn(l.dtype,g.dtype))},c.prototype.where=function(o){qc("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var l=o.dataSync();return Qo(o.shape,l)},c.prototype.topk=function(o,l,g){return aa(o.dataSync(),o.shape,o.dtype,l)},c.prototype.min=function(o,l){Ko("min",l,o.rank);var g=So(o.shape,l),S=g[0],j=Ye(g[1]),V=o.as2D(-1,j);return this.reduce(V,"min",V.dtype).reshape(S)},c.prototype.minimum=function(o,l){if(this.shouldExecuteOnCPU([o,l]))return this.cpuBackend.minimum(o,l);var g=P().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new ja(`
  vec4 result = vec4(min(a, b));
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,o.shape,l.shape):new Uo(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return min(a, b);
`,o.shape,l.shape);return this.compileAndRun(g,[o,l])},c.prototype.mod=function(o,l){var g=P().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new ja(`
  vec4 result = mod(a, b);
  vec4 isNaN = vec4(equal(b, vec4(0.0)));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,o.shape,l.shape):new Uo(`if (b == 0.0) return NAN;
  return mod(a, b);`,o.shape,l.shape);return this.compileAndRun(g,[o,l])},c.prototype.max=function(o,l){if(this.shouldExecuteOnCPU([o]))return this.cpuBackend.max(o,l);Ko("max",l,o.rank);var g=So(o.shape,l),S=g[0],j=Ye(g[1]),V=o.as2D(-1,j);return this.reduce(V,"max",V.dtype).reshape(S)},c.prototype.maximum=function(o,l){if(this.shouldExecuteOnCPU([o,l]))return this.cpuBackend.maximum(o,l);var g=P().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new ja(`
  vec4 result = vec4(max(a, b));
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,o.shape,l.shape):new Uo(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return max(a, b);
`,o.shape,l.shape);return this.compileAndRun(g,[o,l])},c.prototype.all=function(o,l){Ko("all",l,o.rank);var g=So(o.shape,l),S=g[0],j=Ye(g[1]),V=o.as2D(-1,j);return this.reduce(V,"all",V.dtype).reshape(S)},c.prototype.any=function(o,l){Ko("any",l,o.rank);var g=So(o.shape,l),S=g[0],j=Ye(g[1]),V=o.as2D(-1,j);return this.reduce(V,"any",V.dtype).reshape(S)},c.prototype.floorDiv=function(o,l){if(P().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(o,l,`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,"int32");var g=new Uo(`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,o.shape,l.shape);return this.compileAndRun(g,[o,l],"int32")},c.prototype.add=function(o,l){if(o.dtype==="complex64"&&l.dtype==="complex64")return this.complexSeparableBinaryOp(o,l,Ss);if(this.shouldExecuteOnCPU([o,l]))return this.cpuBackend.add(o,l);var g=fn(o.dtype,l.dtype);if(P().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(o,l,Ss,g);var S=new Uo(Ss,o.shape,l.shape);return this.compileAndRun(S,[o,l],g)},c.prototype.packedUnaryOp=function(o,l,g){var S=new zl(o.shape,l);return this.compileAndRun(S,[o],g)},c.prototype.packedBinaryOp=function(o,l,g,S,j){j===void 0&&(j=!1);var V=new ja(g,o.shape,l.shape,j);return this.compileAndRun(V,[o,l],S)},c.prototype.complexSeparableBinaryOp=function(o,l,g){var S=this,j=this.texData.get(o.dataId),V=this.texData.get(l.dataId),ne=[[j.complexTensors.real,V.complexTensors.real],[j.complexTensors.imag,V.complexTensors.imag]].map(function(Se){var Ne=Se[0],ze=Se[1],$e=S.makeComplexComponentTensorInfo(o,Ne),qe=S.makeComplexComponentTensorInfo(l,ze),tt=new Uo(g,o.shape,l.shape);return S.compileAndRun(tt,[$e,qe],fn(Ne.dtype,ze.dtype))}),ae=ne[0],me=ne[1],Ee=this.complex(ae,me);return ae.dispose(),me.dispose(),Ee},c.prototype.makeComplexComponentTensorInfo=function(o,l){return{dataId:l.dataId,dtype:l.dtype,shape:o.shape}},c.prototype.addN=function(o){if(o.length===1)return o[0];if(o.length>P().get("WEBGL_MAX_TEXTURES_IN_SHADER")){var l=Math.floor(o.length/2),g=this.addN(o.slice(0,l)),S=this.addN(o.slice(l));return this.addN([g,S])}var j=o.map(function(ae){return ae.dtype}).reduce(function(ae,me){return fn(ae,me)}),V=o.map(function(ae){return ae.shape}),ne=P().getBool("WEBGL_PACK")?new function(ae,me){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=ae,this.variableNames=me.map(function(Ne,ze){return"T"+ze});var Ee=[];this.variableNames.forEach(function(Ne){Ee.push("vec4 v"+Ne+" = get"+Ne+"AtOutCoords();")});var Se=this.variableNames.map(function(Ne){return"v"+Ne}).join(" + ");this.userCode=`
      void main() {
        `+Ee.join(`
        `)+`

        vec4 result = `+Se+`;
        setOutput(result);
      }
    `}(o[0].shape,V):new function(ae,me){this.outputShape=[],this.outputShape=ae,this.variableNames=me.map(function(Ne,ze){return"T"+ze});var Ee=[];this.variableNames.forEach(function(Ne){Ee.push("float v"+Ne+" = get"+Ne+"AtOutCoords();")});var Se=this.variableNames.map(function(Ne){return"v"+Ne}).join(" + ");this.userCode=`
      void main() {
        `+Ee.join(`
        `)+`

        float result = `+Se+`;
        setOutput(result);
      }
    `}(o[0].shape,V);return this.compileAndRun(ne,o,j)},c.prototype.subtract=function(o,l){if(o.dtype==="complex64"&&l.dtype==="complex64")return this.complexSeparableBinaryOp(o,l,Ga);if(this.shouldExecuteOnCPU([o,l]))return this.cpuBackend.subtract(o,l);var g=fn(o.dtype,l.dtype);if(P().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(o,l,Ga,o.dtype);var S=new Uo(Ga,o.shape,l.shape);return this.compileAndRun(S,[o,l],g)},c.prototype.pow=function(o,l){var g=P().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new ja(`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,o.shape,l.shape):new Uo(`
if(a < 0.0 && floor(b) < b){
  return NAN;
}
if (b == 0.0) {
  return 1.0;
}
return (round(mod(b, 2.0)) != 1) ?
    pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,o.shape,l.shape),S=fn(o.dtype,l.dtype);return this.compileAndRun(g,[o,l],S)},c.prototype.ceil=function(o){if(this.shouldExecuteOnCPU([o]))return this.cpuBackend.ceil(o);if(P().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(o,Dg,o.dtype);var l=new uo(o.shape,Dg);return this.compileAndRun(l,[o])},c.prototype.floor=function(o){if(this.shouldExecuteOnCPU([o]))return this.cpuBackend.floor(o);if(P().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(o,Tg,o.dtype);var l=new uo(o.shape,Tg);return this.compileAndRun(l,[o])},c.prototype.sign=function(o){var l=new uo(o.shape,`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`);return this.compileAndRun(l,[o])},c.prototype.isNaN=function(o){var l=new uo(o.shape,"return float(isnan(x));");return this.compileAndRun(l,[o],"bool")},c.prototype.isInf=function(o){var l=new uo(o.shape,"return float(isinf(x));");return this.compileAndRun(l,[o],"bool")},c.prototype.isFinite=function(o){var l=new uo(o.shape,"return float(!isnan(x) && !isinf(x));");return this.compileAndRun(l,[o],"bool")},c.prototype.round=function(o){var l=new uo(o.shape,`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`);return this.compileAndRun(l,[o])},c.prototype.exp=function(o){if(this.shouldExecuteOnCPU([o]))return this.cpuBackend.exp(o);if(P().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(o,$h,o.dtype);var l=new uo(o.shape,$h);return this.compileAndRun(l,[o])},c.prototype.expm1=function(o){if(this.shouldExecuteOnCPU([o]))return this.cpuBackend.expm1(o);if(P().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(o,Uf,o.dtype);var l=new uo(o.shape,Uf);return this.compileAndRun(l,[o])},c.prototype.softmax=function(o,l){var g=wn([l],o.shape),S=this.max(o,g),j=_o(S.shape,g),V=this.subtract(o,S.reshape(j)),ne=this.exp(V),ae=this.sum(ne,g).reshape(j);return Yo(ne,ae)},c.prototype.log=function(o){if(this.shouldExecuteOnCPU([o]))return this.cpuBackend.log(o);if(P().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(o,`
  vec4 result = log(x);
  vec4 isNaN = vec4(lessThan(x, vec4(0.0)));
  result.r = isNaN.r == 1.0 ? NAN : result.r;
  result.g = isNaN.g == 1.0 ? NAN : result.g;
  result.b = isNaN.b == 1.0 ? NAN : result.b;
  result.a = isNaN.a == 1.0 ? NAN : result.a;

  return result;
`,o.dtype);var l=new uo(o.shape,`if (x < 0.0) return NAN;
  return log(x);`);return this.compileAndRun(l,[o])},c.prototype.log1p=function(o){var l=new uo(o.shape,"return log(1.0 + x);");return this.compileAndRun(l,[o])},c.prototype.sqrt=function(o){var l=new uo(o.shape,"return sqrt(x);");return this.compileAndRun(l,[o])},c.prototype.rsqrt=function(o){if(this.shouldExecuteOnCPU([o]))return this.cpuBackend.rsqrt(o);var l=new uo(o.shape,"return inversesqrt(x);");return this.compileAndRun(l,[o])},c.prototype.reciprocal=function(o){var l=new uo(o.shape,"return 1.0 / x;");return this.compileAndRun(l,[o])},c.prototype.relu=function(o){var l;return l=P().getBool("WEBGL_PACK")?new zl(o.shape,Pp):new uo(o.shape,_g),this.compileAndRun(l,[o])},c.prototype.relu6=function(o){var l;return l=P().getBool("WEBGL_PACK")?new zl(o.shape,il):new uo(o.shape,tp),this.compileAndRun(l,[o])},c.prototype.prelu=function(o,l){var g=P().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new ja(es,o.shape,l.shape):new Uo(Sc,o.shape,l.shape);return this.compileAndRun(g,[o,l])},c.prototype.elu=function(o){if(P().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(o,Du,o.dtype);var l=new uo(o.shape,nl);return this.compileAndRun(l,[o])},c.prototype.eluDer=function(o,l){var g=P().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new ja(`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,o.shape,l.shape):new Uo("return (b >= 1.0) ? a : a * (b + 1.0);",o.shape,l.shape);return this.compileAndRun(g,[o,l])},c.prototype.selu=function(o){var l=new uo(o.shape,`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = 1.7580993408473768;
  float scale = 1.0507009873554805;
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`);return this.compileAndRun(l,[o])},c.prototype.int=function(o){var l=new uo(o.shape,"return float(int(x));");return this.compileAndRun(l,[o],"int32")},c.prototype.clip=function(o,l,g){var S,j=(S=P().getBool("WEBGL_PACK_CLIP")?new el(o.shape):new lc(o.shape)).getCustomSetupFunc(l,g);return this.compileAndRun(S,[o],null,j)},c.prototype.abs=function(o){if(this.shouldExecuteOnCPU([o]))return this.cpuBackend.abs(o);if(P().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(o,Bp,o.dtype);var l=new uo(o.shape,Bp);return this.compileAndRun(l,[o])},c.prototype.complexAbs=function(o){var l=this.texData.get(o.dataId),g=new function(j){this.variableNames=["real","imag"],this.outputShape=j,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `}(o.shape),S=[this.makeComplexComponentTensorInfo(o,l.complexTensors.real),this.makeComplexComponentTensorInfo(o,l.complexTensors.imag)];return this.compileAndRun(g,S)},c.prototype.sigmoid=function(o){var l=new uo(o.shape,"return 1.0 / (1.0 + exp(-1.0 * x));");return this.compileAndRun(l,[o])},c.prototype.softplus=function(o){var l=new uo(o.shape,`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`);return this.compileAndRun(l,[o])},c.prototype.sin=function(o){var l=new uo(o.shape,`if (isnan(x)) return x;
  return sin(x);
`);return this.compileAndRun(l,[o])},c.prototype.cos=function(o){var l=new uo(o.shape,`if (isnan(x)) return x;
  return cos(x);
`);return this.compileAndRun(l,[o])},c.prototype.tan=function(o){var l=new uo(o.shape,"return tan(x);");return this.compileAndRun(l,[o])},c.prototype.asin=function(o){var l=new uo(o.shape,`if (isnan(x)) return x;
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`);return this.compileAndRun(l,[o])},c.prototype.acos=function(o){var l=new uo(o.shape,`if (isnan(x)) return x;
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`);return this.compileAndRun(l,[o])},c.prototype.atan=function(o){var l=new uo(o.shape,`if (isnan(x)) return x;
  return atan(x);
`);return this.compileAndRun(l,[o])},c.prototype.atan2=function(o,l){var g=P().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new ja(`
  vec4 result = atan(a, b);
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,o.shape,l.shape):new Uo(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return atan(a, b);
`,o.shape,l.shape);return this.compileAndRun(g,[o,l])},c.prototype.sinh=function(o){var l=new uo(o.shape,`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`);return this.compileAndRun(l,[o])},c.prototype.cosh=function(o){var l=new uo(o.shape,`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`);return this.compileAndRun(l,[o])},c.prototype.tanh=function(o){var l=new uo(o.shape,`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`);return this.compileAndRun(l,[o])},c.prototype.asinh=function(o){var l=new uo(o.shape,"if (isnan(x)) return x;return log(x + sqrt(x * x + 1.0));");return this.compileAndRun(l,[o])},c.prototype.acosh=function(o){var l=new uo(o.shape,`if (isnan(x)) return x;
  if (x < 1.0) return NAN;
  return log(x + sqrt(x * x - 1.0));`);return this.compileAndRun(l,[o])},c.prototype.atanh=function(o){var l=new uo(o.shape,`if (isnan(x)) return x;
  if ((x < -1.0) || (x > 1.0)) return NAN;
  return (log(1.0 + x) - log(1.0 - x)) / 2.0;`);return this.compileAndRun(l,[o])},c.prototype.erf=function(o){var l=new uo(o.shape,`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = 0.3275911;
  float a1 = 0.254829592;
  float a2 = -0.284496736;
  float a3 = 1.421413741;
  float a4 = -1.453152027;
  float a5 = 1.061405429;

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`);return this.compileAndRun(l,[o])},c.prototype.step=function(o,l){var g=new uo(o.shape,function(S){return S===void 0&&(S=0),Ag+`
    return x > 0.0 ? 1.0 : float(`+S+`);
  `}(l));return this.compileAndRun(g,[o])},c.prototype.conv2dByMatMul=function(o,l,g,S,j,V){var ne=o.shape,ae=this.texData.get(o.dataId),me=g.inChannels,Ee=ne[0]*ne[1]*ne[2],Se=g.outChannels,Ne=g.dataFormat==="channelsLast",ze=(Ee===1||Se===1)&&me>1e3,$e=ne[2]%2!=0&&!!ae.isPacked;if(ze||!P().getBool("WEBGL_LAZILY_UNPACK")||!P().getBool("WEBGL_PACK_BINARY_OPERATIONS")||!$e){var qe=Ne?ne[0]*ne[1]*ne[2]:ne[0]*ne[2]*ne[3],tt=this.reshape(o,[1,qe,g.inChannels]),lt=this.reshape(l,[1,g.inChannels,g.outChannels]);return this.reshape(this.fusedBatchMatMul({a:tt,b:lt,transposeA:!1,transposeB:!1,bias:S,activation:j,preluActivationWeights:V}),g.outShape)}var ht=Ne?ne[0]*ne[1]*(ne[2]+1):ne[0]*ne[2]*(ne[3]+1),vt={dataId:o.dataId,shape:[1,ht,g.inChannels],dtype:o.dtype},Ct=ae.shape;ae.shape=ae.shape.slice(),ae.shape[ae.shape.length-2]++,ke(cu(ae.shape,vt.shape),function(){return"packed reshape "+ae.shape+" to "+vt.shape+" isn't free"});var Vt=this.reshape(l,[1,g.inChannels,g.outChannels]),Yt=this.fusedBatchMatMul({a:vt,b:Vt,transposeA:!1,transposeB:!1,bias:S,activation:j,preluActivationWeights:V}),qt=this.texData.get(Yt.dataId);return ke(qt.isPacked,function(){return"batchMatMul result is expected to be packed"}),ae.shape=Ct,qt.shape=g.outShape,Ue.makeTensorFromDataId(Yt.dataId,g.outShape,Yt.dtype)},c.prototype.conv2dWithIm2Row=function(o,l,g,S,j,V){var ne=g.filterWidth,ae=g.filterHeight,me=g.inChannels,Ee=g.outWidth,Se=g.outHeight,Ne=g.dataFormat==="channelsLast",ze=ne*ae*me,$e=Se*Ee,qe=[ze,$e],tt=o.squeeze([0]),lt=l.reshape([1,ze,-1]),ht=new function(On,Cn,Xn){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=On;for(var er=Xn.filterWidth,sr=Xn.inChannels,lr=Xn.strideWidth,ur=Xn.strideHeight,or=Xn.padInfo,Er=Xn.outWidth,kr=Xn.dilationWidth,Ur=Xn.dilationHeight,Zr=Xn.dataFormat,mi=or.left,co=or.top,lo=sr*er,Eo=go(),wo=Zr==="channelsLast",Bo=wo?0:1,ta=wo?1:2,Pa="",Xi=0;Xi<=1;Xi++)for(var Co=0;Co<=1;Co++)Pa+=`
          blockIndex = rc.y + `+Co+`;
          pos = rc.x + `+Xi+`;

          if(blockIndex < `+On[1]+" && pos < "+On[0]+`) {
            offsetY = int(blockIndex / (`+Er+")) * "+ur+" - "+co+`;
            d0 = offsetY + `+Ur+" * (pos / "+lo+`);

            if(d0 < `+Cn[Bo]+` && d0 >= 0) {

              offsetX = int(mod(float(blockIndex), `+Er+".) * "+lr+". - "+mi+`.);
              d1 = offsetX + `+kr+" * (int(mod(float(pos), "+lo+".) / "+sr+`.));

              if(d1 < `+Cn[ta]+` && d1 >= 0) {

                ch = int(mod(float(pos), `+sr+`.));

                if (`+wo+`) {
                  innerDims = vec2(d1, ch);
                  result[`+(2*Xi+Co)+`] = getChannel(
                    getA(d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[`+(2*Xi+Co)+`] = getChannel(
                    getA(ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `;this.userCode=`
      void main() {
        ivec2 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        `+Pa+`

        `+Eo.output+` = result;
      }
    `}(qe,tt.shape,g),vt=this.compileAndRun(ht,[tt]).reshape([1,qe[0],qe[1]]),Ct=S!=null,Vt=V!=null,Yt=j?Wl(j,!0):null,qt=new _u(vt.shape,[1,$e,g.outChannels],!0,!1,Ct,Yt,Vt),$t=[vt,lt];S&&$t.push(S),Vt&&$t.push(V);var yn=this.compileAndRun(qt,$t);return Ne?yn.reshape([1,Se,Ee,g.outChannels]):yn.reshape([1,g.outChannels,Se,Ee])},c.prototype.fusedConv2d=function(o){var l=o.input,g=o.filter,S=o.convInfo,j=o.bias,V=o.activation,ne=o.preluActivationWeights;if(S.filterHeight===1&&S.filterWidth===1&&S.dilationHeight===1&&S.dilationWidth===1&&S.strideHeight===1&&S.strideWidth===1&&(S.padInfo.type==="SAME"||S.padInfo.type==="VALID"))return this.conv2dByMatMul(l,g,S,j,V,ne);if(P().getBool("WEBGL_CONV_IM2COL")&&l.shape[0]===1)return this.conv2dWithIm2Row(l,g,S,j,V,ne);var ae=j!=null,me=ne!=null,Ee=V?Wl(V,!1):null,Se=new Xd(S,ae,Ee,me),Ne=[l,g];return j&&Ne.push(j),ne&&Ne.push(ne),this.compileAndRun(Se,Ne)},c.prototype.conv2d=function(o,l,g){if(g.filterHeight===1&&g.filterWidth===1&&g.dilationHeight===1&&g.dilationWidth===1&&g.strideHeight===1&&g.strideWidth===1&&(g.padInfo.type==="SAME"||g.padInfo.type==="VALID"))return this.conv2dByMatMul(o,l,g);if(P().getBool("WEBGL_CONV_IM2COL")&&o.shape[0]===1)return this.conv2dWithIm2Row(o,l,g);var S=new Xd(g);return this.compileAndRun(S,[o,l])},c.prototype.conv2dDerInput=function(o,l,g){var S=new function(j){this.variableNames=["dy","W"],this.outputShape=j.inShape;var V=j.filterHeight,ne=j.filterWidth,ae=j.strideHeight,me=j.strideWidth,Ee=j.dataFormat==="channelsLast",Se=V-1-j.padInfo.top,Ne=ne-1-j.padInfo.left,ze=Ee?1:2,$e=Ee?2:3,qe=Ee?3:1;this.userCode=`
      const ivec2 pads = ivec2(`+Se+", "+Ne+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[`+qe+`];

        ivec2 dyCorner = ivec2(coords[`+ze+"], coords["+$e+`]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+V+`; wR++) {
          float dyR = float(dyRCorner + wR) / `+ae+`.0;

          if (dyR < 0.0 || dyR >= `+j.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `+V+` - 1 - wR;

          for (int wC = 0; wC < `+ne+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+me+`.0;

            if (dyC < 0.0 || dyC >= `+j.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `+ne+` - 1 - wC;

            for (int d2 = 0; d2 < `+j.outChannels+`; d2++) {

              if (`+Ee+`) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `}(g);return this.compileAndRun(S,[o,l])},c.prototype.conv2dDerFilter=function(o,l,g){var S=new function(j){this.variableNames=["x","dy"],this.outputShape=j.filterShape;var V=j.strideHeight,ne=j.strideWidth,ae=j.padInfo.top,me=j.padInfo.left,Ee=j.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < `+j.batchSize+`; b++) {
          for (int yR = 0; yR < `+j.outHeight+`; yR++) {
            int xR = wR + yR * `+V+" - "+ae+`;

            if (xR < 0 || xR >= `+j.inHeight+`) {
              continue;
            }

            for (int yC = 0; yC < `+j.outWidth+`; yC++) {
              int xC = wC + yC * `+ne+" - "+me+`;

              if (xC < 0 || xC >= `+j.inWidth+`) {
                continue;
              }

              if (`+Ee+`) {
                float dyValue = getDy(b, yR, yC, d2);
                float xValue = getX(b, xR, xC, d1);
                dotProd += (xValue * dyValue);
              } else {
                float dyValue = getDy(b, d2, yR, yC);
                float xValue = getX(b, d1, xR, xC);
                dotProd += (xValue * dyValue);
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `}(g);return this.compileAndRun(S,[o,l])},c.prototype.fusedDepthwiseConv2D=function(o){var l,g=o.input,S=o.filter,j=o.convInfo,V=o.bias,ne=o.activation,ae=o.preluActivationWeights,me=P().getBool("WEBGL_PACK_DEPTHWISECONV")&&j.strideWidth<=2&&j.outChannels/j.inChannels==1,Ee=ne?Wl(ne,me):null,Se=[g,S],Ne=V!=null,ze=ae!=null;return Ne&&Se.push(V),ze&&Se.push(ae),me?(l=new Ll(j,Ne,Ee,ze),this.compileAndRun(l,Se)):(l=new tl(j,Ne,Ee,ze),this.compileAndRun(l,Se))},c.prototype.depthwiseConv2D=function(o,l,g){var S;return P().getBool("WEBGL_PACK_DEPTHWISECONV")&&g.strideWidth<=2&&g.outChannels/g.inChannels==1?(S=new Ll(g),this.compileAndRun(S,[o,l])):(S=new tl(g),this.compileAndRun(S,[o,l]))},c.prototype.depthwiseConv2DDerInput=function(o,l,g){var S=new function(j){this.variableNames=["dy","W"],this.outputShape=j.inShape;var V=j.filterHeight,ne=j.filterWidth,ae=j.strideHeight,me=j.strideWidth,Ee=V-1-j.padInfo.top,Se=ne-1-j.padInfo.left,Ne=j.outChannels/j.inChannels;this.userCode=`
      const ivec2 pads = ivec2(`+Ee+", "+Se+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < `+V+`; wR++) {
          float dyR = float(dyRCorner + wR) / `+ae+`.0;

          if (dyR < 0.0 || dyR >= `+j.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `+V+` - 1 - wR;

          for (int wC = 0; wC < `+ne+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+me+`.0;

            if (dyC < 0.0 || dyC >= `+j.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `+ne+` - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < `+Ne+`; dm++) {
              int d2 = d1 * `+Ne+` + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `}(g);return this.compileAndRun(S,[o,l])},c.prototype.depthwiseConv2DDerFilter=function(o,l,g){var S=new function(j){this.variableNames=["x","dy"],this.outputShape=j.filterShape;var V=j.strideHeight,ne=j.strideWidth,ae=j.padInfo.top,me=j.padInfo.left,Ee=j.outChannels/j.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * `+Ee+` + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < `+j.batchSize+`; b++) {
          for (int yR = 0; yR < `+j.outHeight+`; yR++) {
            int xR = wR + yR * `+V+" - "+ae+`;

            if (xR < 0 || xR >= `+j.inHeight+`) {
              continue;
            }

            for (int yC = 0; yC < `+j.outWidth+`; yC++) {
              int xC = wC + yC * `+ne+" - "+me+`;

              if (xC < 0 || xC >= `+j.inWidth+`) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `}(g);return this.compileAndRun(S,[o,l])},c.prototype.conv3d=function(o,l,g){var S=new function(j){this.variableNames=["x","W"],this.outputShape=j.outShape;var V=j.padInfo.front,ne=j.padInfo.top,ae=j.padInfo.left,me=j.strideDepth,Ee=j.strideHeight,Se=j.strideWidth,Ne=j.dilationDepth,ze=j.dilationHeight,$e=j.dilationWidth,qe=j.filterDepth,tt=j.filterHeight,lt=j.filterWidth,ht=4*Math.floor(j.inChannels/4),vt=j.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(`+me+", "+Ee+", "+Se+`);
      const ivec3 pads = ivec3(`+V+", "+ne+", "+ae+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < `+qe+`; wF++) {
          int xF = xFCorner + wF * `+Ne+`;

          if (xF < 0 || xF >= `+j.inDepth+`) {
            continue;
          }

          for (int wR = 0; wR < `+tt+`; wR++) {
            int xR = xRCorner + wR * `+ze+`;

            if (xR < 0 || xR >= `+j.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+lt+`; wC++) {
              int xC = xCCorner + wC * `+$e+`;

              if (xC < 0 || xC >= `+j.inWidth+`) {
                continue;
              }

              for (int d1 = 0; d1 < `+ht+`; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (`+(vt===1)+`) {
                dotProd +=
                  getX(batch, xF, xR, xC, `+ht+`) *
                  getW(wF, wR, wC, `+ht+`, d2);
              } else if (`+(vt===2)+`) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, `+ht+`),
                  getX(batch, xF, xR, xC, `+ht+` + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, `+ht+`, d2),
                  getW(wF, wR, wC, `+ht+` + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (`+(vt===3)+`) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, `+ht+`),
                  getX(batch, xF, xR, xC, `+ht+` + 1),
                  getX(batch, xF, xR, xC, `+ht+` + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, `+ht+`, d2),
                  getW(wF, wR, wC, `+ht+` + 1, d2),
                  getW(wF, wR, wC, `+ht+` + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}(g);return this.compileAndRun(S,[o,l])},c.prototype.conv3dDerInput=function(o,l,g){var S=new function(j){this.variableNames=["dy","W"],this.outputShape=j.inShape;var V=j.filterDepth,ne=j.filterHeight,ae=j.filterWidth,me=j.strideDepth,Ee=j.strideHeight,Se=j.strideWidth,Ne=V-1-j.padInfo.front,ze=ne-1-j.padInfo.top,$e=ae-1-j.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(`+Ne+", "+ze+", "+$e+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < `+V+`; wF++) {
          float dyF = float(dyFCorner + wF) / `+me+`.0;

          if (dyF < 0.0 || dyF >= `+j.outDepth+`.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = `+V+` - 1 - wF;

          for (int wR = 0; wR < `+ne+`; wR++) {
            float dyR = float(dyRCorner + wR) / `+Ee+`.0;

            if (dyR < 0.0 || dyR >= `+j.outHeight+`.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = `+ne+` - 1 - wR;

            for (int wC = 0; wC < `+ae+`; wC++) {
              float dyC = float(dyCCorner + wC) / `+Se+`.0;

              if (dyC < 0.0 || dyC >= `+j.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = `+ae+` - 1 - wC;

              for (int d2 = 0; d2 < `+j.outChannels+`; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}(g);return this.compileAndRun(S,[o,l])},c.prototype.conv3dDerFilter=function(o,l,g){var S=new function(j){this.variableNames=["x","dy"],this.outputShape=j.filterShape;var V=j.strideDepth,ne=j.strideHeight,ae=j.strideWidth,me=j.padInfo.front,Ee=j.padInfo.top,Se=j.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < `+j.batchSize+`; b++) {
          for (int yF = 0; yF < `+j.outDepth+`; yF++) {
            int xF = wF + yF * `+V+" - "+me+`;

            if (xF < 0 || xF >= `+j.inDepth+`) {
              continue;
            }

            for (int yR = 0; yR < `+j.outHeight+`; yR++) {
              int xR = wR + yR * `+ne+" - "+Ee+`;

              if (xR < 0 || xR >= `+j.inHeight+`) {
                continue;
              }

              for (int yC = 0; yC < `+j.outWidth+`; yC++) {
                int xC = wC + yC * `+ae+" - "+Se+`;

                if (xC < 0 || xC >= `+j.inWidth+`) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}(g);return this.compileAndRun(S,[o,l])},c.prototype.maxPool=function(o,l){var g=new Hh(l,"max",!1);return this.compileAndRun(g,[o])},c.prototype.avgPool=function(o,l){var g=new Hh(l,"avg",!1);return this.compileAndRun(g,[o],"float32")},c.prototype.maxPoolBackprop=function(o,l,g,S){var j=new Hh(S,"max",!0),V=this.compileAndRun(j,[l]),ne=new function(me){this.variableNames=["dy","maxPos"],this.outputShape=me.inShape;var Ee=me.strideHeight,Se=me.strideWidth,Ne=me.dilationHeight,ze=me.effectiveFilterHeight,$e=me.effectiveFilterWidth,qe=ze-1-me.padInfo.top,tt=$e-1-me.padInfo.left,lt=ze*$e-1;this.userCode=`
      const ivec2 pads = ivec2(`+qe+", "+tt+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+ze+`;
          wR += `+Ne+`) {
          float dyR = float(dyRCorner + wR) / `+Ee+`.0;

          if (dyR < 0.0 || dyR >= `+me.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `+$e+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+Se+`.0;

            if (dyC < 0.0 || dyC >= `+me.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = `+lt+` - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * `+$e+` + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `}(S),ae=this.compileAndRun(ne,[o,V],l.dtype);return V.dispose(),ae},c.prototype.avgPoolBackprop=function(o,l,g){var S=new function(j){this.variableNames=["dy"],this.outputShape=j.inShape;var V=j.filterHeight,ne=j.filterWidth,ae=j.strideHeight,me=j.strideWidth,Ee=j.dilationHeight,Se=j.dilationWidth,Ne=j.effectiveFilterHeight,ze=j.effectiveFilterWidth,$e=Ne-1-j.padInfo.top,qe=ze-1-j.padInfo.left,tt=1/(V*ne);this.userCode=`
      const ivec2 pads = ivec2(`+$e+", "+qe+`);
      const float avgMultiplier = float(`+tt+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+Ne+`;
            wR += `+Ee+`) {
          float dyR = float(dyRCorner + wR) / `+ae+`.0;

          if (dyR < 0.0 || dyR >= `+j.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `+ze+`;
            wC+= `+Se+`) {
            float dyC = float(dyCCorner + wC) / `+me+`.0;

            if (dyC < 0.0 || dyC >= `+j.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `}(g);return this.compileAndRun(S,[o],l.dtype)},c.prototype.cast=function(o,l){return Wr(o,l,this)},c.prototype.unstack=function(o,l){for(var g=o.shape[l],S=new Array(o.rank-1),j=0,V=0;V<o.rank;V++)V!==l&&(S[j++]=o.shape[V]);var ne=new Array(o.rank).fill(0),ae=o.shape.slice();ae[l]=1;var me=new Array(g);for(V=0;V<me.length;V++)ne[l]=V,me[V]=this.slice(o,ne,ae).reshape(S);return me},c.prototype.avgPool3d=function(o,l){var g=new Qd(l,"avg",!1);return this.compileAndRun(g,[o],"float32")},c.prototype.avgPool3dBackprop=function(o,l,g){var S=new function(j){this.variableNames=["dy"],this.outputShape=j.inShape;var V=j.filterDepth,ne=j.filterHeight,ae=j.filterWidth,me=j.strideDepth,Ee=j.strideHeight,Se=j.strideWidth,Ne=j.dilationDepth,ze=j.dilationHeight,$e=j.dilationWidth,qe=j.effectiveFilterDepth,tt=j.effectiveFilterHeight,lt=j.effectiveFilterWidth,ht=qe-1-j.padInfo.front,vt=tt-1-j.padInfo.top,Ct=lt-1-j.padInfo.left,Vt=1/(V*ne*ae);this.userCode=`
      const ivec3 pads = ivec3(`+ht+", "+vt+", "+Ct+`);
      const float avgMultiplier = float(`+Vt+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < `+qe+`;
            wD += `+Ne+`) {
          float dyD = float(dyDCorner + wD) / `+me+`.0;

          if (dyD < 0.0 || dyD >= `+j.outDepth+`.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < `+tt+`;
              wR += `+ze+`) {
            float dyR = float(dyRCorner + wR) / `+Ee+`.0;

            if (dyR < 0.0 || dyR >= `+j.outHeight+`.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < `+lt+`;
                wC += `+$e+`) {
              float dyC = float(dyCCorner + wC) / `+Se+`.0;

              if (dyC < 0.0 || dyC >= `+j.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `}(g);return this.compileAndRun(S,[o],l.dtype)},c.prototype.maxPool3d=function(o,l){var g=new Qd(l,"max",!1);return this.compileAndRun(g,[o],"float32")},c.prototype.maxPool3dBackprop=function(o,l,g,S){var j=new Qd(S,"max",!0),V=this.compileAndRun(j,[l]),ne=new function(me){this.variableNames=["dy","maxPos"],this.outputShape=me.inShape;var Ee=me.strideDepth,Se=me.strideHeight,Ne=me.strideWidth,ze=me.dilationDepth,$e=me.dilationHeight,qe=me.dilationWidth,tt=me.effectiveFilterDepth,lt=me.effectiveFilterHeight,ht=me.effectiveFilterWidth,vt=tt-1-me.padInfo.front,Ct=lt-1-me.padInfo.top,Vt=ht-1-me.padInfo.left,Yt=tt*lt*ht-1;this.userCode=`
      const ivec3 pads = ivec3(`+vt+", "+Ct+", "+Vt+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < `+tt+`;
           wD += `+ze+`) {
          float dyD = float(dyDCorner + wD) / `+Ee+`.0;

          if (dyD < 0.0 || dyD >= `+me.outDepth+`.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < `+lt+`;
              wR += `+$e+`) {
            float dyR = float(dyRCorner + wR) / `+Se+`.0;

            if (dyR < 0.0 || dyR >= `+me.outHeight+`.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < `+ht+`;
                wC += `+qe+`) {
              float dyC = float(dyCCorner + wC) / `+Ne+`.0;

              if (dyC < 0.0 || dyC >= `+me.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = `+Yt+` -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * `+lt+" * "+ht+` +
                  wR * `+ht+` + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `}(S),ae=this.compileAndRun(ne,[o,V],l.dtype);return V.dispose(),ae},c.prototype.reshape=function(o,l){var g=this.texData.get(o.dataId);if(g.isPacked&&!cu(o.shape,l)&&(g.texture===null||!cu(g.shape,l))){var S=this.packedReshape(o,l);return Ue.makeTensorFromDataId(S.dataId,S.shape,S.dtype)}return ai(o,l)},c.prototype.resizeBilinear=function(o,l,g,S){var j=P().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new function(V,ne,ae,me){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var Ee=V[0],Se=V[1],Ne=V[2],ze=V[3];this.outputShape=[Ee,ne,ae,ze];var $e=[me&&ne>1?Se-1:Se,me&&ae>1?Ne-1:Ne],qe=[me&&ne>1?ne-1:ne,me&&ae>1?ae-1:ae];this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          `+$e[0]/qe[0]+`,
          `+$e[1]/qe[1]+`,
          `+$e[1]/qe[1]+`);
      const vec3 inputShapeRC = vec3(`+Se+".0, "+Ne+`.0,
                                     `+Ne+`.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = vec3(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(sourceFracIndexRC);
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < `+(ze-1)+`;
        bool hasNextRow = coords.z < `+(ae-1)+`;

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `}(o.shape,l,g,S):new function(V,ne,ae,me){this.variableNames=["A"],this.outputShape=[];var Ee=V[0],Se=V[1],Ne=V[2],ze=V[3];this.outputShape=[Ee,ne,ae,ze];var $e=[me&&ne>1?Se-1:Se,me&&ae>1?Ne-1:Ne],qe=[me&&ne>1?ne-1:ne,me&&ae>1?ae-1:ae];this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `+$e[0]/qe[0]+`,
          `+$e[1]/qe[1]+`);
      const vec2 inputShapeRC = vec2(`+Se+".0, "+Ne+`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(sourceFracIndexRC);
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `}(o.shape,l,g,S);return this.compileAndRun(j,[o],"float32")},c.prototype.resizeBilinearBackprop=function(o,l,g){var S=new function(j,V,ne){this.variableNames=["dy"],this.outputShape=[],this.outputShape=V.shape;var ae=V.shape,me=ae[1],Ee=ae[2],Se=j.shape,Ne=Se[1],ze=Se[2],$e=[ne&&Ne>1?me-1:me,ne&&ze>1?Ee-1:Ee],qe=[ne&&Ne>1?Ne-1:Ne,ne&&ze>1?ze-1:ze],tt=$e[0]/qe[0],lt=$e[1]/qe[1],ht=1/tt,vt=1/lt,Ct=2*Math.ceil(ht)+2,Vt=2*Math.ceil(vt)+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`+tt+`);
        const float widthScale = float(`+lt+`);

        const float invHeightScale = float(`+ht+`);
        const float invWidthScale = float(`+vt+`);

        const int winHeight = int(`+Ct+`);
        const int winWidth = int(`+Vt+`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `+Ne+`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `+ze+`) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), `+(me-1)+`.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), `+(Ee-1)+`.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}(o,l,g);return this.compileAndRun(S,[o])},c.prototype.resizeNearestNeighbor=function(o,l,g,S){var j=new function(V,ne,ae,me){this.variableNames=["A"],this.outputShape=[];var Ee=V[0],Se=V[1],Ne=V[2],ze=V[3];this.outputShape=[Ee,ne,ae,ze];var $e=[me&&ne>1?Se-1:Se,me&&ae>1?Ne-1:Ne],qe=[me&&ne>1?ne-1:ne,me&&ae>1?ae-1:ae],tt=me?"0.5":"0.0";this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `+$e[0]/qe[0]+`,
          `+$e[1]/qe[1]+`);
      const vec2 inputShapeRC = vec2(`+Se+".0, "+Ne+`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + `+tt+`)));

        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `}(o.shape,l,g,S);return this.compileAndRun(j,[o])},c.prototype.resizeNearestNeighborBackprop=function(o,l,g){var S=new function(j,V,ne){this.variableNames=["dy"],this.outputShape=[],this.outputShape=V.shape;var ae=V.shape,me=ae[1],Ee=ae[2],Se=j.shape,Ne=Se[1],ze=Se[2],$e=[ne&&Ne>1?me-1:me,ne&&ze>1?Ee-1:Ee],qe=[ne&&Ne>1?Ne-1:Ne,ne&&ze>1?ze-1:ze],tt=$e[0]/qe[0],lt=$e[1]/qe[1],ht=1/tt,vt=1/lt,Ct=2*Math.ceil(ht)+2,Vt=2*Math.ceil(vt)+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`+tt+`);
        const float widthScale = float(`+lt+`);

        const float invHeightScale = float(`+ht+`);
        const float invWidthScale = float(`+vt+`);

        const int winHeight = int(`+Ct+`);
        const int winWidth = int(`+Vt+`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `+Ne+`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `+ze+`) {
              continue;
            }

            float sourceFracRow =
              float(`+$e[0]+`) *
                (float(dyR) / float(`+qe[0]+`));

            float sourceFracCol =
                float(`+$e[1]+`) *
                  (float(dyC) / float(`+qe[1]+`));

            int sourceNearestRow = int(min(
                float(int(`+me+`) - 1),
                `+ne+` ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(`+Ee+`) - 1),
                `+ne+` ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}(o,l,g);return this.compileAndRun(S,[o])},c.prototype.multinomial=function(o,l,g,S){var j=l?o:Be(o),V=j.shape[0],ne=j.shape[1],ae=new Fm(V,ne,g),me=ae.getCustomSetupFunc(S);return this.compileAndRun(ae,[j],"int32",me)},c.prototype.oneHot=function(o,l,g,S){var j=new function(V,ne,ae,me){this.variableNames=["indices"],this.outputShape=[V,ne],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(`+me+"), float("+ae+`),
                      float(index == coords.y)));
      }
    `}(o.size,l,g,S);return this.compileAndRun(j,[o])},c.prototype.diag=function(o){var l=new function(g){this.variableNames=["X"],this.outputShape=[g,g],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `}(o.size);return this.compileAndRun(l,[o])},c.prototype.nonMaxSuppression=function(o,l,g,S,j){return qc("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead"),ia(o.dataSync(),l.dataSync(),g,S,j)},c.prototype.cropAndResize=function(o,l,g,S,j,V){var ne=new function(ae,me,Ee,Se,Ne){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var ze=ae[0],$e=ae[1],qe=ae[2],tt=ae[3],lt=me[0],ht=Ee[0],vt=Ee[1];this.outputShape=[lt,ht,vt,tt];var Ct=Se==="bilinear"?1:0,Vt=[$e-1+".0",qe-1+".0"],Yt=Vt[0],qt=Vt[1],$t=ht>1?[""+($e-1)/(ht-1),"(y2-y1) * height_ratio","y1*"+Yt+" + float(y)*(height_scale)"]:["0.0","0.0","0.5 * (y1+y2) * "+Yt],yn=$t[0],On=$t[1],Cn=$t[2],Xn=vt>1?[""+(qe-1)/(vt-1),"(x2-x1) * width_ratio","x1*"+qt+" + float(x)*(width_scale)"]:["0.0","0.0","0.5 * (x1+x2) * "+qt],er=Xn[0],sr=Xn[1],lr=Xn[2];this.userCode=`
      const float height_ratio = float(`+yn+`);
      const float width_ratio = float(`+er+`);
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= `+ze+`) {
          return;
        }

        float height_scale = `+On+`;
        float width_scale = `+sr+`;

        float in_y = `+Cn+`;
        if( in_y < 0.0 || in_y > `+Yt+` ) {
          setOutput(float(`+Ne+`));
          return;
        }
        float in_x = `+lr+`;
        if( in_x < 0.0 || in_x > `+qt+` ) {
          setOutput(float(`+Ne+`));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(`+Ct+` == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `}(o.shape,l.shape,S,j,V);return this.compileAndRun(ne,[o,l,g],"float32")},c.prototype.depthToSpace=function(o,l,g){ke(l>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+l});var S=o.shape[0],j=g==="NHWC"?o.shape[1]:o.shape[2],V=g==="NHWC"?o.shape[2]:o.shape[3],ne=g==="NHWC"?o.shape[3]:o.shape[1],ae=j*l,me=V*l,Ee=ne/(l*l),Se=new yg(g==="NHWC"?[S,ae,me,Ee]:[S,Ee,ae,me],l,g);return this.compileAndRun(Se,[o])},c.prototype.split=function(o,l,g){return la(o,l,g)},c.prototype.scatterND=function(o,l,g){var S=Qc(0,o,g),j=S.sliceRank,V=S.numUpdates,ne=S.sliceSize,ae=S.strides,me=S.outputSize,Ee=[me/ne,ne],Se=o.reshape([V,j]),Ne=l.reshape([V,ne]);if(me===0)return ai(ko([]),g);var ze=fr(0),$e=new N0(V,j,Se.rank,Ne.rank,ae,Ee);return this.compileAndRun($e,[Ne,Se,ze]).reshape(g)},c.prototype.sparseToDense=function(o,l,g,S){var j=Qc(0,o,g),V=j.sliceRank,ne=j.numUpdates,ae=j.strides,me=j.outputSize,Ee=new N0(ne,V,o.rank,l.rank,ae,[me,1]);return this.compileAndRun(Ee,[l,o,S]).reshape(g)},c.prototype.fft=function(o){return this.fftImpl(o,!1)},c.prototype.ifft=function(o){return this.fftImpl(o,!0)},c.prototype.fftImpl=function(o,l){var g=this.texData.get(o.dataId),S=new Cm("return real * expR - imag * expI;",o.shape,l),j=new Cm("return real * expI + imag * expR;",o.shape,l),V=[this.makeComplexComponentTensorInfo(o,g.complexTensors.real),this.makeComplexComponentTensorInfo(o,g.complexTensors.imag)],ne=this.compileAndRun(S,V),ae=this.compileAndRun(j,V),me=this.complex(ne,ae).as2D(o.shape[0],o.shape[1]);return ne.dispose(),ae.dispose(),me},c.prototype.gatherND=function(o,l){var g=l.shape,S=g[g.length-1],j=$s(o,l),V=j[0],ne=j[1],ae=j[2],me=j[3],Ee=l.reshape([ne,S]),Se=o.reshape([o.size/ae,ae]),Ne=new function(ze,$e,qe){this.sliceDim=ze,this.strides=$e,this.variableNames=["x","indices"],this.outputShape=qe;var tt=Io($e.length),lt=Io(qe.length),ht=this.sliceDim>1?"strides[j]":"strides";this.userCode=`
        `+tt+" strides = "+tt+"("+this.strides+`);
         void main() {
          `+lt+` coords = getOutputCoords();
          int flattenIndex = 0;
          for (int j = 0; j < `+this.sliceDim+`; j++) {
            int index = round(getIndices(coords[0], j));
            flattenIndex += index * `+ht+`;
          }
          setOutput(getX(flattenIndex, coords[1]));
        }
      `}(S,me,[ne,ae]);return this.compileAndRun(Ne,[Se,Ee]).reshape(V)},c.prototype.fill=function(o,l,g){if((g=g||be(l))==="string"){var S=hn(g,Ye(o));return S.fill(l),Ue.makeTensor(S,o,g,this)}var j=new Om(o,l),V=j.getCustomSetupFunc(l);return this.compileAndRun(j,[],g,V)},c.prototype.onesLike=function(o){if(o.dtype==="string")throw new Error("onesLike is not supported under string dtype");return this.fill(o.shape,1,o.dtype)},c.prototype.zerosLike=function(o){return this.fill(o.shape,o.dtype==="string"?"":0,o.dtype)},c.prototype.linspace=function(o,l,g){return li(o,l,g)},c.prototype.makeTensorInfo=function(o,l){var g=this.write(null,o,l);return this.texData.get(g).usage=null,{dataId:g,shape:o,dtype:l}},c.prototype.makeOutput=function(o,l){var g=this.makeTensorInfo(o,l).dataId;return Ue.makeTensorFromDataId(g,o,l,this)},c.prototype.unpackTensor=function(o){var l=new function(g){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=g;var S=g.length,j=da("rc",S),V=Io(S),ne=function(Ee,Se){if(Ee===1)return"rc";for(var Ne="",ze=0;ze<Ee;ze++)Ne+=Se[ze],ze<Ee-1&&(Ne+=",");return Ne}(S,j),ae=j.slice(-2),me=S<=1?"rc":"vec2("+ae.join(",")+")";this.userCode=`
      void main() {
        `+V+` rc = getOutputCoords();
        vec4 packedInput = getA(`+ne+`);

        setOutput(getChannel(packedInput, `+me+`));
      }
    `}(o.shape);return this.runWebGLProgram(l,[o],o.dtype)},c.prototype.packTensor=function(o){var l=new function(g){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=g;var S=g.length;if(S===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{var j=da("rc",S),V=Io(S),ne=function(Ee,Se,Ne){if(Ee===1)return"rc > "+Se[0];for(var ze="",$e=Ee-2;$e<Ee;$e++)ze+=Ne[$e]+" >= "+Se[$e],$e<Ee-1&&(ze+="||");return ze}(S,g,j),ae=function(Ee,Se,Ne,ze){if(Ee===1)return"";var $e=ze.slice(-2);return`
    int r = `+$e[0]+`;
    int c = `+$e[1]+`;
    int rp1 = r + 1;
    int cp1 = c + 1;

    bool cEdge = cp1 >= `+Se+`;
    bool rEdge = rp1 >= `+Ne+`;
  `}(S,g[g.length-1],g[g.length-2],j),me=function(Ee,Se){var Ne=Ee.length,ze=function($e,qe){for(var tt=[],lt=0;lt<=1;lt++)for(var ht=0;ht<=1;ht++){for(var vt=(lt===0?"r":"rp1")+", "+(ht===0?"c":"cp1"),Ct=2;Ct<$e;Ct++)vt=qe[qe.length-1-Ct]+","+vt;tt.push(vt)}return tt}(Ne,Se);return Ne===1?`getA(rc),
            rc + 1 >= `+Ee[0]+` ? 0. : getA(rc + 1),
            0, 0`:"getA("+ze[0]+`),
          cEdge ? 0. : getA(`+ze[1]+`),
          rEdge ? 0. : getA(`+ze[2]+`),
          rEdge || cEdge ? 0. : getA(`+ze[3]+")"}(g,j);this.userCode=`
        void main() {
          `+V+` rc = getOutputCoords();

          if(`+ne+`) {
            setOutput(vec4(0));
          } else {
            `+ae+`

            setOutput(vec4(`+me+`));
          }
        }
      `}}(o.shape);return this.runWebGLProgram(l,[o],o.dtype,null,!0)},c.prototype.packedReshape=function(o,l){var g=[ss(o.shape)].concat(Ca(o.shape)),S={dtype:o.dtype,shape:g,dataId:o.dataId},j=new function(ne,ae){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=ne;for(var me="",Ee=0;Ee<4;Ee++){var Se="thisRC = rc;";Ee%2==1&&(Se+="thisRC.z += 1;"),Ee>1&&(Se+="thisRC.y += 1;"),me+=`
        `+Se+`
        `+(Ee>0?"if(thisRC.y < rows && thisRC.z < cols){":"")+`
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[`+Ee+`] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        `+(Ee>0?"}":"")+`
      `}this.userCode=`
      
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      `+wa(["r","c","d"],ae)+`
      return ivec3(r, c, d);
    }
  
      `+Su(ne)+`

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = `+ne[1]+`;
        int cols = `+ne[2]+`;

        `+me+`

        setOutput(result);
      }
    `}([ss(l)].concat(Ca(l)),g),V=this.runWebGLProgram(j,[S],o.dtype,null,!0);return{dataId:V.dataId,shape:l,dtype:V.dtype}},c.prototype.decode=function(o){var l,g=this.texData.get(o),S=g.isPacked,j=g.shape,V=g.dtype,ne=nc(j);return l=S?new function(ae){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=Zn.DENSE;var me=Ti(ae),Ee=go();this.outputShape=ae,this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        `+wa(["r","c","d"],ae)+`
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx *
          vec2(`+me[0]+", "+me[1]+`));
        int index = 4 * (resTexRC.x * `+me[1]+` + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        `+Ee.output+` = result;
      }
    `}(ne):new function(ae){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=Zn.DENSE;var me=Ti(ae),Ee=go();this.outputShape=ae,this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        `+wa(["r","c","d"],ae)+`
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx *
          vec2(`+me[0]+", "+me[1]+`));
        int index = 4 * (resTexRC.x * `+me[1]+` + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        `+Ee.output+` = result;
      }
    `}(ne),{dtype:V,shape:j,dataId:this.runWebGLProgram(l,[{shape:ne,dtype:V,dataId:o}],V,null,!0).dataId}},c.prototype.runWebGLProgram=function(o,l,g,S,j){var V=this;j===void 0&&(j=!1);var ne=this.makeTensorInfo(o.outputShape,g),ae=this.texData.get(ne.dataId);if(o.packedOutput&&(ae.isPacked=!0),o.outPackingScheme===Zn.DENSE){var me=Ti(o.outputShape);ae.texShape=me.map(function(ht){return 2*ht})}if(o.outTexUsage!=null&&(ae.usage=o.outTexUsage),Ye(ne.shape)===0)return ae.values=Hn(ne.dtype,0),ne;var Ee=[],Se=l.map(function(ht){if(ht.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var vt=V.texData.get(ht.dataId);if(vt.texture==null){if(!o.packedInputs&&Ye(ht.shape)<=P().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:ht.shape,texData:null,isUniform:!0,uniformValues:vt.values};o.packedInputs&&(vt.isPacked=!0,vt.shape=ht.shape)}else if(!!vt.isPacked!=!!o.packedInputs)ht=vt.isPacked?V.unpackTensor(ht):V.packTensor(ht),Ee.push(ht),vt=V.texData.get(ht.dataId);else if(vt.isPacked&&!cu(vt.shape,ht.shape)){var Ct=ht,Vt=ht.shape;ht.shape=vt.shape,ht=V.packedReshape(ht,Vt),Ee.push(ht),vt=V.texData.get(ht.dataId),Ct.shape=Vt}return V.uploadToGPU(ht.dataId),{shape:ht.shape,texData:vt,isUniform:!1}});this.uploadToGPU(ne.dataId);var Ne,ze={shape:ne.shape,texData:ae,isUniform:!1},$e=function(ht,vt,Ct){var Vt="";Se.concat(Ct).forEach(function(qt){var $t=qt.texData!=null&&qt.texData.slice!=null&&qt.texData.slice.flatOffset>0,yn=qt.isUniform?"uniform":qt.texData.texShape;Vt+=qt.shape+"_"+yn+"_"+$t});var Yt=ht.userCode;return ht.constructor.name+"_"+Vt+"_"+Yt}(o,0,ze),qe=this.getAndSaveBinary($e,function(){return function(ht,vt,Ct,Vt){var Yt=vt.userCode,qt=Ct.map(function(or,Er){var kr={logicalShape:or.shape,texShape:or.isUniform?null:or.texData.texShape,isUniform:or.isUniform,isPacked:!or.isUniform&&or.texData.isPacked,flatOffset:null};return or.texData!=null&&or.texData.slice!=null&&or.texData.slice.flatOffset>0&&(kr.flatOffset=or.texData.slice.flatOffset),{name:vt.variableNames[Er],shapeInfo:kr}}),$t=qt.map(function(or){return or.shapeInfo}),yn={logicalShape:Vt.shape,texShape:Vt.texData.texShape,isUniform:!1,isPacked:Vt.texData.isPacked,flatOffset:null},On=Ma(qt,yn,Yt,vt.packedInputs),Cn=ht.createProgram(On),Xn=null,er=ht.getUniformLocation(Cn,"NAN",!1);P().getNumber("WEBGL_VERSION")===1&&(Xn=ht.getUniformLocation(Cn,"INFINITY",!1));for(var sr={},lr=0;lr<vt.variableNames.length;lr++){var ur=vt.variableNames[lr];sr[ur]=ht.getUniformLocation(Cn,ur,!1),sr["offset"+ur]=ht.getUniformLocation(Cn,"offset"+ur,!1)}return{program:vt,source:On,webGLProgram:Cn,uniformLocations:sr,inShapeInfos:$t,outShapeInfo:yn,infLoc:Xn,nanLoc:er}}(V.gpgpu,o,Se,ze)}),tt=this.activeTimers!=null;if(tt&&(Ne=this.startTimer()),function(ht,vt,Ct,Vt,Yt){Nm(vt.inShapeInfos,Ct),Nm([vt.outShapeInfo],[Vt]);var qt=Vt.texData.texture,$t=Vt.texData.texShape;Vt.texData.isPacked?ht.setOutputPackedMatrixTexture(qt,$t[0],$t[1]):ht.setOutputMatrixTexture(qt,$t[0],$t[1]),ht.setProgram(vt.webGLProgram),P().getNumber("WEBGL_VERSION")===1&&vt.infLoc!==null&&ht.gl.uniform1f(vt.infLoc,1/0),vt.nanLoc!==null&&ht.gl.uniform1f(vt.nanLoc,NaN),Ct.forEach(function(yn,On){var Cn=vt.program.variableNames[On],Xn=vt.uniformLocations[Cn],er=vt.uniformLocations["offset"+Cn];if(Xn!=null)if(yn.isUniform)if(Ye(yn.shape)<2)ht.gl.uniform1f(Xn,yn.uniformValues[0]);else{var sr=yn.uniformValues;sr instanceof Float32Array||(sr=new Float32Array(sr)),ht.gl.uniform1fv(Xn,sr)}else yn.texData.slice!=null&&er!=null&&ht.gl.uniform1i(er,yn.texData.slice.flatOffset),ht.setInputMatrixTexture(yn.texData.texture,Xn,On)}),Yt!=null&&Yt(ht,vt.webGLProgram),ht.executeProgram()}(this.gpgpu,qe,Se,ze,S),Ee.forEach(function(ht){return V.disposeData(ht.dataId)}),tt&&(Ne=this.endTimer(Ne),this.activeTimers.push({name:o.constructor.name,query:this.getQueryTime(Ne)})),!P().getBool("WEBGL_LAZILY_UNPACK")&&ae.isPacked&&j===!1){var lt=this.unpackTensor(ne);return this.disposeData(ne.dataId),lt}return ne},c.prototype.compileAndRun=function(o,l,g,S,j){j===void 0&&(j=!1),g=g||l[0].dtype;var V=this.runWebGLProgram(o,l,g,S,j);return Ue.makeTensorFromDataId(V.dataId,V.shape,V.dtype)},c.prototype.getAndSaveBinary=function(o,l){return o in this.binaryCache||(this.binaryCache[o]=l()),this.binaryCache[o]},c.prototype.getTextureManager=function(){return this.textureManager},c.prototype.dispose=function(){var o=this;this.disposed||(P().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(function(l){o.gpgpu.deleteProgram(o.binaryCache[l].webGLProgram),delete o.binaryCache[l]}),this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)},c.prototype.floatPrecision=function(){var o=this;return this.floatPrecisionValue==null&&(this.floatPrecisionValue=Ii(function(){if(!P().get("WEBGL_RENDER_FLOAT32_ENABLED")){var l=P().getBool("DEBUG");P().set("DEBUG",!1);var g=o.abs(fr(1e-8)).dataSync()[0];if(P().set("DEBUG",l),g>0)return 32}return 16})),this.floatPrecisionValue},c.prototype.epsilon=function(){return this.floatPrecision()===32?1e-7:1e-4},c.prototype.uploadToGPU=function(o){var l,g=this.texData.get(o),S=g.shape,j=g.dtype,V=g.values,ne=g.texture,ae=g.usage,me=g.isPacked;if(ne==null){var Ee,Se=this.activeTimers!=null;Se&&(Ee=Zt());var Ne=g.texShape;if(Ne==null&&(Ne=Cl(S,me),g.texShape=Ne),V!=null){var ze=nc(S),$e=void 0,qe=Ne[1],tt=Ne[0],lt=V instanceof Uint8Array;me?(qe=(l=qr(Ne[0],Ne[1]))[0],$e=new function(Yt,qt,$t){$t===void 0&&($t=!1),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var yn=go(),On=qt[0],Cn=qt[1];this.outputShape=Yt;var Xn="",er="result";$t&&(er="floor(result * 255. + 0.5)");for(var sr=0;sr<=1;sr++)for(var lr=0;lr<=1;lr++){var ur=2*sr+lr;Xn+=`
          localCoords = coords;
          if(localCoords[2] + `+lr+" < "+Yt[2]+`) {
            localCoords[2] += `+lr+`;
            if(localCoords[1] + `+sr+" < "+Yt[1]+`) {
              localCoords[1] += `+sr+`;

              flatIndex = getFlatIndex(localCoords);
              offset = imod(flatIndex, 4);

              flatIndex = idiv(flatIndex, 4, 1.);

              r = flatIndex / `+Cn+`;
              c = imod(flatIndex, `+Cn+`);
              uv = (vec2(c, r) + halfCR) / vec2(`+Cn+".0, "+On+`.0);
              values = `+yn.texture2D+`(A, uv);

              if(offset == 0) {
                result[`+ur+`] = values[0];
              } else if(offset == 1) {
                result[`+ur+`] = values[1];
              } else if(offset == 2) {
                result[`+ur+`] = values[2];
              } else {
                result[`+ur+`] = values[3];
              }
            }
          }
        `}this.userCode=`
      `+Su(Yt)+`

      void main() {
        ivec3 coords = getOutputCoords();

        vec4 result = vec4(0.);
        int flatIndex, r, c, offset;
        ivec3 localCoords;
        vec2 uv;
        vec4 values;

        `+Xn+`

        `+yn.output+" = "+er+`;
      }
    `}(ze,[tt=l[1],qe],lt)):$e=new function(Yt,qt,$t){$t===void 0&&($t=!1),this.variableNames=["A"];var yn=go(),On=qt[0],Cn=qt[1];this.outputShape=Yt;var Xn="result";$t&&(Xn="floor(result * 255. + 0.5)"),this.userCode=`
      `+Su(Yt)+`

      void main() {
        ivec3 coords = getOutputCoords();

        int flatIndex = getFlatIndex(coords);
        int offset = imod(flatIndex, 4);

        flatIndex = idiv(flatIndex, 4, 1.);
        
        int r = flatIndex / `+Cn+`;
        int c = imod(flatIndex, `+Cn+`);
        vec2 uv = (vec2(c, r) + halfCR) / vec2(`+Cn+".0, "+On+`.0);
        vec4 values = `+yn.texture2D+`(A, uv);

        float result;

        if(offset == 0) {
          result = values[0];
        } else if(offset == 1) {
          result = values[1];
        } else if(offset == 2) {
          result = values[2];
        } else {
          result = values[3];
        }

        `+yn.output+" = vec4("+Xn+`, 0., 0., 0.);
      }
    `}(ze,[tt,qe],lt);var ht=this.makeTensorInfo([tt,qe],j);this.texData.get(ht.dataId).usage=lt?ir.PIXELS:ir.UPLOAD,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(ht.dataId),qe,tt,V);var vt=this.runWebGLProgram($e,[ht],j,null,!0),Ct=this.texData.get(vt.dataId);g.texture=Ct.texture,g.texShape=Ct.texShape,g.isPacked=Ct.isPacked,g.usage=Ct.usage,this.disposeData(ht.dataId),this.texData.delete(vt.dataId),g.values=null,Se&&(this.uploadWaitMs+=Zt()-Ee)}else{var Vt=this.acquireTexture(Ne,ae,j,me);g.texture=Vt}}},c.prototype.convertAndCacheOnCPU=function(o,l){var g=this.texData.get(o),S=g.dtype;return this.releaseGPUData(o),l!=null&&(g.values=function(j,V){if(V==="float32"||V==="complex64")return j;if(V==="int32"||V==="bool"){for(var ne=V==="int32"?new Int32Array(j.length):new Uint8Array(j.length),ae=0;ae<ne.length;++ae)ne[ae]=Math.round(j[ae]);return ne}throw new Error("Unknown dtype "+V)}(l,S)),g.values},c.prototype.acquireTexture=function(o,l,g,S){if(this.numBytesInGPU+=this.computeBytes(o,g),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){var j=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn("High memory usage in GPU: "+j+" MB, most likely due to a memory leak")}return this.textureManager.acquireTexture(o,l,S)},c.prototype.computeBytes=function(o,l){return o[0]*o[1]*Lt(l)},c}(Wt);function Tu(p,c){return p(c={exports:{}},c.exports),c.exports}Mn()&&Ue.registerBackend("webgl",function(){return new Lp},2);var Hu=Tu(function(p){(function(c,o,l){function g(j,V){return V.c=j.c,V.s0=j.s0,V.s1=j.s1,V.s2=j.s2,V}function S(j,V){var ne=new function(Ee){var Se,Ne=this,ze=(Se=4022871197,function($e){$e=$e.toString();for(var qe=0;qe<$e.length;qe++){var tt=.02519603282416938*(Se+=$e.charCodeAt(qe));tt-=Se=tt>>>0,Se=(tt*=Se)>>>0,Se+=4294967296*(tt-=Se)}return 23283064365386963e-26*(Se>>>0)});Ne.next=function(){var $e=2091639*Ne.s0+23283064365386963e-26*Ne.c;return Ne.s0=Ne.s1,Ne.s1=Ne.s2,Ne.s2=$e-(Ne.c=0|$e)},Ne.c=1,Ne.s0=ze(" "),Ne.s1=ze(" "),Ne.s2=ze(" "),Ne.s0-=ze(Ee),Ne.s0<0&&(Ne.s0+=1),Ne.s1-=ze(Ee),Ne.s1<0&&(Ne.s1+=1),Ne.s2-=ze(Ee),Ne.s2<0&&(Ne.s2+=1),ze=null}(j),ae=V&&V.state,me=ne.next;return me.int32=function(){return 4294967296*ne.next()|0},me.double=function(){return me()+11102230246251565e-32*(2097152*me()|0)},me.quick=me,ae&&(typeof ae=="object"&&g(ae,ne),me.state=function(){return g(ne,{})}),me}o&&o.exports?o.exports=S:this.alea=S})(0,p)}),Fg=Tu(function(p){(function(c,o,l){function g(j,V){return V.x=j.x,V.y=j.y,V.z=j.z,V.w=j.w,V}function S(j,V){var ne=new function(Ee){var Se=this,Ne="";Se.x=0,Se.y=0,Se.z=0,Se.w=0,Se.next=function(){var $e=Se.x^Se.x<<11;return Se.x=Se.y,Se.y=Se.z,Se.z=Se.w,Se.w^=Se.w>>>19^$e^$e>>>8},Ee===(0|Ee)?Se.x=Ee:Ne+=Ee;for(var ze=0;ze<Ne.length+64;ze++)Se.x^=0|Ne.charCodeAt(ze),Se.next()}(j),ae=V&&V.state,me=function(){return(ne.next()>>>0)/4294967296};return me.double=function(){do var Ee=((ne.next()>>>11)+(ne.next()>>>0)/4294967296)/2097152;while(Ee===0);return Ee},me.int32=ne.next,me.quick=me,ae&&(typeof ae=="object"&&g(ae,ne),me.state=function(){return g(ne,{})}),me}o&&o.exports?o.exports=S:this.xor128=S})(0,p)}),np=Tu(function(p){(function(c,o,l){function g(j,V){return V.x=j.x,V.y=j.y,V.z=j.z,V.w=j.w,V.v=j.v,V.d=j.d,V}function S(j,V){var ne=new function(Ee){var Se=this,Ne="";Se.next=function(){var $e=Se.x^Se.x>>>2;return Se.x=Se.y,Se.y=Se.z,Se.z=Se.w,Se.w=Se.v,(Se.d=Se.d+362437|0)+(Se.v=Se.v^Se.v<<4^$e^$e<<1)|0},Se.x=0,Se.y=0,Se.z=0,Se.w=0,Se.v=0,Ee===(0|Ee)?Se.x=Ee:Ne+=Ee;for(var ze=0;ze<Ne.length+64;ze++)Se.x^=0|Ne.charCodeAt(ze),ze==Ne.length&&(Se.d=Se.x<<10^Se.x>>>4),Se.next()}(j),ae=V&&V.state,me=function(){return(ne.next()>>>0)/4294967296};return me.double=function(){do var Ee=((ne.next()>>>11)+(ne.next()>>>0)/4294967296)/2097152;while(Ee===0);return Ee},me.int32=ne.next,me.quick=me,ae&&(typeof ae=="object"&&g(ae,ne),me.state=function(){return g(ne,{})}),me}o&&o.exports?o.exports=S:this.xorwow=S})(0,p)}),Rm=Tu(function(p){(function(c,o,l){function g(j,V){return V.x=j.x.slice(),V.i=j.i,V}function S(j,V){j==null&&(j=+new Date);var ne=new function(Ee){var Se=this;Se.next=function(){var Ne,ze,$e=Se.x,qe=Se.i;return Ne=$e[qe],ze=(Ne^=Ne>>>7)^Ne<<24,ze^=(Ne=$e[qe+1&7])^Ne>>>10,ze^=(Ne=$e[qe+3&7])^Ne>>>3,ze^=(Ne=$e[qe+4&7])^Ne<<7,Ne=$e[qe+7&7],ze^=(Ne^=Ne<<13)^Ne<<9,$e[qe]=ze,Se.i=qe+1&7,ze},function(Ne,ze){var $e,qe=[];if(ze===(0|ze))qe[0]=ze;else for(ze=""+ze,$e=0;$e<ze.length;++$e)qe[7&$e]=qe[7&$e]<<15^ze.charCodeAt($e)+qe[$e+1&7]<<13;for(;qe.length<8;)qe.push(0);for($e=0;$e<8&&qe[$e]===0;++$e);for($e==8?qe[7]=-1:qe[$e],Ne.x=qe,Ne.i=0,$e=256;$e>0;--$e)Ne.next()}(Se,Ee)}(j),ae=V&&V.state,me=function(){return(ne.next()>>>0)/4294967296};return me.double=function(){do var Ee=((ne.next()>>>11)+(ne.next()>>>0)/4294967296)/2097152;while(Ee===0);return Ee},me.int32=ne.next,me.quick=me,ae&&(ae.x&&g(ae,ne),me.state=function(){return g(ne,{})}),me}o&&o.exports?o.exports=S:this.xorshift7=S})(0,p)}),kv=Tu(function(p){(function(c,o,l){function g(j,V){return V.i=j.i,V.w=j.w,V.X=j.X.slice(),V}function S(j,V){j==null&&(j=+new Date);var ne=new function(Ee){var Se=this;Se.next=function(){var Ne,ze,$e=Se.w,qe=Se.X,tt=Se.i;return Se.w=$e=$e+1640531527|0,ze=qe[tt+34&127],Ne=qe[tt=tt+1&127],ze^=ze<<13,Ne^=Ne<<17,ze^=ze>>>15,Ne^=Ne>>>12,ze=qe[tt]=ze^Ne,Se.i=tt,ze+($e^$e>>>16)|0},function(Ne,ze){var $e,qe,tt,lt,ht,vt=[],Ct=128;for(ze===(0|ze)?(qe=ze,ze=null):(ze+="\0",qe=0,Ct=Math.max(Ct,ze.length)),tt=0,lt=-32;lt<Ct;++lt)ze&&(qe^=ze.charCodeAt((lt+32)%ze.length)),lt===0&&(ht=qe),qe^=qe<<10,qe^=qe>>>15,qe^=qe<<4,qe^=qe>>>13,lt>=0&&(ht=ht+1640531527|0,tt=($e=vt[127&lt]^=qe+ht)==0?tt+1:0);for(tt>=128&&(vt[127&(ze&&ze.length||0)]=-1),tt=127,lt=512;lt>0;--lt)qe=vt[tt+34&127],$e=vt[tt=tt+1&127],qe^=qe<<13,$e^=$e<<17,qe^=qe>>>15,$e^=$e>>>12,vt[tt]=qe^$e;Ne.w=ht,Ne.X=vt,Ne.i=tt}(Se,Ee)}(j),ae=V&&V.state,me=function(){return(ne.next()>>>0)/4294967296};return me.double=function(){do var Ee=((ne.next()>>>11)+(ne.next()>>>0)/4294967296)/2097152;while(Ee===0);return Ee},me.int32=ne.next,me.quick=me,ae&&(ae.X&&g(ae,ne),me.state=function(){return g(ne,{})}),me}o&&o.exports?o.exports=S:this.xor4096=S})(0,p)}),F0=Tu(function(p){(function(c,o,l){function g(j,V){return V.a=j.a,V.b=j.b,V.c=j.c,V.d=j.d,V}function S(j,V){var ne=new function(Ee){var Se=this,Ne="";Se.next=function(){var $e=Se.b,qe=Se.c,tt=Se.d,lt=Se.a;return $e=$e<<25^$e>>>7^qe,qe=qe-tt|0,tt=tt<<24^tt>>>8^lt,lt=lt-$e|0,Se.b=$e=$e<<20^$e>>>12^qe,Se.c=qe=qe-tt|0,Se.d=tt<<16^qe>>>16^lt,Se.a=lt-$e|0},Se.a=0,Se.b=0,Se.c=-1640531527,Se.d=1367130551,Ee===Math.floor(Ee)?(Se.a=Ee/4294967296|0,Se.b=0|Ee):Ne+=Ee;for(var ze=0;ze<Ne.length+20;ze++)Se.b^=0|Ne.charCodeAt(ze),Se.next()}(j),ae=V&&V.state,me=function(){return(ne.next()>>>0)/4294967296};return me.double=function(){do var Ee=((ne.next()>>>11)+(ne.next()>>>0)/4294967296)/2097152;while(Ee===0);return Ee},me.int32=ne.next,me.quick=me,ae&&(typeof ae=="object"&&g(ae,ne),me.state=function(){return g(ne,{})}),me}o&&o.exports?o.exports=S:this.tychei=S})(0,p)}),Vl=Tu(function(p){(function(c,o){var l,g=this,S=256,j=6,V="random",ne=o.pow(S,j),ae=o.pow(2,52),me=2*ae,Ee=S-1;function Se(tt,lt,ht){var vt=[],Ct=$e(function qt($t,yn){var On,Cn=[],Xn=typeof $t;if(yn&&Xn=="object")for(On in $t)try{Cn.push(qt($t[On],yn-1))}catch{}return Cn.length?Cn:Xn=="string"?$t:$t+"\0"}((lt=lt==1?{entropy:!0}:lt||{}).entropy?[tt,qe(c)]:tt??function(){try{var qt;return l&&(qt=l.randomBytes)?qt=qt(S):(qt=new Uint8Array(S),(g.crypto||g.msCrypto).getRandomValues(qt)),qe(qt)}catch{var $t=g.navigator,yn=$t&&$t.plugins;return[+new Date,g,yn,g.screen,qe(c)]}}(),3),vt),Vt=new Ne(vt),Yt=function(){for(var qt=Vt.g(j),$t=ne,yn=0;qt<ae;)qt=(qt+yn)*S,$t*=S,yn=Vt.g(1);for(;qt>=me;)qt/=2,$t/=2,yn>>>=1;return(qt+yn)/$t};return Yt.int32=function(){return 0|Vt.g(4)},Yt.quick=function(){return Vt.g(4)/4294967296},Yt.double=Yt,$e(qe(Vt.S),c),(lt.pass||ht||function(qt,$t,yn,On){return On&&(On.S&&ze(On,Vt),qt.state=function(){return ze(Vt,{})}),yn?(o[V]=qt,$t):qt})(Yt,Ct,"global"in lt?lt.global:this==o,lt.state)}function Ne(tt){var lt,ht=tt.length,vt=this,Ct=0,Vt=vt.i=vt.j=0,Yt=vt.S=[];for(ht||(tt=[ht++]);Ct<S;)Yt[Ct]=Ct++;for(Ct=0;Ct<S;Ct++)Yt[Ct]=Yt[Vt=Ee&Vt+tt[Ct%ht]+(lt=Yt[Ct])],Yt[Vt]=lt;(vt.g=function(qt){for(var $t,yn=0,On=vt.i,Cn=vt.j,Xn=vt.S;qt--;)$t=Xn[On=Ee&On+1],yn=yn*S+Xn[Ee&(Xn[On]=Xn[Cn=Ee&Cn+$t])+(Xn[Cn]=$t)];return vt.i=On,vt.j=Cn,yn})(S)}function ze(tt,lt){return lt.i=tt.i,lt.j=tt.j,lt.S=tt.S.slice(),lt}function $e(tt,lt){for(var ht,vt=tt+"",Ct=0;Ct<vt.length;)lt[Ee&Ct]=Ee&(ht^=19*lt[Ee&Ct])+vt.charCodeAt(Ct++);return qe(lt)}function qe(tt){return String.fromCharCode.apply(0,tt)}if(o["seed"+V]=Se,$e(o.random(),c),p.exports){p.exports=Se;try{l=a(390)}catch{}}})([],Math)});Vl.alea=Hu,Vl.xor128=Fg,Vl.xorwow=np,Vl.xorshift7=Rm,Vl.xor4096=kv,Vl.tychei=F0;var Kh=Vl.alea,Wf=wt({addN_:function(p){ke(Array.isArray(p),function(){return"The argument passed to tf.addN() must be a list of tensors"}),ke(p.length>=1,function(){return"Must pass at least one tensor to tf.addN(), but got "+p.length});var c=p.map(function(g,S){return Ke(g,"tensors"+S,"addN")}),o=c[0];c.forEach(function(g){if(g.dtype!==o.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),c.forEach(function(g){if(!ln(g.shape,o.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")});var l=c;return Ue.runKernelFunc(function(g,S){return g.addN(c)},l,null,"AddN")}});function Vf(){Cf("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon")}function Ig(p){return p.rank===0||p.rank===1?p.as4D(1,1,1,p.size):p.rank===2?p.as4D(1,1,p.shape[0],p.shape[1]):p.rank===3?p.as4D(1,p.shape[0],p.shape[1],p.shape[2]):p}function Mm(p,c,o,l,g,S){S==null&&(S=.001);var j,V,ne=Ke(p,"x","batchNorm"),ae=Ke(c,"mean","batchNorm"),me=Ke(o,"variance","batchNorm");g!=null&&(j=Ke(g,"scale","batchNorm")),l!=null&&(V=Ke(l,"offset","batchNorm")),ke(ae.rank===me.rank,function(){return"Batch normalization gradient requires mean and variance to have equal ranks."}),ke(V==null||ae.rank===V.rank,function(){return"Batch normalization gradient requires mean and offset to have equal ranks."}),ke(j==null||ae.rank===j.rank,function(){return"Batch normalization gradient requires mean and scale to have equal ranks."});var Ee={x:ne,scale:j,offset:V,mean:ae,variance:me},Se={varianceEpsilon:S};return Ue.runKernelFunc(function(Ne,ze){var $e=Ig(ne),qe=Ne.batchNormalization($e,qf(ae),qf(me),S,qf(j),qf(V));return ze([ne,ae,me,j]),qe},Ee,null,"FusedBatchNorm",Se).reshape(ne.shape)}function qf(p){return p==null?null:p.rank===0?p.as1D():p.rank===1?p:p.rank===2?p.as4D(1,1,p.shape[0],p.shape[1]):p.rank===3?p.as4D(1,p.shape[0],p.shape[1],p.shape[2]):p}var ro=wt({batchNormalization_:function(p,c,o,l,g,S){return l===void 0&&(l=.001),Vf(),Mm(p,c,o,S,g,l)}}),ql=wt({batchNorm_:Mm});function Xh(p,c,o,l,g,S){var j,V,ne=Ke(p,"x","batchNorm"),ae=Ke(c,"mean","batchNorm"),me=Ke(o,"variance","batchNorm");return g!=null&&(j=Ke(g,"scale","batchNorm")),l!=null&&(V=Ke(l,"offset","batchNorm")),ke(ne.rank===2,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+ne.rank+"."}),ke(ae.rank===2||ae.rank===1,function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank "+ae.rank+"."}),ke(me.rank===2||me.rank===1,function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank "+me.rank+"."}),j!=null&&ke(j.rank===2||j.rank===1,function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank "+j.rank+"."}),V!=null&&ke(V.rank===2||V.rank===1,function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank "+V.rank+"."}),ql(ne,ae,me,V,j,S)}var I0=wt({batchNormalization2d_:function(p,c,o,l,g,S){return l===void 0&&(l=.001),Vf(),Xh(p,c,o,S,g,l)}}),R0=wt({batchNorm2d_:Xh});function zp(p,c,o,l,g,S){var j,V,ne=Ke(p,"x","batchNorm"),ae=Ke(c,"mean","batchNorm"),me=Ke(o,"variance","batchNorm");return g!=null&&(j=Ke(g,"scale","batchNorm")),l!=null&&(V=Ke(l,"offset","batchNorm")),ke(ne.rank===3,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+ne.rank+"."}),ke(ae.rank===3||ae.rank===1,function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank "+ae.rank+"."}),ke(me.rank===3||me.rank===1,function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank "+me.rank+"."}),j!=null&&ke(j.rank===3||j.rank===1,function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank "+j.rank+"."}),V!=null&&ke(V.rank===3||V.rank===1,function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank "+V.rank+"."}),ql(ne,ae,me,V,j,S)}var Hl=wt({batchNormalization3d_:function(p,c,o,l,g,S){return l===void 0&&(l=.001),Vf(),zp(p,c,o,S,g,l)}}),ol=wt({batchNorm3d_:zp});function rp(p,c,o,l,g,S){var j,V,ne=Ke(p,"x","batchNorm"),ae=Ke(c,"mean","batchNorm"),me=Ke(o,"variance","batchNorm");return g!=null&&(j=Ke(g,"scale","batchNorm")),l!=null&&(V=Ke(l,"offset","batchNorm")),ke(ne.rank===4,function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+ne.rank+"."}),ke(ae.rank===4||ae.rank===1,function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank "+ae.rank+"."}),ke(me.rank===4||me.rank===1,function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank "+me.rank+"."}),j!=null&&ke(j.rank===4||j.rank===1,function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank "+j.rank+"."}),V!=null&&ke(V.rank===4||V.rank===1,function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank "+V.rank+"."}),ql(ne,ae,me,V,j,S)}var Yh=wt({batchNormalization4d_:function(p,c,o,l,g,S){return l===void 0&&(l=.001),Vf(),rp(p,c,o,S,g,l)}}),Hf=wt({batchNorm4d_:rp}),$l=wt({broadcastTo_:function(p,c){var o=Ke(p,"broadcastTo","x"),l=o.shape;if(c.some(function(Ee){return!(Ee>0)||Ee%1!=0}))throw new Error("broadcastTo(): Invalid broadcast shape ["+c+"].");if(c.length<o.rank)throw new Error("broadcastTo(): shape.length="+c.length+" < input.rank="+o.rank+".");if(c.length>o.rank){for(var g=o.shape.slice();g.length<c.length;)g.unshift(1);o=o.reshape(g)}for(var S=o.shape,j=Array.from(c),V=c.length-1;V>=0;V--)if(S[V]===c[V])j[V]=1;else if(o.shape[V]!==1)throw new Error("broadcastTo(): ["+l+"] cannot be broadcast to ["+c+"].");var ne=j.map(function(Ee,Se){return Ee>1?Se:-1}).filter(function(Ee){return Ee>=0});if(ne.length===0)return o.clone();var ae={x:o},me={shape:c,inputShape:S};return Ue.runKernelFunc(function(Ee){return Ee.tile(o,j)},ae,function(Ee){return{x:function(){return Ee.sum(ne,!0)}}},Ec,me)}}),Gl=wt({clone_:function(p){var c=Ke(p,"x","clone",null);return Ue.runKernelFunc(function(){return Ue.makeTensorFromDataId(c.dataId,c.shape,c.dtype)},{x:c},null,_f)}}),Nu=wt({logicalAnd_:function(p,c){var o=Ke(p,"a","logicalAnd","bool"),l=Ke(c,"b","logicalAnd","bool");return Mi(o.shape,l.shape),Ue.runKernelFunc(function(g){return g.logicalAnd(o,l)},{a:o,b:l},null,"LogicalAnd")}}),Jh=wt({logicalNot_:function(p){var c=Ke(p,"x","logicalNot","bool");return Ue.runKernelFunc(function(o){return o.logicalNot(c)},{$x:c})}}),$f=wt({logicalOr_:function(p,c){var o=Ke(p,"a","logicalOr","bool"),l=Ke(c,"b","logicalOr","bool");return Mi(o.shape,l.shape),Ue.runKernelFunc(function(g){return g.logicalOr(o,l)},{$a:o,$b:l})}}),al=wt({logicalXor_:function(p,c){var o=Ke(p,"a","logicalXor","bool"),l=Ke(c,"b","logicalXor","bool");return Mi(o.shape,l.shape),$f(p,c).logicalAnd(Nu(p,c).logicalNot())}}),Nc=wt({where_:function(p,c,o){var l=Ke(c,"a","where"),g=Ke(o,"b","where"),S=Ke(p,"condition","where","bool");return Ft(l.shape,g.shape,"Error in where: "),S.rank===1?ke(S.shape[0]===l.shape[0],function(){return"The first dimension of `a` must match the size of `condition`."}):Ft(S.shape,g.shape,"Error in where: "),Ue.runKernelFunc(function(j,V){var ne=j.select(S,l,g);return V([S]),ne},{$condition:S,$a:l,$b:g},function(j,V){var ne=V[0];return{$condition:function(){return ii(ne).toFloat()},$a:function(){return j.mul(ne.cast(j.dtype))},$b:function(){return j.mul(ne.logicalNot().cast(j.dtype))}}})}}),Gf=function(p){return R(this,void 0,void 0,function(){var c,o,l;return W(this,function(g){switch(g.label){case 0:return[4,(c=Ke(p,"condition","whereAsync","bool")).data()];case 1:return o=g.sent(),l=Qo(c.shape,o),p!==c&&c.dispose(),[2,l]}})})},Up=wt({divNoNan_:function(p,c){var o,l=Ke(p,"a","div"),g=Ke(c,"b","div");l=(o=An(l,g))[0],g=o[1];var S=Yo(l,g),j=ii(S),V=g.equal(j);return Nc(V,j,S)}}),Kf=wt({tile_:function(p,c){var o=Ke(p,"x","tile",null);ke(o.rank===c.length,function(){return"Error in transpose: rank of input "+o.rank+" must match length of reps "+c+"."});var l=[o],g={x:o},S={reps:c};return Ue.runKernelFunc(function(j,V){var ne=j.tile(o,c);return V([o]),ne},g,null,Nl,S,l)}}),Fc=wt({eye_:function(p,c,o,l){l===void 0&&(l="float32"),c==null&&(c=p);for(var g=bi([p,c],l),S=p<=c?p:c,j=0;j<S;++j)g.set(1,j,j);var V=g.toTensor().as2D(p,c);if(o==null)return V;if(o.length===1)return Kf(zu(V,0),[o[0],1,1]);if(o.length===2)return Kf(zu(zu(V,0),0),[o[0],o[1],1,1]);if(o.length===3)return Kf(zu(zu(zu(V,0),0),0),[o[0],o[1],o[2],1,1]);throw new Error("eye() currently supports only 1D and 2D batchShapes, but received "+o.length+"D.")}}),ts=wt({multinomial_:function(p,c,o,l){l===void 0&&(l=!1);var g=Ke(p,"logits","multinomial"),S=g.size,j=g.rank;if(S<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+S+".");if(j>2)throw new Error("Rank of probabilities must be 1 or 2, but is "+j);o=o||Math.random();var V=j===1?g.as2D(1,-1):g,ne=Ue.runKernelFunc(function(ae){return ae.multinomial(V,l,c,o)},{logits2D:V});return j===1?ne.as1D():ne}}),fc=wt({oneHot_:function(p,c,o,l){if(o===void 0&&(o=1),l===void 0&&(l=0),c<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+c);var g=Ke(p,"indices","oneHot","int32"),S=g.shape.concat([c]),j={indices:g=g.flatten()},V={depth:c,onValue:o,offValue:l};return Ue.runKernelFunc(function(ne,ae){return ae([g]),ne.oneHot(g,c,o,l)},j,null,Lh,V).reshape(S)}}),Fu=wt({pad_:function(p,c,o){o===void 0&&(o=0);var l=Ke(p,"x","pad");if(l.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var g={paddings:c,constantValue:o},S={x:l};return Ue.runKernelFunc(function(j,V){return V([l]),j.pad(l,c,o)},S,null,Cc,g)}}),fu=wt({pad1d_:function(p,c,o){return o===void 0&&(o=0),ke(c.length===2,function(){return"Invalid number of paddings. Must be length of 2."}),Fu(p,[c],o)}}),Qh=wt({pad2d_:function(p,c,o){return o===void 0&&(o=0),ke(c.length===2&&c[0].length===2&&c[1].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),Fu(p,c,o)}}),Wp=wt({pad3d_:function(p,c,o){return o===void 0&&(o=0),ke(c.length===3&&c[0].length===2&&c[1].length===2&&c[2].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),Fu(p,c,o)}}),jm=wt({pad4d_:function(p,c,o){return o===void 0&&(o=0),ke(c.length===4&&c[0].length===2&&c[1].length===2&&c[2].length===2&&c[3].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),Fu(p,c,o)}}),Bm=wt({rand_:function(p,c,o){var l=Ye(p),g=null;if(o==null||o==="float32")g=new Float32Array(l);else if(o==="int32")g=new Int32Array(l);else{if(o!=="bool")throw new Error("Unknown data type "+o);g=new Uint8Array(l)}for(var S=0;S<l;S++)g[S]=c();return Ue.makeTensor(g,p,o)}}),ip=.001,Ro=.1;function op(){return Ue.backend.floatPrecision()===32?ip:Ro}function hc(p,c,o){var l=!0;if((pt(p)||pt(c))&&(l=!1),pt(p)&&pt(c)&&(l=!0),l){var g=p.constructor.name,S=c.constructor.name;if(g!==S)throw new Error("Arrays are of different type. Actual: "+g+". Expected: "+S)}if(Array.isArray(p)&&Array.isArray(c)){var j=za(p),V=za(c);if(!ln(j,V))throw new Error("Arrays have different shapes. Actual: ["+j+"]. Expected: ["+V+"]")}var ne=pt(p)?p:jt(p),ae=pt(c)?c:jt(c);if(ne.length!==ae.length)throw new Error("Arrays have different lengths actual: "+ne.length+" vs expected: "+ae.length+`.
Actual:   `+ne+`.
Expected: `+ae+".");for(var me=0;me<ae.length;++me){var Ee=ne[me],Se=ae[me];if(!o(Ee,Se))throw new Error("Arrays differ: actual["+me+"] = "+Ee+", expected["+me+"] = "+Se+`.
Actual:   `+ne+`.
Expected: `+ae+".")}}function Xf(p,c,o){return!isFinite(p)&&!isFinite(c)||!(isNaN(p)||isNaN(c)||Math.abs(p-c)>o)}var Yf=Object.freeze({TEST_EPSILON_FLOAT16:Ro,expectArraysClose:function(p,c,o){return o==null&&(o=op()),hc(p,c,function(l,g){return Xf(l,g,o)})},testEpsilon:op,expectPromiseToFail:function(p,c){p().then(function(){return c.fail()},function(){return c()})},expectArraysEqual:function(p,c){var o=typeof c=="string"||typeof c=="number"||typeof c=="boolean"?[c]:c;return Tn(p)||Tn(p[0])||Tn(c)||Tn(c[0])?hc(p,o,function(l,g){return l==g}):hc(p,c,function(l,g){return Xf(l,g,0)})},expectNumbersClose:function(p,c,o){if(o==null&&(o=op()),!Xf(p,c,o))throw new Error("Numbers differ: actual === "+p+", expected === "+c)},expectValuesInRange:function(p,c,o){for(var l=0;l<p.length;l++)if(p[l]<c||p[l]>o)throw new Error("Value out of range:"+p[l]+" low: "+c+", high: "+o)},expectArrayBuffersEqual:function(p,c){expect(new Float32Array(p)).toEqual(new Float32Array(c))}}),ap=function(){function p(c,o,l,g,S){this.mean=c,this.stdDev=o,this.dtype=l,this.nextVal=NaN,this.truncated=g,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var j=S||Math.random();this.random=Kh(j.toString())}return p.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var c=this.nextVal;return this.nextVal=NaN,c}for(var o,l,g=!1;!g;){var S=void 0,j=void 0,V=void 0;do V=(S=2*this.random()-1)*S+(j=2*this.random()-1)*j;while(V>=1||V===0);var ne=Math.sqrt(-2*Math.log(V)/V);o=this.mean+this.stdDev*S*ne,l=this.mean+this.stdDev*j*ne,this.truncated&&!this.isValidTruncated(o)||(g=!0)}return this.truncated&&!this.isValidTruncated(l)||(this.nextVal=this.convertValue(l)),this.convertValue(o)},p.prototype.convertValue=function(c){return this.dtype==null||this.dtype==="float32"?c:Math.round(c)},p.prototype.isValidTruncated=function(c){return c<=this.upper&&c>=this.lower},p}(),Vp=function(){function p(c,o,l,g){this.alpha=c,this.beta=1/o,this.dtype=l;var S=g||Math.random();this.randu=Kh(S.toString()),this.randn=new ap(0,1,l,!1,this.randu()),this.d=c<1?c+2/3:c-1/3,this.c=1/Math.sqrt(9*this.d)}return p.prototype.nextValue=function(){for(var c,o,l,g,S,j;;){do g=this.randn.nextValue(),j=1+this.c*g;while(j<=0);if(j*=j*j,o=1-.331*(c=g*g)*c,l=.5*c+this.d*(1-j+Math.log(j)),(S=this.randu())<o||Math.log(S)<l)break}return j=1/this.beta*this.d*j,this.alpha<1&&(j*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(j)},p.prototype.convertValue=function(c){return this.dtype==="float32"?c:Math.round(c)},p}(),qp=function(){function p(c,o,l,g){var S=this;if(c===void 0&&(c=0),o===void 0&&(o=1),this.canReturnFloat=function(){return S.dtype==null||S.dtype==="float32"},this.min=c,this.range=o-c,this.dtype=l,g==null&&(g=Math.random()),typeof g=="number"&&(g=g.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between "+c+" - "+o+" <= 1 and dtype is not float");this.random=Kh(g)}return p.prototype.convertValue=function(c){return this.canReturnFloat()?c:Math.round(c)},p.prototype.nextValue=function(){return this.convertValue(this.min+this.range*this.random())},p}(),Hp=wt({randomGamma_:function(p,c,o,l,g){if(o===void 0&&(o=1),l===void 0&&(l="float32"),o==null&&(o=1),l==null&&(l="float32"),l!=="float32"&&l!=="int32")throw new Error("Unsupported data type "+l);for(var S=new Vp(c,o,l,g),j=bi(p,l),V=0;V<j.values.length;V++)j.values[V]=S.nextValue();return j.toTensor()}}),Rg=wt({randomNormal_:function(p,c,o,l,g){if(c===void 0&&(c=0),o===void 0&&(o=1),l!=null&&l==="bool")throw new Error("Unsupported data type "+l);for(var S=new ap(c,o,l,!1,g),j=bi(p,l),V=0;V<j.values.length;V++)j.values[V]=S.nextValue();return j.toTensor()}}),$p=wt({randomUniform_:function(p,c,o,l,g){c===void 0&&(c=0),o===void 0&&(o=1),l===void 0&&(l="float32");for(var S=bi(p,l),j=new qp(c,o,null,g),V=0;V<S.values.length;V++)S.values[V]=j.nextValue();return S.toTensor()}}),Kl=wt({square_:function(p){var c=Ke(p,"x","square"),o=[c];return Ue.runKernelFunc(function(l,g){return g([c]),l.square(c)},{x:c},null,"Square",{},o,[])}}),Gp=wt({squaredDifference_:function(p,c){var o,l=Ke(p,"a","squaredDifference"),g=Ke(c,"b","squaredDifference");o=An(l,g),l=o[0],g=o[1],Mi(l.shape,g.shape);var S={a:l,b:g},j=[l,g];return Ue.runKernelFunc(function(V,ne){var ae=V.squaredDifference(l,g);return ne([l,g]),ae},S,function(V,ne){var ae=ne[0],me=ne[1],Ee=fr(2);return{a:function(){return V.mul(ae.sub(me).mul(Ee))},b:function(){return V.mul(me.sub(ae).mul(Ee))}}},Dl,{},j,[])}}),Zh=wt({truncatedNormal_:function(p,c,o,l,g){if(c===void 0&&(c=0),o===void 0&&(o=1),l!=null&&l==="bool")throw new Error("Unsupported data type $ { dtype }");for(var S=new ap(c,o,l,!0,g),j=bi(p,l),V=0;V<j.values.length;V++)j.values[V]=S.nextValue();return j.toTensor()}}),Kp=wt({equal_:function(p,c){var o,l=Ke(p,"a","equal"),g=Ke(c,"b","equal");return o=An(l,g),l=o[0],g=o[1],Mi(l.shape,g.shape),Ue.runKernelFunc(function(S){return S.equal(l,g)},{$a:l,$b:g})}}),Pm=wt({equalStrict_:function(p,c){var o=Ke(p,"a","equalStrict"),l=Ke(c,"b","equalStrict");return Ft(o.shape,l.shape,"Error in equalStrict: "),o.equal(l)}}),Lm=wt({greater_:function(p,c){var o,l=Ke(p,"a","greater"),g=Ke(c,"b","greater");return o=An(l,g),l=o[0],g=o[1],Mi(l.shape,g.shape),Ue.runKernelFunc(function(S){return S.greater(l,g)},{a:l,b:g},null,"Greater")}}),sp=wt({greaterEqual_:function(p,c){var o,l=Ke(p,"a","greaterEqual"),g=Ke(c,"b","greaterEqual");return o=An(l,g),l=o[0],g=o[1],Mi(l.shape,g.shape),Ue.runKernelFunc(function(S,j){var V=S.greaterEqual(l,g);return j([l,g]),V},{a:l,b:g},function(S,j){var V=j[0],ne=j[1];return{a:function(){return ii(V)},b:function(){return ii(ne)}}},"GreaterEqual")}}),zm=wt({greaterEqualStrict_:function(p,c){var o=Ke(p,"a","greaterEqualStrict"),l=Ke(c,"b","greaterEqualStrict");return Ft(o.shape,l.shape,"Error in greaterEqualStrict: "),o.greaterEqual(l)}}),Xp=wt({greaterStrict_:function(p,c){var o=Ke(p,"a","greaterStrict"),l=Ke(c,"b","greaterStrict");return Ft(o.shape,l.shape,"Error in greaterStrict: "),o.greater(l)}}),Mg=wt({less_:function(p,c){var o,l=Ke(p,"a","less"),g=Ke(c,"b","less");return o=An(l,g),l=o[0],g=o[1],Mi(l.shape,g.shape),Ue.runKernelFunc(function(S){return S.less(l,g)},{a:l,b:g},null,"Less")}}),sl=wt({lessEqual_:function(p,c){var o,l=Ke(p,"a","lessEqual"),g=Ke(c,"b","lessEqual");return o=An(l,g),l=o[0],g=o[1],Mi(l.shape,g.shape),Ue.runKernelFunc(function(S,j){var V=S.lessEqual(l,g);return j([l,g]),V},{a:l,b:g},null,"LessEqual")}}),M0=wt({lessEqualStrict_:function(p,c){var o=Ke(p,"a","lessEqualStrict"),l=Ke(c,"b","lessEqualStrict");return Ft(o.shape,l.shape,"Error in lessEqualStrict: "),o.lessEqual(l)}}),jg=wt({lessStrict_:function(p,c){var o=Ke(p,"a","lessStrict"),l=Ke(c,"b","lessStrict");return Ft(o.shape,l.shape,"Error in lessStrict: "),o.less(l)}}),up=wt({notEqual_:function(p,c){var o,l=Ke(p,"a","notEqual"),g=Ke(c,"b","notEqual");return o=An(l,g),l=o[0],g=o[1],Mi(l.shape,g.shape),Ue.runKernelFunc(function(S){return S.notEqual(l,g)},{a:l,b:g},null,"NotEqual")}}),Bg=wt({notEqualStrict_:function(p,c){var o=Ke(p,"a","notEqualStrict"),l=Ke(c,"b","notEqualStrict");return Ft(o.shape,l.shape,"Error in notEqualStrict: "),o.notEqual(l)}});function Xl(p,c){for(var o=[],l=p;l<c;++l)o.push(l);return o}function Pg(p){for(var c=[],o=0;o<p.length;++o)for(var l=0;l<p[o].length;++l)c.push(p[o][l]);return c}var cp=wt({gather_:function(p,c,o){o===void 0&&(o=0);var l=Ke(p,"x","gather"),g=Ke(c,"indices","gather","int32");o=wn(o,l.shape)[0];var S=function(j,V,ne){for(var ae=j.shape[ne],me=[],Ee=1,Se=1,Ne=0;Ne<ne;Ne++)me.push(j.shape[Ne]),Ee*=j.shape[Ne];for(Ne=0;Ne<V.rank;Ne++)me.push(V.shape[Ne]);for(Ne=ne+1;Ne<j.rank;Ne++)me.push(j.shape[Ne]),Se*=j.shape[Ne];return{batchSize:Ee,sliceSize:Se,dimSize:ae,outputShape:me}}(l,g,o);return Ue.runKernelFunc(function(j,V){var ne=j.gather(l,g.flatten(),o);return V([g]),ne},{x:l,indices:g},function(j,V){var ne=V[0];return{x:function(){var ae=l.shape,me=ne.size,Ee=ae.slice(0,o),Se=Ee.length,Ne=ae.slice(o,ae.length).slice(1),ze=Ne.length,$e=Xl(0,Se),qe=Xl(Se+1,Se+1+ze),tt=Pg([Ee,[me],Ne]),lt=j.reshape(tt),ht=ne.reshape([me]),vt=Pg([[Se],$e,qe]),Ct=lt.transpose(vt),Vt=Yp(Ct,ht,l.shape[o]),Yt=wu(vt);return Vt.transpose(Yt)},indices:function(){return ne}}},"Gather",{axis:o}).reshape(S.outputShape)}}),Yp=wt({unsortedSegmentSum_:function(p,c,o){var l=Ke(p,"x","unsortedSegmentSum"),g=Ke(c,"segmentIds","unsortedSegmentSum","int32");return ke(nn(o),function(){return"numSegments must be of dtype int"}),Ue.runKernelFunc(function(S,j){var V=S.unsortedSegmentSum(l,g,o);return j([g]),V},{$x:l},function(S,j){var V=j[0];return{$x:function(){return function(ne,ae){for(var me=xa(ae,ii(ae)),Ee=cp(ne,me),Se=sp(ae,fr(0,"int32")),Ne=Ee.rank-Se.rank,ze=0;ze<Ne;++ze)Se=zu(Se,ze+1);Se=Nu(Se,lu(Ee.shape,"bool"));var $e=ii(Ee);return Nc(Se,Ee,$e)}(S,V)}}})}}),Lg=function(p,c,o){return R(this,void 0,void 0,function(){var l,g,S,j,V,ne,ae,me,Ee,Se,Ne,ze,$e;return W(this,function(qe){switch(qe.label){case 0:for(l=Ke(p,"tensor","boolMask"),g=Ke(c,"mask","boolMask","bool"),S=o??0,j=g.rank,V=l.shape,ke(j>0,function(){return"mask cannot be scalar"}),Ft(V.slice(S,S+j),g.shape,"mask's shape must match the first K dimensions of tensor's shape,"),ne=1,ae=S;ae<S+j;ae++)ne*=V[ae];return me=V.slice(0,S).concat([ne],V.slice(S+j)),Ee=l.reshape(me),Se=g.reshape([-1]),[4,Gf(Se)];case 1:return Ne=qe.sent(),ze=Ne.squeeze([1]),$e=cp(Ee,ze,S),p!==l&&l.dispose(),c!==g&&g.dispose(),ze.dispose(),Ee.dispose(),Se.dispose(),Ne.dispose(),[2,$e]}})})};function zg(p,c,o,l,g,S,j){S===void 0&&(S="NHWC"),ke(p.length===c.rank,function(){return"Length of inShape ("+p.length+") and rank of dy ("+c.rank+") must match"});var V=p,ne=c,ae=!1;c.rank===3&&(ae=!0,ne=c.as4D(1,c.shape[0],c.shape[1],c.shape[2]),V=[1,p[0],p[1],p[2]]),ke(V.length===4,function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+V.length+"."}),ke(ne.rank===4,function(){return"Error in conv2dDerInput: dy must be rank 4, but got rank "+ne.rank}),ke(o.rank===4,function(){return"Error in conv2dDerInput: filter must be rank 4, but got rank "+o.rank});var me=S==="NHWC"?V[3]:V[1],Ee=S==="NHWC"?ne.shape[3]:ne.shape[1];ke(me===o.shape[2],function(){return"Error in conv2dDerInput: depth of input ("+me+") must match input depth for filter "+o.shape[2]+"."}),ke(Ee===o.shape[3],function(){return"Error in conv2dDerInput: depth of output ("+Ee+") must match output depth for filter "+o.shape[3]+"."}),j!=null&&ke(nn(g),function(){return"Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode "+j+" but got pad "+g+"."});var Se=$r(S),Ne=Nn(V,o.shape,l,1,g,j,!1,Se),ze=Ue.runKernelFunc(function($e,qe){var tt=$e.conv2dDerInput(ne,o,Ne);return qe([o,ne]),tt},{dy4D:ne,filter:o},function($e,qe){var tt=qe[0],lt=qe[1];return{dy4D:function(){return Jf($e,tt,l,g,S,1,j)},filter:function(){return Vg($e,lt,tt.shape,l,g,S,j)}}});return ae?ze.as3D(ze.shape[1],ze.shape[2],ze.shape[3]):ze}function Um(p){var c=function(S){return typeof S=="number"?[S,S,S]:S.length===2?[S[0],S[1],1]:S}(p),o=c[0],l=c[1],g=c[2];return o===1&&l===1&&g===1}function Ug(p,c,o,l,g){ke(p.length===c.rank,function(){return"Length of inShape ("+p.length+") and rank of dy ("+c.rank+") must match"});var S=p,j=c,V=!1;c.rank===4&&(V=!0,j=c.as5D(1,c.shape[0],c.shape[1],c.shape[2],c.shape[3]),S=[1,p[0],p[1],p[2],p[3]]);var ne=S[4],ae=j.shape[4];ke(S.length===5,function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+S.length+"."}),ke(j.rank===5,function(){return"Error in conv3dDerInput: dy must be rank 5, but got rank "+j.rank}),ke(o.rank===5,function(){return"Error in conv3dDerInput: filter must be rank 5, but got rank "+o.rank}),ke(ne===o.shape[3],function(){return"Error in conv3dDerInput: depth of input ("+ne+") must match input depth for filter "+o.shape[3]+"."}),ke(ae===o.shape[4],function(){return"Error in conv3dDerInput: depth of output ("+ae+") must match output depth for filter "+o.shape[4]+"."});var me=Wn(S,o.shape,l,1,g),Ee=Ue.runKernelFunc(function(Se){return Se.conv3dDerInput(j,o,me)},{dy5D:j});return V?Ee.as4D(Ee.shape[1],Ee.shape[2],Ee.shape[3],Ee.shape[4]):Ee}var Wg=wt({conv1d_:function(p,c,o,l,g,S,j){g===void 0&&(g="NWC"),S===void 0&&(S=1);var V=Ke(p,"x","conv1d"),ne=Ke(c,"filter","conv1d"),ae=V,me=!1;V.rank===2&&(me=!0,ae=V.as3D(1,V.shape[0],V.shape[1])),ke(ae.rank===3,function(){return"Error in conv1d: input must be rank 3, but got rank "+ae.rank+"."}),ke(ne.rank===3,function(){return"Error in conv1d: filter must be rank 3, but got rank "+ne.rank+"."}),j!=null&&ke(nn(l),function(){return"Error in conv1d: pad must be an integer when using, dimRoundingMode "+j+" but got pad "+l+"."}),ke(ae.shape[2]===ne.shape[1],function(){return"Error in conv1d: depth of input ("+ae.shape[2]+") must match input depth for filter "+ne.shape[1]+"."}),ke(xr(o,S),function(){return"Error in conv1D: Either stride or dilation must be 1. Got stride "+o+" and dilation '"+S+"'"}),ke(g==="NWC",function(){return"Error in conv1d: got dataFormat of "+g+" but only NWC is currently supported."});var Ee=ne.as4D(1,ne.shape[0],ne.shape[1],ne.shape[2]),Se=ae.as4D(ae.shape[0],1,ae.shape[1],ae.shape[2]),Ne=Jf(Se,Ee,[1,o],l,"NHWC",[1,S],j);return me?Ne.as2D(Ne.shape[2],Ne.shape[3]):Ne.as3D(Ne.shape[0],Ne.shape[2],Ne.shape[3])}}),Jf=wt({conv2d_:function(p,c,o,l,g,S,j){g===void 0&&(g="NHWC"),S===void 0&&(S=[1,1]);var V=Ke(p,"x","conv2d"),ne=Ke(c,"filter","conv2d"),ae=V,me=!1;V.rank===3&&(me=!0,ae=V.as4D(1,V.shape[0],V.shape[1],V.shape[2])),ke(ae.rank===4,function(){return"Error in conv2d: input must be rank 4, but got rank "+ae.rank+"."}),ke(ne.rank===4,function(){return"Error in conv2d: filter must be rank 4, but got rank "+ne.rank+"."}),j!=null&&ke(nn(l),function(){return"Error in conv2d: pad must be an integer when using, dimRoundingMode "+j+" but got pad "+l+"."});var Ee=g==="NHWC"?ae.shape[3]:ae.shape[1];ke(Ee===ne.shape[2],function(){return"Error in conv2d: depth of input ("+Ee+") must match input depth for filter "+ne.shape[2]+"."}),ke(xr(o,S),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+o+" and dilations '"+S+"'"});var Se=$r(g),Ne=Nn(ae.shape,ne.shape,o,S,l,j,!1,Se),ze=[ne,ae],$e=Ue.runKernelFunc(function(qe,tt){var lt=qe.conv2d(ae,ne,Ne);return tt([ne,ae]),lt},{x:ae,filter:ne},function(qe,tt){var lt=tt,ht=lt[0],vt=lt[1];return ke(Vr(S),function(){return"Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+S+"'"}),{x:function(){return ul(vt.shape,qe,ht,o,l,g)},filter:function(){return Vg(vt,qe,ht.shape,o,l,g)}}},"Conv2D",Ne,ze);return me?$e.as3D($e.shape[1],$e.shape[2],$e.shape[3]):$e}}),j0=wt({conv3d_:function(p,c,o,l,g,S){g===void 0&&(g="NDHWC"),S===void 0&&(S=[1,1,1]);var j=Ke(p,"x","conv3d"),V=Ke(c,"filter","conv3d"),ne=j,ae=!1;j.rank===4&&(ae=!0,ne=j.as5D(1,j.shape[0],j.shape[1],j.shape[2],j.shape[3])),ke(ne.rank===5,function(){return"Error in conv3d: input must be rank 5, but got rank "+ne.rank+"."}),ke(V.rank===5,function(){return"Error in conv3d: filter must be rank 5, but got rank "+V.rank+"."}),ke(ne.shape[4]===V.shape[3],function(){return"Error in conv3d: depth of input ("+ne.shape[4]+") must match input depth for filter "+V.shape[3]+"."}),ke(function(Se,Ne){return Um(o)||Um(Ne)}(0,S),function(){return"Error in conv3D: Either strides or dilations must be 1. Got strides "+o+" and dilations '"+S+"'"}),ke(g==="NDHWC",function(){return"Error in conv3d: got dataFormat of "+g+" but only NDHWC is currently supported."});var me=Wn(ne.shape,V.shape,o,S,l),Ee=Ue.runKernelFunc(function(Se,Ne){var ze=Se.conv3d(ne,V,me);return Ne([ne,V]),ze},{x:ne,$filter:V},function(Se,Ne){ke(Um(S),function(){return"Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+S+"'"});var ze=Ne[0],$e=Ne[1];return{x:function(){return Ug(ze.shape,Se,$e,o,l)},$filter:function(){return function(qe,tt,lt,ht,vt){var Ct=qe;qe.rank===4&&(Ct=qe.as5D(1,qe.shape[0],qe.shape[1],qe.shape[2],qe.shape[3]));var Vt=tt;Vt.rank===4&&(Vt=tt.as5D(1,tt.shape[0],tt.shape[1],tt.shape[2],tt.shape[3])),ke(Ct.rank===5,function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape "+Ct.shape+"."}),ke(Vt.rank===5,function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape "+Vt.shape+"."}),ke(lt.length===5,function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got "+lt+"."}),ke(Ct.shape[4]===lt[3],function(){return"Error in conv3dDerFilter: depth of input "+Ct.shape[4]+") must match input depth in filter ("+lt[3]+"."}),ke(Vt.shape[4]===lt[4],function(){return"Error in conv3dDerFilter: depth of dy ("+Vt.shape[4]+") must match output depth for filter ("+lt[4]+")."});var Yt=Wn(Ct.shape,lt,ht,1,vt);return Ue.runKernelFunc(function(qt){return qt.conv3dDerFilter(Ct,Vt,Yt)},{x5D:Ct,dy5D:Vt})}(ze,Se,$e.shape,o,l)}}});return ae?Ee.as4D(Ee.shape[1],Ee.shape[2],Ee.shape[3],Ee.shape[4]):Ee}}),Vg=wt({conv2dDerFilter_:function(p,c,o,l,g,S,j){S===void 0&&(S="NHWC");var V=p;p.rank===3&&(V=p.as4D(1,p.shape[0],p.shape[1],p.shape[2]));var ne=c;ne.rank===3&&(ne=c.as4D(1,c.shape[0],c.shape[1],c.shape[2])),ke(V.rank===4,function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+V.shape+"."}),ke(ne.rank===4,function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+ne.shape+"."}),ke(o.length===4,function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+o+"."});var ae=S==="NHWC"?V.shape[3]:V.shape[1],me=S==="NHWC"?ne.shape[3]:ne.shape[1];ke(ae===o[2],function(){return"Error in conv2dDerFilter: depth of input "+ae+") must match input depth in filter ("+o[2]+"."}),ke(me===o[3],function(){return"Error in conv2dDerFilter: depth of dy ("+me+") must match output depth for filter ("+o[3]+")."}),j!=null&&ke(nn(g),function(){return"Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode "+j+" but got pad "+g+"."});var Ee=$r(S),Se=Nn(V.shape,o,l,1,g,j,!1,Ee);return Ue.runKernelFunc(function(Ne){return Ne.conv2dDerFilter(V,ne,Se)},{x4D:V,dy4D:ne})}}),ul=wt({conv2dDerInput_:zg}),Wm=wt({depthwiseConv2d_:function(p,c,o,l,g,S,j){S===void 0&&(S=[1,1]);var V=Ke(p,"x","depthwiseConv2d"),ne=Ke(c,"filter","depthwiseConv2d"),ae=V,me=!1;V.rank===3&&(me=!0,ae=V.as4D(1,V.shape[0],V.shape[1],V.shape[2])),ke(ae.rank===4,function(){return"Error in depthwiseConv2d: input must be rank 4, but got rank "+ae.rank+"."}),ke(ne.rank===4,function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+ne.rank+"."}),ke(ae.shape[3]===ne.shape[2],function(){return"Error in depthwiseConv2d: number of input channels ("+ae.shape[3]+") must match the inChannels dimension in filter "+ne.shape[2]+"."}),S==null&&(S=[1,1]),ke(xr(o,S),function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides "+o+" and dilations '"+S+"'"}),j!=null&&ke(nn(l),function(){return"Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode "+j+" but got pad "+l+"."});var Ee=Nn(ae.shape,ne.shape,o,S,l,j,!0),Se=[ae,ne],Ne=Ue.runKernelFunc(function(ze,$e){var qe=ze.depthwiseConv2D(ae,ne,Ee);return $e([ae,ne]),qe},{x:ae,filter:ne},function(ze,$e){ke(Vr(S),function(){return"Error in gradient of depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+S+"'"});var qe=$e[0],tt=$e[1];return{x:function(){return qg(qe.shape,ze,tt,Ee)},filter:function(){return Qf(qe,ze,tt.shape,Ee)}}},"DepthwiseConv2dNative",Ee,Se);return me?Ne.as3D(Ne.shape[1],Ne.shape[2],Ne.shape[3]):Ne}}),qg=wt({depthwiseConv2dDerInput_:function(p,c,o,l){var g=c,S=!1;c.rank===3&&(S=!0,g=c.as4D(1,c.shape[0],c.shape[1],c.shape[2]));var j=Ue.runKernelFunc(function(V){return V.depthwiseConv2DDerInput(g,o,l)},{dy4D:g});return S?j.as3D(j.shape[1],j.shape[2],j.shape[3]):j}}),Qf=wt({depthwiseConv2dDerFilter_:function(p,c,o,l){var g=p;p.rank===3&&(g=p.as4D(1,p.shape[0],p.shape[1],p.shape[2]));var S=c;return S.rank===3&&(S=c.as4D(1,c.shape[0],c.shape[1],c.shape[2])),Ue.runKernelFunc(function(j){return j.depthwiseConv2DDerFilter(g,S,l)},{x4D:g,dy4D:S})}}),cl=wt({separableConv2d_:function(p,c,o,l,g,S,j){S===void 0&&(S=[1,1]),j===void 0&&(j="NHWC");var V=Ke(p,"x","separableConv2d"),ne=Ke(c,"depthwiseFilter","separableConv2d"),ae=Ke(o,"pointwiseFilter","separableConv2d"),me=V,Ee=!1;if(V.rank===3&&(Ee=!0,me=V.as4D(1,V.shape[0],V.shape[1],V.shape[2])),j==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");ke(me.rank===4,function(){return"Error in separableConv2d: input must be rank 4, but got rank "+me.rank+"."}),ke(ne.rank===4,function(){return"Error in separableConv2d: depthwise filter must be rank 4, but got rank "+ne.rank+"."}),ke(ae.rank===4,function(){return"Error in separableConv2d: pointwise filter must be rank 4, but got rank "+ne.rank+"."}),ke(ae.shape[0]===1,function(){return"Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got "+ae.shape[0]+"."}),ke(ae.shape[1]===1,function(){return"Error in separableConv2d: the second dimension of pointwise filter must be 1, but got "+ae.shape[1]+"."});var Se=ne.shape[2],Ne=ne.shape[3];ke(ae.shape[2]===Se*Ne,function(){return"Error in separableConv2d: the third dimension of pointwise filter must be "+Se*Ne+", but got "+ae.shape[2]+"."});var ze=Wm(me,ne,l,g,j,S),$e=Jf(ze,ae,1,"valid",j);return Ee?$e.as3D($e.shape[1],$e.shape[2],$e.shape[3]):$e}}),Jp=wt({conv2dTranspose_:function(p,c,o,l,g,S){return zg(o,Ke(p,"x","conv2dTranspose"),Ke(c,"filter","conv2dTranspose"),l,g,"NHWC",S)}}),Vm=wt({conv3dTranspose_:function(p,c,o,l,g){return Ug(o,Ke(p,"x","conv3dTranspose"),Ke(c,"filter","conv3dTranspose"),l,g)}}),dc=wt({matMul_:function(p,c,o,l){var g;o===void 0&&(o=!1),l===void 0&&(l=!1);var S=Ke(p,"a","matMul"),j=Ke(c,"b","matMul");g=An(S,j),S=g[0],j=g[1];var V=o?S.shape[S.rank-2]:S.shape[S.rank-1],ne=l?j.shape[j.rank-1]:j.shape[j.rank-2],ae=o?S.shape[S.rank-1]:S.shape[S.rank-2],me=l?j.shape[j.rank-2]:j.shape[j.rank-1],Ee=S.shape.slice(0,-2),Se=j.shape.slice(0,-2),Ne=Ye(Ee),ze=Ye(Se);ke(S.rank>=2&&j.rank>=2&&S.rank===j.rank,function(){return"Error in matMul: inputs must have the same rank of at least 2, got ranks "+S.rank+" and "+j.rank+"."}),ke(ln(Ee,Se),function(){return"Error in matMul: outer dimensions ("+Ee+") and ("+Se+") of Tensors with shapes "+S.shape+" and "+j.shape+" must match."}),ke(V===ne,function(){return"Error in matMul: inner shapes ("+V+") and ("+ne+") of Tensors with shapes "+S.shape+" and "+j.shape+" and transposeA="+o+" and transposeB="+l+" must match."});var $e=S.shape.slice(0,-2).concat([ae,me]),qe=o?S.as3D(Ne,V,ae):S.as3D(Ne,ae,V),tt=l?j.as3D(ze,me,ne):j.as3D(ze,ne,me),lt={transposeA:o,transposeB:l};return Ue.runKernelFunc(function(ht,vt){var Ct=ht.batchMatMul(qe,tt,o,l);return vt([qe,tt]),Ct},{a:qe,b:tt},function(ht,vt){var Ct=vt,Vt=Ct[0],Yt=Ct[1];return o||l?!o&&l?{a:function(){return ht.matMul(Yt,!1,!1)},b:function(){return ht.matMul(Vt,!0,!1)}}:o&&!l?{a:function(){return Yt.matMul(ht,!1,!0)},b:function(){return Vt.matMul(ht,!1,!1)}}:{a:function(){return Yt.matMul(ht,!0,!0)},b:function(){return ht.matMul(Vt,!0,!0)}}:{a:function(){return ht.matMul(Yt,!1,!0)},b:function(){return Vt.matMul(ht,!0,!1)}}},"BatchMatMul",lt).reshape($e)}}),qm=wt({dot_:function(p,c){var o=Ke(p,"t1","dot"),l=Ke(c,"t2","dot");ke(!(o.rank!==1&&o.rank!==2||l.rank!==1&&l.rank!==2),function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+o.rank+" and "+l.rank+"."});var g=o.rank===1?o.size:o.shape[1],S=l.rank===1?l.size:l.shape[0];return ke(g===S,function(){return"Error in dot: inner dimensions of inputs must match, but got "+g+" and "+S+"."}),o.rank===1&&l.rank===1?o.as2D(1,-1).matMul(l.as2D(-1,1)).asScalar():o.rank===1&&l.rank===2?o.as2D(1,-1).matMul(l.as2D(l.shape[0],l.shape[1])).as1D():o.rank===2&&l.rank===1?o.matMul(l.as2D(-1,1)).as1D():o.matMul(l.as2D(l.shape[0],l.shape[1]))}}),Hg=wt({outerProduct_:function(p,c){var o=Ke(p,"v1","outerProduct"),l=Ke(c,"v2","outerProduct");return ke(o.rank===1&&l.rank===1,function(){return"Error in outerProduct: inputs must be rank 1, but got ranks "+o.rank+" and "+l.rank+"."}),o.as2D(-1,1).matMul(l.as2D(1,-1))}}),Yl=wt({reverse_:function(p,c){var o=Ke(p,"x","reverse");if(o.rank===0)return o.clone();var l=wn(c,o.shape);return Ue.runKernelFunc(function(g){return g.reverse(o,l)},{$x:o},function(g){return{$x:function(){return g.reverse(l)}}}).reshapeAs(o)}}),B0=wt({reverse1d_:function(p){var c=Ke(p,"x","reverse");return ke(c.rank===1,function(){return"Error in reverse1D: x must be rank 1 but got rank "+c.rank+"."}),Yl(c,0)}}),ed=wt({reverse2d_:function(p,c){var o=Ke(p,"x","reverse");return ke(o.rank===2,function(){return"Error in reverse2D: x must be rank 2 but got rank "+o.rank+"."}),Yl(o,c)}}),td=wt({reverse3d_:function(p,c){var o=Ke(p,"x","reverse");return ke(o.rank===3,function(){return"Error in reverse3D: x must be rank 3 but got rank "+o.rank+"."}),Yl(o,c)}}),Jl=wt({reverse4d_:function(p,c){var o=Ke(p,"x","reverse");return ke(o.rank===4,function(){return"Error in reverse4D: x must be rank 4 but got rank "+o.rank+"."}),Yl(o,c)}});function $g(p,c,o,l,g,S){var j=Ke(p,"x","maxPool"),V=j,ne=!1;j.rank===3&&(ne=!0,V=j.as4D(1,j.shape[0],j.shape[1],j.shape[2])),l==null&&(l=[1,1]),ke(V.rank===4,function(){return"Error in maxPool: input must be rank 4 but got rank "+V.rank+"."}),ke(xr(o,l),function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides "+o+" and dilations '"+l+"'"}),S!=null&&ke(nn(g),function(){return"Error in maxPool: pad must be an integer when using, dimRoundingMode "+S+" but got pad "+g+"."});var ae=bn(V.shape,c,o,l,g,S);if(ae.filterWidth===1&&ae.filterHeight===1&&ln(ae.inShape,ae.outShape))return j.clone();var me=[V],Ee=Ue.runKernelFunc(function(Se,Ne){var ze=Se.maxPool(V,ae);return Ne([V,ze]),ze},{x:V},function(Se,Ne){var ze=Ne[0],$e=Ne[1];return{x:function(){return function(qe,tt,lt,ht,vt,Ct,Vt,Yt){var qt=Ke(qe,"dy","maxPoolBackprop"),$t=Ke(tt,"input","maxPoolBackprop"),yn=Ke(lt,"output","maxPoolBackprop");ke($t.rank===qt.rank,function(){return"Rank of input ("+$t.rank+") does not match rank of dy ("+qt.rank+")"}),Ct==null&&(Ct=[1,1]),ke(xr(vt,Ct),function(){return"Error in maxPoolBackProp: Either strides or dilations must be 1. Got strides "+vt+" and dilations '"+Ct+"'"}),ke(qt.rank===4,function(){return"Error in maxPoolBackprop: dy must be rank 4 but got rank "+qt.rank+"."}),ke($t.rank===4,function(){return"Error in maxPoolBackprop: input must be rank 4 but got rank "+$t.rank+"."});var On=bn($t.shape,ht,vt,Ct,Vt,Yt);return Ue.runKernelFunc(function(Cn){return Cn.maxPoolBackprop(qt,$t,yn,On)},{$dy:qt,$input:$t})}(Se,ze,$e,c,o,l,g)}}},"MaxPool",ae,me);return ne?Ee.as3D(Ee.shape[1],Ee.shape[2],Ee.shape[3]):Ee}function Zf(p,c,o,l,g,S){var j=Ke(p,"x","avgPool","float32");l==null&&(l=[1,1]),ke(xr(o,l),function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides "+o+" and dilations '"+l+"'"});var V=j,ne=!1;j.rank===3&&(ne=!0,V=j.as4D(1,j.shape[0],j.shape[1],j.shape[2])),ke(V.rank===4,function(){return"Error in avgPool: x must be rank 4 but got rank "+V.rank+"."}),S!=null&&ke(nn(g),function(){return"Error in avgPool: pad must be an integer when using, dimRoundingMode "+S+" but got pad "+g+"."});var ae=bn(V.shape,c,o,l,g,S);if(ae.filterWidth===1&&ae.filterHeight===1&&ln(ae.inShape,ae.outShape))return j.clone();var me=Ue.runKernelFunc(function(Ee){return Ee.avgPool(V,ae)},{x:V},function(Ee){return{x:function(){return function(Se,Ne,ze,$e,qe,tt){var lt=Ke(Se,"dy","avgPoolBackprop"),ht=Ke(Ne,"input","avgPoolBackprop");ke(ht.rank===lt.rank,function(){return"Rank of input ("+ht.rank+") does not match rank of dy ("+lt.rank+")"}),qe==null&&(qe=[1,1]),ke(xr($e,qe),function(){return"Error in avgPoolBackprop: Either strides or dilations must be 1. Got strides "+$e+" and dilations '"+qe+"'"});var vt=ht,Ct=lt,Vt=!1;ht.rank===3&&(Vt=!0,vt=ht.as4D(1,ht.shape[0],ht.shape[1],ht.shape[2]),Ct=lt.as4D(1,lt.shape[0],lt.shape[1],lt.shape[2])),ke(Ct.rank===4,function(){return"Error in avgPoolBackprop: dy must be rank 4 but got rank "+Ct.rank+"."}),ke(vt.rank===4,function(){return"Error in avgPoolBackprop: input must be rank 4 but got rank "+vt.rank+"."});var Yt=bn(vt.shape,ze,$e,qe,tt),qt=Ue.runKernelFunc(function($t){return $t.avgPoolBackprop(Ct,vt,Yt)},{dy4D:Ct,input4D:vt});return Vt?qt.as3D(qt.shape[1],qt.shape[2],qt.shape[3]):qt}(Ee,V,c,o,l,g)}}},"AvgPool",ae);return me=me.cast(j.dtype),ne?me.as3D(me.shape[1],me.shape[2],me.shape[3]):me}var pc=wt({maxPool_:function(p,c,o,l,g){return $g(p,c,o,1,l,g)}}),nd=wt({avgPool_:function(p,c,o,l,g){return Zf(p,c,o,1,l,g)}}),lp=wt({pool_:function(p,c,o,l,g,S){g==null&&(g=[1,1]),S==null&&(S=1),l===0&&(l="valid");var j=Ke(p,"x","maxPool"),V=j,ne=!1;j.rank===3&&(ne=!0,V=j.as4D(1,j.shape[0],j.shape[1],j.shape[2])),ke(xr(S,g),function(){return"Error in pool: Either strides or dilations must be 1. Got strides "+S+" and dilations '"+g+"'"});var ae,me=bn(V.shape,c,S,g,l),Ee=[me.dilationHeight,me.dilationWidth];ae=l==="same"?function(vt,Ct){var Vt=vt.map(function($t,yn){return $t+($t-1)*(Ct[yn]-1)}).map(function($t){return $t-1}),Yt=Vt.map(function($t){return Math.floor($t/2)}),qt=Vt.map(function($t,yn){return $t-Yt[yn]});return Vt.map(function($t,yn){return[Yt[yn],qt[yn]]})}([me.filterHeight,me.filterWidth],Ee):[[0,0],[0,0]];var Se=Ee[0]===1&&Ee[1]===1,Ne=function(vt,Ct,Vt){var Yt=Vt.map(function(Cn){return Cn[0]}),qt=Vt.map(function(Cn){return Cn[1]}),$t=vt.concat(Yt,qt),yn=Ct.map(function(Cn,Xn){return(Cn-$t[Xn]%Cn)%Cn}),On=qt.map(function(Cn,Xn){return Cn+yn[Xn]});return[Ct.map(function(Cn,Xn){return[Yt[Xn],On[Xn]]}),Ct.map(function(Cn,Xn){return[0,yn[Xn]]})]}([me.inHeight,me.inWidth],Ee,ae),ze=Ne[0],$e=Ne[1],qe=Se?l:"valid",tt=Se?V:$c(V,Ee,ze),lt=(o==="avg"?function(){return Zf(tt,c,S,1,qe)}:function(){return $g(tt,c,S,1,qe)})(),ht=Se?lt:Ld(lt,Ee,$e);return ne?ht.as3D(ht.shape[1],ht.shape[2],ht.shape[3]):ht}}),Qp=wt({maxPool3d_:function(p,c,o,l,g,S,j){S===void 0&&(S="NDHWC");var V=Ke(p,"x","maxPool3d"),ne=V,ae=!1;V.rank===4&&(ae=!0,ne=V.as5D(1,V.shape[0],V.shape[1],V.shape[2],V.shape[3])),j==null&&(j=[1,1,1]),ke(ne.rank===5,function(){return"Error in maxPool3d: x must be rank 5 but got rank "+ne.rank+"."}),ke(S==="NDHWC",function(){return"Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of "+S}),ke(xr(o,j),function(){return"Error in maxPool3d: Either strides or dilations must be 1. Got strides "+o+" and dilations '"+j+"'"}),g!=null&&ke(nn(l),function(){return"Error in maxPool3d: pad must be an integer when using, dimRoundingMode "+g+" but got pad "+l+"."});var me=Sn(ne.shape,c,o,j,l,g,S),Ee=Ue.runKernelFunc(function(Se,Ne){var ze=Se.maxPool3d(ne,me);return Ne([ne,ze]),ze},{x:ne},function(Se,Ne){var ze=Ne[0],$e=Ne[1];return{x:function(){return function(qe,tt,lt,ht,vt,Ct,Vt,Yt){var qt=Ke(qe,"dy","maxPool3dBackprop"),$t=Ke(tt,"input","maxPool3dBackprop"),yn=Ke(lt,"output","maxPool3dBackprop"),On=qt,Cn=$t,Xn=yn,er=!1;$t.rank===4&&(er=!0,On=qt.as5D(1,qt.shape[0],qt.shape[1],qt.shape[2],qt.shape[3]),Cn=$t.as5D(1,$t.shape[0],$t.shape[1],$t.shape[2],$t.shape[3]),Xn=yn.as5D(1,yn.shape[0],yn.shape[1],yn.shape[2],yn.shape[3])),ke(On.rank===5,function(){return"Error in maxPool3dBackprop: dy must be rank 5 but got rank "+On.rank+"."}),ke(Cn.rank===5,function(){return"Error in maxPool3dBackprop: input must be rank 5 but got rank "+Cn.rank+"."}),ke(Xn.rank===5,function(){return"Error in maxPool3dBackprop: output must be rank 5 but got rank "+Xn.rank+"."}),Ct==null&&(Ct=[1,1,1]),ke(xr(vt,Ct),function(){return"Error in maxPool3dBackprop: Either strides or dilations must be 1. Got strides "+vt+" and dilations '"+Ct+"'"}),Yt!=null&&ke(nn(Vt),function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+Yt+" but got pad "+Vt+"."});var sr=Sn(Cn.shape,ht,vt,Ct,Vt,Yt),lr=Ue.runKernelFunc(function(ur){return ur.maxPool3dBackprop(On,Cn,Xn,sr)},{dy5D:On,input5D:Cn});return er?lr.as4D(lr.shape[1],lr.shape[2],lr.shape[3],lr.shape[4]):lr}(Se,ze,$e,c,o,j,l,g)}}});return ae?Ee.as4D(Ee.shape[1],Ee.shape[2],Ee.shape[3],Ee.shape[4]):Ee}}),Hm=wt({avgPool3d_:function(p,c,o,l,g,S,j){S===void 0&&(S="NDHWC");var V=Ke(p,"x","avgPool3d","float32"),ne=V,ae=!1;V.rank===4&&(ae=!0,ne=V.as5D(1,V.shape[0],V.shape[1],V.shape[2],V.shape[3])),j==null&&(j=[1,1,1]),ke(ne.rank===5,function(){return"Error in avgPool3d: x must be rank 5 but got rank "+ne.rank+"."}),ke(S==="NDHWC",function(){return"Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of "+S}),ke(xr(o,j),function(){return"Error in avgPool3d: Either strides or dilations must be 1. Got strides "+o+" and dilations '"+j+"'"}),g!=null&&ke(nn(l),function(){return"Error in avgPool3d: pad must be an integer when using, dimRoundingMode "+g+" but got pad "+l+"."});var me=Sn(ne.shape,c,o,j,l,g,S),Ee=Ue.runKernelFunc(function(Se){return Se.avgPool3d(ne,me)},{x:ne},function(Se){return{x:function(){return function(Ne,ze,$e,qe,tt,lt,ht){var vt=Ke(Ne,"dy","avgPool3dBackprop"),Ct=Ke(ze,"input","avgPool3dBackprop"),Vt=vt,Yt=Ct,qt=!1;Ct.rank===4&&(qt=!0,Vt=vt.as5D(1,vt.shape[0],vt.shape[1],vt.shape[2],vt.shape[3]),Yt=Ct.as5D(1,Ct.shape[0],Ct.shape[1],Ct.shape[2],Ct.shape[3])),ke(Vt.rank===5,function(){return"Error in avgPool3dBackprop: dy must be rank 5 but got rank "+Vt.rank+"."}),ke(Yt.rank===5,function(){return"Error in avgPool3dBackprop: input must be rank 5 but got rank "+Yt.rank+"."}),tt==null&&(tt=[1,1,1]),ke(xr(qe,tt),function(){return"Error in avgPool3dBackprop: Either strides or dilations must be 1. Got strides "+qe+" and dilations '"+tt+"'"}),ht!=null&&ke(nn(lt),function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+ht+" but got pad "+lt+"."});var $t=Sn(Yt.shape,$e,qe,tt,lt,ht),yn=Ue.runKernelFunc(function(On){return On.avgPool3dBackprop(Vt,Yt,$t)},{dy5D:Vt,input5D:Yt});return qt?yn.as4D(yn.shape[1],yn.shape[2],yn.shape[3],yn.shape[4]):yn}(Se,ne,c,o,j,l,g)}}});return Ee=Ee.cast(ne.dtype),ae?Ee.as4D(Ee.shape[1],Ee.shape[2],Ee.shape[3],Ee.shape[4]):Ee}}),Gg=wt({maxPoolWithArgmax_:function(p,c,o,l,g){g===void 0&&(g=!1);var S=Ke(p,"x","maxPoolWithArgmax"),j={filterSize:c,strides:o,pad:l,includeBatchInIndex:g},V=Ue.runKernel("MaxPoolWithArgmax",{x:S},j);return{result:V[0],indexes:V[1]}}}),ns=wt({slice_:function(p,c,o){var l,g,S=Ke(p,"x","slice");if(S.rank===0)throw new Error("Slicing scalar is not possible");(l=typeof c=="number"?[c].concat(new Array(S.rank-1).fill(0)):c.length<S.rank?c.concat(new Array(S.rank-c.length).fill(0)):c.slice()).forEach(function(ne){ke(ne!==-1,function(){return"slice() does not support negative begin indexing."})}),g=(g=o==null?new Array(S.rank).fill(-1):typeof o=="number"?[o].concat(new Array(S.rank-1).fill(-1)):o.length<S.rank?o.concat(new Array(S.rank-o.length).fill(-1)):o).map(function(ne,ae){return ne>=0?ne:(ke(ne===-1,function(){return"Negative size values should be exactly -1 but got "+ne+" for the slice() size at index "+ae+"."}),S.shape[ae]-l[ae])}),Zc(S,l,g);var j=S.shape,V={begin:l,size:g};return Ue.runKernelFunc(function(ne){return ne.slice(S,l,g)},{x:S},function(ne){for(var ae=[],me=0;me<ne.rank;me++)ae.push([l[me],j[me]-l[me]-g[me]]);return{x:function(){return Fu(ne,ae)}}},"Slice",V)}}),Kg=wt({slice1d_:function(p,c,o){var l=Ke(p,"x","slice1d");return ke(l.rank===1,function(){return"slice1d expects a rank-1 tensor, but got a rank-"+l.rank+" tensor"}),ns(l,[c],[o])}}),rd=wt({slice2d_:function(p,c,o){var l=Ke(p,"x","slice2d");return ke(l.rank===2,function(){return"slice2d expects a rank-2 tensor, but got a rank-"+l.rank+" tensor"}),ns(l,c,o)}}),Xg=wt({slice3d_:function(p,c,o){var l=Ke(p,"x","slice3d");return ke(l.rank===3,function(){return"slice3d expects a rank-3 tensor, but got a rank-"+l.rank+" tensor"}),ns(l,c,o)}}),Zp=wt({slice4d_:function(p,c,o){var l=Ke(p,"x","slice4d");return ke(l.rank===4,function(){return"slice4d expects a rank-4 tensor, but got a rank-"+l.rank+" tensor"}),ns(l,c,o)}});function Ql(p,c,o,l,g){return c.rank<o.rank&&(c=c.reshape(_o(c.shape,l))),p.rank<o.rank&&(p=p.reshape(_o(p.shape,l))),{x:function(){var S=p.mul(o.equal(c).cast(p.dtype));return g==null?S:S.transpose(g)}}}var fp=wt({all_:function(p,c,o){c===void 0&&(c=null),o===void 0&&(o=!1);var l=Ke(p,"x","all","bool"),g=wn(c,l.shape),S=g,j=Oa(S,l.rank);j!=null&&(l=l.transpose(j),S=Aa(S.length,l.rank));var V=Ue.runKernelFunc(function(ae){return ae.all(l,S)},{$x:l});if(o){var ne=_o(V.shape,g);return V.reshape(ne)}return V}}),ll=wt({any_:function(p,c,o){c===void 0&&(c=null),o===void 0&&(o=!1);var l=Ke(p,"x","any","bool"),g=wn(c,l.shape),S=g,j=Oa(S,l.rank);j!=null&&(l=l.transpose(j),S=Aa(S.length,l.rank));var V=Ue.runKernelFunc(function(ae){return ae.any(l,S)},{$x:l});if(o){var ne=_o(V.shape,g);return V.reshape(ne)}return V}}),Yg=wt({argMax_:function(p,c){c===void 0&&(c=0);var o=Ke(p,"x","argMax");c==null&&(c=0);var l=wn(c,o.shape),g=Oa(l,o.rank);g!=null&&(o=o.transpose(g),l=Aa(l.length,o.rank));var S={axis:l[0]},j=[o];return Ue.runKernelFunc(function(V,ne){var ae=V.argMax(o,l[0]);return ne([o]),ae},{x:o},function(V,ne){var ae=ne[0];return{x:function(){return ii(ae)}}},"ArgMax",S,j)}}),em=wt({argMin_:function(p,c){c===void 0&&(c=0);var o=Ke(p,"x","argMin");c==null&&(c=0);var l=wn(c,o.shape),g=Oa(l,o.rank);return g!=null&&(o=o.transpose(g),l=Aa(l.length,o.rank)),Ue.runKernelFunc(function(S,j){var V=S.argMin(o,l[0]);return j([o]),V},{$x:o},function(S,j){var V=j[0];return{$x:function(){return ii(V)}}})}}),tm=wt({logSumExp_:function(p,c,o){c===void 0&&(c=null),o===void 0&&(o=!1);var l=Ke(p,"x","logSumExp"),g=wn(c,l.shape),S=l.max(g,!0),j=l.sub(S).exp().sum(g).log(),V=S.reshape(j.shape).add(j);if(o){var ne=_o(V.shape,g);return V.reshape(ne)}return V}}),$m=wt({max_:function(p,c,o){c===void 0&&(c=null),o===void 0&&(o=!1);var l=Ke(p,"x","max"),g=l,S=wn(c,l.shape),j=S,V=Oa(j,l.rank);V!=null&&(l=l.transpose(V),j=Aa(j.length,l.rank));var ne=[l],ae=Ue.runKernelFunc(function(Ee,Se){var Ne=Ee.max(l,j);return Se([g,Ne]),Ne},{x:l},function(Ee,Se){return Ql(Ee,Se[1],Se[0],S,V)},"Max",{axes:j},ne,[!0]);if(o){var me=_o(ae.shape,S);ae=ae.reshape(me)}return ae}}),Ic=wt({mean_:function(p,c,o){c===void 0&&(c=null),o===void 0&&(o=!1);var l=Ke(p,"x","mean"),g=wn(c,l.shape),S=Ye(So(l.shape,g)[1]);return N(function(j){var V=fr(S);return{value:(V.dtype===j.dtype?j:j.cast(V.dtype)).div(V).sum(c,o),gradFunc:function(ne){var ae=j.shape.slice();return g.forEach(function(me){ae[me]=1}),ne.reshape(ae).mul(lu(j.shape,"float32")).div(S)}}})(l)}}),nm=wt({min_:function(p,c,o){c===void 0&&(c=null),o===void 0&&(o=!1);var l=Ke(p,"x","min"),g=l,S=wn(c,l.shape),j=S,V=Oa(j,l.rank);V!=null&&(l=l.transpose(V),j=Aa(j.length,l.rank));var ne=[l],ae=Ue.runKernelFunc(function(Ee,Se){var Ne=Ee.min(l,j);return Se([g,Ne]),Ne},{x:l},function(Ee,Se){return Ql(Ee,Se[1],Se[0],S,V)},"Min",{axes:j},ne,[!0]);if(o){var me=_o(ae.shape,S);ae=ae.reshape(me)}return ae}}),Jg=wt({moments_:function(p,c,o){c===void 0&&(c=null),o===void 0&&(o=!1);var l=wn(c,(p=Ke(p,"x","moments")).shape),g=p.mean(l,o),S=g.shape;return o||(S=_o(g.shape,l)),{mean:g,variance:p.toFloat().sub(g.reshape(S)).square().mean(l,o)}}}),fl=wt({sum_:function(p,c,o){c===void 0&&(c=null),o===void 0&&(o=!1);var l=Ke(p,"x","sum");l.dtype==="bool"&&(l=l.toInt());var g=wn(c,l.shape);return N(function(S){var j=Oa(g,S.rank),V=g,ne=S;j!=null&&(ne=S.transpose(j),V=Aa(V.length,S.rank));var ae=function(Ne){var ze=S.shape.slice();return g.forEach(function($e){ze[$e]=1}),Ne.reshape(ze).mul(lu(S.shape,"float32"))},me={axes:V},Ee=Ue.runKernelFunc(function(Ne){return Ne.sum(ne,V)},{x:ne},function(Ne){return{x:function(){return ae(Ne)}}},"Sum",me);if(o){var Se=_o(Ee.shape,g);Ee=Ee.reshape(Se)}return{value:Ee,gradFunc:ae}})(l)}}),hp=wt({prod_:function(p,c,o){c===void 0&&(c=null),o===void 0&&(o=!1);var l=Ke(p,"x","prod");l.dtype==="bool"&&(l=l.toInt());var g=wn(c,l.shape),S=Oa(g,l.rank),j=g,V=l;S!=null&&(V=l.transpose(S),j=Aa(j.length,l.rank));var ne=Ue.runKernelFunc(function(me){return me.prod(V,j)},{permutedX:V});if(o){var ae=_o(ne.shape,g);ne=ne.reshape(ae)}return ne}}),eh=wt({elu_:function(p){var c=Ke(p,"x","elu");return Ue.runKernelFunc(function(o,l){var g=o.elu(c);return l([g]),g},{$x:c},function(o,l){var g=l[0];return{$x:function(){return Ue.runKernelFunc(function(S){return S.eluDer(o,g)},{dy:o,y:g})}}})}}),dp=wt({leakyRelu_:function(p,c){c===void 0&&(c=.2);var o=Ke(p,"x","leakyRelu");return xa(fr(c).mul(o),o)}}),rs=wt({prelu_:function(p,c){var o=Ke(p,"x","prelu"),l=Ke(c,"alpha","prelu");return Ue.runKernelFunc(function(g,S){var j=g.prelu(o,l);return S([o,l]),j},{x:o,alpha:l},function(g,S){var j=S[0],V=S[1],ne=j.greater(0);return{x:function(){return Nc(ne,g,g.mul(V))},alpha:function(){var ae=Nc(ne,ii(g),g.mul(j)),me=Ia(V.shape,g.shape);return me.length>0&&(ae=ae.sum(me)),ae.reshape(V.shape)}}},"Prelu")}}),rm=wt({relu_:function(p){var c=Ke(p,"x","relu");return c.dtype==="bool"?c.toInt():Ue.runKernelFunc(function(o,l){var g=o.relu(c);return l([c]),g},{x:c},function(o,l){var g=l[0];return{x:function(){return o.mulStrict(g.step().toFloat())}}},"Relu")}}),Gm=wt({relu6_:function(p){var c=Ke(p,"x","relu6");return c.dtype==="bool"?c.toInt():Ue.runKernelFunc(function(o,l){var g=o.relu6(c);return l([c]),g},{x:c},function(o,l){var g=l[0],S=g.lessEqual(6).mul(g.step());return{x:function(){return o.mulStrict(S.toFloat())}}},"Relu6")}}),pp=wt({selu_:function(p){var c=Ke(p,"x","selu");return Ue.runKernelFunc(function(o,l){var g=o.selu(c);return l([c]),g},{$x:c},function(o,l){var g=l[0];return{$x:function(){var S=g.greater(fr(0)),j=fr(bv),V=fr(xv),ne=o.mul(V),ae=o.mul(j).mul(g.toFloat().exp());return Nc(S,ne,ae)}}})}}),mp=wt({localResponseNormalization_:function(p,c,o,l,g){c===void 0&&(c=5),o===void 0&&(o=1),l===void 0&&(l=1),g===void 0&&(g=.5);var S=Ke(p,"x","localResponseNormalization");ke(S.rank===4||S.rank===3,function(){return`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank `+S.rank+"."}),ke(nn(c),function(){return"Error in localResponseNormalization: depthRadius must be an integer but got depthRadius "+c+"."});var j=S,V=!1;S.rank===3&&(V=!0,j=S.as4D(1,S.shape[0],S.shape[1],S.shape[2]));var ne=Ue.runKernelFunc(function(ae,me){var Ee=ae.localResponseNormalization4D(j,c,o,l,g);return me([j,Ee]),Ee},{x4D:j},function(ae,me){var Ee=me[0],Se=me[1];return{x4D:function(){return Ue.runKernelFunc(function(Ne){return Ne.LRNGrad(ae,Ee,Se,c,o,l,g)},{})}}});return V?ne.as3D(ne.shape[1],ne.shape[2],ne.shape[3]):ne}}),Km=wt({norm_:function(p,c,o,l){c===void 0&&(c="euclidean"),o===void 0&&(o=null),l===void 0&&(l=!1);var g=function V(ne,ae,me){if(me===void 0&&(me=null),ne.rank===0)return ne.abs();if(ne.rank!==1&&me===null)return V(ne.reshape([-1]),ae,me);if(ne.rank===1||typeof me=="number"||Array.isArray(me)&&me.length===1){if(ae===1)return ne.abs().sum(me);if(ae===1/0)return ne.abs().max(me);if(ae===-1/0)return ne.abs().min(me);if(ae==="euclidean"||ae===2)return ne.abs().pow(fr(2,"int32")).sum(me).sqrt();throw new Error("Error in norm: invalid ord value: "+ae)}if(Array.isArray(me)&&me.length===2){if(ae===1)return ne.abs().sum(me[0]).max(me[1]-1);if(ae===1/0)return ne.abs().sum(me[1]).max(me[0]);if(ae===-1/0)return ne.abs().sum(me[1]).min(me[0]);if(ae==="fro"||ae==="euclidean")return ne.square().sum(me).sqrt();throw new Error("Error in norm: invalid ord value: "+ae)}throw new Error("Error in norm: invalid axis: "+me)}(p=Ke(p,"x","norm"),c,o),S=g.shape;if(l){var j=wn(o,p.shape);S=_o(g.shape,j)}return g.reshape(S)}}),Qg=wt({basicLSTMCell_:function(p,c,o,l,g,S){var j=Ke(p,"forgetBias","basicLSTMCell"),V=Ke(c,"lstmKernel","basicLSTMCell"),ne=Ke(o,"lstmBias","basicLSTMCell"),ae=Ke(l,"data","basicLSTMCell"),me=Ke(g,"c","basicLSTMCell"),Ee=Ke(S,"h","basicLSTMCell"),Se=ae.concat(Ee,1).matMul(V).add(ne),Ne=Se.shape[0],ze=Se.shape[1]/4,$e=[Ne,ze],qe=Se.slice([0,0],$e),tt=Se.slice([0,ze],$e),lt=Se.slice([0,2*ze],$e),ht=Se.slice([0,3*ze],$e),vt=qe.sigmoid().mulStrict(tt.tanh()).addStrict(me.mulStrict(j.add(lt).sigmoid()));return[vt,vt.tanh().mulStrict(ht.sigmoid())]}}),P0=wt({multiRNNCell_:function(p,c,o,l){for(var g=Ke(c,"data","multiRNNCell"),S=Lu(o,"c","multiRNNCell"),j=Lu(l,"h","multiRNNCell"),V=g,ne=[],ae=0;ae<p.length;ae++){var me=p[ae](V,S[ae],j[ae]);ne.push(me[0]),ne.push(me[1]),V=me[1]}var Ee=[],Se=[];for(ae=0;ae<ne.length;ae+=2)Ee.push(ne[ae]),Se.push(ne[ae+1]);return[Ee,Se]}}),Rc=wt({movingAverage_:function(p,c,o,l,g){g===void 0&&(g=!0);var S=Ke(p,"v","movingAverage"),j=Ke(c,"x","movingAverage"),V=Ke(o,"decay","movingAverage");Ln(S,j),ke(ln(S.shape,j.shape),function(){return"Shape mismatch in v and x"});var ne=fr(1),ae=ne.sub(V),me=j.sub(S).mul(ae);if(g){ke(l!=null,function(){return"When using zeroDebias: true, step is required."});var Ee=Ke(l,"step","movingAverage");me=me.div(ne.sub(Hs(V,Ee)))}return S.add(me)}}),th=wt({stridedSlice_:function(p,c,o,l,g,S,j,V,ne){if(g===void 0&&(g=0),S===void 0&&(S=0),j===void 0&&(j=0),V===void 0&&(V=0),ne===void 0&&(ne=0),l==null&&(l=new Array(c.length)),j!==0)throw new Error("ellipsis mask is not yet supported");var ae=Ke(p,"x","stridedSlice"),me=Gs(V),Ee=ae.shape.slice();me.forEach(function(qe){c[qe]=0,o[qe]=1,Ee.splice(qe,0,1)}),ae=ae.reshape(Ee);for(var Se=0;Se<ae.rank;Se++)c[Se]=Au(g,c,l,ae.shape,Se),o[Se]=iu(S,o,l,ae.shape,Se),l[Se]=l[Se]||1;var Ne=Gs(ne);Ne.forEach(function(qe){o[qe]=c[qe]+1,l[qe]=1});var ze=Ou(c,o,l),$e=ze.filter(function(qe,tt){return Ne.indexOf(tt)===-1});return l.every(function(qe){return qe===1})?ns(ae,c,ze).reshape($e):Ue.runKernelFunc(function(qe){return qe.stridedSlice(ae,c,o,l)},{$x:ae}).reshape($e)}}),L0=wt({topk_:function(p,c,o){c===void 0&&(c=1),o===void 0&&(o=!0);var l=Ke(p,"x","topk");if(l.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");var g=l.shape[l.shape.length-1];if(c>g)throw new Error("'k' passed to topk() must be <= the last dimension ("+g+") but got "+c);var S=Ue.runKernelFunc(function(j){return j.topk(l,c,o)},{$x:l});return{values:S[0],indices:S[1]}}}),Zg=wt({scatterND_:function(p,c,o){var l=Ke(p,"indices","scatterND","int32"),g=Ke(c,"updates","scatterND");return Jc(g,l,o),Ue.runKernelFunc(function(S){return S.scatterND(l,g,o)},{indices:l,updates:g},null,"ScatterNd",{shape:o})}}),Mc=wt({fft_:function(p){ke(p.dtype==="complex64",function(){return"The dtype for tf.spectral.fft() must be complex64 but got "+p.dtype+"."});var c=p.shape[p.shape.length-1],o=p.size/c,l=p.as2D(o,c);return Ue.runKernelFunc(function(g){return g.fft(l)},{input:p}).reshape(p.shape)}}),Ka=wt({ifft_:function(p){ke(p.dtype==="complex64",function(){return"The dtype for tf.spectral.ifft() must be complex64 but got "+p.dtype+"."});var c=p.shape[p.shape.length-1],o=p.size/c,l=p.as2D(o,c);return Ue.runKernelFunc(function(g){return g.ifft(l)},{input:p}).reshape(p.shape)}}),id=wt({rfft_:function(p,c){ke(p.dtype==="float32",function(){return"The dtype for rfft() must be real value but got "+p.dtype});var o,l=p.shape[p.shape.length-1],g=p.size/l;if(c!=null&&c<l){var S=p.shape.map(function(tt){return 0}),j=p.shape.map(function(tt){return tt});j[p.shape.length-1]=c,o=p.slice(S,j),l=c}else if(c!=null&&c>l){var V=p.shape.map(function(tt){return tt});V[p.shape.length-1]=c-l,o=p.concat(Ki(V),p.shape.length-1),l=c}else o=p;var ne=o.zerosLike(),ae=ho(o,ne).as2D(g,l),me=Mc(ae),Ee=Math.floor(l/2)+1,Se=ca(me),Ne=Ua(me),ze=Se.split([Ee,l-Ee],Se.shape.length-1),$e=Ne.split([Ee,l-Ee],Ne.shape.length-1),qe=o.shape.slice();return qe[o.shape.length-1]=Ee,ho(ze[0],$e[0]).reshape(qe)}}),gp=wt({irfft_:function(p){var c=p.shape[p.shape.length-1],o=p.size/c;if(c<=2){var l=p.as2D(o,c),g=Ka(l);return ca(g)}var S=[o,2*(c-1)],j=ca(p).as2D(o,c),V=Ua(p).as2D(o,c),ne=j.slice([0,1],[o,c-2]).reverse(1),ae=V.slice([0,1],[o,c-2]).reverse(1).mul(fr(-1)),me=j.concat(ne,1),Ee=V.concat(ae,1);return l=ho(me,Ee).as2D(S[0],S[1]),g=Ka(l),ca(g)}}),im=Object.freeze({fft:Mc,ifft:Ka,rfft:id,irfft:gp}),e0=wt({sparseToDense_:function(p,c,o,l){l===void 0&&(l=0);var g=Ke(p,"sparseIndices","sparseToDense","int32"),S=Ke(c,"sparseValues","sparseToDense"),j=Ke(l,"defaultValue","sparseToDense",S.dtype);return function(V,ne,ae,me){if(V.dtype!=="int32")throw new Error("tf.sparseToDense() expects the indices to be int32 type, but the dtype was "+V.dtype+".");if(V.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix, but got shape "+V.shape+".");var Ee=V.rank>0?V.shape[0]:1,Se=V.rank>1?V.shape[1]:1;if(ae.length!==Se)throw new Error("outputShape has incorrect number of elements:, "+ae.length+", should be: "+Se+".");var Ne=ne.size;if(ne.rank!==0&&(ne.rank!==1||Ne!==Ee))throw new Error("sparseValues has incorrect shape "+ne.shape+", should be [] or ["+Ee+"]");if(ne.dtype!==me.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}(g,S,o,j),Ue.runKernelFunc(function(V){return V.sparseToDense(g,S,o,j)},{$sparseIndices:g,$sparseValues:S,$defaultValue:j})}}),om=wt({gatherND_:function(p,c){var o=Ke(c,"indices","gatherND","int32"),l=Ke(p,"x","gatherND");return Ue.runKernelFunc(function(g){return g.gatherND(l,o)},{x:l,indices:o},null,"GatherNd")}}),Zl=wt({diag_:function(p){var c=Ke(p,"x","diag").flatten(),o=p.shape.concat(p.shape);return Ue.runKernelFunc(function(l){return l.diag(c)},{$x:c}).reshape(o)}}),Ev=wt({dropout_:function(p,c,o,l){var g=Ke(p,"x","dropout");if(ke(g.dtype==="float32",function(){return"x has to be a floating point tensor since it's going to be scaled, but got a "+g.dtype+" tensor instead."}),ke(c>=0&&c<1,function(){return"rate must be a float in the range [0, 1), but got "+c+"."}),c===0)return p instanceof Mt?g.clone():g;var S=function(ne,ae){if(ae==null)return ne.shape.slice();if(ln(ne.shape,ae))return ae;if(ne.shape.length===ae.length){for(var me=[],Ee=0;Ee<ne.shape.length;Ee++)ae[Ee]==null&&ne.shape[Ee]!=null?me.push(ne.shape[Ee]):me.push(ae[Ee]);return me}return ae}(g,o),j=1-c,V=$p(S,0,1,"float32",l).add(j).floor().div(j);return g.mul(V)}});function am(p,c,o){for(var l=1-p%2,g=new Float32Array(p),S=0;S<p;++S){var j=2*Math.PI*S/(p+l-1);g[S]=c-o*Math.cos(j)}return Us(g,"float32")}var Wa,vp=wt({hannWindow_:function(p){return am(p,.5,.5)}}),nh=wt({hammingWindow_:function(p){return am(p,.54,.46)}}),sm=wt({frame_:function(p,c,o,l,g){l===void 0&&(l=!1),g===void 0&&(g=0);for(var S=0,j=[];S+c<=p.size;)j.push(ns(p,S,c)),S+=o;if(l)for(;S<p.size;){var V=S+c-p.size,ne=Po([ns(p,S,c-V),ws([V],g)]);j.push(ne),S+=o}return j.length===0?nu([],[0,c]):Po(j).as2D(j.length,c)}}),yp=wt({stft_:function(p,c,o,l,g){var S;g===void 0&&(g=vp),l==null&&(S=c,l=Math.floor(Math.pow(2,Math.ceil(Math.log(S)/Math.log(2)))));for(var j=sm(p,c,o),V=Xo(j,g(c)),ne=[],ae=0;ae<j.shape[0];ae++)ne.push(id(V.slice([ae,0],[1,c]),l));return Po(ne)}}),Xm=Object.freeze({hannWindow:vp,hammingWindow:nh,frame:sm,stft:yp}),Ym=function(p,c,o){return o===void 0&&(o=1),R(this,void 0,void 0,function(){var l,g,S,j,V,ne,ae,me,Ee,Se,Ne,ze,$e,qe;return W(this,function(tt){switch(tt.label){case 0:return l=Ke(p,"predictions","inTopK"),g=Ke(c,"targets","inTopK"),ke(l.rank>1,function(){return"inTopK() expects the predictions to be of rank 2 or higher, but got "+l.rank}),ke(l.rank-1===g.rank,function(){return"predictions rank should be 1 larger than targets rank, but got predictions rank "+l.rank+" and targets rank "+g.rank}),Ft(l.shape.slice(0,l.shape.length-1),g.shape,"predictions's shape should be align with the targets' shape, except the last dimension."),S=l.shape[l.shape.length-1],ke(o>0&&o<=S,function(){return"'k' passed to inTopK() must be > 0 && <= the predictions last dimension ("+S+"), but got "+o}),[4,l.data()];case 1:return j=tt.sent(),[4,g.data()];case 2:for(V=tt.sent(),ne=[j.length/S,S],me=ne[1],Ee=Hn("bool",ae=ne[0]),Se=0;Se<ae;Se++){for(Ne=Se*me,ze=j.subarray(Ne,Ne+me),$e=[],qe=0;qe<ze.length;qe++)$e.push({value:ze[qe],index:qe});for($e.sort(function(lt,ht){return ht.value-lt.value}),Ee[Se]=0,qe=0;qe<o;qe++)if($e[qe].index===V[Se]){Ee[Se]=1;break}}return p!==l&&l.dispose(),c!==g&&g.dispose(),[2,ko(Ee,g.shape,"bool")]}})})};(function(p){p[p.NONE=0]="NONE",p[p.MEAN=1]="MEAN",p[p.SUM=2]="SUM",p[p.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"})(Wa||(Wa={}));var ef=wt({absoluteDifference_:function(p,c,o,l){l===void 0&&(l=Wa.SUM_BY_NONZERO_WEIGHTS);var g=Ke(p,"labels","absoluteDifference"),S=Ke(c,"predictions","absoluteDifference"),j=null;o!=null&&(j=Ke(o,"weights","absoluteDifference")),Ft(g.shape,S.shape,"Error in absoluteDifference: ");var V=g.sub(S).abs();return $u(V,j,l)}}),$u=wt({computeWeightedLoss_:function(p,c,o){o===void 0&&(o=Wa.SUM_BY_NONZERO_WEIGHTS);var l=Ke(p,"losses","computeWeightedLoss"),g=null;c!=null&&(g=Ke(c,"weights","computeWeightedLoss"));var S=g==null?l:l.mul(g);if(o===Wa.NONE)return S;if(o===Wa.SUM)return S.sum();if(o===Wa.MEAN){if(g==null)return S.mean();var j=l.size/g.size,V=S.sum().div(g.sum());return j>1?V.div(fr(j)):V}if(o===Wa.SUM_BY_NONZERO_WEIGHTS){if(g==null)return S.sum().div(fr(l.size));var ne=g.mul(lu(l.shape)).notEqual(fr(0)).sum().toFloat();return S.sum().div(ne)}throw Error("Unknown reduction: "+o)}}),t0=wt({cosineDistance_:function(p,c,o,l,g){g===void 0&&(g=Wa.SUM_BY_NONZERO_WEIGHTS);var S=Ke(p,"labels","cosineDistance"),j=Ke(c,"predictions","cosineDistance"),V=null;l!=null&&(V=Ke(l,"weights","cosineDistance")),Ft(S.shape,j.shape,"Error in cosineDistance: ");var ne=fr(1).sub(S.mul(j).sum(o,!0));return $u(ne,V,g)}}),n0=wt({hingeLoss_:function(p,c,o,l){l===void 0&&(l=Wa.SUM_BY_NONZERO_WEIGHTS);var g=Ke(p,"labels","hingeLoss"),S=Ke(c,"predictions","hingeLoss"),j=null;o!=null&&(j=Ke(o,"weights","hingeLoss")),Ft(g.shape,S.shape,"Error in hingeLoss: ");var V=fr(1);g=fr(2).mul(g).sub(V);var ne=V.sub(g.mul(S)).relu();return $u(ne,j,l)}}),od=wt({huberLoss_:function(p,c,o,l,g){l===void 0&&(l=1),g===void 0&&(g=Wa.SUM_BY_NONZERO_WEIGHTS);var S=Ke(p,"labels","huberLoss"),j=Ke(c,"predictions","huberLoss"),V=null;o!=null&&(V=Ke(o,"weights","huberLoss")),Ft(S.shape,j.shape,"Error in huberLoss: ");var ne=fr(l),ae=j.sub(S).abs(),me=ku(ae,ne),Ee=ae.sub(me),Se=fr(.5).mul(me.square()).add(ne.mul(Ee));return $u(Se,V,g)}}),bp=wt({logLoss_:function(p,c,o,l,g){l===void 0&&(l=1e-7),g===void 0&&(g=Wa.SUM_BY_NONZERO_WEIGHTS);var S=Ke(p,"labels","logLoss"),j=Ke(c,"predictions","logLoss"),V=null;o!=null&&(V=Ke(o,"weights","logLoss")),Ft(S.shape,j.shape,"Error in logLoss: ");var ne=fr(1),ae=fr(l),me=S.mul(j.add(ae).log()).neg().sub(ne.sub(S).mul(ne.sub(j).add(ae).log()));return $u(me,V,g)}}),z0=wt({meanSquaredError_:function(p,c,o,l){l===void 0&&(l=Wa.SUM_BY_NONZERO_WEIGHTS);var g=Ke(p,"labels","meanSquaredError"),S=Ke(c,"predictions","meanSquaredError"),j=null;o!=null&&(j=Ke(o,"weights","meanSquaredError")),Ft(g.shape,S.shape,"Error in meanSquaredError: ");var V=g.squaredDifference(S);return $u(V,j,l)}}),Jm=wt({sigmoidCrossEntropy_:function(p,c,o,l,g){l===void 0&&(l=0),g===void 0&&(g=Wa.SUM_BY_NONZERO_WEIGHTS);var S=Ke(p,"multiClassLabels","sigmoidCrossEntropy"),j=Ke(c,"logits","sigmoidCrossEntropy"),V=null;if(o!=null&&(V=Ke(o,"weights","sigmoidCrossEntropy")),Ft(S.shape,j.shape,"Error in sigmoidCrossEntropy: "),l>0){var ne=fr(l),ae=fr(1),me=fr(.5);S=S.mul(ae.sub(ne)).add(me.mul(ne))}var Ee=function(Se,Ne){var ze=Ke(Se,"labels","sigmoidCrossEntropyWithLogits"),$e=Ke(Ne,"logits","sigmoidCrossEntropyWithLogits");Ft(ze.shape,$e.shape,"Error in sigmoidCrossEntropyWithLogits: ");var qe=$e.relu(),tt=$e.mul(ze),lt=$e.abs().neg().exp().log1p();return qe.sub(tt).add(lt)}(S,j);return $u(Ee,V,g)}}),um=wt({softmaxCrossEntropy_:function(p,c,o,l,g){l===void 0&&(l=0),g===void 0&&(g=Wa.SUM_BY_NONZERO_WEIGHTS);var S=Ke(p,"onehotLabels","softmaxCrossEntropy"),j=Ke(c,"logits","softmaxCrossEntropy"),V=null;if(o!=null&&(V=Ke(o,"weights","softmaxCrossEntropy")),Ft(S.shape,j.shape,"Error in softmaxCrossEntropy: "),l>0){var ne=fr(l),ae=fr(1),me=fr(S.shape[1]);S=S.mul(ae.sub(ne)).add(ne.div(me))}var Ee=function(Se,Ne,ze){if(ze===void 0&&(ze=-1),ze===-1&&(ze=Ne.rank-1),ze!==Ne.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank "+Ne.rank+" and dim was "+ze);return N(function($e,qe,tt){var lt=qe.logSumExp([ze],!0),ht=qe.toFloat().sub(lt);return tt([$e,ht]),{value:ht.mul($e).neg().sum([ze]),gradFunc:function(vt,Ct){var Vt=Ct[0],Yt=Ct[1],qt=_o(vt.shape,[ze]);return[vt.reshape(qt).mul(Vt.toFloat().sub(Yt.exp())),vt.reshape(qt).mul(Yt.exp().sub(Vt.toFloat()))]}}})(Se,Ne)}(S,j);return $u(Ee,V,g)}}),Ir=Object.freeze({get Reduction(){return Wa},absoluteDifference:ef,computeWeightedLoss:$u,cosineDistance:t0,hingeLoss:n0,huberLoss:od,logLoss:bp,meanSquaredError:z0,sigmoidCrossEntropy:Jm,softmaxCrossEntropy:um});function F(p,c){return c===void 0&&(c=!1),Ue.tidy(function(){if(p.shape.length!==2)throw new Error("qr2d() requires a 2D Tensor, but got a "+p.shape.length+"D Tensor.");for(var o=p.shape[0],l=p.shape[1],g=Fc(o),S=p.clone(),j=nu([[1]],[1,1]),V=j.clone(),ne=o>=l?l:o,ae=function(Ee){var Se,Ne=S,ze=V,$e=g;Se=Ue.tidy(function(){var qe=S.slice([Ee,Ee],[o-Ee,1]),tt=qe.norm(),lt=S.slice([Ee,Ee],[1,1]),ht=nu([[-1]]).where(lt.greater(0),nu([[1]])),vt=lt.sub(ht.mul(tt)),Ct=qe.div(vt);V=Ct.shape[0]===1?j.clone():j.concat(Ct.slice([1,0],[Ct.shape[0]-1,Ct.shape[1]]),0);var Vt=ht.matMul(vt).div(tt).neg(),Yt=S.slice([Ee,0],[o-Ee,l]),qt=Vt.mul(V),$t=V.transpose();if(Ee===0)S=Yt.sub(qt.matMul($t.matMul(Yt)));else{var yn=Yt.sub(qt.matMul($t.matMul(Yt)));S=S.slice([0,0],[Ee,l]).concat(yn,0)}var On=qt.transpose(),Cn=g.slice([0,Ee],[o,g.shape[1]-Ee]);if(Ee===0)g=Cn.sub(Cn.matMul(V).matMul(On));else{var Xn=Cn.sub(Cn.matMul(V).matMul(On));g=g.slice([0,0],[o,Ee]).concat(Xn,1)}return[V,S,g]}),V=Se[0],S=Se[1],g=Se[2],No([Ne,ze,$e])},me=0;me<ne;++me)ae(me);return!c&&o>l&&(g=g.slice([0,0],[o,l]),S=S.slice([0,0],[l,l])),[g,S]})}var E=wt({bandPart_:function(p,c,o){if(c%1!=0)throw new Error("bandPart(): numLower must be an integer, got "+c+".");if(o%1!=0)throw new Error("bandPart(): numUpper must be an integer, got "+o+".");var l=Ke(p,"a","bandPart");if(l.rank<2)throw new Error("bandPart(): Rank must be at least 2, got "+l.rank+".");var g=l.shape,S=l.shape.slice(-2),j=S[0],V=S[1];if(!(c<=j))throw new Error("bandPart(): numLower ("+c+") must not be greater than the number of rows ("+j+").");if(!(o<=V))throw new Error("bandPart(): numUpper ("+o+") must not be greater than the number of columns ("+V+").");c<0&&(c=j),o<0&&(o=V);var ne=oc(0,j,1,"int32").reshape([-1,1]),ae=oc(0,V,1,"int32"),me=_a(ne,ae),Ee=Nu(me.lessEqual(fr(+c,"int32")),me.greaterEqual(fr(-o,"int32"))),Se=Ki([j,V],l.dtype);return ru(Mh(l.reshape([-1,j,V])).map(function(Ne){return Nc(Ee,Ne,Se)})).reshape(g)}}),k=wt({gramSchmidt_:function(p){var c;if(Array.isArray(p)){c=!1,ke(p!=null&&p.length>0,function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"});for(var o=p[0].shape[0],l=function(ne){ke(p[ne].shape[0]===o,function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: ("+p[ne].shape[0]+" vs. "+o+")"})},g=1;g<p.length;++g)l(g)}else c=!0,p=Ri(p,p.shape[0],0).map(function(ne){return Is(ne,[0])});ke(p.length<=p[0].shape[0],function(){return"Gram-Schmidt: Number of vectors ("+p.length+") exceeds number of dimensions ("+p[0].shape[0]+")."});var S=[],j=p,V=function(ne){S.push(Ue.tidy(function(){var ae=j[ne];if(ne>0)for(var me=0;me<ne;++me){var Ee=fl(S[me].mulStrict(ae)).mul(S[me]);ae=ae.sub(Ee)}return ae.div(Km(ae,"euclidean"))}))};for(g=0;g<p.length;++g)V(g);return c?ru(S,0):S}}),w=wt({qr_:function(p,c){if(c===void 0&&(c=!1),p.rank<2)throw new Error("qr() requires input tensor to have a rank >= 2, but got rank "+p.rank);if(p.rank===2)return F(p,c);var o=p.shape.slice(0,p.shape.length-2).reduce(function(S,j){return S*j}),l=[],g=[];return Mh(p.reshape([o,p.shape[p.shape.length-2],p.shape[p.shape.length-1]]),0).forEach(function(S){var j=F(S,c),V=j[0],ne=j[1];l.push(V),g.push(ne)}),[ru(l,0).reshape(p.shape),ru(g,0).reshape(p.shape)]}}),_=Object.freeze({bandPart:E,gramSchmidt:k,qr:w});function L(p,c,o,l,g,S){l==null&&(l=.5),g==null&&(g=Number.NEGATIVE_INFINITY),S==null&&(S=0);var j=p.shape[0];return o=Math.min(o,j),ke(0<=l&&l<=1,function(){return"iouThreshold must be in [0, 1], but was '"+l+"'"}),ke(p.rank===2,function(){return"boxes must be a 2D tensor, but was of rank '"+p.rank+"'"}),ke(p.shape[1]===4,function(){return"boxes must have 4 columns, but 2nd dimension was "+p.shape[1]}),ke(c.rank===1,function(){return"scores must be a 1D tensor"}),ke(c.shape[0]===j,function(){return"scores has incompatible shape with boxes. Expected "+j+", but was "+c.shape[0]}),ke(0<=S&&S<=1,function(){return"softNmsSigma must be in [0, 1], but was '"+S+"'"}),{maxOutputSize:o,iouThreshold:l,scoreThreshold:g,softNmsSigma:S}}var Y=wt({resizeBilinear_:function(p,c,o){o===void 0&&(o=!1);var l=Ke(p,"images","resizeBilinear");ke(l.rank===3||l.rank===4,function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got rank "+l.rank+"."}),ke(c.length===2,function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+c+"."});var g=l,S=!1;l.rank===3&&(S=!0,g=l.as4D(1,l.shape[0],l.shape[1],l.shape[2]));var j=c[0],V=c[1],ne=Ue.runKernelFunc(function(ae,me){return me([g]),ae.resizeBilinear(g,j,V,o)},{x:g},function(ae,me){return{x:function(){return Ue.runKernelFunc(function(Ee){return Ee.resizeBilinearBackprop(ae,me[0],o)},{})}}},"ResizeBilinear",{alignCorners:o,newHeight:j,newWidth:V});return S?ne.as3D(ne.shape[1],ne.shape[2],ne.shape[3]):ne}}),ce=wt({resizeNearestNeighbor_:function(p,c,o){o===void 0&&(o=!1);var l=Ke(p,"images","resizeNearestNeighbor");ke(l.rank===3||l.rank===4,function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank "+l.rank+"."}),ke(c.length===2,function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+c+"."}),ke(l.dtype==="float32"||l.dtype==="int32",function(){return"`images` must have `int32` or `float32` as dtype"});var g=l,S=!1;l.rank===3&&(S=!0,g=l.as4D(1,l.shape[0],l.shape[1],l.shape[2]));var j=c[0],V=c[1],ne=Ue.runKernelFunc(function(ae,me){return me([g]),ae.resizeNearestNeighbor(g,j,V,o)},{batchImages:g},function(ae,me){return{batchImages:function(){return Ue.runKernelFunc(function(Ee){return Ee.resizeNearestNeighborBackprop(ae,me[0],o)},{})}}});return S?ne.as3D(ne.shape[1],ne.shape[2],ne.shape[3]):ne}}),ve=wt({nonMaxSuppression_:function(p,c,o,l,g){l===void 0&&(l=.5),g===void 0&&(g=Number.NEGATIVE_INFINITY);var S=Ke(p,"boxes","nonMaxSuppression"),j=Ke(c,"scores","nonMaxSuppression"),V=L(S,j,o,l,g);o=V.maxOutputSize,l=V.iouThreshold,g=V.scoreThreshold;var ne={maxOutputSize:o,iouThreshold:l,scoreThreshold:g};return Ue.runKernelFunc(function(ae){return ae.nonMaxSuppression(S,j,o,l,g)},{boxes:S,scores:j},null,"NonMaxSuppressionV3",ne)}}),De=wt({nonMaxSuppressionWithScore_:function(p,c,o,l,g,S){l===void 0&&(l=.5),g===void 0&&(g=Number.NEGATIVE_INFINITY),S===void 0&&(S=0);var j=Ke(p,"boxes","nonMaxSuppression"),V=Ke(c,"scores","nonMaxSuppression"),ne=L(j,V,o,l,g,S),ae={maxOutputSize:o=ne.maxOutputSize,iouThreshold:l=ne.iouThreshold,scoreThreshold:g=ne.scoreThreshold,softNmsSigma:S=ne.softNmsSigma},me=Ue.runKernel("NonMaxSuppressionV5",{boxes:j,scores:V},ae);return{selectedIndices:me[0],selectedScores:me[1]}}}),Ce=wt({cropAndResize_:function(p,c,o,l,g,S){var j=Ke(p,"image","cropAndResize"),V=Ke(c,"boxes","cropAndResize","float32"),ne=Ke(o,"boxInd","cropAndResize","int32");g=g||"bilinear",S=S||0;var ae=V.shape[0];return ke(j.rank===4,function(){return"Error in cropAndResize: image must be rank 4,but got rank "+j.rank+"."}),ke(V.rank===2&&V.shape[1]===4,function(){return"Error in cropAndResize: boxes must be have size ["+ae+",4] but had shape "+V.shape+"."}),ke(ne.rank===1&&ne.shape[0]===ae,function(){return"Error in cropAndResize: boxInd must be have size ["+ae+"] but had shape "+V.shape+"."}),ke(l.length===2,function(){return"Error in cropAndResize: cropSize must be of length 2, but got length "+l.length+"."}),ke(l[0]>=1&&l[1]>=1,function(){return"cropSize must be atleast [1,1], but was "+l}),ke(g==="bilinear"||g==="nearest",function(){return"method must be bilinear or nearest, but was "+g}),Ue.runKernelFunc(function(me,Ee){return me.cropAndResize(j,V,ne,l,g,S)},{images:j,boxes:V,boxInd:ne},null,"CropAndResize",{method:g,extrapolationValue:S,cropSize:l})}}),Xe=Object.freeze({resizeBilinear:Y,resizeNearestNeighbor:ce,nonMaxSuppression:ve,nonMaxSuppressionAsync:function(p,c,o,l,g){return l===void 0&&(l=.5),g===void 0&&(g=Number.NEGATIVE_INFINITY),R(this,void 0,void 0,function(){var S,j,V,ne,ae,me,Ee;return W(this,function(Se){switch(Se.label){case 0:return S=Ke(p,"boxes","nonMaxSuppressionAsync"),j=Ke(c,"scores","nonMaxSuppressionAsync"),V=L(S,j,o,l,g),o=V.maxOutputSize,l=V.iouThreshold,g=V.scoreThreshold,[4,Promise.all([S.data(),j.data()])];case 1:return ne=Se.sent(),ae=ne[0],me=ne[1],Ee=ia(ae,me,o,l,g),S!==p&&S.dispose(),j!==c&&j.dispose(),[2,Ee]}})})},nonMaxSuppressionWithScore:De,nonMaxSuppressionWithScoreAsync:function(p,c,o,l,g,S){return l===void 0&&(l=.5),g===void 0&&(g=Number.NEGATIVE_INFINITY),S===void 0&&(S=0),R(this,void 0,void 0,function(){var j,V,ne,ae,me,Ee,Se;return W(this,function(Ne){switch(Ne.label){case 0:return j=Ke(p,"boxes","nonMaxSuppressionAsync"),V=Ke(c,"scores","nonMaxSuppressionAsync"),ne=L(j,V,o,l,g,S),o=ne.maxOutputSize,l=ne.iouThreshold,g=ne.scoreThreshold,S=ne.softNmsSigma,[4,Promise.all([j.data(),V.data()])];case 1:return ae=Ne.sent(),me=ae[0],Ee=ae[1],Se=jo(me,Ee,o,l,g,S),j!==p&&j.dispose(),V!==c&&V.dispose(),[2,Se]}})})},cropAndResize:Ce}),nt=function(p,c){return!(p>0)||c==="linear"},Et=function(p,c,o){if(o==null||o==="linear")return p;if(o==="relu")return p.mul(c.step());throw new Error("Gradient for activation "+o+" has not been implemented yet.")},At=function(p,c){var o=c,l=Ia(p.shape,c.shape);return l.length>0&&(o=o.sum(l)),o.reshape(p.shape)},rn=function(p,c,o){if(c==="linear")return p;if(c==="relu")return rm(p);if(c==="elu")return eh(p);if(c==="relu6")return Gm(p);if(c==="prelu")return rs(p,o);throw new Error("Unknown fused activation "+c+".")},un=wt({fusedMatMul_:function(p){var c,o=p.a,l=p.b,g=p.transposeA,S=g!==void 0&&g,j=p.transposeB,V=j!==void 0&&j,ne=p.bias,ae=p.activation,me=ae===void 0?"linear":ae,Ee=p.preluActivationWeights;if(nt(Ue.state.gradientDepth,me)===!1){var Se=dc(o,l,S,V);return ne!=null&&(Se=ra(Se,ne)),rn(Se,me,Ee)}var Ne=Ke(o,"a","fused matMul"),ze=Ke(l,"b","fused matMul");c=An(Ne,ze),Ne=c[0],ze=c[1];var $e=S?Ne.shape[Ne.rank-2]:Ne.shape[Ne.rank-1],qe=V?ze.shape[ze.rank-1]:ze.shape[ze.rank-2],tt=S?Ne.shape[Ne.rank-1]:Ne.shape[Ne.rank-2],lt=V?ze.shape[ze.rank-2]:ze.shape[ze.rank-1],ht=Ne.shape.slice(0,-2),vt=ze.shape.slice(0,-2),Ct=Ye(ht),Vt=Ye(vt);ke(Ne.rank>=2&&ze.rank>=2&&Ne.rank===ze.rank,function(){return"Error in fused matMul: inputs must have the same rank of at least 2, got ranks "+Ne.rank+" and "+ze.rank+"."}),ke(ln(ht,vt),function(){return"Error in fused matMul: outer dimensions ("+ht+") and ("+vt+") of Tensors with shapes "+Ne.shape+" and "+ze.shape+" must match."}),ke($e===qe,function(){return"Error in fused matMul: inner shapes ("+$e+") and ("+qe+") of Tensors with shapes "+Ne.shape+" and "+ze.shape+" and transposeA="+S+" and transposeB="+V+" must match."});var Yt,qt,$t=Ne.shape.slice(0,-2).concat([tt,lt]),yn=S?Ne.as3D(Ct,$e,tt):Ne.as3D(Ct,tt,$e),On=V?ze.as3D(Vt,lt,qe):ze.as3D(Vt,qe,lt);ne!=null&&Mi($t,(Yt=An(Yt=Ke(ne,"bias","fused matMul"),Ne)[0]).shape),Ee!=null&&(qt=Ke(Ee,"prelu weights","fused matMul"));var Cn={a:yn,b:On};ne!=null&&(Cn.bias=Yt),Ee!=null&&(Cn.preluActivationWeights=qt);var Xn=[yn,On];return Ue.runKernelFunc(function(er,sr){var lr=er.fusedBatchMatMul({a:yn,b:On,transposeA:S,transposeB:V,bias:Yt,activation:me,preluActivationWeights:qt});return sr([yn,On,lr]),lr},Cn,function(er,sr){var lr=sr[0],ur=sr[1],or=sr[2],Er=Et(er,or,me),kr={};return ne!=null&&(kr={bias:function(){return At(Yt,Er)}}),Object.assign(S||V?!S&&V?{a:function(){return Er.matMul(ur,!1,!1)},b:function(){return Er.matMul(lr,!0,!1)}}:S&&!V?{a:function(){return ur.matMul(Er,!1,!0)},b:function(){return lr.matMul(Er,!1,!1)}}:{a:function(){return ur.matMul(Er,!0,!0)},b:function(){return Er.matMul(lr,!0,!0)}}:{a:function(){return Er.matMul(ur,!1,!0)},b:function(){return lr.matMul(Er,!0,!1)}},kr)},"_FusedMatMul",{transposeA:S,transposeB:V,activation:me},Xn,[!0]).reshape($t)}}),kn=wt({fusedConv2d_:function(p){var c=p.x,o=p.filter,l=p.strides,g=p.pad,S=p.dataFormat,j=S===void 0?"NHWC":S,V=p.dilations,ne=V===void 0?[1,1]:V,ae=p.dimRoundingMode,me=p.bias,Ee=p.activation,Se=Ee===void 0?"linear":Ee,Ne=p.preluActivationWeights;if(Se=Se||"linear",nt(Ue.state.gradientDepth,Se)===!1){var ze=Jf(c,o,l,g,j,ne,ae);return me!=null&&(ze=ra(ze,me)),rn(ze,Se,Ne)}var $e=Ke(c,"x","conv2d"),qe=Ke(o,"filter","conv2d"),tt=$e,lt=!1;$e.rank===3&&(lt=!0,tt=$e.as4D(1,$e.shape[0],$e.shape[1],$e.shape[2])),ke(tt.rank===4,function(){return"Error in fused conv2d: input must be rank 4, but got rank "+tt.rank+"."}),ke(qe.rank===4,function(){return"Error in fused conv2d: filter must be rank 4, but got rank "+qe.rank+"."}),ae!=null&&ke(nn(g),function(){return"Error in fused conv2d: pad must be an integer when using, dimRoundingMode "+ae+" but got pad "+g+"."}),ke(tt.shape[3]===qe.shape[2],function(){return"Error in conv2d: depth of input ("+tt.shape[3]+") must match input depth for filter "+qe.shape[2]+"."}),ke(xr(l,ne),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+l+" and dilations '"+ne+"'"}),ke(j==="NHWC",function(){return"Error in conv2d: got dataFormat of "+j+" but only NHWC is currently supported."});var ht,vt,Ct=Nn(tt.shape,qe.shape,l,ne,g,ae);me!=null&&(ht=An(ht=Ke(me,"bias","fused conv2d"),$e)[0],Mi(Ct.outShape,ht.shape)),Ne!=null&&(vt=Ke(Ne,"prelu weights","fused conv2d"));var Vt={x:tt,filter:qe};me!=null&&(Vt.bias=ht),Ne!=null&&(Vt.preluActivationWeights=vt);var Yt=[qe,tt],qt=Ue.runKernelFunc(function($t,yn){var On=$t.fusedConv2d({input:tt,filter:qe,convInfo:Ct,bias:ht,activation:Se,preluActivationWeights:vt});return yn([qe,tt,On]),On},Vt,function($t,yn){var On=yn,Cn=On[0],Xn=On[1],er=On[2],sr=Et($t,er,Se);ke(Vr(ne),function(){return"Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+ne+"'"});var lr={};return me!=null&&(lr={bias:function(){return At(ht,sr)}}),Object.assign({x:function(){return ul(Xn.shape,sr,Cn,l,g)},filter:function(){return Vg(Xn,sr,Cn.shape,l,g)}},lr)},"FusedConv2D",{convInfo:Ct,activation:Se},Yt,[!0]);return lt?qt.as3D(qt.shape[1],qt.shape[2],qt.shape[3]):qt}}),En=wt({fusedDepthwiseConv2d_:function(p){var c=p.x,o=p.filter,l=p.strides,g=p.pad,S=p.dataFormat,j=S===void 0?"NHWC":S,V=p.dilations,ne=V===void 0?[1,1]:V,ae=p.dimRoundingMode,me=p.bias,Ee=p.activation,Se=Ee===void 0?"linear":Ee,Ne=p.preluActivationWeights;if(nt(Ue.state.gradientDepth,Se)===!1){var ze=Wm(c,o,l,g,j,ne,ae);return me!=null&&(ze=ra(ze,me)),rn(ze,Se,Ne)}var $e=Ke(c,"x","depthwiseConv2d"),qe=Ke(o,"filter","depthwiseConv2d"),tt=$e,lt=!1;$e.rank===3&&(lt=!0,tt=$e.as4D(1,$e.shape[0],$e.shape[1],$e.shape[2])),ke(tt.rank===4,function(){return"Error in fused depthwiseConv2d: input must be rank 4, but got rank "+tt.rank+"."}),ke(qe.rank===4,function(){return"Error in fused depthwiseConv2d: filter must be rank 4, but got rank "+qe.rank+"."}),ke(tt.shape[3]===qe.shape[2],function(){return"Error in fused depthwiseConv2d: number of input channels ("+tt.shape[3]+") must match the inChannels dimension in filter "+qe.shape[2]+"."}),ne==null&&(ne=[1,1]),ke(xr(l,ne),function(){return"Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides "+l+" and dilations '"+ne+"'"}),ae!=null&&ke(nn(g),function(){return"Error in fused depthwiseConv2d: pad must be an integer when using dimRoundingMode "+ae+" but got pad "+g+"."});var ht,vt,Ct=Nn(tt.shape,qe.shape,l,ne,g,ae,!0);me!=null&&(ht=An(ht=Ke(me,"bias","fused conv2d"),$e)[0],Mi(Ct.outShape,ht.shape)),Ne!=null&&(vt=Ke(Ne,"prelu weights","fused depthwiseConv2d"));var Vt={x:tt,filter:qe};me!=null&&(Vt.bias=ht),Ne!=null&&(Vt.preluActivationWeights=vt);var Yt=[qe,tt],qt=Ue.runKernelFunc(function($t,yn){var On=$t.fusedDepthwiseConv2D({input:tt,filter:qe,convInfo:Ct,bias:ht,activation:Se,preluActivationWeights:vt});return yn([qe,tt,On]),On},Vt,function($t,yn){ke(Vr(ne),function(){return"Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+ne+"'"});var On=yn[0],Cn=yn[1],Xn=yn[2],er=Et($t,Xn,Se),sr={};return me!=null&&(sr={bias:function(){return At(ht,er)}}),Object.assign({x:function(){return qg(Cn.shape,er,On,Ct)},filter:function(){return Qf(Cn,er,On.shape,Ct)}},sr)},"FusedDepthwiseConv2D",{convInfo:Ct,activation:Se},Yt,[!0]);return lt?qt.as3D(qt.shape[1],qt.shape[2],qt.shape[3]):qt}}),_n=Object.freeze({matMul:un,conv2d:kn,depthwiseConv2d:En}),Pn=Object.freeze({image:Xe,linalg:_,losses:Ir,spectral:im,fused:_n,signal:Xm,add:ra,addN:Wf,batchNorm:ql,batchNormalization:ro,batchNorm2d:R0,batchNormalization2d:I0,batchNorm3d:ol,batchNormalization3d:Hl,batchNorm4d:Hf,batchNormalization4d:Yh,broadcastTo:$l,clone:Gl,div:Yo,divNoNan:Up,eye:Fc,multinomial:ts,oneHot:fc,pad:Fu,pad1d:fu,pad2d:Qh,pad3d:Wp,pad4d:jm,rand:Bm,randomGamma:Hp,randomNormal:Rg,randomUniform:$p,square:Kl,squaredDifference:Gp,tile:Kf,truncatedNormal:Zh,conv1d:Wg,conv2d:Jf,conv3d:j0,depthwiseConv2d:Wm,separableConv2d:cl,conv2dTranspose:Jp,conv3dTranspose:Vm,op:wt,booleanMaskAsync:Lg,complex:ho,real:ca,imag:Ua,concat:Po,concat1d:Ih,concat2d:Pd,concat3d:Al,concat4d:Rh,split:Ri,matMul:dc,dot:qm,outerProduct:Hg,reverse:Yl,reverse1d:B0,reverse2d:ed,reverse3d:td,reverse4d:Jl,maxPool:pc,avgPool:nd,pool:lp,maxPool3d:Qp,avgPool3d:Hm,maxPoolWithArgmax:Gg,slice:ns,slice1d:Kg,slice2d:rd,slice3d:Xg,slice4d:Zp,abs:Es,acos:Oc,acosh:Ra,asin:Ac,asinh:Uu,atan:Df,atanh:Tf,ceil:Xc,clipByValue:Vd,cos:Wu,cosh:Em,erf:qd,exp:Il,expm1:jp,floor:Nf,log:Yc,log1p:Hd,logSigmoid:zh,neg:ba,reciprocal:Rl,round:Cs,rsqrt:Ml,sigmoid:Ff,sign:Uh,isNaN:$d,isInf:If,isFinite:jl,sin:Gd,sinh:Kd,softplus:tn,sqrt:Vs,step:Un,tan:Os,tanh:io,all:fp,any:ll,argMax:Yg,argMin:em,logSumExp:tm,max:$m,mean:Ic,min:nm,moments:Jg,sum:fl,prod:hp,equal:Kp,equalStrict:Pm,greater:Lm,greaterEqual:sp,greaterEqualStrict:zm,greaterStrict:Xp,less:Mg,lessEqual:sl,lessEqualStrict:M0,lessStrict:jg,notEqual:up,notEqualStrict:Bg,addStrict:Bl,atan2:Rf,divStrict:nr,floorDiv:$a,maximum:xa,maximumStrict:Hi,minimum:ku,minimumStrict:ac,mod:qs,modStrict:sc,mul:Xo,mulStrict:Vu,pow:Hs,powStrict:so,squaredDifferenceStrict:cs,sub:_a,subStrict:ls,elu:eh,leakyRelu:dp,prelu:rs,relu:rm,relu6:Gm,selu:pp,logicalAnd:Nu,logicalNot:Jh,logicalOr:$f,logicalXor:al,where:Nc,whereAsync:Gf,buffer:bi,print:oa,batchToSpaceND:Ld,cast:zd,cumsum:Ud,depthToSpace:Rp,expandDims:zu,reshape:ks,spaceToBatchND:$c,squeeze:Is,stack:ru,unstack:Mh,setdiff1dAsync:Ni,fill:ws,linspace:Fh,ones:lu,range:oc,scalar:fr,tensor:ko,tensor1d:Us,tensor2d:nu,tensor3d:Hc,tensor4d:Ws,tensor5d:Nh,tensor6d:jd,variable:Bd,zeros:Ki,onesLike:us,zerosLike:ii,transpose:ft,softmax:Be,logSoftmax:Ge,localResponseNormalization:mp,norm:Km,gather:cp,unsortedSegmentSum:Yp,basicLSTMCell:Qg,multiRNNCell:P0,movingAverage:Rc,stridedSlice:th,topk:L0,scatterND:Zg,fft:Mc,ifft:Ka,rfft:id,irfft:gp,sparseToDense:e0,gatherND:om,diag:Zl,dropout:Ev,hannWindow:vp,hammingWindow:nh,frame:sm,stft:yp,inTopKAsync:Ym});function dn(p,c){Array.isArray(p)||(p=[p]),p.forEach(function(o){o!=null&&ke(o.dtype!=="complex64",function(){return c+" does not support complex64 tensors."})})}function cr(p,c,o,l,g,S){for(var j=g.strideHeight,V=g.strideWidth,ne=g.dilationHeight,ae=g.dilationWidth,me=g.effectiveFilterHeight,Ee=g.effectiveFilterWidth,Se=g.padInfo.top,Ne=g.padInfo.left,ze=S==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,$e=bi(g.outShape,o),qe=$e.values,tt=g.outShape[1]*g.outShape[2]*g.outShape[3],lt=g.outShape[2]*g.outShape[3],ht=g.outShape[3],vt=0;vt<g.batchSize;++vt)for(var Ct=vt*tt,Vt=vt*l[0],Yt=0;Yt<g.inChannels;++Yt)for(var qt=0;qt<g.outHeight;++qt)for(var $t=qt*j-Se,yn=Math.max(0,$t),On=Math.min(g.inHeight,me+$t),Cn=Ct+qt*lt,Xn=0;Xn<g.outWidth;++Xn){for(var er=Xn*V-Ne,sr=Math.max(0,er),lr=Math.min(g.inWidth,Ee+er),ur=ze,or=0,Er=0,kr=yn;kr<On;kr+=ne){for(var Ur=Vt+kr*l[1],Zr=sr;Zr<lr;Zr+=ae){var mi=p[Ur+Zr*l[2]+Yt];S==="max"&&mi>ur?ur=mi:S==="avg"&&(or+=mi,Er++)}if(isNaN(ur))break}qe[Cn+Xn*ht+Yt]=S==="avg"?or/Er:ur}return $e}function yr(p,c,o,l,g,S){g===void 0&&(g=!1),S===void 0&&(S=!1);for(var j=bi(l.outShape,"int32"),V=l.strideHeight,ne=l.strideWidth,ae=l.dilationHeight,me=l.dilationWidth,Ee=l.effectiveFilterHeight,Se=l.effectiveFilterWidth,Ne=l.padInfo.top,ze=l.padInfo.left,$e=bi(c,o,p),qe=0;qe<l.batchSize;++qe)for(var tt=0;tt<l.inChannels;++tt)for(var lt=0;lt<l.outHeight;++lt){for(var ht=lt*V-Ne,vt=ht;vt<0;)vt+=ae;for(var Ct=Math.min(l.inHeight,Ee+ht),Vt=0;Vt<l.outWidth;++Vt){for(var Yt=Vt*ne-ze,qt=Yt;qt<0;)qt+=me;for(var $t=Math.min(l.inWidth,Se+Yt),yn=Number.NEGATIVE_INFINITY,On=-1,Cn=vt;Cn<Ct;Cn+=ae)for(var Xn=Cn-ht,er=qt;er<$t;er+=me){var sr=er-Yt,lr=$e.get(qe,Cn,er,tt);lr>yn&&(yn=lr,On=g?S?((qe*l.inHeight+Cn)*l.inWidth+er)*l.inChannels+tt:(Cn*l.inWidth+er)*l.inChannels+tt:Xn*Se+sr)}j.set(On,qe,lt,Vt,tt)}}return j}function br(p,c,o,l){if(o==="linear")return p.linear(c);if(o==="relu")return p.relu(c);if(o==="elu")return p.elu(c);if(o==="relu6")return p.relu6(c);if(o==="prelu")return p.prelu(c,l);throw new Error("Activation "+o+" has not been implemented for the CPU backend.")}var Br=function(p){function c(){var o=p.call(this)||this;return o.blockSize=48,o.firstUse=!0,o.data=new Tt(o,Ue),o}return J(c,p),c.prototype.write=function(o,l,g){this.firstUse&&(this.firstUse=!1,P().get("IS_NODE")&&qc(`
============================
Hi there . Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.
============================`));var S={};return this.data.set(S,{values:o,dtype:g}),S},c.prototype.move=function(o,l,g,S){this.data.set(o,{values:l,dtype:S})},c.prototype.numDataIds=function(){return this.data.numDataIds()},c.prototype.read=function(o){return R(this,void 0,void 0,function(){return W(this,function(l){return[2,this.readSync(o)]})})},c.prototype.readSync=function(o){var l=this.data.get(o),g=l.dtype,S=l.complexTensors;return g==="complex64"?ni(this.readSync(S.real.dataId),this.readSync(S.imag.dataId)):this.data.get(o).values},c.prototype.bufferSync=function(o){var l=this.readSync(o.dataId),g=l;if(o.dtype==="string")try{g=l.map(function(S){return hr(S)})}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return bi(o.shape,o.dtype,g)},c.prototype.makeOutput=function(o,l,g){var S=this.write(o,l,g);return Ue.makeTensorFromDataId(S,l,g,this)},c.prototype.disposeData=function(o){if(this.data.has(o)){var l=this.data.get(o).complexTensors;l!=null&&(l.real.dispose(),l.imag.dispose()),this.data.delete(o)}},c.prototype.time=function(o){return R(this,void 0,void 0,function(){var l;return W(this,function(g){return l=Zt(),o(),[2,{kernelMs:Zt()-l}]})})},c.prototype.memory=function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}},c.prototype.complex=function(o,l){var g=this.makeOutput(null,o.shape,"complex64");return this.data.get(g.dataId).complexTensors={real:Ue.keep(o.clone()),imag:Ue.keep(l.clone())},g},c.prototype.real=function(o){return this.data.get(o.dataId).complexTensors.real.clone()},c.prototype.imag=function(o){return this.data.get(o.dataId).complexTensors.imag.clone()},c.prototype.slice=function(o,l,g){if(dn(o,"slice"),Vh(o.shape,l,g)){var S=Mf(l,o.strides),j=Ye(g);return ko(this.readSync(o.dataId).subarray(S,S+j),g,o.dtype)}for(var V=bi(g,o.dtype),ne=this.bufferSync(o),ae=0;ae<V.size;++ae){var me=V.indexToLoc(ae).map(function(Ee,Se){return Ee+l[Se]});V.values[ae]=ne.get.apply(ne,me)}return V.toTensor()},c.prototype.stridedSlice=function(o,l,g,S){dn(o,"stridedSlice");var j=Ou(l,g,S);if(j.some(function(Ne){return Ne===0}))return ko([],j);for(var V=bi(j,o.dtype),ne=this.bufferSync(o),ae=0;ae<V.size;ae++){for(var me=V.indexToLoc(ae),Ee=new Array(me.length),Se=0;Se<Ee.length;Se++)Ee[Se]=me[Se]*S[Se]+l[Se];V.set.apply(V,[ne.get.apply(ne,Ee)].concat(me))}return V.toTensor()},c.prototype.diag=function(o){for(var l=this.readSync(o.dataId),g=bi([o.size,o.size],o.dtype),S=g.values,j=0;j<l.length;j++)S[j*o.size+j]=l[j];return g.toTensor()},c.prototype.unstack=function(o,l){for(var g=o.shape[l],S=new Array(o.rank-1),j=0,V=0;V<o.rank;V++)V!==l&&(S[j++]=o.shape[V]);var ne=new Array(o.rank).fill(0),ae=o.shape.slice();ae[l]=1;var me=new Array(g);for(V=0;V<me.length;V++)ne[l]=V,me[V]=this.slice(o,ne,ae).reshape(S);return me},c.prototype.reverse=function(o,l){dn(o,"reverse");for(var g=bi(o.shape,o.dtype),S=this.bufferSync(o),j=function(ne){var ae=g.indexToLoc(ne),me=ae.slice();l.forEach(function(Ee){return me[Ee]=o.shape[Ee]-1-me[Ee]}),g.set.apply(g,[S.get.apply(S,me)].concat(ae))},V=0;V<g.size;V++)j(V);return g.toTensor()},c.prototype.concat=function(o,l){var g=this;if(o[0].dtype==="complex64"){var S=o.map(function(Ne){return ca(Ne)}),j=o.map(function(Ne){return Ua(Ne)});return ho(this.concat(S,l),this.concat(j,l))}var V=o.map(function(Ne){var ze=Ye(Ne.shape.slice(l));return Ne.as2D(-1,ze)}),ne=tu(V.map(function(Ne){return Ne.shape}),1),ae=bi(ne,o[0].dtype).values;if(V[0].shape[0]===1){var me=0;V.forEach(function(Ne){ae.set(g.readSync(Ne.dataId),me),me+=Ne.size})}else{var Ee=0;V.forEach(function(Ne){for(var ze=g.readSync(Ne.dataId),$e=0,qe=0;qe<Ne.shape[0];++qe)for(var tt=qe*ne[1]+Ee,lt=0;lt<Ne.shape[1];++lt)ae[tt+lt]=ze[$e++];Ee+=Ne.shape[1]})}var Se=tu(o.map(function(Ne){return Ne.shape}),l);return ko(ae,Se,o[0].dtype)},c.prototype.neg=function(o){return dn(o,"neg"),this.multiply(fr(-1),o)},c.prototype.add=function(o,l){return o.dtype==="complex64"||l.dtype==="complex64"?this.broadcastedBinaryComplexOp(o.cast("complex64"),l.cast("complex64"),function(g,S,j,V){return{real:g+j,imag:S+V}}):this.broadcastedBinaryOp(o,l,fn(o.dtype,l.dtype),function(g,S){return g+S})},c.prototype.addN=function(o){var l=this;dn(o,"addN");for(var g=o.map(function(me){return l.readSync(me.dataId)}),S=bi(o[0].shape,o[0].dtype),j=S.values,V=0;V<o.length;V++)for(var ne=g[V],ae=0;ae<j.length;ae++)j[ae]+=ne[ae];return S.toTensor()},c.prototype.softmax=function(o,l){var g=wn([l],o.shape),S=this.max(o,g),j=_o(S.shape,g),V=this.subtract(o,S.reshape(j)),ne=this.exp(V),ae=this.sum(ne,g).reshape(j);return Yo(ne,ae)},c.prototype.subtract=function(o,l){return o.dtype==="complex64"||l.dtype==="complex64"?this.broadcastedBinaryComplexOp(o.cast("complex64"),l.cast("complex64"),function(g,S,j,V){return{real:g-j,imag:S-V}}):this.broadcastedBinaryOp(o,l,fn(o.dtype,l.dtype),function(g,S){return g-S})},c.prototype.pow=function(o,l){return dn([o,l],"pow"),this.broadcastedBinaryOp(o,l,o.dtype,function(g,S){return Math.pow(g,S)})},c.prototype.batchMatMul=function(o,l,g,S){dn([o,l],"matMul");for(var j=g?o.shape[1]:o.shape[2],V=g?o.shape[2]:o.shape[1],ne=S?l.shape[1]:l.shape[2],ae=o.shape[0],me=this.readSync(o.dataId),Ee=this.readSync(l.dataId),Se=g?[o.strides[0],1,o.strides[1]]:[o.strides[0],o.strides[1],1],Ne=Se[0],ze=Se[1],$e=Se[2],qe=S?[1,l.strides[1],l.strides[0]]:[l.strides[1],1,l.strides[0]],tt=qe[0],lt=qe[1],ht=qe[2],vt=V*ne,Ct=bi([ae,V,ne],o.dtype),Vt=Ct.values,Yt=this.blockSize,qt=0;qt<ae;qt++)for(var $t=0;$t<V;$t+=Yt)for(var yn=0;yn<ne;yn+=Yt)for(var On=0;On<j;On+=Yt)for(var Cn=Math.min($t+Yt,V),Xn=Math.min(yn+Yt,ne),er=Math.min(On+Yt,j),sr=$t;sr<Cn;sr++)for(var lr=yn;lr<Xn;lr++){for(var ur=0,or=On;or<er;or++)ur+=me[qt*Ne+sr*ze+or*$e]*Ee[or*tt+lr*lt+qt*ht];Vt[qt*vt+(sr*ne+lr)]+=ur}return Ct.toTensor()},c.prototype.fusedBatchMatMul=function(o){var l=o.a,g=o.b,S=o.transposeA,j=o.transposeB,V=o.bias,ne=o.activation,ae=o.preluActivationWeights,me=this.batchMatMul(l,g,S,j);return V&&(me=this.add(me,V)),ne&&(me=br(this,me,ne,ae)),me},c.prototype.multiply=function(o,l){return o.dtype==="complex64"||l.dtype==="complex64"?this.broadcastedBinaryComplexOp(o.cast("complex64"),l.cast("complex64"),function(g,S,j,V){return{real:g*j-S*V,imag:g*V+S*j}}):this.broadcastedBinaryOp(o,l,fn(o.dtype,l.dtype),function(g,S){return g*S})},c.prototype.floorDiv=function(o,l){return dn([o,l],"floorDiv"),this.broadcastedBinaryOp(o,l,"int32",function(g,S){return Math.floor(g/S)})},c.prototype.sum=function(o,l){dn(o,"sum"),Ko("sum",l,o.rank);for(var g=So(o.shape,l),S=g[0],j=g[1],V=Ki(S,fn(o.dtype,"int32")),ne=Ye(j),ae=this.readSync(V.dataId),me=this.readSync(o.dataId),Ee=0;Ee<ae.length;++Ee){for(var Se=Ee*ne,Ne=0,ze=0;ze<ne;++ze)Ne+=me[Se+ze];ae[Ee]=Ne}return V},c.prototype.prod=function(o,l){dn(o,"sum");for(var g=So(o.shape,l),S=g[0],j=g[1],V=Ki(S,fn(o.dtype,"int32")),ne=Ye(j),ae=this.readSync(V.dataId),me=this.readSync(o.dataId),Ee=0;Ee<ae.length;++Ee){for(var Se=Ee*ne,Ne=1,ze=0;ze<ne;++ze)Ne*=me[Se+ze];ae[Ee]=Ne}return V},c.prototype.unsortedSegmentSum=function(o,l,g){dn(o,"unsortedSegmentSum");for(var S=[],j=o.rank-l.rank,V=0;V<j;++V)l=l.expandDims(V+1);for(V=0;V<g;++V){var ne=fr(V,"int32"),ae=Kp(ne,l).asType("float32").mul(o).sum(0);S.push(ae)}return ru(S)},c.prototype.argMin=function(o,l){dn(o,"argMin");var g=[l];Ko("argMin",g,o.rank);for(var S=So(o.shape,g),j=S[0],V=S[1],ne=Ki(j,"int32"),ae=Ye(V),me=this.readSync(ne.dataId),Ee=this.readSync(o.dataId),Se=0;Se<me.length;++Se){for(var Ne=Se*ae,ze=Ee[Ne],$e=0,qe=0;qe<ae;++qe){var tt=Ee[Ne+qe];tt<ze&&(ze=tt,$e=qe)}me[Se]=$e}return ne},c.prototype.argMax=function(o,l){dn(o,"argMax");var g=[l];Ko("argMax",g,o.rank);for(var S=So(o.shape,g),j=S[0],V=S[1],ne=Ki(j,"int32"),ae=Ye(V),me=this.readSync(ne.dataId),Ee=this.readSync(o.dataId),Se=0;Se<me.length;++Se){for(var Ne=Se*ae,ze=Ee[Ne],$e=0,qe=0;qe<ae;++qe){var tt=Ee[Ne+qe];tt>ze&&(ze=tt,$e=qe)}me[Se]=$e}return ne},c.prototype.cumsum=function(o,l,g,S){if(dn(o,"cumsum"),l!==o.rank-1)throw new Error("backend.cumsum in CPU expects an inner-most axis="+(o.rank-1)+" but got axis="+l);for(var j=fn(o.dtype,"int32"),V=Ki(o.shape,j),ne=this.readSync(V.dataId),ae=this.readSync(o.dataId),me=o.shape[o.rank-1],Ee=S?function(qe,tt){return qe+me-tt-1}:function(qe,tt){return qe+tt},Se=0;Se<ae.length;Se+=me)for(var Ne=0;Ne<me;Ne++){var ze=Ee(Se,Ne);if(Ne===0)ne[ze]=g?0:ae[ze];else{var $e=Ee(Se,Ne-1);ne[ze]=g?ae[$e]+ne[$e]:ae[ze]+ne[$e]}}return V},c.prototype.equal=function(o,l){return dn([o,l],"equal"),this.broadcastedBinaryOp(o,l,"bool",function(g,S){return g===S?1:0})},c.prototype.notEqual=function(o,l){return dn([o,l],"notEqual"),this.broadcastedBinaryOp(o,l,"bool",function(g,S){return g!==S?1:0})},c.prototype.less=function(o,l){return dn([o,l],"less"),this.broadcastedBinaryOp(o,l,"bool",function(g,S){return g<S?1:0})},c.prototype.lessEqual=function(o,l){return dn([o,l],"lessEqual"),this.broadcastedBinaryOp(o,l,"bool",function(g,S){return g<=S?1:0})},c.prototype.greater=function(o,l){return dn([o,l],"greater"),this.broadcastedBinaryOp(o,l,"bool",function(g,S){return g>S?1:0})},c.prototype.greaterEqual=function(o,l){return dn([o,l],"greaterEqual"),this.broadcastedBinaryOp(o,l,"bool",function(g,S){return g>=S?1:0})},c.prototype.logicalNot=function(o){dn(o,"logicalNot");for(var l=this.readSync(o.dataId),g=new Uint8Array(l.length),S=0;S<l.length;++S)g[S]=l[S]?0:1;return this.makeOutput(g,o.shape,"bool")},c.prototype.logicalAnd=function(o,l){return dn([o,l],"logicalAnd"),this.broadcastedBinaryOp(o,l,"bool",function(g,S){return g&&S})},c.prototype.logicalOr=function(o,l){return dn([o,l],"logicalOr"),this.broadcastedBinaryOp(o,l,"bool",function(g,S){return g||S})},c.prototype.select=function(o,l,g){dn([o,l,g],"select");for(var S=this.readSync(o.dataId),j=this.readSync(l.dataId),V=this.readSync(g.dataId),ne=Ki(l.shape,fn(l.dtype,g.dtype)),ae=this.readSync(ne.dataId),me=0,Ee=o.rank===0||o.rank>1||l.rank===1?1:Ye(l.shape.slice(1)),Se=0;Se<S.length;Se++)for(var Ne=0;Ne<Ee;Ne++)S[Se]===1?ae[me++]=j[Se]:ae[me++]=V[Se];return ne},c.prototype.where=function(o){dn([o],"where");var l=this.readSync(o.dataId);return Qo(o.shape,l)},c.prototype.topk=function(o,l,g){return dn(o,"topk"),aa(this.readSync(o.dataId),o.shape,o.dtype,l)},c.prototype.min=function(o,l){dn(o,"min"),Ko("min",l,o.rank);for(var g=So(o.shape,l),S=g[0],j=g[1],V=Ki(S,o.dtype),ne=Ye(j),ae=this.readSync(V.dataId),me=this.readSync(o.dataId),Ee=0;Ee<ae.length;++Ee){for(var Se=Ee*ne,Ne=me[Se],ze=0;ze<ne;++ze){var $e=me[Se+ze];$e<Ne&&(Ne=$e)}ae[Ee]=Ne}return V},c.prototype.minimum=function(o,l){return dn([o,l],"minimum"),this.broadcastedBinaryOp(o,l,o.dtype,function(g,S){return Math.min(g,S)})},c.prototype.mod=function(o,l){return dn([o,l],"mod"),this.broadcastedBinaryOp(o,l,o.dtype,function(g,S){var j=g%S;return g<0&&S<0||g>=0&&S>=0?j:(j+S)%S})},c.prototype.max=function(o,l){dn(o,"max"),Ko("max",l,o.rank);for(var g=So(o.shape,l),S=g[0],j=g[1],V=Ki(S,o.dtype),ne=Ye(j),ae=this.readSync(V.dataId),me=this.readSync(o.dataId),Ee=0;Ee<ae.length;++Ee){for(var Se=Ee*ne,Ne=me[Se],ze=0;ze<ne;++ze){var $e=me[Se+ze];$e>Ne&&(Ne=$e)}ae[Ee]=Ne}return V},c.prototype.maximum=function(o,l){return dn([o,l],"maximum"),this.broadcastedBinaryOp(o,l,o.dtype,function(g,S){return Math.max(g,S)})},c.prototype.all=function(o,l){dn(o,"all"),Ko("all",l,o.rank);for(var g=So(o.shape,l),S=g[0],j=g[1],V=Ki(S,o.dtype),ne=Ye(j),ae=this.readSync(V.dataId),me=this.readSync(o.dataId),Ee=0;Ee<ae.length;++Ee){for(var Se=Ee*ne,Ne=me[Se],ze=0;ze<ne;++ze){var $e=me[Se+ze];Ne=Ne&&$e}ae[Ee]=Ne}return V},c.prototype.any=function(o,l){dn(o,"any"),Ko("any",l,o.rank);for(var g=So(o.shape,l),S=g[0],j=g[1],V=Ki(S,o.dtype),ne=Ye(j),ae=this.readSync(V.dataId),me=this.readSync(o.dataId),Ee=0;Ee<ae.length;++Ee){for(var Se=Ee*ne,Ne=me[Se],ze=0;ze<ne;++ze){var $e=me[Se+ze];Ne=Ne||$e}ae[Ee]=Ne}return V},c.prototype.squaredDifference=function(o,l){return dn([o,l],"squaredDifference"),this.broadcastedBinaryOp(o,l,o.dtype,function(g,S){var j=g-S;return j*j})},c.prototype.ceil=function(o){dn(o,"ceil");for(var l=this.readSync(o.dataId),g=new Float32Array(l.length),S=0;S<l.length;++S)g[S]=Math.ceil(l[S]);return this.makeOutput(g,o.shape,"float32")},c.prototype.floor=function(o){dn(o,"floor");for(var l=this.readSync(o.dataId),g=new Float32Array(l.length),S=0;S<l.length;++S)g[S]=Math.floor(l[S]);return this.makeOutput(g,o.shape,"float32")},c.prototype.sign=function(o){dn(o,"x");for(var l=this.readSync(o.dataId),g=new Float32Array(l.length),S=0;S<l.length;++S)l[S]<0?g[S]=-1:l[S]>0?g[S]=1:g[S]=0;return this.makeOutput(g,o.shape,"float32")},c.prototype.isNaN=function(o){dn(o,"x");for(var l=this.readSync(o.dataId),g=new Uint8Array(l.length),S=0;S<l.length;++S)Number.isNaN(l[S])&&(g[S]=1);return this.makeOutput(g,o.shape,"bool")},c.prototype.isInf=function(o){dn(o,"x");for(var l=this.readSync(o.dataId),g=new Uint8Array(l.length),S=0;S<l.length;++S)Math.abs(l[S])===1/0&&(g[S]=1);return this.makeOutput(g,o.shape,"bool")},c.prototype.isFinite=function(o){dn(o,"x");for(var l=this.readSync(o.dataId),g=new Uint8Array(l.length),S=0;S<l.length;++S)Number.isFinite(l[S])&&(g[S]=1);return this.makeOutput(g,o.shape,"bool")},c.prototype.round=function(o){dn(o,"round");for(var l=this.readSync(o.dataId),g=new Float32Array(l.length),S=0;S<l.length;++S){var j=Math.floor(l[S]);l[S]-j<.5?g[S]=Math.floor(l[S]):l[S]-j>.5?g[S]=Math.ceil(l[S]):g[S]=j%2==0?j:j+1}return this.makeOutput(g,o.shape,"float32")},c.prototype.exp=function(o){dn(o,"exp");for(var l=this.readSync(o.dataId),g=new Float32Array(l.length),S=0;S<l.length;++S)g[S]=Math.exp(l[S]);return this.makeOutput(g,o.shape,"float32")},c.prototype.expm1=function(o){dn(o,"expm1");for(var l=this.readSync(o.dataId),g=new Float32Array(l.length),S=0;S<l.length;++S)g[S]=Math.expm1(l[S]);return this.makeOutput(g,o.shape,"float32")},c.prototype.log=function(o){dn(o,"log");for(var l=this.readSync(o.dataId),g=new Float32Array(l.length),S=0;S<l.length;++S){var j=l[S];g[S]=Math.log(j)}return this.makeOutput(g,o.shape,"float32")},c.prototype.log1p=function(o){dn(o,"log1p");for(var l=this.readSync(o.dataId),g=new Float32Array(l.length),S=0;S<l.length;++S){var j=l[S];g[S]=Math.log1p(j)}return this.makeOutput(g,o.shape,"float32")},c.prototype.sqrt=function(o){dn(o,"sqrt");for(var l=this.readSync(o.dataId),g=new Float32Array(l.length),S=0;S<l.length;++S){var j=l[S];g[S]=Math.sqrt(j)}return this.makeOutput(g,o.shape,"float32")},c.prototype.rsqrt=function(o){dn(o,"rsqrt");for(var l=this.readSync(o.dataId),g=new Float32Array(l.length),S=0;S<l.length;++S){var j=l[S];g[S]=1/Math.sqrt(j)}return this.makeOutput(g,o.shape,"float32")},c.prototype.reciprocal=function(o){dn(o,"reciprocal");for(var l=this.readSync(o.dataId),g=new Float32Array(l.length),S=0;S<l.length;++S)g[S]=1/l[S];return this.makeOutput(g,o.shape,"float32")},c.prototype.linear=function(o){return o},c.prototype.relu=function(o){dn(o,"relu");for(var l=Ki(o.shape,o.dtype),g=this.readSync(l.dataId),S=this.readSync(o.dataId),j=0;j<S.length;++j)g[j]=Math.max(0,S[j]);return l},c.prototype.relu6=function(o){dn(o,"relu");for(var l=Ki(o.shape,o.dtype),g=this.readSync(l.dataId),S=this.readSync(o.dataId),j=0;j<S.length;++j)g[j]=Math.min(Math.max(0,S[j]),6);return l},c.prototype.prelu=function(o,l){return dn([o,l],"prelu"),this.broadcastedBinaryOp(o,l,o.dtype,function(g,S){return g<0?S*g:g})},c.prototype.elu=function(o){dn(o,"elu");for(var l=new Float32Array(o.size),g=this.readSync(o.dataId),S=0;S<g.length;++S){var j=g[S];l[S]=j>=0?j:Math.exp(j)-1}return this.makeOutput(l,o.shape,"float32")},c.prototype.eluDer=function(o,l){dn([o,l],"eluDer");for(var g=new Float32Array(l.size),S=this.readSync(l.dataId),j=this.readSync(o.dataId),V=0;V<S.length;++V){var ne=S[V];g[V]=ne>=1?j[V]:j[V]*(ne+1)}return this.makeOutput(g,l.shape,"float32")},c.prototype.selu=function(o){dn(o,"selu");for(var l=new Float32Array(o.size),g=this.readSync(o.dataId),S=0;S<g.length;++S){var j=g[S];l[S]=j>=0?1.0507009873554805*j:1.7580993408473768*(Math.exp(j)-1)}return this.makeOutput(l,o.shape,"float32")},c.prototype.clip=function(o,l,g){dn(o,"clip");for(var S=new Float32Array(o.size),j=this.readSync(o.dataId),V=0;V<j.length;++V){var ne=j[V];S[V]=ne>g?g:ne<l?l:ne}return this.makeOutput(S,o.shape,"float32")},c.prototype.abs=function(o){for(var l=new Float32Array(o.size),g=this.readSync(o.dataId),S=0;S<g.length;++S)l[S]=Math.abs(g[S]);return this.makeOutput(l,o.shape,"float32")},c.prototype.complexAbs=function(o){for(var l=new Float32Array(o.size),g=this.readSync(o.dataId),S=0;S<o.size;++S){var j=g[2*S],V=g[2*S+1];l[S]=Math.hypot(j,V)}return this.makeOutput(l,o.shape,"float32")},c.prototype.int=function(o){dn(o,"int");for(var l=new Int32Array(o.size),g=this.readSync(o.dataId),S=0;S<g.length;++S)l[S]=g[S];return this.makeOutput(l,o.shape,"int32")},c.prototype.sigmoid=function(o){dn(o,"sigmoid");for(var l=new Float32Array(o.size),g=this.readSync(o.dataId),S=0;S<g.length;++S)l[S]=1/(1+Math.exp(-g[S]));return this.makeOutput(l,o.shape,"float32")},c.prototype.softplus=function(o){dn(o,"softplus");for(var l=Math.log(11920928955078125e-23)+2,g=new Float32Array(o.size),S=this.readSync(o.dataId),j=0;j<S.length;++j){var V,ne=S[j]>-l,ae=S[j]<l,me=Math.exp(S[j]);V=ae?me:ne?S[j]:Math.log(1+me),g[j]=V}return this.makeOutput(g,o.shape,"float32")},c.prototype.sin=function(o){dn(o,"sin");for(var l=new Float32Array(o.size),g=this.readSync(o.dataId),S=0;S<g.length;++S)l[S]=Math.sin(g[S]);return this.makeOutput(l,o.shape,"float32")},c.prototype.cos=function(o){dn(o,"cos");for(var l=new Float32Array(o.size),g=this.readSync(o.dataId),S=0;S<g.length;++S)l[S]=Math.cos(g[S]);return this.makeOutput(l,o.shape,"float32")},c.prototype.tan=function(o){dn(o,"tan");for(var l=new Float32Array(o.size),g=this.readSync(o.dataId),S=0;S<g.length;++S)l[S]=Math.tan(g[S]);return this.makeOutput(l,o.shape,"float32")},c.prototype.asin=function(o){dn(o,"asin");for(var l=new Float32Array(o.size),g=this.readSync(o.dataId),S=0;S<g.length;++S)l[S]=Math.asin(g[S]);return this.makeOutput(l,o.shape,"float32")},c.prototype.acos=function(o){dn(o,"acos");for(var l=new Float32Array(o.size),g=this.readSync(o.dataId),S=0;S<g.length;++S)l[S]=Math.acos(g[S]);return this.makeOutput(l,o.shape,"float32")},c.prototype.atan=function(o){dn(o,"atan");for(var l=new Float32Array(o.size),g=this.readSync(o.dataId),S=0;S<g.length;++S)l[S]=Math.atan(g[S]);return this.makeOutput(l,o.shape,"float32")},c.prototype.atan2=function(o,l){return dn([o,l],"atan2"),this.broadcastedBinaryOp(o,l,o.dtype,function(g,S){return Math.atan2(g,S)})},c.prototype.sinh=function(o){dn(o,"sinh");for(var l=new Float32Array(o.size),g=this.readSync(o.dataId),S=0;S<g.length;++S)l[S]=Math.sinh(g[S]);return this.makeOutput(l,o.shape,"float32")},c.prototype.cosh=function(o){dn(o,"cosh");for(var l=new Float32Array(o.size),g=this.readSync(o.dataId),S=0;S<g.length;++S)l[S]=Math.cosh(g[S]);return this.makeOutput(l,o.shape,"float32")},c.prototype.tanh=function(o){dn(o,"tanh");for(var l=new Float32Array(o.size),g=this.readSync(o.dataId),S=0;S<g.length;++S)l[S]=Bt(g[S]);return this.makeOutput(l,o.shape,"float32")},c.prototype.asinh=function(o){dn(o,"asinh");for(var l=new Float32Array(o.size),g=this.readSync(o.dataId),S=0;S<g.length;++S)l[S]=Math.asinh(g[S]);return this.makeOutput(l,o.shape,"float32")},c.prototype.acosh=function(o){dn(o,"acosh");for(var l=new Float32Array(o.size),g=this.readSync(o.dataId),S=0;S<g.length;++S)l[S]=Math.acosh(g[S]);return this.makeOutput(l,o.shape,"float32")},c.prototype.atanh=function(o){dn(o,"atanh");for(var l=new Float32Array(o.size),g=this.readSync(o.dataId),S=0;S<g.length;++S)l[S]=Math.atanh(g[S]);return this.makeOutput(l,o.shape,"float32")},c.prototype.erf=function(o){dn(o,"erf");for(var l=new Float32Array(o.size),g=this.readSync(o.dataId),S=0;S<g.length;++S){var j=Math.sign(g[S]),V=Math.abs(g[S]),ne=1/(1+.3275911*V);l[S]=j*(1-((((1.061405429*ne-1.453152027)*ne+1.421413741)*ne-.284496736)*ne+.254829592)*ne*Math.exp(-V*V))}return this.makeOutput(l,o.shape,"float32")},c.prototype.step=function(o,l){l===void 0&&(l=0),dn(o,"step");for(var g=new Float32Array(o.size),S=this.readSync(o.dataId),j=0;j<S.length;++j){var V=S[j];isNaN(V)?g[j]=NaN:g[j]=V>0?1:l}return this.makeOutput(g,o.shape,"float32")},c.prototype.fusedConv2d=function(o){var l=o.input,g=o.filter,S=o.convInfo,j=o.bias,V=o.activation,ne=o.preluActivationWeights,ae=this.conv2d(l,g,S);return j&&(ae=this.add(ae,j)),V&&(ae=br(this,ae,V,ne)),ae},c.prototype.conv2d=function(o,l,g){dn([o,l],"conv2d");for(var S=g.filterHeight,j=g.filterWidth,V=g.dilationHeight,ne=g.dilationWidth,ae=g.padInfo.left,me=g.padInfo.top,Ee=g.dataFormat==="channelsLast",Se=bi(g.outShape,o.dtype),Ne=o.strides[0],ze=Ee?o.strides[1]:o.strides[2],$e=Ee?o.strides[2]:1,qe=Ee?1:o.strides[1],tt=Se.strides[0],lt=Ee?Se.strides[1]:Se.strides[2],ht=Ee?Se.strides[2]:1,vt=Ee?1:Se.strides[1],Ct=this.readSync(o.dataId),Vt=this.readSync(l.dataId),Yt=Se.values,qt=0;qt<g.batchSize;++qt)for(var $t=qt*Ne,yn=qt*tt,On=0;On<g.outHeight;++On)for(var Cn=yn+On*lt,Xn=On*g.strideHeight-me,er=0;er<S;er++){var sr=Xn+er*V;if(!(sr<0||sr>=g.inHeight))for(var lr=er*l.strides[0],ur=$t+sr*ze,or=0;or<g.outWidth;++or)for(var Er=Cn+or*ht,kr=or*g.strideWidth-ae,Ur=0;Ur<j;Ur++){var Zr=kr+Ur*ne;if(!(Zr<0||Zr>=g.inWidth))for(var mi=ur+Zr*$e,co=lr+Ur*l.strides[1],lo=0;lo<g.inChannels;++lo){for(var Eo=Ct[mi+lo*qe],wo=0;wo<g.outChannels;++wo)Yt[Er+wo*vt]+=Eo*Vt[co+wo];co+=g.outChannels}}}return Se.toTensor()},c.prototype.conv3d=function(o,l,g){for(var S=g.filterDepth,j=g.filterHeight,V=g.filterWidth,ne=g.dilationDepth,ae=g.dilationHeight,me=g.dilationWidth,Ee=g.padInfo.front,Se=g.padInfo.left,Ne=g.padInfo.top,ze=bi(g.outShape,o.dtype),$e=this.readSync(o.dataId),qe=this.readSync(l.dataId),tt=ze.values,lt=0;lt<g.batchSize;++lt)for(var ht=lt*o.strides[0],vt=lt*ze.strides[0],Ct=0;Ct<g.outDepth;++Ct)for(var Vt=vt+Ct*ze.strides[1],Yt=Ct*g.strideDepth-Ee,qt=0;qt<S;qt++){var $t=Yt+qt*ne;if(!($t<0||$t>=g.inDepth))for(var yn=qt*l.strides[0],On=ht+$t*o.strides[1],Cn=0;Cn<g.outHeight;++Cn)for(var Xn=Vt+Cn*ze.strides[2],er=Cn*g.strideHeight-Ne,sr=0;sr<j;sr++){var lr=er+sr*ae;if(!(lr<0||lr>=g.inHeight))for(var ur=yn+sr*l.strides[1],or=On+lr*o.strides[2],Er=0;Er<g.outWidth;++Er)for(var kr=Xn+Er*g.outChannels,Ur=Er*g.strideWidth-Se,Zr=0;Zr<V;Zr++){var mi=Ur+Zr*me;if(!(mi<0||mi>=g.inWidth))for(var co=ur+Zr*l.strides[2],lo=or+mi*g.inChannels,Eo=co,wo=0;wo<g.inChannels;++wo){for(var Bo=$e[lo+wo],ta=0;ta<g.outChannels;++ta)tt[kr+ta]+=Bo*qe[Eo+ta];Eo+=g.outChannels}}}}return ze.toTensor()},c.prototype.conv2dDerInput=function(o,l,g){dn([o,l],"conv2dDerInput");for(var S=bi(g.inShape,"float32"),j=S.values,V=this.readSync(o.dataId),ne=this.readSync(l.dataId),ae=l.strides,me=ae[0],Ee=ae[1],Se=ae[2],Ne=g.batchSize,ze=g.filterHeight,$e=g.filterWidth,qe=g.inChannels,tt=g.inHeight,lt=g.inWidth,ht=g.outChannels,vt=g.outHeight,Ct=g.outWidth,Vt=g.strideHeight,Yt=g.strideWidth,qt=g.dataFormat,$t=ze-1-g.padInfo.top,yn=$e-1-g.padInfo.left,On=qt==="channelsLast",Cn=S.strides[0],Xn=On?S.strides[1]:S.strides[2],er=On?S.strides[2]:1,sr=On?1:S.strides[1],lr=o.strides[0],ur=On?o.strides[1]:o.strides[2],or=On?o.strides[2]:1,Er=On?1:o.strides[1],kr=0;kr<Ne;++kr)for(var Ur=0;Ur<qe;++Ur)for(var Zr=0;Zr<tt;++Zr)for(var mi=Zr-$t,co=Math.max(0,Math.ceil(mi/Vt)),lo=Math.min(vt,(ze+mi)/Vt),Eo=0;Eo<lt;++Eo){for(var wo=Eo-yn,Bo=Math.max(0,Math.ceil(wo/Yt)),ta=Math.min(Ct,($e+wo)/Yt),Pa=0,Xi=co;Xi<lo;++Xi)for(var Co=Xi*Vt-mi,Vo=Bo;Vo<ta;++Vo)for(var au=lr*kr+ur*Xi+or*Vo,js=me*(ze-1-Co)+Ee*($e-1-(Vo*Yt-wo))+Se*Ur,Bs=0;Bs<ht;++Bs)Pa+=V[au+Er*Bs]*ne[js+Bs];j[Cn*kr+Xn*Zr+er*Eo+sr*Ur]=Pa}return S.toTensor()},c.prototype.conv3dDerInput=function(o,l,g){for(var S=bi(g.inShape,"float32"),j=S.values,V=S.strides,ne=V[0],ae=V[1],me=V[2],Ee=V[3],Se=this.readSync(o.dataId),Ne=o.strides,ze=Ne[0],$e=Ne[1],qe=Ne[2],tt=Ne[3],lt=this.readSync(l.dataId),ht=l.strides,vt=ht[0],Ct=ht[1],Vt=ht[2],Yt=ht[3],qt=g.batchSize,$t=g.filterDepth,yn=g.filterHeight,On=g.filterWidth,Cn=g.inChannels,Xn=g.inDepth,er=g.inHeight,sr=g.inWidth,lr=g.outChannels,ur=g.outDepth,or=g.outHeight,Er=g.outWidth,kr=g.strideDepth,Ur=g.strideHeight,Zr=g.strideWidth,mi=$t-1-g.padInfo.front,co=yn-1-g.padInfo.top,lo=On-1-g.padInfo.left,Eo=0;Eo<qt;++Eo)for(var wo=0;wo<Cn;++wo)for(var Bo=0;Bo<Xn;++Bo)for(var ta=Bo-mi,Pa=Math.max(0,Math.ceil(ta/kr)),Xi=Math.min(ur,($t+ta)/kr),Co=0;Co<er;++Co)for(var Vo=Co-co,au=Math.max(0,Math.ceil(Vo/Ur)),js=Math.min(or,(yn+Vo)/Ur),Bs=0;Bs<sr;++Bs){for(var hd=Bs-lo,dd=Math.max(0,Math.ceil(hd/Zr)),kp=Math.min(Er,(On+hd)/Zr),mu=0,Qm=Pa;Qm<Xi;++Qm)for(var o0=Qm*kr-ta,pd=au;pd<js;++pd)for(var a0=pd*Ur-Vo,Ep=dd;Ep<kp;++Ep)for(var Ix=ze*Eo+$e*Qm+qe*pd+tt*Ep,Dv=vt*($t-1-o0)+Ct*(yn-1-a0)+Vt*(On-1-(Ep*Zr-hd))+Yt*wo,md=0;md<lr;++md)mu+=Se[Ix+md]*lt[Dv+md];j[ne*Eo+ae*Bo+me*Co+Ee*Bs+wo]=mu}return S.toTensor()},c.prototype.conv2dDerFilter=function(o,l,g){dn([o,l],"conv2dDerFilter");for(var S=g.strideHeight,j=g.strideWidth,V=g.filterHeight,ne=g.filterWidth,ae=g.dataFormat==="channelsLast",me=bi(g.filterShape,"float32"),Ee=g.padInfo.left,Se=g.padInfo.top,Ne=this.bufferSync(o),ze=this.bufferSync(l),$e=0;$e<V;++$e)for(var qe=Math.max(0,Math.ceil((Se-$e)/S)),tt=Math.min(g.outHeight,(g.inHeight+Se-$e)/S),lt=0;lt<ne;++lt)for(var ht=Math.max(0,Math.ceil((Ee-lt)/j)),vt=Math.min(g.outWidth,(g.inWidth+Ee-lt)/j),Ct=0;Ct<g.inChannels;++Ct)for(var Vt=0;Vt<g.outChannels;++Vt){for(var Yt=0,qt=0;qt<g.batchSize;++qt)for(var $t=qe;$t<tt;++$t)for(var yn=$e+$t*S-Se,On=ht;On<vt;++On){var Cn=lt+On*j-Ee;Yt+=ae?Ne.get(qt,yn,Cn,Ct)*ze.get(qt,$t,On,Vt):Ne.get(qt,Ct,yn,Cn)*ze.get(qt,Vt,$t,On)}me.set(Yt,$e,lt,Ct,Vt)}return me.toTensor()},c.prototype.conv3dDerFilter=function(o,l,g){for(var S=g.strideDepth,j=g.strideHeight,V=g.strideWidth,ne=g.filterDepth,ae=g.filterHeight,me=g.filterWidth,Ee=bi(g.filterShape,"float32"),Se=Ee.values,Ne=Ee.strides,ze=Ne[0],$e=Ne[1],qe=Ne[2],tt=Ne[3],lt=this.readSync(l.dataId),ht=l.strides,vt=ht[0],Ct=ht[1],Vt=ht[2],Yt=ht[3],qt=this.readSync(o.dataId),$t=o.strides,yn=$t[0],On=$t[1],Cn=$t[2],Xn=$t[3],er=g.padInfo.front,sr=g.padInfo.left,lr=g.padInfo.top,ur=0;ur<ne;++ur)for(var or=Math.max(0,Math.ceil((er-ur)/S)),Er=Math.min(g.outDepth,(g.inDepth+er-ur)/S),kr=ur*ze,Ur=0;Ur<ae;++Ur)for(var Zr=Math.max(0,Math.ceil((lr-Ur)/j)),mi=Math.min(g.outHeight,(g.inHeight+lr-Ur)/j),co=Ur*$e+kr,lo=0;lo<me;++lo)for(var Eo=Math.max(0,Math.ceil((sr-lo)/V)),wo=Math.min(g.outWidth,(g.inWidth+sr-lo)/V),Bo=lo*qe+co,ta=0;ta<g.inChannels;++ta)for(var Pa=ta*tt+Bo,Xi=0;Xi<g.outChannels;++Xi){for(var Co=0,Vo=0;Vo<g.batchSize;++Vo)for(var au=Vo*yn,js=Vo*vt,Bs=or;Bs<Er;++Bs)for(var hd=(ur+Bs*S-er)*On+au,dd=Bs*Ct+js,kp=Zr;kp<mi;++kp)for(var mu=(Ur+kp*j-lr)*Cn+hd,Qm=kp*Vt+dd,o0=Eo;o0<wo;++o0){var pd=o0*Yt+Qm;Co+=qt[(lo+o0*V-sr)*Xn+mu+ta]*lt[pd+Xi]}Se[Pa+Xi]=Co}return Ee.toTensor()},c.prototype.fusedDepthwiseConv2D=function(o){var l=o.input,g=o.filter,S=o.convInfo,j=o.bias,V=o.activation,ne=o.preluActivationWeights,ae=this.depthwiseConv2D(l,g,S);return j&&(ae=this.add(ae,j)),V&&(ae=br(this,ae,V,ne)),ae},c.prototype.depthwiseConv2D=function(o,l,g){dn([o,l],"depthwiseConv2D");for(var S=g.filterHeight,j=g.filterWidth,V=g.dilationHeight,ne=g.dilationWidth,ae=g.padInfo.left,me=g.padInfo.top,Ee=g.outChannels/g.inChannels,Se=bi(g.outShape,o.dtype),Ne=this.readSync(o.dataId),ze=this.readSync(l.dataId),$e=Se.values,qe=0;qe<g.batchSize;++qe)for(var tt=qe*o.strides[0],lt=qe*Se.strides[0],ht=0;ht<g.outHeight;++ht)for(var vt=lt+ht*Se.strides[1],Ct=ht*g.strideHeight-ae,Vt=0;Vt<S;++Vt){var Yt=Ct+Vt*V;if(!(Yt<0||Yt>=g.inHeight))for(var qt=Vt*l.strides[0],$t=tt+Yt*o.strides[1],yn=0;yn<g.outWidth;++yn)for(var On=vt+yn*Se.strides[2],Cn=yn*g.strideWidth-me,Xn=0;Xn<j;++Xn){var er=Cn+Xn*ne;if(!(er<0||er>=g.inWidth))for(var sr=qt+Xn*l.strides[1],lr=$t+er*g.inChannels,ur=On,or=sr,Er=0;Er<g.inChannels;++Er){for(var kr=Ne[lr+Er],Ur=0;Ur<Ee;++Ur)$e[ur+Ur]+=kr*ze[or+Ur];ur+=Ee,or+=Ee}}}return Se.toTensor()},c.prototype.depthwiseConv2DDerInput=function(o,l,g){dn([o,l],"depthwiseConv2DDerInput");for(var S=bi(g.inShape,"float32"),j=S.values,V=S.strides,ne=V[0],ae=V[1],me=V[2],Ee=this.readSync(o.dataId),Se=o.strides,Ne=Se[0],ze=Se[1],$e=Se[2],qe=this.readSync(l.dataId),tt=l.strides,lt=tt[0],ht=tt[1],vt=tt[2],Ct=g.batchSize,Vt=g.filterHeight,Yt=g.filterWidth,qt=g.inChannels,$t=g.inHeight,yn=g.inWidth,On=g.outChannels,Cn=g.outHeight,Xn=g.outWidth,er=g.strideHeight,sr=g.strideWidth,lr=Vt-1-g.padInfo.top,ur=Yt-1-g.padInfo.left,or=On/qt,Er=0;Er<Ct;++Er)for(var kr=0;kr<qt;++kr)for(var Ur=0;Ur<$t;++Ur)for(var Zr=Ur-lr,mi=Math.max(0,Math.ceil(Zr/er)),co=Math.min(Cn,(Vt+Zr)/er),lo=0;lo<yn;++lo){for(var Eo=lo-ur,wo=Math.max(0,Math.ceil(Eo/sr)),Bo=Math.min(Xn,(Yt+Eo)/sr),ta=0,Pa=mi;Pa<co;++Pa)for(var Xi=Pa*er-Zr,Co=wo;Co<Bo;++Co)for(var Vo=Ne*Er+ze*Pa+$e*Co,au=lt*(Vt-1-Xi)+ht*(Yt-1-(Co*sr-Eo))+vt*kr,js=0;js<or;++js)ta+=Ee[Vo+(kr*or+js)]*qe[au+js];j[ne*Er+ae*Ur+me*lo+kr]=ta}return S.toTensor()},c.prototype.depthwiseConv2DDerFilter=function(o,l,g){dn([o,l],"depthwiseConv2DDerFilter");for(var S=g.strideHeight,j=g.strideWidth,V=g.filterHeight,ne=g.filterWidth,ae=bi(g.filterShape,"float32"),me=g.padInfo.left,Ee=g.padInfo.top,Se=g.outChannels/g.inChannels,Ne=this.bufferSync(o),ze=this.bufferSync(l),$e=0;$e<V;++$e)for(var qe=Math.max(0,Math.ceil((Ee-$e)/S)),tt=Math.min(g.outHeight,(g.inHeight+Ee-$e)/S),lt=0;lt<ne;++lt)for(var ht=Math.max(0,Math.ceil((me-lt)/j)),vt=Math.min(g.outWidth,(g.inWidth+me-lt)/j),Ct=0;Ct<g.outChannels;++Ct){for(var Vt=Math.trunc(Ct/Se),Yt=Ct%Se,qt=0,$t=0;$t<g.batchSize;++$t)for(var yn=qe;yn<tt;++yn)for(var On=$e+yn*S-Ee,Cn=ht;Cn<vt;++Cn){var Xn=lt+Cn*j-me;qt+=Ne.get($t,On,Xn,Vt)*ze.get($t,yn,Cn,Ct)}ae.set(qt,$e,lt,Vt,Yt)}return ae.toTensor()},c.prototype.tile=function(o,l){return dn(o,"tile"),ha(this.bufferSync(o),l)},c.prototype.pad=function(o,l,g){dn(o,"pad");var S=l.map(function(Se,Ne){return Se[0]+o.shape[Ne]+Se[1]}),j=l.map(function(Se){return Se[0]}),V=this.bufferSync(o),ne=bi(S,o.dtype);g!==0&&ne.values.fill(g);for(var ae=0;ae<o.size;ae++){var me=V.indexToLoc(ae),Ee=me.map(function(Se,Ne){return Se+j[Ne]});ne.set.apply(ne,[V.get.apply(V,me)].concat(Ee))}return ne.toTensor()},c.prototype.gather=function(o,l,g){dn([o,l],"gather");var S=o.shape.slice(),j=this.readSync(l.dataId);S[g]=j.length;for(var V=bi(S,o.dtype),ne=this.bufferSync(o),ae=0;ae<V.size;++ae){var me=V.indexToLoc(ae),Ee=me.slice();Ee[g]=j[me[g]];var Se=ne.locToIndex(Ee);V.values[ae]=ne.values[Se]}return V.toTensor()},c.prototype.batchToSpaceND=function(o,l,g){dn([o],"batchToSpaceND");var S=l.reduce(function(Ee,Se){return Ee*Se}),j=Sf(o.shape,l,S),V=Gc(j.length,l.length),ne=Sl(o.shape,l,S),ae=Wd(g,l.length),me=Mp(ne,g,l.length);return ft(o.reshape(j),V).reshape(ne).slice(ae,me)},c.prototype.spaceToBatchND=function(o,l,g){dn([o],"spaceToBatchND");var S=l.reduce(function(Se,Ne){return Se*Ne}),j=[[0,0]];j.push.apply(j,g);for(var V=1+l.length;V<o.shape.length;++V)j.push([0,0]);var ne=o.pad(j),ae=Sf(ne.shape,l,S,!1),me=Gc(ae.length,l.length,!1),Ee=Sl(ne.shape,l,S,!1);return ft(ne.reshape(ae),me).reshape(Ee)},c.prototype.maxPool=function(o,l){return dn(o,"maxPool"),cr(this.readSync(o.dataId),o.shape,o.dtype,o.strides,l,"max").toTensor()},c.prototype.maxPoolBackprop=function(o,l,g,S){dn([l,g],"maxPoolBackprop");for(var j=this.readSync(l.dataId),V=bi(S.outShape,l.dtype,yr(j,l.shape,l.dtype,S).values),ne=S.strideHeight,ae=S.strideWidth,me=S.dilationHeight,Ee=S.dilationWidth,Se=S.effectiveFilterHeight,Ne=S.effectiveFilterWidth,ze=Ne-1-S.padInfo.left,$e=Se-1-S.padInfo.top,qe=bi(l.shape,"float32"),tt=this.bufferSync(o),lt=0;lt<S.batchSize;++lt)for(var ht=0;ht<S.inChannels;++ht)for(var vt=0;vt<S.inHeight;++vt)for(var Ct=0;Ct<S.inWidth;++Ct){for(var Vt=vt-$e,Yt=Ct-ze,qt=0,$t=0;$t<Se;$t+=me){var yn=(Vt+$t)/ne;if(!(yn<0||yn>=S.outHeight||Math.floor(yn)!==yn))for(var On=0;On<Ne;On+=Ee){var Cn=(Yt+On)/ae;if(!(Cn<0||Cn>=S.outWidth||Math.floor(Cn)!==Cn)){var Xn=Se*Ne-1-V.get(lt,yn,Cn,ht)===$t*Ne+On?1:0;Xn!==0&&(qt+=tt.get(lt,yn,Cn,ht)*Xn)}}}qe.set(qt,lt,vt,Ct,ht)}return qe.toTensor()},c.prototype.avgPoolBackprop=function(o,l,g){dn([o,l],"avgPoolBackprop");for(var S=g.strideHeight,j=g.strideWidth,V=g.filterHeight,ne=g.filterWidth,ae=g.dilationHeight,me=g.dilationWidth,Ee=g.effectiveFilterHeight,Se=g.effectiveFilterWidth,Ne=Se-1-g.padInfo.left,ze=Ee-1-g.padInfo.top,$e=bi(l.shape,"float32"),qe=1/(V*ne),tt=this.bufferSync(o),lt=0;lt<g.batchSize;++lt)for(var ht=0;ht<g.inChannels;++ht)for(var vt=0;vt<g.inHeight;++vt)for(var Ct=0;Ct<g.inWidth;++Ct){for(var Vt=vt-ze,Yt=Ct-Ne,qt=0,$t=0;$t<Ee;$t+=ae){var yn=(Vt+$t)/S;if(!(yn<0||yn>=g.outHeight||Math.floor(yn)!==yn))for(var On=0;On<Se;On+=me){var Cn=(Yt+On)/j;Cn<0||Cn>=g.outWidth||Math.floor(Cn)!==Cn||(qt+=tt.get(lt,yn,Cn,ht))}}$e.set(qt*qe,lt,vt,Ct,ht)}return $e.toTensor()},c.prototype.pool3d=function(o,l,g){dn(o,"pool3d");for(var S=l.strideDepth,j=l.strideHeight,V=l.strideWidth,ne=l.dilationDepth,ae=l.dilationHeight,me=l.dilationWidth,Ee=l.effectiveFilterDepth,Se=l.effectiveFilterHeight,Ne=l.effectiveFilterWidth,ze=l.padInfo.front,$e=l.padInfo.top,qe=l.padInfo.left,tt=g==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,lt=this.readSync(o.dataId),ht=bi(l.outShape,o.dtype),vt=ht.values,Ct=l.outShape[1]*l.outShape[2]*l.outShape[3]*l.outShape[4],Vt=l.outShape[2]*l.outShape[3]*l.outShape[4],Yt=l.outShape[3]*l.outShape[4],qt=l.outShape[4],$t=0;$t<l.batchSize;++$t)for(var yn=$t*Ct,On=$t*o.strides[0],Cn=0;Cn<l.inChannels;++Cn)for(var Xn=0;Xn<l.outDepth;++Xn){for(var er=Xn*S-ze,sr=er;sr<0;)sr+=ne;for(var lr=Math.min(l.inDepth,Ee+er),ur=yn+Xn*Vt,or=0;or<l.outHeight;++or){for(var Er=or*j-$e,kr=Er;kr<0;)kr+=ae;for(var Ur=Math.min(l.inHeight,Se+Er),Zr=ur+or*Yt,mi=0;mi<l.outWidth;++mi){for(var co=mi*V-qe,lo=co;lo<0;)lo+=me;for(var Eo=Math.min(l.inWidth,Ne+co),wo=Zr+mi*qt,Bo=tt,ta=0,Pa=0,Xi=sr;Xi<lr;Xi+=ne){for(var Co=On+Xi*o.strides[1],Vo=kr;Vo<Ur;Vo+=ae){for(var au=Co+Vo*o.strides[2],js=lo;js<Eo;js+=me){var Bs=lt[au+js*o.strides[3]+Cn];if(g==="max"&&Bs>Bo?Bo=Bs:g==="avg"&&(ta+=Bs,Pa++),isNaN(Bo))break}if(isNaN(Bo))break}if(isNaN(Bo))break}vt[wo+Cn]=g==="avg"?ta/Pa:Bo}}}return ht.toTensor()},c.prototype.avgPool3d=function(o,l){return dn(o,"avgPool3d"),this.pool3d(o,l,"avg").toFloat()},c.prototype.avgPool3dBackprop=function(o,l,g){dn([o,l],"avgPool3dBackprop");for(var S=g.strideDepth,j=g.strideHeight,V=g.strideWidth,ne=g.filterDepth,ae=g.filterHeight,me=g.filterWidth,Ee=g.dilationDepth,Se=g.dilationHeight,Ne=g.dilationWidth,ze=g.effectiveFilterDepth,$e=g.effectiveFilterHeight,qe=g.effectiveFilterWidth,tt=ze-1-g.padInfo.front,lt=qe-1-g.padInfo.left,ht=$e-1-g.padInfo.top,vt=bi(l.shape,"float32"),Ct=1/(ne*ae*me),Vt=this.bufferSync(o),Yt=0;Yt<g.batchSize;++Yt)for(var qt=0;qt<g.inChannels;++qt)for(var $t=0;$t<g.inDepth;++$t)for(var yn=0;yn<g.inHeight;++yn)for(var On=0;On<g.inWidth;++On){for(var Cn=$t-tt,Xn=yn-ht,er=On-lt,sr=0,lr=0;lr<ze;lr+=Ee){var ur=(Cn+lr)/S;if(!(ur<0||ur>=g.outDepth||Math.floor(ur)!==ur))for(var or=0;or<$e;or+=Se){var Er=(Xn+or)/j;if(!(Er<0||Er>=g.outHeight||Math.floor(Er)!==Er))for(var kr=0;kr<qe;kr+=Ne){var Ur=(er+kr)/V;Ur<0||Ur>=g.outWidth||Math.floor(Ur)!==Ur||(sr+=Vt.get(Yt,ur,Er,Ur,qt))}}}vt.set(sr*Ct,Yt,$t,yn,On,qt)}return vt.toTensor()},c.prototype.maxPool3d=function(o,l){return dn(o,"maxPool3d"),this.pool3d(o,l,"max").toFloat()},c.prototype.maxPool3dPositions=function(o,l){for(var g=bi(l.outShape,"int32"),S=l.strideDepth,j=l.strideHeight,V=l.strideWidth,ne=l.dilationDepth,ae=l.dilationHeight,me=l.dilationWidth,Ee=l.effectiveFilterDepth,Se=l.effectiveFilterHeight,Ne=l.effectiveFilterWidth,ze=l.padInfo.front,$e=l.padInfo.top,qe=l.padInfo.left,tt=this.bufferSync(o),lt=0;lt<l.batchSize;++lt)for(var ht=0;ht<l.inChannels;++ht)for(var vt=0;vt<l.outDepth;++vt){for(var Ct=vt*S-ze,Vt=Ct;Vt<0;)Vt+=ne;for(var Yt=Math.min(l.inDepth,Ee+Ct),qt=0;qt<l.outHeight;++qt){for(var $t=qt*j-$e,yn=$t;yn<0;)yn+=ae;for(var On=Math.min(l.inHeight,Se+$t),Cn=0;Cn<l.outWidth;++Cn){for(var Xn=Cn*V-qe,er=Xn;er<0;)er+=me;for(var sr=Math.min(l.inWidth,Ne+Xn),lr=Number.NEGATIVE_INFINITY,ur=-1,or=Vt;or<Yt;or+=ne)for(var Er=or-Ct,kr=yn;kr<On;kr+=ae)for(var Ur=kr-$t,Zr=er;Zr<sr;Zr+=me){var mi=Zr-Xn,co=tt.get(lt,or,kr,Zr,ht);co>=lr&&(lr=co,ur=Er*Se*Ne+Ur*Se+mi)}g.set(ur,lt,vt,qt,Cn,ht)}}}return g.toTensor()},c.prototype.maxPool3dBackprop=function(o,l,g,S){dn([l,g],"maxPool3dBackprop");for(var j=this.maxPool3dPositions(l,S),V=S.strideDepth,ne=S.strideHeight,ae=S.strideWidth,me=S.dilationDepth,Ee=S.dilationHeight,Se=S.dilationWidth,Ne=S.effectiveFilterDepth,ze=S.effectiveFilterHeight,$e=S.effectiveFilterWidth,qe=Ne-1-S.padInfo.front,tt=$e-1-S.padInfo.left,lt=ze-1-S.padInfo.top,ht=bi(l.shape,"float32"),vt=this.bufferSync(j),Ct=this.bufferSync(o),Vt=0;Vt<S.batchSize;++Vt)for(var Yt=0;Yt<S.inChannels;++Yt)for(var qt=0;qt<S.inDepth;++qt)for(var $t=0;$t<S.inHeight;++$t)for(var yn=0;yn<S.inWidth;++yn){for(var On=qt-qe,Cn=$t-lt,Xn=yn-tt,er=0,sr=0;sr<Ne;sr+=me){var lr=(On+sr)/V;if(!(lr<0||lr>=S.outDepth||Math.floor(lr)!==lr))for(var ur=0;ur<ze;ur+=Ee){var or=(Cn+ur)/ne;if(!(or<0||or>=S.outHeight||Math.floor(or)!==or))for(var Er=0;Er<$e;Er+=Se){var kr=(Xn+Er)/ae;if(!(kr<0||kr>=S.outWidth||Math.floor(kr)!==kr)){var Ur=Ne*ze*$e-1-vt.get(Vt,lr,or,kr,Yt)===sr*ze*$e+ur*$e+Er?1:0;Ur!==0&&(er+=Ct.get(Vt,lr,or,kr,Yt)*Ur)}}}}ht.set(er,Vt,qt,$t,yn,Yt)}return ht.toTensor()},c.prototype.cast=function(o,l){return Wr(o,l,this)},c.prototype.reshape=function(o,l){return ai(o,l)},c.prototype.avgPool=function(o,l){return dn(o,"avgPool"),dn(o,"maxPool"),cr(this.readSync(o.dataId),o.shape,o.dtype,o.strides,l,"avg").toTensor().toFloat()},c.prototype.resizeBilinear=function(o,l,g,S){dn(o,"resizeBilinear");for(var j=o.shape,V=j[0],ne=j[1],ae=j[2],me=j[3],Ee=this.readSync(o.dataId),Se=new Float32Array(Ye([V,l,g,me])),Ne=[S&&l>1?ne-1:ne,S&&g>1?ae-1:ae],ze=[S&&l>1?l-1:l,S&&g>1?g-1:g],$e=0,qe=Ne[0]/ze[0],tt=Ne[1]/ze[1],lt=0;lt<V;lt++)for(var ht=0;ht<l;ht++)for(var vt=qe*ht,Ct=Math.floor(vt),Vt=vt-Ct,Yt=Math.min(ne-1,Math.ceil(vt)),qt=lt*o.strides[0]+Ct*o.strides[1],$t=lt*o.strides[0]+Yt*o.strides[1],yn=0;yn<g;yn++)for(var On=tt*yn,Cn=Math.floor(On),Xn=On-Cn,er=Math.min(ae-1,Math.ceil(On)),sr=qt+Cn*o.strides[2],lr=$t+Cn*o.strides[2],ur=qt+er*o.strides[2],or=$t+er*o.strides[2],Er=0;Er<me;Er++){var kr=Ee[sr+Er],Ur=Ee[lr+Er],Zr=kr+(Ee[ur+Er]-kr)*Xn,mi=Zr+(Ur+(Ee[or+Er]-Ur)*Xn-Zr)*Vt;Se[$e++]=mi}return ko(Se,[V,l,g,me])},c.prototype.resizeBilinearBackprop=function(o,l,g){dn([o,l],"resizeBilinearBackprop");for(var S=l.shape,j=S[0],V=S[1],ne=S[2],ae=S[3],me=o.shape,Ee=me[1],Se=me[2],Ne=new Float32Array(j*V*ne*ae),ze=[g&&Ee>1?V-1:V,g&&Se>1?ne-1:ne],$e=[g&&Ee>1?Ee-1:Ee,g&&Se>1?Se-1:Se],qe=ze[0]/$e[0],tt=ze[1]/$e[1],lt=this.readSync(o.dataId),ht=0,vt=0;vt<j;vt++)for(var Ct=vt*l.strides[0],Vt=0;Vt<Ee;Vt++)for(var Yt=Vt*qe,qt=Math.floor(Yt),$t=Math.min(Math.ceil(Yt),V-1),yn=Ct+qt*l.strides[1],On=Ct+$t*l.strides[1],Cn=Yt-qt,Xn=1-Cn,er=0;er<Se;er++)for(var sr=er*tt,lr=Math.floor(sr),ur=Math.min(Math.ceil(sr),ne-1),or=sr-lr,Er=1-or,kr=yn+lr*l.strides[2],Ur=yn+ur*l.strides[2],Zr=On+lr*l.strides[2],mi=On+ur*l.strides[2],co=Xn*Er,lo=Xn*or,Eo=Cn*Er,wo=Cn*or,Bo=0;Bo<ae;Bo++){var ta=lt[ht++];Ne[kr+Bo]+=ta*co,Ne[Ur+Bo]+=ta*lo,Ne[Zr+Bo]+=ta*Eo,Ne[mi+Bo]+=ta*wo}return Ws(Ne,[j,ne,V,ae],l.dtype)},c.prototype.resizeNearestNeighbor=function(o,l,g,S){dn(o,"resizeNearestNeighbor");for(var j=o.shape,V=j[0],ne=j[1],ae=j[2],me=j[3],Ee=this.readSync(o.dataId),Se=new Float32Array(V*l*g*me),Ne=[S&&l>1?ne-1:ne,S&&g>1?ae-1:ae],ze=[S&&l>1?l-1:l,S&&g>1?g-1:g],$e=Ne[0]/ze[0],qe=Ne[1]/ze[1],tt=0,lt=0;lt<V;lt++)for(var ht=lt*o.strides[0],vt=0;vt<l;vt++)for(var Ct=$e*vt,Vt=ht+Math.min(ne-1,S?Math.round(Ct):Math.floor(Ct))*o.strides[1],Yt=0;Yt<g;Yt++)for(var qt=qe*Yt,$t=Vt+Math.min(ae-1,S?Math.round(qt):Math.floor(qt))*o.strides[2],yn=0;yn<me;yn++){var On=Ee[$t+yn];Se[tt++]=On}return ko(Se,[V,l,g,me],o.dtype)},c.prototype.resizeNearestNeighborBackprop=function(o,l,g){dn([o,l],"resizeNearestNeighborBackprop");for(var S=l.shape,j=S[0],V=S[1],ne=S[2],ae=S[3],me=o.shape,Ee=me[1],Se=me[2],Ne=new Float32Array(j*V*ne*ae),ze=this.readSync(o.dataId),$e=[g&&Ee>1?V-1:V,g&&Se>1?ne-1:ne],qe=[g&&Ee>1?Ee-1:Ee,g&&Se>1?Se-1:Se],tt=$e[0]/qe[0],lt=$e[1]/qe[1],ht=1/tt,vt=1/lt,Ct=2*Math.ceil(ht)+2,Vt=2*Math.ceil(vt)+2,Yt=0;Yt<j;Yt++)for(var qt=Yt*l.strides[0],$t=0;$t<V;$t++)for(var yn=qt+$t*l.strides[1],On=Math.floor($t*ht),Cn=Math.floor(On-Ct/2),Xn=0;Xn<ne;Xn++)for(var er=yn+Xn*l.strides[2],sr=Math.floor(Xn*vt),lr=Math.floor(sr-Vt/2),ur=0;ur<ae;ur++){for(var or=0,Er=0;Er<Ct;Er++){var kr=Er+Cn;if(!(kr<0||kr>=Ee)){var Ur=qt+kr*o.strides[1],Zr=kr*tt;if($t===Math.min(V-1,g?Math.round(Zr):Math.floor(Zr)))for(var mi=0;mi<Vt;mi++){var co=mi+lr;if(!(co<0||co>=Se)){var lo=Ur+co*o.strides[2],Eo=co*lt;Xn===Math.min(ne-1,g?Math.round(Eo):Math.floor(Eo))&&(or+=ze[lo+ur])}}}}Ne[er+ur]=or}return Ws(Ne,l.shape,l.dtype)},c.prototype.batchNormalization=function(o,l,g,S,j,V){dn([o,l,g,j,V],"batchNorm");for(var ne=this.readSync(o.dataId),ae=this.readSync(l.dataId),me=this.readSync(g.dataId),Ee=j?this.readSync(j.dataId):new Float32Array([1]),Se=V?this.readSync(V.dataId):new Float32Array([0]),Ne=new Float32Array(ne.length),ze=Se.length,$e=Ee.length,qe=me.length,tt=ae.length,lt=0,ht=0,vt=0,Ct=0,Vt=0;Vt<ne.length;++Vt)Ne[Vt]=Se[lt++]+(ne[Vt]-ae[ht++])*Ee[vt++]/Math.sqrt(me[Ct++]+S),lt>=ze&&(lt=0),ht>=tt&&(ht=0),vt>=$e&&(vt=0),Ct>=qe&&(Ct=0);return Ws(Ne,o.shape)},c.prototype.localResponseNormalization4D=function(o,l,g,S,j){dn(o,"localResponseNormalization4D");var V=o.shape[3],ne=V-1,ae=this.readSync(o.dataId),me=o.size,Ee=new Float32Array(me);function Se(qe){for(var tt=qe%V,lt=qe-tt+Math.max(0,tt-l),ht=qe-tt+Math.min(tt+l,ne),vt=0;lt<=ht;lt++){var Ct=ae[lt];vt+=Ct*Ct}return vt}for(var Ne=0;Ne<me;Ne++){var ze=Se(Ne),$e=ae[Ne]*Math.pow(g+S*ze,-j);Ee[Ne]=$e}return Ws(Ee,o.shape)},c.prototype.LRNGrad=function(o,l,g,S,j,V,ne){dn(o,"LRNGrad");for(var ae=o.shape[3],me=this.readSync(o.dataId),Ee=this.readSync(l.dataId),Se=this.readSync(g.dataId),Ne=new Float32Array(o.size),ze=o.size,$e=0;$e<ze;$e++){for(var qe=$e%ae,tt=$e-qe+Math.max(0,qe-S),lt=$e-qe+Math.min(ae,qe+S+1),ht=0,vt=tt;vt<lt;vt++)ht+=Math.pow(Ee[vt],2);for(ht=V*ht+j,vt=tt;vt<lt;vt++){var Ct=-2*V*ne*Ee[vt]*Se[$e]/ht;$e===vt&&(Ct+=Math.pow(ht,-ne)),Ct*=me[$e],Ne[vt]+=Ct}}return Ws(Ne,o.shape)},c.prototype.multinomial=function(o,l,g,S){dn(o,"multinomial");for(var j=l?o:Be(o),V=j.shape[0],ne=j.shape[1],ae=Ki([V,g],"int32"),me=this.readSync(ae.dataId),Ee=this.readSync(j.dataId),Se=0;Se<V;++Se){var Ne=Se*ne,ze=new Float32Array(ne-1);ze[0]=Ee[Ne];for(var $e=1;$e<ze.length;++$e)ze[$e]=ze[$e-1]+Ee[Ne+$e];for(var qe=Kh(S.toString()),tt=Se*g,lt=0;lt<g;++lt){var ht=qe();me[tt+lt]=ze.length;for(var vt=0;vt<ze.length;vt++)if(ht<ze[vt]){me[tt+lt]=vt;break}}}return ae},c.prototype.oneHot=function(o,l,g,S){dn(o,"oneHot");var j=new Float32Array(o.size*l);j.fill(S);for(var V=this.readSync(o.dataId),ne=0;ne<o.size;++ne)V[ne]>=0&&V[ne]<l&&(j[ne*l+V[ne]]=g);return nu(j,[o.size,l],"int32")},c.prototype.nonMaxSuppression=function(o,l,g,S,j){return dn(o,"nonMaxSuppression"),ia(this.readSync(o.dataId),this.readSync(l.dataId),g,S,j)},c.prototype.fft=function(o){return this.fftBatch(o,!1)},c.prototype.ifft=function(o){return this.fftBatch(o,!0)},c.prototype.fftBatch=function(o,l){for(var g=o.shape[0],S=o.shape[1],j=bi(o.shape,"float32"),V=bi(o.shape,"float32"),ne=ca(o).as2D(g,S),ae=Ua(o).as2D(g,S),me=0;me<g;me++)for(var Ee=ne.slice([me,0],[1,S]),Se=ae.slice([me,0],[1,S]),Ne=ho(Ee,Se),ze=this.readSync(this.fftImpl(Ne,l).dataId),$e=0;$e<S;$e++){var qe=to(ze,$e);j.values[me*S+$e]=qe.real,V.values[me*S+$e]=qe.imag}return ho(j.toTensor(),V.toTensor()).as2D(g,S)},c.prototype.fftImpl=function(o,l){var g=o.as1D(),S=g.size;if(this.isExponentOf2(S)){var j=this.fftRadix2(g,S,l).as2D(o.shape[0],o.shape[1]);return l&&(j=ho(ca(j).div(fr(S)),Ua(j).div(fr(S)))),j}var V=this.readSync(o.dataId),ne=function(ae){for(var me=new Float32Array(ae.length/2),Ee=new Float32Array(ae.length/2),Se=0;Se<ae.length;Se+=2)me[Se/2]=ae[Se],Ee[Se/2]=ae[Se+1];return{real:me,imag:Ee}}(this.fourierTransformByMatmul(V,S,l));return ho(ne.real,ne.imag).as2D(o.shape[0],o.shape[1])},c.prototype.isExponentOf2=function(o){return(o&o-1)==0},c.prototype.fftRadix2=function(o,l,g){if(l===1)return o;var S=this.readSync(o.dataId),j=l/2,V=function(tt){for(var lt=Math.ceil(tt.length/4),ht=new Float32Array(lt),vt=new Float32Array(lt),Ct=0;Ct<tt.length;Ct+=4)ht[Math.floor(Ct/4)]=tt[Ct],vt[Math.floor(Ct/4)]=tt[Ct+1];return{real:ht,imag:vt}}(S),ne=ho(V.real,V.imag).as1D(),ae=function(tt){for(var lt=Math.floor(tt.length/4),ht=new Float32Array(lt),vt=new Float32Array(lt),Ct=2;Ct<tt.length;Ct+=4)ht[Math.floor(Ct/4)]=tt[Ct],vt[Math.floor(Ct/4)]=tt[Ct+1];return{real:ht,imag:vt}}(S),me=ho(ae.real,ae.imag).as1D();ne=this.fftRadix2(ne,j,g),me=this.fftRadix2(me,j,g);var Ee=function(tt,lt){for(var ht=new Float32Array(tt/2),vt=new Float32Array(tt/2),Ct=0;Ct<Math.ceil(tt/2);Ct++){var Vt=(lt?2:-2)*Math.PI*(Ct/tt);ht[Ct]=Math.cos(Vt),vt[Ct]=Math.sin(Vt)}return{real:ht,imag:vt}}(l,g),Se=ho(Ee.real,Ee.imag).mul(me),Ne=ne.add(Se),ze=ne.sub(Se),$e=ca(Ne).concat(ca(ze)),qe=Ua(Ne).concat(Ua(ze));return ho($e,qe).as1D()},c.prototype.fourierTransformByMatmul=function(o,l,g){for(var S=new Float32Array(2*l),j=0;j<l;j++){for(var V=0,ne=0,ae=0;ae<l;ae++){var me=zo(j*ae,l,g),Ee=to(o,ae);V+=Ee.real*me.real-Ee.imag*me.imag,ne+=Ee.real*me.imag+Ee.imag*me.real}g&&(V/=l,ne/=l),Qi(S,V,ne,j)}return S},c.prototype.depthToSpace=function(o,l,g){ke(g==="NHWC",function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got "+g}),ke(l>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+l});for(var S=o.shape[0],j=o.shape[1],V=o.shape[2],ne=o.shape[3],ae=j*l,me=V*l,Ee=ne/(l*l),Se=this.readSync(o.dataId),Ne=new Float32Array(S*ae*me*Ee),ze=0,$e=0;$e<S;++$e)for(var qe=0;qe<ae;++qe)for(var tt=Math.floor(qe/l),lt=qe%l,ht=0;ht<me;++ht)for(var vt=Math.floor(ht/l),Ct=(lt*l+ht%l)*Ee,Vt=0;Vt<Ee;++Vt){var Yt=Vt+Ct+ne*(vt+V*(tt+j*$e));Ne[ze++]=Se[Yt]}return Ws(Ne,[S,ae,me,Ee])},c.prototype.broadcastedBinaryOp=function(o,l,g,S){var j=Mi(o.shape,l.shape),V=bi(j,g),ne=this.readSync(o.dataId),ae=this.readSync(l.dataId),me=Sa(o.shape,j),Ee=Sa(l.shape,j),Se=V.values;if(me.length+Ee.length===0)for(var Ne=0;Ne<Se.length;++Ne)Se[Ne]=S(ne[Ne%ne.length],ae[Ne%ae.length]);else{var ze=this.bufferSync(o),$e=this.bufferSync(l),qe=function(tt){var lt=V.indexToLoc(tt),ht=lt.slice(-o.rank);me.forEach(function(Yt){return ht[Yt]=0});var vt=ze.locToIndex(ht),Ct=lt.slice(-l.rank);Ee.forEach(function(Yt){return Ct[Yt]=0});var Vt=$e.locToIndex(Ct);Se[tt]=S(ne[vt],ae[Vt])};for(Ne=0;Ne<Se.length;++Ne)qe(Ne)}return V.toTensor()},c.prototype.broadcastedBinaryComplexOp=function(o,l,g){var S=Mi(o.shape,l.shape),j=bi(S,"float32"),V=bi(S,"float32"),ne=this.readSync(o.dataId),ae=this.readSync(l.dataId),me=Sa(o.shape,S),Ee=Sa(l.shape,S),Se=j.values,Ne=V.values;if(me.length+Ee.length===0)for(var ze=0;ze<Se.length;ze++){var $e=ze%ne.length,qe=ze%ae.length,tt=g(ne[2*$e],ne[2*$e+1],ae[2*qe],ae[2*qe+1]);Se[ze]=tt.real,Ne[ze]=tt.imag}else{var lt=this.bufferSync(this.data.get(o.dataId).complexTensors.real),ht=this.bufferSync(this.data.get(l.dataId).complexTensors.real),vt=function(Ct){var Vt=j.indexToLoc(Ct),Yt=Vt.slice(-o.rank);me.forEach(function(Cn){return Yt[Cn]=0});var qt=lt.locToIndex(Yt),$t=Vt.slice(-l.rank);Ee.forEach(function(Cn){return $t[Cn]=0});var yn=ht.locToIndex($t),On=g(ne[2*qt],ne[2*qt+1],ae[2*yn],ae[2*yn+1]);Se[Ct]=On.real,Ne[Ct]=On.imag};for(ze=0;ze<Se.length;ze++)vt(ze)}return this.complex(j.toTensor(),V.toTensor())},c.prototype.split=function(o,l,g){return la(o,l,g)},c.prototype.dispose=function(){},c.prototype.floatPrecision=function(){return 32},c.prototype.epsilon=function(){return 1e-7},c.prototype.cropAndResize=function(o,l,g,S,j,V){for(var ne=o.shape,ae=ne[0],me=ne[1],Ee=ne[2],Se=ne[3],Ne=l.shape[0],ze=S[0],$e=S[1],qe=bi([Ne,ze,$e,Se],"float32"),tt=this.readSync(l.dataId),lt=this.readSync(g.dataId),ht=this.readSync(o.dataId),vt=o.strides,Ct=qe.strides,Vt=0;Vt<Ne;Vt++){var Yt=4*Vt,qt=tt[Yt],$t=tt[Yt+1],yn=tt[Yt+2],On=tt[Yt+3],Cn=lt[Vt];if(!(Cn>=ae))for(var Xn=ze>1?(yn-qt)*(me-1)/(ze-1):0,er=$e>1?(On-$t)*(Ee-1)/($e-1):0,sr=0;sr<ze;sr++){var lr=ze>1?qt*(me-1)+sr*Xn:.5*(qt+yn)*(me-1);if(lr<0||lr>me-1)for(var ur=0;ur<$e;ur++)for(var or=0;or<Se;or++){var Er=or+ur*Ct[2]+sr*Ct[1]+Vt*Ct[0];qe.values[Er]=V}else if(j==="bilinear"){var kr=Math.floor(lr),Ur=Math.ceil(lr),Zr=lr-kr;for(ur=0;ur<$e;ur++)if((Xi=$e>1?$t*(Ee-1)+ur*er:.5*($t+On)*(Ee-1))<0||Xi>Ee-1)for(or=0;or<Se;or++)Er=or+ur*Ct[2]+sr*Ct[1]+Vt*Ct[0],qe.values[Er]=V;else{var mi=Math.floor(Xi),co=Math.ceil(Xi),lo=Xi-mi;for(or=0;or<Se;or++){var Eo=ht[Er=or+mi*vt[2]+kr*vt[1]+Cn*vt[0]],wo=ht[Er=or+co*vt[2]+kr*vt[1]+Cn*vt[0]],Bo=ht[Er=or+mi*vt[2]+Ur*vt[1]+Cn*vt[0]],ta=Eo+(wo-Eo)*lo,Pa=Bo+(ht[Er=or+co*vt[2]+Ur*vt[1]+Cn*vt[0]]-Bo)*lo;Er=or+ur*Ct[2]+sr*Ct[1]+Vt*Ct[0],qe.values[Er]=ta+(Pa-ta)*Zr}}}else for(ur=0;ur<$e;++ur){var Xi;if((Xi=$e>1?$t*(Ee-1)+ur*er:.5*($t+On)*(Ee-1))<0||Xi>Ee-1)for(or=0;or<Se;or++)Er=or+ur*Ct[2]+sr*Ct[1]+Vt*Ct[0],qe.values[Er]=V;else{var Co=Math.round(Xi),Vo=Math.round(lr);for(or=0;or<Se;or++){var au=or+Co*vt[2]+Vo*vt[1]+Cn*vt[0],js=or+ur*Ct[2]+sr*Ct[1]+Vt*Ct[0];qe.values[js]=ht[au]}}}}}return qe.toTensor()},c.prototype.sparseToDense=function(o,l,g,S){var j=Qc(0,o,g),V=j.sliceRank,ne=j.numUpdates,ae=j.sliceSize,me=j.strides,Ee=j.outputSize;return this.scatter(o,l,g,Ee,ae,ne,V,me,S,!1)},c.prototype.gatherND=function(o,l){var g=l.shape,S=g[g.length-1],j=$s(o,l),V=j[0],ne=j[1],ae=j[2],me=j[3];if(ne===0)return ko([],V,o.dtype);for(var Ee=new Wi([ne,ae],o.dtype),Se=this.readSync(l.dataId),Ne=this.readSync(o.dataId),ze=0;ze<ne;ze++){for(var $e=[],qe=0,tt=0;tt<S;tt++){var lt=Se[ze*S+tt];qe+=lt*me[tt],$e.push(lt)}if(qe<0||qe>=o.size/ae)throw new Error("Invalid indices: "+$e+" does not index into "+o.shape);for(var ht=0;ht<ae;ht++)Ee.values[ze*ae+ht]=Ne[qe*ae+ht]}return Ee.toTensor().reshape(V)},c.prototype.scatterND=function(o,l,g){var S=Qc(0,o,g),j=S.sliceRank,V=S.numUpdates,ne=S.sliceSize,ae=S.strides,me=S.outputSize,Ee=fr(0);return this.scatter(o,l,g,me,ne,V,j,ae,Ee,!0)},c.prototype.fill=function(o,l,g){var S=hn(g=g||be(l),Ye(o));return S.fill(l),Ue.makeTensor(S,o,g,this)},c.prototype.onesLike=function(o){if(o.dtype==="string")throw new Error("onesLike is not supported for string tensors");return this.fill(o.shape,1,o.dtype)},c.prototype.zerosLike=function(o){var l=hn(o.dtype,Ye(o.shape));return this.makeOutput(l,o.shape,o.dtype)},c.prototype.linspace=function(o,l,g){return li(o,l,g)},c.prototype.scatter=function(o,l,g,S,j,V,ne,ae,me,Ee){var Se=[S/j,j],Ne=this.readSync(o.dataId),ze=this.readSync(l.dataId);if(S===0)return ko([],g,l.dtype);var $e=new Wi(Se,l.dtype);$e.values.fill(this.readSync(me.dataId)[0]);for(var qe=0;qe<V;qe++){for(var tt=[],lt=0,ht=0;ht<ne;ht++){var vt=Ne[qe*ne+ht];tt.push(vt),lt+=vt*ae[ht]}if(lt<0||lt>=S/j)throw new Error("Invalid indices: "+tt+" does not index into "+g);for(var Ct=0;Ct<j;Ct++)Ee?$e.values[lt*j+Ct]+=ze[qe*j+Ct]:$e.values[lt*j+Ct]=l.rank===0?ze[0]:ze[qe*j+Ct]}return $e.toTensor().reshape(g)},c}(Wt);function Or(p,c){return{kernelName:p,backendName:"cpu",kernelFunc:function(o){var l=o.inputs,g=o.backend,S=l,j=S.a,V=S.b,ne=g;dn([j,V],p);var ae=ne.data.get(j.dataId).values,me=ne.data.get(V.dataId).values,Ee=c(j.shape,V.shape,ae,me,j.dtype),Se=Ee[0],Ne=Ee[1];return{dataId:ne.write(Se,Ne,j.dtype),shape:Ne,dtype:j.dtype}}}}function hi(p){return function(c,o,l,g,S){var j=Mi(c,o),V=j.length,ne=pr(j),ae=Hn(S,Ye(j)),me=c.length,Ee=o.length,Se=pr(c),Ne=pr(o),ze=Sa(c,j),$e=Sa(o,j);if(ze.length+$e.length===0)for(var qe=0;qe<ae.length;++qe)ae[qe]=p(l[qe%l.length],g[qe%g.length]);else{var tt=function(lt){var ht=gr(lt,V,ne),vt=ht.slice(-me);ze.forEach(function(qt){return vt[qt]=0});var Ct=wr(vt,me,Se),Vt=ht.slice(-Ee);$e.forEach(function(qt){return Vt[qt]=0});var Yt=wr(Vt,Ee,Ne);ae[lt]=p(l[Ct],g[Yt])};for(qe=0;qe<ae.length;++qe)tt(qe)}return[ae,j]}}Ue.registerBackend("cpu",function(){return new Br},1);var ki=hi(function(p,c){return p/c}),xi=Or(Lo,ki),xo={kernelName:"MaxPoolWithArgmax",backendName:"cpu",kernelFunc:function(p){var c=p.inputs,o=p.attrs,l=p.backend,g=c.x,S=o,j=S.filterSize,V=S.strides,ne=S.pad,ae=S.includeBatchInIndex,me=l;dn(g,"MaxPoolWithArgmax");var Ee=me.data.get(g.dataId).values,Se=bn(g.shape,j,V,[1,1],ne),Ne=function(lt,ht,vt,Ct,Vt){var Yt=cr(lt,0,vt,pr(ht),Vt,"max"),qt=yr(lt,ht,vt,Vt,!0,Ct);return[Yt.values,qt.values]}(Ee,g.shape,g.dtype,ae,Se),ze=Ne[0],$e=Ne[1],qe=me.write(ze,Se.outShape,g.dtype),tt=me.write($e,Se.outShape,g.dtype);return[{dataId:qe,shape:Se.outShape,dtype:g.dtype},{dataId:tt,shape:Se.outShape,dtype:"int32"}]}},Wo={kernelName:"NonMaxSuppressionV5",backendName:"cpu",kernelFunc:function(p){var c=p.inputs,o=p.backend,l=p.attrs,g=c,S=g.boxes,j=g.scores,V=l,ne=V.maxOutputSize,ae=V.iouThreshold,me=V.scoreThreshold,Ee=V.softNmsSigma,Se=o;dn(S,"NonMaxSuppressionWithScore");var Ne=jo(Se.data.get(S.dataId).values,Se.data.get(j.dataId).values,ne,ae,me,Ee);return[Ne.selectedIndices,Ne.selectedScores]}},To={kernelName:"Square",backendName:"cpu",kernelFunc:function(p){var c=p.inputs,o=p.backend,l=c.x,g=o;dn(l,"square");for(var S=g.data.get(l.dataId).values,j=new Float32Array(S.length),V=0;V<S.length;++V){var ne=S[V];j[V]=ne*ne}return{dataId:g.write(j,l.shape,l.dtype),shape:l.shape,dtype:l.dtype}}},Do=hi(function(p,c){var o=p-c;return o*o});function Mo(p,c,o,l,g){for(var S=Ye(c),j=c.length,V=pr(c),ne=pr(g),ae=Hn(o,Ye(g)),me=0;me<S;++me){for(var Ee=gr(me,j,V),Se=new Array(Ee.length),Ne=0;Ne<Se.length;Ne++)Se[Ne]=Ee[l[Ne]];ae[wr(Se,j,ne)]=p[me]}return ae}for(var ea=0,sa=[Wo,To,Or(Dl,Do),xi,{kernelName:"Transpose",backendName:"cpu",kernelFunc:function(p){var c=p.inputs,o=p.attrs,l=p.backend,g=c.x,S=o.perm,j=l;dn(g,"transpose");for(var V=g.shape.length,ne=new Array(V),ae=0;ae<ne.length;ae++)ne[ae]=g.shape[S[ae]];var me=Mo(j.data.get(g.dataId).values,g.shape,g.dtype,S,ne);return{dataId:j.write(me,ne,g.dtype),shape:ne,dtype:g.dtype}}},xo];ea<sa.length;ea++)pe(sa[ea]);for(var ka,Ys=0,Ci=[{kernelName:"FromPixels",backendName:"webgl",kernelFunc:function(p){var c=p.inputs,o=p.backend,l=p.attrs,g=c.pixels,S=l.numChannels,j=typeof HTMLVideoElement<"u"&&g instanceof HTMLVideoElement,V=typeof HTMLImageElement<"u"&&g instanceof HTMLImageElement,ne=j?[g.videoWidth,g.videoHeight]:[g.width,g.height],ae=ne[0],me=ne[1],Ee=[me,ae],Se=[me,ae,S];(V||j)&&(ka==null&&(ka=document.createElement("canvas").getContext("2d")),ka.canvas.width=ae,ka.canvas.height=me,ka.drawImage(g,0,0,ae,me),g=ka.canvas);var Ne=o.makeTensorInfo(Ee,"int32");o.texData.get(Ne.dataId).usage=ir.PIXELS,o.gpgpu.uploadPixelDataToTexture(o.getTexture(Ne.dataId),g);var ze=P().getBool("WEBGL_PACK")?new function(qe){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var tt=go(),lt=qe[0],ht=qe[1];this.outputShape=qe,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(`+ht+".0, "+lt+`.0);
            vec4 values = `+tt.texture2D+`(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        `+tt.output+` = result;
      }
    `}(Se):new function(qe){this.variableNames=["A"];var tt=go(),lt=qe[0],ht=qe[1];this.outputShape=qe,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+ht+".0, "+lt+`.0);

        vec4 values = `+tt.texture2D+`(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `}(Se),$e=o.runWebGLProgram(ze,[Ne],"int32");return o.disposeData(Ne.dataId),$e}},{kernelName:Lo,backendName:"webgl",kernelFunc:function(p){var c=p.inputs,o=p.backend,l=c;return function(g,S,j){var V=new Uo(`
if (a == b) {
  return 1.0;
};
return a / b;`,g.shape,S.shape);return P().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&(V=new ja(`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,g.shape,S.shape,!0)),j.runWebGLProgram(V,[g,S],"float32")}(l.a,l.b,o)}},{kernelName:"NonMaxSuppressionV5",backendName:"webgl",kernelFunc:function(p){var c=p.inputs,o=p.backend,l=p.attrs;qc("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var g=c,S=g.boxes,j=g.scores,V=l,ne=V.maxOutputSize,ae=V.iouThreshold,me=V.scoreThreshold,Ee=V.softNmsSigma,Se=o,Ne=jo(Se.readSync(S.dataId),Se.readSync(j.dataId),ne,ae,me,Ee);return[Ne.selectedIndices,Ne.selectedScores]}},{kernelName:"Square",backendName:"webgl",kernelFunc:function(p){var c=p.inputs,o=p.backend,l=c.x,g=o,S=new uo(l.shape,"return x * x;");return g.runWebGLProgram(S,[l],l.dtype)}},{kernelName:Dl,backendName:"webgl",kernelFunc:function(p){var c=p.inputs,o=p.backend,l=c,g=l.a,S=l.b,j=o,V=P().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new ja("return (a - b) * (a - b);",g.shape,S.shape):new Uo("return (a - b) * (a - b);",g.shape,S.shape);return j.compileAndRun(V,[g,S])}},{kernelName:"Transpose",backendName:"webgl",kernelFunc:function(p){for(var c,o=p.inputs,l=p.attrs,g=p.backend,S=o.x,j=l.perm,V=g,ne=S.shape.length,ae=new Array(ne),me=0;me<ae.length;me++)ae[me]=S.shape[j[me]];if(V.shouldExecuteOnCPU([S])){var Ee=Mo(V.texData.get(S.dataId).values,S.shape,S.dtype,j,ae);c=V.makeTensorInfo(ae,S.dtype),V.texData.get(c.dataId).values=Ee}else c=function(Se,Ne,ze){var $e=P().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new function(qe,tt){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;for(var lt=new Array(qe.length),ht=0;ht<lt.length;ht++)lt[ht]=qe[tt[ht]];if(this.outputShape=lt,this.rank=lt.length,this.rank>6)throw Error("Packed transpose for rank "+this.rank+" is not yet supported.");var vt=Io(this.rank),Ct=Za("rc",this.rank),Vt=new Array(this.rank);for(ht=0;ht<tt.length;ht++)Vt[tt[ht]]=Ct[ht];var Yt="vec2("+Vt.slice(-2).join()+")",qt="++"+Ct[this.rank-1]+" < "+lt[this.rank-1],$t="getChannel(getA("+Vt.join()+"), "+Yt+")";this.userCode=`
    void main() {
      `+vt+` rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = `+$t+`;
      if(`+qt+`) {
        result[1] = `+$t+`;
      }
      --`+Ct[this.rank-1]+`;
      if(++`+Ct[this.rank-2]+" < "+lt[this.rank-2]+`) {
        result[2] = `+$t+`;
        if(`+qt+`) {
          result[3] = `+$t+`;
        }
      }
      setOutput(result);
    }
    `}(Se.shape,Ne):new function(qe,tt){this.variableNames=["A"];for(var lt=new Array(qe.length),ht=0;ht<lt.length;ht++)lt[ht]=qe[tt[ht]];this.outputShape=lt,this.rank=lt.length;var vt=Io(this.rank),Ct=function(Vt){var Yt=Vt.length;if(Yt>6)throw Error("Transpose for rank "+Yt+" is not yet supported");for(var qt=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],$t=new Array(Yt),yn=0;yn<Vt.length;yn++)$t[Vt[yn]]=qt[yn];return $t.join()}(tt);this.userCode=`
    void main() {
      `+vt+` resRC = getOutputCoords();
      setOutput(getA(`+Ct+`));
    }
    `}(Se.shape,Ne);return ze.runWebGLProgram($e,[Se],Se.dtype)}(S,j,V);return c}},{kernelName:"MaxPoolWithArgmax",backendName:"webgl",kernelFunc:function(p){var c=p.inputs,o=p.attrs,l=p.backend,g=c.x,S=o,j=S.filterSize,V=S.strides,ne=S.pad,ae=S.includeBatchInIndex,me=l;ke(g.shape.length===4,function(){return"Error in maxPool: input must be rank 4 but got rank "+g.shape.length+"."});var Ee=[1,1];ke(xr(V,Ee),function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides "+V+" and dilations '"+Ee+"'"});var Se=bn(g.shape,j,V,Ee,ne),Ne=function(ze,$e,qe,tt){var lt=new Hh(qe,"max",!1),ht=tt.runWebGLProgram(lt,[ze],"float32");return lt=new Hh(qe,"max",!0,!0,$e),[ht,tt.runWebGLProgram(lt,[ze],"float32")]}(g,ae,Se,me);return[Ne[0],Ne[1]]}}];Ys<Ci.length;Ys++)pe(Ci[Ys]);for(var Va=0,Xa=[{kernelName:_l,inputsToSave:["a","b"],gradFunc:function(p,c){var o=c[0],l=c[1],g=Mi(o.shape,l.shape);return{a:function(){var S=p,j=Ia(o.shape,g);return j.length>0&&(S=S.sum(j)),S.reshape(o.shape)},b:function(){var S=p,j=Ia(l.shape,g);return j.length>0&&(S=S.sum(j)),S.reshape(l.shape)}}}},{kernelName:"AddN",saveAllInputs:!0,gradFunc:function(p,c){var o={};return c.forEach(function(l,g){o[g]=function(){return p.clone()}}),o}},{kernelName:Ec,gradFunc:function(p,c,o){for(var l=o,g=l.inputShape,S=l.shape,j=Array.from(S),V=g.length-1;V>=0;V--)if(g[V]===S[V])j[V]=1;else if(g[V]!==1)throw new Error("broadcastTo(): ["+g+"] cannot be broadcast to ["+S+"].");var ne=[];for(V=0;V<j.length;V++)j[V]>1&&ne.push(V);return{x:function(){return p.sum(ne,!0)}}}},{kernelName:Lo,inputsToSave:["a","b"],gradFunc:function(p,c){var o=c[0],l=c[1],g=Mi(o.shape,l.shape);return{a:function(){var S=Yo(p,l.toFloat()),j=Ia(o.shape,g);return j.length>0?fl(S,j).reshape(o.shape):S},b:function(){var S=p.mul(o.toFloat()),j=Ia(l.shape,g);j.length>0&&(S=fl(S,j).reshape(l.shape));var V=Kl(l);return ba(Yo(S,V.toFloat()))}}}},{kernelName:"FusedBatchNorm",inputsToSave:["x","mean","variance","scale"],gradFunc:function(p,c,o){var l=o.varianceEpsilon,g=c[0],S=c[1],j=c[2],V=c[3],ne=Ig(g),ae=V??fr(1),me=Ia(S.shape,ne.shape),Ee=[];if(S.rank===1){for(var Se=0;Se<ne.shape.length-1;++Se)Ee.push(ne.shape[Se]);Ee.push(1)}var Ne=_a(g,S),ze=Xo(p,ae),$e=Ml(ra(j,fr(l))),qe=Xo(Xo(Xo($e,$e),$e),fr(-.5));return{x:function(){return S.rank===1?ks(Xo(Xo(p,Kf($e.as4D(1,1,1,S.shape[0]),Ee)),ae),g.shape):ks(Xo(Xo(p,$e),ae),g.shape)},mean:function(){var tt=Xo(Xo($e,fr(-1)),ze);return S.rank===1&&(tt=fl(tt,me)),ks(tt,S.shape)},variance:function(){var tt=Xo(Xo(qe,Ne),ze);return S.rank===1&&(tt=fl(tt,me)),ks(tt,S.shape)},scale:function(){var tt=Xo(Ne,$e),lt=Xo(p,tt);return S.rank===1&&(lt=fl(lt,me)),ks(lt,S.shape)},offset:function(){var tt=p;return S.rank===1&&(tt=fl(tt,me)),ks(tt,S.shape)}}}},{kernelName:_f,gradFunc:function(p){return{x:function(){return p.toFloat()}}}},{kernelName:Lh,inputsToSave:["indices"],gradFunc:function(p,c){var o=c[0];return{indices:function(){return Ki(o.shape,"float32")}}}},{kernelName:Cc,inputsToSave:["x"],gradFunc:function(p,c,o){var l=c[0],g=o.paddings.map(function(S){return S[0]});return{x:function(){return p.slice(g,l.shape)}}}},{kernelName:"Square",inputsToSave:["x"],gradFunc:function(p,c){var o=c[0];return{x:function(){return p.mul(o.toFloat().mul(2))}}}},{kernelName:Dl,inputsToSave:["a","b"],gradFunc:function(p,c){var o=c[0],l=c[1],g=fr(2);return{a:function(){return Xo(p,Xo(g,_a(o,l)))},b:function(){return Xo(p,Xo(g,_a(l,o)))}}}},{kernelName:Nl,inputsToSave:["x"],gradFunc:function(p,c,o){var l=c[0],g=o.reps;return{x:function(){var S=ii(l);if(l.rank===1)for(var j=0;j<g[0];++j)S=S.add(p.slice([j*l.shape[0]],[l.shape[0]]));else if(l.rank===2)for(j=0;j<g[0];++j)for(var V=0;V<g[1];++V)S=S.add(p.slice([j*l.shape[0],V*l.shape[1]],[l.shape[0],l.shape[1]]));else if(l.rank===3)for(j=0;j<g[0];++j)for(V=0;V<g[1];++V)for(var ne=0;ne<g[2];++ne)S=S.add(p.slice([j*l.shape[0],V*l.shape[1],ne*l.shape[2]],[l.shape[0],l.shape[1],l.shape[2]]));else{if(l.rank!==4)throw new Error("Gradient for tile operation is not implemented for rank-"+l.rank+" tensors yet.");for(j=0;j<g[0];++j)for(V=0;V<g[1];++V)for(ne=0;ne<g[2];++ne)for(var ae=0;ae<g[3];++ae)S=S.add(p.slice([j*l.shape[0],V*l.shape[1],ne*l.shape[2],ae*l.shape[3]],[l.shape[0],l.shape[1],l.shape[2],l.shape[3]]))}return S}}}},{kernelName:"Transpose",gradFunc:function(p,c,o){var l=wu(o.perm);return{x:function(){return ft(p,l)}}}}];Va<Xa.length;Va++)Ae(Xa[Va]);var Js=function(){function p(){}return p.prototype.fetch=function(c,o){return fetch(c,o)},p.prototype.now=function(){return performance.now()},p.prototype.encode=function(c,o){if(o!=="utf-8"&&o!=="utf8")throw new Error("Browser's encoder only supports utf-8, but got "+o);return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(c)},p.prototype.decode=function(c,o){return new TextDecoder(o).decode(c)},p}();P().get("IS_BROWSER")&&P().setPlatform("browser",new Js);var _s,hu=function(){function p(){this.util=a(388),this.textEncoder=new this.util.TextEncoder}return p.prototype.fetch=function(c,o){return P().global.fetch!=null?P().global.fetch(c,o):(_s==null&&(_s=a(389)),_s(c,o))},p.prototype.now=function(){var c=$.hrtime();return 1e3*c[0]+c[1]/1e6},p.prototype.encode=function(c,o){if(o!=="utf-8"&&o!=="utf8")throw new Error("Node built-in encoder only supports utf-8, but got "+o);return this.textEncoder.encode(c)},p.prototype.decode=function(c,o){return c.length===0?"":new this.util.TextDecoder(o).decode(c)},p}();P().get("IS_NODE")&&P().setPlatform("node",new hu);var du={float32:4,int32:4,uint16:2,uint8:1,bool:1},pu=4;function ad(p,c){for(var o={},l=0,g=function(V){var ne=V.name,ae=V.dtype,me=V.shape,Ee=Ye(me),Se=void 0;if("quantization"in V){var Ne=V.quantization;if(Ne.dtype!=="uint8"&&Ne.dtype!=="uint16")throw new Error("Weight "+V.name+" has unknown quantization dtype "+Ne.dtype+". Supported quantization dtypes are: 'uint8' and 'uint16'.");var ze=du[Ne.dtype],$e=p.slice(l,l+Ee*ze),qe=Ne.dtype==="uint8"?new Uint8Array($e):new Uint16Array($e);if(ae==="float32")Se=Float32Array.from(qe,function(Vt){return Vt*Ne.scale+Ne.min});else{if(ae!=="int32")throw new Error("Unsupported dtype in weight '"+ne+"': "+ae);Se=Int32Array.from(qe,function(Vt){return Math.round(Vt*Ne.scale+Ne.min)})}l+=Ee*ze}else if(ae==="string"){var tt=Ye(V.shape);Se=[];for(var lt=0;lt<tt;lt++){var ht=new Uint32Array(p.slice(l,l+pu))[0];l+=pu;var vt=new Uint8Array(p.slice(l,l+ht));Se.push(vt),l+=ht}}else{var Ct=du[ae];if($e=p.slice(l,l+Ee*Ct),ae==="float32")Se=new Float32Array($e);else if(ae==="int32")Se=new Int32Array($e);else{if(ae!=="bool")throw new Error("Unsupported dtype in weight '"+ne+"': "+ae);Se=new Uint8Array($e)}l+=Ee*Ct}o[ne]=ko(Se,me,ae)},S=0,j=c;S<j.length;S++)g(j[S]);return o}var rh=U!==void 0&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function hl(p){return rh?U.byteLength(p):new Blob([p]).size}function tf(p){var c=0;p.forEach(function(g){c+=g.byteLength});var o=new Uint8Array(c),l=0;return p.forEach(function(g){o.set(new Uint8Array(g),l),l+=g.byteLength}),o.buffer}function dl(p){for(p=p.trim();p.endsWith("/");)p=p.slice(0,p.length-1);var c=p.split("/");return c[c.length-1]}function Gu(p){if(p.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:p.modelTopology==null?0:hl(JSON.stringify(p.modelTopology)),weightSpecsBytes:p.weightSpecs==null?0:hl(JSON.stringify(p.weightSpecs)),weightDataBytes:p.weightData==null?0:p.weightData.byteLength}}var Ba=function(){function p(){this.saveRouters=[],this.loadRouters=[]}return p.getInstance=function(){return p.instance==null&&(p.instance=new p),p.instance},p.registerSaveRouter=function(c){p.getInstance().saveRouters.push(c)},p.registerLoadRouter=function(c){p.getInstance().loadRouters.push(c)},p.getSaveHandlers=function(c){return p.getHandlers(c,"save")},p.getLoadHandlers=function(c,o){return p.getHandlers(c,"load",o)},p.getHandlers=function(c,o,l){var g=[];return(o==="load"?p.getInstance().loadRouters:p.getInstance().saveRouters).forEach(function(S){var j=S(c,l);j!==null&&g.push(j)}),g},p}(),nf="://",ih=function(){function p(){this.managers={}}return p.getInstance=function(){return p.instance==null&&(p.instance=new p),p.instance},p.registerManager=function(c,o){ke(c!=null,function(){return"scheme must not be undefined or null."}),c.endsWith(nf)&&(c=c.slice(0,c.indexOf(nf))),ke(c.length>0,function(){return"scheme must not be an empty string."});var l=p.getInstance();ke(l.managers[c]==null,function(){return"A model store manager is already registered for scheme '"+c+"'."}),l.managers[c]=o},p.getManager=function(c){var o=this.getInstance().managers[c];if(o==null)throw new Error("Cannot find model manager for scheme '"+c+"'");return o},p.getSchemes=function(){return Object.keys(this.getInstance().managers)},p}();function sd(p){if(p.indexOf(nf)===-1)throw new Error("The url string provided does not contain a scheme. Supported schemes are: "+ih.getSchemes().join(","));return{scheme:p.split(nf)[0],path:p.split(nf)[1]}}function rf(p,c,o){return o===void 0&&(o=!1),R(this,void 0,void 0,function(){var l,g,S,j,V,ne,ae,me,Ee;return W(this,function(Se){switch(Se.label){case 0:return ke(p!==c,function(){return"Old path and new path are the same: '"+p+"'"}),ke((l=Ba.getLoadHandlers(p)).length>0,function(){return"Copying failed because no load handler is found for source URL "+p+"."}),ke(l.length<2,function(){return"Copying failed because more than one ("+l.length+") load handlers for source URL "+p+"."}),g=l[0],ke((S=Ba.getSaveHandlers(c)).length>0,function(){return"Copying failed because no save handler is found for destination URL "+c+"."}),ke(S.length<2,function(){return"Copying failed because more than one ("+l.length+") save handlers for destination URL "+c+"."}),j=S[0],V=sd(p).scheme,ne=sd(p).path,ae=V===sd(p).scheme,[4,g.load()];case 1:return me=Se.sent(),o&&ae?[4,ih.getManager(V).removeModel(ne)]:[3,3];case 2:Se.sent(),Se.label=3;case 3:return[4,j.save(me)];case 4:return Ee=Se.sent(),!o||ae?[3,6]:[4,ih.getManager(V).removeModel(ne)];case 5:Se.sent(),Se.label=6;case 6:return[2,Ee.modelArtifactsInfo]}})})}var ds="models_store",oh="model_info_store";function ud(){if(!P().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var p=window||self,c=p.indexedDB||p.mozIndexedDB||p.webkitIndexedDB||p.msIndexedDB||p.shimIndexedDB;if(c==null)throw new Error("The current browser does not appear to support IndexedDB.");return c}function cd(p){var c=p.result;c.createObjectStore(ds,{keyPath:"modelPath"}),c.createObjectStore(oh,{keyPath:"modelPath"})}var jc=function(){function p(c){if(this.indexedDB=ud(),c==null||!c)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=c}return p.prototype.save=function(c){return R(this,void 0,void 0,function(){return W(this,function(o){if(c.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return[2,this.databaseAction(this.modelPath,c)]})})},p.prototype.load=function(){return R(this,void 0,void 0,function(){return W(this,function(c){return[2,this.databaseAction(this.modelPath)]})})},p.prototype.databaseAction=function(c,o){var l=this;return new Promise(function(g,S){var j=l.indexedDB.open("tensorflowjs",1);j.onupgradeneeded=function(){return cd(j)},j.onsuccess=function(){var V=j.result;if(o==null){var ne=V.transaction(ds,"readonly"),ae=ne.objectStore(ds).get(l.modelPath);ae.onsuccess=function(){if(ae.result==null)return V.close(),S(new Error("Cannot find model with path '"+l.modelPath+"' in IndexedDB."));g(ae.result.modelArtifacts)},ae.onerror=function($e){return V.close(),S(ae.error)},ne.oncomplete=function(){return V.close()}}else{var me,Ee=Gu(o),Se=V.transaction(oh,"readwrite"),Ne=Se.objectStore(oh),ze=Ne.put({modelPath:l.modelPath,modelArtifactsInfo:Ee});ze.onsuccess=function(){var $e=(me=V.transaction(ds,"readwrite")).objectStore(ds).put({modelPath:l.modelPath,modelArtifacts:o,modelArtifactsInfo:Ee});$e.onsuccess=function(){return g({modelArtifactsInfo:Ee})},$e.onerror=function(qe){var tt=(Ne=Se.objectStore(oh)).delete(l.modelPath);tt.onsuccess=function(){return V.close(),S($e.error)},tt.onerror=function(lt){return V.close(),S($e.error)}}},ze.onerror=function($e){return V.close(),S(ze.error)},Se.oncomplete=function(){me==null?V.close():me.oncomplete=function(){return V.close()}}}},j.onerror=function(V){return S(j.error)}})},p.URL_SCHEME="indexeddb://",p}(),xp=function(p){return P().getBool("IS_BROWSER")&&!Array.isArray(p)&&p.startsWith(jc.URL_SCHEME)?(c=p.slice(jc.URL_SCHEME.length),new jc(c)):null;var c};Ba.registerSaveRouter(xp),Ba.registerLoadRouter(xp);var Ku=function(){function p(){this.indexedDB=ud()}return p.prototype.listModels=function(){return R(this,void 0,void 0,function(){var c=this;return W(this,function(o){return[2,new Promise(function(l,g){var S=c.indexedDB.open("tensorflowjs",1);S.onupgradeneeded=function(){return cd(S)},S.onsuccess=function(){var j=S.result,V=j.transaction(oh,"readonly"),ne=V.objectStore(oh).getAll();ne.onsuccess=function(){for(var ae={},me=0,Ee=ne.result;me<Ee.length;me++){var Se=Ee[me];ae[Se.modelPath]=Se.modelArtifactsInfo}l(ae)},ne.onerror=function(ae){return j.close(),g(ne.error)},V.oncomplete=function(){return j.close()}},S.onerror=function(j){return g(S.error)}})]})})},p.prototype.removeModel=function(c){return R(this,void 0,void 0,function(){var o=this;return W(this,function(l){var g;return c=(g=c).startsWith(jc.URL_SCHEME)?g.slice(jc.URL_SCHEME.length):g,[2,new Promise(function(S,j){var V=o.indexedDB.open("tensorflowjs",1);V.onupgradeneeded=function(){return cd(V)},V.onsuccess=function(){var ne,ae=V.result,me=ae.transaction(oh,"readwrite"),Ee=me.objectStore(oh),Se=Ee.get(c);Se.onsuccess=function(){if(Se.result==null)return ae.close(),j(new Error("Cannot find model with path '"+c+"' in IndexedDB."));var Ne=Ee.delete(c),ze=function(){var $e=(ne=ae.transaction(ds,"readwrite")).objectStore(ds).delete(c);$e.onsuccess=function(){return S(Se.result.modelArtifactsInfo)},$e.onerror=function(qe){return j(Se.error)}};Ne.onsuccess=ze,Ne.onerror=function($e){return ze(),ae.close(),j(Se.error)}},Se.onerror=function(Ne){return ae.close(),j(Se.error)},me.oncomplete=function(){ne==null?ae.close():ne.oncomplete=function(){return ae.close()}}},V.onerror=function(ne){return j(V.error)}})]})})},p}();if(P().getBool("IS_BROWSER"))try{ih.registerManager(jc.URL_SCHEME,new Ku)}catch{}var Ds="/",Iu="tensorflowjs_models",ps="info",pl="model_topology",ah="weight_specs",ld="weight_data",sh="model_metadata";function wp(p){return{info:[Iu,p,ps].join(Ds),topology:[Iu,p,pl].join(Ds),weightSpecs:[Iu,p,ah].join(Ds),weightData:[Iu,p,ld].join(Ds),modelMetadata:[Iu,p,sh].join(Ds)}}function ml(p){var c=p.split(Ds);if(c.length<3)throw new Error("Invalid key format: "+p);return c.slice(1,c.length-1).join(Ds)}var ou=function(){function p(c){if(!P().getBool("IS_BROWSER")||typeof window>"u"||window.localStorage===void 0)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,c==null||!c)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=c,this.keys=wp(this.modelPath)}return p.prototype.save=function(c){return R(this,void 0,void 0,function(){var o,l,g;return W(this,function(S){if(c.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");o=JSON.stringify(c.modelTopology),l=JSON.stringify(c.weightSpecs),g=Gu(c);try{return this.LS.setItem(this.keys.info,JSON.stringify(g)),this.LS.setItem(this.keys.topology,o),this.LS.setItem(this.keys.weightSpecs,l),this.LS.setItem(this.keys.weightData,function(j){if(rh)return U.from(j).toString("base64");for(var V=new Uint8Array(j),ne="",ae=0,me=V.length;ae<me;ae++)ne+=String.fromCharCode(V[ae]);return btoa(ne)}(c.weightData)),this.LS.setItem(this.keys.modelMetadata,JSON.stringify({format:c.format,generatedBy:c.generatedBy,convertedBy:c.convertedBy,userDefinedMetadata:c.userDefinedMetadata})),[2,{modelArtifactsInfo:g}]}catch{throw this.LS.removeItem(this.keys.info),this.LS.removeItem(this.keys.topology),this.LS.removeItem(this.keys.weightSpecs),this.LS.removeItem(this.keys.weightData),this.LS.removeItem(this.keys.modelMetadata),new Error("Failed to save model '"+this.modelPath+"' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes="+g.modelTopologyBytes+", weightSpecsBytes="+g.weightSpecsBytes+", weightDataBytes="+g.weightDataBytes+".")}return[2]})})},p.prototype.load=function(){return R(this,void 0,void 0,function(){var c,o,l,g,S,j,V;return W(this,function(ne){if((c=JSON.parse(this.LS.getItem(this.keys.info)))==null)throw new Error("In local storage, there is no model with name '"+this.modelPath+"'");if(c.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");if(o={},(l=JSON.parse(this.LS.getItem(this.keys.topology)))==null)throw new Error("In local storage, the topology of model '"+this.modelPath+"' is missing.");if(o.modelTopology=l,(g=JSON.parse(this.LS.getItem(this.keys.weightSpecs)))==null)throw new Error("In local storage, the weight specs of model '"+this.modelPath+"' are missing.");if(o.weightSpecs=g,(S=this.LS.getItem(this.keys.modelMetadata))!=null&&(j=JSON.parse(S),o.format=j.format,o.generatedBy=j.generatedBy,o.convertedBy=j.convertedBy,o.userDefinedMetadata=j.userDefinedMetadata),(V=this.LS.getItem(this.keys.weightData))==null)throw new Error("In local storage, the binary weight values of model '"+this.modelPath+"' are missing.");return o.weightData=function(ae){if(rh){var me=U.from(ae,"base64");return me.buffer.slice(me.byteOffset,me.byteOffset+me.byteLength)}for(var Ee=atob(ae),Se=new Uint8Array(Ee.length),Ne=0;Ne<Ee.length;++Ne)Se.set([Ee.charCodeAt(Ne)],Ne);return Se.buffer}(V),[2,o]})})},p.URL_SCHEME="localstorage://",p}(),Cv=function(p){return P().getBool("IS_BROWSER")&&!Array.isArray(p)&&p.startsWith(ou.URL_SCHEME)?(c=p.slice(ou.URL_SCHEME.length),new ou(c)):null;var c};Ba.registerSaveRouter(Cv),Ba.registerLoadRouter(Cv);var gl=function(){function p(){ke(P().getBool("IS_BROWSER"),function(){return"Current environment is not a web browser"}),ke(typeof window>"u"||window.localStorage!==void 0,function(){return"Current browser does not appear to support localStorage"}),this.LS=window.localStorage}return p.prototype.listModels=function(){return R(this,void 0,void 0,function(){var c,o,l,g,S,j;return W(this,function(V){for(c={},o=Iu+Ds,l=Ds+ps,g=0;g<this.LS.length;++g)(S=this.LS.key(g)).startsWith(o)&&S.endsWith(l)&&(j=ml(S),c[j]=JSON.parse(this.LS.getItem(S)));return[2,c]})})},p.prototype.removeModel=function(c){return R(this,void 0,void 0,function(){var o,l;return W(this,function(g){var S;if(c=(S=c).startsWith(ou.URL_SCHEME)?S.slice(ou.URL_SCHEME.length):S,o=wp(c),this.LS.getItem(o.info)==null)throw new Error("Cannot find model at path '"+c+"'");return l=JSON.parse(this.LS.getItem(o.info)),this.LS.removeItem(o.info),this.LS.removeItem(o.topology),this.LS.removeItem(o.weightSpecs),this.LS.removeItem(o.weightData),[2,l]})})},p}();if(P().getBool("IS_BROWSER"))try{ih.registerManager(ou.URL_SCHEME,new gl)}catch{}var fd="model",Ov=".json",Av=".weights.bin";function Sv(p){return new Promise(function(c){return setTimeout(c)}).then(p)}var r0=function(){function p(c){if(!P().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");c.startsWith(p.URL_SCHEME)&&(c=c.slice(p.URL_SCHEME.length)),c!=null&&c.length!==0||(c=fd),this.modelTopologyFileName=c+Ov,this.weightDataFileName=c+Av}return p.prototype.save=function(c){return R(this,void 0,void 0,function(){var o,l,g,S,j,V;return W(this,function(ne){switch(ne.label){case 0:if(typeof document>"u")throw new Error("Browser downloads are not supported in this environment since `document` is not present");if(o=window.URL.createObjectURL(new Blob([c.weightData],{type:"application/octet-stream"})),!(c.modelTopology instanceof ArrayBuffer))return[3,1];throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 1:return l=[{paths:["./"+this.weightDataFileName],weights:c.weightSpecs}],g={modelTopology:c.modelTopology,format:c.format,generatedBy:c.generatedBy,convertedBy:c.convertedBy,weightsManifest:l},S=window.URL.createObjectURL(new Blob([JSON.stringify(g)],{type:"application/json"})),(j=this.jsonAnchor==null?document.createElement("a"):this.jsonAnchor).download=this.modelTopologyFileName,j.href=S,[4,Sv(function(){return j.dispatchEvent(new MouseEvent("click"))})];case 2:return ne.sent(),c.weightData==null?[3,4]:((V=this.weightDataAnchor==null?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,V.href=o,[4,Sv(function(){return V.dispatchEvent(new MouseEvent("click"))})]);case 3:ne.sent(),ne.label=4;case 4:return[2,{modelArtifactsInfo:Gu(c)}]}})})},p.URL_SCHEME="downloads://",p}(),U0=function(){function p(c){if(c==null||c.length<1)throw new Error("When calling browserFiles, at least 1 file is required, but received "+c);this.files=c}return p.prototype.load=function(){return R(this,void 0,void 0,function(){var c,o,l=this;return W(this,function(g){return c=this.files[0],o=this.files.slice(1),[2,new Promise(function(S,j){var V=new FileReader;V.onload=function(ne){var ae=JSON.parse(ne.target.result),me=ae.modelTopology;if(me!=null){o.length===0&&S({modelTopology:me});var Ee=ae.weightsManifest;if(Ee!=null){var Se;try{Se=l.checkManifestAndWeightFiles(Ee,o)}catch(qe){return void j(qe)}var Ne=[],ze=[],$e=[];Ee.forEach(function(qe){qe.paths.forEach(function(tt){ze.push(tt),$e.push(null)}),Ne.push.apply(Ne,qe.weights)}),Ee.forEach(function(qe){qe.paths.forEach(function(tt){var lt=new FileReader;lt.onload=function(ht){var vt=ht.target.result,Ct=ze.indexOf(tt);$e[Ct]=vt,$e.indexOf(null)===-1&&S({modelTopology:me,weightSpecs:Ne,weightData:tf($e),format:ae.format,generatedBy:ae.generatedBy,convertedBy:ae.convertedBy,userDefinedMetadata:ae.userDefinedMetadata})},lt.onerror=function(ht){return j("Failed to weights data from file of path '"+tt+"'.")},lt.readAsArrayBuffer(Se[tt])})})}else j(new Error("weightManifest field is missing from file "+c.name))}else j(new Error("modelTopology field is missing from file "+c.name))},V.onerror=function(ne){return j("Failed to read model topology and weights manifest JSON from file '"+c.name+"'. BrowserFiles supports loading Keras-style tf.Model artifacts only.")},V.readAsText(c)})]})})},p.prototype.checkManifestAndWeightFiles=function(c,o){for(var l=[],g=o.map(function(ne){return dl(ne.name)}),S={},j=0,V=c;j<V.length;j++)V[j].paths.forEach(function(ne){var ae=dl(ne);if(l.indexOf(ae)!==-1)throw new Error("Duplicate file basename found in weights manifest: '"+ae+"'");if(l.push(ae),g.indexOf(ae)===-1)throw new Error("Weight file with basename '"+ae+"' is not provided.");S[ne]=o[g.indexOf(ae)]});if(l.length!==o.length)throw new Error("Mismatch in the number of files in weights manifest ("+l.length+") and the number of weight files provided ("+o.length+").");return S},p}();function i0(p,c,o,l){(function(S){ke(S!=null&&Array.isArray(S)&&S.length>0,function(){return"promises must be a none empty array"})})(p),function(S,j){ke(S>=0&&S<=1,function(){return"Progress fraction must be in range [0, 1], but got startFraction "+S}),ke(j>=0&&j<=1,function(){return"Progress fraction must be in range [0, 1], but got endFraction "+j}),ke(j>=S,function(){return"startFraction must be no more than endFraction, but got startFraction "+S+" and endFraction "+j})}(o=o??0,l=l??1);var g=0;return Promise.all(p.map(function(S){return S.then(function(j){var V=o+ ++g/p.length*(l-o);return c(V),j}),S}))}function W0(p,c){return R(this,void 0,void 0,function(){var o,l,g,S,j,V,ne,ae,me;return W(this,function(Ee){switch(Ee.label){case 0:return c==null&&(c={}),o=c.fetchFunc==null?P().platform.fetch:c.fetchFunc,l=p.map(function(Se){return o(Se,c.requestInit,{isBinary:!0})}),g=0,S=.5,c.onProgress!=null?[3,2]:[4,Promise.all(l)];case 1:return j=Ee.sent(),[3,4];case 2:return[4,i0(l,c.onProgress,g,S)];case 3:j=Ee.sent(),Ee.label=4;case 4:return V=j.map(function(Se){return Se.arrayBuffer()}),ne=.5,ae=1,c.onProgress!=null?[3,6]:[4,Promise.all(V)];case 5:return me=Ee.sent(),[3,8];case 6:return[4,i0(V,c.onProgress,ne,ae)];case 7:me=Ee.sent(),Ee.label=8;case 8:return[2,me]}})})}function mc(p){var c=this;return function(o,l,g){return l===void 0&&(l=""),R(c,void 0,void 0,function(){var S,j,V,ne,ae,me,Ee,Se,Ne,ze;return W(this,function($e){switch($e.label){case 0:if(S=o.map(function(){return!1}),j={},V=g!=null?g.map(function(){return!1}):[],ne=[],o.forEach(function(qe,tt){var lt=0;qe.weights.forEach(function(ht){var vt="quantization"in ht?ht.quantization.dtype:ht.dtype,Ct=du[vt]*Ye(ht.shape),Vt=function(){S[tt]=!0,j[tt]==null&&(j[tt]=[]),j[tt].push({manifestEntry:ht,groupOffset:lt,sizeBytes:Ct})};g!=null?g.forEach(function(Yt,qt){Yt===ht.name&&(Vt(),V[qt]=!0)}):Vt(),ne.push(ht.name),lt+=Ct})}),!V.every(function(qe){return qe}))throw ae=g.filter(function(qe,tt){return!V[tt]}),new Error("Could not find weights in manifest with names: "+ae.join(", ")+`. 
Manifest JSON has weights with names: `+ne.join(", ")+".");return me=S.reduce(function(qe,tt,lt){return tt&&qe.push(lt),qe},[]),Ee=[],me.forEach(function(qe){o[qe].paths.forEach(function(tt){var lt=l+(l.endsWith("/")?"":"/")+tt;Ee.push(lt)})}),[4,p(Ee)];case 1:return Se=$e.sent(),Ne={},ze=0,me.forEach(function(qe){for(var tt=o[qe].paths.length,lt=0,ht=0;ht<tt;ht++)lt+=Se[ze+ht].byteLength;for(var vt=new ArrayBuffer(lt),Ct=new Uint8Array(vt),Vt=0,Yt=0;Yt<tt;Yt++){var qt=new Uint8Array(Se[ze+Yt]);Ct.set(qt,Vt),Vt+=qt.byteLength}j[qe].forEach(function($t){var yn=ad(vt.slice($t.groupOffset,$t.groupOffset+$t.sizeBytes),[$t.manifestEntry]);for(var On in yn)Ne[On]=yn[On]}),ze+=tt}),[2,Ne]}})})}}Ba.registerSaveRouter(function(p){return P().getBool("IS_BROWSER")&&!Array.isArray(p)&&p.startsWith(r0.URL_SCHEME)?function(c){return c===void 0&&(c="model"),new r0(c)}(p.slice(r0.URL_SCHEME.length)):null});var _v=function(){function p(c,o){if(this.DEFAULT_METHOD="POST",o==null&&(o={}),this.weightPathPrefix=o.weightPathPrefix,this.onProgress=o.onProgress,o.fetchFunc!=null?(ke(typeof o.fetchFunc=="function",function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"}),this.fetch=o.fetchFunc):this.fetch=P().platform.fetch,ke(c!=null&&c.length>0,function(){return"URL path for http must not be null, undefined or empty."}),Array.isArray(c)&&ke(c.length===2,function(){return"URL paths for http must have a length of 2, (actual length is "+c.length+")."}),this.path=c,o.requestInit!=null&&o.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=o.requestInit||{}}return p.prototype.save=function(c){return R(this,void 0,void 0,function(){var o,l,g,S;return W(this,function(j){switch(j.label){case 0:if(c.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");return(o=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,l=[{paths:["./model.weights.bin"],weights:c.weightSpecs}],g={modelTopology:c.modelTopology,format:c.format,generatedBy:c.generatedBy,convertedBy:c.convertedBy,userDefinedMetadata:c.userDefinedMetadata,weightsManifest:l},o.body.append("model.json",new Blob([JSON.stringify(g)],{type:"application/json"}),"model.json"),c.weightData!=null&&o.body.append("model.weights.bin",new Blob([c.weightData],{type:"application/octet-stream"}),"model.weights.bin"),[4,this.fetch(this.path,o)];case 1:if((S=j.sent()).ok)return[2,{modelArtifactsInfo:Gu(c),responses:[S]}];throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+S.status+".")}})})},p.prototype.load=function(){return R(this,void 0,void 0,function(){var c,o,l,g,S,j,V,ne,ae,me,Ee,Se;return W(this,function(Ne){switch(Ne.label){case 0:return[4,this.fetch(this.path,this.requestInit)];case 1:if(!(c=Ne.sent()).ok)throw new Error("Request to "+this.path+" failed with status code "+c.status+". Please verify this URL points to the model JSON of the model to load.");Ne.label=2;case 2:return Ne.trys.push([2,4,,5]),[4,c.json()];case 3:return o=Ne.sent(),[3,5];case 4:throw Ne.sent(),l="Failed to parse model JSON of response from "+this.path+".",this.path.endsWith(".pb")?l+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":l+=" Please make sure the server is serving valid JSON for this request.",new Error(l);case 5:if(g=o.modelTopology,S=o.weightsManifest,j=o.generatedBy,V=o.convertedBy,ne=o.format,ae=o.userDefinedMetadata,g==null&&S==null)throw new Error("The JSON from HTTP path "+this.path+" contains neither model topology or manifest for weights.");return S==null?[3,7]:[4,this.loadWeights(S)];case 6:Se=Ne.sent(),me=Se[0],Ee=Se[1],Ne.label=7;case 7:return[2,{modelTopology:g,weightSpecs:me,weightData:Ee,userDefinedMetadata:ae,generatedBy:j,convertedBy:V,format:ne}]}})})},p.prototype.loadWeights=function(c){return R(this,void 0,void 0,function(){var o,l,g,S,j,V,ne,ae,me,Ee,Se;return W(this,function(Ne){switch(Ne.label){case 0:for(o=Array.isArray(this.path)?this.path[1]:this.path,l=function(ze){var $e=ze.lastIndexOf("/"),qe=ze.lastIndexOf("?");return[ze.substring(0,$e)+"/",qe>$e?ze.substring(qe):""]}(o),g=l[0],S=l[1],j=this.weightPathPrefix||g,V=[],ne=0,ae=c;ne<ae.length;ne++)me=ae[ne],V.push.apply(V,me.weights);return Ee=[],c.forEach(function(ze){ze.paths.forEach(function($e){Ee.push(j+$e+S)})}),[4,W0(Ee,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress})];case 1:return Se=Ne.sent(),[2,[V,tf(Se)]]}})})},p.URL_SCHEME_REGEX=/^https?:\/\//,p}();function Xu(p){return p.match(_v.URL_SCHEME_REGEX)!=null}var of=function(p,c){return typeof fetch>"u"?null:(Array.isArray(p)?p.every(function(o){return Xu(o)}):Xu(p))?v(p,{onProgress:c}):null};function v(p,c){return new _v(p,c)}Ba.registerSaveRouter(of),Ba.registerLoadRouter(of);var h,u=function(){function p(c){this.modelArtifacts=c}return p.prototype.load=function(){return R(this,void 0,void 0,function(){return W(this,function(c){return[2,this.modelArtifacts]})})},p}(),d=function(){function p(c){this.saveHandler=c}return p.prototype.save=function(c){return R(this,void 0,void 0,function(){return W(this,function(o){return[2,this.saveHandler(c)]})})},p}(),y=Object.freeze({browserFiles:function(p){return new U0(p)},browserHTTPRequest:function(p,c){return v(p,c)},concatenateArrayBuffers:tf,decodeWeights:ad,encodeWeights:function(p,c){return R(this,void 0,void 0,function(){var o,l,g,S,j,V=this;return W(this,function(ne){switch(ne.label){case 0:for(o=[],l=[],g=Array.isArray(p)?p.map(function(ae){return ae.name}):Object.keys(p),S=function(ae){var me=g[ae],Ee=Array.isArray(p)?p[ae].tensor:p[me];if(Ee.dtype!=="float32"&&Ee.dtype!=="int32"&&Ee.dtype!=="bool"&&Ee.dtype!=="string")throw new Error("Unsupported dtype in weight '"+me+"': "+Ee.dtype);var Se={name:me,shape:Ee.shape,dtype:Ee.dtype};if(Ee.dtype==="string"){var Ne=new Promise(function(ze){return R(V,void 0,void 0,function(){var $e,qe,tt,lt,ht,vt,Ct;return W(this,function(Vt){switch(Vt.label){case 0:return[4,Ee.bytes()];case 1:for($e=Vt.sent(),qe=$e.reduce(function(Yt,qt){return Yt+qt.length},0)+pu*$e.length,tt=new Uint8Array(qe),lt=0,ht=0;ht<$e.length;ht++)vt=$e[ht],Ct=new Uint8Array(new Uint32Array([vt.length]).buffer),tt.set(Ct,lt),lt+=pu,tt.set(vt,lt),lt+=vt.length;return ze(tt),[2]}})})});l.push(Ne)}else l.push(Ee.data());c!=null&&(Se.group=c),o.push(Se)},j=0;j<g.length;++j)S(j);return[4,Promise.all(l)];case 1:return[2,{data:function(ae){if(ae===null)throw new Error("Invalid input value: "+JSON.stringify(ae));var me=0,Ee=[];ae.forEach(function(ze){if(me+=ze.byteLength,Ee.push(ze.byteLength===ze.buffer.byteLength?ze:new ze.constructor(ze)),!(ze instanceof Float32Array||ze instanceof Int32Array||ze instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: "+ze.constructor.name)});var Se=new Uint8Array(me),Ne=0;return Ee.forEach(function(ze){Se.set(new Uint8Array(ze.buffer),Ne),Ne+=ze.byteLength}),Se.buffer}(ne.sent()),specs:o}]}})})},fromMemory:function(p,c,o,l){return arguments.length===1?p.modelTopology!=null||p.weightSpecs!=null?new u(p):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new u({modelTopology:p})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new u({modelTopology:p,weightSpecs:c,weightData:o,trainingConfig:l}))},getLoadHandlers:function(p,c){return Ba.getLoadHandlers(p,c)},getModelArtifactsInfoForJSON:Gu,getSaveHandlers:function(p){return Ba.getSaveHandlers(p)},http:v,isHTTPScheme:Xu,loadWeights:function(p,c,o,l){return c===void 0&&(c=""),R(this,void 0,void 0,function(){return W(this,function(g){return[2,mc(function(S){return W0(S,{requestInit:l})})(p,c,o)]})})},registerLoadRouter:function(p){return Ba.registerLoadRouter(p)},registerSaveRouter:function(p){return Ba.registerSaveRouter(p)},weightsLoaderFactory:mc,withSaveHandler:function(p){return new d(p)},copyModel:function(p,c){return R(this,void 0,void 0,function(){return W(this,function(o){return[2,rf(p,c,!1)]})})},listModels:function(){return R(this,void 0,void 0,function(){var p,c,o,l,g,S,j;return W(this,function(V){switch(V.label){case 0:p=ih.getSchemes(),c={},o=0,l=p,V.label=1;case 1:return o<l.length?(g=l[o],[4,ih.getManager(g).listModels()]):[3,4];case 2:for(j in S=V.sent())c[g+nf+j]=S[j];V.label=3;case 3:return o++,[3,1];case 4:return[2,c]}})})},moveModel:function(p,c){return R(this,void 0,void 0,function(){return W(this,function(o){return[2,rf(p,c,!0)]})})},removeModel:function(p){return R(this,void 0,void 0,function(){var c;return W(this,function(o){return c=sd(p),[2,ih.getManager(c.scheme).removeModel(c.path)]})})}}),D=wt({confusionMatrix_:function(p,c,o){var l=Ke(p,"labels","confusionMatrix"),g=Ke(c,"predictions","confusionMatrix");ke(o==null||o>0&&Number.isInteger(o),function(){return"If provided, numClasses must be a positive integer, but got "+o}),ke(l.rank===1,function(){return"Expected the rank of labels to be 1, but got "+l.rank}),ke(g.rank===1,function(){return"Expected the rank of predictions to be 1, but got "+g.rank}),ke(l.shape[0]===g.shape[0],function(){return"Mismatch in the number of examples: "+l.shape[0]+" vs. "+g.shape[0]+". Labels and predictions should have the same number of elements."}),ke(o>0&&Number.isInteger(o),function(){return"numClasses is required to be a positive integer, but got "+o});var S=fc(l.asType("int32"),o),j=fc(g.asType("int32"),o);return S.transpose().matMul(j).asType("int32")}}),z=Object.freeze({confusionMatrix:D}),X=wt({fromPixels_:function(p,c){if(c===void 0&&(c=3),c>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(p==null)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var o=!1,l=!1,g=!1,S=!1,j=!1;if(p.data instanceof Uint8Array)o=!0;else if(typeof ImageData<"u"&&p instanceof ImageData)l=!0;else if(typeof HTMLVideoElement<"u"&&p instanceof HTMLVideoElement)g=!0;else if(typeof HTMLImageElement<"u"&&p instanceof HTMLImageElement)S=!0;else{if(p.getContext==null)throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was "+p.constructor.name);j=!0}if(g&&g&&p.readyState<2)throw new Error("The video element has not loaded data yet. Please wait for `loadeddata` event on the <video> element.");if(ie("FromPixels",Ue.backendName)!=null)return Ue.runKernel("FromPixels",{pixels:p},{numChannels:c});var V,ne,ae=g?[p.videoWidth,p.videoHeight]:[p.width,p.height],me=ae[0],Ee=ae[1];if(j?V=p.getContext("2d").getImageData(0,0,me,Ee).data:l||o?V=p.data:(S||g)&&(h==null&&(h=document.createElement("canvas").getContext("2d")),h.canvas.width=me,h.canvas.height=Ee,h.drawImage(p,0,0,me,Ee),V=h.getImageData(0,0,me,Ee).data),c===4)ne=new Int32Array(V);else{var Se=me*Ee;ne=new Int32Array(Se*c);for(var Ne=0;Ne<Se;Ne++)for(var ze=0;ze<c;++ze)ne[Ne*c+ze]=V[4*Ne+ze]}return Hc(ne,[Ee,me,c],"int32")}}),oe=Object.freeze({toPixels:function(p,c){return R(this,void 0,void 0,function(){var o,l,g,S,j,V,ne,ae,me,Ee,Se,Ne,ze,$e,qe,tt,lt,ht,vt,Ct,Vt,Yt,qt;return W(this,function($t){switch($t.label){case 0:if(o=Ke(p,"img","toPixels"),p instanceof Mt||(o=o.toInt()),o.rank!==2&&o.rank!==3)throw new Error("toPixels only supports rank 2 or 3 tensors, got rank "+o.rank+".");if(l=o.shape.slice(0,2),g=l[0],S=l[1],(j=o.rank===2?1:o.shape[2])>4||j===2)throw new Error("toPixels only supports depth of size 1, 3 or 4 but got "+j);return[4,o.data()];case 1:return V=$t.sent(),ne=o.min(),ae=o.max(),[4,Promise.all([ne.data(),ae.data()])];case 2:if(me=$t.sent(),Ee=me[0],Se=me[1],Ne=Ee[0],ze=Se[0],ne.dispose(),ae.dispose(),o.dtype==="float32"){if(Ne<0||ze>1)throw new Error("Tensor values for a float32 Tensor must be in the range [0 - 1] but got range ["+Ne+" - "+ze+"].")}else{if(o.dtype!=="int32")throw new Error("Unsupported type for toPixels: "+o.dtype+". Please use float32 or int32 tensors.");if(Ne<0||ze>255)throw new Error("Tensor values for a int32 Tensor must be in the range [0 - 255] but got range ["+Ne+" - "+ze+"].")}for($e=o.dtype==="float32"?255:1,qe=new Uint8ClampedArray(S*g*4),tt=0;tt<g*S;++tt)lt=void 0,ht=void 0,vt=void 0,Ct=void 0,j===1?(lt=V[tt]*$e,ht=V[tt]*$e,vt=V[tt]*$e,Ct=255):j===3?(lt=V[3*tt]*$e,ht=V[3*tt+1]*$e,vt=V[3*tt+2]*$e,Ct=255):j===4&&(lt=V[4*tt]*$e,ht=V[4*tt+1]*$e,vt=V[4*tt+2]*$e,Ct=V[4*tt+3]*$e),qe[0+(Vt=4*tt)]=Math.round(lt),qe[Vt+1]=Math.round(ht),qe[Vt+2]=Math.round(vt),qe[Vt+3]=Math.round(Ct);return c!=null&&(c.width=S,c.height=g,Yt=c.getContext("2d"),qt=new ImageData(qe,S,g),Yt.putImageData(qt,0,0)),o!==p&&o.dispose(),[2,qe]}})})},fromPixels:X}),he=function(){function p(){}return p.prototype.getClassName=function(){return this.constructor.className},p.fromConfig=function(c,o){return new c(o)},p}(),xe=function(){function p(){this.classNameMap={}}return p.getMap=function(){return p.instance==null&&(p.instance=new p),p.instance},p.register=function(c){p.getMap().classNameMap[c.className]=[c,c.fromConfig]},p}();function Fe(p){ke(p.className!=null,function(){return"Class being registered does not have the static className property defined."}),ke(typeof p.className=="string",function(){return"className is required to be a string, but got type "+typeof p.className}),ke(p.className.length>0,function(){return"Class being registered has an empty-string as its className, which is disallowed."}),xe.register(p)}var Re=Object.freeze({Serializable:he,SerializationMap:xe,registerClass:Fe}),Me="1.7.4",We=Object.freeze({gpgpu_util:Dc,webgl_util:Ef,forceHalfFloat:function(){P().set("WEBGL_FORCE_F16_TEXTURES",!0)},MathBackendWebGL:Lp,setWebGLContext:fo,GPGPUContext:Tm}),Ze=function(p){function c(){return p!==null&&p.apply(this,arguments)||this}return J(c,p),c.prototype.minimize=function(o,l,g){l===void 0&&(l=!1);var S=this.computeGradients(o,g),j=S.value,V=S.grads;if(g!=null){var ne=g.map(function(ae){return{name:ae.name,tensor:V[ae.name]}});this.applyGradients(ne)}else this.applyGradients(V);return No(V),l?j:(j.dispose(),null)},Object.defineProperty(c.prototype,"iterations",{get:function(){return this.iterations_==null&&(this.iterations_=0),this.iterations_},enumerable:!0,configurable:!0}),c.prototype.incrementIterations=function(){this.iterations_=this.iterations+1},c.prototype.computeGradients=function(o,l){return C(o,l)},c.prototype.dispose=function(){this.iterations_!=null&&No(this.iterations_)},c.prototype.saveIterations=function(){return R(this,void 0,void 0,function(){return W(this,function(o){return this.iterations_==null&&(this.iterations_=0),[2,{name:"iter",tensor:fr(this.iterations_,"int32")}]})})},c.prototype.getWeights=function(){return R(this,void 0,void 0,function(){return W(this,function(o){throw new Error("getWeights() is not implemented for this optimizer yet.")})})},c.prototype.setWeights=function(o){return R(this,void 0,void 0,function(){return W(this,function(l){throw new Error("setWeights() is not implemented for this optimizer class "+this.getClassName())})})},c.prototype.extractIterations=function(o){return R(this,void 0,void 0,function(){var l;return W(this,function(g){switch(g.label){case 0:return l=this,[4,o[0].tensor.data()];case 1:return l.iterations_=g.sent()[0],[2,o.slice(1)]}})})},c}(he);Object.defineProperty(Ze,Symbol.hasInstance,{value:function(p){return p.minimize!=null&&p.computeGradients!=null&&p.applyGradients!=null}});var Je=function(p){function c(o,l,g){g===void 0&&(g=null);var S=p.call(this)||this;return S.learningRate=o,S.rho=l,S.epsilon=g,S.accumulatedGrads=[],S.accumulatedUpdates=[],g==null&&(S.epsilon=Ue.backend.epsilon()),S}return J(c,p),c.prototype.applyGradients=function(o){var l=this;(Array.isArray(o)?o.map(function(g){return g.name}):Object.keys(o)).forEach(function(g,S){var j=Ue.registeredVariables[g];l.accumulatedGrads[S]==null&&(l.accumulatedGrads[S]={originalName:g+"/accum_grad",variable:Ii(function(){return ii(j).variable(!1)})}),l.accumulatedUpdates[S]==null&&(l.accumulatedUpdates[S]={originalName:g+"/accum_var",variable:Ii(function(){return ii(j).variable(!1)})});var V=Array.isArray(o)?o[S].tensor:o[g];if(V!=null){var ne=l.accumulatedGrads[S].variable,ae=l.accumulatedUpdates[S].variable;Ii(function(){var me=ne.mul(l.rho).add(V.square().mul(1-l.rho)),Ee=ae.add(l.epsilon).sqrt().div(ne.add(l.epsilon).sqrt()).mul(V),Se=ae.mul(l.rho).add(Ee.square().mul(1-l.rho));ne.assign(me),ae.assign(Se);var Ne=Ee.mul(-l.learningRate).add(j);j.assign(Ne)})}}),this.incrementIterations()},c.prototype.dispose=function(){this.accumulatedUpdates!=null&&(No(this.accumulatedGrads.map(function(o){return o.variable})),No(this.accumulatedUpdates.map(function(o){return o.variable})))},c.prototype.getWeights=function(){return R(this,void 0,void 0,function(){var o;return W(this,function(l){switch(l.label){case 0:return o=this.accumulatedGrads.concat(this.accumulatedUpdates),[4,this.saveIterations()];case 1:return[2,[l.sent()].concat(o.map(function(g){return{name:g.originalName,tensor:g.variable}}))]}})})},c.prototype.setWeights=function(o){return R(this,void 0,void 0,function(){var l;return W(this,function(g){switch(g.label){case 0:return[4,this.extractIterations(o)];case 1:return o=g.sent(),l=o.length/2,this.accumulatedGrads=o.slice(0,l).map(function(S){return{originalName:S.name,variable:S.tensor.variable(!1)}}),this.accumulatedUpdates=o.slice(l,2*l).map(function(S){return{originalName:S.name,variable:S.tensor.variable(!1)}}),[2]}})})},c.prototype.getConfig=function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}},c.fromConfig=function(o,l){return new o(l.learningRate,l.rho,l.epsilon)},c.className="Adadelta",c}(Ze);Fe(Je);var at=function(p){function c(o,l){l===void 0&&(l=.1);var g=p.call(this)||this;return g.learningRate=o,g.initialAccumulatorValue=l,g.accumulatedGrads=[],g}return J(c,p),c.prototype.applyGradients=function(o){var l=this;(Array.isArray(o)?o.map(function(g){return g.name}):Object.keys(o)).forEach(function(g,S){var j=Ue.registeredVariables[g];l.accumulatedGrads[S]==null&&(l.accumulatedGrads[S]={originalName:g+"/accumulator",variable:Ii(function(){return ws(j.shape,l.initialAccumulatorValue).variable(!1)})});var V=Array.isArray(o)?o[S].tensor:o[g];if(V!=null){var ne=l.accumulatedGrads[S].variable;Ii(function(){var ae=ne.add(V.square());ne.assign(ae);var me=V.div(ae.add(Ue.backend.epsilon()).sqrt()).mul(-l.learningRate).add(j);j.assign(me)})}}),this.incrementIterations()},c.prototype.dispose=function(){this.accumulatedGrads!=null&&No(this.accumulatedGrads.map(function(o){return o.variable}))},c.prototype.getWeights=function(){return R(this,void 0,void 0,function(){return W(this,function(o){switch(o.label){case 0:return[4,this.saveIterations()];case 1:return[2,[o.sent()].concat(this.accumulatedGrads.map(function(l){return{name:l.originalName,tensor:l.variable}}))]}})})},c.prototype.setWeights=function(o){return R(this,void 0,void 0,function(){return W(this,function(l){switch(l.label){case 0:return[4,this.extractIterations(o)];case 1:return o=l.sent(),this.accumulatedGrads=o.map(function(g){return{originalName:g.name,variable:g.tensor.variable(!1)}}),[2]}})})},c.prototype.getConfig=function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}},c.fromConfig=function(o,l){return new o(l.learningRate,l.initialAccumulatorValue)},c.className="Adagrad",c}(Ze);Fe(at);var yt=function(p){function c(o,l,g,S){S===void 0&&(S=null);var j=p.call(this)||this;return j.learningRate=o,j.beta1=l,j.beta2=g,j.epsilon=S,j.accumulatedFirstMoment=[],j.accumulatedSecondMoment=[],Ii(function(){j.accBeta1=fr(l).variable(),j.accBeta2=fr(g).variable()}),S==null&&(j.epsilon=Ue.backend.epsilon()),j}return J(c,p),c.prototype.applyGradients=function(o){var l=this,g=Array.isArray(o)?o.map(function(S){return S.name}):Object.keys(o);Ii(function(){var S=_a(1,l.accBeta1),j=_a(1,l.accBeta2);g.forEach(function(V,ne){var ae=Ue.registeredVariables[V];l.accumulatedFirstMoment[ne]==null&&(l.accumulatedFirstMoment[ne]={originalName:V+"/m",variable:Ii(function(){return ii(ae).variable(!1)})}),l.accumulatedSecondMoment[ne]==null&&(l.accumulatedSecondMoment[ne]={originalName:V+"/v",variable:Ii(function(){return ii(ae).variable(!1)})});var me=Array.isArray(o)?o[ne].tensor:o[V];if(me!=null){var Ee=l.accumulatedFirstMoment[ne].variable,Se=l.accumulatedSecondMoment[ne].variable,Ne=Ee.mul(l.beta1).add(me.mul(1-l.beta1)),ze=Se.mul(l.beta2).add(me.square().mul(1-l.beta2)),$e=Ne.div(S),qe=ze.div(j);Ee.assign(Ne),Se.assign(ze);var tt=$e.div(qe.sqrt().add(l.epsilon)).mul(-l.learningRate).add(ae);ae.assign(tt)}}),l.accBeta1.assign(l.accBeta1.mul(l.beta1)),l.accBeta2.assign(l.accBeta2.mul(l.beta2))}),this.incrementIterations()},c.prototype.dispose=function(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&No(this.accumulatedFirstMoment.map(function(o){return o.variable})),this.accumulatedSecondMoment!=null&&No(this.accumulatedSecondMoment.map(function(o){return o.variable}))},c.prototype.getWeights=function(){return R(this,void 0,void 0,function(){var o;return W(this,function(l){switch(l.label){case 0:return o=this.accumulatedFirstMoment.concat(this.accumulatedSecondMoment),[4,this.saveIterations()];case 1:return[2,[l.sent()].concat(o.map(function(g){return{name:g.originalName,tensor:g.variable}}))]}})})},c.prototype.setWeights=function(o){return R(this,void 0,void 0,function(){var l,g=this;return W(this,function(S){switch(S.label){case 0:return[4,this.extractIterations(o)];case 1:return o=S.sent(),Ii(function(){g.accBeta1.assign(Hs(g.beta1,g.iterations_+1)),g.accBeta2.assign(Hs(g.beta2,g.iterations_+1))}),l=o.length/2,this.accumulatedFirstMoment=o.slice(0,l).map(function(j){return{originalName:j.name,variable:j.tensor.variable(!1)}}),this.accumulatedSecondMoment=o.slice(l,2*l).map(function(j){return{originalName:j.name,variable:j.tensor.variable(!1)}}),[2]}})})},c.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}},c.fromConfig=function(o,l){return new o(l.learningRate,l.beta1,l.beta2,l.epsilon)},c.className="Adam",c}(Ze);Fe(yt);var xt=function(p){function c(o,l,g,S,j){S===void 0&&(S=null),j===void 0&&(j=0);var V=p.call(this)||this;return V.learningRate=o,V.beta1=l,V.beta2=g,V.epsilon=S,V.decay=j,V.accumulatedFirstMoment=[],V.accumulatedWeightedInfNorm=[],Ii(function(){V.iteration=fr(0).variable(),V.accBeta1=fr(l).variable()}),S==null&&(V.epsilon=Ue.backend.epsilon()),V}return J(c,p),c.prototype.applyGradients=function(o){var l=this,g=Array.isArray(o)?o.map(function(S){return S.name}):Object.keys(o);Ii(function(){var S=_a(1,l.accBeta1),j=Yo(-l.learningRate,l.iteration.mul(l.decay).add(1));g.forEach(function(V,ne){var ae=Ue.registeredVariables[V];l.accumulatedFirstMoment[ne]==null&&(l.accumulatedFirstMoment[ne]={originalName:V+"/m",variable:ii(ae).variable(!1)}),l.accumulatedWeightedInfNorm[ne]==null&&(l.accumulatedWeightedInfNorm[ne]={originalName:V+"/v",variable:ii(ae).variable(!1)});var me=Array.isArray(o)?o[ne].tensor:o[V];if(me!=null){var Ee=l.accumulatedFirstMoment[ne].variable,Se=l.accumulatedWeightedInfNorm[ne].variable,Ne=Ee.mul(l.beta1).add(me.mul(1-l.beta1)),ze=Se.mul(l.beta2),$e=me.abs(),qe=ze.maximum($e);Ee.assign(Ne),Se.assign(qe);var tt=j.div(S).mul(Ne.div(qe.add(l.epsilon))).add(ae);ae.assign(tt)}}),l.iteration.assign(l.iteration.add(1)),l.accBeta1.assign(l.accBeta1.mul(l.beta1))}),this.incrementIterations()},c.prototype.dispose=function(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&No(this.accumulatedFirstMoment.map(function(o){return o.variable})),this.accumulatedWeightedInfNorm!=null&&No(this.accumulatedWeightedInfNorm.map(function(o){return o.variable}))},c.prototype.getWeights=function(){return R(this,void 0,void 0,function(){return W(this,function(o){throw new Error("getWeights() is not implemented for Adamax yet.")})})},c.prototype.setWeights=function(o){return R(this,void 0,void 0,function(){return W(this,function(l){throw new Error("setWeights() is not implemented for Adamax yet.")})})},c.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}},c.fromConfig=function(o,l){return new o(l.learningRate,l.beta1,l.beta2,l.epsilon,l.decay)},c.className="Adamax",c}(Ze);Fe(xt);var kt=function(p){function c(o){var l=p.call(this)||this;return l.learningRate=o,l.setLearningRate(o),l}return J(c,p),c.prototype.applyGradients=function(o){var l=this;(Array.isArray(o)?o.map(function(g){return g.name}):Object.keys(o)).forEach(function(g,S){var j=Array.isArray(o)?o[S].tensor:o[g];if(j!=null){var V=Ue.registeredVariables[g];Ii(function(){var ne=l.c.mul(j).add(V);V.assign(ne)})}}),this.incrementIterations()},c.prototype.setLearningRate=function(o){this.learningRate=o,this.c!=null&&this.c.dispose(),this.c=Dh(fr(-o))},c.prototype.dispose=function(){this.c.dispose()},c.prototype.getWeights=function(){return R(this,void 0,void 0,function(){return W(this,function(o){switch(o.label){case 0:return[4,this.saveIterations()];case 1:return[2,[o.sent()]]}})})},c.prototype.setWeights=function(o){return R(this,void 0,void 0,function(){return W(this,function(l){switch(l.label){case 0:return[4,this.extractIterations(o)];case 1:if((o=l.sent()).length!==0)throw new Error("SGD optimizer does not have settable weights.");return[2]}})})},c.prototype.getConfig=function(){return{learningRate:this.learningRate}},c.fromConfig=function(o,l){return new o(l.learningRate)},c.className="SGD",c}(Ze);Fe(kt);var It=function(p){function c(o,l,g){g===void 0&&(g=!1);var S=p.call(this,o)||this;return S.learningRate=o,S.momentum=l,S.useNesterov=g,S.accumulations=[],S.m=fr(S.momentum),S}return J(c,p),c.prototype.applyGradients=function(o){var l=this;(Array.isArray(o)?o.map(function(g){return g.name}):Object.keys(o)).forEach(function(g,S){var j=Ue.registeredVariables[g];l.accumulations[S]==null&&(l.accumulations[S]={originalName:g+"/momentum",variable:Ii(function(){return ii(j).variable(!1)})});var V=l.accumulations[S].variable,ne=Array.isArray(o)?o[S].tensor:o[g];ne!=null&&Ii(function(){var ae,me=l.m.mul(V).add(ne);ae=l.useNesterov?l.c.mul(ne.add(me.mul(l.m))).add(j):l.c.mul(me).add(j),V.assign(me),j.assign(ae)})}),this.incrementIterations()},c.prototype.dispose=function(){this.m.dispose(),this.accumulations!=null&&No(this.accumulations.map(function(o){return o.variable}))},c.prototype.setMomentum=function(o){this.momentum=o},c.prototype.getWeights=function(){return R(this,void 0,void 0,function(){return W(this,function(o){switch(o.label){case 0:return[4,this.saveIterations()];case 1:return[2,[o.sent()].concat(this.accumulations.map(function(l){return{name:l.originalName,tensor:l.variable}}))]}})})},c.prototype.setWeights=function(o){return R(this,void 0,void 0,function(){return W(this,function(l){switch(l.label){case 0:return[4,this.extractIterations(o)];case 1:return o=l.sent(),this.accumulations=o.map(function(g){return{originalName:g.name,variable:g.tensor.variable(!1)}}),[2]}})})},c.prototype.getConfig=function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}},c.fromConfig=function(o,l){return new o(l.learningRate,l.momentum,l.useNesterov)},c.className="Momentum",c}(kt);Fe(It);var Jt=function(p){function c(o,l,g,S,j){l===void 0&&(l=.9),g===void 0&&(g=0),S===void 0&&(S=null),j===void 0&&(j=!1);var V=p.call(this)||this;if(V.learningRate=o,V.decay=l,V.momentum=g,V.epsilon=S,V.accumulatedMeanSquares=[],V.accumulatedMoments=[],V.accumulatedMeanGrads=[],V.centered=j,S==null&&(V.epsilon=Ue.backend.epsilon()),o==null)throw new Error("learningRate for RMSPropOptimizer must be defined.");return V}return J(c,p),c.prototype.applyGradients=function(o){var l=this;(Array.isArray(o)?o.map(function(g){return g.name}):Object.keys(o)).forEach(function(g,S){var j=Ue.registeredVariables[g];l.accumulatedMeanSquares[S]==null&&(l.accumulatedMeanSquares[S]={originalName:g+"/rms",variable:Ii(function(){return ii(j).variable(!1)})}),l.accumulatedMoments[S]==null&&(l.accumulatedMoments[S]={originalName:g+"/momentum",variable:Ii(function(){return ii(j).variable(!1)})}),l.accumulatedMeanGrads[S]==null&&l.centered&&(l.accumulatedMeanGrads[S]={originalName:g+"/mg",variable:Ii(function(){return ii(j).variable(!1)})});var V=Array.isArray(o)?o[S].tensor:o[g];if(V!=null){var ne=l.accumulatedMeanSquares[S].variable,ae=l.accumulatedMoments[S].variable;Ii(function(){var me=ne.mul(l.decay).add(V.square().mul(1-l.decay));if(l.centered){var Ee=l.accumulatedMeanGrads[S].variable,Se=Ee.mul(l.decay).add(V.mul(1-l.decay)),Ne=ae.mul(l.momentum).add(V.mul(l.learningRate).div(me.sub(Se.square().add(l.epsilon)).sqrt()));ne.assign(me),Ee.assign(Se),ae.assign(Ne);var ze=j.sub(Ne);j.assign(ze)}else{var $e=ne.mul(l.decay).add(V.square().mul(1-l.decay));Ne=ae.mul(l.momentum).add(V.mul(l.learningRate).div($e.add(l.epsilon).sqrt())),ne.assign($e),ae.assign(Ne),ze=j.sub(Ne),j.assign(ze)}})}}),this.incrementIterations()},c.prototype.dispose=function(){this.accumulatedMeanSquares!=null&&No(this.accumulatedMeanSquares.map(function(o){return o.variable})),this.accumulatedMeanGrads!=null&&this.centered&&No(this.accumulatedMeanGrads.map(function(o){return o.variable})),this.accumulatedMoments!=null&&No(this.accumulatedMoments.map(function(o){return o.variable}))},c.prototype.getWeights=function(){return R(this,void 0,void 0,function(){var o;return W(this,function(l){switch(l.label){case 0:return o=this.accumulatedMeanSquares.concat(this.accumulatedMoments),this.centered&&o.push.apply(o,this.accumulatedMeanGrads),[4,this.saveIterations()];case 1:return[2,[l.sent()].concat(o.map(function(g){return{name:g.originalName,tensor:g.variable}}))]}})})},c.prototype.setWeights=function(o){return R(this,void 0,void 0,function(){var l;return W(this,function(g){switch(g.label){case 0:return[4,this.extractIterations(o)];case 1:return o=g.sent(),l=this.centered?o.length/3:o.length/2,this.accumulatedMeanSquares=o.slice(0,l).map(function(S){return{originalName:S.name,variable:S.tensor.variable(!1)}}),this.accumulatedMoments=o.slice(l,2*l).map(function(S){return{originalName:S.name,variable:S.tensor.variable(!1)}}),this.centered&&(this.accumulatedMeanGrads=o.slice(2*l,3*l).map(function(S){return{originalName:S.name,variable:S.tensor.variable(!1)}})),[2]}})})},c.prototype.getConfig=function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}},c.fromConfig=function(o,l){return new o(l.learningRate,l.decay,l.momentum,l.epsilon,l.centered)},c.className="RMSProp",c}(Ze);Fe(Jt);var on=function(){function p(){}return p.sgd=function(c){return new kt(c)},p.momentum=function(c,o,l){return l===void 0&&(l=!1),new It(c,o,l)},p.rmsprop=function(c,o,l,g,S){return o===void 0&&(o=.9),l===void 0&&(l=0),g===void 0&&(g=null),S===void 0&&(S=!1),new Jt(c,o,l,g,S)},p.adam=function(c,o,l,g){return c===void 0&&(c=.001),o===void 0&&(o=.9),l===void 0&&(l=.999),g===void 0&&(g=null),new yt(c,o,l,g)},p.adadelta=function(c,o,l){return c===void 0&&(c=.001),o===void 0&&(o=.95),l===void 0&&(l=null),new Je(c,o,l)},p.adamax=function(c,o,l,g,S){return c===void 0&&(c=.002),o===void 0&&(o=.9),l===void 0&&(l=.999),g===void 0&&(g=null),S===void 0&&(S=0),new xt(c,o,l,g,S)},p.adagrad=function(c,o){return o===void 0&&(o=.1),new at(c,o)},p}(),Qt={sgd:on.sgd,momentum:on.momentum,adadelta:on.adadelta,adagrad:on.adagrad,rmsprop:on.rmsprop,adamax:on.adamax,adam:on.adam},cn=typeof requestAnimationFrame<"u"?requestAnimationFrame:B!==void 0?B:function(p){return p()};function vn(){return new Promise(function(p){return cn(function(){return p()})})}Mt.prototype.add=function(p){return ra(this,p)},Mt.prototype.broadcastTo=function(p){return $l(this,p)},Mt.prototype.div=function(p){return Yo(this,p)},Mt.prototype.divNoNan=function(p){return Up(this,p)},Mt.prototype.squaredDifference=function(p){return Gp(this,p)},Mt.prototype.tile=function(p){return Kf(this,p)},Mt.prototype.oneHot=function(p,c,o){return c===void 0&&(c=1),o===void 0&&(o=0),fc(this,p,c,o)},Mt.prototype.transpose=function(p){return ft(this,p)},Mt.prototype.pad=function(p,c){return Fu(this,p,c)},Mt.prototype.batchNorm=function(p,c,o,l,g){return ql(this,p,c,o,l,g)},bt=Pn}.call(this,a(59),a(75),a(92).Buffer,a(207).setImmediate)},function(Oe,A,a){function b(Nt,Ot,pn){return Nt.fields=Ot||[],Nt.fname=pn,Nt}function $(Nt){return Nt==null?null:Nt.fname}function U(Nt){return Nt==null?null:Nt.fields}function B(Nt){return Nt.length===1?re(Nt[0]):J(Nt)}a.d(A,"a",function(){return we}),a.d(A,"b",function(){return Ae}),a.d(A,"c",function(){return je}),a.d(A,"d",function(){return pe}),a.d(A,"e",function(){return Te}),a.d(A,"f",function(){return b}),a.d(A,"g",function(){return U}),a.d(A,"h",function(){return $}),a.d(A,"i",function(){return Tn}),a.d(A,"j",function(){return Dr}),a.d(A,"k",function(){return xn}),a.d(A,"l",function(){return Yn}),a.d(A,"m",function(){return an}),a.d(A,"n",function(){return Kt}),a.d(A,"o",function(){return R}),a.d(A,"p",function(){return Zt}),a.d(A,"q",function(){return $n}),a.d(A,"r",function(){return Dn}),a.d(A,"s",function(){return K}),a.d(A,"t",function(){return Qr}),a.d(A,"u",function(){return q}),a.d(A,"v",function(){return ti}),a.d(A,"w",function(){return wr}),a.d(A,"x",function(){return P}),a.d(A,"y",function(){return ee}),a.d(A,"z",function(){return Mr}),a.d(A,"A",function(){return di}),a.d(A,"B",function(){return _t}),a.d(A,"C",function(){return Yr}),a.d(A,"D",function(){return Xr}),a.d(A,"E",function(){return Kn}),a.d(A,"F",function(){return fi}),a.d(A,"G",function(){return oi}),a.d(A,"H",function(){return Ut}),a.d(A,"I",function(){return Ao}),a.d(A,"J",function(){return Wi}),a.d(A,"K",function(){return Ei}),a.d(A,"L",function(){return bt}),a.d(A,"M",function(){return ot}),a.d(A,"N",function(){return Mt}),a.d(A,"O",function(){return ge}),a.d(A,"P",function(){return ke}),a.d(A,"Q",function(){return se}),a.d(A,"R",function(){return ye}),a.d(A,"S",function(){return St}),a.d(A,"T",function(){return wn}),a.d(A,"U",function(){return Bn}),a.d(A,"V",function(){return Hn}),a.d(A,"W",function(){return jt}),a.d(A,"X",function(){return Lt}),a.d(A,"Y",function(){return le}),a.d(A,"Z",function(){return _e}),a.d(A,"Aa",function(){return W}),a.d(A,"Ba",function(){return et}),a.d(A,"Ca",function(){return gt}),a.d(A,"Da",function(){return fn}),a.d(A,"Ea",function(){return Ye}),a.d(A,"Fa",function(){return An}),a.d(A,"Ga",function(){return Jn}),a.d(A,"Ha",function(){return Ln}),a.d(A,"Ia",function(){return ie}),a.d(A,"Ja",function(){return zt}),a.d(A,"Ka",function(){return qn}),a.d(A,"La",function(){return Ft}),a.d(A,"Ma",function(){return I}),a.d(A,"Na",function(){return Ve}),a.d(A,"Oa",function(){return Qe}),a.d(A,"Pa",function(){return He}),a.d(A,"Qa",function(){return pt});const re=Nt=>function(Ot){return Ot[Nt]},J=Nt=>{const Ot=Nt.length;return function(pn){for(let Ht=0;Ht<Ot;++Ht)pn=pn[Nt[Ht]];return pn}};function R(Nt){throw Error(Nt)}function W(Nt){const Ot=[],pn=Nt.length;let Ht,Ue,Mn,Gn=null,Zn=0,ir="";function zr(){Ot.push(ir+Nt.substring(Ht,Ue)),ir="",Ht=Ue+1}for(Nt+="",Ht=Ue=0;Ue<pn;++Ue)if((Mn=Nt[Ue])==="\\")ir+=Nt.substring(Ht,Ue),ir+=Nt.substring(++Ue,++Ue),Ht=Ue;else if(Mn===Gn)zr(),Gn=null,Zn=-1;else{if(Gn)continue;Ht===Zn&&Mn==='"'||Ht===Zn&&Mn==="'"?(Ht=Ue+1,Gn=Mn):Mn!=="."||Zn?Mn==="["?(Ue>Ht&&zr(),Zn=Ht=Ue+1):Mn==="]"&&(Zn||R("Access path missing open bracket: "+Nt),Zn>0&&zr(),Zn=0,Ht=Ue+1):Ue>Ht?zr():Ht=Ue+1}return Zn&&R("Access path missing closing bracket: "+Nt),Gn&&R("Access path missing closing quote: "+Nt),Ue>Ht&&(Ue++,zr()),Ot}function q(Nt,Ot,pn){const Ht=W(Nt);return Nt=Ht.length===1?Ht[0]:Nt,b((pn&&pn.get||B)(Ht),[Nt],Ot||Nt)}const P=q("id"),ee=b(Nt=>Nt,[],"identity"),I=b(()=>0,[],"zero"),se=b(()=>1,[],"one"),ie=b(()=>!0,[],"true"),K=b(()=>!1,[],"false");function de(Nt,Ot,pn){const Ht=[Ot].concat([].slice.call(pn));console[Nt].apply(console,Ht)}const pe=0,Ae=1,Te=2,je=3,we=4;function ot(Nt,Ot){let pn=Nt||pe;return{level(Ht){return arguments.length?(pn=+Ht,this):pn},error(){return pn>=Ae&&de(Ot||"error","ERROR",arguments),this},warn(){return pn>=Te&&de(Ot||"warn","WARN",arguments),this},info(){return pn>=je&&de(Ot||"log","INFO",arguments),this},debug(){return pn>=we&&de(Ot||"log","DEBUG",arguments),this}}}var _t=Array.isArray;function Ut(Nt){return Nt===Object(Nt)}const Xt=Nt=>Nt!=="__proto__";function ke(...Nt){return Nt.reduce((Ot,pn)=>{for(const Ht in pn)if(Ht==="signals")Ot.signals=Gt(Ot.signals,pn.signals);else{const Ue=Ht==="legend"?{layout:1}:Ht==="style"||null;Ft(Ot,Ht,pn[Ht],Ue)}return Ot},{})}function Ft(Nt,Ot,pn,Ht){if(!Xt(Ot))return;let Ue,Mn;if(Ut(pn)&&!_t(pn))for(Ue in Mn=Ut(Nt[Ot])?Nt[Ot]:Nt[Ot]={},pn)Ht&&(Ht===!0||Ht[Ue])?Ft(Mn,Ue,pn[Ue]):Xt(Ue)&&(Mn[Ue]=pn[Ue]);else Nt[Ot]=pn}function Gt(Nt,Ot){if(Nt==null)return Ot;const pn={},Ht=[];function Ue(Mn){pn[Mn.name]||(pn[Mn.name]=1,Ht.push(Mn))}return Ot.forEach(Ue),Nt.forEach(Ue),Ht}function jt(Nt){return Nt[Nt.length-1]}function Ye(Nt){return Nt==null||Nt===""?null:+Nt}const ln=Nt=>Ot=>Nt*Math.exp(Ot),nn=Nt=>Ot=>Math.log(Nt*Ot),Bt=Nt=>Ot=>Math.sign(Ot)*Math.log1p(Math.abs(Ot/Nt)),Pt=Nt=>Ot=>Math.sign(Ot)*Math.expm1(Math.abs(Ot))*Nt,gn=Nt=>Ot=>Ot<0?-Math.pow(-Ot,Nt):Math.pow(Ot,Nt);function Dt(Nt,Ot,pn,Ht){const Ue=pn(Nt[0]),Mn=pn(jt(Nt)),Gn=(Mn-Ue)*Ot;return[Ht(Ue-Gn),Ht(Mn-Gn)]}function St(Nt,Ot){return Dt(Nt,Ot,Ye,ee)}function wn(Nt,Ot){var pn=Math.sign(Nt[0]);return Dt(Nt,Ot,nn(pn),ln(pn))}function Bn(Nt,Ot,pn){return Dt(Nt,Ot,gn(pn),gn(1/pn))}function Hn(Nt,Ot,pn){return Dt(Nt,Ot,Bt(pn),Pt(pn))}function hn(Nt,Ot,pn,Ht,Ue){const Mn=Ht(Nt[0]),Gn=Ht(jt(Nt)),Zn=Ot!=null?Ht(Ot):(Mn+Gn)/2;return[Ue(Zn+(Mn-Zn)*pn),Ue(Zn+(Gn-Zn)*pn)]}function Ve(Nt,Ot,pn){return hn(Nt,Ot,pn,Ye,ee)}function Qe(Nt,Ot,pn){const Ht=Math.sign(Nt[0]);return hn(Nt,Ot,pn,nn(Ht),ln(Ht))}function He(Nt,Ot,pn,Ht){return hn(Nt,Ot,pn,gn(Ht),gn(1/Ht))}function pt(Nt,Ot,pn,Ht){return hn(Nt,Ot,pn,Bt(Ht),Pt(Ht))}function Lt(Nt){return 1+~~(new Date(Nt).getMonth()/3)}function zt(Nt){return 1+~~(new Date(Nt).getUTCMonth()/3)}function Tn(Nt){return Nt!=null?_t(Nt)?Nt:[Nt]:[]}function xn(Nt,Ot,pn){let Ht,Ue=Nt[0],Mn=Nt[1];return Mn<Ue&&(Ht=Mn,Mn=Ue,Ue=Ht),(Ht=Mn-Ue)>=pn-Ot?[Ot,pn]:[Ue=Math.min(Math.max(Ue,Ot),pn-Ht),Ue+Ht]}function Kn(Nt){return typeof Nt=="function"}const be="descending";function Yn(Nt,Ot,pn){pn=pn||{},Ot=Tn(Ot)||[];const Ht=[],Ue=[],Mn={},Gn=pn.comparator||pr;return Tn(Nt).forEach((Zn,ir)=>{Zn!=null&&(Ht.push(Ot[ir]===be?-1:1),Ue.push(Zn=Kn(Zn)?Zn:q(Zn,null,pn)),(U(Zn)||[]).forEach(zr=>Mn[zr]=1))}),Ue.length===0?null:b(Gn(Ue,Ht),Object.keys(Mn))}const Dr=(Nt,Ot)=>(Nt<Ot||Nt==null)&&Ot!=null?-1:(Nt>Ot||Ot==null)&&Nt!=null?1:(Ot=Ot instanceof Date?+Ot:Ot,(Nt=Nt instanceof Date?+Nt:Nt)!==Nt&&Ot==Ot?-1:Ot!=Ot&&Nt==Nt?1:0),pr=(Nt,Ot)=>Nt.length===1?Nr(Nt[0],Ot[0]):Fr(Nt,Ot,Nt.length),Nr=(Nt,Ot)=>function(pn,Ht){return Dr(Nt(pn),Nt(Ht))*Ot},Fr=(Nt,Ot,pn)=>(Ot.push(0),function(Ht,Ue){let Mn,Gn=0,Zn=-1;for(;Gn===0&&++Zn<pn;)Mn=Nt[Zn],Gn=Dr(Mn(Ht),Mn(Ue));return Gn*Ot[Zn]});function an(Nt){return Kn(Nt)?Nt:()=>Nt}function Kt(Nt,Ot){let pn;return Ht=>{pn&&clearTimeout(pn),pn=setTimeout(()=>(Ot(Ht),pn=null),Nt)}}function Zt(Nt){for(let Ot,pn,Ht=1,Ue=arguments.length;Ht<Ue;++Ht)for(pn in Ot=arguments[Ht])Nt[pn]=Ot[pn];return Nt}function $n(Nt,Ot){let pn,Ht,Ue,Mn,Gn=0;if(Nt&&(pn=Nt.length))if(Ot==null){for(Ht=Nt[Gn];Gn<pn&&(Ht==null||Ht!=Ht);Ht=Nt[++Gn]);for(Ue=Mn=Ht;Gn<pn;++Gn)(Ht=Nt[Gn])!=null&&(Ht<Ue&&(Ue=Ht),Ht>Mn&&(Mn=Ht))}else{for(Ht=Ot(Nt[Gn]);Gn<pn&&(Ht==null||Ht!=Ht);Ht=Ot(Nt[++Gn]));for(Ue=Mn=Ht;Gn<pn;++Gn)(Ht=Ot(Nt[Gn]))!=null&&(Ht<Ue&&(Ue=Ht),Ht>Mn&&(Mn=Ht))}return[Ue,Mn]}function Dn(Nt,Ot){const pn=Nt.length;let Ht,Ue,Mn,Gn,Zn,ir=-1;if(Ot==null){for(;++ir<pn;)if((Ue=Nt[ir])!=null&&Ue>=Ue){Ht=Mn=Ue;break}if(ir===pn)return[-1,-1];for(Gn=Zn=ir;++ir<pn;)(Ue=Nt[ir])!=null&&(Ht>Ue&&(Ht=Ue,Gn=ir),Mn<Ue&&(Mn=Ue,Zn=ir))}else{for(;++ir<pn;)if((Ue=Ot(Nt[ir],ir,Nt))!=null&&Ue>=Ue){Ht=Mn=Ue;break}if(ir===pn)return[-1,-1];for(Gn=Zn=ir;++ir<pn;)(Ue=Ot(Nt[ir],ir,Nt))!=null&&(Ht>Ue&&(Ht=Ue,Gn=ir),Mn<Ue&&(Mn=Ue,Zn=ir))}return[Gn,Zn]}const hr=Object.prototype.hasOwnProperty;function wr(Nt,Ot){return hr.call(Nt,Ot)}const gr={};function Qr(Nt){let Ot,pn={};function Ht(Mn){return wr(pn,Mn)&&pn[Mn]!==gr}const Ue={size:0,empty:0,object:pn,has:Ht,get:Mn=>Ht(Mn)?pn[Mn]:void 0,set(Mn,Gn){return Ht(Mn)||(++Ue.size,pn[Mn]===gr&&--Ue.empty),pn[Mn]=Gn,this},delete(Mn){return Ht(Mn)&&(--Ue.size,++Ue.empty,pn[Mn]=gr),this},clear(){Ue.size=Ue.empty=0,Ue.object=pn={}},test(Mn){return arguments.length?(Ot=Mn,Ue):Ot},clean(){const Mn={};let Gn=0;for(const Zn in pn){const ir=pn[Zn];ir===gr||Ot&&Ot(ir)||(Mn[Zn]=ir,++Gn)}Ue.size=Gn,Ue.empty=0,Ue.object=pn=Mn}};return Nt&&Object.keys(Nt).forEach(Mn=>{Ue.set(Mn,Nt[Mn])}),Ue}function ti(Nt,Ot,pn,Ht,Ue,Mn){if(!pn&&pn!==0)return Mn;const Gn=+pn;let Zn,ir=Nt[0],zr=jt(Nt);zr<ir&&(Zn=ir,ir=zr,zr=Zn),Zn=Math.abs(Ot-ir);const vr=Math.abs(zr-Ot);return Zn<vr&&Zn<=Gn?Ht:vr<=Gn?Ue:Mn}function Mr(Nt,Ot,pn){const Ht=Nt.prototype=Object.create(Ot.prototype);return Object.defineProperty(Ht,"constructor",{value:Nt,writable:!0,enumerable:!0,configurable:!0}),Zt(Ht,pn)}function di(Nt,Ot,pn,Ht){let Ue,Mn=Ot[0],Gn=Ot[Ot.length-1];return Mn>Gn&&(Ue=Mn,Mn=Gn,Gn=Ue),pn=pn===void 0||pn,Ht=Ht===void 0||Ht,(pn?Mn<=Nt:Mn<Nt)&&(Ht?Nt<=Gn:Nt<Gn)}function Yr(Nt){return typeof Nt=="boolean"}function Xr(Nt){return Object.prototype.toString.call(Nt)==="[object Date]"}function fi(Nt){return Nt&&Kn(Nt[Symbol.iterator])}function oi(Nt){return typeof Nt=="number"}function Ao(Nt){return Object.prototype.toString.call(Nt)==="[object RegExp]"}function Wi(Nt){return typeof Nt=="string"}function Ei(Nt,Ot,pn){Nt&&(Nt=Ot?Tn(Nt).map(Zn=>Zn.replace(/\\(.)/g,"$1")):Tn(Nt));const Ht=Nt&&Nt.length,Ue=pn&&pn.get||B,Mn=Zn=>Ue(Ot?[Zn]:W(Zn));let Gn;if(Ht)if(Ht===1){const Zn=Mn(Nt[0]);Gn=function(ir){return""+Zn(ir)}}else{const Zn=Nt.map(Mn);Gn=function(ir){let zr=""+Zn[0](ir),vr=0;for(;++vr<Ht;)zr+="|"+Zn[vr](ir);return zr}}else Gn=function(){return""};return b(Gn,Nt,"key")}function bt(Nt,Ot){const pn=Nt[0],Ht=jt(Nt),Ue=+Ot;return Ue?Ue===1?Ht:pn+Ue*(Ht-pn):pn}const Lr=1e4;function Mt(Nt){let Ot,pn,Ht;Nt=+Nt||Lr;const Ue=()=>{Ot={},pn={},Ht=0},Mn=(Gn,Zn)=>(++Ht>Nt&&(pn=Ot,Ot={},Ht=1),Ot[Gn]=Zn);return Ue(),{clear:Ue,has:Gn=>wr(Ot,Gn)||wr(pn,Gn),get:Gn=>wr(Ot,Gn)?Ot[Gn]:wr(pn,Gn)?Mn(Gn,pn[Gn]):void 0,set:(Gn,Zn)=>wr(Ot,Gn)?Ot[Gn]=Zn:Mn(Gn,Zn)}}function ge(Nt,Ot,pn,Ht){const Ue=Ot.length,Mn=pn.length;if(!Mn)return Ot;if(!Ue)return pn;const Gn=Ht||new Ot.constructor(Ue+Mn);let Zn=0,ir=0,zr=0;for(;Zn<Ue&&ir<Mn;++zr)Gn[zr]=Nt(Ot[Zn],pn[ir])>0?pn[ir++]:Ot[Zn++];for(;Zn<Ue;++Zn,++zr)Gn[zr]=Ot[Zn];for(;ir<Mn;++ir,++zr)Gn[zr]=pn[ir];return Gn}function le(Nt,Ot){let pn="";for(;--Ot>=0;)pn+=Nt;return pn}function ye(Nt,Ot,pn,Ht){const Ue=pn||" ",Mn=Nt+"",Gn=Ot-Mn.length;return Gn<=0?Mn:Ht==="left"?le(Ue,Gn)+Mn:Ht==="center"?le(Ue,~~(Gn/2))+Mn+le(Ue,Math.ceil(Gn/2)):Mn+le(Ue,Gn)}function _e(Nt){return Nt&&jt(Nt)-Nt[0]||0}function et(Nt){return _t(Nt)?"["+Nt.map(et)+"]":Ut(Nt)||Wi(Nt)?JSON.stringify(Nt).replace("\u2028","\\u2028").replace("\u2029","\\u2029"):Nt}function gt(Nt){return Nt==null||Nt===""?null:!(!Nt||Nt==="false"||Nt==="0")&&!!Nt}const Rt=Nt=>oi(Nt)||Xr(Nt)?Nt:Date.parse(Nt);function fn(Nt,Ot){return Ot=Ot||Rt,Nt==null||Nt===""?null:Ot(Nt)}function Jn(Nt){return Nt==null||Nt===""?null:Nt+""}function An(Nt){const Ot={},pn=Nt.length;for(let Ht=0;Ht<pn;++Ht)Ot[Nt[Ht]]=!0;return Ot}function Ln(Nt,Ot,pn,Ht){const Ue=Ht??"",Mn=Nt+"",Gn=Mn.length,Zn=Math.max(0,Ot-Ue.length);return Gn<=Ot?Mn:pn==="left"?Ue+Mn.slice(Gn-Zn):pn==="center"?Mn.slice(0,Math.ceil(Zn/2))+Ue+Mn.slice(Gn-~~(Zn/2)):Mn.slice(0,Zn)+Ue}function qn(Nt,Ot,pn){if(Nt)if(Ot){const Ht=Nt.length;for(let Ue=0;Ue<Ht;++Ue){const Mn=Ot(Nt[Ue]);Mn&&pn(Mn,Ue,Nt)}}else Nt.forEach(pn)}},function(Oe,A,a){a.r(A);var b=a(0),$=function(Q,G){return($=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(C,N){C.__proto__=N}||function(C,N){for(var te in N)N.hasOwnProperty(te)&&(C[te]=N[te])})(Q,G)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function U(Q,G){function C(){this.constructor=Q}$(Q,G),Q.prototype=G===null?Object.create(G):(C.prototype=G.prototype,new C)}var B,re=function(){return(re=Object.assign||function(Q){for(var G,C=1,N=arguments.length;C<N;C++)for(var te in G=arguments[C])Object.prototype.hasOwnProperty.call(G,te)&&(Q[te]=G[te]);return Q}).apply(this,arguments)};function J(Q,G,C,N){return new(C||(C=Promise))(function(te,Be){function Ge(Wt){try{Tt(N.next(Wt))}catch(ct){Be(ct)}}function ft(Wt){try{Tt(N.throw(Wt))}catch(ct){Be(ct)}}function Tt(Wt){Wt.done?te(Wt.value):new C(function(ct){ct(Wt.value)}).then(Ge,ft)}Tt((N=N.apply(Q,G||[])).next())})}function R(Q,G){var C,N,te,Be,Ge={label:0,sent:function(){if(1&te[0])throw te[1];return te[1]},trys:[],ops:[]};return Be={next:ft(0),throw:ft(1),return:ft(2)},typeof Symbol=="function"&&(Be[Symbol.iterator]=function(){return this}),Be;function ft(Tt){return function(Wt){return function(ct){if(C)throw new TypeError("Generator is already executing.");for(;Ge;)try{if(C=1,N&&(te=2&ct[0]?N.return:ct[0]?N.throw||((te=N.return)&&te.call(N),0):N.next)&&!(te=te.call(N,ct[1])).done)return te;switch(N=0,te&&(ct=[2&ct[0],te.value]),ct[0]){case 0:case 1:te=ct;break;case 4:return Ge.label++,{value:ct[1],done:!1};case 5:Ge.label++,N=ct[1],ct=[0];continue;case 7:ct=Ge.ops.pop(),Ge.trys.pop();continue;default:if(!(te=(te=Ge.trys).length>0&&te[te.length-1])&&(ct[0]===6||ct[0]===2)){Ge=0;continue}if(ct[0]===3&&(!te||ct[1]>te[0]&&ct[1]<te[3])){Ge.label=ct[1];break}if(ct[0]===6&&Ge.label<te[1]){Ge.label=te[1],te=ct;break}if(te&&Ge.label<te[2]){Ge.label=te[2],Ge.ops.push(ct);break}te[2]&&Ge.ops.pop(),Ge.trys.pop();continue}ct=G.call(Q,Ge)}catch(bn){ct=[6,bn],N=0}finally{C=te=0}if(5&ct[0])throw ct[1];return{value:ct[0]?ct[1]:void 0,done:!0}}([Tt,Wt])}}}function W(){return B==null&&(B=Object(b.backend)().epsilon()),B}var q=function(Q){function G(C){var N=Q.call(this,C)||this;return Object.setPrototypeOf(N,G.prototype),N}return U(G,Q),G}(Error),P=function(Q){function G(C){var N=Q.call(this,C)||this;return Object.setPrototypeOf(N,G.prototype),N}return U(G,Q),G}(Error),ee=function(Q){function G(C){var N=Q.call(this,C)||this;return Object.setPrototypeOf(N,G.prototype),N}return U(G,Q),G}(Error),I=function(Q){function G(C){var N=Q.call(this,C)||this;return Object.setPrototypeOf(N,G.prototype),N}return U(G,Q),G}(Error),se=function(Q){function G(C){var N=Q.call(this,C)||this;return Object.setPrototypeOf(N,G.prototype),N}return U(G,Q),G}(Error);(function(Q){function G(C){var N=Q.call(this,C)||this;return Object.setPrototypeOf(N,G.prototype),N}U(G,Q)})(Error);function ie(Q,G){if(Array.isArray(Q)){for(var C=[],N=0;N<G;N++)C=C.concat(Q);return C}return(C=new Array(G)).fill(Q),C}function K(Q,G){if(!Q)throw new se(G)}function de(Q,G){for(var C=0,N=0,te=Q;N<te.length;N++)te[N]===G&&C++;return C}function pe(Q){return Q.length===1?Q[0]:Q}function Ae(Q){return Array.isArray(Q)?Q:[Q]}function Te(Q){var G=Q.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return G[0]!=="_"?G:"private"+G}function je(Q){return Q.length<=1||Q.indexOf("_")===-1?Q:Q.replace(/[_]+(\w|$)/g,function(G,C){return C.toUpperCase()})}var we={};function ot(Q){if(Q==null)return null;var G={};return G.className=Q.getClassName(),G.config=Q.getConfig(),G}function _t(Q,G,C,N,te){var Be,Ge,ft;if(G===void 0&&(G={}),C===void 0&&(C={}),N===void 0&&(N="object"),te===void 0&&(te=!1),typeof Q=="string"){var Tt=Q,Wt=void 0;if(Tt in C)Wt=C[Tt];else if(Tt in we)Wt=we[Tt];else if((Wt=G[Tt])==null)throw new ee("Unknown "+N+": "+Q+`. This may be due to one of the following reasons:
1. The `+N+` is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom `+N+" is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().");return Wt}var ct=Q;if(ct.className==null||ct.config==null)throw new ee(N+": Improper config format: "+JSON.stringify(ct)+`.
'className' and 'config' must set.`);var bn=ct.className,Sn=void 0,Nn=void 0;if(bn in C?(Sn=(Be=C[bn])[0],Nn=Be[1]):bn in we?(Sn=(Ge=we.className)[0],Nn=Ge[1]):bn in G&&(Sn=(ft=G[bn])[0],Nn=ft[1]),Sn==null)throw new ee("Unknown "+N+": "+bn+`. This may be due to one of the following reasons:
1. The `+N+` is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom `+N+" is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().");if(Nn!=null){for(var Wn={},Rn=0,tr=Object.keys(we);Rn<tr.length;Rn++)Wn[$r=tr[Rn]]=we[$r];for(var rr=0,dr=Object.keys(C);rr<dr.length;rr++)Wn[$r=dr[rr]]=C[$r];ct.config.customObjects=Wn;for(var Tr=re({},we),Vr=0,xr=Object.keys(C);Vr<xr.length;Vr++){var $r=xr[Vr];we[$r]=C[$r]}(function Hr(ni){if(ni!=null&&typeof ni=="object")if(Array.isArray(ni))ni.forEach(function(no){return Hr(no)});else for(var to=0,Qi=Object.keys(ni);to<Qi.length;to++){var zo=Qi[to],ji=ni[zo];ji!=null&&typeof ji=="object"&&(Array.isArray(ji)||ji.type!=="ndarray"||typeof ji.value!="number"?Hr(ji):ni[zo]=ji.value)}})(ct.config);var Wr=Nn(Sn,ct.config,C,te);return we=re({},Tr),Wr}Tr=re({},we);for(var ai=0,li=Object.keys(C);ai<li.length;ai++)$r=li[ai],we[$r]=C[$r];return Wr=new Sn(ct.config),we=re({},Tr),Wr}function Ut(Q,G){return-1*function(C,N){return C<N?-1:C>N?1:0}(Q,G)}function Xt(Q){if(Q==null)return Q;for(var G=[],C=0,N=Q;C<N.length;C++){var te=N[C];G.indexOf(te)===-1&&G.push(te)}return G}function ke(Q){if(Q==null)throw new ee("Invalid value in obj: "+JSON.stringify(Q));for(var G in Q)if(Q.hasOwnProperty(G))return!1;return!0}function Ft(Q,G,C){if(C!=null&&Q.indexOf(C)<0)throw new ee(C+" is not a valid "+G+".  Valid values are "+Q+" or null/undefined.")}function Gt(Q,G,C,N){return C===void 0&&(C=0),N===void 0&&(N=1/0),K(C>=0),K(N>=C),Array.isArray(Q)&&Q.length>=C&&Q.length<=N&&Q.every(function(te){return typeof te===G})}function jt(Q,G){Array.isArray(Q)?(b.util.assert(Q.length>0,function(){return G+" is unexpectedly an empty array."}),Q.forEach(function(C,N){return jt(C,"element "+(N+1)+" of "+G)})):b.util.assert(Number.isInteger(Q)&&Q>0,function(){return"Expected "+G+" to be a positive integer, but got "+function C(N){return N===null?"null":Array.isArray(N)?"["+N.map(function(te){return C(te)}).join(",")+"]":typeof N=="string"?'"'+N+'"':""+N}(Q)+"."})}function Ye(Q){return Q==="relu"?"relu":Q==="linear"?"linear":Q==="elu"?"elu":null}function ln(Q,G){return Object(b.tidy)(function(){return Object(b.sqrt)(Object(b.sum)(Object(b.mulStrict)(Q,Q),G,!0))})}var nn=function(Q){function G(){return Q!==null&&Q.apply(this,arguments)||this}return U(G,Q),G.prototype.getConfig=function(){return{}},G}(b.serialization.Serializable),Bt=function(Q){function G(C){var N=Q.call(this)||this;return N.defaultMaxValue=2,N.defaultAxis=0,N.maxValue=C.maxValue!=null?C.maxValue:N.defaultMaxValue,N.axis=C.axis!=null?C.axis:N.defaultAxis,N}return U(G,Q),G.prototype.apply=function(C){var N=this;return Object(b.tidy)(function(){var te=ln(C,N.axis),Be=Object(b.clipByValue)(te,0,N.maxValue);return Object(b.mul)(C,Object(b.div)(Be,Object(b.add)(W(),te)))})},G.prototype.getConfig=function(){return{maxValue:this.maxValue,axis:this.axis}},G.className="MaxNorm",G}(nn);b.serialization.registerClass(Bt);var Pt=function(Q){function G(C){var N=Q.call(this)||this;return N.defaultAxis=0,N.axis=C.axis!=null?C.axis:N.defaultAxis,N}return U(G,Q),G.prototype.apply=function(C){var N=this;return Object(b.tidy)(function(){return Object(b.div)(C,Object(b.add)(W(),ln(C,N.axis)))})},G.prototype.getConfig=function(){return{axis:this.axis}},G.className="UnitNorm",G}(nn);b.serialization.registerClass(Pt);var gn=function(Q){function G(){return Q!==null&&Q.apply(this,arguments)||this}return U(G,Q),G.prototype.apply=function(C){return Object(b.relu)(C)},G.className="NonNeg",G}(nn);b.serialization.registerClass(gn);var Dt=function(Q){function G(C){var N=Q.call(this)||this;return N.defaultMinValue=0,N.defaultMaxValue=1,N.defaultRate=1,N.defaultAxis=0,N.minValue=C.minValue!=null?C.minValue:N.defaultMinValue,N.maxValue=C.maxValue!=null?C.maxValue:N.defaultMaxValue,N.rate=C.rate!=null?C.rate:N.defaultRate,N.axis=C.axis!=null?C.axis:N.defaultAxis,N}return U(G,Q),G.prototype.apply=function(C){var N=this;return Object(b.tidy)(function(){var te=ln(C,N.axis),Be=Object(b.add)(Object(b.mul)(N.rate,Object(b.clipByValue)(te,N.minValue,N.maxValue)),Object(b.mul)(1-N.rate,te));return Object(b.mul)(C,Object(b.div)(Be,Object(b.add)(W(),te)))})},G.prototype.getConfig=function(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}},G.className="MinMaxNorm",G}(nn);b.serialization.registerClass(Dt);var St={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function wn(Q){return ot(Q)}function Bn(Q,G){return G===void 0&&(G={}),_t(Q,b.serialization.SerializationMap.getMap().classNameMap,G,"constraint")}function Hn(Q){return Q==null?null:typeof Q=="string"?Bn({className:Q in St?St[Q]:Q,config:{}}):Q instanceof nn?Q:Bn(Q)}var hn=Object.freeze({maxNorm:function(Q){return new Bt(Q)},unitNorm:function(Q){return new Pt(Q)},nonNeg:function(){return new gn},minMaxNorm:function(Q){return new Dt(Q)}}),Ve=["channelsFirst","channelsLast"],Qe=["valid","same","causal"],He=["max","avg"],pt=["sum","mul","concat","ave"],Lt=new Map;function zt(Q){Ft(Ve,"DataFormat",Q)}function Tn(Q){Ft(Qe,"PaddingMode",Q)}function xn(Q){Ft(He,"PoolMode",Q)}var Kn=[],be="/";function Yn(Q,G){Kn.push(Q);try{var C=G();return Kn.pop(),C}catch(N){throw Kn.pop(),N}}function Dr(Q){if(!Fr(Q))throw new Error("Not a valid tensor name: '"+Q+"'");return(Kn.length===0?"":Kn.join(be)+be)+Q}function pr(Q){if(!Fr(Q))throw new Error("Not a valid tensor name: '"+Q+"'");Lt.has(Q)||Lt.set(Q,0);var G=Lt.get(Q);if(Lt.set(Q,Lt.get(Q)+1),G>0){var C=Q+"_"+G;return Lt.set(C,1),C}return Q}var Nr=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function Fr(Q){return!!Q.match(Nr)}function an(Q){return Q===parseInt(Q.toString(),10)}function Kt(Q,G,C){G==null&&(G=0),C==null&&(C=Q.length);for(var N=1,te=G;te<C;++te)N*=Q[te];return N}function Zt(Q){return Q=Array.isArray(Q)?new Float32Array(Q):Q,Object(b.tensor1d)(Q)}function $n(Q){return Object(b.min)(Zt(Q)).dataSync()[0]}function Dn(Q){return Object(b.max)(Zt(Q)).dataSync()[0]}function hr(Q,G){if(G<Q)throw new ee("end ("+G+") < begin ("+Q+") is forbidden.");for(var C=[],N=Q;N<G;++N)C.push(N);return C}function wr(Q,G){return Q.asType(G)}function gr(Q,G){G===void 0&&(G=-1);var C=Q.shape.slice();return G<0&&(G=C.length+G+1),C.splice(G,0,1),Q.reshape(C)}function Qr(Q,G,C){return Object(b.tidy)(function(){switch(Q.rank){case 1:return Object(b.slice1d)(Q,G,C);case 2:return Object(b.slice2d)(Q,[G,0],[C,Q.shape[1]]);case 3:return Object(b.slice3d)(Q,[G,0,0],[C,Q.shape[1],Q.shape[2]]);case 4:return Object(b.slice4d)(Q,[G,0,0,0],[C,Q.shape[1],Q.shape[2],Q.shape[3]]);case 5:return Object(b.slice)(Q,[G,0,0,0,0],[C,Q.shape[1],Q.shape[2],Q.shape[3],Q.shape[4]]);case 6:return Object(b.slice)(Q,[G,0,0,0,0,0],[C,Q.shape[1],Q.shape[2],Q.shape[3],Q.shape[4],Q.shape[5]]);default:throw new ee("sliceAlongFirstAxis() received an unsupported tensor rank: "+Q.rank)}})}function ti(Q,G,C){return Object(b.tidy)(function(){switch(Q.rank){case 1:return Object(b.slice1d)(Q,G,C);case 2:return Object(b.slice2d)(Q,[0,G],[Q.shape[0],C]);case 3:return Object(b.slice3d)(Q,[0,0,G],[Q.shape[0],Q.shape[1],C]);case 4:return Object(b.slice4d)(Q,[0,0,0,G],[Q.shape[0],Q.shape[1],Q.shape[2],C]);default:throw new ee("sliceAlongLastAxis() received an unsupported tensor rank: "+Q.rank)}})}function Mr(Q,G,C,N){return Object(b.tidy)(function(){switch(Q.rank){case 1:return Object(b.slice1d)(Q,G,C);case 2:switch(N){case 1:return Qr(Q,G,C);case 2:return ti(Q,G,C);default:throw new ee("The axis is not within the rank of the tensor "+N)}case 3:switch(N){case 1:return Qr(Q,G,C);case 2:return Object(b.slice3d)(Q,[0,G,0],[Q.shape[0],C,Q.shape[2]]);case 3:return ti(Q,G,C);default:throw new ee("The axis is not within the rank of the tensor "+N)}case 4:switch(N){case 1:return Qr(Q,G,C);case 2:return Object(b.slice4d)(Q,[0,G,0,0],[Q.shape[0],C,Q.shape[2],Q.shape[3]]);case 3:return Object(b.slice4d)(Q,[0,0,G,0],[Q.shape[0],Q.shape[1],C,Q.shape[3]]);case 4:return ti(Q,G,C);default:throw new ee("The axis is not within the rank of the tensor "+N)}default:throw new ee("sliceAlongLastAxis() received an unsupported tensor rank: "+Q.rank)}})}function di(Q,G){var C;return G===void 0&&(G=-1),G<0&&(G=(C=Q[0].rank)!==0?C:0),G===Q[0].rank&&(G=-1),Object(b.concat)(Q,G)}function Yr(Q,G){switch(Q.rank){case 1:return Object(b.concat1d)([Q,G]);case 2:return Object(b.concat2d)([Q,G],0);case 3:return Object(b.concat3d)([Q,G],0);case 4:return Object(b.concat4d)([Q,G],0);default:throw new ee("concatAlongFirstAxis() received an unsupported tensor rank: "+Q.rank)}}function Xr(Q,G){if(Array.isArray(G)||(G=[G]),Q.rank!==G.length)throw new ee("The length of input n ("+G.length+") does not match the number of dimensions in input x ("+Q.rank+")");return Object(b.tile)(Q,G)}function fi(Q,G,C,N,te){return G===void 0&&(G=0),C===void 0&&(C=1),Object(b.randomNormal)(Q,G,C,N,te)}function oi(Q,G,C,N){if(Q.rank<2||G.rank<2)throw new I("dot requires both inputs to be rank >= 2 but got x shape = "+Q.shape+" and y shape = "+G.shape);if(G.rank>=3&&Q.shape.slice(-1)[0]!==(ct=G.shape.slice(-2)[0]))throw new I("If rank y >= 3, then the second last dim of y must equal the last dim of x but got x shape = "+Q.shape+" and  y shape = "+G.shape);if(Q.rank===2&&G.rank===2){var te=!1,Be=!1;return b.fused.matMul({a:Q,b:G,transposeA:te,transposeB:Be,bias:N?Ei(Q.rank,N,"channelsLast"):null,activation:C})}var Ge=Q.shape.slice(),ft=Ge.pop();Q=Q.reshape([-1,ft]);var Tt=G.shape.slice(),Wt=Tt.pop(),ct=Tt.pop(),bn=Tt.concat([Wt]),Sn=Array.from({length:G.rank},function(Wn,Rn){return Rn===0?G.rank-2:Rn<=G.rank-2?Rn-1:Rn});G=G.transpose(Sn).reshape([ct,-1]);var Nn=Ge.concat(bn);return te=!1,Be=!1,b.fused.matMul({a:Q,b:G,transposeA:te,transposeB:Be,bias:N?Ei(Q.rank,N,"channelsLast"):null,activation:C}).reshape(Nn)}function Ao(Q,G,C){return Object(b.tidy)(function(){return G=Array.isArray(G)?Object(b.tensor1d)(G,"int32"):G.toInt(),Object(b.gather)(Q,G,C)})}function Wi(Q){return Object(b.mulStrict)(Q,Q)}function Ei(Q,G,C){var N=G.shape;if(G.rank!==1&&G.rank!==Q)throw new ee("Unexpected bias dimensions: "+G.rank+"; expected it to be 1 or "+Q);if(Q===5){if(C==="channelsFirst")return N.length===1?G.reshape([1,N[0],1,1,1]):G.reshape([1,N[3],N[0],N[1],N[2]]);if(C==="channelsLast")return N.length===1?G.reshape([1,1,1,1,N[0]]):G.reshape([1].concat(N))}else if(Q===4){if(C==="channelsFirst")return N.length===1?G.reshape([1,N[0],1,1]):G.reshape([1,N[2],N[0],N[1]]);if(C==="channelsLast")return N.length===1?G.reshape([1,1,1,N[0]]):G.reshape([1].concat(N))}else if(Q===3){if(C==="channelsFirst")return N.length===1?G.reshape([1,N[0],1]):G.reshape([1,N[1],N[0]]);if(C==="channelsLast")return N.length===1?G.reshape([1,1,N[0]]):G.reshape([1].concat(N))}else if(Q<3)return G;throw new ee("Unsupported input rank by biasAdd: "+G.rank)}function bt(Q,G,C){return Object(b.tidy)(function(){return C==null&&(C="channelsLast"),zt(C),Q.add(Ei(Q.rank,G,C))})}function Lr(Q,G,C,N){return Object(b.tidy)(function(){return Object(b.dropout)(Q,G,C,N)})}function Mt(Q,G,C){return C===void 0&&(C=!1),C?Q():G()}var ge=["fanIn","fanOut","fanAvg"],le=["normal","uniform","truncatedNormal"],ye=function(Q){function G(){return Q!==null&&Q.apply(this,arguments)||this}return U(G,Q),G.prototype.fromConfigUsesCustomObjects=function(){return!1},G.prototype.getConfig=function(){return{}},G}(b.serialization.Serializable),_e=function(Q){function G(){return Q!==null&&Q.apply(this,arguments)||this}return U(G,Q),G.prototype.apply=function(C,N){return Object(b.zeros)(C,N)},G.className="Zeros",G}(ye);b.serialization.registerClass(_e);var et=function(Q){function G(){return Q!==null&&Q.apply(this,arguments)||this}return U(G,Q),G.prototype.apply=function(C,N){return Object(b.ones)(C,N)},G.className="Ones",G}(ye);b.serialization.registerClass(et);var gt=function(Q){function G(C){var N=Q.call(this)||this;if(typeof C!="object")throw new ee("Expected argument of type ConstantConfig but got "+C);if(C.value===void 0)throw new ee("config must have value set but got "+C);return N.value=C.value,N}return U(G,Q),G.prototype.apply=function(C,N){var te=this;return Object(b.tidy)(function(){return Object(b.mul)(Object(b.scalar)(te.value),Object(b.ones)(C,N))})},G.prototype.getConfig=function(){return{value:this.value}},G.className="Constant",G}(ye);b.serialization.registerClass(gt);var Rt=function(Q){function G(C){var N=Q.call(this)||this;return N.DEFAULT_MINVAL=-.05,N.DEFAULT_MAXVAL=.05,N.minval=C.minval||N.DEFAULT_MINVAL,N.maxval=C.maxval||N.DEFAULT_MAXVAL,N.seed=C.seed,N}return U(G,Q),G.prototype.apply=function(C,N){return Object(b.randomUniform)(C,this.minval,this.maxval,N)},G.prototype.getConfig=function(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}},G.className="RandomUniform",G}(ye);b.serialization.registerClass(Rt);var fn=function(Q){function G(C){var N=Q.call(this)||this;return N.DEFAULT_MEAN=0,N.DEFAULT_STDDEV=.05,N.mean=C.mean||N.DEFAULT_MEAN,N.stddev=C.stddev||N.DEFAULT_STDDEV,N.seed=C.seed,N}return U(G,Q),G.prototype.apply=function(C,N){if((N=N||"float32")!=="float32"&&N!=="int32")throw new I("randomNormal does not support dType "+N+".");return fi(C,this.mean,this.stddev,N,this.seed)},G.prototype.getConfig=function(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}},G.className="RandomNormal",G}(ye);b.serialization.registerClass(fn);var Jn=function(Q){function G(C){var N=Q.call(this)||this;return N.DEFAULT_MEAN=0,N.DEFAULT_STDDEV=.05,N.mean=C.mean||N.DEFAULT_MEAN,N.stddev=C.stddev||N.DEFAULT_STDDEV,N.seed=C.seed,N}return U(G,Q),G.prototype.apply=function(C,N){if((N=N||"float32")!=="float32"&&N!=="int32")throw new I("truncatedNormal does not support dType "+N+".");return Object(b.truncatedNormal)(C,this.mean,this.stddev,N,this.seed)},G.prototype.getConfig=function(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}},G.className="TruncatedNormal",G}(ye);b.serialization.registerClass(Jn);var An=function(Q){function G(C){var N=Q.call(this)||this;return N.gain=C.gain!=null?C.gain:1,N}return U(G,Q),G.prototype.apply=function(C,N){var te=this;return Object(b.tidy)(function(){if(C.length!==2||C[0]!==C[1])throw new ee("Identity matrix initializer can only be used for 2D square matrices.");return Object(b.mul)(te.gain,Object(b.eye)(C[0]))})},G.prototype.getConfig=function(){return{gain:this.gain}},G.className="Identity",G}(ye);b.serialization.registerClass(An);var Ln=function(Q){function G(C){var N=Q.call(this)||this;if(C.scale<0)throw new ee("scale must be a positive float. Got: "+C.scale);return N.scale=C.scale==null?1:C.scale,N.mode=C.mode==null?"fanIn":C.mode,function(te){Ft(ge,"FanMode",te)}(N.mode),N.distribution=C.distribution==null?"normal":C.distribution,function(te){Ft(le,"Distribution",te)}(N.distribution),N.seed=C.seed,N}return U(G,Q),G.prototype.apply=function(C,N){var te=function(ct,bn){var Sn,Nn;if(bn===void 0&&(bn="channelsLast"),zt(bn),ct.length===2)Sn=ct[0],Nn=ct[1];else if([3,4,5].indexOf(ct.length)!==-1)if(bn==="channelsFirst"){var Wn=Kt(ct,2);Sn=ct[1]*Wn,Nn=ct[0]*Wn}else bn==="channelsLast"&&(Wn=Kt(ct,0,ct.length-2),Sn=ct[ct.length-2]*Wn,Nn=ct[ct.length-1]*Wn);else{var Rn=Kt(ct);Sn=Math.sqrt(Rn),Nn=Math.sqrt(Rn)}return[Sn,Nn]}(C),Be=te[0],Ge=te[1],ft=this.scale;if(this.mode==="fanIn"?ft/=Math.max(1,Be):this.mode==="fanOut"?ft/=Math.max(1,Ge):ft/=Math.max(1,(Be+Ge)/2),this.distribution==="normal"){var Tt=Math.sqrt(ft);if((N=N||"float32")!=="float32"&&N!=="int32")throw new I(this.getClassName()+" does not support dType "+N+".");return Object(b.truncatedNormal)(C,0,Tt,N,this.seed)}var Wt=Math.sqrt(3*ft);return Object(b.randomUniform)(C,-Wt,Wt,N)},G.prototype.getConfig=function(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}},G.className="VarianceScaling",G}(ye);b.serialization.registerClass(Ln);var qn=function(Q){function G(C){return Q.call(this,{scale:1,mode:"fanAvg",distribution:"uniform",seed:C==null?null:C.seed})||this}return U(G,Q),G.prototype.getClassName=function(){return Ln.className},G.className="GlorotUniform",G}(Ln);b.serialization.registerClass(qn);var Nt=function(Q){function G(C){return Q.call(this,{scale:1,mode:"fanAvg",distribution:"normal",seed:C==null?null:C.seed})||this}return U(G,Q),G.prototype.getClassName=function(){return Ln.className},G.className="GlorotNormal",G}(Ln);b.serialization.registerClass(Nt);var Ot=function(Q){function G(C){return Q.call(this,{scale:2,mode:"fanIn",distribution:"normal",seed:C==null?null:C.seed})||this}return U(G,Q),G.prototype.getClassName=function(){return Ln.className},G.className="HeNormal",G}(Ln);b.serialization.registerClass(Ot);var pn=function(Q){function G(C){return Q.call(this,{scale:2,mode:"fanIn",distribution:"uniform",seed:C==null?null:C.seed})||this}return U(G,Q),G.prototype.getClassName=function(){return Ln.className},G.className="HeUniform",G}(Ln);b.serialization.registerClass(pn);var Ht=function(Q){function G(C){return Q.call(this,{scale:1,mode:"fanIn",distribution:"normal",seed:C==null?null:C.seed})||this}return U(G,Q),G.prototype.getClassName=function(){return Ln.className},G.className="LeCunNormal",G}(Ln);b.serialization.registerClass(Ht);var Ue=function(Q){function G(C){return Q.call(this,{scale:1,mode:"fanIn",distribution:"uniform",seed:C==null?null:C.seed})||this}return U(G,Q),G.prototype.getClassName=function(){return Ln.className},G.className="LeCunNormal",G}(Ln);b.serialization.registerClass(Ue);var Mn=function(Q){function G(C){var N=Q.call(this)||this;if(N.DEFAULT_GAIN=1,N.gain=C.gain==null?N.DEFAULT_GAIN:C.gain,N.seed=C.seed,N.seed!=null)throw new I("Random seed is not implemented for Orthogonal Initializer yet.");return N}return U(G,Q),G.prototype.apply=function(C,N){var te=this;return Object(b.tidy)(function(){if(C.length!==2)throw new I("The Orthogonal Initializer does not support non-2D shapes yet.");C[0]*C[1]>2e3&&console.warn("Orthogonal initializer is being called on a matrix with more than 2000 ("+C[0]*C[1]+") elements: Slowness may result.");var Be=fi(C[0]>C[1]?[C[1],C[0]]:C,0,1,"float32"),Ge=b.linalg.gramSchmidt(Be);return C[0]>C[1]&&(Ge=Ge.transpose()),Object(b.mul)(te.gain,Ge)})},G.prototype.getConfig=function(){return{gain:this.gain,seed:this.seed}},G.className="Orthogonal",G}(ye);b.serialization.registerClass(Mn);var Gn={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function Zn(Q,G){return G===void 0&&(G={}),_t(Q,b.serialization.SerializationMap.getMap().classNameMap,G,"initializer")}function ir(Q){return ot(Q)}function zr(Q){if(typeof Q=="string"){var G=Q in Gn?Gn[Q]:Q;if(G==="GlorotNormal")return new Nt;if(G==="GlorotUniform")return new qn;if(G==="HeNormal")return new Ot;if(G==="HeUniform")return new pn;if(G==="LeCunNormal")return new Ht;if(G==="LeCunUniform")return new Ue;var C={};return C.className=G,C.config={},Zn(C)}return Q instanceof ye?Q:Zn(Q)}var vr=Object.freeze({zeros:function(){return new _e},ones:function(){return new et},constant:function(Q){return new gt(Q)},randomUniform:function(Q){return new Rt(Q)},randomNormal:function(Q){return new fn(Q)},truncatedNormal:function(Q){return new Jn(Q)},identity:function(Q){return new An(Q)},varianceScaling:function(Q){return new Ln(Q)},glorotUniform:function(Q){return new qn(Q)},glorotNormal:function(Q){return new Nt(Q)},heNormal:function(Q){return new Ot(Q)},heUniform:function(Q){return new pn(Q)},leCunNormal:function(Q){return new Ht(Q)},leCunUniform:function(Q){return new Ue(Q)},orthogonal:function(Q){return new Mn(Q)}}),pi=0;function fo(){return pi++}var ui={};function Zi(Q){return Q===void 0&&(Q=""),Q in ui||(ui[Q]=0),ui[Q]+=1,Q+ui[Q].toString()}function Ti(Q){return Array.isArray(Q)&&Array.isArray(Q[0])}function qr(Q){return Q.length===0?[]:Array.isArray(Q[0])?Q:[Q]}function jr(Q){var G;if(Array.isArray(Q)){if(Q.length!==1)throw new ee("Expected Tensor length to be 1; got "+Q.length);G=Q[0]}else G=Q;return G}function jn(Q){if(Array.isArray(Q)&&Array.isArray(Q[0])){if(Q.length===1)return(Q=Q)[0];throw new ee("Expected exactly 1 Shape; got "+Q.length)}return Q}function ri(Q){for(var G=0,C=0,N=Q;C<N.length;C++){var te=N[C];te.shape.length===0?G+=1:G+=te.shape.reduce(function(Be,Ge){return Be*Ge})}return G}var Vi="Variable",Rr=function(){function Q(G,C,N,te,Be){C===void 0&&(C="float32"),N===void 0&&(N=Vi),te===void 0&&(te=!0),Be===void 0&&(Be=null),this.dtype=C??"float32",this.shape=G.shape,this.id=fo(),N=N??Vi,this.originalName=Dr(N),this.name=pr(this.originalName),this.trainable_=te,this.constraint=Be,this.val=Object(b.variable)(G,this.trainable_,this.name,this.dtype)}return Q.prototype.read=function(){return this.assertNotDisposed(),this.val},Q.prototype.write=function(G){return this.assertNotDisposed(),function(C,N){if(C.shape.toString()!==N.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(C.shape)+" vs. "+JSON.stringify(N.shape))}(this.val,G),this.val.id!==G.id&&(this.val.assign(G),this.constraint!=null&&this.val.assign(this.constraint.apply(this.val))),this},Q.prototype.dispose=function(){this.assertNotDisposed(),this.val.dispose()},Q.prototype.assertNotDisposed=function(){if(this.val.isDisposed)throw new Error("LayersVariable "+this.name+" is already disposed.")},Object.defineProperty(Q.prototype,"trainable",{get:function(){return this.trainable_},set:function(G){this.trainable_=G,this.val.trainable=G},enumerable:!0,configurable:!0}),Q}();function ao(Q){return Q.map(function(G){return G.read()})}function yo(Q){Q.forEach(function(G){G[0].write(G[1])})}var eo=function(Q){this.dtype=Q.dtype,this.shape=Q.shape,Q.shape!=null?this.ndim=Q.shape.length:this.ndim=Q.ndim,this.maxNDim=Q.maxNDim,this.minNDim=Q.minNDim,this.axes=Q.axes||{}},bo=function(Q,G,C,N,te,Be,Ge){this.dtype=Q,this.shape=G,this.sourceLayer=C,this.inputs=N,this.callArgs=te,this.outputTensorIndex=Ge,this.id=fo(),Be!=null&&(this.originalName=Dr(Be),this.name=pr(this.originalName)),this.rank=G.length},Na=0,vs=function(){function Q(G,C){this.callArgs=C,this.id=Na++,this.outboundLayer=G.outboundLayer,this.inboundLayers=G.inboundLayers,this.nodeIndices=G.nodeIndices,this.tensorIndices=G.tensorIndices,this.inputTensors=G.inputTensors,this.outputTensors=G.outputTensors,this.inputMasks=G.inputMasks,this.outputMasks=G.outputMasks,this.inputShapes=G.inputShapes,this.outputShapes=G.outputShapes;for(var N=0,te=G.inboundLayers;N<te.length;N++){var Be=te[N];Be!=null&&Be.outboundNodes.push(this)}G.outboundLayer.inboundNodes.push(this)}return Q.prototype.getConfig=function(){for(var G=[],C=0,N=this.inboundLayers;C<N.length;C++){var te=N[C];te!=null?G.push(te.name):G.push(null)}return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:G,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}},Q}(),Eh=0,qi=function(Q){function G(C){var N=Q.call(this)||this;N._callHook=null,N._addedWeightNames=[],N._stateful=!1,N.id=Eh++,N.activityRegularizer=null,N.inputSpec=null,N.supportsMasking=!1,N._trainableWeights=[],N._nonTrainableWeights=[],N._losses=[],N._updates=[],N._built=!1,N.inboundNodes=[],N.outboundNodes=[];var te=C.name;if(!te){var Be=N.getClassName();te=Te(Be)+"_"+Zi(Be)}if(N.name=te,N.trainable_=C.trainable==null||C.trainable,C.inputShape!=null||C.batchInputShape!=null){var Ge=void 0;if(C.batchInputShape!=null)Ge=C.batchInputShape;else if(C.inputShape!=null){var ft=null;C.batchSize!=null&&(ft=C.batchSize),Ge=[ft].concat(C.inputShape)}N.batchInputShape=Ge;var Tt=C.dtype;Tt==null&&(Tt=C.inputDType),Tt==null&&(Tt="float32"),N.dtype=Tt}return C.weights!=null?N.initialWeights=C.weights:N.initialWeights=null,N._refCount=null,N.fastWeightInitDuringBuild=!1,N}return U(G,Q),G.nodeKey=function(C,N){return C.name+"_ib-"+N.toString()},G.prototype.getNodeAtIndex=function(C,N){if(this.inboundNodes.length===0)throw new P("The layer has never been called and thus has no defined "+N+".");if(this.inboundNodes.length<=C)throw new ee("Asked to get "+N+" at node "+C+", but the layer has only "+this.inboundNodes.length+" inbound nodes.");return this.inboundNodes[C]},G.prototype.getInputAt=function(C){return pe(this.getNodeAtIndex(C,"input").inputTensors)},G.prototype.getOutputAt=function(C){return pe(this.getNodeAtIndex(C,"output").outputTensors)},Object.defineProperty(G.prototype,"input",{get:function(){if(this.inboundNodes.length>1)throw new q("Layer "+this.name+' has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use `getInputAt(nodeIndex)` instead.');if(this.inboundNodes.length===0)throw new q("Layer "+this.name+" is not connected, no input to return.");return pe(this.getNodeAtIndex(0,"input").inputTensors)},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"output",{get:function(){if(this.inboundNodes.length===0)throw new q("Layer "+this.name+" has no inbound nodes.");if(this.inboundNodes.length>1)throw new q("Layer "+this.name+' has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use `getOutputAt(nodeIndex)` instead.');return pe(this.getNodeAtIndex(0,"output").outputTensors)},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"losses",{get:function(){return this._losses},enumerable:!0,configurable:!0}),G.prototype.calculateLosses=function(){return this.losses.map(function(C){return C()})},Object.defineProperty(G.prototype,"updates",{get:function(){return this._updates},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"built",{get:function(){return this._built},set:function(C){this._built=C},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"trainable",{get:function(){return this.trainable_},set:function(C){this._trainableWeights.forEach(function(N){return N.trainable=C}),this.trainable_=C},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"trainableWeights",{get:function(){return this.trainable_?this._trainableWeights.filter(function(C){return C.trainable}):[]},set:function(C){this._trainableWeights=C},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"nonTrainableWeights",{get:function(){return this.trainable?this._trainableWeights.filter(function(C){return!C.trainable}).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)},set:function(C){this._nonTrainableWeights=C},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"weights",{get:function(){return this.trainableWeights.concat(this.nonTrainableWeights)},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"stateful",{get:function(){return this._stateful},enumerable:!0,configurable:!0}),G.prototype.resetStates=function(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")},G.prototype.assertInputCompatibility=function(C){if(C=Ae(C),this.inputSpec!=null&&this.inputSpec.length!==0){var N=Ae(this.inputSpec);if(C.length!==N.length)throw new ee("Layer "+this.name+" expects "+N.length+" inputs, but it received "+C.length+" input tensors. Input received: "+C);for(var te=0;te<C.length;te++){var Be=C[te],Ge=N[te];if(Ge!=null){var ft=Be.rank;if(Ge.ndim!=null&&ft!==Ge.ndim)throw new ee("Input "+te+" is incompatible with layer "+this.name+": expected ndim="+Ge.ndim+", found ndim="+ft);if(Ge.maxNDim!=null&&ft>Ge.maxNDim)throw new ee("Input "+te+" is incompatible with layer "+this.name+": expected max_ndim="+Ge.maxNDim+", found ndim="+ft);if(Ge.minNDim!=null&&ft<Ge.minNDim)throw new ee("Input "+te+" is incompatible with layer "+this.name+": expected min_ndim="+Ge.minNDim+", found ndim="+ft+".");if(Ge.dtype!=null&&Be.dtype!==Ge.dtype)throw new ee("Input "+te+" is incompatible with layer "+this.name+" : expected dtype="+Ge.dtype+", found dtype="+Be.dtype+".");if(Ge.axes){var Tt=Be.shape;for(var Wt in Ge.axes){var ct=Number(Wt),bn=Ge.axes[Wt],Sn=ct>=0?Tt[ct]:Tt[Tt.length+ct];if(bn!=null&&[bn,null].indexOf(Sn)===-1)throw new ee("Input "+te+" is incompatible with layer "+this.name+": expected axis "+ct+" of input shape to have value "+bn+" but got shape "+Tt+".")}}if(Ge.shape!=null)for(var Nn=0;Nn<Ge.shape.length;++Nn){var Wn=Ge.shape[Nn],Rn=Be.shape[Nn];if(Wn!=null&&Rn!=null&&Wn!==Rn)throw new ee("Input "+te+" is incompatible with layer "+this.name+": expected shape="+Ge.shape+", found shape="+Be.shape+".")}}}}},G.prototype.call=function(C,N){return C},G.prototype.invokeCallHook=function(C,N){this._callHook!=null&&this._callHook(C,N)},G.prototype.setCallHook=function(C){this._callHook=C},G.prototype.clearCallHook=function(){this._callHook=null},G.prototype.apply=function(C,N){var te=this;N=N||{},this.assertNotDisposed();for(var Be=Ae(C),Ge=!0,ft=0,Tt=Be;ft<Tt.length;ft++)if(!(Tt[ft]instanceof bo)){Ge=!1;break}for(var Wt=!0,ct=0,bn=Be;ct<bn.length;ct++)if(bn[ct]instanceof bo){Wt=!1;break}if(Ge===Wt)throw new ee("Arguments to apply() must be all SymbolicTensors or all Tensors");return Yn(this.name,function(){if(!te.built){te.assertInputCompatibility(C);for(var Sn=[],Nn=0,Wn=Ae(C);Nn<Wn.length;Nn++){var Rn=Wn[Nn];Sn.push(Rn.shape)}te.build(pe(Sn)),te.built=!0,te.initialWeights&&te.setWeights(te.initialWeights),te._refCount===null&&Wt&&(te._refCount=1)}if(te.assertInputCompatibility(C),Wt){for(var tr=[],rr=0,dr=Ae($r=te.call(C,N));rr<dr.length;rr++){var Tr=dr[rr];Be.indexOf(Tr)!==-1&&(Tr=Tr.clone()),tr.push(Tr)}if($r=pe(tr),te.activityRegularizer!=null)throw new I("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return $r}var Vr=function(ai){for(var li=[],Hr=0,ni=ai=Ae(ai);Hr<ni.length;Hr++){var to=ni[Hr];li.push(to.shape)}return pe(li)}(C),xr=te.computeOutputShape(Vr),$r=void 0,Wr="float32";if(te.warnOnIncompatibleInputShape(Array.isArray(C)?Vr[0]:Vr),$r=xr!=null&&xr.length>0&&Array.isArray(xr[0])?xr.map(function(ai,li){return new bo(Wr,ai,te,Ae(C),N,te.name,li)}):new bo(Wr,xr,te,Ae(C),N,te.name),te.addInboundNode(C,$r,null,null,Vr,xr,N),te._refCount++,te.activityRegularizer!=null)throw new I("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return $r})},G.prototype.warnOnIncompatibleInputShape=function(C){if(this.batchInputShape!=null)if(C.length!==this.batchInputShape.length)console.warn("The rank of the input tensor provided (shape: "+JSON.stringify(C)+") does not match that of the batchInputShape ("+JSON.stringify(this.batchInputShape)+") of the layer "+this.name);else{var N=!1;this.batchInputShape.forEach(function(te,Be){te!=null&&C[Be]!=null&&C[Be]!==te&&(N=!0)}),N&&console.warn("The shape of the input tensor ("+JSON.stringify(C)+") does not match the expectation of layer "+this.name+": "+JSON.stringify(this.batchInputShape))}},Object.defineProperty(G.prototype,"outputShape",{get:function(){if(this.inboundNodes==null||this.inboundNodes.length===0)throw new q("The layer "+this.name+" has never been called and thus has no defined output shape.");for(var C=[],N=0,te=this.inboundNodes;N<te.length;N++){var Be=te[N],Ge=JSON.stringify(Be.outputShapes);C.indexOf(Ge)===-1&&C.push(Ge)}if(C.length===1){var ft=this.inboundNodes[0].outputShapes;return Array.isArray(ft)&&Array.isArray(ft[0])&&ft.length===1?ft[0]:ft}throw new q("The layer "+this.name+' has multiple inbound nodes with different output shapes. Hence the notion of "outut shape" is ill-defined for the layer.')},enumerable:!0,configurable:!0}),G.prototype.countParams=function(){if(!this.built)throw new P("You tried to call countParams() on "+this.name+", but the layer is not built yet. Build it first by calling build(batchInputShape).");return ri(this.weights)},G.prototype.build=function(C){this.built=!0},G.prototype.getWeights=function(C){return C===void 0&&(C=!1),ao(C?this.trainableWeights:this.weights)},G.prototype.setWeights=function(C){var N=this;Object(b.tidy)(function(){var te=N.weights;if(te.length!==C.length)throw new ee('You called setWeights(weights) on layer "'+N.name+'" with a weight list of length '+C.length+", but the layer was expecting "+te.length+" weights. Provided weights: "+C+"...");if(te.length!==0){for(var Be=[],Ge=ao(te),ft=0;ft<Ge.length;++ft){var Tt=Ge[ft],Wt=te[ft],ct=C[ft];if(!b.util.arraysEqual(Tt.shape,ct.shape))throw new ee("Layer weight shape "+Tt.shape+" not compatible with provided weight shape "+ct.shape);Be.push([Wt,ct])}yo(Be)}})},G.prototype.addWeight=function(C,N,te,Be,Ge,ft,Tt){if(this._addedWeightNames.indexOf(C)!==-1)throw new ee("Duplicate weight name "+C+" for layer "+this.name);this._addedWeightNames.push(C),te==null&&(te="float32"),this.fastWeightInitDuringBuild&&(Be=zr("zeros"));var Wt=Be.apply(N,te),ct=new Rr(Wt,te,C,ft,Tt);return Wt.dispose(),Ge!=null&&this.addLoss(function(){return Ge.apply(ct.read())}),ft==null&&(ft=!0),ft?this._trainableWeights.push(ct):this._nonTrainableWeights.push(ct),ct},G.prototype.setFastWeightInitDuringBuild=function(C){this.fastWeightInitDuringBuild=C},G.prototype.addLoss=function(C){var N;C==null||Array.isArray(C)&&C.length===0||(C=Ae(C),this._losses!==void 0&&this._losses!==null&&(N=this.losses).push.apply(N,C))},G.prototype.computeOutputShape=function(C){return C},G.prototype.computeMask=function(C,N){var te=this;if(!this.supportsMasking){if(N!=null){if(!Array.isArray(N))throw new TypeError("Layer "+this.name+" does not support masking, but was passed an inputMask.");N.forEach(function(Be){if(Be!=null)throw new TypeError("Layer "+te.name+" does not support masking, but was passed an inputMask.")})}return null}return N},G.prototype.addInboundNode=function(C,N,te,Be,Ge,ft,Tt){Tt===void 0&&(Tt=null);var Wt=Ae(C);N=Ae(N),te=Ae(te),Be=Ae(Be),Ge=qr(Ge),ft=qr(ft);for(var ct=[],bn=[],Sn=[],Nn=0,Wn=Wt;Nn<Wn.length;Nn++){var Rn=Wn[Nn];ct.push(Rn.sourceLayer),bn.push(Rn.nodeIndex),Sn.push(Rn.tensorIndex)}new vs({outboundLayer:this,inboundLayers:ct,nodeIndices:bn,tensorIndices:Sn,inputTensors:Wt,outputTensors:N,inputMasks:te,outputMasks:Be,inputShapes:Ge,outputShapes:ft},Tt);for(var tr=0;tr<N.length;tr++)N[tr].sourceLayer=this,N[tr].nodeIndex=this.inboundNodes.length-1,N[tr].tensorIndex=tr},G.prototype.getConfig=function(){var C={name:this.name,trainable:this.trainable};return this.batchInputShape!=null&&(C.batchInputShape=this.batchInputShape),this.dtype!=null&&(C.dtype=this.dtype),C},G.prototype.disposeWeights=function(){return this.weights.forEach(function(C){return C.dispose()}),this.weights.length},G.prototype.assertNotDisposed=function(){if(this._refCount===0)throw new Error("Layer '"+this.name+"' is already disposed.")},G.prototype.dispose=function(){if(!this.built)throw new Error("Cannot dispose Layer "+this.name+" because it has not been built yet.");if(this._refCount===null)throw new Error("Cannot dispose Layer "+this.name+" because it has not been used yet.");this.assertNotDisposed();var C=0;return--this._refCount==0&&(C=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:C}},G}(b.serialization.Serializable),ec,bu=function(Q){function G(C){var N=Q.call(this,{dtype:C.dtype,name:C.name!=null?C.name:Zi("input").toString()})||this;if(C.batchSize==null&&(C.batchSize=null),C.sparse==null&&(C.sparse=!1),N.trainable=!1,N.built=!0,N.sparse=C.sparse,C.inputShape!=null&&C.batchInputShape!=null)throw new ee("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");var te=C.batchInputShape;if(te==null){if(C.inputShape==null)throw new ee("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");te=[C.batchSize].concat(C.inputShape)}else if(C.batchSize!=null)throw new ee("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");var Be=C.dtype||"float32";N.batchInputShape=te,N.dtype=Be,N.inputSpec=[{shape:te}];var Ge=new bo(N.dtype,N.batchInputShape,N,[],{},N.name);return Ge.nodeIndex=0,Ge.tensorIndex=0,new vs({outboundLayer:N,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[Ge],outputTensors:[Ge],inputMasks:[null],outputMasks:[null],inputShapes:[te],outputShapes:[te]}),N}return U(G,Q),G.prototype.apply=function(C,N){throw new ee("Cannot pass any input to an InputLayer's apply() method. InputLayer name: "+this.name)},G.prototype.dispose=function(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}},G.prototype.getConfig=function(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}},G.className="InputLayer",G}(qi);function bc(Q){if(Q.batchShape==null&&Q.shape==null)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(Q.batchShape!=null&&Q.shape!=null)throw new ee("Please provide either a `shape` or `batchShape` argument to Input, but not both.");var G=Q.batchShape;Q.shape!=null&&G==null&&(G=[null].concat(Q.shape));var C=Q.dtype;return C==null&&(C="float32"),new bu({batchInputShape:G,name:Q.name,dtype:C,sparse:Q.sparse}).inboundNodes[0].outputTensors[0]}function Bu(Q){return J(this,void 0,void 0,function(){var G,C,N,te,Be,Ge,ft,Tt;return R(this,function(Wt){switch(Wt.label){case 0:if(Q==null)return[2];for(te in G=[],C=[],N=[],Q)typeof(Be=Q[te])!="number"&&(Ge=Be,G.push(Ge.data()),C.push(te),N.push(Ge));return G.length>0?[4,Promise.all(G)]:[3,2];case 1:for(ft=Wt.sent(),Tt=0;Tt<ft.length;++Tt)Q[C[Tt]]=ft[Tt][0];Object(b.dispose)(N),Wt.label=2;case 2:return[2]}})})}function xc(Q){if(Q!=null)for(var G in Q){var C=Q[G];typeof C!="number"&&C.dispose()}}b.serialization.registerClass(bu),function(Q){Q[Q.SILENT=0]="SILENT",Q[Q.VERBOSE=1]="VERBOSE"}(ec||(ec={}));var Dd=125,as=function(){function Q(){this.validationData=null}return Q.prototype.setParams=function(G){this.params=G},Q.prototype.onEpochBegin=function(G,C){return J(this,void 0,void 0,function(){return R(this,function(N){return[2]})})},Q.prototype.onEpochEnd=function(G,C){return J(this,void 0,void 0,function(){return R(this,function(N){return[2]})})},Q.prototype.onBatchBegin=function(G,C){return J(this,void 0,void 0,function(){return R(this,function(N){return[2]})})},Q.prototype.onBatchEnd=function(G,C){return J(this,void 0,void 0,function(){return R(this,function(N){return[2]})})},Q.prototype.onTrainBegin=function(G){return J(this,void 0,void 0,function(){return R(this,function(C){return[2]})})},Q.prototype.onTrainEnd=function(G){return J(this,void 0,void 0,function(){return R(this,function(C){return[2]})})},Q.prototype.setModel=function(G){},Q}(),vf=function(){function Q(G,C){C===void 0&&(C=10),G==null&&(G=[]),this.callbacks=G,this.queueLength=C}return Q.prototype.append=function(G){this.callbacks.push(G)},Q.prototype.setParams=function(G){for(var C=0,N=this.callbacks;C<N.length;C++)N[C].setParams(G)},Q.prototype.setModel=function(G){for(var C=0,N=this.callbacks;C<N.length;C++)N[C].setModel(G)},Q.prototype.onEpochBegin=function(G,C){return J(this,void 0,void 0,function(){var N,te;return R(this,function(Be){switch(Be.label){case 0:C==null&&(C={}),N=0,te=this.callbacks,Be.label=1;case 1:return N<te.length?[4,te[N].onEpochBegin(G,C)]:[3,4];case 2:Be.sent(),Be.label=3;case 3:return N++,[3,1];case 4:return[2]}})})},Q.prototype.onEpochEnd=function(G,C){return J(this,void 0,void 0,function(){var N,te;return R(this,function(Be){switch(Be.label){case 0:C==null&&(C={}),N=0,te=this.callbacks,Be.label=1;case 1:return N<te.length?[4,te[N].onEpochEnd(G,C)]:[3,4];case 2:Be.sent(),Be.label=3;case 3:return N++,[3,1];case 4:return[2]}})})},Q.prototype.onBatchBegin=function(G,C){return J(this,void 0,void 0,function(){var N,te;return R(this,function(Be){switch(Be.label){case 0:C==null&&(C={}),N=0,te=this.callbacks,Be.label=1;case 1:return N<te.length?[4,te[N].onBatchBegin(G,C)]:[3,4];case 2:Be.sent(),Be.label=3;case 3:return N++,[3,1];case 4:return[2]}})})},Q.prototype.onBatchEnd=function(G,C){return J(this,void 0,void 0,function(){var N,te;return R(this,function(Be){switch(Be.label){case 0:C==null&&(C={}),N=0,te=this.callbacks,Be.label=1;case 1:return N<te.length?[4,te[N].onBatchEnd(G,C)]:[3,4];case 2:Be.sent(),Be.label=3;case 3:return N++,[3,1];case 4:return[2]}})})},Q.prototype.onTrainBegin=function(G){return J(this,void 0,void 0,function(){var C,N;return R(this,function(te){switch(te.label){case 0:G==null&&(G={}),C=0,N=this.callbacks,te.label=1;case 1:return C<N.length?[4,N[C].onTrainBegin(G)]:[3,4];case 2:te.sent(),te.label=3;case 3:return C++,[3,1];case 4:return[2]}})})},Q.prototype.onTrainEnd=function(G){return J(this,void 0,void 0,function(){var C,N;return R(this,function(te){switch(te.label){case 0:G==null&&(G={}),C=0,N=this.callbacks,te.label=1;case 1:return C<N.length?[4,N[C].onTrainEnd(G)]:[3,4];case 2:te.sent(),te.label=3;case 3:return C++,[3,1];case 4:return[2]}})})},Q}(),Td=function(Q){function G(){return Q.call(this)||this}return U(G,Q),G.prototype.onEpochBegin=function(C){return J(this,void 0,void 0,function(){return R(this,function(N){return this.seen=0,this.totals={},[2]})})},G.prototype.onBatchEnd=function(C,N){return J(this,void 0,void 0,function(){var te,Be,Ge,ft,Tt=this;return R(this,function(Wt){for(ft in N==null&&(N={}),te=N.size==null?0:N.size,this.seen+=te,Be=function(ct){var bn=N[ct];if(typeof bn=="number")Ge.totals.hasOwnProperty(ct)||(Ge.totals[ct]=0),Ge.totals[ct]=Ge.totals[ct]+bn*te;else{var Sn=void 0;ct in Ge.totals?Sn=Ge.totals[ct]:Ge.totals[ct]=0;var Nn=Object(b.tidy)(function(){return Object(b.add)(Tt.totals[ct],Object(b.mul)(bn,te))});Ge.totals[ct]=Nn,Sn!=null&&Sn.dispose()}},Ge=this,N)Be(ft);return[2]})})},G.prototype.onEpochEnd=function(C,N){return J(this,void 0,void 0,function(){var te,Be,Ge,ft,Tt,Wt=this;return R(this,function(ct){if(N!=null)for(te=function(bn){if(Be.totals[bn]==null)return"continue";typeof Be.totals[bn]=="number"?N[bn]=Be.totals[bn]/Be.seen:Object(b.tidy)(function(){var Sn=Object(b.mul)(Object(b.div)(1,Wt.seen),Wt.totals[bn]);N[bn]=Sn,Wt.totals[bn].dispose(),Object(b.keep)(N[bn])})},Be=this,Ge=0,ft=this.params.metrics;Ge<ft.length;Ge++)Tt=ft[Ge],te(Tt);return[2]})})},G}(as),Pu=function(Q){function G(){return Q!==null&&Q.apply(this,arguments)||this}return U(G,Q),G.prototype.onTrainBegin=function(C){return J(this,void 0,void 0,function(){return R(this,function(N){return this.epoch=[],this.history={},[2]})})},G.prototype.onEpochEnd=function(C,N){return J(this,void 0,void 0,function(){var te;return R(this,function(Be){for(te in N==null&&(N={}),this.epoch.push(C),N)this.history[te]==null&&(this.history[te]=[]),this.history[te].push(N[te]);return[2]})})},G.prototype.syncData=function(){return J(this,void 0,void 0,function(){var C,N,te,Be,Ge,ft,Tt,Wt,ct;return R(this,function(bn){switch(bn.label){case 0:for(Be in C=[],N=[],te=[],this.history)for(Ge=this.history[Be],ft=0;ft<Ge.length;++ft)typeof Ge[ft]!="number"&&(Tt=Ge[ft],C.push(Tt.data()),N.push(Be),te.push(ft));return[4,Promise.all(C)];case 1:for(Wt=bn.sent(),ct=0;ct<Wt.length;++ct)this.history[N[ct]][te[ct]].dispose(),this.history[N[ct]][te[ct]]=Wt[ct][0];return[2]}})})},G}(as),yf=function(Q){function G(C,N){var te=Q.call(this)||this;if(te.currentEpoch=0,te.yieldEvery=N||"auto",te.yieldEvery==="auto"&&(te.yieldEvery=Dd),te.yieldEvery==="never"&&C.onYield!=null)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");return b.util.isNumber(te.yieldEvery)&&(te.maybeWait=function(Be,Ge){var ft,Tt=b.util.now();return function(){for(var Wt=[],ct=0;ct<arguments.length;ct++)Wt[ct]=arguments[ct];var bn=b.util.now();return bn-Tt<Ge?ft:(Tt=bn,ft=Be.apply(void 0,Wt))}}(te.maybeWait.bind(te),te.yieldEvery)),te.trainBegin=C.onTrainBegin,te.trainEnd=C.onTrainEnd,te.epochBegin=C.onEpochBegin,te.epochEnd=C.onEpochEnd,te.batchBegin=C.onBatchBegin,te.batchEnd=C.onBatchEnd,te.yield=C.onYield,te}return U(G,Q),G.prototype.maybeWait=function(C,N,te){return J(this,void 0,void 0,function(){var Be;return R(this,function(Ge){switch(Ge.label){case 0:return Be=[],this.yield==null?[3,2]:[4,Bu(te)];case 1:Ge.sent(),Be.push(this.yield(C,N,te)),Ge.label=2;case 2:return Be.push(Object(b.nextFrame)()),[4,Promise.all(Be)];case 3:return Ge.sent(),[2]}})})},G.prototype.onEpochBegin=function(C,N){return J(this,void 0,void 0,function(){return R(this,function(te){switch(te.label){case 0:return this.currentEpoch=C,this.epochBegin==null?[3,3]:[4,Bu(N)];case 1:return te.sent(),[4,this.epochBegin(C,N)];case 2:te.sent(),te.label=3;case 3:return[2]}})})},G.prototype.onEpochEnd=function(C,N){return J(this,void 0,void 0,function(){var te;return R(this,function(Be){switch(Be.label){case 0:return te=[],this.epochEnd==null?[3,2]:[4,Bu(N)];case 1:Be.sent(),te.push(this.epochEnd(C,N)),Be.label=2;case 2:return this.yieldEvery==="epoch"&&te.push(Object(b.nextFrame)()),[4,Promise.all(te)];case 3:return Be.sent(),[2]}})})},G.prototype.onBatchBegin=function(C,N){return J(this,void 0,void 0,function(){return R(this,function(te){switch(te.label){case 0:return this.batchBegin==null?[3,3]:[4,Bu(N)];case 1:return te.sent(),[4,this.batchBegin(C,N)];case 2:te.sent(),te.label=3;case 3:return[2]}})})},G.prototype.onBatchEnd=function(C,N){return J(this,void 0,void 0,function(){var te;return R(this,function(Be){switch(Be.label){case 0:return te=[],this.batchEnd==null?[3,2]:[4,Bu(N)];case 1:Be.sent(),te.push(this.batchEnd(C,N)),Be.label=2;case 2:return this.yieldEvery==="batch"?te.push(Object(b.nextFrame)()):b.util.isNumber(this.yieldEvery)&&te.push(this.maybeWait(this.currentEpoch,C,N)),[4,Promise.all(te)];case 3:return Be.sent(),[2]}})})},G.prototype.onTrainBegin=function(C){return J(this,void 0,void 0,function(){return R(this,function(N){switch(N.label){case 0:return this.trainBegin==null?[3,3]:[4,Bu(C)];case 1:return N.sent(),[4,this.trainBegin(C)];case 2:N.sent(),N.label=3;case 3:return[2]}})})},G.prototype.onTrainEnd=function(C){return J(this,void 0,void 0,function(){return R(this,function(N){switch(N.label){case 0:return this.trainEnd==null?[3,3]:[4,Bu(C)];case 1:return N.sent(),[4,this.trainEnd(C)];case 2:N.sent(),N.label=3;case 3:return[2]}})})},G}(as);function Ch(Q,G){return Q==null&&(Q={}),Q instanceof as?[Q]:Array.isArray(Q)&&Q[0]instanceof as?Q:Ae(Q).map(function(C){return new yf(C,G)})}var wc=function(){function Q(){}return Q.registerCallbackConstructor=function(G,C){b.util.assert(G>=0&&Number.isInteger(G),function(){return"Verbosity level is expected to be an integer >= 0, but got "+G}),Q.checkForDuplicate(C),Q.constructors[G]==null&&(Q.constructors[G]=[]),Q.constructors[G].push(C)},Q.checkForDuplicate=function(G){for(var C in Q.constructors)Q.constructors[+C].forEach(function(N){if(N===G)throw new ee("Duplicate callback constructor.")})},Q.clear=function(){Q.constructors={}},Q.createCallbacks=function(G){var C=[];for(var N in Q.constructors){var te=+N;G>=te&&C.push.apply(C,Q.constructors[te])}return C.map(function(Be){return new Be})},Q.constructors={},Q}();function El(Q,G,C,N,te,Be,Ge,ft,Tt){var Wt=new Pu,ct=[new Td].concat(wc.createCallbacks(G));Q!=null&&ct.push.apply(ct,Q),ct.push(Wt);var bn=new vf(ct);return bn.setParams({epochs:C,initialEpoch:N,samples:te,steps:Be,batchSize:Ge,verbose:G,doValidation:ft,metrics:Tt}),{callbackList:bn,history:Wt}}function Fa(Q,G,C){return G===void 0&&(G={}),C===void 0&&(C=!1),_t(Q,b.serialization.SerializationMap.getMap().classNameMap,G,"layer",C)}function Vc(Q,G){return Object(b.tidy)(function(){Q.dtype!=="float32"&&(Q=Q.asType("float32"));var C=Object(b.sum)(Wi(Q),G,!0),N=Object(b.fill)(C.shape,W()),te=Object(b.sqrt)(Object(b.maximum)(C,N));return Object(b.div)(Q,te)})}function ua(Q,G){return Object(b.tidy)(function(){return Object(b.mean)(Wi(Object(b.sub)(G,Q)),-1)})}function tc(Q,G){return Object(b.tidy)(function(){return Object(b.mean)(Object(b.abs)(Object(b.sub)(G,Q)),-1)})}function ss(Q,G){return Object(b.tidy)(function(){var C=Object(b.sub)(Q,G),N=Object(b.clipByValue)(Object(b.abs)(Q),W(),Number.MAX_VALUE),te=Object(b.abs)(Object(b.div)(C,N));return Object(b.mul)(100,Object(b.mean)(te,-1))})}function Ca(Q,G,C){return C===void 0&&(C=!1),Object(b.tidy)(function(){if(C)G=Object(b.softmax)(G);else{var N=Object(b.sum)(G,G.shape.length-1,!0);G=Object(b.div)(G,N)}return G=Object(b.clipByValue)(G,W(),1-W()),Object(b.neg)(Object(b.sum)(Object(b.mul)(Q.toFloat(),Object(b.log)(G)),G.shape.length-1))})}function nc(Q,G){return Object(b.tidy)(function(){var C=Object(b.floor)(function(te){var Be=[Kt(te.shape)];return te.reshape(Be)}(Q)).toInt(),N=(G=Object(b.clipByValue)(G,W(),1-W())).shape;return Ca(Object(b.oneHot)(C,N[N.length-1]).reshape(N),G,!1)})}function Cl(Q,G){return Object(b.tidy)(function(){var C;return C=Object(b.clipByValue)(G,W(),1-W()),C=Object(b.log)(Object(b.div)(C,Object(b.sub)(1,C))),Object(b.mean)(function(N,te){if(!b.util.arraysEqual(N.shape,te.shape))throw new ee("logits and labels must have the same shape, but got shapes "+JSON.stringify(N.shape)+" and "+JSON.stringify(te.shape));return Object(b.tidy)(function(){var Be=te.relu(),Ge=te.abs().neg();return Be.sub(te.mul(N)).add(Ge.exp().log1p())})}(Q,C),-1)})}function rc(Q,G){return Object(b.tidy)(function(){var C=Vc(Q,-1),N=Vc(G,-1),te=Object(b.mul)(C,N);return Object(b.neg)(Object(b.sum)(te,-1))})}var cu={meanSquaredError:ua,meanAbsoluteError:tc,meanAbsolutePercentageError:ss,meanSquaredLogarithmicError:function(Q,G){return Object(b.tidy)(function(){var C=Object(b.clipByValue)(G,W(),Number.MAX_VALUE),N=Object(b.log)(Object(b.add)(1,C)),te=Object(b.clipByValue)(Q,W(),Number.MAX_VALUE),Be=Object(b.log)(Object(b.add)(1,te));return Object(b.mean)(Wi(Object(b.sub)(N,Be)),-1)})},squaredHinge:function(Q,G){return Object(b.tidy)(function(){var C=Object(b.maximum)(0,Object(b.sub)(1,Object(b.mul)(Q,G)));return Object(b.mean)(Wi(C),-1)})},hinge:function(Q,G){return Object(b.tidy)(function(){var C=Object(b.maximum)(0,Object(b.sub)(1,Object(b.mul)(Q,G)));return Object(b.mean)(C,-1)})},categoricalHinge:function(Q,G){return Object(b.tidy)(function(){var C=Object(b.sum)(Object(b.mul)(Q,G),-1),N=Object(b.max)(Object(b.mul)(Object(b.sub)(1,Q),G),-1);return Object(b.maximum)(0,Object(b.add)(1,Object(b.sub)(N,C)))})},logcosh:function(Q,G){return Object(b.tidy)(function(){var C=Math.log(2),N=Object(b.sub)(G,Q),te=Object(b.sub)(Object(b.add)(N,Object(b.softplus)(Object(b.mul)(-2,N))),C);return Object(b.mean)(te,-1)})},categoricalCrossentropy:Ca,sparseCategoricalCrossentropy:nc,binaryCrossentropy:Cl,kullbackLeiblerDivergence:function(Q,G){return Object(b.tidy)(function(){var C=Object(b.clipByValue)(Q,W(),1),N=Object(b.clipByValue)(G,W(),1);return Object(b.sum)(Object(b.mul)(Q,Object(b.log)(Object(b.div)(C,N))),-1)})},poisson:function(Q,G){return Object(b.tidy)(function(){var C=Object(b.log)(Object(b.add)(W(),G));return Object(b.mean)(Object(b.sub)(G,Object(b.mul)(Q,C)),-1)})},cosineProximity:rc};function Oh(Q){if(typeof Q=="string"){if(Q in cu)return cu[Q];var G="Unknown loss "+Q;throw Q.toLowerCase().includes("softmaxcrossentropy")&&(G="Unknown loss "+Q+'. Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy'),new ee(G)}return Q}function bf(Q,G){return Object(b.tidy)(function(){var C=Object(b.mul)(.5,Object(b.onesLike)(G)),N=wr(Object(b.greater)(G,C),Q.dtype);return Object(b.mean)(Object(b.equal)(Q,N),-1)})}function xf(Q,G){return Object(b.tidy)(function(){return wr(Object(b.equal)(Object(b.argMax)(Q,-1),Object(b.argMax)(G,-1)),"float32")})}function fa(Q,G){return Object(b.tidy)(function(){return Object(b.logicalAnd)(Q.equal(1),G.equal(1)).sum().cast("float32")})}function Ah(Q,G){return Object(b.tidy)(function(){var C=fa(Q,G),N=function(Be,Ge){return Object(b.tidy)(function(){return Object(b.logicalAnd)(Be.equal(0),Ge.equal(1)).sum().cast("float32")})}(Q,G),te=C.add(N);return Object(b.where)(Object(b.greater)(te,0),C.div(te),0).cast("float32")})}function Nd(Q,G){return Object(b.tidy)(function(){var C=fa(Q,G),N=function(Be,Ge){return Object(b.tidy)(function(){return Object(b.logicalAnd)(Be.equal(1),Ge.equal(0)).sum().cast("float32")})}(Q,G),te=C.add(N);return Object(b.where)(Object(b.greater)(te,0),C.div(te),0).cast("float32")})}function wf(Q,G){return Cl(Q,G)}function kf(Q,G){return Q.rank===G.rank&&(Q=Q.squeeze([Q.rank-1])),(G=G.argMax(-1)).dtype!==Q.dtype&&(G=G.asType(Q.dtype)),Object(b.equal)(Q,G).asType("float32")}var ys=Ca,Ef=nc,ar={binaryAccuracy:bf,categoricalAccuracy:xf,precision:Ah,categoricalCrossentropy:ys,sparseCategoricalCrossentropy:Ef,mse:ua,MSE:ua,mae:tc,MAE:tc,mape:ss,MAPE:ss,cosine:rc};function xu(Q){if(K(Q!==null,"Unknown LossOrMetricFn "+Q),typeof Q=="string")return Q;for(var G=void 0,C=0,N=Object.keys(cu);C<N.length;C++){var te=N[C];if(cu[te]===Q){G=te;break}}if(G!==void 0)return G;for(var Be=0,Ge=Object.keys(ar);Be<Ge.length;Be++)if(te=Ge[Be],ar[te]===Q){G=te;break}return G!==void 0?G:Q.name}var Tp=1048576;function Np(Q,G,C){if(C===void 0&&(C=!1),Q==null||typeof Q!="object"||Object.getPrototypeOf(Q)!==Object.prototype||!function te(Be){if(Be===null)return!0;if(typeof Be=="object"){if(Object.getPrototypeOf(Be)===Object.prototype){for(var Ge=0,ft=Object.keys(Be);Ge<ft.length;Ge++){var Tt=ft[Ge];if(typeof Tt!="string"||!te(Be[Tt]))return!1}return!0}if(Array.isArray(Be)){for(var Wt=0,ct=Be;Wt<ct.length;Wt++)if(!te(ct[Wt]))return!1;return!0}return!1}var bn=typeof Be;return bn==="string"||bn==="number"||bn==="boolean"}(Q))throw new Error("User-defined metadata is expected to be a JSON object, but is not.");if(C){var N=JSON.stringify(Q);N.length>Tp&&console.warn('User-defined metadata of model "'+G+'" is too large in size (length='+N.length+" when serialized). It is not recommended to store such large objects in user-defined metadata. Please make sure its serialized length is <= "+Tp+".")}}function Cf(Q,G,C,N){N===void 0&&(N=console.log);var te,Be=function(Sn){var Nn=!0,Wn=[],Rn=[];for(var tr in Sn.nodesByDepth)Wn.push(Sn.nodesByDepth[tr]);for(var rr=0,dr=Wn;rr<dr.length;rr++){var Tr=dr[rr];if(Tr.length>1||Tr.length===1&&Tr[0].inboundLayers.length>1){Nn=!1;break}Rn.push.apply(Rn,Tr)}if(Nn)for(var Vr=0,xr=Sn.layers;Vr<xr.length;Vr++){for(var $r=!1,Wr=0,ai=xr[Vr].inboundNodes;Wr<ai.length;Wr++){var li=ai[Wr];if(Rn.indexOf(li)!==-1){if($r){Nn=!1;break}$r=!0}}if(!Nn)break}return Nn}(Q),Ge=["Layer (type)","Output shape","Param #"];if(Be?(G=G||65,C=C||[.45,.85,1]):(G=G||98,C=C||[.33,.55,.67,1]),C[C.length-1]<=1&&(C=C.map(function(Sn){return Math.floor(G*Sn)})),!Be)for(var ft in Ge.push("Receives inputs"),te=[],Q.nodesByDepth)te.push.apply(te,Q.nodesByDepth[ft]);N("_".repeat(G)),Ol(Ge,C,N),N("=".repeat(G));for(var Tt=Q.layers,Wt=0;Wt<Tt.length;++Wt)Be?Fd(Tt[Wt],C,N):Sh(Tt[Wt],C,te,N),N((Wt===Tt.length-1?"=":"_").repeat(G));Q.checkTrainableWeightsConsistency();var ct=function(Sn){return Sn.collectedTrainableWeights!=null?ri(Sn.collectedTrainableWeights):ri(Sn.trainableWeights)}(Q),bn=ri(Q.nonTrainableWeights);N("Total params: "+(ct+bn)),N("Trainable params: "+ct),N("Non-trainable params: "+bn),N("_".repeat(G))}function Ol(Q,G,C){C===void 0&&(C=console.log);for(var N="",te=0;te<Q.length;++te)te>0&&(N=N.slice(0,N.length-1)+" "),N=(N+=Q[te]).slice(0,G[te]),N+=" ".repeat(G[te]-N.length);C(N)}function Fd(Q,G,C){var N;try{N=JSON.stringify(Q.outputShape)}catch{N="multiple"}Ol([Q.name+" ("+Q.getClassName()+")",N,Q.countParams().toString()],G,C)}function Sh(Q,G,C,N){var te;try{te=JSON.stringify(Q.outputShape)}catch{te="multiple"}for(var Be=[],Ge=0,ft=Q.inboundNodes;Ge<ft.length;Ge++){var Tt=ft[Ge];if(!(C!=null&&C.length>0&&C.indexOf(Tt)===-1))for(var Wt=0;Wt<Tt.inboundLayers.length;++Wt){var ct=Tt.inboundLayers[Wt].name,bn=Tt.nodeIndices[Wt],Sn=Tt.tensorIndices[Wt];Be.push(ct+"["+bn+"]["+Sn+"]")}}var Nn=Q.name,Wn=Q.getClassName(),Rn=Be.length===0?"":Be[0];for(Ol([Nn+" ("+Wn+")",te,Q.countParams().toString(),Rn],G,N),Wt=1;Wt<Be.length;++Wt)Ol(["","","",Be[Wt]],G,N)}function _h(Q,G,C){return(Q==="inboundNodes"||Q==="outputLayers"||Q==="inputLayers")&&G===0&&typeof C=="string"}function Ii(Q,G){if(Q===null)return null;if(typeof Q=="string")return je(Q);if(typeof Q=="number"||typeof Q=="boolean")return Q;if(Q instanceof Array){for(var C=[],N=Q.length,te=0;te<N;++te){var Be=Q[te];_h(G,te,Be)?C.push(Be):C.push(Ii(Be,G))}return C}for(var Ge={},ft=0,Tt=Object.keys(Q);ft<Tt.length;ft++){var Wt=Tt[ft],ct=Q[Wt];if(Wt==="name"&&typeof ct=="string")Ge[Wt]=ct;else{var bn=je(Wt);Ge[bn]=Ii(ct,bn)}}return Ge}var No=function(){function Q(G){if(this.id2Value={},this.id2Mask={},this.name2Id={},G instanceof Q)for(var C in G.id2Value)this.id2Value[C]=G.id2Value[C],C in G.id2Mask&&(this.id2Mask[C]=G.id2Mask[C]);else{if(G==null)return;for(var N=0,te=G;N<te.length;N++){var Be=te[N];this.add(Be.key,Be.value)}}}return Q.prototype.add=function(G,C,N){if(this.id2Value[G.id]!=null)throw new ee("Duplicate key: name="+G.name+", id="+G.id);return this.id2Value[G.id]=function(te,Be){if(te.dtype==null||te.dtype===Be.dtype)return Be;try{return Object(b.cast)(Be,te.dtype)}catch{throw new ee("The dtype of the feed ("+Be.dtype+") can not be cast to the dtype of the key '"+te.name+"' ("+te.dtype+").")}}(G,C),this.name2Id[G.name]=G.id,N!=null&&(this.id2Mask[G.id]=N),this},Q.prototype.addFeed=function(G){this.add(G.key,G.value)},Q.prototype.hasKey=function(G){return this.id2Value[G.id]!=null},Q.prototype.names=function(){return Object.keys(this.name2Id)},Q.prototype.getValue=function(G){if(G instanceof bo){if(this.id2Value[G.id]==null)throw new ee("Nonexistent key: "+G.name);return this.id2Value[G.id]}var C=this.name2Id[G];if(C==null)throw new ee("Feed dict has no SymbolicTensor name: "+G);return this.id2Value[C]},Q.prototype.getMask=function(G){if(G instanceof bo){if(this.id2Value[G.id]==null)throw new ee("Nonexistent key: "+G.name);return this.id2Mask[G.id]}var C=this.name2Id[G];if(C==null)throw new ee("Feed dict has no SymbolicTensor name: "+G);return this.id2Mask[C]},Q.prototype.disposeMasks=function(){this.id2Mask!=null&&Object(b.dispose)(this.id2Mask)},Q}(),Dh={},bm={};function Of(Q,G,C,N){for(var te=C!=null&&C.training,Be=Array.isArray(Q),Ge=Be?Q:[Q],ft=Ge.map(function(Di){return Di.name}),Tt=[],Wt=G.names(),ct=0,bn=ft;ct<bn.length;ct++){var Sn=bn[ct];Wt.indexOf(Sn)!==-1?Tt.push(G.getValue(Sn)):Tt.push(null)}N!=null&&(N.maxNumTensors=-1/0,N.minNumTensors=1/0);var Nn,Wn,Rn=ft.join(",")+"|"+G.names().join(",");if(Dh[Rn]==null){var tr=function(Di,mo){b.util.assert(Di!=null&&Di.length>0,function(){return"Expected at least one fetch, got none"});var la=[],ha={};if(Di.length===1){var aa=Id(Di[0],mo);la=aa.sorted,ha=aa.recipientMap}else for(var Qo=new Set,Za=0,da=Di;Za<da.length;Za++){for(var go=Id(da[Za],mo),wa=go.sorted,Su=go.recipientMap,fs=0,Ma=wa;fs<Ma.length;fs++){var Fo=Ma[fs];Qo.has(Fo.name)||(la.push(Fo),Qo.add(Fo.name))}var cc=function(Rs){ha[Rs]==null&&(ha[Rs]=new Set),Su[Rs].forEach(function(Zo){return ha[Rs].add(Zo)})};for(var Ks in Su)cc(Ks)}return{sorted:la,recipientCounts:function(Rs){var Zo={};for(var Ms in Rs)Zo[Ms]=Rs[Ms].size;return Zo}(ha)}}(Ge,G);Nn=tr.sorted,Wn=tr.recipientCounts,Dh[Rn]=Nn,bm[Rn]=Wn}Nn=Dh[Rn],Wn={},te||Object.assign(Wn,bm[Rn]);for(var rr=new No(G),dr=0;dr<Nn.length;++dr){if(N!=null){var Tr=Object(b.memory)().numTensors;Tr>N.maxNumTensors&&(N.maxNumTensors=Tr),Tr<N.minNumTensors&&(N.minNumTensors=Tr)}var Vr=Nn[dr],xr=Vr.sourceLayer;if(!(xr instanceof bu)){for(var $r=[],Wr=[],ai=[],li=!1,Hr=0,ni=Vr.inputs;Hr<ni.length;Hr++){var to=ni[Hr],Qi=rr.getValue(to),zo=rr.getMask(to);$r.push(Qi),Wr.push(zo),zo!=null&&(li=!0),te||(Wn[to.name]--,Wn[to.name]!==0||G.hasKey(to)||ft.indexOf(to.name)!==-1||Qi.isDisposed||to.sourceLayer.stateful===!0||ai.push(Qi))}li&&((C=C||{}).mask=Wr[0]);var ji=Ae(xr.apply($r,C)),no=null;xr.supportsMasking&&(no=xr.computeMask($r,Wr));for(var ia=bs(Vr),jo=Array.isArray(ia)?ia:[ia],Jo=0;Jo<jo.length;++Jo){rr.hasKey(jo[Jo])||rr.add(jo[Jo],ji[Jo],Array.isArray(no)?no[0]:no);var Fi=ft.indexOf(jo[Jo].name);Fi!==-1&&(Tt[Fi]=ji[Jo])}te||Object(b.dispose)(ai)}}return rr.disposeMasks(),Be?Tt:Tt[0]}function Id(Q,G){for(var C=new Set,N=[],te={},Be=0,Ge=G.names();Be<Ge.length;Be++){var ft=Ge[Be];C.add(ft)}var Tt=[],Wt=[];for(Tt.push(Q);Tt.length>0;){var ct=Tt[Tt.length-1];if(C.has(ct.name))Tt.pop();else{var bn=Wt[Wt.length-1]===Tt.length-1;if(ct.inputs.length===0||bn)Tt.pop(),N.push(ct),C.add(ct.name),bn&&Wt.pop();else{Wt.push(Tt.length-1);for(var Sn=0,Nn=ct.inputs;Sn<Nn.length;Sn++){var Wn=Nn[Sn];te[Wn.name]==null&&(te[Wn.name]=new Set),te[Wn.name].add(ct.name),C.has(Wn.name)||Tt.push(Wn)}}}}return{sorted:N,recipientMap:te}}function bs(Q){var G;if(Q.sourceLayer.inboundNodes.length===1)G=Q.sourceLayer.output;else{for(var C=null,N=0;N<Q.sourceLayer.inboundNodes.length;++N)for(var te=0,Be=Q.sourceLayer.inboundNodes[N].outputTensors;te<Be.length;te++)if(Be[te].id===Q.id){C=N;break}G=Q.sourceLayer.getOutputAt(C)}return G}function ic(Q,G){return function(C,N,te){var Be=N.length;if(C==null||Array.isArray(C)&&C.length===0)return N.map(function(ft){return null});if(Be===1)return Array.isArray(C)&&C.length===1?C:typeof C=="object"&&N[0]in C?[C[N[0]]]:[C];if(Array.isArray(C)){if(C.length!==Be)throw new Error("Provided "+te+" is an array of "+C.length+" element(s), but the model has "+Be+" outputs. Make sure a set of weights is provided for each model output.");return C}if(typeof C=="object"&&Object.keys(C).length>0&&typeof C[Object.keys(C)[0]]=="object"){var Ge=[];return N.forEach(function(ft){ft in C?Ge.push(C[ft]):Ge.push(null)}),Ge}throw new Error("The model has multiple ("+Be+") outputs, so "+te+" must be either an array with "+Be+" elements or an object with "+N+" keys. Provided "+te+" not understood: "+JSON.stringify(C))}(Q,G,"classWeight")}function Rd(Q,G,C,N){return J(this,void 0,void 0,function(){var te,Be,Ge,ft,Tt;return R(this,function(Wt){switch(Wt.label){case 0:if(G!=null||N!=null)throw new Error("Support sampleWeight is not implemented yet");return C==null?[3,2]:(te=Object(b.tidy)(function(){if(Q.shape.length===1)return Q.clone();if(Q.shape.length===2){if(Q.shape[1]>1)return Q.argMax(1);if(Q.shape[1]===1)return Q.reshape([Q.shape[0]]);throw new Error("Encountered unexpected last-dimension size ("+Q.shape[1]+") during handling of class weights. The size is expected to be >= 1.")}throw new Error("Unexpected rank of target (y) tensor ("+Q.rank+") during handling of class weights. The rank is expected to be 1 or 2.")}),ft=(Ge=Array).from,[4,te.data()]);case 1:return Be=ft.apply(Ge,[Wt.sent()]),Object(b.dispose)(te),Tt=[],Be.forEach(function(ct){if(C[ct]==null)throw new Error("classWeight must contain all classes in the training data. The class "+ct+" exists in the data but not in classWeight");Tt.push(C[ct])}),[2,Object(b.tensor1d)(Tt,"float32")];case 2:return[2,null]}})})}function Fp(Q,G){return Object(b.mul)(Q,G)}var Ip=32;function xm(Q,G){var C,N,te=G;C=te.xs,N=te.ys,b.util.assert(C!=null&&N!=null,function(){return"A Dataset iterator for fitDataset() is expected to generate objects of the form `{xs: xVal, ys: yVal}`, where the two values may be `tf.Tensor`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates "+G});var Be=wm("input",Q.inputNames,C),Ge=wm("output",Q.outputNames,N),ft=Be[0].shape[0];b.util.assert(Be.length===Q.inputs.length,function(){return"LayersModel has "+Q.inputs.length+" inputs, but the dataset provides "+Be.length+" inputs.  (Expected input keys: "+JSON.stringify(Q.inputNames)+")"}),b.util.assert(Ge.length===Q.outputs.length,function(){return"LayersModel has "+Q.outputs.length+" outputs, but the dataset provides "+Ge.length+" outputs.  (Expected output keys: "+JSON.stringify(Q.outputNames)+")"});for(var Tt=function(Sn){b.util.assert(Be[Sn].shape[0]===ft,function(){return"Batch size mismatch: input "+Q.inputNames[Sn]+" has "+Be[Sn].shape[0]+"; expected  "+ft+" based on input "+Q.inputNames[0]+"."})},Wt=0;Wt<Be.length;Wt++)Tt(Wt);for(var ct=function(Sn){b.util.assert(Ge[Sn].shape[0]===ft,function(){return"Batch size mismatch: output "+Q.outputNames[Sn]+" has "+Ge[Sn].shape[0]+"; expected  "+ft+" based on input "+Q.inputNames[0]+"."})},bn=0;bn<Ge.length;bn++)ct(bn);return{xs:Be,ys:Ge}}function wm(Q,G,C){if(C instanceof b.Tensor)return[C];if(Array.isArray(C))return b.util.assert(C.length===G.length,function(){return"Received an array of "+C.length+" Tensors, but expected "+G.length+" to match the "+Q+" keys "+G+"."}),C;for(var N=[],te=0,Be=G;te<Be.length;te++){var Ge=Be[te];if(C[Ge]==null)throw new ee("The feature data generated by the dataset lacks the required "+Q+" key '"+Ge+"'.");N.push(C[Ge])}return N}function qc(Q,G,C){return J(this,void 0,void 0,function(){var N,te,Be,Ge,ft,Tt,Wt,ct,bn,Sn,Nn,Wn,Rn,tr,rr,dr,Tr,Vr,xr,$r,Wr,ai,li,Hr,ni,to,Qi,zo,ji,no,ia,jo,Jo,Fi;return R(this,function(Di){switch(Di.label){case 0:if(N=C.batchesPerEpoch!=null,b.util.assert(Q.optimizer!=null,function(){return"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig)."}),b.util.assert(C!=null,function(){return"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call."}),b.util.assert(C.epochs!=null&&C.epochs>0&&Number.isInteger(C.epochs),function(){return"For fitDataset(), config.epochs is expected to be a positive integer, but got "+C.epochs}),b.util.assert(!N||C.batchesPerEpoch>0&&Number.isInteger(C.batchesPerEpoch),function(){return"For fitDataset(), config.batchesPerEpoch is expected to be a positive integer if specified, but got "+C.batchesPerEpoch}),b.util.assert(C.validationSplit==null,function(){return"`validationSplit` is not supported by `fitDataset()`. Use validationData instead."}),Q.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");Q.isTraining=!0,Di.label=1;case 1:return Di.trys.push([1,,26,27]),te=C.validationData!=null,Be=void 0,Ge=void 0,te&&(za(C.validationData)?b.util.assert(C.validationBatches==null||C.validationBatches>0&&Number.isInteger(C.validationBatches),function(){return"For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, but got "+C.validationBatches}):(ft=function(mo){if(mo.length===3)throw new I("Validation with sample weights is not implemented yet.");return{xs:mo[0],ys:mo[1]}}(C.validationData),Be=ft.xs,Ge=ft.ys)),Tt=Q.makeTrainFunction(),Wt=Q.getDedupedMetricsNames(),ct=void 0,ct=te?Wt.slice().concat(Wt.map(function(mo){return"val_"+mo})):Wt.slice(),bn=Ch(C.callbacks,C.yieldEvery),Sn=C.verbose==null?1:C.verbose,Nn=El(bn,Sn,C.epochs,null,null,function(mo,la){var ha=null;return la.batchesPerEpoch!=null?ha=la.batchesPerEpoch:Number.isFinite(mo.size)&&(ha=mo.size),ha}(G,C),null,te,ct),Wn=Nn.callbackList,Rn=Nn.history,Wn.setModel(Q),Q.history=Rn,[4,Wn.onTrainBegin()];case 2:return Di.sent(),Q.stopTraining_=!1,tr=C.initialEpoch==null?0:C.initialEpoch,[4,G.iterator()];case 3:rr=Di.sent(),Di.label=4;case 4:return tr<C.epochs?(dr={},[4,Wn.onEpochBegin(tr)]):[3,23];case 5:return Di.sent(),Tr=0,Vr=0,N?[3,7]:[4,G.iterator()];case 6:rr=Di.sent(),Di.label=7;case 7:return!N||Tr<C.batchesPerEpoch?[4,rr.next()]:[3,21];case 8:return xr=Di.sent(),N&&xr.done?(console.warn("You provided `batchesPerEpoch` as "+C.batchesPerEpoch+", but your dataset iterator ran out of data after "+Tr+" batches; interrupting training. Make sure that your dataset can generate at least `batchesPerEpoch * epochs` batches (in this case, "+C.batchesPerEpoch*C.epochs+" batches). You may need to use the repeat() function when building your dataset."),[3,21]):xr.value==null?[3,15]:($r=xm(Q,xr.value),Wr=$r.xs,ai=$r.ys,(li={}).batch=Vr,li.size=Wr[0].shape[0],[4,Wn.onBatchBegin(Vr,li)]);case 9:if(Di.sent(),Hr=[],C.classWeight==null)return[3,13];ni=ic(C.classWeight,Q.outputNames),Fi=0,Di.label=10;case 10:return Fi<ni.length?(Qi=(to=Hr).push,[4,Rd(ai[Fi],null,ni[Fi])]):[3,13];case 11:Qi.apply(to,[Di.sent()]),Di.label=12;case 12:return++Fi,[3,10];case 13:for(zo=Wr.concat(ai).concat(Hr),ji=Tt(zo),Object(b.dispose)(zo),Fi=0;Fi<Wt.length;++Fi)no=Wt[Fi],ia=ji[Fi],li[no]=ia,Object(b.keep)(ia);return[4,Wn.onBatchEnd(Vr,li)];case 14:Di.sent(),xc(li),Vr++,Tr++,Di.label=15;case 15:return(N?Tr>=C.batchesPerEpoch:xr.done)?te?(jo=void 0,za(C.validationData)?(Jo=Ae,[4,Q.evaluateDataset(C.validationData,{batches:C.validationBatches})]):[3,17]):[3,19]:[3,20];case 16:return jo=Jo.apply(void 0,[Di.sent()]),[3,18];case 17:jo=Ae(Q.evaluate(Be,Ge,{batchSize:C.validationBatchSize==null?Ip:C.validationBatchSize,verbose:0})),Di.label=18;case 18:for(Fi=0;Fi<Q.metricsNames.length;++Fi)dr["val_"+Q.metricsNames[Fi]]=jo[Fi];Di.label=19;case 19:return[3,21];case 20:return Q.stopTraining_?[3,21]:[3,7];case 21:return[4,Wn.onEpochEnd(tr,dr)];case 22:return Di.sent(),tr++,Q.stopTraining_?[3,23]:[3,4];case 23:return[4,Wn.onTrainEnd()];case 24:return Di.sent(),[4,Q.history.syncData()];case 25:return Di.sent(),[2,Q.history];case 26:return Q.isTraining=!1,[7];case 27:return[2]}})})}function za(Q){return typeof Q.iterator=="function"}function Th(Q){b.util.assert(Q>0&&Number.isInteger(Q),function(){return"batchSize is required to be a positive integer, but got "+Q})}function Ke(Q,G,C){return Q==null?[null]:Array.isArray(Q)?Q.map(function(N){return Qr(N,G,C-G)}):Qr(Q,G,C-G)}function Lu(Q,G){return Object(b.tidy)(function(){return Q==null?null:Array.isArray(Q)?Q.map(function(C){return Lu(C,G)}):Ao(Q,G.dtype==="int32"?G:G.toInt())})}function Af(Q,G){for(var C=[],N=0,te=null;N<Q;)(te=N+G)>=Q&&(te=Q),C.push([N,te]),N=te;return C}function Md(Q,G,C,N){return N===void 0&&(N={}),J(this,void 0,void 0,function(){var te,Be,Ge,ft,Tt,Wt,ct,bn,Sn,Nn,Wn,Rn,tr,rr,dr,Tr,Vr,xr,$r,Wr,ai,li;return R(this,function(Hr){switch(Hr.label){case 0:if(Q.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");Q.isTraining=!0,Hr.label=1;case 1:return Hr.trys.push([1,,7,8]),Th(bn=N.batchSize==null?32:N.batchSize),Sn=!1,[4,Q.standardizeUserData(G,C,N.sampleWeight,N.classWeight,Sn,bn)];case 2:if(Nn=Hr.sent(),te=Nn[0],Be=Nn[1],ct=Nn[2],Wn=!1,Rn=void 0,!(N.validationData!=null&&N.validationData.length>0))return[3,4];if(Wn=!0,N.validationData.length!==2)throw N.validationData.length===3?new I("validationData including sample weights is not supported yet."):new ee("When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; "+N.validationData+" is invalid.");return Ge=N.validationData[0],ft=N.validationData[1],tr=!0,[4,Q.standardizeUserData(Ge,ft,null,null,tr,bn)];case 3:return rr=Hr.sent(),Tt=rr[0],Wt=rr[1],Rn=Tt.concat(Wt),[3,5];case 4:N.validationSplit!=null&&N.validationSplit>0&&N.validationSplit<1?(Wn=!0,dr=Math.floor(te[0].shape[0]*(1-N.validationSplit)),Tr=te[0].shape[0],Tt=Ke(te,dr,Tr),te=Ke(te,0,dr),Wt=Ke(Be,dr,Tr),Be=Ke(Be,0,dr),Rn=Tt.concat(Wt)):N.validationSteps!=null&&(Wn=!0),Hr.label=5;case 5:return Vr=te.concat(Be).concat(ct),Q.checkTrainableWeightsConsistency(),xr=Q.makeTrainFunction(),$r=Q.getDedupedMetricsNames(),Wr=void 0,ai=void 0,Wn?(Q.makeTestFunction(),Wr=Q.testFunction,ai=$r.slice().concat($r.map(function(ni){return"val_"+ni}))):(Wr=null,Rn=[],ai=$r.slice()),li=Ch(N.callbacks,N.yieldEvery),[4,function(ni,to,Qi,zo,ji,no,ia,jo,Jo,Fi,Di,mo,la,ha,aa){return J(this,void 0,void 0,function(){var Qo,Za,da,go,wa,Su,fs,Ma;return R(this,function(Fo){switch(Fo.label){case 0:if(ji==null&&(ji=32),no==null&&(no=1),Di==null&&(Di=!0),la==null&&(la=0),Qo=!1,Jo!=null&&Fi!=null&&(Qo=!0),aa!=null&&(Qo=!0,ha==null))throw new ee("Can only use `validationSteps` when doing step-wise training, i.e., `stepsPerEpoch` must be set.");return(Za=ni.checkNumSamples(Qi,ji,ha,"steps_per_epoch"))!=null&&(da=hr(0,Za)),ia==null&&(ia=1),go=El(jo,ia,no,la,Za,ha,ji,Qo,mo),wa=go.callbackList,Su=go.history,wa.setModel(ni),ni.history=Su,[4,wa.onTrainBegin()];case 1:Fo.sent(),ni.stopTraining_=!1,fs=function(cc){var Ks,Rs,Zo,Ms,Io;return R(this,function(As){switch(As.label){case 0:return[4,wa.onEpochBegin(cc)];case 1:if(As.sent(),Ks={},ha==null)return[3,2];throw new I("stepsPerEpoch mode is not implemented yet.");case 2:if(Di==="batch")throw new I("batch shuffling is not implemneted yet");Di&&b.util.shuffle(da),Rs=Object(b.tensor1d)(da),Zo=Af(Za,ji),Ms=function(hs){var oo;return R(this,function(Ss){switch(Ss.label){case 0:return oo={},[4,wa.onBatchBegin(hs,oo)];case 1:return Ss.sent(),Object(b.tidy)(function(){var Ga=Zo[hs][0],Xs=Zo[hs][1],Sc=Qr(Rs,Ga,Xs-Ga);oo.batch=hs,oo.size=Xs-Ga;for(var Uo=Lu(Qi,Sc),es=to(Uo),ja=0;ja<zo.length;++ja){var lc=zo[ja],el=es[ja];oo[lc]=el,Object(b.keep)(el)}if(hs===Zo.length-1&&Qo){var ci=ni.testLoop(Jo,Fi,ji);for(ja=0;ja<zo.length;++ja)lc=zo[ja],el=ci[ja],Object(b.keep)(el),Ks["val_"+lc]=el}}),[4,wa.onBatchEnd(hs,oo)];case 2:return Ss.sent(),xc(oo),ni.stopTraining_?[2,"break"]:[2]}})},Io=0,As.label=3;case 3:return Io<Zo.length?[5,Ms(Io)]:[3,6];case 4:if(As.sent()==="break")return[3,6];As.label=5;case 5:return++Io,[3,3];case 6:Rs.dispose(),As.label=7;case 7:return[4,wa.onEpochEnd(cc,Ks)];case 8:return As.sent(),ni.stopTraining_?[2,"break"]:[2]}})},Ma=la,Fo.label=2;case 2:return Ma<no?[5,fs(Ma)]:[3,5];case 3:if(Fo.sent()==="break")return[3,5];Fo.label=4;case 4:return++Ma,[3,2];case 5:return[4,wa.onTrainEnd()];case 6:return Fo.sent(),[4,ni.history.syncData()];case 7:return Fo.sent(),[2,ni.history]}})})}(Q,xr,Vr,$r,bn,N.epochs,N.verbose,li,Wr,Rn,N.shuffle,ai,N.initialEpoch,null,null)];case 6:return[2,Hr.sent()];case 7:return Q.isTraining=!1,_o(te,G),_o(Be,C),_o(Tt,Ge),_o(Wt,ft),ct!=null&&Object(b.dispose)(ct),[7];case 8:return[2]}})})}function So(Q){var G=[];Q instanceof b.Tensor&&(Q=[Q]);for(var C=0;C<Q.length;++C){var N=Q[C];if(N.rank===1)G.push(gr(N,1));else{if(N.rank===0)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");G.push(N)}}return G}function _o(Q,G){if(Q!=null){var C=[];if(G instanceof b.Tensor)C.push(G.id);else if(Array.isArray(G))G.forEach(function(Tt){return C.push(Tt.id)});else if(G!=null)for(var N in G){var te=G[N];C.push(te.id)}var Be=[];if(Q instanceof b.Tensor)C.indexOf(Q.id)===-1&&Be.push(Q);else if(Array.isArray(Q))Q.forEach(function(Tt){C.indexOf(Tt.id)===-1&&Be.push(Tt)});else if(Q!=null)for(var Ge in Q){var ft=Q[Ge];C.indexOf(ft.id)===-1&&Be.push(ft)}Be.forEach(function(Tt){Tt.isDisposed||Tt.dispose()})}}function Ko(Q){return Array.isArray(Q)}function Oa(Q){return!function(G){return G instanceof b.Tensor}(Q)&&!Ko(Q)}function wu(Q,G,C,N,te){if(N===void 0&&(N=!0),te===void 0&&(te=""),G==null||G.length===0){if(Q!=null){var Be=!1;if(Ko(Q)&&Q.length>0)Be=!0;else if(Oa(Q)){for(var Ge in Q)if(Q.hasOwnProperty(Ge)){Be=!0;break}}else Be=!0;if(Be)throw new ee("Error when checking model "+te+" expected no data, but got "+Q)}return[]}if(Q==null)return G.map(function(tr){return null});var ft;if(Oa(Q)){Q=Q,ft=[];for(var Tt=0,Wt=G;Tt<Wt.length;Tt++){var ct=Wt[Tt];if(Q[ct]==null)throw new ee('No data provided for "'+ct+'". Need data for each key in: '+G);ft.push(Q[ct])}}else if(Ko(Q)){if((Q=Q).length!==G.length)throw new ee("Error when checking model "+te+": the Array of Tensors that you are passing to your model is not the size the model expected. Expected to see "+G.length+" Tensor(s), but instead got the following list of Tensor(s): "+Q);ft=Q}else{if(Q=Q,G.length>1)throw new ee("The model "+te+" expects "+G.length+" Tensor(s), but only received one Tensor. Found: Tensor with shape "+Q.shape);ft=[Q]}if(ft=So(ft),C!=null){for(var bn=0;bn<G.length;++bn)if(C[bn]!=null){var Sn=ft[bn];if(Sn.shape.length!==C[bn].length)throw new ee("Error when checking "+te+": expected "+G[bn]+" to have "+C[bn].length+" dimension(s). but got array with shape "+Sn.shape);for(var Nn=0;Nn<C[bn].length;++Nn)if(Nn!==0||N){var Wn=Sn.shape[Nn],Rn=C[bn][Nn];if(Rn!=null&&Rn>=0&&Wn!==Rn)throw new ee("Error when checking "+te+": expected "+G[bn]+" to have shape ["+C[bn]+"], but got array with shape ["+Sn.shape+"].")}}}return ft}function Aa(Q,G,C,N,te){var Be;if(N===void 0&&(N=!0),te===void 0&&(te=""),Array.isArray(Q)){if(Q.length!==G.length)throw new ee("Error when checking model "+te+": the Array of Tensors that you are passing to your model is not the size the the model expected. Expected to see "+G.length+" Tensor(s), but instead got "+Q.length+" Tensors(s).");Be=Q}else{if(G.length>1)throw new ee("The model expects "+G.length+" "+te+" Tensors, but only received one Tensor. Found: array with shape "+JSON.stringify(Q.shape)+".");Be=[Q]}if(C!=null){for(var Ge=0;Ge<G.length;++Ge)if(C[Ge]!=null){var ft=Be[Ge];if(ft.shape.length!==C[Ge].length)throw new ee("Error when checking "+te+": expected "+G[Ge]+" to have "+C[Ge].length+" dimension(s), but got array with shape "+JSON.stringify(ft.shape));for(var Tt=0;Tt<C[Ge].length;++Tt)if(Tt!==0||N){var Wt=ft.shape[Tt],ct=C[Ge][Tt];if(ct!=null&&ct!==Wt)throw new ee("Error when checking "+te+": expected "+G[Ge]+" to have shape "+JSON.stringify(C[Ge])+" but got array with shape "+JSON.stringify(ft.shape)+".")}}}}var kc=function(Q){function G(C){var N=Q.call(this,C)||this;return N.isTraining=!1,N}return U(G,Q),G.prototype.summary=function(C,N,te){if(te===void 0&&(te=console.log),!this.built)throw new ee("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");Cf(this,C,N,te)},G.prototype.compile=function(C){var N=this;if(C.loss==null&&(C.loss=[]),this.loss=C.loss,typeof C.optimizer=="string")this.optimizer_=function(tr){var rr={Adagrad:function(){return b.train.adagrad(.01)},Adadelta:function(){return b.train.adadelta(1,.95,W())},Adam:function(){return b.train.adam(.001,.9,.999,W())},Adamax:function(){return b.train.adamax(.002,.9,.999,W(),0)},RMSProp:function(){return b.train.rmsprop(.001,.9,0,W())},SGD:function(){return b.train.sgd(.01)}};if(rr.adagrad=rr.Adagrad,rr.adadelta=rr.Adadelta,rr.adam=rr.Adam,rr.adamax=rr.Adamax,rr.rmsprop=rr.RMSProp,rr.sgd=rr.SGD,tr in rr)return rr[tr]();throw new ee("Unknown Optimizer "+tr)}(C.optimizer),this.isOptimizerOwned=!0;else{if(!(C.optimizer instanceof b.Optimizer))throw new ee("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=C.optimizer,this.isOptimizerOwned=!1}var te=[];if(Array.isArray(C.loss)||typeof C.loss=="string"||typeof C.loss=="function")if(Array.isArray(C.loss)){if(C.loss.length!==this.outputs.length)throw new ee("When passing an Array as loss, it should have one entry per model output. The model has "+this.outputs.length+" output(s), but you passed loss="+C.loss+".");var Be=C.loss;te=Be.map(function(tr){return Oh(tr)})}else{var Ge=Oh(C.loss);this.outputs.forEach(function(tr){te.push(Ge)})}else{for(var ft in C.loss=C.loss,C.loss)if(this.outputNames.indexOf(ft)===-1)throw new ee('Unknown entry in loss dictionary: "'+ft+'". Only expected the following keys: '+this.outputNames);for(var Tt=0,Wt=this.outputNames;Tt<Wt.length;Tt++){var ct=Wt[Tt];C.loss[ct]==null&&console.warn('Output "'+ct+'" is missing from loss dictionary. We assume this was done on purpose, and we will not be expecting data to be passed to '+ct+" during training"),te.push(Oh(C.loss[ct]))}}this.lossFunctions=te,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(var bn=0;bn<this.outputs.length;++bn){var Sn=this.internalOutputShapes[bn],Nn=this.outputNames[bn];this.feedOutputNames.push(Nn),this.feedOutputShapes.push(Sn),this.feedLossFns.push(this.lossFunctions[bn])}var Wn=[];this.metrics=C.metrics,this.metricsNames=["loss"],this.metricsTensors=[],Yn("loss",function(){for(var tr=0;tr<N.outputs.length;++tr)if(Wn.indexOf(tr)===-1){var rr=N.lossFunctions[tr];N.outputs.length>1&&(N.metricsTensors.push([rr,tr]),N.metricsNames.push(N.outputNames[tr]+"_loss"))}});var Rn=function(tr,rr){if(tr==null||Array.isArray(tr)&&tr.length===0)return rr.map(function(ai){return[]});var dr;if(typeof tr=="string"||typeof tr=="function")dr=[tr];else{if(!Array.isArray(tr)&&typeof tr!="object")throw new TypeError("Type of metrics argument not understood. Expected an string,function, Array, or Object, found: "+tr);dr=tr}if(Array.isArray(dr))return rr.map(function(ai){return dr});for(var Tr=[],Vr=0,xr=rr;Vr<xr.length;Vr++){var $r=xr[Vr],Wr=dr.hasOwnProperty($r)?dr[$r]:[];Array.isArray(Wr)||(Wr=[Wr]),Tr.push(Wr)}return Tr}(C.metrics,this.outputNames);Yn("metric",function(){for(var tr=function(dr){if(Wn.indexOf(dr)!==-1)return"continue";(function(Tr){for(var Vr,xr,$r,Wr=function(Hr){if(typeof Hr=="string"&&["accuracy","acc","crossentropy","ce"].indexOf(Hr)!==-1){var ni=N.internalOutputShapes[dr];ni[ni.length-1]===1||N.lossFunctions[dr]===Cl?["accuracy","acc"].indexOf(Hr)!==-1?xr=bf:["crossentropy","ce"].indexOf(Hr)!==-1&&(xr=wf):N.lossFunctions[dr]===nc?["accuracy","acc"].indexOf(Hr)!==-1?xr=kf:["crossentropy","ce"].indexOf(Hr)!==-1&&(xr=Ef):["accuracy","acc"].indexOf(Hr)!==-1?xr=xf:["crossentropy","ce"].indexOf(Hr)!==-1&&(xr=ys);var to=void 0;["accuracy","acc"].indexOf(Hr)!==-1?to="acc":["crossentropy","ce"].indexOf(Hr)!==-1&&(to="ce"),$r=xr,Vr=""+to}else{var Qi=function(ji){if(typeof ji=="string"&&ji in ar)return ar[ji];if(typeof ji!="string"&&ji!=null)return ji;throw new ee("Unknown metric "+ji)}(Hr);$r=Qi,Vr=""+xu(Hr)}var zo;Yn(Vr,function(){zo=$r}),function(ji,no,ia){N.outputNames.length>1&&(no=N.outputNames[ji]+"_"+no),N.metricsNames.push(no),N.metricsTensors.push([ia,ji])}(dr,Vr,zo)},ai=0,li=Rn[dr];ai<li.length;ai++)Wr(li[ai])})()},rr=0;rr<N.outputs.length;++rr)tr(rr)}),this.collectedTrainableWeights=this.trainableWeights},G.prototype.checkTrainableWeightsConsistency=function(){this.collectedTrainableWeights!=null&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")},G.prototype.evaluate=function(C,N,te){te===void 0&&(te={});var Be=te.batchSize==null?32:te.batchSize;Th(Be);var Ge=this.standardizeUserDataXY(C,N,!0,Be);try{var ft=Ge[0].concat(Ge[1]);this.makeTestFunction();var Tt=this.testFunction;return pe(this.testLoop(Tt,ft,Be,te.verbose,te.steps))}finally{_o(Ge[0],C),_o(Ge[1],N)}},G.prototype.evaluateDataset=function(C,N){return J(this,void 0,void 0,function(){return R(this,function(te){return this.makeTestFunction(),[2,function(Be,Ge,ft){return J(this,void 0,void 0,function(){var Tt,Wt,ct,bn,Sn,Nn,Wn,Rn,tr,rr;return R(this,function(dr){switch(dr.label){case 0:if(Tt=(ft=ft||{}).batches!=null,Wt=Be.testFunction,ct=[],ft.verbose>0)throw new I("Verbose mode is not implemented yet.");return b.util.assert(!Tt||ft.batches>0&&Number.isInteger(ft.batches),function(){return"Test loop expects `batches` to be a positive integer, but received "+JSON.stringify(ft.batches)}),function(Tr){return typeof Tr.next=="function"}(Ge)?(Sn=Ge,[3,3]):[3,1];case 1:return[4,Ge.iterator()];case 2:Sn=dr.sent(),dr.label=3;case 3:bn=Sn,Nn=0,Wn=0,Rn=function(){var Tr;return R(this,function(Vr){switch(Vr.label){case 0:return[4,bn.next()];case 1:return Tr=Vr.sent(),ct=Object(b.tidy)(function(){if(Tr.value){var xr=xm(Be,Tr.value),$r=xr.xs,Wr=xr.ys,ai=$r.concat(Wr),li=Object(b.tidy)(function(){return Wt(ai)});if(Object(b.dispose)(ai),Wn===0)for(var Hr=0;Hr<li.length;++Hr)ct.push(Object(b.scalar)(0));var ni=ai[0].shape[0],to=function(Qi){var zo=li[Qi],ji=ct[Qi];ct[Qi]=Object(b.tidy)(function(){return Object(b.add)(ct[Qi],Object(b.mul)(ni,zo))}),Wn>0&&Object(b.dispose)(ji)};for(Hr=0;Hr<li.length;++Hr)to(Hr);Object(b.dispose)(li),Nn+=ni,++Wn}return ct}),Tr.done?(Tt&&console.warn("Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least `batches` batches (in this case, "+ft.batches+" batches). You may need to use the repeat() function when building your dataset."),[2,"break"]):[2]}})},dr.label=4;case 4:return!Tt||Wn<ft.batches?[5,Rn()]:[3,6];case 5:return dr.sent()==="break"?[3,6]:[3,4];case 6:for(tr=0;tr<ct.length;++tr)rr=ct[tr],ct[tr]=Object(b.div)(ct[tr],Nn),Object(b.dispose)(rr);return[2,pe(ct)]}})})}(this,C,N)]})})},G.prototype.checkNumSamples=function(C,N,te,Be){var Ge;if(Be===void 0&&(Be="steps"),te!=null){if(Ge=null,N!=null)throw new ee("If "+Be+" is set, batchSize must be null or undefined.Got batchSize = "+N)}else{if(C==null)throw new ee("Either the input data should have a defined shape, or "+Be+" shoud be specified.");Ge=Array.isArray(C)?C[0].shape[0]:C.shape[0]}return Ge},G.prototype.execute=function(C,N){if(Array.isArray(N)&&N.length===0)throw new ee("`outputs` is an empty Array, which is not allowed.");var te=Array.isArray(N),Be=te?N:[N],Ge=this.retrieveSymbolicTensors(Be),ft=new No;if(C instanceof b.Tensor&&(C=[C]),Array.isArray(C)){if(C.length!==this.inputs.length)throw new ee("The number of inputs provided ("+C.length+") does not match the number of inputs of this model ("+this.inputs.length+").");for(var Tt=0;Tt<this.inputs.length;++Tt)ft.add(this.inputs[Tt],C[Tt])}else for(var Wt=0,ct=this.inputs;Wt<ct.length;Wt++){var bn=ct[Wt],Sn=C[bn.name];if(Sn==null)throw new ee("No value is provided for the model's input "+bn.name);ft.add(bn,Sn)}var Nn=Of(Ge,ft);return te?Nn:Nn[0]},G.prototype.retrieveSymbolicTensors=function(C){for(var N=ie(null,C.length),te=C.length,Be=0,Ge=this.layers;Be<Ge.length;Be++){for(var ft=Ge[Be],Tt=Array.isArray(ft.output)?ft.output:[ft.output],Wt=Tt.map(function(Nn){return Nn.name}),ct=0;ct<C.length;++ct){var bn=Wt.indexOf(C[ct]);if(bn!==-1&&(N[ct]=Tt[bn],te--),te===0)break}if(te===0)break}if(te>0){var Sn=[];throw N.forEach(function(Nn,Wn){Nn==null&&Sn.push(C[Wn])}),new ee("Cannot find SymbolicTensors for output name(s): "+JSON.stringify(Sn))}return N},G.prototype.predictLoop=function(C,N,te){var Be=this;return N===void 0&&(N=32),te===void 0&&(te=!1),Object(b.tidy)(function(){var Ge=Be.checkNumSamples(C);if(te)throw new I("Verbose predictLoop() is not implemented yet.");for(var ft=Af(Ge,N),Tt=Be.outputs.map(function(bn){return[]}),Wt=function(bn){Object(b.tidy)(function(){var Sn=ft[bn][0],Nn=ft[bn][1],Wn=Ke(C,Sn,Nn),Rn=[];if(Array.isArray(Wn))for(var tr=0;tr<Wn.length;++tr)Rn.push({key:Be.inputs[tr],value:Wn[tr]});else Rn.push({key:Be.inputs[0],value:Wn});var rr=new No(Rn);return Of(Be.outputs,rr)}).forEach(function(Sn,Nn){return Tt[Nn].push(Sn)})},ct=0;ct<ft.length;++ct)Wt(ct);return pe(Tt.map(function(bn){return Object(b.concat)(bn,0)}))})},G.prototype.predict=function(C,N){N===void 0&&(N={});var te=So(C);Aa(te,this.inputNames,this.feedInputShapes,!1);try{var Be=N.batchSize==null?32:N.batchSize;return Th(Be),this.predictLoop(te,Be)}finally{_o(te,C)}},G.prototype.predictOnBatch=function(C){Aa(C,this.inputNames,this.feedInputShapes,!0);var N=(Array.isArray(C)?C[0]:C).shape[0];return this.predictLoop(C,N)},G.prototype.standardizeUserDataXY=function(C,N,te,Be){if(this.optimizer_==null)throw new P("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");for(var Ge=[],ft=0;ft<this.feedOutputShapes.length;++ft){var Tt=this.feedOutputShapes[ft];this.feedLossFns[ft]===nc?Ge.push(Tt.slice(0,Tt.length-1).concat([1])):Ge.push(Tt)}if(function(Wt,ct,bn){var Sn=Xt(Wt.map(function(Wn){return Wn.shape[0]}));Sn.sort();var Nn=Xt(ct.map(function(Wn){return Wn.shape[0]}));if(Nn.sort(),Sn.length>1)throw new ee("All input Tensors (x) should have the same number of samples. Got array shapes: "+JSON.stringify(Wt.map(function(Wn){return Wn.shape})));if(Nn.length>1)throw new ee("All target Tensors (y) should have the same number of samples. Got array shapes: "+JSON.stringify(ct.map(function(Wn){return Wn.shape})));if(Sn.length>0&&Nn.length>0&&!b.util.arraysEqual(Sn,Nn))throw new ee("Input Tensors should have the same number of samples as target Tensors. Found "+Sn[0]+" input sample(s) and "+Nn[0]+" target sample(s).")}(C=wu(C,this.feedInputNames,this.feedInputShapes,!1,"input"),N=wu(N,this.feedOutputNames,Ge,!1,"target")),function(Wt,ct,bn){for(var Sn=[ua,Cl,Ca],Nn=0;Nn<Wt.length;++Nn){var Wn=Wt[Nn],Rn=ct[Nn],tr=bn[Nn];if(Rn!=null){if(Rn===Ca&&Wn.shape[Wn.shape.length-1]===1)throw new ee("You are passing a target array of shape "+Wn.shape+" while using a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes].");if(Sn.indexOf(Rn)!==-1)for(var rr=Wn.shape.slice(1),dr=tr.slice(1),Tr=0;Tr<rr.length;++Tr){var Vr=rr[Tr],xr=dr[Tr];if(xr!=null&&Vr!==xr)throw new ee("A target Tensor with shape "+Wn.shape+" was passed for an output of shape "+tr+", while using a loss function that expects targets to have the same shape as the output.")}}}}(N,this.feedLossFns,this.feedOutputShapes),this.stateful&&Be!=null&&Be>0&&C[0].shape[0]%Be!=0)throw new ee("In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size "+Be+". Found: "+C[0].shape[0]+" sample(s).");return[C,N]},G.prototype.standardizeUserData=function(C,N,te,Be,Ge,ft){return Ge===void 0&&(Ge=!0),J(this,void 0,void 0,function(){var Tt,Wt,ct,bn,Sn,Nn,Wn,Rn;return R(this,function(tr){switch(tr.label){case 0:if(Tt=this.standardizeUserDataXY(C,N,Ge,ft),Wt=Tt[0],ct=Tt[1],te!=null)throw new Error("sample weight is not supported yet.");if(bn=null,Be==null)return[3,4];Sn=ic(Be,this.outputNames),bn=[],Nn=0,tr.label=1;case 1:return Nn<Sn.length?(Rn=(Wn=bn).push,[4,Rd(ct[Nn],null,Sn[Nn])]):[3,4];case 2:Rn.apply(Wn,[tr.sent()]),tr.label=3;case 3:return++Nn,[3,1];case 4:return[2,[Wt,ct,bn]]}})})},G.prototype.testLoop=function(C,N,te,Be,Ge){var ft=this;return Be===void 0&&(Be=0),Object(b.tidy)(function(){var Tt=ft.checkNumSamples(N,te,Ge,"steps"),Wt=[];if(Be>0)throw new I("Verbose mode is not implemented yet.");if(Ge!=null)throw new I("steps mode in testLoop() is not implemented yet");for(var ct=Af(Tt,te),bn=Object(b.tensor1d)(hr(0,Tt)),Sn=0;Sn<ct.length;++Sn){var Nn=ct[Sn][0],Wn=ct[Sn][1],Rn=Qr(bn,Nn,Wn-Nn),tr=Lu(N,Rn),rr=C(tr);if(Sn===0)for(var dr=0;dr<rr.length;++dr)Wt.push(Object(b.scalar)(0));for(dr=0;dr<rr.length;++dr){var Tr=rr[dr];Wt[dr]=Object(b.add)(Wt[dr],Object(b.mul)(Wn-Nn,Tr))}}for(dr=0;dr<Wt.length;++dr)Wt[dr]=Object(b.div)(Wt[dr],Tt);return Wt})},G.prototype.getDedupedMetricsNames=function(){for(var C=this.metricsNames,N=[],te=0;te<C.length;++te){var Be=C[te],Ge=Be;de(C,Be)>1&&(Ge+="_"+de(C.slice(0,te),Be)),N.push(Ge)}return N},G.prototype.makeTrainFunction=function(){var C=this;return function(N){var te=[],Be=N.slice(0,C.inputs.length),Ge=N.slice(C.inputs.length,C.inputs.length+C.outputs.length),ft=N.slice(C.inputs.length+C.outputs.length,C.inputs.length+2*C.outputs.length),Tt=[],Wt=C.collectedTrainableWeights.map(function(ct){return ct.read()});return[C.optimizer_.minimize(function(){for(var ct=[],bn=0;bn<C.inputs.length;++bn)ct.push({key:C.inputs[bn],value:Be[bn]});var Sn,Nn=new No(ct),Wn=Of(C.outputs,Nn,{training:!0});for(bn=0;bn<C.lossFunctions.length;++bn){var Rn=(0,C.lossFunctions[bn])(Ge[bn],Wn[bn]);ft[bn]!=null&&(Rn=Fp(Rn,ft[bn]));var tr=Object(b.mean)(Rn);te.push(tr),Sn=bn===0?Rn:Object(b.add)(Sn,Rn)}for(bn=0;bn<C.metricsTensors.length;++bn){var rr=void 0;if(C.outputs.length>1&&bn<C.outputs.length)rr=te[bn];else{var dr=C.metricsTensors[bn][0],Tr=C.metricsTensors[bn][1];rr=Object(b.mean)(dr(Ge[Tr],Wn[Tr]))}Object(b.keep)(rr),Tt.push(rr)}return Sn=Object(b.mean)(Sn),C.calculateLosses().forEach(function(Vr){Sn=Object(b.add)(Sn,Vr)}),Sn},!0,Wt)].concat(Tt)}},G.prototype.makeTestFunction=function(){var C=this;this.testFunction=function(N){return Object(b.tidy)(function(){for(var te,Be=[],Ge=N.slice(0,C.inputs.length),ft=N.slice(C.inputs.length,C.inputs.length+C.outputs.length),Tt=[],Wt=0;Wt<C.inputs.length;++Wt)Tt.push({key:C.inputs[Wt],value:Ge[Wt]});var ct=new No(Tt),bn=Of(C.outputs,ct);for(Wt=0;Wt<C.lossFunctions.length;++Wt){var Sn=C.lossFunctions[Wt],Nn=Object(b.mean)(Sn(ft[Wt],bn[Wt]));te=Wt===0?Nn:Object(b.add)(te,Nn),Be.push(te)}for(Wt=0;Wt<C.metricsTensors.length;++Wt){var Wn=C.metricsTensors[Wt][0],Rn=C.metricsTensors[Wt][1],tr=Object(b.mean)(Wn(ft[Rn],bn[Rn]));Be.push(tr)}return Be})}},G.prototype.fit=function(C,N,te){return te===void 0&&(te={}),J(this,void 0,void 0,function(){return R(this,function(Be){return[2,Md(this,C,N,te)]})})},G.prototype.fitDataset=function(C,N){return J(this,void 0,void 0,function(){return R(this,function(te){return[2,qc(this,C,N)]})})},G.prototype.trainOnBatch=function(C,N){return J(this,void 0,void 0,function(){var te,Be,Ge,ft,Tt,Wt,ct,bn,Sn;return R(this,function(Nn){switch(Nn.label){case 0:return[4,this.standardizeUserData(C,N)];case 1:te=Nn.sent(),Be=te[0],Ge=te[1],ft=this.makeTrainFunction(),Tt=ft(Be.concat(Ge)),Wt=[],ct=0,bn=Tt,Nn.label=2;case 2:return ct<bn.length?[4,bn[ct].data()]:[3,5];case 3:Sn=Nn.sent(),Wt.push(Sn[0]),Nn.label=4;case 4:return ct++,[3,2];case 5:return Object(b.dispose)(Tt),[2,pe(Wt)]}})})},G.prototype.getNamedWeights=function(C){for(var N=[],te=C!=null&&C.trainableOnly,Be=te?this.trainableWeights:this.weights,Ge=this.getWeights(te),ft=0;ft<Be.length;++ft)te&&!Be[ft].trainable||N.push({name:Be[ft].originalName,tensor:Ge[ft]});return N},Object.defineProperty(G.prototype,"stopTraining",{get:function(){return this.stopTraining_},set:function(C){this.stopTraining_=C},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"optimizer",{get:function(){return this.optimizer_},set:function(C){this.optimizer_!==C&&(this.optimizer_=C,this.isOptimizerOwned=!1)},enumerable:!0,configurable:!0}),G.prototype.dispose=function(){var C=Q.prototype.dispose.call(this);if(C.refCountAfterDispose===0&&this.optimizer!=null&&this.isOptimizerOwned){var N=Object(b.memory)().numTensors;this.optimizer_.dispose(),C.numDisposedVariables+=N-Object(b.memory)().numTensors}return C},G.prototype.getLossIdentifiers=function(){var C;if(typeof this.loss=="string")C=Te(this.loss);else if(Array.isArray(this.loss)){for(var N=0,te=this.loss;N<te.length;N++)if(typeof te[N]!="string")throw new Error("Serialization of non-string loss is not supported.");C=this.loss.map(function(ct){return Te(ct)})}else{var Be=Object.keys(this.loss);C={};for(var Ge=this.loss,ft=0,Tt=Be;ft<Tt.length;ft++){var Wt=Tt[ft];if(typeof Ge[Wt]!="string")throw new Error("Serialization of non-string loss is not supported.");C[Wt]=Te(Ge[Wt])}}return C},G.prototype.getMetricIdentifiers=function(){if(typeof this.metrics=="string"||typeof this.metrics=="function")return[Te(xu(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map(function(te){return Te(xu(te))});var C={};for(var N in this.metrics)C[N]=Te(xu(this.metrics[N]));return C},G.prototype.getTrainingConfig=function(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}},G.prototype.loadTrainingConfig=function(C){if(C.weighted_metrics!=null)throw new Error("Loading weight_metrics is not supported yet.");if(C.loss_weights!=null)throw new Error("Loading loss_weights is not supported yet.");if(C.sample_weight_mode!=null)throw new Error("Loading sample_weight_mode is not supported yet.");var N,te,Be=Fa(Ii(C.optimizer_config));if(typeof C.loss=="string")N=je(C.loss);else if(Array.isArray(C.loss))N=C.loss.map(function(ft){return je(ft)});else if(C.loss!=null)for(var Ge in N={},C.loss)N[Ge]=je(C.loss[Ge]);if(Array.isArray(C.metrics))te=C.metrics.map(function(ft){return je(ft)});else if(C.metrics!=null)for(var Ge in te={},C.metrics)te[Ge]=je(C.metrics[Ge]);this.compile({loss:N,metrics:te,optimizer:Be})},G.prototype.save=function(C,N){return J(this,void 0,void 0,function(){var te,Be,Ge,ft,Tt,Wt,ct,bn,Sn,Nn,Wn,Rn,tr,rr;return R(this,function(dr){switch(dr.label){case 0:if(typeof C=="string"){if((te=b.io.getSaveHandlers(C)).length===0)throw new ee("Cannot find any save handlers for URL '"+C+"'");if(te.length>1)throw new ee("Found more than one ("+te.length+") save handlers for URL '"+C+"'");C=te[0]}if(C.save==null)throw new ee("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");return[4,b.io.encodeWeights(this.getNamedWeights(N))];case 1:return Be=dr.sent(),Ge=!1,ft=null,Tt=this.toJSON(ft,Ge),Wt={modelTopology:Tt,format:"layers-model",generatedBy:"TensorFlow.js tfjs-layers v1.7.4",convertedBy:null},N!=null&&N.includeOptimizer&&this.optimizer!=null?(Wt.trainingConfig=this.getTrainingConfig(),ct="optimizer",Rn=(Wn=b.io).encodeWeights,[4,this.optimizer.getWeights()]):[3,4];case 2:return[4,Rn.apply(Wn,[dr.sent(),ct])];case 3:bn=dr.sent(),Sn=bn.data,Nn=bn.specs,(rr=Be.specs).push.apply(rr,Nn),Be.data=b.io.concatenateArrayBuffers([Be.data,Sn]),dr.label=4;case 4:return this.userDefinedMetadata!=null&&(tr=!0,Np(this.userDefinedMetadata,this.name,tr),Wt.userDefinedMetadata=this.userDefinedMetadata),Wt.weightData=Be.data,Wt.weightSpecs=Be.specs,[2,C.save(Wt)]}})})},G.prototype.setUserDefinedMetadata=function(C){Np(C,this.name),this.userDefinedMetadata=C},G.prototype.getUserDefinedMetadata=function(){return this.userDefinedMetadata},G.className="Model",G}(function(Q){function G(C){var N=Q.call(this,{})||this;if(N.containerNodes=new Set,N.name=C.name,N.name==null){var te=N.getClassName().toLowerCase();N.name=Zi(te)}if(N.supportsMasking=!1,N.trainable_=!0,Array.isArray(C.inputs)?N.inputs=C.inputs.slice():N.inputs=[C.inputs],Array.isArray(C.outputs)?N.outputs=C.outputs.slice():N.outputs=[C.outputs],Xt(N.inputs).length!==N.inputs.length)throw new ee("The list of inputs passed to the model is redundant. All inputs should only appear once. Found: "+N.inputs.map(function(oo){return oo.name}));Xt(N.outputs).length!==N.outputs.length&&console.warn("The list of outputs passed to the model is redundant. All outputs should only appear once. Found: "+N.outputs.map(function(oo){return oo.name})),N.inputLayers=[],N.inputLayersNodeIndices=[],N.inputLayersTensorIndices=[],N.outputLayers=[],N.outputLayersNodeIndices=[],N.outputLayersTensorIndices=[],N.layers=[],N.internalContainerRefs=[];for(var Be=0,Ge=N.outputs;Be<Ge.length;Be++){var ft=(Hr=Ge[Be]).sourceLayer,Tt=Hr.nodeIndex,Wt=Hr.tensorIndex;N.outputLayers.push(ft),N.outputLayersNodeIndices.push(Tt),N.outputLayersTensorIndices.push(Wt)}for(var ct=0,bn=N.inputs;ct<bn.length;ct++)ft=(Hr=bn[ct]).sourceLayer,Tt=Hr.nodeIndex,Wt=Hr.tensorIndex,K(Tt===0,"input layer has >1 nodes"),K(Wt===0,"input layer has >1 tensors"),N.inputLayers.push(ft),N.inputLayersNodeIndices.push(Tt),N.inputLayersTensorIndices.push(Wt);N.inputNames=[],N.outputNames=[],N.feedInputShapes=[],N.feedInputNames=[],N.feedOutputNames=[];for(var Sn=0;Sn<N.inputLayers.length;Sn++){if(!((ft=N.inputLayers[Sn])instanceof bu))throw new TypeError("Input layers to a LayersModel must be InputLayer objects. Received inputs: "+C.inputs+". Input "+Sn+" (0-based) originates from layer type "+ft.getClassName()+".");N.inputNames.push(ft.name),N.feedInputShapes.push(ft.batchInputShape),N.feedInputNames.push(ft.name)}for(var Nn=0,Wn=N.outputLayers;Nn<Wn.length;Nn++)ft=Wn[Nn],N.outputNames.push(ft.name);N.internalInputShapes=N.inputs.map(function(oo){return oo.shape}),N.internalOutputShapes=N.outputs.map(function(oo){return oo.shape});for(var Rn={},tr={},rr={},dr={},Tr={},Vr=[],xr=function(oo,Ss,Ga,Xs,Sc,Uo){Xs!=null&&Sc!=null&&Uo!=null||(Xs=oo.sourceLayer,Sc=oo.nodeIndex,Uo=oo.tensorIndex);var es=Xs.inboundNodes[Sc];if(Ga.indexOf(es)!==-1)throw new P("The tensor "+oo.name+' at layer "'+Xs.name+'" is part of a cycle.');if(Ss.indexOf(es)===-1){N.containerNodes.add(G.nodeKey(Xs,Sc)),Xs.id in Tr||(Tr[Xs.id]=Object.keys(Tr).length),Ga.indexOf(es)===-1&&Ga.push(es);for(var ja=es.inboundLayers.length,lc=0;lc<ja;lc++){var el=es.inputTensors[lc],ci=es.inboundLayers[lc],Xd=es.nodeIndices[lc],tl=es.tensorIndices[lc];xr(el,Ss,Ga,ci,Xd,tl)}for(Ss.push(es);Ga.indexOf(es)>=0;)Ga.splice(Ga.indexOf(es),1);Vr.push(es)}},$r=[],Wr=[],ai=0,li=N.outputs;ai<li.length;ai++){var Hr=li[ai];xr(Hr,$r,Wr)}for(var ni=0,to=Vr.slice().reverse();ni<to.length;ni++){tr[(Fo=to[ni]).id]=Fo,Fo.id in Rn||(Rn[Fo.id]=0);var Qi=Rn[Fo.id],zo=rr[Fo.outboundLayer.id]==null?0:rr[Fo.outboundLayer.id];for(Qi=Math.max(Qi,zo),rr[Fo.outboundLayer.id]=Qi,dr[Fo.outboundLayer.id]=Fo.outboundLayer,Rn[Fo.id]=Qi,Sn=0;Sn<Fo.inboundLayers.length;Sn++){var ji=Fo.inboundLayers[Sn],no=(Tt=Fo.nodeIndices[Sn],ji.inboundNodes[Tt]),ia=Rn[no.id]==null?0:Rn[no.id];Rn[no.id]=Math.max(Qi+1,ia),tr[no.id]=no}}var jo={};for(var Jo in Rn)(Qi=Rn[Jo])in jo||(jo[Qi]=[]),jo[Qi].push(tr[Jo]);var Fi={};for(var Di in rr)(Qi=rr[Di])in Fi||(Fi[Qi]=[]),Fi[Qi].push(dr[Di]);var mo=Object.keys(Fi).map(function(oo){return parseInt(oo,10)}).sort(Ut);N.layers=[];for(var la=0,ha=mo;la<ha.length;la++){var aa=Fi[Qi=ha[la]];aa.sort(function(oo,Ss){var Ga=Tr[oo.id],Xs=Tr[Ss.id];return Ga<Xs?-1:Ga>Xs?1:0});for(var Qo=0,Za=aa;Qo<Za.length;Qo++)(ft=Za[Qo])instanceof G&&N.internalContainerRefs.push(ft),N.layers.push(ft)}N.layersByDepth=Fi,mo=Object.keys(jo).map(function(oo){return parseInt(oo,10)}).sort(Ut);for(var da=N.inputs.slice(),go=[],wa=0,Su=mo;wa<Su.length;wa++)for(var fs=0,Ma=jo[Qi=Su[wa]];fs<Ma.length;fs++){var Fo;if((ft=(Fo=Ma[fs]).outboundLayer)!=null){for(var cc=0,Ks=Fo.inputTensors;cc<Ks.length;cc++)if(Hr=Ks[cc],da.indexOf(Hr)===-1)throw new P("Graph disconnected: cannot obtain value for tensor "+Hr+' at layer "'+ft.name+'". The following previous layers were accessed without issue: '+go);for(var Rs=0,Zo=Fo.outputTensors;Rs<Zo.length;Rs++)Hr=Zo[Rs],da.push(Hr);go.push(ft.name)}}N.nodesByDepth=jo;for(var Ms=N.layers.map(function(oo){return oo.name}),Io=function(oo){var Ss=Ms.filter(function(Ga){return Ga===oo}).length;if(Ss!==1)throw new P('The name "'+oo+'" is used '+Ss+" times in the model. All layer names should be unique. Layer names: "+JSON.stringify(Ms))},As=0,hs=Ms;As<hs.length;As++)Io(hs[As]);return N.outboundNodes=[],N.inboundNodes=[],new vs({outboundLayer:N,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:N.inputs,outputTensors:N.outputs,inputMasks:N.inputs.map(function(oo){return null}),outputMasks:N.outputs.map(function(oo){return null}),inputShapes:N.inputs.map(function(oo){return oo.shape}),outputShapes:N.outputs.map(function(oo){return oo.shape})}),N.built=!0,N._refCount=1,N}return U(G,Q),G.prototype.assertNotDisposed=function(){if(this._refCount===0)throw new Error("Container '"+this.name+"' is already disposed.")},G.prototype.dispose=function(){this.assertNotDisposed();var C={refCountAfterDispose:null,numDisposedVariables:0};if(--this._refCount==0){for(var N=0,te=this.layers;N<te.length;N++){var Be=te[N];C.numDisposedVariables+=Be.dispose().numDisposedVariables}for(var Ge=0,ft=this.internalContainerRefs;Ge<ft.length;Ge++){var Tt=ft[Ge];C.numDisposedVariables+=Tt.dispose().numDisposedVariables}}return C.refCountAfterDispose=this._refCount,C},Object.defineProperty(G.prototype,"trainable",{get:function(){return this.trainable_},set:function(C){this.layers.forEach(function(N){N._trainableWeights.forEach(function(te){return te.trainable=C})}),this.trainable_=C},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"trainableWeights",{get:function(){if(this._trainableWeights.length>0)throw new ee("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];for(var C=[],N=0,te=this.layers;N<te.length;N++){var Be=te[N];C=C.concat(Be.trainableWeights)}return C},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"nonTrainableWeights",{get:function(){for(var C=[],N=0,te=this.layers;N<te.length;N++){var Be=te[N];C.push.apply(C,Be.nonTrainableWeights)}if(!this.trainable){for(var Ge=[],ft=0,Tt=this.layers;ft<Tt.length;ft++)Be=Tt[ft],Ge.push.apply(Ge,Be.trainableWeights);return Ge.concat(C)}return C},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"weights",{get:function(){return this.trainableWeights.concat(this.nonTrainableWeights)},enumerable:!0,configurable:!0}),G.prototype.loadWeights=function(C,N){N===void 0&&(N=!0);for(var te={},Be=0,Ge=0,ft=this.layers;Ge<ft.length;Ge++)for(var Tt=0,Wt=ft[Ge].weights;Tt<Wt.length;Tt++){var ct=Wt[Tt];if(te[ct.originalName]!=null)throw new ee("Duplicate weight name: "+ct.originalName);te[ct.originalName]=ct,Be++}var bn=[];for(var Sn in C){if(te[Sn]!=null)bn.push([te[Sn],C[Sn]]);else if(N)throw new ee("Provided weight data has no target variable: "+Sn);delete te[Sn]}if(N){var Nn=[];for(var Wn in te)Nn.push(Wn);if(Nn.length>0)throw new ee(Nn.length+" of "+Be+" weights are not set: "+Nn)}yo(bn)},G.prototype.updatedConfig=function(){var C=this.getConfig(),N={};return N.className=this.getClassName(),N.config=C,N.kerasVersion="tfjs-layers 1.7.4",N.backend="TensorFlow.js",N},G.prototype.toJSON=function(C,N){N===void 0&&(N=!0);var te=function Be(Ge,ft){if(Ge==null)return null;if(typeof Ge=="string")return Te(Ge);if(typeof Ge=="number"||typeof Ge=="boolean")return Ge;if(Ge instanceof Array){for(var Tt=[],Wt=Ge.length,ct=0;ct<Wt;++ct){var bn=Ge[ct];_h(ft,ct,bn)?Tt.push(bn):Tt.push(Be(bn,ft))}return Tt}for(var Sn={},Nn=0,Wn=Object.keys(Ge);Nn<Wn.length;Nn++){var Rn=Wn[Nn],tr=Ge[Rn];Sn[Te(Rn)]=Rn!=="name"&&Rn!=="className"||typeof tr!="string"?Be(tr,Rn):tr}return Sn}(this.updatedConfig());return N?JSON.stringify(te):te},G.prototype.call=function(C,N){var te=this;return Object(b.tidy)(function(){C=Ae(C);for(var Be=new No,Ge=0;Ge<te.inputs.length;++Ge)Be.add(te.inputs[Ge],C[Ge]);return Of(te.outputs,Be,N)})},G.prototype.computeMask=function(C,N){var te=this;return Object(b.tidy)(function(){var Be;return C=Ae(C),Be=N==null?ie(null,C.length):Ae(N),te.runInternalGraph(C,Be)[1]})},G.prototype.computeOutputShape=function(C){var N=qr(C);if(N.length!==this.inputLayers.length)throw new ee("Invalid inputShape argument "+C+": model has "+this.inputLayers.length+" tensor inputs.");for(var te={},Be=0;Be<N.length;Be++){var Ge=this.inputLayers[Be],ft=N[Be];te[li=Ge.name+"_0_0"]=ft}var Tt=Object.keys(this.nodesByDepth).map(function(ni){return parseInt(ni,10)}).sort(Ut);if(Tt.length>1)for(var Wt=0,ct=Tt;Wt<ct.length;Wt++)for(var bn=ct[Wt],Sn=0,Nn=this.nodesByDepth[bn];Sn<Nn.length;Sn++){var Wn=Nn[Sn];if(Ge=Wn.outboundLayer,this.inputLayers.map(function(ni){return ni.id}).indexOf(Ge.id)===-1){for(var Rn=[],tr=0;tr<Wn.inboundLayers.length;tr++){var rr=Wn.inboundLayers[tr],dr=Wn.nodeIndices[tr],Tr=Wn.tensorIndices[tr],Vr=te[li=rr.name+"_"+dr+"_"+Tr];Rn.push(Vr)}var xr=qr(Ge.computeOutputShape(pe(Rn))),$r=Ge.inboundNodes.indexOf(Wn);for(tr=0;tr<xr.length;tr++)te[li=Ge.name+"_"+$r+"_"+tr]=xr[tr]}}var Wr=[],ai=[];for(Be=0;Be<this.outputLayers.length;Be++){Ge=this.outputLayers[Be],$r=this.outputLayersNodeIndices[Be],Tr=this.outputLayersTensorIndices[Be];var li=Ge.name+"_"+$r+"_"+Tr;ai.push(li)}for(Be=0;Be<ai.length;Be++){var Hr=ai[Be];K(Hr in te),Wr.push(te[Hr])}return pe(Wr)},G.prototype.runInternalGraph=function(C,N){N==null&&(N=ie(null,C.length));for(var te={},Be=0;Be<this.inputs.length;++Be){var Ge=this.inputs[Be],ft=C[Be],Tt=N[Be];te[Ge.id]=[ft,Tt]}for(var Wt=0,ct=Object.keys(this.nodesByDepth).map(function(Fi){return parseInt(Fi,10)}).sort(Ut);Wt<ct.length;Wt++)for(var bn=ct[Wt],Sn=0,Nn=this.nodesByDepth[bn];Sn<Nn.length;Sn++){for(var Wn=Nn[Sn],Rn=Wn.outboundLayer,tr=Wn.inputTensors,rr=Wn.outputTensors,dr=new Array,Tr=0,Vr=tr;Tr<Vr.length;Tr++)(Ge=Vr[Tr]).id in te&&dr.push(te[Ge.id]);if(dr.length===tr.length){var xr={},$r=void 0,Wr=void 0,ai=void 0,li=void 0;if(Wn.callArgs!=null&&(xr=Wn.callArgs),dr.length===1){var Hr=dr[0],ni=Hr[0],to=Hr[1];xr.mask==null&&(xr.mask=to),ai=Ae(Rn.call(ni,xr)),li=Ae(Rn.computeMask(ni,to)),$r=[ni],Wr=[to]}else $r=dr.map(function(Fi){return Fi[0]}),Wr=dr.map(function(Fi){return Fi[1]}),xr.mask==null&&(xr.mask=Wr),ai=Ae(Rn.call($r,xr)),li=Ae(Rn.computeMask($r,Wr));if(Rn.activityRegularizer)throw new I("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(Be=0;Be<rr.length;++Be)Ge=rr[Be],ft=ai[Be],Tt=li[Be],te[Ge.id]=[ft,Tt]}}for(var Qi=[],zo=[],ji=[],no=0,ia=this.outputs;no<ia.length;no++){K((Ge=ia[no]).id in te,"Could not compute output "+Ge.name+" : "+Ge.id);var jo=te[Ge.id],Jo=jo[0];Tt=jo[1],ji.push(Jo.shape),Qi.push(Jo),zo.push(Tt)}return[Qi,zo,ji]},G.prototype.buildNodeConversionMap=function(C){for(var N,te={},Be=0,Ge=this.layers;Be<Ge.length;Be++){var ft=Ge[Be];N=ft instanceof G?1:0;for(var Tt=0;Tt<ft.inboundNodes.length;Tt++){var Wt=G.nodeKey(ft,Tt);this.containerNodes.has(Wt)&&(te[Wt]=N,N+=1)}}return te},G.prototype.getLayer=function(C,N){if(N!=null){if(this.layers.length<=N)throw new ee("Was asked to retrieve layer at index "+N+", but model only has "+this.layers.length+" layer(s).");return this.layers[N]}if(C==null)throw new ee("Provide either a layer name or layer index");for(var te=0,Be=this.layers;te<Be.length;te++){var Ge=Be[te];if(Ge.name===C)return Ge}throw new ee("No such layer: "+C)},G.prototype.calculateLosses=function(){var C=this;return Object(b.tidy)(function(){for(var N=[],te=0,Be=C.layers;te<Be.length;te++)for(var Ge=Be[te],ft=0;ft<Ge.inboundNodes.length;++ft){var Tt=G.nodeKey(Ge,ft);C.containerNodes.has(Tt)&&N.push.apply(N,Ge.calculateLosses())}return N})},G.prototype.getConfig=function(){for(var C={name:this.name},N=this.buildNodeConversionMap(this.layers),te=[],Be=0,Ge=this.layers;Be<Ge.length;Be++){for(var ft=(xr=Ge[Be]).getClassName(),Tt=xr.getConfig(),Wt=[],ct=0;ct<xr.inboundNodes.length;ct++){var bn=xr.inboundNodes[ct],Sn=G.nodeKey(xr,ct),Nn={};if(this.containerNodes.has(Sn)){if(bn.callArgs)try{JSON.stringify(bn.callArgs),Nn=bn.callArgs}catch{console.warn("Layer "+xr.name+" was passed non-serializable keyword arguments: "+bn.callArgs+". They will not be included in the serialized model (and thus will be missing at deserialization time)."),Nn={}}if(bn.inboundLayers.length>0){for(var Wn=[],Rn=0;Rn<bn.inboundLayers.length;Rn++){var tr=bn.inboundLayers[Rn],rr=bn.nodeIndices[Rn],dr=bn.tensorIndices[Rn];(Wr=N[G.nodeKey(tr,rr)])==null&&(Wr=0),Wn.push([tr.name,Wr,dr,Nn])}Wt.push(Wn)}}}var Tr={};Tr.name=xr.name,Tr.className=ft,Tr.config=Tt,Tr.inboundNodes=Wt,te.push(Tr)}C.layers=te;var Vr=[];for(Rn=0;Rn<this.inputLayers.length;Rn++){var xr=this.inputLayers[Rn];rr=this.inputLayersNodeIndices[Rn],Sn=G.nodeKey(xr,rr),this.containerNodes.has(Sn)&&((Wr=N[Sn])!==null&&Wr!==void 0||(Wr=0),dr=this.inputLayersTensorIndices[Rn],Vr.push([xr.name,Wr,dr]))}C.inputLayers=Vr;var $r=[];for(Rn=0;Rn<this.outputLayers.length;Rn++){var Wr;xr=this.outputLayers[Rn],rr=this.outputLayersNodeIndices[Rn],Sn=G.nodeKey(xr,rr),this.containerNodes.has(Sn)&&((Wr=N[Sn])!==null&&Wr!==void 0||(Wr=0),dr=this.outputLayersTensorIndices[Rn],$r.push([xr.name,Wr,dr]))}return C.outputLayers=$r,C},G.fromConfig=function(C,N,te,Be){Be===void 0&&(Be=!1);var Ge={},ft={};function Tt(no,ia){no.name in ft?ft[no.name].push(ia):ft[no.name]=[ia]}function Wt(no,ia){for(var jo,Jo=[],Fi=0,Di=ia;Fi<Di.length;Fi++){var mo=Di[Fi],la=mo[0],ha=mo[1],aa=mo[2];if(jo=mo[3]==null?{}:mo[3],!(la in Ge))return void Tt(no,ia);var Qo=Ge[la];if(Qo.inboundNodes.length<=ha)return void Tt(no,ia);var Za=Qo.inboundNodes[ha];Jo.push(Za.outputTensors[aa])}Jo.length>0&&no.apply(pe(Jo),jo)}function ct(no){var ia=no.name,jo=Fa(no,N.customObjects!=null?N.customObjects:{});jo.setFastWeightInitDuringBuild(Be),Ge[ia]=jo,no.inboundNodes.forEach(function(Jo){if(!(Jo instanceof Array))throw new ee("Corrupted configuration, expected array for nodeData: "+Jo);Tt(jo,Jo)})}for(var bn=N.name,Sn=N.layers,Nn=0,Wn=Sn;Nn<Wn.length;Nn++)ct(rr=Wn[Nn]);for(;!ke(ft);)for(var Rn=0,tr=Sn;Rn<tr.length;Rn++){var rr=tr[Rn];if((ji=Ge[rr.name]).name in ft){var dr=ft[ji.name];delete ft[ji.name];for(var Tr=0,Vr=dr;Tr<Vr.length;Tr++)Wt(ji,Vr[Tr])}}for(var xr=[],$r=[],Wr=0,ai=N.inputLayers;Wr<ai.length;Wr++){var li=(rr=ai[Wr])[0],Hr=rr[1],ni=rr[2];K(li in Ge);var to=(ji=Ge[li]).inboundNodes[Hr].outputTensors;xr.push(to[ni])}for(var Qi=0,zo=N.outputLayers;Qi<zo.length;Qi++){var ji;li=(rr=zo[Qi])[0],Hr=rr[1],ni=rr[2],K(li in Ge),to=(ji=Ge[li]).inboundNodes[Hr].outputTensors,$r.push(to[ni])}return new C({inputs:xr,outputs:$r,name:bn})},Object.defineProperty(G.prototype,"stateful",{get:function(){if(this._stateful)throw new ee("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");for(var C=0,N=this.layers;C<N.length;C++)if(N[C].stateful)return!0;return!1},enumerable:!0,configurable:!0}),G.prototype.resetStates=function(){var C=this;Object(b.tidy)(function(){C.layers.forEach(function(N){N.stateful&&N.resetStates()})})},G}(qi));function tu(Q,G){return J(this,void 0,void 0,function(){var C;return R(this,function(N){if(G==null&&(G={}),typeof Q=="string"){if((C=b.io.getLoadHandlers(Q,G.onProgress)).length===0)C.push(b.io.browserHTTPRequest(Q,G));else if(C.length>1)throw new ee("Found more than one ("+C.length+") load handlers for URL '"+Q+"'");Q=C[0]}return[2,function(te,Be,Ge){return J(this,void 0,void 0,function(){var ft,Tt,Wt,ct,bn,Sn,Nn,Wn,Rn;return R(this,function(tr){switch(tr.label){case 0:if(Ge==null&&(Ge={}),te.load==null)throw new ee("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");return[4,te.load()];case 1:if(ft=tr.sent(),(Tt=ft.modelTopology).model_config!=null&&(Tt=Tt.model_config),Wt=Ge.strict==null||Ge.strict,ct=ft.weightData!=null&&ft.weightSpecs!=null&&Wt,bn=Fa(Ii(Tt),Be,ct),(Sn=ft.trainingConfig)!=null&&bn.loadTrainingConfig(Sn),ft.userDefinedMetadata!=null&&bn.setUserDefinedMetadata(ft.userDefinedMetadata),ft.weightData==null)return[3,4];if(ft.weightSpecs==null)throw new ee("LayersModel artifacts contains weight data, but not weight specs. Therefore loading of weights cannot proceed.");return Nn=function(rr,dr){var Tr=b.io.decodeWeights(rr,dr),Vr={},xr=[];return dr.forEach(function($r){$r.group==="optimizer"?xr.push({name:$r.name,tensor:Tr[$r.name]}):Vr[$r.name]=Tr[$r.name]}),{modelWeights:Vr,optimizerWeights:xr}}(ft.weightData,ft.weightSpecs),Wn=Nn.modelWeights,Rn=Nn.optimizerWeights,bn.loadWeights(Wn,Wt),bn.optimizer!=null&&Rn.length>0?[4,bn.optimizer.setWeights(Rn)]:[3,3];case 2:tr.sent(),tr.label=3;case 3:Object(b.dispose)(Wn),Object(b.dispose)(Rn.map(function(rr){return rr.tensor})),tr.label=4;case 4:return[2,bn]}})})}(Q,void 0,G)]})})}b.serialization.registerClass(kc);var wt=function(Q){function G(C){var N=Q.call(this,{inputs:[],outputs:[]})||this;if(C=C||{},N.trainable=!0,N.built=!1,N.name=C.name!=null?C.name:Zi("sequential_"),C.layers!=null)for(var te=0,Be=C.layers;te<Be.length;te++){var Ge=Be[te];N.add(Ge)}return N}return U(G,Q),G.prototype.checkShape=function(C){if(C.inboundNodes[0].outputTensors[0].shape.some(function(N){return N<0}))throw new ee("Negative dimension size caused by adding layer "+C.name+" with input shape ["+C.inboundNodes[0].inputTensors[0].shape+"]")},G.prototype.add=function(C){var N,te=C instanceof G||C instanceof kc;if(te){if((N=C).outputs.length!==1)throw new ee("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(N.inputs.length!==1)throw new ee("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(this.outputs.length===0){if(C.inboundNodes.length===0){if(C.batchInputShape==null)throw new ee("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");var Be=bc({batchShape:C.batchInputShape,dtype:C.dtype,name:C.name+"_input"});C.apply(Be)}if(te)this.outputs=N.outputs,this.inputs=N.inputs;else{if(C.inboundNodes.length!==1)throw new ee("A layer added to a Sequential model must not already be connected somewhere else. LayersModel received layer "+C.name+" which has "+C.inboundNodes.length+" pre-existing inbound connections.");if(C.inboundNodes[0].outputTensors.length!==1)throw new ee("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(C),this.outputs=[C.inboundNodes[0].outputTensors[0]],this.inputs=function ft(Tt,Wt,ct){if((Wt==null||ct!=null&&ct>0)&&(Wt=Tt.sourceLayer,ct=Tt.nodeIndex),Wt.inboundNodes.length===0)return[Tt];var bn=Wt.inboundNodes[ct];if(bn.inboundLayers.length===0)return bn.inputTensors;for(var Sn=[],Nn=0;Nn<bn.inboundLayers.length;Nn++)for(var Wn=0,Rn=ft(bn.inputTensors[Nn],bn.inboundLayers[Nn],bn.nodeIndices[Nn]);Wn<Rn.length;Wn++){var tr=Rn[Wn];Sn.indexOf(tr)===-1&&Sn.push(tr)}return Sn}(this.outputs[0])}this.inboundNodes=[],new vs({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:ie(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map(function(ft){return ft.shape}),outputShapes:this.outputs[0].shape})}else{var Ge=C.apply(this.outputs[0]);if(Array.isArray(Ge))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(C),this.outputs=[Ge],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(C),this.built=!1},G.prototype.pop=function(){if(this.layers.length===0)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),this.layers.length===0)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{var C=this.layers.length-1;this.layers[C].outboundNodes=[],this.outputs=[this.layers[C].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}},G.prototype.call=function(C,N){return this.model==null&&this.build(),this.model.call(C,N)},G.prototype.build=function(C){if(jn(C),this.inputs.length===0||this.outputs.length===0)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new kc({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0},G.prototype.countParams=function(){return this.built||this.build(),Q.prototype.countParams.call(this)},G.prototype.summary=function(C,N,te){te===void 0&&(te=console.log),this.built||this.build(),Q.prototype.summary.call(this,C,N,te)},G.prototype.setWeights=function(C){this.model==null&&this.build(),this.model.setWeights(C)},G.prototype.evaluate=function(C,N,te){if(te===void 0&&(te={}),!this.built)throw new P("The model needs to be compiled before being used.");return this.model.evaluate(C,N,te)},G.prototype.evaluateDataset=function(C,N){return J(this,void 0,void 0,function(){return R(this,function(te){if(!this.built)throw new P("The model needs to be compiled before being used.");return[2,this.model.evaluateDataset(C,N)]})})},G.prototype.predict=function(C,N){return N===void 0&&(N={}),this.model==null&&this.build(),this.model.predict(C,N)},G.prototype.predictOnBatch=function(C){return this.model==null&&this.build(),this.model.predictOnBatch(C)},G.prototype.compile=function(C){this.build(),this.model.compile(C),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames},Object.defineProperty(G.prototype,"optimizer",{get:function(){return this.model==null?void 0:this.model.optimizer},set:function(C){this.model.optimizer=C},enumerable:!0,configurable:!0}),G.prototype.fit=function(C,N,te){return te===void 0&&(te={}),J(this,void 0,void 0,function(){return R(this,function(Be){if(!this.built)throw new P("The model needs to be compiled before being used.");return[2,this.model.fit(C,N,te)]})})},G.prototype.fitDataset=function(C,N){return J(this,void 0,void 0,function(){return R(this,function(te){if(!this.built)throw new P("The model needs to be compiled before being used.");return[2,this.model.fitDataset(C,N)]})})},G.prototype.trainOnBatch=function(C,N){return J(this,void 0,void 0,function(){return R(this,function(te){return[2,this.model.trainOnBatch(C,N)]})})},G.fromConfig=function(C,N,te,Be){var Ge;Be===void 0&&(Be=!1);var ft={};if(N instanceof Array){if(N[0].className==null||N[0].className==="Merge")throw new ee("Legacy serialization format not supported yet.");Ge=N}else b.util.assert(N.layers!=null,function(){return"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field."}),Ge=N.layers,delete N.layers,ft=N;var Tt=new C(ft);if(!(Tt instanceof G))throw new I("Sequential.fromConfig called on non-Sequential input: "+Tt);for(var Wt=0,ct=Ge;Wt<ct.length;Wt++){var bn=Fa(ct[Wt],void 0,Be);Be&&bn.setFastWeightInitDuringBuild(!0),Tt.add(bn)}return Tt},Object.defineProperty(G.prototype,"stopTraining",{get:function(){if(this.model==null)throw new ee("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining},set:function(C){if(this.model==null)throw new ee("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=C},enumerable:!0,configurable:!0}),G.prototype.getConfig=function(){for(var C=[],N=0,te=this.layers;N<te.length;N++){var Be=te[N],Ge={};Ge.className=Be.getClassName(),Ge.config=Be.getConfig(),C.push(Ge)}return{name:this.name,layers:C}},G.className="Sequential",G}(kc);function ho(Q){return new kc(Q)}function ca(Q){return new wt(Q)}function Ua(Q,G){return G==null&&(G={}),tu(Q,G)}function ko(Q){return bc(Q)}function xs(Q,G){wc.registerCallbackConstructor(Q,G)}b.serialization.registerClass(wt);var fr=function(Q){function G(){return Q!==null&&Q.apply(this,arguments)||this}return U(G,Q),G.prototype.getConfig=function(){return{}},G}(b.serialization.Serializable),Us=function(Q){function G(){return Q!==null&&Q.apply(this,arguments)||this}return U(G,Q),G.prototype.apply=function(C,N){return N===void 0&&(N=1),function(te,Be){if(Be===void 0&&(Be=1),Be!==1)throw new I("Support for alpha values other than 1 ("+Be+") is not implemented yet.");return Object(b.elu)(te)}(C,N)},G.className="elu",G}(fr);b.serialization.registerClass(Us);var nu=function(Q){function G(){return Q!==null&&Q.apply(this,arguments)||this}return U(G,Q),G.prototype.apply=function(C){return Object(b.selu)(C)},G.className="selu",G}(fr);b.serialization.registerClass(nu);var Hc=function(Q){function G(){return Q!==null&&Q.apply(this,arguments)||this}return U(G,Q),G.prototype.apply=function(C){return Object(b.relu)(C)},G.className="relu",G}(fr);b.serialization.registerClass(Hc);var Ws=function(Q){function G(){return Q!==null&&Q.apply(this,arguments)||this}return U(G,Q),G.prototype.apply=function(C){return Object(b.tidy)(function(){return Object(b.minimum)(6,Object(b.relu)(C))})},G.className="relu6",G}(fr);b.serialization.registerClass(Ws);var Nh=function(Q){function G(){return Q!==null&&Q.apply(this,arguments)||this}return U(G,Q),G.prototype.apply=function(C){return C},G.className="linear",G}(fr);b.serialization.registerClass(Nh);var jd=function(Q){function G(){return Q!==null&&Q.apply(this,arguments)||this}return U(G,Q),G.prototype.apply=function(C){return Object(b.sigmoid)(C)},G.className="sigmoid",G}(fr);b.serialization.registerClass(jd);var Bd=function(Q){function G(){return Q!==null&&Q.apply(this,arguments)||this}return U(G,Q),G.prototype.apply=function(C){return function(N){return Object(b.tidy)(function(){var te=Object(b.add)(.5,Object(b.mul)(.2,N));return Object(b.clipByValue)(te,0,1)})}(C)},G.className="hardSigmoid",G}(fr);b.serialization.registerClass(Bd);var lu=function(Q){function G(){return Q!==null&&Q.apply(this,arguments)||this}return U(G,Q),G.prototype.apply=function(C){return Object(b.softplus)(C)},G.className="softplus",G}(fr);b.serialization.registerClass(lu);var Ki=function(Q){function G(){return Q!==null&&Q.apply(this,arguments)||this}return U(G,Q),G.prototype.apply=function(C){return function(N){return Object(b.tidy)(function(){return Object(b.div)(N,Object(b.abs)(N).add(1))})}(C)},G.className="softsign",G}(fr);b.serialization.registerClass(Ki);var ws=function(Q){function G(){return Q!==null&&Q.apply(this,arguments)||this}return U(G,Q),G.prototype.apply=function(C){return Object(b.tanh)(C)},G.className="tanh",G}(fr);b.serialization.registerClass(ws);var Fh=function(Q){function G(){return Q!==null&&Q.apply(this,arguments)||this}return U(G,Q),G.prototype.apply=function(C,N){return N===void 0&&(N=-1),Object(b.softmax)(C,N)},G.className="softmax",G}(fr);b.serialization.registerClass(Fh);var oc=function(Q){function G(){return Q!==null&&Q.apply(this,arguments)||this}return U(G,Q),G.prototype.apply=function(C,N){return N===void 0&&(N=-1),Object(b.logSoftmax)(C,N)},G.className="logSoftmax",G}(fr);function us(Q){return Q.getClassName()}function ii(Q,G){return G===void 0&&(G={}),_t(Q,b.serialization.SerializationMap.getMap().classNameMap,G,"activation")}function Po(Q){var G;return Q==null?ii(G={className:"linear",config:{}}):typeof Q=="string"?((G={}).className=Q,G.config={},ii(G)):Q instanceof fr?Q:ii(Q)}function Ih(Q){if(Q!=null&&typeof Q!="object")throw new Error("Argument to L1L2 regularizer's constructor is expected to be an object, but received: "+Q)}b.serialization.registerClass(oc);var Pd=function(Q){function G(){return Q!==null&&Q.apply(this,arguments)||this}return U(G,Q),G}(b.serialization.Serializable),Al=function(Q){function G(C){var N=Q.call(this)||this;return Ih(C),N.l1=C==null||C.l1==null?.01:C.l1,N.l2=C==null||C.l2==null?.01:C.l2,N.hasL1=N.l1!==0,N.hasL2=N.l2!==0,N}return U(G,Q),G.prototype.apply=function(C){var N=this;return Object(b.tidy)(function(){var te=Object(b.zeros)([1]);return N.hasL1&&(te=Object(b.add)(te,Object(b.sum)(Object(b.mul)(N.l1,Object(b.abs)(C))))),N.hasL2&&(te=Object(b.add)(te,Object(b.sum)(Object(b.mul)(N.l2,Wi(C))))),te.asScalar()})},G.prototype.getConfig=function(){return{l1:this.l1,l2:this.l2}},G.fromConfig=function(C,N){return new C({l1:N.l1,l2:N.l2})},G.className="L1L2",G}(Pd);b.serialization.registerClass(Al);var Rh={l1l2:"L1L2"};function Ri(Q){return ot(Q)}function bi(Q,G){return G===void 0&&(G={}),_t(Q,b.serialization.SerializationMap.getMap().classNameMap,G,"regularizer")}function oa(Q){return Q==null?null:typeof Q=="string"?bi({className:Q in Rh?Rh[Q]:Q,config:{}}):Q instanceof Pd?Q:bi(Q)}var Ld=function(Q){function G(C){var N=Q.call(this,C??{})||this;return N.supportsMasking=!0,C!=null&&(N.maxValue=C.maxValue),N}return U(G,Q),G.prototype.call=function(C,N){C=jr(C);var te=Object(b.relu)(C);return this.maxValue!=null&&(te=Object(b.clipByValue)(te,0,this.maxValue)),te},G.prototype.computeOutputShape=function(C){return C},G.prototype.getConfig=function(){var C={maxValue:this.maxValue},N=Q.prototype.getConfig.call(this);return Object.assign(C,N),C},G.className="ReLU",G}(qi);b.serialization.registerClass(Ld);var zd=function(Q){function G(C){var N=Q.call(this,C??{})||this;return N.DEFAULT_ALPHA=.3,C==null&&(C={}),N.alpha=C.alpha==null?N.DEFAULT_ALPHA:C.alpha,N}return U(G,Q),G.prototype.call=function(C,N){var te=jr(C);return Object(b.leakyRelu)(te,this.alpha)},G.prototype.computeOutputShape=function(C){return C},G.prototype.getConfig=function(){var C={alpha:this.alpha},N=Q.prototype.getConfig.call(this);return Object.assign(C,N),C},G.className="LeakyReLU",G}(qi);b.serialization.registerClass(zd);var Ud=function(Q){function G(C){var N=Q.call(this,C??{})||this;if(N.DEFAULT_ALPHA_INITIALIZER="zeros",C==null&&(C={}),N.supportsMasking=!0,N.alphaInitializer=zr(C.alphaInitializer||N.DEFAULT_ALPHA_INITIALIZER),N.alphaRegularizer=oa(C.alphaRegularizer),N.alphaConstraint=Hn(C.alphaConstraint),C.sharedAxes==null)N.sharedAxes=null;else if(Array.isArray(C.sharedAxes))N.sharedAxes=C.sharedAxes;else{if(typeof C.sharedAxes!="number")throw new ee("Expected sharedAxes to be a number or an array of numbers, but got "+C.sharedAxes);N.sharedAxes=[C.sharedAxes]}return N}return U(G,Q),G.prototype.build=function(C){var N=(C=jn(C)).slice(1);if(this.sharedAxes!=null)for(var te=0,Be=this.sharedAxes;te<Be.length;te++)N[(ft=Be[te])-1]=1;this.alpha=this.addWeight("alpha",N,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);var Ge={};if(this.sharedAxes!=null)for(var ft=1;ft<C.length;++ft)Ge[ft]=C[ft];this.inputSpec=[new eo({ndim:C.length,axes:Ge})],this.built=!0},G.prototype.call=function(C,N){return C=jr(C),Object(b.prelu)(C,this.alpha.read())},G.prototype.getConfig=function(){var C={alphaInitializer:ir(this.alphaInitializer),alphaRegularizer:Ri(this.alphaRegularizer),alphaConstraint:wn(this.alphaConstraint),sharedAxes:this.sharedAxes},N=Q.prototype.getConfig.call(this);return Object.assign(C,N),C},G.className="PReLU",G}(qi);b.serialization.registerClass(Ud);var Rp=function(Q){function G(C){var N=Q.call(this,C??{})||this;if(N.DEFAULT_ALPHA=1,C==null&&(C={}),C.alpha!=null&&C.alpha!==N.DEFAULT_ALPHA)throw new I("Non-default alpha value ("+C.alpha+") is not supported by the ELU layer yet.");return N.alpha=C.alpha==null?N.DEFAULT_ALPHA:C.alpha,N}return U(G,Q),G.prototype.call=function(C,N){var te=jr(C);return Object(b.elu)(te)},G.prototype.computeOutputShape=function(C){return C},G.prototype.getConfig=function(){var C={alpha:this.alpha},N=Q.prototype.getConfig.call(this);return Object.assign(C,N),C},G.className="ELU",G}(qi);b.serialization.registerClass(Rp);var zu=function(Q){function G(C){var N=Q.call(this,C??{})||this;return N.DEFAULT_THETA=1,C==null&&(C={}),N.theta=C.theta==null?N.DEFAULT_THETA:C.theta,N}return U(G,Q),G.prototype.call=function(C,N){var te=jr(C);return te.mul(wr(te.greater(this.theta),"float32"))},G.prototype.computeOutputShape=function(C){return C},G.prototype.getConfig=function(){var C={theta:this.theta},N=Q.prototype.getConfig.call(this);return Object.assign(C,N),C},G.className="ThresholdedReLU",G}(qi);b.serialization.registerClass(zu);var ks=function(Q){function G(C){var N=Q.call(this,C??{})||this;return N.DEFAULT_AXIS=1,C==null&&(C={}),N.softmax=new Fh().apply,N.axis=C.axis==null?N.DEFAULT_AXIS:C.axis,N}return U(G,Q),G.prototype.call=function(C,N){var te=jr(C);return this.softmax(te,this.axis)},G.prototype.computeOutputShape=function(C){return C},G.prototype.getConfig=function(){var C={axis:this.axis},N=Q.prototype.getConfig.call(this);return Object.assign(C,N),C},G.className="Softmax",G}(qi);function $c(Q,G,C){if(typeof Q=="number")return ie(Q,G);if(Q.length!==G)throw new ee("The "+C+" argument must be an integer or tuple of "+G+" integers. Received: "+Q.length+" elements.");for(var N=0;N<G;++N){var te=Q[N];if(!an(te))throw new ee("The "+C+" argument must be an integer or tuple of "+G+" integers. Received: "+JSON.stringify(Q)+" including a non-integer number "+te)}return Q}function Is(Q,G,C,N,te){return te===void 0&&(te=1),Q==null?Q:(Be=C==="same"?Q:Q-(G+(G-1)*(te-1))+1,Math.floor((Be+N-1)/N));var Be}function ru(Q,G,C,N){if(Q==null)return null;if(N==="valid")Q=Q*G+Dn([C-G,0]);else{if(N!=="same")throw new ee("Unsupport padding mode: "+N+".");Q*=G}return Q}function Mh(Q,G){return Object(b.tidy)(function(){return zt(G),G==="channelsFirst"?Object(b.transpose)(Q,[0,2,3,1]):Q})}function Ni(Q,G){return Object(b.tidy)(function(){return zt(G),G==="channelsFirst"?Object(b.transpose)(Q,[0,2,3,4,1]):Q})}function Sf(Q,G,C,N,te,Be,Ge,ft){return N===void 0&&(N=[1,1]),te===void 0&&(te="valid"),ft===void 0&&(ft=null),Object(b.tidy)(function(){if(Be==null&&(Be="channelsLast"),zt(Be),Q.rank!==3&&Q.rank!==4)throw new ee("conv2dWithBiasActivation expects input to be of rank 3 or 4, but received "+Q.rank+".");if(G.rank!==3&&G.rank!==4)throw new ee("conv2dWithBiasActivation expects kernel to be of rank 3 or 4, but received "+Q.rank+".");var Tt=Mh(Q,Be);if(te==="causal")throw new I("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return Tt=b.fused.conv2d({x:Tt,filter:G,strides:N,pad:te==="same"?"same":"valid",dilations:Ge,dataFormat:"NHWC",bias:C,activation:ft}),Be==="channelsFirst"&&(Tt=Object(b.transpose)(Tt,[0,3,1,2])),Tt})}b.serialization.registerClass(ks);var Gc=function(Q){function G(C,N){var te=Q.call(this,N)||this;if(te.bias=null,te.DEFAULT_KERNEL_INITIALIZER="glorotNormal",te.DEFAULT_BIAS_INITIALIZER="zeros",G.verifyArgs(N),te.rank=C,jt(te.rank,"rank"),te.rank!==1&&te.rank!==2&&te.rank!==3)throw new I("Convolution layer for rank other than 1, 2, or 3 ("+te.rank+") is not implemented yet.");if(te.kernelSize=$c(N.kernelSize,C,"kernelSize"),te.strides=$c(N.strides==null?1:N.strides,C,"strides"),te.padding=N.padding==null?"valid":N.padding,Tn(te.padding),te.dataFormat=N.dataFormat==null?"channelsLast":N.dataFormat,zt(te.dataFormat),te.activation=Po(N.activation),te.useBias=N.useBias==null||N.useBias,te.biasInitializer=zr(N.biasInitializer||te.DEFAULT_BIAS_INITIALIZER),te.biasConstraint=Hn(N.biasConstraint),te.biasRegularizer=oa(N.biasRegularizer),te.activityRegularizer=oa(N.activityRegularizer),te.dilationRate=$c(N.dilationRate==null?1:N.dilationRate,C,"dilationRate"),te.rank===1&&Array.isArray(te.dilationRate)&&te.dilationRate.length!==1)throw new ee("dilationRate must be a number or an array of a single number for 1D convolution, but received "+JSON.stringify(te.dilationRate));if(te.rank===2){if(typeof te.dilationRate=="number")te.dilationRate=[te.dilationRate,te.dilationRate];else if(te.dilationRate.length!==2)throw new ee("dilationRate must be a number or array of two numbers for 2D convolution, but received "+JSON.stringify(te.dilationRate))}else if(te.rank===3){if(typeof te.dilationRate=="number")te.dilationRate=[te.dilationRate,te.dilationRate,te.dilationRate];else if(te.dilationRate.length!==3)throw new ee("dilationRate must be a number or array of three numbers for 3D convolution, but received "+JSON.stringify(te.dilationRate))}return te}return U(G,Q),G.verifyArgs=function(C){if(K("kernelSize"in C,"required key 'kernelSize' not in config"),typeof C.kernelSize!="number"&&!Gt(C.kernelSize,"number",1,3))throw new ee("BaseConv expects config.kernelSize to be number or number[] with length 1, 2, or 3, but received "+JSON.stringify(C.kernelSize)+".")},G.prototype.getConfig=function(){var C={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:us(this.activation),useBias:this.useBias,biasInitializer:ir(this.biasInitializer),biasRegularizer:Ri(this.biasRegularizer),activityRegularizer:Ri(this.activityRegularizer),biasConstraint:wn(this.biasConstraint)},N=Q.prototype.getConfig.call(this);return Object.assign(C,N),C},G}(qi),Sl=function(Q){function G(C,N){var te=Q.call(this,C,N)||this;return te.kernel=null,G.verifyArgs(N),te.filters=N.filters,jt(te.filters,"filters"),te.kernelInitializer=zr(N.kernelInitializer||te.DEFAULT_KERNEL_INITIALIZER),te.kernelConstraint=Hn(N.kernelConstraint),te.kernelRegularizer=oa(N.kernelRegularizer),te}return U(G,Q),G.prototype.build=function(C){var N;C=jn(C);var te=this.dataFormat==="channelsFirst"?1:C.length-1;if(C[te]==null)throw new ee("The channel dimension of the input should be defined. Found "+C[te]);var Be=C[te],Ge=this.kernelSize.concat([Be,this.filters]);this.kernel=this.addWeight("kernel",Ge,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:(N={},N[te]=Be,N)}],this.built=!0},G.prototype.call=function(C,N){var te=this;return Object(b.tidy)(function(){var Be;C=jr(C);var Ge=te.bias==null?null:te.bias.read(),ft=Ye(te.activation.getClassName());if(ft!=null&&te.rank===2)Be=Sf(C,te.kernel.read(),Ge,te.strides,te.padding,te.dataFormat,te.dilationRate,ft);else{if(te.rank===1)Be=function(Tt,Wt,ct,bn,Sn,Nn,Wn){return bn===void 0&&(bn=1),Sn===void 0&&(Sn="valid"),Wn===void 0&&(Wn=1),Object(b.tidy)(function(){if(Nn==null&&(Nn="channelsLast"),zt(Nn),Tt.shape.length!==3)throw new ee("The input of a conv1dWithBias operation should be 3, but is "+Tt.shape.length+" instead.");if(Wt.shape.length!==3)throw new ee("The kernel for a conv1dWithBias operation should be 3, but is "+Wt.shape.length+" instead");if(ct!=null&&ct.shape.length!==1)throw new ee("The bias for a conv1dWithBias operation should be 1, but is "+Wt.shape.length+" instead");if(Nn==="channelsFirst"&&(Tt=Object(b.transpose)(Tt,[0,2,1])),Sn==="causal")throw new I("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");var Rn=Object(b.conv1d)(Tt,Wt,bn,Sn==="same"?"same":"valid","NWC",Wn);return ct!=null&&(Rn=bt(Rn,ct)),Rn})}(C,te.kernel.read(),Ge,te.strides[0],te.padding,te.dataFormat,te.dilationRate[0]);else if(te.rank===2)Be=Sf(C,te.kernel.read(),Ge,te.strides,te.padding,te.dataFormat,te.dilationRate);else{if(te.rank!==3)throw new I("convolutions greater than 3D are not implemented yet.");Be=function(Tt,Wt,ct,bn,Sn,Nn,Wn){return bn===void 0&&(bn=[1,1,1]),Sn===void 0&&(Sn="valid"),Object(b.tidy)(function(){if(Nn==null&&(Nn="channelsLast"),zt(Nn),Tt.rank!==4&&Tt.rank!==5)throw new ee("conv3dWithBias expects input to be of rank 4 or 5, but received "+Tt.rank+".");if(Wt.rank!==4&&Wt.rank!==5)throw new ee("conv3dWithBias expects kernel to be of rank 4 or 5, but received "+Tt.rank+".");var Rn=Ni(Tt,Nn);if(Sn==="causal")throw new I("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return Rn=Object(b.conv3d)(Rn,Wt,bn,Sn==="same"?"same":"valid","NDHWC",Wn),ct!=null&&(Rn=bt(Rn,ct)),Nn==="channelsFirst"&&(Rn=Object(b.transpose)(Rn,[0,4,1,2,3])),Rn})}(C,te.kernel.read(),Ge,te.strides,te.padding,te.dataFormat,te.dilationRate)}te.activation!=null&&(Be=te.activation.apply(Be))}return Be})},G.prototype.computeOutputShape=function(C){C=jn(C);for(var N=[],te=this.dataFormat==="channelsLast"?C.slice(1,C.length-1):C.slice(2),Be=0;Be<te.length;++Be){var Ge=Is(te[Be],this.kernelSize[Be],this.padding,this.strides[Be],typeof this.dilationRate=="number"?this.dilationRate:this.dilationRate[Be]);N.push(Ge)}var ft=[C[0]];return this.dataFormat==="channelsLast"?(ft=ft.concat(N)).push(this.filters):(ft.push(this.filters),ft=ft.concat(N)),ft},G.prototype.getConfig=function(){var C={filters:this.filters,kernelInitializer:ir(this.kernelInitializer),kernelRegularizer:Ri(this.kernelRegularizer),kernelConstraint:wn(this.kernelConstraint)},N=Q.prototype.getConfig.call(this);return Object.assign(C,N),C},G.verifyArgs=function(C){if(!("filters"in C)||typeof C.filters!="number"||C.filters<1)throw new ee("Convolution layer expected config.filters to be a 'number' > 0 but got "+JSON.stringify(C.filters))},G}(Gc),Wd=function(Q){function G(C){var N=Q.call(this,2,C)||this;return G.verifyArgs(C),N}return U(G,Q),G.prototype.getConfig=function(){var C=Q.prototype.getConfig.call(this);return delete C.rank,C},G.verifyArgs=function(C){if(typeof C.kernelSize!="number"&&!Gt(C.kernelSize,"number",1,2))throw new ee("Conv2D expects config.kernelSize to be number or number[] with length 1 or 2, but received "+JSON.stringify(C.kernelSize)+".")},G.className="Conv2D",G}(Sl);b.serialization.registerClass(Wd);var Mp=function(Q){function G(C){var N=Q.call(this,3,C)||this;return G.verifyArgs(C),N}return U(G,Q),G.prototype.getConfig=function(){var C=Q.prototype.getConfig.call(this);return delete C.rank,C},G.verifyArgs=function(C){if(typeof C.kernelSize!="number"&&(!Array.isArray(C.kernelSize)||C.kernelSize.length!==1&&C.kernelSize.length!==3))throw new ee("Conv3D expects config.kernelSize to be number or [number, number, number], but received "+JSON.stringify(C.kernelSize)+".")},G.className="Conv3D",G}(Sl);b.serialization.registerClass(Mp);var _l=function(Q){function G(C){var N=Q.call(this,C)||this;if(N.inputSpec=[new eo({ndim:4})],N.padding!=="same"&&N.padding!=="valid")throw new ee("Conv2DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode "+N.padding);return N}return U(G,Q),G.prototype.build=function(C){var N;if((C=jn(C)).length!==4)throw new ee("Input should have rank 4; Received input shape: "+JSON.stringify(C));var te=this.dataFormat==="channelsFirst"?1:C.length-1;if(C[te]==null)throw new ee("The channel dimension of the inputs should be defined. Found `None`.");var Be=C[te],Ge=this.kernelSize.concat([this.filters,Be]);this.kernel=this.addWeight("kernel",Ge,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new eo({ndim:4,axes:(N={},N[te]=Be,N)})],this.built=!0},G.prototype.call=function(C,N){var te=this;return Object(b.tidy)(function(){var Be=jr(C);if(Be.shape.length!==4)throw new ee("Conv2DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-"+Be.shape.length);var Ge,ft,Tt=Be.shape,Wt=Tt[0];te.dataFormat==="channelsFirst"?(Ge=2,ft=3):(Ge=1,ft=2);var ct=Tt[Ge],bn=Tt[ft],Sn=te.kernelSize[0],Nn=te.kernelSize[1],Wn=te.strides[0],Rn=te.strides[1],tr=[Wt,ru(ct,Wn,Sn,te.padding),ru(bn,Rn,Nn,te.padding),te.filters];te.dataFormat!=="channelsLast"&&(Be=Object(b.transpose)(Be,[0,2,3,1]));var rr=Object(b.conv2dTranspose)(Be,te.kernel.read(),tr,te.strides,te.padding);return te.dataFormat!=="channelsLast"&&(rr=Object(b.transpose)(rr,[0,3,1,2])),te.bias!=null&&(rr=bt(rr,te.bias.read(),te.dataFormat)),te.activation!=null&&(rr=te.activation.apply(rr)),rr})},G.prototype.computeOutputShape=function(C){var N,te,Be,Ge=(C=jn(C)).slice();this.dataFormat==="channelsFirst"?(N=1,te=2,Be=3):(N=3,te=1,Be=2);var ft=this.kernelSize[0],Tt=this.kernelSize[1],Wt=this.strides[0],ct=this.strides[1];return Ge[N]=this.filters,Ge[te]=ru(Ge[te],Wt,ft,this.padding),Ge[Be]=ru(Ge[Be],ct,Tt,this.padding),Ge},G.prototype.getConfig=function(){var C=Q.prototype.getConfig.call(this);return delete C.dilationRate,C},G.className="Conv2DTranspose",G}(Wd);b.serialization.registerClass(_l);var jh=function(Q){function G(C){return Q.call(this,2,C)||this}return U(G,Q),G.className="SeparableConv2D",G}(function(Q){function G(C,N){var te=Q.call(this,C,N)||this;if(te.DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",te.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",te.depthwiseKernel=null,te.pointwiseKernel=null,N.filters==null)throw new ee("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(N.kernelInitializer!=null||N.kernelRegularizer!=null||N.kernelConstraint!=null)throw new ee("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(N.padding!=null&&N.padding!=="same"&&N.padding!=="valid")throw new ee("SeparableConv"+te.rank+"D supports only padding modes: 'same' and 'valid', but received "+JSON.stringify(N.padding));return te.depthMultiplier=N.depthMultiplier==null?1:N.depthMultiplier,te.depthwiseInitializer=zr(N.depthwiseInitializer||te.DEFAULT_DEPTHWISE_INITIALIZER),te.depthwiseRegularizer=oa(N.depthwiseRegularizer),te.depthwiseConstraint=Hn(N.depthwiseConstraint),te.pointwiseInitializer=zr(N.depthwiseInitializer||te.DEFAULT_POINTWISE_INITIALIZER),te.pointwiseRegularizer=oa(N.pointwiseRegularizer),te.pointwiseConstraint=Hn(N.pointwiseConstraint),te}return U(G,Q),G.prototype.build=function(C){var N;if((C=jn(C)).length<this.rank+2)throw new ee("Inputs to SeparableConv"+this.rank+"D should have rank "+(this.rank+2)+", but received input shape: "+JSON.stringify(C));var te=this.dataFormat==="channelsFirst"?1:C.length-1;if(C[te]==null||C[te]<0)throw new ee("The channel dimension of the inputs should be defined, but found "+JSON.stringify(C[te]));for(var Be=C[te],Ge=this.kernelSize.concat([Be,this.depthMultiplier]),ft=[],Tt=0;Tt<this.rank;++Tt)ft.push(1);ft.push(Be*this.depthMultiplier,this.filters),this.depthwiseKernel=this.addWeight("depthwise_kernel",Ge,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",ft,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,!0,this.pointwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.inputSpec=[new eo({ndim:this.rank+2,axes:(N={},N[te]=Be,N)})],this.built=!0},G.prototype.call=function(C,N){var te=this;return Object(b.tidy)(function(){var Be;if(C=jr(C),te.rank===1)throw new I("1D separable convolution is not implemented yet.");return te.rank===2&&(te.dataFormat==="channelsFirst"&&(C=Object(b.transpose)(C,[0,2,3,1])),Be=Object(b.separableConv2d)(C,te.depthwiseKernel.read(),te.pointwiseKernel.read(),te.strides,te.padding,te.dilationRate,"NHWC")),te.useBias&&(Be=bt(Be,te.bias.read(),te.dataFormat)),te.activation!=null&&(Be=te.activation.apply(Be)),te.dataFormat==="channelsFirst"&&(Be=Object(b.transpose)(Be,[0,3,1,2])),Be})},G.prototype.getConfig=function(){var C=Q.prototype.getConfig.call(this);return delete C.rank,delete C.kernelInitializer,delete C.kernelRegularizer,delete C.kernelConstraint,C.depthwiseInitializer=ir(this.depthwiseInitializer),C.pointwiseInitializer=ir(this.pointwiseInitializer),C.depthwiseRegularizer=Ri(this.depthwiseRegularizer),C.pointwiseRegularizer=Ri(this.pointwiseRegularizer),C.depthwiseConstraint=wn(this.depthwiseConstraint),C.pointwiseConstraint=wn(this.pointwiseConstraint),C},G.className="SeparableConv",G}(Sl));b.serialization.registerClass(jh);var Lo=function(Q){function G(C){var N=Q.call(this,1,C)||this;return G.verifyArgs(C),N.inputSpec=[{ndim:3}],N}return U(G,Q),G.prototype.getConfig=function(){var C=Q.prototype.getConfig.call(this);return delete C.rank,delete C.dataFormat,C},G.verifyArgs=function(C){if(typeof C.kernelSize!="number"&&!Gt(C.kernelSize,"number",1,1))throw new ee("Conv1D expects config.kernelSize to be number or number[] with length 1, but received "+JSON.stringify(C.kernelSize)+".")},G.className="Conv1D",G}(Sl);b.serialization.registerClass(Lo);var Bh=function(Q){function G(C){var N=Q.call(this,C)||this;return typeof C.cropping=="number"?N.cropping=[[C.cropping,C.cropping],[C.cropping,C.cropping]]:typeof C.cropping[0]=="number"?N.cropping=[[C.cropping[0],C.cropping[0]],[C.cropping[1],C.cropping[1]]]:N.cropping=C.cropping,N.dataFormat=C.dataFormat===void 0?"channelsLast":C.dataFormat,N.inputSpec=[{ndim:4}],N}return U(G,Q),G.prototype.computeOutputShape=function(C){return this.dataFormat==="channelsFirst"?[C[0],C[1],C[2]-this.cropping[0][0]-this.cropping[0][1],C[3]-this.cropping[1][0]-this.cropping[1][1]]:[C[0],C[1]-this.cropping[0][0]-this.cropping[0][1],C[2]-this.cropping[1][0]-this.cropping[1][1],C[3]]},G.prototype.call=function(C,N){var te=this;return Object(b.tidy)(function(){return C=jr(C),te.dataFormat==="channelsLast"?Mr(Mr(C,te.cropping[0][0],C.shape[1]-te.cropping[0][0]-te.cropping[0][1],2),te.cropping[1][0],C.shape[2]-te.cropping[1][1]-te.cropping[1][0],3):Mr(Mr(C,te.cropping[0][0],C.shape[2]-te.cropping[0][0]-te.cropping[0][1],3),te.cropping[1][0],C.shape[3]-te.cropping[1][1]-te.cropping[1][0],4)})},G.prototype.getConfig=function(){var C={cropping:this.cropping,dataFormat:this.dataFormat},N=Q.prototype.getConfig.call(this);return Object.assign(C,N),C},G.className="Cropping2D",G}(qi);b.serialization.registerClass(Bh);var Dl=function(Q){function G(C){var N=Q.call(this,C)||this;return N.DEFAULT_SIZE=[2,2],N.inputSpec=[{ndim:4}],N.size=C.size==null?N.DEFAULT_SIZE:C.size,N.dataFormat=C.dataFormat==null?"channelsLast":C.dataFormat,N}return U(G,Q),G.prototype.computeOutputShape=function(C){if(this.dataFormat==="channelsFirst"){var N=C[2]==null?null:this.size[0]*C[2],te=C[3]==null?null:this.size[1]*C[3];return[C[0],C[1],N,te]}return N=C[1]==null?null:this.size[0]*C[1],te=C[2]==null?null:this.size[1]*C[2],[C[0],N,te,C[3]]},G.prototype.call=function(C,N){var te=this;return Object(b.tidy)(function(){var Be=jr(C),Ge=Be.shape;if(te.dataFormat==="channelsFirst"){Be=Object(b.transpose)(Be,[0,2,3,1]);var ft=te.size[0]*Ge[2],Tt=te.size[1]*Ge[3],Wt=Be.resizeNearestNeighbor([ft,Tt]);return Object(b.transpose)(Wt,[0,3,1,2])}return ft=te.size[0]*Ge[1],Tt=te.size[1]*Ge[2],Be.resizeNearestNeighbor([ft,Tt])})},G.prototype.getConfig=function(){var C={size:this.size,dataFormat:this.dataFormat},N=Q.prototype.getConfig.call(this);return Object.assign(C,N),C},G.className="UpSampling2D",G}(qi);b.serialization.registerClass(Dl);var Ph=function(Q){function G(C){var N=Q.call(this,2,C)||this;return N.depthwiseKernel=null,N.depthMultiplier=C.depthMultiplier==null?1:C.depthMultiplier,N.depthwiseInitializer=zr(C.depthwiseInitializer||N.DEFAULT_KERNEL_INITIALIZER),N.depthwiseConstraint=Hn(C.depthwiseConstraint),N.depthwiseRegularizer=oa(C.depthwiseRegularizer),N}return U(G,Q),G.prototype.build=function(C){if((C=jn(C)).length<4)throw new ee("Inputs to DepthwiseConv2D should have rank 4. Received input shape: "+JSON.stringify(C)+".");var N=this.dataFormat==="channelsFirst"?1:3;if(C[N]==null||C[N]<0)throw new ee("The channel dimension of the inputs to DepthwiseConv2D should be defined, but is not ("+C[N]+").");var te=C[N],Be=[this.kernelSize[0],this.kernelSize[1],te,this.depthMultiplier];this.depthwiseKernel=this.addWeight("depthwise_kernel",Be,null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[te*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0},G.prototype.call=function(C,N){var te=this;return Object(b.tidy)(function(){var Be=function(Ge,ft,Tt,Wt,ct,bn){return Tt===void 0&&(Tt=[1,1]),Wt===void 0&&(Wt="valid"),Object(b.tidy)(function(){ct==null&&(ct="channelsLast"),zt(ct);var Sn=Mh(Ge,ct);if(Ge.rank!==4)throw new ee("Input for depthwiseConv2d is required to be 4-D, but is instead "+Ge.rank+"-D");if(ft.rank!==4)throw new ee("depthwiseKernel is required to be 4-D, but is instead "+ft.rank+"-D");return Sn=Object(b.depthwiseConv2d)(Sn,ft,Tt,Wt==="same"?"same":"valid","NHWC",bn),ct==="channelsFirst"&&(Sn=Object(b.transpose)(Sn,[0,3,1,2])),Sn})}(C=jr(C),te.depthwiseKernel.read(),te.strides,te.padding,te.dataFormat,null);return te.useBias&&(Be=bt(Be,te.bias.read(),te.dataFormat)),te.activation!=null&&(Be=te.activation.apply(Be)),Be})},G.prototype.computeOutputShape=function(C){C=jn(C);var N=this.dataFormat==="channelsFirst"?C[2]:C[1],te=this.dataFormat==="channelsFirst"?C[3]:C[2],Be=this.dataFormat==="channelsFirst"?C[1]*this.depthMultiplier:C[3]*this.depthMultiplier,Ge=Is(N,this.kernelSize[0],this.padding,this.strides[0]),ft=Is(te,this.kernelSize[1],this.padding,this.strides[1]);return this.dataFormat==="channelsFirst"?[C[0],Be,Ge,ft]:[C[0],Ge,ft,Be]},G.prototype.getConfig=function(){var C=Q.prototype.getConfig.call(this);return C.depthMultiplier=this.depthMultiplier,C.depthwiseInitializer=ir(this.depthwiseInitializer),C.depthwiseRegularizer=Ri(this.depthwiseRegularizer),C.depthwiseConstraint=wn(this.depthwiseRegularizer),C},G.className="DepthwiseConv2D",G}(Gc);b.serialization.registerClass(Ph);var Tl=function(Q){function G(C){var N=Q.call(this,C)||this;return N.rate=Math.max(Math.min(C.rate,1),0),N.noiseShape=C.noiseShape,N.seed=C.seed,N.supportsMasking=!0,N}return U(G,Q),G.prototype.getNoiseShape=function(C){if(this.noiseShape==null)return this.noiseShape;for(var N=C.shape,te=[],Be=0;Be<this.noiseShape.length;++Be)te.push(this.noiseShape[Be]==null?N[Be]:this.noiseShape[Be]);return te},G.prototype.call=function(C,N){var te=this;return Object(b.tidy)(function(){te.invokeCallHook(C,N);var Be=jr(C);if(0<te.rate&&te.rate<1){var Ge=N.training!=null&&N.training,ft=te.getNoiseShape(Be);return Mt(function(){return Lr(Be,te.rate,ft,te.seed)},function(){return Be},Ge)}return C})},G.prototype.getConfig=function(){var C={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},N=Q.prototype.getConfig.call(this);return Object.assign(C,N),C},G.prototype.dispose=function(){return Q.prototype.dispose.call(this)},G.className="Dropout",G}(qi);b.serialization.registerClass(Tl);var Kc=function(Q){function G(C){var N=Q.call(this,C)||this;return N.inputSpec=[{ndim:3}],N}return U(G,Q),G.prototype.getNoiseShape=function(C){var N=C.shape;return[N[0],1,N[2]]},G.className="SpatialDropout1D",G}(Tl);b.serialization.registerClass(Kc);var Ec=function(Q){function G(C){var N=Q.call(this,C)||this;if(N.activation=null,N.useBias=!0,N.kernel=null,N.bias=null,N.DEFAULT_KERNEL_INITIALIZER="glorotNormal",N.DEFAULT_BIAS_INITIALIZER="zeros",C.batchInputShape==null&&C.inputShape==null&&C.inputDim!=null){var te=null;C.batchSize!=null&&(te=C.batchSize),N.batchInputShape=[te,C.inputDim]}return N.units=C.units,jt(N.units,"units"),N.activation=Po(C.activation),C.useBias!=null&&(N.useBias=C.useBias),N.kernelInitializer=zr(C.kernelInitializer||N.DEFAULT_KERNEL_INITIALIZER),N.biasInitializer=zr(C.biasInitializer||N.DEFAULT_BIAS_INITIALIZER),N.kernelConstraint=Hn(C.kernelConstraint),N.biasConstraint=Hn(C.biasConstraint),N.kernelRegularizer=oa(C.kernelRegularizer),N.biasRegularizer=oa(C.biasRegularizer),N.activityRegularizer=oa(C.activityRegularizer),N.supportsMasking=!0,N.inputSpec=[{minNDim:2}],N}return U(G,Q),G.prototype.build=function(C){var N,te=(C=jn(C))[C.length-1];this.kernel==null&&(this.kernel=this.addWeight("kernel",[te,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:(N={},N[-1]=te,N)}],this.built=!0},G.prototype.computeOutputShape=function(C){var N=(C=jn(C)).slice();return N[N.length-1]=this.units,N},G.prototype.call=function(C,N){var te=this;return Object(b.tidy)(function(){te.invokeCallHook(C,N);var Be,Ge=jr(C),ft=Ye(te.activation.getClassName());return ft!=null?Be=oi(Ge,te.kernel.read(),ft,te.bias?te.bias.read():null):(Be=oi(Ge,te.kernel.read()),te.bias!=null&&(Be=bt(Be,te.bias.read())),te.activation!=null&&(Be=te.activation.apply(Be))),Be})},G.prototype.getConfig=function(){var C={units:this.units,activation:us(this.activation),useBias:this.useBias,kernelInitializer:ir(this.kernelInitializer),biasInitializer:ir(this.biasInitializer),kernelRegularizer:Ri(this.kernelRegularizer),biasRegularizer:Ri(this.biasRegularizer),activityRegularizer:Ri(this.activityRegularizer),kernelConstraint:wn(this.kernelConstraint),biasConstraint:wn(this.biasConstraint)},N=Q.prototype.getConfig.call(this);return Object.assign(C,N),C},G.className="Dense",G}(qi);b.serialization.registerClass(Ec);var Lh=function(Q){function G(C){var N=this;return C=C||{},(N=Q.call(this,C)||this).inputSpec=[{minNDim:3}],N.dataFormat=C.dataFormat,N}return U(G,Q),G.prototype.computeOutputShape=function(C){for(var N=0,te=(C=jn(C)).slice(1);N<te.length;N++)if(te[N]==null)throw new ee('The shape of the input to "Flatten" is not fully defined (got '+C.slice(1)+'). Make sure to pass a complete "input_shape" or "batch_input_shape" argument to the first layer in your model.');return[C[0],Kt(C,1)]},G.prototype.call=function(C,N){var te=this;return Object(b.tidy)(function(){te.invokeCallHook(C,N);var Be=jr(C);if(te.dataFormat==="channelsFirst"&&Be.rank>1){for(var Ge=[0],ft=2;ft<Be.rank;++ft)Ge.push(ft);Ge.push(1),Be=Be.transpose(Ge)}return function(Tt){if(Tt.rank<=1)throw new ee("batchFlatten requires a minimum rank of 2. Got rank: "+Tt.rank+".");var Wt=[Tt.shape[0],Kt(Tt.shape,1)];return Tt.reshape(Wt)}(Be)})},G.prototype.getConfig=function(){var C={};this.dataFormat!=null&&(C.dataFormat=this.dataFormat);var N=Q.prototype.getConfig.call(this);return Object.assign(C,N),C},G.className="Flatten",G}(qi);b.serialization.registerClass(Lh);var _f=function(Q){function G(C){var N=Q.call(this,C)||this;return N.supportsMasking=!0,N.activation=Po(C.activation),N}return U(G,Q),G.prototype.call=function(C,N){var te=this;return Object(b.tidy)(function(){te.invokeCallHook(C,N);var Be=jr(C);return te.activation.apply(Be)})},G.prototype.getConfig=function(){var C={activation:us(this.activation)},N=Q.prototype.getConfig.call(this);return Object.assign(C,N),C},G.className="Activation",G}(qi);b.serialization.registerClass(_f);var Nl=function(Q){function G(C){var N=Q.call(this,C)||this;return N.n=C.n,N.inputSpec=[{ndim:2}],N}return U(G,Q),G.prototype.computeOutputShape=function(C){return[C[0],this.n,C[1]]},G.prototype.call=function(C,N){var te=this;return Object(b.tidy)(function(){return function(Be,Ge){return Object(b.tidy)(function(){if(Be.shape.length!==2)throw new ee("repeat() expects a rank-2 tensor, but received a rank-"+Be.shape.length+" tensor.");return Xr(gr(Be,1),[1,Ge,1])})}(C=jr(C),te.n)})},G.prototype.getConfig=function(){var C={n:this.n},N=Q.prototype.getConfig.call(this);return Object.assign(C,N),C},G.className="RepeatVector",G}(qi);b.serialization.registerClass(Nl);var Cc=function(Q){function G(C){var N=Q.call(this,C)||this;N.targetShape=C.targetShape;for(var te=0;te<N.targetShape.length;++te)N.isUnknown(N.targetShape[te])&&(N.targetShape[te]=null);return N}return U(G,Q),G.prototype.isUnknown=function(C){return C<0||C==null},G.prototype.fixUnknownDimension=function(C,N){for(var te="Total size of new array must be unchanged.",Be=N.slice(),Ge=1,ft=null,Tt=0;Tt<Be.length;++Tt){var Wt=Be[Tt];if(this.isUnknown(Wt)){if(ft!==null)throw new ee("Can only specifiy one unknown dimension.");ft=Tt}else Ge*=Wt}var ct=Kt(C);if(ft!==null){if(Ge===0||ct%Ge!=0)throw new ee(te);Be[ft]=ct/Ge}else if(ct!==Ge)throw new ee(te);return Be},G.prototype.computeOutputShape=function(C){for(var N=!1,te=0;te<C.length;++te)if(this.isUnknown(C[te])){N=!0;break}return N?C.slice(0,1).concat(this.targetShape):C.slice(0,1).concat(this.fixUnknownDimension(C.slice(1),this.targetShape))},G.prototype.call=function(C,N){var te=this;return Object(b.tidy)(function(){te.invokeCallHook(C,N);var Be=jr(C),Ge=Be.shape,ft=Ge.slice(0,1).concat(te.fixUnknownDimension(Ge.slice(1),te.targetShape));return Be.reshape(ft)})},G.prototype.getConfig=function(){var C={targetShape:this.targetShape},N=Q.prototype.getConfig.call(this);return Object.assign(C,N),C},G.className="Reshape",G}(qi);b.serialization.registerClass(Cc);var km=function(Q){function G(C){var N=Q.call(this,C)||this;if(C.dims==null)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(C.dims))throw new Error("Permute constructor requires `dims` to be an Array, but received "+C.dims+" instead.");var te=hr(1,C.dims.length+1);if(!b.util.arraysEqual(C.dims.slice().sort(),te))throw new Error("Invalid permutation `dims`: "+JSON.stringify(C.dims)+" `dims` must contain consecutive integers starting from 1.");return N.dims=C.dims,N.dimsIncludingBatch=[0].concat(N.dims),N.inputSpec=[new eo({ndim:N.dims.length+1})],N}return U(G,Q),G.prototype.computeOutputShape=function(C){var N=(C=jn(C)).slice();return this.dims.forEach(function(te,Be){N[Be+1]=C[te]}),N},G.prototype.call=function(C,N){return Object(b.transpose)(jr(C),this.dimsIncludingBatch)},G.prototype.getConfig=function(){var C={dims:this.dims},N=Q.prototype.getConfig.call(this);return Object.assign(C,N),C},G.className="Permute",G}(qi);b.serialization.registerClass(km);var Fl=function(Q){function G(C){var N=Q.call(this,C??{})||this;return N.supportsMasking=!0,N.maskValue=C!=null?C.maskValue==null?0:C.maskValue:0,N}return U(G,Q),G.prototype.computeOutputShape=function(C){return C},G.prototype.getConfig=function(){var C=Q.prototype.getConfig.call(this),N={maskValue:this.maskValue};return Object.assign(N,C),N},G.prototype.computeMask=function(C,N){var te=jr(C);return Object(b.any)(Object(b.notEqual)(te,this.maskValue),-1)},G.prototype.call=function(C,N){var te=this;return Object(b.tidy)(function(){te.invokeCallHook(C,N);var Be=jr(C),Ge=Object(b.any)(Object(b.notEqual)(Be,te.maskValue),-1,!0);return Be.mul(Ge.asType(Be.dtype))})},G.className="Masking",G}(qi);b.serialization.registerClass(Fl);var ra=function(Q){function G(C){var N=Q.call(this,C)||this;if(N.embeddings=null,N.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",C.batchInputShape==null&&C.inputShape==null){var te=null;C.batchSize!=null&&(te=C.batchSize),C.inputLength==null?N.batchInputShape=[te,null]:N.batchInputShape=[te].concat(Ae(C.inputLength))}return N.inputDim=C.inputDim,jt(N.inputDim,"inputDim"),N.outputDim=C.outputDim,jt(N.outputDim,"outputDim"),N.embeddingsInitializer=zr(C.embeddingsInitializer||N.DEFAULT_EMBEDDINGS_INITIALIZER),N.embeddingsRegularizer=oa(C.embeddingsRegularizer),N.activityRegularizer=oa(C.activityRegularizer),N.embeddingsConstraint=Hn(C.embeddingsConstraint),N.maskZero=C.maskZero,N.supportsMasking=C.maskZero,N.inputLength=C.inputLength,N}return U(G,Q),G.prototype.build=function(C){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0},G.prototype.warnOnIncompatibleInputShape=function(C){},G.prototype.computeMask=function(C,N){var te=this;return Object(b.tidy)(function(){return te.maskZero?(C=jr(C),Object(b.notEqual)(C,Object(b.zerosLike)(C))):null})},G.prototype.computeOutputShape=function(C){if(C=jn(C),this.inputLength==null)return C.concat([this.outputDim]);var N=Ae(this.inputLength);if(N.length!==C.length-1)throw new ee('"inputLength" is '+this.inputLength+", but received input shape has shape "+C);for(var te=0,Be=0;Be<N.length;++Be){var Ge=N[Be],ft=C[Be+1];if(Ge!=null&&ft!=null&&Ge!==ft)throw new ee('"inputLength" is '+this.inputLength+", but received input shape has shape "+C);Ge==null&&(N[te]=ft),te++}return[C[0]].concat(N,[this.outputDim])},G.prototype.call=function(C,N){var te=this;return Object(b.tidy)(function(){te.invokeCallHook(C,N);var Be=jr(C);return Be.dtype!=="int32"&&(Be=wr(Be,"int32")),Ao(te.embeddings.read(),Be.as1D()).reshape(jn(te.computeOutputShape(Be.shape)))})},G.prototype.getConfig=function(){var C={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:ir(this.embeddingsInitializer),embeddingsRegularizer:Ri(this.embeddingsRegularizer),activityRegularizer:Ri(this.activityRegularizer),embeddingsConstraint:wn(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},N=Q.prototype.getConfig.call(this);return Object.assign(C,N),C},G.className="Embedding",G}(qi);b.serialization.registerClass(ra);var Sa=function(Q){function G(C){var N=Q.call(this,C||{})||this;return N.supportsMasking=!0,N}return U(G,Q),G.prototype.mergeFunction=function(C){throw new I},G.prototype.computeElementwiseOpOutputShape=function(C,N){if(C==null||N==null)return null;if(C.length<N.length)return this.computeElementwiseOpOutputShape(N,C);if(N.length===0)return C;for(var te=C.slice(0,C.length-N.length),Be=0;Be<N.length;++Be){var Ge=C[C.length-N.length+Be],ft=N[Be];if(Ge==null||ft==null||Ge<0||ft<0)te.push(null);else if(Ge===1)te.push(ft);else if(ft===1)te.push(Ge);else{if(Ge!==ft)throw new ee("Operands could not be broadcast together with shapes "+JSON.stringify(C)+" "+JSON.stringify(N));te.push(Ge)}}return te},G.prototype.build=function(C){if(Array.isArray(C)&&!Array.isArray(C[0])&&(C=[jn(C)]),(C=C).length<2)throw new ee("A merge layer should be called on an Array of at least 2 inputs. Got "+C.length+" input(s).");for(var N=[],te=0,Be=C;te<Be.length;te++)(Tt=Be[te])!=null&&Tt[0]!==null&&N.push(Tt[0]);if((N=Xt(N)).length>1)throw new ee("Can not merge tensors with different batch sizes. Got tensors with shapes: "+JSON.stringify(C)+".");for(var Ge=C[0]==null?null:C[0].slice(1),ft=1;ft<C.length;++ft){var Tt=C[ft]==null?null:C[ft].slice(1);Ge=this.computeElementwiseOpOutputShape(Ge,Tt)}var Wt=C.map(function(ct){return ct.length});C.indexOf(null)===-1&&Xt(Wt).length===1?this.reshapeRequired=!1:this.reshapeRequired=!0},G.prototype.call=function(C,N){var te=this;return Object(b.tidy)(function(){if(C=C,te.reshapeRequired){var Be=[],Ge=C.map(function(ai){return ai.rank});if(Ge.indexOf(null)===-1){for(var ft=Dn(Ge),Tt=0,Wt=C;Tt<Wt.length;Tt++){for(var ct=(Rn=Wt[Tt]).rank,bn=0;bn<ft-ct;++bn)Rn=gr(Rn,1);Be.push(Rn)}return te.mergeFunction(Be)}for(var Sn=!1,Nn=0,Wn=C;Nn<Wn.length;Nn++){var Rn;if((ct=(Rn=Wn[Nn]).rank)==null){var tr=Rn.shape,rr=tr[0],dr=tr.slice(1).concat([rr]),Tr=Rn.reshape([rr].concat(Kt(tr.slice(1))));Tr=(Tr=Object(b.transpose)(Tr,[1,0])).reshape(dr),Be.push(Tr),Sn=!0}else if(ct>1){var Vr=hr(1,ct).concat([0]);Be.push(Object(b.transpose)(Rn,Vr)),Sn=!0}else Be.push(Rn)}var xr=te.mergeFunction(Be),$r=xr.rank;if(Sn)if($r==null){var Wr=xr.shape;dr=[rr=Wr[Wr.length-1]].concat(Wr.slice(0,Wr.length-1)),xr=Object(b.transpose)(xr.reshape([-1,rr]),[1,0]).reshape(dr)}else $r>1&&(Vr=[$r-1].concat(hr(0,$r-1)),xr=Object(b.transpose)(xr,Vr));return xr}return te.mergeFunction(C)})},G.prototype.computeOutputShape=function(C){var N;N=(C=C)[0]==null?null:C[0].slice(1);for(var te=1;te<C.length;++te){var Be=C[te]==null?null:C[te].slice(1);N=this.computeElementwiseOpOutputShape(N,Be)}for(var Ge=[],ft=0,Tt=C;ft<Tt.length;ft++)(Be=Tt[ft])!=null&&Be[0]!==null&&Ge.push(Be[0]);return(Ge=Xt(Ge)).length===1?Ge.concat(N):[null].concat(N)},G.prototype.computeMask=function(C,N){return Object(b.tidy)(function(){if(N==null)return null;if(!Array.isArray(N))throw new ee("`mask` should be an Array");if(!Array.isArray(C))throw new ee("`inputs` should be an Array");if(N.length!==C.length)throw new ee("The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths ("+C.length+" vs "+N.length+")");if(N.every(function(Ge){return Ge==null}))return null;for(var te=(N=N.map(function(Ge){return Ge==null?Ge:Object(b.expandDims)(Ge,0)}))[0],Be=1;Be<N.length-1;++Be)te=Object(b.logicalAnd)(te,N[Be]);return te})},G}(qi),Ia=function(Q){function G(C){return Q.call(this,C)||this}return U(G,Q),G.prototype.mergeFunction=function(C){return Object(b.tidy)(function(){for(var N=C[0].clone(),te=1;te<C.length;++te)N=Object(b.add)(N,C[te]);return N})},G.className="Add",G}(Sa);b.serialization.registerClass(Ia);var Mi=function(Q){function G(C){return Q.call(this,C)||this}return U(G,Q),G.prototype.mergeFunction=function(C){return Object(b.tidy)(function(){for(var N=C[0].clone(),te=1;te<C.length;++te)N=Object(b.mul)(N,C[te]);return N})},G.className="Multiply",G}(Sa);b.serialization.registerClass(Mi);var Es=function(Q){function G(C){return Q.call(this,C)||this}return U(G,Q),G.prototype.mergeFunction=function(C){return Object(b.tidy)(function(){for(var N=C[0].clone(),te=1;te<C.length;++te)N=Object(b.add)(N,C[te]);return Object(b.mul)(1/C.length,N)})},G.className="Average",G}(Sa);b.serialization.registerClass(Es);var Oc=function(Q){function G(C){return Q.call(this,C)||this}return U(G,Q),G.prototype.mergeFunction=function(C){return Object(b.tidy)(function(){for(var N=C[0],te=1;te<C.length;++te)N=Object(b.maximum)(N,C[te]);return N})},G.className="Maximum",G}(Sa);b.serialization.registerClass(Oc);var Ra=function(Q){function G(C){return Q.call(this,C)||this}return U(G,Q),G.prototype.mergeFunction=function(C){return Object(b.tidy)(function(){for(var N=C[0],te=1;te<C.length;++te)N=Object(b.minimum)(N,C[te]);return N})},G.className="Minimum",G}(Sa);b.serialization.registerClass(Ra);var Ac=function(Q){function G(C){var N=Q.call(this,C)||this;return N.DEFAULT_AXIS=-1,C==null&&(C={}),N.axis=C.axis==null?N.DEFAULT_AXIS:C.axis,N.supportsMasking=!0,N.reshapeRequired=!1,N}return U(G,Q),G.prototype.build=function(C){if(!Array.isArray(C)||!Array.isArray(C[0])||C.length===1)throw new ee("A `Concatenate` layer should be called on a list of at least 2 inputs");for(var N=!0,te=0,Be=C=C;te<Be.length;te++)if((Sn=Be[te])!=null){N=!1;break}if(!N){for(var Ge=[],ft=0;ft<C.length;++ft){var Tt=C[ft].slice();Tt.splice(this.axis,1);for(var Wt=!1,ct=0,bn=Ge;ct<bn.length;ct++){var Sn=bn[ct];if(b.util.arraysEqual(Sn,Tt)){Wt=!0;break}}Wt||Ge.push(Tt)}if(Ge.length>1)throw new ee("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(C))}},G.prototype.mergeFunction=function(C){var N=this;return Object(b.tidy)(function(){return di(C,N.axis)})},G.prototype.computeOutputShape=function(C){if(!Array.isArray(C)||!Array.isArray(C[0]))throw new ee("A `Concatenate` layer should be called on a list of inputs.");for(var N=C,te=N[0].slice(),Be=this.axis<0?te.length+this.axis:this.axis,Ge=0,ft=N.slice(1);Ge<ft.length;Ge++){var Tt=ft[Ge];if(te[Be]==null||Tt[Be]==null){te[Be]=null;break}te[Be]+=Tt[Be]}return te},G.prototype.computeMask=function(C,N){var te=this;if(N==null)return null;if(!Array.isArray(N))throw new ee("`mask` should be an array for Concatenate");if(!Array.isArray(C))throw new ee("`inputs` should be an array for Concatenate");if(N.length!==C.length)throw new ee("Mismatch in the length of mask ("+N.length+") and the legnth of inputs ("+C.length+")");return Object(b.tidy)(function(){var Be=!0;if(N.forEach(function(Wt){Wt==null||(Be=!1)}),Be)return null;for(var Ge=[],ft=0;ft<C.length;++ft)N[ft]==null?Ge.push(Object(b.onesLike)(C[ft]).asType("bool")):N[ft].rank<C[ft].rank?Ge.push(Object(b.expandDims)(N[ft],-1)):Ge.push(N[ft]);var Tt=Object(b.concat)(Ge,te.axis);return Object(b.all)(Tt,-1,!1)})},G.prototype.getConfig=function(){var C={axis:this.axis},N=Q.prototype.getConfig.call(this);return Object.assign(C,N),C},G.className="Concatenate",G}(Sa);function Uu(Q,G){for(;Q<0;)Q+=G;return Q}b.serialization.registerClass(Ac);var Df=function(Q){function G(C){var N=Q.call(this,C)||this;return N.axes=C.axes,N.normalize=C.normalize!=null&&C.normalize,N.supportsMasking=!0,N.reshapeRequired=!1,N}return U(G,Q),G.prototype.build=function(C){b.util.assert(Array.isArray(C)&&C.length===2&&Array.isArray(C[0])&&Array.isArray(C[1]),function(){return"A `Dot` layer should be called on a list of exactly 2 inputs."});var N=C[0],te=C[1];if(N.length>3||te.length>3)throw new I("Dot layer does not support tensors of 4D or higher rank yet.");var Be=this.interpretAxes(N,te);if(N[Be[0]]!==te[Be[1]])throw new ee("Dimension incompatibility: "+N[Be[0]]+" !== "+te[Be[1]])},G.prototype.mergeFunction=function(C){if(C.length!==2)throw new ee("A `Dot` layer must be called on exactly 2 inputs, but received "+C.length+" input(s).");var N,te=C[0],Be=C[1];return N=Array.isArray(this.axes)?this.axes.map(function(Ge,ft){return Uu(Ge,C[ft].shape.length)}):[Uu(this.axes,te.shape.length),Uu(this.axes,Be.shape.length)],this.normalize&&(te=Vc(te,N[0]),Be=Vc(Be,N[1])),function(Ge,ft,Tt){if(Ge.shape.length>3||ft.shape.length>3)throw new I("batchDot is not implemented for tensors of 4D or higher rank yet");if(b.util.assert(Ge.shape.length>=2,function(){return"batchDot requires the rank of x to be >= 2, but got "+Ge.shape.length}),b.util.assert(Ge.shape.length>=2,function(){return"batchDot requires the rank of y to be >= 2, but got "+ft.shape.length}),typeof Tt=="number"&&(Tt=[Tt,Tt]),Ge.dtype==="complex64"||ft.dtype==="complex64")throw new I("batchDot is not implemented for complex64-type Tensors yet.");var Wt=Ge.shape.length,ct=ft.shape.length;Tt==null&&(Tt=[Wt-1,ct-2]);var bn=Tt;return Object(b.tidy)(function(){var Sn,Nn;if(Wt>ct){Sn=Wt-ct;for(var Wn=[],Rn=0;Rn<Sn;++Rn)Wn.push(1);ft=ft.reshape(ft.shape.concat(Wn))}else if(ct>Wt){for(Sn=ct-Wt,Wn=[],Rn=0;Rn<Sn;++Rn)Wn.push(1);Ge=Ge.reshape(Ge.shape.concat(Wn))}else Sn=0;if(Ge.shape.length===2&&ft.shape.length===2)Nn=bn[0]===bn[1]?Ge.mulStrict(ft).sum(bn[0]):Ge.transpose([1,0]).mulStrict(ft).sum(bn[1]);else{var tr=bn[0]!==Ge.shape.length-1,rr=bn[1]===ft.shape.length-1;Nn=Ge.matMul(ft,tr,rr)}if(Sn>0){var dr,Tr=[];for(Rn=dr=Wt>ct?Wt+ct-3:Wt-1;Rn<dr+Sn;++Rn)Tr.push(Rn);Nn=Nn.squeeze(Tr)}return Nn.shape.length===1&&(Nn=Nn.expandDims(1)),Nn})}(te,Be,N)},G.prototype.interpretAxes=function(C,N){return Array.isArray(this.axes)?this.axes:[Uu(this.axes,C.length),Uu(this.axes,N.length)]},G.prototype.computeOutputShape=function(C){b.util.assert(Array.isArray(C)&&C.length===2&&Array.isArray(C[0])&&Array.isArray(C[1]),function(){return"A `Dot` layer should be called on a list of exactly 2 inputs."});var N=C[0].slice(),te=C[1].slice();if(N.length>3||te.length>3)throw new I("Dot layer does not support tensors of 4D or higher rank yet.");var Be=this.interpretAxes(N,te);N.splice(Be[0],1),te.splice(Be[1],1),te.splice(0,1);var Ge=N.concat(te);return Ge.length===1&&Ge.push(1),Ge},G.prototype.computeMask=function(C,N){return null},G.prototype.getConfig=function(){var C={axes:this.axes,normalize:this.normalize},N=Q.prototype.getConfig.call(this);return Object.assign(C,N),C},G.className="Dot",G}(Sa);b.serialization.registerClass(Df);var Tf=function(Q){function G(C){var N=Q.call(this,C)||this;return N.supportsMasking=!0,N.stddev=C.stddev,N}return U(G,Q),G.prototype.computeOutputShape=function(C){return C},G.prototype.getConfig=function(){var C=Q.prototype.getConfig.call(this),N={stddev:this.stddev};return Object.assign(N,C),N},G.prototype.call=function(C,N){var te=this;return Object(b.tidy)(function(){te.invokeCallHook(C,N);var Be=jr(C);return Mt(function(){return fi(Be.shape,0,te.stddev).add(Be)},function(){return Be},N.training||!1)})},G.className="GaussianNoise",G}(qi);b.serialization.registerClass(Tf);var Xc=function(Q){function G(C){var N=Q.call(this,C)||this;return N.supportsMasking=!0,N.rate=C.rate,N}return U(G,Q),G.prototype.computeOutputShape=function(C){return C},G.prototype.getConfig=function(){var C=Q.prototype.getConfig.call(this),N={rate:this.rate};return Object.assign(N,C),N},G.prototype.call=function(C,N){var te=this;return Object(b.tidy)(function(){te.invokeCallHook(C,N);var Be=jr(C);return te.rate>0&&te.rate<1?Mt(function(){var Ge=Math.sqrt(te.rate/(1-te.rate));return Be.mul(fi(Be.shape,1,Ge))},function(){return Be},N.training||!1):Be})},G.className="GaussianDropout",G}(qi);b.serialization.registerClass(Xc);var Vd=function(Q){function G(C){var N=Q.call(this,C)||this;return N.supportsMasking=!0,N.rate=C.rate,N.noiseShape=C.noiseShape,N}return U(G,Q),G.prototype._getNoiseShape=function(C){return this.noiseShape||jr(C).shape},G.prototype.computeOutputShape=function(C){return C},G.prototype.getConfig=function(){var C=Q.prototype.getConfig.call(this),N={rate:this.rate};return Object.assign(N,C),N},G.prototype.call=function(C,N){var te=this;return Object(b.tidy)(function(){if(te.rate<1&&te.rate>0){var Be=te._getNoiseShape(C);return Mt(function(){var Ge=jr(C),ft=-1.7580993408473766,Tt=Object(b.greaterEqual)(Object(b.randomUniform)(Be),te.rate);Tt=wr(Tt,"float32");var Wt=Math.pow((1-te.rate)*(1+te.rate*Math.pow(ft,2)),-.5),ct=-Wt*ft*te.rate;return Ge.mul(Tt).add(Tt.add(-1).mul(ft)).mul(Wt).add(ct)},function(){return jr(C)},N.training||!1)}return C})},G.className="AlphaDropout",G}(qi);function Wu(Q,G,C,N,te,Be){var Ge;if(Be===void 0&&(Be=.001),Q.rank===2)Ge=Object(b.batchNorm2d)(Q,G,C,N,te,Be);else if(Q.rank===3)Ge=Object(b.batchNorm3d)(Q,G,C,N,te,Be);else{if(Q.rank!==4)throw new I("batchNormalization is not implemented for array of rank "+Q.rank+" yet");Ge=Object(b.batchNorm4d)(Q,G,C,N,te,Be)}return Ge}function Em(Q,G,C,N,te){return te===void 0&&(te=.001),b.util.arraysEqual(N.slice().sort(),hr(0,Q.rank-1))?function(Be,Ge,ft,Tt,Wt){return Wt===void 0&&(Wt=.001),Object(b.tidy)(function(){var ct=Object(b.moments)(Be,Tt),bn=ct.mean,Sn=ct.variance;return[Wu(Be,bn,Sn,ft,Ge,Wt),bn,Sn]})}(Q,G,C,N,te):function(Be,Ge,ft,Tt,Wt){return Wt===void 0&&(Wt=.001),Object(b.tidy)(function(){for(var ct=Object(b.moments)(Be,Tt),bn=ct.mean,Sn=ct.variance,Nn=[],Wn=0,Rn=hr(0,Be.rank);Wn<Rn.length;Wn++){var tr=Rn[Wn];Tt.indexOf(tr)!==-1?Nn.push(1):Nn.push(Be.shape[tr])}var rr=bn.reshape(Nn),dr=Sn.reshape(Nn),Tr=Ge==null?null:Ge.reshape(Nn),Vr=ft==null?null:ft.reshape(Nn);return[Wu(Be,rr,dr,Vr,Tr,Wt),bn,Sn]})}(Q,G,C,N,te)}b.serialization.registerClass(Vd);var qd=function(Q){function G(C){var N=this;return C==null&&(C={}),(N=Q.call(this,C)||this).supportsMasking=!0,N.axis=C.axis==null?-1:C.axis,N.momentum=C.momentum==null?.99:C.momentum,N.epsilon=C.epsilon==null?.001:C.epsilon,N.center=C.center==null||C.center,N.scale=C.scale==null||C.scale,N.betaInitializer=zr(C.betaInitializer||"zeros"),N.gammaInitializer=zr(C.gammaInitializer||"ones"),N.movingMeanInitializer=zr(C.movingMeanInitializer||"zeros"),N.movingVarianceInitializer=zr(C.movingVarianceInitializer||"ones"),N.betaConstraint=Hn(C.betaConstraint),N.gammaConstraint=Hn(C.gammaConstraint),N.betaRegularizer=oa(C.betaRegularizer),N.gammaRegularizer=oa(C.gammaRegularizer),N}return U(G,Q),G.prototype.build=function(C){var N;C=jn(C);var te=this.axis>=0?this.axis:this.axis+C.length,Be=C[te];if(Be==null)throw new ee("Axis "+te+" of input tensor should have a defined dimension but the layer received an input with shape "+JSON.stringify(C)+".");this.inputSpec=[new eo({ndim:C.length,axes:(N={},N[te]=Be,N)})];var Ge=[Be];this.scale&&(this.gamma=this.addWeight("gamma",Ge,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",Ge,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",Ge,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",Ge,null,this.movingVarianceInitializer,null,!1),this.built=!0},G.prototype.call=function(C,N){var te=this;return Object(b.tidy)(function(){var Be=N.training!=null&&N.training,Ge=jr(C),ft=Ge.shape,Tt=ft.length,Wt=hr(0,Tt),ct=te.axis>=0?te.axis:te.axis+Tt;Wt.splice(ct,1);var bn=ie(1,Tt);bn[ct]=ft[ct];var Sn=Wt.slice();Sn.sort();var Nn=!b.util.arraysEqual(Sn,hr(0,Tt).slice(0,Tt-1));if(!Be)return function(){if(Nn){var Tr=te.movingMean.read().reshape(bn),Vr=te.movingVariance.read().reshape(bn),xr=te.center?te.beta.read().reshape(bn):null,$r=te.scale?te.gamma.read().reshape(bn):null;return Wu(Ge,Tr,Vr,xr,$r,te.epsilon)}return Wu(Ge,te.movingMean.read(),te.movingVariance.read(),te.beta==null?null:te.beta.read(),te.gamma==null?null:te.gamma.read(),te.epsilon)}();var Wn=Em(Ge,te.gamma.read(),te.beta.read(),Wt,te.epsilon),Rn=Wn[0],tr=Wn[1],rr=Wn[2],dr=function(Tr,Vr,xr){Object(b.tidy)(function(){var $r=1-xr,Wr=Tr.read(),ai=Wr.sub(Vr).mul($r);Tr.write(Wr.sub(ai))})};return dr(te.movingMean,tr,te.momentum),dr(te.movingVariance,rr,te.momentum),Rn})},G.prototype.getConfig=function(){var C={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:ir(this.betaInitializer),gammaInitializer:ir(this.gammaInitializer),movingMeanInitializer:ir(this.movingMeanInitializer),movingVarianceInitializer:ir(this.movingVarianceInitializer),betaRegularizer:Ri(this.betaRegularizer),gammaRegularizer:Ri(this.gammaRegularizer),betaConstraint:wn(this.betaConstraint),gammaConstraint:wn(this.gammaConstraint)},N=Q.prototype.getConfig.call(this);return Object.assign(C,N),C},G.className="BatchNormalization",G}(qi);b.serialization.registerClass(qd);var Il=function(Q){function G(C){var N=this;if(C==null&&(C={}),(N=Q.call(this,C)||this).axis=C.axis==null?-1:C.axis,typeof N.axis=="number"){if(!Number.isInteger(N.axis))throw new Error("Expected axis to be an integer, but received "+N.axis)}else{if(!Array.isArray(N.axis))throw new Error("Expected axis to be an integer or an array of integers, but received "+JSON.stringify(N.axis));for(var te=0,Be=N.axis;te<Be.length;te++){var Ge=Be[te];if(!Number.isInteger(Ge))throw new Error("Expected axis to be an array of integers, but received "+JSON.stringify(N.axis))}}return N.epsilon=C.epsilon==null?.001:C.epsilon,N.center=C.center==null||C.center,N.scale=C.scale==null||C.scale,N.betaInitializer=zr(C.betaInitializer||"zeros"),N.gammaInitializer=zr(C.gammaInitializer||"ones"),N.betaRegularizer=oa(C.betaRegularizer),N.gammaRegularizer=oa(C.gammaRegularizer),N.supportsMasking=!0,N}return U(G,Q),G.prototype.build=function(C){var N=(C=jn(C)).length;typeof this.axis=="number"&&(this.axis=[this.axis]);for(var te=0;te<this.axis.length;++te)this.axis[te]<0&&(this.axis[te]+=N);for(var Be=0,Ge=this.axis;Be<Ge.length;Be++){var ft=Ge[Be];if(ft<0||ft>=N)throw new Error("Invalid axis: "+ft)}if(this.axis.length!==Xt(this.axis).length)throw new Error("Found duplicate axes in: "+this.axis);var Tt=this.axis.map(function(Wt){return C[Wt]});this.scale?this.gamma=this.addWeight("gamma",Tt,"float32",this.gammaInitializer,this.gammaRegularizer,!0):this.gamma=null,this.center?this.beta=this.addWeight("beta",Tt,"float32",this.betaInitializer,this.betaRegularizer,!0):this.beta=null,this.built=!0},G.prototype.call=function(C,N){var te=this,Be=jr(C),Ge=Be.shape,ft=Ge.length;return Object(b.tidy)(function(){for(var Tt=Object(b.moments)(Be,te.axis,!0),Wt=Tt.mean,ct=Tt.variance,bn=ie(1,ft),Sn=0,Nn=te.axis;Sn<Nn.length;Sn++){var Wn=Nn[Sn];bn[Wn]=Ge[Wn]}for(var Rn=function(xr){return xr!=null&&xr.shape.length!==ft&&te.axis!==[ft-1]?xr.reshape(bn):xr},tr=Rn(te.gamma.read()),rr=Rn(te.beta.read()),dr=[],Tr=[],Vr=0;Vr<ft;++Vr)te.axis.indexOf(Vr)!==-1?(dr.push(Ge[Vr]),Tr.push(1)):(dr.push(1),Tr.push(Ge[Vr]));return Wt=Wt.tile(dr),ct=ct.tile(dr),tr=tr.tile(Tr),rr=rr.tile(Tr),Wu(Be,Wt,ct,rr,tr,te.epsilon)})},G.prototype.getConfig=function(){var C={axis:this.axis,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:ir(this.betaInitializer),gammaInitializer:ir(this.gammaInitializer),betaRegularizer:Ri(this.betaRegularizer),gammaRegularizer:Ri(this.gammaRegularizer)},N=Q.prototype.getConfig.call(this);return Object.assign(C,N),C},G.className="LayerNormalization",G}(qi);b.serialization.registerClass(Il);var jp=function(Q){function G(C){var N=this;if(C==null&&(C={}),(N=Q.call(this,C)||this).dataFormat=C.dataFormat==null?"channelsLast":C.dataFormat,C.padding==null)N.padding=[[1,1],[1,1]];else if(typeof C.padding=="number")N.padding=[[C.padding,C.padding],[C.padding,C.padding]];else{if(C.padding=C.padding,C.padding.length!==2)throw new ee("ZeroPadding2D expects padding to be a length-2 array, but received a length-"+C.padding.length+" array.");var te=void 0,Be=void 0;if(typeof C.padding[0]=="number")te=[C.padding[0],C.padding[0]],Be=[C.padding[1],C.padding[1]];else{if(C.padding=C.padding,C.padding[0].length!==2)throw new ee("ZeroPadding2D expects height padding to be a length-2 array, but received a length-"+C.padding[0].length+" array.");if(te=C.padding[0],C.padding[1].length!==2)throw new ee("ZeroPadding2D expects width padding to be a length-2 array, but received a length-"+C.padding[1].length+" array.");Be=C.padding[1]}N.padding=[te,Be]}return N.inputSpec=[new eo({ndim:4})],N}return U(G,Q),G.prototype.computeOutputShape=function(C){var N,te;return C=jn(C),this.dataFormat==="channelsFirst"?(N=C[2]!=null&&C[2]>=0?C[2]+this.padding[0][0]+this.padding[0][1]:null,te=C[3]!=null&&C[3]>=0?C[3]+this.padding[1][0]+this.padding[1][1]:null,[C[0],C[1],N,te]):(N=C[1]!=null&&C[1]>=0?C[1]+this.padding[0][0]+this.padding[0][1]:null,te=C[2]!=null&&C[2]>=0?C[2]+this.padding[1][0]+this.padding[1][1]:null,[C[0],N,te,C[3]])},G.prototype.call=function(C,N){var te=this;return Object(b.tidy)(function(){return function(Be,Ge,ft){return Object(b.tidy)(function(){if(Be.rank!==4)throw new ee("temporalPadding expects input tensor to be 4-D, but received a "+Be.rank+"-D tensor.");if(Ge==null&&(Ge=[[1,1],[1,1]]),Ge.length!==2||Ge[0].length!==2||Ge[1].length!==2)throw new ee("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(ft==null&&(ft="channelsLast"),ft!=="channelsLast"&&ft!=="channelsFirst")throw new ee("Unknown data format: "+ft+". Supported data formats are 'channelsLast' and 'channelsFirst.");var Tt;return Tt=ft==="channelsFirst"?[[0,0],[0,0],Ge[0],Ge[1]]:[[0,0],Ge[0],Ge[1],[0,0]],Object(b.pad)(Be,Tt)})}(jr(C),te.padding,te.dataFormat)})},G.prototype.getConfig=function(){var C={padding:this.padding,dataFormat:this.dataFormat},N=Q.prototype.getConfig.call(this);return Object.assign(C,N),C},G.className="ZeroPadding2D",G}(qi);function Nf(Q,G,C,N,te,Be){return Object(b.tidy)(function(){var Ge;zt(te),xn(Be),Tn(N),C==null&&(C=[1,1]),N==null&&(N="valid"),te==null&&(te="channelsLast"),Be==null&&(Be="max"),Q=Mh(Q,te);var ft=N==="same"?"same":"valid";return Ge=Be==="max"?Object(b.maxPool)(Q,G,C,ft):Object(b.avgPool)(Q,G,C,ft),te==="channelsFirst"&&(Ge=Object(b.transpose)(Ge,[0,3,1,2])),Ge})}function Yc(Q,G,C,N,te,Be){return Object(b.tidy)(function(){var Ge;zt(te),xn(Be),Tn(N),C==null&&(C=[1,1,1]),N==null&&(N="valid"),te==null&&(te="channelsLast"),Be==null&&(Be="max"),Q=Ni(Q,te);var ft=N==="same"?"same":"valid";return Ge=Be==="max"?Object(b.maxPool3d)(Q,G,C,ft):Object(b.avgPool3d)(Q,G,C,ft),te==="channelsFirst"&&(Ge=Object(b.transpose)(Ge,[0,4,1,2,3])),Ge})}b.serialization.registerClass(jp);var Hd=function(Q){function G(C){var N=this;if(C.poolSize==null&&(C.poolSize=2),N=Q.call(this,C)||this,typeof C.poolSize=="number")N.poolSize=[C.poolSize];else{if(!Array.isArray(C.poolSize)||C.poolSize.length!==1||typeof C.poolSize[0]!="number")throw new ee("poolSize for 1D convolutional layer must be a number or an Array of a single number, but received "+JSON.stringify(C.poolSize));N.poolSize=C.poolSize}if(jt(N.poolSize,"poolSize"),C.strides==null)N.strides=N.poolSize;else if(typeof C.strides=="number")N.strides=[C.strides];else{if(!Array.isArray(C.strides)||C.strides.length!==1||typeof C.strides[0]!="number")throw new ee("strides for 1D convolutional layer must be a number or an Array of a single number, but received "+JSON.stringify(C.strides));N.strides=C.strides}return jt(N.strides,"strides"),N.padding=C.padding==null?"valid":C.padding,Tn(N.padding),N.inputSpec=[new eo({ndim:3})],N}return U(G,Q),G.prototype.computeOutputShape=function(C){var N=Is((C=jn(C))[1],this.poolSize[0],this.padding,this.strides[0]);return[C[0],N,C[2]]},G.prototype.call=function(C,N){var te=this;return Object(b.tidy)(function(){te.invokeCallHook(C,N),C=gr(jr(C),2);var Be=te.poolingFunction(jr(C),[te.poolSize[0],1],[te.strides[0],1],te.padding,"channelsLast");return Object(b.squeeze)(Be,[2])})},G.prototype.getConfig=function(){var C={poolSize:this.poolSize,padding:this.padding,strides:this.strides},N=Q.prototype.getConfig.call(this);return Object.assign(C,N),C},G}(qi),zh=function(Q){function G(C){return Q.call(this,C)||this}return U(G,Q),G.prototype.poolingFunction=function(C,N,te,Be,Ge){return zt(Ge),Tn(Be),Nf(C,N,te,Be,Ge,"max")},G.className="MaxPooling1D",G}(Hd);b.serialization.registerClass(zh);var ba=function(Q){function G(C){return Q.call(this,C)||this}return U(G,Q),G.prototype.poolingFunction=function(C,N,te,Be,Ge){return zt(Ge),Tn(Be),Nf(C,N,te,Be,Ge,"avg")},G.className="AveragePooling1D",G}(Hd);b.serialization.registerClass(ba);var Rl=function(Q){function G(C){var N=this;if(C.poolSize==null&&(C.poolSize=[2,2]),(N=Q.call(this,C)||this).poolSize=Array.isArray(C.poolSize)?C.poolSize:[C.poolSize,C.poolSize],C.strides==null)N.strides=N.poolSize;else if(Array.isArray(C.strides)){if(C.strides.length!==2)throw new ee("If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length "+C.strides.length+".");N.strides=C.strides}else N.strides=[C.strides,C.strides];return jt(N.poolSize,"poolSize"),jt(N.strides,"strides"),N.padding=C.padding==null?"valid":C.padding,N.dataFormat=C.dataFormat==null?"channelsLast":C.dataFormat,zt(N.dataFormat),Tn(N.padding),N.inputSpec=[new eo({ndim:4})],N}return U(G,Q),G.prototype.computeOutputShape=function(C){C=jn(C);var N=this.dataFormat==="channelsFirst"?C[2]:C[1],te=this.dataFormat==="channelsFirst"?C[3]:C[2];return N=Is(N,this.poolSize[0],this.padding,this.strides[0]),te=Is(te,this.poolSize[1],this.padding,this.strides[1]),this.dataFormat==="channelsFirst"?[C[0],C[1],N,te]:[C[0],N,te,C[3]]},G.prototype.call=function(C,N){var te=this;return Object(b.tidy)(function(){return te.invokeCallHook(C,N),te.poolingFunction(jr(C),te.poolSize,te.strides,te.padding,te.dataFormat)})},G.prototype.getConfig=function(){var C={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},N=Q.prototype.getConfig.call(this);return Object.assign(C,N),C},G}(qi),Cs=function(Q){function G(C){return Q.call(this,C)||this}return U(G,Q),G.prototype.poolingFunction=function(C,N,te,Be,Ge){return zt(Ge),Tn(Be),Nf(C,N,te,Be,Ge,"max")},G.className="MaxPooling2D",G}(Rl);b.serialization.registerClass(Cs);var Ml=function(Q){function G(C){return Q.call(this,C)||this}return U(G,Q),G.prototype.poolingFunction=function(C,N,te,Be,Ge){return zt(Ge),Tn(Be),Nf(C,N,te,Be,Ge,"avg")},G.className="AveragePooling2D",G}(Rl);b.serialization.registerClass(Ml);var Ff=function(Q){function G(C){var N=this;if(C.poolSize==null&&(C.poolSize=[2,2,2]),(N=Q.call(this,C)||this).poolSize=Array.isArray(C.poolSize)?C.poolSize:[C.poolSize,C.poolSize,C.poolSize],C.strides==null)N.strides=N.poolSize;else if(Array.isArray(C.strides)){if(C.strides.length!==3)throw new ee("If the strides property of a 3D pooling layer is an Array, it is expected to have a length of 3, but received length "+C.strides.length+".");N.strides=C.strides}else N.strides=[C.strides,C.strides,C.strides];return jt(N.poolSize,"poolSize"),jt(N.strides,"strides"),N.padding=C.padding==null?"valid":C.padding,N.dataFormat=C.dataFormat==null?"channelsLast":C.dataFormat,zt(N.dataFormat),Tn(N.padding),N.inputSpec=[new eo({ndim:5})],N}return U(G,Q),G.prototype.computeOutputShape=function(C){C=jn(C);var N=this.dataFormat==="channelsFirst"?C[2]:C[1],te=this.dataFormat==="channelsFirst"?C[3]:C[2],Be=this.dataFormat==="channelsFirst"?C[4]:C[3];return N=Is(N,this.poolSize[0],this.padding,this.strides[0]),te=Is(te,this.poolSize[1],this.padding,this.strides[1]),Be=Is(Be,this.poolSize[2],this.padding,this.strides[2]),this.dataFormat==="channelsFirst"?[C[0],C[1],N,te,Be]:[C[0],N,te,Be,C[4]]},G.prototype.call=function(C,N){var te=this;return Object(b.tidy)(function(){return te.invokeCallHook(C,N),te.poolingFunction(jr(C),te.poolSize,te.strides,te.padding,te.dataFormat)})},G.prototype.getConfig=function(){var C={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},N=Q.prototype.getConfig.call(this);return Object.assign(C,N),C},G}(qi),Uh=function(Q){function G(C){return Q.call(this,C)||this}return U(G,Q),G.prototype.poolingFunction=function(C,N,te,Be,Ge){return zt(Ge),Tn(Be),Yc(C,N,te,Be,Ge,"max")},G.className="MaxPooling3D",G}(Ff);b.serialization.registerClass(Uh);var $d=function(Q){function G(C){return Q.call(this,C)||this}return U(G,Q),G.prototype.poolingFunction=function(C,N,te,Be,Ge){return zt(Ge),Tn(Be),Yc(C,N,te,Be,Ge,"avg")},G.className="AveragePooling3D",G}(Ff);b.serialization.registerClass($d);var If=function(Q){function G(C){var N=Q.call(this,C)||this;return N.inputSpec=[new eo({ndim:3})],N}return U(G,Q),G.prototype.computeOutputShape=function(C){return[C[0],C[2]]},G.prototype.call=function(C,N){throw new I},G}(qi),jl=function(Q){function G(C){return Q.call(this,C||{})||this}return U(G,Q),G.prototype.call=function(C,N){return Object(b.tidy)(function(){var te=jr(C);return Object(b.mean)(te,1)})},G.className="GlobalAveragePooling1D",G}(If);b.serialization.registerClass(jl);var Gd=function(Q){function G(C){return Q.call(this,C||{})||this}return U(G,Q),G.prototype.call=function(C,N){return Object(b.tidy)(function(){var te=jr(C);return Object(b.max)(te,1)})},G.className="GlobalMaxPooling1D",G}(If);b.serialization.registerClass(Gd);var Kd=function(Q){function G(C){var N=Q.call(this,C)||this;return N.dataFormat=C.dataFormat==null?"channelsLast":C.dataFormat,zt(N.dataFormat),N.inputSpec=[new eo({ndim:4})],N}return U(G,Q),G.prototype.computeOutputShape=function(C){return C=C,this.dataFormat==="channelsLast"?[C[0],C[3]]:[C[0],C[1]]},G.prototype.call=function(C,N){throw new I},G.prototype.getConfig=function(){var C={dataFormat:this.dataFormat},N=Q.prototype.getConfig.call(this);return Object.assign(C,N),C},G}(qi),tn=function(Q){function G(){return Q!==null&&Q.apply(this,arguments)||this}return U(G,Q),G.prototype.call=function(C,N){var te=this;return Object(b.tidy)(function(){var Be=jr(C);return te.dataFormat==="channelsLast"?Object(b.mean)(Be,[1,2]):Object(b.mean)(Be,[2,3])})},G.className="GlobalAveragePooling2D",G}(Kd);b.serialization.registerClass(tn);var Vs=function(Q){function G(){return Q!==null&&Q.apply(this,arguments)||this}return U(G,Q),G.prototype.call=function(C,N){var te=this;return Object(b.tidy)(function(){var Be=jr(C);return te.dataFormat==="channelsLast"?Object(b.max)(Be,[1,2]):Object(b.max)(Be,[2,3])})},G.className="GlobalMaxPooling2D",G}(Kd);function Un(Q,G,C,N){if(Array.isArray(Q)){if(G!=null||C!=null)throw new ee("When inputs is an array, neither initialState or constants should be provided");N!=null&&(C=Q.slice(Q.length-N,Q.length),Q=Q.slice(0,Q.length-N)),Q.length>1&&(G=Q.slice(1,Q.length)),Q=Q[0]}function te(Be){return Be==null||Array.isArray(Be)?Be:[Be]}return{inputs:Q,initialState:G=te(G),constants:C=te(C)}}function Os(Q,G,C,N,te,Be,Ge,ft){return N===void 0&&(N=!1),Ge===void 0&&(Ge=!1),ft===void 0&&(ft=!1),Object(b.tidy)(function(){var Tt=G.shape.length;if(Tt<3)throw new ee("Input should be at least 3D, but is "+Tt+"D.");var Wt=[1,0].concat(hr(2,Tt));if(G=Object(b.transpose)(G,Wt),Be!=null)throw new I("The rnn() functoin of the deeplearn.js backend does not support constants yet.");Ge&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),te!=null&&((te=te.asType("bool").asType("float32")).rank===Tt-1&&(te=Object(b.expandDims)(te,-1)),te=Object(b.transpose)(te,Wt)),N&&(G=Object(b.reverse)(G,0),te!=null&&(te=Object(b.reverse)(te,0)));var ct,bn,Sn=[],Nn=C,Wn=G.shape[0],Rn=Object(b.unstack)(G);te!=null&&(bn=Object(b.unstack)(te));for(var tr,rr=function(Tr){var Vr=Rn[Tr],xr=Object(b.tidy)(function(){return Q(Vr,Nn)});if(te==null)ct=xr[0],Nn=xr[1];else{var $r=Object(b.tidy)(function(){var Wr=bn[Tr],ai=Object(b.onesLike)(Wr).sub(Wr);return{output:xr[0].mul(Wr).addStrict(Nn[0].mul(ai)),newStates:Nn.map(function(li,Hr){return xr[1][Hr].mul(Wr).addStrict(li.mul(ai))})}});ct=$r.output,Nn=$r.newStates}ft&&Sn.push(ct)},dr=0;dr<Wn;++dr)rr(dr);return ft&&(tr=Object(b.stack)(Sn,1)),[ct,tr,Nn]})}b.serialization.registerClass(Vs);var io=function(Q){function G(C){var N,te=Q.call(this,C)||this;if(C.cell==null)throw new ee("cell property is missing for the constructor of RNN.");if((N=Array.isArray(C.cell)?new ac({cells:C.cell}):C.cell).stateSize==null)throw new ee("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");return te.cell=N,te.returnSequences=C.returnSequences!=null&&C.returnSequences,te.returnState=C.returnState!=null&&C.returnState,te.goBackwards=C.goBackwards!=null&&C.goBackwards,te._stateful=C.stateful!=null&&C.stateful,te.unroll=C.unroll!=null&&C.unroll,te.supportsMasking=!0,te.inputSpec=[new eo({ndim:3})],te.stateSpec=null,te.states_=null,te.numConstants=null,te.keptStates=[],te}return U(G,Q),G.prototype.getStates=function(){return this.states_==null?hr(0,Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1).map(function(C){return null}):this.states_},G.prototype.setStates=function(C){this.states_=C},G.prototype.computeOutputShape=function(C){Ti(C)&&(C=C[0]),C=C;var N=this.cell.stateSize;Array.isArray(N)||(N=[N]);var te,Be=N[0];if(te=this.returnSequences?[C[0],C[1],Be]:[C[0],Be],this.returnState){for(var Ge=[],ft=0,Tt=N;ft<Tt.length;ft++){var Wt=Tt[ft];Ge.push([C[0],Wt])}return[te].concat(Ge)}return te},G.prototype.computeMask=function(C,N){var te=this;return Object(b.tidy)(function(){Array.isArray(N)&&(N=N[0]);var Be=te.returnSequences?N:null;if(te.returnState){var Ge=te.states.map(function(ft){return null});return[Be].concat(Ge)}return Be})},Object.defineProperty(G.prototype,"states",{get:function(){if(this.states_==null){for(var C=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,N=[],te=0;te<C;++te)N.push(null);return N}return this.states_},set:function(C){this.states_=C},enumerable:!0,configurable:!0}),G.prototype.build=function(C){if(this.numConstants!=null)throw new I("Constants support is not implemented in RNN yet.");Ti(C)&&(C=C[0]),C=C;var N=this.stateful?C[0]:null,te=C[C.length-1];this.inputSpec[0]=new eo({shape:[N,null,te]});var Be,Ge=[C[0]].concat(C.slice(2));if(this.cell.build(Ge),Be=Array.isArray(this.cell.stateSize)?this.cell.stateSize:[this.cell.stateSize],this.stateSpec!=null){if(!b.util.arraysEqual(this.stateSpec.map(function(ft){return ft.shape[ft.shape.length-1]}),Be))throw new ee("An initialState was passed that is not compatible with cell.stateSize. Received stateSpec="+this.stateSpec+"; However cell.stateSize is "+this.cell.stateSize)}else this.stateSpec=Be.map(function(ft){return new eo({shape:[null,ft]})});this.stateful&&this.resetStates()},G.prototype.resetStates=function(C,N){var te=this;N===void 0&&(N=!1),Object(b.tidy)(function(){if(!te.stateful)throw new q("Cannot call resetStates() on an RNN Layer that is not stateful.");var Be=te.inputSpec[0].shape[0];if(Be==null)throw new ee("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(te.states_==null)Array.isArray(te.cell.stateSize)?te.states_=te.cell.stateSize.map(function(ct){return Object(b.zeros)([Be,ct])}):te.states_=[Object(b.zeros)([Be,te.cell.stateSize])];else if(C==null)Object(b.dispose)(te.states_),te.keptStates!=null&&(Object(b.dispose)(te.keptStates),te.keptStates=[]),Array.isArray(te.cell.stateSize)?te.states_=te.cell.stateSize.map(function(ct){return Object(b.zeros)([Be,ct])}):te.states_[0]=Object(b.zeros)([Be,te.cell.stateSize]);else{if(Array.isArray(C)||(C=[C]),C.length!==te.states_.length)throw new ee("Layer "+te.name+" expects "+te.states_.length+" state(s), but it received "+C.length+" state value(s). Input received: "+C);N===!0?te.keptStates.push(te.states_.slice()):Object(b.dispose)(te.states_);for(var Ge=0;Ge<te.states_.length;++Ge){var ft=C[Ge],Tt=Array.isArray(te.cell.stateSize)?te.cell.stateSize[Ge]:te.cell.stateSize,Wt=[Be,Tt];if(!b.util.arraysEqual(ft.shape,Wt))throw new ee("State "+Ge+" is incompatible with layer "+te.name+": expected shape="+Wt+", received shape="+ft.shape);te.states_[Ge]=ft}}te.states_=te.states_.map(function(ct){return Object(b.keep)(ct.clone())})})},G.prototype.apply=function(C,N){var te=N==null?null:N.initialState,Be=N==null?null:N.constants;N==null&&(N={});var Ge=Un(C,te,Be,this.numConstants);C=Ge.inputs,te=Ge.initialState,Be=Ge.constants;var ft=[],Tt=[];if(te!=null){N.initialState=te,ft=ft.concat(te),this.stateSpec=[];for(var Wt=0,ct=te;Wt<ct.length;Wt++){var bn=ct[Wt];this.stateSpec.push(new eo({shape:bn.shape}))}Tt=Tt.concat(this.stateSpec)}if(Be!=null&&(N.constants=Be,ft=ft.concat(Be),this.numConstants=Be.length),ft[0]instanceof bo){var Sn=[C].concat(ft),Nn=this.inputSpec.concat(Tt),Wn=this.inputSpec;this.inputSpec=Nn;var Rn=Q.prototype.apply.call(this,Sn,N);return this.inputSpec=Wn,Rn}return Q.prototype.apply.call(this,C,N)},G.prototype.call=function(C,N){var te=this;return Object(b.tidy)(function(){var Be=N==null?null:N.mask,Ge=N==null?null:N.training,ft=N==null?null:N.initialState;C=jr(C),ft==null&&(ft=te.stateful?te.states_:te.getInitialState(C));var Tt=Array.isArray(te.cell.stateSize)?te.cell.stateSize.length:1;if(ft.length!==Tt)throw new ee("RNN Layer has "+Tt+" state(s) but was passed "+ft.length+" initial state(s).");te.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");var Wt={training:Ge},ct=Os(function(Rn,tr){var rr=te.cell.call([Rn].concat(tr),Wt);return[rr[0],rr.slice(1)]},C,ft,te.goBackwards,Be,null,te.unroll,te.returnSequences),bn=ct[0],Sn=ct[1],Nn=ct[2];te.stateful&&te.resetStates(Nn,Ge);var Wn=te.returnSequences?Sn:bn;return te.returnState?[Wn].concat(Nn):Wn})},G.prototype.getInitialState=function(C){var N=this;return Object(b.tidy)(function(){var te=Object(b.zeros)(C.shape);return te=gr(te=Object(b.sum)(te,[1,2])),Array.isArray(N.cell.stateSize)?N.cell.stateSize.map(function(Be){return Be>1?Xr(te,[1,Be]):te}):N.cell.stateSize>1?[Xr(te,[1,N.cell.stateSize])]:[te]})},Object.defineProperty(G.prototype,"trainableWeights",{get:function(){return this.trainable?this.cell.trainableWeights:[]},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"nonTrainableWeights",{get:function(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights},enumerable:!0,configurable:!0}),G.prototype.setFastWeightInitDuringBuild=function(C){Q.prototype.setFastWeightInitDuringBuild.call(this,C),this.cell!=null&&this.cell.setFastWeightInitDuringBuild(C)},G.prototype.getConfig=function(){var C={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};this.numConstants!=null&&(C.numConstants=this.numConstants);var N=this.cell.getConfig();C.cell={className:this.cell.getClassName(),config:N};var te=Q.prototype.getConfig.call(this);return Object.assign(C,te),C},G.fromConfig=function(C,N,te){te===void 0&&(te={});var Be=Fa(N.cell,te);return new C(Object.assign(N,{cell:Be}))},G.className="RNN",G}(qi);b.serialization.registerClass(io);var Bl=function(Q){function G(){return Q!==null&&Q.apply(this,arguments)||this}return U(G,Q),G}(qi),Rf=function(Q){function G(C){var N=Q.call(this,C)||this;return N.DEFAULT_ACTIVATION="tanh",N.DEFAULT_KERNEL_INITIALIZER="glorotNormal",N.DEFAULT_RECURRENT_INITIALIZER="orthogonal",N.DEFAULT_BIAS_INITIALIZER="zeros",N.units=C.units,jt(N.units,"units"),N.activation=Po(C.activation==null?N.DEFAULT_ACTIVATION:C.activation),N.useBias=C.useBias==null||C.useBias,N.kernelInitializer=zr(C.kernelInitializer||N.DEFAULT_KERNEL_INITIALIZER),N.recurrentInitializer=zr(C.recurrentInitializer||N.DEFAULT_RECURRENT_INITIALIZER),N.biasInitializer=zr(C.biasInitializer||N.DEFAULT_BIAS_INITIALIZER),N.kernelRegularizer=oa(C.kernelRegularizer),N.recurrentRegularizer=oa(C.recurrentRegularizer),N.biasRegularizer=oa(C.biasRegularizer),N.kernelConstraint=Hn(C.kernelConstraint),N.recurrentConstraint=Hn(C.recurrentConstraint),N.biasConstraint=Hn(C.biasConstraint),N.dropout=$n([1,Dn([0,C.dropout==null?0:C.dropout])]),N.recurrentDropout=$n([1,Dn([0,C.recurrentDropout==null?0:C.recurrentDropout])]),N.stateSize=N.units,N.dropoutMask=null,N.recurrentDropoutMask=null,N}return U(G,Q),G.prototype.build=function(C){C=jn(C),this.kernel=this.addWeight("kernel",[C[C.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0},G.prototype.call=function(C,N){var te=this;return Object(b.tidy)(function(){if((C=C).length!==2)throw new ee("SimpleRNNCell expects 2 input Tensors, got "+C.length+".");var Be=C[1];C=C[0];var Ge,ft=N.training!=null&&N.training;0<te.dropout&&te.dropout<1&&te.dropoutMask==null&&(te.dropoutMask=qs(function(){return Object(b.onesLike)(C)},te.dropout,ft)),0<te.recurrentDropout&&te.recurrentDropout<1&&te.recurrentDropoutMask==null&&(te.recurrentDropoutMask=qs(function(){return Object(b.onesLike)(Be)},te.recurrentDropout,ft));var Tt=te.dropoutMask,Wt=te.recurrentDropoutMask;Ge=oi(Tt!=null?Object(b.mul)(C,Tt):C,te.kernel.read()),te.bias!=null&&(Ge=bt(Ge,te.bias.read())),Wt!=null&&(Be=Object(b.mul)(Be,Wt));var ct=Object(b.add)(Ge,oi(Be,te.recurrentKernel.read()));return te.activation!=null&&(ct=te.activation.apply(ct)),[ct,ct]})},G.prototype.getConfig=function(){var C={units:this.units,activation:us(this.activation),useBias:this.useBias,kernelInitializer:ir(this.kernelInitializer),recurrentInitializer:ir(this.recurrentInitializer),biasInitializer:ir(this.biasInitializer),kernelRegularizer:Ri(this.kernelRegularizer),recurrentRegularizer:Ri(this.recurrentRegularizer),biasRegularizer:Ri(this.biasRegularizer),activityRegularizer:Ri(this.activityRegularizer),kernelConstraint:wn(this.kernelConstraint),recurrentConstraint:wn(this.recurrentConstraint),biasConstraint:wn(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout},N=Q.prototype.getConfig.call(this);return Object.assign(C,N),C},G.className="SimpleRNNCell",G}(Bl);b.serialization.registerClass(Rf);var nr=function(Q){function G(C){return C.cell=new Rf(C),Q.call(this,C)||this}return U(G,Q),G.prototype.call=function(C,N){var te=this;return Object(b.tidy)(function(){te.cell.dropoutMask!=null&&(Object(b.dispose)(te.cell.dropoutMask),te.cell.dropoutMask=null),te.cell.recurrentDropoutMask!=null&&(Object(b.dispose)(te.cell.recurrentDropoutMask),te.cell.recurrentDropoutMask=null);var Be=N==null?null:N.mask,Ge=N==null?null:N.training,ft=N==null?null:N.initialState;return Q.prototype.call.call(te,C,{mask:Be,training:Ge,initialState:ft})})},Object.defineProperty(G.prototype,"units",{get:function(){return this.cell.units},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"activation",{get:function(){return this.cell.activation},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"useBias",{get:function(){return this.cell.useBias},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"kernelInitializer",{get:function(){return this.cell.kernelInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"recurrentInitializer",{get:function(){return this.cell.recurrentInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"biasInitializer",{get:function(){return this.cell.biasInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"kernelRegularizer",{get:function(){return this.cell.kernelRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"recurrentRegularizer",{get:function(){return this.cell.recurrentRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"biasRegularizer",{get:function(){return this.cell.biasRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"kernelConstraint",{get:function(){return this.cell.kernelConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"recurrentConstraint",{get:function(){return this.cell.recurrentConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"biasConstraint",{get:function(){return this.cell.biasConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"dropout",{get:function(){return this.cell.dropout},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"recurrentDropout",{get:function(){return this.cell.recurrentDropout},enumerable:!0,configurable:!0}),G.prototype.getConfig=function(){var C={units:this.units,activation:us(this.activation),useBias:this.useBias,kernelInitializer:ir(this.kernelInitializer),recurrentInitializer:ir(this.recurrentInitializer),biasInitializer:ir(this.biasInitializer),kernelRegularizer:Ri(this.kernelRegularizer),recurrentRegularizer:Ri(this.recurrentRegularizer),biasRegularizer:Ri(this.biasRegularizer),activityRegularizer:Ri(this.activityRegularizer),kernelConstraint:wn(this.kernelConstraint),recurrentConstraint:wn(this.recurrentConstraint),biasConstraint:wn(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout},N=Q.prototype.getConfig.call(this);return delete N.cell,Object.assign(C,N),C},G.fromConfig=function(C,N){return new C(N)},G.className="SimpleRNN",G}(io);b.serialization.registerClass(nr);var $a=function(Q){function G(C){var N=Q.call(this,C)||this;return N.DEFAULT_ACTIVATION="tanh",N.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",N.DEFAULT_KERNEL_INITIALIZER="glorotNormal",N.DEFAULT_RECURRENT_INITIALIZER="orthogonal",N.DEFAULT_BIAS_INITIALIZER="zeros",N.units=C.units,jt(N.units,"units"),N.activation=Po(C.activation===void 0?N.DEFAULT_ACTIVATION:C.activation),N.recurrentActivation=Po(C.recurrentActivation===void 0?N.DEFAULT_RECURRENT_ACTIVATION:C.recurrentActivation),N.useBias=C.useBias==null||C.useBias,N.kernelInitializer=zr(C.kernelInitializer||N.DEFAULT_KERNEL_INITIALIZER),N.recurrentInitializer=zr(C.recurrentInitializer||N.DEFAULT_RECURRENT_INITIALIZER),N.biasInitializer=zr(C.biasInitializer||N.DEFAULT_BIAS_INITIALIZER),N.kernelRegularizer=oa(C.kernelRegularizer),N.recurrentRegularizer=oa(C.recurrentRegularizer),N.biasRegularizer=oa(C.biasRegularizer),N.kernelConstraint=Hn(C.kernelConstraint),N.recurrentConstraint=Hn(C.recurrentConstraint),N.biasConstraint=Hn(C.biasConstraint),N.dropout=$n([1,Dn([0,C.dropout==null?0:C.dropout])]),N.recurrentDropout=$n([1,Dn([0,C.recurrentDropout==null?0:C.recurrentDropout])]),N.implementation=C.implementation,N.stateSize=N.units,N.dropoutMask=null,N.recurrentDropoutMask=null,N}return U(G,Q),G.prototype.build=function(C){var N=(C=jn(C))[C.length-1];this.kernel=this.addWeight("kernel",[N,3*this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,3*this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[3*this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0},G.prototype.call=function(C,N){var te=this;return Object(b.tidy)(function(){if((C=C).length!==2)throw new ee("GRUCell expects 2 input Tensors (inputs, h, c), got "+C.length+".");var Be=N.training!=null&&N.training,Ge=C[1];C=C[0],0<te.dropout&&te.dropout<1&&te.dropoutMask==null&&(te.dropoutMask=qs(function(){return Object(b.onesLike)(C)},te.dropout,Be,3)),0<te.recurrentDropout&&te.recurrentDropout<1&&te.recurrentDropoutMask==null&&(te.recurrentDropoutMask=qs(function(){return Object(b.onesLike)(Ge)},te.recurrentDropout,Be,3));var ft,Tt,Wt,ct=te.dropoutMask,bn=te.recurrentDropoutMask;0<te.dropout&&te.dropout<1&&(C=Object(b.mul)(C,ct[0]));var Sn=oi(C,te.kernel.read());te.useBias&&(Sn=bt(Sn,te.bias.read())),0<te.recurrentDropout&&te.recurrentDropout<1&&(Ge=Object(b.mul)(Ge,bn[0]));var Nn=te.recurrentKernel.read(),Wn=Object(b.split)(Nn,[2*te.units,te.units],Nn.rank-1),Rn=Wn[0],tr=Wn[1],rr=oi(Ge,Rn),dr=Object(b.split)(Sn,3,Sn.rank-1),Tr=dr[0],Vr=dr[1],xr=dr[2],$r=Object(b.split)(rr,2,rr.rank-1),Wr=$r[0],ai=$r[1];ft=te.recurrentActivation.apply(Object(b.add)(Tr,Wr)),Tt=te.recurrentActivation.apply(Object(b.add)(Vr,ai));var li=oi(Object(b.mul)(Tt,Ge),tr);Wt=te.activation.apply(Object(b.add)(xr,li));var Hr=Object(b.add)(Object(b.mul)(ft,Ge),Object(b.mul)(Object(b.add)(1,Object(b.neg)(ft)),Wt));return[Hr,Hr]})},G.prototype.getConfig=function(){var C={units:this.units,activation:us(this.activation),recurrentActivation:us(this.recurrentActivation),useBias:this.useBias,kernelInitializer:ir(this.kernelInitializer),recurrentInitializer:ir(this.recurrentInitializer),biasInitializer:ir(this.biasInitializer),kernelRegularizer:Ri(this.kernelRegularizer),recurrentRegularizer:Ri(this.recurrentRegularizer),biasRegularizer:Ri(this.biasRegularizer),activityRegularizer:Ri(this.activityRegularizer),kernelConstraint:wn(this.kernelConstraint),recurrentConstraint:wn(this.recurrentConstraint),biasConstraint:wn(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation},N=Q.prototype.getConfig.call(this);return Object.assign(C,N),C},G.className="GRUCell",G}(Bl);b.serialization.registerClass($a);var xa=function(Q){function G(C){return C.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),C.cell=new $a(C),Q.call(this,C)||this}return U(G,Q),G.prototype.call=function(C,N){var te=this;return Object(b.tidy)(function(){te.cell.dropoutMask!=null&&(Object(b.dispose)(te.cell.dropoutMask),te.cell.dropoutMask=null),te.cell.recurrentDropoutMask!=null&&(Object(b.dispose)(te.cell.recurrentDropoutMask),te.cell.recurrentDropoutMask=null);var Be=N==null?null:N.mask,Ge=N==null?null:N.training,ft=N==null?null:N.initialState;return Q.prototype.call.call(te,C,{mask:Be,training:Ge,initialState:ft})})},Object.defineProperty(G.prototype,"units",{get:function(){return this.cell.units},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"activation",{get:function(){return this.cell.activation},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"recurrentActivation",{get:function(){return this.cell.recurrentActivation},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"useBias",{get:function(){return this.cell.useBias},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"kernelInitializer",{get:function(){return this.cell.kernelInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"recurrentInitializer",{get:function(){return this.cell.recurrentInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"biasInitializer",{get:function(){return this.cell.biasInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"kernelRegularizer",{get:function(){return this.cell.kernelRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"recurrentRegularizer",{get:function(){return this.cell.recurrentRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"biasRegularizer",{get:function(){return this.cell.biasRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"kernelConstraint",{get:function(){return this.cell.kernelConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"recurrentConstraint",{get:function(){return this.cell.recurrentConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"biasConstraint",{get:function(){return this.cell.biasConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"dropout",{get:function(){return this.cell.dropout},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"recurrentDropout",{get:function(){return this.cell.recurrentDropout},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"implementation",{get:function(){return this.cell.implementation},enumerable:!0,configurable:!0}),G.prototype.getConfig=function(){var C={units:this.units,activation:us(this.activation),recurrentActivation:us(this.recurrentActivation),useBias:this.useBias,kernelInitializer:ir(this.kernelInitializer),recurrentInitializer:ir(this.recurrentInitializer),biasInitializer:ir(this.biasInitializer),kernelRegularizer:Ri(this.kernelRegularizer),recurrentRegularizer:Ri(this.recurrentRegularizer),biasRegularizer:Ri(this.biasRegularizer),activityRegularizer:Ri(this.activityRegularizer),kernelConstraint:wn(this.kernelConstraint),recurrentConstraint:wn(this.recurrentConstraint),biasConstraint:wn(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation},N=Q.prototype.getConfig.call(this);return delete N.cell,Object.assign(C,N),C},G.fromConfig=function(C,N){return N.implmentation===0&&(N.implementation=1),new C(N)},G.className="GRU",G}(io);b.serialization.registerClass(xa);var Hi=function(Q){function G(C){var N=Q.call(this,C)||this;return N.DEFAULT_ACTIVATION="tanh",N.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",N.DEFAULT_KERNEL_INITIALIZER="glorotNormal",N.DEFAULT_RECURRENT_INITIALIZER="orthogonal",N.DEFAULT_BIAS_INITIALIZER="zeros",N.units=C.units,jt(N.units,"units"),N.activation=Po(C.activation===void 0?N.DEFAULT_ACTIVATION:C.activation),N.recurrentActivation=Po(C.recurrentActivation===void 0?N.DEFAULT_RECURRENT_ACTIVATION:C.recurrentActivation),N.useBias=C.useBias==null||C.useBias,N.kernelInitializer=zr(C.kernelInitializer||N.DEFAULT_KERNEL_INITIALIZER),N.recurrentInitializer=zr(C.recurrentInitializer||N.DEFAULT_RECURRENT_INITIALIZER),N.biasInitializer=zr(C.biasInitializer||N.DEFAULT_BIAS_INITIALIZER),N.unitForgetBias=C.unitForgetBias,N.kernelRegularizer=oa(C.kernelRegularizer),N.recurrentRegularizer=oa(C.recurrentRegularizer),N.biasRegularizer=oa(C.biasRegularizer),N.kernelConstraint=Hn(C.kernelConstraint),N.recurrentConstraint=Hn(C.recurrentConstraint),N.biasConstraint=Hn(C.biasConstraint),N.dropout=$n([1,Dn([0,C.dropout==null?0:C.dropout])]),N.recurrentDropout=$n([1,Dn([0,C.recurrentDropout==null?0:C.recurrentDropout])]),N.implementation=C.implementation,N.stateSize=[N.units,N.units],N.dropoutMask=null,N.recurrentDropoutMask=null,N}return U(G,Q),G.prototype.build=function(C){var N,te,Be=(C=jn(C))[C.length-1];if(this.kernel=this.addWeight("kernel",[Be,4*this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,4*this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){if(this.unitForgetBias){var Ge=this.biasInitializer,ft=this.units;te=new((N=function(Tt){function Wt(){return Tt!==null&&Tt.apply(this,arguments)||this}return U(Wt,Tt),Wt.prototype.apply=function(ct,bn){var Sn=Ge.apply([ft]),Nn=new et().apply([ft]),Wn=Ge.apply([2*ft]);return Yr(Yr(Sn,Nn),Wn)},Wt}(ye)).className="CustomInit",N)}else te=this.biasInitializer;this.bias=this.addWeight("bias",[4*this.units],null,te,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0},G.prototype.call=function(C,N){var te=this;return Object(b.tidy)(function(){var Be=N.training!=null&&N.training;if((C=C).length!==3)throw new ee("LSTMCell expects 3 input Tensors (inputs, h, c), got "+C.length+".");var Ge=C[1],ft=C[2];C=C[0],0<te.dropout&&te.dropout<1&&te.dropoutMask==null&&(te.dropoutMask=qs(function(){return Object(b.onesLike)(C)},te.dropout,Be,4)),0<te.recurrentDropout&&te.recurrentDropout<1&&te.recurrentDropoutMask==null&&(te.recurrentDropoutMask=qs(function(){return Object(b.onesLike)(Ge)},te.recurrentDropout,Be,4));var Tt,Wt,ct,bn,Sn=te.dropoutMask,Nn=te.recurrentDropoutMask;0<te.dropout&&te.dropout<1&&(C=Object(b.mul)(C,Sn[0]));var Wn=oi(C,te.kernel.read());0<te.recurrentDropout&&te.recurrentDropout<1&&(Ge=Object(b.mul)(Ge,Nn[0])),Wn=Object(b.add)(Wn,oi(Ge,te.recurrentKernel.read())),te.useBias&&(Wn=bt(Wn,te.bias.read()));var Rn=Object(b.split)(Wn,4,Wn.rank-1),tr=Rn[0],rr=Rn[1],dr=Rn[2],Tr=Rn[3];Tt=te.recurrentActivation.apply(tr),Wt=te.recurrentActivation.apply(rr),ct=Object(b.add)(Object(b.mul)(Wt,ft),Object(b.mul)(Tt,te.activation.apply(dr))),bn=te.recurrentActivation.apply(Tr);var Vr=Object(b.mul)(bn,te.activation.apply(ct));return[Vr,Vr,ct]})},G.prototype.getConfig=function(){var C={units:this.units,activation:us(this.activation),recurrentActivation:us(this.recurrentActivation),useBias:this.useBias,kernelInitializer:ir(this.kernelInitializer),recurrentInitializer:ir(this.recurrentInitializer),biasInitializer:ir(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:Ri(this.kernelRegularizer),recurrentRegularizer:Ri(this.recurrentRegularizer),biasRegularizer:Ri(this.biasRegularizer),activityRegularizer:Ri(this.activityRegularizer),kernelConstraint:wn(this.kernelConstraint),recurrentConstraint:wn(this.recurrentConstraint),biasConstraint:wn(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation},N=Q.prototype.getConfig.call(this);return Object.assign(C,N),C},G.className="LSTMCell",G}(Bl);b.serialization.registerClass(Hi);var ku=function(Q){function G(C){return C.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),C.cell=new Hi(C),Q.call(this,C)||this}return U(G,Q),G.prototype.call=function(C,N){var te=this;return Object(b.tidy)(function(){te.cell.dropoutMask!=null&&(Object(b.dispose)(te.cell.dropoutMask),te.cell.dropoutMask=null),te.cell.recurrentDropoutMask!=null&&(Object(b.dispose)(te.cell.recurrentDropoutMask),te.cell.recurrentDropoutMask=null);var Be=N==null?null:N.mask,Ge=N==null?null:N.training,ft=N==null?null:N.initialState;return Q.prototype.call.call(te,C,{mask:Be,training:Ge,initialState:ft})})},Object.defineProperty(G.prototype,"units",{get:function(){return this.cell.units},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"activation",{get:function(){return this.cell.activation},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"recurrentActivation",{get:function(){return this.cell.recurrentActivation},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"useBias",{get:function(){return this.cell.useBias},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"kernelInitializer",{get:function(){return this.cell.kernelInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"recurrentInitializer",{get:function(){return this.cell.recurrentInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"biasInitializer",{get:function(){return this.cell.biasInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"unitForgetBias",{get:function(){return this.cell.unitForgetBias},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"kernelRegularizer",{get:function(){return this.cell.kernelRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"recurrentRegularizer",{get:function(){return this.cell.recurrentRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"biasRegularizer",{get:function(){return this.cell.biasRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"kernelConstraint",{get:function(){return this.cell.kernelConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"recurrentConstraint",{get:function(){return this.cell.recurrentConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"biasConstraint",{get:function(){return this.cell.biasConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"dropout",{get:function(){return this.cell.dropout},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"recurrentDropout",{get:function(){return this.cell.recurrentDropout},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"implementation",{get:function(){return this.cell.implementation},enumerable:!0,configurable:!0}),G.prototype.getConfig=function(){var C={units:this.units,activation:us(this.activation),recurrentActivation:us(this.recurrentActivation),useBias:this.useBias,kernelInitializer:ir(this.kernelInitializer),recurrentInitializer:ir(this.recurrentInitializer),biasInitializer:ir(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:Ri(this.kernelRegularizer),recurrentRegularizer:Ri(this.recurrentRegularizer),biasRegularizer:Ri(this.biasRegularizer),activityRegularizer:Ri(this.activityRegularizer),kernelConstraint:wn(this.kernelConstraint),recurrentConstraint:wn(this.recurrentConstraint),biasConstraint:wn(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation},N=Q.prototype.getConfig.call(this);return delete N.cell,Object.assign(C,N),C},G.fromConfig=function(C,N){return N.implmentation===0&&(N.implementation=1),new C(N)},G.className="LSTM",G}(io);b.serialization.registerClass(ku);var ac=function(Q){function G(C){var N=Q.call(this,C)||this;return N.cells=C.cells,N}return U(G,Q),Object.defineProperty(G.prototype,"stateSize",{get:function(){for(var C=[],N=0,te=this.cells.slice().reverse();N<te.length;N++){var Be=te[N];Array.isArray(Be.stateSize)?C.push.apply(C,Be.stateSize):C.push(Be.stateSize)}return C},enumerable:!0,configurable:!0}),G.prototype.call=function(C,N){var te=this;return Object(b.tidy)(function(){for(var Be=(C=C).slice(1),Ge=[],ft=0,Tt=te.cells.slice().reverse();ft<Tt.length;ft++){var Wt=Tt[ft];Array.isArray(Wt.stateSize)?Ge.push(Be.splice(0,Wt.stateSize.length)):Ge.push(Be.splice(0,1))}Ge.reverse();for(var ct,bn=[],Sn=0;Sn<te.cells.length;++Sn)Wt=te.cells[Sn],Be=Ge[Sn],ct=Sn===0?[C[0]].concat(Be):[ct[0]].concat(Be),ct=Wt.call(ct,N),bn.push(ct.slice(1));Be=[];for(var Nn=0,Wn=bn.slice().reverse();Nn<Wn.length;Nn++){var Rn=Wn[Nn];Be.push.apply(Be,Rn)}return[ct[0]].concat(Be)})},G.prototype.build=function(C){var N;Ti(C)&&(C=C[0]),C=C,this.cells.forEach(function(te,Be){Yn("RNNCell_"+Be,function(){te.build(C),N=Array.isArray(te.stateSize)?te.stateSize[0]:te.stateSize,C=[C[0],N]})}),this.built=!0},G.prototype.getConfig=function(){for(var C=[],N=0,te=this.cells;N<te.length;N++){var Be=te[N];C.push({className:Be.getClassName(),config:Be.getConfig()})}var Ge={cells:C},ft=Q.prototype.getConfig.call(this);return Object.assign(Ge,ft),Ge},G.fromConfig=function(C,N,te){te===void 0&&(te={});for(var Be=[],Ge=0,ft=N.cells;Ge<ft.length;Ge++){var Tt=ft[Ge];Be.push(Fa(Tt,te))}return new C({cells:Be})},Object.defineProperty(G.prototype,"trainableWeights",{get:function(){if(!this.trainable)return[];for(var C=[],N=0,te=this.cells;N<te.length;N++){var Be=te[N];C.push.apply(C,Be.trainableWeights)}return C},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"nonTrainableWeights",{get:function(){for(var C=[],N=0,te=this.cells;N<te.length;N++){var Be=te[N];C.push.apply(C,Be.nonTrainableWeights)}if(!this.trainable){for(var Ge=[],ft=0,Tt=this.cells;ft<Tt.length;ft++)Be=Tt[ft],Ge.push.apply(Ge,Be.trainableWeights);return Ge.concat(C)}return C},enumerable:!0,configurable:!0}),G.prototype.getWeights=function(){for(var C=[],N=0,te=this.cells;N<te.length;N++){var Be=te[N];C.push.apply(C,Be.weights)}return ao(C)},G.prototype.setWeights=function(C){for(var N=[],te=0,Be=this.cells;te<Be.length;te++)for(var Ge=Be[te],ft=Ge.weights.length,Tt=C.splice(ft),Wt=0;Wt<Ge.weights.length;++Wt)N.push([Ge.weights[Wt],Tt[Wt]]);yo(N)},G.className="StackedRNNCells",G}(Bl);function qs(Q,G,C,N){function te(){return Lr(Q(),G)}if(C===void 0&&(C=null),N===void 0&&(N=1),N>1){for(var Be=[],Ge=0;Ge<N;Ge++)Be.push(Mt(te,Q,C));return Be.map(function(ft){return Object(b.keep)(ft.clone())})}return Object(b.keep)(Mt(te,Q,C).clone())}b.serialization.registerClass(ac);var sc=function(Q){function G(C){var N=Q.call(this,C)||this;return N.layer=C.layer,N}return U(G,Q),G.prototype.build=function(C){this.built=!0},Object.defineProperty(G.prototype,"trainable",{get:function(){return this.layer!=null&&this.layer.trainable},set:function(C){this.layer!=null&&(this.layer.trainable=C)},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"trainableWeights",{get:function(){return this.layer.trainableWeights},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"nonTrainableWeights",{get:function(){return this.layer.nonTrainableWeights},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"updates",{get:function(){return this.layer._updates},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"losses",{get:function(){return this.layer.losses},enumerable:!0,configurable:!0}),G.prototype.getWeights=function(){return this.layer.getWeights()},G.prototype.setWeights=function(C){this.layer.setWeights(C)},G.prototype.getConfig=function(){var C={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},N=Q.prototype.getConfig.call(this);return Object.assign(C,N),C},G.prototype.setFastWeightInitDuringBuild=function(C){Q.prototype.setFastWeightInitDuringBuild.call(this,C),this.layer!=null&&this.layer.setFastWeightInitDuringBuild(C)},G.fromConfig=function(C,N,te){te===void 0&&(te={});var Be=Fa(N.layer,te);delete N.layer;var Ge={layer:Be};return Object.assign(Ge,N),new C(Ge)},G}(qi),Xo=function(Q){function G(C){var N=Q.call(this,C)||this;return N.supportsMasking=!0,N}return U(G,Q),G.prototype.build=function(C){if((C=jn(C)).length<3)throw new ee("TimeDistributed layer expects an input shape >= 3D, but received input shape "+JSON.stringify(C));this.inputSpec=[{shape:C}];var N=[C[0]].concat(C.slice(2));this.layer.built||(this.layer.build(N),this.layer.built=!0),Q.prototype.build.call(this,C)},G.prototype.computeOutputShape=function(C){var N=[(C=jn(C))[0]].concat(C.slice(2)),te=this.layer.computeOutputShape(N),Be=C[1];return[te[0],Be].concat(te.slice(1))},G.prototype.call=function(C,N){var te=this;return Object(b.tidy)(function(){return Os(function(Be,Ge){return[jr(te.layer.call(Be,N)),[]]},C=jr(C),[],!1,null,null,!1,!0)[1]})},G.className="TimeDistributed",G}(sc);b.serialization.registerClass(Xo);var Vu="concat",Hs=function(Q){function G(C){var N=Q.call(this,C)||this,te=C.layer.getConfig(),Be={};Be.className=C.layer.getClassName(),Be.config=te,N.forwardLayer=Fa(Be),te.goBackwards=te.goBackwards!==!0;var Ge={};if(Ge.className=C.layer.getClassName(),Ge.config=te,N.backwardLayer=Fa(Ge),N.forwardLayer.name="forward_"+N.forwardLayer.name,N.backwardLayer.name="backward_"+N.backwardLayer.name,N.mergeMode=C.mergeMode===void 0?Vu:C.mergeMode,function(ft){Ft(pt,"BidirectionalMergeMode",ft)}(N.mergeMode),C.weights)throw new I("weights support is not implemented for Bidirectional layer yet.");return N._stateful=C.layer.stateful,N.returnSequences=C.layer.returnSequences,N.returnState=C.layer.returnState,N.supportsMasking=!0,N._trainable=!0,N.inputSpec=C.layer.inputSpec,N.numConstants=null,N}return U(G,Q),Object.defineProperty(G.prototype,"trainable",{get:function(){return this._trainable},set:function(C){this._trainable=C,this.forwardLayer!=null&&(this.forwardLayer.trainable=C),this.backwardLayer!=null&&(this.backwardLayer.trainable=C)},enumerable:!0,configurable:!0}),G.prototype.getWeights=function(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())},G.prototype.setWeights=function(C){var N=C.length,te=Math.floor(N/2);this.forwardLayer.setWeights(C.slice(0,te)),this.backwardLayer.setWeights(C.slice(te))},G.prototype.computeOutputShape=function(C){var N,te,Be,Ge=this.forwardLayer.computeOutputShape(C);return Array.isArray(Ge)&&Array.isArray(Ge[0])||(Ge=[Ge]),Ge=Ge,this.returnState&&(Be=Ge.slice(1)),N=Ge[0],N=N,this.mergeMode==="concat"?(N[N.length-1]*=2,te=[N]):te=this.mergeMode==null?[N,N.slice()]:[N],this.returnState?this.mergeMode==null?te.concat(Be).concat(Be.slice()):[N].concat(Be).concat(Be.slice()):pe(te)},G.prototype.apply=function(C,N){var te=N==null?null:N.initialState,Be=N==null?null:N.constants;N==null&&(N={});var Ge=Un(C,te,Be,this.numConstants);if(C=Ge.inputs,te=Ge.initialState,Be=Ge.constants,Array.isArray(C)&&(te=C.slice(1),C=C[0]),(te==null||te.length===0)&&Be==null)return Q.prototype.apply.call(this,C,N);var ft=[],Tt=[];if(te!=null){var Wt=te.length;if(Wt%2>0)throw new ee("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");N.initialState=te,ft.push.apply(ft,te);var ct=te.map(function(dr){return new eo({shape:dr.shape})});this.forwardLayer.stateSpec=ct.slice(0,Wt/2),this.backwardLayer.stateSpec=ct.slice(Wt/2),Tt.push.apply(Tt,ct)}if(Be!=null)throw new I("Support for constants in Bidirectional layers is not implemented yet.");for(var bn=ft[0]instanceof bo,Sn=0,Nn=ft;Sn<Nn.length;Sn++)if(Nn[Sn]instanceof bo!==bn)throw new ee("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors");if(bn){var Wn=[C].concat(ft),Rn=this.inputSpec.concat(Tt),tr=this.inputSpec;this.inputSpec=Rn;var rr=Q.prototype.apply.call(this,Wn,N);return this.inputSpec=tr,rr}return Q.prototype.apply.call(this,C,N)},G.prototype.call=function(C,N){var te=this;return Object(b.tidy)(function(){var Be,Ge,ft,Tt,Wt=N.initialState;if(Wt==null)Be=te.forwardLayer.call(C,N),Ge=te.backwardLayer.call(C,N);else{var ct=Wt.slice(0,Wt.length/2),bn=Wt.slice(Wt.length/2);Be=te.forwardLayer.call(C,Object.assign(N,{initialState:ct})),Ge=te.backwardLayer.call(C,Object.assign(N,{initialState:bn}))}return te.returnState&&(Array.isArray(Be)&&(ft=Be.slice(1).concat(Ge.slice(1))),Be=Be[0],Ge=Ge[0]),te.returnSequences&&(Ge=Object(b.reverse)(Ge,1)),te.mergeMode==="concat"?Tt=di([Be,Ge]):te.mergeMode==="sum"?Tt=Object(b.add)(Be,Ge):te.mergeMode==="ave"?Tt=Object(b.mul)(.5,Object(b.add)(Be,Ge)):te.mergeMode==="mul"?Tt=Object(b.mul)(Be,Ge):te.mergeMode==null&&(Tt=[Be,Ge]),te.returnState?te.mergeMode==null?Tt.concat(ft):[Tt].concat(ft):Tt})},G.prototype.resetStates=function(C){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()},G.prototype.build=function(C){var N=this;Yn(this.forwardLayer.name,function(){N.forwardLayer.build(C)}),Yn(this.backwardLayer.name,function(){N.backwardLayer.build(C)}),this.built=!0},G.prototype.computeMask=function(C,N){var te;if(Array.isArray(N)&&(N=N[0]),te=this.returnSequences?this.mergeMode==null?[N,N]:N:this.mergeMode==null?[null,null]:null,this.returnState){var Be=this.forwardLayer.states.map(function(Ge){return null});return Array.isArray(te)?te.concat(Be).concat(Be):[te].concat(Be).concat(Be)}return te},Object.defineProperty(G.prototype,"trainableWeights",{get:function(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"nonTrainableWeights",{get:function(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)},enumerable:!0,configurable:!0}),G.prototype.setFastWeightInitDuringBuild=function(C){Q.prototype.setFastWeightInitDuringBuild.call(this,C),this.forwardLayer!=null&&this.forwardLayer.setFastWeightInitDuringBuild(C),this.backwardLayer!=null&&this.backwardLayer.setFastWeightInitDuringBuild(C)},G.prototype.getConfig=function(){var C={mergeMode:this.mergeMode},N=Q.prototype.getConfig.call(this);return Object.assign(C,N),C},G.fromConfig=function(C,N){var te=Fa(N.layer);if(delete N.layer,N.numConstants!=null)throw new I("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");var Be=N;return Be.layer=te,new C(Be)},G.className="Bidirectional",G}(sc);function so(Q){return new ba(Q)}function cs(Q){return new Ml(Q)}function _a(Q){return new $d(Q)}function ls(Q){return new Gd(Q)}function Yo(Q){return new Vs(Q)}function $s(Q){return new zh(Q)}function Eu(Q){return new Cs(Q)}b.serialization.registerClass(Hs);var qu=ls,uc=Yo,Cu=$s,Jc=Eu,Qc=Object.freeze({inputLayer:function(Q){return new bu(Q)},elu:function(Q){return new Rp(Q)},reLU:function(Q){return new Ld(Q)},leakyReLU:function(Q){return new zd(Q)},prelu:function(Q){return new Ud(Q)},softmax:function(Q){return new ks(Q)},thresholdedReLU:function(Q){return new zu(Q)},conv1d:function(Q){return new Lo(Q)},conv2d:function(Q){return new Wd(Q)},conv2dTranspose:function(Q){return new _l(Q)},conv3d:function(Q){return new Mp(Q)},separableConv2d:function(Q){return new jh(Q)},cropping2D:function(Q){return new Bh(Q)},upSampling2d:function(Q){return new Dl(Q)},depthwiseConv2d:function(Q){return new Ph(Q)},activation:function(Q){return new _f(Q)},dense:function(Q){return new Ec(Q)},dropout:function(Q){return new Tl(Q)},spatialDropout1d:function(Q){return new Kc(Q)},flatten:function(Q){return new Lh(Q)},repeatVector:function(Q){return new Nl(Q)},reshape:function(Q){return new Cc(Q)},permute:function(Q){return new km(Q)},embedding:function(Q){return new ra(Q)},add:function(Q){return new Ia(Q)},average:function(Q){return new Es(Q)},concatenate:function(Q){return new Ac(Q)},maximum:function(Q){return new Oc(Q)},minimum:function(Q){return new Ra(Q)},multiply:function(Q){return new Mi(Q)},dot:function(Q){return new Df(Q)},batchNormalization:function(Q){return new qd(Q)},layerNormalization:function(Q){return new Il(Q)},zeroPadding2d:function(Q){return new jp(Q)},averagePooling1d:so,avgPool1d:function(Q){return so(Q)},avgPooling1d:function(Q){return so(Q)},averagePooling2d:cs,avgPool2d:function(Q){return cs(Q)},avgPooling2d:function(Q){return cs(Q)},averagePooling3d:_a,avgPool3d:function(Q){return _a(Q)},avgPooling3d:function(Q){return _a(Q)},globalAveragePooling1d:function(Q){return new jl(Q)},globalAveragePooling2d:function(Q){return new tn(Q)},globalMaxPooling1d:ls,globalMaxPooling2d:Yo,maxPooling1d:$s,maxPooling2d:Eu,maxPooling3d:function(Q){return new Uh(Q)},gru:function(Q){return new xa(Q)},gruCell:function(Q){return new $a(Q)},lstm:function(Q){return new ku(Q)},lstmCell:function(Q){return new Hi(Q)},simpleRNN:function(Q){return new nr(Q)},simpleRNNCell:function(Q){return new Rf(Q)},rnn:function(Q){return new io(Q)},stackedRNNCells:function(Q){return new ac(Q)},bidirectional:function(Q){return new Hs(Q)},timeDistributed:function(Q){return new Xo(Q)},globalMaxPool1d:qu,globalMaxPool2d:uc,maxPool1d:Cu,maxPool2d:Jc,Layer:qi,RNN:io,RNNCell:Bl,input:ko,gaussianNoise:function(Q){return new Tf(Q)},gaussianDropout:function(Q){return new Xc(Q)},alphaDropout:function(Q){return new Vd(Q)},masking:function(Q){return new Fl(Q)}}),Wh=Object.freeze({binaryAccuracy:function(Q,G){return bf(Q,G)},binaryCrossentropy:function(Q,G){return wf(Q,G)},sparseCategoricalAccuracy:function(Q,G){return kf(Q,G)},categoricalAccuracy:function(Q,G){return xf(Q,G)},categoricalCrossentropy:function(Q,G){return ys(Q,G)},precision:function(Q,G){return Ah(Q,G)},recall:function(Q,G){return Nd(Q,G)},cosineProximity:function(Q,G){return rc(Q,G)},meanAbsoluteError:function(Q,G){return tc(Q,G)},meanAbsolutePercentageError:function(Q,G){return ss(Q,G)},MAPE:function(Q,G){return ss(Q,G)},mape:function(Q,G){return ss(Q,G)},meanSquaredError:function(Q,G){return ua(Q,G)},MSE:function(Q,G){return ua(Q,G)},mse:function(Q,G){return ua(Q,G)}}),Zc=Object.freeze({modelFromJSON:function(Q,G){return J(this,void 0,void 0,function(){var C,N,te,Be,Ge,ft,Tt,Wt;return R(this,function(ct){switch(ct.label){case 0:return"modelTopology"in Q||(Q={modelTopology:Q}),(C=(Q=Q).modelTopology).model_config!=null&&(C=C.model_config),N=Ii(C),te=Fa(N,G),Q.weightsManifest==null?[3,2]:[4,b.io.loadWeights(Q.weightsManifest,Q.pathPrefix,te.weights.map(function(bn){return bn.originalName}))];case 1:for(Be=ct.sent(),Ge={},ft=0,Tt=te.weights;ft<Tt.length;ft++)Wt=Tt[ft],Ge[Wt.originalName]=Be[Wt.originalName];te.loadWeights(Ge),Object(b.dispose)(Be),ct.label=2;case 2:return[2,te]}})})}}),Gs=Object.freeze({l1l2:function(Q){return new Al(Q)},l1:function(Q){return function(G){return Ih(G),new Al({l1:G!=null?G.l1:null,l2:0})}(Q)},l2:function(Q){return function(G){return Ih(G),new Al({l2:G!=null?G.l2:null,l1:0})}(Q)}}),Ou=function(Q){function G(){var C=Q!==null&&Q.apply(this,arguments)||this;return C.model=null,C}return U(G,Q),G.prototype.setModel=function(C){if(!(C instanceof kc))throw new Error("model must be a LayersModel, not some other Container");this.model=C},G}(as);function Au(Q,G){return Q<G}function iu(Q,G){return Q>G}var Vh=function(Q){function G(C){var N=Q.call(this)||this;if(C==null&&(C={}),C.restoreBestWeights)throw new I("restoreBestWeights = True is not implemented in EarlyStopping yet.");return N.monitor=C.monitor||"val_loss",N.minDelta=Math.abs(C.minDelta||0),N.patience=C.patience||0,N.verbose=C.verbose||0,N.mode=C.mode||"auto",N.baseline=C.baseline,["auto","min","max"].indexOf(N.mode)===-1&&(console.warn("EarlyStopping mode '"+N.mode+"' is invalid. Falling back to mode 'auto'."),N.mode="auto"),N.mode==="min"?N.monitorFunc=Au:N.mode==="max"||N.monitor.indexOf("acc")!==-1?N.monitorFunc=iu:N.monitorFunc=Au,N.monitorFunc===Au&&(N.minDelta*=-1),N}return U(G,Q),G.prototype.onTrainBegin=function(C){return J(this,void 0,void 0,function(){return R(this,function(N){return this.wait=0,this.stoppedEpoch=0,this.baseline!=null?this.best=this.baseline:this.best=this.monitorFunc===Au?1/0:-1/0,[2]})})},G.prototype.onEpochEnd=function(C,N){return J(this,void 0,void 0,function(){var te;return R(this,function(Be){switch(Be.label){case 0:return[4,Bu(N)];case 1:return Be.sent(),(te=this.getMonitorValue(N))==null?[2]:(this.monitorFunc(te-this.minDelta,this.best)?(this.best=te,this.wait=0):(this.wait++,this.wait>=this.patience&&(this.stoppedEpoch=C,this.model.stopTraining=!0)),[2])}})})},G.prototype.onTrainEnd=function(C){return J(this,void 0,void 0,function(){return R(this,function(N){return this.stoppedEpoch>0&&this.verbose&&console.log("Epoch "+this.stoppedEpoch+": early stopping."),[2]})})},G.prototype.getMonitorValue=function(C){C==null&&(C={});var N=C[this.monitor];return N==null&&console.warn("Metric for EarlyStopping "+this.monitor+" is not available. Available metrics are: "+Object.keys(C)),N},G}(Ou),Mf={earlyStopping:function(Q){return new Vh(Q)}},jf=a(20),Pl=a(130);a.d(A,"version",function(){return Bf}),a.d(A,"AdadeltaOptimizer",function(){return b.AdadeltaOptimizer}),a.d(A,"AdagradOptimizer",function(){return b.AdagradOptimizer}),a.d(A,"AdamOptimizer",function(){return b.AdamOptimizer}),a.d(A,"AdamaxOptimizer",function(){return b.AdamaxOptimizer}),a.d(A,"Add",function(){return b.Add}),a.d(A,"AddN",function(){return b.AddN}),a.d(A,"BroadcastTo",function(){return b.BroadcastTo}),a.d(A,"DataStorage",function(){return b.DataStorage}),a.d(A,"Div",function(){return b.Div}),a.d(A,"ENV",function(){return b.ENV}),a.d(A,"Environment",function(){return b.Environment}),a.d(A,"FromPixels",function(){return b.FromPixels}),a.d(A,"FusedBatchNorm",function(){return b.FusedBatchNorm}),a.d(A,"Identity",function(){return b.Identity}),a.d(A,"KernelBackend",function(){return b.KernelBackend}),a.d(A,"MaxPoolWithArgmax",function(){return b.MaxPoolWithArgmax}),a.d(A,"MomentumOptimizer",function(){return b.MomentumOptimizer}),a.d(A,"NonMaxSuppressionV5",function(){return b.NonMaxSuppressionV5}),a.d(A,"OneHot",function(){return b.OneHot}),a.d(A,"Optimizer",function(){return b.Optimizer}),a.d(A,"PadV2",function(){return b.PadV2}),a.d(A,"RMSPropOptimizer",function(){return b.RMSPropOptimizer}),a.d(A,"Rank",function(){return b.Rank}),a.d(A,"Reduction",function(){return b.Reduction}),a.d(A,"SGDOptimizer",function(){return b.SGDOptimizer}),a.d(A,"Square",function(){return b.Square}),a.d(A,"SquaredDifference",function(){return b.SquaredDifference}),a.d(A,"Tensor",function(){return b.Tensor}),a.d(A,"TensorBuffer",function(){return b.TensorBuffer}),a.d(A,"Tile",function(){return b.Tile}),a.d(A,"Transpose",function(){return b.Transpose}),a.d(A,"Variable",function(){return b.Variable}),a.d(A,"abs",function(){return b.abs}),a.d(A,"acos",function(){return b.acos}),a.d(A,"acosh",function(){return b.acosh}),a.d(A,"add",function(){return b.add}),a.d(A,"addN",function(){return b.addN}),a.d(A,"addStrict",function(){return b.addStrict}),a.d(A,"all",function(){return b.all}),a.d(A,"any",function(){return b.any}),a.d(A,"argMax",function(){return b.argMax}),a.d(A,"argMin",function(){return b.argMin}),a.d(A,"asin",function(){return b.asin}),a.d(A,"asinh",function(){return b.asinh}),a.d(A,"atan",function(){return b.atan}),a.d(A,"atan2",function(){return b.atan2}),a.d(A,"atanh",function(){return b.atanh}),a.d(A,"avgPool",function(){return b.avgPool}),a.d(A,"avgPool3d",function(){return b.avgPool3d}),a.d(A,"backend",function(){return b.backend}),a.d(A,"backend_util",function(){return b.backend_util}),a.d(A,"basicLSTMCell",function(){return b.basicLSTMCell}),a.d(A,"batchNorm",function(){return b.batchNorm}),a.d(A,"batchNorm2d",function(){return b.batchNorm2d}),a.d(A,"batchNorm3d",function(){return b.batchNorm3d}),a.d(A,"batchNorm4d",function(){return b.batchNorm4d}),a.d(A,"batchNormalization",function(){return b.batchNormalization}),a.d(A,"batchNormalization2d",function(){return b.batchNormalization2d}),a.d(A,"batchNormalization3d",function(){return b.batchNormalization3d}),a.d(A,"batchNormalization4d",function(){return b.batchNormalization4d}),a.d(A,"batchToSpaceND",function(){return b.batchToSpaceND}),a.d(A,"booleanMaskAsync",function(){return b.booleanMaskAsync}),a.d(A,"broadcastTo",function(){return b.broadcastTo}),a.d(A,"browser",function(){return b.browser}),a.d(A,"buffer",function(){return b.buffer}),a.d(A,"cast",function(){return b.cast}),a.d(A,"ceil",function(){return b.ceil}),a.d(A,"clipByValue",function(){return b.clipByValue}),a.d(A,"clone",function(){return b.clone}),a.d(A,"complex",function(){return b.complex}),a.d(A,"concat",function(){return b.concat}),a.d(A,"concat1d",function(){return b.concat1d}),a.d(A,"concat2d",function(){return b.concat2d}),a.d(A,"concat3d",function(){return b.concat3d}),a.d(A,"concat4d",function(){return b.concat4d}),a.d(A,"conv1d",function(){return b.conv1d}),a.d(A,"conv2d",function(){return b.conv2d}),a.d(A,"conv2dTranspose",function(){return b.conv2dTranspose}),a.d(A,"conv3d",function(){return b.conv3d}),a.d(A,"conv3dTranspose",function(){return b.conv3dTranspose}),a.d(A,"cos",function(){return b.cos}),a.d(A,"cosh",function(){return b.cosh}),a.d(A,"cumsum",function(){return b.cumsum}),a.d(A,"customGrad",function(){return b.customGrad}),a.d(A,"deprecationWarn",function(){return b.deprecationWarn}),a.d(A,"depthToSpace",function(){return b.depthToSpace}),a.d(A,"depthwiseConv2d",function(){return b.depthwiseConv2d}),a.d(A,"diag",function(){return b.diag}),a.d(A,"disableDeprecationWarnings",function(){return b.disableDeprecationWarnings}),a.d(A,"dispose",function(){return b.dispose}),a.d(A,"disposeVariables",function(){return b.disposeVariables}),a.d(A,"div",function(){return b.div}),a.d(A,"divNoNan",function(){return b.divNoNan}),a.d(A,"divStrict",function(){return b.divStrict}),a.d(A,"dot",function(){return b.dot}),a.d(A,"dropout",function(){return b.dropout}),a.d(A,"elu",function(){return b.elu}),a.d(A,"enableDebugMode",function(){return b.enableDebugMode}),a.d(A,"enableProdMode",function(){return b.enableProdMode}),a.d(A,"engine",function(){return b.engine}),a.d(A,"env",function(){return b.env}),a.d(A,"equal",function(){return b.equal}),a.d(A,"equalStrict",function(){return b.equalStrict}),a.d(A,"erf",function(){return b.erf}),a.d(A,"exp",function(){return b.exp}),a.d(A,"expandDims",function(){return b.expandDims}),a.d(A,"expm1",function(){return b.expm1}),a.d(A,"eye",function(){return b.eye}),a.d(A,"fft",function(){return b.fft}),a.d(A,"fill",function(){return b.fill}),a.d(A,"findBackend",function(){return b.findBackend}),a.d(A,"findBackendFactory",function(){return b.findBackendFactory}),a.d(A,"floor",function(){return b.floor}),a.d(A,"floorDiv",function(){return b.floorDiv}),a.d(A,"frame",function(){return b.frame}),a.d(A,"fused",function(){return b.fused}),a.d(A,"gather",function(){return b.gather}),a.d(A,"gatherND",function(){return b.gatherND}),a.d(A,"gather_util",function(){return b.gather_util}),a.d(A,"getBackend",function(){return b.getBackend}),a.d(A,"getGradient",function(){return b.getGradient}),a.d(A,"getKernel",function(){return b.getKernel}),a.d(A,"getKernelsForBackend",function(){return b.getKernelsForBackend}),a.d(A,"grad",function(){return b.grad}),a.d(A,"grads",function(){return b.grads}),a.d(A,"greater",function(){return b.greater}),a.d(A,"greaterEqual",function(){return b.greaterEqual}),a.d(A,"greaterEqualStrict",function(){return b.greaterEqualStrict}),a.d(A,"greaterStrict",function(){return b.greaterStrict}),a.d(A,"hammingWindow",function(){return b.hammingWindow}),a.d(A,"hannWindow",function(){return b.hannWindow}),a.d(A,"ifft",function(){return b.ifft}),a.d(A,"imag",function(){return b.imag}),a.d(A,"image",function(){return b.image}),a.d(A,"inTopKAsync",function(){return b.inTopKAsync}),a.d(A,"io",function(){return b.io}),a.d(A,"irfft",function(){return b.irfft}),a.d(A,"isFinite",function(){return b.isFinite}),a.d(A,"isInf",function(){return b.isInf}),a.d(A,"isNaN",function(){return b.isNaN}),a.d(A,"keep",function(){return b.keep}),a.d(A,"leakyRelu",function(){return b.leakyRelu}),a.d(A,"less",function(){return b.less}),a.d(A,"lessEqual",function(){return b.lessEqual}),a.d(A,"lessEqualStrict",function(){return b.lessEqualStrict}),a.d(A,"lessStrict",function(){return b.lessStrict}),a.d(A,"linalg",function(){return b.linalg}),a.d(A,"linspace",function(){return b.linspace}),a.d(A,"localResponseNormalization",function(){return b.localResponseNormalization}),a.d(A,"log",function(){return b.log}),a.d(A,"log1p",function(){return b.log1p}),a.d(A,"logSigmoid",function(){return b.logSigmoid}),a.d(A,"logSoftmax",function(){return b.logSoftmax}),a.d(A,"logSumExp",function(){return b.logSumExp}),a.d(A,"logicalAnd",function(){return b.logicalAnd}),a.d(A,"logicalNot",function(){return b.logicalNot}),a.d(A,"logicalOr",function(){return b.logicalOr}),a.d(A,"logicalXor",function(){return b.logicalXor}),a.d(A,"losses",function(){return b.losses}),a.d(A,"matMul",function(){return b.matMul}),a.d(A,"math",function(){return b.math}),a.d(A,"max",function(){return b.max}),a.d(A,"maxPool",function(){return b.maxPool}),a.d(A,"maxPool3d",function(){return b.maxPool3d}),a.d(A,"maxPoolWithArgmax",function(){return b.maxPoolWithArgmax}),a.d(A,"maximum",function(){return b.maximum}),a.d(A,"maximumStrict",function(){return b.maximumStrict}),a.d(A,"mean",function(){return b.mean}),a.d(A,"memory",function(){return b.memory}),a.d(A,"min",function(){return b.min}),a.d(A,"minimum",function(){return b.minimum}),a.d(A,"minimumStrict",function(){return b.minimumStrict}),a.d(A,"mod",function(){return b.mod}),a.d(A,"modStrict",function(){return b.modStrict}),a.d(A,"moments",function(){return b.moments}),a.d(A,"movingAverage",function(){return b.movingAverage}),a.d(A,"mul",function(){return b.mul}),a.d(A,"mulStrict",function(){return b.mulStrict}),a.d(A,"multiRNNCell",function(){return b.multiRNNCell}),a.d(A,"multinomial",function(){return b.multinomial}),a.d(A,"neg",function(){return b.neg}),a.d(A,"nextFrame",function(){return b.nextFrame}),a.d(A,"norm",function(){return b.norm}),a.d(A,"notEqual",function(){return b.notEqual}),a.d(A,"notEqualStrict",function(){return b.notEqualStrict}),a.d(A,"oneHot",function(){return b.oneHot}),a.d(A,"ones",function(){return b.ones}),a.d(A,"onesLike",function(){return b.onesLike}),a.d(A,"op",function(){return b.op}),a.d(A,"outerProduct",function(){return b.outerProduct}),a.d(A,"pad",function(){return b.pad}),a.d(A,"pad1d",function(){return b.pad1d}),a.d(A,"pad2d",function(){return b.pad2d}),a.d(A,"pad3d",function(){return b.pad3d}),a.d(A,"pad4d",function(){return b.pad4d}),a.d(A,"pool",function(){return b.pool}),a.d(A,"pow",function(){return b.pow}),a.d(A,"powStrict",function(){return b.powStrict}),a.d(A,"prelu",function(){return b.prelu}),a.d(A,"print",function(){return b.print}),a.d(A,"prod",function(){return b.prod}),a.d(A,"profile",function(){return b.profile}),a.d(A,"rand",function(){return b.rand}),a.d(A,"randomGamma",function(){return b.randomGamma}),a.d(A,"randomNormal",function(){return b.randomNormal}),a.d(A,"randomUniform",function(){return b.randomUniform}),a.d(A,"range",function(){return b.range}),a.d(A,"ready",function(){return b.ready}),a.d(A,"real",function(){return b.real}),a.d(A,"reciprocal",function(){return b.reciprocal}),a.d(A,"registerBackend",function(){return b.registerBackend}),a.d(A,"registerGradient",function(){return b.registerGradient}),a.d(A,"registerKernel",function(){return b.registerKernel}),a.d(A,"relu",function(){return b.relu}),a.d(A,"relu6",function(){return b.relu6}),a.d(A,"removeBackend",function(){return b.removeBackend}),a.d(A,"reshape",function(){return b.reshape}),a.d(A,"reverse",function(){return b.reverse}),a.d(A,"reverse1d",function(){return b.reverse1d}),a.d(A,"reverse2d",function(){return b.reverse2d}),a.d(A,"reverse3d",function(){return b.reverse3d}),a.d(A,"reverse4d",function(){return b.reverse4d}),a.d(A,"rfft",function(){return b.rfft}),a.d(A,"round",function(){return b.round}),a.d(A,"rsqrt",function(){return b.rsqrt}),a.d(A,"scalar",function(){return b.scalar}),a.d(A,"scatterND",function(){return b.scatterND}),a.d(A,"scatter_util",function(){return b.scatter_util}),a.d(A,"selu",function(){return b.selu}),a.d(A,"separableConv2d",function(){return b.separableConv2d}),a.d(A,"serialization",function(){return b.serialization}),a.d(A,"setBackend",function(){return b.setBackend}),a.d(A,"setPlatform",function(){return b.setPlatform}),a.d(A,"setdiff1dAsync",function(){return b.setdiff1dAsync}),a.d(A,"sigmoid",function(){return b.sigmoid}),a.d(A,"sign",function(){return b.sign}),a.d(A,"signal",function(){return b.signal}),a.d(A,"sin",function(){return b.sin}),a.d(A,"sinh",function(){return b.sinh}),a.d(A,"slice",function(){return b.slice}),a.d(A,"slice1d",function(){return b.slice1d}),a.d(A,"slice2d",function(){return b.slice2d}),a.d(A,"slice3d",function(){return b.slice3d}),a.d(A,"slice4d",function(){return b.slice4d}),a.d(A,"slice_util",function(){return b.slice_util}),a.d(A,"softmax",function(){return b.softmax}),a.d(A,"softplus",function(){return b.softplus}),a.d(A,"spaceToBatchND",function(){return b.spaceToBatchND}),a.d(A,"sparseToDense",function(){return b.sparseToDense}),a.d(A,"spectral",function(){return b.spectral}),a.d(A,"split",function(){return b.split}),a.d(A,"sqrt",function(){return b.sqrt}),a.d(A,"square",function(){return b.square}),a.d(A,"squaredDifference",function(){return b.squaredDifference}),a.d(A,"squaredDifferenceStrict",function(){return b.squaredDifferenceStrict}),a.d(A,"squeeze",function(){return b.squeeze}),a.d(A,"stack",function(){return b.stack}),a.d(A,"step",function(){return b.step}),a.d(A,"stft",function(){return b.stft}),a.d(A,"stridedSlice",function(){return b.stridedSlice}),a.d(A,"sub",function(){return b.sub}),a.d(A,"subStrict",function(){return b.subStrict}),a.d(A,"sum",function(){return b.sum}),a.d(A,"sumOutType",function(){return b.sumOutType}),a.d(A,"tan",function(){return b.tan}),a.d(A,"tanh",function(){return b.tanh}),a.d(A,"tensor",function(){return b.tensor}),a.d(A,"tensor1d",function(){return b.tensor1d}),a.d(A,"tensor2d",function(){return b.tensor2d}),a.d(A,"tensor3d",function(){return b.tensor3d}),a.d(A,"tensor4d",function(){return b.tensor4d}),a.d(A,"tensor5d",function(){return b.tensor5d}),a.d(A,"tensor6d",function(){return b.tensor6d}),a.d(A,"tensor_util",function(){return b.tensor_util}),a.d(A,"test_util",function(){return b.test_util}),a.d(A,"tidy",function(){return b.tidy}),a.d(A,"tile",function(){return b.tile}),a.d(A,"time",function(){return b.time}),a.d(A,"topk",function(){return b.topk}),a.d(A,"train",function(){return b.train}),a.d(A,"transpose",function(){return b.transpose}),a.d(A,"truncatedNormal",function(){return b.truncatedNormal}),a.d(A,"unregisterGradient",function(){return b.unregisterGradient}),a.d(A,"unregisterKernel",function(){return b.unregisterKernel}),a.d(A,"unsortedSegmentSum",function(){return b.unsortedSegmentSum}),a.d(A,"unstack",function(){return b.unstack}),a.d(A,"util",function(){return b.util}),a.d(A,"valueAndGrad",function(){return b.valueAndGrad}),a.d(A,"valueAndGrads",function(){return b.valueAndGrads}),a.d(A,"variable",function(){return b.variable}),a.d(A,"variableGrads",function(){return b.variableGrads}),a.d(A,"version_core",function(){return b.version_core}),a.d(A,"webgl",function(){return b.webgl}),a.d(A,"where",function(){return b.where}),a.d(A,"whereAsync",function(){return b.whereAsync}),a.d(A,"zeros",function(){return b.zeros}),a.d(A,"zerosLike",function(){return b.zerosLike}),a.d(A,"constraints",function(){return hn}),a.d(A,"initializers",function(){return vr}),a.d(A,"layers",function(){return Qc}),a.d(A,"metrics",function(){return Wh}),a.d(A,"models",function(){return Zc}),a.d(A,"regularizers",function(){return Gs}),a.d(A,"CallbackList",function(){return vf}),a.d(A,"CustomCallback",function(){return yf}),a.d(A,"History",function(){return Pu}),a.d(A,"Callback",function(){return Ou}),a.d(A,"callbacks",function(){return Mf}),a.d(A,"EarlyStopping",function(){return Vh}),a.d(A,"InputSpec",function(){return eo}),a.d(A,"SymbolicTensor",function(){return bo}),a.d(A,"LayersModel",function(){return kc}),a.d(A,"input",function(){return ko}),a.d(A,"loadLayersModel",function(){return Ua}),a.d(A,"model",function(){return ho}),a.d(A,"registerCallbackConstructor",function(){return xs}),a.d(A,"sequential",function(){return ca}),a.d(A,"RNN",function(){return io}),a.d(A,"Sequential",function(){return wt}),a.d(A,"LayerVariable",function(){return Rr}),a.d(A,"version_layers",function(){return"1.7.4"}),a.d(A,"GraphModel",function(){return jf.GraphModel}),a.d(A,"loadGraphModel",function(){return jf.loadGraphModel}),a.d(A,"deregisterOp",function(){return jf.deregisterOp}),a.d(A,"registerOp",function(){return jf.registerOp}),a.d(A,"version_converter",function(){return jf.version_converter}),a.d(A,"data",function(){return Pl});var Bf={"tfjs-core":b.version_core,"tfjs-data":Pl.version_data,"tfjs-layers":"1.7.4","tfjs-converter":jf.version_converter,tfjs:"1.7.4"}},function(Oe,A,a){a.r(A),function(b,$,U,B){a.d(A,"AdadeltaOptimizer",function(){return Ov}),a.d(A,"AdagradOptimizer",function(){return Av}),a.d(A,"AdamOptimizer",function(){return Sv}),a.d(A,"AdamaxOptimizer",function(){return r0}),a.d(A,"DataStorage",function(){return Bl}),a.d(A,"ENV",function(){return ee}),a.d(A,"Environment",function(){return q}),a.d(A,"KernelBackend",function(){return Rf}),a.d(A,"MomentumOptimizer",function(){return i0}),a.d(A,"Optimizer",function(){return fd}),a.d(A,"RMSPropOptimizer",function(){return W0}),a.d(A,"Rank",function(){return ge}),a.d(A,"Reduction",function(){return rs}),a.d(A,"SGDOptimizer",function(){return U0}),a.d(A,"Tensor",function(){return Mt}),a.d(A,"TensorBuffer",function(){return Wi}),a.d(A,"Variable",function(){return gt}),a.d(A,"abs",function(){return Dc}),a.d(A,"acos",function(){return Tm}),a.d(A,"acosh",function(){return Nm}),a.d(A,"add",function(){return Xh}),a.d(A,"addN",function(){return I0}),a.d(A,"addStrict",function(){return R0}),a.d(A,"all",function(){return Vm}),a.d(A,"any",function(){return dc}),a.d(A,"argMax",function(){return qm}),a.d(A,"argMin",function(){return Hg}),a.d(A,"asin",function(){return _u}),a.d(A,"asinh",function(){return Fm}),a.d(A,"atan",function(){return Hh}),a.d(A,"atan2",function(){return zp}),a.d(A,"atanh",function(){return Qd}),a.d(A,"avgPool",function(){return Wg}),a.d(A,"avgPool3d",function(){return Vg}),a.d(A,"backend",function(){return xm}),a.d(A,"backend_util",function(){return uc}),a.d(A,"basicLSTMCell",function(){return Xg}),a.d(A,"batchNorm",function(){return F0}),a.d(A,"batchNorm2d",function(){return Vl}),a.d(A,"batchNorm3d",function(){return Kh}),a.d(A,"batchNorm4d",function(){return Wf}),a.d(A,"batchNormalization",function(){return kv}),a.d(A,"batchNormalization2d",function(){return Fg}),a.d(A,"batchNormalization3d",function(){return np}),a.d(A,"batchNormalization4d",function(){return Rm}),a.d(A,"batchToSpaceND",function(){return Gc}),a.d(A,"booleanMaskAsync",function(){return Hp}),a.d(A,"broadcastTo",function(){return Sl}),a.d(A,"browser",function(){return Ku}),a.d(A,"buffer",function(){return Ni}),a.d(A,"cast",function(){return Wd}),a.d(A,"ceil",function(){return N0}),a.d(A,"clipByValue",function(){return Zd}),a.d(A,"clone",function(){return Mp}),a.d(A,"complex",function(){return ho}),a.d(A,"concat",function(){return Po}),a.d(A,"concat1d",function(){return Ih}),a.d(A,"concat2d",function(){return Pd}),a.d(A,"concat3d",function(){return Al}),a.d(A,"concat4d",function(){return Rh}),a.d(A,"conv1d",function(){return Gp}),a.d(A,"conv2d",function(){return Zh}),a.d(A,"conv2dTranspose",function(){return sl}),a.d(A,"conv3d",function(){return Kp}),a.d(A,"conv3dTranspose",function(){return M0}),a.d(A,"cos",function(){return Tc}),a.d(A,"cosh",function(){return ep}),a.d(A,"cumsum",function(){return _l}),a.d(A,"customGrad",function(){return Vs}),a.d(A,"deprecationWarn",function(){return Cf}),a.d(A,"depthToSpace",function(){return jh}),a.d(A,"depthwiseConv2d",function(){return sp}),a.d(A,"diag",function(){return hp}),a.d(A,"disableDeprecationWarnings",function(){return Np}),a.d(A,"dispose",function(){return No}),a.d(A,"disposeVariables",function(){return Ol}),a.d(A,"div",function(){return Hl}),a.d(A,"divNoNan",function(){return ol}),a.d(A,"divStrict",function(){return rp}),a.d(A,"dot",function(){return up}),a.d(A,"dropout",function(){return eh}),a.d(A,"elu",function(){return pc}),a.d(A,"enableDebugMode",function(){return Tp}),a.d(A,"enableProdMode",function(){return xu}),a.d(A,"engine",function(){return Fd}),a.d(A,"env",function(){return P}),a.d(A,"equal",function(){return fc}),a.d(A,"equalStrict",function(){return Fu}),a.d(A,"erf",function(){return Cg}),a.d(A,"exp",function(){return Og}),a.d(A,"expandDims",function(){return Lo}),a.d(A,"expm1",function(){return Im}),a.d(A,"eye",function(){return Bh}),a.d(A,"fft",function(){return em}),a.d(A,"fill",function(){return ws}),a.d(A,"findBackend",function(){return Rd}),a.d(A,"findBackendFactory",function(){return Fp}),a.d(A,"floor",function(){return bv}),a.d(A,"floorDiv",function(){return Yh}),a.d(A,"frame",function(){return pp}),a.d(A,"fused",function(){return Jm}),a.d(A,"gather",function(){return Vp}),a.d(A,"gatherND",function(){return fl}),a.d(A,"gather_util",function(){return Em}),a.d(A,"getBackend",function(){return bs}),a.d(A,"getGradient",function(){return K}),a.d(A,"getKernel",function(){return ie}),a.d(A,"getKernelsForBackend",function(){return de}),a.d(A,"grad",function(){return If}),a.d(A,"grads",function(){return jl}),a.d(A,"greater",function(){return fu}),a.d(A,"greaterEqual",function(){return Qh}),a.d(A,"greaterEqualStrict",function(){return Wp}),a.d(A,"greaterStrict",function(){return jm}),a.d(A,"hammingWindow",function(){return Gm}),a.d(A,"hannWindow",function(){return rm}),a.d(A,"ifft",function(){return tm}),a.d(A,"imag",function(){return Ua}),a.d(A,"image",function(){return Ym}),a.d(A,"inTopKAsync",function(){return Qg}),a.d(A,"io",function(){return ud}),a.d(A,"irfft",function(){return Ic}),a.d(A,"isFinite",function(){return $h}),a.d(A,"isInf",function(){return Tg}),a.d(A,"isNaN",function(){return Dg}),a.d(A,"keep",function(){return Dh}),a.d(A,"leakyRelu",function(){return nd}),a.d(A,"less",function(){return Bm}),a.d(A,"lessEqual",function(){return ip}),a.d(A,"lessEqualStrict",function(){return Ro}),a.d(A,"lessStrict",function(){return op}),a.d(A,"linalg",function(){return am}),a.d(A,"linspace",function(){return Fh}),a.d(A,"localResponseNormalization",function(){return Kg}),a.d(A,"log",function(){return xv}),a.d(A,"log1p",function(){return uo}),a.d(A,"logSigmoid",function(){return Ag}),a.d(A,"logSoftmax",function(){return io}),a.d(A,"logSumExp",function(){return Yl}),a.d(A,"logicalAnd",function(){return Vf}),a.d(A,"logicalNot",function(){return Ig}),a.d(A,"logicalOr",function(){return Mm}),a.d(A,"logicalXor",function(){return qf}),a.d(A,"losses",function(){return im}),a.d(A,"matMul",function(){return jg}),a.d(A,"math",function(){return jc}),a.d(A,"max",function(){return B0}),a.d(A,"maxPool",function(){return Ug}),a.d(A,"maxPool3d",function(){return j0}),a.d(A,"maximum",function(){return Hf}),a.d(A,"maximumStrict",function(){return $l}),a.d(A,"mean",function(){return ed}),a.d(A,"memory",function(){return Sh}),a.d(A,"min",function(){return td}),a.d(A,"minimum",function(){return Gl}),a.d(A,"minimumStrict",function(){return Nu}),a.d(A,"mod",function(){return Jh}),a.d(A,"modStrict",function(){return $f}),a.d(A,"moments",function(){return Jl}),a.d(A,"movingAverage",function(){return Ql}),a.d(A,"mul",function(){return al}),a.d(A,"mulStrict",function(){return Nc}),a.d(A,"multiRNNCell",function(){return Zp}),a.d(A,"multinomial",function(){return Dl}),a.d(A,"neg",function(){return Sg}),a.d(A,"nextFrame",function(){return of}),a.d(A,"norm",function(){return rd}),a.d(A,"notEqual",function(){return hc}),a.d(A,"notEqualStrict",function(){return Xf}),a.d(A,"oneHot",function(){return Ph}),a.d(A,"ones",function(){return lu}),a.d(A,"onesLike",function(){return us}),a.d(A,"op",function(){return wt}),a.d(A,"outerProduct",function(){return Bg}),a.d(A,"pad",function(){return Tl}),a.d(A,"pad1d",function(){return Kc}),a.d(A,"pad2d",function(){return Ec}),a.d(A,"pad3d",function(){return Lh}),a.d(A,"pad4d",function(){return _f}),a.d(A,"pool",function(){return Jf}),a.d(A,"pow",function(){return Gf}),a.d(A,"powStrict",function(){return Up}),a.d(A,"prelu",function(){return lp}),a.d(A,"print",function(){return Sf}),a.d(A,"prod",function(){return Zf}),a.d(A,"profile",function(){return _h}),a.d(A,"rand",function(){return Nl}),a.d(A,"randomGamma",function(){return km}),a.d(A,"randomNormal",function(){return Cc}),a.d(A,"randomUniform",function(){return Fl}),a.d(A,"range",function(){return oc}),a.d(A,"ready",function(){return Id}),a.d(A,"real",function(){return ca}),a.d(A,"reciprocal",function(){return Bp}),a.d(A,"registerBackend",function(){return Ip}),a.d(A,"registerGradient",function(){return Ae}),a.d(A,"registerKernel",function(){return pe}),a.d(A,"relu",function(){return Qp}),a.d(A,"relu6",function(){return Hm}),a.d(A,"removeBackend",function(){return ic}),a.d(A,"reshape",function(){return ra}),a.d(A,"reverse",function(){return Xl}),a.d(A,"reverse1d",function(){return Pg}),a.d(A,"reverse2d",function(){return cp}),a.d(A,"reverse3d",function(){return Yp}),a.d(A,"reverse4d",function(){return Lg}),a.d(A,"rfft",function(){return $m}),a.d(A,"round",function(){return _g}),a.d(A,"rsqrt",function(){return tp}),a.d(A,"scalar",function(){return fr}),a.d(A,"scatterND",function(){return Yg}),a.d(A,"scatter_util",function(){return Hd}),a.d(A,"selu",function(){return Gg}),a.d(A,"separableConv2d",function(){return Mg}),a.d(A,"serialization",function(){return pl}),a.d(A,"setBackend",function(){return Of}),a.d(A,"setPlatform",function(){return wm}),a.d(A,"setdiff1dAsync",function(){return Ac}),a.d(A,"sigmoid",function(){return nl}),a.d(A,"sign",function(){return rl}),a.d(A,"signal",function(){return Km}),a.d(A,"sin",function(){return Uf}),a.d(A,"sinh",function(){return Gh}),a.d(A,"slice",function(){return ul}),a.d(A,"slice1d",function(){return Wm}),a.d(A,"slice2d",function(){return qg}),a.d(A,"slice3d",function(){return Qf}),a.d(A,"slice4d",function(){return cl}),a.d(A,"slice_util",function(){return $d}),a.d(A,"softmax",function(){return Os}),a.d(A,"softplus",function(){return wv}),a.d(A,"spaceToBatchND",function(){return Sa}),a.d(A,"sparseToDense",function(){return Jg}),a.d(A,"spectral",function(){return nm}),a.d(A,"split",function(){return Ri}),a.d(A,"sqrt",function(){return Pp}),a.d(A,"square",function(){return Dm}),a.d(A,"squaredDifference",function(){return zf}),a.d(A,"squaredDifferenceStrict",function(){return Kf}),a.d(A,"squeeze",function(){return Ia}),a.d(A,"stack",function(){return Mi}),a.d(A,"step",function(){return il}),a.d(A,"stft",function(){return mp}),a.d(A,"stridedSlice",function(){return fp}),a.d(A,"sub",function(){return Fc}),a.d(A,"subStrict",function(){return ts}),a.d(A,"sum",function(){return $g}),a.d(A,"sumOutType",function(){return Jn}),a.d(A,"tan",function(){return Du}),a.d(A,"tanh",function(){return zl}),a.d(A,"tensor",function(){return ko}),a.d(A,"tensor1d",function(){return Us}),a.d(A,"tensor2d",function(){return nu}),a.d(A,"tensor3d",function(){return Hc}),a.d(A,"tensor4d",function(){return Ws}),a.d(A,"tensor5d",function(){return Nh}),a.d(A,"tensor6d",function(){return jd}),a.d(A,"tensor_util",function(){return Ot}),a.d(A,"test_util",function(){return ou}),a.d(A,"tidy",function(){return Ii}),a.d(A,"tile",function(){return Es}),a.d(A,"time",function(){return bm}),a.d(A,"topk",function(){return ll}),a.d(A,"train",function(){return _v}),a.d(A,"transpose",function(){return ns}),a.d(A,"truncatedNormal",function(){return Oc}),a.d(A,"unregisterGradient",function(){return je}),a.d(A,"unregisterKernel",function(){return Te}),a.d(A,"unsortedSegmentSum",function(){return qp}),a.d(A,"unstack",function(){return Ra}),a.d(A,"util",function(){return Qr}),a.d(A,"valueAndGrad",function(){return Gd}),a.d(A,"valueAndGrads",function(){return Kd}),a.d(A,"variable",function(){return Bd}),a.d(A,"variableGrads",function(){return tn}),a.d(A,"version_core",function(){return Cv}),a.d(A,"webgl",function(){return gl}),a.d(A,"where",function(){return ro}),a.d(A,"whereAsync",function(){return ql}),a.d(A,"zeros",function(){return Ki}),a.d(A,"zerosLike",function(){return ii});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var re=function(v,h){return(re=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(u,d){u.__proto__=d}||function(u,d){for(var y in d)d.hasOwnProperty(y)&&(u[y]=d[y])})(v,h)};function J(v,h){function u(){this.constructor=v}re(v,h),v.prototype=h===null?Object.create(h):(u.prototype=h.prototype,new u)}function R(v,h,u,d){return new(u||(u=Promise))(function(y,D){function z(he){try{oe(d.next(he))}catch(xe){D(xe)}}function X(he){try{oe(d.throw(he))}catch(xe){D(xe)}}function oe(he){he.done?y(he.value):new u(function(xe){xe(he.value)}).then(z,X)}oe((d=d.apply(v,h||[])).next())})}function W(v,h){var u,d,y,D,z={label:0,sent:function(){if(1&y[0])throw y[1];return y[1]},trys:[],ops:[]};return D={next:X(0),throw:X(1),return:X(2)},typeof Symbol=="function"&&(D[Symbol.iterator]=function(){return this}),D;function X(oe){return function(he){return function(xe){if(u)throw new TypeError("Generator is already executing.");for(;z;)try{if(u=1,d&&(y=2&xe[0]?d.return:xe[0]?d.throw||((y=d.return)&&y.call(d),0):d.next)&&!(y=y.call(d,xe[1])).done)return y;switch(d=0,y&&(xe=[2&xe[0],y.value]),xe[0]){case 0:case 1:y=xe;break;case 4:return z.label++,{value:xe[1],done:!1};case 5:z.label++,d=xe[1],xe=[0];continue;case 7:xe=z.ops.pop(),z.trys.pop();continue;default:if(!(y=(y=z.trys).length>0&&y[y.length-1])&&(xe[0]===6||xe[0]===2)){z=0;continue}if(xe[0]===3&&(!y||xe[1]>y[0]&&xe[1]<y[3])){z.label=xe[1];break}if(xe[0]===6&&z.label<y[1]){z.label=y[1],y=xe;break}if(y&&z.label<y[2]){z.label=y[2],z.ops.push(xe);break}y[2]&&z.ops.pop(),z.trys.pop();continue}xe=h.call(v,z)}catch(Fe){xe=[6,Fe],d=0}finally{u=y=0}if(5&xe[0])throw xe[1];return{value:xe[0]?xe[1]:void 0,done:!0}}([oe,he])}}}var q=function(){function v(h){this.global=h,this.flags={},this.flagRegistry={},this.urlFlags={},this.populateURLFlags()}return v.prototype.setPlatform=function(h,u){this.platform!=null&&console.warn("Platform "+this.platformName+" has already been set. Overwriting the platform with "+u+"."),this.platformName=h,this.platform=u},v.prototype.registerFlag=function(h,u,d){if(this.flagRegistry[h]={evaluationFn:u,setHook:d},this.urlFlags[h]!=null){var y=this.urlFlags[h];console.warn("Setting feature override from URL "+h+": "+y+"."),this.set(h,y)}},v.prototype.get=function(h){return h in this.flags?this.flags[h]:(this.flags[h]=this.evaluateFlag(h),this.flags[h])},v.prototype.getNumber=function(h){return this.get(h)},v.prototype.getBool=function(h){return this.get(h)},v.prototype.getFlags=function(){return this.flags},Object.defineProperty(v.prototype,"features",{get:function(){return this.flags},enumerable:!0,configurable:!0}),v.prototype.set=function(h,u){if(this.flagRegistry[h]==null)throw new Error("Cannot set flag "+h+" as it has not been registered.");this.flags[h]=u,this.flagRegistry[h].setHook!=null&&this.flagRegistry[h].setHook(u)},v.prototype.evaluateFlag=function(h){if(this.flagRegistry[h]==null)throw new Error("Cannot evaluate flag '"+h+"': no evaluation function found.");return this.flagRegistry[h].evaluationFn()},v.prototype.setFlags=function(h){this.flags=Object.assign({},h)},v.prototype.reset=function(){this.flags={},this.urlFlags={},this.populateURLFlags()},v.prototype.populateURLFlags=function(){var h=this;if(this.global!==void 0&&this.global.location!==void 0&&this.global.location.search!==void 0){var u,d,y=(u=this.global.location.search,d={},u.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,function(D){for(var z=[],X=1;X<arguments.length;X++)z[X-1]=arguments[X];return function(oe,he,xe){oe[decodeURIComponent(he)]=decodeURIComponent(xe||"")}(d,z[0],z[1]),z.join("=")}),d);"tfjsflags"in y&&y.tfjsflags.split(",").forEach(function(D){var z=D.split(":"),X=z[0],oe=z[1];h.urlFlags[X]=function(he,xe){if((xe=xe.toLowerCase())==="true"||xe==="false")return xe==="true";if(""+ +xe===xe)return+xe;throw new Error("Could not parse value flag value "+xe+" for flag "+he+".")}(X,oe)})}},v}();function P(){return ee}var ee=null,I=new Map,se=new Map;function ie(v,h){var u=we(v,h);return I.get(u)}function K(v){return se.get(v)}function de(v){for(var h=I.entries(),u=[];;){var d=h.next(),y=d.done,D=d.value;if(y)break;var z=D[0],X=D[1];z.split("_")[0]===v&&u.push(X)}return u}function pe(v){var h=v.kernelName,u=v.backendName,d=we(h,u);if(I.has(d))throw new Error("The kernel '"+h+"' for backend '"+u+"' is already registered");I.set(d,v)}function Ae(v){var h=v.kernelName;se.has(h)&&console.warn("Overriding the gradient for '"+h+"'"),se.set(h,v)}function Te(v,h){var u=we(v,h);if(!I.has(u))throw new Error("The kernel '"+v+"' for backend '"+h+"' is not registered");I.delete(u)}function je(v){if(!se.has(v))throw new Error("The gradient '"+v+"' for backend is not registered");se.delete(v)}function we(v,h){return h+"_"+v}function ot(v){for(var h=v.length,u=0,d=0;h>0;)d=Math.random()*h|0,u=v[--h],v[h]=v[d],v[d]=u}function _t(v,h,u){return Math.max(v,Math.min(h,u))}function Ut(v){return v%2==0?v:v+1}function Xt(v){for(var h=0,u=0;u<v.length;u++)h+=v[u];return h}function ke(v,h){if(!v)throw new Error(typeof h=="string"?h:h())}function Ft(v,h,u){u===void 0&&(u=""),ke(ln(v,h),function(){return u+" Shapes "+v+" and "+h+" must match"})}function Gt(v){ke(v!=null,function(){return"The input to the tensor constructor must be a non-null value."})}function jt(v,h,u){if(h===void 0&&(h=[]),u===void 0&&(u=!1),h==null&&(h=[]),Array.isArray(v)||pt(v)&&!u)for(var d=0;d<v.length;++d)jt(v[d],h,u);else h.push(v);return h}function Ye(v){if(v.length===0)return 1;for(var h=v[0],u=1;u<v.length;u++)h*=v[u];return h}function ln(v,h){if(v===h)return!0;if(v==null||h==null||v.length!==h.length)return!1;for(var u=0;u<v.length;u++)if(v[u]!==h[u])return!1;return!0}function nn(v){return v%1==0}function Bt(v){if(Math.tanh!=null)return Math.tanh(v);if(v===1/0)return 1;if(v===-1/0)return-1;var h=Math.exp(2*v);return(h-1)/(h+1)}function Pt(v){var h=Math.ceil(Math.sqrt(v));return[h,Math.ceil(v/h)]}function gn(v,h){return h<=v.length?v:v+" ".repeat(h-v.length)}function Dt(v,h,u){return h===void 0&&(h=function(d){return 0}),new Promise(function(d,y){var D=0,z=function(){if(v())d();else{var X=h(++D);u!=null&&D>=u?y():setTimeout(z,X)}};z()})}function St(v,h){for(var u=1,d=-1,y=0;y<v.length;++y)if(v[y]>=0)u*=v[y];else if(v[y]===-1){if(d!==-1)throw Error("Shapes can only have 1 implicit size. Found -1 at dim "+d+" and dim "+y);d=y}else if(v[y]<0)throw Error("Shapes can not be < 0. Found "+v[y]+" at dim "+y);if(d===-1){if(h>0&&h!==u)throw Error("Size("+h+") must match the product of shape "+v);return v}if(u===0)throw Error("Cannot infer the missing size in ["+v+"] when there are 0 elements");if(h%u!=0)throw Error("The implicit shape can't be a fractional number. Got "+h+" / "+u);var D=v.slice();return D[d]=h/u,D}function wn(v,h){var u=h.length;return ke((v=v==null?h.map(function(d,y){return y}):[].concat(v)).every(function(d){return d>=-u&&d<u}),function(){return"All values in axis param must be in range [-"+u+", "+u+") but got axis "+v}),ke(v.every(function(d){return nn(d)}),function(){return"All values in axis param must be integers but got axis "+v}),v.map(function(d){return d<0?u+d:d})}function Bn(v,h){for(var u=[],d=[],y=h!=null&&Array.isArray(h)&&h.length===0,D=h==null||y?null:wn(h,v).sort(),z=0,X=0;X<v.length;++X){if(D!=null){if(D[z]===X&&v[X]!==1)throw new Error("Can't squeeze axis "+X+" since its dim '"+v[X]+"' is not 1");(D[z]==null||D[z]>X)&&v[X]===1&&(u.push(v[X]),d.push(X)),D[z]<=X&&z++}v[X]!==1&&(u.push(v[X]),d.push(X))}return{newShape:u,keptDims:d}}function Hn(v,h){var u=null;if(v==null||v==="float32")u=new Float32Array(h);else if(v==="int32")u=new Int32Array(h);else{if(v!=="bool")throw new Error("Unknown data type "+v);u=new Uint8Array(h)}return u}function hn(v,h){var u=null;if(v==null||v==="float32")u=new Float32Array(h);else if(v==="int32")u=new Int32Array(h);else if(v==="bool")u=new Uint8Array(h);else{if(v!=="string")throw new Error("Unknown data type "+v);u=new Array(h)}return u}function Ve(v,h){for(var u=0;u<v.length;u++){var d=v[u];if(isNaN(d)||!isFinite(d))throw Error("A tensor of type "+h+" being uploaded contains "+d+".")}}function Qe(v){return v==="bool"||v==="complex64"||v==="float32"||v==="int32"||v==="string"}function He(v,h){return!(h==="complex64"||h==="float32"&&v!=="complex64"||h==="int32"&&v!=="float32"&&v!=="complex64"||h==="bool"&&v==="bool")}function pt(v){return v instanceof Float32Array||v instanceof Int32Array||v instanceof Uint8Array}function Lt(v){if(v==="float32"||v==="int32")return 4;if(v==="complex64")return 8;if(v==="bool")return 1;throw new Error("Unknown dtype "+v)}function zt(v){if(v==null)return 0;var h=0;return v.forEach(function(u){return h+=u.length}),h}function Tn(v){return typeof v=="string"||v instanceof String}function xn(v){return typeof v=="boolean"}function Kn(v){return typeof v=="number"}function be(v){return Array.isArray(v)?be(v[0]):v instanceof Float32Array?"float32":v instanceof Int32Array||v instanceof Uint8Array?"int32":Kn(v)?"float32":Tn(v)?"string":xn(v)?"bool":"float32"}function Yn(v){return!!(v&&v.constructor&&v.call&&v.apply)}function Dr(v,h){for(var u=h;u<v;++u)if(v%u==0)return u;return v}function pr(v){var h=v.length;if(h<2)return[];var u=new Array(h-1);u[h-2]=v[h-1];for(var d=h-3;d>=0;--d)u[d]=u[d+1]*v[d+1];return u}function Nr(v,h,u){if(h==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(v)&&(v=jt(v)),u&&Ve(v,h),function(D,z){return D instanceof Float32Array&&z==="float32"||D instanceof Int32Array&&z==="int32"||D instanceof Uint8Array&&z==="bool"}(v,h))return v;if(h==null||h==="float32"||h==="complex64")return new Float32Array(v);if(h==="int32")return new Int32Array(v);if(h==="bool"){for(var d=new Uint8Array(v.length),y=0;y<d.length;++y)Math.round(v[y])!==0&&(d[y]=1);return d}throw new Error("Unknown data type "+h)}function Fr(v,h){if(v.length===0)return h[0];var u=v.reduce(function(d,y){return d*y});if(u===0)return[];if(u!==h.length)throw new Error("["+v+"] does not match the input size.");return function d(y,D,z){var X=new Array;if(D.length===1)for(var oe=D[0],he=0;he<oe;he++)X[he]=z[y+he];else{oe=D[0];var xe=D.slice(1),Fe=xe.reduce(function(Re,Me){return Re*Me});for(he=0;he<oe;he++)X[he]=d(y+he*Fe,xe,z)}return X}(0,v,h)}function an(v,h){for(var u=Kt(v,h),d=0;d<u.length;d++)u[d]=1;return u}function Kt(v,h){if(h==null||h==="float32"||h==="complex64")return new Float32Array(v);if(h==="int32")return new Int32Array(v);if(h==="bool")return new Uint8Array(v);throw new Error("Unknown data type "+h)}function Zt(){return P().platform.now()}function $n(v){v.forEach(function(h){ke(Number.isInteger(h)&&h>=0,function(){return"Tensor must have a shape comprised of positive integers but got shape ["+v+"]."})})}function Dn(v,h){return h===void 0&&(h="utf-8"),h=h||"utf-8",P().platform.encode(v,h)}function hr(v,h){return h===void 0&&(h="utf-8"),h=h||"utf-8",P().platform.decode(v,h)}function wr(v,h,u){if(h===0)return 0;if(h===1)return v[0];for(var d=v[v.length-1],y=0;y<v.length-1;++y)d+=u[y]*v[y];return d}function gr(v,h,u){if(h===0)return[];if(h===1)return[v];for(var d=new Array(h),y=0;y<d.length-1;++y)d[y]=Math.floor(v/u[y]),v-=d[y]*u[y];return d[d.length-1]=v,d}var Qr=Object.freeze({shuffle:ot,clamp:_t,nearestLargerEven:Ut,sum:Xt,randUniform:function(v,h){var u=Math.random();return h*u+(1-u)*v},distSquared:function(v,h){for(var u=0,d=0;d<v.length;d++){var y=Number(v[d])-Number(h[d]);u+=y*y}return u},assert:ke,assertShapesMatch:Ft,assertNonNull:Gt,flatten:jt,sizeFromShape:Ye,isScalarShape:function(v){return v.length===0},arraysEqual:ln,isInt:nn,tanh:Bt,sizeToSquarishShape:Pt,createShuffledIndices:function(v){for(var h=new Uint32Array(v),u=0;u<v;++u)h[u]=u;return ot(h),h},rightPad:gn,repeatedTry:Dt,inferFromImplicitShape:St,parseAxisParam:wn,squeezeShape:Bn,getTypedArrayFromDType:Hn,getArrayFromDType:hn,checkConversionForErrors:Ve,isValidDtype:Qe,hasEncodingLoss:He,isTypedArray:pt,bytesPerElement:Lt,bytesFromStringArray:zt,isString:Tn,isBoolean:xn,isNumber:Kn,inferDtype:be,isFunction:Yn,nearestDivisor:Dr,computeStrides:pr,toTypedArray:Nr,toNestedArray:Fr,makeOnesTypedArray:an,makeZerosTypedArray:Kt,now:Zt,assertNonNegativeIntegerDimensions:$n,fetch:function(v,h){return P().platform.fetch(v,h)},encodeString:Dn,decodeString:hr,locToIndex:wr,indexToLoc:gr}),ti=function(){function v(h,u){this.backendTimer=h,this.logger=u,u==null&&(this.logger=new Mr)}return v.prototype.profileKernel=function(h,u,d){var y,D=this,z=this.backendTimer.time(function(){y=d()});return y.forEach(function(X){X.data().then(function(oe){(function(he,xe,Fe){if(xe!=="float32")return!1;for(var Re=0;Re<he.length;Re++){var Me=he[Re];if(isNaN(Me)||!isFinite(Me))return console.warn("Found "+Me+" in the result of '"+Fe+"'"),!0}})(oe,X.dtype,h),z.then(function(he){var xe="";he.getExtraProfileInfo!=null&&(xe=he.getExtraProfileInfo()),D.logger.logKernelProfile(h,X,oe,he.kernelMs,u,xe)})})}),y},v}(),Mr=function(){function v(){}return v.prototype.logKernelProfile=function(h,u,d,y,D,z){var X=typeof y=="number"?gn(y+"ms",9):y.error,oe=gn(h,25),he=u.rank,xe=u.size,Fe=gn(u.shape.toString(),14),Re="";for(var Me in D){var We=D[Me].shape||u.shape,Ze=We.length;Re+=Me+": "+Ze+"D "+(Ze>0?We:"")+" "}console.log("%c"+oe+"	%c"+X+"	%c"+he+"D "+Fe+"	%c"+xe+"	%c"+Re+"	%c"+z,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")},v}(),di=20,Yr=3,Xr=7;function fi(v,h,u){return gn(Array.isArray(v)?parseFloat(v[0].toFixed(Xr))+" + "+parseFloat(v[1].toFixed(Xr))+"j":Tn(v)?"'"+v+"'":u==="bool"?oi(v):parseFloat(v.toFixed(Xr)).toString(),h)}function oi(v){return v===0?"false":"true"}function Ao(v){for(var h=[],u=0;u<v.length;u+=2)h.push([v[u],v[u+1]]);return h}var Wi=function(){function v(h,u,d){var y=this;if(this.dtype=u,this.shape=h.slice(),this.size=Ye(h),d!=null){var D=d.length;ke(D===this.size,function(){return"Length of values '"+D+"' does not match the size inferred by the shape '"+y.size+"'."})}if(u==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=d||hn(u,this.size),this.strides=pr(h)}return v.prototype.set=function(h){for(var u=this,d=[],y=1;y<arguments.length;y++)d[y-1]=arguments[y];d.length===0&&(d=[0]),ke(d.length===this.rank,function(){return"The number of provided coordinates ("+d.length+") must match the rank ("+u.rank+")"});var D=this.locToIndex(d);this.values[D]=h},v.prototype.get=function(){for(var h=[],u=0;u<arguments.length;u++)h[u]=arguments[u];h.length===0&&(h=[0]);for(var d=0,y=0,D=h;y<D.length;y++){var z=D[y];if(z<0||z>=this.shape[d]){var X="Requested out of range element at "+h+".   Buffer shape="+this.shape;throw new Error(X)}d++}for(var oe=h[h.length-1],he=0;he<h.length-1;++he)oe+=this.strides[he]*h[he];return this.values[oe]},v.prototype.locToIndex=function(h){if(this.rank===0)return 0;if(this.rank===1)return h[0];for(var u=h[h.length-1],d=0;d<h.length-1;++d)u+=this.strides[d]*h[d];return u},v.prototype.indexToLoc=function(h){if(this.rank===0)return[];if(this.rank===1)return[h];for(var u=new Array(this.shape.length),d=0;d<u.length-1;++d)u[d]=Math.floor(h/this.strides[d]),h-=u[d]*this.strides[d];return u[u.length-1]=h,u},Object.defineProperty(v.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),v.prototype.toTensor=function(){return Ei().makeTensor(this.values,this.shape,this.dtype)},v}(),Ei=null,bt=null,Lr=null,Mt=function(){function v(h,u,d,y){this.kept=!1,this.isDisposedInternal=!1,this.shape=h.slice(),this.dtype=u||"float32",this.size=Ye(h),this.strides=pr(h),this.dataId=d,this.id=y,this.rankType=this.rank<5?this.rank.toString():"higher"}return v.prototype.flatten=function(){return this.throwIfDisposed(),this.as1D()},v.prototype.asScalar=function(){return this.throwIfDisposed(),ke(this.size===1,function(){return"The array must have only 1 element."}),this.reshape([])},v.prototype.as1D=function(){return this.throwIfDisposed(),this.reshape([this.size])},v.prototype.as2D=function(h,u){return this.throwIfDisposed(),this.reshape([h,u])},v.prototype.as3D=function(h,u,d){return this.throwIfDisposed(),this.reshape([h,u,d])},v.prototype.as4D=function(h,u,d,y){return this.throwIfDisposed(),this.reshape([h,u,d,y])},v.prototype.as5D=function(h,u,d,y,D){return this.throwIfDisposed(),this.reshape([h,u,d,y,D])},v.prototype.asType=function(h){return this.throwIfDisposed(),bt.cast(this,h)},Object.defineProperty(v.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),v.prototype.buffer=function(){return R(this,void 0,void 0,function(){var h;return W(this,function(u){switch(u.label){case 0:return[4,this.data()];case 1:return h=u.sent(),[2,bt.buffer(this.shape,this.dtype,h)]}})})},v.prototype.bufferSync=function(){return bt.buffer(this.shape,this.dtype,this.dataSync())},v.prototype.array=function(){return R(this,void 0,void 0,function(){var h;return W(this,function(u){switch(u.label){case 0:return[4,this.data()];case 1:return h=u.sent(),[2,Fr(this.shape,h)]}})})},v.prototype.arraySync=function(){return Fr(this.shape,this.dataSync())},v.prototype.data=function(){return R(this,void 0,void 0,function(){var h,u;return W(this,function(d){switch(d.label){case 0:return this.throwIfDisposed(),h=Ei().read(this.dataId),this.dtype!=="string"?[3,2]:[4,h];case 1:u=d.sent();try{return[2,u.map(function(y){return hr(y)})]}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}d.label=2;case 2:return[2,h]}})})},v.prototype.dataSync=function(){this.throwIfDisposed();var h=Ei().readSync(this.dataId);if(this.dtype==="string")try{return h.map(function(u){return hr(u)})}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return h},v.prototype.bytes=function(){return R(this,void 0,void 0,function(){var h;return W(this,function(u){switch(u.label){case 0:return this.throwIfDisposed(),[4,Ei().read(this.dataId)];case 1:return h=u.sent(),this.dtype==="string"?[2,h]:[2,new Uint8Array(h.buffer)]}})})},v.prototype.dispose=function(){this.isDisposed||(Ei().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(v.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!0,configurable:!0}),v.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},v.prototype.toFloat=function(){return this.asType("float32")},v.prototype.toInt=function(){return this.asType("int32")},v.prototype.toBool=function(){return this.asType("bool")},v.prototype.print=function(h){return h===void 0&&(h=!1),bt.print(this,h)},v.prototype.reshape=function(h){return this.throwIfDisposed(),bt.reshape(this,h)},v.prototype.reshapeAs=function(h){return this.throwIfDisposed(),this.reshape(h.shape)},v.prototype.expandDims=function(h){return h===void 0&&(h=0),bt.expandDims(this,h)},v.prototype.cumsum=function(h,u,d){return h===void 0&&(h=0),u===void 0&&(u=!1),d===void 0&&(d=!1),bt.cumsum(this,h,u,d)},v.prototype.squeeze=function(h){return this.throwIfDisposed(),bt.squeeze(this,h)},v.prototype.clone=function(){return this.throwIfDisposed(),bt.clone(this)},v.prototype.oneHot=function(h,u,d){return this.throwIfDisposed(),bt.oneHot(this,h,u,d)},v.prototype.toString=function(h){return h===void 0&&(h=!1),function(u,d,y,D){var z=pr(d),X=function(Fe,Re,Me,We){var Ze=Ye(Re),Je=We[We.length-1],at=new Array(Je).fill(0),yt=Re.length,xt=Me==="complex64"?Ao(Fe):Fe;if(yt>1)for(var kt=0;kt<Ze/Je;kt++)for(var It=kt*Je,Jt=0;Jt<Je;Jt++)at[Jt]=Math.max(at[Jt],fi(xt[It+Jt],0,Me).length);return at}(u,d,y,z),oe=d.length,he=function Fe(Re,Me,We,Ze,Je,at){at===void 0&&(at=!0);var yt=We==="complex64"?2:1,xt=Me[0],kt=Me.length;if(kt===0)return We==="complex64"?[fi(Ao(Re)[0],0,We)]:We==="bool"?[oi(Re[0])]:[Re[0].toString()];if(kt===1){if(xt>di){var It=Yr*yt,Jt=Array.from(Re.slice(0,It)),on=Array.from(Re.slice((xt-Yr)*yt,xt*yt));return We==="complex64"&&(Jt=Ao(Jt),on=Ao(on)),["["+Jt.map(function(j,V){return fi(j,Je[V],We)}).join(", ")+", ..., "+on.map(function(j,V){return fi(j,Je[xt-Yr+V],We)}).join(", ")+"]"]}return["["+(We==="complex64"?Ao(Re):Array.from(Re)).map(function(j,V){return fi(j,Je[V],We)}).join(", ")+"]"]}var Qt=Me.slice(1),cn=Ze.slice(1),vn=Ze[0]*yt,p=[];if(xt>di){for(var c=0;c<Yr;c++){var o=(l=c*vn)+vn;p.push.apply(p,Fe(Re.slice(l,o),Qt,We,cn,Je,!1))}for(p.push("..."),c=xt-Yr;c<xt;c++)o=(l=c*vn)+vn,p.push.apply(p,Fe(Re.slice(l,o),Qt,We,cn,Je,c===xt-1))}else for(c=0;c<xt;c++){var l;o=(l=c*vn)+vn,p.push.apply(p,Fe(Re.slice(l,o),Qt,We,cn,Je,c===xt-1))}var g=kt===2?",":"";for(p[0]="["+p[0]+g,c=1;c<p.length-1;c++)p[c]=" "+p[c]+g;var S=`,
`;for(c=2;c<kt;c++)S+=`
`;return p[p.length-1]=" "+p[p.length-1]+"]"+(at?"":S),p}(u,d,y,z,X),xe=["Tensor"];return D&&(xe.push("  dtype: "+y),xe.push("  rank: "+oe),xe.push("  shape: ["+d+"]"),xe.push("  values:")),xe.push(he.map(function(Fe){return"    "+Fe}).join(`
`)),xe.join(`
`)}(this.dataSync(),this.shape,this.dtype,h)},v.prototype.tile=function(h){return this.throwIfDisposed(),bt.tile(this,h)},v.prototype.gather=function(h,u){return u===void 0&&(u=0),this.throwIfDisposed(),bt.gather(this,h,u)},v.prototype.matMul=function(h,u,d){return u===void 0&&(u=!1),d===void 0&&(d=!1),this.throwIfDisposed(),bt.matMul(this,h,u,d)},v.prototype.dot=function(h){return this.throwIfDisposed(),bt.dot(this,h)},v.prototype.norm=function(h,u,d){return h===void 0&&(h="euclidean"),u===void 0&&(u=null),d===void 0&&(d=!1),this.throwIfDisposed(),bt.norm(this,h,u,d)},v.prototype.slice=function(h,u){return this.throwIfDisposed(),bt.slice(this,h,u)},v.prototype.reverse=function(h){return this.throwIfDisposed(),bt.reverse(this,h)},v.prototype.concat=function(h,u){return u===void 0&&(u=0),this.throwIfDisposed(),h instanceof v&&(h=[h]),bt.concat([this].concat(h),u)},v.prototype.split=function(h,u){return u===void 0&&(u=0),this.throwIfDisposed(),bt.split(this,h,u)},v.prototype.stack=function(h,u){return u===void 0&&(u=0),bt.stack([this,h],u)},v.prototype.unstack=function(h){return h===void 0&&(h=0),bt.unstack(this,h)},v.prototype.pad=function(h,u){return u===void 0&&(u=0),bt.pad(this,h,u)},v.prototype.batchNormalization=function(h,u,d,y,D){return d===void 0&&(d=.001),Lr("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon"),this.batchNorm(h,u,D,y,d)},v.prototype.batchNorm=function(h,u,d,y,D){return D===void 0&&(D=.001),this.throwIfDisposed(),bt.batchNorm(this,h,u,d,y,D)},v.prototype.all=function(h,u){return h===void 0&&(h=null),u===void 0&&(u=!1),this.throwIfDisposed(),bt.all(this,h,u)},v.prototype.any=function(h,u){return h===void 0&&(h=null),u===void 0&&(u=!1),this.throwIfDisposed(),bt.any(this,h,u)},v.prototype.logSumExp=function(h,u){return h===void 0&&(h=null),u===void 0&&(u=!1),this.throwIfDisposed(),bt.logSumExp(this,h,u)},v.prototype.sum=function(h,u){return h===void 0&&(h=null),u===void 0&&(u=!1),this.throwIfDisposed(),bt.sum(this,h,u)},v.prototype.prod=function(h,u){return h===void 0&&(h=null),u===void 0&&(u=!1),this.throwIfDisposed(),bt.prod(this,h,u)},v.prototype.mean=function(h,u){return h===void 0&&(h=null),u===void 0&&(u=!1),this.throwIfDisposed(),bt.mean(this,h,u)},v.prototype.min=function(h,u){return h===void 0&&(h=null),u===void 0&&(u=!1),this.throwIfDisposed(),bt.min(this,h,u)},v.prototype.max=function(h,u){return h===void 0&&(h=null),u===void 0&&(u=!1),this.throwIfDisposed(),bt.max(this,h,u)},v.prototype.argMin=function(h){return h===void 0&&(h=null),this.throwIfDisposed(),bt.argMin(this,h)},v.prototype.argMax=function(h){return h===void 0&&(h=null),this.throwIfDisposed(),bt.argMax(this,h)},v.prototype.cast=function(h){return this.throwIfDisposed(),bt.cast(this,h)},v.prototype.add=function(h){return this.throwIfDisposed(),bt.add(this,h)},v.prototype.addStrict=function(h){return this.throwIfDisposed(),bt.addStrict(this,h)},v.prototype.atan2=function(h){return this.throwIfDisposed(),bt.atan2(this,h)},v.prototype.sub=function(h){return this.throwIfDisposed(),bt.sub(this,h)},v.prototype.subStrict=function(h){return this.throwIfDisposed(),bt.subStrict(this,h)},v.prototype.pow=function(h){return this.throwIfDisposed(),bt.pow(this,h)},v.prototype.powStrict=function(h){return this.throwIfDisposed(),bt.powStrict(this,h)},v.prototype.mul=function(h){return this.throwIfDisposed(),bt.mul(this,h)},v.prototype.mulStrict=function(h){return this.throwIfDisposed(),bt.mulStrict(this,h)},v.prototype.div=function(h){return this.throwIfDisposed(),bt.div(this,h)},v.prototype.divNoNan=function(h){return this.throwIfDisposed(),bt.divNoNan(this,h)},v.prototype.floorDiv=function(h){return this.throwIfDisposed(),bt.floorDiv(this,h)},v.prototype.divStrict=function(h){return this.throwIfDisposed(),bt.divStrict(this,h)},v.prototype.minimum=function(h){return this.throwIfDisposed(),bt.minimum(this,h)},v.prototype.minimumStrict=function(h){return this.throwIfDisposed(),bt.minimumStrict(this,h)},v.prototype.maximum=function(h){return this.throwIfDisposed(),bt.maximum(this,h)},v.prototype.maximumStrict=function(h){return this.throwIfDisposed(),bt.maximumStrict(this,h)},v.prototype.mod=function(h){return this.throwIfDisposed(),bt.mod(this,h)},v.prototype.modStrict=function(h){return this.throwIfDisposed(),bt.modStrict(this,h)},v.prototype.squaredDifferenceStrict=function(h){return this.throwIfDisposed(),bt.squaredDifferenceStrict(this,h)},v.prototype.transpose=function(h){return this.throwIfDisposed(),bt.transpose(this,h)},v.prototype.notEqual=function(h){return this.throwIfDisposed(),bt.notEqual(this,h)},v.prototype.notEqualStrict=function(h){return this.throwIfDisposed(),bt.notEqualStrict(this,h)},v.prototype.less=function(h){return this.throwIfDisposed(),bt.less(this,h)},v.prototype.lessStrict=function(h){return this.throwIfDisposed(),bt.lessStrict(this,h)},v.prototype.equal=function(h){return this.throwIfDisposed(),bt.equal(this,h)},v.prototype.equalStrict=function(h){return this.throwIfDisposed(),bt.equalStrict(this,h)},v.prototype.lessEqual=function(h){return this.throwIfDisposed(),bt.lessEqual(this,h)},v.prototype.lessEqualStrict=function(h){return this.throwIfDisposed(),bt.lessEqualStrict(this,h)},v.prototype.greater=function(h){return this.throwIfDisposed(),bt.greater(this,h)},v.prototype.greaterStrict=function(h){return this.throwIfDisposed(),bt.greaterStrict(this,h)},v.prototype.greaterEqual=function(h){return this.throwIfDisposed(),bt.greaterEqual(this,h)},v.prototype.greaterEqualStrict=function(h){return this.throwIfDisposed(),bt.greaterEqualStrict(this,h)},v.prototype.logicalAnd=function(h){return this.throwIfDisposed(),bt.logicalAnd(this,h)},v.prototype.logicalOr=function(h){return this.throwIfDisposed(),bt.logicalOr(this,h)},v.prototype.logicalNot=function(){return this.throwIfDisposed(),bt.logicalNot(this)},v.prototype.logicalXor=function(h){return this.throwIfDisposed(),bt.logicalXor(this,h)},v.prototype.where=function(h,u){return this.throwIfDisposed(),bt.where(h,this,u)},v.prototype.neg=function(){return this.throwIfDisposed(),bt.neg(this)},v.prototype.ceil=function(){return this.throwIfDisposed(),bt.ceil(this)},v.prototype.floor=function(){return this.throwIfDisposed(),bt.floor(this)},v.prototype.sign=function(){return this.throwIfDisposed(),bt.sign(this)},v.prototype.isNaN=function(){return this.throwIfDisposed(),bt.isNaN(this)},v.prototype.isInf=function(){return this.throwIfDisposed(),bt.isInf(this)},v.prototype.isFinite=function(){return this.throwIfDisposed(),bt.isFinite(this)},v.prototype.exp=function(){return this.throwIfDisposed(),bt.exp(this)},v.prototype.expm1=function(){return this.throwIfDisposed(),bt.expm1(this)},v.prototype.log=function(){return this.throwIfDisposed(),bt.log(this)},v.prototype.log1p=function(){return this.throwIfDisposed(),bt.log1p(this)},v.prototype.sqrt=function(){return this.throwIfDisposed(),bt.sqrt(this)},v.prototype.rsqrt=function(){return this.throwIfDisposed(),bt.rsqrt(this)},v.prototype.square=function(){return this.throwIfDisposed(),bt.square(this)},v.prototype.reciprocal=function(){return this.throwIfDisposed(),bt.reciprocal(this)},v.prototype.abs=function(){return this.throwIfDisposed(),bt.abs(this)},v.prototype.clipByValue=function(h,u){return this.throwIfDisposed(),bt.clipByValue(this,h,u)},v.prototype.relu=function(){return this.throwIfDisposed(),bt.relu(this)},v.prototype.relu6=function(){return this.throwIfDisposed(),bt.relu6(this)},v.prototype.elu=function(){return this.throwIfDisposed(),bt.elu(this)},v.prototype.selu=function(){return this.throwIfDisposed(),bt.selu(this)},v.prototype.leakyRelu=function(h){return h===void 0&&(h=.2),this.throwIfDisposed(),bt.leakyRelu(this,h)},v.prototype.prelu=function(h){return this.throwIfDisposed(),bt.prelu(this,h)},v.prototype.sigmoid=function(){return this.throwIfDisposed(),bt.sigmoid(this)},v.prototype.logSigmoid=function(){return this.throwIfDisposed(),bt.logSigmoid(this)},v.prototype.softplus=function(){return this.throwIfDisposed(),bt.softplus(this)},v.prototype.zerosLike=function(){return this.throwIfDisposed(),bt.zerosLike(this)},v.prototype.onesLike=function(){return this.throwIfDisposed(),bt.onesLike(this)},v.prototype.sin=function(){return this.throwIfDisposed(),bt.sin(this)},v.prototype.cos=function(){return this.throwIfDisposed(),bt.cos(this)},v.prototype.tan=function(){return this.throwIfDisposed(),bt.tan(this)},v.prototype.asin=function(){return this.throwIfDisposed(),bt.asin(this)},v.prototype.acos=function(){return this.throwIfDisposed(),bt.acos(this)},v.prototype.atan=function(){return this.throwIfDisposed(),bt.atan(this)},v.prototype.sinh=function(){return this.throwIfDisposed(),bt.sinh(this)},v.prototype.cosh=function(){return this.throwIfDisposed(),bt.cosh(this)},v.prototype.tanh=function(){return this.throwIfDisposed(),bt.tanh(this)},v.prototype.asinh=function(){return this.throwIfDisposed(),bt.asinh(this)},v.prototype.acosh=function(){return this.throwIfDisposed(),bt.acosh(this)},v.prototype.atanh=function(){return this.throwIfDisposed(),bt.atanh(this)},v.prototype.erf=function(){return this.throwIfDisposed(),bt.erf(this)},v.prototype.round=function(){return this.throwIfDisposed(),bt.round(this)},v.prototype.step=function(h){return h===void 0&&(h=0),this.throwIfDisposed(),bt.step(this,h)},v.prototype.softmax=function(h){return h===void 0&&(h=-1),this.throwIfDisposed(),bt.softmax(this,h)},v.prototype.logSoftmax=function(h){return h===void 0&&(h=-1),this.throwIfDisposed(),bt.logSoftmax(this,h)},v.prototype.resizeBilinear=function(h,u){return u===void 0&&(u=!1),this.throwIfDisposed(),bt.image.resizeBilinear(this,h,u)},v.prototype.resizeNearestNeighbor=function(h,u){return u===void 0&&(u=!1),this.throwIfDisposed(),bt.image.resizeNearestNeighbor(this,h,u)},v.prototype.conv1d=function(h,u,d,y,D,z){return y===void 0&&(y="NWC"),D===void 0&&(D=1),this.throwIfDisposed(),bt.conv1d(this,h,u,d,y,D,z)},v.prototype.conv2d=function(h,u,d,y,D,z){return y===void 0&&(y="NHWC"),D===void 0&&(D=[1,1]),this.throwIfDisposed(),bt.conv2d(this,h,u,d,y,D,z)},v.prototype.conv2dTranspose=function(h,u,d,y,D){return this.throwIfDisposed(),bt.conv2dTranspose(this,h,u,d,y,D)},v.prototype.depthwiseConv2D=function(h,u,d,y,D,z){return y===void 0&&(y="NHWC"),D===void 0&&(D=[1,1]),this.throwIfDisposed(),bt.depthwiseConv2d(this,h,u,d,y,D,z)},v.prototype.separableConv2d=function(h,u,d,y,D,z){return D===void 0&&(D=[1,1]),z===void 0&&(z="NHWC"),this.throwIfDisposed(),bt.separableConv2d(this,h,u,d,y,D,z)},v.prototype.avgPool=function(h,u,d,y){return this.throwIfDisposed(),bt.avgPool(this,h,u,d,y)},v.prototype.maxPool=function(h,u,d,y){return this.throwIfDisposed(),bt.maxPool(this,h,u,d,y)},v.prototype.localResponseNormalization=function(h,u,d,y){return h===void 0&&(h=5),u===void 0&&(u=1),d===void 0&&(d=1),y===void 0&&(y=.5),bt.localResponseNormalization(this,h,u,d,y)},v.prototype.pool=function(h,u,d,y,D){return this.throwIfDisposed(),bt.pool(this,h,u,d,y,D)},v.prototype.variable=function(h,u,d){return h===void 0&&(h=!0),this.throwIfDisposed(),Ei().makeVariable(this,h,u,d)},v.prototype.unsortedSegmentSum=function(h,u){return this.throwIfDisposed(),bt.unsortedSegmentSum(this,h,u)},v.prototype.batchToSpaceND=function(h,u){return this.throwIfDisposed(),bt.batchToSpaceND(this,h,u)},v.prototype.spaceToBatchND=function(h,u){return this.throwIfDisposed(),bt.spaceToBatchND(this,h,u)},v.prototype.topk=function(h,u){return h===void 0&&(h=1),u===void 0&&(u=!0),this.throwIfDisposed(),bt.topk(this,h,u)},v.prototype.stridedSlice=function(h,u,d,y,D,z,X,oe){return y===void 0&&(y=0),D===void 0&&(D=0),z===void 0&&(z=0),X===void 0&&(X=0),oe===void 0&&(oe=0),this.throwIfDisposed(),bt.stridedSlice(this,h,u,d,y,D,z,X,oe)},v.prototype.depthToSpace=function(h,u){return this.throwIfDisposed(),bt.depthToSpace(this,h,u)},v.prototype.fft=function(){return this.throwIfDisposed(),bt.spectral.fft(this)},v.prototype.ifft=function(){return this.throwIfDisposed(),bt.spectral.ifft(this)},v.prototype.rfft=function(){return this.throwIfDisposed(),bt.spectral.rfft(this)},v.prototype.irfft=function(){return this.throwIfDisposed(),bt.spectral.irfft(this)},v}();Object.defineProperty(Mt,Symbol.hasInstance,{value:function(v){return!!v&&v.dataId!=null&&v.shape!=null&&v.dtype!=null}});var ge,le,ye,_e,et,gt=function(v){function h(u,d,y,D){var z=v.call(this,u.shape,u.dtype,u.dataId,D)||this;return z.trainable=d,z.name=y,z}return J(h,v),h.prototype.assign=function(u){if(u.dtype!==this.dtype)throw new Error("dtype of the new value ("+u.dtype+") and previous value ("+this.dtype+") must match");if(!ln(u.shape,this.shape))throw new Error("shape of the new value ("+u.shape+") and previous value ("+this.shape+") must match");Ei().disposeTensor(this),this.dataId=u.dataId,Ei().incRef(this,null)},h.prototype.dispose=function(){Ei().disposeVariable(this),this.isDisposedInternal=!0},h}(Mt);Object.defineProperty(gt,Symbol.hasInstance,{value:function(v){return v instanceof Mt&&v.assign!=null&&v.assign instanceof Function}}),function(v){v.R0="R0",v.R1="R1",v.R2="R2",v.R3="R3",v.R4="R4",v.R5="R5",v.R6="R6"}(ge||(ge={})),function(v){v.float32="float32",v.int32="int32",v.bool="int32",v.complex64="complex64"}(le||(le={})),function(v){v.float32="float32",v.int32="int32",v.bool="bool",v.complex64="complex64"}(ye||(ye={})),function(v){v.float32="float32",v.int32="float32",v.bool="float32",v.complex64="complex64"}(_e||(_e={})),function(v){v.float32="complex64",v.int32="complex64",v.bool="complex64",v.complex64="complex64"}(et||(et={}));var Rt={float32:_e,int32:le,bool:ye,complex64:et};function fn(v,h){if(v==="string"||h==="string"){if(v==="string"&&h==="string")return"string";throw new Error("Can not upcast "+v+" with "+h)}return Rt[v][h]}function Jn(v){return fn(v,"int32")}function An(v,h){if(v.dtype===h.dtype)return[v,h];var u=fn(v.dtype,h.dtype);return[v.cast(u),h.cast(u)]}function Ln(v,h){ke(v.dtype===h.dtype,function(){return"The dtypes of the first("+v.dtype+") and second("+h.dtype+") input must match"})}function qn(v){var h=[];return function u(d,y,D){if(d!=null){if(d instanceof Mt)y.push(d);else if(z=d,Array.isArray(z)||typeof z=="object"){var z,X=d;for(var oe in X){var he=X[oe];D.has(he)||(D.add(he),u(he,y,D))}}}}(v,h,new Set),h}var Nt,Ot=Object.freeze({makeTypesMatch:An,assertTypesMatch:Ln,isTensorInList:function(v,h){return h.some(function(u){return u.id===v.id})},getTensorsInContainer:qn}),pn=function(){function v(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null}}return v.prototype.dispose=function(){for(var h in this.registeredVariables)this.registeredVariables[h].dispose()},v}(),Ht=function(){function v(h){this.ENV=h,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new pn}return v.prototype.ready=function(){return R(this,void 0,void 0,function(){var h,u,d;return W(this,function(y){switch(y.label){case 0:if(this.pendingBackendInit!=null)return[2,this.pendingBackendInit.then(function(){})];if(this.backendInstance!=null)return[2];h=this.getSortedBackends(),u=0,y.label=1;case 1:return u<h.length?(d=h[u],[4,this.initializeBackend(d).success]):[3,5];case 2:return y.sent()?[4,this.setBackend(d)]:[3,4];case 3:return y.sent(),[2];case 4:return u++,[3,1];case 5:throw new Error("Could not initialize any backends, all backend initializations failed.")}})})},Object.defineProperty(v.prototype,"backend",{get:function(){if(this.pendingBackendInit!=null)throw new Error("Backend '"+this.backendName+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");if(this.backendInstance==null){var h=this.initializeBackendsAndReturnBest(),u=h.name;if(h.asyncInit)throw new Error("The highest priority backend '"+u+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(u)}return this.backendInstance},enumerable:!0,configurable:!0}),v.prototype.backendNames=function(){return Object.keys(this.registryFactory)},v.prototype.findBackend=function(h){return!(h in this.registry)&&(!(h in this.registryFactory)||this.initializeBackend(h).asyncInit)?null:this.registry[h]},v.prototype.findBackendFactory=function(h){return h in this.registryFactory?this.registryFactory[h].factory:null},v.prototype.registerBackend=function(h,u,d){return d===void 0&&(d=1),h in this.registryFactory?(console.warn(h+" backend was already registered. Reusing existing backend factory."),!1):(this.registryFactory[h]={factory:u,priority:d},!0)},v.prototype.setBackend=function(h){return R(this,void 0,void 0,function(){var u,d,y;return W(this,function(D){switch(D.label){case 0:if(this.registryFactory[h]==null)throw new Error("Backend name '"+h+"' not found in registry");return this.backendName=h,this.registry[h]!=null?[3,4]:(this.backendInstance=null,u=this.initializeBackend(h),d=u.success,u.asyncInit?[4,d]:[3,2]);case 1:return y=D.sent(),[3,3];case 2:y=d,D.label=3;case 3:if(!y)return[2,!1];D.label=4;case 4:return this.backendInstance=this.registry[h],this.setupRegisteredKernels(),this.profiler=new ti(this.backendInstance),[2,!0]}})})},v.prototype.setupRegisteredKernels=function(){var h=this;de(this.backendName).forEach(function(u){u.setupFunc!=null&&u.setupFunc(h.backendInstance)})},v.prototype.disposeRegisteredKernels=function(h){var u=this;de(h).forEach(function(d){d.disposeFunc!=null&&d.disposeFunc(u.registry[h])})},v.prototype.initializeBackend=function(h){var u=this,d=this.registryFactory[h];if(d==null)throw new Error("Cannot initialize backend "+h+", no registration found.");try{var y=d.factory();if(Promise.resolve(y)===y){var D=++this.pendingBackendInitId,z=y.then(function(X){return!(D<u.pendingBackendInitId||(u.registry[h]=X,u.pendingBackendInit=null,0))}).catch(function(X){return!(D<u.pendingBackendInitId||(u.pendingBackendInit=null,console.warn("Initialization of backend "+h+" failed"),console.warn(X.stack||X.message),1))});return this.pendingBackendInit=z,{success:z,asyncInit:!0}}return this.registry[h]=y,{success:!0,asyncInit:!1}}catch(X){return console.warn("Initialization of backend "+h+" failed"),console.warn(X.stack||X.message),{success:!1,asyncInit:!1}}},v.prototype.removeBackend=function(h){if(!(h in this.registryFactory))throw new Error(h+" backend not found in registry");this.backendName===h&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,h in this.registry&&(this.disposeRegisteredKernels(h),this.registry[h].dispose(),delete this.registry[h]),delete this.registryFactory[h],this.backendName===h&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)},v.prototype.getSortedBackends=function(){var h=this;if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort(function(u,d){return h.registryFactory[d].priority-h.registryFactory[u].priority})},v.prototype.initializeBackendsAndReturnBest=function(){for(var h=this.getSortedBackends(),u=0;u<h.length;u++){var d=h[u],y=this.initializeBackend(d),D=y.success,z=y.asyncInit;if(z||D)return{name:d,asyncInit:z}}throw new Error("Could not initialize any backends, all backend initializations failed.")},v.prototype.moveData=function(h,u){var d=this.state.tensorInfo.get(u),y=d.backend,D=this.readSync(u);y.disposeData(u),d.backend=h,h.move(u,D,d.shape,d.dtype),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++},v.prototype.tidy=function(h,u){var d,y=this,D=null;if(u==null){if(typeof h!="function")throw new Error("Please provide a function to tidy()");u=h}else{if(typeof h!="string"&&!(h instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof u!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");D=h}return this.scopedRun(function(){return y.startScope(D)},function(){return y.endScope(d)},function(){return(d=u())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),d})},v.prototype.scopedRun=function(h,u,d){h();try{var y=d();return u(),y}catch(D){throw u(),D}},v.prototype.nextTensorId=function(){return v.nextTensorId++},v.prototype.nextVariableId=function(){return v.nextVariableId++},v.prototype.clone=function(h){var u=this.makeTensorFromDataId(h.dataId,h.shape,h.dtype),d={x:h};return this.addTapeNode(this.state.activeScope.name,d,[u],function(y){return{x:function(){return y.toFloat()}}},[]),u},v.prototype.runKernel=function(h,u,d,y,D){return this.runKernelFunc(null,u,null,h,d,y,D)},v.prototype.shouldCheckForMemLeaks=function(){return this.ENV.getBool("IS_TEST")},v.prototype.checkKernelForMemLeak=function(h,u,d){var y=this.backend.numDataIds(),D=0;d.forEach(function(oe){D+=oe.dtype==="complex64"?3:1});var z=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],X=y-u-D-z;if(X>0)throw new Error("Backend '"+this.backendName+"' has an internal memory leak ("+X+" data ids) after running '"+h+"'")},v.prototype.runKernelFunc=function(h,u,d,y,D,z,X){var oe,he=this;z===void 0&&(z=[]),X===void 0&&(X=[]);var xe=[],Fe=this.isTapeOn();y==null&&(y=this.state.activeScope!=null?this.state.activeScope.name:"");var Re,Me=function(yt){Fe&&(xe=yt.map(function(xt){return he.keep(he.clone(xt))}))},We=this.state.numBytes,Ze=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);var Je,at=ie(y,this.backendName);return Re=at!=null?function(){var yt=he.backend.numDataIds();Je=at.kernelFunc({inputs:u,attrs:D,backend:he.backend});var xt=Array.isArray(Je)?Je:[Je];he.shouldCheckForMemLeaks()&&he.checkKernelForMemLeak(y,yt,xt);var kt=xt.map(function(Jt){var on=Jt.dataId,Qt=Jt.shape,cn=Jt.dtype;return he.makeTensorFromDataId(on,Qt,cn)}),It=kt.filter(function(Jt,on){return X[on]});return Me((z||[]).slice().concat(It)),kt}:function(){var yt=he.backend.numDataIds();Je=he.tidy(function(){return h(he.backend,Me)});var xt=Array.isArray(Je)?Je:[Je];return he.shouldCheckForMemLeaks()&&he.checkKernelForMemLeak(y,yt,xt),xt},this.scopedRun(function(){return he.state.kernelDepth++},function(){return he.state.kernelDepth--},function(){oe=he.ENV.getBool("DEBUG")?he.profiler.profileKernel(y,u,function(){return Re()}):Re()}),Fe&&this.addTapeNode(y,u,oe,d,xe),this.state.profiling&&this.state.activeProfile.kernels.push({name:y,bytesAdded:this.state.numBytes-We,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-Ze,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(u).map(function(yt){return u[yt].shape}),outputShapes:oe.map(function(yt){return yt.shape})}),Array.isArray(Je)?oe:oe[0]},v.prototype.makeTensor=function(h,u,d,y){if(h==null)throw new Error("Values passed to engine.makeTensor() are null");d=d||"float32",y=y||this.backend;var D=h;d==="string"&&Tn(h[0])&&(D=h.map(function(xe){return Dn(xe)}));var z=y.write(D,u,d),X=new Mt(u,d,z,this.nextTensorId());if(this.incRef(X,y),d==="string"){var oe=this.state.tensorInfo.get(z),he=zt(D);this.state.numBytes+=he-oe.bytes,oe.bytes=he}return X},v.prototype.makeTensorFromDataId=function(h,u,d,y){var D=new Mt(u,d=d||"float32",h,this.nextTensorId());return this.incRef(D,y),D},v.prototype.makeVariable=function(h,u,d,y){u===void 0&&(u=!0),d=d||this.nextVariableId().toString(),y!=null&&y!==h.dtype&&(h=h.asType(y));var D=new gt(h,u,d,this.nextTensorId());if(this.state.registeredVariables[D.name]!=null)throw new Error("Variable with name "+D.name+" was already registered");return this.state.registeredVariables[D.name]=D,this.incRef(D,this.backend),D},v.prototype.incRef=function(h,u){var d=this.state.tensorInfo.has(h.dataId)?this.state.tensorInfo.get(h.dataId).refCount:0;if(this.state.numTensors++,h.dtype==="string"&&this.state.numStringTensors++,d===0){this.state.numDataBuffers++;var y=0;h.dtype!=="complex64"&&h.dtype!=="string"&&(y=h.size*Lt(h.dtype)),this.state.tensorInfo.set(h.dataId,{backend:u||this.backend,dtype:h.dtype,shape:h.shape,bytes:y,refCount:0}),this.state.numBytes+=y}this.state.tensorInfo.get(h.dataId).refCount++,h instanceof gt||this.track(h)},v.prototype.disposeTensor=function(h){if(this.state.tensorInfo.has(h.dataId)){this.state.numTensors--,h.dtype==="string"&&this.state.numStringTensors--;var u=this.state.tensorInfo.get(h.dataId);u.refCount<=1?(h.dtype!=="complex64"&&(this.state.numBytes-=u.bytes),this.state.numDataBuffers--,u.backend.disposeData(h.dataId),this.state.tensorInfo.delete(h.dataId)):this.state.tensorInfo.get(h.dataId).refCount--}},v.prototype.disposeVariables=function(){for(var h in this.state.registeredVariables){var u=this.state.registeredVariables[h];this.disposeVariable(u)}},v.prototype.disposeVariable=function(h){this.disposeTensor(h),this.state.registeredVariables[h.name]!=null&&delete this.state.registeredVariables[h.name]},v.prototype.memory=function(){var h=this.backend.memory();return h.numTensors=this.state.numTensors,h.numDataBuffers=this.state.numDataBuffers,h.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(h.unreliable=!0,h.reasons==null&&(h.reasons=[]),h.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),h},v.prototype.profile=function(h){return R(this,void 0,void 0,function(){var u,d;return W(this,function(y){return this.state.profiling=!0,u=this.state.numBytes,d=this.state.numTensors,this.state.activeProfile.kernels=[],this.state.activeProfile.result=h(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,this.state.activeProfile.kernels.map(function(D){return D.totalBytesSnapshot})),this.state.activeProfile.newBytes=this.state.numBytes-u,this.state.activeProfile.newTensors=this.state.numTensors-d,[2,this.state.activeProfile]})})},v.prototype.isTapeOn=function(){return this.state.gradientDepth>0&&this.state.kernelDepth===0},v.prototype.addTapeNode=function(h,u,d,y,D){var z=this,X={id:this.state.nextTapeNodeId++,kernelName:h,inputs:u,outputs:d,saved:D},oe=K(h);oe!=null&&(y=oe.gradFunc),y!=null&&(X.gradient=function(he){return he=he.map(function(xe,Fe){if(xe==null){var Re=d[Fe],Me=Kt(Re.size,Re.dtype);return z.makeTensor(Me,Re.shape,Re.dtype)}return xe}),y(he.length>1?he:he[0],D)}),this.state.activeTape.push(X)},v.prototype.keep=function(h){return h.kept=!0,h},v.prototype.startTape=function(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++},v.prototype.endTape=function(){this.state.gradientDepth--},v.prototype.startScope=function(h){var u={track:[],name:"unnamed scope",id:this.state.nextScopeId++};h&&(u.name=h),this.state.scopeStack.push(u),this.state.activeScope=u},v.prototype.endScope=function(h){for(var u=this,d=qn(h),y=new Set(d.map(function(oe){return oe.id})),D=0;D<this.state.activeScope.track.length;D++){var z=this.state.activeScope.track[D];z.kept||y.has(z.id)||z.dispose()}var X=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],d.forEach(function(oe){oe.kept||oe.scopeId!==X.id||u.track(oe)})},v.prototype.gradients=function(h,u,d,y){var D=this;if(y===void 0&&(y=!1),ke(u.length>0,function(){return"gradients() received an empty list of xs."}),d!=null&&d.dtype!=="float32")throw new Error("dy must have 'float32' dtype, but has '"+d.dtype+"'");var z=this.scopedRun(function(){return D.startTape()},function(){return D.endTape()},function(){return D.tidy("forward",h)});ke(z instanceof Mt,function(){return"The result y returned by f() must be a tensor."});var X=function(oe,he,xe){for(var Fe={},Re={},Me=0;Me<he.length;Me++)Fe[he[Me].id]=!0;for(Me=0;Me<oe.length;Me++){var We=(Jt=oe[Me]).inputs;for(var Ze in We){for(var Je=We[Ze],at=!1,yt=0;yt<he.length;yt++)if(Fe[Je.id]){Jt.outputs.forEach(function(vn){return Fe[vn.id]=!0}),at=!0,Re[Jt.id]=!0;break}if(at)break}}var xt={};xt[xe.id]=!0;var kt={};for(Me=oe.length-1;Me>=0;Me--)for(We=(Jt=oe[Me]).inputs,yt=0;yt<Jt.outputs.length;yt++)if(xt[Jt.outputs[yt].id]){for(var Ze in We)xt[We[Ze].id]=!0,kt[Jt.id]=!0;break}var It=[];for(Me=0;Me<oe.length;Me++){var Jt;if(Re[(Jt=oe[Me]).id]&&kt[Jt.id]){var on={};for(var Ze in Jt.inputs){var Qt=Jt.inputs[Ze];Fe[Qt.id]&&(on[Ze]=Qt)}var cn=Object.assign({},Jt);cn.inputs=on,cn.outputs=Jt.outputs,It.push(cn)}}return It}(this.state.activeTape,u,z);if(!y&&X.length===0&&u.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",function(){var oe,he,xe={};xe[z.id]=d??(he=an(Ye(oe=z.shape),"float32"),Ue.makeTensor(he,oe,"float32")),function(Re,Me,We){for(var Ze=function(at){var yt=Me[at],xt=[];if(yt.outputs.forEach(function(on){var Qt=Re[on.id];Qt!=null?xt.push(Qt):xt.push(null)}),yt.gradient==null)throw new Error("Cannot compute gradient: gradient function not found for "+yt.kernelName+".");var kt=yt.gradient(xt),It=function(on){if(!(on in kt))throw new Error("Cannot backprop through input "+on+". Available gradients found: "+Object.keys(kt)+".");var Qt=We(function(){return kt[on]()});if(Qt.dtype!=="float32")throw new Error("Error in gradient for op "+yt.kernelName+". The gradient of input "+on+" must have 'float32' dtype, but has '"+Qt.dtype+"'");var cn=yt.inputs[on];if(!ln(Qt.shape,cn.shape))throw new Error("Error in gradient for op "+yt.kernelName+". The gradient of input '"+on+"' has shape '"+Qt.shape+"', which does not match the shape of the input '"+cn.shape+"'");if(Re[cn.id]==null)Re[cn.id]=Qt;else{var vn=Re[cn.id];Re[cn.id]=vn.add(Qt),vn.dispose()}};for(var Jt in yt.inputs)It(Jt)},Je=Me.length-1;Je>=0;Je--)Ze(Je)}(xe,X,function(Re){return D.tidy(Re)});var Fe=u.map(function(Re){return xe[Re.id]});return D.state.gradientDepth===0&&(D.state.activeTape.forEach(function(Re){for(var Me=0,We=Re.saved;Me<We.length;Me++)We[Me].dispose()}),D.state.activeTape=null),{value:z,grads:Fe}})},v.prototype.customGrad=function(h){var u=this;return ke(Yn(h),function(){return"The f passed in customGrad(f) must be a function."}),function(){for(var d,y=[],D=0;D<arguments.length;D++)y[D]=arguments[D];ke(y.every(function(X){return X instanceof Mt}),function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"});var z={};return y.forEach(function(X,oe){z[oe]=X}),u.runKernelFunc(function(X,oe){return ke((d=h.apply(void 0,y.concat([oe]))).value instanceof Mt,function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"}),ke(Yn(d.gradFunc),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."}),d.value},z,function(X,oe){var he=d.gradFunc(X,oe),xe=Array.isArray(he)?he:[he];ke(xe.length===y.length,function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."}),ke(xe.every(function(Re){return Re instanceof Mt}),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."});var Fe={};return xe.forEach(function(Re,Me){Fe[Me]=function(){return Re}}),Fe})}},v.prototype.readSync=function(h){return this.state.tensorInfo.get(h).backend.readSync(h)},v.prototype.read=function(h){return this.state.tensorInfo.get(h).backend.read(h)},v.prototype.time=function(h){return R(this,void 0,void 0,function(){var u,d;return W(this,function(y){switch(y.label){case 0:return u=Zt(),[4,this.backend.time(h)];case 1:return(d=y.sent()).wallMs=Zt()-u,[2,d]}})})},v.prototype.track=function(h){return this.state.activeScope!=null&&(h.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(h)),h},Object.defineProperty(v.prototype,"registeredVariables",{get:function(){return this.state.registeredVariables},enumerable:!0,configurable:!0}),v.prototype.reset=function(){for(var h in this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new pn,this.registry)this.disposeRegisteredKernels(h),this.registry[h].dispose(),delete this.registry[h];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null},v.nextTensorId=0,v.nextVariableId=0,v}(),Ue=function(){var v=function(){if(Nt==null){var u=void 0;if(typeof window<"u")u=window;else if(b!==void 0)u=b;else if($!==void 0)u=$;else{if(typeof self>"u")throw new Error("Could not find a global object");u=self}Nt=u}return Nt}();if(v._tfengine==null){var h=new q(v);v._tfengine=new Ht(h)}return function(u){ee=u}(v._tfengine.ENV),Ei=function(){return v._tfengine},v._tfengine}();function Mn(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}var Gn=P();Gn.registerFlag("DEBUG",function(){return!1},function(v){v&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")}),Gn.registerFlag("IS_BROWSER",function(){return Mn()}),Gn.registerFlag("IS_NODE",function(){return $!==void 0&&$.versions!==void 0&&$.versions.node!==void 0}),Gn.registerFlag("IS_CHROME",function(){return typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)}),Gn.registerFlag("PROD",function(){return!1}),Gn.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",function(){return Gn.getBool("DEBUG")}),Gn.registerFlag("DEPRECATION_WARNINGS_ENABLED",function(){return!0}),Gn.registerFlag("IS_TEST",function(){return!1});var Zn,ir,zr,vr={},pi={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function fo(v,h){vr[v]=h}function ui(v){v in vr||(vr[v]=function(u){if(u!==1&&u!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var d=function(y){if(typeof OffscreenCanvas<"u"&&y===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}(u);return d.addEventListener("webglcontextlost",function(y){y.preventDefault(),delete vr[u]},!1),u===1?d.getContext("webgl",pi)||d.getContext("experimental-webgl",pi):d.getContext("webgl2",pi)}(v));var h=vr[v];return h.isContextLost()?(delete vr[v],ui(v)):(h.disable(h.DEPTH_TEST),h.disable(h.STENCIL_TEST),h.disable(h.BLEND),h.disable(h.DITHER),h.disable(h.POLYGON_OFFSET_FILL),h.disable(h.SAMPLE_COVERAGE),h.enable(h.SCISSOR_TEST),h.enable(h.CULL_FACE),h.cullFace(h.BACK),vr[v])}function Zi(v,h){return[h,v]}function Ti(v){var h=Ye(v);return Pt(Math.ceil(h/4))}function qr(v,h){return[Math.max(1,Math.ceil(h/2)),Math.max(1,Math.ceil(v/2))]}function jr(v,h){var u,d,y,D,z,X,oe,he,xe,Fe=v;return P().getNumber("WEBGL_VERSION")===2?(u=Fe.R32F,d=Fe.R16F,y=Fe.RGBA16F,D=Fe.RGBA32F,z=Fe.RED,X=4,oe=1,he=Fe.HALF_FLOAT,xe=Fe.FLOAT):(u=v.RGBA,d=v.RGBA,y=v.RGBA,D=Fe.RGBA,z=v.RGBA,X=4,oe=4,he=h!=null?h.HALF_FLOAT_OES:null,xe=v.FLOAT),{internalFormatFloat:u,internalFormatHalfFloat:d,internalFormatPackedHalfFloat:y,internalFormatPackedFloat:D,textureFormatFloat:z,downloadTextureFormat:v.RGBA,downloadUnpackNumChannels:X,defaultNumChannels:oe,textureTypeHalfFloat:he,textureTypeFloat:xe}}function jn(v,h,u){var d=u();return h&&function(y){var D=y.getError();if(D!==y.NO_ERROR)throw new Error("WebGL Error: "+ao(y,D))}(v),d}(function(v){v[v.DENSE=0]="DENSE",v[v.SHARED_BATCH=1]="SHARED_BATCH"})(Zn||(Zn={})),function(v){v[v.RENDER=0]="RENDER",v[v.UPLOAD=1]="UPLOAD",v[v.PIXELS=2]="PIXELS",v[v.DOWNLOAD=3]="DOWNLOAD"}(ir||(ir={})),function(v){v[v.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",v[v.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",v[v.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",v[v.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",v[v.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(zr||(zr={}));var ri=596e-10,Vi=65504;function Rr(v){return!!(P().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||v===0||ri<Math.abs(v)&&Math.abs(v)<Vi)}function ao(v,h){switch(h){case v.NO_ERROR:return"NO_ERROR";case v.INVALID_ENUM:return"INVALID_ENUM";case v.INVALID_VALUE:return"INVALID_VALUE";case v.INVALID_OPERATION:return"INVALID_OPERATION";case v.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case v.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case v.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code "+h}}function yo(v,h,u){return ua(v,h,function(){return v.getExtension(u)},'Extension "'+u+'" not supported on this browser.')}function eo(v,h,u){var d=ua(v,h,function(){return v.createShader(v.VERTEX_SHADER)},"Unable to create vertex WebGLShader.");if(jn(v,h,function(){return v.shaderSource(d,u)}),jn(v,h,function(){return v.compileShader(d)}),v.getShaderParameter(d,v.COMPILE_STATUS)===!1)throw console.log(v.getShaderInfoLog(d)),new Error("Failed to compile vertex shader.");return d}function bo(v,h,u){var d=ua(v,h,function(){return v.createShader(v.FRAGMENT_SHADER)},"Unable to create fragment WebGLShader.");if(jn(v,h,function(){return v.shaderSource(d,u)}),jn(v,h,function(){return v.compileShader(d)}),v.getShaderParameter(d,v.COMPILE_STATUS)===!1)throw function(y,D){var z=Eh.exec(D);if(z==null)return console.log("Couldn't parse line number in error: "+D),void console.log(y);for(var X=+z[1],oe=y.split(`
`),he=oe.length.toString().length+2,xe=oe.map(function(Je,at){return gn((at+1).toString(),he)+Je}),Fe=0,Re=0;Re<xe.length;Re++)Fe=Math.max(xe[Re].length,Fe);var Me=xe.slice(0,X-1),We=xe.slice(X-1,X),Ze=xe.slice(X);console.log(Me.join(`
`)),console.log(D.split(`
`)[0]),console.log("%c "+gn(We[0],Fe),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(Ze.join(`
`))}(u,v.getShaderInfoLog(d)),new Error("Failed to compile fragment shader.");return d}var Na,vs,Eh=/ERROR: [0-9]+:([0-9]+):/g;function qi(v,h){return ua(v,h,function(){return v.createProgram()},"Unable to create WebGLProgram.")}function ec(v,h,u){if(jn(v,h,function(){return v.linkProgram(u)}),v.getProgramParameter(u,v.LINK_STATUS)===!1)throw console.log(v.getProgramInfoLog(u)),new Error("Failed to link vertex and fragment shaders.")}function bu(v,h,u){if(jn(v,h,function(){return v.validateProgram(u)}),v.getProgramParameter(u,v.VALIDATE_STATUS)===!1)throw console.log(v.getProgramInfoLog(u)),new Error("Shader program validation failed.")}function bc(v,h,u){var d=ua(v,h,function(){return v.createBuffer()},"Unable to create WebGLBuffer");return jn(v,h,function(){return v.bindBuffer(v.ARRAY_BUFFER,d)}),jn(v,h,function(){return v.bufferData(v.ARRAY_BUFFER,u,v.STATIC_DRAW)}),d}function Bu(v,h,u){var d=ua(v,h,function(){return v.createBuffer()},"Unable to create WebGLBuffer");return jn(v,h,function(){return v.bindBuffer(v.ELEMENT_ARRAY_BUFFER,d)}),jn(v,h,function(){return v.bufferData(v.ELEMENT_ARRAY_BUFFER,u,v.STATIC_DRAW)}),d}function xc(v,h){return ua(v,h,function(){return v.createTexture()},"Unable to create WebGLTexture.")}function Dd(v,h){var u=P().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(v<=0||h<=0){var d="["+v+"x"+h+"]";throw new Error("Requested texture size "+d+" is invalid.")}if(v>u||h>u)throw d="["+v+"x"+h+"]",new Error("Requested texture size "+d+" greater than WebGL maximum on this browser / GPU ["+u+"x"+u+"].")}function as(v,h){return ua(v,h,function(){return v.createFramebuffer()},"Unable to create WebGLFramebuffer.")}function vf(v,h,u,d,y,D,z,X){var oe=v.getAttribLocation(u,d);return oe!==-1&&(jn(v,h,function(){return v.bindBuffer(v.ARRAY_BUFFER,y)}),jn(v,h,function(){return v.vertexAttribPointer(oe,D,v.FLOAT,!1,z,X)}),jn(v,h,function(){return v.enableVertexAttribArray(oe)}),!0)}function Td(v,h,u,d){tc(v,d),jn(v,h,function(){return v.activeTexture(v.TEXTURE0+d)}),jn(v,h,function(){return v.bindTexture(v.TEXTURE_2D,u)})}function Pu(v,h,u,d){return ua(v,h,function(){return v.getUniformLocation(u,d)},'uniform "'+d+'" not present in program.')}function yf(v,h,u){return v.getUniformLocation(h,u)}function Ch(v,h,u,d,y,D){jn(v,h,function(){return Td(v,h,d,D)}),jn(v,h,function(){return v.uniform1i(y,D)})}function wc(v,h,u,d){jn(v,h,function(){return v.bindFramebuffer(v.FRAMEBUFFER,d)}),jn(v,h,function(){return v.framebufferTexture2D(v.FRAMEBUFFER,v.COLOR_ATTACHMENT0,v.TEXTURE_2D,u,0)})}function El(v,h,u){jn(v,h,function(){return v.bindFramebuffer(v.FRAMEBUFFER,u)}),jn(v,h,function(){return v.framebufferTexture2D(v.FRAMEBUFFER,v.COLOR_ATTACHMENT0,v.TEXTURE_2D,null,0)})}function Fa(v){var h=v.checkFramebufferStatus(v.FRAMEBUFFER);if(h!==v.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+Vc(v,h))}function Vc(v,h){switch(h){case v.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case v.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case v.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case v.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error "+h}}function ua(v,h,u,d){var y=jn(v,h,function(){return u()});if(y==null)throw new Error(d);return y}function tc(v,h){var u=v.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,d=h+v.TEXTURE0;if(d<v.TEXTURE0||d>u)throw new Error("textureUnit must be in [gl.TEXTURE0, gl.TEXTURE"+u+"].")}function ss(v,h){return h===void 0&&(h=2),Ye(v.slice(0,v.length-h))}function Ca(v){if(v.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[v.length>1?v[v.length-2]:1,v[v.length-1]]}function nc(v){var h=[1,1,1];return v.length===0||v.length===1&&v[0]===1||(h=[ss(v)].concat(Ca(v))),h}function Cl(v,h){var u;h===void 0&&(h=!1);var d=P().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(h&&(d*=2,(v=v.map(function(he,xe){return xe>=v.length-2?Ut(v[xe]):v[xe]})).length===1&&(v=[2,v[0]])),v.length!==2){var y=Bn(v);v=y.newShape}var D=Ye(v);if(v.length<=1&&D<=d)return[1,D];if(v.length===2&&v[0]<=d&&v[1]<=d)return v;if(v.length===3&&v[0]*v[1]<=d&&v[2]<=d)return[v[0]*v[1],v[2]];if(v.length===3&&v[0]<=d&&v[1]*v[2]<=d)return[v[0],v[1]*v[2]];if(v.length===4&&v[0]*v[1]*v[2]<=d&&v[3]<=d)return[v[0]*v[1]*v[2],v[3]];if(v.length===4&&v[0]<=d&&v[1]*v[2]*v[3]<=d)return[v[0],v[1]*v[2]*v[3]];if(h){var z=ss(v),X=2,oe=2;return v.length&&(X=(u=Ca(v))[0],oe=u[1]),Pt(D=z*(X/2)*(oe/2)).map(function(he){return 2*he})}return Pt(D)}function rc(v){return v%2==0}function cu(v,h){if(ln(v=v.slice(-2),h=h.slice(-2))||!v.length||!h.length||v[0]===0||v[1]===0||h[0]===0||h[1]===0)return!0;if(v.length!==h.length){var u=v.slice(-1)[0],d=h.slice(-1)[0];if(u===d||rc(u)&&rc(d)&&(v[0]===1||h[0]===1))return!0}return v[1]===h[1]&&rc(v[0])&&rc(h[0])}function Oh(v){if(Na==null){var h=ui(v);Na=h.getParameter(h.MAX_TEXTURE_SIZE)}return Na}function bf(v){if(vs==null){var h=ui(v);vs=h.getParameter(h.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,vs)}function xf(v){if(v===0)return 0;var h=ui(v);return fa(h,"EXT_disjoint_timer_query_webgl2")&&v===2?2:fa(h,"EXT_disjoint_timer_query")?1:0}function fa(v,h){return v.getExtension(h)!=null}function Ah(v){try{if(ui(v)!=null)return!0}catch{return!1}return!1}function Nd(v){if(v===0)return!1;var h=ui(v);if(v===1){if(!fa(h,"OES_texture_float"))return!1}else if(!fa(h,"EXT_color_buffer_float"))return!1;return kf(h)}function wf(v){if(v===0)return!1;var h=ui(v);return v!==1?fa(h,"EXT_color_buffer_float")?kf(h):!!fa(h,"EXT_color_buffer_half_float")&&function(u,d){var y=jr(u,d),D=u.createTexture();u.bindTexture(u.TEXTURE_2D,D),u.texImage2D(u.TEXTURE_2D,0,y.internalFormatHalfFloat,1,1,0,y.textureFormatFloat,y.textureTypeHalfFloat,null);var z=u.createFramebuffer();u.bindFramebuffer(u.FRAMEBUFFER,z),u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,D,0);var X=u.checkFramebufferStatus(u.FRAMEBUFFER)===u.FRAMEBUFFER_COMPLETE;return u.bindTexture(u.TEXTURE_2D,null),u.bindFramebuffer(u.FRAMEBUFFER,null),u.deleteTexture(D),u.deleteFramebuffer(z),X}(h,h.getExtension("EXT_color_buffer_half_float")):!!fa(h,"OES_texture_float")&&!!fa(h,"WEBGL_color_buffer_float")&&kf(h)}function kf(v){var h=jr(v),u=v.createTexture();v.bindTexture(v.TEXTURE_2D,u),v.texImage2D(v.TEXTURE_2D,0,h.internalFormatFloat,1,1,0,h.textureFormatFloat,h.textureTypeFloat,null);var d=v.createFramebuffer();v.bindFramebuffer(v.FRAMEBUFFER,d),v.framebufferTexture2D(v.FRAMEBUFFER,v.COLOR_ATTACHMENT0,v.TEXTURE_2D,u,0);var y=v.checkFramebufferStatus(v.FRAMEBUFFER)===v.FRAMEBUFFER_COMPLETE;return v.bindTexture(v.TEXTURE_2D,null),v.bindFramebuffer(v.FRAMEBUFFER,null),v.deleteTexture(u),v.deleteFramebuffer(d),y}function ys(v){return v===2&&ui(v).fenceSync!=null}var Ef=Object.freeze({callAndCheck:jn,canBeRepresented:Rr,getWebGLErrorMessage:ao,getExtensionOrThrow:yo,createVertexShader:eo,createFragmentShader:bo,createProgram:qi,linkProgram:ec,validateProgram:bu,createStaticVertexBuffer:bc,createStaticIndexBuffer:Bu,getNumChannels:function(){return P().getNumber("WEBGL_VERSION")===2?1:4},createTexture:xc,validateTextureSize:Dd,createFramebuffer:as,bindVertexBufferToProgramAttribute:vf,bindTextureUnit:Td,unbindTextureUnit:function(v,h,u){tc(v,u),jn(v,h,function(){return v.activeTexture(v.TEXTURE0+u)}),jn(v,h,function(){return v.bindTexture(v.TEXTURE_2D,null)})},getProgramUniformLocationOrThrow:Pu,getProgramUniformLocation:yf,bindTextureToProgramUniformSampler:Ch,bindCanvasToFramebuffer:function(v,h){jn(v,h,function(){return v.bindFramebuffer(v.FRAMEBUFFER,null)}),jn(v,h,function(){return v.viewport(0,0,v.canvas.width,v.canvas.height)}),jn(v,h,function(){return v.scissor(0,0,v.canvas.width,v.canvas.height)})},bindColorTextureToFramebuffer:wc,unbindColorTextureFromFramebuffer:El,validateFramebuffer:Fa,getFramebufferErrorMessage:Vc,getBatchDim:ss,getRowsCols:Ca,getShapeAs3D:nc,getTextureShapeFromLogicalShape:Cl,isReshapeFree:cu,getWebGLMaxTextureSize:Oh,resetMaxTextureSize:function(){Na=null},resetMaxTexturesInShader:function(){vs=null},getMaxTexturesInShader:bf,getWebGLDisjointQueryTimerVersion:xf,hasExtension:fa,isWebGLVersionEnabled:Ah,isCapableOfRenderingToFloatTexture:Nd,isDownloadFloatTextureEnabled:wf,isWebGLFenceEnabled:ys}),ar=P();function xu(){P().set("PROD",!0)}function Tp(){P().set("DEBUG",!0)}function Np(){P().set("DEPRECATION_WARNINGS_ENABLED",!1),console.warn("TensorFlow.js deprecation warnings have been disabled.")}function Cf(v){P().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(v+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function Ol(){Ue.disposeVariables()}function Fd(){return Ue}function Sh(){return Ue.memory()}function _h(v){return Ue.profile(v)}function Ii(v,h){return Ue.tidy(v,h)}function No(v){qn(v).forEach(function(h){return h.dispose()})}function Dh(v){return Ue.keep(v)}function bm(v){return Ue.time(v)}function Of(v){return Ue.setBackend(v)}function Id(){return Ue.ready()}function bs(){return Ue.backendName}function ic(v){Ue.removeBackend(v)}function Rd(v){return Ue.findBackend(v)}function Fp(v){return Ue.findBackendFactory(v)}function Ip(v,h,u){return u===void 0&&(u=1),Ue.registerBackend(v,h,u)}function xm(){return Ue.backend}function wm(v,h){P().setPlatform(v,h)}function qc(){for(var v=[],h=0;h<arguments.length;h++)v[h]=arguments[h];P().getBool("IS_TEST")||console.warn.apply(console,v)}function za(v,h){var u=v;if(pt(v))return h==="string"?[]:[v.length];if(!Array.isArray(v))return[];for(var d=[];Array.isArray(u)||pt(u)&&h!=="string";)d.push(u.length),u=u[0];return Array.isArray(v)&&P().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&function y(D,z,X){if(X=X||[],Array.isArray(D)||pt(D)){ke(z.length>0,function(){return"Element arr["+X.join("][")+"] should be a primitive, but is an array of "+D.length+" elements"}),ke(D.length===z[0],function(){return"Element arr["+X.join("][")+"] should have "+z[0]+" elements, but has "+D.length+" elements"});for(var oe=z.slice(1),he=0;he<D.length;++he)y(D[he],oe,X.concat(he))}else ke(z.length===0,function(){return"Element arr["+X.join("][")+"] is a primitive, but should be an array/TypedArray of "+z[0]+" elements"})}(v,d,[]),d}function Th(v,h,u,d){if(v!=null&&(v!=="numeric"&&v!==h||v==="numeric"&&h==="string"))throw new Error("Argument '"+u+"' passed to '"+d+"' must be "+v+" tensor, but got "+h+" tensor")}function Ke(v,h,u,d){if(d===void 0&&(d="numeric"),v instanceof Mt)return Th(d,v.dtype,h,u),v;var y=be(v);if(y!=="string"&&["bool","int32","float32"].indexOf(d)>=0&&(y=d),Th(d,y,h,u),v==null||!pt(v)&&!Array.isArray(v)&&typeof v!="number"&&typeof v!="boolean"&&typeof v!="string"){var D=v==null?"null":v.constructor.name;throw new Error("Argument '"+h+"' passed to '"+u+"' must be a Tensor or TensorLike, but got '"+D+"'")}var z=za(v,y);pt(v)||Array.isArray(v)||(v=[v]);var X=y!=="string"?Nr(v,y,P().getBool("DEBUG")):jt(v,[],!0);return Ue.makeTensor(X,z,y)}function Lu(v,h,u,d){if(d===void 0&&(d="numeric"),!Array.isArray(v))throw new Error("Argument "+h+" passed to "+u+" must be a `Tensor[]` or `TensorLike[]`");return v.map(function(y,D){return Ke(y,h+"["+D+"]",u)},d)}function Af(v,h){for(var u=0;u<v.length;++u)if(v[v.length-u-1]!==h-1-u)return!1;return!0}function Md(v,h,u){for(var d=v.length+h.length,y=[],D=0,z=0,X=0;X<d;X++)u.indexOf(X)===-1?y.push(v[D++]):y.push(h[z++]);return y}function So(v,h){for(var u=[],d=v.length,y=0;y<d;y++)h.indexOf(y)===-1&&u.push(v[y]);return[u,h.map(function(D){return v[D]})]}function _o(v,h){return Md(v,h.map(function(u){return 1}),h)}function Ko(v,h,u){ke(Af(h,u),function(){return v+" supports only inner-most axes for now. Got axes "+h+" and rank-"+u+" input."})}function Oa(v,h){if(Af(v,h))return null;for(var u=[],d=0;d<h;++d)v.indexOf(d)===-1&&u.push(d);return v.forEach(function(y){return u.push(y)}),u}function wu(v){return v.map(function(h,u){return[u,h]}).sort(function(h,u){return h[1]-u[1]}).map(function(h){return h[0]})}function Aa(v,h){for(var u=[],d=h-v;d<h;++d)u.push(d);return u}function kc(v,h){var u=v[0].length;v.forEach(function(y,D){ke(y.length===u,function(){return"Error in concat"+u+"D: rank of tensors["+D+"] must be the same as the rank of the rest ("+u+")"})}),ke(h>=0&&h<u,function(){return"Error in concat"+u+"D: axis must be between 0 and "+(u-1)+"."});var d=v[0];v.forEach(function(y,D){for(var z=0;z<u;z++)ke(z===h||y[z]===d[z],function(){return"Error in concat"+u+"D: Shape of tensors["+D+"] ("+y+") does not match the shape of the rest ("+d+") along the non-concatenated axis "+D+"."})})}function tu(v,h){for(var u=v[0].slice(),d=1;d<v.length;d++)u[h]+=v[d][h];return u}function wt(v){var h=Object.keys(v);if(h.length!==1)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+h.length+" keys.");var u=h[0],d=v[u];u.endsWith("_")&&(u=u.substring(0,u.length-1));var y=function(){for(var D=[],z=0;z<arguments.length;z++)D[z]=arguments[z];Ue.startScope(u);try{var X=d.apply(void 0,D);return X instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),Ue.endScope(X),X}catch(oe){throw Ue.endScope(null),oe}};return Object.defineProperty(y,"name",{value:u,configurable:!0}),y}ar.registerFlag("HAS_WEBGL",function(){return ar.getNumber("WEBGL_VERSION")>0}),ar.registerFlag("WEBGL_VERSION",function(){return Ah(2)?2:Ah(1)?1:0}),ar.registerFlag("WEBGL_BUFFER_SUPPORTED",function(){return ar.get("WEBGL_VERSION")===2}),ar.registerFlag("WEBGL_CPU_FORWARD",function(){return!0}),ar.registerFlag("WEBGL_FORCE_F16_TEXTURES",function(){return!1}),ar.registerFlag("WEBGL_PACK",function(){return ar.getBool("HAS_WEBGL")}),ar.registerFlag("WEBGL_PACK_NORMALIZATION",function(){return ar.getBool("WEBGL_PACK")}),ar.registerFlag("WEBGL_PACK_CLIP",function(){return ar.getBool("WEBGL_PACK")}),ar.registerFlag("WEBGL_PACK_DEPTHWISECONV",function(){return!1}),ar.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",function(){return ar.getBool("WEBGL_PACK")}),ar.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",function(){return ar.getBool("WEBGL_PACK")}),ar.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",function(){return ar.getBool("WEBGL_PACK")}),ar.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",function(){return ar.getBool("WEBGL_PACK")}),ar.registerFlag("WEBGL_PACK_REDUCE",function(){return ar.getBool("WEBGL_PACK")}),ar.registerFlag("WEBGL_LAZILY_UNPACK",function(){return ar.getBool("WEBGL_PACK")}),ar.registerFlag("WEBGL_CONV_IM2COL",function(){return ar.getBool("WEBGL_PACK")}),ar.registerFlag("WEBGL_MAX_TEXTURE_SIZE",function(){return Oh(ar.getNumber("WEBGL_VERSION"))}),ar.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",function(){return bf(ar.getNumber("WEBGL_VERSION"))}),ar.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",function(){var v=ar.getNumber("WEBGL_VERSION");return v===0?0:xf(v)}),ar.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",function(){return ar.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&(v=navigator.userAgent||navigator.vendor||window.opera,!(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(v)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(v.substr(0,4))));var v}),ar.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",function(){return Nd(ar.getNumber("WEBGL_VERSION"))}),ar.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",function(){return!ar.getBool("WEBGL_FORCE_F16_TEXTURES")&&ar.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")}),ar.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",function(){return wf(ar.getNumber("WEBGL_VERSION"))}),ar.registerFlag("WEBGL_FENCE_API_ENABLED",function(){return ys(ar.getNumber("WEBGL_VERSION"))}),ar.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",function(){return ar.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0}),Lr=Cf;var ho=wt({complex_:function(v,h){var u=Ke(v,"real","complex"),d=Ke(h,"imag","complex");return Ft(u.shape,d.shape,"real and imag shapes, "+u.shape+" and "+d.shape+", must match in call to tf.complex()."),Ue.runKernelFunc(function(y){return y.complex(u,d)},{$real:u,$imag:d})}}),ca=wt({real_:function(v){var h=Ke(v,"input","real");return Ue.runKernelFunc(function(u){return u.real(h)},{$input:h})}}),Ua=wt({imag_:function(v){var h=Ke(v,"input","imag");return Ue.runKernelFunc(function(u){return u.imag(h)},{$input:h})}});function ko(v,h,u){return xs(v,h,za(v,u),u)}function xs(v,h,u,d){if(d==null&&(d=be(v)),d==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!pt(v)&&!Array.isArray(v)&&typeof v!="number"&&typeof v!="boolean"&&typeof v!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(h!=null){$n(h);var y=Ye(h),D=Ye(u);ke(y===D,function(){return"Based on the provided shape, ["+h+"], the tensor should have "+y+" values but has "+D});for(var z=0;z<u.length;++z){var X=u[z],oe=z!==u.length-1||X!==Ye(h.slice(z));ke(u[z]===h[z]||!oe,function(){return"Error creating a new Tensor. Inferred shape ("+u+") does not match the provided shape ("+h+"). "})}}return pt(v)||Array.isArray(v)||(v=[v]),h=h||u,v=d!=="string"?Nr(v,d,P().getBool("DEBUG")):jt(v,[],!0),Ue.makeTensor(v,h,d)}function fr(v,h){if((pt(v)&&h!=="string"||Array.isArray(v))&&h!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(h==="string"&&pt(v)&&!(v instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return xs(v,[],[],h)}function Us(v,h){Gt(v);var u=za(v,h);if(u.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return xs(v,null,u,h)}function nu(v,h,u){if(Gt(v),h!=null&&h.length!==2)throw new Error("tensor2d() requires shape to have two numbers");var d=za(v,u);if(d.length!==2&&d.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(d.length===1&&h==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return xs(v,h,d,u)}function Hc(v,h,u){if(Gt(v),h!=null&&h.length!==3)throw new Error("tensor3d() requires shape to have three numbers");var d=za(v,u);if(d.length!==3&&d.length!==1)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(d.length===1&&h==null)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return xs(v,h,d,u)}function Ws(v,h,u){if(Gt(v),h!=null&&h.length!==4)throw new Error("tensor4d() requires shape to have four numbers");var d=za(v,u);if(d.length!==4&&d.length!==1)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(d.length===1&&h==null)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return xs(v,h,d,u)}function Nh(v,h,u){if(Gt(v),h!=null&&h.length!==5)throw new Error("tensor5d() requires shape to have five numbers");var d=za(v,u);if(d.length!==5&&d.length!==1)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(d.length===1&&h==null)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return xs(v,h,d,u)}function jd(v,h,u){if(Gt(v),h!=null&&h.length!==6)throw new Error("tensor6d() requires shape to have six numbers");var d=za(v,u);if(d.length!==6&&d.length!==1)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(d.length===1&&h==null)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return xs(v,h=h||d,d,u)}function Bd(v,h,u,d){return h===void 0&&(h=!0),Ue.makeVariable(v,h,u,d)}function lu(v,h){if(h===void 0&&(h="float32"),h==="complex64"){var u=lu(v,"float32"),d=Ki(v,"float32");return ho(u,d)}var y=an(Ye(v),h);return Ue.makeTensor(y,v,h)}function Ki(v,h){if(h===void 0&&(h="float32"),h==="complex64"){var u=Ki(v,"float32"),d=Ki(v,"float32");return ho(u,d)}var y=Kt(Ye(v),h);return Ue.makeTensor(y,v,h)}function ws(v,h,u){return Ue.runKernelFunc(function(d){return d.fill(v,h,u)},{})}function Fh(v,h,u){if(u<=0)throw new Error("The number of values should be positive.");return Ue.runKernelFunc(function(d){return d.linspace(v,h,u)},{})}function oc(v,h,u,d){if(u===void 0&&(u=1),d===void 0&&(d="float32"),u===0)throw new Error("Cannot have a step of zero");if(v===h||v<h&&u<0||h<v&&u>1)return Ki([0],d);var y=Kt(Math.abs(Math.ceil((h-v)/u)),d);h<v&&u===1&&(u=-1),y[0]=v;for(var D=1;D<y.length;D++)y[D]=y[D-1]+u;return Us(y,d)}var us=wt({onesLike_:function(v){var h=Ke(v,"x","onesLike");if(h.dtype==="complex64"){var u=us(ca(h)),d=ii(Ua(h));return ho(u,d)}return Ue.runKernelFunc(function(y){return y.onesLike(h)},{$x:h},function(y,D){return{$x:function(){return ii(y)}}})}}),ii=wt({zerosLike_:function(v){var h=Ke(v,"x","zerosLike");return Ue.runKernelFunc(function(u){return u.zerosLike(h)},{$x:h},function(u,d){return{$x:function(){return ii(u)}}})}}),Po=wt({concat_:function(v,h){h===void 0&&(h=0),ke(v.length>=1,function(){return"Pass at least one tensor to concat"});var u=Lu(v,"tensors","concat");u[0].dtype==="complex64"&&u.forEach(function(X){if(X.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype `+X.dtype+". ")}),h=wn(h,u[0].shape)[0];var d=tu(u.map(function(X){return X.shape}),h);if(Ye(d)===0)return ko([],d);if((u=u.filter(function(X){return X.size>0})).length===1)return u[0];var y=u.map(function(X){return X.shape});kc(y,h);var D=u,z={axis:h};return Ue.runKernelFunc(function(X){return X.concat(u,h)},D,function(X){var oe=y.map(function(he){return he[h]});return Ri(X,oe,h).map(function(he){return function(){return he}})},"Concat",z)}}),Ih=wt({concat1d_:function(v){return Po(v,0)}}),Pd=wt({concat2d_:function(v,h){return Po(v,h)}}),Al=wt({concat3d_:function(v,h){return Po(v,h)}}),Rh=wt({concat4d_:function(v,h){return Po(v,h)}}),Ri=wt({split_:function(v,h,u){u===void 0&&(u=0);var d,y=Ke(v,"x","split");return u=wn(u,y.shape)[0],typeof h=="number"?(ke(y.shape[u]%h==0,function(){return"Number of splits must evenly divide the axis."}),d=new Array(h).fill(y.shape[u]/h)):(ke(y.shape[u]===h.reduce(function(D,z){return D+z}),function(){return"The sum of sizes must match the size of the axis dimension."}),d=h),Ue.runKernelFunc(function(D){return D.split(y,d,u)},{$x:y},function(D){return{$x:function(){return Po(D,u)}}})}});function bi(v,h){return v(h={exports:{}},h.exports),h.exports}var oa=bi(function(v){(function(h,u,d){function y(z,X){return X.c=z.c,X.s0=z.s0,X.s1=z.s1,X.s2=z.s2,X}function D(z,X){var oe=new function(Fe){var Re,Me=this,We=(Re=4022871197,function(Ze){Ze=Ze.toString();for(var Je=0;Je<Ze.length;Je++){var at=.02519603282416938*(Re+=Ze.charCodeAt(Je));at-=Re=at>>>0,Re=(at*=Re)>>>0,Re+=4294967296*(at-=Re)}return 23283064365386963e-26*(Re>>>0)});Me.next=function(){var Ze=2091639*Me.s0+23283064365386963e-26*Me.c;return Me.s0=Me.s1,Me.s1=Me.s2,Me.s2=Ze-(Me.c=0|Ze)},Me.c=1,Me.s0=We(" "),Me.s1=We(" "),Me.s2=We(" "),Me.s0-=We(Fe),Me.s0<0&&(Me.s0+=1),Me.s1-=We(Fe),Me.s1<0&&(Me.s1+=1),Me.s2-=We(Fe),Me.s2<0&&(Me.s2+=1),We=null}(z),he=X&&X.state,xe=oe.next;return xe.int32=function(){return 4294967296*oe.next()|0},xe.double=function(){return xe()+11102230246251565e-32*(2097152*xe()|0)},xe.quick=xe,he&&(typeof he=="object"&&y(he,oe),xe.state=function(){return y(oe,{})}),xe}u&&u.exports?u.exports=D:this.alea=D})(0,v)}),Ld=bi(function(v){(function(h,u,d){function y(z,X){return X.x=z.x,X.y=z.y,X.z=z.z,X.w=z.w,X}function D(z,X){var oe=new function(Fe){var Re=this,Me="";Re.x=0,Re.y=0,Re.z=0,Re.w=0,Re.next=function(){var Ze=Re.x^Re.x<<11;return Re.x=Re.y,Re.y=Re.z,Re.z=Re.w,Re.w^=Re.w>>>19^Ze^Ze>>>8},Fe===(0|Fe)?Re.x=Fe:Me+=Fe;for(var We=0;We<Me.length+64;We++)Re.x^=0|Me.charCodeAt(We),Re.next()}(z),he=X&&X.state,xe=function(){return(oe.next()>>>0)/4294967296};return xe.double=function(){do var Fe=((oe.next()>>>11)+(oe.next()>>>0)/4294967296)/2097152;while(Fe===0);return Fe},xe.int32=oe.next,xe.quick=xe,he&&(typeof he=="object"&&y(he,oe),xe.state=function(){return y(oe,{})}),xe}u&&u.exports?u.exports=D:this.xor128=D})(0,v)}),zd=bi(function(v){(function(h,u,d){function y(z,X){return X.x=z.x,X.y=z.y,X.z=z.z,X.w=z.w,X.v=z.v,X.d=z.d,X}function D(z,X){var oe=new function(Fe){var Re=this,Me="";Re.next=function(){var Ze=Re.x^Re.x>>>2;return Re.x=Re.y,Re.y=Re.z,Re.z=Re.w,Re.w=Re.v,(Re.d=Re.d+362437|0)+(Re.v=Re.v^Re.v<<4^Ze^Ze<<1)|0},Re.x=0,Re.y=0,Re.z=0,Re.w=0,Re.v=0,Fe===(0|Fe)?Re.x=Fe:Me+=Fe;for(var We=0;We<Me.length+64;We++)Re.x^=0|Me.charCodeAt(We),We==Me.length&&(Re.d=Re.x<<10^Re.x>>>4),Re.next()}(z),he=X&&X.state,xe=function(){return(oe.next()>>>0)/4294967296};return xe.double=function(){do var Fe=((oe.next()>>>11)+(oe.next()>>>0)/4294967296)/2097152;while(Fe===0);return Fe},xe.int32=oe.next,xe.quick=xe,he&&(typeof he=="object"&&y(he,oe),xe.state=function(){return y(oe,{})}),xe}u&&u.exports?u.exports=D:this.xorwow=D})(0,v)}),Ud=bi(function(v){(function(h,u,d){function y(z,X){return X.x=z.x.slice(),X.i=z.i,X}function D(z,X){z==null&&(z=+new Date);var oe=new function(Fe){var Re=this;Re.next=function(){var Me,We,Ze=Re.x,Je=Re.i;return Me=Ze[Je],We=(Me^=Me>>>7)^Me<<24,We^=(Me=Ze[Je+1&7])^Me>>>10,We^=(Me=Ze[Je+3&7])^Me>>>3,We^=(Me=Ze[Je+4&7])^Me<<7,Me=Ze[Je+7&7],We^=(Me^=Me<<13)^Me<<9,Ze[Je]=We,Re.i=Je+1&7,We},function(Me,We){var Ze,Je=[];if(We===(0|We))Je[0]=We;else for(We=""+We,Ze=0;Ze<We.length;++Ze)Je[7&Ze]=Je[7&Ze]<<15^We.charCodeAt(Ze)+Je[Ze+1&7]<<13;for(;Je.length<8;)Je.push(0);for(Ze=0;Ze<8&&Je[Ze]===0;++Ze);for(Ze==8?Je[7]=-1:Je[Ze],Me.x=Je,Me.i=0,Ze=256;Ze>0;--Ze)Me.next()}(Re,Fe)}(z),he=X&&X.state,xe=function(){return(oe.next()>>>0)/4294967296};return xe.double=function(){do var Fe=((oe.next()>>>11)+(oe.next()>>>0)/4294967296)/2097152;while(Fe===0);return Fe},xe.int32=oe.next,xe.quick=xe,he&&(he.x&&y(he,oe),xe.state=function(){return y(oe,{})}),xe}u&&u.exports?u.exports=D:this.xorshift7=D})(0,v)}),Rp=bi(function(v){(function(h,u,d){function y(z,X){return X.i=z.i,X.w=z.w,X.X=z.X.slice(),X}function D(z,X){z==null&&(z=+new Date);var oe=new function(Fe){var Re=this;Re.next=function(){var Me,We,Ze=Re.w,Je=Re.X,at=Re.i;return Re.w=Ze=Ze+1640531527|0,We=Je[at+34&127],Me=Je[at=at+1&127],We^=We<<13,Me^=Me<<17,We^=We>>>15,Me^=Me>>>12,We=Je[at]=We^Me,Re.i=at,We+(Ze^Ze>>>16)|0},function(Me,We){var Ze,Je,at,yt,xt,kt=[],It=128;for(We===(0|We)?(Je=We,We=null):(We+="\0",Je=0,It=Math.max(It,We.length)),at=0,yt=-32;yt<It;++yt)We&&(Je^=We.charCodeAt((yt+32)%We.length)),yt===0&&(xt=Je),Je^=Je<<10,Je^=Je>>>15,Je^=Je<<4,Je^=Je>>>13,yt>=0&&(xt=xt+1640531527|0,at=(Ze=kt[127&yt]^=Je+xt)==0?at+1:0);for(at>=128&&(kt[127&(We&&We.length||0)]=-1),at=127,yt=512;yt>0;--yt)Je=kt[at+34&127],Ze=kt[at=at+1&127],Je^=Je<<13,Ze^=Ze<<17,Je^=Je>>>15,Ze^=Ze>>>12,kt[at]=Je^Ze;Me.w=xt,Me.X=kt,Me.i=at}(Re,Fe)}(z),he=X&&X.state,xe=function(){return(oe.next()>>>0)/4294967296};return xe.double=function(){do var Fe=((oe.next()>>>11)+(oe.next()>>>0)/4294967296)/2097152;while(Fe===0);return Fe},xe.int32=oe.next,xe.quick=xe,he&&(he.X&&y(he,oe),xe.state=function(){return y(oe,{})}),xe}u&&u.exports?u.exports=D:this.xor4096=D})(0,v)}),zu=bi(function(v){(function(h,u,d){function y(z,X){return X.a=z.a,X.b=z.b,X.c=z.c,X.d=z.d,X}function D(z,X){var oe=new function(Fe){var Re=this,Me="";Re.next=function(){var Ze=Re.b,Je=Re.c,at=Re.d,yt=Re.a;return Ze=Ze<<25^Ze>>>7^Je,Je=Je-at|0,at=at<<24^at>>>8^yt,yt=yt-Ze|0,Re.b=Ze=Ze<<20^Ze>>>12^Je,Re.c=Je=Je-at|0,Re.d=at<<16^Je>>>16^yt,Re.a=yt-Ze|0},Re.a=0,Re.b=0,Re.c=-1640531527,Re.d=1367130551,Fe===Math.floor(Fe)?(Re.a=Fe/4294967296|0,Re.b=0|Fe):Me+=Fe;for(var We=0;We<Me.length+20;We++)Re.b^=0|Me.charCodeAt(We),Re.next()}(z),he=X&&X.state,xe=function(){return(oe.next()>>>0)/4294967296};return xe.double=function(){do var Fe=((oe.next()>>>11)+(oe.next()>>>0)/4294967296)/2097152;while(Fe===0);return Fe},xe.int32=oe.next,xe.quick=xe,he&&(typeof he=="object"&&y(he,oe),xe.state=function(){return y(oe,{})}),xe}u&&u.exports?u.exports=D:this.tychei=D})(0,v)}),ks=bi(function(v){(function(h,u){var d,y=this,D=256,z=6,X="random",oe=u.pow(D,z),he=u.pow(2,52),xe=2*he,Fe=D-1;function Re(at,yt,xt){var kt=[],It=Ze(function Qt(cn,vn){var p,c=[],o=typeof cn;if(vn&&o=="object")for(p in cn)try{c.push(Qt(cn[p],vn-1))}catch{}return c.length?c:o=="string"?cn:cn+"\0"}((yt=yt==1?{entropy:!0}:yt||{}).entropy?[at,Je(h)]:at??function(){try{var Qt;return d&&(Qt=d.randomBytes)?Qt=Qt(D):(Qt=new Uint8Array(D),(y.crypto||y.msCrypto).getRandomValues(Qt)),Je(Qt)}catch{var cn=y.navigator,vn=cn&&cn.plugins;return[+new Date,y,vn,y.screen,Je(h)]}}(),3),kt),Jt=new Me(kt),on=function(){for(var Qt=Jt.g(z),cn=oe,vn=0;Qt<he;)Qt=(Qt+vn)*D,cn*=D,vn=Jt.g(1);for(;Qt>=xe;)Qt/=2,cn/=2,vn>>>=1;return(Qt+vn)/cn};return on.int32=function(){return 0|Jt.g(4)},on.quick=function(){return Jt.g(4)/4294967296},on.double=on,Ze(Je(Jt.S),h),(yt.pass||xt||function(Qt,cn,vn,p){return p&&(p.S&&We(p,Jt),Qt.state=function(){return We(Jt,{})}),vn?(u[X]=Qt,cn):Qt})(on,It,"global"in yt?yt.global:this==u,yt.state)}function Me(at){var yt,xt=at.length,kt=this,It=0,Jt=kt.i=kt.j=0,on=kt.S=[];for(xt||(at=[xt++]);It<D;)on[It]=It++;for(It=0;It<D;It++)on[It]=on[Jt=Fe&Jt+at[It%xt]+(yt=on[It])],on[Jt]=yt;(kt.g=function(Qt){for(var cn,vn=0,p=kt.i,c=kt.j,o=kt.S;Qt--;)cn=o[p=Fe&p+1],vn=vn*D+o[Fe&(o[p]=o[c=Fe&c+cn])+(o[c]=cn)];return kt.i=p,kt.j=c,vn})(D)}function We(at,yt){return yt.i=at.i,yt.j=at.j,yt.S=at.S.slice(),yt}function Ze(at,yt){for(var xt,kt=at+"",It=0;It<kt.length;)yt[Fe&It]=Fe&(xt^=19*yt[Fe&It])+kt.charCodeAt(It++);return Je(yt)}function Je(at){return String.fromCharCode.apply(0,at)}if(u["seed"+X]=Re,Ze(u.random(),h),v.exports){v.exports=Re;try{d=a(251)}catch{}}})([],Math)});ks.alea=oa,ks.xor128=Ld,ks.xorwow=zd,ks.xorshift7=Ud,ks.xor4096=Rp,ks.tychei=zu;var $c=ks.alea,Is=function(){function v(h,u,d,y,D){this.mean=h,this.stdDev=u,this.dtype=d,this.nextVal=NaN,this.truncated=y,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var z=D||Math.random();this.random=$c(z.toString())}return v.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var h=this.nextVal;return this.nextVal=NaN,h}for(var u,d,y=!1;!y;){var D=void 0,z=void 0,X=void 0;do X=(D=2*this.random()-1)*D+(z=2*this.random()-1)*z;while(X>=1||X===0);var oe=Math.sqrt(-2*Math.log(X)/X);u=this.mean+this.stdDev*D*oe,d=this.mean+this.stdDev*z*oe,this.truncated&&!this.isValidTruncated(u)||(y=!0)}return this.truncated&&!this.isValidTruncated(d)||(this.nextVal=this.convertValue(d)),this.convertValue(u)},v.prototype.convertValue=function(h){return this.dtype==null||this.dtype==="float32"?h:Math.round(h)},v.prototype.isValidTruncated=function(h){return h<=this.upper&&h>=this.lower},v}(),ru=function(){function v(h,u,d,y){this.alpha=h,this.beta=1/u,this.dtype=d;var D=y||Math.random();this.randu=$c(D.toString()),this.randn=new Is(0,1,d,!1,this.randu()),this.d=h<1?h+2/3:h-1/3,this.c=1/Math.sqrt(9*this.d)}return v.prototype.nextValue=function(){for(var h,u,d,y,D,z;;){do y=this.randn.nextValue(),z=1+this.c*y;while(z<=0);if(z*=z*z,u=1-.331*(h=y*y)*h,d=.5*h+this.d*(1-z+Math.log(z)),(D=this.randu())<u||Math.log(D)<d)break}return z=1/this.beta*this.d*z,this.alpha<1&&(z*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(z)},v.prototype.convertValue=function(h){return this.dtype==="float32"?h:Math.round(h)},v}(),Mh=function(){function v(h,u,d,y){var D=this;if(h===void 0&&(h=0),u===void 0&&(u=1),this.canReturnFloat=function(){return D.dtype==null||D.dtype==="float32"},this.min=h,this.range=u-h,this.dtype=d,y==null&&(y=Math.random()),typeof y=="number"&&(y=y.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between "+h+" - "+u+" <= 1 and dtype is not float");this.random=$c(y)}return v.prototype.convertValue=function(h){return this.canReturnFloat()?h:Math.round(h)},v.prototype.nextValue=function(){return this.convertValue(this.min+this.range*this.random())},v}();function Ni(v,h,u){return h===void 0&&(h="float32"),h=h||"float32",$n(v),new Wi(v,h,u)}function Sf(v,h){h===void 0&&(h=!1),console.log(v.toString(h))}var Gc=wt({batchToSpaceND_:function(v,h,u){var d=Ke(v,"x","batchToSpaceND"),y=h.reduce(function(D,z){return D*z});return ke(d.rank>=1+h.length,function(){return"input rank is "+d.rank+" but should be > than blockShape.length "+h.length}),ke(u.length===h.length,function(){return"crops.length is "+u.length+" but should be equal to blockShape.length  "+h.length}),ke(d.shape[0]%y==0,function(){return"input tensor batch is "+d.shape[0]+" but is not divisible by the product of the elements of blockShape "+h.join(" * ")+" === "+y}),Ue.runKernelFunc(function(D){return D.batchToSpaceND(d,h,u)},{$x:d},function(D){return{$x:function(){return D.spaceToBatchND(h,u)}}})}}),Sl=wt({broadcastTo_:function(v,h){var u=Ke(v,"broadcastTo","x"),d=u.shape;if(h.some(function(oe){return!(oe>0)||oe%1!=0}))throw new Error("broadcastTo(): Invalid broadcast shape ["+h+"].");if(h.length<u.rank)throw new Error("broadcastTo(): shape.length="+h.length+" < input.rank="+u.rank+".");if(h.length>u.rank){for(var y=u.shape.slice();y.length<h.length;)y.unshift(1);u=u.reshape(y)}for(var D=Array.from(h),z=h.length-1;z>=0;z--)if(u.shape[z]===h[z])D[z]=1;else if(u.shape[z]!==1)throw new Error("broadcastTo(): ["+d+"] cannot be broadcast to ["+h+"].");var X=D.map(function(oe,he){return oe>1?he:-1}).filter(function(oe){return oe>=0});return X.length===0?u.clone():Ue.runKernelFunc(function(oe){return oe.tile(u,D)},{input:u},function(oe){return{input:function(){return oe.sum(X,!0)}}})}}),Wd=wt({cast_:function(v,h){var u=Ke(v,"x","cast");if(!Qe(h))throw new Error("Failed to cast to unknown dtype "+h);if(h==="string"&&u.dtype!=="string"||h!=="string"&&u.dtype==="string")throw new Error("Only strings can be casted to strings");var d={dtype:h};return Ue.runKernelFunc(function(y){return y.cast(u,h)},{x:u},function(y){return{x:function(){return y.clone()}}},"Cast",d)}}),Mp=wt({clone_:function(v){var h=Ke(v,"x","clone",null);return Ue.runKernelFunc(function(){return Ue.makeTensorFromDataId(h.dataId,h.shape,h.dtype)},{$x:h},function(u){return{$x:function(){return u.toFloat()}}})}}),_l=wt({cumsum_:function(v,h,u,d){h===void 0&&(h=0),u===void 0&&(u=!1),d===void 0&&(d=!1);var y=Ke(v,"x","cumsum"),D=Oa([h|=0],y.rank),z=y;D!=null&&(z=y.transpose(D));var X=Aa(1,y.rank)[0],oe=Ue.runKernelFunc(function(he){return he.cumsum(z,X,u,d)},{permutedX:z},function(he){return{permutedX:function(){return he.cumsum(h,u,!d)}}});return D!=null&&(oe=oe.transpose(D)),oe}}),jh=wt({depthToSpace_:function(v,h,u){u===void 0&&(u="NHWC");var d=Ke(v,"x","depthToSpace"),y=u==="NHWC"?d.shape[1]:d.shape[2],D=u==="NHWC"?d.shape[2]:d.shape[3],z=u==="NHWC"?d.shape[3]:d.shape[1];return ke(y*h>=0,function(){return`Negative dimension size caused by overflow when multiplying
      `+y+" and "+h+`  for depthToSpace with input shape
      `+d.shape}),ke(D*h>=0,function(){return`Negative dimension size caused by overflow when multiplying
      `+D+" and "+h+` for depthToSpace with input shape
          `+d.shape}),ke(z%(h*h)==0,function(){return"Dimension size must be evenly divisible by "+h*h+" but is "+z+" for depthToSpace with input shape "+d.shape}),Ue.runKernelFunc(function(X){return X.depthToSpace(d,h,u)},{$x:d})}}),Lo=wt({expandDims_:function(v,h){h===void 0&&(h=0);var u=Ke(v,"x","expandDims",null);ke(h<=u.rank,function(){return"Axis must be <= rank of the tensor"});var d=u.shape.slice();return h<0&&(ke(-(u.rank+1)<=h,function(){return"Axis must be in the interval ["+-(u.rank+1)+", "+u.rank+"]"}),h=u.rank+h+1),d.splice(h,0,1),ra(u,d)}}),Bh=wt({eye_:function(v,h,u,d){d===void 0&&(d="float32"),h==null&&(h=v);for(var y=Ni([v,h],d),D=v<=h?v:h,z=0;z<D;++z)y.set(1,z,z);var X=y.toTensor().as2D(v,h);if(u==null)return X;if(u.length===1)return Es(Lo(X,0),[u[0],1,1]);if(u.length===2)return Es(Lo(Lo(X,0),0),[u[0],u[1],1,1]);if(u.length===3)return Es(Lo(Lo(Lo(X,0),0),0),[u[0],u[1],u[2],1,1]);throw new Error("eye() currently supports only 1D and 2D batchShapes, but received "+u.length+"D.")}}),Dl=wt({multinomial_:function(v,h,u,d){d===void 0&&(d=!1);var y=Ke(v,"logits","multinomial"),D=y.size,z=y.rank;if(D<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+D+".");if(z>2)throw new Error("Rank of probabilities must be 1 or 2, but is "+z);u=u||Math.random();var X=z===1?y.as2D(1,-1):y,oe=Ue.runKernelFunc(function(he){return he.multinomial(X,d,h,u)},{logits2D:X});return z===1?oe.as1D():oe}}),Ph=wt({oneHot_:function(v,h,u,d){if(u===void 0&&(u=1),d===void 0&&(d=0),h<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+h);var y=Ke(v,"indices","oneHot","int32"),D=y.shape.concat([h]);return y=y.flatten(),Ue.runKernelFunc(function(z){return z.oneHot(y,h,u,d)},{$indices:y},function(z){return{$indices:function(){return Ki(y.shape,"float32")}}}).reshape(D)}}),Tl=wt({pad_:function(v,h,u){u===void 0&&(u=0);var d=Ke(v,"x","pad");if(d.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var y={paddings:h,constantValue:u};return Ue.runKernelFunc(function(D){return D.pad(d,h,u)},{x:d},function(D){var z=h.map(function(X){return X[0]});return{x:function(){return D.slice(z,d.shape)}}},"PadV2",y)}}),Kc=wt({pad1d_:function(v,h,u){return u===void 0&&(u=0),ke(h.length===2,function(){return"Invalid number of paddings. Must be length of 2."}),Tl(v,[h],u)}}),Ec=wt({pad2d_:function(v,h,u){return u===void 0&&(u=0),ke(h.length===2&&h[0].length===2&&h[1].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),Tl(v,h,u)}}),Lh=wt({pad3d_:function(v,h,u){return u===void 0&&(u=0),ke(h.length===3&&h[0].length===2&&h[1].length===2&&h[2].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),Tl(v,h,u)}}),_f=wt({pad4d_:function(v,h,u){return u===void 0&&(u=0),ke(h.length===4&&h[0].length===2&&h[1].length===2&&h[2].length===2&&h[3].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),Tl(v,h,u)}}),Nl=wt({rand_:function(v,h,u){var d=Ye(v),y=null;if(u==null||u==="float32")y=new Float32Array(d);else if(u==="int32")y=new Int32Array(d);else{if(u!=="bool")throw new Error("Unknown data type "+u);y=new Uint8Array(d)}for(var D=0;D<d;D++)y[D]=h();return Ue.makeTensor(y,v,u)}}),Cc=wt({randomNormal_:function(v,h,u,d,y){if(h===void 0&&(h=0),u===void 0&&(u=1),d!=null&&d==="bool")throw new Error("Unsupported data type "+d);for(var D=new Is(h,u,d,!1,y),z=Ni(v,d),X=0;X<z.values.length;X++)z.values[X]=D.nextValue();return z.toTensor()}}),km=wt({randomGamma_:function(v,h,u,d,y){if(u===void 0&&(u=1),d===void 0&&(d="float32"),u==null&&(u=1),d==null&&(d="float32"),d!=="float32"&&d!=="int32")throw new Error("Unsupported data type "+d);for(var D=new ru(h,u,d,y),z=Ni(v,d),X=0;X<z.values.length;X++)z.values[X]=D.nextValue();return z.toTensor()}}),Fl=wt({randomUniform_:function(v,h,u,d,y){h===void 0&&(h=0),u===void 0&&(u=1),d===void 0&&(d="float32");for(var D=Ni(v,d),z=new Mh(h,u,null,y),X=0;X<D.values.length;X++)D.values[X]=z.nextValue();return D.toTensor()}}),ra=wt({reshape_:function(v,h){var u=Ke(v,"x","reshape",null);h=St(h,u.size),ke(u.size===Ye(h),function(){return"new shape and old shape must have the same number of elements."});var d={shape:h};return Ue.runKernelFunc(function(y){return y.reshape(u,h)},{x:u},function(y){return{x:function(){return y.reshape(u.shape)}}},"Reshape",d)}}),Sa=wt({spaceToBatchND_:function(v,h,u){var d=Ke(v,"x","spaceToBatchND");return ke(d.rank>=1+h.length,function(){return"input rank "+d.rank+" should be > than [blockShape] "+h.length}),ke(u.length===h.length,function(){return"paddings.shape[0] "+u.length+" must be equal to [blockShape] "+h.length}),ke(d.shape.reduce(function(y,D,z){return z>0&&z<=h.length?y&&(D+u[z-1][0]+u[z-1][1])%h[z-1]==0:y},!0),function(){return"input spatial dimensions "+d.shape.slice(1)+" with paddings "+u.toString()+" must be divisible by blockShapes "+h.toString()}),Ue.runKernelFunc(function(y){return y.spaceToBatchND(d,h,u)},{$x:d},function(y){return{$x:function(){return y.batchToSpaceND(h,u)}}})}}),Ia=wt({squeeze_:function(v,h){var u=Ke(v,"x","squeeze");return ra(u,Bn(u.shape,h).newShape)}}),Mi=wt({stack_:function(v,h){h===void 0&&(h=0);var u=Lu(v,"tensors","stack");if(ke(u.length>=1,function(){return"Pass at least one tensor to tf.stack"}),u.length===1)return u[0].expandDims(h);var d=u[0].rank,y=u[0].shape,D=u[0].dtype;ke(h<=d,function(){return"Axis must be <= rank of the tensor"}),u.forEach(function(X){Ft(y,X.shape,"All tensors passed to stack must have matching shapes")}),u.forEach(function(X){ke(D===X.dtype,function(){return"All tensors passed to stack must have matching dtypes"})});var z=u.map(function(X){return X.expandDims(h)});return Po(z,h)}}),Es=wt({tile_:function(v,h){var u=Ke(v,"x","tile",null);ke(u.rank===h.length,function(){return"Error in transpose: rank of input "+u.rank+" must match length of reps "+h+"."});var d=[u],y={reps:h};return Ue.runKernelFunc(function(D,z){var X=D.tile(u,h);return z([u]),X},{x:u},function(D,z){var X=z[0];return{x:function(){var oe=ii(X);if(X.rank===1)for(var he=0;he<h[0];++he)oe=oe.add(D.slice([he*X.shape[0]],[X.shape[0]]));else if(X.rank===2)for(he=0;he<h[0];++he)for(var xe=0;xe<h[1];++xe)oe=oe.add(D.slice([he*X.shape[0],xe*X.shape[1]],[X.shape[0],X.shape[1]]));else if(X.rank===3)for(he=0;he<h[0];++he)for(xe=0;xe<h[1];++xe)for(var Fe=0;Fe<h[2];++Fe)oe=oe.add(D.slice([he*X.shape[0],xe*X.shape[1],Fe*X.shape[2]],[X.shape[0],X.shape[1],X.shape[2]]));else{if(X.rank!==4)throw new Error("Gradient for tile operation is not implemented for rank-"+X.rank+" tensors yet.");for(he=0;he<h[0];++he)for(xe=0;xe<h[1];++xe)for(Fe=0;Fe<h[2];++Fe)for(var Re=0;Re<h[3];++Re)oe=oe.add(D.slice([he*X.shape[0],xe*X.shape[1],Fe*X.shape[2],Re*X.shape[3]],[X.shape[0],X.shape[1],X.shape[2],X.shape[3]]))}return oe}}},"Tile",y,d)}}),Oc=wt({truncatedNormal_:function(v,h,u,d,y){if(h===void 0&&(h=0),u===void 0&&(u=1),d!=null&&d==="bool")throw new Error("Unsupported data type "+d);for(var D=new Is(h,u,d,!0,y),z=Ni(v,d),X=0;X<z.values.length;X++)z.values[X]=D.nextValue();return z.toTensor()}}),Ra=wt({unstack_:function(v,h){h===void 0&&(h=0),h=h||0;var u=Ke(v,"x","unstack");ke(h>=-u.shape.length&&h<u.shape.length,function(){return"Axis = "+h+" is not in [-"+u.shape.length+", "+u.shape.length+")"}),h<0&&(h+=u.shape.length);var d={axis:h};return Ue.runKernelFunc(function(y){return y.unstack(u,h)},{x:u},function(y){return{x:function(){return Mi(y,h)}}},"Unpack",d)}}),Ac=function(v,h){return R(this,void 0,void 0,function(){var u,d,y,D,z,X,oe,he,xe,Fe;return W(this,function(Re){switch(Re.label){case 0:return u=Ke(v,"x","setdiff1d"),d=Ke(h,"y","setdiff1d"),ke(u.dtype===d.dtype,function(){return"x and y should have the same dtype, but got x ("+u.dtype+") and y ("+d.dtype+")."}),ke(u.rank===1,function(){return"x should be 1D tensor, but got x ("+u.shape+")."}),ke(d.rank===1,function(){return"y should be 1D tensor, but got y ("+d.shape+")."}),[4,u.data()];case 1:return y=Re.sent(),[4,d.data()];case 2:for(D=Re.sent(),z=new Set(D),X=0,xe=0;xe<y.length;xe++)z.has(y[xe])||X++;for(oe=new Wi([X],u.dtype),he=new Wi([X],"int32"),xe=0,Fe=0;xe<y.length;xe++)z.has(y[xe])||(oe.values[Fe]=y[xe],he.values[Fe]=xe,Fe++);return[2,[oe.toTensor(),he.toTensor()]]}})})};function Uu(v,h,u,d){d===void 0&&(d=!0);var y=[];if(d)(y=y.concat(h.slice(0))).push(v[0]/u),y=y.concat(v.slice(1));else{y=y.concat(v[0]);for(var D=h.length,z=0;z<D;++z)y=y.concat([v[z+1]/h[z],h[z]]);y=y.concat(v.slice(D+1))}return y}function Df(v,h,u){u===void 0&&(u=!0);var d=[];if(u){d.push(h);for(var y=h+1;y<v;++y)y<=2*h?(d.push(y),d.push(y-(h+1))):d.push(y)}else{var D=[],z=[];for(y=1;y<v;++y)y>=2*h+1||y%2==1?z.push(y):D.push(y);d.push.apply(d,D),d.push(0),d.push.apply(d,z)}return d}function Tf(v,h,u,d){d===void 0&&(d=!0);var y=[];d?y.push(v[0]/u):y.push(v[0]*u);for(var D=1;D<v.length;++D)D<=h.length?d?y.push(h[D-1]*v[D]):y.push(v[D]/h[D-1]):y.push(v[D]);return y}function Xc(v,h){for(var u=[0],d=0;d<h;++d)u.push(v[d][0]);return u}function Vd(v,h,u){for(var d=v.slice(0,1),y=0;y<u;++y)d.push(v[y+1]-h[y][0]-h[y][1]);return d}function Wu(v,h){if(v.rank<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher, but the rank was "+v.rank+".");if(h.rank<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher, but the rank was "+h.rank+".");if(h.dtype!=="int32")throw new Error("tf.gatherND() expects the indices to be int32 type, but the dtype was "+h.dtype+".");if(h.shape[h.rank-1]>v.rank)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+h.shape[h.rank-1]+" vs. "+v.rank);if(v.size===0)throw new Error("Requested more than 0 entries, but input is empty. Input shape: "+v.shape+".");for(var u=h.shape,d=u[u.length-1],y=1,D=0;D<u.length-1;++D)y*=u[D];var z=v.shape,X=u.slice();X.pop();var oe=1;for(D=d;D<v.rank;++D)oe*=z[D],X.push(z[D]);var he=pr(v.shape).map(function(xe){return xe/oe}).concat([1]).slice(0,d);return[X,y,oe,he]}var Em=Object.freeze({prepareAndValidate:Wu}),qd=30;function Il(v){return v<=qd?v:Dr(v,Math.floor(Math.sqrt(v)))}function jp(v,h,u){var d=h.rank>1?h.shape[h.rank-1]:1,y=h.rank>1?h.rank-1:1,D="Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: "+u.shape+", indices.shape: "+h.shape+", shape: "+v+", sliceDim: "+d+", and batchDim: "+y+".";if(u.rank<y)throw new Error(D+" update.rank < "+y+". ");if(v.length<d+(u.rank-y))throw new Error(D+" Output shape length < "+(d+(u.rank-y)));if(u.rank!==y+v.length-d)throw new Error(D+" update.rank != "+(y+v.length-d));for(var z=0;z<y;++z)if(u.shape[z]!==h.shape[z])throw new Error(D+" updates.shape["+z+"] ("+u.shape[z]+") != indices.shape["+z+"] ("+h.shape[z]+").");for(z=0;z<u.rank-y;++z)if(u.shape[z+y]!==v[z+d])throw new Error(D+" updates.shape["+(z+y)+"] ("+u.shape[z+y]+") != shape["+(z+y)+"] ("+v[z+y]+")")}function Nf(v,h,u){if(h.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher, but the rank was "+h.rank+".");if(v.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher, but the rank was "+v.rank+".");if(h.dtype!=="int32")throw new Error("The dtype of 'indices' should be int32, but got dtype: "+h.dtype);if(u.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: "+u);if(u.length===0){if(h.size===0)throw new Error("Indices specified for empty output. indices shape: "+h.shape);if(v.size===0)throw new Error("Updates specified for empty output. updates shape: "+v.shape)}jp(u,h,v)}function Yc(v,h,u){for(var d=h.shape.length,y=d>1?h.shape[d-1]:1,D=u.length,z=1,X=y;X<D;++X)z*=u[X];var oe=y<1?1:y;return{sliceRank:y,numUpdates:Ye(h.shape)/oe,sliceSize:z,strides:pr(u.slice(0,y)).concat([1]),outputSize:Ye(u)}}var Hd=Object.freeze({validateUpdateShape:jp,validateInput:Nf,calculateShapes:Yc});function zh(v,h,u){ke(v.rank===h.length,function(){return"Error in slice"+v.rank+"D: Length of begin "+h+" must match the rank of the array ("+v.rank+")."}),ke(v.rank===u.length,function(){return"Error in slice"+v.rank+"D: Length of size "+u+" must match the rank of the array ("+v.rank+")."});for(var d=function(D){ke(h[D]+u[D]<=v.shape[D],function(){return"Error in slice"+v.rank+"D: begin["+D+"] + size["+D+"] ("+(h[D]+u[D])+") would overflow input.shape["+D+"] ("+v.shape[D]+")"})},y=0;y<v.rank;++y)d(y)}function ba(v){for(var h=[],u=0;v>0;)1&v&&h.push(u),v/=2,u++;return h}function Rl(v,h,u){for(var d=[],y=0;y<v.length;y++)d[y]=Math.ceil((h[y]-v[y])/u[y]);return d}function Cs(v,h,u,d,y){var D=h[y],z=u[y]||1;(v&1<<y||D==null)&&(D=z>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);var X=d[y];return D<0&&(D+=X),_t(0,D,X-1)}function Ml(v,h,u,d,y){var D=h[y],z=u[y]||1;(v&1<<y||D==null)&&(D=z>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);var X=d[y];return D<0&&(D+=X),z>0?_t(0,D,X):_t(-1,D,X-1)}function Ff(v,h,u){for(var d=u.length,y=0;y<u.length;y++)if(u[y]>1){d=y;break}for(y=d+1;y<u.length;y++)if(h[y]>0||u[y]!==v[y])return!1;return!0}function Uh(v,h){for(var u=v.length>0?v[v.length-1]:1,d=0;d<v.length-1;d++)u+=v[d]*h[d];return u}var $d=Object.freeze({assertParamsValid:zh,maskToAxes:ba,computeOutShape:Rl,startForAxis:Cs,stopForAxis:Ml,isSliceContinous:Ff,computeFlatOffset:Uh});function If(v){return ke(Yn(v),function(){return"The f passed in grad(f) must be a function"}),function(h,u){var d=Ke(h,"x","tf.grad",null),y=u!=null?Ke(u,"dy","tf.grad"):null;return Ue.tidy(function(){var D=Ue.gradients(function(){return v(d)},[d],y),z=D.value,X=D.grads;return y!=null&&Ft(z.shape,y.shape,"The shape of dy passed in grad(f)(x, dy) must match the shape returned by f(x)"),Un(X),X[0]})}}function jl(v){return ke(Yn(v),function(){return"The f passed in grads(f) must be a function"}),function(h,u){ke(Array.isArray(h),function(){return"The args passed in grads(f)(args) must be an array of `Tensor`s or `TensorLike`s"});var d=Lu(h,"args","tf.grads",null),y=u!=null?Ke(u,"dy","tf.grads"):null;return Ue.tidy(function(){var D=Ue.gradients(function(){return v.apply(void 0,d)},d,y),z=D.value,X=D.grads;return y!=null&&Ft(z.shape,y.shape,"The shape of dy passed in grads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),Un(X),X})}}function Gd(v){return ke(Yn(v),function(){return"The f passed in valueAndGrad(f) must be a function"}),function(h,u){ke(h instanceof Mt,function(){return"The x passed in valueAndGrad(f)(x) must be a tensor"}),ke(u==null||u instanceof Mt,function(){return"The dy passed in valueAndGrad(f)(x, dy) must be a tensor"});var d=Ue.gradients(function(){return v(h)},[h],u),y=d.grads,D=d.value;return Un(y),{grad:y[0],value:D}}}function Kd(v){return ke(Yn(v),function(){return"The f passed in valueAndGrads(f) must be a function"}),function(h,u){ke(Array.isArray(h)&&h.every(function(y){return y instanceof Mt}),function(){return"The args passed in valueAndGrads(f)(args) must be array of tensors"}),ke(u==null||u instanceof Mt,function(){return"The dy passed in valueAndGrads(f)(args, dy) must be a tensor"});var d=Ue.gradients(function(){return v.apply(void 0,h)},h,u);return u!=null&&Ft(d.value.shape,u.shape,"The shape of dy passed in valueAndGrads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),Un(d.grads),d}}function tn(v,h){ke(Yn(v),function(){return"The f passed in variableGrads(f) must be a function"}),ke(h==null||Array.isArray(h)&&h.every(function(xe){return xe instanceof gt}),function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"});var u=h!=null;if(!u)for(var d in h=[],Ue.registeredVariables)h.push(Ue.registeredVariables[d]);var y=u?h.filter(function(xe){return!xe.trainable}):null,D=h.length;ke((h=h.filter(function(xe){return xe.trainable})).length>0,function(){return"variableGrads() expects at least one of the input variables to be trainable, but none of the "+D+" variables is trainable."});var z=Ue.gradients(v,h,null,!0),X=z.value,oe=z.grads;ke(oe.some(function(xe){return xe!=null}),function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."}),ke(X.rank===0,function(){return"The f passed in variableGrads(f) must return a scalar, but it returned a rank-"+X.rank+" tensor"});var he={};return h.forEach(function(xe,Fe){oe[Fe]!=null&&(he[xe.name]=oe[Fe])}),y!=null&&y.forEach(function(xe){return he[xe.name]=null}),{value:X,grads:he}}function Vs(v){return Ue.customGrad(v)}function Un(v){if(v.filter(function(h){return h==null}).length>0)throw new Error(`Cannot compute gradient of y=f(x) with respect to x. Make sure that
    the f you passed encloses all operations that lead from x to y.`)}var Os=wt({softmax_:function(v,h){h===void 0&&(h=-1);var u=Ke(v,"logits","softmax","float32");if(h===-1&&(h=u.rank-1),h!==u.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank "+u.rank+" and dim was "+h);return Ue.runKernelFunc(function(d,y){var D=d.softmax(u,h);return y([D]),D},{logits:u},function(d,y){var D=y[0],z=d.mul(D);return{logits:function(){return z.sub(z.sum([h],!0).mul(D))}}},"Softmax",{dim:h},[],[!0])}}),io=wt({logSoftmax_:function(v,h){h===void 0&&(h=-1);var u=Ke(v,"logits","logSoftmax");if(h===-1&&(h=u.rank-1),h!==u.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. Logits was rank "+u.rank+" and axis was "+h);return Vs(function(d,y){var D=d.max(h,!0),z=d.sub(D),X=z.toFloat().sub(z.exp().sum(h,!0).log());return y([X]),{value:X,gradFunc:function(oe,he){var xe=he[0].exp();return oe.sub(oe.sum(h,!0).mul(xe))}}})(u)}}),Bl=function(){function v(h,u){this.backend=h,this.dataMover=u,this.data=new WeakMap,this.dataIdsCount=0}return v.prototype.get=function(h){return this.data.has(h)||this.dataMover.moveData(this.backend,h),this.data.get(h)},v.prototype.set=function(h,u){this.dataIdsCount++,this.data.set(h,u)},v.prototype.has=function(h){return this.data.has(h)},v.prototype.delete=function(h){return this.dataIdsCount--,this.data.delete(h)},v.prototype.numDataIds=function(){return this.dataIdsCount},v}(),Rf=function(){function v(){}return v.prototype.time=function(h){return nr("time")},v.prototype.read=function(h){return nr("read")},v.prototype.readSync=function(h){return nr("readSync")},v.prototype.numDataIds=function(){return nr("numDataIds")},v.prototype.disposeData=function(h){return nr("disposeData")},v.prototype.write=function(h,u,d){return nr("write")},v.prototype.move=function(h,u,d,y){return nr("move")},v.prototype.memory=function(){return nr("memory")},v.prototype.floatPrecision=function(){return nr("floatPrecision")},v.prototype.epsilon=function(){return this.floatPrecision()===32?1e-7:1e-4},v.prototype.batchMatMul=function(h,u,d,y){return nr("batchMatMul")},v.prototype.fusedBatchMatMul=function(h){return h.a,h.b,h.transposeA,h.transposeB,h.bias,h.activation,h.preluActivationWeights,nr("fusedBatchMatMul")},v.prototype.slice=function(h,u,d){return nr("slice")},v.prototype.stridedSlice=function(h,u,d,y){return nr("stridedSlice")},v.prototype.unstack=function(h,u){return nr("unstack")},v.prototype.reverse=function(h,u){return nr("reverse")},v.prototype.concat=function(h,u){return nr("concat")},v.prototype.neg=function(h){return nr("neg")},v.prototype.add=function(h,u){return nr("add")},v.prototype.addN=function(h){return nr("addN")},v.prototype.subtract=function(h,u){return nr("subtract")},v.prototype.multiply=function(h,u){return nr("multiply")},v.prototype.realDivide=function(h,u){return nr("realDivide")},v.prototype.floorDiv=function(h,u){return nr("floorDiv")},v.prototype.sum=function(h,u){return nr("sum")},v.prototype.prod=function(h,u){return nr("prod")},v.prototype.unsortedSegmentSum=function(h,u,d){return nr("unsortedSegmentSum")},v.prototype.argMin=function(h,u){return nr("argMin")},v.prototype.argMax=function(h,u){return nr("argMax")},v.prototype.equal=function(h,u){return nr("equal")},v.prototype.notEqual=function(h,u){return nr("notEqual")},v.prototype.less=function(h,u){return nr("less")},v.prototype.lessEqual=function(h,u){return nr("lessEqual")},v.prototype.greater=function(h,u){return nr("greater")},v.prototype.greaterEqual=function(h,u){return nr("greaterEqual")},v.prototype.logicalNot=function(h){return nr("logicalNot")},v.prototype.logicalAnd=function(h,u){return nr("logicalAnd")},v.prototype.logicalOr=function(h,u){return nr("logicalOr")},v.prototype.where=function(h){return nr("where")},v.prototype.select=function(h,u,d){return nr("select")},v.prototype.topk=function(h,u,d){return nr("topk")},v.prototype.min=function(h,u){return nr("min")},v.prototype.minimum=function(h,u){return nr("minimum")},v.prototype.mod=function(h,u){return nr("mod")},v.prototype.max=function(h,u){return nr("max")},v.prototype.maximum=function(h,u){return nr("maximum")},v.prototype.all=function(h,u){return nr("all")},v.prototype.any=function(h,u){return nr("any")},v.prototype.squaredDifference=function(h,u){return nr("squaredDifference")},v.prototype.ceil=function(h){return nr("ceil")},v.prototype.floor=function(h){return nr("floor")},v.prototype.round=function(h){return nr("round")},v.prototype.sign=function(h){return nr("sign")},v.prototype.isNaN=function(h){return nr("isNaN")},v.prototype.isInf=function(h){return nr("isInf")},v.prototype.isFinite=function(h){return nr("isFinite")},v.prototype.pow=function(h,u){return nr("pow")},v.prototype.exp=function(h){return nr("exp")},v.prototype.expm1=function(h){return nr("expm1")},v.prototype.softmax=function(h,u){return nr("softmax")},v.prototype.log=function(h){return nr("log")},v.prototype.log1p=function(h){return nr("log1p")},v.prototype.sqrt=function(h){return nr("sqrt")},v.prototype.rsqrt=function(h){return nr("rsqrt")},v.prototype.square=function(h){return nr("square")},v.prototype.reciprocal=function(h){return nr("reciprocal")},v.prototype.relu=function(h){return nr("relu")},v.prototype.relu6=function(h){return nr("relu6")},v.prototype.prelu=function(h,u){return nr("prelu")},v.prototype.elu=function(h){return nr("elu")},v.prototype.eluDer=function(h,u){return nr("eluDer")},v.prototype.selu=function(h){return nr("selu")},v.prototype.int=function(h){return nr("int")},v.prototype.clip=function(h,u,d){return nr("clip")},v.prototype.abs=function(h){return nr("abs")},v.prototype.complexAbs=function(h){return nr("complexAbs")},v.prototype.sigmoid=function(h){return nr("sigmoid")},v.prototype.softplus=function(h){return nr("softplus")},v.prototype.sin=function(h){return nr("sin")},v.prototype.cos=function(h){return nr("cos")},v.prototype.tan=function(h){return nr("tan")},v.prototype.asin=function(h){return nr("asin")},v.prototype.acos=function(h){return nr("acos")},v.prototype.atan=function(h){return nr("atan")},v.prototype.atan2=function(h,u){return nr("atan2")},v.prototype.sinh=function(h){return nr("sinh")},v.prototype.cosh=function(h){return nr("cosh")},v.prototype.tanh=function(h){return nr("tanh")},v.prototype.asinh=function(h){return nr("asinh")},v.prototype.acosh=function(h){return nr("acosh")},v.prototype.atanh=function(h){return nr("atanh")},v.prototype.erf=function(h){return nr("erf")},v.prototype.step=function(h,u){return nr("step")},v.prototype.fusedConv2d=function(h){return h.input,h.filter,h.convInfo,h.bias,h.activation,h.preluActivationWeights,nr("fusedConv2d")},v.prototype.conv2d=function(h,u,d){return nr("conv2d")},v.prototype.conv2dDerInput=function(h,u,d){return nr("conv2dDerInput")},v.prototype.conv2dDerFilter=function(h,u,d){return nr("conv2dDerFilter")},v.prototype.fusedDepthwiseConv2D=function(h){return h.input,h.filter,h.convInfo,h.bias,h.activation,h.preluActivationWeights,nr("fusedDepthwiseConv2D")},v.prototype.depthwiseConv2D=function(h,u,d){return nr("depthwiseConv2D")},v.prototype.depthwiseConv2DDerInput=function(h,u,d){return nr("depthwiseConv2DDerInput")},v.prototype.depthwiseConv2DDerFilter=function(h,u,d){return nr("depthwiseConv2DDerFilter")},v.prototype.conv3d=function(h,u,d){return nr("conv3d")},v.prototype.conv3dDerInput=function(h,u,d){return nr("conv3dDerInput")},v.prototype.conv3dDerFilter=function(h,u,d){return nr("conv3dDerFilter")},v.prototype.maxPool=function(h,u){return nr("maxPool")},v.prototype.maxPoolBackprop=function(h,u,d,y){return nr("maxPoolBackprop")},v.prototype.avgPool=function(h,u){return nr("avgPool")},v.prototype.avgPoolBackprop=function(h,u,d){return nr("avgPoolBackprop")},v.prototype.avgPool3d=function(h,u){return nr("avgPool3d")},v.prototype.avgPool3dBackprop=function(h,u,d){return nr("avgPool3dBackprop")},v.prototype.maxPool3d=function(h,u){return nr("maxPool3d")},v.prototype.maxPool3dBackprop=function(h,u,d,y){return nr("maxPool3dBackprop")},v.prototype.reshape=function(h,u){return nr("reshape")},v.prototype.cast=function(h,u){return nr("cast")},v.prototype.tile=function(h,u){return nr("tile")},v.prototype.pad=function(h,u,d){return nr("pad")},v.prototype.transpose=function(h,u){return nr("transpose")},v.prototype.gather=function(h,u,d){return nr("gather")},v.prototype.gatherND=function(h,u){return nr("gatherND")},v.prototype.scatterND=function(h,u,d){return nr("scatterND")},v.prototype.batchToSpaceND=function(h,u,d){return nr("batchToSpaceND")},v.prototype.spaceToBatchND=function(h,u,d){return nr("spaceToBatchND")},v.prototype.resizeBilinear=function(h,u,d,y){return nr("resizeBilinear")},v.prototype.resizeBilinearBackprop=function(h,u,d){return nr("resizeBilinearBackprop")},v.prototype.resizeNearestNeighbor=function(h,u,d,y){return nr("resizeNearestNeighbor")},v.prototype.resizeNearestNeighborBackprop=function(h,u,d){return nr("resizeNearestNeighborBackprop")},v.prototype.batchNormalization=function(h,u,d,y,D,z){return nr("batchNormalization")},v.prototype.localResponseNormalization4D=function(h,u,d,y,D){return nr("localResponseNormalization4D")},v.prototype.LRNGrad=function(h,u,d,y,D,z,X){return nr("LRNGrad")},v.prototype.multinomial=function(h,u,d,y){return nr("multinomial")},v.prototype.oneHot=function(h,u,d,y){return nr("oneHot")},v.prototype.cumsum=function(h,u,d,y){return nr("cumsum")},v.prototype.nonMaxSuppression=function(h,u,d,y,D){return nr("nonMaxSuppression")},v.prototype.fft=function(h){return nr("fft")},v.prototype.ifft=function(h){return nr("ifft")},v.prototype.complex=function(h,u){return nr("complex")},v.prototype.real=function(h){return nr("real")},v.prototype.imag=function(h){return nr("imag")},v.prototype.cropAndResize=function(h,u,d,y,D,z){return nr("cropAndResize")},v.prototype.depthToSpace=function(h,u,d){return nr("depthToSpace")},v.prototype.split=function(h,u,d){return nr("split")},v.prototype.sparseToDense=function(h,u,d,y){return nr("sparseToDense")},v.prototype.diag=function(h){return nr("diag")},v.prototype.fill=function(h,u,d){return nr("fill")},v.prototype.onesLike=function(h){return nr("onesLike")},v.prototype.zerosLike=function(h){return nr("zerosLike")},v.prototype.linspace=function(h,u,d){return nr("linspace")},v.prototype.dispose=function(){return nr("dispose")},v}();function nr(v){throw new Error("'"+v+"' not yet implemented or not found in the registry. Did you forget to import the kernel?")}function $a(v,h){for(var u=v.length,d=[],y=0;y<u;y++){var D=u-1-y,z=v[D]||1;(h[h.length-1-y]||1)>1&&z===1&&d.unshift(D)}return d}function xa(v,h){for(var u=[],d=0;d<h.length;d++){var y=v[v.length-d-1],D=h.length-d-1,z=h[D];(y==null||y===1&&z>1)&&u.unshift(D)}return u}function Hi(v,h){for(var u=[],d=Math.max(v.length,h.length),y=0;y<d;y++){var D=v[v.length-y-1];D==null&&(D=1);var z=h[h.length-y-1];if(z==null&&(z=1),D===1)u.unshift(z);else if(z===1)u.unshift(D);else{if(D!==z)throw Error("Operands could not be broadcast together with shapes "+v+" and "+h+".");u.unshift(D)}}return u}function ku(v,h,u,d,y,D,z){z===void 0&&(z="channelsLast");var X,oe=Vu(h),he=oe[0],xe=oe[1];if(z==="channelsLast")X=[he,xe,v[3],v[3]];else{if(z!=="channelsFirst")throw new Error("Unknown dataFormat "+z);X=[he,xe,v[1],v[1]]}return qs(v,X,u,d,y,D,!1,z)}function ac(v,h,u,d,y,D,z){z===void 0&&(z="NDHWC");var X,oe,he=Hs(h),xe=he[0],Fe=he[1],Re=he[2];if(z==="NDHWC")oe="channelsLast",X=[xe,Fe,Re,v[4],v[4]];else{if(z!=="NCDHW")throw new Error("Unknown dataFormat "+z);oe="channelsFirst",X=[xe,Fe,Re,v[1],v[1]]}return sc(v,X,u,d,y,!1,oe,D)}function qs(v,h,u,d,y,D,z,X){z===void 0&&(z=!1),X===void 0&&(X="channelsLast");var oe=[-1,-1,-1,-1],he=oe[0],xe=oe[1],Fe=oe[2],Re=oe[3];if(X==="channelsLast")he=v[0],xe=v[1],Fe=v[2],Re=v[3];else{if(X!=="channelsFirst")throw new Error("Unknown dataFormat "+X);he=v[0],Re=v[1],xe=v[2],Fe=v[3]}var Me,We=h[0],Ze=h[1],Je=h[3],at=Vu(u),yt=at[0],xt=at[1],kt=Vu(d),It=kt[0],Jt=kt[1],on=so(We,It),Qt=so(Ze,Jt),cn=function(l,g,S,j,V,ne,ae,me){var Ee,Se,Ne;if(typeof l=="number"){Ee={top:l,bottom:l,left:l,right:l,type:l===0?"VALID":"NUMBER"};var ze=function(vt,Ct,Vt,Yt,qt){Yt==null&&(Yt=Xo(vt,Ct,Vt));var $t=vt[1],yn=cs((vt[0]-Ct+2*Yt)/Vt+1,qt);ke(nn(yn),function(){return"The output # of rows ("+yn+") must be an integer. Change the stride and/or zero pad parameters"});var On=cs(($t-Ct+2*Yt)/Vt+1,qt);return ke(nn(On),function(){return"The output # of columns ("+On+") must be an integer. Change the stride and/or zero pad parameters"}),[yn,On]}([g,S],ne,j,l,me);Se=ze[0],Ne=ze[1]}else if(l==="same"){Se=Math.ceil(g/j),Ne=Math.ceil(S/V);var $e=Math.max(0,(Se-1)*j+ne-g),qe=Math.max(0,(Ne-1)*V+ae-S),tt=Math.floor($e/2),lt=$e-tt,ht=Math.floor(qe/2);Ee={top:tt,bottom:lt,left:ht,right:qe-ht,type:"SAME"}}else{if(l!=="valid")throw Error("Unknown padding parameter: "+l);Ee={top:0,bottom:0,left:0,right:0,type:"VALID"},Se=Math.ceil((g-ne+1)/j),Ne=Math.ceil((S-ae+1)/V)}return{padInfo:Ee,outHeight:Se,outWidth:Ne}}(y,xe,Fe,yt,xt,on,Qt,D),vn=cn.padInfo,p=cn.outHeight,c=cn.outWidth,o=z?Je*Re:Je;return X==="channelsFirst"?Me=[he,o,p,c]:X==="channelsLast"&&(Me=[he,p,c,o]),{batchSize:he,dataFormat:X,inHeight:xe,inWidth:Fe,inChannels:Re,outHeight:p,outWidth:c,outChannels:o,padInfo:vn,strideHeight:yt,strideWidth:xt,filterHeight:We,filterWidth:Ze,effectiveFilterHeight:on,effectiveFilterWidth:Qt,dilationHeight:It,dilationWidth:Jt,inShape:v,outShape:Me,filterShape:h}}function sc(v,h,u,d,y,D,z,X){D===void 0&&(D=!1),z===void 0&&(z="channelsLast");var oe=[-1,-1,-1,-1,-1],he=oe[0],xe=oe[1],Fe=oe[2],Re=oe[3],Me=oe[4];if(z==="channelsLast")he=v[0],xe=v[1],Fe=v[2],Re=v[3],Me=v[4];else{if(z!=="channelsFirst")throw new Error("Unknown dataFormat "+z);he=v[0],Me=v[1],xe=v[2],Fe=v[3],Re=v[4]}var We,Ze=h[0],Je=h[1],at=h[2],yt=h[4],xt=Hs(u),kt=xt[0],It=xt[1],Jt=xt[2],on=Hs(d),Qt=on[0],cn=on[1],vn=on[2],p=so(Ze,Qt),c=so(Je,cn),o=so(at,vn),l=function(ae,me,Ee,Se,Ne,ze,$e,qe,tt,lt,ht){var vt,Ct,Vt,Yt;if(typeof ae=="number"){vt={top:ae,bottom:ae,left:ae,right:ae,front:ae,back:ae,type:ae===0?"VALID":"NUMBER"};var qt=function(ur,or,Er,kr,Ur,Zr){Ur==null&&(Ur=Xo(ur,or,kr));var mi=ur[1],co=ur[2],lo=cs((ur[0]-or+2*Ur)/kr+1,Zr);ke(nn(lo),function(){return"The output # of depths ("+lo+") must be an integer. Change the stride and/or zero pad parameters"});var Eo=cs((mi-or+2*Ur)/kr+1,Zr);ke(nn(Eo),function(){return"The output # of rows ("+Eo+") must be an integer. Change the stride and/or zero pad parameters"});var wo=cs((co-or+2*Ur)/kr+1,Zr);return ke(nn(wo),function(){return"The output # of columns ("+wo+") must be an integer. Change the stride and/or zero pad parameters"}),[lo,Eo,wo,1]}([me,Ee,Se,1],qe,0,Ne,ae,ht);Ct=qt[0],Vt=qt[1],Yt=qt[2]}else if(ae==="same"){var $t=((Ct=Math.ceil(me/Ne))-1)*Ne+qe-me,yn=((Vt=Math.ceil(Ee/ze))-1)*ze+tt-Ee,On=((Yt=Math.ceil(Se/$e))-1)*$e+lt-Se,Cn=Math.floor($t/2),Xn=$t-Cn,er=Math.floor(yn/2),sr=yn-er,lr=Math.floor(On/2);vt={top:er,bottom:sr,left:lr,right:On-lr,front:Cn,back:Xn,type:"SAME"}}else{if(ae!=="valid")throw Error("Unknown padding parameter: "+ae);vt={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},Ct=Math.ceil((me-qe+1)/Ne),Vt=Math.ceil((Ee-tt+1)/ze),Yt=Math.ceil((Se-lt+1)/$e)}return{padInfo:vt,outDepth:Ct,outHeight:Vt,outWidth:Yt}}(y,xe,Fe,Re,kt,It,Jt,p,c,o,X),g=l.padInfo,S=l.outDepth,j=l.outHeight,V=l.outWidth,ne=D?yt*Me:yt;return z==="channelsFirst"?We=[he,ne,S,j,V]:z==="channelsLast"&&(We=[he,S,j,V,ne]),{batchSize:he,dataFormat:z,inDepth:xe,inHeight:Fe,inWidth:Re,inChannels:Me,outDepth:S,outHeight:j,outWidth:V,outChannels:ne,padInfo:g,strideDepth:kt,strideHeight:It,strideWidth:Jt,filterDepth:Ze,filterHeight:Je,filterWidth:at,effectiveFilterDepth:p,effectiveFilterHeight:c,effectiveFilterWidth:o,dilationDepth:Qt,dilationHeight:cn,dilationWidth:vn,inShape:v,outShape:We,filterShape:h}}function Xo(v,h,u,d){d===void 0&&(d=1);var y=so(h,d);return Math.floor((v[0]*(u-1)-u+y)/2)}function Vu(v){return typeof v=="number"?[v,v,v]:v.length===2?[v[0],v[1],1]:v}function Hs(v){return typeof v=="number"?[v,v,v]:v}function so(v,h){return h<=1?v:v+(v-1)*(h-1)}function cs(v,h){if(!h)return v;switch(h){case"round":return Math.round(v);case"ceil":return Math.ceil(v);case"floor":return Math.floor(v);default:throw new Error("Unknown roundingMode "+h)}}function _a(v){var h=Vu(v),u=h[0],d=h[1],y=h[2];return u===1&&d===1&&y===1}function ls(v,h){return _a(v)||_a(h)}function Yo(v){if(v==="NHWC")return"channelsLast";if(v==="NCHW")return"channelsFirst";throw new Error("Unknown dataFormat "+v)}function $s(v,h,u){if(h==="complex64"){if(v.dtype==="complex64")return v.clone();var d=Ki(v.shape),y=v.toFloat(),D=u.complex(y,d);return d.dispose(),y.dispose(),D}if(!He(v.dtype,h))return Ue.makeTensorFromDataId(v.dataId,v.shape,h);if(v.dtype==="complex64"){var z=u.real(v);return D=z.cast(h),z.dispose(),D}if(h==="int32")return u.int(v);if(h==="bool"){var X=fr(0,v.dtype);return D=u.notEqual(v,X),X.dispose(),D}throw new Error("Error in Cast: failed to cast "+v.dtype+" to "+h)}function Eu(v,h){return Ue.makeTensorFromDataId(v.dataId,h,v.dtype)}function qu(v,h,u){var d=(h-v)/(u-1),y=Kt(u,"float32");y[0]=v;for(var D=1;D<y.length;D++)y[D]=y[D-1]+d;return Us(y,"float32")}var uc=Object.freeze({castTensor:$s,reshapeTensor:Eu,linspaceImpl:qu,upcastType:fn,axesAreInnerMostDims:Af,combineLocations:Md,computeOutAndReduceShapes:So,expandShapeToKeepDim:_o,assertAxesAreInnerMostDims:Ko,getAxesPermutation:Oa,getUndoAxesPermutation:wu,getInnerMostAxes:Aa,getBroadcastDims:$a,getReductionAxes:xa,assertAndGetBroadcastShape:Hi,assertParamsConsistent:kc,computeOutShape:tu,computePool2DInfo:ku,computePool3DInfo:ac,computeConv2DInfo:qs,computeConv3DInfo:sc,computeDefaultPad:Xo,tupleValuesAreOne:_a,eitherStridesOrDilationsAreOne:ls,convertConv2DDataFormat:Yo,PARALLELIZE_THRESHOLD:qd,computeOptimalWindowSize:Il});function Cu(v,h){if(v.length!==h.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+v.length+", imag: "+h.length+".");for(var u=new Float32Array(2*v.length),d=0;d<u.length;d+=2)u[d]=v[d/2],u[d+1]=h[d/2];return u}function Jc(v,h){return{real:v[2*h],imag:v[2*h+1]}}function Qc(v,h,u,d){v[2*d]=h,v[2*d+1]=u}function Wh(v,h,u){var d=(u?2:-2)*Math.PI*(v/h);return{real:Math.cos(d),imag:Math.sin(d)}}function Zc(v,h,u){var d=function(D,z,X){return function(oe,he,xe){for(var Fe=0,Re=oe.length,Me=0,We=!1;Fe<Re;){var Ze=xe(he,oe[Me=Fe+(Re-Fe>>>1)]);Ze>0?Fe=Me+1:(Re=Me,We=!Ze)}return We?Fe:-Fe-1}(D,z,X||Gs)}(v,h,u),y=d<0?-(d+1):d;v.splice(y,0,h)}function Gs(v,h){return v>h?1:v<h?-1:0}function Ou(v,h,u,d,y){return iu(v,h,u,d,y,0).selectedIndices}function Au(v,h,u,d,y,D){var z=iu(v,h,u,d,y,D);return z.numValidOutputs.dispose(),{selectedIndices:z.selectedIndices,selectedScores:z.selectedScores}}function iu(v,h,u,d,y,D,z,X){X===void 0&&(X=!1);for(var oe=Array.from(h).map(function(kt,It){return{score:kt,boxIndex:It,suppressBeginIndex:0}}).filter(function(kt){return kt.score>y}).sort(jf),he=D>0?-.5/D:0,xe=[],Fe=[];xe.length<u&&oe.length>0;){var Re=oe.pop(),Me=Re.score,We=Re.boxIndex,Ze=Re.suppressBeginIndex;if(Me<y)break;for(var Je=!1,at=xe.length-1;at>=Ze;--at){var yt=Vh(v,We,xe[at]);if(yt>=d){Je=!0;break}if(Re.score=Re.score*Mf(d,he,yt),Re.score<=y)break}Re.suppressBeginIndex=xe.length,Je||(Re.score===Me?(xe.push(We),Fe.push(Re.score)):Re.score>y&&Zc(oe,Re,jf))}var xt=xe.length;return X&&(xe.fill(0,xt),Fe.fill(0,xt)),{selectedIndices:Us(xe,"int32"),selectedScores:Us(Fe,"float32"),numValidOutputs:fr(xt,"int32")}}function Vh(v,h,u){var d=v.subarray(4*h,4*h+4),y=v.subarray(4*u,4*u+4),D=Math.min(d[0],d[2]),z=Math.min(d[1],d[3]),X=Math.max(d[0],d[2]),oe=Math.max(d[1],d[3]),he=Math.min(y[0],y[2]),xe=Math.min(y[1],y[3]),Fe=Math.max(y[0],y[2]),Re=Math.max(y[1],y[3]),Me=(X-D)*(oe-z),We=(Fe-he)*(Re-xe);if(Me<=0||We<=0)return 0;var Ze=Math.max(D,he),Je=Math.max(z,xe),at=Math.min(X,Fe),yt=Math.min(oe,Re),xt=Math.max(at-Ze,0)*Math.max(yt-Je,0);return xt/(Me+We-xt)}function Mf(v,h,u){var d=Math.exp(h*u*u);return u<=v?d:0}function jf(v,h){return v.score-h.score||v.score===h.score&&h.boxIndex-v.boxIndex}function Pl(v,h,u){var d=new Array(v.rank).fill(0),y=v.shape.slice();return h.map(function(D){y[u]=D;var z=v.slice(d,y);return d[u]+=D,z})}function Bf(v,h){for(var u=new Array(v.rank),d=0;d<u.length;d++)u[d]=v.shape[d]*h[d];var y=Ni(u,v.dtype);for(d=0;d<y.values.length;++d){for(var D=y.indexToLoc(d),z=new Array(v.rank),X=0;X<z.length;X++)z[X]=D[X]%v.shape[X];var oe=v.locToIndex(z);y.values[d]=v.values[oe]}return y.toTensor()}function Q(v,h,u,d,y){for(var D=h[h.length-1],z=[v.length/D,D],X=z[0],oe=z[1],he=Hn(u,X*d),xe=Hn("int32",X*d),Fe=0;Fe<X;Fe++){for(var Re=Fe*oe,Me=v.subarray(Re,Re+oe),We=[],Ze=0;Ze<Me.length;Ze++)We.push({value:Me[Ze],index:Ze});We.sort(function(kt,It){return It.value-kt.value});var Je=Fe*d,at=he.subarray(Je,Je+d),yt=xe.subarray(Je,Je+d);for(Ze=0;Ze<d;Ze++)at[Ze]=We[Ze].value,yt[Ze]=We[Ze].index}var xt=h.slice();return xt[xt.length-1]=d,[ko(he,xt,u),ko(xe,xt,"int32")]}function G(v,h){for(var u=[],d=0;d<h.length;d++)h[d]&&u.push(d);var y=Ni(v,"int32"),D=Ni([u.length,v.length],"int32");for(d=0;d<u.length;d++){var z=y.indexToLoc(u[d]),X=d*v.length;D.values.set(z,X)}return D.toTensor()}function C(v,h){return["x","y","z","w","u","v"].slice(0,h).map(function(u){return v+"."+u})}function N(v,h){return h===1?[v]:C(v,h)}function te(){var v,h,u,d,y,D,z,X,oe,he;return P().getNumber("WEBGL_VERSION")===2?(v="#version 300 es",h="in",u="out",d="in",y="texture",D="outputColor",z="out vec4 outputColor;",X=`
      bool isnan_custom(float val) {
        return (val > 0.0 || val < 0.0) ? false : val != 0.0;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `,oe="",he=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(v="",h="attribute",u="varying",d="varying",y="texture2D",D="gl_FragColor",z="",X=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,oe=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,he=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:v,attribute:h,varyingVs:u,varyingFs:d,texture2D:y,output:D,defineOutput:z,defineSpecialNaN:X,defineSpecialInf:oe,defineRound:he}}function Be(v,h,u){u===void 0&&(u="index");var d=pr(h);return d.map(function(y,D){return"int "+v[D]+" = "+u+" / "+y+"; "+(D===d.length-1?"int "+v[D+1]+" = "+u+" - "+v[D]+" * "+y:"index -= "+v[D]+" * "+y)+";"}).join("")}function Ge(v){var h=pr(v).map(function(u){return u.toString()});return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * `+h[0]+" + coords.y * "+h[1]+` + coords.z;
  }
`}var ft=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`;function Tt(v,h,u,d){var y=[];v.forEach(function(Me){var We=Ye(Me.shapeInfo.logicalShape);Me.shapeInfo.isUniform?y.push("uniform float "+Me.name+(We>1?"["+We+"]":"")+";"):(y.push("uniform sampler2D "+Me.name+";"),y.push("uniform int offset"+Me.name+";"))});var D,z,X=y.join(`
`),oe=v.map(function(Me){return function(We,Ze,Je){Je===void 0&&(Je=!1);var at="";at+=Je?function kt(It){var Jt,on,Qt;switch(It.shapeInfo.logicalShape.length){case 0:return Jt=It.name,on="get"+Jt.charAt(0).toUpperCase()+Jt.slice(1),Qt=te(),`
    vec4 `+on+`() {
      return `+Qt.texture2D+"("+Jt+`, halfCR);
    }
  `;case 1:return function(cn){var vn=cn.name,p="get"+vn.charAt(0).toUpperCase()+vn.slice(1),c=cn.shapeInfo.texShape,o=[Math.ceil(c[0]/2),Math.ceil(c[1]/2)],l=te();return`
    vec4 `+p+`(int index) {
      vec2 uv = packedUVfrom1D(
        `+o[0]+", "+o[1]+`, index);
      return `+l.texture2D+"("+vn+`, uv);
    }
  `}(It);case 2:return function(cn){var vn=cn.shapeInfo.logicalShape,p=cn.name,c="get"+p.charAt(0).toUpperCase()+p.slice(1),o=cn.shapeInfo.texShape,l=o[0],g=o[1],S=te();if(o!=null&&ln(vn,o))return`
      vec4 `+c+`(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(`+g+".0, "+l+`.0);

        return `+S.texture2D+"("+p+`, uv);
      }
    `;var j=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)],V=Math.ceil(vn[1]/2);return`
    vec4 `+c+`(int row, int col) {
      vec2 uv = packedUVfrom2D(`+V+", "+j[0]+", "+j[1]+`, row, col);
      return `+S.texture2D+"("+p+`, uv);
    }
  `}(It);case 3:return function(cn){var vn=cn.shapeInfo.logicalShape,p=cn.name,c="get"+p.charAt(0).toUpperCase()+p.slice(1),o=cn.shapeInfo.texShape,l=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)];if(vn[0]===1){var g=vn.slice(1),S=tr(cn,g);return`
        `+kt(S)+`
        vec4 `+c+`(int b, int row, int col) {
          return `+c+"("+rr(["b","row","col"],[1,2])+`);
        }
      `}var j=l[0],V=l[1],ne=Math.ceil(vn[2]/2),ae=ne*Math.ceil(vn[1]/2),me=te();return`
    vec4 `+c+`(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        `+j+", "+V+", "+ae+", "+ne+`, b, row, col);
      return `+me.texture2D+"("+p+`, uv);
    }
  `}(It);default:return function(cn){for(var vn=cn.shapeInfo.logicalShape,p=vn.length,c=cn.name,o="get"+c.charAt(0).toUpperCase()+c.slice(1),l=cn.shapeInfo.texShape,g=[Math.ceil(l[0]/2),Math.ceil(l[1]/2)],S=g[0],j=g[1],V=Math.ceil(vn[p-1]/2),ne=V*Math.ceil(vn[p-2]/2),ae="int b, int row, int col",me="b * "+ne+" + (row / 2) * "+V+" + (col / 2)",Ee=2;Ee<p-1;Ee++)ae="int b"+Ee+", "+ae,ne*=vn[p-Ee-1],me="b"+Ee+" * "+ne+" + "+me;var Se=te();return`
    vec4 `+o+"("+ae+`) {
      int index = `+me+`;
      int texR = index / `+j+`;
      int texC = index - texR * `+j+`;
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+j+", "+S+`);
      return `+Se.texture2D+"("+c+`, uv);
    }
  `}(It)}}(We):function kt(It){var Jt=It.shapeInfo.logicalShape;switch(Jt.length){case 0:return function(on){var Qt=on.name,cn="get"+Qt.charAt(0).toUpperCase()+Qt.slice(1);if(on.shapeInfo.isUniform)return"float "+cn+"() {return "+Qt+";}";var vn=on.shapeInfo.texShape,p=vn[0],c=vn[1];if(p===1&&c===1)return`
      float `+cn+`() {
        return sampleTexture(`+Qt+`, halfCR);
      }
    `;var o=on.shapeInfo.texShape,l=o[0],g=o[1],S=Nn(Qt);return`
    float `+cn+`() {
      vec2 uv = uvFromFlat(`+l+", "+g+", "+S+`);
      return sampleTexture(`+Qt+`, uv);
    }
  `}(It);case 1:return function(on){var Qt=on.name,cn="get"+Qt.charAt(0).toUpperCase()+Qt.slice(1);if(on.shapeInfo.isUniform)return`
      float `+cn+`(int index) {
        `+Wn(on)+`
      }
    `;var vn=on.shapeInfo.texShape,p=vn[0],c=vn[1];if(c===1&&p===1)return`
      float `+cn+`(int index) {
        return sampleTexture(`+Qt+`, halfCR);
      }
    `;var o=Nn(Qt);return c===1?`
      float `+cn+`(int index) {
        vec2 uv = vec2(0.5, (float(index + `+o+") + 0.5) / "+p+`.0);
        return sampleTexture(`+Qt+`, uv);
      }
    `:p===1?`
      float `+cn+`(int index) {
        vec2 uv = vec2((float(index + `+o+") + 0.5) / "+c+`.0, 0.5);
        return sampleTexture(`+Qt+`, uv);
      }
    `:`
    float `+cn+`(int index) {
      vec2 uv = uvFromFlat(`+p+", "+c+", index + "+o+`);
      return sampleTexture(`+Qt+`, uv);
    }
  `}(It);case 2:return function(on){var Qt=on.shapeInfo.logicalShape,cn=on.name,vn="get"+cn.charAt(0).toUpperCase()+cn.slice(1),p=on.shapeInfo.texShape;if(p!=null&&ln(Qt,p)){var c=p[0],o=p[1];return`
    float `+vn+`(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(`+o+".0, "+c+`.0);
      return sampleTexture(`+cn+`, uv);
    }
  `}var l=Bn(Qt),g=l.newShape,S=l.keptDims,j=g;if(j.length<Qt.length){var V=tr(on,j);return`
      `+kt(V)+`
      float `+vn+`(int row, int col) {
        return `+vn+"("+rr(["row","col"],S)+`);
      }
    `}if(on.shapeInfo.isUniform)return`
      float `+vn+`(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(`+Qt[1]+`, 1)));
        `+Wn(on)+`
      }
    `;var ne=p[0],ae=p[1],me=Nn(cn);return ae===1?`
    float `+vn+`(int row, int col) {
      float index = dot(vec3(row, col, `+me+"), vec3("+Qt[1]+`, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / `+ne+`.0);
      return sampleTexture(`+cn+`, uv);
    }
  `:ne===1?`
    float `+vn+`(int row, int col) {
      float index = dot(vec3(row, col, `+me+"), vec3("+Qt[1]+`, 1, 1));
      vec2 uv = vec2((index + 0.5) / `+ae+`.0, 0.5);
      return sampleTexture(`+cn+`, uv);
    }
  `:`
  float `+vn+`(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * `+Qt[1]+" + col + "+me+`;
    vec2 uv = uvFromFlat(`+ne+", "+ae+`, index);
    return sampleTexture(`+cn+`, uv);
  }
`}(It);case 3:return function(on){var Qt=on.shapeInfo.logicalShape,cn=on.name,vn="get"+cn.charAt(0).toUpperCase()+cn.slice(1),p=Qt[1]*Qt[2],c=Qt[2],o=Bn(Qt),l=o.newShape,g=o.keptDims,S=l;if(S.length<Qt.length){var j=tr(on,S);return`
        `+kt(j)+`
        float `+vn+`(int row, int col, int depth) {
          return `+vn+"("+rr(["row","col","depth"],g)+`);
        }
      `}if(on.shapeInfo.isUniform)return`
      float `+vn+`(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(`+p+", "+c+`, 1)));
        `+Wn(on)+`
      }
    `;var V=on.shapeInfo.texShape,ne=V[0],ae=V[1],me=on.shapeInfo.flatOffset;if(ae===p&&me==null)return`
        float `+vn+`(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(`+c+`, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(`+ae+".0, "+ne+`.0);
          return sampleTexture(`+cn+`, uv);
        }
      `;if(ae===c&&me==null)return`
    float `+vn+`(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(`+Qt[1]+`, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+ae+".0, "+ne+`.0);
      return sampleTexture(`+cn+`, uv);
    }
  `;var Ee=Nn(cn);return`
      float `+vn+`(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * `+p+" + col * "+c+" + depth + "+Ee+`;
        vec2 uv = uvFromFlat(`+ne+", "+ae+`, index);
        return sampleTexture(`+cn+`, uv);
      }
  `}(It);case 4:return function(on){var Qt=on.shapeInfo.logicalShape,cn=on.name,vn="get"+cn.charAt(0).toUpperCase()+cn.slice(1),p=Qt[3],c=Qt[2]*p,o=Qt[1]*c,l=Bn(Qt),g=l.newShape,S=l.keptDims;if(g.length<Qt.length){var j=tr(on,g);return`
      `+kt(j)+`
      float `+vn+`(int row, int col, int depth, int depth2) {
        return `+vn+"("+rr(["row","col","depth","depth2"],S)+`);
      }
    `}if(on.shapeInfo.isUniform)return`
      float `+vn+`(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(`+o+", "+c+", "+p+`, 1)));
        `+Wn(on)+`
      }
    `;var V=on.shapeInfo.flatOffset,ne=on.shapeInfo.texShape,ae=ne[0],me=ne[1];if(me===o&&V==null)return`
      float `+vn+`(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(`+c+", "+p+`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+me+".0, "+ae+`.0);
        return sampleTexture(`+cn+`, uv);
      }
    `;if(me===p&&V==null)return`
      float `+vn+`(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(`+Qt[1]*Qt[2]+", "+Qt[2]+`, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+me+".0, "+ae+`.0);
        return sampleTexture(`+cn+`, uv);
      }
    `;var Ee=Nn(cn);return`
    float `+vn+`(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+o+" + col * "+c+` +
          depth * `+p+` + depth2;
      vec2 uv = uvFromFlat(`+ae+", "+me+", index + "+Ee+`);
      return sampleTexture(`+cn+`, uv);
    }
  `}(It);case 5:return function(on){var Qt=on.shapeInfo.logicalShape,cn=on.name,vn="get"+cn.charAt(0).toUpperCase()+cn.slice(1),p=Qt[4],c=Qt[3]*p,o=Qt[2]*c,l=Qt[1]*o,g=Bn(Qt),S=g.newShape,j=g.keptDims;if(S.length<Qt.length){var V=tr(on,S);return`
      `+kt(V)+`
      float `+vn+`(int row, int col, int depth, int depth2, int depth3) {
        return `+vn+"("+rr(["row","col","depth","depth2","depth3"],j)+`);
      }
    `}if(on.shapeInfo.isUniform)return`
      float `+vn+`(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(`+l+", "+o+", "+c+", "+p+`)) +
          depth3;
        `+Wn(on)+`
      }
    `;var ne=on.shapeInfo.flatOffset,ae=on.shapeInfo.texShape,me=ae[0],Ee=ae[1];if(Ee===l&&ne==null)return`
      float `+vn+`(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(`+o+", "+c+", "+p+`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+Ee+".0, "+me+`.0);
        return sampleTexture(`+cn+`, uv);
      }
    `;if(Ee===p&&ne==null)return`
      float `+vn+`(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(`+Qt[1]*Qt[2]*Qt[3]+`,
               `+Qt[2]*Qt[3]+", "+Qt[3]+`, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+Ee+".0, "+me+`.0);
        return sampleTexture(`+cn+`, uv);
      }
    `;var Se=Nn(cn);return`
    float `+vn+`(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+l+" + col * "+o+" + depth * "+c+` +
          depth2 * `+p+" + depth3 + "+Se+`;
      vec2 uv = uvFromFlat(`+me+", "+Ee+`, index);
      return sampleTexture(`+cn+`, uv);
    }
  `}(It);case 6:return function(on){var Qt=on.shapeInfo.logicalShape,cn=on.name,vn="get"+cn.charAt(0).toUpperCase()+cn.slice(1),p=Bn(Qt),c=p.newShape,o=p.keptDims;if(c.length<Qt.length){var l=tr(on,c);return`
      `+kt(l)+`
      float `+vn+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return `+vn+"("+rr(["row","col","depth","depth2","depth3","depth4"],o)+`);
      }
    `}var g=Qt[5],S=Qt[4]*g,j=Qt[3]*S,V=Qt[2]*j,ne=Qt[1]*V;if(on.shapeInfo.isUniform)return`
      float `+vn+`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(`+ne+", "+V+", "+j+", "+S+`)) +
          dot(
            vec2(depth3, depth4),
            vec2(`+g+`, 1)));
        `+Wn(on)+`
      }
    `;var ae=on.shapeInfo.flatOffset,me=on.shapeInfo.texShape,Ee=me[0],Se=me[1];if(Se===ne&&ae==null)return`
      float `+vn+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(`+V+", "+j+", "+S+", "+g+`)) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+Se+".0, "+Ee+`.0);
        return sampleTexture(`+cn+`, uv);
      }
    `;if(Se===g&&ae==null)return`
      float `+vn+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(`+Qt[1]*Qt[2]*Qt[3]*Qt[4]+`,
               `+Qt[2]*Qt[3]*Qt[4]+`,
               `+Qt[3]*Qt[4]+`,
               `+Qt[4]+`)) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+Se+".0, "+Ee+`.0);
        return sampleTexture(`+cn+`, uv);
      }
    `;var Ne=Nn(cn);return`
    float `+vn+`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+ne+" + col * "+V+" + depth * "+j+` +
          depth2 * `+S+" + depth3 * "+g+" + depth4 + "+Ne+`;
      vec2 uv = uvFromFlat(`+Ee+", "+Se+`, index);
      return sampleTexture(`+cn+`, uv);
    }
  `}(It);default:throw new Error(Jt.length+"-D input sampling is not yet supported")}}(We);var yt=We.shapeInfo.logicalShape,xt=Ze.logicalShape;return yt.length<=xt.length&&(at+=Je?function(kt,It){var Jt,on=kt.name,Qt=on.charAt(0).toUpperCase()+on.slice(1),cn="get"+Qt+"AtOutCoords",vn=kt.shapeInfo.logicalShape.length,p=It.logicalShape.length,c=$a(kt.shapeInfo.logicalShape,It.logicalShape),o=Rn(p),l=p-vn,g=["x","y","z","w","u","v"];Jt=vn===0?"":p<2&&c.length>=1?"coords = 0;":c.map(function(Ee){return"coords."+g[Ee+l]+" = 0;"}).join(`
`);var S;S=p<2&&vn>0?"coords":kt.shapeInfo.logicalShape.map(function(Ee,Se){return"coords."+g[Se+l]}).join(", ");var j="return outputValue;",V=Ye(kt.shapeInfo.logicalShape)===1,ne=Ye(It.logicalShape)===1;if(vn!==1||V||ne){if(V&&!ne)j=p===1?`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:`
        return vec4(outputValue.x);
      `;else if(c.length){var ae=vn-2,me=vn-1;c.indexOf(ae)>-1&&c.indexOf(me)>-1?j="return vec4(outputValue.x);":c.indexOf(ae)>-1?j="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":c.indexOf(me)>-1&&(j="return vec4(outputValue.xx, outputValue.zz);")}}else j=`
      return vec4(outputValue.xy, outputValue.xy);
    `;return`
    vec4 `+cn+`() {
      `+o+` coords = getOutputCoords();
      `+Jt+`
      vec4 outputValue = get`+Qt+"("+S+`);
      `+j+`
    }
  `}(We,Ze):function(kt,It){var Jt=kt.name,on=Jt.charAt(0).toUpperCase()+Jt.slice(1),Qt="get"+on+"AtOutCoords",cn=It.texShape,vn=kt.shapeInfo.texShape,p=kt.shapeInfo.logicalShape.length,c=It.logicalShape.length;if(!kt.shapeInfo.isUniform&&p===c&&kt.shapeInfo.flatOffset==null&&ln(vn,cn))return`
      float `+Qt+`() {
        return sampleTexture(`+Jt+`, resultUV);
      }
    `;var o=Rn(c),l=$a(kt.shapeInfo.logicalShape,It.logicalShape),g=c-p,S=["x","y","z","w","u","v"];return`
    float `+Qt+`() {
      `+o+` coords = getOutputCoords();
      `+(p===0?"":c<2&&l.length>=1?"coords = 0;":l.map(function(j){return"coords."+S[j+g]+" = 0;"}).join(`
`))+`
      return get`+on+"("+(c<2&&p>0?"coords":kt.shapeInfo.logicalShape.map(function(j,V){return"coords."+S[V+g]}).join(", "))+`);
    }
  `}(We,Ze)),at}(Me,h,d)}).join(`
`),he=h.texShape,xe=te(),Fe=`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return `+xe.texture2D+`(textureSampler, uv).r;
    }
  `,Re=function(Me){return Me.version+`
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    `+Me.varyingFs+` vec2 resultUV;
    `+Me.defineOutput+`
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    `+Me.defineSpecialNaN+`
    `+Me.defineSpecialInf+`
    `+Me.defineRound+`

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    `+Wt+`
    `+ct+`
    `+bn+`
  `}(xe);return h.isPacked?(D=function(Me,We){switch(Me.length){case 0:return`
    int getOutputCoords() {
      return 0;
    }
  `;case 1:return function(kt,It){var Jt=[Math.ceil(It[0]/2),Math.ceil(It[1]/2)];return Jt[0]===1?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * `+Jt[1]+`.0);
      }
    `:Jt[1]===1?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * `+Jt[0]+`.0);
      }
    `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+Jt[0]+", "+Jt[1]+`));
      return 2 * (resTexRC.x * `+Jt[1]+` + resTexRC.y);
    }
  `}(0,We);case 2:return function(kt,It){var Jt=[Math.ceil(It[0]/2),Math.ceil(It[1]/2)];if(ln(kt,It))return`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(`+Jt[0]+", "+Jt[1]+`));
      }
    `;var on=Math.ceil(kt[1]/2);return`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+Jt[0]+", "+Jt[1]+`));

      int index = resTexRC.x * `+Jt[1]+` + resTexRC.y;
      int r = 2 * (index / `+on+`);
      int c = imod(index, `+on+`) * 2;

      return ivec2(r, c);
    }
  `}(Me,We);case 3:return Ze=Me,Je=We,at=[Math.ceil(Je[0]/2),Math.ceil(Je[1]/2)],xt=(yt=Math.ceil(Ze[2]/2))*Math.ceil(Ze[1]/2),`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+at[0]+", "+at[1]+`));
      int index = resTexRC.x * `+at[1]+` + resTexRC.y;

      int b = index / `+xt+`;
      index -= b * `+xt+`;

      int r = 2 * (index / `+yt+`);
      int c = imod(index, `+yt+`) * 2;

      return ivec3(b, r, c);
    }
  `;default:return function(kt,It){for(var Jt=[Math.ceil(It[0]/2),Math.ceil(It[1]/2)],on=Math.ceil(kt[kt.length-1]/2),Qt=on*Math.ceil(kt[kt.length-2]/2),cn=Qt,vn="",p="b, r, c",c=2;c<kt.length-1;c++)vn=`
      int b`+c+" = index / "+(cn*=kt[kt.length-c-1])+`;
      index -= b`+c+" * "+cn+`;
    `+vn,p="b"+c+", "+p;return`
    ivec`+kt.length+` getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+Jt[0]+", "+Jt[1]+`));
      int index = resTexRC.x * `+Jt[1]+` + resTexRC.y;

      `+vn+`

      int b = index / `+Qt+`;
      index -= b * `+Qt+`;

      int r = 2 * (index / `+on+`);
      int c = imod(index, `+on+`) * 2;

      return ivec`+kt.length+"("+p+`);
    }
  `}(Me,We)}var Ze,Je,at,yt,xt}(h.logicalShape,he),z=`
    void setOutput(vec4 val) {
      `+xe.output+` = val;
    }
  `):(D=function(Me,We){switch(Me.length){case 0:return`
    int getOutputCoords() {
      return 0;
    }
  `;case 1:return function(at,yt){return yt[0]===1?`
      int getOutputCoords() {
        return int(resultUV.x * `+yt[1]+`.0);
      }
    `:yt[1]===1?`
      int getOutputCoords() {
        return int(resultUV.y * `+yt[0]+`.0);
      }
    `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+yt[0]+", "+yt[1]+`));
      return resTexRC.x * `+yt[1]+` + resTexRC.y;
    }
  `}(0,We);case 2:return function(at,yt){return ln(at,yt)?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(`+yt[0]+", "+yt[1]+`));
      }
    `:at[1]===1?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`+yt[0]+", "+yt[1]+`));
        int index = resTexRC.x * `+yt[1]+` + resTexRC.y;
        return ivec2(index, 0);
      }
    `:at[0]===1?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`+yt[0]+", "+yt[1]+`));
        int index = resTexRC.x * `+yt[1]+` + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+yt[0]+", "+yt[1]+`));
      int index = resTexRC.x * `+yt[1]+` + resTexRC.y;
      int r = index / `+at[1]+`;
      int c = index - r * `+at[1]+`;
      return ivec2(r, c);
    }
  `}(Me,We);case 3:return Ze=We,Je=Be(["r","c","d"],Me),`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+Ze[0]+", "+Ze[1]+`));
      int index = resTexRC.x * `+Ze[1]+` + resTexRC.y;
      `+Je+`
      return ivec3(r, c, d);
    }
  `;case 4:return function(at,yt){var xt=Be(["r","c","d","d2"],at);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`+yt[0]+", "+yt[1]+`));
      int index = resTexRC.x * `+yt[1]+` + resTexRC.y;
      `+xt+`
      return ivec4(r, c, d, d2);
    }
  `}(Me,We);case 5:return function(at,yt){var xt=Be(["r","c","d","d2","d3"],at);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(`+yt[0]+`,
                             `+yt[1]+`));

      int index = resTexRC.x * `+yt[1]+` + resTexRC.y;

      `+xt+`

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `}(Me,We);case 6:return function(at,yt){var xt=Be(["r","c","d","d2","d3","d4"],at);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`+yt[0]+", "+yt[1]+`));
      int index = resTexRC.x * `+yt[1]+` + resTexRC.y;

      `+xt+`

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `}(Me,We);default:throw new Error(Me.length+"-D output sampling is not yet supported")}var Ze,Je}(h.logicalShape,he),z=`
    void setOutput(float val) {
      `+xe.output+` = vec4(val, 0, 0, 0);
    }
  `),d&&(Re+=Sn),[Re,Fe,z,X,D,oe,u].join(`
`)}var Wt=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,ct=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,bn=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,Sn=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function Nn(v){return"offset"+v}function Wn(v){var h=v.name,u=Ye(v.shapeInfo.logicalShape);return u<2?"return "+h+";":`
    for (int i = 0; i < `+u+`; i++) {
      if (i == index) {
        return `+h+`[i];
      }
    }
  `}function Rn(v){if(v<=1)return"int";if(v===2)return"ivec2";if(v===3)return"ivec3";if(v===4)return"ivec4";if(v===5)return"ivec5";if(v===6)return"ivec6";throw Error("GPU for rank "+v+" is not yet supported")}function tr(v,h){var u=JSON.parse(JSON.stringify(v));return u.shapeInfo.logicalShape=h,u}function rr(v,h){return h.map(function(u){return v[u]}).join(", ")}var dr=function(v,h,u){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=Hi(h,u),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        `+v+`
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `},Tr="return a + b;",Vr="return a - b;",xr="return a * b;",$r="return (a < 0.) ? b * a : a;",Wr=function(v,h,u){this.variableNames=["A","B"],this.outputShape=Hi(h,u),this.userCode=`
      float binaryOperation(float a, float b) {
        `+v+`
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `},ai=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`,li=function(v,h,u,d){d===void 0&&(d=!1),this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=Hi(h,u);var y=this.outputShape.length,D="";if(d)if(y===0||Ye(this.outputShape)===1)D=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else if(D=`
          `+Rn(y)+` coords = getOutputCoords();
        `,y===1)D+=`
            result.y = (coords + 1) >= `+this.outputShape[0]+` ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `;else{var z=N("coords",y);D+=`
            bool nextRowOutOfBounds =
              (`+z[y-2]+" + 1) >= "+this.outputShape[y-2]+`;
            bool nextColOutOfBounds =
              (`+z[y-1]+" + 1) >= "+this.outputShape[y-1]+`;
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        `+v+`
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        `+D+`

        setOutput(result);
      }
    `},Hr=function(){function v(h){this.variableNames=["A"],this.outputShape=h,this.userCode=`
      uniform float minVal;
      uniform float maxVal;

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}return v.prototype.getCustomSetupFunc=function(h,u){var d=this;return function(y,D){d.minLoc==null&&(d.minLoc=y.getUniformLocationNoThrow(D,"minVal"),d.maxLoc=y.getUniformLocationNoThrow(D,"maxVal")),y.gl.uniform1f(d.minLoc,h),y.gl.uniform1f(d.maxLoc,u)}},v}(),ni=function(){function v(h){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=h,this.userCode=`
      uniform float minVal;
      uniform float maxVal;

      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}return v.prototype.getCustomSetupFunc=function(h,u){var d=this;return function(y,D){d.minLoc==null&&(d.minLoc=y.getUniformLocationNoThrow(D,"minVal"),d.maxLoc=y.getUniformLocationNoThrow(D,"maxVal")),y.gl.uniform1f(d.minLoc,h),y.gl.uniform1f(d.maxLoc,u)}},v}();function to(v,h,u){var d=v.indexOf(h);return v.map(function(y,D){return D===d?y+" - "+u:y}).join()}var Qi=function(v,h,u,d){h===void 0&&(h=!1),u===void 0&&(u=null),d===void 0&&(d=!1),this.variableNames=["x","W"],this.outputShape=v.outShape;var y=v.padInfo.top,D=v.padInfo.left,z=v.strideHeight,X=v.strideWidth,oe=v.dilationHeight,he=v.dilationWidth,xe=v.filterHeight,Fe=v.filterWidth,Re=4*Math.floor(v.inChannels/4),Me=v.inChannels%4,We=v.dataFormat==="channelsLast",Ze=We?1:2,Je=We?2:3,at=We?3:1,yt="",xt="";u&&(yt=d?`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          `+u+`
        }`:`
          float activation(float x) {
            `+u+`
          }
        `,xt="result = activation(result);");var kt=h?"result += getBiasAtOutCoords();":"";h&&this.variableNames.push("bias"),d&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+yt+`

      const ivec2 strides = ivec2(`+z+", "+X+`);
      const ivec2 pads = ivec2(`+y+", "+D+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[`+at+`];

        ivec2 xRCCorner =
            ivec2(coords[`+Ze+"], coords["+Je+`]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+xe+`; wR++) {
          int xR = xRCorner + wR * `+oe+`;

          if (xR < 0 || xR >= `+v.inHeight+`) {
            continue;
          }

          for (int wC = 0; wC < `+Fe+`; wC++) {
            int xC = xCCorner + wC * `+he+`;

            if (xC < 0 || xC >= `+v.inWidth+`) {
              continue;
            }

            for (int d1 = 0; d1 < `+Re+`; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (`+We+`) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (`+(Me===1)+`) {

              if (`+We+`) {
                dotProd +=
                    getX(batch, xR, xC, `+Re+`) *
                    getW(wR, wC, `+Re+`, d2);
              } else {
                dotProd +=
                    getX(batch, `+Re+`, xR, xC) *
                    getW(wR, wC, `+Re+`, d2);
              }

            } else if (`+(Me===2)+`) {
              vec2 wValues = vec2(
                getW(wR, wC, `+Re+`, d2),
                getW(wR, wC, `+Re+` + 1, d2)
              );

              if (`+We+`) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, `+Re+`),
                  getX(batch, xR, xC, `+Re+` + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, `+Re+`, xR, xC),
                  getX(batch, `+Re+` + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (`+(Me===3)+`) {
              vec3 wValues = vec3(
                getW(wR, wC, `+Re+`, d2),
                getW(wR, wC, `+Re+` + 1, d2),
                getW(wR, wC, `+Re+` + 2, d2)
              );

              if (`+We+`) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, `+Re+`),
                  getX(batch, xR, xC, `+Re+` + 1),
                  getX(batch, xR, xC, `+Re+` + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, `+Re+`, xR, xC),
                  getX(batch, `+Re+` + 1, xR, xC),
                  getX(batch, `+Re+` + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        `+kt+`
        `+xt+`
        setOutput(result);
      }
    `},zo=function(v,h,u,d){h===void 0&&(h=!1),u===void 0&&(u=null),d===void 0&&(d=!1),this.variableNames=["x","W"],this.outputShape=v.outShape;var y=v.inHeight,D=v.inWidth,z=v.padInfo.top,X=v.padInfo.left,oe=v.strideHeight,he=v.strideWidth,xe=v.dilationHeight,Fe=v.dilationWidth,Re=v.filterHeight,Me=v.filterWidth,We=v.outChannels/v.inChannels,Ze="",Je="";u&&(Ze=d?`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          `+u+`
        }`:`
          float activation(float x) {
            `+u+`
          }
        `,Je="result = activation(result);");var at=h?"result += getBiasAtOutCoords();":"";h&&this.variableNames.push("bias"),d&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+Ze+`

      const ivec2 strides = ivec2(`+oe+", "+he+`);
      const ivec2 pads = ivec2(`+z+", "+X+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / `+We+`;
        int q = d2 - d1 * `+We+`;

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < `+Re+`; wR++) {
          int xR = xRCorner + wR * `+xe+`;

          if (xR < 0 || xR >= `+y+`) {
            continue;
          }

          for (int wC = 0; wC < `+Me+`; wC++) {
            int xC = xCCorner + wC * `+Fe+`;

            if (xC < 0 || xC >= `+D+`) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        `+at+`
        `+Je+`
        setOutput(result);
      }
    `},ji=function(v,h,u,d){h===void 0&&(h=!1),u===void 0&&(u=null),d===void 0&&(d=!1),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=v.outShape;for(var y=v.inHeight,D=v.inWidth,z=v.padInfo.top,X=v.padInfo.left,oe=v.strideHeight,he=v.strideWidth,xe=v.dilationHeight,Fe=v.dilationWidth,Re=v.filterHeight,Me=v.filterWidth,We=Me,Ze="int xR; int xC; int xCOffset;",Je=0;Je<Re;Je++)for(var at=0;at<Me;at++)Ze+=`
          vec4 xTexelR`+Je+"C"+2*at+` = vec4(0.);
          vec4 wR`+Je+"C"+at+` = vec4(0.);
          vec4 xR`+Je+"C"+at+" = vec4(0.);";for(Je=0;Je<Re;Je++)for(var yt=0;yt<We;yt++){if(Ze+=`
          xR = xRCorner + `+Je*xe+`;
          xC = xCCorner + `+(at=2*yt)*Fe+`;
        `,he===1){if(at<Me&&(Ze+=X%2==1?`
                xCOffset = xC + 1;
                if(xR >= 0 && xR < `+y+" && xCOffset >= 0 && xCOffset < "+D+`) {
                  xTexelR`+Je+"C"+at+` = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if(xCOffset + 1 >= `+D+`) {
                    xTexelR`+Je+"C"+at+`.zw = vec2(0.);
                  }
                } else {
                  xTexelR`+Je+"C"+at+` = vec4(0.);
                }

                xCOffset = xC + 1 - 2;
                if(xR >= 0 && xR < `+y+" && xCOffset >= 0 && xCOffset < "+D+`) {
                  vec4 previous = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if(xCOffset + 1 >= `+D+`) {
                    previous.zw = vec2(0.);
                  }

                  xR`+Je+"C"+at+" = vec4(previous.zw, xTexelR"+Je+"C"+at+`.xy);
                } else {
                  xR`+Je+"C"+at+" = vec4(0, 0, xTexelR"+Je+"C"+at+`.xy);
                }
              `:`
                if(xR >= 0 && xR < `+y+" && xC >= 0 && xC < "+D+`) {
                  xTexelR`+Je+"C"+at+` = getX(batch, xR, xC, d1);
                } else {
                  xTexelR`+Je+"C"+at+` = vec4(0.);
                }

                xR`+Je+"C"+at+" = xTexelR"+Je+"C"+at+`;
              `,at+1<Me)){var xt=X%2==0?Ut(Fe):Fe;Fe%2==0&&X%2==1||Fe%2!=0&&X%2!=1?(Ze+=`
                  xCOffset = xC + `+X%2+" + "+xt+`;

                  if(xR >= 0 && xR < `+y+` &&
                    xCOffset >= 0 && xCOffset < `+D+`) {
                    xTexelR`+Je+"C"+(at+2)+` = getX(batch, xR, xCOffset, d1);
                  }
                `,Fe>1&&(Ze+=`
                    xCOffset -= 2;
                    if(xR >= 0 && xR < `+y+` &&
                      xCOffset >= 0 && xCOffset < `+D+`) {
                      xTexelR`+Je+"C"+at+` = getX(batch, xR, xCOffset, d1);
                    } else {
                      xTexelR`+Je+"C"+at+` = vec4(0.);
                    }
                  `),Ze+=`
                  xR`+Je+"C"+(at+1)+` = vec4(
                    xTexelR`+Je+"C"+at+".zw, xTexelR"+Je+"C"+(at+2)+`.xy);
                `):Ze+=`
                  xCOffset = xC + `+xt+`;

                  if(xR >= 0 && xR < `+y+` &&
                    xCOffset >= 0 && xCOffset < `+D+`) {
                    xTexelR`+Je+"C"+(at+2)+` = getX(batch, xR, xCOffset, d1);
                  }

                  xR`+Je+"C"+(at+1)+" = xTexelR"+Je+"C"+(at+2)+`;
                `}}else at<Me&&(Ze+=`
              if(xR >= 0 && xR < `+y+`) {
            `,X%2==1?(Ze+=`
                xCOffset = xC + 1 - `+he+`;
                if(xCOffset >= 0 && xCOffset < `+D+`) {
                  xTexelR`+Je+"C"+at+` = getX(batch, xR, xCOffset, d1);
                } else {
                  xTexelR`+Je+"C"+at+` = vec4(0.);
                }

                if(xC + 1 >= 0 && xC + 1 < `+D+`) {
                  xTexelR`+Je+"C"+(at+2)+` = getX(batch, xR, xC + 1, d1);
                } else {
                  xTexelR`+Je+"C"+(at+2)+` = vec4(0.);
                }

                xR`+Je+"C"+at+` = vec4(
                  xTexelR`+Je+"C"+at+".zw, xTexelR"+Je+"C"+(at+2)+`.zw);
              `,at+1<Me&&(Ze+=`
                  vec4 final = vec4(0.);
                  xCOffset = xC + 1 + `+he+`;
                  if(xCOffset >= 0 && xCOffset < `+D+`) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xR`+Je+"C"+(at+1)+" = vec4(xTexelR"+Je+"C"+(at+2)+`.xy, final.xy);
                `)):(Ze+=`
                if(xC >= 0 && xC < `+D+`) {
                  xTexelR`+Je+"C"+at+` = getX(batch, xR, xC, d1);
                } else {
                  xTexelR`+Je+"C"+at+` = vec4(0.);
                }

                xCOffset = xC + `+he+`;
                if(xCOffset >= 0 && xCOffset < `+D+`) {
                  xTexelR`+Je+"C"+(at+2)+` = getX(batch, xR, xCOffset, d1);
                } else {
                  xTexelR`+Je+"C"+(at+2)+` = vec4(0.);
                }

                xR`+Je+"C"+at+` = vec4(
                  xTexelR`+Je+"C"+at+".xy, xTexelR"+Je+"C"+(at+2)+`.xy);
              `,at+1<Me&&(Ze+=`
                  xR`+Je+"C"+(at+1)+` = vec4(
                    xTexelR`+Je+"C"+at+".zw, xTexelR"+Je+"C"+(at+2)+`.zw);
                `)),Ze+="}");at<Me&&(Ze+=`
            vec4 wTexelR`+Je+"C"+at+" = getW("+Je+", "+at+`, d1, q);
            wR`+Je+"C"+at+" = vec4(wTexelR"+Je+"C"+at+".xz, wTexelR"+Je+"C"+at+`.xz);
          `,at+1<Me&&(Ze+=`
              vec4 wTexelR`+Je+"C"+(at+1)+" = getW("+Je+", "+(at+1)+`, d1, q);
              wR`+Je+"C"+(at+1)+` =
                vec4(wTexelR`+Je+"C"+(at+1)+".xz, wTexelR"+Je+"C"+(at+1)+".xz);"))}for(Je=0;Je<Re;Je++)for(at=0;at<Me;at++)Ze+="dotProd += xR"+Je+"C"+at+" * wR"+Je+"C"+at+";";var kt="",It="";u&&(kt=d?`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          `+u+`
        }`:`vec4 activation(vec4 x) {
          `+u+`
        }`,It="result = activation(result);");var Jt=h?"result += getBiasAtOutCoords();":"";h&&this.variableNames.push("bias"),d&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+kt+`

      const ivec2 strides = ivec2(`+oe+", "+he+`);
      const ivec2 pads = ivec2(`+z+", "+X+`);

      void main() {

        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2;
        int q = 0;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        vec4 dotProd = vec4(0.);

        `+Ze+`

        vec4 result = dotProd;
        `+Jt+`
        `+It+`
        setOutput(result);
      }
    `};function no(v,h){if(v===1)return""+h;if(v===2)return h+".y";if(v===3)return h+".z";if(v===4)return h+".w";throw Error("Cumulative sum for rank "+v+" is not yet supported")}var ia=function(){function v(h,u,d){this.variableNames=["x"],this.outputShape=[],this.outputShape=h,this.blockSize=u,this.dataFormat=d,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = `+this.getHeightCoordString()+`;
      int w = `+this.getWidthCoordString()+`;
      int d = `+this.getDepthCoordString()+`;

      int in_h = h / `+u+`;
      int offset_h = imod(h, `+u+`);
      int in_w = w / `+u+`;
      int offset_w = imod(w, `+u+`);
      int offset_d = (offset_h * `+u+` + offset_w) *
        `+this.getOutputDepthSize()+`;
      int in_d = d + offset_d;

      float result = `+this.getInputSamplingString()+`;
      setOutput(result);
    }
  `}return v.prototype.getHeightCoordString=function(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"},v.prototype.getWidthCoordString=function(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"},v.prototype.getDepthCoordString=function(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"},v.prototype.getOutputDepthSize=function(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]},v.prototype.getInputSamplingString=function(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"},v}(),jo=function(v,h,u){this.variableNames=["real","imag"];var d=h[1];this.outputShape=h;var y=u?"2.0 * "+Math.PI:"-2.0 * "+Math.PI,D=u?d+".0":"1.0";this.userCode=`
      const float exponentMultiplier = `+y+`;

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        `+v+`
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(`+d+`);
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < `+d+`; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / `+D+`;
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `},Jo=function(){function v(h,u){this.outputShape=[],this.variableNames=["x"],this.outputShape=h,this.userCode=`
      uniform float value;
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}return v.prototype.getCustomSetupFunc=function(h){var u=this;return function(d,y){u.valueLoc==null&&(u.valueLoc=d.getUniformLocationNoThrow(y,"value")),d.gl.uniform1f(u.valueLoc,h)}},v}();function Fi(v,h){var u=te();return eo(v,h,u.version+`
    precision highp float;
    `+u.attribute+` vec3 clipSpacePos;
    `+u.attribute+` vec2 uv;
    `+u.varyingVs+` vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`)}function Di(v,h){return bc(v,h,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function mo(v,h){return Bu(v,h,new Uint16Array([0,1,2,2,1,3]))}function la(v,h,u,d,y,D,z){Dd(u,d);var X=xc(v,h),oe=v.TEXTURE_2D;return jn(v,h,function(){return v.bindTexture(oe,X)}),jn(v,h,function(){return v.texParameteri(oe,v.TEXTURE_WRAP_S,v.CLAMP_TO_EDGE)}),jn(v,h,function(){return v.texParameteri(oe,v.TEXTURE_WRAP_T,v.CLAMP_TO_EDGE)}),jn(v,h,function(){return v.texParameteri(oe,v.TEXTURE_MIN_FILTER,v.NEAREST)}),jn(v,h,function(){return v.texParameteri(oe,v.TEXTURE_MAG_FILTER,v.NEAREST)}),jn(v,h,function(){return v.texImage2D(oe,0,y,u,d,0,D,z,null)}),jn(v,h,function(){return v.bindTexture(v.TEXTURE_2D,null)}),X}function ha(v,h,u,d,y){var D=Zi(u,d);return la(v,h,D[0],D[1],y.internalFormatFloat,y.textureFormatFloat,v.FLOAT)}function aa(v,h,u,d,y){var D=Zi(u,d);return la(v,h,D[0],D[1],y.internalFormatHalfFloat,y.textureFormatFloat,y.textureTypeHalfFloat)}function Qo(v,h,u,d,y){var D=Zi(u,d);return la(v,h,D[0],D[1],v.RGBA,v.RGBA,v.UNSIGNED_BYTE)}function Za(v,h,u,d,y){var D=qr(u,d);return la(v,h,D[0],D[1],y.internalFormatPackedFloat,v.RGBA,v.FLOAT)}function da(v,h,u,d,y){var D=qr(u,d);return la(v,h,D[0],D[1],y.internalFormatPackedHalfFloat,v.RGBA,y.textureTypeHalfFloat)}function go(v,h,u,d){return jn(v,h,function(){return v.bindBuffer(v.ARRAY_BUFFER,d)}),vf(v,h,u,"clipSpacePos",d,3,20,0)&&vf(v,h,u,"uv",d,2,20,12)}function wa(v,h,u,d,y,D,z){var X,oe,he;jn(v,h,function(){return v.bindTexture(v.TEXTURE_2D,u)}),D instanceof Uint8Array?(X=new Uint8Array(d*y*4),oe=v.UNSIGNED_BYTE,he=v.RGBA):(X=new Float32Array(d*y*4),oe=v.FLOAT,he=z.internalFormatPackedFloat),X.set(D),jn(v,h,function(){return v.texImage2D(v.TEXTURE_2D,0,he,d,y,0,v.RGBA,oe,X)}),jn(v,h,function(){return v.bindTexture(v.TEXTURE_2D,null)})}function Su(v,h,u,d){jn(v,h,function(){return v.bindTexture(v.TEXTURE_2D,u)}),d.data instanceof Uint8Array?jn(v,h,function(){return v.texImage2D(v.TEXTURE_2D,0,v.RGBA,d.width,d.height,0,v.RGBA,v.UNSIGNED_BYTE,d.data)}):jn(v,h,function(){return v.texImage2D(v.TEXTURE_2D,0,v.RGBA,v.RGBA,v.UNSIGNED_BYTE,d)}),jn(v,h,function(){return v.bindTexture(v.TEXTURE_2D,null)})}function fs(v,h,u,d,y){var D=v.createBuffer();jn(v,h,function(){return v.bindBuffer(v.PIXEL_PACK_BUFFER,D)});var z=16*u*d;return jn(v,h,function(){return v.bufferData(v.PIXEL_PACK_BUFFER,z,v.STREAM_READ)}),jn(v,h,function(){return v.readPixels(0,0,d,u,v.RGBA,v.FLOAT,0)}),jn(v,h,function(){return v.bindBuffer(v.PIXEL_PACK_BUFFER,null)}),D}function Ma(v,h,u){var d=v,y=new Float32Array(u);return d.bindBuffer(d.PIXEL_PACK_BUFFER,h),d.getBufferSubData(d.PIXEL_PACK_BUFFER,0,y),d.bindBuffer(d.PIXEL_PACK_BUFFER,null),y}function Fo(v,h,u,d,y){var D=Zi(u,d),z=D[0],X=D[1],oe=new Uint8Array(u*d*4);return jn(v,h,function(){return v.readPixels(0,0,z,X,y.downloadTextureFormat,v.UNSIGNED_BYTE,oe)}),new Float32Array(oe.buffer)}function cc(v,h,u,d,y,D,z,X){var oe=v,he=new Float32Array(function(xe,Fe){var Re=qr(D,z);return Re[0]*Re[1]*4}());return oe.bindBuffer(oe.PIXEL_PACK_BUFFER,h),oe.getBufferSubData(oe.PIXEL_PACK_BUFFER,0,he),oe.bindBuffer(oe.PIXEL_PACK_BUFFER,null),he}function Ks(v,h,u,d){var y=new Float32Array(u*d*4);return jn(v,h,function(){return v.readPixels(0,0,d,u,v.RGBA,v.FLOAT,y)}),y}var Rs=Object.freeze({createVertexShader:Fi,createVertexBuffer:Di,createIndexBuffer:mo,createFloat32MatrixTexture:ha,createFloat16MatrixTexture:aa,createUnsignedBytesMatrixTexture:Qo,createPackedMatrixTexture:Za,createFloat16PackedMatrixTexture:da,bindVertexProgramAttributeStreams:go,uploadDenseMatrixToTexture:wa,uploadPixelDataToTexture:Su,createBufferFromOutputTexture:fs,downloadFloat32MatrixFromBuffer:Ma,downloadByteEncodedFloatMatrixFromOutputTexture:Fo,downloadPackedMatrixFromBuffer:cc,downloadMatrixFromPackedOutputTexture:Ks}),Zo=function(){function v(h){this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];var u=P().getNumber("WEBGL_VERSION");h!=null?(this.gl=h,fo(u,h)):this.gl=ui(u);var d="WEBGL_color_buffer_float";if(P().getNumber("WEBGL_VERSION")===1){if(this.textureFloatExtension=yo(this.gl,this.debug,"OES_texture_float"),fa(this.gl,"OES_texture_half_float"))this.textureHalfFloatExtension=yo(this.gl,this.debug,"OES_texture_half_float");else if(P().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(d),fa(this.gl,"EXT_color_buffer_half_float"))this.colorBufferHalfFloatExtension=yo(this.gl,this.debug,"EXT_color_buffer_half_float");else if(P().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(d="EXT_color_buffer_float",fa(this.gl,d))this.colorBufferFloatExtension=this.gl.getExtension(d);else{if(!fa(this.gl,"EXT_color_buffer_half_float"))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension("EXT_color_buffer_half_float")}this.vertexBuffer=Di(this.gl,this.debug),this.indexBuffer=mo(this.gl,this.debug),this.framebuffer=as(this.gl,this.debug),this.textureConfig=jr(this.gl,this.textureHalfFloatExtension)}return Object.defineProperty(v.prototype,"debug",{get:function(){return P().getBool("DEBUG")},enumerable:!0,configurable:!0}),v.prototype.dispose=function(){var h=this;if(!this.disposed){this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var u=this.gl;jn(u,this.debug,function(){return u.finish()}),jn(u,this.debug,function(){return u.bindFramebuffer(u.FRAMEBUFFER,null)}),jn(u,this.debug,function(){return u.deleteFramebuffer(h.framebuffer)}),jn(u,this.debug,function(){return u.bindBuffer(u.ARRAY_BUFFER,null)}),jn(u,this.debug,function(){return u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,null)}),jn(u,this.debug,function(){return u.deleteBuffer(h.indexBuffer)}),this.disposed=!0}},v.prototype.createFloat32MatrixTexture=function(h,u){return this.throwIfDisposed(),ha(this.gl,this.debug,h,u,this.textureConfig)},v.prototype.createFloat16MatrixTexture=function(h,u){return this.throwIfDisposed(),aa(this.gl,this.debug,h,u,this.textureConfig)},v.prototype.createUnsignedBytesMatrixTexture=function(h,u){return this.throwIfDisposed(),Qo(this.gl,this.debug,h,u,this.textureConfig)},v.prototype.uploadPixelDataToTexture=function(h,u){this.throwIfDisposed(),Su(this.gl,this.debug,h,u)},v.prototype.uploadDenseMatrixToTexture=function(h,u,d,y){this.throwIfDisposed(),wa(this.gl,this.debug,h,u,d,y,this.textureConfig)},v.prototype.createFloat16PackedMatrixTexture=function(h,u){return this.throwIfDisposed(),da(this.gl,this.debug,h,u,this.textureConfig)},v.prototype.createPackedMatrixTexture=function(h,u){return this.throwIfDisposed(),Za(this.gl,this.debug,h,u,this.textureConfig)},v.prototype.deleteMatrixTexture=function(h){var u=this;this.throwIfDisposed(),this.outputTexture===h&&(El(this.gl,this.debug,this.framebuffer),this.outputTexture=null),jn(this.gl,this.debug,function(){return u.gl.deleteTexture(h)})},v.prototype.downloadByteEncodedFloatMatrixFromOutputTexture=function(h,u,d){var y=this;return this.downloadMatrixDriver(h,function(){return Fo(y.gl,y.debug,u,d,y.textureConfig)})},v.prototype.downloadPackedMatrixFromBuffer=function(h,u,d,y,D,z){return cc(this.gl,h,0,0,0,D,z,this.textureConfig)},v.prototype.downloadFloat32MatrixFromBuffer=function(h,u){return Ma(this.gl,h,u)},v.prototype.createBufferFromTexture=function(h,u,d){this.bindTextureToFrameBuffer(h);var y=fs(this.gl,this.debug,u,d,this.textureConfig);return this.unbindTextureToFrameBuffer(),y},v.prototype.createAndWaitForFence=function(){var h=this.createFence(this.gl);return this.pollFence(h)},v.prototype.createFence=function(h){var u,d,y=this;if(P().getBool("WEBGL_FENCE_API_ENABLED")){var D=h,z=D.fenceSync(D.SYNC_GPU_COMMANDS_COMPLETE,0);h.flush(),d=function(){var X=D.clientWaitSync(z,0,0);return X===D.ALREADY_SIGNALED||X===D.CONDITION_SATISFIED},u=z}else P().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(u=this.beginQuery(),this.endQuery(),d=function(){return y.isQueryAvailable(u,P().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):d=function(){return!0};return{query:u,isFencePassed:d}},v.prototype.downloadMatrixFromPackedTexture=function(h,u,d){var y=this;return this.downloadMatrixDriver(h,function(){return Ks(y.gl,y.debug,u,d)})},v.prototype.createProgram=function(h){this.throwIfDisposed();var u=this.gl,d=bo(u,this.debug,h),y=Fi(u,this.debug),D=qi(u,this.debug);return jn(u,this.debug,function(){return u.attachShader(D,y)}),jn(u,this.debug,function(){return u.attachShader(D,d)}),ec(u,this.debug,D),this.debug&&bu(u,this.debug,D),this.vertexAttrsAreBound||(this.setProgram(D),this.vertexAttrsAreBound=go(u,this.debug,this.program,this.vertexBuffer)),D},v.prototype.deleteProgram=function(h){var u=this;this.throwIfDisposed(),h===this.program&&(this.program=null),h!=null&&jn(this.gl,this.debug,function(){return u.gl.deleteProgram(h)})},v.prototype.setProgram=function(h){var u=this;this.throwIfDisposed(),this.program=h,this.program!=null&&this.debug&&bu(this.gl,this.debug,this.program),jn(this.gl,this.debug,function(){return u.gl.useProgram(h)})},v.prototype.getUniformLocation=function(h,u,d){return d===void 0&&(d=!0),this.throwIfDisposed(),d?Pu(this.gl,this.debug,h,u):yf(this.gl,h,u)},v.prototype.getAttributeLocation=function(h,u){var d=this;return this.throwIfDisposed(),jn(this.gl,this.debug,function(){return d.gl.getAttribLocation(h,u)})},v.prototype.getUniformLocationNoThrow=function(h,u){return this.throwIfDisposed(),this.gl.getUniformLocation(h,u)},v.prototype.setInputMatrixTexture=function(h,u,d){this.throwIfDisposed(),this.throwIfNoProgram(),Ch(this.gl,this.debug,this.program,h,u,d)},v.prototype.setOutputMatrixTexture=function(h,u,d){this.setOutputMatrixTextureDriver(h,d,u)},v.prototype.setOutputPackedMatrixTexture=function(h,u,d){this.throwIfDisposed();var y=qr(u,d),D=y[0],z=y[1];this.setOutputMatrixTextureDriver(h,D,z)},v.prototype.setOutputMatrixWriteRegion=function(h,u,d,y){this.setOutputMatrixWriteRegionDriver(d,h,y,u)},v.prototype.setOutputPackedMatrixWriteRegion=function(h,u,d,y){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")},v.prototype.debugValidate=function(){this.program!=null&&bu(this.gl,this.debug,this.program),Fa(this.gl)},v.prototype.executeProgram=function(){this.throwIfDisposed(),this.throwIfNoProgram();var h=this.gl;this.debug&&this.debugValidate(),jn(h,this.debug,function(){return h.drawElements(h.TRIANGLES,6,h.UNSIGNED_SHORT,0)})},v.prototype.blockUntilAllProgramsCompleted=function(){var h=this;this.throwIfDisposed(),jn(this.gl,this.debug,function(){return h.gl.finish()})},v.prototype.getQueryTimerExtension=function(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=yo(this.gl,this.debug,P().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension},v.prototype.getQueryTimerExtensionWebGL2=function(){return this.getQueryTimerExtension()},v.prototype.getQueryTimerExtensionWebGL1=function(){return this.getQueryTimerExtension()},v.prototype.beginQuery=function(){if(P().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){var h=this.gl,u=this.getQueryTimerExtensionWebGL2(),d=h.createQuery();return h.beginQuery(u.TIME_ELAPSED_EXT,d),d}var y=this.getQueryTimerExtensionWebGL1(),D=y.createQueryEXT();return y.beginQueryEXT(y.TIME_ELAPSED_EXT,D),D},v.prototype.endQuery=function(){if(P().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")!==2){var h=this.getQueryTimerExtensionWebGL1();h.endQueryEXT(h.TIME_ELAPSED_EXT)}else{var u=this.gl,d=this.getQueryTimerExtensionWebGL2();u.endQuery(d.TIME_ELAPSED_EXT)}},v.prototype.waitForQueryAndGetTime=function(h){return R(this,void 0,void 0,function(){var u=this;return W(this,function(d){switch(d.label){case 0:return[4,Dt(function(){return u.disposed||u.isQueryAvailable(h,P().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))})];case 1:return d.sent(),[2,this.getQueryTime(h,P().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))]}})})},v.prototype.getQueryTime=function(h,u){if(u===0)return null;if(u===2){var d=this.gl;return d.getQueryParameter(h,d.QUERY_RESULT)/1e6}var y=this.getQueryTimerExtensionWebGL1();return y.getQueryObjectEXT(h,y.QUERY_RESULT_EXT)/1e6},v.prototype.isQueryAvailable=function(h,u){if(u===0)return!0;if(u===2){var d=this.gl,y=this.getQueryTimerExtensionWebGL2(),D=d.getQueryParameter(h,d.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(y.GPU_DISJOINT_EXT)),D&&!this.disjoint}return D=(y=this.getQueryTimerExtensionWebGL1()).getQueryObjectEXT(h,y.QUERY_RESULT_AVAILABLE_EXT),this.disjoint==null&&(this.disjoint=this.gl.getParameter(y.GPU_DISJOINT_EXT)),D&&!this.disjoint},v.prototype.pollFence=function(h){var u=this;return new Promise(function(d){u.addItemToPoll(function(){return h.isFencePassed()},function(){return d()})})},v.prototype.pollItems=function(){for(var h=function(d){for(var y=0;y<d.length&&d[y]();++y);return y-1}(this.itemsToPoll.map(function(d){return d.isDoneFn})),u=0;u<=h;++u)(0,this.itemsToPoll[u].resolveFn)();this.itemsToPoll=this.itemsToPoll.slice(h+1)},v.prototype.addItemToPoll=function(h,u){var d=this;this.itemsToPoll.push({isDoneFn:h,resolveFn:u}),this.itemsToPoll.length>1||Dt(function(){return d.pollItems(),d.itemsToPoll.length===0})},v.prototype.bindTextureToFrameBuffer=function(h){this.throwIfDisposed(),wc(this.gl,this.debug,h,this.framebuffer),this.debug&&Fa(this.gl)},v.prototype.unbindTextureToFrameBuffer=function(){this.outputTexture!=null?(wc(this.gl,this.debug,this.outputTexture,this.framebuffer),this.debug&&Fa(this.gl)):El(this.gl,this.debug,this.framebuffer)},v.prototype.downloadMatrixDriver=function(h,u){this.bindTextureToFrameBuffer(h);var d=u();return this.unbindTextureToFrameBuffer(),d},v.prototype.setOutputMatrixTextureDriver=function(h,u,d){this.throwIfDisposed();var y=this.gl;wc(y,this.debug,h,this.framebuffer),this.debug&&Fa(y),this.outputTexture=h,jn(y,this.debug,function(){return y.viewport(0,0,u,d)}),jn(y,this.debug,function(){return y.scissor(0,0,u,d)})},v.prototype.setOutputMatrixWriteRegionDriver=function(h,u,d,y){var D=this;this.throwIfDisposed(),jn(this.gl,this.debug,function(){return D.gl.scissor(h,u,d,y)})},v.prototype.throwIfDisposed=function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")},v.prototype.throwIfNoProgram=function(){if(this.program==null)throw new Error("No GPU program is currently set.")},v}();function Ms(v,h){if(v.length!==h.length)throw Error("Binary was compiled with "+v.length+" inputs, but was executed with "+h.length+" inputs");v.forEach(function(u,d){var y=u.logicalShape,D=h[d],z=D.shape;if(!ln(y,z))throw Error("Binary was compiled with different shapes than the current args. Shapes "+y+" and "+z+" must match");if(!u.isUniform||!D.isUniform){var X=u.texShape,oe=D.isUniform?null:D.texData.texShape;if(!ln(X,oe))throw Error("Binary was compiled with different texture shapes than the current args. Shape "+X+" and "+oe+" must match")}})}var Io=function(v,h,u,d,y,D,z){u===void 0&&(u=!1),d===void 0&&(d=!1),y===void 0&&(y=!1),D===void 0&&(D=null),z===void 0&&(z=!1),this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=h;var X=u?v[1]:v[2],oe=Math.ceil(X/2),he=u?"i * 2, rc.y":"rc.y, i * 2",xe=d?"rc.z, i * 2":"i * 2, rc.z",Fe=u?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],Re=d?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],Me="",We="";D&&(Me=z?`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          `+D+`
        }`:`vec4 activation(vec4 x) {
          `+D+`
        }`,We="result = activation(result);");var Ze=y?"result += getBiasAtOutCoords();":"";y&&this.variableNames.push("bias"),z&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+Me+`

      const float sharedDimension = `+oe+`.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        for (int i = 0; i < `+oe+`; i++) {
          vec4 a = getMatrixA(rc.x, `+he+`);
          vec4 b = getMatrixB(rc.x, `+xe+`);

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (`+Fe[0]+" * "+Re[0]+`);
          result += (`+Fe[1]+" * "+Re[1]+`);
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        `+Ze+`

        `+We+`

        setOutput(result);
      }
    `},As=function(){function v(h,u,d){this.variableNames=["probs"],this.outputShape=[h,d],this.userCode=`
      uniform float seed;

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < `+(u-1)+`; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(`+(u-1)+`));
      }
    `}return v.prototype.getCustomSetupFunc=function(h){var u=this;return function(d,y){u.seedLoc==null&&(u.seedLoc=d.getUniformLocation(y,"seed")),d.gl.uniform1f(u.seedLoc,h)}},v}(),hs=function(v,h,u){if(this.variableNames=["x"],h==="avg"&&u)throw new Error("Cannot compute positions for average pool.");var d=v.filterWidth,y=v.strideHeight,D=v.strideWidth,z=v.dilationHeight,X=v.dilationWidth,oe=v.effectiveFilterHeight,he=v.effectiveFilterWidth,xe=v.padInfo.top,Fe=v.padInfo.left;this.outputShape=v.outShape;var Re=h==="avg",Me="0.0";if(Re||(Me="-1.0 / 1e-20"),u)this.userCode=`
        const ivec2 strides = ivec2(`+y+", "+D+`);
        const ivec2 pads = ivec2(`+xe+", "+Fe+`);

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < `+oe+`;
              wR += `+z+`) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= `+v.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+he+`;
                wC += `+X+`) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= `+v.inWidth+`) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value >= currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = wR * `+he+` + wC;
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;else{var We=h+"("+h+"("+h+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";h==="avg"&&(We="avgValue / count");var Ze=4*Math.floor(d/4),Je=d%4,at=`
      if (`+Re+`) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = max(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(`+y+", "+D+`);
      const ivec2 pads = ivec2(`+xe+", "+Fe+`);
      const float initializationValue = `+Me+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= `+v.inWidth+`) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(`+Me+`);
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < `+oe+`;
            wR += `+z+`) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= `+v.inHeight+`) {
            continue;
          }

          for (int wC = 0; wC < `+Ze+`; wC += 4) {
            int xC = xCCorner + wC * `+X+`;

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+X+`, d),
              getValue(batch, xR, xC + 2 * `+X+`, d),
              getValue(batch, xR, xC + 3 * `+X+`, d)
            );

            `+at+`
          }

          int xC = xCCorner + `+Ze+`;
          if (`+(Je===1)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            `+at+`
          } else if (`+(Je===2)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+X+`, d),
              initializationValue,
              initializationValue
            );

            `+at+`
          } else if (`+(Je===3)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+X+`, d),
              getValue(batch, xR, xC + 2 * `+X+`, d),
              initializationValue
            );

            `+at+`
          }
        }
        setOutput(`+We+`);
      }
    `}},oo=function(v,h,u){if(this.variableNames=["x"],h==="avg"&&u)throw new Error("Cannot compute positions for average pool.");var d=v.filterWidth,y=v.strideDepth,D=v.strideHeight,z=v.strideWidth,X=v.dilationDepth,oe=v.dilationHeight,he=v.dilationWidth,xe=v.effectiveFilterDepth,Fe=v.effectiveFilterHeight,Re=v.effectiveFilterWidth,Me=v.padInfo.front,We=v.padInfo.top,Ze=v.padInfo.left;this.outputShape=v.outShape;var Je=h==="avg",at="0.0";if(Je||(at="-1.0 / 1e-20"),u)this.userCode=`
        const ivec3 strides =
            ivec3(`+y+", "+D+", "+z+`);
        const ivec3 pads = ivec3(`+Me+", "+We+", "+Ze+`);

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < `+xe+`;
              wD += `+X+`) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= `+v.inDepth+`) {
              continue;
            }

            for (int wR = 0; wR < `+Fe+`;
                wR += `+oe+`) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= `+v.inHeight+`) {
                continue;
              }

              for (int wC = 0; wC < `+Re+`;
                  wC += `+he+`) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= `+v.inWidth+`) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value >= currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition =
                      wD * `+Fe+" * "+Re+` +
                      wR * `+Re+` + wC;;
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;else{var yt=h+"("+h+"("+h+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";h==="avg"&&(yt="avgValue / count");var xt=4*Math.floor(d/4),kt=d%4,It=`
      if (`+Je+`) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = max(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec3 strides =
        ivec3(`+y+", "+D+", "+z+`);
      const ivec3 pads = ivec3(`+Me+", "+We+", "+Ze+`);
      const float initializationValue = `+at+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= `+v.inWidth+`) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(`+at+`);
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < `+xe+`;
            wD += `+X+`) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= `+v.inDepth+`) {
            continue;
          }

          for (int wR = 0; wR < `+Fe+`;
            wR += `+oe+`) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= `+v.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+xt+`; wC += 4) {
              int xC = xCCorner + wC * `+he+`;

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+he+`, ch),
                getValue(batch, xD, xR, xC + 2 * `+he+`, ch),
                getValue(batch, xD, xR, xC + 3 * `+he+`, ch)
              );

              `+It+`
            }

            int xC = xCCorner + `+xt+`;
            if (`+(kt===1)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              `+It+`
            } else if (`+(kt===2)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+he+`, ch),
                initializationValue,
                initializationValue
              );

              `+It+`
            } else if (`+(kt===3)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+he+`, ch),
                getValue(batch, xD, xR, xC + 2 * `+he+`, ch),
                initializationValue
              );

              `+It+`
            }
          }
          setOutput(`+yt+`);
        }
      }
    `}},Ss=function(v,h,u,d,y,D,z){this.variableNames=["updates","indices","defaultValue"],this.outputShape=D;var X=Rn(y.length),oe=Rn(D.length),he="";u===1?he="i":u===2&&(he="i, j");var xe="getIndices("+he+")",Fe="";d===1?Fe="i":d===2&&(Fe="i, coords[1]");var Re="getUpdates("+Fe+")",Me=h>1?"strides[j]":"strides";this.userCode=`
        `+X+" strides = "+X+"("+y+`);

        void main() {
          `+oe+` coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < `+v+`; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < `+h+`; j++) {
              int index = round(`+xe+`);
              flattenedIndex += index * `+Me+`;
            }
            if (flattenedIndex == coords[0]) {
              sum += `+Re+`;
              found = true;
            }
          }
          setOutput(mix(getDefaultValue(), sum, float(found)));
        }
      `},Ga=function(){function v(h){this.variableNames=["source"],this.outputShape=h,this.rank=h.length;var u,d=Rn(this.rank),y="uniform int start["+this.rank+"];",D=function(z){if(z===1)return"sourceLoc";if(z<=6)return Xs.slice(0,z).map(function(X){return"sourceLoc."+X}).join(",");throw Error("Slicing for rank "+z+" is not yet supported")}(this.rank);u=`
        `+d+` sourceLoc;
        `+d+` coords = getOutputCoords();
        `+h.map(function(z,X){return"sourceLoc."+Xs[X]+" = start["+X+"] + coords."+Xs[X]+";"}).join(`
`)+`
      `,this.userCode=`
      `+y+`
      void main() {
        `+u+`
        setOutput(getSource(`+D+`));
      }
    `}return v.prototype.getCustomSetupFunc=function(h){var u=this;if(h.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+h.length+")");return function(d,y){u.startLoc==null&&(u.startLoc=d.getUniformLocationNoThrow(y,"start"),u.startLoc==null)||d.gl.uniform1iv(u.startLoc,h)}},v}(),Xs=["x","y","z","w","u","v"],Sc=function(){function v(h){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=h,this.rank=h.length;var u=Rn(this.rank),d=N("coords",this.rank),y=N("sourceLoc",this.rank),D=this.rank===1?"sourceLoc":"vec2("+y.slice(-2).join()+")",z="getChannel(getSource("+y.join()+"), "+D+")",X=`
      result.x = `+z+`;
      if (++`+d[this.rank-1]+" < "+h[this.rank-1]+`) {
        ++`+y[this.rank-1]+`;
        result.y = `+z+`;
        --`+y[this.rank-1]+`;
      }
    `,oe=this.rank===1?"":`
      --`+d[this.rank-1]+`;
      if (++`+d[this.rank-2]+" < "+h[this.rank-2]+`) {
        ++`+y[this.rank-2]+`;
        result.z = `+z+`;
        if (++`+d[this.rank-1]+" < "+h[this.rank-1]+`) {
          ++`+y[this.rank-1]+`;
          result.w = `+z+`;
        }
      }
    `,he=this.rank<=4?`sourceLoc = coords +
            `+u+"("+h.map(function(xe,Fe){return"start["+Fe+"]"}).join()+");":h.map(function(xe,Fe){return y[Fe]+" = "+d[Fe]+" + start["+Fe+"];"}).join(`
`);this.userCode=`
      uniform int start[`+this.rank+`];
      void main() {
        `+u+` coords = getOutputCoords();
        `+u+` sourceLoc;
        `+he+`
        vec4 result = vec4(0.);
        `+X+`
        `+oe+`
        setOutput(result);
      }
    `}return v.prototype.getCustomSetupFunc=function(h){var u=this;if(h.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+h.length+")");return function(d,y){u.startLoc==null&&(u.startLoc=d.getUniformLocationNoThrow(y,"start"),u.startLoc==null)||d.gl.uniform1iv(u.startLoc,h)}},v}(),Uo=function(){function v(h){this.gpgpu=h,this.numUsedTextures=0,this.numFreeTextures=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return v.prototype.acquireTexture=function(h,u,d){var y,D=es(u,d),z=ja(h,D,d);if(z in this.freeTextures||(this.freeTextures[z]=[]),z in this.usedTextures||(this.usedTextures[z]=[]),this.freeTextures[z].length>0){this.numFreeTextures--,this.numUsedTextures++,this.log();var X=this.freeTextures[z].shift();return this.usedTextures[z].push(X),X}return this.numUsedTextures++,this.log(),D===zr.PACKED_2X2_FLOAT32?y=this.gpgpu.createPackedMatrixTexture(h[0],h[1]):D===zr.PACKED_2X2_FLOAT16?y=this.gpgpu.createFloat16PackedMatrixTexture(h[0],h[1]):D===zr.UNPACKED_FLOAT32?y=this.gpgpu.createFloat32MatrixTexture(h[0],h[1]):D===zr.UNPACKED_FLOAT16?y=this.gpgpu.createFloat16MatrixTexture(h[0],h[1]):D===zr.PACKED_4X1_UNSIGNED_BYTE&&(y=this.gpgpu.createUnsignedBytesMatrixTexture(h[0],h[1])),this.usedTextures[z].push(y),y},v.prototype.releaseTexture=function(h,u,d,y){if(this.freeTextures!=null){var D=ja(u,es(d,y),y);D in this.freeTextures||(this.freeTextures[D]=[]),this.freeTextures[D].push(h),this.numFreeTextures++,this.numUsedTextures--;var z=this.usedTextures[D],X=z.indexOf(h);if(X<0)throw new Error("Cannot release a texture that was never provided by this texture manager");z.splice(X,1),this.log()}},v.prototype.log=function(){if(this.logEnabled){var h=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",this.numFreeTextures+" / "+this.numUsedTextures,"("+h+")")}},v.prototype.getNumUsedTextures=function(){return this.numUsedTextures},v.prototype.getNumFreeTextures=function(){return this.numFreeTextures},v.prototype.dispose=function(){var h=this;if(this.freeTextures!=null){for(var u in this.freeTextures)this.freeTextures[u].forEach(function(d){h.gpgpu.deleteMatrixTexture(d)});for(var u in this.usedTextures)this.usedTextures[u].forEach(function(y){h.gpgpu.deleteMatrixTexture(y)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0}},v}();function es(v,h){if(v===ir.UPLOAD)return zr.PACKED_2X2_FLOAT32;if(v===ir.RENDER||v==null)return function(u){return P().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?u?zr.PACKED_2X2_FLOAT32:zr.UNPACKED_FLOAT32:u?zr.PACKED_2X2_FLOAT16:zr.UNPACKED_FLOAT16}(h);if(v===ir.DOWNLOAD||v===ir.PIXELS)return zr.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type "+v)}function ja(v,h,u){return v[0]+"_"+v[1]+"_"+h+"_"+u}var lc=1.7580993408473768,el=1.0507009873554805,ci=function(v,h){this.variableNames=["A"],this.outputShape=v,this.userCode=`
      float unaryOperation(float x) {
        `+h+`
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `},Xd="if (isnan(x)) return x;",tl="return x;",Ll="return abs(x);",vg=Xd+`
  return (x < 0.0) ? 0.0 : x;
`,yg=Xd+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,Cm="return (x >= 0.0) ? x : (exp(x) - 1.0);",Om="return -x;",bg="return ceil(x);",Am="return floor(x);",xg="return exp(x);",Pf="return exp(x) - 1.0;",Yd="return x;",wg="return x;",kg=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,Eg=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,_c=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,Lf=function(v,h){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=v,this.userCode=`
      vec4 unaryOperation(vec4 x) {
        `+h+`
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `},Jd={};function Sm(v,h){if(h===void 0&&(h=!1),v==="linear")return h?wg:tl;if(v==="relu")return h?kg:vg;if(v==="elu")return h?_c:Cm;if(v==="relu6")return h?Eg:yg;if(v==="prelu")return h?ai:$r;throw new Error("Activation "+v+" has not been implemented for the WebGL backend.")}var _m=600,T0=function(v){function h(u){var d,y=v.call(this)||this;if(y.pendingRead=new WeakMap,y.pendingDisposal=new WeakSet,y.dataRefCount=new WeakMap,y.numBytesInGPU=0,y.uploadWaitMs=0,y.downloadWaitMs=0,y.warnedAboutMemory=!1,y.pendingDeletes=0,y.disposed=!1,!P().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");if(u==null){var D=ui(P().getNumber("WEBGL_VERSION"));y.binaryCache=((d=P().getNumber("WEBGL_VERSION"))in Jd||(Jd[d]={}),Jd[d]),y.gpgpu=new Zo(D),y.canvas=D.canvas,y.gpgpuCreatedLocally=!0}else y.gpgpu=u,y.binaryCache={},y.gpgpuCreatedLocally=!1,y.canvas=u.gl.canvas;return y.textureManager=new Uo(y.gpgpu),y.numMBBeforeWarning=P().global.screen==null?1024:P().global.screen.height*P().global.screen.width*window.devicePixelRatio*_m/1024/1024,y.texData=new Bl(y,Ue),y}return J(h,v),h.prototype.numDataIds=function(){return this.texData.numDataIds()+(this.cpuBackend?this.cpuBackend.numDataIds():0)-this.pendingDeletes},h.prototype.write=function(u,d,y){if(P().getBool("DEBUG")&&this.checkNumericalProblems(u),y==="complex64"&&u!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");var D={};return this.texData.set(D,{shape:d,dtype:y,values:u,usage:ir.UPLOAD}),D},h.prototype.move=function(u,d,y,D){if(P().getBool("DEBUG")&&this.checkNumericalProblems(d),D==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(u,{shape:y,dtype:D,values:d,usage:ir.UPLOAD})},h.prototype.readSync=function(u){var d=this.texData.get(u),y=d.values,D=d.dtype,z=d.complexTensors,X=d.slice,oe=d.shape,he=d.isPacked;if(X!=null){var xe;xe=he?new Lf(oe,Yd):new ci(oe,Yd);var Fe=this.runWebGLProgram(xe,[{dataId:u,shape:oe,dtype:D}],D),Re=this.readSync(Fe.dataId);return this.disposeData(Fe.dataId),Re}if(y!=null)return this.convertAndCacheOnCPU(u);if(D==="string")return y;var Me,We,Ze=this.activeTimers!=null;return Ze&&(Me=Zt()),We=D==="complex64"?Cu(z.real.dataSync(),z.imag.dataSync()):this.getValuesFromTexture(u),Ze&&(this.downloadWaitMs+=Zt()-Me),this.convertAndCacheOnCPU(u,We)},h.prototype.read=function(u){return R(this,void 0,void 0,function(){var d,y,D,z,X,oe,he,xe,Fe,Re,Me,We,Ze,Je,at,yt,xt,kt,It,Jt,on,Qt;return W(this,function(cn){switch(cn.label){case 0:if(this.pendingRead.has(u))return d=this.pendingRead.get(u),[2,new Promise(function(vn){return d.push(vn)})];if(y=this.texData.get(u),D=y.values,z=y.shape,X=y.slice,oe=y.dtype,he=y.complexTensors,xe=y.isPacked,X!=null)return Fe=void 0,Fe=xe?new Lf(z,Yd):new ci(z,Yd),Re=this.runWebGLProgram(Fe,[{dataId:u,shape:z,dtype:oe}],oe),Me=this.read(Re.dataId),this.disposeData(Re.dataId),[2,Me];if(D!=null)return[2,this.convertAndCacheOnCPU(u)];if(!P().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&P().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");return We=null,oe!=="complex64"&&P().get("WEBGL_BUFFER_SUPPORTED")&&(Ze=this.decode(u),Je=this.texData.get(Ze.dataId),We=(Qt=this.gpgpu).createBufferFromTexture.apply(Qt,[Je.texture].concat(Ti(z)))),this.pendingRead.set(u,[]),oe==="complex64"?[3,2]:[4,this.gpgpu.createAndWaitForFence()];case 1:cn.sent(),cn.label=2;case 2:return oe!=="complex64"?[3,4]:[4,Promise.all([he.real.data(),he.imag.data()])];case 3:return yt=cn.sent(),xt=yt[0],kt=yt[1],at=Cu(xt,kt),[3,5];case 4:We==null?at=this.getValuesFromTexture(u):(It=Ye(z),at=this.gpgpu.downloadFloat32MatrixFromBuffer(We,It)),cn.label=5;case 5:return Ze!=null&&this.disposeData(Ze.dataId),Jt=this.convertAndCacheOnCPU(u,at),on=this.pendingRead.get(u),this.pendingRead.delete(u),on.forEach(function(vn){return vn(Jt)}),this.pendingDisposal.has(u)&&(this.pendingDisposal.delete(u),this.disposeData(u),this.pendingDeletes--),[2,Jt]}})})},h.prototype.checkNumericalProblems=function(u){if(u!=null)for(var d=0;d<u.length;d++){var y=u[d];if(!Rr(y))throw P().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error("The value "+y+" cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'"):Error("The value "+y+" cannot be represented on this device.")}},h.prototype.getValuesFromTexture=function(u){var d,y=this.texData.get(u),D=y.shape,z=y.dtype,X=y.isPacked,oe=Ye(D);if(P().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){var he=this.decode(u),xe=this.texData.get(he.dataId),Fe=(d=this.gpgpu).downloadMatrixFromPackedTexture.apply(d,[xe.texture].concat(Ti(D))).subarray(0,oe);return this.disposeData(he.dataId),Fe}var Re=P().getBool("WEBGL_PACK")&&X===!0,Me=Re?nc(D):D,We=Re?new function(yt){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=ir.DOWNLOAD;var xt=te();this.outputShape=yt,this.userCode=`
      `+ft+`

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        `+xt.output+` = encode_float(x);
      }
    `}(Me):new function(yt){this.variableNames=["A"],this.outTexUsage=ir.DOWNLOAD;var xt=te();this.outputShape=yt,this.userCode=`
      `+ft+`

      void main() {
        float x = getAAtOutCoords();
        `+xt.output+` = encode_float(x);
      }
    `}(Me),Ze=this.runWebGLProgram(We,[{shape:Me,dtype:z,dataId:u}],"float32"),Je=this.texData.get(Ze.dataId),at=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(Je.texture,Je.texShape[0],Je.texShape[1]).subarray(0,oe);return this.disposeData(Ze.dataId),at},h.prototype.time=function(u){return R(this,void 0,void 0,function(){var d,y,D,z,X,oe,he;return W(this,function(xe){switch(xe.label){case 0:return d=this.activeTimers,y=[],D=!1,this.programTimersStack==null?(this.programTimersStack=y,D=!0):this.activeTimers.push(y),this.activeTimers=y,u(),z=jt(this.activeTimers.map(function(Fe){return Fe.query})).filter(function(Fe){return Fe!=null}),X=jt(this.activeTimers.map(function(Fe){return Fe.name})).filter(function(Fe){return Fe!=null}),this.activeTimers=d,D&&(this.programTimersStack=null),oe={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null},P().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[4,Promise.all(z)]:[3,2];case 1:return he=xe.sent(),oe.kernelMs=Xt(he),oe.getExtraProfileInfo=function(){return he.map(function(Fe,Re){return{name:X[Re],ms:Fe}}).map(function(Fe){return Fe.name+": "+Fe.ms}).join(", ")},[3,3];case 2:oe.kernelMs={error:"WebGL query timers are not supported in this environment."},xe.label=3;case 3:return this.uploadWaitMs=0,this.downloadWaitMs=0,[2,oe]}})})},h.prototype.memory=function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU}},h.prototype.startTimer=function(){return P().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:Zt(),endMs:null}},h.prototype.endTimer=function(u){return P().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),u):(u.endMs=Zt(),u)},h.prototype.getQueryTime=function(u){return R(this,void 0,void 0,function(){var d;return W(this,function(y){return P().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[2,this.gpgpu.waitForQueryAndGetTime(u)]:[2,(d=u).endMs-d.startMs]})})},h.prototype.disposeData=function(u){if(!this.pendingDisposal.has(u)){if(this.pendingRead.has(u))return this.pendingDisposal.add(u),void this.pendingDeletes++;if(this.texData.has(u)){this.releaseGPUData(u);var d=this.texData.get(u).complexTensors;d!=null&&(d.real.dispose(),d.imag.dispose()),this.texData.delete(u)}}},h.prototype.releaseGPUData=function(u){var d=this.texData.get(u),y=d.texture,D=d.dtype,z=d.texShape,X=d.usage,oe=d.isPacked,he=d.slice,xe=he&&he.origDataId||u,Fe=this.dataRefCount.get(xe);Fe>1?this.dataRefCount.set(xe,Fe-1):(this.dataRefCount.delete(xe),y!=null&&(this.numBytesInGPU-=this.computeBytes(z,D),this.textureManager.releaseTexture(y,z,X,oe)));var Re=this.texData.get(u);Re.texture=null,Re.texShape=null,Re.isPacked=!1,Re.slice=null},h.prototype.getTexture=function(u){return this.uploadToGPU(u),this.texData.get(u).texture},h.prototype.getDataInfo=function(u){return this.texData.get(u)},h.prototype.getCPUBackend=function(){return P().getBool("WEBGL_CPU_FORWARD")?(this.cpuBackend==null&&(this.cpuBackend=Ue.findBackend("cpu")),this.cpuBackend):null},h.prototype.shouldExecuteOnCPU=function(u,d){var y=this;return d===void 0&&(d=128),this.getCPUBackend()!=null&&u.every(function(D){return y.texData.get(D.dataId).texture==null&&D.size<d})},h.prototype.getGPGPUContext=function(){return this.gpgpu},h.prototype.complex=function(u,d){var y=this.makeOutput(u.shape,"complex64");return this.texData.get(y.dataId).complexTensors={real:Ue.keep(u.clone()),imag:Ue.keep(d.clone())},y},h.prototype.real=function(u){return this.texData.get(u.dataId).complexTensors.real.clone()},h.prototype.imag=function(u){return this.texData.get(u.dataId).complexTensors.imag.clone()},h.prototype.slice=function(u,d,y){if(this.shouldExecuteOnCPU([u]))return this.cpuBackend.slice(u,d,y);if(Ye(y)===0)return ko([],y,u.dtype);var D=this.texData.get(u.dataId).isPacked,z=Ff(u.shape,d,y);if(D||!z){var X=P().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Sc(y):new Ga(y),oe=X.getCustomSetupFunc(d);return this.compileAndRun(X,[u],null,oe)}return this.uploadToGPU(u.dataId),this.shallowSlice(u,d,y)},h.prototype.shallowSlice=function(u,d,y){var D=this.texData.get(u.dataId),z=this.makeOutput(y,u.dtype),X=this.texData.get(z.dataId);Object.assign(X,D),X.shape=y,X.dtype=u.dtype;var oe=Uh(d,u.strides);D.slice&&(oe+=D.slice.flatOffset),X.slice={flatOffset:oe,origDataId:D.slice&&D.slice.origDataId||u.dataId};var he=this.dataRefCount.get(X.slice.origDataId)||1;return this.dataRefCount.set(X.slice.origDataId,he+1),z},h.prototype.stridedSlice=function(u,d,y,D){if(this.shouldExecuteOnCPU([u]))return this.cpuBackend.stridedSlice(u,d,y,D);var z=Rl(d,y,D);if(z.some(function(oe){return oe===0}))return ko([],z);var X=new function(oe,he,xe){this.variableNames=["x"],this.outputShape=xe;var Fe=xe.length,Re=Rn(xe.length),Me=Rn(xe.length),We="";if(Fe===1)We="coords * strides + begin";else{var Ze=0;We=xe.map(function(Je,at){return Ze++,xe.length===1?"coords * strides["+at+"] + begin["+at+"]":"coords["+(Ze-1)+"] * strides["+at+"] + begin["+at+"]"}).join(",")}this.userCode=`
      `+Re+" begin = "+Re+"("+oe+`);
      `+Re+" strides = "+Re+"("+he+`);

      void main() {
        `+Me+` coords = getOutputCoords();
        setOutput(getX(`+We+`));
      }
    `}(d,D,z);return this.compileAndRun(X,[u])},h.prototype.reverse=function(u,d){var y=P().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new function(D,z){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;var X=D.length;if(X>4)throw new Error("WebGL backend: Reverse of rank-"+X+" tensor is not yet supported");this.outputShape=D;var oe=N("rc",X),he=oe[X-1]+" + 1 < "+this.outputShape[X-1],xe=oe[X-2]+" + 1 < "+this.outputShape[X-2],Fe=Rn(X);function Re(Me){var We=D.map(function(Ze,Je){return function(at,yt){return z.indexOf(at)!==-1&&D[at]!==1?D[at]+" - "+yt[at]+" - 1":""+yt[at]}(Je,Me)});return"getChannel(getX("+We.join(",")+"), vec2("+We.slice(-2).join(",")+"))"}this.userCode=X===1?`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(`+D[0]+` - rc - 1),
            `+D[0]+` - rc - 1);
          if(`+he+`){
              result.g = getChannel(getX(`+D[0]+` - (rc  + 1) - 1),
                `+D[0]+` - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `:`
        void main() {
          `+Fe+` rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = `+Re(oe.slice())+`;
          if(`+he+`){
            result.g = `+function(Me){return Me[X-1]="("+Me[X-1]+" + 1)",Re(Me)}(oe.slice())+`;
          }
          if(`+xe+`) {
            result.b = `+function(Me){return Me[X-2]="("+Me[X-2]+" + 1)",Re(Me)}(oe.slice())+`;
            if(`+he+`) {
              result.a = `+function(Me){return Me[X-1]="("+Me[X-1]+" + 1)",Me[X-2]="("+Me[X-2]+" + 1)",Re(Me)}(oe.slice())+`;
            }
          }
          setOutput(result);
        }
    `}(u.shape,d):new function(D,z){this.variableNames=["x"];var X=D.length;if(X>4)throw new Error("WebGL backend: Reverse of rank-"+X+" tensor is not yet supported");if(this.outputShape=D,X!==1){var oe=D.map(function(xe,Fe){return function(Re){return z.indexOf(Re)!==-1&&D[Re]!==1?D[Re]+" - coords["+Re+"] - 1":"coords["+Re+"]"}(Fe)}).join(","),he=Rn(X);this.userCode=`
      void main() {
        `+he+` coords = getOutputCoords();
        setOutput(getX(`+oe+`));
      }
    `}else this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(`+D[0]+` - coord - 1));
        }
      `}(u.shape,d);return this.compileAndRun(y,[u])},h.prototype.concat=function(u,d){if(u[0].dtype==="complex64"){var y=u.map(function(Me){return ca(Me)}),D=u.map(function(Me){return Ua(Me)});return ho(this.concat(y,d),this.concat(D,d))}if(this.shouldExecuteOnCPU(u))return this.cpuBackend.concat(u,d);if(u.length===1)return u[0];if(u.length>P().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){var z=Math.floor(u.length/2),X=this.concat(u.slice(0,z),d),oe=this.concat(u.slice(z),d);return this.concat([X,oe],d)}if(P().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&u[0].rank>1){var he=new function(Me,We){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=tu(Me,We);var Ze=this.outputShape,Je=Ze.length,at=Rn(Je),yt=N("coords",Je),xt=["x","y","z","w","u","v"].slice(0,Je);this.variableNames=Me.map(function(o,l){return"T"+l});var kt=new Array(Me.length-1);kt[0]=Me[0][We];for(var It=1;It<kt.length;It++)kt[It]=kt[It-1]+Me[It][We];var Jt=xt[We],on=xt.slice(-2),Qt=xt.join(),cn="if ("+Jt+" < "+kt[0]+`) {
        return getChannel(
            getT0(`+Qt+"), vec2("+on.join()+`));
        }`;for(It=1;It<kt.length;It++){var vn=kt[It-1];cn+=`
        if (`+Jt+" < "+kt[It]+"  && "+Jt+" >= "+kt[It-1]+`) {
          return getChannel(
            getT`+It+"("+to(xt,Jt,vn)+`),
            vec2(`+to(on,Jt,vn)+`));
        }`}var p=kt.length,c=kt[kt.length-1];cn+=`
        return getChannel(
          getT`+p+"("+to(xt,Jt,c)+`),
          vec2(`+to(on,Jt,c)+"));",this.userCode=`
      float getValue(`+xt.map(function(o){return"int "+o})+`) {
        `+cn+`
      }

      void main() {
        `+at+` coords = getOutputCoords();
        vec4 result = vec4(getValue(`+yt+`), 0., 0., 0.);

        `+yt[Je-1]+" = "+yt[Je-1]+` + 1;
        if (`+yt[Je-1]+" < "+Ze[Je-1]+`) {
          result.g = getValue(`+yt+`);
        }

        `+yt[Je-2]+" = "+yt[Je-2]+` + 1;
        if (`+yt[Je-2]+" < "+Ze[Je-2]+`) {
          result.a = getValue(`+yt+`);
        }

        `+yt[Je-1]+" = "+yt[Je-1]+` - 1;
        if (`+yt[Je-2]+" < "+Ze[Je-2]+` &&
            `+yt[Je-1]+" < "+Ze[Je-1]+`) {
          result.b = getValue(`+yt+`);
        }
        setOutput(result);
      }
    `}(u.map(function(Me){return Me.shape}),d);return this.compileAndRun(he,u)}var xe=tu(u.map(function(Me){return Me.shape}),d),Fe=u.map(function(Me){return Me.as2D(-1,Ye(Me.shape.slice(d)))}),Re=new function(Me){this.outputShape=[],this.outputShape=tu(Me,1),this.variableNames=Me.map(function(kt,It){return"T"+It});var We=new Array(Me.length-1);We[0]=Me[0][1];for(var Ze=1;Ze<We.length;Ze++)We[Ze]=We[Ze-1]+Me[Ze][1];var Je=["if (yC < "+We[0]+") setOutput(getT0(yR, yC));"];for(Ze=1;Ze<We.length;Ze++){var at=We[Ze-1];Je.push("else if (yC < "+We[Ze]+") setOutput(getT"+Ze+"(yR, yC-"+at+"));")}var yt=We.length,xt=We[We.length-1];Je.push("else setOutput(getT"+yt+"(yR, yC-"+xt+"));"),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        `+Je.join(`
        `)+`
      }
    `}(Fe.map(function(Me){return Me.shape}));return this.compileAndRun(Re,Fe).reshape(xe)},h.prototype.neg=function(u){if(this.shouldExecuteOnCPU([u]))return this.cpuBackend.neg(u);if(P().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(u,Om,u.dtype);var d=new ci(u.shape,Om);return this.compileAndRun(d,[u])},h.prototype.batchMatMul=function(u,d,y,D){var z=y?u.shape[2]:u.shape[1],X=D?d.shape[1]:d.shape[2],oe=y?u.shape[1]:u.shape[2],he=u.shape[0];if((z===1||X===1)&&oe>1e3){y&&(u=u.transpose([0,2,1])),D&&(d=d.transpose([0,2,1]));var xe=X===1?u:u.as3D(he,oe,1),Fe=X===1?2:1,Re=X===1?d.as3D(he,1,oe):d;return this.multiply(xe,Re).sum(Fe,!0)}var Me=fn(u.dtype,d.dtype),We=new Io(u.shape,[he,z,X],y,D);return this.compileAndRun(We,[u,d],Me)},h.prototype.fusedBatchMatMul=function(u){var d=u.a,y=u.b,D=u.transposeA,z=u.transposeB,X=u.bias,oe=u.activation,he=u.preluActivationWeights,xe=D?d.shape[2]:d.shape[1],Fe=z?y.shape[1]:y.shape[2],Re=d.shape[0],Me=fn(d.dtype,y.dtype),We=X!=null,Ze=he!=null,Je=oe?Sm(oe,!0):null,at=new Io(d.shape,[Re,xe,Fe],D,z,We,Je,Ze),yt=[d,y];return X&&yt.push(X),he&&yt.push(he),this.compileAndRun(at,yt,Me)},h.prototype.multiply=function(u,d){if(u.dtype==="complex64"){var y=this.texData.get(u.dataId),D=this.texData.get(d.dataId),z=new dr("return areal * breal - aimag * bimag;",u.shape,d.shape),X=new dr("return areal * bimag + aimag * breal;",u.shape,d.shape),oe=[this.makeComplexComponentTensorInfo(u,y.complexTensors.real),this.makeComplexComponentTensorInfo(u,y.complexTensors.imag),this.makeComplexComponentTensorInfo(d,D.complexTensors.real),this.makeComplexComponentTensorInfo(d,D.complexTensors.imag)],he=this.compileAndRun(z,oe),xe=this.compileAndRun(X,oe),Fe=this.complex(he,xe);return he.dispose(),xe.dispose(),Fe}if(this.shouldExecuteOnCPU([u,d]))return this.cpuBackend.multiply(u,d);if(P().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(u,d,xr,u.dtype);var Re=new Wr(xr,u.shape,d.shape);return this.compileAndRun(Re,[u,d],u.dtype)},h.prototype.batchNormalization=function(u,d,y,D,z,X){var oe=[u,d,y],he=null;X!=null&&(he=X.shape,oe.push(X));var xe=null;if(z!=null&&(xe=z.shape,oe.push(z)),P().getBool("WEBGL_PACK_NORMALIZATION")){var Fe=new function(Me,We,Ze,Je,at,yt){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],Hi(Me,We),Hi(Me,Ze);var xt="vec4(0.0)";Je!=null&&(Hi(Me,Je),this.variableNames.push("offset"),xt="getOffsetAtOutCoords()");var kt="vec4(1.0)";at!=null&&(Hi(Me,at),this.variableNames.push("scale"),kt="getScaleAtOutCoords()"),this.outputShape=Me,this.userCode=`
      void main() {
        vec4 offset = `+xt+`;
        vec4 scale = `+kt+`;

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(`+yt+`));

        setOutput((x - mean) * inv + offset);
      }
    `}(u.shape,d.shape,y.shape,he,xe,D);return this.compileAndRun(Fe,oe)}var Re=new function(Me,We,Ze,Je,at,yt){this.outputShape=[],this.variableNames=["x","mean","variance"],Hi(Me,We),Hi(Me,Ze);var xt="0.0";Je!=null&&(Hi(Me,Je),this.variableNames.push("offset"),xt="getOffsetAtOutCoords()");var kt="1.0";at!=null&&(Hi(Me,at),this.variableNames.push("scale"),kt="getScaleAtOutCoords()"),this.outputShape=Me,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = `+xt+`;
        float scale = `+kt+`;
        float inv = scale * inversesqrt(variance + float(`+yt+`));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `}(u.shape,d.shape,y.shape,he,xe,D);return this.compileAndRun(Re,oe)},h.prototype.localResponseNormalization4D=function(u,d,y,D,z){var X=P().getBool("WEBGL_PACK_NORMALIZATION")?new function(oe,he,xe,Fe,Re){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;var Me,We=he,Ze=oe[3]-1;this.outputShape=oe;var Je="float("+xe+") + float("+Fe+") * sum";Me=Re===.5?"inversesqrt("+Je+")":Re===1?"1.0/("+Je+")":"exp(log("+Je+") * float(-"+Re+"));",this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < `+this.outputShape[3]+`;
        bool hasNextRow = c < `+this.outputShape[2]+`;

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - `+We+`;
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - `+We+"; j <= "+We+`; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(`+Ze+`));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * `+Me+`;
        setOutput(result);
      }
    `}(u.shape,d,y,D,z):new function(oe,he,xe,Fe,Re){this.variableNames=["x"],this.outputShape=[];var Me,We=he,Ze=oe[3]-1;this.outputShape=oe;var Je="float("+xe+") + float("+Fe+") * sum";Me=Re===.5?"inversesqrt("+Je+")":Re===1?"1.0/("+Je+")":"exp(log("+Je+") * float(-"+Re+"));",this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -`+We+"; j <= "+We+`; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  `+Ze+`) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * `+Me+`;
        setOutput(val);
      }
    `}(u.shape,d,y,D,z);return this.compileAndRun(X,[u])},h.prototype.LRNGrad=function(u,d,y,D,z,X,oe){var he=new function(xe,Fe,Re,Me,We){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=xe,this.depth=xe[3],this.depthRadius=Fe,this.bias=Re,this.alpha=Me,this.beta=We,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < `+this.depth+`; ++d) {
          int depthBegin = int(max(0.0, float(d - `+Fe+`)));
          int depthEnd = int(min(float(`+this.depth+`),
              float(d + `+Fe+` + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = `+this.depth+`;

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(`+Me+") * norm + float("+Re+`);

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(`+Me+`)
                * float(`+We+`)
                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * `+We+`);
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `}(d.shape,D,z,X,oe);return this.compileAndRun(he,[d,y,u])},h.prototype.tile=function(u,d){if(u.dtype==="string"){var y=this.readSync(u.dataId).map(function(z){return hr(z)});return Bf(Ni(u.shape,u.dtype,y),d)}var D=new function(z,X){this.variableNames=["A"];for(var oe=new Array(z.length),he=0;he<oe.length;he++)oe[he]=z[he]*X[he];this.outputShape=oe,this.rank=oe.length;var xe=Rn(this.rank),Fe=function(Re){var Me=Re.length;if(Me>5)throw Error("Tile for rank "+Me+" is not yet supported");if(Me===1)return"imod(resRC, "+Re[0]+")";for(var We=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],Ze=[],Je=0;Je<Re.length;Je++)Ze.push("imod("+We[Je]+", "+Re[Je]+")");return Ze.join()}(z);this.userCode=`
      void main() {
        `+xe+` resRC = getOutputCoords();
        setOutput(getA(`+Fe+`));
      }
    `}(u.shape,d);return this.compileAndRun(D,[u])},h.prototype.pad=function(u,d,y){var D=P().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new function(z,X,oe){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=X.map(function(Jt,on){return Jt[0]+z[on]+Jt[1]});for(var he=z.length,xe=Rn(he),Fe=X.map(function(Jt){return Jt[0]}).join(","),Re=X.map(function(Jt,on){return Jt[0]+z[on]}).join(","),Me=N("rc",he),We=N("source",he),Ze=Me[he-1]+" < "+this.outputShape[he-1],Je=he===1?"source":"vec2("+We.slice(-2).join()+")",at=[xe+" rc = outputLoc;",Me[he-1]+` += 1;
       if(`+Ze+`) {
      `,he===1?"":`}
       rc = outputLoc;
       `+Me[he-2]+` += 1;
       if(`+Me[he-2]+" < "+this.outputShape[he-2]+") {",he===1?"":"  "+Me[he-1]+` += 1;
         if(`+Ze+") {"],yt=he===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",xt="",kt=0,It=he===1?2:4;kt<It;kt++)xt+=`
        `+at[kt]+`
        if (`+yt+`) {
          result[`+kt+"] = float("+oe+`);
        } else {
          `+xe+` source = rc - start;
          result[`+kt+"] = getChannel(getX("+We.join()+"), "+Je+`);
        }
      `;xt+=he===1?"} ":"}}",this.userCode=`
      const `+xe+" start = "+xe+"("+Fe+`);
      const `+xe+" end = "+xe+"("+Re+`);

      void main() {
        `+xe+` outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        `+xt+`
        setOutput(result);
      }
    `}(u.shape,d,y):new function(z,X,oe){this.variableNames=["x"],this.outputShape=X.map(function(We,Ze){return We[0]+z[Ze]+We[1]});var he=z.length,xe=Rn(he),Fe=X.map(function(We){return We[0]}).join(","),Re=X.map(function(We,Ze){return We[0]+z[Ze]}).join(","),Me=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,he);this.userCode=he!==1?`
      `+xe+" start = "+xe+"("+Fe+`);
      `+xe+" end = "+xe+"("+Re+`);

      void main() {
        `+xe+` outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(float(`+oe+`));
        } else {
          `+xe+` coords = outC - start;
          setOutput(getX(`+Me+`));
        }
      }
    `:`
        int start = `+Fe+`;
        int end = `+Re+`;

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(float(`+oe+`));
          } else {
            setOutput(getX(outC - start));
          }
        }
      `}(u.shape,d,y);return this.compileAndRun(D,[u])},h.prototype.transpose=function(u,d){if(this.shouldExecuteOnCPU([u]))return this.cpuBackend.transpose(u,d);var y=P().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new function(D,z){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;for(var X=new Array(D.length),oe=0;oe<X.length;oe++)X[oe]=D[z[oe]];if(this.outputShape=X,this.rank=X.length,this.rank>6)throw Error("Packed transpose for rank "+this.rank+" is not yet supported.");var he=Rn(this.rank),xe=C("rc",this.rank),Fe=new Array(this.rank);for(oe=0;oe<z.length;oe++)Fe[z[oe]]=xe[oe];var Re="vec2("+Fe.slice(-2).join()+")",Me="++"+xe[this.rank-1]+" < "+X[this.rank-1],We="getChannel(getA("+Fe.join()+"), "+Re+")";this.userCode=`
    void main() {
      `+he+` rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = `+We+`;
      if(`+Me+`) {
        result[1] = `+We+`;
      }
      --`+xe[this.rank-1]+`;
      if(++`+xe[this.rank-2]+" < "+X[this.rank-2]+`) {
        result[2] = `+We+`;
        if(`+Me+`) {
          result[3] = `+We+`;
        }
      }
      setOutput(result);
    }
    `}(u.shape,d):new function(D,z){this.variableNames=["A"];for(var X=new Array(D.length),oe=0;oe<X.length;oe++)X[oe]=D[z[oe]];this.outputShape=X,this.rank=X.length;var he=Rn(this.rank),xe=function(Fe){var Re=Fe.length;if(Re>6)throw Error("Transpose for rank "+Re+" is not yet supported");for(var Me=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],We=new Array(Re),Ze=0;Ze<Fe.length;Ze++)We[Fe[Ze]]=Me[Ze];return We.join()}(z);this.userCode=`
    void main() {
      `+he+` resRC = getOutputCoords();
      setOutput(getA(`+xe+`));
    }
    `}(u.shape,d);return this.compileAndRun(y,[u])},h.prototype.gather=function(u,d,y){if(this.shouldExecuteOnCPU([u,d]))return this.cpuBackend.gather(u,d,y);var D=new function(z,X,oe){this.variableNames=["A","indices"];var he=z.slice();he[oe]=X,this.outputShape=he,this.rank=he.length;var xe=Rn(this.rank),Fe=function(Re,Me){var We=Re.length;if(We>4)throw Error("Gather for rank "+We+" is not yet supported");if(We===1)return"int(getIndices(resRC))";for(var Ze=["resRC.x","resRC.y","resRC.z","resRC.w"],Je=[],at=0;at<Re.length;at++)at===Me?Je.push("int(getIndices("+Ze[at]+"))"):Je.push(""+Ze[at]);return Je.join()}(z,oe);this.userCode=`
      void main() {
        `+xe+` resRC = getOutputCoords();
        setOutput(getA(`+Fe+`));
      }
    `}(u.shape,d.size,y);return this.compileAndRun(D,[u,d])},h.prototype.batchToSpaceND=function(u,d,y){ke(u.rank<=4,function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"});var D=d.reduce(function(Fe,Re){return Fe*Re}),z=Uu(u.shape,d,D),X=Df(z.length,d.length),oe=Tf(u.shape,d,D),he=Xc(y,d.length),xe=Vd(oe,y,d.length);return u.reshape(z).transpose(X).reshape(oe).slice(he,xe)},h.prototype.spaceToBatchND=function(u,d,y){ke(u.rank<=4,function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"});var D=d.reduce(function(Re,Me){return Re*Me}),z=[[0,0]];z.push.apply(z,y);for(var X=1+d.length;X<u.shape.length;++X)z.push([0,0]);var oe=u.pad(z),he=Uu(oe.shape,d,D,!1),xe=Df(he.length,d.length,!1),Fe=Tf(oe.shape,d,D,!1);return oe.reshape(he).transpose(xe).reshape(Fe)},h.prototype.reduce=function(u,d,y){var D=u.shape[0],z=u.shape[1],X=new function(he,xe){this.variableNames=["x"];var Fe=he.windowSize,Re=he.batchSize,Me=he.inSize,We=Math.ceil(Me/Fe);this.outputShape=[Re,We];var Ze="0.0",Je="";xe==="prod"?Ze="1.0":xe==="min"?(Ze="1.0 / 1e-20",Je="min"):xe==="max"&&(Ze="-1.0 / 1e-20",Je="max");var at=xe+"("+xe+"("+xe+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";xe==="sum"?at="sumValue":xe==="prod"?at="prodValue":xe==="all"?at="allValue":xe==="any"&&(at="anyValue");var yt=4*Math.floor(Fe/4),xt=Fe%4,kt=`
      if (`+(xe==="sum")+`) {
        sumValue += dot(values, ones);
      } else if (`+(xe==="prod")+`) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = `+Je+`(values, minMaxValue);
      }
    `,It="vec4";xe==="all"?(Ze="1.0",kt=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,It="bvec4"):xe==="any"&&(Ze="0.0",kt=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,It="bvec4");var Jt="";Me%Fe>0&&(Jt=`
        if (inIdx < 0 || inIdx >= `+Me+`) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = `+Ze+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        `+Jt+`
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `+Fe+`;

        vec4 minMaxValue = vec4(`+Ze+`);
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < `+yt+`; i += 4) {
          int inIdx = inOffset + i;
          `+It+" values = "+It+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          `+kt+`
        }

        int inIdx = inOffset + `+yt+`;
        if (`+(xt===1)+`) {
          `+It+" values = "+It+`(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          `+kt+`
        } else if (`+(xt===2)+`) {
          `+It+" values = "+It+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          `+kt+`
        } else if (`+(xt===3)+`) {
          `+It+" values = "+It+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          `+kt+`
        }
        setOutput(`+at+`);
      }
    `}({windowSize:Il(z),inSize:z,batchSize:D},d),oe=this.compileAndRun(X,[u],y);return oe.shape[1]===1?oe:this.reduce(oe,d,y)},h.prototype.argReduce=function(u,d,y){y===void 0&&(y=null);var D=u.shape[0],z=u.shape[1];y!=null&&(D=y.shape[0],z=y.shape[1]);var X=new function(xe,Fe,Re){this.variableNames=["A"];var Me=xe.windowSize,We=xe.batchSize,Ze=xe.inSize,Je=Math.ceil(Ze/Me);Re||this.variableNames.push("bestIndicesA"),this.outputShape=[We,Je];var at=Fe==="max"?">":"<",yt=Re?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `+Me+`;

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < `+Me+`; i++) {
          int inIdx = `+yt+`;
          float candidate = getA(batch, inIdx);
          if (candidate `+at+` bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `}({windowSize:Il(z),inSize:z,batchSize:D},d,y==null),oe=[u];y!=null&&oe.push(y);var he=this.compileAndRun(X,oe,"int32");return he.shape[1]===1?he:this.argReduce(u,d,he)},h.prototype.argReducePacked=function(u,d,y){y===void 0&&(y=null);var D=y!=null?y.shape:u.shape,z=new function(he,xe,Fe,Re){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,ke(he.length>2,function(){return"Packed arg"+(Fe.charAt(0).toUpperCase()+Fe.slice(1))+" supports only inputs with rank above 2."});var Me=he[he.length-1],We=Math.ceil(Me/xe);this.outputShape=he.slice(0,-1),We>1&&this.outputShape.push(We),Re||this.variableNames.push("bestIndicesA");var Ze,Je,at=this.outputShape,yt=at.length,xt=Rn(yt),kt=N("coords",yt);if(We===1){var It=Rn(Je=yt+1);Ze=`
        `+It+" sourceLocR = "+It+"("+kt.join()+`, 0);
        ++`+kt[yt-1]+`;
        `+It+" sourceLocG = "+It+"("+kt.join()+`, 0);
        ++`+kt[yt-2]+`;
        `+It+" sourceLocA = "+It+"("+kt.join()+`, 0);
        --`+kt[yt-1]+`;
        `+It+" sourceLocB = "+It+"("+kt.join()+`, 0);
        --`+kt[yt-2]+";"}else Je=yt,Ze=`
        `+xt+` sourceLocR = coords;
        ++`+kt[yt-1]+`;
        `+xt+` sourceLocG = coords;
        ++`+kt[yt-2]+`;
        `+xt+` sourceLocA = coords;
        --`+kt[yt-1]+`;
        `+xt+` sourceLocB = coords;
        --`+kt[yt-2]+";";var Jt=["x","y","z","w","u","v"].slice(0,Je),on="."+Jt[Je-1],Qt=Jt.map(function(j){return"int "+j}),cn=N("sourceLocR",Je-1).concat("inIdx.r"),vn=N("sourceLocG",Je-1).concat("inIdx.g"),p=N("sourceLocB",Je-1).concat("inIdx.b"),c=N("sourceLocA",Je-1).concat("inIdx.a"),o=Fe==="max"?"greaterThan":"lessThan",l=Re?"":`
          inIdx = round(vec4(getBestIndicesAChannel(`+cn.join()+`),
                             getBestIndicesAChannel(`+vn.join()+`),
                             getBestIndicesAChannel(`+p.join()+`),
                             getBestIndicesAChannel(`+c.join()+")));",g=`vec4(
            getAChannel(`+cn.join()+`),
            hasNextCol ? getAChannel(`+vn.join()+`) : 0.,
            hasNextRow ? getAChannel(`+p.join()+`) : 0.,
            hasNextRow && hasNextCol ? getAChannel(`+c.join()+") : 0.)",S=Re?"":`
      float getBestIndicesAChannel(`+Qt.join()+`) {
        return getChannel(getBestIndicesA(`+Jt.join()+`),
                                          vec2(`+Jt.slice(-2).join()+`));
      }`;this.userCode=`
      float getAChannel(`+Qt.join()+`) {
        return getChannel(getA(`+Jt.join()+`),
                               vec2(`+Jt.slice(-2).join()+`));
      }
      `+S+`
      void main() {
        `+xt+` coords = getOutputCoords();
        bool hasNextCol = `+kt[yt-1]+" < "+(at[yt-1]-1)+`;
        bool hasNextRow = `+kt[yt-2]+" < "+(at[yt-2]-1)+`;
        `+Ze+`
        ivec4 srcIdx = ivec4(sourceLocR`+on+", sourceLocG"+on+`,
          sourceLocB`+on+", sourceLocA"+on+") * "+xe+`;
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = `+g+`;

        for (int i = 0; i < `+xe+`; i++) {
          inIdx = srcIdx;
          `+l+`
          vec4 candidate = `+g+`;
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(`+o+`(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `}(D,Il(D[D.length-1]),d,y==null),X=y==null?[u]:[u,y],oe=this.compileAndRun(z,X,"int32");return oe.rank===u.rank?this.argReducePacked(u,d,oe):oe},h.prototype.sum=function(u,d){Ko("sum",d,u.rank);var y=So(u.shape,d),D=y[0],z=Ye(y[1]),X=u.as2D(-1,z),oe=Jn(u.dtype);return this.reduce(X,"sum",oe).reshape(D)},h.prototype.prod=function(u,d){if(this.shouldExecuteOnCPU([u]))return this.cpuBackend.prod(u,d);var y=So(u.shape,d),D=y[0],z=Ye(y[1]),X=u.as2D(-1,z),oe=Jn(u.dtype);return this.reduce(X,"prod",oe).reshape(D)},h.prototype.unsortedSegmentSum=function(u,d,y){var D=0,z=Oa([D],u.rank),X=u;z!=null&&(X=u.transpose(z),D=Aa(1,u.rank)[0]);var oe=function(Me,We,Ze){for(var Je=[],at=Me.length,yt=0;yt<at;yt++)yt!==We?Je.push(Me[yt]):Je.push(Ze);return Je}(X.shape,D,y),he=Ye([X.shape[D]]),xe=X.as2D(-1,he),Fe=Jn(u.dtype),Re=this.segOpCompute(xe,"unsortedSegmentSum",d,Fe,y).reshape(oe);return z!=null&&(Re=Re.transpose(wu(z))),Re},h.prototype.segOpCompute=function(u,d,y,D,z){var X=u.shape[0],oe=u.shape[1],he=function(Re,Me){var We,Ze=!1;for(Re<=qd?(We=Re,Ze=!0):We=Dr(Re,Math.floor(Math.sqrt(Re)));!Ze;)We>Me||We===Re?Ze=!0:We=Dr(Re,We+1);return We}(oe,z),xe=new function(Re,Me){this.variableNames=["x","segmentIds"];var We=Re.windowSize,Ze=Re.batchSize,Je=Re.inSize,at=Re.numSegments,yt=at*Math.ceil(Je/We);this.outputShape=[Ze,yt];var xt=4*Math.floor(We/4),kt=We%4,It=`
        sumValue += dot(values, segFilter);
    `,Jt="";Je%We>0&&(Jt=`
        if (inIdx < 0 || inIdx >= `+Je+`) {
          return initializationValue;
        }
      `);var on="";Je%We>0&&(on=`
        if (inIdx < 0 || inIdx >= `+Je+`) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = 0.0;

      float getValue(int batch, int inIdx) {
        `+Jt+`
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        `+on+`
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          `+at+")) * float("+We+`));
        int currentSeg = int(mod(float(outIdx), float(`+at+`)));

        float sumValue = 0.0;

        for (int i = 0; i < `+xt+`; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          `+It+`
        }

        int inIdx = inOffset + `+xt+`;
        if (`+(kt===1)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          `+It+`
        } else if (`+(kt===2)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          `+It+`
        } else if (`+(kt===3)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          `+It+`
        }
        setOutput(sumValue);
      }
    `}({windowSize:he,inSize:oe,batchSize:X,numSegments:z}),Fe=this.compileAndRun(xe,[u,y],D);return Fe.shape[1]===z?Fe:(y=oc(0,z).tile([oe/he]),this.segOpCompute(Fe,d,y,D,z))},h.prototype.argMinMaxReduce=function(u,d,y){var D=[d];if(Ko("arg"+y.charAt(0).toUpperCase()+y.slice(1),D,u.rank),!P().getBool("WEBGL_PACK_REDUCE")||u.rank<=2){var z=So(u.shape,D),X=z[0],oe=Ye(z[1]),he=u.as2D(-1,oe);return this.argReduce(he,y).reshape(X)}return this.argReducePacked(u,y)},h.prototype.argMin=function(u,d){return this.argMinMaxReduce(u,d,"min")},h.prototype.argMax=function(u,d){return this.argMinMaxReduce(u,d,"max")},h.prototype.cumsum=function(u,d,y,D){if(d!==u.rank-1)throw new Error("WebGL cumsum shader expects an inner-most axis="+(u.rank-1)+" but got axis="+d);var z=new function(X,oe,he){this.variableNames=["x"],this.outputShape=X;var xe=X.length,Fe=X[X.length-1],Re=he?"<":">";this.userCode=`
      int getIndex(int i) {
        `+(he?"return "+Fe+" -i - 1;":"return i;")+`
      }

      void main() {
        `+Rn(xe)+` coords = getOutputCoords();
        int end = `+no(xe,"coords")+`;
        float val = 0.0;
        for (int i = `+Fe+` - 1; i >= 0; i -= 1) {
          int idx = getIndex(i);
          if (idx `+Re+` end) {
            continue;
          }
          if (idx == end && `+oe+`) {
            continue;
          }
          `+no(xe,"coords")+` = idx;
          val += getX(`+function(Me,We){if(Me===1)return""+We;if(Me===2)return We+".x, "+We+".y";if(Me===3)return We+".x, "+We+".y, "+We+".z";if(Me===4)return We+".x, "+We+".y, "+We+".z, "+We+".w";throw Error("Cumulative sum for rank "+Me+" is not yet supported")}(xe,"coords")+`);
        }
        setOutput(val);
      }
    `}(u.shape,y,D);return this.compileAndRun(z,[u])},h.prototype.equal=function(u,d){if(P().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(u,d,`
  return vec4(equal(a, b));
`,"bool");var y=new Wr("return float(a == b);",u.shape,d.shape);return this.compileAndRun(y,[u,d],"bool")},h.prototype.notEqual=function(u,d){if(P().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(u,d,`
  return vec4(notEqual(a, b));
`,"bool");var y=new Wr("return float(a != b);",u.shape,d.shape);return this.compileAndRun(y,[u,d],"bool")},h.prototype.less=function(u,d){if(this.shouldExecuteOnCPU([u,d]))return this.cpuBackend.less(u,d);if(P().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(u,d,`
  return vec4(lessThan(a, b));
`,"bool");var y=new Wr("return float(a < b);",u.shape,d.shape);return this.compileAndRun(y,[u,d],"bool")},h.prototype.lessEqual=function(u,d){if(P().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(u,d,`
  return vec4(lessThanEqual(a, b));
`,"bool");var y=new Wr("return float(a <= b);",u.shape,d.shape);return this.compileAndRun(y,[u,d],"bool")},h.prototype.greater=function(u,d){if(this.shouldExecuteOnCPU([u,d]))return this.cpuBackend.greater(u,d);if(P().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(u,d,`
  return vec4(greaterThan(a, b));
`,"bool");var y=new Wr("return float(a > b);",u.shape,d.shape);return this.compileAndRun(y,[u,d],"bool")},h.prototype.greaterEqual=function(u,d){if(P().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(u,d,`
  return vec4(greaterThanEqual(a, b));
`,"bool");var y=new Wr("return float(a >= b);",u.shape,d.shape);return this.compileAndRun(y,[u,d],"bool")},h.prototype.logicalNot=function(u){var d=new ci(u.shape,"return float(!(x >= 1.0));");return this.compileAndRun(d,[u])},h.prototype.logicalAnd=function(u,d){if(P().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(u,d,`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,"bool");var y=new Wr("return float(a >= 1.0 && b >= 1.0);",u.shape,d.shape);return this.compileAndRun(y,[u,d],"bool")},h.prototype.logicalOr=function(u,d){if(P().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(u,d,`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,"bool");var y=new Wr("return float(a >= 1.0 || b >= 1.0);",u.shape,d.shape);return this.compileAndRun(y,[u,d],"bool")},h.prototype.select=function(u,d,y){var D=new function(z,X,oe){var he,xe;if(this.variableNames=["c","a","b"],this.outputShape=X,oe>4)throw Error("Where for rank "+oe+" is not yet supported");if(oe===1)xe="resRC",he="resRC";else{for(var Fe=["resRC.x","resRC.y","resRC.z","resRC.w"],Re=[],Me=[],We=0;We<X.length;We++)Me.push(""+Fe[We]),We<z&&Re.push(""+Fe[We]);he=Re.join(),xe=Me.join()}var Ze=Rn(oe);this.userCode=`
      void main() {
        `+Ze+` resRC = getOutputCoords();
        float cVal = getC(`+he+`);
        if (cVal >= 1.0) {
          setOutput(getA(`+xe+`));
        } else {
          setOutput(getB(`+xe+`));
        }
      }
    `}(u.rank,d.shape,d.rank);return this.compileAndRun(D,[u,d,y],fn(d.dtype,y.dtype))},h.prototype.where=function(u){qc("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var d=u.dataSync();return G(u.shape,d)},h.prototype.topk=function(u,d,y){return Q(u.dataSync(),u.shape,u.dtype,d)},h.prototype.min=function(u,d){Ko("min",d,u.rank);var y=So(u.shape,d),D=y[0],z=Ye(y[1]),X=u.as2D(-1,z);return this.reduce(X,"min",X.dtype).reshape(D)},h.prototype.minimum=function(u,d){if(this.shouldExecuteOnCPU([u,d]))return this.cpuBackend.minimum(u,d);var y=P().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new li(`
  vec4 result = vec4(min(a, b));
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,u.shape,d.shape):new Wr(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return min(a, b);
`,u.shape,d.shape);return this.compileAndRun(y,[u,d])},h.prototype.mod=function(u,d){var y=P().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new li(`
  vec4 result = mod(a, b);
  vec4 isNaN = vec4(equal(b, vec4(0.0)));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,u.shape,d.shape):new Wr(`if (b == 0.0) return NAN;
  return mod(a, b);`,u.shape,d.shape);return this.compileAndRun(y,[u,d])},h.prototype.max=function(u,d){if(this.shouldExecuteOnCPU([u]))return this.cpuBackend.max(u,d);Ko("max",d,u.rank);var y=So(u.shape,d),D=y[0],z=Ye(y[1]),X=u.as2D(-1,z);return this.reduce(X,"max",X.dtype).reshape(D)},h.prototype.maximum=function(u,d){if(this.shouldExecuteOnCPU([u,d]))return this.cpuBackend.maximum(u,d);var y=P().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new li(`
  vec4 result = vec4(max(a, b));
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,u.shape,d.shape):new Wr(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return max(a, b);
`,u.shape,d.shape);return this.compileAndRun(y,[u,d])},h.prototype.all=function(u,d){Ko("all",d,u.rank);var y=So(u.shape,d),D=y[0],z=Ye(y[1]),X=u.as2D(-1,z);return this.reduce(X,"all",X.dtype).reshape(D)},h.prototype.any=function(u,d){Ko("any",d,u.rank);var y=So(u.shape,d),D=y[0],z=Ye(y[1]),X=u.as2D(-1,z);return this.reduce(X,"any",X.dtype).reshape(D)},h.prototype.realDivide=function(u,d){if(P().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(u,d,`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,"float32",!0);var y=new Wr(`
if (a == b) {
  return 1.0;
};
return a / b;`,u.shape,d.shape);return this.compileAndRun(y,[u,d],"float32")},h.prototype.floorDiv=function(u,d){if(P().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(u,d,`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,"int32");var y=new Wr(`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,u.shape,d.shape);return this.compileAndRun(y,[u,d],"int32")},h.prototype.add=function(u,d){if(u.dtype==="complex64"&&d.dtype==="complex64")return this.complexSeparableBinaryOp(u,d,Tr);if(this.shouldExecuteOnCPU([u,d]))return this.cpuBackend.add(u,d);var y=fn(u.dtype,d.dtype);if(P().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(u,d,Tr,y);var D=new Wr(Tr,u.shape,d.shape);return this.compileAndRun(D,[u,d],y)},h.prototype.packedUnaryOp=function(u,d,y){var D=new Lf(u.shape,d);return this.compileAndRun(D,[u],y)},h.prototype.packedBinaryOp=function(u,d,y,D,z){z===void 0&&(z=!1);var X=new li(y,u.shape,d.shape,z);return this.compileAndRun(X,[u,d],D)},h.prototype.complexSeparableBinaryOp=function(u,d,y){var D=this,z=this.texData.get(u.dataId),X=this.texData.get(d.dataId),oe=[[z.complexTensors.real,X.complexTensors.real],[z.complexTensors.imag,X.complexTensors.imag]].map(function(Re){var Me=Re[0],We=Re[1],Ze=D.makeComplexComponentTensorInfo(u,Me),Je=D.makeComplexComponentTensorInfo(d,We),at=new Wr(y,u.shape,d.shape);return D.compileAndRun(at,[Ze,Je],fn(Me.dtype,We.dtype))}),he=oe[0],xe=oe[1],Fe=this.complex(he,xe);return he.dispose(),xe.dispose(),Fe},h.prototype.makeComplexComponentTensorInfo=function(u,d){return{dataId:d.dataId,dtype:d.dtype,shape:u.shape}},h.prototype.addN=function(u){if(u.length===1)return u[0];if(u.length>P().get("WEBGL_MAX_TEXTURES_IN_SHADER")){var d=Math.floor(u.length/2),y=this.addN(u.slice(0,d)),D=this.addN(u.slice(d));return this.addN([y,D])}var z=u.map(function(he){return he.dtype}).reduce(function(he,xe){return fn(he,xe)}),X=u.map(function(he){return he.shape}),oe=P().getBool("WEBGL_PACK")?new function(he,xe){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=he,this.variableNames=xe.map(function(Me,We){return"T"+We});var Fe=[];this.variableNames.forEach(function(Me){Fe.push("vec4 v"+Me+" = get"+Me+"AtOutCoords();")});var Re=this.variableNames.map(function(Me){return"v"+Me}).join(" + ");this.userCode=`
      void main() {
        `+Fe.join(`
        `)+`

        vec4 result = `+Re+`;
        setOutput(result);
      }
    `}(u[0].shape,X):new function(he,xe){this.outputShape=[],this.outputShape=he,this.variableNames=xe.map(function(Me,We){return"T"+We});var Fe=[];this.variableNames.forEach(function(Me){Fe.push("float v"+Me+" = get"+Me+"AtOutCoords();")});var Re=this.variableNames.map(function(Me){return"v"+Me}).join(" + ");this.userCode=`
      void main() {
        `+Fe.join(`
        `)+`

        float result = `+Re+`;
        setOutput(result);
      }
    `}(u[0].shape,X);return this.compileAndRun(oe,u,z)},h.prototype.subtract=function(u,d){if(u.dtype==="complex64"&&d.dtype==="complex64")return this.complexSeparableBinaryOp(u,d,Vr);if(this.shouldExecuteOnCPU([u,d]))return this.cpuBackend.subtract(u,d);var y=fn(u.dtype,d.dtype);if(P().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(u,d,Vr,u.dtype);var D=new Wr(Vr,u.shape,d.shape);return this.compileAndRun(D,[u,d],y)},h.prototype.pow=function(u,d){var y=P().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new li(`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,u.shape,d.shape):new Wr(`
if(a < 0.0 && floor(b) < b){
  return NAN;
}
if (b == 0.0) {
  return 1.0;
}
return (round(mod(b, 2.0)) != 1) ?
    pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,u.shape,d.shape),D=fn(u.dtype,d.dtype);return this.compileAndRun(y,[u,d],D)},h.prototype.ceil=function(u){if(this.shouldExecuteOnCPU([u]))return this.cpuBackend.ceil(u);if(P().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(u,bg,u.dtype);var d=new ci(u.shape,bg);return this.compileAndRun(d,[u])},h.prototype.floor=function(u){if(this.shouldExecuteOnCPU([u]))return this.cpuBackend.floor(u);if(P().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(u,Am,u.dtype);var d=new ci(u.shape,Am);return this.compileAndRun(d,[u])},h.prototype.sign=function(u){var d=new ci(u.shape,`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`);return this.compileAndRun(d,[u])},h.prototype.isNaN=function(u){var d=new ci(u.shape,"return float(isnan(x));");return this.compileAndRun(d,[u],"bool")},h.prototype.isInf=function(u){var d=new ci(u.shape,"return float(isinf(x));");return this.compileAndRun(d,[u],"bool")},h.prototype.isFinite=function(u){var d=new ci(u.shape,"return float(!isnan(x) && !isinf(x));");return this.compileAndRun(d,[u],"bool")},h.prototype.round=function(u){var d=new ci(u.shape,`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`);return this.compileAndRun(d,[u])},h.prototype.exp=function(u){if(this.shouldExecuteOnCPU([u]))return this.cpuBackend.exp(u);if(P().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(u,xg,u.dtype);var d=new ci(u.shape,xg);return this.compileAndRun(d,[u])},h.prototype.expm1=function(u){if(this.shouldExecuteOnCPU([u]))return this.cpuBackend.expm1(u);if(P().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(u,Pf,u.dtype);var d=new ci(u.shape,Pf);return this.compileAndRun(d,[u])},h.prototype.softmax=function(u,d){var y=wn([d],u.shape),D=this.max(u,y),z=_o(D.shape,y),X=this.subtract(u,D.reshape(z)),oe=this.exp(X),he=this.sum(oe,y).reshape(z);return this.realDivide(oe,he)},h.prototype.log=function(u){if(this.shouldExecuteOnCPU([u]))return this.cpuBackend.log(u);if(P().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(u,`
  vec4 result = log(x);
  vec4 isNaN = vec4(lessThan(x, vec4(0.0)));
  result.r = isNaN.r == 1.0 ? NAN : result.r;
  result.g = isNaN.g == 1.0 ? NAN : result.g;
  result.b = isNaN.b == 1.0 ? NAN : result.b;
  result.a = isNaN.a == 1.0 ? NAN : result.a;

  return result;
`,u.dtype);var d=new ci(u.shape,`if (x < 0.0) return NAN;
  return log(x);`);return this.compileAndRun(d,[u])},h.prototype.log1p=function(u){var d=new ci(u.shape,"return log(1.0 + x);");return this.compileAndRun(d,[u])},h.prototype.sqrt=function(u){var d=new ci(u.shape,"return sqrt(x);");return this.compileAndRun(d,[u])},h.prototype.rsqrt=function(u){if(this.shouldExecuteOnCPU([u]))return this.cpuBackend.rsqrt(u);var d=new ci(u.shape,"return inversesqrt(x);");return this.compileAndRun(d,[u])},h.prototype.reciprocal=function(u){var d=new ci(u.shape,"return 1.0 / x;");return this.compileAndRun(d,[u])},h.prototype.relu=function(u){var d;return d=P().getBool("WEBGL_PACK")?new Lf(u.shape,kg):new ci(u.shape,vg),this.compileAndRun(d,[u])},h.prototype.relu6=function(u){var d;return d=P().getBool("WEBGL_PACK")?new Lf(u.shape,Eg):new ci(u.shape,yg),this.compileAndRun(d,[u])},h.prototype.prelu=function(u,d){var y=P().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new li(ai,u.shape,d.shape):new Wr($r,u.shape,d.shape);return this.compileAndRun(y,[u,d])},h.prototype.elu=function(u){if(P().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(u,_c,u.dtype);var d=new ci(u.shape,Cm);return this.compileAndRun(d,[u])},h.prototype.eluDer=function(u,d){var y=P().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new li(`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,u.shape,d.shape):new Wr("return (b >= 1.0) ? a : a * (b + 1.0);",u.shape,d.shape);return this.compileAndRun(y,[u,d])},h.prototype.selu=function(u){var d=new ci(u.shape,`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = 1.7580993408473768;
  float scale = 1.0507009873554805;
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`);return this.compileAndRun(d,[u])},h.prototype.int=function(u){var d=new ci(u.shape,"return float(int(x));");return this.compileAndRun(d,[u],"int32")},h.prototype.clip=function(u,d,y){var D,z=(D=P().getBool("WEBGL_PACK_CLIP")?new ni(u.shape):new Hr(u.shape)).getCustomSetupFunc(d,y);return this.compileAndRun(D,[u],null,z)},h.prototype.abs=function(u){if(this.shouldExecuteOnCPU([u]))return this.cpuBackend.abs(u);if(P().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(u,Ll,u.dtype);var d=new ci(u.shape,Ll);return this.compileAndRun(d,[u])},h.prototype.complexAbs=function(u){var d=this.texData.get(u.dataId),y=new function(z){this.variableNames=["real","imag"],this.outputShape=z,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `}(u.shape),D=[this.makeComplexComponentTensorInfo(u,d.complexTensors.real),this.makeComplexComponentTensorInfo(u,d.complexTensors.imag)];return this.compileAndRun(y,D)},h.prototype.sigmoid=function(u){var d=new ci(u.shape,"return 1.0 / (1.0 + exp(-1.0 * x));");return this.compileAndRun(d,[u])},h.prototype.softplus=function(u){var d=new ci(u.shape,`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`);return this.compileAndRun(d,[u])},h.prototype.sin=function(u){var d=new ci(u.shape,`if (isnan(x)) return x;
  return sin(x);
`);return this.compileAndRun(d,[u])},h.prototype.cos=function(u){var d=new ci(u.shape,`if (isnan(x)) return x;
  return cos(x);
`);return this.compileAndRun(d,[u])},h.prototype.tan=function(u){var d=new ci(u.shape,"return tan(x);");return this.compileAndRun(d,[u])},h.prototype.asin=function(u){var d=new ci(u.shape,`if (isnan(x)) return x;
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`);return this.compileAndRun(d,[u])},h.prototype.acos=function(u){var d=new ci(u.shape,`if (isnan(x)) return x;
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`);return this.compileAndRun(d,[u])},h.prototype.atan=function(u){var d=new ci(u.shape,`if (isnan(x)) return x;
  return atan(x);
`);return this.compileAndRun(d,[u])},h.prototype.atan2=function(u,d){var y=P().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new li(`
  vec4 result = atan(a, b);
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,u.shape,d.shape):new Wr(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return atan(a, b);
`,u.shape,d.shape);return this.compileAndRun(y,[u,d])},h.prototype.sinh=function(u){var d=new ci(u.shape,`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`);return this.compileAndRun(d,[u])},h.prototype.cosh=function(u){var d=new ci(u.shape,`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`);return this.compileAndRun(d,[u])},h.prototype.tanh=function(u){var d=new ci(u.shape,`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`);return this.compileAndRun(d,[u])},h.prototype.asinh=function(u){var d=new ci(u.shape,"if (isnan(x)) return x;return log(x + sqrt(x * x + 1.0));");return this.compileAndRun(d,[u])},h.prototype.acosh=function(u){var d=new ci(u.shape,`if (isnan(x)) return x;
  if (x < 1.0) return NAN;
  return log(x + sqrt(x * x - 1.0));`);return this.compileAndRun(d,[u])},h.prototype.atanh=function(u){var d=new ci(u.shape,`if (isnan(x)) return x;
  if ((x < -1.0) || (x > 1.0)) return NAN;
  return (log(1.0 + x) - log(1.0 - x)) / 2.0;`);return this.compileAndRun(d,[u])},h.prototype.erf=function(u){var d=new ci(u.shape,`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = 0.3275911;
  float a1 = 0.254829592;
  float a2 = -0.284496736;
  float a3 = 1.421413741;
  float a4 = -1.453152027;
  float a5 = 1.061405429;

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`);return this.compileAndRun(d,[u])},h.prototype.step=function(u,d){var y=new ci(u.shape,function(D){return D===void 0&&(D=0),Xd+`
    return x > 0.0 ? 1.0 : float(`+D+`);
  `}(d));return this.compileAndRun(y,[u])},h.prototype.conv2dByMatMul=function(u,d,y,D,z,X){var oe=u.shape,he=this.texData.get(u.dataId),xe=y.inChannels,Fe=oe[0]*oe[1]*oe[2],Re=y.outChannels,Me=y.dataFormat==="channelsLast",We=(Fe===1||Re===1)&&xe>1e3,Ze=oe[2]%2!=0&&!!he.isPacked;if(We||!P().getBool("WEBGL_LAZILY_UNPACK")||!P().getBool("WEBGL_PACK_BINARY_OPERATIONS")||!Ze){var Je=Me?oe[0]*oe[1]*oe[2]:oe[0]*oe[2]*oe[3],at=this.reshape(u,[1,Je,y.inChannels]),yt=this.reshape(d,[1,y.inChannels,y.outChannels]);return this.reshape(this.fusedBatchMatMul({a:at,b:yt,transposeA:!1,transposeB:!1,bias:D,activation:z,preluActivationWeights:X}),y.outShape)}var xt=Me?oe[0]*oe[1]*(oe[2]+1):oe[0]*oe[2]*(oe[3]+1),kt={dataId:u.dataId,shape:[1,xt,y.inChannels],dtype:u.dtype},It=he.shape;he.shape=he.shape.slice(),he.shape[he.shape.length-2]++,ke(cu(he.shape,kt.shape),function(){return"packed reshape "+he.shape+" to "+kt.shape+" isn't free"});var Jt=this.reshape(d,[1,y.inChannels,y.outChannels]),on=this.fusedBatchMatMul({a:kt,b:Jt,transposeA:!1,transposeB:!1,bias:D,activation:z,preluActivationWeights:X}),Qt=this.texData.get(on.dataId);return ke(Qt.isPacked,function(){return"batchMatMul result is expected to be packed"}),he.shape=It,Qt.shape=y.outShape,Ue.makeTensorFromDataId(on.dataId,y.outShape,on.dtype)},h.prototype.conv2dWithIm2Row=function(u,d,y,D,z,X){var oe=y.filterWidth,he=y.filterHeight,xe=y.inChannels,Fe=y.outWidth,Re=y.outHeight,Me=y.dataFormat==="channelsLast",We=oe*he*xe,Ze=Re*Fe,Je=[We,Ze],at=u.squeeze([0]),yt=d.reshape([1,We,-1]),xt=new function(p,c,o){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=p;for(var l=o.filterWidth,g=o.inChannels,S=o.strideWidth,j=o.strideHeight,V=o.padInfo,ne=o.outWidth,ae=o.dilationWidth,me=o.dilationHeight,Ee=o.dataFormat,Se=V.left,Ne=V.top,ze=g*l,$e=te(),qe=Ee==="channelsLast",tt=qe?0:1,lt=qe?1:2,ht="",vt=0;vt<=1;vt++)for(var Ct=0;Ct<=1;Ct++)ht+=`
          blockIndex = rc.y + `+Ct+`;
          pos = rc.x + `+vt+`;

          if(blockIndex < `+p[1]+" && pos < "+p[0]+`) {
            offsetY = int(blockIndex / (`+ne+")) * "+j+" - "+Ne+`;
            d0 = offsetY + `+me+" * (pos / "+ze+`);

            if(d0 < `+c[tt]+` && d0 >= 0) {

              offsetX = int(mod(float(blockIndex), `+ne+".) * "+S+". - "+Se+`.);
              d1 = offsetX + `+ae+" * (int(mod(float(pos), "+ze+".) / "+g+`.));

              if(d1 < `+c[lt]+` && d1 >= 0) {

                ch = int(mod(float(pos), `+g+`.));

                if (`+qe+`) {
                  innerDims = vec2(d1, ch);
                  result[`+(2*vt+Ct)+`] = getChannel(
                    getA(d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[`+(2*vt+Ct)+`] = getChannel(
                    getA(ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `;this.userCode=`
      void main() {
        ivec2 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        `+ht+`

        `+$e.output+` = result;
      }
    `}(Je,at.shape,y),kt=this.compileAndRun(xt,[at]).reshape([1,Je[0],Je[1]]),It=D!=null,Jt=X!=null,on=z?Sm(z,!0):null,Qt=new Io(kt.shape,[1,Ze,y.outChannels],!0,!1,It,on,Jt),cn=[kt,yt];D&&cn.push(D),Jt&&cn.push(X);var vn=this.compileAndRun(Qt,cn);return Me?vn.reshape([1,Re,Fe,y.outChannels]):vn.reshape([1,y.outChannels,Re,Fe])},h.prototype.fusedConv2d=function(u){var d=u.input,y=u.filter,D=u.convInfo,z=u.bias,X=u.activation,oe=u.preluActivationWeights;if(D.filterHeight===1&&D.filterWidth===1&&D.dilationHeight===1&&D.dilationWidth===1&&D.strideHeight===1&&D.strideWidth===1&&(D.padInfo.type==="SAME"||D.padInfo.type==="VALID"))return this.conv2dByMatMul(d,y,D,z,X,oe);if(P().getBool("WEBGL_CONV_IM2COL")&&d.shape[0]===1)return this.conv2dWithIm2Row(d,y,D,z,X,oe);var he=z!=null,xe=oe!=null,Fe=X?Sm(X,!1):null,Re=new Qi(D,he,Fe,xe),Me=[d,y];return z&&Me.push(z),oe&&Me.push(oe),this.compileAndRun(Re,Me)},h.prototype.conv2d=function(u,d,y){if(y.filterHeight===1&&y.filterWidth===1&&y.dilationHeight===1&&y.dilationWidth===1&&y.strideHeight===1&&y.strideWidth===1&&(y.padInfo.type==="SAME"||y.padInfo.type==="VALID"))return this.conv2dByMatMul(u,d,y);if(P().getBool("WEBGL_CONV_IM2COL")&&u.shape[0]===1)return this.conv2dWithIm2Row(u,d,y);var D=new Qi(y);return this.compileAndRun(D,[u,d])},h.prototype.conv2dDerInput=function(u,d,y){var D=new function(z){this.variableNames=["dy","W"],this.outputShape=z.inShape;var X=z.filterHeight,oe=z.filterWidth,he=z.strideHeight,xe=z.strideWidth,Fe=z.dataFormat==="channelsLast",Re=X-1-z.padInfo.top,Me=oe-1-z.padInfo.left,We=Fe?1:2,Ze=Fe?2:3,Je=Fe?3:1;this.userCode=`
      const ivec2 pads = ivec2(`+Re+", "+Me+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[`+Je+`];

        ivec2 dyCorner = ivec2(coords[`+We+"], coords["+Ze+`]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+X+`; wR++) {
          float dyR = float(dyRCorner + wR) / `+he+`.0;

          if (dyR < 0.0 || dyR >= `+z.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `+X+` - 1 - wR;

          for (int wC = 0; wC < `+oe+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+xe+`.0;

            if (dyC < 0.0 || dyC >= `+z.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `+oe+` - 1 - wC;

            for (int d2 = 0; d2 < `+z.outChannels+`; d2++) {

              if (`+Fe+`) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `}(y);return this.compileAndRun(D,[u,d])},h.prototype.conv2dDerFilter=function(u,d,y){var D=new function(z){this.variableNames=["x","dy"],this.outputShape=z.filterShape;var X=z.strideHeight,oe=z.strideWidth,he=z.padInfo.top,xe=z.padInfo.left,Fe=z.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < `+z.batchSize+`; b++) {
          for (int yR = 0; yR < `+z.outHeight+`; yR++) {
            int xR = wR + yR * `+X+" - "+he+`;

            if (xR < 0 || xR >= `+z.inHeight+`) {
              continue;
            }

            for (int yC = 0; yC < `+z.outWidth+`; yC++) {
              int xC = wC + yC * `+oe+" - "+xe+`;

              if (xC < 0 || xC >= `+z.inWidth+`) {
                continue;
              }

              if (`+Fe+`) {
                float dyValue = getDy(b, yR, yC, d2);
                float xValue = getX(b, xR, xC, d1);
                dotProd += (xValue * dyValue);
              } else {
                float dyValue = getDy(b, d2, yR, yC);
                float xValue = getX(b, d1, xR, xC);
                dotProd += (xValue * dyValue);
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `}(y);return this.compileAndRun(D,[u,d])},h.prototype.fusedDepthwiseConv2D=function(u){var d,y=u.input,D=u.filter,z=u.convInfo,X=u.bias,oe=u.activation,he=u.preluActivationWeights,xe=P().getBool("WEBGL_PACK_DEPTHWISECONV")&&z.strideWidth<=2&&z.outChannels/z.inChannels==1,Fe=oe?Sm(oe,xe):null,Re=[y,D],Me=X!=null,We=he!=null;return Me&&Re.push(X),We&&Re.push(he),xe?(d=new ji(z,Me,Fe,We),this.compileAndRun(d,Re)):(d=new zo(z,Me,Fe,We),this.compileAndRun(d,Re))},h.prototype.depthwiseConv2D=function(u,d,y){var D;return P().getBool("WEBGL_PACK_DEPTHWISECONV")&&y.strideWidth<=2&&y.outChannels/y.inChannels==1?(D=new ji(y),this.compileAndRun(D,[u,d])):(D=new zo(y),this.compileAndRun(D,[u,d]))},h.prototype.depthwiseConv2DDerInput=function(u,d,y){var D=new function(z){this.variableNames=["dy","W"],this.outputShape=z.inShape;var X=z.filterHeight,oe=z.filterWidth,he=z.strideHeight,xe=z.strideWidth,Fe=X-1-z.padInfo.top,Re=oe-1-z.padInfo.left,Me=z.outChannels/z.inChannels;this.userCode=`
      const ivec2 pads = ivec2(`+Fe+", "+Re+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < `+X+`; wR++) {
          float dyR = float(dyRCorner + wR) / `+he+`.0;

          if (dyR < 0.0 || dyR >= `+z.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `+X+` - 1 - wR;

          for (int wC = 0; wC < `+oe+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+xe+`.0;

            if (dyC < 0.0 || dyC >= `+z.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `+oe+` - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < `+Me+`; dm++) {
              int d2 = d1 * `+Me+` + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `}(y);return this.compileAndRun(D,[u,d])},h.prototype.depthwiseConv2DDerFilter=function(u,d,y){var D=new function(z){this.variableNames=["x","dy"],this.outputShape=z.filterShape;var X=z.strideHeight,oe=z.strideWidth,he=z.padInfo.top,xe=z.padInfo.left,Fe=z.outChannels/z.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * `+Fe+` + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < `+z.batchSize+`; b++) {
          for (int yR = 0; yR < `+z.outHeight+`; yR++) {
            int xR = wR + yR * `+X+" - "+he+`;

            if (xR < 0 || xR >= `+z.inHeight+`) {
              continue;
            }

            for (int yC = 0; yC < `+z.outWidth+`; yC++) {
              int xC = wC + yC * `+oe+" - "+xe+`;

              if (xC < 0 || xC >= `+z.inWidth+`) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `}(y);return this.compileAndRun(D,[u,d])},h.prototype.conv3d=function(u,d,y){var D=new function(z){this.variableNames=["x","W"],this.outputShape=z.outShape;var X=z.padInfo.front,oe=z.padInfo.top,he=z.padInfo.left,xe=z.strideDepth,Fe=z.strideHeight,Re=z.strideWidth,Me=z.dilationDepth,We=z.dilationHeight,Ze=z.dilationWidth,Je=z.filterDepth,at=z.filterHeight,yt=z.filterWidth,xt=4*Math.floor(z.inChannels/4),kt=z.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(`+xe+", "+Fe+", "+Re+`);
      const ivec3 pads = ivec3(`+X+", "+oe+", "+he+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < `+Je+`; wF++) {
          int xF = xFCorner + wF * `+Me+`;

          if (xF < 0 || xF >= `+z.inDepth+`) {
            continue;
          }

          for (int wR = 0; wR < `+at+`; wR++) {
            int xR = xRCorner + wR * `+We+`;

            if (xR < 0 || xR >= `+z.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+yt+`; wC++) {
              int xC = xCCorner + wC * `+Ze+`;

              if (xC < 0 || xC >= `+z.inWidth+`) {
                continue;
              }

              for (int d1 = 0; d1 < `+xt+`; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (`+(kt===1)+`) {
                dotProd +=
                  getX(batch, xF, xR, xC, `+xt+`) *
                  getW(wF, wR, wC, `+xt+`, d2);
              } else if (`+(kt===2)+`) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, `+xt+`),
                  getX(batch, xF, xR, xC, `+xt+` + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, `+xt+`, d2),
                  getW(wF, wR, wC, `+xt+` + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (`+(kt===3)+`) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, `+xt+`),
                  getX(batch, xF, xR, xC, `+xt+` + 1),
                  getX(batch, xF, xR, xC, `+xt+` + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, `+xt+`, d2),
                  getW(wF, wR, wC, `+xt+` + 1, d2),
                  getW(wF, wR, wC, `+xt+` + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}(y);return this.compileAndRun(D,[u,d])},h.prototype.conv3dDerInput=function(u,d,y){var D=new function(z){this.variableNames=["dy","W"],this.outputShape=z.inShape;var X=z.filterDepth,oe=z.filterHeight,he=z.filterWidth,xe=z.strideDepth,Fe=z.strideHeight,Re=z.strideWidth,Me=X-1-z.padInfo.front,We=oe-1-z.padInfo.top,Ze=he-1-z.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(`+Me+", "+We+", "+Ze+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < `+X+`; wF++) {
          float dyF = float(dyFCorner + wF) / `+xe+`.0;

          if (dyF < 0.0 || dyF >= `+z.outDepth+`.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = `+X+` - 1 - wF;

          for (int wR = 0; wR < `+oe+`; wR++) {
            float dyR = float(dyRCorner + wR) / `+Fe+`.0;

            if (dyR < 0.0 || dyR >= `+z.outHeight+`.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = `+oe+` - 1 - wR;

            for (int wC = 0; wC < `+he+`; wC++) {
              float dyC = float(dyCCorner + wC) / `+Re+`.0;

              if (dyC < 0.0 || dyC >= `+z.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = `+he+` - 1 - wC;

              for (int d2 = 0; d2 < `+z.outChannels+`; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}(y);return this.compileAndRun(D,[u,d])},h.prototype.conv3dDerFilter=function(u,d,y){var D=new function(z){this.variableNames=["x","dy"],this.outputShape=z.filterShape;var X=z.strideDepth,oe=z.strideHeight,he=z.strideWidth,xe=z.padInfo.front,Fe=z.padInfo.top,Re=z.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < `+z.batchSize+`; b++) {
          for (int yF = 0; yF < `+z.outDepth+`; yF++) {
            int xF = wF + yF * `+X+" - "+xe+`;

            if (xF < 0 || xF >= `+z.inDepth+`) {
              continue;
            }

            for (int yR = 0; yR < `+z.outHeight+`; yR++) {
              int xR = wR + yR * `+oe+" - "+Fe+`;

              if (xR < 0 || xR >= `+z.inHeight+`) {
                continue;
              }

              for (int yC = 0; yC < `+z.outWidth+`; yC++) {
                int xC = wC + yC * `+he+" - "+Re+`;

                if (xC < 0 || xC >= `+z.inWidth+`) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}(y);return this.compileAndRun(D,[u,d])},h.prototype.maxPool=function(u,d){var y=new hs(d,"max",!1);return this.compileAndRun(y,[u])},h.prototype.avgPool=function(u,d){var y=new hs(d,"avg",!1);return this.compileAndRun(y,[u],"float32")},h.prototype.maxPoolBackprop=function(u,d,y,D){var z=new hs(D,"max",!0),X=this.compileAndRun(z,[d]),oe=new function(xe){this.variableNames=["dy","maxPos"],this.outputShape=xe.inShape;var Fe=xe.strideHeight,Re=xe.strideWidth,Me=xe.dilationHeight,We=xe.effectiveFilterHeight,Ze=xe.effectiveFilterWidth,Je=We-1-xe.padInfo.top,at=Ze-1-xe.padInfo.left,yt=We*Ze-1;this.userCode=`
      const ivec2 pads = ivec2(`+Je+", "+at+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+We+`;
          wR += `+Me+`) {
          float dyR = float(dyRCorner + wR) / `+Fe+`.0;

          if (dyR < 0.0 || dyR >= `+xe.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `+Ze+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+Re+`.0;

            if (dyC < 0.0 || dyC >= `+xe.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = `+yt+` - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * `+Ze+` + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `}(D),he=this.compileAndRun(oe,[u,X],d.dtype);return X.dispose(),he},h.prototype.avgPoolBackprop=function(u,d,y){var D=new function(z){this.variableNames=["dy"],this.outputShape=z.inShape;var X=z.filterHeight,oe=z.filterWidth,he=z.strideHeight,xe=z.strideWidth,Fe=z.dilationHeight,Re=z.dilationWidth,Me=z.effectiveFilterHeight,We=z.effectiveFilterWidth,Ze=Me-1-z.padInfo.top,Je=We-1-z.padInfo.left,at=1/(X*oe);this.userCode=`
      const ivec2 pads = ivec2(`+Ze+", "+Je+`);
      const float avgMultiplier = float(`+at+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+Me+`;
            wR += `+Fe+`) {
          float dyR = float(dyRCorner + wR) / `+he+`.0;

          if (dyR < 0.0 || dyR >= `+z.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `+We+`;
            wC+= `+Re+`) {
            float dyC = float(dyCCorner + wC) / `+xe+`.0;

            if (dyC < 0.0 || dyC >= `+z.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `}(y);return this.compileAndRun(D,[u],d.dtype)},h.prototype.cast=function(u,d){return $s(u,d,this)},h.prototype.unstack=function(u,d){for(var y=u.shape[d],D=new Array(u.rank-1),z=0,X=0;X<u.rank;X++)X!==d&&(D[z++]=u.shape[X]);var oe=new Array(u.rank).fill(0),he=u.shape.slice();he[d]=1;var xe=new Array(y);for(X=0;X<xe.length;X++)oe[d]=X,xe[X]=this.slice(u,oe,he).reshape(D);return xe},h.prototype.avgPool3d=function(u,d){var y=new oo(d,"avg",!1);return this.compileAndRun(y,[u],"float32")},h.prototype.avgPool3dBackprop=function(u,d,y){var D=new function(z){this.variableNames=["dy"],this.outputShape=z.inShape;var X=z.filterDepth,oe=z.filterHeight,he=z.filterWidth,xe=z.strideDepth,Fe=z.strideHeight,Re=z.strideWidth,Me=z.dilationDepth,We=z.dilationHeight,Ze=z.dilationWidth,Je=z.effectiveFilterDepth,at=z.effectiveFilterHeight,yt=z.effectiveFilterWidth,xt=Je-1-z.padInfo.front,kt=at-1-z.padInfo.top,It=yt-1-z.padInfo.left,Jt=1/(X*oe*he);this.userCode=`
      const ivec3 pads = ivec3(`+xt+", "+kt+", "+It+`);
      const float avgMultiplier = float(`+Jt+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < `+Je+`;
            wD += `+Me+`) {
          float dyD = float(dyDCorner + wD) / `+xe+`.0;

          if (dyD < 0.0 || dyD >= `+z.outDepth+`.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < `+at+`;
              wR += `+We+`) {
            float dyR = float(dyRCorner + wR) / `+Fe+`.0;

            if (dyR < 0.0 || dyR >= `+z.outHeight+`.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < `+yt+`;
                wC += `+Ze+`) {
              float dyC = float(dyCCorner + wC) / `+Re+`.0;

              if (dyC < 0.0 || dyC >= `+z.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `}(y);return this.compileAndRun(D,[u],d.dtype)},h.prototype.maxPool3d=function(u,d){var y=new oo(d,"max",!1);return this.compileAndRun(y,[u],"float32")},h.prototype.maxPool3dBackprop=function(u,d,y,D){var z=new oo(D,"max",!0),X=this.compileAndRun(z,[d]),oe=new function(xe){this.variableNames=["dy","maxPos"],this.outputShape=xe.inShape;var Fe=xe.strideDepth,Re=xe.strideHeight,Me=xe.strideWidth,We=xe.dilationDepth,Ze=xe.dilationHeight,Je=xe.dilationWidth,at=xe.effectiveFilterDepth,yt=xe.effectiveFilterHeight,xt=xe.effectiveFilterWidth,kt=at-1-xe.padInfo.front,It=yt-1-xe.padInfo.top,Jt=xt-1-xe.padInfo.left,on=at*yt*xt-1;this.userCode=`
      const ivec3 pads = ivec3(`+kt+", "+It+", "+Jt+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < `+at+`;
           wD += `+We+`) {
          float dyD = float(dyDCorner + wD) / `+Fe+`.0;

          if (dyD < 0.0 || dyD >= `+xe.outDepth+`.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < `+yt+`;
              wR += `+Ze+`) {
            float dyR = float(dyRCorner + wR) / `+Re+`.0;

            if (dyR < 0.0 || dyR >= `+xe.outHeight+`.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < `+xt+`;
                wC += `+Je+`) {
              float dyC = float(dyCCorner + wC) / `+Me+`.0;

              if (dyC < 0.0 || dyC >= `+xe.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = `+on+` -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * `+yt+" * "+xt+` +
                  wR * `+xt+` + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `}(D),he=this.compileAndRun(oe,[u,X],d.dtype);return X.dispose(),he},h.prototype.reshape=function(u,d){var y=this.texData.get(u.dataId);if(y.isPacked&&!cu(u.shape,d)&&(y.texture===null||!cu(y.shape,d))){var D=this.packedReshape(u,d);return Ue.makeTensorFromDataId(D.dataId,D.shape,D.dtype)}return Eu(u,d)},h.prototype.resizeBilinear=function(u,d,y,D){var z=P().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new function(X,oe,he,xe){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var Fe=X[0],Re=X[1],Me=X[2],We=X[3];this.outputShape=[Fe,oe,he,We];var Ze=[xe&&oe>1?Re-1:Re,xe&&he>1?Me-1:Me],Je=[xe&&oe>1?oe-1:oe,xe&&he>1?he-1:he];this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          `+Ze[0]/Je[0]+`,
          `+Ze[1]/Je[1]+`,
          `+Ze[1]/Je[1]+`);
      const vec3 inputShapeRC = vec3(`+Re+".0, "+Me+`.0,
                                     `+Me+`.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = vec3(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(sourceFracIndexRC);
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < `+(We-1)+`;
        bool hasNextRow = coords.z < `+(he-1)+`;

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `}(u.shape,d,y,D):new function(X,oe,he,xe){this.variableNames=["A"],this.outputShape=[];var Fe=X[0],Re=X[1],Me=X[2],We=X[3];this.outputShape=[Fe,oe,he,We];var Ze=[xe&&oe>1?Re-1:Re,xe&&he>1?Me-1:Me],Je=[xe&&oe>1?oe-1:oe,xe&&he>1?he-1:he];this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `+Ze[0]/Je[0]+`,
          `+Ze[1]/Je[1]+`);
      const vec2 inputShapeRC = vec2(`+Re+".0, "+Me+`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(sourceFracIndexRC);
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `}(u.shape,d,y,D);return this.compileAndRun(z,[u],"float32")},h.prototype.resizeBilinearBackprop=function(u,d,y){var D=new function(z,X,oe){this.variableNames=["dy"],this.outputShape=[],this.outputShape=X.shape;var he=X.shape,xe=he[1],Fe=he[2],Re=z.shape,Me=Re[1],We=Re[2],Ze=[oe&&Me>1?xe-1:xe,oe&&We>1?Fe-1:Fe],Je=[oe&&Me>1?Me-1:Me,oe&&We>1?We-1:We],at=Ze[0]/Je[0],yt=Ze[1]/Je[1],xt=1/at,kt=1/yt,It=2*Math.ceil(xt)+2,Jt=2*Math.ceil(kt)+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`+at+`);
        const float widthScale = float(`+yt+`);

        const float invHeightScale = float(`+xt+`);
        const float invWidthScale = float(`+kt+`);

        const int winHeight = int(`+It+`);
        const int winWidth = int(`+Jt+`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `+Me+`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `+We+`) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), `+(xe-1)+`.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), `+(Fe-1)+`.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}(u,d,y);return this.compileAndRun(D,[u])},h.prototype.resizeNearestNeighbor=function(u,d,y,D){var z=new function(X,oe,he,xe){this.variableNames=["A"],this.outputShape=[];var Fe=X[0],Re=X[1],Me=X[2],We=X[3];this.outputShape=[Fe,oe,he,We];var Ze=[xe&&oe>1?Re-1:Re,xe&&he>1?Me-1:Me],Je=[xe&&oe>1?oe-1:oe,xe&&he>1?he-1:he],at=xe?"0.5":"0.0";this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `+Ze[0]/Je[0]+`,
          `+Ze[1]/Je[1]+`);
      const vec2 inputShapeRC = vec2(`+Re+".0, "+Me+`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + `+at+`)));

        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `}(u.shape,d,y,D);return this.compileAndRun(z,[u])},h.prototype.resizeNearestNeighborBackprop=function(u,d,y){var D=new function(z,X,oe){this.variableNames=["dy"],this.outputShape=[],this.outputShape=X.shape;var he=X.shape,xe=he[1],Fe=he[2],Re=z.shape,Me=Re[1],We=Re[2],Ze=[oe&&Me>1?xe-1:xe,oe&&We>1?Fe-1:Fe],Je=[oe&&Me>1?Me-1:Me,oe&&We>1?We-1:We],at=Ze[0]/Je[0],yt=Ze[1]/Je[1],xt=1/at,kt=1/yt,It=2*Math.ceil(xt)+2,Jt=2*Math.ceil(kt)+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`+at+`);
        const float widthScale = float(`+yt+`);

        const float invHeightScale = float(`+xt+`);
        const float invWidthScale = float(`+kt+`);

        const int winHeight = int(`+It+`);
        const int winWidth = int(`+Jt+`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `+Me+`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `+We+`) {
              continue;
            }

            float sourceFracRow =
              float(`+Ze[0]+`) *
                (float(dyR) / float(`+Je[0]+`));

            float sourceFracCol =
                float(`+Ze[1]+`) *
                  (float(dyC) / float(`+Je[1]+`));

            int sourceNearestRow = int(min(
                float(int(`+xe+`) - 1),
                `+oe+` ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(`+Fe+`) - 1),
                `+oe+` ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}(u,d,y);return this.compileAndRun(D,[u])},h.prototype.multinomial=function(u,d,y,D){var z=d?u:Os(u),X=z.shape[0],oe=z.shape[1],he=new As(X,oe,y),xe=he.getCustomSetupFunc(D);return this.compileAndRun(he,[z],"int32",xe)},h.prototype.oneHot=function(u,d,y,D){var z=new function(X,oe,he,xe){this.variableNames=["indices"],this.outputShape=[X,oe],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(`+xe+"), float("+he+`),
                      float(index == coords.y)));
      }
    `}(u.size,d,y,D);return this.compileAndRun(z,[u])},h.prototype.diag=function(u){var d=new function(y){this.variableNames=["X"],this.outputShape=[y,y],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `}(u.size);return this.compileAndRun(d,[u])},h.prototype.nonMaxSuppression=function(u,d,y,D,z){return qc("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead"),Ou(u.dataSync(),d.dataSync(),y,D,z)},h.prototype.cropAndResize=function(u,d,y,D,z,X){var oe=new function(he,xe,Fe,Re,Me){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var We=he[0],Ze=he[1],Je=he[2],at=he[3],yt=xe[0],xt=Fe[0],kt=Fe[1];this.outputShape=[yt,xt,kt,at];var It=Re==="bilinear"?1:0,Jt=[Ze-1+".0",Je-1+".0"],on=Jt[0],Qt=Jt[1],cn=xt>1?[""+(Ze-1)/(xt-1),"(y2-y1) * height_ratio","y1*"+on+" + float(y)*(height_scale)"]:["0.0","0.0","0.5 * (y1+y2) * "+on],vn=cn[0],p=cn[1],c=cn[2],o=kt>1?[""+(Je-1)/(kt-1),"(x2-x1) * width_ratio","x1*"+Qt+" + float(x)*(width_scale)"]:["0.0","0.0","0.5 * (x1+x2) * "+Qt],l=o[0],g=o[1],S=o[2];this.userCode=`
      const float height_ratio = float(`+vn+`);
      const float width_ratio = float(`+l+`);
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= `+We+`) {
          return;
        }

        float height_scale = `+p+`;
        float width_scale = `+g+`;

        float in_y = `+c+`;
        if( in_y < 0.0 || in_y > `+on+` ) {
          setOutput(float(`+Me+`));
          return;
        }
        float in_x = `+S+`;
        if( in_x < 0.0 || in_x > `+Qt+` ) {
          setOutput(float(`+Me+`));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(`+It+` == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `}(u.shape,d.shape,D,z,X);return this.compileAndRun(oe,[u,d,y],"float32")},h.prototype.depthToSpace=function(u,d,y){ke(d>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+d});var D=u.shape[0],z=y==="NHWC"?u.shape[1]:u.shape[2],X=y==="NHWC"?u.shape[2]:u.shape[3],oe=y==="NHWC"?u.shape[3]:u.shape[1],he=z*d,xe=X*d,Fe=oe/(d*d),Re=new ia(y==="NHWC"?[D,he,xe,Fe]:[D,Fe,he,xe],d,y);return this.compileAndRun(Re,[u])},h.prototype.split=function(u,d,y){return Pl(u,d,y)},h.prototype.scatterND=function(u,d,y){var D=Yc(0,u,y),z=D.sliceRank,X=D.numUpdates,oe=D.sliceSize,he=D.strides,xe=D.outputSize,Fe=[xe/oe,oe],Re=u.reshape([X,z]),Me=d.reshape([X,oe]);if(xe===0)return Eu(ko([]),y);var We=fr(0),Ze=new Ss(X,z,Re.rank,Me.rank,he,Fe);return this.compileAndRun(Ze,[Me,Re,We]).reshape(y)},h.prototype.sparseToDense=function(u,d,y,D){var z=Yc(0,u,y),X=z.sliceRank,oe=z.numUpdates,he=z.strides,xe=z.outputSize,Fe=new Ss(oe,X,u.rank,d.rank,he,[xe,1]);return this.compileAndRun(Fe,[d,u,D]).reshape(y)},h.prototype.fft=function(u){return this.fftImpl(u,!1)},h.prototype.ifft=function(u){return this.fftImpl(u,!0)},h.prototype.fftImpl=function(u,d){var y=this.texData.get(u.dataId),D=new jo("return real * expR - imag * expI;",u.shape,d),z=new jo("return real * expI + imag * expR;",u.shape,d),X=[this.makeComplexComponentTensorInfo(u,y.complexTensors.real),this.makeComplexComponentTensorInfo(u,y.complexTensors.imag)],oe=this.compileAndRun(D,X),he=this.compileAndRun(z,X),xe=this.complex(oe,he).as2D(u.shape[0],u.shape[1]);return oe.dispose(),he.dispose(),xe},h.prototype.gatherND=function(u,d){var y=d.shape,D=y[y.length-1],z=Wu(u,d),X=z[0],oe=z[1],he=z[2],xe=z[3],Fe=d.reshape([oe,D]),Re=u.reshape([u.size/he,he]),Me=new function(We,Ze,Je){this.sliceDim=We,this.strides=Ze,this.variableNames=["x","indices"],this.outputShape=Je;var at=Rn(Ze.length),yt=Rn(Je.length),xt=this.sliceDim>1?"strides[j]":"strides";this.userCode=`
        `+at+" strides = "+at+"("+this.strides+`);
         void main() {
          `+yt+` coords = getOutputCoords();
          int flattenIndex = 0;
          for (int j = 0; j < `+this.sliceDim+`; j++) {
            int index = round(getIndices(coords[0], j));
            flattenIndex += index * `+xt+`;
          }
          setOutput(getX(flattenIndex, coords[1]));
        }
      `}(D,xe,[oe,he]);return this.compileAndRun(Me,[Re,Fe]).reshape(X)},h.prototype.fill=function(u,d,y){if((y=y||be(d))==="string"){var D=hn(y,Ye(u));return D.fill(d),Ue.makeTensor(D,u,y,this)}var z=new Jo(u,d),X=z.getCustomSetupFunc(d);return this.compileAndRun(z,[],y,X)},h.prototype.onesLike=function(u){if(u.dtype==="string")throw new Error("onesLike is not supported under string dtype");return this.fill(u.shape,1,u.dtype)},h.prototype.zerosLike=function(u){return this.fill(u.shape,u.dtype==="string"?"":0,u.dtype)},h.prototype.linspace=function(u,d,y){return qu(u,d,y)},h.prototype.makeTensorInfo=function(u,d){var y=this.write(null,u,d);return this.texData.get(y).usage=null,{dataId:y,shape:u,dtype:d}},h.prototype.makeOutput=function(u,d){var y=this.makeTensorInfo(u,d).dataId;return Ue.makeTensorFromDataId(y,u,d,this)},h.prototype.unpackTensor=function(u){var d=new function(y){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=y;var D=y.length,z=N("rc",D),X=Rn(D),oe=function(Fe,Re){if(Fe===1)return"rc";for(var Me="",We=0;We<Fe;We++)Me+=Re[We],We<Fe-1&&(Me+=",");return Me}(D,z),he=z.slice(-2),xe=D<=1?"rc":"vec2("+he.join(",")+")";this.userCode=`
      void main() {
        `+X+` rc = getOutputCoords();
        vec4 packedInput = getA(`+oe+`);

        setOutput(getChannel(packedInput, `+xe+`));
      }
    `}(u.shape);return this.runWebGLProgram(d,[u],u.dtype)},h.prototype.packTensor=function(u){var d=new function(y){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=y;var D=y.length;if(D===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{var z=N("rc",D),X=Rn(D),oe=function(Fe,Re,Me){if(Fe===1)return"rc > "+Re[0];for(var We="",Ze=Fe-2;Ze<Fe;Ze++)We+=Me[Ze]+" >= "+Re[Ze],Ze<Fe-1&&(We+="||");return We}(D,y,z),he=function(Fe,Re,Me,We){if(Fe===1)return"";var Ze=We.slice(-2);return`
    int r = `+Ze[0]+`;
    int c = `+Ze[1]+`;
    int rp1 = r + 1;
    int cp1 = c + 1;

    bool cEdge = cp1 >= `+Re+`;
    bool rEdge = rp1 >= `+Me+`;
  `}(D,y[y.length-1],y[y.length-2],z),xe=function(Fe,Re){var Me=Fe.length,We=function(Ze,Je){for(var at=[],yt=0;yt<=1;yt++)for(var xt=0;xt<=1;xt++){for(var kt=(yt===0?"r":"rp1")+", "+(xt===0?"c":"cp1"),It=2;It<Ze;It++)kt=Je[Je.length-1-It]+","+kt;at.push(kt)}return at}(Me,Re);return Me===1?`getA(rc),
            rc + 1 >= `+Fe[0]+` ? 0. : getA(rc + 1),
            0, 0`:"getA("+We[0]+`),
          cEdge ? 0. : getA(`+We[1]+`),
          rEdge ? 0. : getA(`+We[2]+`),
          rEdge || cEdge ? 0. : getA(`+We[3]+")"}(y,z);this.userCode=`
        void main() {
          `+X+` rc = getOutputCoords();

          if(`+oe+`) {
            setOutput(vec4(0));
          } else {
            `+he+`

            setOutput(vec4(`+xe+`));
          }
        }
      `}}(u.shape);return this.runWebGLProgram(d,[u],u.dtype,null,!0)},h.prototype.packedReshape=function(u,d){var y=[ss(u.shape)].concat(Ca(u.shape)),D={dtype:u.dtype,shape:y,dataId:u.dataId},z=new function(oe,he){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=oe;for(var xe="",Fe=0;Fe<4;Fe++){var Re="thisRC = rc;";Fe%2==1&&(Re+="thisRC.z += 1;"),Fe>1&&(Re+="thisRC.y += 1;"),xe+=`
        `+Re+`
        `+(Fe>0?"if(thisRC.y < rows && thisRC.z < cols){":"")+`
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[`+Fe+`] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        `+(Fe>0?"}":"")+`
      `}this.userCode=`
      
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      `+Be(["r","c","d"],he)+`
      return ivec3(r, c, d);
    }
  
      `+Ge(oe)+`

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = `+oe[1]+`;
        int cols = `+oe[2]+`;

        `+xe+`

        setOutput(result);
      }
    `}([ss(d)].concat(Ca(d)),y),X=this.runWebGLProgram(z,[D],u.dtype,null,!0);return{dataId:X.dataId,shape:d,dtype:X.dtype}},h.prototype.decode=function(u){var d,y=this.texData.get(u),D=y.isPacked,z=y.shape,X=y.dtype,oe=nc(z);return d=D?new function(he){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=Zn.DENSE;var xe=Ti(he),Fe=te();this.outputShape=he,this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        `+Be(["r","c","d"],he)+`
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx *
          vec2(`+xe[0]+", "+xe[1]+`));
        int index = 4 * (resTexRC.x * `+xe[1]+` + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        `+Fe.output+` = result;
      }
    `}(oe):new function(he){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=Zn.DENSE;var xe=Ti(he),Fe=te();this.outputShape=he,this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        `+Be(["r","c","d"],he)+`
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx *
          vec2(`+xe[0]+", "+xe[1]+`));
        int index = 4 * (resTexRC.x * `+xe[1]+` + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        `+Fe.output+` = result;
      }
    `}(oe),{dtype:X,shape:z,dataId:this.runWebGLProgram(d,[{shape:oe,dtype:X,dataId:u}],X,null,!0).dataId}},h.prototype.runWebGLProgram=function(u,d,y,D,z){var X=this;z===void 0&&(z=!1);var oe=this.makeTensorInfo(u.outputShape,y),he=this.texData.get(oe.dataId);if(u.packedOutput&&(he.isPacked=!0),u.outPackingScheme===Zn.DENSE){var xe=Ti(u.outputShape);he.texShape=xe.map(function(xt){return 2*xt})}if(u.outTexUsage!=null&&(he.usage=u.outTexUsage),Ye(oe.shape)===0)return he.values=Hn(oe.dtype,0),oe;var Fe=[],Re=d.map(function(xt){if(xt.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var kt=X.texData.get(xt.dataId);if(kt.texture==null){if(!u.packedInputs&&Ye(xt.shape)<=P().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:xt.shape,texData:null,isUniform:!0,uniformValues:kt.values};u.packedInputs&&(kt.isPacked=!0,kt.shape=xt.shape)}else if(!!kt.isPacked!=!!u.packedInputs)xt=kt.isPacked?X.unpackTensor(xt):X.packTensor(xt),Fe.push(xt),kt=X.texData.get(xt.dataId);else if(kt.isPacked&&!cu(kt.shape,xt.shape)){var It=xt,Jt=xt.shape;xt.shape=kt.shape,xt=X.packedReshape(xt,Jt),Fe.push(xt),kt=X.texData.get(xt.dataId),It.shape=Jt}return X.uploadToGPU(xt.dataId),{shape:xt.shape,texData:kt,isUniform:!1}});this.uploadToGPU(oe.dataId);var Me,We={shape:oe.shape,texData:he,isUniform:!1},Ze=function(xt,kt,It){var Jt="";Re.concat(It).forEach(function(Qt){var cn=Qt.texData!=null&&Qt.texData.slice!=null&&Qt.texData.slice.flatOffset>0,vn=Qt.isUniform?"uniform":Qt.texData.texShape;Jt+=Qt.shape+"_"+vn+"_"+cn});var on=xt.userCode;return xt.constructor.name+"_"+Jt+"_"+on}(u,0,We),Je=this.getAndSaveBinary(Ze,function(){return function(xt,kt,It,Jt){var on=kt.userCode,Qt=It.map(function(V,ne){var ae={logicalShape:V.shape,texShape:V.isUniform?null:V.texData.texShape,isUniform:V.isUniform,isPacked:!V.isUniform&&V.texData.isPacked,flatOffset:null};return V.texData!=null&&V.texData.slice!=null&&V.texData.slice.flatOffset>0&&(ae.flatOffset=V.texData.slice.flatOffset),{name:kt.variableNames[ne],shapeInfo:ae}}),cn=Qt.map(function(V){return V.shapeInfo}),vn={logicalShape:Jt.shape,texShape:Jt.texData.texShape,isUniform:!1,isPacked:Jt.texData.isPacked,flatOffset:null},p=Tt(Qt,vn,on,kt.packedInputs),c=xt.createProgram(p),o=null,l=xt.getUniformLocation(c,"NAN",!1);P().getNumber("WEBGL_VERSION")===1&&(o=xt.getUniformLocation(c,"INFINITY",!1));for(var g={},S=0;S<kt.variableNames.length;S++){var j=kt.variableNames[S];g[j]=xt.getUniformLocation(c,j,!1),g["offset"+j]=xt.getUniformLocation(c,"offset"+j,!1)}return{program:kt,source:p,webGLProgram:c,uniformLocations:g,inShapeInfos:cn,outShapeInfo:vn,infLoc:o,nanLoc:l}}(X.gpgpu,u,Re,We)}),at=this.activeTimers!=null;if(at&&(Me=this.startTimer()),function(xt,kt,It,Jt,on){Ms(kt.inShapeInfos,It),Ms([kt.outShapeInfo],[Jt]);var Qt=Jt.texData.texture,cn=Jt.texData.texShape;Jt.texData.isPacked?xt.setOutputPackedMatrixTexture(Qt,cn[0],cn[1]):xt.setOutputMatrixTexture(Qt,cn[0],cn[1]),xt.setProgram(kt.webGLProgram),P().getNumber("WEBGL_VERSION")===1&&kt.infLoc!==null&&xt.gl.uniform1f(kt.infLoc,1/0),kt.nanLoc!==null&&xt.gl.uniform1f(kt.nanLoc,NaN),It.forEach(function(vn,p){var c=kt.program.variableNames[p],o=kt.uniformLocations[c],l=kt.uniformLocations["offset"+c];if(o!=null)if(vn.isUniform)if(Ye(vn.shape)<2)xt.gl.uniform1f(o,vn.uniformValues[0]);else{var g=vn.uniformValues;g instanceof Float32Array||(g=new Float32Array(g)),xt.gl.uniform1fv(o,g)}else vn.texData.slice!=null&&l!=null&&xt.gl.uniform1i(l,vn.texData.slice.flatOffset),xt.setInputMatrixTexture(vn.texData.texture,o,p)}),on!=null&&on(xt,kt.webGLProgram),xt.executeProgram()}(this.gpgpu,Je,Re,We,D),Fe.forEach(function(xt){return X.disposeData(xt.dataId)}),at&&(Me=this.endTimer(Me),this.activeTimers.push({name:u.constructor.name,query:this.getQueryTime(Me)})),!P().getBool("WEBGL_LAZILY_UNPACK")&&he.isPacked&&z===!1){var yt=this.unpackTensor(oe);return this.disposeData(oe.dataId),yt}return oe},h.prototype.compileAndRun=function(u,d,y,D,z){z===void 0&&(z=!1),y=y||d[0].dtype;var X=this.runWebGLProgram(u,d,y,D,z);return Ue.makeTensorFromDataId(X.dataId,X.shape,X.dtype)},h.prototype.getAndSaveBinary=function(u,d){return u in this.binaryCache||(this.binaryCache[u]=d()),this.binaryCache[u]},h.prototype.getTextureManager=function(){return this.textureManager},h.prototype.dispose=function(){var u=this;this.disposed||(P().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(function(d){u.gpgpu.deleteProgram(u.binaryCache[d].webGLProgram),delete u.binaryCache[d]}),this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)},h.prototype.floatPrecision=function(){var u=this;return this.floatPrecisionValue==null&&(this.floatPrecisionValue=Ii(function(){if(!P().get("WEBGL_RENDER_FLOAT32_ENABLED")){var d=P().getBool("DEBUG");P().set("DEBUG",!1);var y=u.abs(fr(1e-8)).dataSync()[0];if(P().set("DEBUG",d),y>0)return 32}return 16})),this.floatPrecisionValue},h.prototype.epsilon=function(){return this.floatPrecision()===32?1e-7:1e-4},h.prototype.uploadToGPU=function(u){var d,y=this.texData.get(u),D=y.shape,z=y.dtype,X=y.values,oe=y.texture,he=y.usage,xe=y.isPacked;if(oe==null){var Fe,Re=this.activeTimers!=null;Re&&(Fe=Zt());var Me=y.texShape;if(Me==null&&(Me=Cl(D,xe),y.texShape=Me),X!=null){var We=nc(D),Ze=void 0,Je=Me[1],at=Me[0],yt=X instanceof Uint8Array;xe?(Je=(d=qr(Me[0],Me[1]))[0],Ze=new function(on,Qt,cn){cn===void 0&&(cn=!1),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var vn=te(),p=Qt[0],c=Qt[1];this.outputShape=on;var o="",l="result";cn&&(l="floor(result * 255. + 0.5)");for(var g=0;g<=1;g++)for(var S=0;S<=1;S++){var j=2*g+S;o+=`
          localCoords = coords;
          if(localCoords[2] + `+S+" < "+on[2]+`) {
            localCoords[2] += `+S+`;
            if(localCoords[1] + `+g+" < "+on[1]+`) {
              localCoords[1] += `+g+`;

              flatIndex = getFlatIndex(localCoords);
              offset = imod(flatIndex, 4);

              flatIndex = idiv(flatIndex, 4, 1.);

              r = flatIndex / `+c+`;
              c = imod(flatIndex, `+c+`);
              uv = (vec2(c, r) + halfCR) / vec2(`+c+".0, "+p+`.0);
              values = `+vn.texture2D+`(A, uv);

              if(offset == 0) {
                result[`+j+`] = values[0];
              } else if(offset == 1) {
                result[`+j+`] = values[1];
              } else if(offset == 2) {
                result[`+j+`] = values[2];
              } else {
                result[`+j+`] = values[3];
              }
            }
          }
        `}this.userCode=`
      `+Ge(on)+`

      void main() {
        ivec3 coords = getOutputCoords();

        vec4 result = vec4(0.);
        int flatIndex, r, c, offset;
        ivec3 localCoords;
        vec2 uv;
        vec4 values;

        `+o+`

        `+vn.output+" = "+l+`;
      }
    `}(We,[at=d[1],Je],yt)):Ze=new function(on,Qt,cn){cn===void 0&&(cn=!1),this.variableNames=["A"];var vn=te(),p=Qt[0],c=Qt[1];this.outputShape=on;var o="result";cn&&(o="floor(result * 255. + 0.5)"),this.userCode=`
      `+Ge(on)+`

      void main() {
        ivec3 coords = getOutputCoords();

        int flatIndex = getFlatIndex(coords);
        int offset = imod(flatIndex, 4);

        flatIndex = idiv(flatIndex, 4, 1.);
        
        int r = flatIndex / `+c+`;
        int c = imod(flatIndex, `+c+`);
        vec2 uv = (vec2(c, r) + halfCR) / vec2(`+c+".0, "+p+`.0);
        vec4 values = `+vn.texture2D+`(A, uv);

        float result;

        if(offset == 0) {
          result = values[0];
        } else if(offset == 1) {
          result = values[1];
        } else if(offset == 2) {
          result = values[2];
        } else {
          result = values[3];
        }

        `+vn.output+" = vec4("+o+`, 0., 0., 0.);
      }
    `}(We,[at,Je],yt);var xt=this.makeTensorInfo([at,Je],z);this.texData.get(xt.dataId).usage=yt?ir.PIXELS:ir.UPLOAD,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(xt.dataId),Je,at,X);var kt=this.runWebGLProgram(Ze,[xt],z,null,!0),It=this.texData.get(kt.dataId);y.texture=It.texture,y.texShape=It.texShape,y.isPacked=It.isPacked,y.usage=It.usage,this.disposeData(xt.dataId),this.texData.delete(kt.dataId),y.values=null,Re&&(this.uploadWaitMs+=Zt()-Fe)}else{var Jt=this.acquireTexture(Me,he,z,xe);y.texture=Jt}}},h.prototype.convertAndCacheOnCPU=function(u,d){var y=this.texData.get(u),D=y.dtype;return this.releaseGPUData(u),d!=null&&(y.values=function(z,X){if(X==="float32"||X==="complex64")return z;if(X==="int32"||X==="bool"){for(var oe=X==="int32"?new Int32Array(z.length):new Uint8Array(z.length),he=0;he<oe.length;++he)oe[he]=Math.round(z[he]);return oe}throw new Error("Unknown dtype "+X)}(d,D)),y.values},h.prototype.acquireTexture=function(u,d,y,D){if(this.numBytesInGPU+=this.computeBytes(u,y),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){var z=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn("High memory usage in GPU: "+z+" MB, most likely due to a memory leak")}return this.textureManager.acquireTexture(u,d,D)},h.prototype.computeBytes=function(u,d){return u[0]*u[1]*Lt(d)},h}(Rf);Mn()&&Ue.registerBackend("webgl",function(){return new T0},2);var Dm=wt({square_:function(v){var h=Ke(v,"x","square"),u=[h];return Ue.runKernelFunc(function(d,y){return y([h]),d.square(h)},{x:h},null,"Square",{},u,[])}}),qh="SquaredDifference",zf=wt({squaredDifference_:function(v,h){var u,d=Ke(v,"a","squaredDifference"),y=Ke(h,"b","squaredDifference");u=An(d,y),d=u[0],y=u[1],Hi(d.shape,y.shape);var D={a:d,b:y},z=[d,y];return Ue.runKernelFunc(function(X,oe){var he=X.squaredDifference(d,y);return oe([d,y]),he},D,function(X,oe){var he=oe[0],xe=oe[1],Fe=fr(2);return{a:function(){return X.mul(he.sub(xe).mul(Fe))},b:function(){return X.mul(xe.sub(he).mul(Fe))}}},qh,{},z,[])}}),Dc=wt({abs_:function(v){var h=Ke(v,"x","abs");return h.dtype==="complex64"?Ue.runKernelFunc(function(u){return u.complexAbs(h)},{$x:h}):Ue.runKernelFunc(function(u,d){var y=u.abs(h);return d([h]),y},{x:h},function(u,d){var y=d[0];return{x:function(){return u.mul(y.toFloat().step(-1))}}},"Abs")}}),Tm=wt({acos_:function(v){var h=Ke(v,"x","acos");return Ue.runKernelFunc(function(u,d){var y=u.acos(h);return d([h]),y},{$x:h},function(u,d){var y=d[0];return{$x:function(){return u.divStrict(fr(1).sub(y.toFloat().square()).sqrt()).neg()}}})}}),Nm=wt({acosh_:function(v){var h=Ke(v,"x","acosh");return Ue.runKernelFunc(function(u,d){var y=u.acosh(h);return d([h]),y},{$x:h},function(u,d){var y=d[0];return{$x:function(){return u.divStrict(y.toFloat().square().sub(1).sqrt())}}})}}),_u=wt({asin_:function(v){var h=Ke(v,"x","asin");return Ue.runKernelFunc(function(u,d){var y=u.asin(h);return d([h]),y},{$x:h},function(u,d){var y=d[0];return{$x:function(){return u.divStrict(fr(1).sub(y.toFloat().square()).sqrt())}}})}}),Fm=wt({asinh_:function(v){var h=Ke(v,"x","asinh");return Ue.runKernelFunc(function(u,d){var y=u.asinh(h);return d([h]),y},{$x:h},function(u,d){var y=d[0];return{$x:function(){return u.divStrict(fr(1).add(y.toFloat().square()).sqrt())}}})}}),Hh=wt({atan_:function(v){var h=Ke(v,"x","atan");return Ue.runKernelFunc(function(u,d){var y=u.atan(h);return d([h]),y},{$x:h},function(u,d){var y=d[0];return{$x:function(){return u.div(y.toFloat().square().add(1))}}})}}),Qd=wt({atanh_:function(v){var h=Ke(v,"x","atanh");return Ue.runKernelFunc(function(u,d){var y=u.atanh(h);return d([h]),y},{$x:h},function(u,d){var y=d[0];return{$x:function(){return u.div(fr(1).sub(y.toFloat().square()))}}})}}),N0=wt({ceil_:function(v){var h=Ke(v,"x","ceil");return Ue.runKernelFunc(function(u){return u.ceil(h)},{$x:h},function(u){return{$x:function(){return ii(u)}}})}}),Zd=wt({clipByValue_:function(v,h,u){var d=Ke(v,"x","clipByValue");ke(h<=u,function(){return"Error in clip: min ("+h+") must be less than or equal to max ("+u+")."});var y=[d],D={min:h,max:u};return Ue.runKernelFunc(function(z,X){var oe=z.clip(d,h,u);return X([d]),oe},{x:d},function(z,X){var oe=X[0];return{x:function(){return z.where(oe.greaterEqual(h).logicalAnd(oe.lessEqual(u)),ii(z))}}},"ClipByValue",D,y)}}),Tc=wt({cos_:function(v){var h=Ke(v,"x","cos"),u=[h];return Ue.runKernelFunc(function(d,y){var D=d.cos(h);return y([h]),D},{x:h},function(d,y){var D=y[0];return{x:function(){return D.toFloat().sin().neg().mul(d)}}},"Cos",{},u)}}),ep=wt({cosh_:function(v){var h=Ke(v,"x","cosh");return Ue.runKernelFunc(function(u,d){var y=u.cosh(h);return d([h]),y},{$x:h},function(u,d){var y=d[0];return{$x:function(){return y.toFloat().sinh().mulStrict(u)}}})}}),Cg=wt({erf_:function(v){var h=Ke(v,"x","erf");return ke(h.dtype==="int32"||h.dtype==="float32",function(){return"Input dtype must be `int32` or `float32`."}),h.dtype==="int32"&&(h=h.toFloat()),Ue.runKernelFunc(function(u,d){var y=u.erf(h);return d([h]),y},{$x:h},function(u,d){var y=d[0];return{$x:function(){return u.mul(y.square().neg().exp().mul(2/Math.sqrt(Math.PI)))}}})}}),Og=wt({exp_:function(v){var h=Ke(v,"x","exp");return Ue.runKernelFunc(function(u,d){var y=u.exp(h);return d([y]),y},{x:h},function(u,d){return{x:function(){return u.mulStrict(d[0])}}},"Exp",{},[],[!0])}}),Im=wt({expm1_:function(v){var h=Ke(v,"x","expm1");return Ue.runKernelFunc(function(u,d){var y=u.expm1(h);return d([h]),y},{$x:h},function(u,d){var y=d[0];return{$x:function(){return u.mul(y.exp())}}})}}),bv=wt({floor_:function(v){var h=Ke(v,"x","floor");return Ue.runKernelFunc(function(u){return u.floor(h)},{$x:h},function(u){return{$x:function(){return ii(u)}}})}}),xv=wt({log_:function(v){var h=Ke(v,"x","log"),u=[h];return Ue.runKernelFunc(function(d,y){var D=d.log(h);return y([h]),D},{x:h},function(d,y){var D=y[0];return{x:function(){return d.div(D.toFloat())}}},"Log",{},u)}}),uo=wt({log1p_:function(v){var h=Ke(v,"x","log1p");return Ue.runKernelFunc(function(u,d){var y=u.log1p(h);return d([h]),y},{$x:h},function(u,d){var y=d[0];return{$x:function(){return u.div(y.add(1))}}})}}),Ag=wt({logSigmoid_:function(v){var h=Ke(v,"x","logSigmoid");return Ue.runKernelFunc(function(u,d){var y=u.softplus(h.neg()).neg();return d([h]),y},{$x:h},function(u,d){var y=d[0];return{$x:function(){return u.mul(y.neg().sigmoid())}}})}}),Sg=wt({neg_:function(v){var h=Ke(v,"x","neg"),u=[h];return Ue.runKernelFunc(function(d){return d.neg(h)},{x:h},function(d){return{x:function(){return d.neg()}}},"Neg",{},u)}}),Bp=wt({reciprocal_:function(v){var h=Ke(v,"x","reciprocal");return Ue.runKernelFunc(function(u,d){var y=u.reciprocal(h);return d([h]),y},{$x:h},function(u,d){var y=d[0];return{$x:function(){return u.div(y.square().neg())}}})}}),_g=wt({round_:function(v){var h=Ke(v,"x","round");return Ue.runKernelFunc(function(u){return u.round(h)},{$x:h},function(u){return{$x:function(){return ii(u)}}})}}),tp=wt({rsqrt_:function(v){var h=Ke(v,"x","rsqrt"),u=[h];return Ue.runKernelFunc(function(d,y){var D=d.rsqrt(h);return y([h]),D},{x:h},function(d,y){var D=y[0];return{x:function(){return d.div(D.pow(1.5).mul(2)).neg()}}},"Rsqrt",{},u)}}),nl=wt({sigmoid_:function(v){var h=Ke(v,"x","sigmoid");return Ue.runKernelFunc(function(u,d){var y=u.sigmoid(h);return d([y]),y},{x:h},function(u,d){var y=d[0];return{x:function(){return u.mul(y.mul(fr(1).sub(y)))}}},"Sigmoid")}}),rl=wt({sign_:function(v){var h=Ke(v,"x","sign");return Ue.runKernelFunc(function(u){return u.sign(h)},{$x:h},function(u){return{$x:function(){return ii(u)}}})}}),Dg=wt({isNaN_:function(v){var h=Ke(v,"x","isNaN");return Ue.runKernelFunc(function(u){return u.isNaN(h)},{$x:h},function(u){return{$x:function(){return ii(u)}}})}}),Tg=wt({isInf_:function(v){var h=Ke(v,"x","isInf");return Ue.runKernelFunc(function(u){return u.isInf(h)},{$x:h},function(u){return{$x:function(){return ii(u)}}})}}),$h=wt({isFinite_:function(v){var h=Ke(v,"x","isFinite");return Ue.runKernelFunc(function(u){return u.isFinite(h)},{$x:h},function(u){return{$x:function(){return ii(u)}}})}}),Uf=wt({sin_:function(v){var h=Ke(v,"x","sin"),u=[h];return Ue.runKernelFunc(function(d,y){var D=d.sin(h);return y([h]),D},{x:h},function(d,y){var D=y[0];return{x:function(){return D.toFloat().cos().mul(d)}}},"Sin",{},u)}}),Gh=wt({sinh_:function(v){var h=Ke(v,"x","sinh");return Ue.runKernelFunc(function(u,d){var y=u.sinh(h);return d([h]),y},{$x:h},function(u,d){var y=d[0];return{$x:function(){return y.toFloat().cosh().mulStrict(u)}}})}}),wv=wt({softplus_:function(v){var h=Ke(v,"x","softplus");return Ue.runKernelFunc(function(u,d){var y=u.softplus(h);return d([h]),y},{$x:h},function(u,d){var y=d[0];return{$x:function(){return u.mul(y.sigmoid())}}})}}),Pp=wt({sqrt_:function(v){var h=Ke(v,"x","sqrt");return Ue.runKernelFunc(function(u,d){var y=u.sqrt(h);return d([h]),y},{$x:h},function(u,d){var y=d[0];return{$x:function(){return u.div(y.toFloat().sqrt().mul(2))}}})}}),il=wt({step_:function(v,h){h===void 0&&(h=0);var u=Ke(v,"x","step");return Ue.runKernelFunc(function(d){return d.step(u,h)},{$x:u},function(d){return{$x:function(){return ii(d)}}})}}),Du=wt({tan_:function(v){var h=Ke(v,"x","tan");return Ue.runKernelFunc(function(u,d){var y=u.tan(h);return d([h]),y},{$x:h},function(u,d){var y=d[0];return{$x:function(){return u.div(y.cos().square())}}})}}),zl=wt({tanh_:function(v){var h=Ke(v,"x","tanh");return Ue.runKernelFunc(function(u,d){var y=u.tanh(h);return d([y]),y},{x:h},function(u,d){var y=d[0];return{x:function(){return fr(1).sub(y.square()).mulStrict(u)}}},"Tanh",{},null,[!0])}});function Ul(v,h,u,d,y,D){var z,X,oe=Ke(v,"x","batchNorm"),he=Ke(h,"mean","batchNorm"),xe=Ke(u,"variance","batchNorm");return y!=null&&(z=Ke(y,"scale","batchNorm")),d!=null&&(X=Ke(d,"offset","batchNorm")),ke(oe.rank===2,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+oe.rank+"."}),ke(he.rank===2||he.rank===1,function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank "+he.rank+"."}),ke(xe.rank===2||xe.rank===1,function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank "+xe.rank+"."}),z!=null&&ke(z.rank===2||z.rank===1,function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank "+z.rank+"."}),X!=null&&ke(X.rank===2||X.rank===1,function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank "+X.rank+"."}),Lp(oe,he,xe,X,z,D)}function Wl(v,h,u,d,y,D){var z,X,oe=Ke(v,"x","batchNorm"),he=Ke(h,"mean","batchNorm"),xe=Ke(u,"variance","batchNorm");return y!=null&&(z=Ke(y,"scale","batchNorm")),d!=null&&(X=Ke(d,"offset","batchNorm")),ke(oe.rank===3,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+oe.rank+"."}),ke(he.rank===3||he.rank===1,function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank "+he.rank+"."}),ke(xe.rank===3||xe.rank===1,function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank "+xe.rank+"."}),z!=null&&ke(z.rank===3||z.rank===1,function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank "+z.rank+"."}),X!=null&&ke(X.rank===3||X.rank===1,function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank "+X.rank+"."}),Lp(oe,he,xe,X,z,D)}function Ng(v,h,u,d,y,D){var z,X,oe=Ke(v,"x","batchNorm"),he=Ke(h,"mean","batchNorm"),xe=Ke(u,"variance","batchNorm");return y!=null&&(z=Ke(y,"scale","batchNorm")),d!=null&&(X=Ke(d,"offset","batchNorm")),ke(oe.rank===4,function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+oe.rank+"."}),ke(he.rank===4||he.rank===1,function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank "+he.rank+"."}),ke(xe.rank===4||xe.rank===1,function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank "+xe.rank+"."}),z!=null&&ke(z.rank===4||z.rank===1,function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank "+z.rank+"."}),X!=null&&ke(X.rank===4||X.rank===1,function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank "+X.rank+"."}),Lp(oe,he,xe,X,z,D)}function Lp(v,h,u,d,y,D){D==null&&(D=.001);var z,X,oe,he=Ke(v,"x","batchNorm"),xe=Ke(h,"mean","batchNorm"),Fe=Ke(u,"variance","batchNorm");y!=null&&(z=Ke(y,"scale","batchNorm")),d!=null&&(X=Ke(d,"offset","batchNorm")),ke(xe.rank===Fe.rank,function(){return"Batch normalization gradient requires mean and variance to have equal ranks."}),ke(X==null||xe.rank===X.rank,function(){return"Batch normalization gradient requires mean and offset to have equal ranks."}),ke(z==null||xe.rank===z.rank,function(){return"Batch normalization gradient requires mean and scale to have equal ranks."}),oe=he.rank===0||he.rank===1?he.as4D(1,1,1,he.size):he.rank===2?he.as4D(1,1,he.shape[0],he.shape[1]):he.rank===3?he.as4D(1,he.shape[0],he.shape[1],he.shape[2]):he;var Re=[he,xe,Fe,z];return Ue.runKernelFunc(function(Me,We){var Ze=Me.batchNormalization(oe,Tu(xe),Tu(Fe),D,Tu(z),Tu(X));return We([he,xe,Fe,z]),Ze},{x:he,mean:xe,variance:Fe,scale:z,offset:X},function(Me,We){var Ze=We,Je=Ze[0],at=Ze[1],yt=Ze[2],xt=Ze[3],kt=xt??fr(1),It=xa(at.shape,oe.shape),Jt=[];if(at.rank===1){for(var on=0;on<oe.shape.length-1;++on)Jt.push(oe.shape[on]);Jt.push(1)}var Qt=Je.sub(at),cn=Me.mul(kt),vn=tp(yt.add(fr(D))),p=vn.mul(vn).mul(vn).mul(fr(-.5));return{x:function(){return at.rank===1?Me.mul(Es(vn.as4D(1,1,1,at.shape[0]),Jt)).mul(kt).reshape(Je.shape):Me.mul(vn).mul(kt).reshape(Je.shape)},mean:function(){var c=vn.mul(fr(-1)).mul(cn);return at.rank===1&&(c=c.sum(It)),c.reshape(at.shape)},variance:function(){var c=p.mul(Qt).mul(cn);return at.rank===1&&(c=c.sum(It)),c.reshape(at.shape)},scale:function(){var c=Qt.mul(vn),o=Me.mul(c);return at.rank===1&&(o=o.sum(It)),o.reshape(at.shape)},offset:function(){var c=Me;return at.rank===1&&(c=c.sum(It)),c.reshape(at.shape)}}},"BatchNormalization",{varianceEpsilon:D},Re).reshape(he.shape)}function Tu(v){return v==null?null:v.rank===0?v.as1D():v.rank===1?v:v.rank===2?v.as4D(1,1,v.shape[0],v.shape[1]):v.rank===3?v.as4D(1,v.shape[0],v.shape[1],v.shape[2]):v}function Hu(){Cf("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon")}var Fg=wt({batchNormalization2d_:function(v,h,u,d,y,D){return d===void 0&&(d=.001),Hu(),Ul(v,h,u,D,y,d)}}),np=wt({batchNormalization3d_:function(v,h,u,d,y,D){return d===void 0&&(d=.001),Hu(),Wl(v,h,u,D,y,d)}}),Rm=wt({batchNormalization4d_:function(v,h,u,d,y,D){return d===void 0&&(d=.001),Hu(),Ng(v,h,u,D,y,d)}}),kv=wt({batchNormalization_:function(v,h,u,d,y,D){return d===void 0&&(d=.001),Hu(),Lp(v,h,u,D,y,d)}}),F0=wt({batchNorm_:Lp}),Vl=wt({batchNorm2d_:Ul}),Kh=wt({batchNorm3d_:Wl}),Wf=wt({batchNorm4d_:Ng}),Vf=wt({logicalAnd_:function(v,h){var u=Ke(v,"a","logicalAnd","bool"),d=Ke(h,"b","logicalAnd","bool");return Hi(u.shape,d.shape),Ue.runKernelFunc(function(y){return y.logicalAnd(u,d)},{a:u,b:d},null,"LogicalAnd")}}),Ig=wt({logicalNot_:function(v){var h=Ke(v,"x","logicalNot","bool");return Ue.runKernelFunc(function(u){return u.logicalNot(h)},{$x:h})}}),Mm=wt({logicalOr_:function(v,h){var u=Ke(v,"a","logicalOr","bool"),d=Ke(h,"b","logicalOr","bool");return Hi(u.shape,d.shape),Ue.runKernelFunc(function(y){return y.logicalOr(u,d)},{$a:u,$b:d})}}),qf=wt({logicalXor_:function(v,h){var u=Ke(v,"a","logicalXor","bool"),d=Ke(h,"b","logicalXor","bool");return Hi(u.shape,d.shape),Mm(v,h).logicalAnd(Vf(v,h).logicalNot())}}),ro=wt({where_:function(v,h,u){var d=Ke(h,"a","where"),y=Ke(u,"b","where"),D=Ke(v,"condition","where","bool");return Ft(d.shape,y.shape,"Error in where: "),D.rank===1?ke(D.shape[0]===d.shape[0],function(){return"The first dimension of `a` must match the size of `condition`."}):Ft(D.shape,y.shape,"Error in where: "),Ue.runKernelFunc(function(z,X){var oe=z.select(D,d,y);return X([D]),oe},{$condition:D,$a:d,$b:y},function(z,X){var oe=X[0];return{$condition:function(){return ii(oe).toFloat()},$a:function(){return z.mul(oe.cast(z.dtype))},$b:function(){return z.mul(oe.logicalNot().cast(z.dtype))}}})}}),ql=function(v){return R(this,void 0,void 0,function(){var h,u,d;return W(this,function(y){switch(y.label){case 0:return[4,(h=Ke(v,"condition","whereAsync","bool")).data()];case 1:return u=y.sent(),d=G(h.shape,u),v!==h&&h.dispose(),[2,d]}})})},Xh=wt({add_:function(v,h){var u,d=Ke(v,"a","add"),y=Ke(h,"b","add");u=An(d,y),d=u[0],y=u[1];var D=Hi(d.shape,y.shape);return Ue.runKernelFunc(function(z){return z.add(d,y)},{a:d,b:y},function(z){return{a:function(){var X=z,oe=xa(d.shape,D);return oe.length>0&&(X=X.sum(oe)),X.reshape(d.shape)},b:function(){var X=z,oe=xa(y.shape,D);return oe.length>0&&(X=X.sum(oe)),X.reshape(y.shape)}}},"Add")}}),I0=wt({addN_:function(v){ke(Array.isArray(v),function(){return"The argument passed to tf.addN() must be a list of tensors"}),ke(v.length>=1,function(){return"Must pass at least one tensor to tf.addN(), but got "+v.length});var h=v.map(function(y,D){return Ke(y,"tensors"+D,"addN")}),u=h[0];h.forEach(function(y){if(y.dtype!==u.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),h.forEach(function(y){if(!ln(y.shape,u.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")});var d=h;return Ue.runKernelFunc(function(y){return y.addN(h)},d,function(y){var D={};return h.forEach(function(z,X){D[X]=function(){return y.clone()}}),D},"AddN")}}),R0=wt({addStrict_:function(v,h){var u=Ke(v,"a","addStrict"),d=Ke(h,"b","addStrict");return Ft(u.shape,d.shape,"Error in addStrict: "),u.add(d)}}),zp=wt({atan2_:function(v,h){var u,d=Ke(v,"a","atan2"),y=Ke(h,"b","atan2");u=An(d,y),d=u[0],y=u[1];var D=Hi(d.shape,y.shape);return Ue.runKernelFunc(function(z,X){var oe=z.atan2(d,y);return X([d,y]),oe},{$a:d,$b:y},function(z,X){var oe=X[0],he=X[1];return{$a:function(){var xe=Xh(oe.square(),he.square()),Fe=z.mul(he.div(xe)),Re=xa(oe.shape,D);return Re.length>0&&(Fe=Fe.sum(Re)),Fe.reshape(oe.shape)},$b:function(){var xe=Xh(oe.square(),he.square()),Fe=Sg(z.mul(oe.div(xe))),Re=xa(he.shape,D);return Re.length>0&&(Fe=Fe.sum(Re)),Fe.reshape(he.shape)}}})}}),Hl=wt({div_:function(v,h){var u,d=Ke(v,"a","div"),y=Ke(h,"b","div");if(u=An(d,y),d=u[0],y=u[1],d.dtype==="int32"&&y.dtype==="int32")return Yh(d,y);var D=Hi(d.shape,y.shape);return Ue.runKernelFunc(function(z,X){var oe=z.realDivide(d,y);return X([d,y]),oe},{a:d,b:y},function(z,X){var oe=X[0],he=X[1];return{a:function(){var xe=z.div(he.toFloat()),Fe=xa(oe.shape,D);return Fe.length>0?xe.sum(Fe).reshape(oe.shape):xe},b:function(){var xe=z.mul(oe.toFloat()),Fe=xa(he.shape,D);Fe.length>0&&(xe=xe.sum(Fe).reshape(he.shape));var Re=he.square();return xe.div(Re.toFloat()).neg()}}},"Div")}}),ol=wt({divNoNan_:function(v,h){var u,d=Ke(v,"a","div"),y=Ke(h,"b","div");d=(u=An(d,y))[0],y=u[1];var D=Hl(d,y),z=ii(D),X=y.equal(z);return ro(X,z,D)}}),rp=wt({divStrict_:function(v,h){var u=Ke(v,"a","div"),d=Ke(h,"b","div");return Ft(u.shape,d.shape,"Error in divideStrict: "),u.div(d)}}),Yh=wt({floorDiv_:function(v,h){var u,d=Ke(v,"a","floorDiv"),y=Ke(h,"b","floorDiv");u=An(d,y),d=u[0],y=u[1];var D=Hi(d.shape,y.shape);return Ue.runKernelFunc(function(z,X){var oe=z.floorDiv(d,y);return X([d,y]),oe},{a:d,b:y},function(z,X){var oe=X[0],he=X[1];return{a:function(){var xe=z.div(he.toFloat()),Fe=xa(oe.shape,D);return Fe.length>0?xe.sum(Fe).reshape(oe.shape):xe},b:function(){var xe=z.mul(oe.toFloat()),Fe=xa(he.shape,D);Fe.length>0&&(xe=xe.sum(Fe).reshape(he.shape));var Re=he.square();return xe.div(Re.toFloat()).neg()}}},"FloorDiv")}}),Hf=wt({maximum_:function(v,h){var u,d=Ke(v,"a","maximum"),y=Ke(h,"b","maximum");return u=An(d,y),d=u[0],y=u[1],d.dtype==="bool"&&(d=d.toInt(),y=y.toInt()),Hi(d.shape,y.shape),Ue.runKernelFunc(function(D,z){var X=D.maximum(d,y);return z([d,y]),X},{a:d,b:y},function(D,z){var X=z[0],oe=z[1];return{a:function(){return D.mul(X.greaterEqual(oe).toFloat())},b:function(){return D.mul(X.less(oe).toFloat())}}},"Maximum")}}),$l=wt({maximumStrict_:function(v,h){var u=Ke(v,"a","maximumStrict"),d=Ke(h,"b","maximumStrict");return Ft(u.shape,d.shape,"Error in maximumStrict: "),u.maximum(d)}}),Gl=wt({minimum_:function(v,h){var u,d=Ke(v,"a","minimum"),y=Ke(h,"b","minimum");return u=An(d,y),d=u[0],y=u[1],d.dtype==="bool"&&(d=d.toInt(),y=y.toInt()),Hi(d.shape,y.shape),Ue.runKernelFunc(function(D,z){var X=D.minimum(d,y);return z([d,y]),X},{a:d,b:y},function(D,z){var X=z[0],oe=z[1];return{a:function(){return D.mul(X.lessEqual(oe).toFloat())},b:function(){return D.mul(X.greater(oe).toFloat())}}},"Minimum")}}),Nu=wt({minimumStrict_:function(v,h){var u=Ke(v,"a","minimumStrict"),d=Ke(h,"b","minimumStrict");return Ft(u.shape,d.shape,"Error in minimumStrict: "),u.minimum(d)}}),Jh=wt({mod_:function(v,h){var u,d=Ke(v,"a","mod"),y=Ke(h,"b","mod");u=An(d,y),d=u[0],y=u[1];var D=Hi(d.shape,y.shape);return Ue.runKernelFunc(function(z,X){var oe=z.mod(d,y);return X([d,y]),oe},{$a:d,$b:y},function(z,X){var oe=X[0],he=X[1];return{$a:function(){var xe=xa(oe.shape,D);return xe.length>0?z.sum(xe).reshape(oe.shape):z},$b:function(){var xe=z.mul(oe.div(he).floor().neg()),Fe=xa(he.shape,D);return Fe.length>0?xe.sum(Fe).reshape(he.shape):xe}}})}}),$f=wt({modStrict_:function(v,h){var u=Ke(v,"a","modStrict"),d=Ke(h,"b","modStrict");return Ft(u.shape,d.shape,"Error in modStrict: "),u.mod(d)}}),al=wt({mul_:function(v,h){var u,d=Ke(v,"a","mul"),y=Ke(h,"b","mul");u=An(d,y),d=u[0],y=u[1];var D=Hi(d.shape,y.shape);return Ue.runKernelFunc(function(z,X){var oe=z.multiply(d,y);return X([d,y]),oe},{a:d,b:y},function(z,X){var oe=X[0],he=X[1];return{a:function(){var xe=z.mul(he.toFloat()),Fe=xa(oe.shape,D);return Fe.length>0?xe.sum(Fe).reshape(oe.shape):xe},b:function(){var xe=z.mul(oe.toFloat()),Fe=xa(he.shape,D);return Fe.length>0?xe.sum(Fe).reshape(he.shape):xe}}},"Mul")}}),Nc=wt({mulStrict_:function(v,h){var u=Ke(v,"a","mul"),d=Ke(h,"b","mul");return Ft(u.shape,d.shape,"Error in multiplyStrict: "),u.mul(d)}}),Gf=wt({pow_:function(v,h){var u,d=Ke(v,"base","pow"),y=Ke(h,"exp","pow");u=An(d,y),d=u[0],y=u[1];var D=Hi(d.shape,y.shape),z=[d,y];return Ue.runKernelFunc(function(X,oe){var he=X.pow(d,y);return oe([d,y,he]),he},{a:d,b:y},function(X,oe){var he=oe[0],xe=oe[1],Fe=oe[2];return{a:function(){var Re=xe.toFloat(),Me=X.mul(Re.mul(he.pow(Re.sub(fr(1))))),We=xa(he.shape,D);return We.length>0&&(Me=Me.sum(We)),Me.reshape(he.shape)},b:function(){var Re=he.greater(0),Me=he.log().where(Re,ii(he)),We=X.mul(Fe.mul(Me)),Ze=xa(xe.shape,D);return Ze.length>0&&(We=We.sum(Ze)),We.reshape(xe.shape)}}},"Pow",{},z,[!0])}}),Up=wt({powStrict_:function(v,h){return Ft(v.shape,h.shape,"Error in powStrict: "),v.pow(h)}}),Kf=wt({squaredDifferenceStrict_:function(v,h){var u=Ke(v,"a","squaredDifferenceStrict"),d=Ke(h,"b","squaredDifferenceStrict");return Ft(u.shape,d.shape,"Error in squaredDifferenceStrict: "),u.squaredDifference(d)}}),Fc=wt({sub_:function(v,h){var u,d=Ke(v,"a","sub"),y=Ke(h,"b","sub");u=An(d,y),d=u[0],y=u[1];var D=Hi(d.shape,y.shape);return Ue.runKernelFunc(function(z){return z.subtract(d,y)},{a:d,b:y},function(z){return{a:function(){var X=z,oe=xa(d.shape,D);return oe.length>0&&(X=X.sum(oe)),X.reshape(d.shape)},b:function(){var X=z,oe=xa(y.shape,D);return oe.length>0&&(X=X.sum(oe)),X.neg().reshape(y.shape)}}},"Sub")}}),ts=wt({subStrict_:function(v,h){var u=Ke(v,"a","subStrict"),d=Ke(h,"b","subStrict");return Ft(u.shape,d.shape,"Error in subStrict: "),u.sub(d)}}),fc=wt({equal_:function(v,h){var u,d=Ke(v,"a","equal"),y=Ke(h,"b","equal");return u=An(d,y),d=u[0],y=u[1],Hi(d.shape,y.shape),Ue.runKernelFunc(function(D){return D.equal(d,y)},{$a:d,$b:y})}}),Fu=wt({equalStrict_:function(v,h){var u=Ke(v,"a","equalStrict"),d=Ke(h,"b","equalStrict");return Ft(u.shape,d.shape,"Error in equalStrict: "),u.equal(d)}}),fu=wt({greater_:function(v,h){var u,d=Ke(v,"a","greater"),y=Ke(h,"b","greater");return u=An(d,y),d=u[0],y=u[1],Hi(d.shape,y.shape),Ue.runKernelFunc(function(D){return D.greater(d,y)},{a:d,b:y},null,"Greater")}}),Qh=wt({greaterEqual_:function(v,h){var u,d=Ke(v,"a","greaterEqual"),y=Ke(h,"b","greaterEqual");return u=An(d,y),d=u[0],y=u[1],Hi(d.shape,y.shape),Ue.runKernelFunc(function(D,z){var X=D.greaterEqual(d,y);return z([d,y]),X},{a:d,b:y},function(D,z){var X=z[0],oe=z[1];return{a:function(){return ii(X)},b:function(){return ii(oe)}}},"GreaterEqual")}}),Wp=wt({greaterEqualStrict_:function(v,h){var u=Ke(v,"a","greaterEqualStrict"),d=Ke(h,"b","greaterEqualStrict");return Ft(u.shape,d.shape,"Error in greaterEqualStrict: "),u.greaterEqual(d)}}),jm=wt({greaterStrict_:function(v,h){var u=Ke(v,"a","greaterStrict"),d=Ke(h,"b","greaterStrict");return Ft(u.shape,d.shape,"Error in greaterStrict: "),u.greater(d)}}),Bm=wt({less_:function(v,h){var u,d=Ke(v,"a","less"),y=Ke(h,"b","less");return u=An(d,y),d=u[0],y=u[1],Hi(d.shape,y.shape),Ue.runKernelFunc(function(D){return D.less(d,y)},{a:d,b:y},null,"Less")}}),ip=wt({lessEqual_:function(v,h){var u,d=Ke(v,"a","lessEqual"),y=Ke(h,"b","lessEqual");return u=An(d,y),d=u[0],y=u[1],Hi(d.shape,y.shape),Ue.runKernelFunc(function(D,z){var X=D.lessEqual(d,y);return z([d,y]),X},{a:d,b:y},null,"LessEqual")}}),Ro=wt({lessEqualStrict_:function(v,h){var u=Ke(v,"a","lessEqualStrict"),d=Ke(h,"b","lessEqualStrict");return Ft(u.shape,d.shape,"Error in lessEqualStrict: "),u.lessEqual(d)}}),op=wt({lessStrict_:function(v,h){var u=Ke(v,"a","lessStrict"),d=Ke(h,"b","lessStrict");return Ft(u.shape,d.shape,"Error in lessStrict: "),u.less(d)}}),hc=wt({notEqual_:function(v,h){var u,d=Ke(v,"a","notEqual"),y=Ke(h,"b","notEqual");return u=An(d,y),d=u[0],y=u[1],Hi(d.shape,y.shape),Ue.runKernelFunc(function(D){return D.notEqual(d,y)},{a:d,b:y},null,"NotEqual")}}),Xf=wt({notEqualStrict_:function(v,h){var u=Ke(v,"a","notEqualStrict"),d=Ke(h,"b","notEqualStrict");return Ft(u.shape,d.shape,"Error in notEqualStrict: "),u.notEqual(d)}});function Yf(v,h){for(var u=[],d=v;d<h;++d)u.push(d);return u}function ap(v){for(var h=[],u=0;u<v.length;++u)for(var d=0;d<v[u].length;++d)h.push(v[u][d]);return h}var Vp=wt({gather_:function(v,h,u){u===void 0&&(u=0);var d=Ke(v,"x","gather"),y=Ke(h,"indices","gather","int32");u=wn(u,d.shape)[0];var D=function(z,X,oe){for(var he=z.shape[oe],xe=[],Fe=1,Re=1,Me=0;Me<oe;Me++)xe.push(z.shape[Me]),Fe*=z.shape[Me];for(Me=0;Me<X.rank;Me++)xe.push(X.shape[Me]);for(Me=oe+1;Me<z.rank;Me++)xe.push(z.shape[Me]),Re*=z.shape[Me];return{batchSize:Fe,sliceSize:Re,dimSize:he,outputShape:xe}}(d,y,u);return Ue.runKernelFunc(function(z,X){var oe=z.gather(d,y.flatten(),u);return X([y]),oe},{x:d,indices:y},function(z,X){var oe=X[0];return{x:function(){var he=d.shape,xe=oe.size,Fe=he.slice(0,u),Re=Fe.length,Me=he.slice(u,he.length).slice(1),We=Me.length,Ze=Yf(0,Re),Je=Yf(Re+1,Re+1+We),at=ap([Fe,[xe],Me]),yt=z.reshape(at),xt=oe.reshape([xe]),kt=ap([[Re],Ze,Je]),It=yt.transpose(kt),Jt=qp(It,xt,d.shape[u]),on=wu(kt);return Jt.transpose(on)},indices:function(){return oe}}},"Gather",{axis:u}).reshape(D.outputShape)}}),qp=wt({unsortedSegmentSum_:function(v,h,u){var d=Ke(v,"x","unsortedSegmentSum"),y=Ke(h,"segmentIds","unsortedSegmentSum","int32");return ke(nn(u),function(){return"numSegments must be of dtype int"}),Ue.runKernelFunc(function(D,z){var X=D.unsortedSegmentSum(d,y,u);return z([y]),X},{$x:d},function(D,z){var X=z[0];return{$x:function(){return function(oe,he){for(var xe=Hf(he,ii(he)),Fe=Vp(oe,xe),Re=Qh(he,fr(0,"int32")),Me=Fe.rank-Re.rank,We=0;We<Me;++We)Re=Lo(Re,We+1);Re=Vf(Re,lu(Fe.shape,"bool"));var Ze=ii(Fe);return ro(Re,Fe,Ze)}(D,X)}}})}}),Hp=function(v,h,u){return R(this,void 0,void 0,function(){var d,y,D,z,X,oe,he,xe,Fe,Re,Me,We,Ze;return W(this,function(Je){switch(Je.label){case 0:for(d=Ke(v,"tensor","boolMask"),y=Ke(h,"mask","boolMask","bool"),D=u??0,z=y.rank,X=d.shape,ke(z>0,function(){return"mask cannot be scalar"}),Ft(X.slice(D,D+z),y.shape,"mask's shape must match the first K dimensions of tensor's shape,"),oe=1,he=D;he<D+z;he++)oe*=X[he];return xe=X.slice(0,D).concat([oe],X.slice(D+z)),Fe=d.reshape(xe),Re=y.reshape([-1]),[4,ql(Re)];case 1:return Me=Je.sent(),We=Me.squeeze([1]),Ze=Vp(Fe,We,D),v!==d&&d.dispose(),h!==y&&y.dispose(),We.dispose(),Fe.dispose(),Re.dispose(),Me.dispose(),[2,Ze]}})})};function Rg(v,h,u,d,y,D,z){D===void 0&&(D="NHWC"),ke(v.length===h.rank,function(){return"Length of inShape ("+v.length+") and rank of dy ("+h.rank+") must match"});var X=v,oe=h,he=!1;h.rank===3&&(he=!0,oe=h.as4D(1,h.shape[0],h.shape[1],h.shape[2]),X=[1,v[0],v[1],v[2]]),ke(X.length===4,function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+X.length+"."}),ke(oe.rank===4,function(){return"Error in conv2dDerInput: dy must be rank 4, but got rank "+oe.rank}),ke(u.rank===4,function(){return"Error in conv2dDerInput: filter must be rank 4, but got rank "+u.rank});var xe=D==="NHWC"?X[3]:X[1],Fe=D==="NHWC"?oe.shape[3]:oe.shape[1];ke(xe===u.shape[2],function(){return"Error in conv2dDerInput: depth of input ("+xe+") must match input depth for filter "+u.shape[2]+"."}),ke(Fe===u.shape[3],function(){return"Error in conv2dDerInput: depth of output ("+Fe+") must match output depth for filter "+u.shape[3]+"."}),z!=null&&ke(nn(y),function(){return"Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode "+z+" but got pad "+y+"."});var Re=Yo(D),Me=qs(X,u.shape,d,1,y,z,!1,Re),We=Ue.runKernelFunc(function(Ze,Je){var at=Ze.conv2dDerInput(oe,u,Me);return Je([u,oe]),at},{dy4D:oe,filter:u},function(Ze,Je){var at=Je[0],yt=Je[1];return{dy4D:function(){return Zh(Ze,at,d,y,D,1,z)},filter:function(){return Pm(Ze,yt,at.shape,d,y,D,z)}}});return he?We.as3D(We.shape[1],We.shape[2],We.shape[3]):We}function $p(v){var h=function(D){return typeof D=="number"?[D,D,D]:D.length===2?[D[0],D[1],1]:D}(v),u=h[0],d=h[1],y=h[2];return u===1&&d===1&&y===1}function Kl(v,h,u,d,y){ke(v.length===h.rank,function(){return"Length of inShape ("+v.length+") and rank of dy ("+h.rank+") must match"});var D=v,z=h,X=!1;h.rank===4&&(X=!0,z=h.as5D(1,h.shape[0],h.shape[1],h.shape[2],h.shape[3]),D=[1,v[0],v[1],v[2],v[3]]);var oe=D[4],he=z.shape[4];ke(D.length===5,function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+D.length+"."}),ke(z.rank===5,function(){return"Error in conv3dDerInput: dy must be rank 5, but got rank "+z.rank}),ke(u.rank===5,function(){return"Error in conv3dDerInput: filter must be rank 5, but got rank "+u.rank}),ke(oe===u.shape[3],function(){return"Error in conv3dDerInput: depth of input ("+oe+") must match input depth for filter "+u.shape[3]+"."}),ke(he===u.shape[4],function(){return"Error in conv3dDerInput: depth of output ("+he+") must match output depth for filter "+u.shape[4]+"."});var xe=sc(D,u.shape,d,1,y),Fe=Ue.runKernelFunc(function(Re){return Re.conv3dDerInput(z,u,xe)},{dy5D:z});return X?Fe.as4D(Fe.shape[1],Fe.shape[2],Fe.shape[3],Fe.shape[4]):Fe}var Gp=wt({conv1d_:function(v,h,u,d,y,D,z){y===void 0&&(y="NWC"),D===void 0&&(D=1);var X=Ke(v,"x","conv1d"),oe=Ke(h,"filter","conv1d"),he=X,xe=!1;X.rank===2&&(xe=!0,he=X.as3D(1,X.shape[0],X.shape[1])),ke(he.rank===3,function(){return"Error in conv1d: input must be rank 3, but got rank "+he.rank+"."}),ke(oe.rank===3,function(){return"Error in conv1d: filter must be rank 3, but got rank "+oe.rank+"."}),z!=null&&ke(nn(d),function(){return"Error in conv1d: pad must be an integer when using, dimRoundingMode "+z+" but got pad "+d+"."}),ke(he.shape[2]===oe.shape[1],function(){return"Error in conv1d: depth of input ("+he.shape[2]+") must match input depth for filter "+oe.shape[1]+"."}),ke(ls(u,D),function(){return"Error in conv1D: Either stride or dilation must be 1. Got stride "+u+" and dilation '"+D+"'"}),ke(y==="NWC",function(){return"Error in conv1d: got dataFormat of "+y+" but only NWC is currently supported."});var Fe=oe.as4D(1,oe.shape[0],oe.shape[1],oe.shape[2]),Re=he.as4D(he.shape[0],1,he.shape[1],he.shape[2]),Me=Zh(Re,Fe,[1,u],d,"NHWC",[1,D],z);return xe?Me.as2D(Me.shape[2],Me.shape[3]):Me.as3D(Me.shape[0],Me.shape[2],Me.shape[3])}}),Zh=wt({conv2d_:function(v,h,u,d,y,D,z){y===void 0&&(y="NHWC"),D===void 0&&(D=[1,1]);var X=Ke(v,"x","conv2d"),oe=Ke(h,"filter","conv2d"),he=X,xe=!1;X.rank===3&&(xe=!0,he=X.as4D(1,X.shape[0],X.shape[1],X.shape[2])),ke(he.rank===4,function(){return"Error in conv2d: input must be rank 4, but got rank "+he.rank+"."}),ke(oe.rank===4,function(){return"Error in conv2d: filter must be rank 4, but got rank "+oe.rank+"."}),z!=null&&ke(nn(d),function(){return"Error in conv2d: pad must be an integer when using, dimRoundingMode "+z+" but got pad "+d+"."});var Fe=y==="NHWC"?he.shape[3]:he.shape[1];ke(Fe===oe.shape[2],function(){return"Error in conv2d: depth of input ("+Fe+") must match input depth for filter "+oe.shape[2]+"."}),ke(ls(u,D),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+u+" and dilations '"+D+"'"});var Re=Yo(y),Me=qs(he.shape,oe.shape,u,D,d,z,!1,Re),We=[oe,he],Ze=Ue.runKernelFunc(function(Je,at){var yt=Je.conv2d(he,oe,Me);return at([oe,he]),yt},{x:he,filter:oe},function(Je,at){var yt=at,xt=yt[0],kt=yt[1];return ke(_a(D),function(){return"Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+D+"'"}),{x:function(){return Lm(kt.shape,Je,xt,u,d,y)},filter:function(){return Pm(kt,Je,xt.shape,u,d,y)}}},"Conv2D",Me,We);return xe?Ze.as3D(Ze.shape[1],Ze.shape[2],Ze.shape[3]):Ze}}),Kp=wt({conv3d_:function(v,h,u,d,y,D){y===void 0&&(y="NDHWC"),D===void 0&&(D=[1,1,1]);var z=Ke(v,"x","conv3d"),X=Ke(h,"filter","conv3d"),oe=z,he=!1;z.rank===4&&(he=!0,oe=z.as5D(1,z.shape[0],z.shape[1],z.shape[2],z.shape[3])),ke(oe.rank===5,function(){return"Error in conv3d: input must be rank 5, but got rank "+oe.rank+"."}),ke(X.rank===5,function(){return"Error in conv3d: filter must be rank 5, but got rank "+X.rank+"."}),ke(oe.shape[4]===X.shape[3],function(){return"Error in conv3d: depth of input ("+oe.shape[4]+") must match input depth for filter "+X.shape[3]+"."}),ke(function(Re,Me){return $p(u)||$p(Me)}(0,D),function(){return"Error in conv3D: Either strides or dilations must be 1. Got strides "+u+" and dilations '"+D+"'"}),ke(y==="NDHWC",function(){return"Error in conv3d: got dataFormat of "+y+" but only NDHWC is currently supported."});var xe=sc(oe.shape,X.shape,u,D,d),Fe=Ue.runKernelFunc(function(Re,Me){var We=Re.conv3d(oe,X,xe);return Me([oe,X]),We},{x:oe,$filter:X},function(Re,Me){ke($p(D),function(){return"Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+D+"'"});var We=Me[0],Ze=Me[1];return{x:function(){return Kl(We.shape,Re,Ze,u,d)},$filter:function(){return function(Je,at,yt,xt,kt){var It=Je;Je.rank===4&&(It=Je.as5D(1,Je.shape[0],Je.shape[1],Je.shape[2],Je.shape[3]));var Jt=at;Jt.rank===4&&(Jt=at.as5D(1,at.shape[0],at.shape[1],at.shape[2],at.shape[3])),ke(It.rank===5,function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape "+It.shape+"."}),ke(Jt.rank===5,function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape "+Jt.shape+"."}),ke(yt.length===5,function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got "+yt+"."}),ke(It.shape[4]===yt[3],function(){return"Error in conv3dDerFilter: depth of input "+It.shape[4]+") must match input depth in filter ("+yt[3]+"."}),ke(Jt.shape[4]===yt[4],function(){return"Error in conv3dDerFilter: depth of dy ("+Jt.shape[4]+") must match output depth for filter ("+yt[4]+")."});var on=sc(It.shape,yt,xt,1,kt);return Ue.runKernelFunc(function(Qt){return Qt.conv3dDerFilter(It,Jt,on)},{x5D:It,dy5D:Jt})}(We,Re,Ze.shape,u,d)}}});return he?Fe.as4D(Fe.shape[1],Fe.shape[2],Fe.shape[3],Fe.shape[4]):Fe}}),Pm=wt({conv2dDerFilter_:function(v,h,u,d,y,D,z){D===void 0&&(D="NHWC");var X=v;v.rank===3&&(X=v.as4D(1,v.shape[0],v.shape[1],v.shape[2]));var oe=h;oe.rank===3&&(oe=h.as4D(1,h.shape[0],h.shape[1],h.shape[2])),ke(X.rank===4,function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+X.shape+"."}),ke(oe.rank===4,function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+oe.shape+"."}),ke(u.length===4,function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+u+"."});var he=D==="NHWC"?X.shape[3]:X.shape[1],xe=D==="NHWC"?oe.shape[3]:oe.shape[1];ke(he===u[2],function(){return"Error in conv2dDerFilter: depth of input "+he+") must match input depth in filter ("+u[2]+"."}),ke(xe===u[3],function(){return"Error in conv2dDerFilter: depth of dy ("+xe+") must match output depth for filter ("+u[3]+")."}),z!=null&&ke(nn(y),function(){return"Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode "+z+" but got pad "+y+"."});var Fe=Yo(D),Re=qs(X.shape,u,d,1,y,z,!1,Fe);return Ue.runKernelFunc(function(Me){return Me.conv2dDerFilter(X,oe,Re)},{x4D:X,dy4D:oe})}}),Lm=wt({conv2dDerInput_:Rg}),sp=wt({depthwiseConv2d_:function(v,h,u,d,y,D,z){D===void 0&&(D=[1,1]);var X=Ke(v,"x","depthwiseConv2d"),oe=Ke(h,"filter","depthwiseConv2d"),he=X,xe=!1;X.rank===3&&(xe=!0,he=X.as4D(1,X.shape[0],X.shape[1],X.shape[2])),ke(he.rank===4,function(){return"Error in depthwiseConv2d: input must be rank 4, but got rank "+he.rank+"."}),ke(oe.rank===4,function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+oe.rank+"."}),ke(he.shape[3]===oe.shape[2],function(){return"Error in depthwiseConv2d: number of input channels ("+he.shape[3]+") must match the inChannels dimension in filter "+oe.shape[2]+"."}),D==null&&(D=[1,1]),ke(ls(u,D),function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides "+u+" and dilations '"+D+"'"}),z!=null&&ke(nn(d),function(){return"Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode "+z+" but got pad "+d+"."});var Fe=qs(he.shape,oe.shape,u,D,d,z,!0),Re=[he,oe],Me=Ue.runKernelFunc(function(We,Ze){var Je=We.depthwiseConv2D(he,oe,Fe);return Ze([he,oe]),Je},{x:he,filter:oe},function(We,Ze){ke(_a(D),function(){return"Error in gradient of depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+D+"'"});var Je=Ze[0],at=Ze[1];return{x:function(){return zm(Je.shape,We,at,Fe)},filter:function(){return Xp(Je,We,at.shape,Fe)}}},"DepthwiseConv2dNative",Fe,Re);return xe?Me.as3D(Me.shape[1],Me.shape[2],Me.shape[3]):Me}}),zm=wt({depthwiseConv2dDerInput_:function(v,h,u,d){var y=h,D=!1;h.rank===3&&(D=!0,y=h.as4D(1,h.shape[0],h.shape[1],h.shape[2]));var z=Ue.runKernelFunc(function(X){return X.depthwiseConv2DDerInput(y,u,d)},{dy4D:y});return D?z.as3D(z.shape[1],z.shape[2],z.shape[3]):z}}),Xp=wt({depthwiseConv2dDerFilter_:function(v,h,u,d){var y=v;v.rank===3&&(y=v.as4D(1,v.shape[0],v.shape[1],v.shape[2]));var D=h;return D.rank===3&&(D=h.as4D(1,h.shape[0],h.shape[1],h.shape[2])),Ue.runKernelFunc(function(z){return z.depthwiseConv2DDerFilter(y,D,d)},{x4D:y,dy4D:D})}}),Mg=wt({separableConv2d_:function(v,h,u,d,y,D,z){D===void 0&&(D=[1,1]),z===void 0&&(z="NHWC");var X=Ke(v,"x","separableConv2d"),oe=Ke(h,"depthwiseFilter","separableConv2d"),he=Ke(u,"pointwiseFilter","separableConv2d"),xe=X,Fe=!1;if(X.rank===3&&(Fe=!0,xe=X.as4D(1,X.shape[0],X.shape[1],X.shape[2])),z==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");ke(xe.rank===4,function(){return"Error in separableConv2d: input must be rank 4, but got rank "+xe.rank+"."}),ke(oe.rank===4,function(){return"Error in separableConv2d: depthwise filter must be rank 4, but got rank "+oe.rank+"."}),ke(he.rank===4,function(){return"Error in separableConv2d: pointwise filter must be rank 4, but got rank "+oe.rank+"."}),ke(he.shape[0]===1,function(){return"Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got "+he.shape[0]+"."}),ke(he.shape[1]===1,function(){return"Error in separableConv2d: the second dimension of pointwise filter must be 1, but got "+he.shape[1]+"."});var Re=oe.shape[2],Me=oe.shape[3];ke(he.shape[2]===Re*Me,function(){return"Error in separableConv2d: the third dimension of pointwise filter must be "+Re*Me+", but got "+he.shape[2]+"."});var We=sp(xe,oe,d,y,z,D),Ze=Zh(We,he,1,"valid",z);return Fe?Ze.as3D(Ze.shape[1],Ze.shape[2],Ze.shape[3]):Ze}}),sl=wt({conv2dTranspose_:function(v,h,u,d,y,D){return Rg(u,Ke(v,"x","conv2dTranspose"),Ke(h,"filter","conv2dTranspose"),d,y,"NHWC",D)}}),M0=wt({conv3dTranspose_:function(v,h,u,d,y){return Kl(u,Ke(v,"x","conv3dTranspose"),Ke(h,"filter","conv3dTranspose"),d,y)}}),jg=wt({matMul_:function(v,h,u,d){var y;u===void 0&&(u=!1),d===void 0&&(d=!1);var D=Ke(v,"a","matMul"),z=Ke(h,"b","matMul");y=An(D,z),D=y[0],z=y[1];var X=u?D.shape[D.rank-2]:D.shape[D.rank-1],oe=d?z.shape[z.rank-1]:z.shape[z.rank-2],he=u?D.shape[D.rank-1]:D.shape[D.rank-2],xe=d?z.shape[z.rank-2]:z.shape[z.rank-1],Fe=D.shape.slice(0,-2),Re=z.shape.slice(0,-2),Me=Ye(Fe),We=Ye(Re);ke(D.rank>=2&&z.rank>=2&&D.rank===z.rank,function(){return"Error in matMul: inputs must have the same rank of at least 2, got ranks "+D.rank+" and "+z.rank+"."}),ke(ln(Fe,Re),function(){return"Error in matMul: outer dimensions ("+Fe+") and ("+Re+") of Tensors with shapes "+D.shape+" and "+z.shape+" must match."}),ke(X===oe,function(){return"Error in matMul: inner shapes ("+X+") and ("+oe+") of Tensors with shapes "+D.shape+" and "+z.shape+" and transposeA="+u+" and transposeB="+d+" must match."});var Ze=D.shape.slice(0,-2).concat([he,xe]),Je=u?D.as3D(Me,X,he):D.as3D(Me,he,X),at=d?z.as3D(We,xe,oe):z.as3D(We,oe,xe),yt={transposeA:u,transposeB:d};return Ue.runKernelFunc(function(xt,kt){var It=xt.batchMatMul(Je,at,u,d);return kt([Je,at]),It},{a:Je,b:at},function(xt,kt){var It=kt,Jt=It[0],on=It[1];return u||d?!u&&d?{a:function(){return xt.matMul(on,!1,!1)},b:function(){return xt.matMul(Jt,!0,!1)}}:u&&!d?{a:function(){return on.matMul(xt,!1,!0)},b:function(){return Jt.matMul(xt,!1,!1)}}:{a:function(){return on.matMul(xt,!0,!0)},b:function(){return xt.matMul(Jt,!0,!0)}}:{a:function(){return xt.matMul(on,!1,!0)},b:function(){return Jt.matMul(xt,!0,!1)}}},"BatchMatMul",yt).reshape(Ze)}}),up=wt({dot_:function(v,h){var u=Ke(v,"t1","dot"),d=Ke(h,"t2","dot");ke(!(u.rank!==1&&u.rank!==2||d.rank!==1&&d.rank!==2),function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+u.rank+" and "+d.rank+"."});var y=u.rank===1?u.size:u.shape[1],D=d.rank===1?d.size:d.shape[0];return ke(y===D,function(){return"Error in dot: inner dimensions of inputs must match, but got "+y+" and "+D+"."}),u.rank===1&&d.rank===1?u.as2D(1,-1).matMul(d.as2D(-1,1)).asScalar():u.rank===1&&d.rank===2?u.as2D(1,-1).matMul(d.as2D(d.shape[0],d.shape[1])).as1D():u.rank===2&&d.rank===1?u.matMul(d.as2D(-1,1)).as1D():u.matMul(d.as2D(d.shape[0],d.shape[1]))}}),Bg=wt({outerProduct_:function(v,h){var u=Ke(v,"v1","outerProduct"),d=Ke(h,"v2","outerProduct");return ke(u.rank===1&&d.rank===1,function(){return"Error in outerProduct: inputs must be rank 1, but got ranks "+u.rank+" and "+d.rank+"."}),u.as2D(-1,1).matMul(d.as2D(1,-1))}}),Xl=wt({reverse_:function(v,h){var u=Ke(v,"x","reverse");if(u.rank===0)return u.clone();var d=wn(h,u.shape);return Ue.runKernelFunc(function(y){return y.reverse(u,d)},{$x:u},function(y){return{$x:function(){return y.reverse(d)}}}).reshapeAs(u)}}),Pg=wt({reverse1d_:function(v){var h=Ke(v,"x","reverse");return ke(h.rank===1,function(){return"Error in reverse1D: x must be rank 1 but got rank "+h.rank+"."}),Xl(h,0)}}),cp=wt({reverse2d_:function(v,h){var u=Ke(v,"x","reverse");return ke(u.rank===2,function(){return"Error in reverse2D: x must be rank 2 but got rank "+u.rank+"."}),Xl(u,h)}}),Yp=wt({reverse3d_:function(v,h){var u=Ke(v,"x","reverse");return ke(u.rank===3,function(){return"Error in reverse3D: x must be rank 3 but got rank "+u.rank+"."}),Xl(u,h)}}),Lg=wt({reverse4d_:function(v,h){var u=Ke(v,"x","reverse");return ke(u.rank===4,function(){return"Error in reverse4D: x must be rank 4 but got rank "+u.rank+"."}),Xl(u,h)}});function zg(v,h,u,d,y,D){var z=Ke(v,"x","maxPool"),X=z,oe=!1;z.rank===3&&(oe=!0,X=z.as4D(1,z.shape[0],z.shape[1],z.shape[2])),d==null&&(d=[1,1]),ke(X.rank===4,function(){return"Error in maxPool: input must be rank 4 but got rank "+X.rank+"."}),ke(ls(u,d),function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides "+u+" and dilations '"+d+"'"}),D!=null&&ke(nn(y),function(){return"Error in maxPool: pad must be an integer when using, dimRoundingMode "+D+" but got pad "+y+"."});var he=ku(X.shape,h,u,d,y,D);if(he.filterWidth===1&&he.filterHeight===1&&ln(he.inShape,he.outShape))return z.clone();var xe=[X],Fe=Ue.runKernelFunc(function(Re,Me){var We=Re.maxPool(X,he);return Me([X,We]),We},{x:X},function(Re,Me){var We=Me[0],Ze=Me[1];return{x:function(){return function(Je,at,yt,xt,kt,It,Jt,on){var Qt=Ke(Je,"dy","maxPoolBackprop"),cn=Ke(at,"input","maxPoolBackprop"),vn=Ke(yt,"output","maxPoolBackprop");ke(cn.rank===Qt.rank,function(){return"Rank of input ("+cn.rank+") does not match rank of dy ("+Qt.rank+")"}),It==null&&(It=[1,1]),ke(ls(kt,It),function(){return"Error in maxPoolBackProp: Either strides or dilations must be 1. Got strides "+kt+" and dilations '"+It+"'"}),ke(Qt.rank===4,function(){return"Error in maxPoolBackprop: dy must be rank 4 but got rank "+Qt.rank+"."}),ke(cn.rank===4,function(){return"Error in maxPoolBackprop: input must be rank 4 but got rank "+cn.rank+"."});var p=ku(cn.shape,xt,kt,It,Jt,on);return Ue.runKernelFunc(function(c){return c.maxPoolBackprop(Qt,cn,vn,p)},{$dy:Qt,$input:cn})}(Re,We,Ze,h,u,d,y)}}},"MaxPool",he,xe);return oe?Fe.as3D(Fe.shape[1],Fe.shape[2],Fe.shape[3]):Fe}function Um(v,h,u,d,y,D){var z=Ke(v,"x","avgPool","float32");d==null&&(d=[1,1]),ke(ls(u,d),function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides "+u+" and dilations '"+d+"'"});var X=z,oe=!1;z.rank===3&&(oe=!0,X=z.as4D(1,z.shape[0],z.shape[1],z.shape[2])),ke(X.rank===4,function(){return"Error in avgPool: x must be rank 4 but got rank "+X.rank+"."}),D!=null&&ke(nn(y),function(){return"Error in avgPool: pad must be an integer when using, dimRoundingMode "+D+" but got pad "+y+"."});var he=ku(X.shape,h,u,d,y,D);if(he.filterWidth===1&&he.filterHeight===1&&ln(he.inShape,he.outShape))return z.clone();var xe=Ue.runKernelFunc(function(Fe){return Fe.avgPool(X,he)},{x:X},function(Fe){return{x:function(){return function(Re,Me,We,Ze,Je,at){var yt=Ke(Re,"dy","avgPoolBackprop"),xt=Ke(Me,"input","avgPoolBackprop");ke(xt.rank===yt.rank,function(){return"Rank of input ("+xt.rank+") does not match rank of dy ("+yt.rank+")"}),Je==null&&(Je=[1,1]),ke(ls(Ze,Je),function(){return"Error in avgPoolBackprop: Either strides or dilations must be 1. Got strides "+Ze+" and dilations '"+Je+"'"});var kt=xt,It=yt,Jt=!1;xt.rank===3&&(Jt=!0,kt=xt.as4D(1,xt.shape[0],xt.shape[1],xt.shape[2]),It=yt.as4D(1,yt.shape[0],yt.shape[1],yt.shape[2])),ke(It.rank===4,function(){return"Error in avgPoolBackprop: dy must be rank 4 but got rank "+It.rank+"."}),ke(kt.rank===4,function(){return"Error in avgPoolBackprop: input must be rank 4 but got rank "+kt.rank+"."});var on=ku(kt.shape,We,Ze,Je,at),Qt=Ue.runKernelFunc(function(cn){return cn.avgPoolBackprop(It,kt,on)},{dy4D:It,input4D:kt});return Jt?Qt.as3D(Qt.shape[1],Qt.shape[2],Qt.shape[3]):Qt}(Fe,X,h,u,d,y)}}},"AvgPool",he);return xe=xe.cast(z.dtype),oe?xe.as3D(xe.shape[1],xe.shape[2],xe.shape[3]):xe}var Ug=wt({maxPool_:function(v,h,u,d,y){return zg(v,h,u,1,d,y)}}),Wg=wt({avgPool_:function(v,h,u,d,y){return Um(v,h,u,1,d,y)}}),Jf=wt({pool_:function(v,h,u,d,y,D){y==null&&(y=[1,1]),D==null&&(D=1),d===0&&(d="valid");var z=Ke(v,"x","maxPool"),X=z,oe=!1;z.rank===3&&(oe=!0,X=z.as4D(1,z.shape[0],z.shape[1],z.shape[2])),ke(ls(D,y),function(){return"Error in pool: Either strides or dilations must be 1. Got strides "+D+" and dilations '"+y+"'"});var he,xe=ku(X.shape,h,D,y,d),Fe=[xe.dilationHeight,xe.dilationWidth];he=d==="same"?function(kt,It){var Jt=kt.map(function(cn,vn){return cn+(cn-1)*(It[vn]-1)}).map(function(cn){return cn-1}),on=Jt.map(function(cn){return Math.floor(cn/2)}),Qt=Jt.map(function(cn,vn){return cn-on[vn]});return Jt.map(function(cn,vn){return[on[vn],Qt[vn]]})}([xe.filterHeight,xe.filterWidth],Fe):[[0,0],[0,0]];var Re=Fe[0]===1&&Fe[1]===1,Me=function(kt,It,Jt){var on=Jt.map(function(c){return c[0]}),Qt=Jt.map(function(c){return c[1]}),cn=kt.concat(on,Qt),vn=It.map(function(c,o){return(c-cn[o]%c)%c}),p=Qt.map(function(c,o){return c+vn[o]});return[It.map(function(c,o){return[on[o],p[o]]}),It.map(function(c,o){return[0,vn[o]]})]}([xe.inHeight,xe.inWidth],Fe,he),We=Me[0],Ze=Me[1],Je=Re?d:"valid",at=Re?X:Sa(X,Fe,We),yt=(u==="avg"?function(){return Um(at,h,D,1,Je)}:function(){return zg(at,h,D,1,Je)})(),xt=Re?yt:Gc(yt,Fe,Ze);return oe?xt.as3D(xt.shape[1],xt.shape[2],xt.shape[3]):xt}}),j0=wt({maxPool3d_:function(v,h,u,d,y,D,z){D===void 0&&(D="NDHWC");var X=Ke(v,"x","maxPool3d"),oe=X,he=!1;X.rank===4&&(he=!0,oe=X.as5D(1,X.shape[0],X.shape[1],X.shape[2],X.shape[3])),z==null&&(z=[1,1,1]),ke(oe.rank===5,function(){return"Error in maxPool3d: x must be rank 5 but got rank "+oe.rank+"."}),ke(D==="NDHWC",function(){return"Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of "+D}),ke(ls(u,z),function(){return"Error in maxPool3d: Either strides or dilations must be 1. Got strides "+u+" and dilations '"+z+"'"}),y!=null&&ke(nn(d),function(){return"Error in maxPool3d: pad must be an integer when using, dimRoundingMode "+y+" but got pad "+d+"."});var xe=ac(oe.shape,h,u,z,d,y,D),Fe=Ue.runKernelFunc(function(Re,Me){var We=Re.maxPool3d(oe,xe);return Me([oe,We]),We},{x:oe},function(Re,Me){var We=Me[0],Ze=Me[1];return{x:function(){return function(Je,at,yt,xt,kt,It,Jt,on){var Qt=Ke(Je,"dy","maxPool3dBackprop"),cn=Ke(at,"input","maxPool3dBackprop"),vn=Ke(yt,"output","maxPool3dBackprop"),p=Qt,c=cn,o=vn,l=!1;cn.rank===4&&(l=!0,p=Qt.as5D(1,Qt.shape[0],Qt.shape[1],Qt.shape[2],Qt.shape[3]),c=cn.as5D(1,cn.shape[0],cn.shape[1],cn.shape[2],cn.shape[3]),o=vn.as5D(1,vn.shape[0],vn.shape[1],vn.shape[2],vn.shape[3])),ke(p.rank===5,function(){return"Error in maxPool3dBackprop: dy must be rank 5 but got rank "+p.rank+"."}),ke(c.rank===5,function(){return"Error in maxPool3dBackprop: input must be rank 5 but got rank "+c.rank+"."}),ke(o.rank===5,function(){return"Error in maxPool3dBackprop: output must be rank 5 but got rank "+o.rank+"."}),It==null&&(It=[1,1,1]),ke(ls(kt,It),function(){return"Error in maxPool3dBackprop: Either strides or dilations must be 1. Got strides "+kt+" and dilations '"+It+"'"}),on!=null&&ke(nn(Jt),function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+on+" but got pad "+Jt+"."});var g=ac(c.shape,xt,kt,It,Jt,on),S=Ue.runKernelFunc(function(j){return j.maxPool3dBackprop(p,c,o,g)},{dy5D:p,input5D:c});return l?S.as4D(S.shape[1],S.shape[2],S.shape[3],S.shape[4]):S}(Re,We,Ze,h,u,z,d,y)}}});return he?Fe.as4D(Fe.shape[1],Fe.shape[2],Fe.shape[3],Fe.shape[4]):Fe}}),Vg=wt({avgPool3d_:function(v,h,u,d,y,D,z){D===void 0&&(D="NDHWC");var X=Ke(v,"x","avgPool3d","float32"),oe=X,he=!1;X.rank===4&&(he=!0,oe=X.as5D(1,X.shape[0],X.shape[1],X.shape[2],X.shape[3])),z==null&&(z=[1,1,1]),ke(oe.rank===5,function(){return"Error in avgPool3d: x must be rank 5 but got rank "+oe.rank+"."}),ke(D==="NDHWC",function(){return"Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of "+D}),ke(ls(u,z),function(){return"Error in avgPool3d: Either strides or dilations must be 1. Got strides "+u+" and dilations '"+z+"'"}),y!=null&&ke(nn(d),function(){return"Error in avgPool3d: pad must be an integer when using, dimRoundingMode "+y+" but got pad "+d+"."});var xe=ac(oe.shape,h,u,z,d,y,D),Fe=Ue.runKernelFunc(function(Re){return Re.avgPool3d(oe,xe)},{x:oe},function(Re){return{x:function(){return function(Me,We,Ze,Je,at,yt,xt){var kt=Ke(Me,"dy","avgPool3dBackprop"),It=Ke(We,"input","avgPool3dBackprop"),Jt=kt,on=It,Qt=!1;It.rank===4&&(Qt=!0,Jt=kt.as5D(1,kt.shape[0],kt.shape[1],kt.shape[2],kt.shape[3]),on=It.as5D(1,It.shape[0],It.shape[1],It.shape[2],It.shape[3])),ke(Jt.rank===5,function(){return"Error in avgPool3dBackprop: dy must be rank 5 but got rank "+Jt.rank+"."}),ke(on.rank===5,function(){return"Error in avgPool3dBackprop: input must be rank 5 but got rank "+on.rank+"."}),at==null&&(at=[1,1,1]),ke(ls(Je,at),function(){return"Error in avgPool3dBackprop: Either strides or dilations must be 1. Got strides "+Je+" and dilations '"+at+"'"}),xt!=null&&ke(nn(yt),function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+xt+" but got pad "+yt+"."});var cn=ac(on.shape,Ze,Je,at,yt,xt),vn=Ue.runKernelFunc(function(p){return p.avgPool3dBackprop(Jt,on,cn)},{dy5D:Jt,input5D:on});return Qt?vn.as4D(vn.shape[1],vn.shape[2],vn.shape[3],vn.shape[4]):vn}(Re,oe,h,u,z,d,y)}}});return Fe=Fe.cast(oe.dtype),he?Fe.as4D(Fe.shape[1],Fe.shape[2],Fe.shape[3],Fe.shape[4]):Fe}}),ul=wt({slice_:function(v,h,u){var d,y,D=Ke(v,"x","slice");if(D.rank===0)throw new Error("Slicing scalar is not possible");(d=typeof h=="number"?[h].concat(new Array(D.rank-1).fill(0)):h.length<D.rank?h.concat(new Array(D.rank-h.length).fill(0)):h.slice()).forEach(function(oe){ke(oe!==-1,function(){return"slice() does not support negative begin indexing."})}),y=(y=u==null?new Array(D.rank).fill(-1):typeof u=="number"?[u].concat(new Array(D.rank-1).fill(-1)):u.length<D.rank?u.concat(new Array(D.rank-u.length).fill(-1)):u).map(function(oe,he){return oe>=0?oe:(ke(oe===-1,function(){return"Negative size values should be exactly -1 but got "+oe+" for the slice() size at index "+he+"."}),D.shape[he]-d[he])}),zh(D,d,y);var z=D.shape,X={begin:d,size:y};return Ue.runKernelFunc(function(oe){return oe.slice(D,d,y)},{x:D},function(oe){for(var he=[],xe=0;xe<oe.rank;xe++)he.push([d[xe],z[xe]-d[xe]-y[xe]]);return{x:function(){return oe.pad(he)}}},"Slice",X)}}),Wm=wt({slice1d_:function(v,h,u){var d=Ke(v,"x","slice1d");return ke(d.rank===1,function(){return"slice1d expects a rank-1 tensor, but got a rank-"+d.rank+" tensor"}),ul(d,[h],[u])}}),qg=wt({slice2d_:function(v,h,u){var d=Ke(v,"x","slice2d");return ke(d.rank===2,function(){return"slice2d expects a rank-2 tensor, but got a rank-"+d.rank+" tensor"}),ul(d,h,u)}}),Qf=wt({slice3d_:function(v,h,u){var d=Ke(v,"x","slice3d");return ke(d.rank===3,function(){return"slice3d expects a rank-3 tensor, but got a rank-"+d.rank+" tensor"}),ul(d,h,u)}}),cl=wt({slice4d_:function(v,h,u){var d=Ke(v,"x","slice4d");return ke(d.rank===4,function(){return"slice4d expects a rank-4 tensor, but got a rank-"+d.rank+" tensor"}),ul(d,h,u)}});function Jp(v,h,u,d,y){return h.rank<u.rank&&(h=h.reshape(_o(h.shape,d))),v.rank<u.rank&&(v=v.reshape(_o(v.shape,d))),{x:function(){var D=v.mul(u.equal(h).cast(v.dtype));return y==null?D:D.transpose(y)}}}var Vm=wt({all_:function(v,h,u){h===void 0&&(h=null),u===void 0&&(u=!1);var d=Ke(v,"x","all","bool"),y=wn(h,d.shape),D=y,z=Oa(D,d.rank);z!=null&&(d=d.transpose(z),D=Aa(D.length,d.rank));var X=Ue.runKernelFunc(function(he){return he.all(d,D)},{$x:d});if(u){var oe=_o(X.shape,y);return X.reshape(oe)}return X}}),dc=wt({any_:function(v,h,u){h===void 0&&(h=null),u===void 0&&(u=!1);var d=Ke(v,"x","any","bool"),y=wn(h,d.shape),D=y,z=Oa(D,d.rank);z!=null&&(d=d.transpose(z),D=Aa(D.length,d.rank));var X=Ue.runKernelFunc(function(he){return he.any(d,D)},{$x:d});if(u){var oe=_o(X.shape,y);return X.reshape(oe)}return X}}),qm=wt({argMax_:function(v,h){h===void 0&&(h=0);var u=Ke(v,"x","argMax");h==null&&(h=0);var d=wn(h,u.shape),y=Oa(d,u.rank);y!=null&&(u=u.transpose(y),d=Aa(d.length,u.rank));var D={axis:d[0]},z=[u];return Ue.runKernelFunc(function(X,oe){var he=X.argMax(u,d[0]);return oe([u]),he},{x:u},function(X,oe){var he=oe[0];return{x:function(){return ii(he)}}},"ArgMax",D,z)}}),Hg=wt({argMin_:function(v,h){h===void 0&&(h=0);var u=Ke(v,"x","argMin");h==null&&(h=0);var d=wn(h,u.shape),y=Oa(d,u.rank);return y!=null&&(u=u.transpose(y),d=Aa(d.length,u.rank)),Ue.runKernelFunc(function(D,z){var X=D.argMin(u,d[0]);return z([u]),X},{$x:u},function(D,z){var X=z[0];return{$x:function(){return ii(X)}}})}}),Yl=wt({logSumExp_:function(v,h,u){h===void 0&&(h=null),u===void 0&&(u=!1);var d=Ke(v,"x","logSumExp"),y=wn(h,d.shape),D=d.max(y,!0),z=d.sub(D).exp().sum(y).log(),X=D.reshape(z.shape).add(z);if(u){var oe=_o(X.shape,y);return X.reshape(oe)}return X}}),B0=wt({max_:function(v,h,u){h===void 0&&(h=null),u===void 0&&(u=!1);var d=Ke(v,"x","max"),y=d,D=wn(h,d.shape),z=D,X=Oa(z,d.rank);X!=null&&(d=d.transpose(X),z=Aa(z.length,d.rank));var oe=[d],he=Ue.runKernelFunc(function(Fe,Re){var Me=Fe.max(d,z);return Re([y,Me]),Me},{x:d},function(Fe,Re){return Jp(Fe,Re[1],Re[0],D,X)},"Max",{axes:z},oe,[!0]);if(u){var xe=_o(he.shape,D);he=he.reshape(xe)}return he}}),ed=wt({mean_:function(v,h,u){h===void 0&&(h=null),u===void 0&&(u=!1);var d=Ke(v,"x","mean"),y=wn(h,d.shape),D=Ye(So(d.shape,y)[1]);return Vs(function(z){var X=fr(D);return{value:(X.dtype===z.dtype?z:z.cast(X.dtype)).div(X).sum(h,u),gradFunc:function(oe){var he=z.shape.slice();return y.forEach(function(xe){he[xe]=1}),oe.reshape(he).mul(lu(z.shape,"float32")).div(D)}}})(d)}}),td=wt({min_:function(v,h,u){h===void 0&&(h=null),u===void 0&&(u=!1);var d=Ke(v,"x","min"),y=d,D=wn(h,d.shape),z=D,X=Oa(z,d.rank);X!=null&&(d=d.transpose(X),z=Aa(z.length,d.rank));var oe=[d],he=Ue.runKernelFunc(function(Fe,Re){var Me=Fe.min(d,z);return Re([y,Me]),Me},{x:d},function(Fe,Re){return Jp(Fe,Re[1],Re[0],D,X)},"Min",{axes:z},oe,[!0]);if(u){var xe=_o(he.shape,D);he=he.reshape(xe)}return he}}),Jl=wt({moments_:function(v,h,u){h===void 0&&(h=null),u===void 0&&(u=!1);var d=wn(h,(v=Ke(v,"x","moments")).shape),y=v.mean(d,u),D=y.shape;return u||(D=_o(y.shape,d)),{mean:y,variance:v.toFloat().sub(y.reshape(D)).square().mean(d,u)}}}),$g=wt({sum_:function(v,h,u){h===void 0&&(h=null),u===void 0&&(u=!1);var d=Ke(v,"x","sum");d.dtype==="bool"&&(d=d.toInt());var y=wn(h,d.shape);return Vs(function(D){var z=Oa(y,D.rank),X=y,oe=D;z!=null&&(oe=D.transpose(z),X=Aa(X.length,D.rank));var he=function(Me){var We=D.shape.slice();return y.forEach(function(Ze){We[Ze]=1}),Me.reshape(We).mul(lu(D.shape,"float32"))},xe={axes:X},Fe=Ue.runKernelFunc(function(Me){return Me.sum(oe,X)},{x:oe},function(Me){return{x:function(){return he(Me)}}},"Sum",xe);if(u){var Re=_o(Fe.shape,y);Fe=Fe.reshape(Re)}return{value:Fe,gradFunc:he}})(d)}}),Zf=wt({prod_:function(v,h,u){h===void 0&&(h=null),u===void 0&&(u=!1);var d=Ke(v,"x","prod");d.dtype==="bool"&&(d=d.toInt());var y=wn(h,d.shape),D=Oa(y,d.rank),z=y,X=d;D!=null&&(X=d.transpose(D),z=Aa(z.length,d.rank));var oe=Ue.runKernelFunc(function(xe){return xe.prod(X,z)},{permutedX:X});if(u){var he=_o(oe.shape,y);oe=oe.reshape(he)}return oe}}),pc=wt({elu_:function(v){var h=Ke(v,"x","elu");return Ue.runKernelFunc(function(u,d){var y=u.elu(h);return d([y]),y},{$x:h},function(u,d){var y=d[0];return{$x:function(){return Ue.runKernelFunc(function(D){return D.eluDer(u,y)},{dy:u,y})}}})}}),nd=wt({leakyRelu_:function(v,h){h===void 0&&(h=.2);var u=Ke(v,"x","leakyRelu");return Hf(fr(h).mul(u),u)}}),lp=wt({prelu_:function(v,h){var u=Ke(v,"x","prelu"),d=Ke(h,"alpha","prelu");return Ue.runKernelFunc(function(y,D){var z=y.prelu(u,d);return D([u,d]),z},{x:u,alpha:d},function(y,D){var z=D[0],X=D[1],oe=z.greater(0);return{x:function(){return ro(oe,y,y.mul(X))},alpha:function(){var he=ro(oe,ii(y),y.mul(z)),xe=xa(X.shape,y.shape);return xe.length>0&&(he=he.sum(xe)),he.reshape(X.shape)}}},"Prelu")}}),Qp=wt({relu_:function(v){var h=Ke(v,"x","relu");return h.dtype==="bool"?h.toInt():Ue.runKernelFunc(function(u,d){var y=u.relu(h);return d([h]),y},{x:h},function(u,d){var y=d[0];return{x:function(){return u.mulStrict(y.step().toFloat())}}},"Relu")}}),Hm=wt({relu6_:function(v){var h=Ke(v,"x","relu6");return h.dtype==="bool"?h.toInt():Ue.runKernelFunc(function(u,d){var y=u.relu6(h);return d([h]),y},{x:h},function(u,d){var y=d[0],D=y.lessEqual(6).mul(y.step());return{x:function(){return u.mulStrict(D.toFloat())}}},"Relu6")}}),Gg=wt({selu_:function(v){var h=Ke(v,"x","selu");return Ue.runKernelFunc(function(u,d){var y=u.selu(h);return d([h]),y},{$x:h},function(u,d){var y=d[0];return{$x:function(){var D=y.greater(fr(0)),z=fr(lc),X=fr(el),oe=u.mul(X),he=u.mul(z).mul(y.toFloat().exp());return ro(D,oe,he)}}})}}),ns=wt({transpose_:function(v,h){var u=Ke(v,"x","transpose");if(h==null&&(h=u.shape.map(function(y,D){return D}).reverse()),ke(u.rank===h.length,function(){return"Error in transpose: rank of input "+u.rank+" must match length of perm "+h+"."}),h.forEach(function(y){ke(y>=0&&y<u.rank,function(){return"All entries in 'perm' must be between 0 and "+(u.rank-1)+" but got "+h})}),u.rank<=1)return u.clone();var d={perm:h};return Ue.runKernelFunc(function(y){return y.transpose(u,h)},{x:u},function(y){var D=wu(h);return{x:function(){return y.transpose(D)}}},"Transpose",d)}}),Kg=wt({localResponseNormalization_:function(v,h,u,d,y){h===void 0&&(h=5),u===void 0&&(u=1),d===void 0&&(d=1),y===void 0&&(y=.5);var D=Ke(v,"x","localResponseNormalization");ke(D.rank===4||D.rank===3,function(){return`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank `+D.rank+"."}),ke(nn(h),function(){return"Error in localResponseNormalization: depthRadius must be an integer but got depthRadius "+h+"."});var z=D,X=!1;D.rank===3&&(X=!0,z=D.as4D(1,D.shape[0],D.shape[1],D.shape[2]));var oe=Ue.runKernelFunc(function(he,xe){var Fe=he.localResponseNormalization4D(z,h,u,d,y);return xe([z,Fe]),Fe},{x4D:z},function(he,xe){var Fe=xe[0],Re=xe[1];return{x4D:function(){return Ue.runKernelFunc(function(Me){return Me.LRNGrad(he,Fe,Re,h,u,d,y)},{})}}});return X?oe.as3D(oe.shape[1],oe.shape[2],oe.shape[3]):oe}}),rd=wt({norm_:function(v,h,u,d){h===void 0&&(h="euclidean"),u===void 0&&(u=null),d===void 0&&(d=!1);var y=function X(oe,he,xe){if(xe===void 0&&(xe=null),oe.rank===0)return oe.abs();if(oe.rank!==1&&xe===null)return X(oe.reshape([-1]),he,xe);if(oe.rank===1||typeof xe=="number"||Array.isArray(xe)&&xe.length===1){if(he===1)return oe.abs().sum(xe);if(he===1/0)return oe.abs().max(xe);if(he===-1/0)return oe.abs().min(xe);if(he==="euclidean"||he===2)return oe.abs().pow(fr(2,"int32")).sum(xe).sqrt();throw new Error("Error in norm: invalid ord value: "+he)}if(Array.isArray(xe)&&xe.length===2){if(he===1)return oe.abs().sum(xe[0]).max(xe[1]-1);if(he===1/0)return oe.abs().sum(xe[1]).max(xe[0]);if(he===-1/0)return oe.abs().sum(xe[1]).min(xe[0]);if(he==="fro"||he==="euclidean")return oe.square().sum(xe).sqrt();throw new Error("Error in norm: invalid ord value: "+he)}throw new Error("Error in norm: invalid axis: "+xe)}(v=Ke(v,"x","norm"),h,u),D=y.shape;if(d){var z=wn(u,v.shape);D=_o(y.shape,z)}return y.reshape(D)}}),Xg=wt({basicLSTMCell_:function(v,h,u,d,y,D){var z=Ke(v,"forgetBias","basicLSTMCell"),X=Ke(h,"lstmKernel","basicLSTMCell"),oe=Ke(u,"lstmBias","basicLSTMCell"),he=Ke(d,"data","basicLSTMCell"),xe=Ke(y,"c","basicLSTMCell"),Fe=Ke(D,"h","basicLSTMCell"),Re=he.concat(Fe,1).matMul(X).add(oe),Me=Re.shape[0],We=Re.shape[1]/4,Ze=[Me,We],Je=Re.slice([0,0],Ze),at=Re.slice([0,We],Ze),yt=Re.slice([0,2*We],Ze),xt=Re.slice([0,3*We],Ze),kt=Je.sigmoid().mulStrict(at.tanh()).addStrict(xe.mulStrict(z.add(yt).sigmoid()));return[kt,kt.tanh().mulStrict(xt.sigmoid())]}}),Zp=wt({multiRNNCell_:function(v,h,u,d){for(var y=Ke(h,"data","multiRNNCell"),D=Lu(u,"c","multiRNNCell"),z=Lu(d,"h","multiRNNCell"),X=y,oe=[],he=0;he<v.length;he++){var xe=v[he](X,D[he],z[he]);oe.push(xe[0]),oe.push(xe[1]),X=xe[1]}var Fe=[],Re=[];for(he=0;he<oe.length;he+=2)Fe.push(oe[he]),Re.push(oe[he+1]);return[Fe,Re]}}),Ql=wt({movingAverage_:function(v,h,u,d,y){y===void 0&&(y=!0);var D=Ke(v,"v","movingAverage"),z=Ke(h,"x","movingAverage"),X=Ke(u,"decay","movingAverage");Ln(D,z),ke(ln(D.shape,z.shape),function(){return"Shape mismatch in v and x"});var oe=fr(1),he=oe.sub(X),xe=z.sub(D).mul(he);if(y){ke(d!=null,function(){return"When using zeroDebias: true, step is required."});var Fe=Ke(d,"step","movingAverage");xe=xe.div(oe.sub(Gf(X,Fe)))}return D.add(xe)}}),fp=wt({stridedSlice_:function(v,h,u,d,y,D,z,X,oe){if(y===void 0&&(y=0),D===void 0&&(D=0),z===void 0&&(z=0),X===void 0&&(X=0),oe===void 0&&(oe=0),d==null&&(d=new Array(h.length)),z!==0)throw new Error("ellipsis mask is not yet supported");var he=Ke(v,"x","stridedSlice"),xe=ba(X),Fe=he.shape.slice();xe.forEach(function(Je){h[Je]=0,u[Je]=1,Fe.splice(Je,0,1)}),he=he.reshape(Fe);for(var Re=0;Re<he.rank;Re++)h[Re]=Cs(y,h,d,he.shape,Re),u[Re]=Ml(D,u,d,he.shape,Re),d[Re]=d[Re]||1;var Me=ba(oe);Me.forEach(function(Je){u[Je]=h[Je]+1,d[Je]=1});var We=Rl(h,u,d),Ze=We.filter(function(Je,at){return Me.indexOf(at)===-1});return d.every(function(Je){return Je===1})?ul(he,h,We).reshape(Ze):Ue.runKernelFunc(function(Je){return Je.stridedSlice(he,h,u,d)},{$x:he}).reshape(Ze)}}),ll=wt({topk_:function(v,h,u){h===void 0&&(h=1),u===void 0&&(u=!0);var d=Ke(v,"x","topk");if(d.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");var y=d.shape[d.shape.length-1];if(h>y)throw new Error("'k' passed to topk() must be <= the last dimension ("+y+") but got "+h);var D=Ue.runKernelFunc(function(z){return z.topk(d,h,u)},{$x:d});return{values:D[0],indices:D[1]}}}),Yg=wt({scatterND_:function(v,h,u){var d=Ke(v,"indices","scatterND","int32"),y=Ke(h,"updates","scatterND");return Nf(y,d,u),Ue.runKernelFunc(function(D){return D.scatterND(d,y,u)},{indices:d,updates:y},null,"ScatterNd",{shape:u})}}),em=wt({fft_:function(v){ke(v.dtype==="complex64",function(){return"The dtype for tf.spectral.fft() must be complex64 but got "+v.dtype+"."});var h=v.shape[v.shape.length-1],u=v.size/h,d=v.as2D(u,h);return Ue.runKernelFunc(function(y){return y.fft(d)},{input:v}).reshape(v.shape)}}),tm=wt({ifft_:function(v){ke(v.dtype==="complex64",function(){return"The dtype for tf.spectral.ifft() must be complex64 but got "+v.dtype+"."});var h=v.shape[v.shape.length-1],u=v.size/h,d=v.as2D(u,h);return Ue.runKernelFunc(function(y){return y.ifft(d)},{input:v}).reshape(v.shape)}}),$m=wt({rfft_:function(v,h){ke(v.dtype==="float32",function(){return"The dtype for rfft() must be real value but got "+v.dtype});var u,d=v.shape[v.shape.length-1],y=v.size/d;if(h!=null&&h<d){var D=v.shape.map(function(at){return 0}),z=v.shape.map(function(at){return at});z[v.shape.length-1]=h,u=v.slice(D,z),d=h}else if(h!=null&&h>d){var X=v.shape.map(function(at){return at});X[v.shape.length-1]=h-d,u=v.concat(Ki(X),v.shape.length-1),d=h}else u=v;var oe=u.zerosLike(),he=ho(u,oe).as2D(y,d),xe=em(he),Fe=Math.floor(d/2)+1,Re=ca(xe),Me=Ua(xe),We=Re.split([Fe,d-Fe],Re.shape.length-1),Ze=Me.split([Fe,d-Fe],Me.shape.length-1),Je=u.shape.slice();return Je[u.shape.length-1]=Fe,ho(We[0],Ze[0]).reshape(Je)}}),Ic=wt({irfft_:function(v){var h=v.shape[v.shape.length-1],u=v.size/h;if(h<=2){var d=v.as2D(u,h),y=tm(d);return ca(y)}var D=[u,2*(h-1)],z=ca(v).as2D(u,h),X=Ua(v).as2D(u,h),oe=z.slice([0,1],[u,h-2]).reverse(1),he=X.slice([0,1],[u,h-2]).reverse(1).mul(fr(-1)),xe=z.concat(oe,1),Fe=X.concat(he,1);return d=ho(xe,Fe).as2D(D[0],D[1]),y=tm(d),ca(y)}}),nm=Object.freeze({fft:em,ifft:tm,rfft:$m,irfft:Ic}),Jg=wt({sparseToDense_:function(v,h,u,d){d===void 0&&(d=0);var y=Ke(v,"sparseIndices","sparseToDense","int32"),D=Ke(h,"sparseValues","sparseToDense"),z=Ke(d,"defaultValue","sparseToDense",D.dtype);return function(X,oe,he,xe){if(X.dtype!=="int32")throw new Error("tf.sparseToDense() expects the indices to be int32 type, but the dtype was "+X.dtype+".");if(X.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix, but got shape "+X.shape+".");var Fe=X.rank>0?X.shape[0]:1,Re=X.rank>1?X.shape[1]:1;if(he.length!==Re)throw new Error("outputShape has incorrect number of elements:, "+he.length+", should be: "+Re+".");var Me=oe.size;if(oe.rank!==0&&(oe.rank!==1||Me!==Fe))throw new Error("sparseValues has incorrect shape "+oe.shape+", should be [] or ["+Fe+"]");if(oe.dtype!==xe.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}(y,D,u,z),Ue.runKernelFunc(function(X){return X.sparseToDense(y,D,u,z)},{$sparseIndices:y,$sparseValues:D,$defaultValue:z})}}),fl=wt({gatherND_:function(v,h){var u=Ke(h,"indices","gatherND","int32"),d=Ke(v,"x","gatherND");return Ue.runKernelFunc(function(y){return y.gatherND(d,u)},{x:d,indices:u},null,"GatherNd")}}),hp=wt({diag_:function(v){var h=Ke(v,"x","diag").flatten(),u=v.shape.concat(v.shape);return Ue.runKernelFunc(function(d){return d.diag(h)},{$x:h}).reshape(u)}}),eh=wt({dropout_:function(v,h,u,d){var y=Ke(v,"x","dropout");if(ke(y.dtype==="float32",function(){return"x has to be a floating point tensor since it's going to be scaled, but got a "+y.dtype+" tensor instead."}),ke(h>=0&&h<1,function(){return"rate must be a float in the range [0, 1), but got "+h+"."}),h===0)return v instanceof Mt?y.clone():y;var D=function(oe,he){if(he==null)return oe.shape.slice();if(ln(oe.shape,he))return he;if(oe.shape.length===he.length){for(var xe=[],Fe=0;Fe<oe.shape.length;Fe++)he[Fe]==null&&oe.shape[Fe]!=null?xe.push(oe.shape[Fe]):xe.push(he[Fe]);return xe}return he}(y,u),z=1-h,X=Fl(D,0,1,"float32",d).add(z).floor().div(z);return y.mul(X)}});function dp(v,h,u){for(var d=1-v%2,y=new Float32Array(v),D=0;D<v;++D){var z=2*Math.PI*D/(v+d-1);y[D]=h-u*Math.cos(z)}return Us(y,"float32")}var rs,rm=wt({hannWindow_:function(v){return dp(v,.5,.5)}}),Gm=wt({hammingWindow_:function(v){return dp(v,.54,.46)}}),pp=wt({frame_:function(v,h,u,d,y){d===void 0&&(d=!1),y===void 0&&(y=0);for(var D=0,z=[];D+h<=v.size;)z.push(ul(v,D,h)),D+=u;if(d)for(;D<v.size;){var X=D+h-v.size,oe=Po([ul(v,D,h-X),ws([X],y)]);z.push(oe),D+=u}return z.length===0?nu([],[0,h]):Po(z).as2D(z.length,h)}}),mp=wt({stft_:function(v,h,u,d,y){var D;y===void 0&&(y=rm),d==null&&(D=h,d=Math.floor(Math.pow(2,Math.ceil(Math.log(D)/Math.log(2)))));for(var z=pp(v,h,u),X=al(z,y(h)),oe=[],he=0;he<z.shape[0];he++)oe.push($m(X.slice([he,0],[1,h]),d));return Po(oe)}}),Km=Object.freeze({hannWindow:rm,hammingWindow:Gm,frame:pp,stft:mp}),Qg=function(v,h,u){return u===void 0&&(u=1),R(this,void 0,void 0,function(){var d,y,D,z,X,oe,he,xe,Fe,Re,Me,We,Ze,Je;return W(this,function(at){switch(at.label){case 0:return d=Ke(v,"predictions","inTopK"),y=Ke(h,"targets","inTopK"),ke(d.rank>1,function(){return"inTopK() expects the predictions to be of rank 2 or higher, but got "+d.rank}),ke(d.rank-1===y.rank,function(){return"predictions rank should be 1 larger than targets rank, but got predictions rank "+d.rank+" and targets rank "+y.rank}),Ft(d.shape.slice(0,d.shape.length-1),y.shape,"predictions's shape should be align with the targets' shape, except the last dimension."),D=d.shape[d.shape.length-1],ke(u>0&&u<=D,function(){return"'k' passed to inTopK() must be > 0 && <= the predictions last dimension ("+D+"), but got "+u}),[4,d.data()];case 1:return z=at.sent(),[4,y.data()];case 2:for(X=at.sent(),oe=[z.length/D,D],xe=oe[1],Fe=Hn("bool",he=oe[0]),Re=0;Re<he;Re++){for(Me=Re*xe,We=z.subarray(Me,Me+xe),Ze=[],Je=0;Je<We.length;Je++)Ze.push({value:We[Je],index:Je});for(Ze.sort(function(yt,xt){return xt.value-yt.value}),Fe[Re]=0,Je=0;Je<u;Je++)if(Ze[Je].index===X[Re]){Fe[Re]=1;break}}return v!==d&&d.dispose(),h!==y&&y.dispose(),[2,ko(Fe,y.shape,"bool")]}})})};(function(v){v[v.NONE=0]="NONE",v[v.MEAN=1]="MEAN",v[v.SUM=2]="SUM",v[v.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"})(rs||(rs={}));var P0=wt({absoluteDifference_:function(v,h,u,d){d===void 0&&(d=rs.SUM_BY_NONZERO_WEIGHTS);var y=Ke(v,"labels","absoluteDifference"),D=Ke(h,"predictions","absoluteDifference"),z=null;u!=null&&(z=Ke(u,"weights","absoluteDifference")),Ft(y.shape,D.shape,"Error in absoluteDifference: ");var X=y.sub(D).abs();return Rc(X,z,d)}}),Rc=wt({computeWeightedLoss_:function(v,h,u){u===void 0&&(u=rs.SUM_BY_NONZERO_WEIGHTS);var d=Ke(v,"losses","computeWeightedLoss"),y=null;h!=null&&(y=Ke(h,"weights","computeWeightedLoss"));var D=y==null?d:d.mul(y);if(u===rs.NONE)return D;if(u===rs.SUM)return D.sum();if(u===rs.MEAN){if(y==null)return D.mean();var z=d.size/y.size,X=D.sum().div(y.sum());return z>1?X.div(fr(z)):X}if(u===rs.SUM_BY_NONZERO_WEIGHTS){if(y==null)return D.sum().div(fr(d.size));var oe=y.mul(lu(d.shape)).notEqual(fr(0)).sum().toFloat();return D.sum().div(oe)}throw Error("Unknown reduction: "+u)}}),th=wt({cosineDistance_:function(v,h,u,d,y){y===void 0&&(y=rs.SUM_BY_NONZERO_WEIGHTS);var D=Ke(v,"labels","cosineDistance"),z=Ke(h,"predictions","cosineDistance"),X=null;d!=null&&(X=Ke(d,"weights","cosineDistance")),Ft(D.shape,z.shape,"Error in cosineDistance: ");var oe=fr(1).sub(D.mul(z).sum(u,!0));return Rc(oe,X,y)}}),L0=wt({hingeLoss_:function(v,h,u,d){d===void 0&&(d=rs.SUM_BY_NONZERO_WEIGHTS);var y=Ke(v,"labels","hingeLoss"),D=Ke(h,"predictions","hingeLoss"),z=null;u!=null&&(z=Ke(u,"weights","hingeLoss")),Ft(y.shape,D.shape,"Error in hingeLoss: ");var X=fr(1);y=fr(2).mul(y).sub(X);var oe=X.sub(y.mul(D)).relu();return Rc(oe,z,d)}}),Zg=wt({huberLoss_:function(v,h,u,d,y){d===void 0&&(d=1),y===void 0&&(y=rs.SUM_BY_NONZERO_WEIGHTS);var D=Ke(v,"labels","huberLoss"),z=Ke(h,"predictions","huberLoss"),X=null;u!=null&&(X=Ke(u,"weights","huberLoss")),Ft(D.shape,z.shape,"Error in huberLoss: ");var oe=fr(d),he=z.sub(D).abs(),xe=Gl(he,oe),Fe=he.sub(xe),Re=fr(.5).mul(xe.square()).add(oe.mul(Fe));return Rc(Re,X,y)}}),Mc=wt({logLoss_:function(v,h,u,d,y){d===void 0&&(d=1e-7),y===void 0&&(y=rs.SUM_BY_NONZERO_WEIGHTS);var D=Ke(v,"labels","logLoss"),z=Ke(h,"predictions","logLoss"),X=null;u!=null&&(X=Ke(u,"weights","logLoss")),Ft(D.shape,z.shape,"Error in logLoss: ");var oe=fr(1),he=fr(d),xe=D.mul(z.add(he).log()).neg().sub(oe.sub(D).mul(oe.sub(z).add(he).log()));return Rc(xe,X,y)}}),Ka=wt({meanSquaredError_:function(v,h,u,d){d===void 0&&(d=rs.SUM_BY_NONZERO_WEIGHTS);var y=Ke(v,"labels","meanSquaredError"),D=Ke(h,"predictions","meanSquaredError"),z=null;u!=null&&(z=Ke(u,"weights","meanSquaredError")),Ft(y.shape,D.shape,"Error in meanSquaredError: ");var X=y.squaredDifference(D);return Rc(X,z,d)}}),id=wt({sigmoidCrossEntropy_:function(v,h,u,d,y){d===void 0&&(d=0),y===void 0&&(y=rs.SUM_BY_NONZERO_WEIGHTS);var D=Ke(v,"multiClassLabels","sigmoidCrossEntropy"),z=Ke(h,"logits","sigmoidCrossEntropy"),X=null;if(u!=null&&(X=Ke(u,"weights","sigmoidCrossEntropy")),Ft(D.shape,z.shape,"Error in sigmoidCrossEntropy: "),d>0){var oe=fr(d),he=fr(1),xe=fr(.5);D=D.mul(he.sub(oe)).add(xe.mul(oe))}var Fe=function(Re,Me){var We=Ke(Re,"labels","sigmoidCrossEntropyWithLogits"),Ze=Ke(Me,"logits","sigmoidCrossEntropyWithLogits");Ft(We.shape,Ze.shape,"Error in sigmoidCrossEntropyWithLogits: ");var Je=Ze.relu(),at=Ze.mul(We),yt=Ze.abs().neg().exp().log1p();return Je.sub(at).add(yt)}(D,z);return Rc(Fe,X,y)}}),gp=wt({softmaxCrossEntropy_:function(v,h,u,d,y){d===void 0&&(d=0),y===void 0&&(y=rs.SUM_BY_NONZERO_WEIGHTS);var D=Ke(v,"onehotLabels","softmaxCrossEntropy"),z=Ke(h,"logits","softmaxCrossEntropy"),X=null;if(u!=null&&(X=Ke(u,"weights","softmaxCrossEntropy")),Ft(D.shape,z.shape,"Error in softmaxCrossEntropy: "),d>0){var oe=fr(d),he=fr(1),xe=fr(D.shape[1]);D=D.mul(he.sub(oe)).add(oe.div(xe))}var Fe=function(Re,Me,We){if(We===void 0&&(We=-1),We===-1&&(We=Me.rank-1),We!==Me.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank "+Me.rank+" and dim was "+We);return Vs(function(Ze,Je,at){var yt=Je.logSumExp([We],!0),xt=Je.toFloat().sub(yt);return at([Ze,xt]),{value:xt.mul(Ze).neg().sum([We]),gradFunc:function(kt,It){var Jt=It[0],on=It[1],Qt=_o(kt.shape,[We]);return[kt.reshape(Qt).mul(Jt.toFloat().sub(on.exp())),kt.reshape(Qt).mul(on.exp().sub(Jt.toFloat()))]}}})(Re,Me)}(D,z);return Rc(Fe,X,y)}}),im=Object.freeze({get Reduction(){return rs},absoluteDifference:P0,computeWeightedLoss:Rc,cosineDistance:th,hingeLoss:L0,huberLoss:Zg,logLoss:Mc,meanSquaredError:Ka,sigmoidCrossEntropy:id,softmaxCrossEntropy:gp});function e0(v,h){return h===void 0&&(h=!1),Ue.tidy(function(){if(v.shape.length!==2)throw new Error("qr2d() requires a 2D Tensor, but got a "+v.shape.length+"D Tensor.");for(var u=v.shape[0],d=v.shape[1],y=Bh(u),D=v.clone(),z=nu([[1]],[1,1]),X=z.clone(),oe=u>=d?d:u,he=function(Fe){var Re,Me=D,We=X,Ze=y;Re=Ue.tidy(function(){var Je=D.slice([Fe,Fe],[u-Fe,1]),at=Je.norm(),yt=D.slice([Fe,Fe],[1,1]),xt=nu([[-1]]).where(yt.greater(0),nu([[1]])),kt=yt.sub(xt.mul(at)),It=Je.div(kt);X=It.shape[0]===1?z.clone():z.concat(It.slice([1,0],[It.shape[0]-1,It.shape[1]]),0);var Jt=xt.matMul(kt).div(at).neg(),on=D.slice([Fe,0],[u-Fe,d]),Qt=Jt.mul(X);if(Fe===0)D=on.sub(Qt.matMul(X.transpose().matMul(on)));else{var cn=on.sub(Qt.matMul(X.transpose().matMul(on)));D=D.slice([0,0],[Fe,d]).concat(cn,0)}var vn=y.slice([0,Fe],[u,y.shape[1]-Fe]);if(Fe===0)y=vn.sub(vn.matMul(X).matMul(Qt.transpose()));else{var p=vn.sub(vn.matMul(X).matMul(Qt.transpose()));y=y.slice([0,0],[u,Fe]).concat(p,1)}return[X,D,y]}),X=Re[0],D=Re[1],y=Re[2],No([Me,We,Ze])},xe=0;xe<oe;++xe)he(xe);return!h&&u>d&&(y=y.slice([0,0],[u,d]),D=D.slice([0,0],[d,d])),[y,D]})}var om=wt({bandPart_:function(v,h,u){if(h%1!=0)throw new Error("bandPart(): numLower must be an integer, got "+h+".");if(u%1!=0)throw new Error("bandPart(): numUpper must be an integer, got "+u+".");var d=Ke(v,"a","bandPart");if(d.rank<2)throw new Error("bandPart(): Rank must be at least 2, got "+d.rank+".");var y=d.shape,D=d.shape.slice(-2),z=D[0],X=D[1];if(!(h<=z))throw new Error("bandPart(): numLower ("+h+") must not be greater than the number of rows ("+z+").");if(!(u<=X))throw new Error("bandPart(): numUpper ("+u+") must not be greater than the number of columns ("+X+").");h<0&&(h=z),u<0&&(u=X);var oe=oc(0,z,1,"int32").reshape([-1,1]),he=oc(0,X,1,"int32"),xe=Fc(oe,he),Fe=Vf(xe.lessEqual(fr(+h,"int32")),xe.greaterEqual(fr(-u,"int32"))),Re=Ki([z,X],d.dtype);return Mi(Ra(d.reshape([-1,z,X])).map(function(Me){return ro(Fe,Me,Re)})).reshape(y)}}),Zl=wt({gramSchmidt_:function(v){var h;if(Array.isArray(v)){h=!1,ke(v!=null&&v.length>0,function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"});for(var u=v[0].shape[0],d=function(oe){ke(v[oe].shape[0]===u,function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: ("+v[oe].shape[0]+" vs. "+u+")"})},y=1;y<v.length;++y)d(y)}else h=!0,v=Ri(v,v.shape[0],0).map(function(oe){return Ia(oe,[0])});ke(v.length<=v[0].shape[0],function(){return"Gram-Schmidt: Number of vectors ("+v.length+") exceeds number of dimensions ("+v[0].shape[0]+")."});var D=[],z=v,X=function(oe){D.push(Ue.tidy(function(){var he=z[oe];if(oe>0)for(var xe=0;xe<oe;++xe){var Fe=$g(D[xe].mulStrict(he)).mul(D[xe]);he=he.sub(Fe)}return he.div(rd(he,"euclidean"))}))};for(y=0;y<v.length;++y)X(y);return h?Mi(D,0):D}}),Ev=wt({qr_:function(v,h){if(h===void 0&&(h=!1),v.rank<2)throw new Error("qr() requires input tensor to have a rank >= 2, but got rank "+v.rank);if(v.rank===2)return e0(v,h);var u=v.shape.slice(0,v.shape.length-2).reduce(function(D,z){return D*z}),d=[],y=[];return Ra(v.reshape([u,v.shape[v.shape.length-2],v.shape[v.shape.length-1]]),0).forEach(function(D){var z=e0(D,h),X=z[0],oe=z[1];d.push(X),y.push(oe)}),[Mi(d,0).reshape(v.shape),Mi(y,0).reshape(v.shape)]}}),am=Object.freeze({bandPart:om,gramSchmidt:Zl,qr:Ev});function Wa(v,h,u,d,y,D){d==null&&(d=.5),y==null&&(y=Number.NEGATIVE_INFINITY),D==null&&(D=0);var z=v.shape[0];return u=Math.min(u,z),ke(0<=d&&d<=1,function(){return"iouThreshold must be in [0, 1], but was '"+d+"'"}),ke(v.rank===2,function(){return"boxes must be a 2D tensor, but was of rank '"+v.rank+"'"}),ke(v.shape[1]===4,function(){return"boxes must have 4 columns, but 2nd dimension was "+v.shape[1]}),ke(h.rank===1,function(){return"scores must be a 1D tensor"}),ke(h.shape[0]===z,function(){return"scores has incompatible shape with boxes. Expected "+z+", but was "+h.shape[0]}),ke(0<=D&&D<=1,function(){return"softNmsSigma must be in [0, 1], but was '"+D+"'"}),{maxOutputSize:u,iouThreshold:d,scoreThreshold:y,softNmsSigma:D}}var vp=wt({resizeBilinear_:function(v,h,u){u===void 0&&(u=!1);var d=Ke(v,"images","resizeBilinear");ke(d.rank===3||d.rank===4,function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got rank "+d.rank+"."}),ke(h.length===2,function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+h+"."});var y=d,D=!1;d.rank===3&&(D=!0,y=d.as4D(1,d.shape[0],d.shape[1],d.shape[2]));var z=h[0],X=h[1],oe=Ue.runKernelFunc(function(he,xe){return xe([y]),he.resizeBilinear(y,z,X,u)},{x:y},function(he,xe){return{x:function(){return Ue.runKernelFunc(function(Fe){return Fe.resizeBilinearBackprop(he,xe[0],u)},{})}}},"ResizeBilinear",{alignCorners:u,newHeight:z,newWidth:X});return D?oe.as3D(oe.shape[1],oe.shape[2],oe.shape[3]):oe}}),nh=wt({resizeNearestNeighbor_:function(v,h,u){u===void 0&&(u=!1);var d=Ke(v,"images","resizeNearestNeighbor");ke(d.rank===3||d.rank===4,function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank "+d.rank+"."}),ke(h.length===2,function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+h+"."}),ke(d.dtype==="float32"||d.dtype==="int32",function(){return"`images` must have `int32` or `float32` as dtype"});var y=d,D=!1;d.rank===3&&(D=!0,y=d.as4D(1,d.shape[0],d.shape[1],d.shape[2]));var z=h[0],X=h[1],oe=Ue.runKernelFunc(function(he,xe){return xe([y]),he.resizeNearestNeighbor(y,z,X,u)},{batchImages:y},function(he,xe){return{batchImages:function(){return Ue.runKernelFunc(function(Fe){return Fe.resizeNearestNeighborBackprop(he,xe[0],u)},{})}}});return D?oe.as3D(oe.shape[1],oe.shape[2],oe.shape[3]):oe}}),sm=wt({nonMaxSuppression_:function(v,h,u,d,y){d===void 0&&(d=.5),y===void 0&&(y=Number.NEGATIVE_INFINITY);var D=Ke(v,"boxes","nonMaxSuppression"),z=Ke(h,"scores","nonMaxSuppression"),X=Wa(D,z,u,d,y);u=X.maxOutputSize,d=X.iouThreshold,y=X.scoreThreshold;var oe={maxOutputSize:u,iouThreshold:d,scoreThreshold:y};return Ue.runKernelFunc(function(he){return he.nonMaxSuppression(D,z,u,d,y)},{boxes:D,scores:z},null,"NonMaxSuppressionV3",oe)}}),yp=wt({nonMaxSuppressionWithScore_:function(v,h,u,d,y,D){d===void 0&&(d=.5),y===void 0&&(y=Number.NEGATIVE_INFINITY),D===void 0&&(D=0);var z=Ke(v,"boxes","nonMaxSuppression"),X=Ke(h,"scores","nonMaxSuppression"),oe=Wa(z,X,u,d,y,D),he={maxOutputSize:u=oe.maxOutputSize,iouThreshold:d=oe.iouThreshold,scoreThreshold:y=oe.scoreThreshold,softNmsSigma:D=oe.softNmsSigma},xe=Ue.runKernel("NonMaxSuppressionV5",{boxes:z,scores:X},he);return{selectedIndices:xe[0],selectedScores:xe[1]}}}),Xm=wt({cropAndResize_:function(v,h,u,d,y,D){var z=Ke(v,"image","cropAndResize"),X=Ke(h,"boxes","cropAndResize","float32"),oe=Ke(u,"boxInd","cropAndResize","int32");y=y||"bilinear",D=D||0;var he=X.shape[0];return ke(z.rank===4,function(){return"Error in cropAndResize: image must be rank 4,but got rank "+z.rank+"."}),ke(X.rank===2&&X.shape[1]===4,function(){return"Error in cropAndResize: boxes must be have size ["+he+",4] but had shape "+X.shape+"."}),ke(oe.rank===1&&oe.shape[0]===he,function(){return"Error in cropAndResize: boxInd must be have size ["+he+"] but had shape "+X.shape+"."}),ke(d.length===2,function(){return"Error in cropAndResize: cropSize must be of length 2, but got length "+d.length+"."}),ke(d[0]>=1&&d[1]>=1,function(){return"cropSize must be atleast [1,1], but was "+d}),ke(y==="bilinear"||y==="nearest",function(){return"method must be bilinear or nearest, but was "+y}),Ue.runKernelFunc(function(xe,Fe){return xe.cropAndResize(z,X,oe,d,y,D)},{images:z,boxes:X,boxInd:oe},null,"CropAndResize",{method:y,extrapolationValue:D,cropSize:d})}}),Ym=Object.freeze({resizeBilinear:vp,resizeNearestNeighbor:nh,nonMaxSuppression:sm,nonMaxSuppressionAsync:function(v,h,u,d,y){return d===void 0&&(d=.5),y===void 0&&(y=Number.NEGATIVE_INFINITY),R(this,void 0,void 0,function(){var D,z,X,oe,he,xe,Fe;return W(this,function(Re){switch(Re.label){case 0:return D=Ke(v,"boxes","nonMaxSuppressionAsync"),z=Ke(h,"scores","nonMaxSuppressionAsync"),X=Wa(D,z,u,d,y),u=X.maxOutputSize,d=X.iouThreshold,y=X.scoreThreshold,[4,Promise.all([D.data(),z.data()])];case 1:return oe=Re.sent(),he=oe[0],xe=oe[1],Fe=Ou(he,xe,u,d,y),D!==v&&D.dispose(),z!==h&&z.dispose(),[2,Fe]}})})},nonMaxSuppressionWithScore:yp,nonMaxSuppressionWithScoreAsync:function(v,h,u,d,y,D){return d===void 0&&(d=.5),y===void 0&&(y=Number.NEGATIVE_INFINITY),D===void 0&&(D=0),R(this,void 0,void 0,function(){var z,X,oe,he,xe,Fe,Re;return W(this,function(Me){switch(Me.label){case 0:return z=Ke(v,"boxes","nonMaxSuppressionAsync"),X=Ke(h,"scores","nonMaxSuppressionAsync"),oe=Wa(z,X,u,d,y,D),u=oe.maxOutputSize,d=oe.iouThreshold,y=oe.scoreThreshold,D=oe.softNmsSigma,[4,Promise.all([z.data(),X.data()])];case 1:return he=Me.sent(),xe=he[0],Fe=he[1],Re=Au(xe,Fe,u,d,y,D),z!==v&&z.dispose(),X!==h&&X.dispose(),[2,Re]}})})},cropAndResize:Xm}),ef=function(v,h){return!(v>0)||h==="linear"},$u=function(v,h,u){if(u==null||u==="linear")return v;if(u==="relu")return v.mul(h.step());throw new Error("Gradient for activation "+u+" has not been implemented yet.")},t0=function(v,h){var u=h,d=xa(v.shape,h.shape);return d.length>0&&(u=u.sum(d)),u.reshape(v.shape)},n0=function(v,h,u){if(h==="linear")return v;if(h==="relu")return Qp(v);if(h==="elu")return pc(v);if(h==="relu6")return Hm(v);if(h==="prelu")return lp(v,u);throw new Error("Unknown fused activation "+h+".")},od=wt({fusedMatMul_:function(v){var h,u=v.a,d=v.b,y=v.transposeA,D=y!==void 0&&y,z=v.transposeB,X=z!==void 0&&z,oe=v.bias,he=v.activation,xe=he===void 0?"linear":he,Fe=v.preluActivationWeights;if(ef(Ue.state.gradientDepth,xe)===!1){var Re=jg(u,d,D,X);return oe!=null&&(Re=Xh(Re,oe)),n0(Re,xe,Fe)}var Me=Ke(u,"a","fused matMul"),We=Ke(d,"b","fused matMul");h=An(Me,We),Me=h[0],We=h[1];var Ze=D?Me.shape[Me.rank-2]:Me.shape[Me.rank-1],Je=X?We.shape[We.rank-1]:We.shape[We.rank-2],at=D?Me.shape[Me.rank-1]:Me.shape[Me.rank-2],yt=X?We.shape[We.rank-2]:We.shape[We.rank-1],xt=Me.shape.slice(0,-2),kt=We.shape.slice(0,-2),It=Ye(xt),Jt=Ye(kt);ke(Me.rank>=2&&We.rank>=2&&Me.rank===We.rank,function(){return"Error in fused matMul: inputs must have the same rank of at least 2, got ranks "+Me.rank+" and "+We.rank+"."}),ke(ln(xt,kt),function(){return"Error in fused matMul: outer dimensions ("+xt+") and ("+kt+") of Tensors with shapes "+Me.shape+" and "+We.shape+" must match."}),ke(Ze===Je,function(){return"Error in fused matMul: inner shapes ("+Ze+") and ("+Je+") of Tensors with shapes "+Me.shape+" and "+We.shape+" and transposeA="+D+" and transposeB="+X+" must match."});var on,Qt,cn=Me.shape.slice(0,-2).concat([at,yt]),vn=D?Me.as3D(It,Ze,at):Me.as3D(It,at,Ze),p=X?We.as3D(Jt,yt,Je):We.as3D(Jt,Je,yt);oe!=null&&Hi(cn,(on=An(on=Ke(oe,"bias","fused matMul"),Me)[0]).shape),Fe!=null&&(Qt=Ke(Fe,"prelu weights","fused matMul"));var c={a:vn,b:p};oe!=null&&(c.bias=on),Fe!=null&&(c.preluActivationWeights=Qt);var o=[vn,p];return Ue.runKernelFunc(function(l,g){var S=l.fusedBatchMatMul({a:vn,b:p,transposeA:D,transposeB:X,bias:on,activation:xe,preluActivationWeights:Qt});return g([vn,p,S]),S},c,function(l,g){var S=g[0],j=g[1],V=g[2],ne=$u(l,V,xe),ae={};return oe!=null&&(ae={bias:function(){return t0(on,ne)}}),Object.assign(D||X?!D&&X?{a:function(){return ne.matMul(j,!1,!1)},b:function(){return ne.matMul(S,!0,!1)}}:D&&!X?{a:function(){return j.matMul(ne,!1,!0)},b:function(){return S.matMul(ne,!1,!1)}}:{a:function(){return j.matMul(ne,!0,!0)},b:function(){return ne.matMul(S,!0,!0)}}:{a:function(){return ne.matMul(j,!1,!0)},b:function(){return S.matMul(ne,!0,!1)}},ae)},"_FusedMatMul",{transposeA:D,transposeB:X,activation:xe},o,[!0]).reshape(cn)}}),bp=wt({fusedConv2d_:function(v){var h=v.x,u=v.filter,d=v.strides,y=v.pad,D=v.dataFormat,z=D===void 0?"NHWC":D,X=v.dilations,oe=X===void 0?[1,1]:X,he=v.dimRoundingMode,xe=v.bias,Fe=v.activation,Re=Fe===void 0?"linear":Fe,Me=v.preluActivationWeights;if(Re=Re||"linear",ef(Ue.state.gradientDepth,Re)===!1){var We=Zh(h,u,d,y,z,oe,he);return xe!=null&&(We=Xh(We,xe)),n0(We,Re,Me)}var Ze=Ke(h,"x","conv2d"),Je=Ke(u,"filter","conv2d"),at=Ze,yt=!1;Ze.rank===3&&(yt=!0,at=Ze.as4D(1,Ze.shape[0],Ze.shape[1],Ze.shape[2])),ke(at.rank===4,function(){return"Error in fused conv2d: input must be rank 4, but got rank "+at.rank+"."}),ke(Je.rank===4,function(){return"Error in fused conv2d: filter must be rank 4, but got rank "+Je.rank+"."}),he!=null&&ke(nn(y),function(){return"Error in fused conv2d: pad must be an integer when using, dimRoundingMode "+he+" but got pad "+y+"."}),ke(at.shape[3]===Je.shape[2],function(){return"Error in conv2d: depth of input ("+at.shape[3]+") must match input depth for filter "+Je.shape[2]+"."}),ke(ls(d,oe),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+d+" and dilations '"+oe+"'"}),ke(z==="NHWC",function(){return"Error in conv2d: got dataFormat of "+z+" but only NHWC is currently supported."});var xt,kt,It=qs(at.shape,Je.shape,d,oe,y,he);xe!=null&&(xt=An(xt=Ke(xe,"bias","fused conv2d"),Ze)[0],Hi(It.outShape,xt.shape)),Me!=null&&(kt=Ke(Me,"prelu weights","fused conv2d"));var Jt={x:at,filter:Je};xe!=null&&(Jt.bias=xt),Me!=null&&(Jt.preluActivationWeights=kt);var on=[Je,at],Qt=Ue.runKernelFunc(function(cn,vn){var p=cn.fusedConv2d({input:at,filter:Je,convInfo:It,bias:xt,activation:Re,preluActivationWeights:kt});return vn([Je,at,p]),p},Jt,function(cn,vn){var p=vn,c=p[0],o=p[1],l=p[2],g=$u(cn,l,Re);ke(_a(oe),function(){return"Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+oe+"'"});var S={};return xe!=null&&(S={bias:function(){return t0(xt,g)}}),Object.assign({x:function(){return Lm(o.shape,g,c,d,y)},filter:function(){return Pm(o,g,c.shape,d,y)}},S)},"FusedConv2D",{convInfo:It,activation:Re},on,[!0]);return yt?Qt.as3D(Qt.shape[1],Qt.shape[2],Qt.shape[3]):Qt}}),z0=wt({fusedDepthwiseConv2d_:function(v){var h=v.x,u=v.filter,d=v.strides,y=v.pad,D=v.dataFormat,z=D===void 0?"NHWC":D,X=v.dilations,oe=X===void 0?[1,1]:X,he=v.dimRoundingMode,xe=v.bias,Fe=v.activation,Re=Fe===void 0?"linear":Fe,Me=v.preluActivationWeights;if(ef(Ue.state.gradientDepth,Re)===!1){var We=sp(h,u,d,y,z,oe,he);return xe!=null&&(We=Xh(We,xe)),n0(We,Re,Me)}var Ze=Ke(h,"x","depthwiseConv2d"),Je=Ke(u,"filter","depthwiseConv2d"),at=Ze,yt=!1;Ze.rank===3&&(yt=!0,at=Ze.as4D(1,Ze.shape[0],Ze.shape[1],Ze.shape[2])),ke(at.rank===4,function(){return"Error in fused depthwiseConv2d: input must be rank 4, but got rank "+at.rank+"."}),ke(Je.rank===4,function(){return"Error in fused depthwiseConv2d: filter must be rank 4, but got rank "+Je.rank+"."}),ke(at.shape[3]===Je.shape[2],function(){return"Error in fused depthwiseConv2d: number of input channels ("+at.shape[3]+") must match the inChannels dimension in filter "+Je.shape[2]+"."}),oe==null&&(oe=[1,1]),ke(ls(d,oe),function(){return"Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides "+d+" and dilations '"+oe+"'"}),he!=null&&ke(nn(y),function(){return"Error in fused depthwiseConv2d: pad must be an integer when using dimRoundingMode "+he+" but got pad "+y+"."});var xt,kt,It=qs(at.shape,Je.shape,d,oe,y,he,!0);xe!=null&&(xt=An(xt=Ke(xe,"bias","fused conv2d"),Ze)[0],Hi(It.outShape,xt.shape)),Me!=null&&(kt=Ke(Me,"prelu weights","fused depthwiseConv2d"));var Jt={x:at,filter:Je};xe!=null&&(Jt.bias=xt),Me!=null&&(Jt.preluActivationWeights=kt);var on=[Je,at],Qt=Ue.runKernelFunc(function(cn,vn){var p=cn.fusedDepthwiseConv2D({input:at,filter:Je,convInfo:It,bias:xt,activation:Re,preluActivationWeights:kt});return vn([Je,at,p]),p},Jt,function(cn,vn){ke(_a(oe),function(){return"Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+oe+"'"});var p=vn[0],c=vn[1],o=vn[2],l=$u(cn,o,Re),g={};return xe!=null&&(g={bias:function(){return t0(xt,l)}}),Object.assign({x:function(){return zm(c.shape,l,p,It)},filter:function(){return Xp(c,l,p.shape,It)}},g)},"FusedDepthwiseConv2D",{convInfo:It,activation:Re},on,[!0]);return yt?Qt.as3D(Qt.shape[1],Qt.shape[2],Qt.shape[3]):Qt}}),Jm=Object.freeze({matMul:od,conv2d:bp,depthwiseConv2d:z0}),um=Object.freeze({image:Ym,linalg:am,losses:im,spectral:nm,fused:Jm,signal:Km,square:Dm,squaredDifference:zf,conv1d:Gp,conv2d:Zh,conv3d:Kp,depthwiseConv2d:sp,separableConv2d:Mg,conv2dTranspose:sl,conv3dTranspose:M0,op:wt,batchNormalization2d:Fg,batchNormalization3d:np,batchNormalization4d:Rm,batchNormalization:kv,batchNorm:F0,batchNorm2d:Vl,batchNorm3d:Kh,batchNorm4d:Wf,booleanMaskAsync:Hp,complex:ho,real:ca,imag:Ua,concat:Po,concat1d:Ih,concat2d:Pd,concat3d:Al,concat4d:Rh,split:Ri,matMul:jg,dot:up,outerProduct:Bg,reverse:Xl,reverse1d:Pg,reverse2d:cp,reverse3d:Yp,reverse4d:Lg,maxPool:Ug,avgPool:Wg,pool:Jf,maxPool3d:j0,avgPool3d:Vg,slice:ul,slice1d:Wm,slice2d:qg,slice3d:Qf,slice4d:cl,abs:Dc,acos:Tm,acosh:Nm,asin:_u,asinh:Fm,atan:Hh,atanh:Qd,ceil:N0,clipByValue:Zd,cos:Tc,cosh:ep,erf:Cg,exp:Og,expm1:Im,floor:bv,log:xv,log1p:uo,logSigmoid:Ag,neg:Sg,reciprocal:Bp,round:_g,rsqrt:tp,sigmoid:nl,sign:rl,isNaN:Dg,isInf:Tg,isFinite:$h,sin:Uf,sinh:Gh,softplus:wv,sqrt:Pp,step:il,tan:Du,tanh:zl,all:Vm,any:dc,argMax:qm,argMin:Hg,logSumExp:Yl,max:B0,mean:ed,min:td,moments:Jl,sum:$g,prod:Zf,equal:fc,equalStrict:Fu,greater:fu,greaterEqual:Qh,greaterEqualStrict:Wp,greaterStrict:jm,less:Bm,lessEqual:ip,lessEqualStrict:Ro,lessStrict:op,notEqual:hc,notEqualStrict:Xf,add:Xh,addN:I0,addStrict:R0,atan2:zp,div:Hl,divNoNan:ol,divStrict:rp,floorDiv:Yh,maximum:Hf,maximumStrict:$l,minimum:Gl,minimumStrict:Nu,mod:Jh,modStrict:$f,mul:al,mulStrict:Nc,pow:Gf,powStrict:Up,squaredDifferenceStrict:Kf,sub:Fc,subStrict:ts,elu:pc,leakyRelu:nd,prelu:lp,relu:Qp,relu6:Hm,selu:Gg,logicalAnd:Vf,logicalNot:Ig,logicalOr:Mm,logicalXor:qf,where:ro,whereAsync:ql,buffer:Ni,print:Sf,batchToSpaceND:Gc,broadcastTo:Sl,cast:Wd,clone:Mp,cumsum:_l,depthToSpace:jh,expandDims:Lo,eye:Bh,multinomial:Dl,oneHot:Ph,pad:Tl,pad1d:Kc,pad2d:Ec,pad3d:Lh,pad4d:_f,rand:Nl,randomNormal:Cc,randomGamma:km,randomUniform:Fl,reshape:ra,spaceToBatchND:Sa,squeeze:Ia,stack:Mi,tile:Es,truncatedNormal:Oc,unstack:Ra,setdiff1dAsync:Ac,fill:ws,linspace:Fh,ones:lu,range:oc,scalar:fr,tensor:ko,tensor1d:Us,tensor2d:nu,tensor3d:Hc,tensor4d:Ws,tensor5d:Nh,tensor6d:jd,variable:Bd,zeros:Ki,onesLike:us,zerosLike:ii,transpose:ns,softmax:Os,logSoftmax:io,localResponseNormalization:Kg,norm:rd,gather:Vp,unsortedSegmentSum:qp,basicLSTMCell:Xg,multiRNNCell:Zp,movingAverage:Ql,stridedSlice:fp,topk:ll,scatterND:Yg,fft:em,ifft:tm,rfft:$m,irfft:Ic,sparseToDense:Jg,gatherND:fl,diag:hp,dropout:eh,hannWindow:rm,hammingWindow:Gm,frame:pp,stft:mp,inTopKAsync:Qg});function Ir(v,h){Array.isArray(v)||(v=[v]),v.forEach(function(u){u!=null&&ke(u.dtype!=="complex64",function(){return h+" does not support complex64 tensors."})})}function F(v,h,u,d){if(u==="linear")return v.linear(h);if(u==="relu")return v.relu(h);if(u==="elu")return v.elu(h);if(u==="relu6")return v.relu6(h);if(u==="prelu")return v.prelu(h,d);throw new Error("Activation "+u+" has not been implemented for the CPU backend.")}var E=function(v){function h(){var u=v.call(this)||this;return u.blockSize=48,u.firstUse=!0,u.data=new Bl(u,Ue),u}return J(h,v),h.prototype.write=function(u,d,y){this.firstUse&&(this.firstUse=!1,P().get("IS_NODE")&&qc(`
============================
Hi there . Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.
============================`));var D={};return this.data.set(D,{values:u,dtype:y}),D},h.prototype.move=function(u,d,y,D){this.data.set(u,{values:d,dtype:D})},h.prototype.numDataIds=function(){return this.data.numDataIds()},h.prototype.read=function(u){return R(this,void 0,void 0,function(){return W(this,function(d){return[2,this.readSync(u)]})})},h.prototype.readSync=function(u){var d=this.data.get(u),y=d.dtype,D=d.complexTensors;return y==="complex64"?Cu(this.readSync(D.real.dataId),this.readSync(D.imag.dataId)):this.data.get(u).values},h.prototype.bufferSync=function(u){var d=this.readSync(u.dataId),y=d;if(u.dtype==="string")try{y=d.map(function(D){return hr(D)})}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return Ni(u.shape,u.dtype,y)},h.prototype.makeOutput=function(u,d,y){var D=this.write(u,d,y);return Ue.makeTensorFromDataId(D,d,y,this)},h.prototype.disposeData=function(u){if(this.data.has(u)){var d=this.data.get(u).complexTensors;d!=null&&(d.real.dispose(),d.imag.dispose()),this.data.delete(u)}},h.prototype.time=function(u){return R(this,void 0,void 0,function(){var d;return W(this,function(y){return d=Zt(),u(),[2,{kernelMs:Zt()-d}]})})},h.prototype.memory=function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}},h.prototype.complex=function(u,d){var y=this.makeOutput(null,u.shape,"complex64");return this.data.get(y.dataId).complexTensors={real:Ue.keep(u.clone()),imag:Ue.keep(d.clone())},y},h.prototype.real=function(u){return this.data.get(u.dataId).complexTensors.real.clone()},h.prototype.imag=function(u){return this.data.get(u.dataId).complexTensors.imag.clone()},h.prototype.slice=function(u,d,y){if(Ir(u,"slice"),Ff(u.shape,d,y)){var D=Uh(d,u.strides),z=Ye(y);return ko(this.readSync(u.dataId).subarray(D,D+z),y,u.dtype)}for(var X=Ni(y,u.dtype),oe=this.bufferSync(u),he=0;he<X.size;++he){var xe=X.indexToLoc(he).map(function(Fe,Re){return Fe+d[Re]});X.values[he]=oe.get.apply(oe,xe)}return X.toTensor()},h.prototype.stridedSlice=function(u,d,y,D){Ir(u,"stridedSlice");var z=Rl(d,y,D);if(z.some(function(Me){return Me===0}))return ko([],z);for(var X=Ni(z,u.dtype),oe=this.bufferSync(u),he=0;he<X.size;he++){for(var xe=X.indexToLoc(he),Fe=new Array(xe.length),Re=0;Re<Fe.length;Re++)Fe[Re]=xe[Re]*D[Re]+d[Re];X.set.apply(X,[oe.get.apply(oe,Fe)].concat(xe))}return X.toTensor()},h.prototype.diag=function(u){for(var d=this.readSync(u.dataId),y=Ni([u.size,u.size],u.dtype),D=y.values,z=0;z<d.length;z++)D[z*u.size+z]=d[z];return y.toTensor()},h.prototype.unstack=function(u,d){for(var y=u.shape[d],D=new Array(u.rank-1),z=0,X=0;X<u.rank;X++)X!==d&&(D[z++]=u.shape[X]);var oe=new Array(u.rank).fill(0),he=u.shape.slice();he[d]=1;var xe=new Array(y);for(X=0;X<xe.length;X++)oe[d]=X,xe[X]=this.slice(u,oe,he).reshape(D);return xe},h.prototype.reverse=function(u,d){Ir(u,"reverse");for(var y=Ni(u.shape,u.dtype),D=this.bufferSync(u),z=function(oe){var he=y.indexToLoc(oe),xe=he.slice();d.forEach(function(Fe){return xe[Fe]=u.shape[Fe]-1-xe[Fe]}),y.set.apply(y,[D.get.apply(D,xe)].concat(he))},X=0;X<y.size;X++)z(X);return y.toTensor()},h.prototype.concat=function(u,d){var y=this;if(u[0].dtype==="complex64"){var D=u.map(function(Me){return ca(Me)}),z=u.map(function(Me){return Ua(Me)});return ho(this.concat(D,d),this.concat(z,d))}var X=u.map(function(Me){var We=Ye(Me.shape.slice(d));return Me.as2D(-1,We)}),oe=tu(X.map(function(Me){return Me.shape}),1),he=Ni(oe,u[0].dtype).values;if(X[0].shape[0]===1){var xe=0;X.forEach(function(Me){he.set(y.readSync(Me.dataId),xe),xe+=Me.size})}else{var Fe=0;X.forEach(function(Me){for(var We=y.readSync(Me.dataId),Ze=0,Je=0;Je<Me.shape[0];++Je)for(var at=Je*oe[1]+Fe,yt=0;yt<Me.shape[1];++yt)he[at+yt]=We[Ze++];Fe+=Me.shape[1]})}var Re=tu(u.map(function(Me){return Me.shape}),d);return ko(he,Re,u[0].dtype)},h.prototype.neg=function(u){return Ir(u,"neg"),this.multiply(fr(-1),u)},h.prototype.add=function(u,d){return u.dtype==="complex64"||d.dtype==="complex64"?this.broadcastedBinaryComplexOp(u.cast("complex64"),d.cast("complex64"),function(y,D,z,X){return{real:y+z,imag:D+X}}):this.broadcastedBinaryOp(u,d,fn(u.dtype,d.dtype),function(y,D){return y+D})},h.prototype.addN=function(u){var d=this;Ir(u,"addN");for(var y=u.map(function(xe){return d.readSync(xe.dataId)}),D=Ni(u[0].shape,u[0].dtype),z=D.values,X=0;X<u.length;X++)for(var oe=y[X],he=0;he<z.length;he++)z[he]+=oe[he];return D.toTensor()},h.prototype.softmax=function(u,d){var y=wn([d],u.shape),D=this.max(u,y),z=_o(D.shape,y),X=this.subtract(u,D.reshape(z)),oe=this.exp(X),he=this.sum(oe,y).reshape(z);return this.realDivide(oe,he)},h.prototype.subtract=function(u,d){return u.dtype==="complex64"||d.dtype==="complex64"?this.broadcastedBinaryComplexOp(u.cast("complex64"),d.cast("complex64"),function(y,D,z,X){return{real:y-z,imag:D-X}}):this.broadcastedBinaryOp(u,d,fn(u.dtype,d.dtype),function(y,D){return y-D})},h.prototype.pow=function(u,d){return Ir([u,d],"pow"),this.broadcastedBinaryOp(u,d,u.dtype,function(y,D){return Math.pow(y,D)})},h.prototype.batchMatMul=function(u,d,y,D){Ir([u,d],"matMul");for(var z=y?u.shape[1]:u.shape[2],X=y?u.shape[2]:u.shape[1],oe=D?d.shape[1]:d.shape[2],he=u.shape[0],xe=this.readSync(u.dataId),Fe=this.readSync(d.dataId),Re=y?[u.strides[0],1,u.strides[1]]:[u.strides[0],u.strides[1],1],Me=Re[0],We=Re[1],Ze=Re[2],Je=D?[1,d.strides[1],d.strides[0]]:[d.strides[1],1,d.strides[0]],at=Je[0],yt=Je[1],xt=Je[2],kt=X*oe,It=Ni([he,X,oe],u.dtype),Jt=It.values,on=this.blockSize,Qt=0;Qt<he;Qt++)for(var cn=0;cn<X;cn+=on)for(var vn=0;vn<oe;vn+=on)for(var p=0;p<z;p+=on)for(var c=Math.min(cn+on,X),o=Math.min(vn+on,oe),l=Math.min(p+on,z),g=cn;g<c;g++)for(var S=vn;S<o;S++){for(var j=0,V=p;V<l;V++)j+=xe[Qt*Me+g*We+V*Ze]*Fe[V*at+S*yt+Qt*xt];Jt[Qt*kt+(g*oe+S)]+=j}return It.toTensor()},h.prototype.fusedBatchMatMul=function(u){var d=u.a,y=u.b,D=u.transposeA,z=u.transposeB,X=u.bias,oe=u.activation,he=u.preluActivationWeights,xe=this.batchMatMul(d,y,D,z);return X&&(xe=this.add(xe,X)),oe&&(xe=F(this,xe,oe,he)),xe},h.prototype.multiply=function(u,d){return u.dtype==="complex64"||d.dtype==="complex64"?this.broadcastedBinaryComplexOp(u.cast("complex64"),d.cast("complex64"),function(y,D,z,X){return{real:y*z-D*X,imag:y*X+D*z}}):this.broadcastedBinaryOp(u,d,fn(u.dtype,d.dtype),function(y,D){return y*D})},h.prototype.realDivide=function(u,d){return Ir([u,d],"realDivide"),this.broadcastedBinaryOp(u,d,"float32",function(y,D){return y/D})},h.prototype.floorDiv=function(u,d){return Ir([u,d],"floorDiv"),this.broadcastedBinaryOp(u,d,"int32",function(y,D){return Math.floor(y/D)})},h.prototype.sum=function(u,d){Ir(u,"sum"),Ko("sum",d,u.rank);for(var y=So(u.shape,d),D=y[0],z=y[1],X=Ki(D,fn(u.dtype,"int32")),oe=Ye(z),he=this.readSync(X.dataId),xe=this.readSync(u.dataId),Fe=0;Fe<he.length;++Fe){for(var Re=Fe*oe,Me=0,We=0;We<oe;++We)Me+=xe[Re+We];he[Fe]=Me}return X},h.prototype.prod=function(u,d){Ir(u,"sum");for(var y=So(u.shape,d),D=y[0],z=y[1],X=Ki(D,fn(u.dtype,"int32")),oe=Ye(z),he=this.readSync(X.dataId),xe=this.readSync(u.dataId),Fe=0;Fe<he.length;++Fe){for(var Re=Fe*oe,Me=1,We=0;We<oe;++We)Me*=xe[Re+We];he[Fe]=Me}return X},h.prototype.unsortedSegmentSum=function(u,d,y){Ir(u,"unsortedSegmentSum");for(var D=[],z=u.rank-d.rank,X=0;X<z;++X)d=d.expandDims(X+1);for(X=0;X<y;++X){var oe=fr(X,"int32"),he=fc(oe,d).asType("float32").mul(u).sum(0);D.push(he)}return Mi(D)},h.prototype.argMin=function(u,d){Ir(u,"argMin");var y=[d];Ko("argMin",y,u.rank);for(var D=So(u.shape,y),z=D[0],X=D[1],oe=Ki(z,"int32"),he=Ye(X),xe=this.readSync(oe.dataId),Fe=this.readSync(u.dataId),Re=0;Re<xe.length;++Re){for(var Me=Re*he,We=Fe[Me],Ze=0,Je=0;Je<he;++Je){var at=Fe[Me+Je];at<We&&(We=at,Ze=Je)}xe[Re]=Ze}return oe},h.prototype.argMax=function(u,d){Ir(u,"argMax");var y=[d];Ko("argMax",y,u.rank);for(var D=So(u.shape,y),z=D[0],X=D[1],oe=Ki(z,"int32"),he=Ye(X),xe=this.readSync(oe.dataId),Fe=this.readSync(u.dataId),Re=0;Re<xe.length;++Re){for(var Me=Re*he,We=Fe[Me],Ze=0,Je=0;Je<he;++Je){var at=Fe[Me+Je];at>We&&(We=at,Ze=Je)}xe[Re]=Ze}return oe},h.prototype.cumsum=function(u,d,y,D){if(Ir(u,"cumsum"),d!==u.rank-1)throw new Error("backend.cumsum in CPU expects an inner-most axis="+(u.rank-1)+" but got axis="+d);for(var z=fn(u.dtype,"int32"),X=Ki(u.shape,z),oe=this.readSync(X.dataId),he=this.readSync(u.dataId),xe=u.shape[u.rank-1],Fe=D?function(Je,at){return Je+xe-at-1}:function(Je,at){return Je+at},Re=0;Re<he.length;Re+=xe)for(var Me=0;Me<xe;Me++){var We=Fe(Re,Me);if(Me===0)oe[We]=y?0:he[We];else{var Ze=Fe(Re,Me-1);oe[We]=y?he[Ze]+oe[Ze]:he[We]+oe[Ze]}}return X},h.prototype.equal=function(u,d){return Ir([u,d],"equal"),this.broadcastedBinaryOp(u,d,"bool",function(y,D){return y===D?1:0})},h.prototype.notEqual=function(u,d){return Ir([u,d],"notEqual"),this.broadcastedBinaryOp(u,d,"bool",function(y,D){return y!==D?1:0})},h.prototype.less=function(u,d){return Ir([u,d],"less"),this.broadcastedBinaryOp(u,d,"bool",function(y,D){return y<D?1:0})},h.prototype.lessEqual=function(u,d){return Ir([u,d],"lessEqual"),this.broadcastedBinaryOp(u,d,"bool",function(y,D){return y<=D?1:0})},h.prototype.greater=function(u,d){return Ir([u,d],"greater"),this.broadcastedBinaryOp(u,d,"bool",function(y,D){return y>D?1:0})},h.prototype.greaterEqual=function(u,d){return Ir([u,d],"greaterEqual"),this.broadcastedBinaryOp(u,d,"bool",function(y,D){return y>=D?1:0})},h.prototype.logicalNot=function(u){Ir(u,"logicalNot");for(var d=this.readSync(u.dataId),y=new Uint8Array(d.length),D=0;D<d.length;++D)y[D]=d[D]?0:1;return this.makeOutput(y,u.shape,"bool")},h.prototype.logicalAnd=function(u,d){return Ir([u,d],"logicalAnd"),this.broadcastedBinaryOp(u,d,"bool",function(y,D){return y&&D})},h.prototype.logicalOr=function(u,d){return Ir([u,d],"logicalOr"),this.broadcastedBinaryOp(u,d,"bool",function(y,D){return y||D})},h.prototype.select=function(u,d,y){Ir([u,d,y],"select");for(var D=this.readSync(u.dataId),z=this.readSync(d.dataId),X=this.readSync(y.dataId),oe=Ki(d.shape,fn(d.dtype,y.dtype)),he=this.readSync(oe.dataId),xe=0,Fe=u.rank===0||u.rank>1||d.rank===1?1:Ye(d.shape.slice(1)),Re=0;Re<D.length;Re++)for(var Me=0;Me<Fe;Me++)D[Re]===1?he[xe++]=z[Re]:he[xe++]=X[Re];return oe},h.prototype.where=function(u){Ir([u],"where");var d=this.readSync(u.dataId);return G(u.shape,d)},h.prototype.topk=function(u,d,y){return Ir(u,"topk"),Q(this.readSync(u.dataId),u.shape,u.dtype,d)},h.prototype.min=function(u,d){Ir(u,"min"),Ko("min",d,u.rank);for(var y=So(u.shape,d),D=y[0],z=y[1],X=Ki(D,u.dtype),oe=Ye(z),he=this.readSync(X.dataId),xe=this.readSync(u.dataId),Fe=0;Fe<he.length;++Fe){for(var Re=Fe*oe,Me=xe[Re],We=0;We<oe;++We){var Ze=xe[Re+We];Ze<Me&&(Me=Ze)}he[Fe]=Me}return X},h.prototype.minimum=function(u,d){return Ir([u,d],"minimum"),this.broadcastedBinaryOp(u,d,u.dtype,function(y,D){return Math.min(y,D)})},h.prototype.mod=function(u,d){return Ir([u,d],"mod"),this.broadcastedBinaryOp(u,d,u.dtype,function(y,D){var z=y%D;return y<0&&D<0||y>=0&&D>=0?z:(z+D)%D})},h.prototype.max=function(u,d){Ir(u,"max"),Ko("max",d,u.rank);for(var y=So(u.shape,d),D=y[0],z=y[1],X=Ki(D,u.dtype),oe=Ye(z),he=this.readSync(X.dataId),xe=this.readSync(u.dataId),Fe=0;Fe<he.length;++Fe){for(var Re=Fe*oe,Me=xe[Re],We=0;We<oe;++We){var Ze=xe[Re+We];Ze>Me&&(Me=Ze)}he[Fe]=Me}return X},h.prototype.maximum=function(u,d){return Ir([u,d],"maximum"),this.broadcastedBinaryOp(u,d,u.dtype,function(y,D){return Math.max(y,D)})},h.prototype.all=function(u,d){Ir(u,"all"),Ko("all",d,u.rank);for(var y=So(u.shape,d),D=y[0],z=y[1],X=Ki(D,u.dtype),oe=Ye(z),he=this.readSync(X.dataId),xe=this.readSync(u.dataId),Fe=0;Fe<he.length;++Fe){for(var Re=Fe*oe,Me=xe[Re],We=0;We<oe;++We){var Ze=xe[Re+We];Me=Me&&Ze}he[Fe]=Me}return X},h.prototype.any=function(u,d){Ir(u,"any"),Ko("any",d,u.rank);for(var y=So(u.shape,d),D=y[0],z=y[1],X=Ki(D,u.dtype),oe=Ye(z),he=this.readSync(X.dataId),xe=this.readSync(u.dataId),Fe=0;Fe<he.length;++Fe){for(var Re=Fe*oe,Me=xe[Re],We=0;We<oe;++We){var Ze=xe[Re+We];Me=Me||Ze}he[Fe]=Me}return X},h.prototype.squaredDifference=function(u,d){return Ir([u,d],"squaredDifference"),this.broadcastedBinaryOp(u,d,u.dtype,function(y,D){var z=y-D;return z*z})},h.prototype.ceil=function(u){Ir(u,"ceil");for(var d=this.readSync(u.dataId),y=new Float32Array(d.length),D=0;D<d.length;++D)y[D]=Math.ceil(d[D]);return this.makeOutput(y,u.shape,"float32")},h.prototype.floor=function(u){Ir(u,"floor");for(var d=this.readSync(u.dataId),y=new Float32Array(d.length),D=0;D<d.length;++D)y[D]=Math.floor(d[D]);return this.makeOutput(y,u.shape,"float32")},h.prototype.sign=function(u){Ir(u,"x");for(var d=this.readSync(u.dataId),y=new Float32Array(d.length),D=0;D<d.length;++D)d[D]<0?y[D]=-1:d[D]>0?y[D]=1:y[D]=0;return this.makeOutput(y,u.shape,"float32")},h.prototype.isNaN=function(u){Ir(u,"x");for(var d=this.readSync(u.dataId),y=new Uint8Array(d.length),D=0;D<d.length;++D)Number.isNaN(d[D])&&(y[D]=1);return this.makeOutput(y,u.shape,"bool")},h.prototype.isInf=function(u){Ir(u,"x");for(var d=this.readSync(u.dataId),y=new Uint8Array(d.length),D=0;D<d.length;++D)Math.abs(d[D])===1/0&&(y[D]=1);return this.makeOutput(y,u.shape,"bool")},h.prototype.isFinite=function(u){Ir(u,"x");for(var d=this.readSync(u.dataId),y=new Uint8Array(d.length),D=0;D<d.length;++D)Number.isFinite(d[D])&&(y[D]=1);return this.makeOutput(y,u.shape,"bool")},h.prototype.round=function(u){Ir(u,"round");for(var d=this.readSync(u.dataId),y=new Float32Array(d.length),D=0;D<d.length;++D){var z=Math.floor(d[D]);d[D]-z<.5?y[D]=Math.floor(d[D]):d[D]-z>.5?y[D]=Math.ceil(d[D]):y[D]=z%2==0?z:z+1}return this.makeOutput(y,u.shape,"float32")},h.prototype.exp=function(u){Ir(u,"exp");for(var d=this.readSync(u.dataId),y=new Float32Array(d.length),D=0;D<d.length;++D)y[D]=Math.exp(d[D]);return this.makeOutput(y,u.shape,"float32")},h.prototype.expm1=function(u){Ir(u,"expm1");for(var d=this.readSync(u.dataId),y=new Float32Array(d.length),D=0;D<d.length;++D)y[D]=Math.expm1(d[D]);return this.makeOutput(y,u.shape,"float32")},h.prototype.log=function(u){Ir(u,"log");for(var d=this.readSync(u.dataId),y=new Float32Array(d.length),D=0;D<d.length;++D){var z=d[D];y[D]=Math.log(z)}return this.makeOutput(y,u.shape,"float32")},h.prototype.log1p=function(u){Ir(u,"log1p");for(var d=this.readSync(u.dataId),y=new Float32Array(d.length),D=0;D<d.length;++D){var z=d[D];y[D]=Math.log1p(z)}return this.makeOutput(y,u.shape,"float32")},h.prototype.sqrt=function(u){Ir(u,"sqrt");for(var d=this.readSync(u.dataId),y=new Float32Array(d.length),D=0;D<d.length;++D){var z=d[D];y[D]=Math.sqrt(z)}return this.makeOutput(y,u.shape,"float32")},h.prototype.rsqrt=function(u){Ir(u,"rsqrt");for(var d=this.readSync(u.dataId),y=new Float32Array(d.length),D=0;D<d.length;++D){var z=d[D];y[D]=1/Math.sqrt(z)}return this.makeOutput(y,u.shape,"float32")},h.prototype.reciprocal=function(u){Ir(u,"reciprocal");for(var d=this.readSync(u.dataId),y=new Float32Array(d.length),D=0;D<d.length;++D)y[D]=1/d[D];return this.makeOutput(y,u.shape,"float32")},h.prototype.linear=function(u){return u},h.prototype.relu=function(u){Ir(u,"relu");for(var d=Ki(u.shape,u.dtype),y=this.readSync(d.dataId),D=this.readSync(u.dataId),z=0;z<D.length;++z)y[z]=Math.max(0,D[z]);return d},h.prototype.relu6=function(u){Ir(u,"relu");for(var d=Ki(u.shape,u.dtype),y=this.readSync(d.dataId),D=this.readSync(u.dataId),z=0;z<D.length;++z)y[z]=Math.min(Math.max(0,D[z]),6);return d},h.prototype.prelu=function(u,d){return Ir([u,d],"prelu"),this.broadcastedBinaryOp(u,d,u.dtype,function(y,D){return y<0?D*y:y})},h.prototype.elu=function(u){Ir(u,"elu");for(var d=new Float32Array(u.size),y=this.readSync(u.dataId),D=0;D<y.length;++D){var z=y[D];d[D]=z>=0?z:Math.exp(z)-1}return this.makeOutput(d,u.shape,"float32")},h.prototype.eluDer=function(u,d){Ir([u,d],"eluDer");for(var y=new Float32Array(d.size),D=this.readSync(d.dataId),z=this.readSync(u.dataId),X=0;X<D.length;++X){var oe=D[X];y[X]=oe>=1?z[X]:z[X]*(oe+1)}return this.makeOutput(y,d.shape,"float32")},h.prototype.selu=function(u){Ir(u,"selu");for(var d=new Float32Array(u.size),y=this.readSync(u.dataId),D=0;D<y.length;++D){var z=y[D];d[D]=z>=0?1.0507009873554805*z:1.7580993408473768*(Math.exp(z)-1)}return this.makeOutput(d,u.shape,"float32")},h.prototype.clip=function(u,d,y){Ir(u,"clip");for(var D=new Float32Array(u.size),z=this.readSync(u.dataId),X=0;X<z.length;++X){var oe=z[X];D[X]=oe>y?y:oe<d?d:oe}return this.makeOutput(D,u.shape,"float32")},h.prototype.abs=function(u){for(var d=new Float32Array(u.size),y=this.readSync(u.dataId),D=0;D<y.length;++D)d[D]=Math.abs(y[D]);return this.makeOutput(d,u.shape,"float32")},h.prototype.complexAbs=function(u){for(var d=new Float32Array(u.size),y=this.readSync(u.dataId),D=0;D<u.size;++D){var z=y[2*D],X=y[2*D+1];d[D]=Math.hypot(z,X)}return this.makeOutput(d,u.shape,"float32")},h.prototype.int=function(u){Ir(u,"int");for(var d=new Int32Array(u.size),y=this.readSync(u.dataId),D=0;D<y.length;++D)d[D]=y[D];return this.makeOutput(d,u.shape,"int32")},h.prototype.sigmoid=function(u){Ir(u,"sigmoid");for(var d=new Float32Array(u.size),y=this.readSync(u.dataId),D=0;D<y.length;++D)d[D]=1/(1+Math.exp(-y[D]));return this.makeOutput(d,u.shape,"float32")},h.prototype.softplus=function(u){Ir(u,"softplus");for(var d=Math.log(11920928955078125e-23)+2,y=new Float32Array(u.size),D=this.readSync(u.dataId),z=0;z<D.length;++z){var X,oe=D[z]>-d,he=D[z]<d,xe=Math.exp(D[z]);X=he?xe:oe?D[z]:Math.log(1+xe),y[z]=X}return this.makeOutput(y,u.shape,"float32")},h.prototype.sin=function(u){Ir(u,"sin");for(var d=new Float32Array(u.size),y=this.readSync(u.dataId),D=0;D<y.length;++D)d[D]=Math.sin(y[D]);return this.makeOutput(d,u.shape,"float32")},h.prototype.cos=function(u){Ir(u,"cos");for(var d=new Float32Array(u.size),y=this.readSync(u.dataId),D=0;D<y.length;++D)d[D]=Math.cos(y[D]);return this.makeOutput(d,u.shape,"float32")},h.prototype.tan=function(u){Ir(u,"tan");for(var d=new Float32Array(u.size),y=this.readSync(u.dataId),D=0;D<y.length;++D)d[D]=Math.tan(y[D]);return this.makeOutput(d,u.shape,"float32")},h.prototype.asin=function(u){Ir(u,"asin");for(var d=new Float32Array(u.size),y=this.readSync(u.dataId),D=0;D<y.length;++D)d[D]=Math.asin(y[D]);return this.makeOutput(d,u.shape,"float32")},h.prototype.acos=function(u){Ir(u,"acos");for(var d=new Float32Array(u.size),y=this.readSync(u.dataId),D=0;D<y.length;++D)d[D]=Math.acos(y[D]);return this.makeOutput(d,u.shape,"float32")},h.prototype.atan=function(u){Ir(u,"atan");for(var d=new Float32Array(u.size),y=this.readSync(u.dataId),D=0;D<y.length;++D)d[D]=Math.atan(y[D]);return this.makeOutput(d,u.shape,"float32")},h.prototype.atan2=function(u,d){return Ir([u,d],"atan2"),this.broadcastedBinaryOp(u,d,u.dtype,function(y,D){return Math.atan2(y,D)})},h.prototype.sinh=function(u){Ir(u,"sinh");for(var d=new Float32Array(u.size),y=this.readSync(u.dataId),D=0;D<y.length;++D)d[D]=Math.sinh(y[D]);return this.makeOutput(d,u.shape,"float32")},h.prototype.cosh=function(u){Ir(u,"cosh");for(var d=new Float32Array(u.size),y=this.readSync(u.dataId),D=0;D<y.length;++D)d[D]=Math.cosh(y[D]);return this.makeOutput(d,u.shape,"float32")},h.prototype.tanh=function(u){Ir(u,"tanh");for(var d=new Float32Array(u.size),y=this.readSync(u.dataId),D=0;D<y.length;++D)d[D]=Bt(y[D]);return this.makeOutput(d,u.shape,"float32")},h.prototype.asinh=function(u){Ir(u,"asinh");for(var d=new Float32Array(u.size),y=this.readSync(u.dataId),D=0;D<y.length;++D)d[D]=Math.asinh(y[D]);return this.makeOutput(d,u.shape,"float32")},h.prototype.acosh=function(u){Ir(u,"acosh");for(var d=new Float32Array(u.size),y=this.readSync(u.dataId),D=0;D<y.length;++D)d[D]=Math.acosh(y[D]);return this.makeOutput(d,u.shape,"float32")},h.prototype.atanh=function(u){Ir(u,"atanh");for(var d=new Float32Array(u.size),y=this.readSync(u.dataId),D=0;D<y.length;++D)d[D]=Math.atanh(y[D]);return this.makeOutput(d,u.shape,"float32")},h.prototype.erf=function(u){Ir(u,"erf");for(var d=new Float32Array(u.size),y=this.readSync(u.dataId),D=0;D<y.length;++D){var z=Math.sign(y[D]),X=Math.abs(y[D]),oe=1/(1+.3275911*X);d[D]=z*(1-((((1.061405429*oe-1.453152027)*oe+1.421413741)*oe-.284496736)*oe+.254829592)*oe*Math.exp(-X*X))}return this.makeOutput(d,u.shape,"float32")},h.prototype.step=function(u,d){d===void 0&&(d=0),Ir(u,"step");for(var y=new Float32Array(u.size),D=this.readSync(u.dataId),z=0;z<D.length;++z){var X=D[z];isNaN(X)?y[z]=NaN:y[z]=X>0?1:d}return this.makeOutput(y,u.shape,"float32")},h.prototype.fusedConv2d=function(u){var d=u.input,y=u.filter,D=u.convInfo,z=u.bias,X=u.activation,oe=u.preluActivationWeights,he=this.conv2d(d,y,D);return z&&(he=this.add(he,z)),X&&(he=F(this,he,X,oe)),he},h.prototype.conv2d=function(u,d,y){Ir([u,d],"conv2d");for(var D=y.filterHeight,z=y.filterWidth,X=y.dilationHeight,oe=y.dilationWidth,he=y.padInfo.left,xe=y.padInfo.top,Fe=y.dataFormat==="channelsLast",Re=Ni(y.outShape,u.dtype),Me=u.strides[0],We=Fe?u.strides[1]:u.strides[2],Ze=Fe?u.strides[2]:1,Je=Fe?1:u.strides[1],at=Re.strides[0],yt=Fe?Re.strides[1]:Re.strides[2],xt=Fe?Re.strides[2]:1,kt=Fe?1:Re.strides[1],It=this.readSync(u.dataId),Jt=this.readSync(d.dataId),on=Re.values,Qt=0;Qt<y.batchSize;++Qt)for(var cn=Qt*Me,vn=Qt*at,p=0;p<y.outHeight;++p)for(var c=vn+p*yt,o=p*y.strideHeight-xe,l=0;l<D;l++){var g=o+l*X;if(!(g<0||g>=y.inHeight))for(var S=l*d.strides[0],j=cn+g*We,V=0;V<y.outWidth;++V)for(var ne=c+V*xt,ae=V*y.strideWidth-he,me=0;me<z;me++){var Ee=ae+me*oe;if(!(Ee<0||Ee>=y.inWidth))for(var Se=j+Ee*Ze,Ne=S+me*d.strides[1],ze=0;ze<y.inChannels;++ze){for(var $e=It[Se+ze*Je],qe=0;qe<y.outChannels;++qe)on[ne+qe*kt]+=$e*Jt[Ne+qe];Ne+=y.outChannels}}}return Re.toTensor()},h.prototype.conv3d=function(u,d,y){for(var D=y.filterDepth,z=y.filterHeight,X=y.filterWidth,oe=y.dilationDepth,he=y.dilationHeight,xe=y.dilationWidth,Fe=y.padInfo.front,Re=y.padInfo.left,Me=y.padInfo.top,We=Ni(y.outShape,u.dtype),Ze=this.readSync(u.dataId),Je=this.readSync(d.dataId),at=We.values,yt=0;yt<y.batchSize;++yt)for(var xt=yt*u.strides[0],kt=yt*We.strides[0],It=0;It<y.outDepth;++It)for(var Jt=kt+It*We.strides[1],on=It*y.strideDepth-Fe,Qt=0;Qt<D;Qt++){var cn=on+Qt*oe;if(!(cn<0||cn>=y.inDepth))for(var vn=Qt*d.strides[0],p=xt+cn*u.strides[1],c=0;c<y.outHeight;++c)for(var o=Jt+c*We.strides[2],l=c*y.strideHeight-Me,g=0;g<z;g++){var S=l+g*he;if(!(S<0||S>=y.inHeight))for(var j=vn+g*d.strides[1],V=p+S*u.strides[2],ne=0;ne<y.outWidth;++ne)for(var ae=o+ne*y.outChannels,me=ne*y.strideWidth-Re,Ee=0;Ee<X;Ee++){var Se=me+Ee*xe;if(!(Se<0||Se>=y.inWidth))for(var Ne=j+Ee*d.strides[2],ze=V+Se*y.inChannels,$e=Ne,qe=0;qe<y.inChannels;++qe){for(var tt=Ze[ze+qe],lt=0;lt<y.outChannels;++lt)at[ae+lt]+=tt*Je[$e+lt];$e+=y.outChannels}}}}return We.toTensor()},h.prototype.conv2dDerInput=function(u,d,y){Ir([u,d],"conv2dDerInput");for(var D=Ni(y.inShape,"float32"),z=D.values,X=this.readSync(u.dataId),oe=this.readSync(d.dataId),he=d.strides,xe=he[0],Fe=he[1],Re=he[2],Me=y.batchSize,We=y.filterHeight,Ze=y.filterWidth,Je=y.inChannels,at=y.inHeight,yt=y.inWidth,xt=y.outChannels,kt=y.outHeight,It=y.outWidth,Jt=y.strideHeight,on=y.strideWidth,Qt=y.dataFormat,cn=We-1-y.padInfo.top,vn=Ze-1-y.padInfo.left,p=Qt==="channelsLast",c=D.strides[0],o=p?D.strides[1]:D.strides[2],l=p?D.strides[2]:1,g=p?1:D.strides[1],S=u.strides[0],j=p?u.strides[1]:u.strides[2],V=p?u.strides[2]:1,ne=p?1:u.strides[1],ae=0;ae<Me;++ae)for(var me=0;me<Je;++me)for(var Ee=0;Ee<at;++Ee)for(var Se=Ee-cn,Ne=Math.max(0,Math.ceil(Se/Jt)),ze=Math.min(kt,(We+Se)/Jt),$e=0;$e<yt;++$e){for(var qe=$e-vn,tt=Math.max(0,Math.ceil(qe/on)),lt=Math.min(It,(Ze+qe)/on),ht=0,vt=Ne;vt<ze;++vt)for(var Ct=vt*Jt-Se,Vt=tt;Vt<lt;++Vt)for(var Yt=S*ae+j*vt+V*Vt,qt=xe*(We-1-Ct)+Fe*(Ze-1-(Vt*on-qe))+Re*me,$t=0;$t<xt;++$t)ht+=X[Yt+ne*$t]*oe[qt+$t];z[c*ae+o*Ee+l*$e+g*me]=ht}return D.toTensor()},h.prototype.conv3dDerInput=function(u,d,y){for(var D=Ni(y.inShape,"float32"),z=D.values,X=D.strides,oe=X[0],he=X[1],xe=X[2],Fe=X[3],Re=this.readSync(u.dataId),Me=u.strides,We=Me[0],Ze=Me[1],Je=Me[2],at=Me[3],yt=this.readSync(d.dataId),xt=d.strides,kt=xt[0],It=xt[1],Jt=xt[2],on=xt[3],Qt=y.batchSize,cn=y.filterDepth,vn=y.filterHeight,p=y.filterWidth,c=y.inChannels,o=y.inDepth,l=y.inHeight,g=y.inWidth,S=y.outChannels,j=y.outDepth,V=y.outHeight,ne=y.outWidth,ae=y.strideDepth,me=y.strideHeight,Ee=y.strideWidth,Se=cn-1-y.padInfo.front,Ne=vn-1-y.padInfo.top,ze=p-1-y.padInfo.left,$e=0;$e<Qt;++$e)for(var qe=0;qe<c;++qe)for(var tt=0;tt<o;++tt)for(var lt=tt-Se,ht=Math.max(0,Math.ceil(lt/ae)),vt=Math.min(j,(cn+lt)/ae),Ct=0;Ct<l;++Ct)for(var Vt=Ct-Ne,Yt=Math.max(0,Math.ceil(Vt/me)),qt=Math.min(V,(vn+Vt)/me),$t=0;$t<g;++$t){for(var yn=$t-ze,On=Math.max(0,Math.ceil(yn/Ee)),Cn=Math.min(ne,(p+yn)/Ee),Xn=0,er=ht;er<vt;++er)for(var sr=er*ae-lt,lr=Yt;lr<qt;++lr)for(var ur=lr*me-Vt,or=On;or<Cn;++or)for(var Er=We*$e+Ze*er+Je*lr+at*or,kr=kt*(cn-1-sr)+It*(vn-1-ur)+Jt*(p-1-(or*Ee-yn))+on*qe,Ur=0;Ur<S;++Ur)Xn+=Re[Er+Ur]*yt[kr+Ur];z[oe*$e+he*tt+xe*Ct+Fe*$t+qe]=Xn}return D.toTensor()},h.prototype.conv2dDerFilter=function(u,d,y){Ir([u,d],"conv2dDerFilter");for(var D=y.strideHeight,z=y.strideWidth,X=y.filterHeight,oe=y.filterWidth,he=y.dataFormat==="channelsLast",xe=Ni(y.filterShape,"float32"),Fe=y.padInfo.left,Re=y.padInfo.top,Me=this.bufferSync(u),We=this.bufferSync(d),Ze=0;Ze<X;++Ze)for(var Je=Math.max(0,Math.ceil((Re-Ze)/D)),at=Math.min(y.outHeight,(y.inHeight+Re-Ze)/D),yt=0;yt<oe;++yt)for(var xt=Math.max(0,Math.ceil((Fe-yt)/z)),kt=Math.min(y.outWidth,(y.inWidth+Fe-yt)/z),It=0;It<y.inChannels;++It)for(var Jt=0;Jt<y.outChannels;++Jt){for(var on=0,Qt=0;Qt<y.batchSize;++Qt)for(var cn=Je;cn<at;++cn)for(var vn=Ze+cn*D-Re,p=xt;p<kt;++p){var c=yt+p*z-Fe;on+=he?Me.get(Qt,vn,c,It)*We.get(Qt,cn,p,Jt):Me.get(Qt,It,vn,c)*We.get(Qt,Jt,cn,p)}xe.set(on,Ze,yt,It,Jt)}return xe.toTensor()},h.prototype.conv3dDerFilter=function(u,d,y){for(var D=y.strideDepth,z=y.strideHeight,X=y.strideWidth,oe=y.filterDepth,he=y.filterHeight,xe=y.filterWidth,Fe=Ni(y.filterShape,"float32"),Re=Fe.values,Me=Fe.strides,We=Me[0],Ze=Me[1],Je=Me[2],at=Me[3],yt=this.readSync(d.dataId),xt=d.strides,kt=xt[0],It=xt[1],Jt=xt[2],on=xt[3],Qt=this.readSync(u.dataId),cn=u.strides,vn=cn[0],p=cn[1],c=cn[2],o=cn[3],l=y.padInfo.front,g=y.padInfo.left,S=y.padInfo.top,j=0;j<oe;++j)for(var V=Math.max(0,Math.ceil((l-j)/D)),ne=Math.min(y.outDepth,(y.inDepth+l-j)/D),ae=j*We,me=0;me<he;++me)for(var Ee=Math.max(0,Math.ceil((S-me)/z)),Se=Math.min(y.outHeight,(y.inHeight+S-me)/z),Ne=me*Ze+ae,ze=0;ze<xe;++ze)for(var $e=Math.max(0,Math.ceil((g-ze)/X)),qe=Math.min(y.outWidth,(y.inWidth+g-ze)/X),tt=ze*Je+Ne,lt=0;lt<y.inChannels;++lt)for(var ht=lt*at+tt,vt=0;vt<y.outChannels;++vt){for(var Ct=0,Vt=0;Vt<y.batchSize;++Vt)for(var Yt=Vt*vn,qt=Vt*kt,$t=V;$t<ne;++$t)for(var yn=(j+$t*D-l)*p+Yt,On=$t*It+qt,Cn=Ee;Cn<Se;++Cn)for(var Xn=(me+Cn*z-S)*c+yn,er=Cn*Jt+On,sr=$e;sr<qe;++sr){var lr=sr*on+er;Ct+=Qt[(ze+sr*X-g)*o+Xn+lt]*yt[lr+vt]}Re[ht+vt]=Ct}return Fe.toTensor()},h.prototype.fusedDepthwiseConv2D=function(u){var d=u.input,y=u.filter,D=u.convInfo,z=u.bias,X=u.activation,oe=u.preluActivationWeights,he=this.depthwiseConv2D(d,y,D);return z&&(he=this.add(he,z)),X&&(he=F(this,he,X,oe)),he},h.prototype.depthwiseConv2D=function(u,d,y){Ir([u,d],"depthwiseConv2D");for(var D=y.filterHeight,z=y.filterWidth,X=y.dilationHeight,oe=y.dilationWidth,he=y.padInfo.left,xe=y.padInfo.top,Fe=y.outChannels/y.inChannels,Re=Ni(y.outShape,u.dtype),Me=this.readSync(u.dataId),We=this.readSync(d.dataId),Ze=Re.values,Je=0;Je<y.batchSize;++Je)for(var at=Je*u.strides[0],yt=Je*Re.strides[0],xt=0;xt<y.outHeight;++xt)for(var kt=yt+xt*Re.strides[1],It=xt*y.strideHeight-he,Jt=0;Jt<D;++Jt){var on=It+Jt*X;if(!(on<0||on>=y.inHeight))for(var Qt=Jt*d.strides[0],cn=at+on*u.strides[1],vn=0;vn<y.outWidth;++vn)for(var p=kt+vn*Re.strides[2],c=vn*y.strideWidth-xe,o=0;o<z;++o){var l=c+o*oe;if(!(l<0||l>=y.inWidth))for(var g=Qt+o*d.strides[1],S=cn+l*y.inChannels,j=p,V=g,ne=0;ne<y.inChannels;++ne){for(var ae=Me[S+ne],me=0;me<Fe;++me)Ze[j+me]+=ae*We[V+me];j+=Fe,V+=Fe}}}return Re.toTensor()},h.prototype.depthwiseConv2DDerInput=function(u,d,y){Ir([u,d],"depthwiseConv2DDerInput");for(var D=Ni(y.inShape,"float32"),z=D.values,X=D.strides,oe=X[0],he=X[1],xe=X[2],Fe=this.readSync(u.dataId),Re=u.strides,Me=Re[0],We=Re[1],Ze=Re[2],Je=this.readSync(d.dataId),at=d.strides,yt=at[0],xt=at[1],kt=at[2],It=y.batchSize,Jt=y.filterHeight,on=y.filterWidth,Qt=y.inChannels,cn=y.inHeight,vn=y.inWidth,p=y.outChannels,c=y.outHeight,o=y.outWidth,l=y.strideHeight,g=y.strideWidth,S=Jt-1-y.padInfo.top,j=on-1-y.padInfo.left,V=p/Qt,ne=0;ne<It;++ne)for(var ae=0;ae<Qt;++ae)for(var me=0;me<cn;++me)for(var Ee=me-S,Se=Math.max(0,Math.ceil(Ee/l)),Ne=Math.min(c,(Jt+Ee)/l),ze=0;ze<vn;++ze){for(var $e=ze-j,qe=Math.max(0,Math.ceil($e/g)),tt=Math.min(o,(on+$e)/g),lt=0,ht=Se;ht<Ne;++ht)for(var vt=ht*l-Ee,Ct=qe;Ct<tt;++Ct)for(var Vt=Me*ne+We*ht+Ze*Ct,Yt=yt*(Jt-1-vt)+xt*(on-1-(Ct*g-$e))+kt*ae,qt=0;qt<V;++qt)lt+=Fe[Vt+(ae*V+qt)]*Je[Yt+qt];z[oe*ne+he*me+xe*ze+ae]=lt}return D.toTensor()},h.prototype.depthwiseConv2DDerFilter=function(u,d,y){Ir([u,d],"depthwiseConv2DDerFilter");for(var D=y.strideHeight,z=y.strideWidth,X=y.filterHeight,oe=y.filterWidth,he=Ni(y.filterShape,"float32"),xe=y.padInfo.left,Fe=y.padInfo.top,Re=y.outChannels/y.inChannels,Me=this.bufferSync(u),We=this.bufferSync(d),Ze=0;Ze<X;++Ze)for(var Je=Math.max(0,Math.ceil((Fe-Ze)/D)),at=Math.min(y.outHeight,(y.inHeight+Fe-Ze)/D),yt=0;yt<oe;++yt)for(var xt=Math.max(0,Math.ceil((xe-yt)/z)),kt=Math.min(y.outWidth,(y.inWidth+xe-yt)/z),It=0;It<y.outChannels;++It){for(var Jt=Math.trunc(It/Re),on=It%Re,Qt=0,cn=0;cn<y.batchSize;++cn)for(var vn=Je;vn<at;++vn)for(var p=Ze+vn*D-Fe,c=xt;c<kt;++c){var o=yt+c*z-xe;Qt+=Me.get(cn,p,o,Jt)*We.get(cn,vn,c,It)}he.set(Qt,Ze,yt,Jt,on)}return he.toTensor()},h.prototype.tile=function(u,d){return Ir(u,"tile"),Bf(this.bufferSync(u),d)},h.prototype.pad=function(u,d,y){Ir(u,"pad");var D=d.map(function(Re,Me){return Re[0]+u.shape[Me]+Re[1]}),z=d.map(function(Re){return Re[0]}),X=this.bufferSync(u),oe=Ni(D,u.dtype);y!==0&&oe.values.fill(y);for(var he=0;he<u.size;he++){var xe=X.indexToLoc(he),Fe=xe.map(function(Re,Me){return Re+z[Me]});oe.set.apply(oe,[X.get.apply(X,xe)].concat(Fe))}return oe.toTensor()},h.prototype.transpose=function(u,d){Ir(u,"transpose");for(var y=new Array(u.rank),D=0;D<y.length;D++)y[D]=u.shape[d[D]];var z=this.readSync(u.dataId),X=Ni(y,u.dtype),oe=this.bufferSync(u);for(D=0;D<u.size;++D){for(var he=oe.indexToLoc(D),xe=new Array(he.length),Fe=0;Fe<xe.length;Fe++)xe[Fe]=he[d[Fe]];var Re=X.locToIndex(xe);X.values[Re]=z[D]}return X.toTensor()},h.prototype.gather=function(u,d,y){Ir([u,d],"gather");var D=u.shape.slice(),z=this.readSync(d.dataId);D[y]=z.length;for(var X=Ni(D,u.dtype),oe=this.bufferSync(u),he=0;he<X.size;++he){var xe=X.indexToLoc(he),Fe=xe.slice();Fe[y]=z[xe[y]];var Re=oe.locToIndex(Fe);X.values[he]=oe.values[Re]}return X.toTensor()},h.prototype.batchToSpaceND=function(u,d,y){Ir([u],"batchToSpaceND");var D=d.reduce(function(Fe,Re){return Fe*Re}),z=Uu(u.shape,d,D),X=Df(z.length,d.length),oe=Tf(u.shape,d,D),he=Xc(y,d.length),xe=Vd(oe,y,d.length);return u.reshape(z).transpose(X).reshape(oe).slice(he,xe)},h.prototype.spaceToBatchND=function(u,d,y){Ir([u],"spaceToBatchND");var D=d.reduce(function(Re,Me){return Re*Me}),z=[[0,0]];z.push.apply(z,y);for(var X=1+d.length;X<u.shape.length;++X)z.push([0,0]);var oe=u.pad(z),he=Uu(oe.shape,d,D,!1),xe=Df(he.length,d.length,!1),Fe=Tf(oe.shape,d,D,!1);return oe.reshape(he).transpose(xe).reshape(Fe)},h.prototype.pool=function(u,d,y){Ir(u,"pool");for(var D=d.strideHeight,z=d.strideWidth,X=d.dilationHeight,oe=d.dilationWidth,he=d.effectiveFilterHeight,xe=d.effectiveFilterWidth,Fe=d.padInfo.top,Re=d.padInfo.left,Me=y==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,We=this.readSync(u.dataId),Ze=Ni(d.outShape,u.dtype),Je=Ze.values,at=d.outShape[1]*d.outShape[2]*d.outShape[3],yt=d.outShape[2]*d.outShape[3],xt=d.outShape[3],kt=0;kt<d.batchSize;++kt)for(var It=kt*at,Jt=kt*u.strides[0],on=0;on<d.inChannels;++on)for(var Qt=0;Qt<d.outHeight;++Qt)for(var cn=Qt*D-Fe,vn=Math.max(0,cn),p=Math.min(d.inHeight,he+cn),c=It+Qt*yt,o=0;o<d.outWidth;++o){for(var l=o*z-Re,g=Math.max(0,l),S=Math.min(d.inWidth,xe+l),j=Me,V=0,ne=0,ae=vn;ae<p;ae+=X){for(var me=Jt+ae*u.strides[1],Ee=g;Ee<S;Ee+=oe){var Se=We[me+Ee*u.strides[2]+on];y==="max"&&Se>j?j=Se:y==="avg"&&(V+=Se,ne++)}if(isNaN(j))break}Je[c+o*xt+on]=y==="avg"?V/ne:j}return Ze.toTensor()},h.prototype.maxPool=function(u,d){return this.pool(u,d,"max")},h.prototype.maxPoolPositions=function(u,d){for(var y=Ni(d.outShape,"int32"),D=d.strideHeight,z=d.strideWidth,X=d.dilationHeight,oe=d.dilationWidth,he=d.effectiveFilterHeight,xe=d.effectiveFilterWidth,Fe=d.padInfo.top,Re=d.padInfo.left,Me=this.bufferSync(u),We=0;We<d.batchSize;++We)for(var Ze=0;Ze<d.inChannels;++Ze)for(var Je=0;Je<d.outHeight;++Je){for(var at=Je*D-Fe,yt=at;yt<0;)yt+=X;for(var xt=Math.min(d.inHeight,he+at),kt=0;kt<d.outWidth;++kt){for(var It=kt*z-Re,Jt=It;Jt<0;)Jt+=oe;for(var on=Math.min(d.inWidth,xe+It),Qt=Number.NEGATIVE_INFINITY,cn=-1,vn=yt;vn<xt;vn+=X)for(var p=vn-at,c=Jt;c<on;c+=oe){var o=c-It,l=Me.get(We,vn,c,Ze);l>Qt&&(Qt=l,cn=p*xe+o)}y.set(cn,We,Je,kt,Ze)}}return y.toTensor()},h.prototype.maxPoolBackprop=function(u,d,y,D){Ir([d,y],"maxPoolBackprop");for(var z=this.maxPoolPositions(d,D),X=D.strideHeight,oe=D.strideWidth,he=D.dilationHeight,xe=D.dilationWidth,Fe=D.effectiveFilterHeight,Re=D.effectiveFilterWidth,Me=Re-1-D.padInfo.left,We=Fe-1-D.padInfo.top,Ze=Ni(d.shape,"float32"),Je=this.bufferSync(z),at=this.bufferSync(u),yt=0;yt<D.batchSize;++yt)for(var xt=0;xt<D.inChannels;++xt)for(var kt=0;kt<D.inHeight;++kt)for(var It=0;It<D.inWidth;++It){for(var Jt=kt-We,on=It-Me,Qt=0,cn=0;cn<Fe;cn+=he){var vn=(Jt+cn)/X;if(!(vn<0||vn>=D.outHeight||Math.floor(vn)!==vn))for(var p=0;p<Re;p+=xe){var c=(on+p)/oe;if(!(c<0||c>=D.outWidth||Math.floor(c)!==c)){var o=Fe*Re-1-Je.get(yt,vn,c,xt)===cn*Re+p?1:0;o!==0&&(Qt+=at.get(yt,vn,c,xt)*o)}}}Ze.set(Qt,yt,kt,It,xt)}return Ze.toTensor()},h.prototype.avgPoolBackprop=function(u,d,y){Ir([u,d],"avgPoolBackprop");for(var D=y.strideHeight,z=y.strideWidth,X=y.filterHeight,oe=y.filterWidth,he=y.dilationHeight,xe=y.dilationWidth,Fe=y.effectiveFilterHeight,Re=y.effectiveFilterWidth,Me=Re-1-y.padInfo.left,We=Fe-1-y.padInfo.top,Ze=Ni(d.shape,"float32"),Je=1/(X*oe),at=this.bufferSync(u),yt=0;yt<y.batchSize;++yt)for(var xt=0;xt<y.inChannels;++xt)for(var kt=0;kt<y.inHeight;++kt)for(var It=0;It<y.inWidth;++It){for(var Jt=kt-We,on=It-Me,Qt=0,cn=0;cn<Fe;cn+=he){var vn=(Jt+cn)/D;if(!(vn<0||vn>=y.outHeight||Math.floor(vn)!==vn))for(var p=0;p<Re;p+=xe){var c=(on+p)/z;c<0||c>=y.outWidth||Math.floor(c)!==c||(Qt+=at.get(yt,vn,c,xt))}}Ze.set(Qt*Je,yt,kt,It,xt)}return Ze.toTensor()},h.prototype.pool3d=function(u,d,y){Ir(u,"pool3d");for(var D=d.strideDepth,z=d.strideHeight,X=d.strideWidth,oe=d.dilationDepth,he=d.dilationHeight,xe=d.dilationWidth,Fe=d.effectiveFilterDepth,Re=d.effectiveFilterHeight,Me=d.effectiveFilterWidth,We=d.padInfo.front,Ze=d.padInfo.top,Je=d.padInfo.left,at=y==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,yt=this.readSync(u.dataId),xt=Ni(d.outShape,u.dtype),kt=xt.values,It=d.outShape[1]*d.outShape[2]*d.outShape[3]*d.outShape[4],Jt=d.outShape[2]*d.outShape[3]*d.outShape[4],on=d.outShape[3]*d.outShape[4],Qt=d.outShape[4],cn=0;cn<d.batchSize;++cn)for(var vn=cn*It,p=cn*u.strides[0],c=0;c<d.inChannels;++c)for(var o=0;o<d.outDepth;++o){for(var l=o*D-We,g=l;g<0;)g+=oe;for(var S=Math.min(d.inDepth,Fe+l),j=vn+o*Jt,V=0;V<d.outHeight;++V){for(var ne=V*z-Ze,ae=ne;ae<0;)ae+=he;for(var me=Math.min(d.inHeight,Re+ne),Ee=j+V*on,Se=0;Se<d.outWidth;++Se){for(var Ne=Se*X-Je,ze=Ne;ze<0;)ze+=xe;for(var $e=Math.min(d.inWidth,Me+Ne),qe=Ee+Se*Qt,tt=at,lt=0,ht=0,vt=g;vt<S;vt+=oe){for(var Ct=p+vt*u.strides[1],Vt=ae;Vt<me;Vt+=he){for(var Yt=Ct+Vt*u.strides[2],qt=ze;qt<$e;qt+=xe){var $t=yt[Yt+qt*u.strides[3]+c];if(y==="max"&&$t>tt?tt=$t:y==="avg"&&(lt+=$t,ht++),isNaN(tt))break}if(isNaN(tt))break}if(isNaN(tt))break}kt[qe+c]=y==="avg"?lt/ht:tt}}}return xt.toTensor()},h.prototype.avgPool3d=function(u,d){return Ir(u,"avgPool3d"),this.pool3d(u,d,"avg").toFloat()},h.prototype.avgPool3dBackprop=function(u,d,y){Ir([u,d],"avgPool3dBackprop");for(var D=y.strideDepth,z=y.strideHeight,X=y.strideWidth,oe=y.filterDepth,he=y.filterHeight,xe=y.filterWidth,Fe=y.dilationDepth,Re=y.dilationHeight,Me=y.dilationWidth,We=y.effectiveFilterDepth,Ze=y.effectiveFilterHeight,Je=y.effectiveFilterWidth,at=We-1-y.padInfo.front,yt=Je-1-y.padInfo.left,xt=Ze-1-y.padInfo.top,kt=Ni(d.shape,"float32"),It=1/(oe*he*xe),Jt=this.bufferSync(u),on=0;on<y.batchSize;++on)for(var Qt=0;Qt<y.inChannels;++Qt)for(var cn=0;cn<y.inDepth;++cn)for(var vn=0;vn<y.inHeight;++vn)for(var p=0;p<y.inWidth;++p){for(var c=cn-at,o=vn-xt,l=p-yt,g=0,S=0;S<We;S+=Fe){var j=(c+S)/D;if(!(j<0||j>=y.outDepth||Math.floor(j)!==j))for(var V=0;V<Ze;V+=Re){var ne=(o+V)/z;if(!(ne<0||ne>=y.outHeight||Math.floor(ne)!==ne))for(var ae=0;ae<Je;ae+=Me){var me=(l+ae)/X;me<0||me>=y.outWidth||Math.floor(me)!==me||(g+=Jt.get(on,j,ne,me,Qt))}}}kt.set(g*It,on,cn,vn,p,Qt)}return kt.toTensor()},h.prototype.maxPool3d=function(u,d){return Ir(u,"maxPool3d"),this.pool3d(u,d,"max").toFloat()},h.prototype.maxPool3dPositions=function(u,d){for(var y=Ni(d.outShape,"int32"),D=d.strideDepth,z=d.strideHeight,X=d.strideWidth,oe=d.dilationDepth,he=d.dilationHeight,xe=d.dilationWidth,Fe=d.effectiveFilterDepth,Re=d.effectiveFilterHeight,Me=d.effectiveFilterWidth,We=d.padInfo.front,Ze=d.padInfo.top,Je=d.padInfo.left,at=this.bufferSync(u),yt=0;yt<d.batchSize;++yt)for(var xt=0;xt<d.inChannels;++xt)for(var kt=0;kt<d.outDepth;++kt){for(var It=kt*D-We,Jt=It;Jt<0;)Jt+=oe;for(var on=Math.min(d.inDepth,Fe+It),Qt=0;Qt<d.outHeight;++Qt){for(var cn=Qt*z-Ze,vn=cn;vn<0;)vn+=he;for(var p=Math.min(d.inHeight,Re+cn),c=0;c<d.outWidth;++c){for(var o=c*X-Je,l=o;l<0;)l+=xe;for(var g=Math.min(d.inWidth,Me+o),S=Number.NEGATIVE_INFINITY,j=-1,V=Jt;V<on;V+=oe)for(var ne=V-It,ae=vn;ae<p;ae+=he)for(var me=ae-cn,Ee=l;Ee<g;Ee+=xe){var Se=Ee-o,Ne=at.get(yt,V,ae,Ee,xt);Ne>=S&&(S=Ne,j=ne*Re*Me+me*Re+Se)}y.set(j,yt,kt,Qt,c,xt)}}}return y.toTensor()},h.prototype.maxPool3dBackprop=function(u,d,y,D){Ir([d,y],"maxPool3dBackprop");for(var z=this.maxPool3dPositions(d,D),X=D.strideDepth,oe=D.strideHeight,he=D.strideWidth,xe=D.dilationDepth,Fe=D.dilationHeight,Re=D.dilationWidth,Me=D.effectiveFilterDepth,We=D.effectiveFilterHeight,Ze=D.effectiveFilterWidth,Je=Me-1-D.padInfo.front,at=Ze-1-D.padInfo.left,yt=We-1-D.padInfo.top,xt=Ni(d.shape,"float32"),kt=this.bufferSync(z),It=this.bufferSync(u),Jt=0;Jt<D.batchSize;++Jt)for(var on=0;on<D.inChannels;++on)for(var Qt=0;Qt<D.inDepth;++Qt)for(var cn=0;cn<D.inHeight;++cn)for(var vn=0;vn<D.inWidth;++vn){for(var p=Qt-Je,c=cn-yt,o=vn-at,l=0,g=0;g<Me;g+=xe){var S=(p+g)/X;if(!(S<0||S>=D.outDepth||Math.floor(S)!==S))for(var j=0;j<We;j+=Fe){var V=(c+j)/oe;if(!(V<0||V>=D.outHeight||Math.floor(V)!==V))for(var ne=0;ne<Ze;ne+=Re){var ae=(o+ne)/he;if(!(ae<0||ae>=D.outWidth||Math.floor(ae)!==ae)){var me=Me*We*Ze-1-kt.get(Jt,S,V,ae,on)===g*We*Ze+j*Ze+ne?1:0;me!==0&&(l+=It.get(Jt,S,V,ae,on)*me)}}}}xt.set(l,Jt,Qt,cn,vn,on)}return xt.toTensor()},h.prototype.cast=function(u,d){return $s(u,d,this)},h.prototype.reshape=function(u,d){return Eu(u,d)},h.prototype.avgPool=function(u,d){return Ir(u,"avgPool"),this.pool(u,d,"avg").toFloat()},h.prototype.resizeBilinear=function(u,d,y,D){Ir(u,"resizeBilinear");for(var z=u.shape,X=z[0],oe=z[1],he=z[2],xe=z[3],Fe=this.readSync(u.dataId),Re=new Float32Array(Ye([X,d,y,xe])),Me=[D&&d>1?oe-1:oe,D&&y>1?he-1:he],We=[D&&d>1?d-1:d,D&&y>1?y-1:y],Ze=0,Je=Me[0]/We[0],at=Me[1]/We[1],yt=0;yt<X;yt++)for(var xt=0;xt<d;xt++)for(var kt=Je*xt,It=Math.floor(kt),Jt=kt-It,on=Math.min(oe-1,Math.ceil(kt)),Qt=yt*u.strides[0]+It*u.strides[1],cn=yt*u.strides[0]+on*u.strides[1],vn=0;vn<y;vn++)for(var p=at*vn,c=Math.floor(p),o=p-c,l=Math.min(he-1,Math.ceil(p)),g=Qt+c*u.strides[2],S=cn+c*u.strides[2],j=Qt+l*u.strides[2],V=cn+l*u.strides[2],ne=0;ne<xe;ne++){var ae=Fe[g+ne],me=Fe[S+ne],Ee=ae+(Fe[j+ne]-ae)*o,Se=Ee+(me+(Fe[V+ne]-me)*o-Ee)*Jt;Re[Ze++]=Se}return ko(Re,[X,d,y,xe])},h.prototype.resizeBilinearBackprop=function(u,d,y){Ir([u,d],"resizeBilinearBackprop");for(var D=d.shape,z=D[0],X=D[1],oe=D[2],he=D[3],xe=u.shape,Fe=xe[1],Re=xe[2],Me=new Float32Array(z*X*oe*he),We=[y&&Fe>1?X-1:X,y&&Re>1?oe-1:oe],Ze=[y&&Fe>1?Fe-1:Fe,y&&Re>1?Re-1:Re],Je=We[0]/Ze[0],at=We[1]/Ze[1],yt=this.readSync(u.dataId),xt=0,kt=0;kt<z;kt++)for(var It=kt*d.strides[0],Jt=0;Jt<Fe;Jt++)for(var on=Jt*Je,Qt=Math.floor(on),cn=Math.min(Math.ceil(on),X-1),vn=It+Qt*d.strides[1],p=It+cn*d.strides[1],c=on-Qt,o=1-c,l=0;l<Re;l++)for(var g=l*at,S=Math.floor(g),j=Math.min(Math.ceil(g),oe-1),V=g-S,ne=1-V,ae=vn+S*d.strides[2],me=vn+j*d.strides[2],Ee=p+S*d.strides[2],Se=p+j*d.strides[2],Ne=o*ne,ze=o*V,$e=c*ne,qe=c*V,tt=0;tt<he;tt++){var lt=yt[xt++];Me[ae+tt]+=lt*Ne,Me[me+tt]+=lt*ze,Me[Ee+tt]+=lt*$e,Me[Se+tt]+=lt*qe}return Ws(Me,[z,oe,X,he],d.dtype)},h.prototype.resizeNearestNeighbor=function(u,d,y,D){Ir(u,"resizeNearestNeighbor");for(var z=u.shape,X=z[0],oe=z[1],he=z[2],xe=z[3],Fe=this.readSync(u.dataId),Re=new Float32Array(X*d*y*xe),Me=[D&&d>1?oe-1:oe,D&&y>1?he-1:he],We=[D&&d>1?d-1:d,D&&y>1?y-1:y],Ze=Me[0]/We[0],Je=Me[1]/We[1],at=0,yt=0;yt<X;yt++)for(var xt=yt*u.strides[0],kt=0;kt<d;kt++)for(var It=Ze*kt,Jt=xt+Math.min(oe-1,D?Math.round(It):Math.floor(It))*u.strides[1],on=0;on<y;on++)for(var Qt=Je*on,cn=Jt+Math.min(he-1,D?Math.round(Qt):Math.floor(Qt))*u.strides[2],vn=0;vn<xe;vn++){var p=Fe[cn+vn];Re[at++]=p}return ko(Re,[X,d,y,xe],u.dtype)},h.prototype.resizeNearestNeighborBackprop=function(u,d,y){Ir([u,d],"resizeNearestNeighborBackprop");for(var D=d.shape,z=D[0],X=D[1],oe=D[2],he=D[3],xe=u.shape,Fe=xe[1],Re=xe[2],Me=new Float32Array(z*X*oe*he),We=this.readSync(u.dataId),Ze=[y&&Fe>1?X-1:X,y&&Re>1?oe-1:oe],Je=[y&&Fe>1?Fe-1:Fe,y&&Re>1?Re-1:Re],at=Ze[0]/Je[0],yt=Ze[1]/Je[1],xt=1/at,kt=1/yt,It=2*Math.ceil(xt)+2,Jt=2*Math.ceil(kt)+2,on=0;on<z;on++)for(var Qt=on*d.strides[0],cn=0;cn<X;cn++)for(var vn=Qt+cn*d.strides[1],p=Math.floor(cn*xt),c=Math.floor(p-It/2),o=0;o<oe;o++)for(var l=vn+o*d.strides[2],g=Math.floor(o*kt),S=Math.floor(g-Jt/2),j=0;j<he;j++){for(var V=0,ne=0;ne<It;ne++){var ae=ne+c;if(!(ae<0||ae>=Fe)){var me=Qt+ae*u.strides[1],Ee=ae*at;if(cn===Math.min(X-1,y?Math.round(Ee):Math.floor(Ee)))for(var Se=0;Se<Jt;Se++){var Ne=Se+S;if(!(Ne<0||Ne>=Re)){var ze=me+Ne*u.strides[2],$e=Ne*yt;o===Math.min(oe-1,y?Math.round($e):Math.floor($e))&&(V+=We[ze+j])}}}}Me[l+j]=V}return Ws(Me,d.shape,d.dtype)},h.prototype.batchNormalization=function(u,d,y,D,z,X){Ir([u,d,y,z,X],"batchNorm");for(var oe=this.readSync(u.dataId),he=this.readSync(d.dataId),xe=this.readSync(y.dataId),Fe=z?this.readSync(z.dataId):new Float32Array([1]),Re=X?this.readSync(X.dataId):new Float32Array([0]),Me=new Float32Array(oe.length),We=Re.length,Ze=Fe.length,Je=xe.length,at=he.length,yt=0,xt=0,kt=0,It=0,Jt=0;Jt<oe.length;++Jt)Me[Jt]=Re[yt++]+(oe[Jt]-he[xt++])*Fe[kt++]/Math.sqrt(xe[It++]+D),yt>=We&&(yt=0),xt>=at&&(xt=0),kt>=Ze&&(kt=0),It>=Je&&(It=0);return Ws(Me,u.shape)},h.prototype.localResponseNormalization4D=function(u,d,y,D,z){Ir(u,"localResponseNormalization4D");var X=u.shape[3],oe=X-1,he=this.readSync(u.dataId),xe=u.size,Fe=new Float32Array(xe);function Re(Je){for(var at=Je%X,yt=Je-at+Math.max(0,at-d),xt=Je-at+Math.min(at+d,oe),kt=0;yt<=xt;yt++){var It=he[yt];kt+=It*It}return kt}for(var Me=0;Me<xe;Me++){var We=Re(Me),Ze=he[Me]*Math.pow(y+D*We,-z);Fe[Me]=Ze}return Ws(Fe,u.shape)},h.prototype.LRNGrad=function(u,d,y,D,z,X,oe){Ir(u,"LRNGrad");for(var he=u.shape[3],xe=this.readSync(u.dataId),Fe=this.readSync(d.dataId),Re=this.readSync(y.dataId),Me=new Float32Array(u.size),We=u.size,Ze=0;Ze<We;Ze++){for(var Je=Ze%he,at=Ze-Je+Math.max(0,Je-D),yt=Ze-Je+Math.min(he,Je+D+1),xt=0,kt=at;kt<yt;kt++)xt+=Math.pow(Fe[kt],2);for(xt=X*xt+z,kt=at;kt<yt;kt++){var It=-2*X*oe*Fe[kt]*Re[Ze]/xt;Ze===kt&&(It+=Math.pow(xt,-oe)),It*=xe[Ze],Me[kt]+=It}}return Ws(Me,u.shape)},h.prototype.multinomial=function(u,d,y,D){Ir(u,"multinomial");for(var z=d?u:Os(u),X=z.shape[0],oe=z.shape[1],he=Ki([X,y],"int32"),xe=this.readSync(he.dataId),Fe=this.readSync(z.dataId),Re=0;Re<X;++Re){var Me=Re*oe,We=new Float32Array(oe-1);We[0]=Fe[Me];for(var Ze=1;Ze<We.length;++Ze)We[Ze]=We[Ze-1]+Fe[Me+Ze];for(var Je=$c(D.toString()),at=Re*y,yt=0;yt<y;++yt){var xt=Je();xe[at+yt]=We.length;for(var kt=0;kt<We.length;kt++)if(xt<We[kt]){xe[at+yt]=kt;break}}}return he},h.prototype.oneHot=function(u,d,y,D){Ir(u,"oneHot");var z=new Float32Array(u.size*d);z.fill(D);for(var X=this.readSync(u.dataId),oe=0;oe<u.size;++oe)X[oe]>=0&&X[oe]<d&&(z[oe*d+X[oe]]=y);return nu(z,[u.size,d],"int32")},h.prototype.nonMaxSuppression=function(u,d,y,D,z){return Ir(u,"nonMaxSuppression"),Ou(this.readSync(u.dataId),this.readSync(d.dataId),y,D,z)},h.prototype.fft=function(u){return this.fftBatch(u,!1)},h.prototype.ifft=function(u){return this.fftBatch(u,!0)},h.prototype.fftBatch=function(u,d){for(var y=u.shape[0],D=u.shape[1],z=Ni(u.shape,"float32"),X=Ni(u.shape,"float32"),oe=ca(u).as2D(y,D),he=Ua(u).as2D(y,D),xe=0;xe<y;xe++)for(var Fe=oe.slice([xe,0],[1,D]),Re=he.slice([xe,0],[1,D]),Me=ho(Fe,Re),We=this.readSync(this.fftImpl(Me,d).dataId),Ze=0;Ze<D;Ze++){var Je=Jc(We,Ze);z.values[xe*D+Ze]=Je.real,X.values[xe*D+Ze]=Je.imag}return ho(z.toTensor(),X.toTensor()).as2D(y,D)},h.prototype.fftImpl=function(u,d){var y=u.as1D(),D=y.size;if(this.isExponentOf2(D)){var z=this.fftRadix2(y,D,d).as2D(u.shape[0],u.shape[1]);return d&&(z=ho(ca(z).div(fr(D)),Ua(z).div(fr(D)))),z}var X=this.readSync(u.dataId),oe=function(he){for(var xe=new Float32Array(he.length/2),Fe=new Float32Array(he.length/2),Re=0;Re<he.length;Re+=2)xe[Re/2]=he[Re],Fe[Re/2]=he[Re+1];return{real:xe,imag:Fe}}(this.fourierTransformByMatmul(X,D,d));return ho(oe.real,oe.imag).as2D(u.shape[0],u.shape[1])},h.prototype.isExponentOf2=function(u){return(u&u-1)==0},h.prototype.fftRadix2=function(u,d,y){if(d===1)return u;var D=this.readSync(u.dataId),z=d/2,X=function(at){for(var yt=Math.ceil(at.length/4),xt=new Float32Array(yt),kt=new Float32Array(yt),It=0;It<at.length;It+=4)xt[Math.floor(It/4)]=at[It],kt[Math.floor(It/4)]=at[It+1];return{real:xt,imag:kt}}(D),oe=ho(X.real,X.imag).as1D(),he=function(at){for(var yt=Math.floor(at.length/4),xt=new Float32Array(yt),kt=new Float32Array(yt),It=2;It<at.length;It+=4)xt[Math.floor(It/4)]=at[It],kt[Math.floor(It/4)]=at[It+1];return{real:xt,imag:kt}}(D),xe=ho(he.real,he.imag).as1D();oe=this.fftRadix2(oe,z,y),xe=this.fftRadix2(xe,z,y);var Fe=function(at,yt){for(var xt=new Float32Array(at/2),kt=new Float32Array(at/2),It=0;It<Math.ceil(at/2);It++){var Jt=(yt?2:-2)*Math.PI*(It/at);xt[It]=Math.cos(Jt),kt[It]=Math.sin(Jt)}return{real:xt,imag:kt}}(d,y),Re=ho(Fe.real,Fe.imag).mul(xe),Me=oe.add(Re),We=oe.sub(Re),Ze=ca(Me).concat(ca(We)),Je=Ua(Me).concat(Ua(We));return ho(Ze,Je).as1D()},h.prototype.fourierTransformByMatmul=function(u,d,y){for(var D=new Float32Array(2*d),z=0;z<d;z++){for(var X=0,oe=0,he=0;he<d;he++){var xe=Wh(z*he,d,y),Fe=Jc(u,he);X+=Fe.real*xe.real-Fe.imag*xe.imag,oe+=Fe.real*xe.imag+Fe.imag*xe.real}y&&(X/=d,oe/=d),Qc(D,X,oe,z)}return D},h.prototype.depthToSpace=function(u,d,y){ke(y==="NHWC",function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got "+y}),ke(d>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+d});for(var D=u.shape[0],z=u.shape[1],X=u.shape[2],oe=u.shape[3],he=z*d,xe=X*d,Fe=oe/(d*d),Re=this.readSync(u.dataId),Me=new Float32Array(D*he*xe*Fe),We=0,Ze=0;Ze<D;++Ze)for(var Je=0;Je<he;++Je)for(var at=Math.floor(Je/d),yt=Je%d,xt=0;xt<xe;++xt)for(var kt=Math.floor(xt/d),It=(yt*d+xt%d)*Fe,Jt=0;Jt<Fe;++Jt){var on=Jt+It+oe*(kt+X*(at+z*Ze));Me[We++]=Re[on]}return Ws(Me,[D,he,xe,Fe])},h.prototype.broadcastedBinaryOp=function(u,d,y,D){var z=Hi(u.shape,d.shape),X=Ni(z,y),oe=this.readSync(u.dataId),he=this.readSync(d.dataId),xe=$a(u.shape,z),Fe=$a(d.shape,z),Re=X.values;if(xe.length+Fe.length===0)for(var Me=0;Me<Re.length;++Me)Re[Me]=D(oe[Me%oe.length],he[Me%he.length]);else{var We=this.bufferSync(u),Ze=this.bufferSync(d),Je=function(at){var yt=X.indexToLoc(at),xt=yt.slice(-u.rank);xe.forEach(function(on){return xt[on]=0});var kt=We.locToIndex(xt),It=yt.slice(-d.rank);Fe.forEach(function(on){return It[on]=0});var Jt=Ze.locToIndex(It);Re[at]=D(oe[kt],he[Jt])};for(Me=0;Me<Re.length;++Me)Je(Me)}return X.toTensor()},h.prototype.broadcastedBinaryComplexOp=function(u,d,y){var D=Hi(u.shape,d.shape),z=Ni(D,"float32"),X=Ni(D,"float32"),oe=this.readSync(u.dataId),he=this.readSync(d.dataId),xe=$a(u.shape,D),Fe=$a(d.shape,D),Re=z.values,Me=X.values;if(xe.length+Fe.length===0)for(var We=0;We<Re.length;We++){var Ze=We%oe.length,Je=We%he.length,at=y(oe[2*Ze],oe[2*Ze+1],he[2*Je],he[2*Je+1]);Re[We]=at.real,Me[We]=at.imag}else{var yt=this.bufferSync(this.data.get(u.dataId).complexTensors.real),xt=this.bufferSync(this.data.get(d.dataId).complexTensors.real),kt=function(It){var Jt=z.indexToLoc(It),on=Jt.slice(-u.rank);xe.forEach(function(c){return on[c]=0});var Qt=yt.locToIndex(on),cn=Jt.slice(-d.rank);Fe.forEach(function(c){return cn[c]=0});var vn=xt.locToIndex(cn),p=y(oe[2*Qt],oe[2*Qt+1],he[2*vn],he[2*vn+1]);Re[It]=p.real,Me[It]=p.imag};for(We=0;We<Re.length;We++)kt(We)}return this.complex(z.toTensor(),X.toTensor())},h.prototype.split=function(u,d,y){return Pl(u,d,y)},h.prototype.dispose=function(){},h.prototype.floatPrecision=function(){return 32},h.prototype.epsilon=function(){return 1e-7},h.prototype.cropAndResize=function(u,d,y,D,z,X){for(var oe=u.shape,he=oe[0],xe=oe[1],Fe=oe[2],Re=oe[3],Me=d.shape[0],We=D[0],Ze=D[1],Je=Ni([Me,We,Ze,Re],"float32"),at=this.readSync(d.dataId),yt=this.readSync(y.dataId),xt=this.readSync(u.dataId),kt=u.strides,It=Je.strides,Jt=0;Jt<Me;Jt++){var on=4*Jt,Qt=at[on],cn=at[on+1],vn=at[on+2],p=at[on+3],c=yt[Jt];if(!(c>=he))for(var o=We>1?(vn-Qt)*(xe-1)/(We-1):0,l=Ze>1?(p-cn)*(Fe-1)/(Ze-1):0,g=0;g<We;g++){var S=We>1?Qt*(xe-1)+g*o:.5*(Qt+vn)*(xe-1);if(S<0||S>xe-1)for(var j=0;j<Ze;j++)for(var V=0;V<Re;V++){var ne=V+j*It[2]+g*It[1]+Jt*It[0];Je.values[ne]=X}else if(z==="bilinear"){var ae=Math.floor(S),me=Math.ceil(S),Ee=S-ae;for(j=0;j<Ze;j++)if((vt=Ze>1?cn*(Fe-1)+j*l:.5*(cn+p)*(Fe-1))<0||vt>Fe-1)for(V=0;V<Re;V++)ne=V+j*It[2]+g*It[1]+Jt*It[0],Je.values[ne]=X;else{var Se=Math.floor(vt),Ne=Math.ceil(vt),ze=vt-Se;for(V=0;V<Re;V++){var $e=xt[ne=V+Se*kt[2]+ae*kt[1]+c*kt[0]],qe=xt[ne=V+Ne*kt[2]+ae*kt[1]+c*kt[0]],tt=xt[ne=V+Se*kt[2]+me*kt[1]+c*kt[0]],lt=$e+(qe-$e)*ze,ht=tt+(xt[ne=V+Ne*kt[2]+me*kt[1]+c*kt[0]]-tt)*ze;ne=V+j*It[2]+g*It[1]+Jt*It[0],Je.values[ne]=lt+(ht-lt)*Ee}}}else for(j=0;j<Ze;++j){var vt;if((vt=Ze>1?cn*(Fe-1)+j*l:.5*(cn+p)*(Fe-1))<0||vt>Fe-1)for(V=0;V<Re;V++)ne=V+j*It[2]+g*It[1]+Jt*It[0],Je.values[ne]=X;else{var Ct=Math.round(vt),Vt=Math.round(S);for(V=0;V<Re;V++){var Yt=V+Ct*kt[2]+Vt*kt[1]+c*kt[0],qt=V+j*It[2]+g*It[1]+Jt*It[0];Je.values[qt]=xt[Yt]}}}}}return Je.toTensor()},h.prototype.sparseToDense=function(u,d,y,D){var z=Yc(0,u,y),X=z.sliceRank,oe=z.numUpdates,he=z.sliceSize,xe=z.strides,Fe=z.outputSize;return this.scatter(u,d,y,Fe,he,oe,X,xe,D,!1)},h.prototype.gatherND=function(u,d){var y=d.shape,D=y[y.length-1],z=Wu(u,d),X=z[0],oe=z[1],he=z[2],xe=z[3];if(oe===0)return ko([],X,u.dtype);for(var Fe=new Wi([oe,he],u.dtype),Re=this.readSync(d.dataId),Me=this.readSync(u.dataId),We=0;We<oe;We++){for(var Ze=[],Je=0,at=0;at<D;at++){var yt=Re[We*D+at];Je+=yt*xe[at],Ze.push(yt)}if(Je<0||Je>=u.size/he)throw new Error("Invalid indices: "+Ze+" does not index into "+u.shape);for(var xt=0;xt<he;xt++)Fe.values[We*he+xt]=Me[Je*he+xt]}return Fe.toTensor().reshape(X)},h.prototype.scatterND=function(u,d,y){var D=Yc(0,u,y),z=D.sliceRank,X=D.numUpdates,oe=D.sliceSize,he=D.strides,xe=D.outputSize,Fe=fr(0);return this.scatter(u,d,y,xe,oe,X,z,he,Fe,!0)},h.prototype.fill=function(u,d,y){var D=hn(y=y||be(d),Ye(u));return D.fill(d),Ue.makeTensor(D,u,y,this)},h.prototype.onesLike=function(u){if(u.dtype==="string")throw new Error("onesLike is not supported for string tensors");return this.fill(u.shape,1,u.dtype)},h.prototype.zerosLike=function(u){var d=hn(u.dtype,Ye(u.shape));return this.makeOutput(d,u.shape,u.dtype)},h.prototype.linspace=function(u,d,y){return qu(u,d,y)},h.prototype.scatter=function(u,d,y,D,z,X,oe,he,xe,Fe){var Re=[D/z,z],Me=this.readSync(u.dataId),We=this.readSync(d.dataId);if(D===0)return ko([],y,d.dtype);var Ze=new Wi(Re,d.dtype);Ze.values.fill(this.readSync(xe.dataId)[0]);for(var Je=0;Je<X;Je++){for(var at=[],yt=0,xt=0;xt<oe;xt++){var kt=Me[Je*oe+xt];at.push(kt),yt+=kt*he[xt]}if(yt<0||yt>=D/z)throw new Error("Invalid indices: "+at+" does not index into "+y);for(var It=0;It<z;It++)Fe?Ze.values[yt*z+It]+=We[Je*z+It]:Ze.values[yt*z+It]=d.rank===0?We[0]:We[Je*z+It]}return Ze.toTensor().reshape(y)},h}(Rf);Ue.registerBackend("cpu",function(){return new E},1);for(var k=0,w=[{kernelName:"NonMaxSuppressionV5",backendName:"cpu",kernelFunc:function(v){var h=v.inputs,u=v.backend,d=v.attrs,y=h,D=y.boxes,z=y.scores,X=d,oe=X.maxOutputSize,he=X.iouThreshold,xe=X.scoreThreshold,Fe=X.softNmsSigma,Re=u;Ir(D,"NonMaxSuppressionWithScore");var Me=Au(Re.data.get(D.dataId).values,Re.data.get(z.dataId).values,oe,he,xe,Fe);return[Me.selectedIndices,Me.selectedScores]}},{kernelName:"Square",backendName:"cpu",kernelFunc:function(v){var h=v.inputs,u=v.backend,d=h.x,y=u;Ir(d,"square");for(var D=y.data.get(d.dataId).values,z=new Float32Array(D.length),X=0;X<D.length;++X){var oe=D[X];z[X]=oe*oe}return{dataId:y.write(z,d.shape,d.dtype),shape:d.shape,dtype:d.dtype}}},{kernelName:qh,backendName:"cpu",kernelFunc:function(v){var h=v.inputs,u=v.backend,d=h,y=d.a,D=d.b,z=u;Ir([y,D],qh);var X=z.data.get(y.dataId).values,oe=z.data.get(D.dataId).values,he=function(Re,Me,We,Ze,Je,at){var yt=Hi(Re,Me),xt=yt.length,kt=pr(yt),It=Hn(Je,Ye(yt)),Jt=Re.length,on=Me.length,Qt=pr(Re),cn=pr(Me),vn=$a(Re,yt),p=$a(Me,yt);if(vn.length+p.length===0)for(var c=0;c<It.length;++c)It[c]=at(We[c%We.length],Ze[c%Ze.length]);else{var o=function(l){var g=gr(l,xt,kt),S=g.slice(-Jt);vn.forEach(function(ae){return S[ae]=0});var j=wr(S,Jt,Qt),V=g.slice(-on);p.forEach(function(ae){return V[ae]=0});var ne=wr(V,on,cn);It[l]=at(We[j],Ze[ne])};for(c=0;c<It.length;++c)o(c)}return[It,yt]}(y.shape,D.shape,X,oe,y.dtype,function(Re,Me){var We=Re-Me;return We*We}),xe=he[0],Fe=he[1];return{dataId:z.write(xe,Fe,y.dtype),shape:Fe,dtype:y.dtype}}}];k<w.length;k++)pe(w[k]);for(var _,L=0,Y=[{kernelName:"FromPixels",backendName:"webgl",kernelFunc:function(v){var h=v.inputs,u=v.backend,d=v.attrs,y=h.pixels,D=d.numChannels,z=typeof HTMLVideoElement<"u"&&y instanceof HTMLVideoElement,X=typeof HTMLImageElement<"u"&&y instanceof HTMLImageElement,oe=z?[y.videoWidth,y.videoHeight]:[y.width,y.height],he=oe[0],xe=oe[1],Fe=[xe,he],Re=[xe,he,D];(X||z)&&(_==null&&(_=document.createElement("canvas").getContext("2d")),_.canvas.width=he,_.canvas.height=xe,_.drawImage(y,0,0,he,xe),y=_.canvas);var Me=u.makeTensorInfo(Fe,"int32");u.texData.get(Me.dataId).usage=ir.PIXELS,u.gpgpu.uploadPixelDataToTexture(u.getTexture(Me.dataId),y);var We=P().getBool("WEBGL_PACK")?new function(Je){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var at=te(),yt=Je[0],xt=Je[1];this.outputShape=Je,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(`+xt+".0, "+yt+`.0);
            vec4 values = `+at.texture2D+`(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        `+at.output+` = result;
      }
    `}(Re):new function(Je){this.variableNames=["A"];var at=te(),yt=Je[0],xt=Je[1];this.outputShape=Je,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+xt+".0, "+yt+`.0);

        vec4 values = `+at.texture2D+`(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `}(Re),Ze=u.runWebGLProgram(We,[Me],"int32");return u.disposeData(Me.dataId),Ze}},{kernelName:"NonMaxSuppressionV5",backendName:"webgl",kernelFunc:function(v){var h=v.inputs,u=v.backend,d=v.attrs;qc("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var y=h,D=y.boxes,z=y.scores,X=d,oe=X.maxOutputSize,he=X.iouThreshold,xe=X.scoreThreshold,Fe=X.softNmsSigma,Re=u,Me=Au(Re.readSync(D.dataId),Re.readSync(z.dataId),oe,he,xe,Fe);return[Me.selectedIndices,Me.selectedScores]}},{kernelName:"Square",backendName:"webgl",kernelFunc:function(v){var h=v.inputs,u=v.backend,d=h.x,y=u,D=new ci(d.shape,"return x * x;");return y.runWebGLProgram(D,[d],d.dtype)}},{kernelName:qh,backendName:"webgl",kernelFunc:function(v){var h=v.inputs,u=v.backend,d=h,y=d.a,D=d.b,z=u,X=P().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new li("return (a - b) * (a - b);",y.shape,D.shape):new Wr("return (a - b) * (a - b);",y.shape,D.shape);return z.compileAndRun(X,[y,D])}}];L<Y.length;L++)pe(Y[L]);for(var ce=0,ve=[{kernelName:"Square",gradFunc:function(v,h){var u=h[0];return{x:function(){return v.mul(u.toFloat().mul(2))}}}},{kernelName:qh,gradFunc:function(v,h){var u=h[0],d=h[1],y=fr(2);return{a:function(){return al(v,al(y,Fc(u,d)))},b:function(){return al(v,al(y,Fc(d,u)))}}}}];ce<ve.length;ce++)Ae(ve[ce]);var De=function(){function v(){}return v.prototype.fetch=function(h,u){return fetch(h,u)},v.prototype.now=function(){return performance.now()},v.prototype.encode=function(h,u){if(u!=="utf-8"&&u!=="utf8")throw new Error("Browser's encoder only supports utf-8, but got "+u);return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(h)},v.prototype.decode=function(h,u){return new TextDecoder(u).decode(h)},v}();P().get("IS_BROWSER")&&P().setPlatform("browser",new De);var Ce,Xe=function(){function v(){this.util=a(249),this.textEncoder=new this.util.TextEncoder}return v.prototype.fetch=function(h,u){return P().global.fetch!=null?P().global.fetch(h,u):(Ce==null&&(Ce=a(250)),Ce(h,u))},v.prototype.now=function(){var h=$.hrtime();return 1e3*h[0]+h[1]/1e6},v.prototype.encode=function(h,u){if(u!=="utf-8"&&u!=="utf8")throw new Error("Node built-in encoder only supports utf-8, but got "+u);return this.textEncoder.encode(h)},v.prototype.decode=function(h,u){return h.length===0?"":new this.util.TextDecoder(u).decode(h)},v}();P().get("IS_NODE")&&P().setPlatform("node",new Xe);var nt={float32:4,int32:4,uint16:2,uint8:1,bool:1},Et=4;function At(v,h){for(var u={},d=0,y=function(X){var oe=X.name,he=X.dtype,xe=X.shape,Fe=Ye(xe),Re=void 0;if("quantization"in X){var Me=X.quantization;if(Me.dtype!=="uint8"&&Me.dtype!=="uint16")throw new Error("Weight "+X.name+" has unknown quantization dtype "+Me.dtype+". Supported quantization dtypes are: 'uint8' and 'uint16'.");var We=nt[Me.dtype],Ze=v.slice(d,d+Fe*We),Je=Me.dtype==="uint8"?new Uint8Array(Ze):new Uint16Array(Ze);if(he==="float32")Re=Float32Array.from(Je,function(Jt){return Jt*Me.scale+Me.min});else{if(he!=="int32")throw new Error("Unsupported dtype in weight '"+oe+"': "+he);Re=Int32Array.from(Je,function(Jt){return Math.round(Jt*Me.scale+Me.min)})}d+=Fe*We}else if(he==="string"){var at=Ye(X.shape);Re=[];for(var yt=0;yt<at;yt++){var xt=new Uint32Array(v.slice(d,d+Et))[0];d+=Et;var kt=new Uint8Array(v.slice(d,d+xt));Re.push(kt),d+=xt}}else{var It=nt[he];if(Ze=v.slice(d,d+Fe*It),he==="float32")Re=new Float32Array(Ze);else if(he==="int32")Re=new Int32Array(Ze);else{if(he!=="bool")throw new Error("Unsupported dtype in weight '"+oe+"': "+he);Re=new Uint8Array(Ze)}d+=Fe*It}u[oe]=ko(Re,xe,he)},D=0,z=h;D<z.length;D++)y(z[D]);return u}var rn=U!==void 0&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function un(v){return rn?U.byteLength(v):new Blob([v]).size}function kn(v){var h=0;v.forEach(function(y){h+=y.byteLength});var u=new Uint8Array(h),d=0;return v.forEach(function(y){u.set(new Uint8Array(y),d),d+=y.byteLength}),u.buffer}function En(v){for(v=v.trim();v.endsWith("/");)v=v.slice(0,v.length-1);var h=v.split("/");return h[h.length-1]}function _n(v){if(v.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:v.modelTopology==null?0:un(JSON.stringify(v.modelTopology)),weightSpecsBytes:v.weightSpecs==null?0:un(JSON.stringify(v.weightSpecs)),weightDataBytes:v.weightData==null?0:v.weightData.byteLength}}var Pn=function(){function v(){this.saveRouters=[],this.loadRouters=[]}return v.getInstance=function(){return v.instance==null&&(v.instance=new v),v.instance},v.registerSaveRouter=function(h){v.getInstance().saveRouters.push(h)},v.registerLoadRouter=function(h){v.getInstance().loadRouters.push(h)},v.getSaveHandlers=function(h){return v.getHandlers(h,"save")},v.getLoadHandlers=function(h,u){return v.getHandlers(h,"load",u)},v.getHandlers=function(h,u,d){var y=[];return(u==="load"?v.getInstance().loadRouters:v.getInstance().saveRouters).forEach(function(D){var z=D(h,d);z!==null&&y.push(z)}),y},v}(),dn="://",cr=function(){function v(){this.managers={}}return v.getInstance=function(){return v.instance==null&&(v.instance=new v),v.instance},v.registerManager=function(h,u){ke(h!=null,function(){return"scheme must not be undefined or null."}),h.endsWith(dn)&&(h=h.slice(0,h.indexOf(dn))),ke(h.length>0,function(){return"scheme must not be an empty string."});var d=v.getInstance();ke(d.managers[h]==null,function(){return"A model store manager is already registered for scheme '"+h+"'."}),d.managers[h]=u},v.getManager=function(h){var u=this.getInstance().managers[h];if(u==null)throw new Error("Cannot find model manager for scheme '"+h+"'");return u},v.getSchemes=function(){return Object.keys(this.getInstance().managers)},v}();function yr(v){if(v.indexOf(dn)===-1)throw new Error("The url string provided does not contain a scheme. Supported schemes are: "+cr.getSchemes().join(","));return{scheme:v.split(dn)[0],path:v.split(dn)[1]}}function br(v,h,u){return u===void 0&&(u=!1),R(this,void 0,void 0,function(){var d,y,D,z,X,oe,he,xe,Fe;return W(this,function(Re){switch(Re.label){case 0:return ke(v!==h,function(){return"Old path and new path are the same: '"+v+"'"}),ke((d=Pn.getLoadHandlers(v)).length>0,function(){return"Copying failed because no load handler is found for source URL "+v+"."}),ke(d.length<2,function(){return"Copying failed because more than one ("+d.length+") load handlers for source URL "+v+"."}),y=d[0],ke((D=Pn.getSaveHandlers(h)).length>0,function(){return"Copying failed because no save handler is found for destination URL "+h+"."}),ke(D.length<2,function(){return"Copying failed because more than one ("+d.length+") save handlers for destination URL "+h+"."}),z=D[0],X=yr(v).scheme,oe=yr(v).path,he=X===yr(v).scheme,[4,y.load()];case 1:return xe=Re.sent(),u&&he?[4,cr.getManager(X).removeModel(oe)]:[3,3];case 2:Re.sent(),Re.label=3;case 3:return[4,z.save(xe)];case 4:return Fe=Re.sent(),!u||he?[3,6]:[4,cr.getManager(X).removeModel(oe)];case 5:Re.sent(),Re.label=6;case 6:return[2,Fe.modelArtifactsInfo]}})})}var Br="models_store",Or="model_info_store";function hi(){if(!P().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var v=window||self,h=v.indexedDB||v.mozIndexedDB||v.webkitIndexedDB||v.msIndexedDB||v.shimIndexedDB;if(h==null)throw new Error("The current browser does not appear to support IndexedDB.");return h}function ki(v){var h=v.result;h.createObjectStore(Br,{keyPath:"modelPath"}),h.createObjectStore(Or,{keyPath:"modelPath"})}var xi=function(){function v(h){if(this.indexedDB=hi(),h==null||!h)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=h}return v.prototype.save=function(h){return R(this,void 0,void 0,function(){return W(this,function(u){if(h.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return[2,this.databaseAction(this.modelPath,h)]})})},v.prototype.load=function(){return R(this,void 0,void 0,function(){return W(this,function(h){return[2,this.databaseAction(this.modelPath)]})})},v.prototype.databaseAction=function(h,u){var d=this;return new Promise(function(y,D){var z=d.indexedDB.open("tensorflowjs",1);z.onupgradeneeded=function(){return ki(z)},z.onsuccess=function(){var X=z.result;if(u==null){var oe=X.transaction(Br,"readonly"),he=oe.objectStore(Br).get(d.modelPath);he.onsuccess=function(){if(he.result==null)return X.close(),D(new Error("Cannot find model with path '"+d.modelPath+"' in IndexedDB."));y(he.result.modelArtifacts)},he.onerror=function(Ze){return X.close(),D(he.error)},oe.oncomplete=function(){return X.close()}}else{var xe,Fe=_n(u),Re=X.transaction(Or,"readwrite"),Me=Re.objectStore(Or),We=Me.put({modelPath:d.modelPath,modelArtifactsInfo:Fe});We.onsuccess=function(){var Ze=(xe=X.transaction(Br,"readwrite")).objectStore(Br).put({modelPath:d.modelPath,modelArtifacts:u,modelArtifactsInfo:Fe});Ze.onsuccess=function(){return y({modelArtifactsInfo:Fe})},Ze.onerror=function(Je){var at=(Me=Re.objectStore(Or)).delete(d.modelPath);at.onsuccess=function(){return X.close(),D(Ze.error)},at.onerror=function(yt){return X.close(),D(Ze.error)}}},We.onerror=function(Ze){return X.close(),D(We.error)},Re.oncomplete=function(){xe==null?X.close():xe.oncomplete=function(){return X.close()}}}},z.onerror=function(X){return D(z.error)}})},v.URL_SCHEME="indexeddb://",v}(),xo=function(v){return P().getBool("IS_BROWSER")&&!Array.isArray(v)&&v.startsWith(xi.URL_SCHEME)?(h=v.slice(xi.URL_SCHEME.length),new xi(h)):null;var h};Pn.registerSaveRouter(xo),Pn.registerLoadRouter(xo);var Wo=function(){function v(){this.indexedDB=hi()}return v.prototype.listModels=function(){return R(this,void 0,void 0,function(){var h=this;return W(this,function(u){return[2,new Promise(function(d,y){var D=h.indexedDB.open("tensorflowjs",1);D.onupgradeneeded=function(){return ki(D)},D.onsuccess=function(){var z=D.result,X=z.transaction(Or,"readonly"),oe=X.objectStore(Or).getAll();oe.onsuccess=function(){for(var he={},xe=0,Fe=oe.result;xe<Fe.length;xe++){var Re=Fe[xe];he[Re.modelPath]=Re.modelArtifactsInfo}d(he)},oe.onerror=function(he){return z.close(),y(oe.error)},X.oncomplete=function(){return z.close()}},D.onerror=function(z){return y(D.error)}})]})})},v.prototype.removeModel=function(h){return R(this,void 0,void 0,function(){var u=this;return W(this,function(d){var y;return h=(y=h).startsWith(xi.URL_SCHEME)?y.slice(xi.URL_SCHEME.length):y,[2,new Promise(function(D,z){var X=u.indexedDB.open("tensorflowjs",1);X.onupgradeneeded=function(){return ki(X)},X.onsuccess=function(){var oe,he=X.result,xe=he.transaction(Or,"readwrite"),Fe=xe.objectStore(Or),Re=Fe.get(h);Re.onsuccess=function(){if(Re.result==null)return he.close(),z(new Error("Cannot find model with path '"+h+"' in IndexedDB."));var Me=Fe.delete(h),We=function(){var Ze=(oe=he.transaction(Br,"readwrite")).objectStore(Br).delete(h);Ze.onsuccess=function(){return D(Re.result.modelArtifactsInfo)},Ze.onerror=function(Je){return z(Re.error)}};Me.onsuccess=We,Me.onerror=function(Ze){return We(),he.close(),z(Re.error)}},Re.onerror=function(Me){return he.close(),z(Re.error)},xe.oncomplete=function(){oe==null?he.close():oe.oncomplete=function(){return he.close()}}},X.onerror=function(oe){return z(X.error)}})]})})},v}();if(P().getBool("IS_BROWSER"))try{cr.registerManager(xi.URL_SCHEME,new Wo)}catch{}var To="/",Do="tensorflowjs_models",Mo="info",ea="model_topology",sa="weight_specs",ka="weight_data",Ys="model_metadata";function Ci(v){return{info:[Do,v,Mo].join(To),topology:[Do,v,ea].join(To),weightSpecs:[Do,v,sa].join(To),weightData:[Do,v,ka].join(To),modelMetadata:[Do,v,Ys].join(To)}}function Va(v){var h=v.split(To);if(h.length<3)throw new Error("Invalid key format: "+v);return h.slice(1,h.length-1).join(To)}var Xa=function(){function v(h){if(!P().getBool("IS_BROWSER")||typeof window>"u"||window.localStorage===void 0)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,h==null||!h)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=h,this.keys=Ci(this.modelPath)}return v.prototype.save=function(h){return R(this,void 0,void 0,function(){var u,d,y;return W(this,function(D){if(h.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");u=JSON.stringify(h.modelTopology),d=JSON.stringify(h.weightSpecs),y=_n(h);try{return this.LS.setItem(this.keys.info,JSON.stringify(y)),this.LS.setItem(this.keys.topology,u),this.LS.setItem(this.keys.weightSpecs,d),this.LS.setItem(this.keys.weightData,function(z){if(rn)return U.from(z).toString("base64");for(var X=new Uint8Array(z),oe="",he=0,xe=X.length;he<xe;he++)oe+=String.fromCharCode(X[he]);return btoa(oe)}(h.weightData)),this.LS.setItem(this.keys.modelMetadata,JSON.stringify({format:h.format,generatedBy:h.generatedBy,convertedBy:h.convertedBy,userDefinedMetadata:h.userDefinedMetadata})),[2,{modelArtifactsInfo:y}]}catch{throw this.LS.removeItem(this.keys.info),this.LS.removeItem(this.keys.topology),this.LS.removeItem(this.keys.weightSpecs),this.LS.removeItem(this.keys.weightData),this.LS.removeItem(this.keys.modelMetadata),new Error("Failed to save model '"+this.modelPath+"' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes="+y.modelTopologyBytes+", weightSpecsBytes="+y.weightSpecsBytes+", weightDataBytes="+y.weightDataBytes+".")}return[2]})})},v.prototype.load=function(){return R(this,void 0,void 0,function(){var h,u,d,y,D,z,X;return W(this,function(oe){if((h=JSON.parse(this.LS.getItem(this.keys.info)))==null)throw new Error("In local storage, there is no model with name '"+this.modelPath+"'");if(h.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");if(u={},(d=JSON.parse(this.LS.getItem(this.keys.topology)))==null)throw new Error("In local storage, the topology of model '"+this.modelPath+"' is missing.");if(u.modelTopology=d,(y=JSON.parse(this.LS.getItem(this.keys.weightSpecs)))==null)throw new Error("In local storage, the weight specs of model '"+this.modelPath+"' are missing.");if(u.weightSpecs=y,(D=this.LS.getItem(this.keys.modelMetadata))!=null&&(z=JSON.parse(D),u.format=z.format,u.generatedBy=z.generatedBy,u.convertedBy=z.convertedBy,u.userDefinedMetadata=z.userDefinedMetadata),(X=this.LS.getItem(this.keys.weightData))==null)throw new Error("In local storage, the binary weight values of model '"+this.modelPath+"' are missing.");return u.weightData=function(he){if(rn){var xe=U.from(he,"base64");return xe.buffer.slice(xe.byteOffset,xe.byteOffset+xe.byteLength)}for(var Fe=atob(he),Re=new Uint8Array(Fe.length),Me=0;Me<Fe.length;++Me)Re.set([Fe.charCodeAt(Me)],Me);return Re.buffer}(X),[2,u]})})},v.URL_SCHEME="localstorage://",v}(),Js=function(v){return P().getBool("IS_BROWSER")&&!Array.isArray(v)&&v.startsWith(Xa.URL_SCHEME)?(h=v.slice(Xa.URL_SCHEME.length),new Xa(h)):null;var h};Pn.registerSaveRouter(Js),Pn.registerLoadRouter(Js);var _s=function(){function v(){ke(P().getBool("IS_BROWSER"),function(){return"Current environment is not a web browser"}),ke(typeof window>"u"||window.localStorage!==void 0,function(){return"Current browser does not appear to support localStorage"}),this.LS=window.localStorage}return v.prototype.listModels=function(){return R(this,void 0,void 0,function(){var h,u,d,y,D,z;return W(this,function(X){for(h={},u=Do+To,d=To+Mo,y=0;y<this.LS.length;++y)(D=this.LS.key(y)).startsWith(u)&&D.endsWith(d)&&(z=Va(D),h[z]=JSON.parse(this.LS.getItem(D)));return[2,h]})})},v.prototype.removeModel=function(h){return R(this,void 0,void 0,function(){var u,d;return W(this,function(y){var D;if(h=(D=h).startsWith(Xa.URL_SCHEME)?D.slice(Xa.URL_SCHEME.length):D,u=Ci(h),this.LS.getItem(u.info)==null)throw new Error("Cannot find model at path '"+h+"'");return d=JSON.parse(this.LS.getItem(u.info)),this.LS.removeItem(u.info),this.LS.removeItem(u.topology),this.LS.removeItem(u.weightSpecs),this.LS.removeItem(u.weightData),[2,d]})})},v}();if(P().getBool("IS_BROWSER"))try{cr.registerManager(Xa.URL_SCHEME,new _s)}catch{}var hu="model",du=".json",pu=".weights.bin";function ad(v){return new Promise(function(h){return setTimeout(h)}).then(v)}var rh=function(){function v(h){if(!P().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");h.startsWith(v.URL_SCHEME)&&(h=h.slice(v.URL_SCHEME.length)),h!=null&&h.length!==0||(h=hu),this.modelTopologyFileName=h+du,this.weightDataFileName=h+pu}return v.prototype.save=function(h){return R(this,void 0,void 0,function(){var u,d,y,D,z,X;return W(this,function(oe){switch(oe.label){case 0:if(typeof document>"u")throw new Error("Browser downloads are not supported in this environment since `document` is not present");if(u=window.URL.createObjectURL(new Blob([h.weightData],{type:"application/octet-stream"})),!(h.modelTopology instanceof ArrayBuffer))return[3,1];throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 1:return d=[{paths:["./"+this.weightDataFileName],weights:h.weightSpecs}],y={modelTopology:h.modelTopology,format:h.format,generatedBy:h.generatedBy,convertedBy:h.convertedBy,weightsManifest:d},D=window.URL.createObjectURL(new Blob([JSON.stringify(y)],{type:"application/json"})),(z=this.jsonAnchor==null?document.createElement("a"):this.jsonAnchor).download=this.modelTopologyFileName,z.href=D,[4,ad(function(){return z.dispatchEvent(new MouseEvent("click"))})];case 2:return oe.sent(),h.weightData==null?[3,4]:((X=this.weightDataAnchor==null?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,X.href=u,[4,ad(function(){return X.dispatchEvent(new MouseEvent("click"))})]);case 3:oe.sent(),oe.label=4;case 4:return[2,{modelArtifactsInfo:_n(h)}]}})})},v.URL_SCHEME="downloads://",v}(),hl=function(){function v(h){if(h==null||h.length<1)throw new Error("When calling browserFiles, at least 1 file is required, but received "+h);this.files=h}return v.prototype.load=function(){return R(this,void 0,void 0,function(){var h,u,d=this;return W(this,function(y){return h=this.files[0],u=this.files.slice(1),[2,new Promise(function(D,z){var X=new FileReader;X.onload=function(oe){var he=JSON.parse(oe.target.result),xe=he.modelTopology;if(xe!=null){u.length===0&&D({modelTopology:xe});var Fe=he.weightsManifest;if(Fe!=null){var Re;try{Re=d.checkManifestAndWeightFiles(Fe,u)}catch(Je){return void z(Je)}var Me=[],We=[],Ze=[];Fe.forEach(function(Je){Je.paths.forEach(function(at){We.push(at),Ze.push(null)}),Me.push.apply(Me,Je.weights)}),Fe.forEach(function(Je){Je.paths.forEach(function(at){var yt=new FileReader;yt.onload=function(xt){var kt=xt.target.result,It=We.indexOf(at);Ze[It]=kt,Ze.indexOf(null)===-1&&D({modelTopology:xe,weightSpecs:Me,weightData:kn(Ze),format:he.format,generatedBy:he.generatedBy,convertedBy:he.convertedBy,userDefinedMetadata:he.userDefinedMetadata})},yt.onerror=function(xt){return z("Failed to weights data from file of path '"+at+"'.")},yt.readAsArrayBuffer(Re[at])})})}else z(new Error("weightManifest field is missing from file "+h.name))}else z(new Error("modelTopology field is missing from file "+h.name))},X.onerror=function(oe){return z("Failed to read model topology and weights manifest JSON from file '"+h.name+"'. BrowserFiles supports loading Keras-style tf.Model artifacts only.")},X.readAsText(h)})]})})},v.prototype.checkManifestAndWeightFiles=function(h,u){for(var d=[],y=u.map(function(oe){return En(oe.name)}),D={},z=0,X=h;z<X.length;z++)X[z].paths.forEach(function(oe){var he=En(oe);if(d.indexOf(he)!==-1)throw new Error("Duplicate file basename found in weights manifest: '"+he+"'");if(d.push(he),y.indexOf(he)===-1)throw new Error("Weight file with basename '"+he+"' is not provided.");D[oe]=u[y.indexOf(he)]});if(d.length!==u.length)throw new Error("Mismatch in the number of files in weights manifest ("+d.length+") and the number of weight files provided ("+u.length+").");return D},v}();function tf(v,h,u,d){(function(D){ke(D!=null&&Array.isArray(D)&&D.length>0,function(){return"promises must be a none empty array"})})(v),function(D,z){ke(D>=0&&D<=1,function(){return"Progress fraction must be in range [0, 1], but got startFraction "+D}),ke(z>=0&&z<=1,function(){return"Progress fraction must be in range [0, 1], but got endFraction "+z}),ke(z>=D,function(){return"startFraction must be no more than endFraction, but got startFraction "+D+" and endFraction "+z})}(u=u??0,d=d??1);var y=0;return Promise.all(v.map(function(D){return D.then(function(z){var X=u+ ++y/v.length*(d-u);return h(X),z}),D}))}function dl(v,h){return R(this,void 0,void 0,function(){var u,d,y,D,z,X,oe,he,xe;return W(this,function(Fe){switch(Fe.label){case 0:return h==null&&(h={}),u=h.fetchFunc==null?P().platform.fetch:h.fetchFunc,d=v.map(function(Re){return u(Re,h.requestInit,{isBinary:!0})}),y=0,D=.5,h.onProgress!=null?[3,2]:[4,Promise.all(d)];case 1:return z=Fe.sent(),[3,4];case 2:return[4,tf(d,h.onProgress,y,D)];case 3:z=Fe.sent(),Fe.label=4;case 4:return X=z.map(function(Re){return Re.arrayBuffer()}),oe=.5,he=1,h.onProgress!=null?[3,6]:[4,Promise.all(X)];case 5:return xe=Fe.sent(),[3,8];case 6:return[4,tf(X,h.onProgress,oe,he)];case 7:xe=Fe.sent(),Fe.label=8;case 8:return[2,xe]}})})}function Gu(v){var h=this;return function(u,d,y){return d===void 0&&(d=""),R(h,void 0,void 0,function(){var D,z,X,oe,he,xe,Fe,Re,Me,We;return W(this,function(Ze){switch(Ze.label){case 0:if(D=u.map(function(){return!1}),z={},X=y!=null?y.map(function(){return!1}):[],oe=[],u.forEach(function(Je,at){var yt=0;Je.weights.forEach(function(xt){var kt="quantization"in xt?xt.quantization.dtype:xt.dtype,It=nt[kt]*Ye(xt.shape),Jt=function(){D[at]=!0,z[at]==null&&(z[at]=[]),z[at].push({manifestEntry:xt,groupOffset:yt,sizeBytes:It})};y!=null?y.forEach(function(on,Qt){on===xt.name&&(Jt(),X[Qt]=!0)}):Jt(),oe.push(xt.name),yt+=It})}),!X.every(function(Je){return Je}))throw he=y.filter(function(Je,at){return!X[at]}),new Error("Could not find weights in manifest with names: "+he.join(", ")+`. 
Manifest JSON has weights with names: `+oe.join(", ")+".");return xe=D.reduce(function(Je,at,yt){return at&&Je.push(yt),Je},[]),Fe=[],xe.forEach(function(Je){u[Je].paths.forEach(function(at){var yt=d+(d.endsWith("/")?"":"/")+at;Fe.push(yt)})}),[4,v(Fe)];case 1:return Re=Ze.sent(),Me={},We=0,xe.forEach(function(Je){for(var at=u[Je].paths.length,yt=0,xt=0;xt<at;xt++)yt+=Re[We+xt].byteLength;for(var kt=new ArrayBuffer(yt),It=new Uint8Array(kt),Jt=0,on=0;on<at;on++){var Qt=new Uint8Array(Re[We+on]);It.set(Qt,Jt),Jt+=Qt.byteLength}z[Je].forEach(function(cn){var vn=At(kt.slice(cn.groupOffset,cn.groupOffset+cn.sizeBytes),[cn.manifestEntry]);for(var p in vn)Me[p]=vn[p]}),We+=at}),[2,Me]}})})}}Pn.registerSaveRouter(function(v){return P().getBool("IS_BROWSER")&&!Array.isArray(v)&&v.startsWith(rh.URL_SCHEME)?function(h){return h===void 0&&(h="model"),new rh(h)}(v.slice(rh.URL_SCHEME.length)):null});var Ba=function(){function v(h,u){if(this.DEFAULT_METHOD="POST",u==null&&(u={}),this.weightPathPrefix=u.weightPathPrefix,this.onProgress=u.onProgress,u.fetchFunc!=null?(ke(typeof u.fetchFunc=="function",function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"}),this.fetch=u.fetchFunc):this.fetch=P().platform.fetch,ke(h!=null&&h.length>0,function(){return"URL path for http must not be null, undefined or empty."}),Array.isArray(h)&&ke(h.length===2,function(){return"URL paths for http must have a length of 2, (actual length is "+h.length+")."}),this.path=h,u.requestInit!=null&&u.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=u.requestInit||{}}return v.prototype.save=function(h){return R(this,void 0,void 0,function(){var u,d,y,D;return W(this,function(z){switch(z.label){case 0:if(h.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");return(u=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,d=[{paths:["./model.weights.bin"],weights:h.weightSpecs}],y={modelTopology:h.modelTopology,format:h.format,generatedBy:h.generatedBy,convertedBy:h.convertedBy,userDefinedMetadata:h.userDefinedMetadata,weightsManifest:d},u.body.append("model.json",new Blob([JSON.stringify(y)],{type:"application/json"}),"model.json"),h.weightData!=null&&u.body.append("model.weights.bin",new Blob([h.weightData],{type:"application/octet-stream"}),"model.weights.bin"),[4,this.fetch(this.path,u)];case 1:if((D=z.sent()).ok)return[2,{modelArtifactsInfo:_n(h),responses:[D]}];throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+D.status+".")}})})},v.prototype.load=function(){return R(this,void 0,void 0,function(){var h,u,d,y,D,z,X,oe,he,xe,Fe,Re;return W(this,function(Me){switch(Me.label){case 0:return[4,this.fetch(this.path,this.requestInit)];case 1:if(!(h=Me.sent()).ok)throw new Error("Request to "+this.path+" failed with status code "+h.status+". Please verify this URL points to the model JSON of the model to load.");Me.label=2;case 2:return Me.trys.push([2,4,,5]),[4,h.json()];case 3:return u=Me.sent(),[3,5];case 4:throw Me.sent(),d="Failed to parse model JSON of response from "+this.path+".",this.path.endsWith(".pb")?d+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":d+=" Please make sure the server is serving valid JSON for this request.",new Error(d);case 5:if(y=u.modelTopology,D=u.weightsManifest,z=u.generatedBy,X=u.convertedBy,oe=u.format,he=u.userDefinedMetadata,y==null&&D==null)throw new Error("The JSON from HTTP path "+this.path+" contains neither model topology or manifest for weights.");return D==null?[3,7]:[4,this.loadWeights(D)];case 6:Re=Me.sent(),xe=Re[0],Fe=Re[1],Me.label=7;case 7:return[2,{modelTopology:y,weightSpecs:xe,weightData:Fe,userDefinedMetadata:he,generatedBy:z,convertedBy:X,format:oe}]}})})},v.prototype.loadWeights=function(h){return R(this,void 0,void 0,function(){var u,d,y,D,z,X,oe,he,xe,Fe,Re;return W(this,function(Me){switch(Me.label){case 0:for(u=Array.isArray(this.path)?this.path[1]:this.path,d=function(We){var Ze=We.lastIndexOf("/"),Je=We.lastIndexOf("?");return[We.substring(0,Ze)+"/",Je>Ze?We.substring(Je):""]}(u),y=d[0],D=d[1],z=this.weightPathPrefix||y,X=[],oe=0,he=h;oe<he.length;oe++)xe=he[oe],X.push.apply(X,xe.weights);return Fe=[],h.forEach(function(We){We.paths.forEach(function(Ze){Fe.push(z+Ze+D)})}),[4,dl(Fe,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress})];case 1:return Re=Me.sent(),[2,[X,kn(Re)]]}})})},v.URL_SCHEME_REGEX=/^https?:\/\//,v}();function nf(v){return v.match(Ba.URL_SCHEME_REGEX)!=null}var ih=function(v,h){return typeof fetch>"u"?null:(Array.isArray(v)?v.every(function(u){return nf(u)}):nf(v))?sd(v,{onProgress:h}):null};function sd(v,h){return new Ba(v,h)}Pn.registerSaveRouter(ih),Pn.registerLoadRouter(ih);var rf,ds=function(){function v(h){this.modelArtifacts=h}return v.prototype.load=function(){return R(this,void 0,void 0,function(){return W(this,function(h){return[2,this.modelArtifacts]})})},v}(),oh=function(){function v(h){this.saveHandler=h}return v.prototype.save=function(h){return R(this,void 0,void 0,function(){return W(this,function(u){return[2,this.saveHandler(h)]})})},v}(),ud=Object.freeze({browserFiles:function(v){return new hl(v)},browserHTTPRequest:function(v,h){return sd(v,h)},concatenateArrayBuffers:kn,decodeWeights:At,encodeWeights:function(v,h){return R(this,void 0,void 0,function(){var u,d,y,D,z,X=this;return W(this,function(oe){switch(oe.label){case 0:for(u=[],d=[],y=Array.isArray(v)?v.map(function(he){return he.name}):Object.keys(v),D=function(he){var xe=y[he],Fe=Array.isArray(v)?v[he].tensor:v[xe];if(Fe.dtype!=="float32"&&Fe.dtype!=="int32"&&Fe.dtype!=="bool"&&Fe.dtype!=="string")throw new Error("Unsupported dtype in weight '"+xe+"': "+Fe.dtype);var Re={name:xe,shape:Fe.shape,dtype:Fe.dtype};if(Fe.dtype==="string"){var Me=new Promise(function(We){return R(X,void 0,void 0,function(){var Ze,Je,at,yt,xt,kt,It;return W(this,function(Jt){switch(Jt.label){case 0:return[4,Fe.bytes()];case 1:for(Ze=Jt.sent(),Je=Ze.reduce(function(on,Qt){return on+Qt.length},0)+Et*Ze.length,at=new Uint8Array(Je),yt=0,xt=0;xt<Ze.length;xt++)kt=Ze[xt],It=new Uint8Array(new Uint32Array([kt.length]).buffer),at.set(It,yt),yt+=Et,at.set(kt,yt),yt+=kt.length;return We(at),[2]}})})});d.push(Me)}else d.push(Fe.data());h!=null&&(Re.group=h),u.push(Re)},z=0;z<y.length;++z)D(z);return[4,Promise.all(d)];case 1:return[2,{data:function(he){if(he===null)throw new Error("Invalid input value: "+JSON.stringify(he));var xe=0,Fe=[];he.forEach(function(We){if(xe+=We.byteLength,Fe.push(We.byteLength===We.buffer.byteLength?We:new We.constructor(We)),!(We instanceof Float32Array||We instanceof Int32Array||We instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: "+We.constructor.name)});var Re=new Uint8Array(xe),Me=0;return Fe.forEach(function(We){Re.set(new Uint8Array(We.buffer),Me),Me+=We.byteLength}),Re.buffer}(oe.sent()),specs:u}]}})})},fromMemory:function(v,h,u,d){return arguments.length===1?v.modelTopology!=null||v.weightSpecs!=null?new ds(v):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new ds({modelTopology:v})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new ds({modelTopology:v,weightSpecs:h,weightData:u,trainingConfig:d}))},getLoadHandlers:function(v,h){return Pn.getLoadHandlers(v,h)},getModelArtifactsInfoForJSON:_n,getSaveHandlers:function(v){return Pn.getSaveHandlers(v)},http:sd,isHTTPScheme:nf,loadWeights:function(v,h,u,d){return h===void 0&&(h=""),R(this,void 0,void 0,function(){return W(this,function(y){return[2,Gu(function(D){return dl(D,{requestInit:d})})(v,h,u)]})})},registerLoadRouter:function(v){return Pn.registerLoadRouter(v)},registerSaveRouter:function(v){return Pn.registerSaveRouter(v)},weightsLoaderFactory:Gu,withSaveHandler:function(v){return new oh(v)},copyModel:function(v,h){return R(this,void 0,void 0,function(){return W(this,function(u){return[2,br(v,h,!1)]})})},listModels:function(){return R(this,void 0,void 0,function(){var v,h,u,d,y,D,z;return W(this,function(X){switch(X.label){case 0:v=cr.getSchemes(),h={},u=0,d=v,X.label=1;case 1:return u<d.length?(y=d[u],[4,cr.getManager(y).listModels()]):[3,4];case 2:for(z in D=X.sent())h[y+dn+z]=D[z];X.label=3;case 3:return u++,[3,1];case 4:return[2,h]}})})},moveModel:function(v,h){return R(this,void 0,void 0,function(){return W(this,function(u){return[2,br(v,h,!0)]})})},removeModel:function(v){return R(this,void 0,void 0,function(){var h;return W(this,function(u){return h=yr(v),[2,cr.getManager(h.scheme).removeModel(h.path)]})})}}),cd=wt({confusionMatrix_:function(v,h,u){var d=Ke(v,"labels","confusionMatrix"),y=Ke(h,"predictions","confusionMatrix");ke(u==null||u>0&&Number.isInteger(u),function(){return"If provided, numClasses must be a positive integer, but got "+u}),ke(d.rank===1,function(){return"Expected the rank of labels to be 1, but got "+d.rank}),ke(y.rank===1,function(){return"Expected the rank of predictions to be 1, but got "+y.rank}),ke(d.shape[0]===y.shape[0],function(){return"Mismatch in the number of examples: "+d.shape[0]+" vs. "+y.shape[0]+". Labels and predictions should have the same number of elements."}),ke(u>0&&Number.isInteger(u),function(){return"numClasses is required to be a positive integer, but got "+u});var D=Ph(d.asType("int32"),u),z=Ph(y.asType("int32"),u);return D.transpose().matMul(z).asType("int32")}}),jc=Object.freeze({confusionMatrix:cd}),xp=wt({fromPixels_:function(v,h){if(h===void 0&&(h=3),h>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(v==null)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var u=!1,d=!1,y=!1,D=!1,z=!1;if(v.data instanceof Uint8Array)u=!0;else if(typeof ImageData<"u"&&v instanceof ImageData)d=!0;else if(typeof HTMLVideoElement<"u"&&v instanceof HTMLVideoElement)y=!0;else if(typeof HTMLImageElement<"u"&&v instanceof HTMLImageElement)D=!0;else{if(v.getContext==null)throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was "+v.constructor.name);z=!0}if(y&&y&&v.readyState<2)throw new Error("The video element has not loaded data yet. Please wait for `loadeddata` event on the <video> element.");if(ie("FromPixels",Ue.backendName)!=null)return Ue.runKernel("FromPixels",{pixels:v},{numChannels:h});var X,oe,he=y?[v.videoWidth,v.videoHeight]:[v.width,v.height],xe=he[0],Fe=he[1];if(z?X=v.getContext("2d").getImageData(0,0,xe,Fe).data:d||u?X=v.data:(D||y)&&(rf==null&&(rf=document.createElement("canvas").getContext("2d")),rf.canvas.width=xe,rf.canvas.height=Fe,rf.drawImage(v,0,0,xe,Fe),X=rf.getImageData(0,0,xe,Fe).data),h===4)oe=new Int32Array(X);else{var Re=xe*Fe;oe=new Int32Array(Re*h);for(var Me=0;Me<Re;Me++)for(var We=0;We<h;++We)oe[Me*h+We]=X[4*Me+We]}return Hc(oe,[Fe,xe,h],"int32")}}),Ku=Object.freeze({toPixels:function(v,h){return R(this,void 0,void 0,function(){var u,d,y,D,z,X,oe,he,xe,Fe,Re,Me,We,Ze,Je,at,yt,xt,kt,It,Jt,on,Qt;return W(this,function(cn){switch(cn.label){case 0:if(u=Ke(v,"img","toPixels"),v instanceof Mt||(u=u.toInt()),u.rank!==2&&u.rank!==3)throw new Error("toPixels only supports rank 2 or 3 tensors, got rank "+u.rank+".");if(d=u.shape.slice(0,2),y=d[0],D=d[1],(z=u.rank===2?1:u.shape[2])>4||z===2)throw new Error("toPixels only supports depth of size 1, 3 or 4 but got "+z);return[4,u.data()];case 1:return X=cn.sent(),oe=u.min(),he=u.max(),[4,Promise.all([oe.data(),he.data()])];case 2:if(xe=cn.sent(),Fe=xe[0],Re=xe[1],Me=Fe[0],We=Re[0],oe.dispose(),he.dispose(),u.dtype==="float32"){if(Me<0||We>1)throw new Error("Tensor values for a float32 Tensor must be in the range [0 - 1] but got range ["+Me+" - "+We+"].")}else{if(u.dtype!=="int32")throw new Error("Unsupported type for toPixels: "+u.dtype+". Please use float32 or int32 tensors.");if(Me<0||We>255)throw new Error("Tensor values for a int32 Tensor must be in the range [0 - 255] but got range ["+Me+" - "+We+"].")}for(Ze=u.dtype==="float32"?255:1,Je=new Uint8ClampedArray(D*y*4),at=0;at<y*D;++at)yt=void 0,xt=void 0,kt=void 0,It=void 0,z===1?(yt=X[at]*Ze,xt=X[at]*Ze,kt=X[at]*Ze,It=255):z===3?(yt=X[3*at]*Ze,xt=X[3*at+1]*Ze,kt=X[3*at+2]*Ze,It=255):z===4&&(yt=X[4*at]*Ze,xt=X[4*at+1]*Ze,kt=X[4*at+2]*Ze,It=X[4*at+3]*Ze),Je[0+(Jt=4*at)]=Math.round(yt),Je[Jt+1]=Math.round(xt),Je[Jt+2]=Math.round(kt),Je[Jt+3]=Math.round(It);return h!=null&&(h.width=D,h.height=y,on=h.getContext("2d"),Qt=new ImageData(Je,D,y),on.putImageData(Qt,0,0)),u!==v&&u.dispose(),[2,Je]}})})},fromPixels:xp}),Ds=function(){function v(){}return v.prototype.getClassName=function(){return this.constructor.className},v.fromConfig=function(h,u){return new h(u)},v}(),Iu=function(){function v(){this.classNameMap={}}return v.getMap=function(){return v.instance==null&&(v.instance=new v),v.instance},v.register=function(h){v.getMap().classNameMap[h.className]=[h,h.fromConfig]},v}();function ps(v){ke(v.className!=null,function(){return"Class being registered does not have the static className property defined."}),ke(typeof v.className=="string",function(){return"className is required to be a string, but got type "+typeof v.className}),ke(v.className.length>0,function(){return"Class being registered has an empty-string as its className, which is disallowed."}),Iu.register(v)}var pl=Object.freeze({Serializable:Ds,SerializationMap:Iu,registerClass:ps}),ah=.001,ld=.1;function sh(){return Ue.backend.floatPrecision()===32?ah:ld}function wp(v,h,u){var d=!0;if((pt(v)||pt(h))&&(d=!1),pt(v)&&pt(h)&&(d=!0),d){var y=v.constructor.name,D=h.constructor.name;if(y!==D)throw new Error("Arrays are of different type. Actual: "+y+". Expected: "+D)}if(Array.isArray(v)&&Array.isArray(h)){var z=za(v),X=za(h);if(!ln(z,X))throw new Error("Arrays have different shapes. Actual: ["+z+"]. Expected: ["+X+"]")}var oe=pt(v)?v:jt(v),he=pt(h)?h:jt(h);if(oe.length!==he.length)throw new Error("Arrays have different lengths actual: "+oe.length+" vs expected: "+he.length+`.
Actual:   `+oe+`.
Expected: `+he+".");for(var xe=0;xe<he.length;++xe){var Fe=oe[xe],Re=he[xe];if(!u(Fe,Re))throw new Error("Arrays differ: actual["+xe+"] = "+Fe+", expected["+xe+"] = "+Re+`.
Actual:   `+oe+`.
Expected: `+he+".")}}function ml(v,h,u){return!isFinite(v)&&!isFinite(h)||!(isNaN(v)||isNaN(h)||Math.abs(v-h)>u)}var ou=Object.freeze({TEST_EPSILON_FLOAT16:ld,expectArraysClose:function(v,h,u){return u==null&&(u=sh()),wp(v,h,function(d,y){return ml(d,y,u)})},testEpsilon:sh,expectPromiseToFail:function(v,h){v().then(function(){return h.fail()},function(){return h()})},expectArraysEqual:function(v,h){var u=typeof h=="string"||typeof h=="number"||typeof h=="boolean"?[h]:h;return Tn(v)||Tn(v[0])||Tn(h)||Tn(h[0])?wp(v,u,function(d,y){return d==y}):wp(v,h,function(d,y){return ml(d,y,0)})},expectNumbersClose:function(v,h,u){if(u==null&&(u=sh()),!ml(v,h,u))throw new Error("Numbers differ: actual === "+v+", expected === "+h)},expectValuesInRange:function(v,h,u){for(var d=0;d<v.length;d++)if(v[d]<h||v[d]>u)throw new Error("Value out of range:"+v[d]+" low: "+h+", high: "+u)},expectArrayBuffersEqual:function(v,h){expect(new Float32Array(v)).toEqual(new Float32Array(h))}}),Cv="1.7.0",gl=Object.freeze({gpgpu_util:Rs,webgl_util:Ef,forceHalfFloat:function(){P().set("WEBGL_FORCE_F16_TEXTURES",!0)},MathBackendWebGL:T0,setWebGLContext:fo,GPGPUContext:Zo}),fd=function(v){function h(){return v!==null&&v.apply(this,arguments)||this}return J(h,v),h.prototype.minimize=function(u,d,y){d===void 0&&(d=!1);var D=this.computeGradients(u,y),z=D.value,X=D.grads;if(y!=null){var oe=y.map(function(he){return{name:he.name,tensor:X[he.name]}});this.applyGradients(oe)}else this.applyGradients(X);return No(X),d?z:(z.dispose(),null)},Object.defineProperty(h.prototype,"iterations",{get:function(){return this.iterations_==null&&(this.iterations_=0),this.iterations_},enumerable:!0,configurable:!0}),h.prototype.incrementIterations=function(){this.iterations_=this.iterations+1},h.prototype.computeGradients=function(u,d){return tn(u,d)},h.prototype.dispose=function(){this.iterations_!=null&&No(this.iterations_)},h.prototype.saveIterations=function(){return R(this,void 0,void 0,function(){return W(this,function(u){return this.iterations_==null&&(this.iterations_=0),[2,{name:"iter",tensor:fr(this.iterations_,"int32")}]})})},h.prototype.getWeights=function(){return R(this,void 0,void 0,function(){return W(this,function(u){throw new Error("getWeights() is not implemented for this optimizer yet.")})})},h.prototype.setWeights=function(u){return R(this,void 0,void 0,function(){return W(this,function(d){throw new Error("setWeights() is not implemented for this optimizer class "+this.getClassName())})})},h.prototype.extractIterations=function(u){return R(this,void 0,void 0,function(){var d;return W(this,function(y){switch(y.label){case 0:return d=this,[4,u[0].tensor.data()];case 1:return d.iterations_=y.sent()[0],[2,u.slice(1)]}})})},h}(Ds);Object.defineProperty(fd,Symbol.hasInstance,{value:function(v){return v.minimize!=null&&v.computeGradients!=null&&v.applyGradients!=null}});var Ov=function(v){function h(u,d,y){y===void 0&&(y=null);var D=v.call(this)||this;return D.learningRate=u,D.rho=d,D.epsilon=y,D.accumulatedGrads=[],D.accumulatedUpdates=[],y==null&&(D.epsilon=Ue.backend.epsilon()),D}return J(h,v),h.prototype.applyGradients=function(u){var d=this;(Array.isArray(u)?u.map(function(y){return y.name}):Object.keys(u)).forEach(function(y,D){var z=Ue.registeredVariables[y];d.accumulatedGrads[D]==null&&(d.accumulatedGrads[D]={originalName:y+"/accum_grad",variable:Ii(function(){return ii(z).variable(!1)})}),d.accumulatedUpdates[D]==null&&(d.accumulatedUpdates[D]={originalName:y+"/accum_var",variable:Ii(function(){return ii(z).variable(!1)})});var X=Array.isArray(u)?u[D].tensor:u[y];if(X!=null){var oe=d.accumulatedGrads[D].variable,he=d.accumulatedUpdates[D].variable;Ii(function(){var xe=oe.mul(d.rho).add(X.square().mul(1-d.rho)),Fe=he.add(d.epsilon).sqrt().div(oe.add(d.epsilon).sqrt()).mul(X),Re=he.mul(d.rho).add(Fe.square().mul(1-d.rho));oe.assign(xe),he.assign(Re);var Me=Fe.mul(-d.learningRate).add(z);z.assign(Me)})}}),this.incrementIterations()},h.prototype.dispose=function(){this.accumulatedUpdates!=null&&(No(this.accumulatedGrads.map(function(u){return u.variable})),No(this.accumulatedUpdates.map(function(u){return u.variable})))},h.prototype.getWeights=function(){return R(this,void 0,void 0,function(){var u;return W(this,function(d){switch(d.label){case 0:return u=this.accumulatedGrads.concat(this.accumulatedUpdates),[4,this.saveIterations()];case 1:return[2,[d.sent()].concat(u.map(function(y){return{name:y.originalName,tensor:y.variable}}))]}})})},h.prototype.setWeights=function(u){return R(this,void 0,void 0,function(){var d;return W(this,function(y){switch(y.label){case 0:return[4,this.extractIterations(u)];case 1:return u=y.sent(),d=u.length/2,this.accumulatedGrads=u.slice(0,d).map(function(D){return{originalName:D.name,variable:D.tensor.variable(!1)}}),this.accumulatedUpdates=u.slice(d,2*d).map(function(D){return{originalName:D.name,variable:D.tensor.variable(!1)}}),[2]}})})},h.prototype.getConfig=function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}},h.fromConfig=function(u,d){return new u(d.learningRate,d.rho,d.epsilon)},h.className="Adadelta",h}(fd);ps(Ov);var Av=function(v){function h(u,d){d===void 0&&(d=.1);var y=v.call(this)||this;return y.learningRate=u,y.initialAccumulatorValue=d,y.accumulatedGrads=[],y}return J(h,v),h.prototype.applyGradients=function(u){var d=this;(Array.isArray(u)?u.map(function(y){return y.name}):Object.keys(u)).forEach(function(y,D){var z=Ue.registeredVariables[y];d.accumulatedGrads[D]==null&&(d.accumulatedGrads[D]={originalName:y+"/accumulator",variable:Ii(function(){return ws(z.shape,d.initialAccumulatorValue).variable(!1)})});var X=Array.isArray(u)?u[D].tensor:u[y];if(X!=null){var oe=d.accumulatedGrads[D].variable;Ii(function(){var he=oe.add(X.square());oe.assign(he);var xe=X.div(he.add(Ue.backend.epsilon()).sqrt()).mul(-d.learningRate).add(z);z.assign(xe)})}}),this.incrementIterations()},h.prototype.dispose=function(){this.accumulatedGrads!=null&&No(this.accumulatedGrads.map(function(u){return u.variable}))},h.prototype.getWeights=function(){return R(this,void 0,void 0,function(){return W(this,function(u){switch(u.label){case 0:return[4,this.saveIterations()];case 1:return[2,[u.sent()].concat(this.accumulatedGrads.map(function(d){return{name:d.originalName,tensor:d.variable}}))]}})})},h.prototype.setWeights=function(u){return R(this,void 0,void 0,function(){return W(this,function(d){switch(d.label){case 0:return[4,this.extractIterations(u)];case 1:return u=d.sent(),this.accumulatedGrads=u.map(function(y){return{originalName:y.name,variable:y.tensor.variable(!1)}}),[2]}})})},h.prototype.getConfig=function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}},h.fromConfig=function(u,d){return new u(d.learningRate,d.initialAccumulatorValue)},h.className="Adagrad",h}(fd);ps(Av);var Sv=function(v){function h(u,d,y,D){D===void 0&&(D=null);var z=v.call(this)||this;return z.learningRate=u,z.beta1=d,z.beta2=y,z.epsilon=D,z.accumulatedFirstMoment=[],z.accumulatedSecondMoment=[],Ii(function(){z.accBeta1=fr(d).variable(),z.accBeta2=fr(y).variable()}),D==null&&(z.epsilon=Ue.backend.epsilon()),z}return J(h,v),h.prototype.applyGradients=function(u){var d=this,y=Array.isArray(u)?u.map(function(D){return D.name}):Object.keys(u);Ii(function(){var D=Fc(1,d.accBeta1),z=Fc(1,d.accBeta2);y.forEach(function(X,oe){var he=Ue.registeredVariables[X];d.accumulatedFirstMoment[oe]==null&&(d.accumulatedFirstMoment[oe]={originalName:X+"/m",variable:Ii(function(){return ii(he).variable(!1)})}),d.accumulatedSecondMoment[oe]==null&&(d.accumulatedSecondMoment[oe]={originalName:X+"/v",variable:Ii(function(){return ii(he).variable(!1)})});var xe=Array.isArray(u)?u[oe].tensor:u[X];if(xe!=null){var Fe=d.accumulatedFirstMoment[oe].variable,Re=d.accumulatedSecondMoment[oe].variable,Me=Fe.mul(d.beta1).add(xe.mul(1-d.beta1)),We=Re.mul(d.beta2).add(xe.square().mul(1-d.beta2)),Ze=Me.div(D),Je=We.div(z);Fe.assign(Me),Re.assign(We);var at=Ze.div(Je.sqrt().add(d.epsilon)).mul(-d.learningRate).add(he);he.assign(at)}}),d.accBeta1.assign(d.accBeta1.mul(d.beta1)),d.accBeta2.assign(d.accBeta2.mul(d.beta2))}),this.incrementIterations()},h.prototype.dispose=function(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&No(this.accumulatedFirstMoment.map(function(u){return u.variable})),this.accumulatedSecondMoment!=null&&No(this.accumulatedSecondMoment.map(function(u){return u.variable}))},h.prototype.getWeights=function(){return R(this,void 0,void 0,function(){var u;return W(this,function(d){switch(d.label){case 0:return u=this.accumulatedFirstMoment.concat(this.accumulatedSecondMoment),[4,this.saveIterations()];case 1:return[2,[d.sent()].concat(u.map(function(y){return{name:y.originalName,tensor:y.variable}}))]}})})},h.prototype.setWeights=function(u){return R(this,void 0,void 0,function(){var d,y=this;return W(this,function(D){switch(D.label){case 0:return[4,this.extractIterations(u)];case 1:return u=D.sent(),Ii(function(){y.accBeta1.assign(Gf(y.beta1,y.iterations_+1)),y.accBeta2.assign(Gf(y.beta2,y.iterations_+1))}),d=u.length/2,this.accumulatedFirstMoment=u.slice(0,d).map(function(z){return{originalName:z.name,variable:z.tensor.variable(!1)}}),this.accumulatedSecondMoment=u.slice(d,2*d).map(function(z){return{originalName:z.name,variable:z.tensor.variable(!1)}}),[2]}})})},h.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}},h.fromConfig=function(u,d){return new u(d.learningRate,d.beta1,d.beta2,d.epsilon)},h.className="Adam",h}(fd);ps(Sv);var r0=function(v){function h(u,d,y,D,z){D===void 0&&(D=null),z===void 0&&(z=0);var X=v.call(this)||this;return X.learningRate=u,X.beta1=d,X.beta2=y,X.epsilon=D,X.decay=z,X.accumulatedFirstMoment=[],X.accumulatedWeightedInfNorm=[],Ii(function(){X.iteration=fr(0).variable(),X.accBeta1=fr(d).variable()}),D==null&&(X.epsilon=Ue.backend.epsilon()),X}return J(h,v),h.prototype.applyGradients=function(u){var d=this,y=Array.isArray(u)?u.map(function(D){return D.name}):Object.keys(u);Ii(function(){var D=Fc(1,d.accBeta1),z=Hl(-d.learningRate,d.iteration.mul(d.decay).add(1));y.forEach(function(X,oe){var he=Ue.registeredVariables[X];d.accumulatedFirstMoment[oe]==null&&(d.accumulatedFirstMoment[oe]={originalName:X+"/m",variable:ii(he).variable(!1)}),d.accumulatedWeightedInfNorm[oe]==null&&(d.accumulatedWeightedInfNorm[oe]={originalName:X+"/v",variable:ii(he).variable(!1)});var xe=Array.isArray(u)?u[oe].tensor:u[X];if(xe!=null){var Fe=d.accumulatedFirstMoment[oe].variable,Re=d.accumulatedWeightedInfNorm[oe].variable,Me=Fe.mul(d.beta1).add(xe.mul(1-d.beta1)),We=Re.mul(d.beta2),Ze=xe.abs(),Je=We.maximum(Ze);Fe.assign(Me),Re.assign(Je);var at=z.div(D).mul(Me.div(Je.add(d.epsilon))).add(he);he.assign(at)}}),d.iteration.assign(d.iteration.add(1)),d.accBeta1.assign(d.accBeta1.mul(d.beta1))}),this.incrementIterations()},h.prototype.dispose=function(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&No(this.accumulatedFirstMoment.map(function(u){return u.variable})),this.accumulatedWeightedInfNorm!=null&&No(this.accumulatedWeightedInfNorm.map(function(u){return u.variable}))},h.prototype.getWeights=function(){return R(this,void 0,void 0,function(){return W(this,function(u){throw new Error("getWeights() is not implemented for Adamax yet.")})})},h.prototype.setWeights=function(u){return R(this,void 0,void 0,function(){return W(this,function(d){throw new Error("setWeights() is not implemented for Adamax yet.")})})},h.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}},h.fromConfig=function(u,d){return new u(d.learningRate,d.beta1,d.beta2,d.epsilon,d.decay)},h.className="Adamax",h}(fd);ps(r0);var U0=function(v){function h(u){var d=v.call(this)||this;return d.learningRate=u,d.setLearningRate(u),d}return J(h,v),h.prototype.applyGradients=function(u){var d=this;(Array.isArray(u)?u.map(function(y){return y.name}):Object.keys(u)).forEach(function(y,D){var z=Array.isArray(u)?u[D].tensor:u[y];if(z!=null){var X=Ue.registeredVariables[y];Ii(function(){var oe=d.c.mul(z).add(X);X.assign(oe)})}}),this.incrementIterations()},h.prototype.setLearningRate=function(u){this.learningRate=u,this.c!=null&&this.c.dispose(),this.c=Dh(fr(-u))},h.prototype.dispose=function(){this.c.dispose()},h.prototype.getWeights=function(){return R(this,void 0,void 0,function(){return W(this,function(u){switch(u.label){case 0:return[4,this.saveIterations()];case 1:return[2,[u.sent()]]}})})},h.prototype.setWeights=function(u){return R(this,void 0,void 0,function(){return W(this,function(d){switch(d.label){case 0:return[4,this.extractIterations(u)];case 1:if((u=d.sent()).length!==0)throw new Error("SGD optimizer does not have settable weights.");return[2]}})})},h.prototype.getConfig=function(){return{learningRate:this.learningRate}},h.fromConfig=function(u,d){return new u(d.learningRate)},h.className="SGD",h}(fd);ps(U0);var i0=function(v){function h(u,d,y){y===void 0&&(y=!1);var D=v.call(this,u)||this;return D.learningRate=u,D.momentum=d,D.useNesterov=y,D.accumulations=[],D.m=fr(D.momentum),D}return J(h,v),h.prototype.applyGradients=function(u){var d=this;(Array.isArray(u)?u.map(function(y){return y.name}):Object.keys(u)).forEach(function(y,D){var z=Ue.registeredVariables[y];d.accumulations[D]==null&&(d.accumulations[D]={originalName:y+"/momentum",variable:Ii(function(){return ii(z).variable(!1)})});var X=d.accumulations[D].variable,oe=Array.isArray(u)?u[D].tensor:u[y];oe!=null&&Ii(function(){var he,xe=d.m.mul(X).add(oe);he=d.useNesterov?d.c.mul(oe.add(xe.mul(d.m))).add(z):d.c.mul(xe).add(z),X.assign(xe),z.assign(he)})}),this.incrementIterations()},h.prototype.dispose=function(){this.m.dispose(),this.accumulations!=null&&No(this.accumulations.map(function(u){return u.variable}))},h.prototype.setMomentum=function(u){this.momentum=u},h.prototype.getWeights=function(){return R(this,void 0,void 0,function(){return W(this,function(u){switch(u.label){case 0:return[4,this.saveIterations()];case 1:return[2,[u.sent()].concat(this.accumulations.map(function(d){return{name:d.originalName,tensor:d.variable}}))]}})})},h.prototype.setWeights=function(u){return R(this,void 0,void 0,function(){return W(this,function(d){switch(d.label){case 0:return[4,this.extractIterations(u)];case 1:return u=d.sent(),this.accumulations=u.map(function(y){return{originalName:y.name,variable:y.tensor.variable(!1)}}),[2]}})})},h.prototype.getConfig=function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}},h.fromConfig=function(u,d){return new u(d.learningRate,d.momentum,d.useNesterov)},h.className="Momentum",h}(U0);ps(i0);var W0=function(v){function h(u,d,y,D,z){d===void 0&&(d=.9),y===void 0&&(y=0),D===void 0&&(D=null),z===void 0&&(z=!1);var X=v.call(this)||this;if(X.learningRate=u,X.decay=d,X.momentum=y,X.epsilon=D,X.accumulatedMeanSquares=[],X.accumulatedMoments=[],X.accumulatedMeanGrads=[],X.centered=z,D==null&&(X.epsilon=Ue.backend.epsilon()),u==null)throw new Error("learningRate for RMSPropOptimizer must be defined.");return X}return J(h,v),h.prototype.applyGradients=function(u){var d=this;(Array.isArray(u)?u.map(function(y){return y.name}):Object.keys(u)).forEach(function(y,D){var z=Ue.registeredVariables[y];d.accumulatedMeanSquares[D]==null&&(d.accumulatedMeanSquares[D]={originalName:y+"/rms",variable:Ii(function(){return ii(z).variable(!1)})}),d.accumulatedMoments[D]==null&&(d.accumulatedMoments[D]={originalName:y+"/momentum",variable:Ii(function(){return ii(z).variable(!1)})}),d.accumulatedMeanGrads[D]==null&&d.centered&&(d.accumulatedMeanGrads[D]={originalName:y+"/mg",variable:Ii(function(){return ii(z).variable(!1)})});var X=Array.isArray(u)?u[D].tensor:u[y];if(X!=null){var oe=d.accumulatedMeanSquares[D].variable,he=d.accumulatedMoments[D].variable;Ii(function(){var xe=oe.mul(d.decay).add(X.square().mul(1-d.decay));if(d.centered){var Fe=d.accumulatedMeanGrads[D].variable,Re=Fe.mul(d.decay).add(X.mul(1-d.decay)),Me=he.mul(d.momentum).add(X.mul(d.learningRate).div(xe.sub(Re.square().add(d.epsilon)).sqrt()));oe.assign(xe),Fe.assign(Re),he.assign(Me);var We=z.sub(Me);z.assign(We)}else{var Ze=oe.mul(d.decay).add(X.square().mul(1-d.decay));Me=he.mul(d.momentum).add(X.mul(d.learningRate).div(Ze.add(d.epsilon).sqrt())),oe.assign(Ze),he.assign(Me),We=z.sub(Me),z.assign(We)}})}}),this.incrementIterations()},h.prototype.dispose=function(){this.accumulatedMeanSquares!=null&&No(this.accumulatedMeanSquares.map(function(u){return u.variable})),this.accumulatedMeanGrads!=null&&this.centered&&No(this.accumulatedMeanGrads.map(function(u){return u.variable})),this.accumulatedMoments!=null&&No(this.accumulatedMoments.map(function(u){return u.variable}))},h.prototype.getWeights=function(){return R(this,void 0,void 0,function(){var u;return W(this,function(d){switch(d.label){case 0:return u=this.accumulatedMeanSquares.concat(this.accumulatedMoments),this.centered&&u.push.apply(u,this.accumulatedMeanGrads),[4,this.saveIterations()];case 1:return[2,[d.sent()].concat(u.map(function(y){return{name:y.originalName,tensor:y.variable}}))]}})})},h.prototype.setWeights=function(u){return R(this,void 0,void 0,function(){var d;return W(this,function(y){switch(y.label){case 0:return[4,this.extractIterations(u)];case 1:return u=y.sent(),d=this.centered?u.length/3:u.length/2,this.accumulatedMeanSquares=u.slice(0,d).map(function(D){return{originalName:D.name,variable:D.tensor.variable(!1)}}),this.accumulatedMoments=u.slice(d,2*d).map(function(D){return{originalName:D.name,variable:D.tensor.variable(!1)}}),this.centered&&(this.accumulatedMeanGrads=u.slice(2*d,3*d).map(function(D){return{originalName:D.name,variable:D.tensor.variable(!1)}})),[2]}})})},h.prototype.getConfig=function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}},h.fromConfig=function(u,d){return new u(d.learningRate,d.decay,d.momentum,d.epsilon,d.centered)},h.className="RMSProp",h}(fd);ps(W0);var mc=function(){function v(){}return v.sgd=function(h){return new U0(h)},v.momentum=function(h,u,d){return d===void 0&&(d=!1),new i0(h,u,d)},v.rmsprop=function(h,u,d,y,D){return u===void 0&&(u=.9),d===void 0&&(d=0),y===void 0&&(y=null),D===void 0&&(D=!1),new W0(h,u,d,y,D)},v.adam=function(h,u,d,y){return h===void 0&&(h=.001),u===void 0&&(u=.9),d===void 0&&(d=.999),y===void 0&&(y=null),new Sv(h,u,d,y)},v.adadelta=function(h,u,d){return h===void 0&&(h=.001),u===void 0&&(u=.95),d===void 0&&(d=null),new Ov(h,u,d)},v.adamax=function(h,u,d,y,D){return h===void 0&&(h=.002),u===void 0&&(u=.9),d===void 0&&(d=.999),y===void 0&&(y=null),D===void 0&&(D=0),new r0(h,u,d,y,D)},v.adagrad=function(h,u){return u===void 0&&(u=.1),new Av(h,u)},v}(),_v={sgd:mc.sgd,momentum:mc.momentum,adadelta:mc.adadelta,adagrad:mc.adagrad,rmsprop:mc.rmsprop,adamax:mc.adamax,adam:mc.adam},Xu=typeof requestAnimationFrame<"u"?requestAnimationFrame:B!==void 0?B:function(v){return v()};function of(){return new Promise(function(v){return Xu(function(){return v()})})}Mt.prototype.squaredDifference=function(v){return zf(this,v)},bt=um}.call(this,a(59),a(75),a(92).Buffer,a(207).setImmediate)},function(Oe,A,a){Oe.exports=a(281)},function(Oe,A,a){a.d(A,"c",function(){return $}),a.d(A,"a",function(){return U}),a.d(A,"b",function(){return B}),a.d(A,"d",function(){return re}),a.d(A,"e",function(){return J});/*! *****************************************************************************
	Copyright (c) Microsoft Corporation.

	Permission to use, copy, modify, and/or distribute this software for any
	purpose with or without fee is hereby granted.

	THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
	REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
	AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
	INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
	LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
	OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
	PERFORMANCE OF THIS SOFTWARE.
	***************************************************************************** */var b=function(R,W){return(b=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(q,P){q.__proto__=P}||function(q,P){for(var ee in P)P.hasOwnProperty(ee)&&(q[ee]=P[ee])})(R,W)};function $(R,W){function q(){this.constructor=R}b(R,W),R.prototype=W===null?Object.create(W):(q.prototype=W.prototype,new q)}var U=function(){return(U=Object.assign||function(R){for(var W,q=1,P=arguments.length;q<P;q++)for(var ee in W=arguments[q])Object.prototype.hasOwnProperty.call(W,ee)&&(R[ee]=W[ee]);return R}).apply(this,arguments)};function B(R,W,q,P){return new(q||(q=Promise))(function(ee,I){function se(de){try{K(P.next(de))}catch(pe){I(pe)}}function ie(de){try{K(P.throw(de))}catch(pe){I(pe)}}function K(de){de.done?ee(de.value):function(pe){return pe instanceof q?pe:new q(function(Ae){Ae(pe)})}(de.value).then(se,ie)}K((P=P.apply(R,W||[])).next())})}function re(R,W){var q,P,ee,I,se={label:0,sent:function(){if(1&ee[0])throw ee[1];return ee[1]},trys:[],ops:[]};return I={next:ie(0),throw:ie(1),return:ie(2)},typeof Symbol=="function"&&(I[Symbol.iterator]=function(){return this}),I;function ie(K){return function(de){return function(pe){if(q)throw new TypeError("Generator is already executing.");for(;se;)try{if(q=1,P&&(ee=2&pe[0]?P.return:pe[0]?P.throw||((ee=P.return)&&ee.call(P),0):P.next)&&!(ee=ee.call(P,pe[1])).done)return ee;switch(P=0,ee&&(pe=[2&pe[0],ee.value]),pe[0]){case 0:case 1:ee=pe;break;case 4:return se.label++,{value:pe[1],done:!1};case 5:se.label++,P=pe[1],pe=[0];continue;case 7:pe=se.ops.pop(),se.trys.pop();continue;default:if(!(ee=(ee=se.trys).length>0&&ee[ee.length-1])&&(pe[0]===6||pe[0]===2)){se=0;continue}if(pe[0]===3&&(!ee||pe[1]>ee[0]&&pe[1]<ee[3])){se.label=pe[1];break}if(pe[0]===6&&se.label<ee[1]){se.label=ee[1],ee=pe;break}if(ee&&se.label<ee[2]){se.label=ee[2],se.ops.push(pe);break}ee[2]&&se.ops.pop(),se.trys.pop();continue}pe=W.call(R,se)}catch(Ae){pe=[6,Ae],P=0}finally{q=ee=0}if(5&pe[0])throw pe[1];return{value:pe[0]?pe[1]:void 0,done:!0}}([K,de])}}}function J(){for(var R=0,W=0,q=arguments.length;W<q;W++)R+=arguments[W].length;var P=Array(R),ee=0;for(W=0;W<q;W++)for(var I=arguments[W],se=0,ie=I.length;se<ie;se++,ee++)P[ee]=I[se];return P}},function(Oe,A){function a(b,$,U,B,re,J,R){try{var W=b[J](R),q=W.value}catch(P){return void U(P)}W.done?$(q):Promise.resolve(q).then(B,re)}Oe.exports=function(b){return function(){var $=this,U=arguments;return new Promise(function(B,re){var J=b.apply($,U);function R(q){a(J,B,re,R,W,"next",q)}function W(q){a(J,B,re,R,W,"throw",q)}R(void 0)})}},Oe.exports.__esModule=!0,Oe.exports.default=Oe.exports},function(Oe,A){function a(b){return Oe.exports=a=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function($){return typeof $}:function($){return $&&typeof Symbol=="function"&&$.constructor===Symbol&&$!==Symbol.prototype?"symbol":typeof $},Oe.exports.__esModule=!0,Oe.exports.default=Oe.exports,a(b)}Oe.exports=a,Oe.exports.__esModule=!0,Oe.exports.default=Oe.exports},function(Oe,A,a){var b=a(16),$=a(24),U=a(42),B=a(38),re=a(56),J=function(R,W,q){var P,ee,I,se,ie=R&J.F,K=R&J.G,de=R&J.S,pe=R&J.P,Ae=R&J.B,Te=K?b:de?b[W]||(b[W]={}):(b[W]||{}).prototype,je=K?$:$[W]||($[W]={}),we=je.prototype||(je.prototype={});for(P in K&&(q=W),q)I=((ee=!ie&&Te&&Te[P]!==void 0)?Te:q)[P],se=Ae&&ee?re(I,b):pe&&typeof I=="function"?re(Function.call,I):I,Te&&B(Te,P,I,R&J.U),je[P]!=I&&U(je,P,se),pe&&we[P]!=I&&(we[P]=I)};b.core=$,J.F=1,J.G=2,J.S=4,J.P=8,J.B=16,J.W=32,J.U=64,J.R=128,Oe.exports=J},function(Oe,A){function a(b,$){for(var U=0;U<$.length;U++){var B=$[U];B.enumerable=B.enumerable||!1,B.configurable=!0,"value"in B&&(B.writable=!0),Object.defineProperty(b,B.key,B)}}Oe.exports=function(b,$,U){return $&&a(b.prototype,$),U&&a(b,U),Object.defineProperty(b,"prototype",{writable:!1}),b},Oe.exports.__esModule=!0,Oe.exports.default=Oe.exports},function(Oe,A){Oe.exports=function(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")},Oe.exports.__esModule=!0,Oe.exports.default=Oe.exports},function(Oe,A,a){a.d(A,"a",function(){return ot}),a.d(A,"b",function(){return _t}),a.d(A,"c",function(){return Ut}),a.d(A,"d",function(){return Xt}),a.d(A,"e",function(){return Gt}),a.d(A,"f",function(){return ke}),a.d(A,"g",function(){return je}),a.d(A,"h",function(){return Te}),a.d(A,"i",function(){return Ft}),a.d(A,"j",function(){return jt}),a.d(A,"k",function(){return we}),a.d(A,"l",function(){return Ae}),a.d(A,"m",function(){return Dt}),a.d(A,"n",function(){return Ei}),a.d(A,"o",function(){return Yn}),a.d(A,"p",function(){return Kt}),a.d(A,"q",function(){return Dn}),a.d(A,"r",function(){return gr}),a.d(A,"s",function(){return Bt}),a.d(A,"t",function(){return ln}),a.d(A,"u",function(){return Nr}),a.d(A,"v",function(){return Zt}),a.d(A,"w",function(){return hr}),a.d(A,"x",function(){return Qr}),a.d(A,"y",function(){return Ve}),a.d(A,"z",function(){return Qe}),a.d(A,"A",function(){return St});var b=a(1),$=a(72),U=a(40),B=a(71),re=a(39),J=a(70),R=a(135),W=a(184),q=a(183),P=a(69),ee=a(182),I=a(68),se=a(134),ie=a(181),K=a(180),de=a(108),pe=a(45);const Ae="year",Te="quarter",je="month",we="week",ot="date",_t="day",Ut="dayofyear",Xt="hours",ke="minutes",Ft="seconds",Gt="milliseconds",jt=[Ae,Te,je,we,ot,_t,Ut,Xt,ke,Ft,Gt],Ye=jt.reduce((bt,Lr,Mt)=>(bt[Lr]=1+Mt,bt),{});function ln(bt){const Lr=Object(b.i)(bt).slice(),Mt={};return Lr.length||Object(b.o)("Missing time unit."),Lr.forEach(ge=>{Object(b.w)(Ye,ge)?Mt[ge]=1:Object(b.o)("Invalid time unit: ".concat(ge,"."))}),(Mt[we]||Mt[_t]?1:0)+(Mt[Te]||Mt[je]||Mt[ot]?1:0)+(Mt[Ut]?1:0)>1&&Object(b.o)("Incompatible time units: ".concat(bt)),Lr.sort((ge,le)=>Ye[ge]-Ye[le]),Lr}const nn={[Ae]:"%Y ",[Te]:"Q%q ",[je]:"%b ",[ot]:"%d ",[we]:"W%U ",[_t]:"%a ",[Ut]:"%j ",[Xt]:"%H:00",[ke]:"00:%M",[Ft]:":%S",[Gt]:".%L",["".concat(Ae,"-").concat(je)]:"%Y-%m ",["".concat(Ae,"-").concat(je,"-").concat(ot)]:"%Y-%m-%d ",["".concat(Xt,"-").concat(ke)]:"%H:%M"};function Bt(bt,Lr){const Mt=Object(b.p)({},nn,Lr),ge=ln(bt),le=ge.length;let ye,_e,et="",gt=0;for(gt=0;gt<le;)for(ye=ge.length;ye>gt;--ye)if(Mt[_e=ge.slice(gt,ye).join("-")]!=null){et+=Mt[_e],gt=ye;break}return et.trim()}const Pt=new Date;function gn(bt){return Pt.setFullYear(bt),Pt.setMonth(0),Pt.setDate(1),Pt.setHours(0,0,0,0),Pt}function Dt(bt){return wn(new Date(bt))}function St(bt){return Bn(new Date(bt))}function wn(bt){return $.a.count(gn(bt.getFullYear())-1,bt)}function Bn(bt){return U.b.count(gn(bt.getFullYear())-1,bt)}function Hn(bt){return gn(bt).getDay()}function hn(bt,Lr,Mt,ge,le,ye,_e){if(0<=bt&&bt<100){const et=new Date(-1,Lr,Mt,ge,le,ye,_e);return et.setFullYear(bt),et}return new Date(bt,Lr,Mt,ge,le,ye,_e)}function Ve(bt){return He(new Date(bt))}function Qe(bt){return pt(new Date(bt))}function He(bt){const Lr=Date.UTC(bt.getUTCFullYear(),0,1);return B.a.count(Lr-1,bt)}function pt(bt){const Lr=Date.UTC(bt.getUTCFullYear(),0,1);return re.b.count(Lr-1,bt)}function Lt(bt){return Pt.setTime(Date.UTC(bt,0,1)),Pt.getUTCDay()}function zt(bt,Lr,Mt,ge,le,ye,_e){if(0<=bt&&bt<100){const et=new Date(Date.UTC(-1,Lr,Mt,ge,le,ye,_e));return et.setUTCFullYear(Mt.y),et}return new Date(Date.UTC(bt,Lr,Mt,ge,le,ye,_e))}function Tn(bt,Lr,Mt,ge,le){const ye=Lr||1,_e=Object(b.W)(bt),et=(pn,Ht,Ue)=>function(Mn,Gn,Zn,ir){const zr=Zn<=1?Mn:ir?(vr,pi)=>ir+Zn*Math.floor((Mn(vr,pi)-ir)/Zn):(vr,pi)=>Zn*Math.floor(Mn(vr,pi)/Zn);return Gn?(vr,pi)=>Gn(zr(vr,pi),pi):zr}(Mt[Ue=Ue||pn],ge[Ue],pn===_e&&ye,Ht),gt=new Date,Rt=Object(b.Fa)(bt),fn=Rt[Ae]?et(Ae):Object(b.m)(2012),Jn=Rt[je]?et(je):Rt[Te]?et(Te):b.Ma,An=Rt[we]&&Rt[_t]?et(_t,1,we+_t):Rt[we]?et(we,1):Rt[_t]?et(_t,1):Rt[ot]?et(ot,1):Rt[Ut]?et(Ut,1):b.Q,Ln=Rt[Xt]?et(Xt):b.Ma,qn=Rt[ke]?et(ke):b.Ma,Nt=Rt[Ft]?et(Ft):b.Ma,Ot=Rt[Gt]?et(Gt):b.Ma;return function(pn){gt.setTime(+pn);const Ht=fn(gt);return le(Ht,Jn(gt),An(gt,Ht),Ln(gt),qn(gt),Nt(gt),Ot(gt))}}function xn(bt,Lr,Mt){return Lr+7*bt-(Mt+6)%7}const Kn={[Ae]:bt=>bt.getFullYear(),[Te]:bt=>Math.floor(bt.getMonth()/3),[je]:bt=>bt.getMonth(),[ot]:bt=>bt.getDate(),[Xt]:bt=>bt.getHours(),[ke]:bt=>bt.getMinutes(),[Ft]:bt=>bt.getSeconds(),[Gt]:bt=>bt.getMilliseconds(),[Ut]:bt=>wn(bt),[we]:bt=>Bn(bt),[we+_t]:(bt,Lr)=>xn(Bn(bt),bt.getDay(),Hn(Lr)),[_t]:(bt,Lr)=>xn(1,bt.getDay(),Hn(Lr))},be={[Te]:bt=>3*bt,[we]:(bt,Lr)=>xn(bt,0,Hn(Lr))};function Yn(bt,Lr){return Tn(bt,Lr||1,Kn,be,hn)}const Dr={[Ae]:bt=>bt.getUTCFullYear(),[Te]:bt=>Math.floor(bt.getUTCMonth()/3),[je]:bt=>bt.getUTCMonth(),[ot]:bt=>bt.getUTCDate(),[Xt]:bt=>bt.getUTCHours(),[ke]:bt=>bt.getUTCMinutes(),[Ft]:bt=>bt.getUTCSeconds(),[Gt]:bt=>bt.getUTCMilliseconds(),[Ut]:bt=>He(bt),[we]:bt=>pt(bt),[_t]:(bt,Lr)=>xn(1,bt.getUTCDay(),Lt(Lr)),[we+_t]:(bt,Lr)=>xn(pt(bt),bt.getUTCDay(),Lt(Lr))},pr={[Te]:bt=>3*bt,[we]:(bt,Lr)=>xn(bt,0,Lt(Lr))};function Nr(bt,Lr){return Tn(bt,Lr||1,Dr,pr,zt)}const Fr={[Ae]:J.a,[Te]:R.a.every(3),[je]:R.a,[we]:U.b,[ot]:$.a,[_t]:$.a,[Ut]:$.a,[Xt]:W.a,[ke]:q.a,[Ft]:P.a,[Gt]:ee.a},an={[Ae]:I.a,[Te]:se.a.every(3),[je]:se.a,[we]:re.b,[ot]:B.a,[_t]:B.a,[Ut]:B.a,[Xt]:ie.a,[ke]:K.a,[Ft]:P.a,[Gt]:ee.a};function Kt(bt){return Fr[bt]}function Zt(bt){return an[bt]}function $n(bt,Lr,Mt){return bt?bt.offset(Lr,Mt):void 0}function Dn(bt,Lr,Mt){return $n(Kt(bt),Lr,Mt)}function hr(bt,Lr,Mt){return $n(Zt(bt),Lr,Mt)}function wr(bt,Lr,Mt,ge){return bt?bt.range(Lr,Mt,ge):void 0}function gr(bt,Lr,Mt,ge){return wr(Kt(bt),Lr,Mt,ge)}function Qr(bt,Lr,Mt,ge){return wr(Zt(bt),Lr,Mt,ge)}const ti=31536e6,Mr=[Ae,je,ot,Xt,ke,Ft,Gt],di=Mr.slice(0,-1),Yr=di.slice(0,-1),Xr=Yr.slice(0,-1),fi=Xr.slice(0,-1),oi=[Ae,je],Ao=[Ae],Wi=[[di,1,1e3],[di,5,5e3],[di,15,15e3],[di,30,3e4],[Yr,1,6e4],[Yr,5,3e5],[Yr,15,9e5],[Yr,30,18e5],[Xr,1,36e5],[Xr,3,108e5],[Xr,6,216e5],[Xr,12,432e5],[fi,1,864e5],[[Ae,we],1,6048e5],[oi,1,2592e6],[oi,3,7776e6],[Ao,1,ti]];function Ei(bt){const Lr=bt.extent,Mt=bt.maxbins||40,ge=Math.abs(Object(b.Z)(Lr))/Mt;let le,ye,_e=Object(de.a)(et=>et[2]).right(Wi,ge);return _e===Wi.length?(le=Ao,ye=Object(pe.c)(Lr[0]/ti,Lr[1]/ti,Mt)):_e?(le=(_e=Wi[ge/Wi[_e-1][2]<Wi[_e][2]/ge?_e-1:_e])[0],ye=_e[1]):(le=Mr,ye=Math.max(Object(pe.c)(Lr[0],Lr[1],Mt),1)),{units:le,step:ye}}},function(Oe,A,a){a.d(A,"e",function(){return b}),a.d(A,"c",function(){return $}),a.d(A,"b",function(){return U}),a.d(A,"a",function(){return B}),a.d(A,"f",function(){return re}),a.d(A,"d",function(){return J}),a.d(A,"g",function(){return R});const b=1e3,$=60*b,U=60*$,B=24*U,re=7*B,J=30*B,R=365*B},function(Oe,A){Oe.exports=function(a){return typeof a=="object"?a!==null:typeof a=="function"}},function(Oe,A,a){var b=a(13);Oe.exports=function($){if(!b($))throw TypeError($+" is not an object!");return $}},function(Oe,A){Oe.exports=function(a){try{return!!a()}catch{return!0}}},function(Oe,A){var a=Oe.exports=typeof window<"u"&&window.Math==Math?window:typeof self<"u"&&self.Math==Math?self:Function("return this")();typeof __g=="number"&&(__g=a)},function(Oe,A,a){Oe.exports=a(280)},function(Oe,A){Oe.exports=function(a,b,$){return b in a?Object.defineProperty(a,b,{value:$,enumerable:!0,configurable:!0,writable:!0}):a[b]=$,a},Oe.exports.__esModule=!0,Oe.exports.default=Oe.exports},function(Oe,A,a){var b=a(129)("wks"),$=a(84),U=a(16).Symbol,B=typeof U=="function";(Oe.exports=function(re){return b[re]||(b[re]=B&&U[re]||(B?U:$)("Symbol."+re))}).store=b},function(Oe,A,a){a.r(A),function(b){a.d(A,"GraphModel",function(){return bt}),a.d(A,"loadGraphModel",function(){return Lr}),a.d(A,"deregisterOp",function(){return ee}),a.d(A,"registerOp",function(){return q}),a.d(A,"version_converter",function(){return Mt});var $,U,B=a(0),re=function(){return(re=Object.assign||function(ge){for(var le,ye=1,_e=arguments.length;ye<_e;ye++)for(var et in le=arguments[ye])Object.prototype.hasOwnProperty.call(le,et)&&(ge[et]=le[et]);return ge}).apply(this,arguments)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function J(ge,le,ye,_e){return new(ye||(ye=Promise))(function(et,gt){function Rt(An){try{Jn(_e.next(An))}catch(Ln){gt(Ln)}}function fn(An){try{Jn(_e.throw(An))}catch(Ln){gt(Ln)}}function Jn(An){An.done?et(An.value):new ye(function(Ln){Ln(An.value)}).then(Rt,fn)}Jn((_e=_e.apply(ge,le||[])).next())})}function R(ge,le){var ye,_e,et,gt,Rt={label:0,sent:function(){if(1&et[0])throw et[1];return et[1]},trys:[],ops:[]};return gt={next:fn(0),throw:fn(1),return:fn(2)},typeof Symbol=="function"&&(gt[Symbol.iterator]=function(){return this}),gt;function fn(Jn){return function(An){return function(Ln){if(ye)throw new TypeError("Generator is already executing.");for(;Rt;)try{if(ye=1,_e&&(et=2&Ln[0]?_e.return:Ln[0]?_e.throw||((et=_e.return)&&et.call(_e),0):_e.next)&&!(et=et.call(_e,Ln[1])).done)return et;switch(_e=0,et&&(Ln=[2&Ln[0],et.value]),Ln[0]){case 0:case 1:et=Ln;break;case 4:return Rt.label++,{value:Ln[1],done:!1};case 5:Rt.label++,_e=Ln[1],Ln=[0];continue;case 7:Ln=Rt.ops.pop(),Rt.trys.pop();continue;default:if(!(et=(et=Rt.trys).length>0&&et[et.length-1])&&(Ln[0]===6||Ln[0]===2)){Rt=0;continue}if(Ln[0]===3&&(!et||Ln[1]>et[0]&&Ln[1]<et[3])){Rt.label=Ln[1];break}if(Ln[0]===6&&Rt.label<et[1]){Rt.label=et[1],et=Ln;break}if(et&&Rt.label<et[2]){Rt.label=et[2],Rt.ops.push(Ln);break}et[2]&&Rt.ops.pop(),Rt.trys.pop();continue}Ln=le.call(ge,Rt)}catch(qn){Ln=[6,qn],_e=0}finally{ye=et=0}if(5&Ln[0])throw Ln[1];return{value:Ln[0]?Ln[1]:void 0,done:!0}}([Jn,An])}}}(function(ge){ge[ge.DT_INVALID=0]="DT_INVALID",ge[ge.DT_FLOAT=1]="DT_FLOAT",ge[ge.DT_DOUBLE=2]="DT_DOUBLE",ge[ge.DT_INT32=3]="DT_INT32",ge[ge.DT_UINT8=4]="DT_UINT8",ge[ge.DT_INT16=5]="DT_INT16",ge[ge.DT_INT8=6]="DT_INT8",ge[ge.DT_STRING=7]="DT_STRING",ge[ge.DT_COMPLEX64=8]="DT_COMPLEX64",ge[ge.DT_INT64=9]="DT_INT64",ge[ge.DT_BOOL=10]="DT_BOOL",ge[ge.DT_QINT8=11]="DT_QINT8",ge[ge.DT_QUINT8=12]="DT_QUINT8",ge[ge.DT_QINT32=13]="DT_QINT32",ge[ge.DT_BFLOAT16=14]="DT_BFLOAT16",ge[ge.DT_FLOAT_REF=101]="DT_FLOAT_REF",ge[ge.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",ge[ge.DT_INT32_REF=103]="DT_INT32_REF",ge[ge.DT_UINT8_REF=104]="DT_UINT8_REF",ge[ge.DT_INT16_REF=105]="DT_INT16_REF",ge[ge.DT_INT8_REF=106]="DT_INT8_REF",ge[ge.DT_STRING_REF=107]="DT_STRING_REF",ge[ge.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",ge[ge.DT_INT64_REF=109]="DT_INT64_REF",ge[ge.DT_BOOL_REF=110]="DT_BOOL_REF",ge[ge.DT_QINT8_REF=111]="DT_QINT8_REF",ge[ge.DT_QUINT8_REF=112]="DT_QUINT8_REF",ge[ge.DT_QINT32_REF=113]="DT_QINT32_REF",ge[ge.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF"})($||($={})),function(ge){(function(le){le[le.LEGACY=0]="LEGACY",le[le.V1=1]="V1",le[le.V2=2]="V2"})(ge.CheckpointFormatVersion||(ge.CheckpointFormatVersion={}))}(U||(U={}));var W={};function q(ge,le){var ye={tfOpName:ge,category:"custom",inputs:[],attrs:[],customExecutor:le};W[ge]=ye}function P(ge){return W[ge]}function ee(ge){delete W[ge]}function I(ge,le,ye,_e){var et=le.inputParams[ge];if(et&&et.inputIndexStart!==void 0){var gt=et.inputIndexStart,Rt=et.inputIndexEnd===0?void 0:et.inputIndexEnd===void 0?gt+1:et.inputIndexEnd;if(et.type==="tensor")return se(le.inputNames[et.inputIndexStart],ye,_e);if(et.type==="tensors")return le.inputNames.slice(gt,Rt).map(function(An){return se(An,ye,_e)});var fn=Array.prototype.slice.call(se(le.inputNames.slice(gt)[0],ye,_e).dataSync());return et.type==="number"?fn[0]:fn}var Jn=le.attrParams[ge];return Jn&&Jn.value}function se(ge,le,ye){var _e=de(ge),et=_e[0],gt=_e[1],Rt=ye.currentContextIds.find(function(fn){return!!le[K(et,fn)]});return Rt!==void 0?le[K(et,Rt)][gt]:void 0}function ie(ge,le){var ye=de(ge),_e=ye[0],et=ye[1];return[K(_e,le&&le.currentContextId),et]}function K(ge,le){return le?ge+"-"+le:ge}function de(ge){var le=ge.lastIndexOf(":");return le===-1?[ge,0]:[ge.substring(0,le),Number(ge.substring(le+1))]}function pe(ge,le){for(var ye=[],_e=0;_e<ge.length;_e+=le)ye.push(ge.slice(_e,_e+le));return ye}var Ae=Object.freeze({json:[{tfOpName:"Add",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddV2",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddN",category:"arithmetic",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"BiasAdd",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sub",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"RealDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Div",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"DivNoNan",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mul",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Maximum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}]},{tfOpName:"Minimum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}]},{tfOpName:"Pow",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SquaredDifference",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorMod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]}),Te=Object.freeze({json:[{tfOpName:"Abs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan2",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ceil",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ClipByValue",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"clip_value_min",name:"clipValueMin",type:"number"},{tfName:"clip_value_max",name:"clipValueMax",type:"number"}]},{tfOpName:"Complex",category:"basic_math",inputs:[{start:0,name:"real",type:"tensor"},{start:1,name:"imag",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ComplexAbs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Elu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Exp",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Floor",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Imag",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Neg",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Real",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Prelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"alpha",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu6",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"clipValueMin",name:"clipValueMin",type:"number",defaultValue:0},{tfName:"clipValueMax",name:"clipValueMax",type:"number",defaultValue:6}]},{tfOpName:"Selu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sigmoid",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Rsqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Square",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sign",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Round",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Expm1",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log1p",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Reciprocal",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Softplus",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Erf",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Prod",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axes",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LeakyRelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"alpha",name:"alpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]}),je=Object.freeze({json:[{tfOpName:"LoopCond",category:"control",inputs:[{start:0,name:"pred",type:"tensor"}]},{tfOpName:"Switch",category:"control",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"pred",type:"tensor"}]},{tfOpName:"Merge",category:"control",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"Enter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"frame_name",name:"frameName",type:"string"},{tfName:"is_constant",name:"isConstant",type:"bool"}]},{tfOpName:"Exit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NextIteration",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayV3",category:"control",inputs:[{start:0,name:"size",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"dynamic_size",name:"dynamicSize",type:"bool"},{tfName:"clear_after_read",name:"clearAfterRead",type:"bool"},{tfName:"identical_element_shapes",name:"identicalElementShapes",type:"bool"},{tfName:"tensor_array_name",name:"name",type:"string"}]},{tfOpName:"TensorArrayWriteV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayReadV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"},{start:1,name:"index",type:"number"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayGatherV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"},{start:1,name:"indices",type:"number[]"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"}]},{tfOpName:"TensorArrayScatterV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"},{start:1,name:"indices",type:"number[]"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArrayConcatV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"},{start:1,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape_except0",name:"elementShapeExcept0",type:"shape",notSupported:!0}]},{tfOpName:"TensorArraySplitV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"},{start:1,name:"tensor",type:"tensor"},{start:2,name:"lengths",type:"number[]"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArraySizeV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"},{start:1,name:"flowIn",type:"number"}]},{tfOpName:"TensorArrayCloseV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"}]}]}),we=Object.freeze({json:[{tfOpName:"AvgPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPoolWithArgmax",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"include_batch_in_index",name:"includeBatchInIndex",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AvgPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Conv1D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"stride",name:"stride",type:"number"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NWC"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"dilation",name:"dilation",type:"number",defaultValue:1}]},{tfOpName:"Conv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"useCudnnOnGpu",name:"useCudnnOnGpu",type:"bool"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"_FusedConv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"use_cudnn_on_gpu",name:"useCudnnOnGpu",type:"bool",defaultValue:!0},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4}]},{tfOpName:"Conv2DBackpropInput",category:"convolution",inputs:[{start:2,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:0,name:"outputShape",type:"number[]"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"DepthwiseConv2d",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"DepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"FusedDepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]}]},{tfOpName:"Conv3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]}]}),ot=Object.freeze({json:[{tfOpName:"Fill",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"},{start:1,name:"value",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"LinSpace",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"num",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"OneHot",category:"creation",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"depth",type:"number"},{start:2,name:"onValue",type:"number",defaultValue:1},{start:3,name:"offValue",type:"number",defaultValue:0}],attrs:[{tfName:"axis",name:"axis",type:"number",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ones",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"OnesLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"RandomUniform",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"minval",name:"minval",type:"number",defaultValue:0},{tfName:"maxval",name:"maxval",type:"number",defaultValue:1},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Range",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"step",type:"number",defaultValue:0}],attrs:[{tfName:"Tidx",name:"dtype",type:"dtype"}]},{tfOpName:"TruncatedNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"means",name:"mean",type:"number",defaultValue:0},{tfName:"stddev",name:"stdDev",type:"number",defaultValue:1},{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Zeros",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"ZerosLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Multinomial",category:"creation",inputs:[{start:0,name:"logits",type:"tensor"},{start:1,name:"numSamples",type:"number"}],attrs:[{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number"},{tfName:"T",name:"dtype",type:"dtype"},{tfName:"output_dtype",name:"output_dtype",type:"dtype"}]}]}),_t=Object.freeze({json:[{tfOpName:"NonMaxSuppressionV2",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV3",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV5",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"},{start:5,name:"softNmsSigma",type:"number"}]},{tfOpName:"Where",category:"dynamic",inputs:[{start:0,name:"condition",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ListDiff",category:"dynamic",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]}),Ut=Object.freeze({json:[{tfOpName:"TopKV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"k",type:"number"}],attrs:[{tfName:"sorted",name:"sorted",type:"bool"}]}]}),Xt=Object.freeze({json:[{tfOpName:"PlaceholderWithDefault",category:"graph",inputs:[{start:0,name:"default",type:"tensor"}],attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Placeholder",category:"graph",attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Const",category:"graph"},{tfOpName:"Identity",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IdentityN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Snapshot",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Rank",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Size",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Shape",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"ShapeN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Print",category:"graph",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"data",type:"tensors"}],attrs:[{tfName:"message",name:"message",type:"string"},{tfName:"first_n",name:"firstN",type:"number",notSupported:!0},{tfName:"summarize",name:"summarize",type:"number",defaultValue:3}]},{tfOpName:"NoOp",category:"graph",inputs:[]},{tfOpName:"StopGradient",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"FakeQuantWithMinMaxVars",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"min",name:"min",type:"number"},{tfName:"max",name:"max",type:"number"}]}]}),ke=Object.freeze({json:[{tfOpName:"ResizeBilinear",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ResizeNearestNeighbor",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"CropAndResize",category:"image",inputs:[{start:0,name:"image",type:"tensor"},{start:1,name:"boxes",type:"tensor"},{start:2,name:"boxInd",type:"tensor"},{start:3,name:"cropSize",type:"number[]"}],attrs:[{tfName:"method",name:"method",type:"string"},{tfName:"extrapolation_value",name:"extrapolationValue",type:"number"}]}]}),Ft=Object.freeze({json:[{tfOpName:"Equal",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NotEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Greater",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"GreaterEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Less",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LessEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalAnd",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalNot",category:"logical",inputs:[{start:0,name:"a",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalOr",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Select",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SelectV2",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]}),Gt=Object.freeze({json:[{tfOpName:"_FusedMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMulV2",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Transpose",category:"matrices",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"perm",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]}),jt=Object.freeze({json:[{tfOpName:"FusedBatchNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV2",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV3",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"LRN",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"depth_radius",name:"radius",type:"number",defaultValue:5},{tfName:"bias",name:"bias",type:"number",defaultValue:1},{tfName:"alpha",name:"alpha",type:"number",defaultValue:1},{tfName:"beta",name:"beta",type:"number",defaultValue:.5}]},{tfOpName:"Softmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"LogSoftmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"SparseToDense",category:"normalization",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!0,notSupported:!0}]}]}),Ye=Object.freeze({json:[{tfOpName:"Max",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Mean",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Min",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Sum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"All",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Any",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"ArgMax",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"ArgMin",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"Prod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]}]}),ln=Object.freeze({json:[{tfOpName:"ConcatV2",category:"slice_join",inputs:[{start:0,end:-1,name:"tensors",type:"tensors"},{start:-1,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"Concat",category:"slice_join",inputs:[{start:1,end:0,name:"tensors",type:"tensors"},{start:0,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"GatherV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"axis",type:"number",defaultValue:0}]},{tfOpName:"Gather",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0},{tfName:"validate_indices",name:"validateIndices",type:"bool",notSupported:!0}]},{tfOpName:"Reverse",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"dims",type:"bool",notSupported:!0}]},{tfOpName:"ReverseV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}]},{tfOpName:"Slice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"size",type:"number[]"}]},{tfOpName:"StridedSlice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"end",type:"number[]"},{start:3,name:"strides",type:"number[]"}],attrs:[{tfName:"begin_mask",name:"beginMask",type:"number",defaultValue:0},{tfName:"end_mask",name:"endMask",type:"number",defaultValue:0},{tfName:"new_axis_mask",name:"newAxisMask",type:"number",defaultValue:0},{tfName:"ellipsis_mask",name:"ellipsisMask",type:"number",defaultValue:0},{tfName:"shrink_axis_mask",name:"shrinkAxisMask",type:"number",defaultValue:0}]},{tfOpName:"Pack",category:"slice_join",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0}]},{tfOpName:"Unpack",category:"slice_join",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0},{tfName:"num",name:"num",type:"number",defaultValue:0,notSupported:!0}]},{tfOpName:"Tile",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"reps",type:"number[]"}]},{tfOpName:"Split",category:"slice_join",inputs:[{start:0,name:"axis",type:"number",defaultValue:0},{start:1,name:"x",type:"tensor"}],attrs:[{tfName:"num_split",name:"numOrSizeSplits",type:"number",defaultValue:1}]},{tfOpName:"SplitV",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"numOrSizeSplits",type:"number[]"},{start:2,name:"axis",type:"number",defaultValue:0}]},{tfOpName:"ScatterNd",category:"slice_join",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"shape",type:"number[]"}]},{tfOpName:"GatherNd",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}]},{tfOpName:"SparseToDense",category:"slice_join",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!1,notSupported:!0}]}]}),nn=Object.freeze({json:[{tfOpName:"FFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"RFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]},{tfOpName:"IRFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]}]}),Bt=Object.freeze({json:[{tfOpName:"Cast",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"SrcT",name:"sdtype",type:"dtype",notSupported:!0},{tfName:"DstT",name:"dtype",type:"dtype"}]},{tfOpName:"ExpandDims",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"Pad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"constant_value",name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"PadV2",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"},{start:2,name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"Reshape",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}]},{tfOpName:"Squeeze",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"axis",tfDeprecatedName:"squeeze_dims",name:"axis",type:"number[]"}]},{tfOpName:"SpaceToBatchND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"paddings",type:"number[]"}]},{tfOpName:"BatchToSpaceND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"crops",type:"number[]"}]},{tfOpName:"DepthToSpace",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"block_size",name:"blockSize",type:"number"},{tfName:"data_format",name:"dataFormat",type:"string"}]}]}),Pt=function(){function ge(){var le=[Ae,Te,je,we,ot,_t,Ut,Ft,ke,Xt,Gt,jt,Ye,ln,nn,Bt],ye=[].concat.apply([],le.map(function(_e){return _e.json}));this.opMappers=ye.reduce(function(_e,et){return _e[et.tfOpName]=et,_e},{})}return Object.defineProperty(ge,"Instance",{get:function(){return this._instance||(this._instance=new this)},enumerable:!0,configurable:!0}),ge.prototype.transformGraph=function(le,ye){var _e=this;ye===void 0&&(ye={});var et=[],gt=[],Rt=le.node.reduce(function(Nt,Ot){return Nt[Ot.name]=_e.mapNode(Ot),Ot.op.startsWith("Placeholder")&&et.push(Nt[Ot.name]),Ot.op==="Const"&&gt.push(Nt[Ot.name]),Nt},{}),fn=[],Jn=[],An={},Ln={};ye!=null&&(An=this.mapSignatureEntries(ye.inputs),Ln=this.mapSignatureEntries(ye.outputs));var qn=Object.keys(Rt);return qn.forEach(function(Nt){var Ot=Rt[Nt];Ot.inputNames.forEach(function(pn){var Ht=ie(pn)[0];Ot.inputs.push(Rt[Ht]),Rt[Ht].children.push(Ot)})}),Object.keys(Ln).length===0?qn.forEach(function(Nt){var Ot=Rt[Nt];Ot.children.length===0&&Jn.push(Ot)}):Object.keys(Ln).forEach(function(Nt){var Ot=ie(Nt)[0],pn=Rt[Ot];pn!=null&&(pn.signatureKey=Ln[Nt],Jn.push(pn))}),Object.keys(An).length>0?Object.keys(An).forEach(function(Nt){var Ot=ie(Nt)[0],pn=Rt[Ot];pn&&(pn.signatureKey=An[Nt],fn.push(pn))}):fn=et,{nodes:Rt,inputs:fn,outputs:Jn,weights:gt,placeholders:et,signature:ye}},ge.prototype.mapSignatureEntries=function(le){return Object.keys(le||{}).reduce(function(ye,_e){return ye[le[_e].name]=_e,ye},{})},ge.prototype.mapNode=function(le){var ye=P(le.op)||this.opMappers[le.op]||{};le.attr==null&&(le.attr={});var _e={name:le.name,op:le.op,category:ye.category,inputNames:(le.input||[]).map(function(et){return et.startsWith("^")?et.substr(1):et}),inputs:[],children:[],inputParams:{},attrParams:{},rawAttrs:le.attr};return ye.inputs!=null&&(_e.inputParams=ye.inputs.reduce(function(et,gt){return et[gt.name]={type:gt.type,inputIndexStart:gt.start,inputIndexEnd:gt.end},et},{})),ye.attrs!=null&&(_e.attrParams=ye.attrs.reduce(function(et,gt){var Rt=gt.type,fn=void 0;switch(gt.type){case"string":(fn=Dt(le.attr,gt.tfName,gt.defaultValue))===void 0&&gt.tfDeprecatedName&&(fn=Dt(le.attr,gt.tfDeprecatedName,gt.defaultValue));break;case"string[]":(fn=pt(le.attr,gt.tfName,gt.defaultValue))===void 0&&gt.tfDeprecatedName&&(fn=pt(le.attr,gt.tfDeprecatedName,gt.defaultValue));break;case"number":(fn=wn(le.attr,gt.tfName,gt.defaultValue||0))===void 0&&gt.tfDeprecatedName&&(fn=wn(le.attr,gt.tfDeprecatedName,gt.defaultValue));break;case"number[]":(fn=He(le.attr,gt.tfName,gt.defaultValue))===void 0&&gt.tfDeprecatedName&&(fn=He(le.attr,gt.tfDeprecatedName,gt.defaultValue));break;case"bool":(fn=St(le.attr,gt.tfName,gt.defaultValue))===void 0&&gt.tfDeprecatedName&&(fn=St(le.attr,gt.tfDeprecatedName,gt.defaultValue));break;case"bool[]":(fn=zt(le.attr,gt.tfName,gt.defaultValue))===void 0&&gt.tfDeprecatedName&&(fn=zt(le.attr,gt.tfDeprecatedName,gt.defaultValue));break;case"shape":(fn=Qe(le.attr,gt.tfName,gt.defaultValue))===void 0&&gt.tfDeprecatedName&&(fn=Qe(le.attr,gt.tfDeprecatedName,gt.defaultValue));break;case"shape[]":(fn=Lt(le.attr,gt.tfName,gt.defaultValue))===void 0&&gt.tfDeprecatedName&&(fn=Lt(le.attr,gt.tfDeprecatedName,gt.defaultValue));break;case"dtype":(fn=Hn(le.attr,gt.tfName,gt.defaultValue))===void 0&&gt.tfDeprecatedName&&(fn=Hn(le.attr,gt.tfDeprecatedName,gt.defaultValue));break;case"dtype[]":(fn=hn(le.attr,gt.tfName,gt.defaultValue))===void 0&&gt.tfDeprecatedName&&(fn=hn(le.attr,gt.tfDeprecatedName,gt.defaultValue));break;case"tensor":case"tensors":break;default:throw new Error("Unsupported param type: "+gt.type+" for op: "+le.op)}return et[gt.name]={value:fn,type:Rt},et},{})),_e},ge}();function gn(ge,le){var ye=Array.isArray(ge)?String.fromCharCode.apply(null,ge):function(_e){var et=Object(B.env)().global;if(et.atob!==void 0)return et.atob(_e);if(b!==void 0)return new b(_e,"base64").toString();throw new Error("Unable to decode base64 in this environment. Missing built-in atob() or Buffer()")}(ge);return le?ye:ye.toLowerCase()}function Dt(ge,le,ye,_e){_e===void 0&&(_e=!1);var et=ge[le];return et!=null?gn(et.s,_e):ye}function St(ge,le,ye){var _e=ge[le];return _e?_e.b:ye}function wn(ge,le,ye){var _e=ge[le]||{},et=_e.i!=null?_e.i:_e.f!=null?_e.f:ye;return typeof et=="number"?et:parseInt(et,10)}function Bn(ge){switch(typeof ge=="string"&&(ge=$[ge]),ge){case $.DT_FLOAT:return"float32";case $.DT_INT32:case $.DT_INT64:case $.DT_INT8:case $.DT_UINT8:return"int32";case $.DT_BOOL:return"bool";case $.DT_DOUBLE:return"float32";case $.DT_STRING:return"string";default:return null}}function Hn(ge,le,ye){var _e=ge[le];return _e&&_e.type?Bn(_e.type):ye}function hn(ge,le,ye){var _e=ge[le];return _e&&_e.list&&_e.list.type?_e.list.type.map(function(et){return Bn(et)}):ye}function Ve(ge){if(!ge.unknownRank)return ge.dim!=null?ge.dim.map(function(le){return typeof le.size=="number"?le.size:parseInt(le.size,10)}):[]}function Qe(ge,le,ye){var _e=ge[le];return _e&&_e.shape?Ve(_e.shape):ye}function He(ge,le,ye){var _e=ge[le];return _e?((_e.list.f&&_e.list.f.length?_e.list.f:_e.list.i)||[]).map(function(et){return typeof et=="number"?et:parseInt(et,10)}):ye}function pt(ge,le,ye,_e){_e===void 0&&(_e=!1);var et=ge[le];return et&&et.list&&et.list.s?et.list.s.map(function(gt){return gn(gt,_e)}):ye}function Lt(ge,le,ye){var _e=ge[le];return _e&&_e.list&&_e.list.shape?_e.list.shape.map(function(et){return Ve(et)}):ye}function zt(ge,le,ye){var _e=ge[le];return _e&&_e.list&&_e.list.b?_e.list.b:ye}var Tn=function(){function ge(le,ye,_e){var et=this;this.node=le,this.tensorMap=ye,this.context=_e,this.inputs=[],this.attrs={},this.inputs=le.inputNames.map(function(gt){return et.getInput(gt)}),le.rawAttrs!=null&&(this.attrs=Object.keys(le.rawAttrs).reduce(function(gt,Rt){return gt[Rt]=et.getAttr(Rt),gt},{}))}return ge.prototype.getInput=function(le){return se(le,this.tensorMap,this.context)},ge.prototype.getAttr=function(le,ye){var _e=this.node.rawAttrs[le];if(_e.tensor!=null)return se(le,this.tensorMap,this.context);if(_e.i!=null||_e.f!=null)return wn(this.node.rawAttrs,le,ye);if(_e.s!=null)return Dt(this.node.rawAttrs,le,ye);if(_e.b!=null)return St(this.node.rawAttrs,le,ye);if(_e.shape!=null)return Qe(this.node.rawAttrs,le,ye);if(_e.type!=null)return Hn(this.node.rawAttrs,le,ye);if(_e.list!=null){if(_e.list.i!=null||_e.list.f!=null)return He(this.node.rawAttrs,le,ye);if(_e.list.s!=null)return pt(this.node.rawAttrs,le,ye);if(_e.list.shape!=null)return Lt(this.node.rawAttrs,le,ye);if(_e.list.b!=null)return zt(this.node.rawAttrs,le,ye);if(_e.list.type!=null)return hn(this.node.rawAttrs,le,ye)}return ye},ge}(),xn=function(ge,le,ye){switch(ge.op){case"BiasAdd":case"AddV2":case"Add":return[Object(B.add)(I("a",ge,le,ye),I("b",ge,le,ye))];case"AddN":return[Object(B.addN)(I("tensors",ge,le,ye))];case"FloorMod":case"Mod":return[Object(B.mod)(I("a",ge,le,ye),I("b",ge,le,ye))];case"Mul":return[Object(B.mul)(I("a",ge,le,ye),I("b",ge,le,ye))];case"RealDiv":case"Div":return[Object(B.div)(I("a",ge,le,ye),I("b",ge,le,ye))];case"DivNoNan":return[Object(B.divNoNan)(I("a",ge,le,ye),I("b",ge,le,ye))];case"FloorDiv":return[Object(B.floorDiv)(I("a",ge,le,ye),I("b",ge,le,ye))];case"Sub":return[Object(B.sub)(I("a",ge,le,ye),I("b",ge,le,ye))];case"Minimum":return[Object(B.minimum)(I("a",ge,le,ye),I("b",ge,le,ye))];case"Maximum":return[Object(B.maximum)(I("a",ge,le,ye),I("b",ge,le,ye))];case"Pow":return[Object(B.pow)(I("a",ge,le,ye),I("b",ge,le,ye))];case"SquaredDifference":return[Object(B.squaredDifference)(I("a",ge,le,ye),I("b",ge,le,ye))];default:throw TypeError("Node type "+ge.op+" is not implemented")}},Kn=function(ge,le,ye){switch(ge.op){case"Abs":case"ComplexAbs":return[Object(B.abs)(I("x",ge,le,ye))];case"Acos":return[Object(B.acos)(I("x",ge,le,ye))];case"Acosh":return[Object(B.acosh)(I("x",ge,le,ye))];case"Asin":return[Object(B.asin)(I("x",ge,le,ye))];case"Asinh":return[Object(B.asinh)(I("x",ge,le,ye))];case"Atan":return[Object(B.atan)(I("x",ge,le,ye))];case"Atan2":return[Object(B.atan2)(I("x",ge,le,ye),I("y",ge,le,ye))];case"Atanh":return[Object(B.atanh)(I("x",ge,le,ye))];case"Ceil":return[Object(B.ceil)(I("x",ge,le,ye))];case"Complex":return[Object(B.complex)(I("real",ge,le,ye),I("imag",ge,le,ye))];case"Cos":return[Object(B.cos)(I("x",ge,le,ye))];case"Cosh":return[Object(B.cosh)(I("x",ge,le,ye))];case"Elu":return[Object(B.elu)(I("x",ge,le,ye))];case"Erf":return[Object(B.erf)(I("x",ge,le,ye))];case"Exp":return[Object(B.exp)(I("x",ge,le,ye))];case"Expm1":return[Object(B.expm1)(I("x",ge,le,ye))];case"Floor":return[Object(B.floor)(I("x",ge,le,ye))];case"Log":return[Object(B.log)(I("x",ge,le,ye))];case"Log1p":return[Object(B.log1p)(I("x",ge,le,ye))];case"Imag":return[Object(B.imag)(I("x",ge,le,ye))];case"Neg":return[Object(B.neg)(I("x",ge,le,ye))];case"Reciprocal":return[Object(B.reciprocal)(I("x",ge,le,ye))];case"Real":return[Object(B.real)(I("x",ge,le,ye))];case"Relu":return[Object(B.relu)(I("x",ge,le,ye))];case"Round":return[Object(B.round)(I("x",ge,le,ye))];case"Selu":return[Object(B.selu)(I("x",ge,le,ye))];case"Sigmoid":return[Object(B.sigmoid)(I("x",ge,le,ye))];case"Sin":return[Object(B.sin)(I("x",ge,le,ye))];case"Sign":return[Object(B.sign)(I("x",ge,le,ye))];case"Sinh":return[Object(B.sinh)(I("x",ge,le,ye))];case"Softplus":return[Object(B.softplus)(I("x",ge,le,ye))];case"Sqrt":return[Object(B.sqrt)(I("x",ge,le,ye))];case"Square":return[Object(B.square)(I("x",ge,le,ye))];case"Tanh":return[Object(B.tanh)(I("x",ge,le,ye))];case"Tan":return[Object(B.tan)(I("x",ge,le,ye))];case"Relu6":case"ClipByValue":return[Object(B.clipByValue)(I("x",ge,le,ye),I("clipValueMin",ge,le,ye),I("clipValueMax",ge,le,ye))];case"Rsqrt":return[Object(B.rsqrt)(se(ge.inputNames[0],le,ye))];case"Prod":return[Object(B.prod)(I("x",ge,le,ye),I("axes",ge,le,ye))];case"LeakyRelu":return[Object(B.leakyRelu)(I("x",ge,le,ye),I("alpha",ge,le,ye))];case"Prelu":return[Object(B.prelu)(I("x",ge,le,ye),I("alpha",ge,le,ye))];default:throw TypeError("Node type "+ge.op+" is not implemented")}},be=function(){function ge(le,ye,_e,et,gt,Rt,fn){this.name=le,this.dtype=ye,this.maxSize=_e,this.elementShape=et,this.identicalElementShapes=gt,this.dynamicSize=Rt,this.clearAfterRead=fn,this.tensors=[],this.closed_=!1,this.id=ge.nextId++}return Object.defineProperty(ge.prototype,"closed",{get:function(){return this.closed_},enumerable:!0,configurable:!0}),ge.prototype.clearAndClose=function(){this.tensors.forEach(function(le){return le.tensor.dispose()}),this.tensors=[],this.closed_=!0},ge.prototype.size=function(){return this.tensors.length},ge.prototype.read=function(le){if(this.closed_)throw new Error("TensorArray "+this.name+" has already been closed.");if(le<0||le>=this.tensors.length)throw new Error("Tried to read from index "+le+", but array size is: "+this.tensors.length);var ye=this.tensors[le];if(ye.cleared)throw new Error("TensorArray "+this.name+": Could not read index "+le+" twice because it was cleared after a previous read (perhaps try setting clear_after_read = false?).");return this.clearAfterRead&&(ye.cleared=!0),ye.read=!0,ye.tensor},ge.prototype.readMany=function(le){var ye=this;return le.map(function(_e){return ye.read(_e)})},ge.prototype.write=function(le,ye){if(this.closed_)throw new Error("TensorArray "+this.name+" has already been closed.");if(le<0||!this.dynamicSize&&le>=this.maxSize)throw new Error("Tried to write to index "+le+", but array is not resizeable and size is: "+this.maxSize);var _e=this.tensors[le]||{};if(ye.dtype!==this.dtype)throw new Error("TensorArray "+this.name+": Could not write to TensorArray index "+le+`,
          because the value dtype is `+ye.dtype+", but TensorArray dtype is "+this.dtype+".");if(this.size()!==0||this.elementShape!=null&&this.elementShape.length!==0||(this.elementShape=ye.shape),this.assertShapesMatchAllowUndefinedSize(this.elementShape,ye.shape,"TensorArray "+this.name+": Could not write to TensorArray index "+le+"."),_e&&_e.read)throw new Error("TensorArray "+this.name+": Could not write to TensorArray index "+le+", because it has already been read.");if(_e&&_e.written)throw new Error("TensorArray "+this.name+": Could not write to TensorArray index "+le+", because it has already been written.");_e.tensor=ye,_e.written=!0,this.tensors[le]=_e},ge.prototype.writeMany=function(le,ye){var _e=this;if(le.length!==ye.length)throw new Error("TensorArray "+this.name+": could not write multiple tensors,because the index size: "+le.length+" is not the same as tensors size: "+ye.length+".");le.forEach(function(et,gt){return _e.write(et,ye[gt])})},ge.prototype.gather=function(le,ye){if(ye&&ye!==this.dtype)throw new Error("TensorArray dtype is "+this.dtype+" but gather requested dtype "+ye);if(!le){le=[];for(var _e=0;_e<this.size();_e++)le.push(_e)}if(le.length===0)return Object(B.tensor)([],[0].concat(this.elementShape));var et=this.readMany(le);return this.assertShapesMatchAllowUndefinedSize(this.elementShape,et[0].shape,"TensorArray shape mismatch: "),Object(B.stack)(et,0)},ge.prototype.concat=function(le){if(le&&le!==this.dtype)throw new Error("TensorArray dtype is "+this.dtype+" but concat requested dtype "+le);if(this.size()===0)return Object(B.tensor)([],[0].concat(this.elementShape));for(var ye=[],_e=0;_e<this.size();_e++)ye.push(_e);var et=this.readMany(ye);return this.assertShapesMatchAllowUndefinedSize(this.elementShape,et[0].shape,"TensorArray shape mismatch: tensor array shape ("+this.elementShape+") vs first tensor shape ("+et[0].shape+")"),Object(B.concat)(et,0)},ge.prototype.scatter=function(le,ye){if(ye.dtype!==this.dtype)throw new Error("TensorArray dtype is "+this.dtype+" but tensor has dtype "+ye.dtype);if(le.length!==ye.shape[0])throw new Error("Expected len(indices) == tensor.shape[0], but saw: "+le.length+" vs. "+ye.shape[0]);var _e=Math.max.apply(Math,le);if(!this.dynamicSize&&_e>=this.maxSize)throw new Error("Max index must be < array size ("+_e+"  vs. "+this.maxSize+")");this.writeMany(le,Object(B.unstack)(ye,0))},ge.prototype.split=function(le,ye){var _e=this;if(ye.dtype!==this.dtype)throw new Error("TensorArray dtype is "+this.dtype+" but tensor has dtype "+ye.dtype);var et=0,gt=le.map(function(Ln){return et+=Ln});if(et!==ye.shape[0])throw new Error(`Expected sum of lengths to be equal to
          tensor.shape[0], but sum of lengths is
        `+et+", and tensor's shape is: "+ye.shape);if(!this.dynamicSize&&le.length!==this.maxSize)throw new Error("TensorArray's size is not equal to the size of lengths ("+this.maxSize+" vs. "+le.length+"), and the TensorArray is not marked as dynamically resizeable");var Rt=et===0?0:ye.size/et,fn=[];Object(B.tidy)(function(){ye=ye.reshape([1,et,Rt]);for(var Ln=0;Ln<le.length;++Ln){var qn=[0,Ln===0?0:gt[Ln-1],0],Nt=[1,le[Ln],Rt];fn[Ln]=Object(B.slice)(ye,qn,Nt).reshape(_e.elementShape)}return fn});for(var Jn=[],An=0;An<le.length;An++)Jn[An]=An;this.writeMany(Jn,fn)},ge.prototype.assertShapesMatchAllowUndefinedSize=function(le,ye,_e){_e===void 0&&(_e=""),B.util.assert(this.shapesEqualAllowUndefinedSize(le,ye),function(){return _e+" Shapes "+le+" and "+ye+" must match"})},ge.prototype.shapesEqualAllowUndefinedSize=function(le,ye){if(le.length!==ye.length)return!1;for(var _e=0;_e<le.length;_e++)if(le[_e]!==-1&&ye[_e]!==-1&&le[_e]!==ye[_e])return!1;return!0},ge.nextId=0,ge}(),Yn=function(ge,le,ye){return J(void 0,void 0,void 0,function(){var _e,et,gt,Rt,fn,Jn,An,Ln,qn,Nt,Ot,pn,Ht,Ue,Mn,Gn,Zn,ir,zr,vr,pi,fo,ui,Zi,Ti,qr,jr,jn,ri,Vi,Rr,ao,yo,eo,bo;return R(this,function(Na){switch(Na.label){case 0:switch(ge.op){case"LoopCond":return[3,1];case"Switch":return[3,2];case"Merge":return[3,4];case"Enter":return[3,5];case"Exit":return[3,6];case"NextIteration":return[3,7];case"TensorArrayV3":return[3,8];case"TensorArrayWriteV3":return[3,9];case"TensorArrayReadV3":return[3,10];case"TensorArrayGatherV3":return[3,11];case"TensorArrayScatterV3":return[3,12];case"TensorArrayConcatV3":return[3,13];case"TensorArraySplitV3":return[3,14];case"TensorArraySizeV3":return[3,15];case"TensorArrayCloseV3":return[3,16]}return[3,17];case 1:return[2,[I("pred",ge,le,ye).clone()]];case 2:return _e=I("pred",ge,le,ye),et=I("data",ge,le,ye),[4,_e.data()];case 3:return[2,Na.sent()[0]?[void 0,et.clone()]:[et.clone(),void 0]];case 4:return[2,(gt=ge.inputNames.find(function(vs){return se(vs,le,ye)!==void 0}))?[se(gt,le,ye).clone()]:void 0];case 5:return Rt=I("frameName",ge,le,ye),fn=I("tensor",ge,le,ye),ye.enterFrame(Rt),[2,[fn.clone()]];case 6:return Jn=I("tensor",ge,le,ye),ye.exitFrame(),[2,[Jn.clone()]];case 7:return An=I("tensor",ge,le,ye),ye.nextIteration(),[2,[An.clone()]];case 8:return Ln=I("size",ge,le,ye),qn=I("dtype",ge,le,ye),Nt=I("elementShape",ge,le,ye),Ot=I("dynamicSize",ge,le,ye),pn=I("clearAfterRead",ge,le,ye),Ht=I("identicalElementShapes",ge,le,ye),Ue=I("name",ge,le,ye),Mn=new be(Ue,qn,Ln,Nt,Ht,Ot,pn),ye.addTensorArray(Mn),[2,[Object(B.scalar)(Mn.id),Object(B.scalar)(1)]];case 9:return Gn=I("tensorArrayId",ge,le,ye),Zn=I("index",ge,le,ye),ir=I("tensor",ge,le,ye),ye.getTensorArray(Gn).write(Zn,ir),[2,[Object(B.scalar)(1)]];case 10:return zr=I("tensorArrayId",ge,le,ye),vr=I("index",ge,le,ye),[2,[ye.getTensorArray(zr).read(vr)]];case 11:return pi=I("tensorArrayId",ge,le,ye),fo=I("indices",ge,le,ye),ui=I("dtype",ge,le,ye),[2,[ye.getTensorArray(pi).gather(fo,ui)]];case 12:return Zi=I("tensorArrayId",ge,le,ye),Ti=I("indices",ge,le,ye),qr=I("tensor",ge,le,ye),ye.getTensorArray(Zi).scatter(Ti,qr),[2,[Object(B.scalar)(1)]];case 13:return jr=I("tensorArrayId",ge,le,ye),jn=ye.getTensorArray(jr),ri=I("dtype",ge,le,ye),[2,[jn.concat(ri)]];case 14:return Vi=I("tensorArrayId",ge,le,ye),Rr=I("tensor",ge,le,ye),ao=I("lengths",ge,le,ye),ye.getTensorArray(Vi).split(ao,Rr),[2,[Object(B.scalar)(1)]];case 15:return yo=I("tensorArrayId",ge,le,ye),eo=ye.getTensorArray(yo),[2,[Object(B.scalar)(eo.size(),"int32")]];case 16:return bo=I("tensorArrayId",ge,le,ye),ye.getTensorArray(bo).clearAndClose(),[2,[Object(B.scalar)(0)]];case 17:throw TypeError("Node type "+ge.op+" is not implemented")}})})},Dr=function(ge,le,ye){switch(ge.op){case"Conv1D":var _e=I("stride",ge,le,ye),et=I("pad",ge,le,ye),gt=I("dataFormat",ge,le,ye).toUpperCase(),Rt=I("dilation",ge,le,ye);return[Object(B.conv1d)(I("x",ge,le,ye),I("filter",ge,le,ye),_e,et,gt,Rt)];case"Conv2D":_e=I("strides",ge,le,ye),et=I("pad",ge,le,ye),gt=I("dataFormat",ge,le,ye).toUpperCase();var fn=I("dilations",ge,le,ye);return[Object(B.conv2d)(I("x",ge,le,ye),I("filter",ge,le,ye),[_e[1],_e[2]],et,gt,[fn[1],fn[2]])];case"_FusedConv2D":case"FusedDepthwiseConv2dNative":var Jn=I("fusedOps",ge,le,ye),An=Jn[0],Ln=Jn[1],qn=An==="biasadd",Nt=Ln==="prelu",Ot=An==="fusedbatchnorm",pn=I("numArgs",ge,le,ye);if(qn){if(Nt&&pn!==2)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!Nt&&pn!==1)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd must have one extra argument: bias.")}if(Ot)throw new Error("FusedConv2d and DepthwiseConv2d with FusedBatchNorm is not supported.");_e=I("strides",ge,le,ye),et=I("pad",ge,le,ye),gt=I("dataFormat",ge,le,ye).toUpperCase(),fn=I("dilations",ge,le,ye);var Ht=I("args",ge,le,ye),Ue=Ht[0],Mn=Ht[1];return[(ge.op==="_FusedConv2D"?B.fused.conv2d:B.fused.depthwiseConv2d)({x:I("x",ge,le,ye),filter:I("filter",ge,le,ye),strides:[_e[1],_e[2]],pad:et,dataFormat:gt,dilations:[fn[1],fn[2]],bias:Ue,activation:Ln,preluActivationWeights:Mn})];case"Conv2DBackpropInput":case"Conv2dTranspose":var Gn=I("outputShape",ge,le,ye);return _e=I("strides",ge,le,ye),et=I("pad",ge,le,ye),[Object(B.conv2dTranspose)(I("x",ge,le,ye),I("filter",ge,le,ye),Gn,[_e[1],_e[2]],et)];case"DepthwiseConv2dNative":case"DepthwiseConv2d":return _e=I("strides",ge,le,ye),et=I("pad",ge,le,ye),fn=I("dilations",ge,le,ye),gt=I("dataFormat",ge,le,ye).toUpperCase(),[Object(B.depthwiseConv2d)(I("input",ge,le,ye),I("filter",ge,le,ye),[_e[1],_e[2]],et,gt,[fn[1],fn[2]])];case"Conv3D":return _e=I("strides",ge,le,ye),et=I("pad",ge,le,ye),gt=I("dataFormat",ge,le,ye).toUpperCase(),fn=I("dilations",ge,le,ye),[Object(B.conv3d)(I("x",ge,le,ye),I("filter",ge,le,ye),[_e[1],_e[2],_e[3]],et,gt,[fn[1],fn[2],fn[3]])];case"AvgPool":_e=I("strides",ge,le,ye),et=I("pad",ge,le,ye);var Zn=I("kernelSize",ge,le,ye);return[Object(B.avgPool)(I("x",ge,le,ye),[Zn[1],Zn[2]],[_e[1],_e[2]],et)];case"MaxPool":return _e=I("strides",ge,le,ye),et=I("pad",ge,le,ye),Zn=I("kernelSize",ge,le,ye),[Object(B.maxPool)(I("x",ge,le,ye),[Zn[1],Zn[2]],[_e[1],_e[2]],et)];case"MaxPoolWithArgmax":_e=I("strides",ge,le,ye),et=I("pad",ge,le,ye),Zn=I("kernelSize",ge,le,ye);var ir=I("includeBatchInIndex",ge,le,ye),zr=Object(B.maxPoolWithArgmax)(I("x",ge,le,ye),[Zn[1],Zn[2]],[_e[1],_e[2]],et,ir);return[zr.result,zr.indexes];case"AvgPool3D":return _e=I("strides",ge,le,ye),et=I("pad",ge,le,ye),Zn=I("kernelSize",ge,le,ye),[Object(B.avgPool3d)(I("x",ge,le,ye),[Zn[1],Zn[2],Zn[3]],[_e[1],_e[2],_e[3]],et)];case"MaxPool3D":return _e=I("strides",ge,le,ye),et=I("pad",ge,le,ye),Zn=I("kernelSize",ge,le,ye),[Object(B.maxPool3d)(I("x",ge,le,ye),[Zn[1],Zn[2],Zn[3]],[_e[1],_e[2],_e[3]],et)];default:throw TypeError("Node type "+ge.op+" is not implemented")}},pr=function(ge,le,ye){switch(ge.op){case"Fill":var _e=I("shape",ge,le,ye),et=I("dtype",ge,le,ye),gt=I("value",ge,le,ye);return[Object(B.fill)(_e,gt,et)];case"LinSpace":var Rt=I("start",ge,le,ye),fn=I("stop",ge,le,ye),Jn=I("num",ge,le,ye);return[Object(B.linspace)(Rt,fn,Jn)];case"Multinomial":var An=I("logits",ge,le,ye),Ln=I("numSamples",ge,le,ye),qn=I("seed",ge,le,ye);return[Object(B.multinomial)(An,Ln,qn)];case"OneHot":var Nt=I("indices",ge,le,ye),Ot=I("depth",ge,le,ye),pn=I("onValue",ge,le,ye),Ht=I("offValue",ge,le,ye);return[Object(B.oneHot)(Nt,Ot,pn,Ht)];case"Ones":return[Object(B.ones)(I("shape",ge,le,ye),I("dtype",ge,le,ye))];case"OnesLike":return[Object(B.onesLike)(I("x",ge,le,ye))];case"RandomUniform":return[Object(B.randomUniform)(I("shape",ge,le,ye),I("minval",ge,le,ye),I("maxval",ge,le,ye),I("dtype",ge,le,ye))];case"Range":Rt=I("start",ge,le,ye);var Ue=I("stop",ge,le,ye),Mn=I("step",ge,le,ye);return[Object(B.range)(Rt,Ue,Mn,I("dtype",ge,le,ye))];case"TruncatedNormal":_e=I("shape",ge,le,ye);var Gn=I("mean",ge,le,ye),Zn=I("stdDev",ge,le,ye);return qn=I("seed",ge,le,ye),[Object(B.truncatedNormal)(_e,Gn,Zn,I("dtype",ge,le,ye),qn)];case"Zeros":return[Object(B.zeros)(I("shape",ge,le,ye),I("dtype",ge,le,ye))];case"ZerosLike":return[Object(B.zerosLike)(I("x",ge,le,ye))];default:throw TypeError("Node type "+ge.op+" is not implemented")}},Nr=function(ge,le,ye){return J(void 0,void 0,void 0,function(){var _e,et,gt,Rt,fn,Jn,An,Ln;return R(this,function(qn){switch(qn.label){case 0:switch(ge.op){case"NonMaxSuppressionV5":case"NonMaxSuppressionV3":case"NonMaxSuppressionV2":return[3,1];case"Where":return[3,5];case"ListDiff":return[3,7]}return[3,8];case 1:return _e=I("boxes",ge,le,ye),et=I("scores",ge,le,ye),gt=I("maxOutputSize",ge,le,ye),Rt=I("iouThreshold",ge,le,ye),fn=I("scoreThreshold",ge,le,ye),ge.op!=="NonMaxSuppressionV5"?[3,3]:(Jn=I("softNmsSigma",ge,le,ye),[4,B.image.nonMaxSuppressionWithScoreAsync(_e,et,gt,Rt,fn,Jn)]);case 2:return[2,[(Ln=qn.sent()).selectedIndices,Ln.selectedScores]];case 3:return[4,B.image.nonMaxSuppressionAsync(_e,et,gt,Rt,fn)];case 4:return[2,[qn.sent()]];case 5:return An=I("condition",ge,le,ye).asType("bool"),[4,Object(B.whereAsync)(An)];case 6:return Ln=[qn.sent()],An.dispose(),[2,Ln];case 7:return[2,Object(B.setdiff1dAsync)(I("x",ge,le,ye),I("y",ge,le,ye))];case 8:throw TypeError("Node type "+ge.op+" is not implemented")}})})},Fr=function(ge,le,ye){switch(ge.op){case"TopKV2":var _e=I("x",ge,le,ye),et=I("k",ge,le,ye),gt=I("sorted",ge,le,ye),Rt=Object(B.topk)(_e,et,gt);return[Rt.values,Rt.indices];default:throw TypeError("Node type "+ge.op+" is not implemented")}},an=function(ge,le,ye){switch(ge.op){case"Const":return le[ge.name];case"PlaceholderWithDefault":var _e=I("default",ge,le,ye);return[se(ge.name,le,ye)||_e];case"Placeholder":return[se(ge.name,le,ye)];case"Identity":case"StopGradient":case"FakeQuantWithMinMaxVars":return[I("x",ge,le,ye).clone()];case"IdentityN":return I("x",ge,le,ye).map(function(An){return An.clone()});case"Snapshot":return[I("x",ge,le,ye).clone()];case"Shape":return[Object(B.tensor1d)(I("x",ge,le,ye).shape,"int32")];case"ShapeN":return I("x",ge,le,ye).map(function(An){return Object(B.tensor1d)(An.shape)});case"Size":return[Object(B.scalar)(I("x",ge,le,ye).size,"int32")];case"Rank":return[Object(B.scalar)(I("x",ge,le,ye).rank,"int32")];case"NoOp":return[Object(B.scalar)(1)];case"Print":var et=I("x",ge,le,ye),gt=I("data",ge,le,ye),Rt=I("message",ge,le,ye),fn=I("summarize",ge,le,ye);console.warn("The graph has a tf.print() operation,usually used for debugging, which slows down performance."),console.log(Rt);for(var Jn=0;Jn<gt.length;Jn++)console.log(Array.prototype.slice.call(gt[Jn].dataSync()).slice(0,fn));return[et];default:throw TypeError("Node type "+ge.op+" is not implemented")}},Kt=function(ge,le,ye){switch(ge.op){case"ResizeBilinear":var _e=I("images",ge,le,ye),et=I("size",ge,le,ye),gt=I("alignCorners",ge,le,ye);return[B.image.resizeBilinear(_e,[et[0],et[1]],gt)];case"ResizeNearestNeighbor":return _e=I("images",ge,le,ye),et=I("size",ge,le,ye),gt=I("alignCorners",ge,le,ye),[B.image.resizeNearestNeighbor(_e,[et[0],et[1]],gt)];case"CropAndResize":var Rt=I("image",ge,le,ye),fn=I("boxes",ge,le,ye),Jn=I("boxInd",ge,le,ye),An=I("cropSize",ge,le,ye),Ln=I("method",ge,le,ye),qn=I("extrapolationValue",ge,le,ye);return[B.image.cropAndResize(Rt,fn,Jn,An,Ln,qn)];default:throw TypeError("Node type "+ge.op+" is not implemented")}},Zt=function(ge,le,ye){switch(ge.op){case"Equal":return[Object(B.equal)(I("a",ge,le,ye),I("b",ge,le,ye))];case"NotEqual":return[Object(B.notEqual)(I("a",ge,le,ye),I("b",ge,le,ye))];case"Greater":return[Object(B.greater)(I("a",ge,le,ye),I("b",ge,le,ye))];case"GreaterEqual":return[Object(B.greaterEqual)(I("a",ge,le,ye),I("b",ge,le,ye))];case"Less":return[Object(B.less)(I("a",ge,le,ye),I("b",ge,le,ye))];case"LessEqual":return[Object(B.lessEqual)(I("a",ge,le,ye),I("b",ge,le,ye))];case"LogicalAnd":return[Object(B.logicalAnd)(I("a",ge,le,ye),I("b",ge,le,ye))];case"LogicalNot":return[Object(B.logicalNot)(I("a",ge,le,ye))];case"LogicalOr":return[Object(B.logicalOr)(I("a",ge,le,ye),I("b",ge,le,ye))];case"Select":case"SelectV2":return[Object(B.where)(I("condition",ge,le,ye),I("a",ge,le,ye),I("b",ge,le,ye))];default:throw TypeError("Node type "+ge.op+" is not implemented")}},$n=function(ge,le,ye){switch(ge.op){case"BatchMatMul":case"BatchMatMulV2":case"MatMul":return[Object(B.matMul)(I("a",ge,le,ye),I("b",ge,le,ye),I("transposeA",ge,le,ye),I("transposeB",ge,le,ye))];case"Transpose":return[Object(B.transpose)(I("x",ge,le,ye),I("perm",ge,le,ye))];case"_FusedMatMul":var _e=I("fusedOps",ge,le,ye),et=_e[0],gt=_e[1],Rt=et==="biasadd",fn=gt==="prelu",Jn=I("numArgs",ge,le,ye);if(Rt){if(fn&&Jn!==2)throw new Error("Fused MatMul with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!fn&&Jn!==1)throw new Error("Fused MatMul with BiasAdd must have one extra argument: bias.")}var An=I("args",ge,le,ye),Ln=An[0],qn=An[1];return[B.fused.matMul({a:I("a",ge,le,ye),b:I("b",ge,le,ye),transposeA:I("transposeA",ge,le,ye),transposeB:I("transposeB",ge,le,ye),bias:Ln,activation:gt,preluActivationWeights:qn})];default:throw TypeError("Node type "+ge.op+" is not implemented")}},Dn=function(ge,le,ye){switch(ge.op){case"FusedBatchNorm":case"FusedBatchNormV2":case"FusedBatchNormV3":return[Object(B.batchNorm)(I("x",ge,le,ye),I("mean",ge,le,ye),I("variance",ge,le,ye),I("offset",ge,le,ye),I("scale",ge,le,ye),I("epsilon",ge,le,ye))];case"LRN":return[Object(B.localResponseNormalization)(I("x",ge,le,ye),I("radius",ge,le,ye),I("bias",ge,le,ye),I("alpha",ge,le,ye),I("beta",ge,le,ye))];case"Softmax":return[Object(B.softmax)(I("x",ge,le,ye))];case"LogSoftmax":return[Object(B.logSoftmax)(I("x",ge,le,ye))];case"SparseToDense":return[Object(B.sparseToDense)(I("sparseIndices",ge,le,ye),I("outputShape",ge,le,ye),I("sparseValues",ge,le,ye),I("defaultValue",ge,le,ye))];default:throw TypeError("Node type "+ge.op+" is not implemented")}},hr=function(ge,le,ye){switch(ge.op){case"Max":var _e=I("axis",ge,le,ye),et=I("keepDims",ge,le,ye);return[Object(B.max)(I("x",ge,le,ye),_e,et)];case"Mean":return _e=I("axis",ge,le,ye),et=I("keepDims",ge,le,ye),[Object(B.mean)(I("x",ge,le,ye),_e,et)];case"Min":return _e=I("axis",ge,le,ye),et=I("keepDims",ge,le,ye),[Object(B.min)(I("x",ge,le,ye),_e,et)];case"Sum":return _e=I("axis",ge,le,ye),et=I("keepDims",ge,le,ye),[Object(B.sum)(I("x",ge,le,ye),_e,et)];case"All":return _e=I("axis",ge,le,ye),et=I("keepDims",ge,le,ye),[Object(B.all)(I("x",ge,le,ye),_e,et)];case"Any":return _e=I("axis",ge,le,ye),et=I("keepDims",ge,le,ye),[Object(B.any)(I("x",ge,le,ye),_e,et)];case"ArgMax":return _e=I("axis",ge,le,ye),[Object(B.argMax)(I("x",ge,le,ye),_e)];case"ArgMin":return _e=I("axis",ge,le,ye),[Object(B.argMin)(I("x",ge,le,ye),_e)];case"Prod":return _e=I("axis",ge,le,ye),et=I("keepDims",ge,le,ye),[Object(B.prod)(I("x",ge,le,ye),_e,et)];default:throw TypeError("Node type "+ge.op+" is not implemented")}},wr=function(ge,le,ye){switch(ge.op){case"ConcatV2":case"Concat":var _e=I("n",ge,le,ye),et=I("axis",ge,le,ye),gt=I("tensors",ge,le,ye);return gt=gt.slice(0,_e),[Object(B.concat)(gt,et)];case"GatherV2":case"Gather":et=I("axis",ge,le,ye);var Rt=I("x",ge,le,ye),fn=I("indices",ge,le,ye);return[Object(B.gather)(Rt,fn.asType("int32"),et)];case"ReverseV2":case"Reverse":return et=I("axis",ge,le,ye),Rt=I("x",ge,le,ye),[Object(B.reverse)(Rt,et)];case"Slice":var Jn=I("begin",ge,le,ye),An=I("size",ge,le,ye);return[Object(B.slice)(I("x",ge,le,ye),Jn,An)];case"StridedSlice":Jn=I("begin",ge,le,ye);var Ln=I("end",ge,le,ye),qn=I("strides",ge,le,ye),Nt=I("beginMask",ge,le,ye),Ot=I("endMask",ge,le,ye),pn=I("ellipsisMask",ge,le,ye),Ht=I("newAxisMask",ge,le,ye),Ue=I("shrinkAxisMask",ge,le,ye),Mn=I("x",ge,le,ye);if(Jn.length===1&&Mn.shape.length>1)for(var Gn=1;Gn<Mn.shape.length;Gn++)Jn.push(0),Ln.push(Mn.shape[Gn]),qn.push(qn[0]);return[Object(B.stridedSlice)(Mn,Jn,Ln,qn,Nt,Ot,pn,Ht,Ue)];case"Pack":return Object(B.tidy)(function(){var Zi=I("axis",ge,le,ye),Ti=I("tensors",ge,le,ye),qr=Ti[0].shape,jr=Ti[0].squeeze().shape,jn=Ti.map(function(ri){var Vi=B.util.arraysEqual(ri.shape,qr);if(!Vi&&!B.util.arraysEqual(ri.squeeze().shape,jr))throw new Error("the input tensors shape does not match");return Vi?ri:ri.reshape(qr)});return[Object(B.stack)(jn,Zi)]});case"Unpack":return Object(B.tidy)(function(){var Zi=I("axis",ge,le,ye),Ti=I("tensor",ge,le,ye);return Object(B.unstack)(Ti,Zi)});case"Tile":var Zn=I("reps",ge,le,ye);return[Object(B.tile)(I("x",ge,le,ye),Zn)];case"Split":case"SplitV":et=I("axis",ge,le,ye);var ir=I("numOrSizeSplits",ge,le,ye);return Object(B.split)(I("x",ge,le,ye),ir,et);case"ScatterNd":fn=I("indices",ge,le,ye);var zr=I("values",ge,le,ye),vr=I("shape",ge,le,ye);return[Object(B.scatterND)(fn,zr,vr)];case"GatherNd":var pi=I("x",ge,le,ye);return fn=I("indices",ge,le,ye),[Object(B.gatherND)(pi,fn)];case"SparseToDense":fn=I("sparseIndices",ge,le,ye),vr=I("outputShape",ge,le,ye);var fo=I("sparseValues",ge,le,ye),ui=I("defaultValue",ge,le,ye);return[Object(B.sparseToDense)(fn,fo,vr,fo.dtype===ui.dtype?ui:ui.asType(fo.dtype))];default:throw TypeError("Node type "+ge.op+" is not implemented")}},gr=function(ge,le,ye){switch(ge.op){case"FFT":return[Object(B.fft)(I("x",ge,le,ye))];case"IFFT":return[Object(B.ifft)(I("x",ge,le,ye))];case"RFFT":return[Object(B.rfft)(I("x",ge,le,ye))];case"IRFFT":return[Object(B.irfft)(I("x",ge,le,ye))];default:throw TypeError("Node type "+ge.op+" is not implemented")}},Qr=function(ge,le,ye){switch(ge.op){case"Cast":return[Object(B.cast)(I("x",ge,le,ye),I("dtype",ge,le,ye))];case"ExpandDims":var _e=I("axis",ge,le,ye);return[Object(B.expandDims)(I("x",ge,le,ye),_e)];case"Squeeze":return _e=I("axis",ge,le,ye),[Object(B.squeeze)(I("x",ge,le,ye),_e)];case"Reshape":return[Object(B.reshape)(I("x",ge,le,ye),I("shape",ge,le,ye))];case"PadV2":case"Pad":return[Object(B.pad)(I("x",ge,le,ye),pe(I("padding",ge,le,ye),2),I("constantValue",ge,le,ye))];case"SpaceToBatchND":var et=I("blockShape",ge,le,ye),gt=pe(I("paddings",ge,le,ye),2);return[Object(B.spaceToBatchND)(I("x",ge,le,ye),et,gt)];case"BatchToSpaceND":et=I("blockShape",ge,le,ye);var Rt=pe(I("crops",ge,le,ye),2);return[Object(B.batchToSpaceND)(I("x",ge,le,ye),et,Rt)];case"DepthToSpace":var fn=I("blockSize",ge,le,ye),Jn=I("dataFormat",ge,le,ye).toUpperCase();return[Object(B.depthToSpace)(I("x",ge,le,ye),fn,Jn)];default:throw TypeError("Node type "+ge.op+" is not implemented")}};function ti(ge,le,ye){var _e=function(et,gt,Rt){switch(et.category){case"arithmetic":return Object(B.tidy)(function(){return xn(et,gt,Rt)});case"basic_math":return Object(B.tidy)(function(){return Kn(et,gt,Rt)});case"control":return Yn(et,gt,Rt);case"convolution":return Object(B.tidy)(function(){return Dr(et,gt,Rt)});case"creation":return Object(B.tidy)(function(){return pr(et,gt,Rt)});case"dynamic":return Nr(et,gt,Rt);case"evaluation":return Object(B.tidy)(function(){return Fr(et,gt,Rt)});case"image":return Object(B.tidy)(function(){return Kt(et,gt,Rt)});case"graph":return Object(B.tidy)(function(){return an(et,gt,Rt)});case"logical":return Object(B.tidy)(function(){return Zt(et,gt,Rt)});case"matrices":return Object(B.tidy)(function(){return $n(et,gt,Rt)});case"normalization":return Object(B.tidy)(function(){return Dn(et,gt,Rt)});case"reduction":return Object(B.tidy)(function(){return hr(et,gt,Rt)});case"slice_join":return Object(B.tidy)(function(){return wr(et,gt,Rt)});case"spectral":return Object(B.tidy)(function(){return gr(et,gt,Rt)});case"transformation":return Object(B.tidy)(function(){return Qr(et,gt,Rt)});case"custom":var fn=P(et.op);if(fn&&fn.customExecutor)return fn.customExecutor(new Tn(et,gt,Rt));throw TypeError("Custom op "+et.op+" is not registered.");default:throw TypeError("Unknown op '"+et.op+"'. File an issue at https://github.com/tensorflow/tfjs/issues so we can add it, or register a custom execution with tf.registerOp()")}}(ge,le,ye);return _e instanceof Promise?_e.then(function(et){return[].concat(et)}):[].concat(_e)}var Mr=function(){function ge(le,ye){this.weightMap=le,this.tensorArrayMap=ye,this.rootContext={id:0,frameName:"",iterationId:0},this.contexts=[this.rootContext],this.lastId=0,this.generateCurrentContextIds()}return ge.prototype.newFrame=function(le,ye){return{id:le,frameName:ye,iterationId:0}},Object.defineProperty(ge.prototype,"currentContext",{get:function(){return this.contexts},set:function(le){this.contexts!==le&&(this.contexts=le,this.generateCurrentContextIds())},enumerable:!0,configurable:!0}),Object.defineProperty(ge.prototype,"currentContextId",{get:function(){return this._currentContextIds[0]},enumerable:!0,configurable:!0}),Object.defineProperty(ge.prototype,"currentContextIds",{get:function(){return this._currentContextIds},enumerable:!0,configurable:!0}),ge.prototype.generateCurrentContextIds=function(){for(var le=[],ye=0;ye<this.contexts.length-1;ye++){var _e=this.contexts.slice(0,this.contexts.length-ye);le.push(this.contextIdforContexts(_e))}le.push(""),this._currentContextIds=le},ge.prototype.contextIdforContexts=function(le){return le?le.map(function(ye){return ye.id===0&&ye.iterationId===0?"":ye.frameName+"-"+ye.iterationId}).join("/"):""},ge.prototype.enterFrame=function(le){this.contexts&&(this.lastId++,this.contexts=this.contexts.slice(),this.contexts.push(this.newFrame(this.lastId,le)),this._currentContextIds.unshift(this.contextIdforContexts(this.contexts)))},ge.prototype.exitFrame=function(){if(!(this.contexts&&this.contexts.length>1))throw new Error("Cannot exit frame, the context is empty");this.contexts=this.contexts.slice(),this.contexts.splice(-1),this.currentContextIds.shift()},ge.prototype.nextIteration=function(){if(!(this.contexts&&this.contexts.length>0))throw new Error("Cannot increase frame iteration, the context is empty");this.contexts=this.contexts.slice(),this.lastId++;var le=Object.assign({},this.contexts[this.contexts.length-1]);le.iterationId+=1,le.id=this.lastId,this.contexts.splice(-1,1,le),this._currentContextIds.splice(0,1,this.contextIdforContexts(this.contexts))},ge.prototype.getWeight=function(le){return this.weightMap[le]},ge.prototype.addTensorArray=function(le){this.tensorArrayMap[le.id]=le},ge.prototype.getTensorArray=function(le){return this.tensorArrayMap[le]},ge}();function di(ge,le,ye){for(var _e=new Set,et=[],gt=null,Rt=null,fn=new Set,Jn=Object.keys(ge).map(function(qn){return de(qn)[0]}),An=le.slice();An.length>0;){var Ln=An.pop();(fi(Ln)||oi(Ln))&&gt==null&&(Rt=(gt=Ln).children.map(function(qn){return qn.name}).filter(function(qn){return _e.has(qn)})),_e.add(Ln.name),ye[Ln.name]==null&&Jn.indexOf(Ln.name)===-1&&(Ln.inputs.length!==0?Ln.inputs.forEach(function(qn){fn.has(qn.name)||(fn.add(qn.name),An.push(qn))}):et.push(Ln.name))}return{inputs:ge,outputs:le,usedNodes:_e,missingInputs:et,dynamicNode:gt,syncInputs:Rt}}var Yr=["Switch","Merge","Enter","Exit","NextIteration"],Xr=["NonMaxSuppressionV2","NonMaxSuppressionV3","NonMaxSuppressionV5","Where"];function fi(ge){return Yr.indexOf(ge.op)>=0}function oi(ge){return Xr.indexOf(ge.op)>=0}var Ao=function(){function ge(le){this.graph=le,this.compiledMap=new Map,this._weightMap={},this.SEPERATOR=",",this._outputs=le.outputs,this._inputs=le.inputs,this._signature=le.signature}return Object.defineProperty(ge.prototype,"weightMap",{get:function(){return this._weightMap},set:function(le){var ye=Object.keys(le).map(function(_e){return le[_e].map(function(et){return et.id})});this.weightIds=[].concat.apply([],ye),this._weightMap=le},enumerable:!0,configurable:!0}),Object.defineProperty(ge.prototype,"inputs",{get:function(){return this._inputs.map(function(le){return{name:le.name,shape:le.attrParams.shape?le.attrParams.shape.value:void 0,dtype:le.attrParams.dtype?le.attrParams.dtype.value:void 0}})},enumerable:!0,configurable:!0}),Object.defineProperty(ge.prototype,"outputs",{get:function(){return this._outputs.map(function(le){return{name:le.name,shape:le.attrParams.shape?le.attrParams.shape.value:void 0,dtype:le.attrParams.dtype?le.attrParams.dtype.value:void 0}})},enumerable:!0,configurable:!0}),Object.defineProperty(ge.prototype,"inputNodes",{get:function(){return this._inputs.map(function(le){return le.signatureKey||le.name})},enumerable:!0,configurable:!0}),Object.defineProperty(ge.prototype,"outputNodes",{get:function(){return this._outputs.map(function(le){return le.signatureKey||le.name})},enumerable:!0,configurable:!0}),ge.prototype.getCompilationKey=function(le,ye){var _e=le.map(function(gt){return gt.name}).sort(),et=ye.map(function(gt){return gt.name}).sort();return _e.join(this.SEPERATOR)+"--"+et.join(this.SEPERATOR)},ge.prototype.compile=function(le,ye){var _e=di(le,ye,this.weightMap),et=_e.missingInputs,gt=_e.dynamicNode,Rt=_e.syncInputs;if(gt!=null)throw new Error("This execution contains the node '"+gt.name+"', which has the dynamic op '"+gt.op+"'. Please use model.executeAsync() instead. Alternatively, to avoid the dynamic ops, specify the inputs ["+Rt+"]");if(et.length>0){var fn=ye.map(function(An){return An.name}),Jn=Object.keys(le);throw new Error("Cannot compute the outputs ["+fn+"] from the provided inputs ["+Jn+"]. Missing the following inputs: ["+et+"]")}return function(An,Ln,qn){var Nt=qn.usedNodes,Ot=qn.inputs,pn=[];Object.keys(Ot).map(function(Gn){return de(Gn)[0]}).map(function(Gn){return An.nodes[Gn]}).forEach(function(Gn){Nt.has(Gn.name)&&pn.push(Gn)}),An.weights.forEach(function(Gn){Nt.has(Gn.name)&&pn.push(Gn)});for(var Ht=new Set,Ue=[];pn.length>0;){var Mn=pn.pop();Ht.add(Mn.name),Ln[Mn.name]||Ue.push(Mn),Mn.children.forEach(function(Gn){!Ht.has(Gn.name)&&Nt.has(Gn.name)&&Gn.inputs.every(function(Zn){return Ht.has(Zn.name)})&&pn.push(Gn)})}return Ue}(this.graph,this.weightMap,_e)},ge.prototype.execute=function(le,ye){var _e=this;le=this.mapInputs(le);var et=Object.keys(le).sort();this.checkInputs(le),this.checkInputShapeAndType(le),ye=this.mapOutputs(ye),this.checkOutputs(ye);var gt=et.map(function(Ln){return _e.graph.nodes[de(Ln)[0]]}),Rt=ye.map(function(Ln){return _e.graph.nodes[de(Ln)[0]]}),fn=this.getCompilationKey(gt,Rt),Jn=this.compiledMap.get(fn);Jn==null&&(Jn=this.compile(le,Rt),this.compiledMap.set(fn,Jn));var An={};return Object(B.tidy)(function(){var Ln=new Mr(_e._weightMap,An),qn=re({},_e.weightMap);Object.keys(le).forEach(function(Mn){var Gn=de(Mn),Zn=Gn[0],ir=[];ir[Gn[1]]=le[Mn],qn[Zn]=ir});for(var Nt=_e.getFrozenTensorIds(qn),Ot={},pn=0;pn<Jn.length;pn++){var Ht=Jn[pn];if(!qn[Ht.name]){var Ue=ti(Ht,qn,Ln);if(Ue instanceof Promise)throw new Error("The execution of the op '"+Ht.op+"' returned a promise. Please use model.executeAsync() instead.");qn[Ht.name]=Ue,_e.checkTensorForDisposal(Ht.name,Ht,qn,Ln,Nt,ye,Ot)}}return ye.map(function(Mn){return se(Mn,qn,Ln)})})},ge.prototype.getFrozenTensorIds=function(le){var ye=[].concat.apply([],Object.keys(le).map(function(_e){return le[_e]}).map(function(_e){return _e.map(function(et){return et.id})}));return new Set(ye)},ge.prototype.checkTensorForDisposal=function(le,ye,_e,et,gt,Rt,fn){ye.category!=="control"&&Rt.indexOf(le)===-1&&(_e[le].forEach(function(Jn){Jn!=null&&(fn[Jn.id]=(fn[Jn.id]||0)+ye.children.length)}),ye.inputs.forEach(function(Jn){if(Jn.category!=="control"){var An=function(Ln,qn,Nt){return qn[K(Ln,Nt.currentContextId)]}(Jn.name,_e,et);An!=null&&An.forEach(function(Ln){if(Ln&&!gt.has(Ln.id)){var qn=fn[Ln.id];qn===1?(Ln.dispose(),delete fn[Ln.id]):qn!=null&&fn[Ln.id]--}})}}))},ge.prototype.executeAsync=function(le,ye){return J(this,void 0,void 0,function(){var _e,et,gt,Rt,fn,Jn,An=this;return R(this,function(Ln){switch(Ln.label){case 0:return le=this.mapInputs(le),this.checkInputs(le),this.checkInputShapeAndType(le),ye=this.mapOutputs(ye),this.checkOutputs(ye),_e={},et=new Mr(this._weightMap,_e),[4,this.executeWithControlFlow(le,et,ye)];case 1:return gt=Ln.sent(),Rt=ye.map(function(qn){return se(qn,gt,et)}),fn=new Set(Rt.map(function(qn){return qn.id})),Jn=new Set(Object.keys(le).map(function(qn){return le[qn].id})),Object.keys(gt).forEach(function(qn){gt[qn].forEach(function(Nt){!Nt||Nt.isDisposed||fn.has(Nt.id)||Jn.has(Nt.id)||An.weightIds.indexOf(Nt.id)!==-1||Nt.dispose()})}),[2,Rt]}})})},ge.prototype.executeWithControlFlow=function(le,ye,_e){return J(this,void 0,void 0,function(){var et,gt,Rt,fn,Jn,An,Ln,qn,Nt,Ot,pn,Ht,Ue,Mn,Gn,Zn,ir=this;return R(this,function(zr){switch(zr.label){case 0:et=Object.keys(le),gt=et.map(function(vr){return ir.graph.nodes[de(vr)[0]]}),Rt=_e.map(function(vr){return ir.graph.nodes[de(vr)[0]]}),fn=di(le,Rt,this.weightMap),Jn=fn.usedNodes,An=fn.missingInputs,Ln=fn.dynamicNode,qn=fn.syncInputs,Nt=gt.concat(this.graph.weights).map(function(vr){return{node:vr,contexts:ye.currentContext}}),Ot=re({},this.weightMap),Object.keys(le).forEach(function(vr){var pi=de(vr),fo=pi[0],ui=[];ui[pi[1]]=le[vr],Ot[fo]=ui}),pn={},Ht=this.getFrozenTensorIds(Ot),Ue={},zr.label=1;case 1:return Nt.length>0?(Mn=this.processStack(gt,Nt,ye,Ot,Ue,Ht,_e,pn,Jn),[4,Promise.all(Mn)]):[3,3];case 2:return zr.sent(),[3,1];case 3:if(Ln==null&&console.warn("This model execution did not contain any nodes with control flow or dynamic output shapes. You can use model.execute() instead."),(Gn=Rt.filter(function(vr){return!fi(vr)&&!se(vr.name,Ot,ye)}).map(function(vr){return vr.name})).length>0)throw Zn="",Ln!=null&&(Zn="Alternatively, to avoid the dynamic ops, use model.execute() and specify the inputs ["+qn+"]"),new Error("Cannot compute the outputs ["+Gn+"] from the provided inputs ["+et+"]. Consider providing the following inputs: ["+An+"]. "+Zn);return[2,Ot]}})})},ge.prototype.processStack=function(le,ye,_e,et,gt,Rt,fn,Jn,An){for(var Ln=this,qn=[],Nt=function(){var pn=ye.pop();_e.currentContext=pn.contexts;var Ht="";if(pn.node.op==="Enter"&&I("isConstant",pn.node,et,_e)&&(Ht=ie(pn.node.name,_e)[0]),le.indexOf(pn.node)===-1){var Ue=ti(pn.node,et,_e);Ht||(Ht=ie(pn.node.name,_e)[0]);var Mn=_e.currentContext;Ue instanceof Promise?qn.push(Ue.then(function(Gn){return et[Ht]=Gn,_e.currentContext=Mn,Ln.checkTensorForDisposal(Ht,pn.node,et,_e,Rt,fn,Jn),Ln.processChildNodes(pn.node,ye,_e,et,gt,An),Gn})):(et[Ht]=Ue,Ot.checkTensorForDisposal(Ht,pn.node,et,_e,Rt,fn,Jn),Ot.processChildNodes(pn.node,ye,_e,et,gt,An))}else Ot.processChildNodes(pn.node,ye,_e,et,gt,An)},Ot=this;ye.length>0;)Nt();return qn},ge.prototype.processChildNodes=function(le,ye,_e,et,gt,Rt){le.children.forEach(function(fn){var Jn=ie(fn.name,_e)[0];!gt[Jn]&&Rt.has(fn.name)&&(fn.op==="Merge"?fn.inputNames.some(function(An){return!!se(An,et,_e)})&&(gt[Jn]=!0,ye.push({contexts:_e.currentContext,node:fn})):fn.inputNames.every(function(An){return!!se(An,et,_e)})&&(gt[Jn]=!0,ye.push({contexts:_e.currentContext,node:fn})))})},ge.prototype.dispose=function(){var le=this;Object.keys(this.weightMap).forEach(function(ye){return le.weightMap[ye].forEach(function(_e){return _e.dispose()})})},ge.prototype.checkInputShapeAndType=function(le){var ye=this;Object.keys(le).forEach(function(_e){var et=le[_e],gt=de(_e)[0],Rt=ye.graph.nodes[gt];if(Rt.attrParams.shape&&Rt.attrParams.shape.value){var fn=Rt.attrParams.shape.value,Jn=fn.length===et.shape.length&&et.shape.every(function(An,Ln){return fn[Ln]===-1||fn[Ln]===An});B.util.assert(Jn,function(){return"The shape of dict['"+Rt.name+"'] provided in model.execute(dict) must be ["+fn+"], but was ["+et.shape+"]"})}Rt.attrParams.dtype&&Rt.attrParams.dtype.value&&B.util.assert(et.dtype===Rt.attrParams.dtype.value,function(){return"The dtype of dict['"+Rt.name+"'] provided in model.execute(dict) must be "+Rt.attrParams.dtype.value+", but was "+et.dtype})})},ge.prototype.mapInputs=function(le){var ye={};for(var _e in le)this._signature!=null&&this._signature.inputs!=null&&this._signature.inputs[_e]!=null?ye[this._signature.inputs[_e].name]=le[_e]:ye[_e]=le[_e];return ye},ge.prototype.checkInputs=function(le){var ye=this,_e=Object.keys(le).filter(function(et){var gt=de(et)[0];return ye.graph.nodes[gt]==null});if(_e.length>0)throw new Error("The dict provided in model.execute(dict) has keys: ["+_e+"] that are not part of graph")},ge.prototype.mapOutputs=function(le){var ye=this;return le.map(function(_e){return ye._signature!=null&&ye._signature.outputs!=null&&ye._signature.outputs[_e]!=null?ye._signature.outputs[_e].name:_e},{})},ge.prototype.checkOutputs=function(le){var ye=this;le.forEach(function(_e){var et=de(_e)[0];if(!ye.graph.nodes[et])throw new Error("The output '"+_e+"' is not found in the graph")})},ge}(),Wi="?tfjs-format=file",Ei="model.json",bt=function(){function ge(le,ye){ye===void 0&&(ye={}),this.modelUrl=le,this.loadOptions=ye,this.version="n/a",ye==null&&(this.loadOptions={})}return Object.defineProperty(ge.prototype,"modelVersion",{get:function(){return this.version},enumerable:!0,configurable:!0}),Object.defineProperty(ge.prototype,"inputNodes",{get:function(){return this.executor.inputNodes},enumerable:!0,configurable:!0}),Object.defineProperty(ge.prototype,"outputNodes",{get:function(){return this.executor.outputNodes},enumerable:!0,configurable:!0}),Object.defineProperty(ge.prototype,"inputs",{get:function(){return this.executor.inputs},enumerable:!0,configurable:!0}),Object.defineProperty(ge.prototype,"outputs",{get:function(){return this.executor.outputs},enumerable:!0,configurable:!0}),Object.defineProperty(ge.prototype,"weights",{get:function(){return this.executor.weightMap},enumerable:!0,configurable:!0}),ge.prototype.findIOHandler=function(){var le=this.modelUrl;if(le.load!=null)this.handler=le;else if(this.loadOptions.requestInit!=null)this.handler=B.io.browserHTTPRequest(le,this.loadOptions);else{var ye=B.io.getLoadHandlers(le,this.loadOptions.onProgress);if(ye.length===0)ye.push(B.io.browserHTTPRequest(le,this.loadOptions));else if(ye.length>1)throw new Error("Found more than one ("+ye.length+") load handlers for URL '"+[le]+"'");this.handler=ye[0]}},ge.prototype.load=function(){return J(this,void 0,void 0,function(){var le,ye,_e,et;return R(this,function(gt){switch(gt.label){case 0:if(this.findIOHandler(),this.handler.load==null)throw new Error("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");return le=this,[4,this.handler.load()];case 1:return le.artifacts=gt.sent(),ye=this.artifacts.modelTopology,_e={},this.artifacts.userDefinedMetadata!=null&&(_e=this.artifacts.userDefinedMetadata.signature),this.version=ye.versions.producer+"."+ye.versions.minConsumer,et=B.io.decodeWeights(this.artifacts.weightData,this.artifacts.weightSpecs),this.executor=new Ao(Pt.Instance.transformGraph(ye,_e)),this.executor.weightMap=this.convertTensorMapToTensorsMap(et),[2,!0]}})})},ge.prototype.save=function(le,ye){return J(this,void 0,void 0,function(){var _e;return R(this,function(et){if(typeof le=="string"){if((_e=B.io.getSaveHandlers(le)).length===0)throw new Error("Cannot find any save handlers for URL '"+le+"'");if(_e.length>1)throw new Error("Found more than one ("+_e.length+") save handlers for URL '"+le+"'");le=_e[0]}if(le.save==null)throw new Error("GraphModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");return[2,le.save(this.artifacts)]})})},ge.prototype.predict=function(le,ye){return this.execute(le,this.outputNodes)},ge.prototype.normalizeInputs=function(le){if(!(le instanceof B.Tensor||Array.isArray(le)))return le;if((le=Array.isArray(le)?le:[le]).length!==this.inputNodes.length)throw new Error("Input tensor count mismatch,the graph model has "+this.inputNodes.length+" placeholders, while there are "+le.length+" input tensors.");return this.inputNodes.reduce(function(ye,_e,et){return ye[_e]=le[et],ye},{})},ge.prototype.normalizeOutputs=function(le){return le=le||this.outputNodes,Array.isArray(le)?le:[le]},ge.prototype.execute=function(le,ye){le=this.normalizeInputs(le),ye=this.normalizeOutputs(ye);var _e=this.executor.execute(le,ye);return _e.length>1?_e:_e[0]},ge.prototype.executeAsync=function(le,ye){return J(this,void 0,void 0,function(){var _e;return R(this,function(et){switch(et.label){case 0:return le=this.normalizeInputs(le),ye=this.normalizeOutputs(ye),[4,this.executor.executeAsync(le,ye)];case 1:return[2,(_e=et.sent()).length>1?_e:_e[0]]}})})},ge.prototype.convertTensorMapToTensorsMap=function(le){return Object.keys(le).reduce(function(ye,_e){return ye[_e]=[le[_e]],ye},{})},ge.prototype.dispose=function(){this.executor.dispose()},ge}();function Lr(ge,le){return le===void 0&&(le={}),J(this,void 0,void 0,function(){var ye;return R(this,function(_e){switch(_e.label){case 0:if(ge==null)throw new Error("modelUrl in loadGraphModel() cannot be null. Please provide a url or an IOHandler that loads the model");return le==null&&(le={}),le.fromTFHub&&ge.load==null&&(ge.endsWith("/")||(ge+="/"),ge=""+ge+Ei+Wi),[4,(ye=new bt(ge,le)).load()];case 1:return _e.sent(),[2,ye]}})})}var Mt="1.7.4"}.call(this,a(92).Buffer)},function(Oe,A,a){/**
* @license
* Copyright 2017 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Object.defineProperty(A,"__esModule",{value:!0});var b=a(103);function $(ie){for(var K=ie.length,de=0,pe=0;K>0;)pe=Math.random()*K|0,de=ie[--K],ie[K]=ie[pe],ie[pe]=de}function U(ie,K){if(!ie)throw new Error(typeof K=="string"?K:K())}function B(ie,K,de){if(K===void 0&&(K=[]),de===void 0&&(de=!1),K==null&&(K=[]),Array.isArray(ie)||q(ie)&&!de)for(var pe=0;pe<ie.length;++pe)B(ie[pe],K,de);else K.push(ie);return K}function re(ie,K){if(ie===K)return!0;if(ie==null||K==null||ie.length!==K.length)return!1;for(var de=0;de<ie.length;de++)if(ie[de]!==K[de])return!1;return!0}function J(ie){return ie%1==0}function R(ie,K){var de=K.length;return U((ie=ie==null?K.map(function(pe,Ae){return Ae}):[].concat(ie)).every(function(pe){return pe>=-de&&pe<de}),function(){return"All values in axis param must be in range [-"+de+", "+de+") but got axis "+ie}),U(ie.every(function(pe){return J(pe)}),function(){return"All values in axis param must be integers but got axis "+ie}),ie.map(function(pe){return pe<0?de+pe:pe})}function W(ie,K){for(var de=0;de<ie.length;de++){var pe=ie[de];if(isNaN(pe)||!isFinite(pe))throw Error("A tensor of type "+K+" being uploaded contains "+pe+".")}}function q(ie){return ie instanceof Float32Array||ie instanceof Int32Array||ie instanceof Uint8Array}function P(ie){return typeof ie=="string"||ie instanceof String}function ee(ie){return typeof ie=="boolean"}function I(ie){return typeof ie=="number"}function se(ie,K){if(K==null||K==="float32"||K==="complex64")return new Float32Array(ie);if(K==="int32")return new Int32Array(ie);if(K==="bool")return new Uint8Array(ie);throw new Error("Unknown data type "+K)}A.shuffle=$,A.clamp=function(ie,K,de){return Math.max(ie,Math.min(K,de))},A.nearestLargerEven=function(ie){return ie%2==0?ie:ie+1},A.sum=function(ie){for(var K=0,de=0;de<ie.length;de++)K+=ie[de];return K},A.randUniform=function(ie,K){var de=Math.random();return K*de+(1-de)*ie},A.distSquared=function(ie,K){for(var de=0,pe=0;pe<ie.length;pe++){var Ae=Number(ie[pe])-Number(K[pe]);de+=Ae*Ae}return de},A.assert=U,A.assertShapesMatch=function(ie,K,de){de===void 0&&(de=""),U(re(ie,K),function(){return de+" Shapes "+ie+" and "+K+" must match"})},A.assertNonNull=function(ie){U(ie!=null,function(){return"The input to the tensor constructor must be a non-null value."})},A.flatten=B,A.sizeFromShape=function(ie){if(ie.length===0)return 1;for(var K=ie[0],de=1;de<ie.length;de++)K*=ie[de];return K},A.isScalarShape=function(ie){return ie.length===0},A.arraysEqual=re,A.isInt=J,A.tanh=function(ie){if(Math.tanh!=null)return Math.tanh(ie);if(ie===1/0)return 1;if(ie===-1/0)return-1;var K=Math.exp(2*ie);return(K-1)/(K+1)},A.sizeToSquarishShape=function(ie){var K=Math.ceil(Math.sqrt(ie));return[K,Math.ceil(ie/K)]},A.createShuffledIndices=function(ie){for(var K=new Uint32Array(ie),de=0;de<ie;++de)K[de]=de;return $(K),K},A.rightPad=function(ie,K){return K<=ie.length?ie:ie+" ".repeat(K-ie.length)},A.repeatedTry=function(ie,K,de){return K===void 0&&(K=function(pe){return 0}),new Promise(function(pe,Ae){var Te=0,je=function(){if(ie())pe();else{var we=K(++Te);de!=null&&Te>=de?Ae():setTimeout(je,we)}};je()})},A.inferFromImplicitShape=function(ie,K){for(var de=1,pe=-1,Ae=0;Ae<ie.length;++Ae)if(ie[Ae]>=0)de*=ie[Ae];else if(ie[Ae]===-1){if(pe!==-1)throw Error("Shapes can only have 1 implicit size. Found -1 at dim "+pe+" and dim "+Ae);pe=Ae}else if(ie[Ae]<0)throw Error("Shapes can not be < 0. Found "+ie[Ae]+" at dim "+Ae);if(pe===-1){if(K>0&&K!==de)throw Error("Size("+K+") must match the product of shape "+ie);return ie}if(de===0)throw Error("Cannot infer the missing size in ["+ie+"] when there are 0 elements");if(K%de!=0)throw Error("The implicit shape can't be a fractional number. Got "+K+" / "+de);var Te=ie.slice();return Te[pe]=K/de,Te},A.parseAxisParam=R,A.squeezeShape=function(ie,K){for(var de=[],pe=[],Ae=K!=null&&Array.isArray(K)&&K.length===0,Te=K==null||Ae?null:R(K,ie).sort(),je=0,we=0;we<ie.length;++we){if(Te!=null){if(Te[je]===we&&ie[we]!==1)throw new Error("Can't squeeze axis "+we+" since its dim '"+ie[we]+"' is not 1");(Te[je]==null||Te[je]>we)&&ie[we]===1&&(de.push(ie[we]),pe.push(we)),Te[je]<=we&&je++}ie[we]!==1&&(de.push(ie[we]),pe.push(we))}return{newShape:de,keptDims:pe}},A.getTypedArrayFromDType=function(ie,K){var de=null;if(ie==null||ie==="float32")de=new Float32Array(K);else if(ie==="int32")de=new Int32Array(K);else{if(ie!=="bool")throw new Error("Unknown data type "+ie);de=new Uint8Array(K)}return de},A.getArrayFromDType=function(ie,K){var de=null;if(ie==null||ie==="float32")de=new Float32Array(K);else if(ie==="int32")de=new Int32Array(K);else if(ie==="bool")de=new Uint8Array(K);else{if(ie!=="string")throw new Error("Unknown data type "+ie);de=new Array(K)}return de},A.checkConversionForErrors=W,A.isValidDtype=function(ie){return ie==="bool"||ie==="complex64"||ie==="float32"||ie==="int32"||ie==="string"},A.hasEncodingLoss=function(ie,K){return!(K==="complex64"||K==="float32"&&ie!=="complex64"||K==="int32"&&ie!=="float32"&&ie!=="complex64"||K==="bool"&&ie==="bool")},A.isTypedArray=q,A.bytesPerElement=function(ie){if(ie==="float32"||ie==="int32")return 4;if(ie==="complex64")return 8;if(ie==="bool")return 1;throw new Error("Unknown dtype "+ie)},A.bytesFromStringArray=function(ie){if(ie==null)return 0;var K=0;return ie.forEach(function(de){return K+=de.length}),K},A.isString=P,A.isBoolean=ee,A.isNumber=I,A.inferDtype=function ie(K){return Array.isArray(K)?ie(K[0]):K instanceof Float32Array?"float32":K instanceof Int32Array||K instanceof Uint8Array?"int32":I(K)?"float32":P(K)?"string":ee(K)?"bool":"float32"},A.isFunction=function(ie){return!!(ie&&ie.constructor&&ie.call&&ie.apply)},A.nearestDivisor=function(ie,K){for(var de=K;de<ie;++de)if(ie%de==0)return de;return ie},A.computeStrides=function(ie){var K=ie.length;if(K<2)return[];var de=new Array(K-1);de[K-2]=ie[K-1];for(var pe=K-3;pe>=0;--pe)de[pe]=de[pe+1]*ie[pe+1];return de},A.toTypedArray=function(ie,K,de){if(K==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(ie)&&(ie=B(ie)),de&&W(ie,K),function(Te,je){return Te instanceof Float32Array&&je==="float32"||Te instanceof Int32Array&&je==="int32"||Te instanceof Uint8Array&&je==="bool"}(ie,K))return ie;if(K==null||K==="float32"||K==="complex64")return new Float32Array(ie);if(K==="int32")return new Int32Array(ie);if(K==="bool"){for(var pe=new Uint8Array(ie.length),Ae=0;Ae<pe.length;++Ae)Math.round(ie[Ae])!==0&&(pe[Ae]=1);return pe}throw new Error("Unknown data type "+K)},A.toNestedArray=function(ie,K){if(ie.length===0)return K[0];var de=ie.reduce(function(pe,Ae){return pe*Ae});if(de===0)return[];if(de!==K.length)throw new Error("["+ie+"] does not match the input size.");return function pe(Ae,Te,je){var we=new Array;if(Te.length===1)for(var ot=Te[0],_t=0;_t<ot;_t++)we[_t]=je[Ae+_t];else{ot=Te[0];var Ut=Te.slice(1),Xt=Ut.reduce(function(ke,Ft){return ke*Ft});for(_t=0;_t<ot;_t++)we[_t]=pe(Ae+_t*Xt,Ut,je)}return we}(0,ie,K)},A.makeOnesTypedArray=function(ie,K){for(var de=se(ie,K),pe=0;pe<de.length;pe++)de[pe]=1;return de},A.makeZerosTypedArray=se,A.now=function(){return b.env().platform.now()},A.assertNonNegativeIntegerDimensions=function(ie){ie.forEach(function(K){U(Number.isInteger(K)&&K>=0,function(){return"Tensor must have a shape comprised of positive integers but got shape ["+ie+"]."})})},A.fetch=function(ie,K){return b.env().platform.fetch(ie,K)},A.encodeString=function(ie,K){return K===void 0&&(K="utf-8"),K=K||"utf-8",b.env().platform.encode(ie,K)},A.decodeString=function(ie,K){return K===void 0&&(K="utf-8"),K=K||"utf-8",b.env().platform.decode(ie,K)},A.locToIndex=function(ie,K,de){if(K===0)return 0;if(K===1)return ie[0];for(var pe=ie[ie.length-1],Ae=0;Ae<ie.length-1;++Ae)pe+=de[Ae]*ie[Ae];return pe},A.indexToLoc=function(ie,K,de){if(K===0)return[];if(K===1)return[ie];for(var pe=new Array(K),Ae=0;Ae<pe.length-1;++Ae)pe[Ae]=Math.floor(ie/de[Ae]),ie-=pe[Ae]*de[Ae];return pe[pe.length-1]=ie,pe}},function(Oe,A,a){var b=a(54),$=Math.min;Oe.exports=function(U){return U>0?$(b(U),9007199254740991):0}},function(Oe,A,a){var b=a(262),$=a(261),U=a(187),B=a(260);Oe.exports=function(re,J){return b(re)||$(re,J)||U(re,J)||B()},Oe.exports.__esModule=!0,Oe.exports.default=Oe.exports},function(Oe,A){var a=Oe.exports={version:"2.6.12"};typeof __e=="number"&&(__e=a)},function(Oe,A,a){(function(b,$){/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var U=this&&this.__awaiter||function(de,pe,Ae,Te){return new(Ae||(Ae=Promise))(function(je,we){function ot(Xt){try{Ut(Te.next(Xt))}catch(ke){we(ke)}}function _t(Xt){try{Ut(Te.throw(Xt))}catch(ke){we(ke)}}function Ut(Xt){Xt.done?je(Xt.value):new Ae(function(ke){ke(Xt.value)}).then(ot,_t)}Ut((Te=Te.apply(de,pe||[])).next())})},B=this&&this.__generator||function(de,pe){var Ae,Te,je,we,ot={label:0,sent:function(){if(1&je[0])throw je[1];return je[1]},trys:[],ops:[]};return we={next:_t(0),throw:_t(1),return:_t(2)},typeof Symbol=="function"&&(we[Symbol.iterator]=function(){return this}),we;function _t(Ut){return function(Xt){return function(ke){if(Ae)throw new TypeError("Generator is already executing.");for(;ot;)try{if(Ae=1,Te&&(je=2&ke[0]?Te.return:ke[0]?Te.throw||((je=Te.return)&&je.call(Te),0):Te.next)&&!(je=je.call(Te,ke[1])).done)return je;switch(Te=0,je&&(ke=[2&ke[0],je.value]),ke[0]){case 0:case 1:je=ke;break;case 4:return ot.label++,{value:ke[1],done:!1};case 5:ot.label++,Te=ke[1],ke=[0];continue;case 7:ke=ot.ops.pop(),ot.trys.pop();continue;default:if(!(je=(je=ot.trys).length>0&&je[je.length-1])&&(ke[0]===6||ke[0]===2)){ot=0;continue}if(ke[0]===3&&(!je||ke[1]>je[0]&&ke[1]<je[3])){ot.label=ke[1];break}if(ke[0]===6&&ot.label<je[1]){ot.label=je[1],je=ke;break}if(je&&ot.label<je[2]){ot.label=je[2],ot.ops.push(ke);break}je[2]&&ot.ops.pop(),ot.trys.pop();continue}ke=pe.call(de,ot)}catch(Ft){ke=[6,Ft],Te=0}finally{Ae=je=0}if(5&ke[0])throw ke[1];return{value:ke[0]?ke[1]:void 0,done:!0}}([Ut,Xt])}}};Object.defineProperty(A,"__esModule",{value:!0});var re,J=a(103),R=a(382),W=a(381),q=a(380),P=a(33),ee=a(74),I=a(21),se=a(21),ie=function(){function de(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null}}return de.prototype.dispose=function(){for(var pe in this.registeredVariables)this.registeredVariables[pe].dispose()},de}(),K=function(){function de(pe){this.ENV=pe,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new ie}return de.prototype.ready=function(){return U(this,void 0,void 0,function(){var pe,Ae,Te;return B(this,function(je){switch(je.label){case 0:if(this.pendingBackendInit!=null)return[2,this.pendingBackendInit.then(function(){})];if(this.backendInstance!=null)return[2];pe=this.getSortedBackends(),Ae=0,je.label=1;case 1:return Ae<pe.length?(Te=pe[Ae],[4,this.initializeBackend(Te).success]):[3,5];case 2:return je.sent()?[4,this.setBackend(Te)]:[3,4];case 3:return je.sent(),[2];case 4:return Ae++,[3,1];case 5:throw new Error("Could not initialize any backends, all backend initializations failed.")}})})},Object.defineProperty(de.prototype,"backend",{get:function(){if(this.pendingBackendInit!=null)throw new Error("Backend '"+this.backendName+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");if(this.backendInstance==null){var pe=this.initializeBackendsAndReturnBest(),Ae=pe.name;if(pe.asyncInit)throw new Error("The highest priority backend '"+Ae+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(Ae)}return this.backendInstance},enumerable:!0,configurable:!0}),de.prototype.backendNames=function(){return Object.keys(this.registryFactory)},de.prototype.findBackend=function(pe){return!(pe in this.registry)&&(!(pe in this.registryFactory)||this.initializeBackend(pe).asyncInit)?null:this.registry[pe]},de.prototype.findBackendFactory=function(pe){return pe in this.registryFactory?this.registryFactory[pe].factory:null},de.prototype.registerBackend=function(pe,Ae,Te){return Te===void 0&&(Te=1),pe in this.registryFactory?(console.warn(pe+" backend was already registered. Reusing existing backend factory."),!1):(this.registryFactory[pe]={factory:Ae,priority:Te},!0)},de.prototype.setBackend=function(pe){return U(this,void 0,void 0,function(){var Ae,Te,je;return B(this,function(we){switch(we.label){case 0:if(this.registryFactory[pe]==null)throw new Error("Backend name '"+pe+"' not found in registry");return this.backendName=pe,this.registry[pe]!=null?[3,4]:(this.backendInstance=null,Ae=this.initializeBackend(pe),Te=Ae.success,Ae.asyncInit?[4,Te]:[3,2]);case 1:return je=we.sent(),[3,3];case 2:je=Te,we.label=3;case 3:if(!je)return[2,!1];we.label=4;case 4:return this.backendInstance=this.registry[pe],this.setupRegisteredKernels(),this.profiler=new W.Profiler(this.backendInstance),[2,!0]}})})},de.prototype.setupRegisteredKernels=function(){var pe=this;R.getKernelsForBackend(this.backendName).forEach(function(Ae){Ae.setupFunc!=null&&Ae.setupFunc(pe.backendInstance)})},de.prototype.disposeRegisteredKernels=function(pe){var Ae=this;R.getKernelsForBackend(pe).forEach(function(Te){Te.disposeFunc!=null&&Te.disposeFunc(Ae.registry[pe])})},de.prototype.initializeBackend=function(pe){var Ae=this,Te=this.registryFactory[pe];if(Te==null)throw new Error("Cannot initialize backend "+pe+", no registration found.");try{var je=Te.factory();if(Promise.resolve(je)===je){var we=++this.pendingBackendInitId,ot=je.then(function(_t){return!(we<Ae.pendingBackendInitId)&&(Ae.registry[pe]=_t,Ae.pendingBackendInit=null,!0)}).catch(function(_t){return!(we<Ae.pendingBackendInitId)&&(Ae.pendingBackendInit=null,console.warn("Initialization of backend "+pe+" failed"),console.warn(_t.stack||_t.message),!1)});return this.pendingBackendInit=ot,{success:ot,asyncInit:!0}}return this.registry[pe]=je,{success:!0,asyncInit:!1}}catch(_t){return console.warn("Initialization of backend "+pe+" failed"),console.warn(_t.stack||_t.message),{success:!1,asyncInit:!1}}},de.prototype.removeBackend=function(pe){if(!(pe in this.registryFactory))throw new Error(pe+" backend not found in registry");this.backendName===pe&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,pe in this.registry&&(this.disposeRegisteredKernels(pe),this.registry[pe].dispose(),delete this.registry[pe]),delete this.registryFactory[pe],this.backendName===pe&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)},de.prototype.getSortedBackends=function(){var pe=this;if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort(function(Ae,Te){return pe.registryFactory[Te].priority-pe.registryFactory[Ae].priority})},de.prototype.initializeBackendsAndReturnBest=function(){for(var pe=this.getSortedBackends(),Ae=0;Ae<pe.length;Ae++){var Te=pe[Ae],je=this.initializeBackend(Te),we=je.success,ot=je.asyncInit;if(ot||we)return{name:Te,asyncInit:ot}}throw new Error("Could not initialize any backends, all backend initializations failed.")},de.prototype.moveData=function(pe,Ae){var Te=this.state.tensorInfo.get(Ae),je=Te.backend,we=this.readSync(Ae);je.disposeData(Ae),Te.backend=pe,pe.move(Ae,we,Te.shape,Te.dtype),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++},de.prototype.tidy=function(pe,Ae){var Te,je=this,we=null;if(Ae==null){if(typeof pe!="function")throw new Error("Please provide a function to tidy()");Ae=pe}else{if(typeof pe!="string"&&!(pe instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof Ae!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");we=pe}return this.scopedRun(function(){return je.startScope(we)},function(){return je.endScope(Te)},function(){return(Te=Ae())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),Te})},de.prototype.scopedRun=function(pe,Ae,Te){pe();try{var je=Te();return Ae(),je}catch(we){throw Ae(),we}},de.prototype.nextTensorId=function(){return de.nextTensorId++},de.prototype.nextVariableId=function(){return de.nextVariableId++},de.prototype.clone=function(pe){var Ae=this.makeTensorFromDataId(pe.dataId,pe.shape,pe.dtype),Te={x:pe};return this.addTapeNode(this.state.activeScope.name,Te,[Ae],function(je){return{x:function(){return je.toFloat()}}},[],{}),Ae},de.prototype.runKernel=function(pe,Ae,Te,je,we){return this.runKernelFunc(null,Ae,null,pe,Te,je,we)},de.prototype.shouldCheckForMemLeaks=function(){return this.ENV.getBool("IS_TEST")},de.prototype.checkKernelForMemLeak=function(pe,Ae,Te){var je=this.backend.numDataIds(),we=0;Te.forEach(function(Ut){we+=Ut.dtype==="complex64"?3:1});var ot=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],_t=je-Ae-we-ot;if(_t>0)throw new Error("Backend '"+this.backendName+"' has an internal memory leak ("+_t+" data ids) after running '"+pe+"'")},de.prototype.runKernelFunc=function(pe,Ae,Te,je,we,ot,_t){var Ut,Xt=this,ke=[],Ft=this.isTapeOn();je==null&&(je=this.state.activeScope!=null?this.state.activeScope.name:"");var Gt,jt=this.state.numBytes,Ye=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);var ln,nn=R.getKernel(je,this.backendName);if(nn!=null)Gt=function(){var Pt=Xt.backend.numDataIds();ln=nn.kernelFunc({inputs:Ae,attrs:we,backend:Xt.backend});var gn=Array.isArray(ln)?ln:[ln];Xt.shouldCheckForMemLeaks()&&Xt.checkKernelForMemLeak(je,Pt,gn);var Dt=gn.map(function(Bn){var Hn=Bn.dataId,hn=Bn.shape,Ve=Bn.dtype;return Xt.makeTensorFromDataId(Hn,hn,Ve)});if(Ft){var St=Xt.getTensorsForGradient(je,Ae,Dt);if(St==null){_t==null&&(_t=[]);var wn=Dt.filter(function(Bn,Hn){return _t[Hn]});St=(ot||[]).slice().concat(wn)}ke=Xt.saveTensorsForBackwardMode(St)}return Dt};else{var Bt=function(Pt){Ft&&(ke=Pt.map(function(gn){return Xt.keep(Xt.clone(gn))}))};Gt=function(){var Pt=Xt.backend.numDataIds();ln=Xt.tidy(function(){return pe(Xt.backend,Bt)});var gn=Array.isArray(ln)?ln:[ln];return Xt.shouldCheckForMemLeaks()&&Xt.checkKernelForMemLeak(je,Pt,gn),gn}}return this.scopedRun(function(){return Xt.state.kernelDepth++},function(){return Xt.state.kernelDepth--},function(){Ut=Xt.ENV.getBool("DEBUG")?Xt.profiler.profileKernel(je,Ae,function(){return Gt()}):Gt()}),Ft&&this.addTapeNode(je,Ae,Ut,Te,ke,we),this.state.profiling&&this.state.activeProfile.kernels.push({name:je,bytesAdded:this.state.numBytes-jt,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-Ye,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(Ae).map(function(Pt){return Ae[Pt].shape}),outputShapes:Ut.map(function(Pt){return Pt.shape})}),Array.isArray(ln)?Ut:Ut[0]},de.prototype.saveTensorsForBackwardMode=function(pe){var Ae=this;return pe.map(function(Te){return Ae.keep(Ae.clone(Te))})},de.prototype.getTensorsForGradient=function(pe,Ae,Te){var je=R.getGradient(pe);if(je!=null){var we=je.inputsToSave||[],ot=je.outputsToSave||[],_t=void 0;je.saveAllInputs?(I.assert(Array.isArray(Ae),function(){return"saveAllInputs is true, expected inputs to be an array."}),_t=Object.keys(Ae).map(function(Xt){return Ae[Xt]})):_t=we.map(function(Xt){return Ae[Xt]});var Ut=Te.filter(function(Xt,ke){return ot[ke]});return _t.concat(Ut)}return null},de.prototype.makeTensor=function(pe,Ae,Te,je){if(pe==null)throw new Error("Values passed to engine.makeTensor() are null");Te=Te||"float32",je=je||this.backend;var we=pe;Te==="string"&&I.isString(pe[0])&&(we=pe.map(function(ke){return I.encodeString(ke)}));var ot=je.write(we,Ae,Te),_t=new P.Tensor(Ae,Te,ot,this.nextTensorId());if(this.incRef(_t,je),Te==="string"){var Ut=this.state.tensorInfo.get(ot),Xt=se.bytesFromStringArray(we);this.state.numBytes+=Xt-Ut.bytes,Ut.bytes=Xt}return _t},de.prototype.makeTensorFromDataId=function(pe,Ae,Te,je){Te=Te||"float32";var we=new P.Tensor(Ae,Te,pe,this.nextTensorId());return this.incRef(we,je),we},de.prototype.makeVariable=function(pe,Ae,Te,je){Ae===void 0&&(Ae=!0),Te=Te||this.nextVariableId().toString(),je!=null&&je!==pe.dtype&&(pe=pe.asType(je));var we=new P.Variable(pe,Ae,Te,this.nextTensorId());if(this.state.registeredVariables[we.name]!=null)throw new Error("Variable with name "+we.name+" was already registered");return this.state.registeredVariables[we.name]=we,this.incRef(we,this.backend),we},de.prototype.incRef=function(pe,Ae){var Te=this.state.tensorInfo.has(pe.dataId)?this.state.tensorInfo.get(pe.dataId).refCount:0;if(this.state.numTensors++,pe.dtype==="string"&&this.state.numStringTensors++,Te===0){this.state.numDataBuffers++;var je=0;pe.dtype!=="complex64"&&pe.dtype!=="string"&&(je=pe.size*I.bytesPerElement(pe.dtype)),this.state.tensorInfo.set(pe.dataId,{backend:Ae||this.backend,dtype:pe.dtype,shape:pe.shape,bytes:je,refCount:0}),this.state.numBytes+=je}this.state.tensorInfo.get(pe.dataId).refCount++,pe instanceof P.Variable||this.track(pe)},de.prototype.disposeTensor=function(pe){if(this.state.tensorInfo.has(pe.dataId)){this.state.numTensors--,pe.dtype==="string"&&this.state.numStringTensors--;var Ae=this.state.tensorInfo.get(pe.dataId);Ae.refCount<=1?(pe.dtype!=="complex64"&&(this.state.numBytes-=Ae.bytes),this.state.numDataBuffers--,Ae.backend.disposeData(pe.dataId),this.state.tensorInfo.delete(pe.dataId)):this.state.tensorInfo.get(pe.dataId).refCount--}},de.prototype.disposeVariables=function(){for(var pe in this.state.registeredVariables){var Ae=this.state.registeredVariables[pe];this.disposeVariable(Ae)}},de.prototype.disposeVariable=function(pe){this.disposeTensor(pe),this.state.registeredVariables[pe.name]!=null&&delete this.state.registeredVariables[pe.name]},de.prototype.memory=function(){var pe=this.backend.memory();return pe.numTensors=this.state.numTensors,pe.numDataBuffers=this.state.numDataBuffers,pe.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(pe.unreliable=!0,pe.reasons==null&&(pe.reasons=[]),pe.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),pe},de.prototype.profile=function(pe){return U(this,void 0,void 0,function(){var Ae,Te;return B(this,function(je){return this.state.profiling=!0,Ae=this.state.numBytes,Te=this.state.numTensors,this.state.activeProfile.kernels=[],this.state.activeProfile.result=pe(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,this.state.activeProfile.kernels.map(function(we){return we.totalBytesSnapshot})),this.state.activeProfile.newBytes=this.state.numBytes-Ae,this.state.activeProfile.newTensors=this.state.numTensors-Te,[2,this.state.activeProfile]})})},de.prototype.isTapeOn=function(){return this.state.gradientDepth>0&&this.state.kernelDepth===0},de.prototype.addTapeNode=function(pe,Ae,Te,je,we,ot){var _t=this,Ut={id:this.state.nextTapeNodeId++,kernelName:pe,inputs:Ae,outputs:Te,saved:we},Xt=R.getGradient(pe);Xt!=null&&(je=Xt.gradFunc),je!=null&&(Ut.gradient=function(ke){return ke=ke.map(function(Ft,Gt){if(Ft==null){var jt=Te[Gt],Ye=I.makeZerosTypedArray(jt.size,jt.dtype);return _t.makeTensor(Ye,jt.shape,jt.dtype)}return Ft}),je(ke.length>1?ke:ke[0],we,ot)}),this.state.activeTape.push(Ut)},de.prototype.keep=function(pe){return pe.kept=!0,pe},de.prototype.startTape=function(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++},de.prototype.endTape=function(){this.state.gradientDepth--},de.prototype.startScope=function(pe){var Ae={track:[],name:"unnamed scope",id:this.state.nextScopeId++};pe&&(Ae.name=pe),this.state.scopeStack.push(Ae),this.state.activeScope=Ae},de.prototype.endScope=function(pe){for(var Ae=this,Te=ee.getTensorsInContainer(pe),je=new Set(Te.map(function(Ut){return Ut.id})),we=0;we<this.state.activeScope.track.length;we++){var ot=this.state.activeScope.track[we];ot.kept||je.has(ot.id)||ot.dispose()}var _t=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],Te.forEach(function(Ut){Ut.kept||Ut.scopeId!==_t.id||Ae.track(Ut)})},de.prototype.gradients=function(pe,Ae,Te,je){var we=this;if(je===void 0&&(je=!1),I.assert(Ae.length>0,function(){return"gradients() received an empty list of xs."}),Te!=null&&Te.dtype!=="float32")throw new Error("dy must have 'float32' dtype, but has '"+Te.dtype+"'");var ot=this.scopedRun(function(){return we.startTape()},function(){return we.endTape()},function(){return we.tidy("forward",pe)});I.assert(ot instanceof P.Tensor,function(){return"The result y returned by f() must be a tensor."});var _t=q.getFilteredNodesXToY(this.state.activeTape,Ae,ot);if(!je&&_t.length===0&&Ae.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",function(){var Ut={};Ut[ot.id]=Te??function(ke){var Ft=se.makeOnesTypedArray(se.sizeFromShape(ke),"float32");return A.ENGINE.makeTensor(Ft,ke,"float32")}(ot.shape),q.backpropagateGradients(Ut,_t,function(ke){return we.tidy(ke)});var Xt=Ae.map(function(ke){return Ut[ke.id]});return we.state.gradientDepth===0&&(we.state.activeTape.forEach(function(ke){for(var Ft=0,Gt=ke.saved;Ft<Gt.length;Ft++)Gt[Ft].dispose()}),we.state.activeTape=null),{value:ot,grads:Xt}})},de.prototype.customGrad=function(pe){var Ae=this;return I.assert(I.isFunction(pe),function(){return"The f passed in customGrad(f) must be a function."}),function(){for(var Te,je=[],we=0;we<arguments.length;we++)je[we]=arguments[we];I.assert(je.every(function(_t){return _t instanceof P.Tensor}),function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"});var ot={};return je.forEach(function(_t,Ut){ot[Ut]=_t}),Ae.runKernelFunc(function(_t,Ut){return Te=pe.apply(void 0,je.concat([Ut])),I.assert(Te.value instanceof P.Tensor,function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"}),I.assert(I.isFunction(Te.gradFunc),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."}),Te.value},ot,function(_t,Ut){var Xt=Te.gradFunc(_t,Ut),ke=Array.isArray(Xt)?Xt:[Xt];I.assert(ke.length===je.length,function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."}),I.assert(ke.every(function(Gt){return Gt instanceof P.Tensor}),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."});var Ft={};return ke.forEach(function(Gt,jt){Ft[jt]=function(){return Gt}}),Ft})}},de.prototype.readSync=function(pe){return this.state.tensorInfo.get(pe).backend.readSync(pe)},de.prototype.read=function(pe){return this.state.tensorInfo.get(pe).backend.read(pe)},de.prototype.time=function(pe){return U(this,void 0,void 0,function(){var Ae,Te;return B(this,function(je){switch(je.label){case 0:return Ae=se.now(),[4,this.backend.time(pe)];case 1:return(Te=je.sent()).wallMs=se.now()-Ae,[2,Te]}})})},de.prototype.track=function(pe){return this.state.activeScope!=null&&(pe.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(pe)),pe},Object.defineProperty(de.prototype,"registeredVariables",{get:function(){return this.state.registeredVariables},enumerable:!0,configurable:!0}),de.prototype.reset=function(){for(var pe in this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new ie,this.registry)this.disposeRegisteredKernels(pe),this.registry[pe].dispose(),delete this.registry[pe];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null},de.nextTensorId=0,de.nextVariableId=0,de}();A.Engine=K,A.ENGINE=function(){var de=function(){if(re==null){var Ae=void 0;if(typeof window<"u")Ae=window;else if(b!==void 0)Ae=b;else if($!==void 0)Ae=$;else{if(typeof self>"u")throw new Error("Could not find a global object");Ae=self}re=Ae}return re}();if(de._tfengine==null){var pe=new J.Environment(de);de._tfengine=new K(pe)}return J.setEnvironmentGlobal(de._tfengine.ENV),P.setTensorTracker(function(){return de._tfengine}),de._tfengine}()}).call(this,a(59),a(75))},function(Oe,A,a){var b=a(14),$=a(240),U=a(66),B=Object.defineProperty;A.f=a(27)?Object.defineProperty:function(re,J,R){if(b(re),J=U(J,!0),b(R),$)try{return B(re,J,R)}catch{}if("get"in R||"set"in R)throw TypeError("Accessors not supported!");return"value"in R&&(re[J]=R.value),re}},function(Oe,A,a){Oe.exports=!a(15)(function(){return Object.defineProperty({},"a",{get:function(){return 7}}).a!=7})},function(Oe,A,a){Object.defineProperty(A,"__esModule",{value:!0});/**
 * @license
 * Copyright 2018 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var b=a(25);A.op=function($){var U=Object.keys($);if(U.length!==1)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+U.length+" keys.");var B=U[0],re=$[B];B.endsWith("_")&&(B=B.substring(0,B.length-1));var J=function(){for(var R=[],W=0;W<arguments.length;W++)R[W]=arguments[W];b.ENGINE.startScope(B);try{var q=re.apply(void 0,R);return q instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),b.ENGINE.endScope(q),q}catch(P){throw b.ENGINE.endScope(null),P}};return Object.defineProperty(J,"name",{value:B,configurable:!0}),J}},function(Oe,A,a){/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Object.defineProperty(A,"__esModule",{value:!0});var b=a(25),$=a(103),U=a(33),B=a(21);function re(W,q){var P=W;if(B.isTypedArray(W))return q==="string"?[]:[W.length];if(!Array.isArray(W))return[];for(var ee=[];Array.isArray(P)||B.isTypedArray(P)&&q!=="string";)ee.push(P.length),P=P[0];return Array.isArray(W)&&$.env().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&function I(se,ie,K){if(K=K||[],!Array.isArray(se)&&!B.isTypedArray(se))return void B.assert(ie.length===0,function(){return"Element arr["+K.join("][")+"] is a primitive, but should be an array/TypedArray of "+ie[0]+" elements"});B.assert(ie.length>0,function(){return"Element arr["+K.join("][")+"] should be a primitive, but is an array of "+se.length+" elements"}),B.assert(se.length===ie[0],function(){return"Element arr["+K.join("][")+"] should have "+ie[0]+" elements, but has "+se.length+" elements"});for(var de=ie.slice(1),pe=0;pe<se.length;++pe)I(se[pe],de,K.concat(pe))}(W,ee,[]),ee}function J(W,q,P,ee){if(W!=null&&(W!=="numeric"&&W!==q||W==="numeric"&&q==="string"))throw new Error("Argument '"+P+"' passed to '"+ee+"' must be "+W+" tensor, but got "+q+" tensor")}function R(W,q,P,ee){if(ee===void 0&&(ee="numeric"),W instanceof U.Tensor)return J(ee,W.dtype,q,P),W;var I=B.inferDtype(W);if(I!=="string"&&["bool","int32","float32"].indexOf(ee)>=0&&(I=ee),J(ee,I,q,P),W==null||!B.isTypedArray(W)&&!Array.isArray(W)&&typeof W!="number"&&typeof W!="boolean"&&typeof W!="string"){var se=W==null?"null":W.constructor.name;throw new Error("Argument '"+q+"' passed to '"+P+"' must be a Tensor or TensorLike, but got '"+se+"'")}var ie=re(W,I);B.isTypedArray(W)||Array.isArray(W)||(W=[W]);var K=I!=="string"?B.toTypedArray(W,I,$.env().getBool("DEBUG")):B.flatten(W,[],!0);return b.ENGINE.makeTensor(K,ie,I)}A.inferShape=re,A.convertToTensor=R,A.convertToTensorArray=function(W,q,P,ee){if(ee===void 0&&(ee="numeric"),!Array.isArray(W))throw new Error("Argument "+q+" passed to "+P+" must be a `Tensor[]` or `TensorLike[]`");return W.map(function(I,se){return R(I,q+"["+se+"]",P)},ee)}},function(Oe,A,a){var b=a(254),$=a(253),U=a(187),B=a(252);Oe.exports=function(re){return b(re)||$(re)||U(re)||B()},Oe.exports.__esModule=!0,Oe.exports.default=Oe.exports},function(Oe,A,a){a.d(A,"a",function(){return U});var b=new Date,$=new Date;function U(B,re,J,R){function W(q){return B(q=arguments.length===0?new Date:new Date(+q)),q}return W.floor=function(q){return B(q=new Date(+q)),q},W.ceil=function(q){return B(q=new Date(q-1)),re(q,1),B(q),q},W.round=function(q){var P=W(q),ee=W.ceil(q);return q-P<ee-q?P:ee},W.offset=function(q,P){return re(q=new Date(+q),P==null?1:Math.floor(P)),q},W.range=function(q,P,ee){var I,se=[];if(q=W.ceil(q),ee=ee==null?1:Math.floor(ee),!(q<P&&ee>0))return se;do se.push(I=new Date(+q)),re(q,ee),B(q);while(I<q&&q<P);return se},W.filter=function(q){return U(function(P){if(P>=P)for(;B(P),!q(P);)P.setTime(P-1)},function(P,ee){if(P>=P)if(ee<0)for(;++ee<=0;)for(;re(P,-1),!q(P););else for(;--ee>=0;)for(;re(P,1),!q(P););})},J&&(W.count=function(q,P){return b.setTime(+q),$.setTime(+P),B(b),B($),Math.floor(J(b,$))},W.every=function(q){return q=Math.floor(q),isFinite(q)&&q>0?q>1?W.filter(R?function(P){return R(P)%q==0}:function(P){return W.count(0,P)%q==0}):W:null}),W}},function(Oe,A,a){const b=a(116),{MAX_LENGTH:$,MAX_SAFE_INTEGER:U}=a(117),{re:B,t:re}=a(90),J=a(115),{compareIdentifiers:R}=a(146);class W{constructor(P,ee){if(ee=J(ee),P instanceof W){if(P.loose===!!ee.loose&&P.includePrerelease===!!ee.includePrerelease)return P;P=P.version}else if(typeof P!="string")throw new TypeError(`Invalid Version: ${P}`);if(P.length>$)throw new TypeError(`version is longer than ${$} characters`);b("SemVer",P,ee),this.options=ee,this.loose=!!ee.loose,this.includePrerelease=!!ee.includePrerelease;const I=P.trim().match(ee.loose?B[re.LOOSE]:B[re.FULL]);if(!I)throw new TypeError(`Invalid Version: ${P}`);if(this.raw=P,this.major=+I[1],this.minor=+I[2],this.patch=+I[3],this.major>U||this.major<0)throw new TypeError("Invalid major version");if(this.minor>U||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>U||this.patch<0)throw new TypeError("Invalid patch version");I[4]?this.prerelease=I[4].split(".").map(se=>{if(/^[0-9]+$/.test(se)){const ie=+se;if(ie>=0&&ie<U)return ie}return se}):this.prerelease=[],this.build=I[5]?I[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(P){if(b("SemVer.compare",this.version,this.options,P),!(P instanceof W)){if(typeof P=="string"&&P===this.version)return 0;P=new W(P,this.options)}return P.version===this.version?0:this.compareMain(P)||this.comparePre(P)}compareMain(P){return P instanceof W||(P=new W(P,this.options)),R(this.major,P.major)||R(this.minor,P.minor)||R(this.patch,P.patch)}comparePre(P){if(P instanceof W||(P=new W(P,this.options)),this.prerelease.length&&!P.prerelease.length)return-1;if(!this.prerelease.length&&P.prerelease.length)return 1;if(!this.prerelease.length&&!P.prerelease.length)return 0;let ee=0;do{const I=this.prerelease[ee],se=P.prerelease[ee];if(b("prerelease compare",ee,I,se),I===void 0&&se===void 0)return 0;if(se===void 0)return 1;if(I===void 0)return-1;if(I!==se)return R(I,se)}while(++ee)}compareBuild(P){P instanceof W||(P=new W(P,this.options));let ee=0;do{const I=this.build[ee],se=P.build[ee];if(b("prerelease compare",ee,I,se),I===void 0&&se===void 0)return 0;if(se===void 0)return 1;if(I===void 0)return-1;if(I!==se)return R(I,se)}while(++ee)}inc(P,ee){switch(P){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",ee);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",ee);break;case"prepatch":this.prerelease.length=0,this.inc("patch",ee),this.inc("pre",ee);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",ee),this.inc("pre",ee);break;case"major":this.minor===0&&this.patch===0&&this.prerelease.length!==0||this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":this.patch===0&&this.prerelease.length!==0||this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":if(this.prerelease.length===0)this.prerelease=[0];else{let I=this.prerelease.length;for(;--I>=0;)typeof this.prerelease[I]=="number"&&(this.prerelease[I]++,I=-2);I===-1&&this.prerelease.push(0)}ee&&(this.prerelease[0]===ee?isNaN(this.prerelease[1])&&(this.prerelease=[ee,0]):this.prerelease=[ee,0]);break;default:throw new Error(`invalid increment argument: ${P}`)}return this.format(),this.raw=this.version,this}}Oe.exports=W},function(Oe,A,a){/**
* @license
* Copyright 2017 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/var b=this&&this.__extends||function(){var se=function(ie,K){return(se=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(de,pe){de.__proto__=pe}||function(de,pe){for(var Ae in pe)pe.hasOwnProperty(Ae)&&(de[Ae]=pe[Ae])})(ie,K)};return function(ie,K){function de(){this.constructor=ie}se(ie,K),ie.prototype=K===null?Object.create(K):(de.prototype=K.prototype,new de)}}(),$=this&&this.__awaiter||function(se,ie,K,de){return new(K||(K=Promise))(function(pe,Ae){function Te(ot){try{we(de.next(ot))}catch(_t){Ae(_t)}}function je(ot){try{we(de.throw(ot))}catch(_t){Ae(_t)}}function we(ot){ot.done?pe(ot.value):new K(function(_t){_t(ot.value)}).then(Te,je)}we((de=de.apply(se,ie||[])).next())})},U=this&&this.__generator||function(se,ie){var K,de,pe,Ae,Te={label:0,sent:function(){if(1&pe[0])throw pe[1];return pe[1]},trys:[],ops:[]};return Ae={next:je(0),throw:je(1),return:je(2)},typeof Symbol=="function"&&(Ae[Symbol.iterator]=function(){return this}),Ae;function je(we){return function(ot){return function(_t){if(K)throw new TypeError("Generator is already executing.");for(;Te;)try{if(K=1,de&&(pe=2&_t[0]?de.return:_t[0]?de.throw||((pe=de.return)&&pe.call(de),0):de.next)&&!(pe=pe.call(de,_t[1])).done)return pe;switch(de=0,pe&&(_t=[2&_t[0],pe.value]),_t[0]){case 0:case 1:pe=_t;break;case 4:return Te.label++,{value:_t[1],done:!1};case 5:Te.label++,de=_t[1],_t=[0];continue;case 7:_t=Te.ops.pop(),Te.trys.pop();continue;default:if(!(pe=(pe=Te.trys).length>0&&pe[pe.length-1])&&(_t[0]===6||_t[0]===2)){Te=0;continue}if(_t[0]===3&&(!pe||_t[1]>pe[0]&&_t[1]<pe[3])){Te.label=_t[1];break}if(_t[0]===6&&Te.label<pe[1]){Te.label=pe[1],pe=_t;break}if(pe&&Te.label<pe[2]){Te.label=pe[2],Te.ops.push(_t);break}pe[2]&&Te.ops.pop(),Te.trys.pop();continue}_t=ie.call(se,Te)}catch(Ut){_t=[6,Ut],de=0}finally{K=pe=0}if(5&_t[0])throw _t[1];return{value:_t[0]?_t[1]:void 0,done:!0}}([we,ot])}}};Object.defineProperty(A,"__esModule",{value:!0});var B=a(379),re=a(21),J=a(21),R=function(){function se(ie,K,de){var pe=this;if(this.dtype=K,this.shape=ie.slice(),this.size=re.sizeFromShape(ie),de!=null){var Ae=de.length;re.assert(Ae===this.size,function(){return"Length of values '"+Ae+"' does not match the size inferred by the shape '"+pe.size+"'."})}if(K==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=de||re.getArrayFromDType(K,this.size),this.strides=J.computeStrides(ie)}return se.prototype.set=function(ie){for(var K=this,de=[],pe=1;pe<arguments.length;pe++)de[pe-1]=arguments[pe];de.length===0&&(de=[0]),re.assert(de.length===this.rank,function(){return"The number of provided coordinates ("+de.length+") must match the rank ("+K.rank+")"});var Ae=this.locToIndex(de);this.values[Ae]=ie},se.prototype.get=function(){for(var ie=[],K=0;K<arguments.length;K++)ie[K]=arguments[K];ie.length===0&&(ie=[0]);for(var de=0,pe=0,Ae=ie;pe<Ae.length;pe++){var Te=Ae[pe];if(Te<0||Te>=this.shape[de]){var je="Requested out of range element at "+ie+".   Buffer shape="+this.shape;throw new Error(je)}de++}for(var we=ie[ie.length-1],ot=0;ot<ie.length-1;++ot)we+=this.strides[ot]*ie[ot];return this.values[we]},se.prototype.locToIndex=function(ie){if(this.rank===0)return 0;if(this.rank===1)return ie[0];for(var K=ie[ie.length-1],de=0;de<ie.length-1;++de)K+=this.strides[de]*ie[de];return K},se.prototype.indexToLoc=function(ie){if(this.rank===0)return[];if(this.rank===1)return[ie];for(var K=new Array(this.shape.length),de=0;de<K.length-1;++de)K[de]=Math.floor(ie/this.strides[de]),ie-=K[de]*this.strides[de];return K[K.length-1]=ie,K},Object.defineProperty(se.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),se.prototype.toTensor=function(){return W().makeTensor(this.values,this.shape,this.dtype)},se}();A.TensorBuffer=R;var W=null,q=null,P=null;A.setTensorTracker=function(se){W=se},A.setOpHandler=function(se){q=se},A.setDeprecationWarningFn=function(se){P=se};var ee=function(){function se(ie,K,de,pe){this.kept=!1,this.isDisposedInternal=!1,this.shape=ie.slice(),this.dtype=K||"float32",this.size=re.sizeFromShape(ie),this.strides=J.computeStrides(ie),this.dataId=de,this.id=pe,this.rankType=this.rank<5?this.rank.toString():"higher"}return se.prototype.flatten=function(){return this.throwIfDisposed(),this.as1D()},se.prototype.asScalar=function(){return this.throwIfDisposed(),re.assert(this.size===1,function(){return"The array must have only 1 element."}),this.reshape([])},se.prototype.as1D=function(){return this.throwIfDisposed(),this.reshape([this.size])},se.prototype.as2D=function(ie,K){return this.throwIfDisposed(),this.reshape([ie,K])},se.prototype.as3D=function(ie,K,de){return this.throwIfDisposed(),this.reshape([ie,K,de])},se.prototype.as4D=function(ie,K,de,pe){return this.throwIfDisposed(),this.reshape([ie,K,de,pe])},se.prototype.as5D=function(ie,K,de,pe,Ae){return this.throwIfDisposed(),this.reshape([ie,K,de,pe,Ae])},se.prototype.asType=function(ie){return this.throwIfDisposed(),q.cast(this,ie)},Object.defineProperty(se.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),se.prototype.buffer=function(){return $(this,void 0,void 0,function(){var ie;return U(this,function(K){switch(K.label){case 0:return[4,this.data()];case 1:return ie=K.sent(),[2,q.buffer(this.shape,this.dtype,ie)]}})})},se.prototype.bufferSync=function(){return q.buffer(this.shape,this.dtype,this.dataSync())},se.prototype.array=function(){return $(this,void 0,void 0,function(){var ie;return U(this,function(K){switch(K.label){case 0:return[4,this.data()];case 1:return ie=K.sent(),[2,J.toNestedArray(this.shape,ie)]}})})},se.prototype.arraySync=function(){return J.toNestedArray(this.shape,this.dataSync())},se.prototype.data=function(){return $(this,void 0,void 0,function(){var ie,K;return U(this,function(de){switch(de.label){case 0:return this.throwIfDisposed(),ie=W().read(this.dataId),this.dtype!=="string"?[3,2]:[4,ie];case 1:K=de.sent();try{return[2,K.map(function(pe){return re.decodeString(pe)})]}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}de.label=2;case 2:return[2,ie]}})})},se.prototype.dataSync=function(){this.throwIfDisposed();var ie=W().readSync(this.dataId);if(this.dtype==="string")try{return ie.map(function(K){return re.decodeString(K)})}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return ie},se.prototype.bytes=function(){return $(this,void 0,void 0,function(){var ie;return U(this,function(K){switch(K.label){case 0:return this.throwIfDisposed(),[4,W().read(this.dataId)];case 1:return ie=K.sent(),this.dtype==="string"?[2,ie]:[2,new Uint8Array(ie.buffer)]}})})},se.prototype.dispose=function(){this.isDisposed||(W().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(se.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!0,configurable:!0}),se.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},se.prototype.toFloat=function(){return this.asType("float32")},se.prototype.toInt=function(){return this.asType("int32")},se.prototype.toBool=function(){return this.asType("bool")},se.prototype.print=function(ie){return ie===void 0&&(ie=!1),q.print(this,ie)},se.prototype.reshape=function(ie){return this.throwIfDisposed(),q.reshape(this,ie)},se.prototype.reshapeAs=function(ie){return this.throwIfDisposed(),this.reshape(ie.shape)},se.prototype.expandDims=function(ie){return ie===void 0&&(ie=0),q.expandDims(this,ie)},se.prototype.cumsum=function(ie,K,de){return ie===void 0&&(ie=0),K===void 0&&(K=!1),de===void 0&&(de=!1),q.cumsum(this,ie,K,de)},se.prototype.squeeze=function(ie){return this.throwIfDisposed(),q.squeeze(this,ie)},se.prototype.clone=function(){return this.throwIfDisposed(),q.clone(this)},se.prototype.toString=function(ie){ie===void 0&&(ie=!1);var K=this.dataSync();return B.tensorToString(K,this.shape,this.dtype,ie)},se.prototype.gather=function(ie,K){return K===void 0&&(K=0),this.throwIfDisposed(),q.gather(this,ie,K)},se.prototype.matMul=function(ie,K,de){return K===void 0&&(K=!1),de===void 0&&(de=!1),this.throwIfDisposed(),q.matMul(this,ie,K,de)},se.prototype.dot=function(ie){return this.throwIfDisposed(),q.dot(this,ie)},se.prototype.norm=function(ie,K,de){return ie===void 0&&(ie="euclidean"),K===void 0&&(K=null),de===void 0&&(de=!1),this.throwIfDisposed(),q.norm(this,ie,K,de)},se.prototype.slice=function(ie,K){return this.throwIfDisposed(),q.slice(this,ie,K)},se.prototype.reverse=function(ie){return this.throwIfDisposed(),q.reverse(this,ie)},se.prototype.concat=function(ie,K){return K===void 0&&(K=0),this.throwIfDisposed(),ie instanceof se&&(ie=[ie]),q.concat([this].concat(ie),K)},se.prototype.split=function(ie,K){return K===void 0&&(K=0),this.throwIfDisposed(),q.split(this,ie,K)},se.prototype.stack=function(ie,K){return K===void 0&&(K=0),q.stack([this,ie],K)},se.prototype.unstack=function(ie){return ie===void 0&&(ie=0),q.unstack(this,ie)},se.prototype.batchNormalization=function(ie,K,de,pe,Ae){return de===void 0&&(de=.001),P("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon"),this.batchNorm(ie,K,Ae,pe,de)},se.prototype.all=function(ie,K){return ie===void 0&&(ie=null),K===void 0&&(K=!1),this.throwIfDisposed(),q.all(this,ie,K)},se.prototype.any=function(ie,K){return ie===void 0&&(ie=null),K===void 0&&(K=!1),this.throwIfDisposed(),q.any(this,ie,K)},se.prototype.logSumExp=function(ie,K){return ie===void 0&&(ie=null),K===void 0&&(K=!1),this.throwIfDisposed(),q.logSumExp(this,ie,K)},se.prototype.sum=function(ie,K){return ie===void 0&&(ie=null),K===void 0&&(K=!1),this.throwIfDisposed(),q.sum(this,ie,K)},se.prototype.prod=function(ie,K){return ie===void 0&&(ie=null),K===void 0&&(K=!1),this.throwIfDisposed(),q.prod(this,ie,K)},se.prototype.mean=function(ie,K){return ie===void 0&&(ie=null),K===void 0&&(K=!1),this.throwIfDisposed(),q.mean(this,ie,K)},se.prototype.min=function(ie,K){return ie===void 0&&(ie=null),K===void 0&&(K=!1),this.throwIfDisposed(),q.min(this,ie,K)},se.prototype.max=function(ie,K){return ie===void 0&&(ie=null),K===void 0&&(K=!1),this.throwIfDisposed(),q.max(this,ie,K)},se.prototype.argMin=function(ie){return ie===void 0&&(ie=null),this.throwIfDisposed(),q.argMin(this,ie)},se.prototype.argMax=function(ie){return ie===void 0&&(ie=null),this.throwIfDisposed(),q.argMax(this,ie)},se.prototype.cast=function(ie){return this.throwIfDisposed(),q.cast(this,ie)},se.prototype.addStrict=function(ie){return this.throwIfDisposed(),q.addStrict(this,ie)},se.prototype.atan2=function(ie){return this.throwIfDisposed(),q.atan2(this,ie)},se.prototype.sub=function(ie){return this.throwIfDisposed(),q.sub(this,ie)},se.prototype.subStrict=function(ie){return this.throwIfDisposed(),q.subStrict(this,ie)},se.prototype.pow=function(ie){return this.throwIfDisposed(),q.pow(this,ie)},se.prototype.powStrict=function(ie){return this.throwIfDisposed(),q.powStrict(this,ie)},se.prototype.mul=function(ie){return this.throwIfDisposed(),q.mul(this,ie)},se.prototype.mulStrict=function(ie){return this.throwIfDisposed(),q.mulStrict(this,ie)},se.prototype.floorDiv=function(ie){return this.throwIfDisposed(),q.floorDiv(this,ie)},se.prototype.divStrict=function(ie){return this.throwIfDisposed(),q.divStrict(this,ie)},se.prototype.minimum=function(ie){return this.throwIfDisposed(),q.minimum(this,ie)},se.prototype.minimumStrict=function(ie){return this.throwIfDisposed(),q.minimumStrict(this,ie)},se.prototype.maximum=function(ie){return this.throwIfDisposed(),q.maximum(this,ie)},se.prototype.maximumStrict=function(ie){return this.throwIfDisposed(),q.maximumStrict(this,ie)},se.prototype.mod=function(ie){return this.throwIfDisposed(),q.mod(this,ie)},se.prototype.modStrict=function(ie){return this.throwIfDisposed(),q.modStrict(this,ie)},se.prototype.squaredDifferenceStrict=function(ie){return this.throwIfDisposed(),q.squaredDifferenceStrict(this,ie)},se.prototype.notEqual=function(ie){return this.throwIfDisposed(),q.notEqual(this,ie)},se.prototype.notEqualStrict=function(ie){return this.throwIfDisposed(),q.notEqualStrict(this,ie)},se.prototype.less=function(ie){return this.throwIfDisposed(),q.less(this,ie)},se.prototype.lessStrict=function(ie){return this.throwIfDisposed(),q.lessStrict(this,ie)},se.prototype.equal=function(ie){return this.throwIfDisposed(),q.equal(this,ie)},se.prototype.equalStrict=function(ie){return this.throwIfDisposed(),q.equalStrict(this,ie)},se.prototype.lessEqual=function(ie){return this.throwIfDisposed(),q.lessEqual(this,ie)},se.prototype.lessEqualStrict=function(ie){return this.throwIfDisposed(),q.lessEqualStrict(this,ie)},se.prototype.greater=function(ie){return this.throwIfDisposed(),q.greater(this,ie)},se.prototype.greaterStrict=function(ie){return this.throwIfDisposed(),q.greaterStrict(this,ie)},se.prototype.greaterEqual=function(ie){return this.throwIfDisposed(),q.greaterEqual(this,ie)},se.prototype.greaterEqualStrict=function(ie){return this.throwIfDisposed(),q.greaterEqualStrict(this,ie)},se.prototype.logicalAnd=function(ie){return this.throwIfDisposed(),q.logicalAnd(this,ie)},se.prototype.logicalOr=function(ie){return this.throwIfDisposed(),q.logicalOr(this,ie)},se.prototype.logicalNot=function(){return this.throwIfDisposed(),q.logicalNot(this)},se.prototype.logicalXor=function(ie){return this.throwIfDisposed(),q.logicalXor(this,ie)},se.prototype.where=function(ie,K){return this.throwIfDisposed(),q.where(ie,this,K)},se.prototype.neg=function(){return this.throwIfDisposed(),q.neg(this)},se.prototype.ceil=function(){return this.throwIfDisposed(),q.ceil(this)},se.prototype.floor=function(){return this.throwIfDisposed(),q.floor(this)},se.prototype.sign=function(){return this.throwIfDisposed(),q.sign(this)},se.prototype.isNaN=function(){return this.throwIfDisposed(),q.isNaN(this)},se.prototype.isInf=function(){return this.throwIfDisposed(),q.isInf(this)},se.prototype.isFinite=function(){return this.throwIfDisposed(),q.isFinite(this)},se.prototype.exp=function(){return this.throwIfDisposed(),q.exp(this)},se.prototype.expm1=function(){return this.throwIfDisposed(),q.expm1(this)},se.prototype.log=function(){return this.throwIfDisposed(),q.log(this)},se.prototype.log1p=function(){return this.throwIfDisposed(),q.log1p(this)},se.prototype.sqrt=function(){return this.throwIfDisposed(),q.sqrt(this)},se.prototype.rsqrt=function(){return this.throwIfDisposed(),q.rsqrt(this)},se.prototype.square=function(){return this.throwIfDisposed(),q.square(this)},se.prototype.reciprocal=function(){return this.throwIfDisposed(),q.reciprocal(this)},se.prototype.abs=function(){return this.throwIfDisposed(),q.abs(this)},se.prototype.clipByValue=function(ie,K){return this.throwIfDisposed(),q.clipByValue(this,ie,K)},se.prototype.relu=function(){return this.throwIfDisposed(),q.relu(this)},se.prototype.relu6=function(){return this.throwIfDisposed(),q.relu6(this)},se.prototype.elu=function(){return this.throwIfDisposed(),q.elu(this)},se.prototype.selu=function(){return this.throwIfDisposed(),q.selu(this)},se.prototype.leakyRelu=function(ie){return ie===void 0&&(ie=.2),this.throwIfDisposed(),q.leakyRelu(this,ie)},se.prototype.prelu=function(ie){return this.throwIfDisposed(),q.prelu(this,ie)},se.prototype.sigmoid=function(){return this.throwIfDisposed(),q.sigmoid(this)},se.prototype.logSigmoid=function(){return this.throwIfDisposed(),q.logSigmoid(this)},se.prototype.softplus=function(){return this.throwIfDisposed(),q.softplus(this)},se.prototype.zerosLike=function(){return this.throwIfDisposed(),q.zerosLike(this)},se.prototype.onesLike=function(){return this.throwIfDisposed(),q.onesLike(this)},se.prototype.sin=function(){return this.throwIfDisposed(),q.sin(this)},se.prototype.cos=function(){return this.throwIfDisposed(),q.cos(this)},se.prototype.tan=function(){return this.throwIfDisposed(),q.tan(this)},se.prototype.asin=function(){return this.throwIfDisposed(),q.asin(this)},se.prototype.acos=function(){return this.throwIfDisposed(),q.acos(this)},se.prototype.atan=function(){return this.throwIfDisposed(),q.atan(this)},se.prototype.sinh=function(){return this.throwIfDisposed(),q.sinh(this)},se.prototype.cosh=function(){return this.throwIfDisposed(),q.cosh(this)},se.prototype.tanh=function(){return this.throwIfDisposed(),q.tanh(this)},se.prototype.asinh=function(){return this.throwIfDisposed(),q.asinh(this)},se.prototype.acosh=function(){return this.throwIfDisposed(),q.acosh(this)},se.prototype.atanh=function(){return this.throwIfDisposed(),q.atanh(this)},se.prototype.erf=function(){return this.throwIfDisposed(),q.erf(this)},se.prototype.round=function(){return this.throwIfDisposed(),q.round(this)},se.prototype.step=function(ie){return ie===void 0&&(ie=0),this.throwIfDisposed(),q.step(this,ie)},se.prototype.softmax=function(ie){return ie===void 0&&(ie=-1),this.throwIfDisposed(),q.softmax(this,ie)},se.prototype.logSoftmax=function(ie){return ie===void 0&&(ie=-1),this.throwIfDisposed(),q.logSoftmax(this,ie)},se.prototype.resizeBilinear=function(ie,K){return K===void 0&&(K=!1),this.throwIfDisposed(),q.image.resizeBilinear(this,ie,K)},se.prototype.resizeNearestNeighbor=function(ie,K){return K===void 0&&(K=!1),this.throwIfDisposed(),q.image.resizeNearestNeighbor(this,ie,K)},se.prototype.conv1d=function(ie,K,de,pe,Ae,Te){return pe===void 0&&(pe="NWC"),Ae===void 0&&(Ae=1),this.throwIfDisposed(),q.conv1d(this,ie,K,de,pe,Ae,Te)},se.prototype.conv2d=function(ie,K,de,pe,Ae,Te){return pe===void 0&&(pe="NHWC"),Ae===void 0&&(Ae=[1,1]),this.throwIfDisposed(),q.conv2d(this,ie,K,de,pe,Ae,Te)},se.prototype.conv2dTranspose=function(ie,K,de,pe,Ae){return this.throwIfDisposed(),q.conv2dTranspose(this,ie,K,de,pe,Ae)},se.prototype.depthwiseConv2D=function(ie,K,de,pe,Ae,Te){return pe===void 0&&(pe="NHWC"),Ae===void 0&&(Ae=[1,1]),this.throwIfDisposed(),q.depthwiseConv2d(this,ie,K,de,pe,Ae,Te)},se.prototype.separableConv2d=function(ie,K,de,pe,Ae,Te){return Ae===void 0&&(Ae=[1,1]),Te===void 0&&(Te="NHWC"),this.throwIfDisposed(),q.separableConv2d(this,ie,K,de,pe,Ae,Te)},se.prototype.avgPool=function(ie,K,de,pe){return this.throwIfDisposed(),q.avgPool(this,ie,K,de,pe)},se.prototype.maxPool=function(ie,K,de,pe){return this.throwIfDisposed(),q.maxPool(this,ie,K,de,pe)},se.prototype.localResponseNormalization=function(ie,K,de,pe){return ie===void 0&&(ie=5),K===void 0&&(K=1),de===void 0&&(de=1),pe===void 0&&(pe=.5),q.localResponseNormalization(this,ie,K,de,pe)},se.prototype.pool=function(ie,K,de,pe,Ae){return this.throwIfDisposed(),q.pool(this,ie,K,de,pe,Ae)},se.prototype.variable=function(ie,K,de){return ie===void 0&&(ie=!0),this.throwIfDisposed(),W().makeVariable(this,ie,K,de)},se.prototype.unsortedSegmentSum=function(ie,K){return this.throwIfDisposed(),q.unsortedSegmentSum(this,ie,K)},se.prototype.batchToSpaceND=function(ie,K){return this.throwIfDisposed(),q.batchToSpaceND(this,ie,K)},se.prototype.spaceToBatchND=function(ie,K){return this.throwIfDisposed(),q.spaceToBatchND(this,ie,K)},se.prototype.topk=function(ie,K){return ie===void 0&&(ie=1),K===void 0&&(K=!0),this.throwIfDisposed(),q.topk(this,ie,K)},se.prototype.stridedSlice=function(ie,K,de,pe,Ae,Te,je,we){return pe===void 0&&(pe=0),Ae===void 0&&(Ae=0),Te===void 0&&(Te=0),je===void 0&&(je=0),we===void 0&&(we=0),this.throwIfDisposed(),q.stridedSlice(this,ie,K,de,pe,Ae,Te,je,we)},se.prototype.depthToSpace=function(ie,K){return this.throwIfDisposed(),q.depthToSpace(this,ie,K)},se.prototype.fft=function(){return this.throwIfDisposed(),q.spectral.fft(this)},se.prototype.ifft=function(){return this.throwIfDisposed(),q.spectral.ifft(this)},se.prototype.rfft=function(){return this.throwIfDisposed(),q.spectral.rfft(this)},se.prototype.irfft=function(){return this.throwIfDisposed(),q.spectral.irfft(this)},se}();A.Tensor=ee,Object.defineProperty(ee,Symbol.hasInstance,{value:function(se){return!!se&&se.dataId!=null&&se.shape!=null&&se.dtype!=null}});var I=function(se){function ie(K,de,pe,Ae){var Te=se.call(this,K.shape,K.dtype,K.dataId,Ae)||this;return Te.trainable=de,Te.name=pe,Te}return b(ie,se),ie.prototype.assign=function(K){if(K.dtype!==this.dtype)throw new Error("dtype of the new value ("+K.dtype+") and previous value ("+this.dtype+") must match");if(!re.arraysEqual(K.shape,this.shape))throw new Error("shape of the new value ("+K.shape+") and previous value ("+this.shape+") must match");W().disposeTensor(this),this.dataId=K.dataId,W().incRef(this,null)},ie.prototype.dispose=function(){W().disposeVariable(this),this.isDisposedInternal=!0},ie}(ee);A.Variable=I,Object.defineProperty(I,Symbol.hasInstance,{value:function(se){return se instanceof ee&&se.assign!=null&&se.assign instanceof Function}})},function(Oe,A,a){var b=a(61);Oe.exports=function($){return Object(b($))}},function(Oe,A){function a(b){return Oe.exports=a=Object.setPrototypeOf?Object.getPrototypeOf:function($){return $.__proto__||Object.getPrototypeOf($)},Oe.exports.__esModule=!0,Oe.exports.default=Oe.exports,a(b)}Oe.exports=a,Oe.exports.__esModule=!0,Oe.exports.default=Oe.exports},function(Oe,A,a){var b=a(195),$=Object.prototype.toString;function U(q){return $.call(q)==="[object Array]"}function B(q){return q===void 0}function re(q){return q!==null&&typeof q=="object"}function J(q){if($.call(q)!=="[object Object]")return!1;var P=Object.getPrototypeOf(q);return P===null||P===Object.prototype}function R(q){return $.call(q)==="[object Function]"}function W(q,P){if(q!=null)if(typeof q!="object"&&(q=[q]),U(q))for(var ee=0,I=q.length;ee<I;ee++)P.call(null,q[ee],ee,q);else for(var se in q)Object.prototype.hasOwnProperty.call(q,se)&&P.call(null,q[se],se,q)}Oe.exports={isArray:U,isArrayBuffer:function(q){return $.call(q)==="[object ArrayBuffer]"},isBuffer:function(q){return q!==null&&!B(q)&&q.constructor!==null&&!B(q.constructor)&&typeof q.constructor.isBuffer=="function"&&q.constructor.isBuffer(q)},isFormData:function(q){return typeof FormData<"u"&&q instanceof FormData},isArrayBufferView:function(q){return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(q):q&&q.buffer&&q.buffer instanceof ArrayBuffer},isString:function(q){return typeof q=="string"},isNumber:function(q){return typeof q=="number"},isObject:re,isPlainObject:J,isUndefined:B,isDate:function(q){return $.call(q)==="[object Date]"},isFile:function(q){return $.call(q)==="[object File]"},isBlob:function(q){return $.call(q)==="[object Blob]"},isFunction:R,isStream:function(q){return re(q)&&R(q.pipe)},isURLSearchParams:function(q){return typeof URLSearchParams<"u"&&q instanceof URLSearchParams},isStandardBrowserEnv:function(){return(typeof navigator>"u"||navigator.product!=="ReactNative"&&navigator.product!=="NativeScript"&&navigator.product!=="NS")&&typeof window<"u"&&typeof document<"u"},forEach:W,merge:function q(){var P={};function ee(ie,K){J(P[K])&&J(ie)?P[K]=q(P[K],ie):J(ie)?P[K]=q({},ie):U(ie)?P[K]=ie.slice():P[K]=ie}for(var I=0,se=arguments.length;I<se;I++)W(arguments[I],ee);return P},extend:function(q,P,ee){return W(P,function(I,se){q[se]=ee&&typeof I=="function"?b(I,ee):I}),q},trim:function(q){return q.trim?q.trim():q.replace(/^\s+|\s+$/g,"")},stripBOM:function(q){return q.charCodeAt(0)===65279&&(q=q.slice(1)),q}}},function(Oe,A,a){var b=a(8),$=a(15),U=a(61),B=/"/g,re=function(J,R,W,q){var P=String(U(J)),ee="<"+R;return W!==""&&(ee+=" "+W+'="'+String(q).replace(B,"&quot;")+'"'),ee+">"+P+"</"+R+">"};Oe.exports=function(J,R){var W={};W[J]=R(re),b(b.P+b.F*$(function(){var q=""[J]('"');return q!==q.toLowerCase()||q.split('"').length>3}),"String",W)}},function(Oe,A,a){var b=a(16),$=a(42),U=a(43),B=a(84)("src"),re=a(576),J=(""+re).split("toString");a(24).inspectSource=function(R){return re.call(R)},(Oe.exports=function(R,W,q,P){var ee=typeof q=="function";ee&&(U(q,"name")||$(q,"name",W)),R[W]!==q&&(ee&&(U(q,B)||$(q,B,R[W]?""+R[W]:J.join(String(W)))),R===b?R[W]=q:P?R[W]?R[W]=q:$(R,W,q):(delete R[W],$(R,W,q)))})(Function.prototype,"toString",function(){return typeof this=="function"&&this[B]||re.call(this)})},function(Oe,A,a){a.d(A,"b",function(){return B}),a.d(A,"a",function(){return re}),a.d(A,"c",function(){return W});var b=a(31),$=a(12);function U(ee){return Object(b.a)(function(I){I.setUTCDate(I.getUTCDate()-(I.getUTCDay()+7-ee)%7),I.setUTCHours(0,0,0,0)},function(I,se){I.setUTCDate(I.getUTCDate()+7*se)},function(I,se){return(se-I)/$.f})}var B=U(0),re=U(1),J=U(2),R=U(3),W=U(4),q=U(5),P=U(6);B.range,re.range,J.range,R.range,W.range,q.range,P.range},function(Oe,A,a){a.d(A,"b",function(){return B}),a.d(A,"a",function(){return re}),a.d(A,"c",function(){return W});var b=a(31),$=a(12);function U(ee){return Object(b.a)(function(I){I.setDate(I.getDate()-(I.getDay()+7-ee)%7),I.setHours(0,0,0,0)},function(I,se){I.setDate(I.getDate()+7*se)},function(I,se){return(se-I-(se.getTimezoneOffset()-I.getTimezoneOffset())*$.c)/$.f})}var B=U(0),re=U(1),J=U(2),R=U(3),W=U(4),q=U(5),P=U(6);B.range,re.range,J.range,R.range,W.range,q.range,P.range},function(Oe,A,a){var b=a(107),$=a(61);Oe.exports=function(U){return b($(U))}},function(Oe,A,a){var b=a(26),$=a(85);Oe.exports=a(27)?function(U,B,re){return b.f(U,B,$(1,re))}:function(U,B,re){return U[B]=re,U}},function(Oe,A){var a={}.hasOwnProperty;Oe.exports=function(b,$){return a.call(b,$)}},function(Oe,A,a){var b=a(45),$=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function U(hn){if(!(Ve=$.exec(hn)))throw new Error("invalid format: "+hn);var Ve;return new B({fill:Ve[1],align:Ve[2],sign:Ve[3],symbol:Ve[4],zero:Ve[5],width:Ve[6],comma:Ve[7],precision:Ve[8]&&Ve[8].slice(1),trim:Ve[9],type:Ve[10]})}function B(hn){this.fill=hn.fill===void 0?" ":hn.fill+"",this.align=hn.align===void 0?">":hn.align+"",this.sign=hn.sign===void 0?"-":hn.sign+"",this.symbol=hn.symbol===void 0?"":hn.symbol+"",this.zero=!!hn.zero,this.width=hn.width===void 0?void 0:+hn.width,this.comma=!!hn.comma,this.precision=hn.precision===void 0?void 0:+hn.precision,this.trim=!!hn.trim,this.type=hn.type===void 0?"":hn.type+""}U.prototype=B.prototype,B.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,0|this.width))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};function re(hn,Ve){if((Qe=(hn=Ve?hn.toExponential(Ve-1):hn.toExponential()).indexOf("e"))<0)return null;var Qe,He=hn.slice(0,Qe);return[He.length>1?He[0]+He.slice(2):He,+hn.slice(Qe+1)]}var J,R,W,q,P=function(hn){return(hn=re(Math.abs(hn)))?hn[1]:NaN},ee=function(hn,Ve){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(P(Ve)/3)))-P(Math.abs(hn)))},I=function(hn,Ve){return hn=Math.abs(hn),Ve=Math.abs(Ve)-hn,Math.max(0,P(Ve)-P(hn))+1},se=function(hn){return Math.max(0,-P(Math.abs(hn)))},ie=function(hn){e:for(var Ve,Qe=hn.length,He=1,pt=-1;He<Qe;++He)switch(hn[He]){case".":pt=Ve=He;break;case"0":pt===0&&(pt=He),Ve=He;break;default:if(!+hn[He])break e;pt>0&&(pt=0)}return pt>0?hn.slice(0,pt)+hn.slice(Ve+1):hn},K=function(hn,Ve){var Qe=re(hn,Ve);if(!Qe)return hn+"";var He=Qe[0],pt=Qe[1];return pt<0?"0."+new Array(-pt).join("0")+He:He.length>pt+1?He.slice(0,pt+1)+"."+He.slice(pt+1):He+new Array(pt-He.length+2).join("0")},de={"%":(hn,Ve)=>(100*hn).toFixed(Ve),b:hn=>Math.round(hn).toString(2),c:hn=>hn+"",d:function(hn){return Math.abs(hn=Math.round(hn))>=1e21?hn.toLocaleString("en").replace(/,/g,""):hn.toString(10)},e:(hn,Ve)=>hn.toExponential(Ve),f:(hn,Ve)=>hn.toFixed(Ve),g:(hn,Ve)=>hn.toPrecision(Ve),o:hn=>Math.round(hn).toString(8),p:(hn,Ve)=>K(100*hn,Ve),r:K,s:function(hn,Ve){var Qe=re(hn,Ve);if(!Qe)return hn+"";var He=Qe[0],pt=Qe[1],Lt=pt-(J=3*Math.max(-8,Math.min(8,Math.floor(pt/3))))+1,zt=He.length;return Lt===zt?He:Lt>zt?He+new Array(Lt-zt+1).join("0"):Lt>0?He.slice(0,Lt)+"."+He.slice(Lt):"0."+new Array(1-Lt).join("0")+re(hn,Math.max(0,Ve+Lt-1))[0]},X:hn=>Math.round(hn).toString(16).toUpperCase(),x:hn=>Math.round(hn).toString(16)},pe=function(hn){return hn},Ae=Array.prototype.map,Te=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"],je=function(hn){var Ve=hn.grouping===void 0||hn.thousands===void 0?pe:function(be,Yn){return function(Dr,pr){for(var Nr=Dr.length,Fr=[],an=0,Kt=be[0],Zt=0;Nr>0&&Kt>0&&(Zt+Kt+1>pr&&(Kt=Math.max(1,pr-Zt)),Fr.push(Dr.substring(Nr-=Kt,Nr+Kt)),!((Zt+=Kt+1)>pr));)Kt=be[an=(an+1)%be.length];return Fr.reverse().join(Yn)}}(Ae.call(hn.grouping,Number),hn.thousands+""),Qe=hn.currency===void 0?"":hn.currency[0]+"",He=hn.currency===void 0?"":hn.currency[1]+"",pt=hn.decimal===void 0?".":hn.decimal+"",Lt=hn.numerals===void 0?pe:function(be){return function(Yn){return Yn.replace(/[0-9]/g,function(Dr){return be[+Dr]})}}(Ae.call(hn.numerals,String)),zt=hn.percent===void 0?"%":hn.percent+"",Tn=hn.minus===void 0?"":hn.minus+"",xn=hn.nan===void 0?"NaN":hn.nan+"";function Kn(be){var Yn=(be=U(be)).fill,Dr=be.align,pr=be.sign,Nr=be.symbol,Fr=be.zero,an=be.width,Kt=be.comma,Zt=be.precision,$n=be.trim,Dn=be.type;Dn==="n"?(Kt=!0,Dn="g"):de[Dn]||(Zt===void 0&&(Zt=12),$n=!0,Dn="g"),(Fr||Yn==="0"&&Dr==="=")&&(Fr=!0,Yn="0",Dr="=");var hr=Nr==="$"?Qe:Nr==="#"&&/[boxX]/.test(Dn)?"0"+Dn.toLowerCase():"",wr=Nr==="$"?He:/[%p]/.test(Dn)?zt:"",gr=de[Dn],Qr=/[defgprs%]/.test(Dn);function ti(Mr){var di,Yr,Xr,fi=hr,oi=wr;if(Dn==="c")oi=gr(Mr)+oi,Mr="";else{var Ao=(Mr=+Mr)<0||1/Mr<0;if(Mr=isNaN(Mr)?xn:gr(Math.abs(Mr),Zt),$n&&(Mr=ie(Mr)),Ao&&+Mr==0&&pr!=="+"&&(Ao=!1),fi=(Ao?pr==="("?pr:Tn:pr==="-"||pr==="("?"":pr)+fi,oi=(Dn==="s"?Te[8+J/3]:"")+oi+(Ao&&pr==="("?")":""),Qr){for(di=-1,Yr=Mr.length;++di<Yr;)if(48>(Xr=Mr.charCodeAt(di))||Xr>57){oi=(Xr===46?pt+Mr.slice(di+1):Mr.slice(di))+oi,Mr=Mr.slice(0,di);break}}}Kt&&!Fr&&(Mr=Ve(Mr,1/0));var Wi=fi.length+Mr.length+oi.length,Ei=Wi<an?new Array(an-Wi+1).join(Yn):"";switch(Kt&&Fr&&(Mr=Ve(Ei+Mr,Ei.length?an-oi.length:1/0),Ei=""),Dr){case"<":Mr=fi+Mr+oi+Ei;break;case"=":Mr=fi+Ei+Mr+oi;break;case"^":Mr=Ei.slice(0,Wi=Ei.length>>1)+fi+Mr+oi+Ei.slice(Wi);break;default:Mr=Ei+fi+Mr+oi}return Lt(Mr)}return Zt=Zt===void 0?6:/[gprs]/.test(Dn)?Math.max(1,Math.min(21,Zt)):Math.max(0,Math.min(20,Zt)),ti.toString=function(){return be+""},ti}return{format:Kn,formatPrefix:function(be,Yn){var Dr=Kn(((be=U(be)).type="f",be)),pr=3*Math.max(-8,Math.min(8,Math.floor(P(Yn)/3))),Nr=Math.pow(10,-pr),Fr=Te[8+pr/3];return function(an){return Dr(Nr*an)+Fr}}}};(function(hn){R=je(hn),W=R.format,q=R.formatPrefix})({thousands:",",grouping:[3],currency:["$",""]});var we=a(11),ot=a(1),_t=a(100),Ut=a(246);function Xt(hn){const Ve={};return Qe=>Ve[Qe]||(Ve[Qe]=hn(Qe))}function ke(hn){const Ve=Xt(hn.format),Qe=hn.formatPrefix;return{format:Ve,formatPrefix:Qe,formatFloat(He){const pt=U(He||",");if(pt.precision==null){switch(pt.precision=12,pt.type){case"%":pt.precision-=2;break;case"e":pt.precision-=1}return function(Lt,zt){return Tn=>{const xn=Lt(Tn),Kn=xn.indexOf(zt);if(Kn<0)return xn;let be=function(Dr,pr){let Nr,Fr=Dr.lastIndexOf("e");if(Fr>0)return Fr;for(Fr=Dr.length;--Fr>pr;)if((Nr=Dr.charCodeAt(Fr))>=48&&Nr<=57)return Fr+1}(xn,Kn);const Yn=be<xn.length?xn.slice(be):"";for(;--be>Kn;)if(xn[be]!=="0"){++be;break}return xn.slice(0,be)+Yn}}(Ve(pt),Ve(".1f")(1)[1])}return Ve(pt)},formatSpan(He,pt,Lt,zt){zt=U(zt??",f");const Tn=Object(b.c)(He,pt,Lt),xn=Math.max(Math.abs(He),Math.abs(pt));let Kn;if(zt.precision==null)switch(zt.type){case"s":return isNaN(Kn=ee(Tn,xn))||(zt.precision=Kn),Qe(zt,xn);case"":case"e":case"g":case"p":case"r":isNaN(Kn=I(Tn,xn))||(zt.precision=Kn-(zt.type==="e"));break;case"f":case"%":isNaN(Kn=se(Tn))||(zt.precision=Kn-2*(zt.type==="%"))}return Ve(zt)}}}let Ft,Gt;function jt(){return Ft=ke({format:W,formatPrefix:q})}function Ye(hn){return ke(je(hn))}function ln(hn){return arguments.length?Ft=Ye(hn):Ft}function nn(hn,Ve,Qe){Qe=Qe||{},Object(ot.H)(Qe)||Object(ot.o)("Invalid time multi-format specifier: ".concat(Qe));const He=Ve(we.i),pt=Ve(we.f),Lt=Ve(we.d),zt=Ve(we.a),Tn=Ve(we.k),xn=Ve(we.g),Kn=Ve(we.h),be=Ve(we.l),Yn=hn(Qe[we.e]||".%L"),Dr=hn(Qe[we.i]||":%S"),pr=hn(Qe[we.f]||"%I:%M"),Nr=hn(Qe[we.d]||"%I %p"),Fr=hn(Qe[we.a]||Qe[we.b]||"%a %d"),an=hn(Qe[we.k]||"%b %d"),Kt=hn(Qe[we.g]||"%B"),Zt=hn(Qe[we.h]||"%B"),$n=hn(Qe[we.l]||"%Y");return Dn=>(He(Dn)<Dn?Yn:pt(Dn)<Dn?Dr:Lt(Dn)<Dn?pr:zt(Dn)<Dn?Nr:xn(Dn)<Dn?Tn(Dn)<Dn?Fr:an:be(Dn)<Dn?Kn(Dn)<Dn?Kt:Zt:$n)(Dn)}function Bt(hn){const Ve=Xt(hn.format),Qe=Xt(hn.utcFormat);return{timeFormat:He=>Object(ot.J)(He)?Ve(He):nn(Ve,we.p,He),utcFormat:He=>Object(ot.J)(He)?Qe(He):nn(Qe,we.v,He),timeParse:Xt(hn.parse),utcParse:Xt(hn.utcParse)}}function Pt(){return Gt=Bt({format:_t.a,parse:_t.b,utcFormat:_t.c,utcParse:_t.d})}function gn(hn){return Bt(Object(Ut.a)(hn))}function Dt(hn){return arguments.length?Gt=gn(hn):Gt}a.d(A,"a",function(){return Bn}),a.d(A,"b",function(){return wn}),a.d(A,"c",function(){return ln}),a.d(A,"d",function(){return Hn}),a.d(A,"e",function(){return Dt}),jt(),Pt();const St=(hn,Ve)=>Object(ot.p)({},hn,Ve);function wn(hn,Ve){const Qe=hn?Ye(hn):ln(),He=Ve?gn(Ve):Dt();return St(Qe,He)}function Bn(hn,Ve){const Qe=arguments.length;return Qe&&Qe!==2&&Object(ot.o)("defaultLocale expects either zero or two arguments."),Qe?St(ln(hn),Dt(Ve)):St(ln(),Dt())}function Hn(){return jt(),Pt(),Bn()}},function(Oe,A,a){a.d(A,"b",function(){return B}),a.d(A,"c",function(){return re});var b=Math.sqrt(50),$=Math.sqrt(10),U=Math.sqrt(2);function B(J,R,W){var q=(R-J)/Math.max(0,W),P=Math.floor(Math.log(q)/Math.LN10),ee=q/Math.pow(10,P);return P>=0?(ee>=b?10:ee>=$?5:ee>=U?2:1)*Math.pow(10,P):-Math.pow(10,-P)/(ee>=b?10:ee>=$?5:ee>=U?2:1)}function re(J,R,W){var q=Math.abs(R-J)/Math.max(0,W),P=Math.pow(10,Math.floor(Math.log(q)/Math.LN10)),ee=q/P;return ee>=b?P*=10:ee>=$?P*=5:ee>=U&&(P*=2),R<J?-P:P}A.a=function(J,R,W){var q,P,ee,I,se=-1;if(W=+W,(J=+J)==(R=+R)&&W>0)return[J];if((q=R<J)&&(P=J,J=R,R=P),(I=B(J,R,W))===0||!isFinite(I))return[];if(I>0){let ie=Math.round(J/I),K=Math.round(R/I);for(ie*I<J&&++ie,K*I>R&&--K,ee=new Array(P=K-ie+1);++se<P;)ee[se]=(ie+se)*I}else{I=-I;let ie=Math.round(J*I),K=Math.round(R*I);for(ie/I<J&&++ie,K/I>R&&--K,ee=new Array(P=K-ie+1);++se<P;)ee[se]=(ie+se)/I}return q&&ee.reverse(),ee}},function(Oe,A,a){/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/var b=this&&this.__awaiter||function(B,re,J,R){return new(J||(J=Promise))(function(W,q){function P(se){try{I(R.next(se))}catch(ie){q(ie)}}function ee(se){try{I(R.throw(se))}catch(ie){q(ie)}}function I(se){se.done?W(se.value):new J(function(ie){ie(se.value)}).then(P,ee)}I((R=R.apply(B,re||[])).next())})};Object.defineProperty(A,"__esModule",{value:!0});const $=a(198),U=a(197);A.getDrawArea=function(B){if(B instanceof HTMLElement)return B;if($.isSurface(B))return B.drawArea;if($.isSurfaceInfo(B))return U.visor().surface({name:B.name,tab:B.tab,styles:B.styles}).drawArea;throw new Error("Not a drawable")},A.shallowEquals=function(B,re){const J=Object.getOwnPropertyNames(B),R=Object.getOwnPropertyNames(re);if(J.length!==R.length)return!1;for(let W=0;W<J.length;W++){const q=J[W];if(B[q]!==re[q])return!1}return!0},A.nextFrame=function(){return b(this,void 0,void 0,function*(){yield new Promise(B=>requestAnimationFrame(B))})}},function(Oe,A,a){class b{constructor(Gt,jt){if(jt=U(jt),Gt instanceof b)return Gt.loose===!!jt.loose&&Gt.includePrerelease===!!jt.includePrerelease?Gt:new b(Gt.raw,jt);if(Gt instanceof B)return this.raw=Gt.value,this.set=[[Gt]],this.format(),this;if(this.options=jt,this.loose=!!jt.loose,this.includePrerelease=!!jt.includePrerelease,this.raw=Gt,this.set=Gt.split(/\s*\|\|\s*/).map(Ye=>this.parseRange(Ye.trim())).filter(Ye=>Ye.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${Gt}`);if(this.set.length>1){const Ye=this.set[0];if(this.set=this.set.filter(ln=>!I(ln[0])),this.set.length===0)this.set=[Ye];else if(this.set.length>1){for(const ln of this.set)if(ln.length===1&&se(ln[0])){this.set=[ln];break}}}this.format()}format(){return this.range=this.set.map(Gt=>Gt.join(" ").trim()).join("||").trim(),this.range}toString(){return this.range}parseRange(Gt){Gt=Gt.trim();const jt=`parseRange:${Object.keys(this.options).join(",")}:${Gt}`,Ye=$.get(jt);if(Ye)return Ye;const ln=this.options.loose,nn=ln?R[W.HYPHENRANGELOOSE]:R[W.HYPHENRANGE];Gt=Gt.replace(nn,Xt(this.options.includePrerelease)),re("hyphen replace",Gt),Gt=Gt.replace(R[W.COMPARATORTRIM],q),re("comparator trim",Gt,R[W.COMPARATORTRIM]),Gt=(Gt=(Gt=Gt.replace(R[W.TILDETRIM],P)).replace(R[W.CARETTRIM],ee)).split(/\s+/).join(" ");const Bt=ln?R[W.COMPARATORLOOSE]:R[W.COMPARATOR],Pt=Gt.split(" ").map(St=>K(St,this.options)).join(" ").split(/\s+/).map(St=>Ut(St,this.options)).filter(this.options.loose?St=>!!St.match(Bt):()=>!0).map(St=>new B(St,this.options)),gn=(Pt.length,new Map);for(const St of Pt){if(I(St))return[St];gn.set(St.value,St)}gn.size>1&&gn.has("")&&gn.delete("");const Dt=[...gn.values()];return $.set(jt,Dt),Dt}intersects(Gt,jt){if(!(Gt instanceof b))throw new TypeError("a Range is required");return this.set.some(Ye=>ie(Ye,jt)&&Gt.set.some(ln=>ie(ln,jt)&&Ye.every(nn=>ln.every(Bt=>nn.intersects(Bt,jt)))))}test(Gt){if(!Gt)return!1;if(typeof Gt=="string")try{Gt=new J(Gt,this.options)}catch{return!1}for(let jt=0;jt<this.set.length;jt++)if(ke(this.set[jt],Gt,this.options))return!0;return!1}}Oe.exports=b;const $=new(a(335))({max:1e3}),U=a(115),B=a(113),re=a(116),J=a(32),{re:R,t:W,comparatorTrimReplace:q,tildeTrimReplace:P,caretTrimReplace:ee}=a(90),I=Ft=>Ft.value==="<0.0.0-0",se=Ft=>Ft.value==="",ie=(Ft,Gt)=>{let jt=!0;const Ye=Ft.slice();let ln=Ye.pop();for(;jt&&Ye.length;)jt=Ye.every(nn=>ln.intersects(nn,Gt)),ln=Ye.pop();return jt},K=(Ft,Gt)=>(re("comp",Ft,Gt),Ft=Te(Ft,Gt),re("caret",Ft),Ft=pe(Ft,Gt),re("tildes",Ft),Ft=we(Ft,Gt),re("xrange",Ft),Ft=_t(Ft,Gt),re("stars",Ft),Ft),de=Ft=>!Ft||Ft.toLowerCase()==="x"||Ft==="*",pe=(Ft,Gt)=>Ft.trim().split(/\s+/).map(jt=>Ae(jt,Gt)).join(" "),Ae=(Ft,Gt)=>{const jt=Gt.loose?R[W.TILDELOOSE]:R[W.TILDE];return Ft.replace(jt,(Ye,ln,nn,Bt,Pt)=>{let gn;return re("tilde",Ft,Ye,ln,nn,Bt,Pt),de(ln)?gn="":de(nn)?gn=`>=${ln}.0.0 <${+ln+1}.0.0-0`:de(Bt)?gn=`>=${ln}.${nn}.0 <${ln}.${+nn+1}.0-0`:Pt?(re("replaceTilde pr",Pt),gn=`>=${ln}.${nn}.${Bt}-${Pt} <${ln}.${+nn+1}.0-0`):gn=`>=${ln}.${nn}.${Bt} <${ln}.${+nn+1}.0-0`,re("tilde return",gn),gn})},Te=(Ft,Gt)=>Ft.trim().split(/\s+/).map(jt=>je(jt,Gt)).join(" "),je=(Ft,Gt)=>{re("caret",Ft,Gt);const jt=Gt.loose?R[W.CARETLOOSE]:R[W.CARET],Ye=Gt.includePrerelease?"-0":"";return Ft.replace(jt,(ln,nn,Bt,Pt,gn)=>{let Dt;return re("caret",Ft,ln,nn,Bt,Pt,gn),de(nn)?Dt="":de(Bt)?Dt=`>=${nn}.0.0${Ye} <${+nn+1}.0.0-0`:de(Pt)?Dt=nn==="0"?`>=${nn}.${Bt}.0${Ye} <${nn}.${+Bt+1}.0-0`:`>=${nn}.${Bt}.0${Ye} <${+nn+1}.0.0-0`:gn?(re("replaceCaret pr",gn),Dt=nn==="0"?Bt==="0"?`>=${nn}.${Bt}.${Pt}-${gn} <${nn}.${Bt}.${+Pt+1}-0`:`>=${nn}.${Bt}.${Pt}-${gn} <${nn}.${+Bt+1}.0-0`:`>=${nn}.${Bt}.${Pt}-${gn} <${+nn+1}.0.0-0`):(re("no pr"),Dt=nn==="0"?Bt==="0"?`>=${nn}.${Bt}.${Pt}${Ye} <${nn}.${Bt}.${+Pt+1}-0`:`>=${nn}.${Bt}.${Pt}${Ye} <${nn}.${+Bt+1}.0-0`:`>=${nn}.${Bt}.${Pt} <${+nn+1}.0.0-0`),re("caret return",Dt),Dt})},we=(Ft,Gt)=>(re("replaceXRanges",Ft,Gt),Ft.split(/\s+/).map(jt=>ot(jt,Gt)).join(" ")),ot=(Ft,Gt)=>{Ft=Ft.trim();const jt=Gt.loose?R[W.XRANGELOOSE]:R[W.XRANGE];return Ft.replace(jt,(Ye,ln,nn,Bt,Pt,gn)=>{re("xRange",Ft,Ye,ln,nn,Bt,Pt,gn);const Dt=de(nn),St=Dt||de(Bt),wn=St||de(Pt),Bn=wn;return ln==="="&&Bn&&(ln=""),gn=Gt.includePrerelease?"-0":"",Dt?Ye=ln===">"||ln==="<"?"<0.0.0-0":"*":ln&&Bn?(St&&(Bt=0),Pt=0,ln===">"?(ln=">=",St?(nn=+nn+1,Bt=0,Pt=0):(Bt=+Bt+1,Pt=0)):ln==="<="&&(ln="<",St?nn=+nn+1:Bt=+Bt+1),ln==="<"&&(gn="-0"),Ye=`${ln+nn}.${Bt}.${Pt}${gn}`):St?Ye=`>=${nn}.0.0${gn} <${+nn+1}.0.0-0`:wn&&(Ye=`>=${nn}.${Bt}.0${gn} <${nn}.${+Bt+1}.0-0`),re("xRange return",Ye),Ye})},_t=(Ft,Gt)=>(re("replaceStars",Ft,Gt),Ft.trim().replace(R[W.STAR],"")),Ut=(Ft,Gt)=>(re("replaceGTE0",Ft,Gt),Ft.trim().replace(R[Gt.includePrerelease?W.GTE0PRE:W.GTE0],"")),Xt=Ft=>(Gt,jt,Ye,ln,nn,Bt,Pt,gn,Dt,St,wn,Bn,Hn)=>`${jt=de(Ye)?"":de(ln)?`>=${Ye}.0.0${Ft?"-0":""}`:de(nn)?`>=${Ye}.${ln}.0${Ft?"-0":""}`:Bt?`>=${jt}`:`>=${jt}${Ft?"-0":""}`} ${gn=de(Dt)?"":de(St)?`<${+Dt+1}.0.0-0`:de(wn)?`<${Dt}.${+St+1}.0-0`:Bn?`<=${Dt}.${St}.${wn}-${Bn}`:Ft?`<${Dt}.${St}.${+wn+1}-0`:`<=${gn}`}`.trim(),ke=(Ft,Gt,jt)=>{for(let Ye=0;Ye<Ft.length;Ye++)if(!Ft[Ye].test(Gt))return!1;if(Gt.prerelease.length&&!jt.includePrerelease){for(let Ye=0;Ye<Ft.length;Ye++)if(re(Ft[Ye].semver),Ft[Ye].semver!==B.ANY&&Ft[Ye].semver.prerelease.length>0){const ln=Ft[Ye].semver;if(ln.major===Gt.major&&ln.minor===Gt.minor&&ln.patch===Gt.patch)return!0}return!1}return!0}},function(Oe,A,a){const b=a(32);Oe.exports=($,U,B)=>new b($,B).compare(new b(U,B))},function(Oe,A,a){var b=a(15);Oe.exports=function($,U){return!!$&&b(function(){U?$.call(null,function(){},1):$.call(null)})}},function(Oe,A,a){a.r(A);var b=function(je,we){if((ot=(je=we?je.toExponential(we-1):je.toExponential()).indexOf("e"))<0)return null;var ot,_t=je.slice(0,ot);return[_t.length>1?_t[0]+_t.slice(2):_t,+je.slice(ot+1)]},$=function(je){return(je=b(Math.abs(je)))?je[1]:NaN},U=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function B(je){return new re(je)}function re(je){if(!(we=U.exec(je)))throw new Error("invalid format: "+je);var we;this.fill=we[1]||" ",this.align=we[2]||">",this.sign=we[3]||"-",this.symbol=we[4]||"",this.zero=!!we[5],this.width=we[6]&&+we[6],this.comma=!!we[7],this.precision=we[8]&&+we[8].slice(1),this.trim=!!we[9],this.type=we[10]||""}B.prototype=re.prototype,re.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width==null?"":Math.max(1,0|this.width))+(this.comma?",":"")+(this.precision==null?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};var J,R,W,q,P=function(je){e:for(var we,ot=je.length,_t=1,Ut=-1;_t<ot;++_t)switch(je[_t]){case".":Ut=we=_t;break;case"0":Ut===0&&(Ut=_t),we=_t;break;default:if(Ut>0){if(!+je[_t])break e;Ut=0}}return Ut>0?je.slice(0,Ut)+je.slice(we+1):je},ee=function(je,we){var ot=b(je,we);if(!ot)return je+"";var _t=ot[0],Ut=ot[1];return Ut<0?"0."+new Array(-Ut).join("0")+_t:_t.length>Ut+1?_t.slice(0,Ut+1)+"."+_t.slice(Ut+1):_t+new Array(Ut-_t.length+2).join("0")},I={"%":function(je,we){return(100*je).toFixed(we)},b:function(je){return Math.round(je).toString(2)},c:function(je){return je+""},d:function(je){return Math.round(je).toString(10)},e:function(je,we){return je.toExponential(we)},f:function(je,we){return je.toFixed(we)},g:function(je,we){return je.toPrecision(we)},o:function(je){return Math.round(je).toString(8)},p:function(je,we){return ee(100*je,we)},r:ee,s:function(je,we){var ot=b(je,we);if(!ot)return je+"";var _t=ot[0],Ut=ot[1],Xt=Ut-(J=3*Math.max(-8,Math.min(8,Math.floor(Ut/3))))+1,ke=_t.length;return Xt===ke?_t:Xt>ke?_t+new Array(Xt-ke+1).join("0"):Xt>0?_t.slice(0,Xt)+"."+_t.slice(Xt):"0."+new Array(1-Xt).join("0")+b(je,Math.max(0,we+Xt-1))[0]},X:function(je){return Math.round(je).toString(16).toUpperCase()},x:function(je){return Math.round(je).toString(16)}},se=function(je){return je},ie=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"],K=function(je){var we=je.grouping&&je.thousands?function(Ft,Gt){return function(jt,Ye){for(var ln=jt.length,nn=[],Bt=0,Pt=Ft[0],gn=0;ln>0&&Pt>0&&(gn+Pt+1>Ye&&(Pt=Math.max(1,Ye-gn)),nn.push(jt.substring(ln-=Pt,ln+Pt)),!((gn+=Pt+1)>Ye));)Pt=Ft[Bt=(Bt+1)%Ft.length];return nn.reverse().join(Gt)}}(je.grouping,je.thousands):se,ot=je.currency,_t=je.decimal,Ut=je.numerals?function(Ft){return function(Gt){return Gt.replace(/[0-9]/g,function(jt){return Ft[+jt]})}}(je.numerals):se,Xt=je.percent||"%";function ke(Ft){var Gt=(Ft=B(Ft)).fill,jt=Ft.align,Ye=Ft.sign,ln=Ft.symbol,nn=Ft.zero,Bt=Ft.width,Pt=Ft.comma,gn=Ft.precision,Dt=Ft.trim,St=Ft.type;St==="n"?(Pt=!0,St="g"):I[St]||(gn==null&&(gn=12),Dt=!0,St="g"),(nn||Gt==="0"&&jt==="=")&&(nn=!0,Gt="0",jt="=");var wn=ln==="$"?ot[0]:ln==="#"&&/[boxX]/.test(St)?"0"+St.toLowerCase():"",Bn=ln==="$"?ot[1]:/[%p]/.test(St)?Xt:"",Hn=I[St],hn=/[defgprs%]/.test(St);function Ve(Qe){var He,pt,Lt,zt=wn,Tn=Bn;if(St==="c")Tn=Hn(Qe)+Tn,Qe="";else{var xn=(Qe=+Qe)<0;if(Qe=Hn(Math.abs(Qe),gn),Dt&&(Qe=P(Qe)),xn&&+Qe==0&&(xn=!1),zt=(xn?Ye==="("?Ye:"-":Ye==="-"||Ye==="("?"":Ye)+zt,Tn=(St==="s"?ie[8+J/3]:"")+Tn+(xn&&Ye==="("?")":""),hn){for(He=-1,pt=Qe.length;++He<pt;)if(48>(Lt=Qe.charCodeAt(He))||Lt>57){Tn=(Lt===46?_t+Qe.slice(He+1):Qe.slice(He))+Tn,Qe=Qe.slice(0,He);break}}}Pt&&!nn&&(Qe=we(Qe,1/0));var Kn=zt.length+Qe.length+Tn.length,be=Kn<Bt?new Array(Bt-Kn+1).join(Gt):"";switch(Pt&&nn&&(Qe=we(be+Qe,be.length?Bt-Tn.length:1/0),be=""),jt){case"<":Qe=zt+Qe+Tn+be;break;case"=":Qe=zt+be+Qe+Tn;break;case"^":Qe=be.slice(0,Kn=be.length>>1)+zt+Qe+Tn+be.slice(Kn);break;default:Qe=be+zt+Qe+Tn}return Ut(Qe)}return gn=gn==null?6:/[gprs]/.test(St)?Math.max(1,Math.min(21,gn)):Math.max(0,Math.min(20,gn)),Ve.toString=function(){return Ft+""},Ve}return{format:ke,formatPrefix:function(Ft,Gt){var jt=ke(((Ft=B(Ft)).type="f",Ft)),Ye=3*Math.max(-8,Math.min(8,Math.floor($(Gt)/3))),ln=Math.pow(10,-Ye),nn=ie[8+Ye/3];return function(Bt){return jt(ln*Bt)+nn}}}};function de(je){return R=K(je),W=R.format,q=R.formatPrefix,R}de({decimal:".",thousands:",",grouping:[3],currency:["$",""]});var pe=function(je){return Math.max(0,-$(Math.abs(je)))},Ae=function(je,we){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor($(we)/3)))-$(Math.abs(je)))},Te=function(je,we){return je=Math.abs(je),we=Math.abs(we)-je,Math.max(0,$(we)-$(je))+1};a.d(A,"formatDefaultLocale",function(){return de}),a.d(A,"format",function(){return W}),a.d(A,"formatPrefix",function(){return q}),a.d(A,"formatLocale",function(){return K}),a.d(A,"formatSpecifier",function(){return B}),a.d(A,"precisionFixed",function(){return pe}),a.d(A,"precisionPrefix",function(){return Ae}),a.d(A,"precisionRound",function(){return Te})},function(Oe,A,a){var b=a(56),$=a(107),U=a(34),B=a(22),re=a(224);Oe.exports=function(J,R){var W=J==1,q=J==2,P=J==3,ee=J==4,I=J==6,se=J==5||I,ie=R||re;return function(K,de,pe){for(var Ae,Te,je=U(K),we=$(je),ot=b(de,pe,3),_t=B(we.length),Ut=0,Xt=W?ie(K,_t):q?ie(K,0):void 0;_t>Ut;Ut++)if((se||Ut in we)&&(Te=ot(Ae=we[Ut],Ut,je),J)){if(W)Xt[Ut]=Te;else if(Te)switch(J){case 3:return!0;case 5:return Ae;case 6:return Ut;case 2:Xt.push(Ae)}else if(ee)return!1}return I?-1:P||ee?ee:Xt}}},function(Oe,A,a){var b=a(8),$=a(24),U=a(15);Oe.exports=function(B,re){var J=($.Object||{})[B]||Object[B],R={};R[B]=re(J),b(b.S+b.F*U(function(){J(1)}),"Object",R)}},function(Oe,A,a){var b=a(106),$=a(85),U=a(41),B=a(66),re=a(43),J=a(240),R=Object.getOwnPropertyDescriptor;A.f=a(27)?R:function(W,q){if(W=U(W),q=B(q,!0),J)try{return R(W,q)}catch{}if(re(W,q))return $(!b.f.call(W,q),W[q])}},function(Oe,A){var a=Math.ceil,b=Math.floor;Oe.exports=function($){return isNaN($=+$)?0:($>0?b:a)($)}},function(Oe,A){Oe.exports=function(a){if(typeof a!="function")throw TypeError(a+" is not a function!");return a}},function(Oe,A,a){var b=a(55);Oe.exports=function($,U,B){if(b($),U===void 0)return $;switch(B){case 1:return function(re){return $.call(U,re)};case 2:return function(re,J){return $.call(U,re,J)};case 3:return function(re,J,R){return $.call(U,re,J,R)}}return function(){return $.apply(U,arguments)}}},function(Oe,A,a){var b=a(7).default,$=a(258);Oe.exports=function(U,B){if(B&&(b(B)==="object"||typeof B=="function"))return B;if(B!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return $(U)},Oe.exports.__esModule=!0,Oe.exports.default=Oe.exports},function(Oe,A,a){var b=a(259);Oe.exports=function($,U){if(typeof U!="function"&&U!==null)throw new TypeError("Super expression must either be null or a function");$.prototype=Object.create(U&&U.prototype,{constructor:{value:$,writable:!0,configurable:!0}}),Object.defineProperty($,"prototype",{writable:!1}),U&&b($,U)},Oe.exports.__esModule=!0,Oe.exports.default=Oe.exports},function(Oe,A){var a;a=function(){return this}();try{a=a||Function("return this")()||(0,eval)("this")}catch{typeof window=="object"&&(a=window)}Oe.exports=a},function(Oe,A,a){if(a(27)){var b=a(83),$=a(16),U=a(15),B=a(8),re=a(118),J=a(151),R=a(56),W=a(94),q=a(85),P=a(42),ee=a(93),I=a(54),se=a(22),ie=a(213),K=a(81),de=a(66),pe=a(43),Ae=a(105),Te=a(13),je=a(34),we=a(159),ot=a(80),_t=a(78),Ut=a(79).f,Xt=a(157),ke=a(84),Ft=a(19),Gt=a(51),jt=a(128),Ye=a(104),ln=a(155),nn=a(96),Bt=a(125),Pt=a(95),gn=a(156),Dt=a(222),St=a(26),wn=a(53),Bn=St.f,Hn=wn.f,hn=$.RangeError,Ve=$.TypeError,Qe=$.Uint8Array,He=Array.prototype,pt=J.ArrayBuffer,Lt=J.DataView,zt=Gt(0),Tn=Gt(2),xn=Gt(3),Kn=Gt(4),be=Gt(5),Yn=Gt(6),Dr=jt(!0),pr=jt(!1),Nr=ln.values,Fr=ln.keys,an=ln.entries,Kt=He.lastIndexOf,Zt=He.reduce,$n=He.reduceRight,Dn=He.join,hr=He.sort,wr=He.slice,gr=He.toString,Qr=He.toLocaleString,ti=Ft("iterator"),Mr=Ft("toStringTag"),di=ke("typed_constructor"),Yr=ke("def_constructor"),Xr=re.CONSTR,fi=re.TYPED,oi=re.VIEW,Ao=Gt(1,function(Ht,Ue){return Mt(Ye(Ht,Ht[Yr]),Ue)}),Wi=U(function(){return new Qe(new Uint16Array([1]).buffer)[0]===1}),Ei=!!Qe&&!!Qe.prototype.set&&U(function(){new Qe(1).set({})}),bt=function(Ht,Ue){var Mn=I(Ht);if(Mn<0||Mn%Ue)throw hn("Wrong offset!");return Mn},Lr=function(Ht){if(Te(Ht)&&fi in Ht)return Ht;throw Ve(Ht+" is not a typed array!")},Mt=function(Ht,Ue){if(!(Te(Ht)&&di in Ht))throw Ve("It is not a typed array constructor!");return new Ht(Ue)},ge=function(Ht,Ue){return le(Ye(Ht,Ht[Yr]),Ue)},le=function(Ht,Ue){for(var Mn=0,Gn=Ue.length,Zn=Mt(Ht,Gn);Gn>Mn;)Zn[Mn]=Ue[Mn++];return Zn},ye=function(Ht,Ue,Mn){Bn(Ht,Ue,{get:function(){return this._d[Mn]}})},_e=function(Ht){var Ue,Mn,Gn,Zn,ir,zr,vr=je(Ht),pi=arguments.length,fo=pi>1?arguments[1]:void 0,ui=fo!==void 0,Zi=Xt(vr);if(Zi!=null&&!we(Zi)){for(zr=Zi.call(vr),Gn=[],Ue=0;!(ir=zr.next()).done;Ue++)Gn.push(ir.value);vr=Gn}for(ui&&pi>2&&(fo=R(fo,arguments[2],2)),Ue=0,Mn=se(vr.length),Zn=Mt(this,Mn);Mn>Ue;Ue++)Zn[Ue]=ui?fo(vr[Ue],Ue):vr[Ue];return Zn},et=function(){for(var Ht=0,Ue=arguments.length,Mn=Mt(this,Ue);Ue>Ht;)Mn[Ht]=arguments[Ht++];return Mn},gt=!!Qe&&U(function(){Qr.call(new Qe(1))}),Rt=function(){return Qr.apply(gt?wr.call(Lr(this)):Lr(this),arguments)},fn={copyWithin:function(Ht,Ue){return Dt.call(Lr(this),Ht,Ue,arguments.length>2?arguments[2]:void 0)},every:function(Ht){return Kn(Lr(this),Ht,arguments.length>1?arguments[1]:void 0)},fill:function(Ht){return gn.apply(Lr(this),arguments)},filter:function(Ht){return ge(this,Tn(Lr(this),Ht,arguments.length>1?arguments[1]:void 0))},find:function(Ht){return be(Lr(this),Ht,arguments.length>1?arguments[1]:void 0)},findIndex:function(Ht){return Yn(Lr(this),Ht,arguments.length>1?arguments[1]:void 0)},forEach:function(Ht){zt(Lr(this),Ht,arguments.length>1?arguments[1]:void 0)},indexOf:function(Ht){return pr(Lr(this),Ht,arguments.length>1?arguments[1]:void 0)},includes:function(Ht){return Dr(Lr(this),Ht,arguments.length>1?arguments[1]:void 0)},join:function(Ht){return Dn.apply(Lr(this),arguments)},lastIndexOf:function(Ht){return Kt.apply(Lr(this),arguments)},map:function(Ht){return Ao(Lr(this),Ht,arguments.length>1?arguments[1]:void 0)},reduce:function(Ht){return Zt.apply(Lr(this),arguments)},reduceRight:function(Ht){return $n.apply(Lr(this),arguments)},reverse:function(){for(var Ht,Ue=Lr(this).length,Mn=Math.floor(Ue/2),Gn=0;Gn<Mn;)Ht=this[Gn],this[Gn++]=this[--Ue],this[Ue]=Ht;return this},some:function(Ht){return xn(Lr(this),Ht,arguments.length>1?arguments[1]:void 0)},sort:function(Ht){return hr.call(Lr(this),Ht)},subarray:function(Ht,Ue){var Mn=Lr(this),Gn=Mn.length,Zn=K(Ht,Gn);return new(Ye(Mn,Mn[Yr]))(Mn.buffer,Mn.byteOffset+Zn*Mn.BYTES_PER_ELEMENT,se((Ue===void 0?Gn:K(Ue,Gn))-Zn))}},Jn=function(Ht,Ue){return ge(this,wr.call(Lr(this),Ht,Ue))},An=function(Ht){Lr(this);var Ue=bt(arguments[1],1),Mn=this.length,Gn=je(Ht),Zn=se(Gn.length),ir=0;if(Zn+Ue>Mn)throw hn("Wrong length!");for(;ir<Zn;)this[Ue+ir]=Gn[ir++]},Ln={entries:function(){return an.call(Lr(this))},keys:function(){return Fr.call(Lr(this))},values:function(){return Nr.call(Lr(this))}},qn=function(Ht,Ue){return Te(Ht)&&Ht[fi]&&typeof Ue!="symbol"&&Ue in Ht&&String(+Ue)==String(Ue)},Nt=function(Ht,Ue){return qn(Ht,Ue=de(Ue,!0))?q(2,Ht[Ue]):Hn(Ht,Ue)},Ot=function(Ht,Ue,Mn){return!(qn(Ht,Ue=de(Ue,!0))&&Te(Mn)&&pe(Mn,"value"))||pe(Mn,"get")||pe(Mn,"set")||Mn.configurable||pe(Mn,"writable")&&!Mn.writable||pe(Mn,"enumerable")&&!Mn.enumerable?Bn(Ht,Ue,Mn):(Ht[Ue]=Mn.value,Ht)};Xr||(wn.f=Nt,St.f=Ot),B(B.S+B.F*!Xr,"Object",{getOwnPropertyDescriptor:Nt,defineProperty:Ot}),U(function(){gr.call({})})&&(gr=Qr=function(){return Dn.call(this)});var pn=ee({},fn);ee(pn,Ln),P(pn,ti,Ln.values),ee(pn,{slice:Jn,set:An,constructor:function(){},toString:gr,toLocaleString:Rt}),ye(pn,"buffer","b"),ye(pn,"byteOffset","o"),ye(pn,"byteLength","l"),ye(pn,"length","e"),Bn(pn,Mr,{get:function(){return this[fi]}}),Oe.exports=function(Ht,Ue,Mn,Gn){var Zn=Ht+((Gn=!!Gn)?"Clamped":"")+"Array",ir="get"+Ht,zr="set"+Ht,vr=$[Zn],pi=vr||{},fo=vr&&_t(vr),ui=!vr||!re.ABV,Zi={},Ti=vr&&vr.prototype,qr=function(Vi,Rr){Bn(Vi,Rr,{get:function(){return function(ao,yo){var eo=ao._d;return eo.v[ir](yo*Ue+eo.o,Wi)}(this,Rr)},set:function(ao){return function(yo,eo,bo){var Na=yo._d;Gn&&(bo=(bo=Math.round(bo))<0?0:bo>255?255:255&bo),Na.v[zr](eo*Ue+Na.o,bo,Wi)}(this,Rr,ao)},enumerable:!0})};ui?(vr=Mn(function(Vi,Rr,ao,yo){W(Vi,vr,Zn,"_d");var eo,bo,Na,vs,Eh=0,qi=0;if(Te(Rr)){if(!(Rr instanceof pt||(vs=Ae(Rr))=="ArrayBuffer"||vs=="SharedArrayBuffer"))return fi in Rr?le(vr,Rr):_e.call(vr,Rr);eo=Rr,qi=bt(ao,Ue);var ec=Rr.byteLength;if(yo===void 0){if(ec%Ue||(bo=ec-qi)<0)throw hn("Wrong length!")}else if((bo=se(yo)*Ue)+qi>ec)throw hn("Wrong length!");Na=bo/Ue}else Na=ie(Rr),eo=new pt(bo=Na*Ue);for(P(Vi,"_d",{b:eo,o:qi,l:bo,e:Na,v:new Lt(eo)});Eh<Na;)qr(Vi,Eh++)}),Ti=vr.prototype=ot(pn),P(Ti,"constructor",vr)):U(function(){vr(1)})&&U(function(){new vr(-1)})&&Bt(function(Vi){new vr,new vr(null),new vr(1.5),new vr(Vi)},!0)||(vr=Mn(function(Vi,Rr,ao,yo){var eo;return W(Vi,vr,Zn),Te(Rr)?Rr instanceof pt||(eo=Ae(Rr))=="ArrayBuffer"||eo=="SharedArrayBuffer"?yo!==void 0?new pi(Rr,bt(ao,Ue),yo):ao!==void 0?new pi(Rr,bt(ao,Ue)):new pi(Rr):fi in Rr?le(vr,Rr):_e.call(vr,Rr):new pi(ie(Rr))}),zt(fo!==Function.prototype?Ut(pi).concat(Ut(fo)):Ut(pi),function(Vi){Vi in vr||P(vr,Vi,pi[Vi])}),vr.prototype=Ti,b||(Ti.constructor=vr));var jr=Ti[ti],jn=!!jr&&(jr.name=="values"||jr.name==null),ri=Ln.values;P(vr,di,!0),P(Ti,fi,Zn),P(Ti,oi,!0),P(Ti,Yr,vr),(Gn?new vr(1)[Mr]==Zn:Mr in Ti)||Bn(Ti,Mr,{get:function(){return Zn}}),Zi[Zn]=vr,B(B.G+B.W+B.F*(vr!=pi),Zi),B(B.S,Zn,{BYTES_PER_ELEMENT:Ue}),B(B.S+B.F*U(function(){pi.of.call(vr,1)}),Zn,{from:_e,of:et}),"BYTES_PER_ELEMENT"in Ti||P(Ti,"BYTES_PER_ELEMENT",Ue),B(B.P,Zn,fn),Pt(Zn),B(B.P+B.F*Ei,Zn,{set:An}),B(B.P+B.F*!jn,Zn,Ln),b||Ti.toString==gr||(Ti.toString=gr),B(B.P+B.F*U(function(){new vr(1).slice()}),Zn,{slice:Jn}),B(B.P+B.F*(U(function(){return[1,2].toLocaleString()!=new vr([1,2]).toLocaleString()})||!U(function(){Ti.toLocaleString.call([1,2])})),Zn,{toLocaleString:Rt}),nn[Zn]=jn?jr:ri,b||jn||P(Ti,ti,ri)}}else Oe.exports=function(){}},function(Oe,A){Oe.exports=function(a){if(a==null)throw TypeError("Can't call method on  "+a);return a}},function(Oe,A){var a={}.toString;Oe.exports=function(b){return a.call(b).slice(8,-1)}},function(Oe,A,a){(function(b){a.d(A,"a",function(){return Ut}),a.d(A,"b",function(){return Xt}),a.d(A,"c",function(){return pe}),a.d(A,"d",function(){return Ae}),a.d(A,"e",function(){return Gt}),a.d(A,"f",function(){return Ft}),a.d(A,"g",function(){return ke}),a.d(A,"h",function(){return ie});var $=a(1),U=a(582),B=a(176),re=a(44);const J=/^(data:|([A-Za-z]+:)?\/\/)/,R=/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|cid|xmpp|file|data):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i,W=/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205f\u3000]/g,q="file://";async function P(){Object($.o)("No file system access.")}async function ee(){Object($.o)("No HTTP fetch method available.")}const I=jt=>jt!=null&&jt==jt,se=jt=>!(Number.isNaN(+jt)||jt instanceof Date),ie={boolean:$.Ca,integer:$.Ea,number:$.Ea,date:$.Da,string:$.Ga,unknown:$.y},K=[jt=>jt==="true"||jt==="false"||jt===!0||jt===!1,jt=>se(jt)&&Number.isInteger(+jt),se,jt=>!Number.isNaN(Date.parse(jt))],de=["boolean","integer","number","date"];function pe(jt,Ye){if(!jt||!jt.length)return"unknown";const ln=jt.length,nn=K.length,Bt=K.map((Pt,gn)=>gn+1);for(let Pt,gn,Dt=0,St=0;Dt<ln;++Dt)for(gn=Ye?jt[Dt][Ye]:jt[Dt],Pt=0;Pt<nn;++Pt)if(Bt[Pt]&&I(gn)&&!K[Pt](gn)&&(Bt[Pt]=0,++St===K.length))return"string";return de[Bt.reduce((Pt,gn)=>Pt===0?gn:Pt,0)-1]}function Ae(jt,Ye){return Ye.reduce((ln,nn)=>(ln[nn]=pe(jt,nn),ln),{})}function Te(jt){const Ye=function(ln,nn){const Bt={delimiter:jt};return je(ln,nn?Object($.p)(nn,Bt):Bt)};return Ye.responseType="text",Ye}function je(jt,Ye){return Ye.header&&(jt=Ye.header.map($.Ba).join(Ye.delimiter)+`
`+jt),Object(U.a)(Ye.delimiter).parse(jt+"")}function we(jt,Ye){const ln=Ye&&Ye.property?Object($.u)(Ye.property):$.y;return Object($.H)(jt)&&!function(nn){return!(typeof b!="function"||!Object($.E)(b.isBuffer))&&b.isBuffer(nn)}(jt)?function(nn,Bt){return!Object($.B)(nn)&&Object($.F)(nn)&&(nn=[...nn]),Bt&&Bt.copy?JSON.parse(JSON.stringify(nn)):nn}(ln(jt),Ye):ln(JSON.parse(jt))}je.responseType="text",we.responseType="json";const ot={interior:(jt,Ye)=>jt!==Ye,exterior:(jt,Ye)=>jt===Ye};function _t(jt,Ye){let ln,nn,Bt,Pt;return jt=we(jt,Ye),Ye&&Ye.feature?(ln=B.a,Bt=Ye.feature):Ye&&Ye.mesh?(ln=B.b,Bt=Ye.mesh,Pt=ot[Ye.filter]):Object($.o)("Missing TopoJSON feature or mesh parameter."),(nn=(nn=jt.objects[Bt])?ln(jt,nn,Pt):Object($.o)("Invalid TopoJSON object: "+Bt))&&nn.features||[nn]}_t.responseType="json";const Ut={dsv:je,csv:Te(","),tsv:Te("	"),json:we,topojson:_t};function Xt(jt,Ye){return arguments.length>1?(Ut[jt]=Ye,this):Object($.w)(Ut,jt)?Ut[jt]:null}function ke(jt){const Ye=Xt(jt);return Ye&&Ye.responseType||"text"}function Ft(jt,Ye,ln,nn){const Bt=Xt((Ye=Ye||{}).type||"json");return Bt||Object($.o)("Unknown data format type: "+Ye.type),jt=Bt(jt,Ye),Ye.parse&&function(Pt,gn,Dt,St){if(!Pt.length)return;const wn=Object(re.e)();Dt=Dt||wn.timeParse,St=St||wn.utcParse;let Bn,Hn,hn,Ve,Qe,He,pt=Pt.columns||Object.keys(Pt[0]);gn==="auto"&&(gn=Ae(Pt,pt));const Lt=(pt=Object.keys(gn)).map(zt=>{const Tn=gn[zt];let xn,Kn;if(Tn&&(Tn.startsWith("date:")||Tn.startsWith("utc:")))return xn=Tn.split(/:(.+)?/,2),((Kn=xn[1])[0]==="'"&&Kn[Kn.length-1]==="'"||Kn[0]==='"'&&Kn[Kn.length-1]==='"')&&(Kn=Kn.slice(1,-1)),(xn[0]==="utc"?St:Dt)(Kn);if(!ie[Tn])throw Error("Illegal format pattern: "+zt+":"+Tn);return ie[Tn]});for(hn=0,Qe=Pt.length,He=pt.length;hn<Qe;++hn)for(Bn=Pt[hn],Ve=0;Ve<He;++Ve)Hn=pt[Ve],Bn[Hn]=Lt[Ve](Bn[Hn])}(jt,Ye.parse,ln,nn),Object($.w)(jt,"columns")&&delete jt.columns,jt}const Gt=function(jt,Ye){return ln=>({options:ln||{},sanitize:async function(nn,Bt){Bt=Object($.p)({},this.options,Bt);const Pt=this.fileAccess,gn={href:null};let Dt,St,wn;const Bn=R.test(nn.replace(W,""));nn!=null&&typeof nn=="string"&&Bn||Object($.o)("Sanitize failure, invalid URI: "+Object($.Ba)(nn));const Hn=J.test(nn);return(wn=Bt.baseURL)&&!Hn&&(nn.startsWith("/")||wn.endsWith("/")||(nn="/"+nn),nn=wn+nn),St=(Dt=nn.startsWith(q))||Bt.mode==="file"||Bt.mode!=="http"&&!Hn&&Pt,Dt?nn=nn.slice(q.length):nn.startsWith("//")&&(Bt.defaultProtocol==="file"?(nn=nn.slice(2),St=!0):nn=(Bt.defaultProtocol||"http")+":"+nn),Object.defineProperty(gn,"localFile",{value:!!St}),gn.href=nn,Bt.target&&(gn.target=Bt.target+""),Bt.rel&&(gn.rel=Bt.rel+""),Bt.context==="image"&&Bt.crossOrigin&&(gn.crossOrigin=Bt.crossOrigin+""),gn},load:async function(nn,Bt){const Pt=await this.sanitize(nn,Bt),gn=Pt.href;return Pt.localFile?this.file(gn):this.http(gn,Bt)},fileAccess:!!Ye,file:function(nn){return nn?Bt=>new Promise((Pt,gn)=>{nn.readFile(Bt,(Dt,St)=>{Dt?gn(Dt):Pt(St)})}):P}(Ye),http:function(nn){return nn?async function(Bt,Pt){const gn=Object($.p)({},this.options.http,Pt),Dt=Pt&&Pt.response,St=await nn(Bt,gn);return St.ok?Object($.E)(St[Dt])?St[Dt]():St.text():Object($.o)(St.status+""+St.statusText)}:ee}(jt)})}(typeof fetch<"u"&&fetch,null)}).call(this,a(92).Buffer)},function(Oe,A,a){/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Object.defineProperty(A,"__esModule",{value:!0});const b=a(102),$=a(46),U={prepend:!1};A.subSurface=function(B,re,J={}){const R=$.getDrawArea(B),W=b.css({"& canvas":{display:"block"},marginTop:".5rem",marginBottom:".5rem"}),q=b.css({backgroundColor:"white",display:"inline-block",boxSizing:"border-box",borderBottom:"1px solid #357EDD",lineHeight:"2em",padding:"0 10px 0 10px",marginBottom:"20px",fontWeight:"600",textAlign:"left"}),P=Object.assign({},U,J);let ee=R.querySelector(`div[data-name=${re}]`);if(!ee){if((ee=document.createElement("div")).setAttribute("class",`${W}`),ee.dataset.name=re,P.title){const I=document.createElement("div");I.setAttribute("class",`subsurface-title ${q}`),I.innerText=P.title,ee.appendChild(I)}P.prepend?R.insertBefore(ee,R.firstChild):R.appendChild(ee)}return ee},A.getDefaultWidth=function(B){let re=0,J=B;for(;J&&J.clientWidth===0;)J=J.parentElement,re=50;return J.clientWidth-re},A.getDefaultHeight=function(B){return B.clientHeight===0?200:B.clientHeight}},function(Oe,A,a){var b=a(84)("meta"),$=a(13),U=a(43),B=a(26).f,re=0,J=Object.isExtensible||function(){return!0},R=!a(15)(function(){return J(Object.preventExtensions({}))}),W=function(P){B(P,b,{value:{i:"O"+ ++re,w:{}}})},q=Oe.exports={KEY:b,NEED:!1,fastKey:function(P,ee){if(!$(P))return typeof P=="symbol"?P:(typeof P=="string"?"S":"P")+P;if(!U(P,b)){if(!J(P))return"F";if(!ee)return"E";W(P)}return P[b].i},getWeak:function(P,ee){if(!U(P,b)){if(!J(P))return!0;if(!ee)return!1;W(P)}return P[b].w},onFreeze:function(P){return R&&q.NEED&&J(P)&&!U(P,b)&&W(P),P}}},function(Oe,A,a){var b=a(13);Oe.exports=function($,U){if(!b($))return $;var B,re;if(U&&typeof(B=$.toString)=="function"&&!b(re=B.call($))||typeof(B=$.valueOf)=="function"&&!b(re=B.call($))||!U&&typeof(B=$.toString)=="function"&&!b(re=B.call($)))return re;throw TypeError("Can't convert object to primitive value")}},function(Oe,A,a){Object.defineProperty(A,"__esModule",{value:!0}),a(0),a(384);const b=a(349),$=a(289),U=a(288),B=a(137),re=a(196),J=a(287),R=a(109),W=a(286),q=a(285),P=a(284),ee=a(283),I=a(110),se=a(282);A.version_vis=se.version;const ie={barchart:b.barchart,table:R.table,histogram:B.histogram,linechart:re.linechart,scatterplot:J.scatterplot,confusionMatrix:$.confusionMatrix,heatmap:U.heatmap};A.render=ie;const K={accuracy:I.accuracy,perClassAccuracy:I.perClassAccuracy,confusionMatrix:I.confusionMatrix};A.metrics=K;const de={history:W.history,fitCallbacks:W.fitCallbacks,perClassAccuracy:P.perClassAccuracy,valuesDistribution:ee.valuesDistribution,layer:q.layer,modelSummary:q.modelSummary};A.show=de;var pe=a(197);A.visor=pe.visor,function(Ae){for(var Te in Ae)A.hasOwnProperty(Te)||(A[Te]=Ae[Te])}(a(198))},function(Oe,A,a){var b=a(31),$=Object(b.a)(function(U){U.setUTCMonth(0,1),U.setUTCHours(0,0,0,0)},function(U,B){U.setUTCFullYear(U.getUTCFullYear()+B)},function(U,B){return B.getUTCFullYear()-U.getUTCFullYear()},function(U){return U.getUTCFullYear()});$.every=function(U){return isFinite(U=Math.floor(U))&&U>0?Object(b.a)(function(B){B.setUTCFullYear(Math.floor(B.getUTCFullYear()/U)*U),B.setUTCMonth(0,1),B.setUTCHours(0,0,0,0)},function(B,re){B.setUTCFullYear(B.getUTCFullYear()+re*U)}):null},A.a=$,$.range},function(Oe,A,a){var b=a(31),$=a(12),U=Object(b.a)(function(B){B.setTime(B-B.getMilliseconds())},function(B,re){B.setTime(+B+re*$.e)},function(B,re){return(re-B)/$.e},function(B){return B.getUTCSeconds()});A.a=U,U.range},function(Oe,A,a){var b=a(31),$=Object(b.a)(function(U){U.setMonth(0,1),U.setHours(0,0,0,0)},function(U,B){U.setFullYear(U.getFullYear()+B)},function(U,B){return B.getFullYear()-U.getFullYear()},function(U){return U.getFullYear()});$.every=function(U){return isFinite(U=Math.floor(U))&&U>0?Object(b.a)(function(B){B.setFullYear(Math.floor(B.getFullYear()/U)*U),B.setMonth(0,1),B.setHours(0,0,0,0)},function(B,re){B.setFullYear(B.getFullYear()+re*U)}):null},A.a=$,$.range},function(Oe,A,a){var b=a(31),$=a(12),U=Object(b.a)(function(B){B.setUTCHours(0,0,0,0)},function(B,re){B.setUTCDate(B.getUTCDate()+re)},function(B,re){return(re-B)/$.a},function(B){return B.getUTCDate()-1});A.a=U,U.range},function(Oe,A,a){var b=a(31),$=a(12),U=Object(b.a)(B=>B.setHours(0,0,0,0),(B,re)=>B.setDate(B.getDate()+re),(B,re)=>(re-B-(re.getTimezoneOffset()-B.getTimezoneOffset())*$.c)/$.a,B=>B.getDate()-1);A.a=U,U.range},function(Oe,A,a){Object.defineProperty(A,"__esModule",{value:!0}),A.Add="Add",A.AddN="AddN",A.Div="Div",A.FusedBatchNorm="FusedBatchNorm",A.SquaredDifference="SquaredDifference",A.Square="Square",A.Transpose="Transpose",A.NonMaxSuppressionV5="NonMaxSuppressionV5",A.BroadcastTo="BroadcastTo",A.OneHot="OneHot",A.Identity="Identity",A.Tile="Tile",A.PadV2="PadV2",A.FromPixels="FromPixels",A.MaxPoolWithArgmax="MaxPoolWithArgmax"},function(Oe,A,a){/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Object.defineProperty(A,"__esModule",{value:!0});var b=a(33),$=a(378),U=a(21);A.makeTypesMatch=function(B,re){if(B.dtype===re.dtype)return[B,re];var J=$.upcastType(B.dtype,re.dtype);return[B.cast(J),re.cast(J)]},A.assertTypesMatch=function(B,re){U.assert(B.dtype===re.dtype,function(){return"The dtypes of the first("+B.dtype+") and second("+re.dtype+") input must match"})},A.isTensorInList=function(B,re){return re.some(function(J){return J.id===B.id})},A.getTensorsInContainer=function(B){var re=[];return function J(R,W,q){if(R!=null){if(R instanceof b.Tensor)W.push(R);else if(function(se){return Array.isArray(se)||typeof se=="object"}(R)){var P=R;for(var ee in P){var I=P[ee];q.has(I)||(q.add(I),J(I,W,q))}}}}(B,re,new Set),re}},function(Oe,A){var a,b,$=Oe.exports={};function U(){throw new Error("setTimeout has not been defined")}function B(){throw new Error("clearTimeout has not been defined")}function re(ie){if(a===setTimeout)return setTimeout(ie,0);if((a===U||!a)&&setTimeout)return a=setTimeout,setTimeout(ie,0);try{return a(ie,0)}catch{try{return a.call(null,ie,0)}catch{return a.call(this,ie,0)}}}(function(){try{a=typeof setTimeout=="function"?setTimeout:U}catch{a=U}try{b=typeof clearTimeout=="function"?clearTimeout:B}catch{b=B}})();var J,R=[],W=!1,q=-1;function P(){W&&J&&(W=!1,J.length?R=J.concat(R):q=-1,R.length&&ee())}function ee(){if(!W){var ie=re(P);W=!0;for(var K=R.length;K;){for(J=R,R=[];++q<K;)J&&J[q].run();q=-1,K=R.length}J=null,W=!1,function(de){if(b===clearTimeout)return clearTimeout(de);if((b===B||!b)&&clearTimeout)return b=clearTimeout,clearTimeout(de);try{b(de)}catch{try{return b.call(null,de)}catch{return b.call(this,de)}}}(ie)}}function I(ie,K){this.fun=ie,this.array=K}function se(){}$.nextTick=function(ie){var K=new Array(arguments.length-1);if(arguments.length>1)for(var de=1;de<arguments.length;de++)K[de-1]=arguments[de];R.push(new I(ie,K)),R.length!==1||W||re(ee)},I.prototype.run=function(){this.fun.apply(null,this.array)},$.title="browser",$.browser=!0,$.env={},$.argv=[],$.version="",$.versions={},$.on=se,$.addListener=se,$.once=se,$.off=se,$.removeListener=se,$.removeAllListeners=se,$.emit=se,$.prependListener=se,$.prependOnceListener=se,$.listeners=function(ie){return[]},$.binding=function(ie){throw new Error("process.binding is not supported")},$.cwd=function(){return"/"},$.chdir=function(ie){throw new Error("process.chdir is not supported")},$.umask=function(){return 0}},function(Oe,A,a){var b=a(13);Oe.exports=function($,U){if(!b($)||$._t!==U)throw TypeError("Incompatible receiver, "+U+" required!");return $}},function(Oe,A,a){var b=a(19)("unscopables"),$=Array.prototype;$[b]==null&&a(42)($,b,{}),Oe.exports=function(U){$[b][U]=!0}},function(Oe,A,a){var b=a(43),$=a(34),U=a(173)("IE_PROTO"),B=Object.prototype;Oe.exports=Object.getPrototypeOf||function(re){return re=$(re),b(re,U)?re[U]:typeof re.constructor=="function"&&re instanceof re.constructor?re.constructor.prototype:re instanceof Object?B:null}},function(Oe,A,a){var b=a(238),$=a(172).concat("length","prototype");A.f=Object.getOwnPropertyNames||function(U){return b(U,$)}},function(Oe,A,a){var b=a(14),$=a(237),U=a(172),B=a(173)("IE_PROTO"),re=function(){},J=function(){var R,W=a(175)("iframe"),q=U.length;for(W.style.display="none",a(171).appendChild(W),W.src="javascript:",(R=W.contentWindow.document).open(),R.write("<script>document.F=Object<\/script>"),R.close(),J=R.F;q--;)delete J.prototype[U[q]];return J()};Oe.exports=Object.create||function(R,W){var q;return R!==null?(re.prototype=b(R),q=new re,re.prototype=null,q[B]=R):q=J(),W===void 0?q:$(q,W)}},function(Oe,A,a){var b=a(54),$=Math.max,U=Math.min;Oe.exports=function(B,re){return(B=b(B))<0?$(B+re,0):U(B,re)}},function(Oe,A,a){var b=a(238),$=a(172);Oe.exports=Object.keys||function(U){return b(U,$)}},function(Oe,A){Oe.exports=!1},function(Oe,A){var a=0,b=Math.random();Oe.exports=function($){return"Symbol(".concat($===void 0?"":$,")_",(++a+b).toString(36))}},function(Oe,A){Oe.exports=function(a,b){return{enumerable:!(1&a),configurable:!(2&a),writable:!(4&a),value:b}}},function(Oe,A,a){Oe.exports=function(b,$){$||($={}),typeof $=="function"&&($={cmp:$});var U=typeof $.cycles=="boolean"&&$.cycles,B=$.cmp&&function(J){return function(R){return function(W,q){var P={key:W,value:R[W]},ee={key:q,value:R[q]};return J(P,ee)}}}($.cmp),re=[];return function J(R){if(R&&R.toJSON&&typeof R.toJSON=="function"&&(R=R.toJSON()),R!==void 0){if(typeof R=="number")return isFinite(R)?""+R:"null";if(typeof R!="object")return JSON.stringify(R);var W,q;if(Array.isArray(R)){for(q="[",W=0;W<R.length;W++)W&&(q+=","),q+=J(R[W])||"null";return q+"]"}if(R===null)return"null";if(re.indexOf(R)!==-1){if(U)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}var P=re.push(R)-1,ee=Object.keys(R).sort(B&&B(R));for(q="",W=0;W<ee.length;W++){var I=ee[W],se=J(R[I]);se&&(q&&(q+=","),q+=JSON.stringify(I)+":"+se)}return re.splice(P,1),"{"+q+"}"}}(b)}},function(Oe,A,a){A.a=function(b,$){return b<$?-1:b>$?1:b>=$?0:NaN}},function(Oe,A,a){a.r(A);var b={};a.d(b,"JsonPatchError",function(){return jt}),a.d(b,"deepClone",function(){return Ye}),a.d(b,"getValueByPointer",function(){return Bt}),a.d(b,"applyOperation",function(){return Pt}),a.d(b,"applyPatch",function(){return gn}),a.d(b,"applyReducer",function(){return Dt}),a.d(b,"validator",function(){return St}),a.d(b,"validate",function(){return wn}),a.d(b,"_areEquals",function(){return Bn});var $={};a.d($,"unobserve",function(){return Qe}),a.d($,"observe",function(){return He}),a.d($,"generate",function(){return pt}),a.d($,"compare",function(){return zt});var U={};a.d(U,"aggregate",function(){return ic}),a.d(U,"bin",function(){return Rd}),a.d(U,"collect",function(){return Ip}),a.d(U,"compare",function(){return xm}),a.d(U,"countpattern",function(){return qc}),a.d(U,"cross",function(){return za}),a.d(U,"density",function(){return Md}),a.d(U,"dotbin",function(){return wu}),a.d(U,"expression",function(){return Aa}),a.d(U,"extent",function(){return tu}),a.d(U,"facet",function(){return ho}),a.d(U,"field",function(){return ca}),a.d(U,"filter",function(){return ko}),a.d(U,"flatten",function(){return xs}),a.d(U,"fold",function(){return fr}),a.d(U,"formula",function(){return Us}),a.d(U,"generate",function(){return nu}),a.d(U,"impute",function(){return Nh}),a.d(U,"joinaggregate",function(){return jd}),a.d(U,"kde",function(){return Bd}),a.d(U,"key",function(){return lu}),a.d(U,"load",function(){return ws}),a.d(U,"lookup",function(){return oc}),a.d(U,"multiextent",function(){return us}),a.d(U,"multivalues",function(){return Po}),a.d(U,"params",function(){return Pd}),a.d(U,"pivot",function(){return Al}),a.d(U,"prefacet",function(){return Rh}),a.d(U,"project",function(){return Ri}),a.d(U,"proxy",function(){return bi}),a.d(U,"quantile",function(){return oa}),a.d(U,"relay",function(){return Ld}),a.d(U,"sample",function(){return zd}),a.d(U,"sequence",function(){return Ud}),a.d(U,"sieve",function(){return Rp}),a.d(U,"subflow",function(){return wt}),a.d(U,"timeunit",function(){return zu}),a.d(U,"tupleindex",function(){return $c}),a.d(U,"values",function(){return Is}),a.d(U,"window",function(){return Gc});var B={};a.d(B,"interpolate",function(){return aa}),a.d(B,"interpolateArray",function(){return ia}),a.d(B,"interpolateBasis",function(){return Vr}),a.d(B,"interpolateBasisClosed",function(){return xr}),a.d(B,"interpolateDate",function(){return Jo}),a.d(B,"interpolateDiscrete",function(){return N0}),a.d(B,"interpolateHue",function(){return Zd}),a.d(B,"interpolateNumber",function(){return Fi}),a.d(B,"interpolateNumberArray",function(){return ji}),a.d(B,"interpolateObject",function(){return Di}),a.d(B,"interpolateRound",function(){return Qo}),a.d(B,"interpolateString",function(){return ha}),a.d(B,"interpolateTransformCss",function(){return Im}),a.d(B,"interpolateTransformSvg",function(){return bv}),a.d(B,"interpolateZoom",function(){return Ag}),a.d(B,"interpolateRgb",function(){return ni}),a.d(B,"interpolateRgbBasis",function(){return Qi}),a.d(B,"interpolateRgbBasisClosed",function(){return zo}),a.d(B,"interpolateHsl",function(){return Bp}),a.d(B,"interpolateHslLong",function(){return _g}),a.d(B,"interpolateLab",function(){return np}),a.d(B,"interpolateHcl",function(){return kv}),a.d(B,"interpolateHclLong",function(){return F0}),a.d(B,"interpolateCubehelix",function(){return Xh}),a.d(B,"interpolateCubehelixLong",function(){return I0}),a.d(B,"piecewise",function(){return _u}),a.d(B,"quantize",function(){return R0});var re={};a.d(re,"bound",function(){return BA}),a.d(re,"identifier",function(){return Gk}),a.d(re,"mark",function(){return LA}),a.d(re,"overlap",function(){return zA}),a.d(re,"render",function(){return $A}),a.d(re,"viewlayout",function(){return QA});var J={};a.d(J,"axisticks",function(){return eS}),a.d(J,"datajoin",function(){return tS}),a.d(J,"encode",function(){return nS}),a.d(J,"legendentries",function(){return rS}),a.d(J,"linkpath",function(){return Kk}),a.d(J,"pie",function(){return Xk}),a.d(J,"scale",function(){return cS}),a.d(J,"sortitems",function(){return hS}),a.d(J,"stack",function(){return Jk});var R={};a.d(R,"contour",function(){return DE}),a.d(R,"geojson",function(){return FE}),a.d(R,"geopath",function(){return IE}),a.d(R,"geopoint",function(){return RE}),a.d(R,"geoshape",function(){return ME}),a.d(R,"graticule",function(){return jE}),a.d(R,"heatmap",function(){return BE}),a.d(R,"isocontour",function(){return AE}),a.d(R,"kde2d",function(){return _E}),a.d(R,"projection",function(){return E_});var W={};a.d(W,"force",function(){return VE});var q={};a.d(q,"nest",function(){return YE}),a.d(q,"pack",function(){return QE}),a.d(q,"partition",function(){return e3}),a.d(q,"stratify",function(){return t3}),a.d(q,"tree",function(){return r3}),a.d(q,"treelinks",function(){return i3}),a.d(q,"treemap",function(){return a3});var P={};a.d(P,"label",function(){return u3});var ee={};a.d(ee,"loess",function(){return c3}),a.d(ee,"regression",function(){return f3});var I={};a.d(I,"voronoi",function(){return g3});var se={};a.d(se,"wordcloud",function(){return y3});var ie={};a.d(ie,"crossfilter",function(){return b3}),a.d(ie,"resolvefilter",function(){return x3});var K={};a.d(K,"Dataflow",function(){return qn}),a.d(K,"EventStream",function(){return Ei}),a.d(K,"MultiPulse",function(){return Rt}),a.d(K,"Operator",function(){return oi}),a.d(K,"Parameters",function(){return Yr}),a.d(K,"Pulse",function(){return ye}),a.d(K,"Transform",function(){return Ot}),a.d(K,"changeset",function(){return Mr}),a.d(K,"definition",function(){return Ht}),a.d(K,"ingest",function(){return Dn}),a.d(K,"isTuple",function(){return Kt}),a.d(K,"transform",function(){return Ue}),a.d(K,"transforms",function(){return pn}),a.d(K,"tupleid",function(){return Zt}),a.d(K,"interpolate",function(){return Kp}),a.d(K,"interpolateColors",function(){return Kl}),a.d(K,"interpolateRange",function(){return $p}),a.d(K,"quantizeInterpolator",function(){return Gp}),a.d(K,"scale",function(){return Ro}),a.d(K,"scheme",function(){return zm}),a.d(K,"projection",function(){return OE}),a.d(K,"View",function(){return AD}),a.d(K,"defaultLocale",function(){return Dr.a}),a.d(K,"formatLocale",function(){return Dr.c}),a.d(K,"locale",function(){return Dr.b}),a.d(K,"resetDefaultLocale",function(){return Dr.d}),a.d(K,"timeFormatLocale",function(){return Dr.e}),a.d(K,"expressionFunction",function(){return Yu}),a.d(K,"parse",function(){return oB}),a.d(K,"runtimeContext",function(){return aD}),a.d(K,"codegenExpression",function(){return ZB}),a.d(K,"parseExpression",function(){return YB}),a.d(K,"parseSelector",function(){return _y}),a.d(K,"version",function(){return s7}),a.d(K,"Debug",function(){return be.a}),a.d(K,"Error",function(){return be.b}),a.d(K,"Info",function(){return be.c}),a.d(K,"None",function(){return be.d}),a.d(K,"Warn",function(){return be.e}),a.d(K,"accessor",function(){return be.f}),a.d(K,"accessorFields",function(){return be.g}),a.d(K,"accessorName",function(){return be.h}),a.d(K,"array",function(){return be.i}),a.d(K,"ascending",function(){return be.j}),a.d(K,"clampRange",function(){return be.k}),a.d(K,"compare",function(){return be.l}),a.d(K,"constant",function(){return be.m}),a.d(K,"debounce",function(){return be.n}),a.d(K,"error",function(){return be.o}),a.d(K,"extend",function(){return be.p}),a.d(K,"extent",function(){return be.q}),a.d(K,"extentIndex",function(){return be.r}),a.d(K,"falsy",function(){return be.s}),a.d(K,"fastmap",function(){return be.t}),a.d(K,"field",function(){return be.u}),a.d(K,"flush",function(){return be.v}),a.d(K,"hasOwnProperty",function(){return be.w}),a.d(K,"id",function(){return be.x}),a.d(K,"identity",function(){return be.y}),a.d(K,"inherits",function(){return be.z}),a.d(K,"inrange",function(){return be.A}),a.d(K,"isArray",function(){return be.B}),a.d(K,"isBoolean",function(){return be.C}),a.d(K,"isDate",function(){return be.D}),a.d(K,"isFunction",function(){return be.E}),a.d(K,"isIterable",function(){return be.F}),a.d(K,"isNumber",function(){return be.G}),a.d(K,"isObject",function(){return be.H}),a.d(K,"isRegExp",function(){return be.I}),a.d(K,"isString",function(){return be.J}),a.d(K,"key",function(){return be.K}),a.d(K,"lerp",function(){return be.L}),a.d(K,"logger",function(){return be.M}),a.d(K,"lruCache",function(){return be.N}),a.d(K,"merge",function(){return be.O}),a.d(K,"mergeConfig",function(){return be.P}),a.d(K,"one",function(){return be.Q}),a.d(K,"pad",function(){return be.R}),a.d(K,"panLinear",function(){return be.S}),a.d(K,"panLog",function(){return be.T}),a.d(K,"panPow",function(){return be.U}),a.d(K,"panSymlog",function(){return be.V}),a.d(K,"peek",function(){return be.W}),a.d(K,"quarter",function(){return be.X}),a.d(K,"repeat",function(){return be.Y}),a.d(K,"span",function(){return be.Z}),a.d(K,"splitAccessPath",function(){return be.Aa}),a.d(K,"stringValue",function(){return be.Ba}),a.d(K,"toBoolean",function(){return be.Ca}),a.d(K,"toDate",function(){return be.Da}),a.d(K,"toNumber",function(){return be.Ea}),a.d(K,"toSet",function(){return be.Fa}),a.d(K,"toString",function(){return be.Ga}),a.d(K,"truncate",function(){return be.Ha}),a.d(K,"truthy",function(){return be.Ia}),a.d(K,"utcquarter",function(){return be.Ja}),a.d(K,"visitArray",function(){return be.Ka}),a.d(K,"writeConfig",function(){return be.La}),a.d(K,"zero",function(){return be.Ma}),a.d(K,"zoomLinear",function(){return be.Na}),a.d(K,"zoomLog",function(){return be.Oa}),a.d(K,"zoomPow",function(){return be.Pa}),a.d(K,"zoomSymlog",function(){return be.Qa}),a.d(K,"bandwidthNRD",function(){return qr}),a.d(K,"bin",function(){return jr}),a.d(K,"bootstrapCI",function(){return Vi}),a.d(K,"cumulativeLogNormal",function(){return Dd}),a.d(K,"cumulativeNormal",function(){return qi}),a.d(K,"cumulativeUniform",function(){return Ch}),a.d(K,"densityLogNormal",function(){return xc}),a.d(K,"densityNormal",function(){return Eh}),a.d(K,"densityUniform",function(){return yf}),a.d(K,"dotbin",function(){return Rr}),a.d(K,"quantileLogNormal",function(){return as}),a.d(K,"quantileNormal",function(){return ec}),a.d(K,"quantileUniform",function(){return wc}),a.d(K,"quantiles",function(){return Zi}),a.d(K,"quartiles",function(){return Ti}),a.d(K,"random",function(){return jn}),a.d(K,"randomInteger",function(){return yo}),a.d(K,"randomKDE",function(){return bc}),a.d(K,"randomLCG",function(){return ao}),a.d(K,"randomLogNormal",function(){return vf}),a.d(K,"randomMixture",function(){return Td}),a.d(K,"randomNormal",function(){return bu}),a.d(K,"randomUniform",function(){return El}),a.d(K,"regressionExp",function(){return nc}),a.d(K,"regressionLinear",function(){return ss}),a.d(K,"regressionLoess",function(){return xf}),a.d(K,"regressionLog",function(){return Ca}),a.d(K,"regressionPoly",function(){return cu}),a.d(K,"regressionPow",function(){return Cl}),a.d(K,"regressionQuad",function(){return rc}),a.d(K,"sampleCurve",function(){return wf}),a.d(K,"sampleLogNormal",function(){return Bu}),a.d(K,"sampleNormal",function(){return vs}),a.d(K,"sampleUniform",function(){return Pu}),a.d(K,"setRandom",function(){return ri}),a.d(K,"DATE",function(){return ar.a}),a.d(K,"DAY",function(){return ar.b}),a.d(K,"DAYOFYEAR",function(){return ar.c}),a.d(K,"HOURS",function(){return ar.d}),a.d(K,"MILLISECONDS",function(){return ar.e}),a.d(K,"MINUTES",function(){return ar.f}),a.d(K,"MONTH",function(){return ar.g}),a.d(K,"QUARTER",function(){return ar.h}),a.d(K,"SECONDS",function(){return ar.i}),a.d(K,"TIME_UNITS",function(){return ar.j}),a.d(K,"WEEK",function(){return ar.k}),a.d(K,"YEAR",function(){return ar.l}),a.d(K,"dayofyear",function(){return ar.m}),a.d(K,"timeBin",function(){return ar.n}),a.d(K,"timeFloor",function(){return ar.o}),a.d(K,"timeInterval",function(){return ar.p}),a.d(K,"timeOffset",function(){return ar.q}),a.d(K,"timeSequence",function(){return ar.r}),a.d(K,"timeUnitSpecifier",function(){return ar.s}),a.d(K,"timeUnits",function(){return ar.t}),a.d(K,"utcFloor",function(){return ar.u}),a.d(K,"utcInterval",function(){return ar.v}),a.d(K,"utcOffset",function(){return ar.w}),a.d(K,"utcSequence",function(){return ar.x}),a.d(K,"utcdayofyear",function(){return ar.y}),a.d(K,"utcweek",function(){return ar.z}),a.d(K,"week",function(){return ar.A}),a.d(K,"format",function(){return Yn.a}),a.d(K,"formats",function(){return Yn.b}),a.d(K,"inferType",function(){return Yn.c}),a.d(K,"inferTypes",function(){return Yn.d}),a.d(K,"loader",function(){return Yn.e}),a.d(K,"read",function(){return Yn.f}),a.d(K,"responseType",function(){return Yn.g}),a.d(K,"typeParsers",function(){return Yn.h}),a.d(K,"Bounds",function(){return Ka}),a.d(K,"CanvasHandler",function(){return We}),a.d(K,"CanvasRenderer",function(){return kt}),a.d(K,"Gradient",function(){return qm}),a.d(K,"GroupItem",function(){return gp}),a.d(K,"Handler",function(){return u}),a.d(K,"Item",function(){return id}),a.d(K,"Marks",function(){return gl}),a.d(K,"RenderType",function(){return ur}),a.d(K,"Renderer",function(){return y}),a.d(K,"ResourceLoader",function(){return im}),a.d(K,"SVGHandler",function(){return Jt}),a.d(K,"SVGRenderer",function(){return lt}),a.d(K,"SVGStringRenderer",function(){return lr}),a.d(K,"Scenegraph",function(){return i0}),a.d(K,"boundClip",function(){return lo}),a.d(K,"boundContext",function(){return um}),a.d(K,"boundItem",function(){return fd}),a.d(K,"boundMark",function(){return Av}),a.d(K,"boundStroke",function(){return Zl}),a.d(K,"domChild",function(){return Xu}),a.d(K,"domClear",function(){return of}),a.d(K,"domCreate",function(){return mc}),a.d(K,"domFind",function(){return _v}),a.d(K,"font",function(){return ld}),a.d(K,"fontFamily",function(){return ah}),a.d(K,"fontSize",function(){return Ku}),a.d(K,"intersect",function(){return kr}),a.d(K,"intersectBoxLine",function(){return De}),a.d(K,"intersectPath",function(){return L}),a.d(K,"intersectPoint",function(){return Y}),a.d(K,"intersectRule",function(){return ve}),a.d(K,"lineHeight",function(){return Ds}),a.d(K,"markup",function(){return Ne}),a.d(K,"multiLineOffset",function(){return ps}),a.d(K,"pathCurves",function(){return Yl}),a.d(K,"pathEqual",function(){return Bo}),a.d(K,"pathParse",function(){return td}),a.d(K,"pathRectangle",function(){return Jg}),a.d(K,"pathRender",function(){return rd}),a.d(K,"pathSymbols",function(){return Ql}),a.d(K,"pathTrail",function(){return fl}),a.d(K,"point",function(){return h}),a.d(K,"renderModule",function(){return Er}),a.d(K,"resetSVGClipId",function(){return Zg}),a.d(K,"resetSVGDefIds",function(){return ta}),a.d(K,"sceneEqual",function(){return wo}),a.d(K,"sceneFromJSON",function(){return U0}),a.d(K,"scenePickVisit",function(){return Pn}),a.d(K,"sceneToJSON",function(){return r0}),a.d(K,"sceneVisit",function(){return _n}),a.d(K,"sceneZOrder",function(){return En}),a.d(K,"serializeXML",function(){return ze}),a.d(K,"textMetrics",function(){return ds});var de={};a.d(de,"invalidSpec",function(){return Y7}),a.d(de,"FIT_NON_SINGLE",function(){return J7}),a.d(de,"containerSizeNonSingle",function(){return Q7}),a.d(de,"containerSizeNotCompatibleWithAutosize",function(){return Z7}),a.d(de,"droppingFit",function(){return eP}),a.d(de,"cannotProjectOnChannelWithoutField",function(){return tP}),a.d(de,"cannotProjectAggregate",function(){return nP}),a.d(de,"nearestNotSupportForContinuous",function(){return rP}),a.d(de,"selectionNotSupported",function(){return iP}),a.d(de,"selectionNotFound",function(){return oP}),a.d(de,"SCALE_BINDINGS_CONTINUOUS",function(){return aP}),a.d(de,"LEGEND_BINDINGS_PROJECT_LENGTH",function(){return sP}),a.d(de,"noSameUnitLookup",function(){return uP}),a.d(de,"noSuchRepeatedValue",function(){return cP}),a.d(de,"columnsNotSupportByRowCol",function(){return lP}),a.d(de,"CONCAT_CANNOT_SHARE_AXIS",function(){return fP}),a.d(de,"unrecognizedParse",function(){return hP}),a.d(de,"differentParse",function(){return dP}),a.d(de,"invalidTransformIgnored",function(){return pP}),a.d(de,"NO_FIELDS_NEEDS_AS",function(){return mP}),a.d(de,"customFormatTypeNotAllowed",function(){return gP}),a.d(de,"encodingOverridden",function(){return vP}),a.d(de,"projectionOverridden",function(){return yP}),a.d(de,"REPLACE_ANGLE_WITH_THETA",function(){return bP}),a.d(de,"primitiveChannelDef",function(){return xP}),a.d(de,"invalidFieldType",function(){return wP}),a.d(de,"invalidFieldTypeForCountAggregate",function(){return kP}),a.d(de,"invalidAggregate",function(){return EP}),a.d(de,"missingFieldType",function(){return CP}),a.d(de,"droppingColor",function(){return OP}),a.d(de,"emptyFieldDef",function(){return AP}),a.d(de,"latLongDeprecated",function(){return SP}),a.d(de,"LINE_WITH_VARYING_SIZE",function(){return _P}),a.d(de,"incompatibleChannel",function(){return DP}),a.d(de,"invalidEncodingChannel",function(){return TP}),a.d(de,"facetChannelShouldBeDiscrete",function(){return NP}),a.d(de,"facetChannelDropped",function(){return FP}),a.d(de,"discreteChannelCannotEncode",function(){return IP}),a.d(de,"lineWithRange",function(){return RP}),a.d(de,"orientOverridden",function(){return MP}),a.d(de,"CANNOT_UNION_CUSTOM_DOMAIN_WITH_FIELD_DOMAIN",function(){return jP}),a.d(de,"RANGE_STEP_DEPRECATED",function(){return BP}),a.d(de,"cannotUseScalePropertyWithNonColor",function(){return PP}),a.d(de,"unaggregateDomainHasNoEffectForRawField",function(){return LP}),a.d(de,"unaggregateDomainWithNonSharedDomainOp",function(){return zP}),a.d(de,"unaggregatedDomainWithLogScale",function(){return UP}),a.d(de,"cannotApplySizeToNonOrientedMark",function(){return WP}),a.d(de,"scaleTypeNotWorkWithChannel",function(){return VP}),a.d(de,"scaleTypeNotWorkWithFieldDef",function(){return qP}),a.d(de,"scalePropertyNotWorkWithScaleType",function(){return HP}),a.d(de,"scaleTypeNotWorkWithMark",function(){return $P}),a.d(de,"stepDropped",function(){return GP}),a.d(de,"mergeConflictingProperty",function(){return KP}),a.d(de,"mergeConflictingDomainProperty",function(){return XP}),a.d(de,"independentScaleMeansIndependentGuide",function(){return YP}),a.d(de,"domainSortDropped",function(){return JP}),a.d(de,"MORE_THAN_ONE_SORT",function(){return QP}),a.d(de,"FACETED_INDEPENDENT_DIFFERENT_SOURCES",function(){return ZP}),a.d(de,"FACETED_INDEPENDENT_SAME_FIELDS_DIFFERENT_SOURCES",function(){return eL}),a.d(de,"FACETED_INDEPENDENT_SAME_SOURCE",function(){return tL}),a.d(de,"INVALID_CHANNEL_FOR_AXIS",function(){return nL}),a.d(de,"cannotStackRangedMark",function(){return rL}),a.d(de,"cannotStackNonLinearScale",function(){return iL}),a.d(de,"stackNonSummativeAggregate",function(){return oL}),a.d(de,"invalidTimeUnit",function(){return aL}),a.d(de,"droppedDay",function(){return sL}),a.d(de,"errorBarCenterAndExtentAreNotNeeded",function(){return uL}),a.d(de,"errorBarCenterIsUsedWithWrongExtent",function(){return cL}),a.d(de,"errorBarContinuousAxisHasCustomizedAggregate",function(){return lL}),a.d(de,"errorBarCenterIsNotNeeded",function(){return fL}),a.d(de,"errorBand1DNotSupport",function(){return hL}),a.d(de,"channelRequiredForBinned",function(){return dL}),a.d(de,"domainRequiredForThresholdScale",function(){return pL});var pe={};a.d(pe,"compile",function(){return RW}),a.d(pe,"extractTransforms",function(){return jW}),a.d(pe,"normalize",function(){return YF}),a.d(pe,"version",function(){return BW});var Ae={};a.d(Ae,"dark",function(){return PW}),a.d(Ae,"excel",function(){return LW}),a.d(Ae,"fivethirtyeight",function(){return zW}),a.d(Ae,"ggplot2",function(){return UW}),a.d(Ae,"googlecharts",function(){return $W}),a.d(Ae,"latimes",function(){return WW}),a.d(Ae,"quartz",function(){return VW}),a.d(Ae,"urbaninstitute",function(){return HW}),a.d(Ae,"version",function(){return GW}),a.d(Ae,"vox",function(){return qW});/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017 Joachim Wester
 * MIT license
 */var Te=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var s in i)i.hasOwnProperty(s)&&(r[s]=i[s])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}(),je=Object.prototype.hasOwnProperty;function we(e,t){return je.call(e,t)}function ot(e){if(Array.isArray(e)){for(var t=new Array(e.length),n=0;n<t.length;n++)t[n]=""+n;return t}if(Object.keys)return Object.keys(e);t=[];for(var r in e)we(e,r)&&t.push(r);return t}function _t(e){switch(typeof e){case"object":return JSON.parse(JSON.stringify(e));case"undefined":return null;default:return e}}function Ut(e){for(var t,n=0,r=e.length;n<r;){if(!((t=e.charCodeAt(n))>=48&&t<=57))return!1;n++}return!0}function Xt(e){return e.indexOf("/")===-1&&e.indexOf("~")===-1?e:e.replace(/~/g,"~0").replace(/\//g,"~1")}function ke(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}function Ft(e,t){var n=[e];for(var r in t){var i=typeof t[r]=="object"?JSON.stringify(t[r],null,2):t[r];i!==void 0&&n.push(r+": "+i)}return n.join(`
`)}var Gt=function(e){function t(n,r,i,s,f){var m=this.constructor,x=e.call(this,Ft(n,{name:r,index:i,operation:s,tree:f}))||this;return x.name=r,x.index=i,x.operation=s,x.tree=f,Object.setPrototypeOf(x,m.prototype),x.message=Ft(n,{name:r,index:i,operation:s,tree:f}),x}return Te(t,e),t}(Error),jt=Gt,Ye=_t,ln={add:function(e,t,n){return e[t]=this.value,{newDocument:n}},remove:function(e,t,n){var r=e[t];return delete e[t],{newDocument:n,removed:r}},replace:function(e,t,n){var r=e[t];return e[t]=this.value,{newDocument:n,removed:r}},move:function(e,t,n){var r=Bt(n,this.path);r&&(r=_t(r));var i=Pt(n,{op:"remove",path:this.from}).removed;return Pt(n,{op:"add",path:this.path,value:i}),{newDocument:n,removed:r}},copy:function(e,t,n){var r=Bt(n,this.from);return Pt(n,{op:"add",path:this.path,value:_t(r)}),{newDocument:n}},test:function(e,t,n){return{newDocument:n,test:Bn(e[t],this.value)}},_get:function(e,t,n){return this.value=e[t],{newDocument:n}}},nn={add:function(e,t,n){return Ut(t)?e.splice(t,0,this.value):e[t]=this.value,{newDocument:n,index:t}},remove:function(e,t,n){return{newDocument:n,removed:e.splice(t,1)[0]}},replace:function(e,t,n){var r=e[t];return e[t]=this.value,{newDocument:n,removed:r}},move:ln.move,copy:ln.copy,test:ln.test,_get:ln._get};function Bt(e,t){if(t=="")return e;var n={op:"_get",path:t};return Pt(e,n),n.value}function Pt(e,t,n,r,i,s){if(n===void 0&&(n=!1),r===void 0&&(r=!0),i===void 0&&(i=!0),s===void 0&&(s=0),n&&(typeof n=="function"?n(t,0,e,t.path):St(t,0)),t.path===""){var f={newDocument:e};if(t.op==="add")return f.newDocument=t.value,f;if(t.op==="replace")return f.newDocument=t.value,f.removed=e,f;if(t.op==="move"||t.op==="copy")return f.newDocument=Bt(e,t.from),t.op==="move"&&(f.removed=e),f;if(t.op==="test"){if(f.test=Bn(e,t.value),f.test===!1)throw new jt("Test operation failed","TEST_OPERATION_FAILED",s,t,e);return f.newDocument=e,f}if(t.op==="remove")return f.removed=e,f.newDocument=null,f;if(t.op==="_get")return t.value=e,f;if(n)throw new jt("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",s,t,e);return f}r||(e=_t(e));var m=(t.path||"").split("/"),x=e,O=1,T=m.length,M=void 0,H=void 0,Z=void 0;for(Z=typeof n=="function"?n:St;;){if((H=m[O])&&H.indexOf("~")!=-1&&(H=ke(H)),i&&H=="__proto__")throw new TypeError("JSON-Patch: modifying `__proto__` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(n&&M===void 0&&(x[H]===void 0?M=m.slice(0,O).join("/"):O==T-1&&(M=t.path),M!==void 0&&Z(t,0,e,M)),O++,Array.isArray(x)){if(H==="-")H=x.length;else{if(n&&!Ut(H))throw new jt("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",s,t,e);Ut(H)&&(H=~~H)}if(O>=T){if(n&&t.op==="add"&&H>x.length)throw new jt("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",s,t,e);if((f=nn[t.op].call(t,x,H,e)).test===!1)throw new jt("Test operation failed","TEST_OPERATION_FAILED",s,t,e);return f}}else if(O>=T){if((f=ln[t.op].call(t,x,H,e)).test===!1)throw new jt("Test operation failed","TEST_OPERATION_FAILED",s,t,e);return f}if(x=x[H],n&&O<T&&(!x||typeof x!="object"))throw new jt("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",s,t,e)}}function gn(e,t,n,r,i){if(r===void 0&&(r=!0),i===void 0&&(i=!0),n&&!Array.isArray(t))throw new jt("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");r||(e=_t(e));for(var s=new Array(t.length),f=0,m=t.length;f<m;f++)s[f]=Pt(e,t[f],n,!0,i,f),e=s[f].newDocument;return s.newDocument=e,s}function Dt(e,t,n){var r=Pt(e,t);if(r.test===!1)throw new jt("Test operation failed","TEST_OPERATION_FAILED",n,t,e);return r.newDocument}function St(e,t,n,r){if(typeof e!="object"||e===null||Array.isArray(e))throw new jt("Operation is not an object","OPERATION_NOT_AN_OBJECT",t,e,n);if(!ln[e.op])throw new jt("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",t,e,n);if(typeof e.path!="string")throw new jt("Operation `path` property is not a string","OPERATION_PATH_INVALID",t,e,n);if(e.path.indexOf("/")!==0&&e.path.length>0)throw new jt('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",t,e,n);if((e.op==="move"||e.op==="copy")&&typeof e.from!="string")throw new jt("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",t,e,n);if((e.op==="add"||e.op==="replace"||e.op==="test")&&e.value===void 0)throw new jt("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",t,e,n);if((e.op==="add"||e.op==="replace"||e.op==="test")&&function m(x){if(x===void 0)return!0;if(x){if(Array.isArray(x)){for(var O=0,T=x.length;O<T;O++)if(m(x[O]))return!0}else if(typeof x=="object"){var M=ot(x),H=M.length;for(O=0;O<H;O++)if(m(x[M[O]]))return!0}}return!1}(e.value))throw new jt("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",t,e,n);if(n){if(e.op=="add"){var i=e.path.split("/").length,s=r.split("/").length;if(i!==s+1&&i!==s)throw new jt("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",t,e,n)}else if(e.op==="replace"||e.op==="remove"||e.op==="_get"){if(e.path!==r)throw new jt("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",t,e,n)}else if(e.op==="move"||e.op==="copy"){var f=wn([{op:"_get",path:e.from,value:void 0}],n);if(f&&f.name==="OPERATION_PATH_UNRESOLVABLE")throw new jt("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",t,e,n)}}}function wn(e,t,n){try{if(!Array.isArray(e))throw new jt("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(t)gn(_t(t),_t(e),n||!0);else{n=n||St;for(var r=0;r<e.length;r++)n(e[r],r,t,void 0)}}catch(i){if(i instanceof jt)return i;throw i}}function Bn(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){var n,r,i,s=Array.isArray(e),f=Array.isArray(t);if(s&&f){if((r=e.length)!=t.length)return!1;for(n=r;n--!=0;)if(!Bn(e[n],t[n]))return!1;return!0}if(s!=f)return!1;var m=Object.keys(e);if((r=m.length)!==Object.keys(t).length)return!1;for(n=r;n--!=0;)if(!t.hasOwnProperty(m[n]))return!1;for(n=r;n--!=0;)if(!Bn(e[i=m[n]],t[i]))return!1;return!0}return e!=e&&t!=t}/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017 Joachim Wester
 * MIT license
 */var Hn=new WeakMap,hn=function(){return function(e){this.observers=new Map,this.obj=e}}(),Ve=function(){return function(e,t){this.callback=e,this.observer=t}}();function Qe(e,t){t.unobserve()}function He(e,t){var n,r=function(m){return Hn.get(m)}(e);if(r){var i=function(m,x){return m.observers.get(x)}(r,t);n=i&&i.observer}else r=new hn(e),Hn.set(e,r);if(n)return n;if(n={},r.value=_t(e),t){n.callback=t,n.next=null;var s=function(){pt(n)},f=function(){clearTimeout(n.next),n.next=setTimeout(s)};typeof window<"u"&&(window.addEventListener("mouseup",f),window.addEventListener("keyup",f),window.addEventListener("mousedown",f),window.addEventListener("keydown",f),window.addEventListener("change",f))}return n.patches=[],n.object=e,n.unobserve=function(){pt(n),clearTimeout(n.next),function(m,x){m.observers.delete(x.callback)}(r,n),typeof window<"u"&&(window.removeEventListener("mouseup",f),window.removeEventListener("keyup",f),window.removeEventListener("mousedown",f),window.removeEventListener("keydown",f),window.removeEventListener("change",f))},r.observers.set(t,new Ve(t,n)),n}function pt(e,t){t===void 0&&(t=!1);var n=Hn.get(e.object);Lt(n.value,e.object,e.patches,"",t),e.patches.length&&gn(n.value,e.patches);var r=e.patches;return r.length>0&&(e.patches=[],e.callback&&e.callback(r)),r}function Lt(e,t,n,r,i){if(t!==e){typeof t.toJSON=="function"&&(t=t.toJSON());for(var s=ot(t),f=ot(e),m=!1,x=f.length-1;x>=0;x--){var O=e[M=f[x]];if(!we(t,M)||t[M]===void 0&&O!==void 0&&Array.isArray(t)===!1)Array.isArray(e)===Array.isArray(t)?(i&&n.push({op:"test",path:r+"/"+Xt(M),value:_t(O)}),n.push({op:"remove",path:r+"/"+Xt(M)}),m=!0):(i&&n.push({op:"test",path:r,value:e}),n.push({op:"replace",path:r,value:t}));else{var T=t[M];typeof O=="object"&&O!=null&&typeof T=="object"&&T!=null&&Array.isArray(O)===Array.isArray(T)?Lt(O,T,n,r+"/"+Xt(M),i):O!==T&&(i&&n.push({op:"test",path:r+"/"+Xt(M),value:_t(O)}),n.push({op:"replace",path:r+"/"+Xt(M),value:_t(T)}))}}if(m||s.length!=f.length)for(x=0;x<s.length;x++){var M;we(e,M=s[x])||t[M]===void 0||n.push({op:"add",path:r+"/"+Xt(M),value:_t(t[M])})}}}function zt(e,t,n){n===void 0&&(n=!1);var r=[];return Lt(e,t,r,"",n),r}Object.assign({},b,$,{JsonPatchError:Gt,deepClone:_t,escapePathComponent:Xt,unescapePathComponent:ke});var Tn=a(133),xn=a.n(Tn),Kn=a(179),be=a(1),Yn=a(63),Dr=a(44);function pr(e){const t=e||be.y,n=[],r={};return n.add=i=>{const s=t(i);return r[s]||(r[s]=1,n.push(i)),n},n.remove=i=>{const s=t(i);if(r[s]){r[s]=0;const f=n.indexOf(i);f>=0&&n.splice(f,1)}return n},n}async function Nr(e,t){try{await t(e)}catch(n){e.error(n)}}const Fr=Symbol("vega_id");let an=1;function Kt(e){return!(!e||!Zt(e))}function Zt(e){return e[Fr]}function $n(e,t){return e[Fr]=t,e}function Dn(e){const t=e===Object(e)?e:{data:e};return Zt(t)?t:$n(t,an++)}function hr(e){return wr(e,Dn({}))}function wr(e,t){for(const n in e)t[n]=e[n];return t}function gr(e,t){return $n(t,Zt(e))}function Qr(e,t){return e?t?(n,r)=>e(n,r)||Zt(t(n))-Zt(t(r)):(n,r)=>e(n,r)||Zt(n)-Zt(r):null}function ti(e){return e&&e.constructor===Mr}function Mr(){const e=[],t=[],n=[],r=[],i=[];let s=null,f=!1;return{constructor:Mr,insert(m){const x=Object(be.i)(m),O=x.length;for(let T=0;T<O;++T)e.push(x[T]);return this},remove(m){const x=Object(be.E)(m)?r:t,O=Object(be.i)(m),T=O.length;for(let M=0;M<T;++M)x.push(O[M]);return this},modify(m,x,O){const T={field:x,value:Object(be.m)(O)};return Object(be.E)(m)?(T.filter=m,i.push(T)):(T.tuple=m,n.push(T)),this},encode(m,x){return Object(be.E)(m)?i.push({filter:m,field:x}):n.push({tuple:m,field:x}),this},clean(m){return s=m,this},reflow(){return f=!0,this},pulse(m,x){const O={},T={};let M,H,Z,ue,fe,Ie;for(M=0,H=x.length;M<H;++M)O[Zt(x[M])]=1;for(M=0,H=t.length;M<H;++M)O[Zt(fe=t[M])]=-1;for(M=0,H=r.length;M<H;++M)ue=r[M],x.forEach(Le=>{ue(Le)&&(O[Zt(Le)]=-1)});for(M=0,H=e.length;M<H;++M)Ie=Zt(fe=e[M]),O[Ie]?O[Ie]=1:m.add.push(Dn(e[M]));for(M=0,H=x.length;M<H;++M)fe=x[M],O[Zt(fe)]<0&&m.rem.push(fe);function Pe(Le,rt,it){it?Le[rt]=it(Le):m.encode=rt,f||(T[Zt(Le)]=Le)}for(M=0,H=n.length;M<H;++M)fe=(Z=n[M]).tuple,ue=Z.field,(Ie=O[Zt(fe)])>0&&(Pe(fe,ue,Z.value),m.modifies(ue));for(M=0,H=i.length;M<H;++M)Z=i[M],ue=Z.filter,x.forEach(Le=>{ue(Le)&&O[Zt(Le)]>0&&Pe(Le,Z.field,Z.value)}),m.modifies(Z.field);if(f)m.mod=t.length||r.length?x.filter(Le=>O[Zt(Le)]>0):x.slice();else for(Ie in T)m.mod.push(T[Ie]);return(s||s==null&&(t.length||r.length))&&m.clean(!0),m}}}const di="_:mod:_";function Yr(){Object.defineProperty(this,di,{writable:!0,value:{}})}Yr.prototype={set(e,t,n,r){const i=this,s=i[e],f=i[di];return t!=null&&t>=0?(s[t]!==n||r)&&(s[t]=n,f[t+":"+e]=-1,f[e]=-1):(s!==n||r)&&(i[e]=n,f[e]=Object(be.B)(n)?1+n.length:-1),i},modified(e,t){const n=this[di];if(!arguments.length){for(const r in n)if(n[r])return!0;return!1}if(Object(be.B)(e)){for(let r=0;r<e.length;++r)if(n[e[r]])return!0;return!1}return t!=null&&t>=0?t+1<n[e]||!!n[t+":"+e]:!!n[e]},clear(){return this[di]={},this}};let Xr=0;const fi=new Yr;function oi(e,t,n,r){this.id=++Xr,this.value=e,this.stamp=-1,this.rank=-1,this.qrank=-1,this.flags=0,t&&(this._update=t),n&&this.parameters(n,r)}function Ao(e){return function(t){const n=this.flags;return arguments.length===0?!!(n&e):(this.flags=t?n|e:n&~e,this)}}oi.prototype={targets(){return this._targets||(this._targets=pr(be.x))},set(e){return this.value!==e?(this.value=e,1):0},skip:Ao(1),modified:Ao(2),parameters(e,t,n){t=t!==!1;const r=this._argval=this._argval||new Yr,i=this._argops=this._argops||[],s=[];let f,m,x,O;const T=(M,H,Z)=>{Z instanceof oi?(Z!==this&&(t&&Z.targets().add(this),s.push(Z)),i.push({op:Z,name:M,index:H})):r.set(M,H,Z)};for(f in e)if(m=e[f],f==="pulse")Object(be.i)(m).forEach(M=>{M instanceof oi?M!==this&&(M.targets().add(this),s.push(M)):Object(be.o)("Pulse parameters must be operator instances.")}),this.source=m;else if(Object(be.B)(m))for(r.set(f,-1,Array(x=m.length)),O=0;O<x;++O)T(f,O,m[O]);else T(f,-1,m);return this.marshall().clear(),n&&(i.initonly=!0),s},marshall(e){const t=this._argval||fi,n=this._argops;let r,i,s,f;if(n){const m=n.length;for(i=0;i<m;++i)f=(s=(r=n[i]).op).modified()&&s.stamp===e,t.set(r.name,r.index,s.value,f);if(n.initonly){for(i=0;i<m;++i)(r=n[i]).op.targets().remove(this);this._argops=null,this._update=null}}return t},detach(){const e=this._argops;let t,n,r;if(e)for(t=0,n=e.length;t<n;++t)(r=e[t].op)._targets&&r._targets.remove(this);this.pulse=null,this.source=null},evaluate(e){const t=this._update;if(t){const n=this.marshall(e.stamp),r=t.call(this,n,e);if(n.clear(),r!==this.value)this.value=r;else if(!this.modified())return e.StopPropagation}},run(e){if(e.stamp<this.stamp)return e.StopPropagation;let t;return this.skip()?(this.skip(!1),t=0):t=this.evaluate(e),this.pulse=t||e}};let Wi=0;function Ei(e,t,n){this.id=++Wi,this.value=null,n&&(this.receive=n),e&&(this._filter=e),t&&(this._apply=t)}function bt(e,t,n){return new Ei(e,t,n)}Ei.prototype={_filter:be.Ia,_apply:be.y,targets(){return this._targets||(this._targets=pr(be.x))},consume(e){return arguments.length?(this._consume=!!e,this):!!this._consume},receive(e){if(this._filter(e)){const t=this.value=this._apply(e),n=this._targets,r=n?n.length:0;for(let i=0;i<r;++i)n[i].receive(t);this._consume&&(e.preventDefault(),e.stopPropagation())}},filter(e){const t=bt(e);return this.targets().add(t),t},apply(e){const t=bt(null,e);return this.targets().add(t),t},merge(){const e=bt();this.targets().add(e);for(let t=0,n=arguments.length;t<n;++t)arguments[t].targets().add(e);return e},throttle(e){let t=-1;return this.filter(()=>{const n=Date.now();return n-t>e?(t=n,1):0})},debounce(e){const t=bt();return this.targets().add(bt(null,null,Object(be.n)(e,n=>{const r=n.dataflow;t.receive(n),r&&r.run&&r.run()}))),t},between(e,t){let n=!1;return e.targets().add(bt(null,null,()=>n=!0)),t.targets().add(bt(null,null,()=>n=!1)),this.filter(()=>n)},detach(){this._filter=be.Ia,this._targets=null}};const Lr={skip:!0};function Mt(e,t,n,r,i,s){const f=Object(be.p)({},s,Lr);let m,x;Object(be.E)(n)||(n=Object(be.m)(n)),r===void 0?m=O=>e.touch(n(O)):Object(be.E)(r)?(x=new oi(null,r,i,!1),m=O=>{x.evaluate(O);const T=n(O),M=x.value;ti(M)?e.pulse(T,M,s):e.update(T,M,f)}):m=O=>e.update(n(O),r,f),t.apply(m)}function ge(e,t,n,r,i,s){if(r===void 0)t.targets().add(n);else{const f=s||{},m=new oi(null,function(x,O){return O=Object(be.E)(O)?O:Object(be.m)(O),x?function(T,M){const H=O(T,M);return x.skip()||(x.skip(H!==this.value).value=H),H}:O}(n,r),i,!1);m.modified(f.force),m.rank=t.rank,t.targets().add(m),n&&(m.skip(!0),m.value=n.value,m.targets().add(n),e.connect(n,[m]))}}const le={};function ye(e,t,n){this.dataflow=e,this.stamp=t??-1,this.add=[],this.rem=[],this.mod=[],this.fields=null,this.encode=n||null}function _e(e,t){const n=[];return Object(be.Ka)(e,t,r=>n.push(r)),n}function et(e,t){const n={};return e.visit(t,r=>{n[Zt(r)]=1}),r=>n[Zt(r)]?null:r}function gt(e,t){return e?(n,r)=>e(n,r)&&t(n,r):t}function Rt(e,t,n,r){const i=this,s=n.length;let f=0;this.dataflow=e,this.stamp=t,this.fields=null,this.encode=r||null,this.pulses=n;for(let m=0;m<s;++m){const x=n[m];if(x.stamp===t){if(x.fields){const O=i.fields||(i.fields={});for(const T in x.fields)O[T]=1}x.changed(i.ADD)&&(f|=i.ADD),x.changed(i.REM)&&(f|=i.REM),x.changed(i.MOD)&&(f|=i.MOD)}}this.changes=f}function fn(e){return e.error("Dataflow already running. Use runAsync() to chain invocations."),e}ye.prototype={StopPropagation:le,ADD:1,REM:2,MOD:4,ADD_REM:3,ADD_MOD:5,ALL:7,REFLOW:8,SOURCE:16,NO_SOURCE:32,NO_FIELDS:64,fork(e){return new ye(this.dataflow).init(this,e)},clone(){const e=this.fork(7);return e.add=e.add.slice(),e.rem=e.rem.slice(),e.mod=e.mod.slice(),e.source&&(e.source=e.source.slice()),e.materialize(23)},addAll(){let e=this;return!e.source||e.add===e.rem||!e.rem.length&&e.source.length===e.add.length||((e=new ye(this.dataflow).init(this)).add=e.source,e.rem=[]),e},init(e,t){const n=this;return n.stamp=e.stamp,n.encode=e.encode,!e.fields||64&t||(n.fields=e.fields),1&t?(n.addF=e.addF,n.add=e.add):(n.addF=null,n.add=[]),2&t?(n.remF=e.remF,n.rem=e.rem):(n.remF=null,n.rem=[]),4&t?(n.modF=e.modF,n.mod=e.mod):(n.modF=null,n.mod=[]),32&t?(n.srcF=null,n.source=null):(n.srcF=e.srcF,n.source=e.source,e.cleans&&(n.cleans=e.cleans)),n},runAfter(e){this.dataflow.runAfter(e)},changed(e){const t=e||7;return 1&t&&this.add.length||2&t&&this.rem.length||4&t&&this.mod.length},reflow(e){if(e)return this.fork(7).reflow();const t=this.add.length,n=this.source&&this.source.length;return n&&n!==t&&(this.mod=this.source,t&&this.filter(4,et(this,1))),this},clean(e){return arguments.length?(this.cleans=!!e,this):this.cleans},modifies(e){const t=this.fields||(this.fields={});return Object(be.B)(e)?e.forEach(n=>t[n]=!0):t[e]=!0,this},modified(e,t){const n=this.fields;return!(!t&&!this.mod.length||!n)&&(arguments.length?Object(be.B)(e)?e.some(r=>n[r]):n[e]:!!n)},filter(e,t){const n=this;return 1&e&&(n.addF=gt(n.addF,t)),2&e&&(n.remF=gt(n.remF,t)),4&e&&(n.modF=gt(n.modF,t)),16&e&&(n.srcF=gt(n.srcF,t)),n},materialize(e){const t=this;return 1&(e=e||7)&&t.addF&&(t.add=_e(t.add,t.addF),t.addF=null),2&e&&t.remF&&(t.rem=_e(t.rem,t.remF),t.remF=null),4&e&&t.modF&&(t.mod=_e(t.mod,t.modF),t.modF=null),16&e&&t.srcF&&(t.source=t.source.filter(t.srcF),t.srcF=null),t},visit(e,t){const n=this,r=t;if(16&e)return Object(be.Ka)(n.source,n.srcF,r),n;1&e&&Object(be.Ka)(n.add,n.addF,r),2&e&&Object(be.Ka)(n.rem,n.remF,r),4&e&&Object(be.Ka)(n.mod,n.modF,r);const i=n.source;if(8&e&&i){const s=n.add.length+n.mod.length;s===i.length||(s?Object(be.Ka)(i,et(n,5),r):Object(be.Ka)(i,n.srcF,r))}return n}},Object(be.z)(Rt,ye,{fork(e){const t=new ye(this.dataflow).init(this,e&this.NO_FIELDS);return e!==void 0&&(e&t.ADD&&this.visit(t.ADD,n=>t.add.push(n)),e&t.REM&&this.visit(t.REM,n=>t.rem.push(n)),e&t.MOD&&this.visit(t.MOD,n=>t.mod.push(n))),t},changed(e){return this.changes&e},modified(e){const t=this,n=t.fields;return n&&t.changes&t.MOD?Object(be.B)(e)?e.some(r=>n[r]):n[e]:0},filter(){Object(be.o)("MultiPulse does not support filtering.")},materialize(){Object(be.o)("MultiPulse does not support materialization.")},visit(e,t){const n=this,r=n.pulses,i=r.length;let s=0;if(e&n.SOURCE)for(;s<i;++s)r[s].visit(e,t);else for(;s<i;++s)r[s].stamp===n.stamp&&r[s].visit(e,t);return n}});const Jn={skip:!1,force:!1};function An(e){let t=[];return{clear:()=>t=[],size:()=>t.length,peek:()=>t[0],push:n=>(t.push(n),Ln(t,0,t.length-1,e)),pop:()=>{const n=t.pop();let r;return t.length?(r=t[0],t[0]=n,function(i,s,f){const m=s,x=i.length,O=i[s];let T,M=1+(s<<1);for(;M<x;)(T=M+1)<x&&f(i[M],i[T])>=0&&(M=T),i[s]=i[M],M=1+((s=M)<<1);i[s]=O,Ln(i,m,s,f)}(t,0,e)):r=n,r}}}function Ln(e,t,n,r){let i,s;const f=e[n];for(;n>t&&r(f,i=e[s=n-1>>1])<0;)e[n]=i,n=s;return e[n]=f}function qn(){this.logger(Object(be.M)()),this.logLevel(be.b),this._clock=0,this._rank=0,this._locale=Object(Dr.a)();try{this._loader=Object(Yn.e)()}catch{}this._touched=pr(be.x),this._input={},this._pulse=null,this._heap=An((e,t)=>e.qrank-t.qrank),this._postrun=[]}function Nt(e){return function(){return this._log[e].apply(this,arguments)}}function Ot(e,t){oi.call(this,e,null,t)}qn.prototype={stamp(){return this._clock},loader(e){return arguments.length?(this._loader=e,this):this._loader},locale(e){return arguments.length?(this._locale=e,this):this._locale},logger(e){return arguments.length?(this._log=e,this):this._log},error:Nt("error"),warn:Nt("warn"),info:Nt("info"),debug:Nt("debug"),logLevel:Nt("level"),cleanThreshold:1e4,add:function(e,t,n,r){let i,s=1;return e instanceof oi?i=e:e&&e.prototype instanceof oi?i=new e:Object(be.E)(e)?i=new oi(null,e):(s=0,i=new oi(e,t)),this.rank(i),s&&(r=n,n=t),n&&this.connect(i,i.parameters(n,r)),this.touch(i),i},connect:function(e,t){const n=e.rank,r=t.length;for(let i=0;i<r;++i)if(n<t[i].rank)return void this.rerank(e)},rank:function(e){e.rank=++this._rank},rerank:function(e){const t=[e];let n,r,i;for(;t.length;)if(this.rank(n=t.pop()),r=n._targets)for(i=r.length;--i>=0;)t.push(n=r[i]),n===e&&Object(be.o)("Cycle detected in dataflow graph.")},pulse:function(e,t,n){this.touch(e,n||Jn);const r=new ye(this,this._clock+(this._pulse?0:1)),i=e.pulse&&e.pulse.source||[];return r.target=e,this._input[e.id]=t.pulse(r,i),this},touch:function(e,t){const n=t||Jn;return this._pulse?this._enqueue(e):this._touched.add(e),n.skip&&e.skip(!0),this},update:function(e,t,n){const r=n||Jn;return(e.set(t)||r.force)&&this.touch(e,r),this},changeset:Mr,ingest:function(e,t,n){return t=this.parse(t,n),this.pulse(e,this.changeset().insert(t))},parse:function(e,t){const n=this.locale();return Object(Yn.f)(e,t,n.timeParse,n.utcParse)},preload:async function(e,t,n){const r=this,i=r._pending||function(f){let m;const x=new Promise(O=>m=O);return x.requests=0,x.done=()=>{--x.requests==0&&(f._pending=null,m(f))},f._pending=x}(r);i.requests+=1;const s=await r.request(t,n);return r.pulse(e,r.changeset().remove(be.Ia).insert(s.data||[])),i.done(),s},request:async function(e,t){const n=this;let r,i=0;try{r=await n.loader().load(e,{context:"dataflow",response:Object(Yn.g)(t&&t.type)});try{r=n.parse(r,t)}catch(s){i=-2,n.warn("Data ingestion failed",e,s)}}catch(s){i=-1,n.warn("Loading failed",e,s)}return{data:r,status:i}},events:function(e,t,n,r){const i=this,s=bt(n,r),f=function(O){O.dataflow=i;try{s.receive(O)}catch(T){i.error(T)}finally{i.run()}};let m;const x=(m=typeof e=="string"&&typeof document<"u"?document.querySelectorAll(e):Object(be.i)(e)).length;for(let O=0;O<x;++O)m[O].addEventListener(t,f);return s},on:function(e,t,n,r,i){return(e instanceof oi?ge:Mt)(this,e,t,n,r,i),this},evaluate:async function(e,t,n){const r=this,i=[];if(r._pulse)return fn(r);if(r._pending&&await r._pending,t&&await Nr(r,t),!r._touched.length)return r.debug("Dataflow invoked, but nothing to do."),r;const s=++r._clock;r._pulse=new ye(r,s,e),r._touched.forEach(T=>r._enqueue(T,!0)),r._touched=pr(be.x);let f,m,x,O=0;try{for(;r._heap.size()>0;)(f=r._heap.pop()).rank===f.qrank?((m=f.run(r._getPulse(f,e))).then?m=await m:m.async&&(i.push(m.async),m=le),m!==le&&f._targets&&f._targets.forEach(T=>r._enqueue(T)),++O):r._enqueue(f,!0)}catch(T){r._heap.clear(),x=T}if(r._input={},r._pulse=null,r.debug(`Pulse ${s}: ${O} operators`),x&&(r._postrun=[],r.error(x)),r._postrun.length){const T=r._postrun.sort((M,H)=>H.priority-M.priority);r._postrun=[];for(let M=0;M<T.length;++M)await Nr(r,T[M].callback)}return n&&await Nr(r,n),i.length&&Promise.all(i).then(T=>r.runAsync(null,()=>{T.forEach(M=>{try{M(r)}catch(H){r.error(H)}})})),r},run:function(e,t,n){return this._pulse?fn(this):(this.evaluate(e,t,n),this)},runAsync:async function(e,t,n){for(;this._running;)await this._running;const r=()=>this._running=null;return(this._running=this.evaluate(e,t,n)).then(r,r),this._running},runAfter:function(e,t,n){if(this._pulse||t)this._postrun.push({priority:n||0,callback:e});else try{e(this)}catch(r){this.error(r)}},_enqueue:function(e,t){const n=e.stamp<this._clock;n&&(e.stamp=this._clock),(n||t)&&(e.qrank=e.rank,this._heap.push(e))},_getPulse:function(e,t){const n=e.source,r=this._clock;return n&&Object(be.B)(n)?new Rt(this,r,n.map(i=>i.pulse),t):this._input[e.id]||function(i,s){return s&&s.stamp===i.stamp?s:(i=i.fork(),s&&s!==le&&(i.source=s.source),i)}(this._pulse,n&&n.pulse)}},Object(be.z)(Ot,oi,{run(e){if(e.stamp<this.stamp)return e.StopPropagation;let t;return this.skip()?this.skip(!1):t=this.evaluate(e),(t=t||e).then?t=t.then(n=>this.pulse=n):t!==e.StopPropagation&&(this.pulse=t),t},evaluate(e){const t=this.marshall(e.stamp),n=this.transform(t,e);return t.clear(),n},transform(){}});const pn={};function Ht(e){const t=Ue(e);return t&&t.Definition||null}function Ue(e){return e=e&&e.toLowerCase(),Object(be.w)(pn,e)?pn[e]:null}var Mn=a(87);function Gn(e,t){let n;if(t===void 0)for(const r of e)r!=null&&(n<r||n===void 0&&r>=r)&&(n=r);else{let r=-1;for(let i of e)(i=t(i,++r,e))!=null&&(n<i||n===void 0&&i>=i)&&(n=i)}return n}function Zn(e,t){let n;if(t===void 0)for(const r of e)r!=null&&(n>r||n===void 0&&r>=r)&&(n=r);else{let r=-1;for(let i of e)(i=t(i,++r,e))!=null&&(n>i||n===void 0&&i>=i)&&(n=i)}return n}function ir(e,t,n){const r=e[t];e[t]=e[n],e[n]=r}var zr=function(e){return e===null?NaN:+e};function vr(e,t,n){if(r=(e=Float64Array.from(function*(m,x){if(x===void 0)for(let O of m)O!=null&&(O=+O)>=O&&(yield O);else{let O=-1;for(let T of m)(T=x(T,++O,m))!=null&&(T=+T)>=T&&(yield T)}}(e,n))).length){if((t=+t)<=0||r<2)return Zn(e);if(t>=1)return Gn(e);var r,i=(r-1)*t,s=Math.floor(i),f=Gn(function m(x,O,T=0,M=x.length-1,H=Mn.a){for(;M>T;){if(M-T>600){const Ie=M-T+1,Pe=O-T+1,Le=Math.log(Ie),rt=.5*Math.exp(2*Le/3),it=.5*Math.sqrt(Le*rt*(Ie-rt)/Ie)*(Pe-Ie/2<0?-1:1);m(x,O,Math.max(T,Math.floor(O-Pe*rt/Ie+it)),Math.min(M,Math.floor(O+(Ie-Pe)*rt/Ie+it)),H)}const Z=x[O];let ue=T,fe=M;for(ir(x,T,O),H(x[M],Z)>0&&ir(x,T,M);ue<fe;){for(ir(x,ue,fe),++ue,--fe;H(x[ue],Z)<0;)++ue;for(;H(x[fe],Z)>0;)--fe}H(x[T],Z)===0?ir(x,T,fe):ir(x,++fe,M),fe<=O&&(T=fe+1),O<=fe&&(M=fe-1)}return x}(e,s).subarray(0,s+1));return f+(Zn(e.subarray(s+1))-f)*(i-s)}}function pi(e,t,n=zr){if(r=e.length){if((t=+t)<=0||r<2)return+n(e[0],0,e);if(t>=1)return+n(e[r-1],r-1,e);var r,i=(r-1)*t,s=Math.floor(i),f=+n(e[s],s,e);return f+(+n(e[s+1],s+1,e)-f)*(i-s)}}var fo=function(e,t){return vr(e,.5,t)};function*ui(e,t){if(t==null)for(let n of e)n!=null&&n!==""&&(n=+n)>=n&&(yield n);else{let n=-1;for(let r of e)(r=t(r,++n,e))!=null&&r!==""&&(r=+r)>=r&&(yield r)}}function Zi(e,t,n){const r=Float64Array.from(ui(e,n));return r.sort(Mn.a),t.map(i=>pi(r,i))}function Ti(e,t){return Zi(e,[.25,.5,.75],t)}function qr(e,t){const n=e.length,r=function(f,m){const x=function(O,T){let M,H=0,Z=0,ue=0;if(T===void 0)for(let fe of O)fe!=null&&(fe=+fe)>=fe&&(ue+=(M=fe-Z)*(fe-(Z+=M/++H)));else{let fe=-1;for(let Ie of O)(Ie=T(Ie,++fe,O))!=null&&(Ie=+Ie)>=Ie&&(ue+=(M=Ie-Z)*(Ie-(Z+=M/++H)))}if(H>1)return ue/(H-1)}(f,m);return x&&Math.sqrt(x)}(e,t),i=Ti(e,t),s=(i[2]-i[0])/1.34;return 1.06*(Math.min(r,s)||r||Math.abs(i[0])||1)*Math.pow(n,-.2)}function jr(e){const t=e.maxbins||20,n=e.base||10,r=Math.log(n),i=e.divide||[5,2];let s,f,m,x,O,T,M=e.extent[0],H=e.extent[1];const Z=e.span||H-M||Math.abs(M)||1;if(e.step)s=e.step;else if(e.steps){for(x=Z/t,O=0,T=e.steps.length;O<T&&e.steps[O]<x;++O);s=e.steps[Math.max(0,O-1)]}else{for(f=Math.ceil(Math.log(t)/r),m=e.minstep||0,s=Math.max(m,Math.pow(n,Math.round(Math.log(Z)/r)-f));Math.ceil(Z/s)>t;)s*=n;for(O=0,T=i.length;O<T;++O)(x=s/i[O])>=m&&Z/x<=t&&(s=x)}const ue=(x=Math.log(s))>=0?0:1+~~(-x/r),fe=Math.pow(n,-ue-1);return(e.nice||e.nice===void 0)&&(M=M<(x=Math.floor(M/s+fe)*s)?x-s:x,H=Math.ceil(H/s)*s),{start:M,stop:H===M?M+s:H,step:s}}var jn=Math.random;function ri(e){jn=e}function Vi(e,t,n,r){if(!e.length)return[void 0,void 0];const i=Float64Array.from(ui(e,r)),s=i.length,f=t;let m,x,O,T;for(O=0,T=Array(f);O<f;++O){for(m=0,x=0;x<s;++x)m+=i[~~(jn()*s)];T[O]=m/s}return T.sort(Mn.a),[vr(T,n/2),vr(T,1-n/2)]}function Rr(e,t,n,r){r=r||(H=>H);const i=e.length,s=new Float64Array(i);let f,m=0,x=1,O=r(e[0]),T=O,M=O+t;for(;x<i;++x){if((f=r(e[x]))>=M){for(T=(O+T)/2;m<x;++m)s[m]=T;M=f+t,O=f}T=f}for(T=(O+T)/2;m<x;++m)s[m]=T;return n?function(H,Z){const ue=H.length;let fe,Ie,Pe=0,Le=1;for(;H[Pe]===H[Le];)++Le;for(;Le<ue;){for(fe=Le+1;H[Le]===H[fe];)++fe;if(H[Le]-H[Le-1]<Z){for(Ie=Le+(Pe+fe-Le-Le>>1);Ie<Le;)H[Ie++]=H[Le];for(;Ie>Le;)H[Ie--]=H[Pe]}Pe=Le,Le=fe}return H}(s,t+t/4):s}function ao(e){return function(){return(e=(1103515245*e+12345)%2147483647)/2147483647}}function yo(e,t){let n,r,i;t==null&&(t=e,e=0);const s={min(f){return arguments.length?(i=r-(n=f||0),s):n},max(f){return arguments.length?(i=(r=f||0)-n,s):r},sample:()=>n+Math.floor(i*jn()),pdf:f=>f===Math.floor(f)&&f>=n&&f<r?1/i:0,cdf(f){const m=Math.floor(f);return m<n?0:m>=r?1:(m-n+1)/i},icdf:f=>f>=0&&f<=1?n-1+Math.floor(f*i):NaN};return s.min(e).max(t)}const eo=Math.sqrt(2*Math.PI),bo=Math.SQRT2;let Na=NaN;function vs(e,t){e=e||0,t=t??1;let n,r,i=0,s=0;if(Na==Na)i=Na,Na=NaN;else{do n=(i=2*jn()-1)*i+(s=2*jn()-1)*s;while(n===0||n>1);i*=r=Math.sqrt(-2*Math.log(n)/n),Na=s*r}return e+i*t}function Eh(e,t,n){n=n??1;const r=(e-(t||0))/n;return Math.exp(-.5*r*r)/(n*eo)}function qi(e,t,n){const r=(e-(t=t||0))/(n=n??1),i=Math.abs(r);let s;if(i>37)s=0;else{const f=Math.exp(-i*i/2);i<7.07106781186547?(s=f*((((((.0352624965998911*i+.700383064443688)*i+6.37396220353165)*i+33.912866078383)*i+112.079291497871)*i+221.213596169931)*i+220.206867912376),s/=((((((.0883883476483184*i+1.75566716318264)*i+16.064177579207)*i+86.7807322029461)*i+296.564248779674)*i+637.333633378831)*i+793.826512519948)*i+440.413735824752):s=f/(i+1/(i+2/(i+3/(i+4/(i+.65)))))/2.506628274631}return r>0?1-s:s}function ec(e,t,n){return e<0||e>1?NaN:(t||0)+(n??1)*bo*function(r){let i,s=-Math.log((1-r)*(1+r));return s<6.25?i=1.6536545626831027+(i=.24015818242558962+(i=(i=(i=.00018673420803405714+(i=(i=(i=42347877827932404e-23+(i=(i=(i=10512122733215323e-25+(i=(i=(i=26335093153082323e-28+(i=(i=(i=6637638134358324e-30+(i=20972767875968562e-33+(i=(i=11157877678025181e-33+(i=128584807152564e-32+(i=(i=-364441206401782e-35)*(s-=3.125)-16850591381820166e-35)*s)*s)*s-1333171662854621e-31)*s)*s)*s-4054566272975207e-29)*s-8151934197605472e-29)*s)*s-12975133253453532e-27)*s-5415412054294628e-26)*s)*s-4112633980346984e-24)*s-29070369957882005e-24)*s)*s-13654692000834679e-22)*s-13882523362786469e-21)*s)*s-.000740702534166267)*s-.006033670871430149)*s)*s:s<16?(s=Math.sqrt(s)-3.25,i=3.0838856104922208+(i=1.0052589676941592+(i=.005370914553590064+(i=(i=.002491442096107851+(i=(i=.0009532893797373805+(i=(i=24031110387097894e-21+(i=6828485145957318e-20+(i=(i=12475304481671779e-21+(i=29234449089955446e-22+(i=(i=15027403968909828e-22+(i=18239629214389228e-24+(i=(i=9075656193888539e-23+(i=22137376921775787e-25)*s)*s-27517406297064545e-23)*s)*s)*s-4013867526981546e-21)*s)*s)*s-47318229009055734e-21)*s)*s)*s-.0003550375203628475)*s)*s-.0016882755560235047)*s)*s-.003751208507569241)*s)*s)*s):Number.isFinite(s)?(s=Math.sqrt(s)-5,i=4.849906401408584+(i=1.0103004648645344+(i=(i=(i=7599527703001776e-20+(i=(i=4526062597223154e-21+(i=(i=22900482228026655e-23+(i=(i=2914795345090108e-23+(i=(i=761570120807834e-23+(i=(i=15076572693500548e-25+(i=(i=-27109920616438573e-27)*s-2555641816996525e-25)*s)*s-3789465440126737e-24)*s)*s-1496002662714924e-23)*s)*s-6771199775845234e-23)*s)*s-99298272942317e-20)*s)*s-1968177810553167e-20)*s)*s-.00021503011930044477)*s-.00013871931833623122)*s)*s):i=1/0,i*r}(2*e-1)}function bu(e,t){let n,r;const i={mean(s){return arguments.length?(n=s||0,i):n},stdev(s){return arguments.length?(r=s??1,i):r},sample:()=>vs(n,r),pdf:s=>Eh(s,n,r),cdf:s=>qi(s,n,r),icdf:s=>ec(s,n,r)};return i.mean(e).stdev(t)}function bc(e,t){const n=bu();let r=0;const i={data(s){return arguments.length?(e=s,r=s?s.length:0,i.bandwidth(t)):e},bandwidth(s){return arguments.length?(!(t=s)&&e&&(t=qr(e)),i):t},sample:()=>e[~~(jn()*r)]+t*n.sample(),pdf(s){let f=0,m=0;for(;m<r;++m)f+=n.pdf((s-e[m])/t);return f/t/r},cdf(s){let f=0,m=0;for(;m<r;++m)f+=n.cdf((s-e[m])/t);return f/r},icdf(){throw Error("KDE icdf not supported.")}};return i.data(e)}function Bu(e,t){return e=e||0,t=t??1,Math.exp(e+vs()*t)}function xc(e,t,n){if(e<=0)return 0;t=t||0,n=n??1;const r=(Math.log(e)-t)/n;return Math.exp(-.5*r*r)/(n*eo*e)}function Dd(e,t,n){return qi(Math.log(e),t,n)}function as(e,t,n){return Math.exp(ec(e,t,n))}function vf(e,t){let n,r;const i={mean(s){return arguments.length?(n=s||0,i):n},stdev(s){return arguments.length?(r=s??1,i):r},sample:()=>Bu(n,r),pdf:s=>xc(s,n,r),cdf:s=>Dd(s,n,r),icdf:s=>as(s,n,r)};return i.mean(e).stdev(t)}function Td(e,t){let n,r=0;const i={weights(s){return arguments.length?(n=function(f){const m=[];let x,O=0;for(x=0;x<r;++x)O+=m[x]=f[x]==null?1:+f[x];for(x=0;x<r;++x)m[x]/=O;return m}(t=s||[]),i):t},distributions(s){return arguments.length?(s?(r=s.length,e=s):(r=0,e=[]),i.weights(t)):e},sample(){const s=jn();let f=e[r-1],m=n[0],x=0;for(;x<r-1;m+=n[++x])if(s<m){f=e[x];break}return f.sample()},pdf(s){let f=0,m=0;for(;m<r;++m)f+=n[m]*e[m].pdf(s);return f},cdf(s){let f=0,m=0;for(;m<r;++m)f+=n[m]*e[m].cdf(s);return f},icdf(){throw Error("Mixture icdf not supported.")}};return i.distributions(e).weights(t)}function Pu(e,t){return t==null&&(t=e??1,e=0),e+(t-e)*jn()}function yf(e,t,n){return n==null&&(n=t??1,t=0),e>=t&&e<=n?1/(n-t):0}function Ch(e,t,n){return n==null&&(n=t??1,t=0),e<t?0:e>n?1:(e-t)/(n-t)}function wc(e,t,n){return n==null&&(n=t??1,t=0),e>=0&&e<=1?t+e*(n-t):NaN}function El(e,t){let n,r;const i={min(s){return arguments.length?(n=s||0,i):n},max(s){return arguments.length?(r=s??1,i):r},sample:()=>Pu(n,r),pdf:s=>yf(s,n,r),cdf:s=>Ch(s,n,r),icdf:s=>wc(s,n,r)};return t==null&&(t=e??1,e=0),i.min(e).max(t)}function Fa(e,t,n,r){const i=r-e*e,s=Math.abs(i)<1e-24?0:(n-e*t)/i;return[t-s*e,s]}function Vc(e,t,n,r){e=e.filter(Z=>{let ue=t(Z),fe=n(Z);return ue!=null&&(ue=+ue)>=ue&&fe!=null&&(fe=+fe)>=fe}),r&&e.sort((Z,ue)=>t(Z)-t(ue));const i=e.length,s=new Float64Array(i),f=new Float64Array(i);let m,x,O,T=0,M=0,H=0;for(O of e)s[T]=m=+t(O),f[T]=x=+n(O),M+=(m-M)/++T,H+=(x-H)/T;for(T=0;T<i;++T)s[T]-=M,f[T]-=H;return[s,f,M,H]}function ua(e,t,n,r){let i,s,f=-1;for(const m of e)i=t(m),s=n(m),i!=null&&(i=+i)>=i&&s!=null&&(s=+s)>=s&&r(i,s,++f)}function tc(e,t,n,r,i){let s=0,f=0;return ua(e,t,n,(m,x)=>{const O=x-i(m),T=x-r;s+=O*O,f+=T*T}),1-s/f}function ss(e,t,n){let r=0,i=0,s=0,f=0,m=0;ua(e,t,n,(T,M)=>{r+=(T-r)/++m,i+=(M-i)/m,s+=(T*M-s)/m,f+=(T*T-f)/m});const x=Fa(r,i,s,f),O=T=>x[0]+x[1]*T;return{coef:x,predict:O,rSquared:tc(e,t,n,i,O)}}function Ca(e,t,n){let r=0,i=0,s=0,f=0,m=0;ua(e,t,n,(T,M)=>{++m,T=Math.log(T),r+=(T-r)/m,i+=(M-i)/m,s+=(T*M-s)/m,f+=(T*T-f)/m});const x=Fa(r,i,s,f),O=T=>x[0]+x[1]*Math.log(T);return{coef:x,predict:O,rSquared:tc(e,t,n,i,O)}}function nc(e,t,n){const[r,i,s,f]=Vc(e,t,n);let m,x,O,T=0,M=0,H=0,Z=0,ue=0;ua(e,t,n,(Le,rt)=>{m=r[ue++],x=Math.log(rt),T+=(rt*x-T)/ue,M+=((O=m*rt)-M)/ue,H+=(O*x-H)/ue,Z+=(m*O-Z)/ue});const[fe,Ie]=Fa(M/f,T/f,H/f,Z/f),Pe=Le=>Math.exp(fe+Ie*(Le-s));return{coef:[Math.exp(fe-Ie*s),Ie],predict:Pe,rSquared:tc(e,t,n,f,Pe)}}function Cl(e,t,n){let r=0,i=0,s=0,f=0,m=0,x=0;ua(e,t,n,(M,H)=>{const Z=Math.log(M),ue=Math.log(H);r+=(Z-r)/++x,i+=(ue-i)/x,s+=(Z*ue-s)/x,f+=(Z*Z-f)/x,m+=(H-m)/x});const O=Fa(r,i,s,f),T=M=>O[0]*Math.pow(M,O[1]);return O[0]=Math.exp(O[0]),{coef:O,predict:T,rSquared:tc(e,t,n,m,T)}}function rc(e,t,n){const[r,i,s,f]=Vc(e,t,n),m=r.length;let x,O,T,M,H=0,Z=0,ue=0,fe=0,Ie=0;for(x=0;x<m;)O=r[x],T=i[x++],H+=((M=O*O)-H)/x,Z+=(M*O-Z)/x,ue+=(M*M-ue)/x,fe+=(O*T-fe)/x,Ie+=(M*T-Ie)/x;const Pe=ue-H*H,Le=H*Pe-Z*Z,rt=(Ie*H-fe*Z)/Le,it=(fe*Pe-Ie*Z)/Le,ut=-rt*H,st=mt=>rt*(mt-=s)*mt+it*mt+ut+f;return{coef:[ut-it*s+rt*s*s+f,it-2*rt*s,rt],predict:st,rSquared:tc(e,t,n,f,st)}}function cu(e,t,n,r){if(r===1)return ss(e,t,n);if(r===2)return rc(e,t,n);const[i,s,f,m]=Vc(e,t,n),x=i.length,O=[],T=[],M=r+1;let H,Z,ue,fe,Ie;for(H=0;H<M;++H){for(ue=0,fe=0;ue<x;++ue)fe+=Math.pow(i[ue],H)*s[ue];for(O.push(fe),Ie=new Float64Array(M),Z=0;Z<M;++Z){for(ue=0,fe=0;ue<x;++ue)fe+=Math.pow(i[ue],H+Z);Ie[Z]=fe}T.push(Ie)}T.push(O);const Pe=function(rt){const it=rt.length-1,ut=[];let st,mt,dt,en,mn;for(st=0;st<it;++st){for(en=st,mt=st+1;mt<it;++mt)Math.abs(rt[st][mt])>Math.abs(rt[st][en])&&(en=mt);for(dt=st;dt<it+1;++dt)mn=rt[dt][st],rt[dt][st]=rt[dt][en],rt[dt][en]=mn;for(mt=st+1;mt<it;++mt)for(dt=it;dt>=st;dt--)rt[dt][mt]-=rt[dt][st]*rt[st][mt]/rt[st][st]}for(mt=it-1;mt>=0;--mt){for(mn=0,dt=mt+1;dt<it;++dt)mn+=rt[dt][mt]*ut[dt];ut[mt]=(rt[it][mt]-mn)/rt[mt][mt]}return ut}(T),Le=rt=>{rt-=f;let it=m+Pe[0]+Pe[1]*rt+Pe[2]*rt*rt;for(H=3;H<M;++H)it+=Pe[H]*Math.pow(rt,H);return it};return{coef:function(rt,it,ut,st){const mt=Array(rt);let dt,en,mn,sn;for(dt=0;dt<rt;++dt)mt[dt]=0;for(dt=rt-1;dt>=0;--dt)for(mn=it[dt],sn=1,mt[dt]+=mn,en=1;en<=dt;++en)sn*=(dt+1-en)/en,mt[dt-en]+=mn*Math.pow(ut,en)*sn;return mt[0]+=st,mt}(M,Pe,-f,m),predict:Le,rSquared:tc(e,t,n,m,Le)}}const Oh=2,bf=1e-12;function xf(e,t,n,r){const[i,s,f,m]=Vc(e,t,n,!0),x=i.length,O=Math.max(2,~~(r*x)),T=new Float64Array(x),M=new Float64Array(x),H=new Float64Array(x).fill(1);for(let Z=-1;++Z<=Oh;){const ue=[0,O-1];for(let Ie=0;Ie<x;++Ie){const Pe=i[Ie],Le=ue[0],rt=ue[1],it=Pe-i[Le]>i[rt]-Pe?Le:rt;let ut=0,st=0,mt=0,dt=0,en=0;const mn=1/Math.abs(i[it]-Pe||1);for(let Fn=Le;Fn<=rt;++Fn){const zn=i[Fn],Vn=s[Fn],Qn=fa(Math.abs(Pe-zn)*mn)*H[Fn],mr=zn*Qn;ut+=Qn,st+=mr,mt+=Vn*Qn,dt+=Vn*mr,en+=zn*mr}const[sn,In]=Fa(st/ut,mt/ut,dt/ut,en/ut);T[Ie]=sn+In*Pe,M[Ie]=Math.abs(s[Ie]-T[Ie]),Ah(i,Ie+1,ue)}if(Z===Oh)break;const fe=fo(M);if(Math.abs(fe)<bf)break;for(let Ie,Pe,Le=0;Le<x;++Le)Ie=M[Le]/(6*fe),H[Le]=Ie>=1?bf:(Pe=1-Ie*Ie)*Pe}return function(Z,ue,fe,Ie){const Pe=Z.length,Le=[];let rt,it=0,ut=0,st=[];for(;it<Pe;++it)rt=Z[it]+fe,st[0]===rt?st[1]+=(ue[it]-st[1])/++ut:(ut=0,st[1]+=Ie,st=[rt,ue[it]],Le.push(st));return st[1]+=Ie,Le}(i,T,f,m)}function fa(e){return(e=1-e*e*e)*e*e}function Ah(e,t,n){const r=e[t];let i=n[0],s=n[1]+1;if(!(s>=e.length))for(;t>i&&e[s]-r<=r-e[i];)n[0]=++i,n[1]=s,++s}const Nd=.5*Math.PI/180;function wf(e,t,n,r){n=n||25,r=Math.max(n,r||200);const i=fe=>[fe,e(fe)],s=t[0],f=t[1],m=f-s,x=m/r,O=[i(s)],T=[];if(n===r){for(let fe=1;fe<r;++fe)O.push(i(s+fe/n*m));return O.push(i(f)),O}T.push(i(f));for(let fe=n;--fe>0;)T.push(i(s+fe/n*m));let M=O[0],H=T[T.length-1];const Z=1/m,ue=function(fe,Ie){let Pe=fe,Le=fe;const rt=Ie.length;for(let it=0;it<rt;++it){const ut=Ie[it][1];ut<Pe&&(Pe=ut),ut>Le&&(Le=ut)}return 1/(Le-Pe)}(M[1],T);for(;H;){const fe=i((M[0]+H[0])/2);fe[0]-M[0]>=x&&kf(M,fe,H,Z,ue)>Nd?T.push(fe):(M=H,O.push(H),T.pop()),H=T[T.length-1]}return O}function kf(e,t,n,r,i){const s=Math.atan2(i*(n[1]-e[1]),r*(n[0]-e[0])),f=Math.atan2(i*(t[1]-e[1]),r*(t[0]-e[0]));return Math.abs(s-f)}var ys=function(e,t,n){e=+e,t=+t,n=(i=arguments.length)<2?(t=e,e=0,1):i<3?1:+n;for(var r=-1,i=0|Math.max(0,Math.ceil((t-e)/n)),s=new Array(i);++r<i;)s[r]=e+r*n;return s},Ef=a(108),ar=a(11);function xu(e){return e&&e.length?e.length===1?e[0]:function(t){return n=>{const r=t.length;let i=1,s=String(t[0](n));for(;i<r;++i)s+="|"+t[i](n);return s}}(e):function(){return""}}function Tp(e,t,n){return n||e+(t?"_"+t:"")}const Np=()=>{},Cf={init:Np,add:Np,rem:Np,idx:0},Ol={values:{init:e=>e.cell.store=!0,value:e=>e.cell.data.values(),idx:-1},count:{value:e=>e.cell.num},__count__:{value:e=>e.missing+e.valid},missing:{value:e=>e.missing},valid:{value:e=>e.valid},sum:{init:e=>e.sum=0,value:e=>e.sum,add:(e,t)=>e.sum+=+t,rem:(e,t)=>e.sum-=t},product:{init:e=>e.product=1,value:e=>e.valid?e.product:void 0,add:(e,t)=>e.product*=t,rem:(e,t)=>e.product/=t},mean:{init:e=>e.mean=0,value:e=>e.valid?e.mean:void 0,add:(e,t)=>(e.mean_d=t-e.mean,e.mean+=e.mean_d/e.valid),rem:(e,t)=>(e.mean_d=t-e.mean,e.mean-=e.valid?e.mean_d/e.valid:e.mean)},average:{value:e=>e.valid?e.mean:void 0,req:["mean"],idx:1},variance:{init:e=>e.dev=0,value:e=>e.valid>1?e.dev/(e.valid-1):void 0,add:(e,t)=>e.dev+=e.mean_d*(t-e.mean),rem:(e,t)=>e.dev-=e.mean_d*(t-e.mean),req:["mean"],idx:1},variancep:{value:e=>e.valid>1?e.dev/e.valid:void 0,req:["variance"],idx:2},stdev:{value:e=>e.valid>1?Math.sqrt(e.dev/(e.valid-1)):void 0,req:["variance"],idx:2},stdevp:{value:e=>e.valid>1?Math.sqrt(e.dev/e.valid):void 0,req:["variance"],idx:2},stderr:{value:e=>e.valid>1?Math.sqrt(e.dev/(e.valid*(e.valid-1))):void 0,req:["variance"],idx:2},distinct:{value:e=>e.cell.data.distinct(e.get),req:["values"],idx:3},ci0:{value:e=>e.cell.data.ci0(e.get),req:["values"],idx:3},ci1:{value:e=>e.cell.data.ci1(e.get),req:["values"],idx:3},median:{value:e=>e.cell.data.q2(e.get),req:["values"],idx:3},q1:{value:e=>e.cell.data.q1(e.get),req:["values"],idx:3},q3:{value:e=>e.cell.data.q3(e.get),req:["values"],idx:3},min:{init:e=>e.min=void 0,value:e=>e.min=Number.isNaN(e.min)?e.cell.data.min(e.get):e.min,add:(e,t)=>{(t<e.min||e.min===void 0)&&(e.min=t)},rem:(e,t)=>{t<=e.min&&(e.min=NaN)},req:["values"],idx:4},max:{init:e=>e.max=void 0,value:e=>e.max=Number.isNaN(e.max)?e.cell.data.max(e.get):e.max,add:(e,t)=>{(t>e.max||e.max===void 0)&&(e.max=t)},rem:(e,t)=>{t>=e.max&&(e.max=NaN)},req:["values"],idx:4},argmin:{init:e=>e.argmin=void 0,value:e=>e.argmin||e.cell.data.argmin(e.get),add:(e,t,n)=>{t<e.min&&(e.argmin=n)},rem:(e,t)=>{t<=e.min&&(e.argmin=void 0)},req:["min","values"],idx:3},argmax:{init:e=>e.argmax=void 0,value:e=>e.argmax||e.cell.data.argmax(e.get),add:(e,t,n)=>{t>e.max&&(e.argmax=n)},rem:(e,t)=>{t>=e.max&&(e.argmax=void 0)},req:["max","values"],idx:3}},Fd=Object.keys(Ol);function Sh(e,t){return Ol[e](t)}function _h(e,t){return e.idx-t.idx}function Ii(){this.valid=0,this.missing=0,this._ops.forEach(e=>e.init(this))}function No(e,t){e!=null&&e!==""?e==e&&(++this.valid,this._ops.forEach(n=>n.add(this,e,t))):++this.missing}function Dh(e,t){e!=null&&e!==""?e==e&&(--this.valid,this._ops.forEach(n=>n.rem(this,e,t))):--this.missing}function bm(e){return this._out.forEach(t=>e[t.out]=t.value(this)),e}function Of(e,t){const n=t||be.y,r=function(f){const m={};f.forEach(O=>m[O.name]=O);const x=O=>{O.req&&O.req.forEach(T=>{m[T]||x(m[T]=Ol[T]())})};return f.forEach(x),Object.values(m).sort(_h)}(e),i=e.slice().sort(_h);function s(f){this._ops=r,this._out=i,this.cell=f,this.init()}return s.prototype.init=Ii,s.prototype.add=No,s.prototype.rem=Dh,s.prototype.set=bm,s.prototype.get=n,s.fields=e.map(f=>f.out),s}function Id(e){this._key=e?Object(be.u)(e):Zt,this.reset()}Fd.forEach(e=>{Ol[e]=function(t,n){return r=>Object(be.p)({name:t,out:r||t},Cf,n)}(e,Ol[e])});const bs=Id.prototype;function ic(e){Ot.call(this,null,e),this._adds=[],this._mods=[],this._alen=0,this._mlen=0,this._drop=!0,this._cross=!1,this._dims=[],this._dnames=[],this._measures=[],this._countOnly=!1,this._counts=null,this._prev=null,this._inputs=null,this._outputs=null}bs.reset=function(){this._add=[],this._rem=[],this._ext=null,this._get=null,this._q=null},bs.add=function(e){this._add.push(e)},bs.rem=function(e){this._rem.push(e)},bs.values=function(){if(this._get=null,this._rem.length===0)return this._add;const e=this._add,t=this._rem,n=this._key,r=e.length,i=t.length,s=Array(r-i),f={};let m,x,O;for(m=0;m<i;++m)f[n(t[m])]=1;for(m=0,x=0;m<r;++m)f[n(O=e[m])]?f[n(O)]=0:s[x++]=O;return this._rem=[],this._add=s},bs.distinct=function(e){const t=this.values(),n={};let r,i=t.length,s=0;for(;--i>=0;)r=e(t[i])+"",Object(be.w)(n,r)||(n[r]=1,++s);return s},bs.extent=function(e){if(this._get!==e||!this._ext){const t=this.values(),n=Object(be.r)(t,e);this._ext=[t[n[0]],t[n[1]]],this._get=e}return this._ext},bs.argmin=function(e){return this.extent(e)[0]||{}},bs.argmax=function(e){return this.extent(e)[1]||{}},bs.min=function(e){const t=this.extent(e)[0];return t!=null?e(t):void 0},bs.max=function(e){const t=this.extent(e)[1];return t!=null?e(t):void 0},bs.quartile=function(e){return this._get===e&&this._q||(this._q=Ti(this.values(),e),this._get=e),this._q},bs.q1=function(e){return this.quartile(e)[0]},bs.q2=function(e){return this.quartile(e)[1]},bs.q3=function(e){return this.quartile(e)[2]},bs.ci=function(e){return this._get===e&&this._ci||(this._ci=Vi(this.values(),1e3,.05,e),this._get=e),this._ci},bs.ci0=function(e){return this.ci(e)[0]},bs.ci1=function(e){return this.ci(e)[1]},ic.Definition={type:"Aggregate",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"ops",type:"enum",array:!0,values:Fd},{name:"fields",type:"field",null:!0,array:!0},{name:"as",type:"string",null:!0,array:!0},{name:"drop",type:"boolean",default:!0},{name:"cross",type:"boolean",default:!1},{name:"key",type:"field"}]},Object(be.z)(ic,Ot,{transform(e,t){const n=this,r=t.fork(t.NO_SOURCE|t.NO_FIELDS),i=e.modified();return n.stamp=r.stamp,n.value&&(i||t.modified(n._inputs,!0))?(n._prev=n.value,n.value=i?n.init(e):{},t.visit(t.SOURCE,s=>n.add(s))):(n.value=n.value||n.init(e),t.visit(t.REM,s=>n.rem(s)),t.visit(t.ADD,s=>n.add(s))),r.modifies(n._outputs),n._drop=e.drop!==!1,e.cross&&n._dims.length>1&&(n._drop=!1,n.cross()),t.clean()&&n._drop&&r.clean(!0).runAfter(()=>this.clean()),n.changes(r)},cross(){const e=this,t=e.value,n=e._dnames,r=n.map(()=>({})),i=n.length;function s(f){let m,x,O,T;for(m in f)for(O=f[m].tuple,x=0;x<i;++x)r[x][T=O[n[x]]]=T}s(e._prev),s(t),function f(m,x,O){const T=n[O],M=r[O++];for(const H in M){const Z=m?m+"|"+H:H;x[T]=M[H],O<i?f(Z,x,O):t[Z]||e.cell(Z,x)}}("",{},0)},init(e){const t=this._inputs=[],n=this._outputs=[],r={};function i(Ie){const Pe=Object(be.i)(Object(be.g)(Ie)),Le=Pe.length;let rt,it=0;for(;it<Le;++it)r[rt=Pe[it]]||(r[rt]=1,t.push(rt))}this._dims=Object(be.i)(e.groupby),this._dnames=this._dims.map(Ie=>{const Pe=Object(be.h)(Ie);return i(Ie),n.push(Pe),Pe}),this.cellkey=e.key?e.key:xu(this._dims),this._countOnly=!0,this._counts=[],this._measures=[];const s=e.fields||[null],f=e.ops||["count"],m=e.as||[],x=s.length,O={};let T,M,H,Z,ue,fe;for(x!==f.length&&Object(be.o)("Unmatched number of fields and aggregate ops."),fe=0;fe<x;++fe)T=s[fe],M=f[fe],T==null&&M!=="count"&&Object(be.o)("Null aggregate field specified."),ue=Tp(M,Z=Object(be.h)(T),m[fe]),n.push(ue),M!=="count"?((H=O[Z])||(i(T),(H=O[Z]=[]).field=T,this._measures.push(H)),M!=="count"&&(this._countOnly=!1),H.push(Sh(M,ue))):this._counts.push(ue);return this._measures=this._measures.map(Ie=>Of(Ie,Ie.field)),{}},cellkey:xu(),cell(e,t){let n=this.value[e];return n?n.num===0&&this._drop&&n.stamp<this.stamp?(n.stamp=this.stamp,this._adds[this._alen++]=n):n.stamp<this.stamp&&(n.stamp=this.stamp,this._mods[this._mlen++]=n):(n=this.value[e]=this.newcell(e,t),this._adds[this._alen++]=n),n},newcell(e,t){const n={key:e,num:0,agg:null,tuple:this.newtuple(t,this._prev&&this._prev[e]),stamp:this.stamp,store:!1};if(!this._countOnly){const r=this._measures,i=r.length;n.agg=Array(i);for(let s=0;s<i;++s)n.agg[s]=new r[s](n)}return n.store&&(n.data=new Id),n},newtuple(e,t){const n=this._dnames,r=this._dims,i=r.length,s={};for(let f=0;f<i;++f)s[n[f]]=r[f](e);return t?gr(t.tuple,s):Dn(s)},clean(){const e=this.value;for(const t in e)e[t].num===0&&delete e[t]},add(e){const t=this.cellkey(e),n=this.cell(t,e);if(n.num+=1,this._countOnly)return;n.store&&n.data.add(e);const r=n.agg;for(let i=0,s=r.length;i<s;++i)r[i].add(r[i].get(e),e)},rem(e){const t=this.cellkey(e),n=this.cell(t,e);if(n.num-=1,this._countOnly)return;n.store&&n.data.rem(e);const r=n.agg;for(let i=0,s=r.length;i<s;++i)r[i].rem(r[i].get(e),e)},celltuple(e){const t=e.tuple,n=this._counts;e.store&&e.data.values();for(let r=0,i=n.length;r<i;++r)t[n[r]]=e.num;if(!this._countOnly){const r=e.agg;for(let i=0,s=r.length;i<s;++i)r[i].set(t)}return t},changes(e){const t=this._adds,n=this._mods,r=this._prev,i=this._drop,s=e.add,f=e.rem,m=e.mod;let x,O,T,M;if(r)for(O in r)x=r[O],i&&!x.num||f.push(x.tuple);for(T=0,M=this._alen;T<M;++T)s.push(this.celltuple(t[T])),t[T]=null;for(T=0,M=this._mlen;T<M;++T)((x=n[T]).num===0&&i?f:m).push(this.celltuple(x)),n[T]=null;return this._alen=this._mlen=0,this._prev=null,e}});function Rd(e){Ot.call(this,null,e)}function Fp(e,t,n){const r=e;let i=t||[],s=n||[],f={},m=0;return{add:x=>s.push(x),remove:x=>f[r(x)]=++m,size:()=>i.length,data:(x,O)=>(m&&(i=i.filter(T=>!f[r(T)]),f={},m=0),O&&x&&i.sort(x),s.length&&(i=x?Object(be.O)(x,i,s.sort(x)):i.concat(s),s=[]),i)}}function Ip(e){Ot.call(this,[],e)}function xm(e){oi.call(this,null,wm,e)}function wm(e){return this.value&&!e.modified()?this.value:Object(be.l)(e.fields,e.orders)}function qc(e){Ot.call(this,null,e)}function za(e){Ot.call(this,null,e)}Rd.Definition={type:"Bin",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"interval",type:"boolean",default:!0},{name:"anchor",type:"number"},{name:"maxbins",type:"number",default:20},{name:"base",type:"number",default:10},{name:"divide",type:"number",array:!0,default:[5,2]},{name:"extent",type:"number",array:!0,length:2,required:!0},{name:"span",type:"number"},{name:"step",type:"number"},{name:"steps",type:"number",array:!0},{name:"minstep",type:"number",default:0},{name:"nice",type:"boolean",default:!0},{name:"name",type:"string"},{name:"as",type:"string",array:!0,length:2,default:["bin0","bin1"]}]},Object(be.z)(Rd,Ot,{transform(e,t){const n=e.interval!==!1,r=this._bins(e),i=r.start,s=r.step,f=e.as||["bin0","bin1"],m=f[0],x=f[1];let O;return O=e.modified()?(t=t.reflow(!0)).SOURCE:t.modified(Object(be.g)(e.field))?t.ADD_MOD:t.ADD,t.visit(O,n?T=>{const M=r(T);T[m]=M,T[x]=M==null?null:i+s*(1+(M-i)/s)}:T=>T[m]=r(T)),t.modifies(n?f:m)},_bins(e){if(this.value&&!e.modified())return this.value;const t=e.field,n=jr(e),r=n.step;let i,s,f=n.start,m=f+Math.ceil((n.stop-f)/r)*r;(i=e.anchor)!=null&&(s=i-(f+r*Math.floor((i-f)/r)),f+=s,m+=s);const x=function(O){let T=Object(be.Ea)(t(O));return T==null?null:T<f?-1/0:T>m?1/0:(T=Math.max(f,Math.min(T,m-r)),f+r*Math.floor(1e-14+(T-f)/r))};return x.start=f,x.stop=n.stop,x.step=r,this.value=Object(be.f)(x,Object(be.g)(t),e.name||"bin_"+Object(be.h)(t))}}),Ip.Definition={type:"Collect",metadata:{source:!0},params:[{name:"sort",type:"compare"}]},Object(be.z)(Ip,Ot,{transform(e,t){const n=t.fork(t.ALL),r=Fp(Zt,this.value,n.materialize(n.ADD).add),i=e.sort,s=t.changed()||i&&(e.modified("sort")||t.modified(i.fields));return n.visit(n.REM,r.remove),this.modified(s),this.value=n.source=r.data(Qr(i),s),t.source&&t.source.root&&(this.value.root=t.source.root),n}}),Object(be.z)(xm,oi),qc.Definition={type:"CountPattern",metadata:{generates:!0,changes:!0},params:[{name:"field",type:"field",required:!0},{name:"case",type:"enum",values:["upper","lower","mixed"],default:"mixed"},{name:"pattern",type:"string",default:'[\\w"]+'},{name:"stopwords",type:"string",default:""},{name:"as",type:"string",array:!0,length:2,default:["text","count"]}]},Object(be.z)(qc,Ot,{transform(e,t){const n=M=>H=>{for(var Z,ue=function(Pe,Le,rt){switch(Le){case"upper":Pe=Pe.toUpperCase();break;case"lower":Pe=Pe.toLowerCase()}return Pe.match(rt)}(m(H),e.case,s)||[],fe=0,Ie=ue.length;fe<Ie;++fe)f.test(Z=ue[fe])||M(Z)},r=this._parameterCheck(e,t),i=this._counts,s=this._match,f=this._stop,m=e.field,x=e.as||["text","count"],O=n(M=>i[M]=1+(i[M]||0)),T=n(M=>i[M]-=1);return r?t.visit(t.SOURCE,O):(t.visit(t.ADD,O),t.visit(t.REM,T)),this._finish(t,x)},_parameterCheck(e,t){let n=!1;return!e.modified("stopwords")&&this._stop||(this._stop=new RegExp("^"+(e.stopwords||"")+"$","i"),n=!0),!e.modified("pattern")&&this._match||(this._match=new RegExp(e.pattern||"[\\w']+","g"),n=!0),(e.modified("field")||t.modified(e.field.fields))&&(n=!0),n&&(this._counts={}),n},_finish(e,t){const n=this._counts,r=this._tuples||(this._tuples={}),i=t[0],s=t[1],f=e.fork(e.NO_SOURCE|e.NO_FIELDS);let m,x,O;for(m in n)x=r[m],O=n[m]||0,!x&&O?(r[m]=x=Dn({}),x[i]=m,x[s]=O,f.add.push(x)):O===0?(x&&f.rem.push(x),n[m]=null,r[m]=null):x[s]!==O&&(x[s]=O,f.mod.push(x));return f.modifies(t)}}),za.Definition={type:"Cross",metadata:{generates:!0},params:[{name:"filter",type:"expr"},{name:"as",type:"string",array:!0,length:2,default:["a","b"]}]},Object(be.z)(za,Ot,{transform(e,t){const n=t.fork(t.NO_SOURCE),r=e.as||["a","b"],i=r[0],s=r[1],f=!this.value||t.changed(t.ADD_REM)||e.modified("as")||e.modified("filter");let m=this.value;return f?(m&&(n.rem=m),m=t.materialize(t.SOURCE).source,n.add=this.value=function(x,O,T,M){for(var H,Z,ue=[],fe={},Ie=x.length,Pe=0;Pe<Ie;++Pe)for(fe[O]=Z=x[Pe],H=0;H<Ie;++H)fe[T]=x[H],M(fe)&&(ue.push(Dn(fe)),(fe={})[O]=Z);return ue}(m,i,s,e.filter||be.Ia)):n.mod=m,n.source=this.value,n.modifies(r)}});const Th={kde:bc,mixture:Td,normal:bu,lognormal:vf,uniform:El},Ke="distributions",Lu="function",Af="field";function Md(e){Ot.call(this,null,e)}const So=[{key:{function:"normal"},params:[{name:"mean",type:"number",default:0},{name:"stdev",type:"number",default:1}]},{key:{function:"lognormal"},params:[{name:"mean",type:"number",default:0},{name:"stdev",type:"number",default:1}]},{key:{function:"uniform"},params:[{name:"min",type:"number",default:0},{name:"max",type:"number",default:1}]},{key:{function:"kde"},params:[{name:"field",type:"field",required:!0},{name:"from",type:"data"},{name:"bandwidth",type:"number",default:0}]}],_o={key:{function:"mixture"},params:[{name:"distributions",type:"param",array:!0,params:So},{name:"weights",type:"number",array:!0}]};function Ko(e,t){return e?e.map((n,r)=>t[r]||Object(be.h)(n)):null}function Oa(e,t,n){const r=[],i=M=>M(x);let s,f,m,x,O,T;if(t==null)r.push(e.map(n));else for(s={},f=0,m=e.length;f<m;++f)x=e[f],(T=s[O=t.map(i)])||(s[O]=T=[],T.dims=O,r.push(T)),T.push(n(x));return r}Md.Definition={type:"Density",metadata:{generates:!0},params:[{name:"extent",type:"number",array:!0,length:2},{name:"steps",type:"number"},{name:"minsteps",type:"number",default:25},{name:"maxsteps",type:"number",default:200},{name:"method",type:"string",default:"pdf",values:["pdf","cdf"]},{name:"distribution",type:"param",params:So.concat(_o)},{name:"as",type:"string",array:!0,default:["value","density"]}]},Object(be.z)(Md,Ot,{transform(e,t){const n=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){const r=function O(T,M){const H=T[Lu];Object(be.w)(Th,H)||Object(be.o)("Unknown distribution function: "+H);const Z=Th[H]();for(const ue in T)ue===Af?Z.data((T.from||M()).map(T[ue])):ue===Ke?Z[ue](T[ue].map(fe=>O(fe,M))):typeof Z[ue]===Lu&&Z[ue](T[ue]);return Z}(e.distribution,function(O){return()=>O.materialize(O.SOURCE).source}(t)),i=e.steps||e.minsteps||25,s=e.steps||e.maxsteps||200;let f=e.method||"pdf";f!=="pdf"&&f!=="cdf"&&Object(be.o)("Invalid density method: "+f),e.extent||r.data||Object(be.o)("Missing density extent parameter."),f=r[f];const m=e.as||["value","density"],x=wf(f,e.extent||Object(be.q)(r.data()),i,s).map(O=>{const T={};return T[m[0]]=O[0],T[m[1]]=O[1],Dn(T)});this.value&&(n.rem=this.value),this.value=n.add=n.source=x}return n}});function wu(e){Ot.call(this,null,e)}wu.Definition={type:"DotBin",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"groupby",type:"field",array:!0},{name:"step",type:"number"},{name:"smooth",type:"boolean",default:!1},{name:"as",type:"string",default:"bin"}]};function Aa(e){oi.call(this,null,kc,e),this.modified(!0)}function kc(e){const t=e.expr;return this.value&&!e.modified("expr")?this.value:Object(be.f)(n=>t(n,e),Object(be.g)(t),Object(be.h)(t))}function tu(e){Ot.call(this,[void 0,void 0],e)}function wt(e,t){oi.call(this,e),this.parent=t,this.count=0}function ho(e){Ot.call(this,{},e),this._keys=Object(be.t)();const t=this._targets=[];t.active=0,t.forEach=n=>{for(let r=0,i=t.active;r<i;++r)n(t[r],r,t)}}function ca(e){oi.call(this,null,Ua,e)}function Ua(e){return this.value&&!e.modified()?this.value:Object(be.B)(e.name)?Object(be.i)(e.name).map(t=>Object(be.u)(t)):Object(be.u)(e.name,e.as)}function ko(e){Ot.call(this,Object(be.t)(),e)}function xs(e){Ot.call(this,[],e)}function fr(e){Ot.call(this,[],e)}function Us(e){Ot.call(this,null,e)}function nu(e){Ot.call(this,[],e)}Object(be.z)(wu,Ot,{transform(e,t){if(this.value&&!e.modified()&&!t.changed())return t;const n=t.materialize(t.SOURCE).source,r=Oa(t.source,e.groupby,be.y),i=e.smooth||!1,s=e.field,f=e.step||((ue,fe)=>Object(be.Z)(Object(be.q)(ue,fe))/30)(n,s),m=Qr((ue,fe)=>s(ue)-s(fe)),x=e.as||"bin",O=r.length;let T,M=1/0,H=-1/0,Z=0;for(;Z<O;++Z){const ue=r[Z].sort(m);T=-1;for(const fe of Rr(ue,f,i,s))fe<M&&(M=fe),fe>H&&(H=fe),ue[++T][x]=fe}return this.value={start:M,stop:H,step:f},t.reflow(!0).modifies(x)}}),Object(be.z)(Aa,oi),tu.Definition={type:"Extent",metadata:{},params:[{name:"field",type:"field",required:!0}]},Object(be.z)(tu,Ot,{transform(e,t){const n=this.value,r=e.field,i=t.changed()||t.modified(r.fields)||e.modified("field");let s=n[0],f=n[1];if((i||s==null)&&(s=1/0,f=-1/0),t.visit(i?t.SOURCE:t.ADD,m=>{const x=Object(be.Ea)(r(m));x!=null&&(x<s&&(s=x),x>f&&(f=x))}),!Number.isFinite(s)||!Number.isFinite(f)){let m=Object(be.h)(r);m&&(m=` for field "${m}"`),t.dataflow.warn(`Infinite extent${m}: [${s}, ${f}]`),s=f=void 0}this.value=[s,f]}}),Object(be.z)(wt,oi,{connect(e){return this.detachSubflow=e.detachSubflow,this.targets().add(e),e.source=this},add(e){this.count+=1,this.value.add.push(e)},rem(e){this.count-=1,this.value.rem.push(e)},mod(e){this.value.mod.push(e)},init(e){this.value.init(e,e.NO_SOURCE)},evaluate(){return this.value}}),Object(be.z)(ho,Ot,{activate(e){this._targets[this._targets.active++]=e},subflow(e,t,n,r){const i=this.value;let s,f,m=Object(be.w)(i,e)&&i[e];return m?m.value.stamp<n.stamp&&(m.init(n),this.activate(m)):(f=r||(f=this._group[e])&&f.tuple,s=n.dataflow,m=new wt(n.fork(n.NO_SOURCE),this),s.add(m).connect(t(s,e,f)),i[e]=m,this.activate(m)),m},clean(){const e=this.value;let t=0;for(const n in e)if(e[n].count===0){const r=e[n].detachSubflow;r&&r(),delete e[n],++t}if(t){const n=this._targets.filter(r=>r&&r.count>0);this.initTargets(n)}},initTargets(e){const t=this._targets,n=t.length,r=e?e.length:0;let i=0;for(;i<r;++i)t[i]=e[i];for(;i<n&&t[i]!=null;++i)t[i]=null;t.active=r},transform(e,t){const n=t.dataflow,r=e.key,i=e.subflow,s=this._keys,f=e.modified("key"),m=x=>this.subflow(x,i,t);return this._group=e.group||{},this.initTargets(),t.visit(t.REM,x=>{const O=Zt(x),T=s.get(O);T!==void 0&&(s.delete(O),m(T).rem(x))}),t.visit(t.ADD,x=>{const O=r(x);s.set(Zt(x),O),m(O).add(x)}),f||t.modified(r.fields)?t.visit(t.MOD,x=>{const O=Zt(x),T=s.get(O),M=r(x);T===M?m(M).mod(x):(s.set(O,M),m(T).rem(x),m(M).add(x))}):t.changed(t.MOD)&&t.visit(t.MOD,x=>{m(s.get(Zt(x))).mod(x)}),f&&t.visit(t.REFLOW,x=>{const O=Zt(x),T=s.get(O),M=r(x);T!==M&&(s.set(O,M),m(T).rem(x),m(M).add(x))}),t.clean()?n.runAfter(()=>{this.clean(),s.clean()}):s.empty>n.cleanThreshold&&n.runAfter(s.clean),t}}),Object(be.z)(ca,oi),ko.Definition={type:"Filter",metadata:{changes:!0},params:[{name:"expr",type:"expr",required:!0}]},Object(be.z)(ko,Ot,{transform(e,t){const n=t.dataflow,r=this.value,i=t.fork(),s=i.add,f=i.rem,m=i.mod,x=e.expr;let O=!0;function T(M){const H=Zt(M),Z=x(M,e),ue=r.get(H);Z&&ue?(r.delete(H),s.push(M)):Z||ue?O&&Z&&!ue&&m.push(M):(r.set(H,1),f.push(M))}return t.visit(t.REM,M=>{const H=Zt(M);r.has(H)?r.delete(H):f.push(M)}),t.visit(t.ADD,M=>{x(M,e)?s.push(M):r.set(Zt(M),1)}),t.visit(t.MOD,T),e.modified()&&(O=!1,t.visit(t.REFLOW,T)),r.empty>n.cleanThreshold&&n.runAfter(r.clean),i}}),xs.Definition={type:"Flatten",metadata:{generates:!0},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"index",type:"string"},{name:"as",type:"string",array:!0}]},Object(be.z)(xs,Ot,{transform(e,t){const n=t.fork(t.NO_SOURCE),r=e.fields,i=Ko(r,e.as||[]),s=e.index||null,f=i.length;return n.rem=this.value,t.visit(t.SOURCE,m=>{const x=r.map(ue=>ue(m)),O=x.reduce((ue,fe)=>Math.max(ue,fe.length),0);let T,M,H,Z=0;for(;Z<O;++Z){for(M=hr(m),T=0;T<f;++T)M[i[T]]=(H=x[T][Z])==null?null:H;s&&(M[s]=Z),n.add.push(M)}}),this.value=n.source=n.add,s&&n.modifies(s),n.modifies(i)}}),fr.Definition={type:"Fold",metadata:{generates:!0},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"as",type:"string",array:!0,length:2,default:["key","value"]}]},Object(be.z)(fr,Ot,{transform(e,t){const n=t.fork(t.NO_SOURCE),r=e.fields,i=r.map(be.h),s=e.as||["key","value"],f=s[0],m=s[1],x=r.length;return n.rem=this.value,t.visit(t.SOURCE,O=>{for(let T,M=0;M<x;++M)(T=hr(O))[f]=i[M],T[m]=r[M](O),n.add.push(T)}),this.value=n.source=n.add,n.modifies(s)}}),Us.Definition={type:"Formula",metadata:{modifies:!0},params:[{name:"expr",type:"expr",required:!0},{name:"as",type:"string",required:!0},{name:"initonly",type:"boolean"}]},Object(be.z)(Us,Ot,{transform(e,t){const n=e.expr,r=e.as,i=e.modified(),s=e.initonly?t.ADD:i?t.SOURCE:t.modified(n.fields)||t.modified(r)?t.ADD_MOD:t.ADD;return i&&(t=t.materialize().reflow(!0)),e.initonly||t.modifies(r),t.visit(s,f=>f[r]=n(f,e))}}),Object(be.z)(nu,Ot,{transform(e,t){const n=t.fork(t.ALL),r=e.generator;let i,s,f,m=this.value,x=e.size-m.length;if(x>0){for(i=[];--x>=0;)i.push(f=Dn(r(e))),m.push(f);n.add=n.add.length?n.materialize(n.ADD).add.concat(i):i}else s=m.slice(0,-x),n.rem=n.rem.length?n.materialize(n.REM).rem.concat(s):s,m=m.slice(-x);return n.source=this.value=m,n}});const Hc={value:"value",median:fo,mean:function(e,t){let n=0,r=0;if(t===void 0)for(let i of e)i!=null&&(i=+i)>=i&&(++n,r+=i);else{let i=-1;for(let s of e)(s=t(s,++i,e))!=null&&(s=+s)>=s&&(++n,r+=s)}if(n)return r/n},min:Zn,max:Gn},Ws=[];function Nh(e){Ot.call(this,[],e)}function jd(e){ic.call(this,e)}function Bd(e){Ot.call(this,null,e)}function lu(e){oi.call(this,null,Ki,e)}function Ki(e){return this.value&&!e.modified()?this.value:Object(be.K)(e.fields,e.flat)}function ws(e){Ot.call(this,[],e),this._pending=null}function Fh(e,t,n){n.forEach(Dn);const r=t.fork(t.NO_FIELDS&t.NO_SOURCE);return r.rem=e.value,e.value=r.source=r.add=n,e._pending=null,r.rem.length&&r.clean(!0),r}function oc(e){Ot.call(this,{},e)}function us(e){oi.call(this,null,ii,e)}function ii(e){if(this.value&&!e.modified())return this.value;const t=e.extents,n=t.length;let r,i,s=1/0,f=-1/0;for(r=0;r<n;++r)(i=t[r])[0]<s&&(s=i[0]),i[1]>f&&(f=i[1]);return[s,f]}function Po(e){oi.call(this,null,Ih,e)}function Ih(e){return this.value&&!e.modified()?this.value:e.values.reduce((t,n)=>t.concat(n),[])}function Pd(e){Ot.call(this,null,e)}function Al(e){ic.call(this,e)}function Rh(e){ho.call(this,e)}function Ri(e){Ot.call(this,null,e)}function bi(e){Ot.call(this,null,e)}function oa(e){Ot.call(this,null,e)}Nh.Definition={type:"Impute",metadata:{changes:!0},params:[{name:"field",type:"field",required:!0},{name:"key",type:"field",required:!0},{name:"keyvals",array:!0},{name:"groupby",type:"field",array:!0},{name:"method",type:"enum",default:"value",values:["value","mean","median","max","min"]},{name:"value",default:0}]},Object(be.z)(Nh,Ot,{transform(e,t){var n,r,i,s,f,m,x,O,T,M,H=t.fork(t.ALL),Z=function(st){var mt,dt=st.method||Hc.value;if(Hc[dt]!=null)return dt===Hc.value?(mt=st.value!==void 0?st.value:0,()=>mt):Hc[dt];Object(be.o)("Unrecognized imputation method: "+dt)}(e),ue=function(st){const mt=st.field;return dt=>dt?mt(dt):NaN}(e),fe=Object(be.h)(e.field),Ie=Object(be.h)(e.key),Pe=(e.groupby||[]).map(be.h),Le=function(st,mt,dt,en){var mn,sn,In,Fn,zn,Vn,Qn,mr,Pr=zi=>zi(mr),Cr=[],Jr=en?en.slice():[],gi={},vi={};for(Jr.forEach((zi,wi)=>gi[zi]=wi+1),Fn=0,Qn=st.length;Fn<Qn;++Fn)mr=st[Fn],Vn=dt(mr),zn=gi[Vn]||(gi[Vn]=Jr.push(Vn)),sn=(mn=mt?mt.map(Pr):Ws)+"",(In=vi[sn])||(In=vi[sn]=[],Cr.push(In),In.values=mn),In[zn-1]=mr;return Cr.domain=Jr,Cr}(t.source,e.groupby,e.key,e.keyvals),rt=[],it=this.value,ut=Le.domain.length;for(f=0,O=Le.length;f<O;++f)for(i=(n=Le[f]).values,r=NaN,x=0;x<ut;++x)if(n[x]==null){for(s=Le.domain[x],M={_impute:!0},m=0,T=i.length;m<T;++m)M[Pe[m]]=i[m];M[Ie]=s,M[fe]=Number.isNaN(r)?r=Z(n,ue):r,rt.push(Dn(M))}return rt.length&&(H.add=H.materialize(H.ADD).add.concat(rt)),it.length&&(H.rem=H.materialize(H.REM).rem.concat(it)),this.value=rt,H}}),jd.Definition={type:"JoinAggregate",metadata:{modifies:!0},params:[{name:"groupby",type:"field",array:!0},{name:"fields",type:"field",null:!0,array:!0},{name:"ops",type:"enum",array:!0,values:Fd},{name:"as",type:"string",null:!0,array:!0},{name:"key",type:"field"}]},Object(be.z)(jd,ic,{transform(e,t){const n=this,r=e.modified();let i;return n.value&&(r||t.modified(n._inputs,!0))?(i=n.value=r?n.init(e):{},t.visit(t.SOURCE,s=>n.add(s))):(i=n.value=n.value||this.init(e),t.visit(t.REM,s=>n.rem(s)),t.visit(t.ADD,s=>n.add(s))),n.changes(),t.visit(t.SOURCE,s=>{Object(be.p)(s,i[n.cellkey(s)].tuple)}),t.reflow(r).modifies(this._outputs)},changes(){const e=this._adds,t=this._mods;let n,r;for(n=0,r=this._alen;n<r;++n)this.celltuple(e[n]),e[n]=null;for(n=0,r=this._mlen;n<r;++n)this.celltuple(t[n]),t[n]=null;this._alen=this._mlen=0}}),Bd.Definition={type:"KDE",metadata:{generates:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"cumulative",type:"boolean",default:!1},{name:"counts",type:"boolean",default:!1},{name:"bandwidth",type:"number",default:0},{name:"extent",type:"number",array:!0,length:2},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"steps",type:"number"},{name:"minsteps",type:"number",default:25},{name:"maxsteps",type:"number",default:200},{name:"as",type:"string",array:!0,default:["value","density"]}]},Object(be.z)(Bd,Ot,{transform(e,t){const n=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){const r=t.materialize(t.SOURCE).source,i=Oa(r,e.groupby,e.field),s=(e.groupby||[]).map(be.h),f=e.bandwidth,m=e.cumulative?"cdf":"pdf",x=e.as||["value","density"],O=[];let T=e.extent,M=e.steps||e.minsteps||25,H=e.steps||e.maxsteps||200;m!=="pdf"&&m!=="cdf"&&Object(be.o)("Invalid density method: "+m),e.resolve==="shared"&&(T||(T=Object(be.q)(r,e.field)),M=H=e.steps||H),i.forEach(Z=>{const ue=bc(Z,f)[m],fe=e.counts?Z.length:1;wf(ue,T||Object(be.q)(Z),M,H).forEach(Ie=>{const Pe={};for(let Le=0;Le<s.length;++Le)Pe[s[Le]]=Z.dims[Le];Pe[x[0]]=Ie[0],Pe[x[1]]=Ie[1]*fe,O.push(Dn(Pe))})}),this.value&&(n.rem=this.value),this.value=n.add=n.source=O}return n}}),Object(be.z)(lu,oi),Object(be.z)(ws,Ot,{transform(e,t){const n=t.dataflow;return this._pending?Fh(this,t,this._pending):function(r){return r.modified("async")&&!(r.modified("values")||r.modified("url")||r.modified("format"))}(e)?t.StopPropagation:e.values?Fh(this,t,n.parse(e.values,e.format)):e.async?{async:n.request(e.url,e.format).then(r=>(this._pending=Object(be.i)(r.data),i=>i.touch(this)))}:n.request(e.url,e.format).then(r=>Fh(this,t,Object(be.i)(r.data)))}}),oc.Definition={type:"Lookup",metadata:{modifies:!0},params:[{name:"index",type:"index",params:[{name:"from",type:"data",required:!0},{name:"key",type:"field",required:!0}]},{name:"values",type:"field",array:!0},{name:"fields",type:"field",array:!0,required:!0},{name:"as",type:"string",array:!0},{name:"default",default:null}]},Object(be.z)(oc,Ot,{transform(e,t){const n=e.fields,r=e.index,i=e.values,s=e.default==null?null:e.default,f=e.modified(),m=n.length;let x,O,T=f?t.SOURCE:t.ADD,M=t,H=e.as;return i?(O=i.length,m>1&&!H&&Object(be.o)('Multi-field lookup requires explicit "as" parameter.'),H&&H.length!==m*O&&Object(be.o)('The "as" parameter has too few output field names.'),H=H||i.map(be.h),x=function(Z){for(var ue,fe,Ie=0,Pe=0;Ie<m;++Ie)if((fe=r.get(n[Ie](Z)))==null)for(ue=0;ue<O;++ue,++Pe)Z[H[Pe]]=s;else for(ue=0;ue<O;++ue,++Pe)Z[H[Pe]]=i[ue](fe)}):(H||Object(be.o)("Missing output field names."),x=function(Z){for(var ue,fe=0;fe<m;++fe)ue=r.get(n[fe](Z)),Z[H[fe]]=ue??s}),f?M=t.reflow(!0):T|=n.some(Z=>t.modified(Z.fields))?t.MOD:0,t.visit(T,x),M.modifies(H)}}),Object(be.z)(us,oi),Object(be.z)(Po,oi),Object(be.z)(Pd,Ot,{transform(e,t){return this.modified(e.modified()),this.value=e,t.fork(t.NO_SOURCE|t.NO_FIELDS)}}),Al.Definition={type:"Pivot",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"value",type:"field",required:!0},{name:"op",type:"enum",values:Fd,default:"sum"},{name:"limit",type:"number",default:0},{name:"key",type:"field"}]},Object(be.z)(Al,ic,{_transform:ic.prototype.transform,transform(e,t){return this._transform(function(n,r){const i=n.field,s=n.value,f=(n.op==="count"?"__count__":n.op)||"sum",m=Object(be.g)(i).concat(Object(be.g)(s)),x=function(O,T,M){const H={},Z=[];return M.visit(M.SOURCE,ue=>{const fe=O(ue);H[fe]||(H[fe]=1,Z.push(fe))}),Z.sort(be.j),T?Z.slice(0,T):Z}(i,n.limit||0,r);return r.changed()&&n.set("__pivot__",null,null,!0),{key:n.key,groupby:n.groupby,ops:x.map(()=>f),fields:x.map(O=>function(T,M,H,Z){return Object(be.f)(ue=>M(ue)===T?H(ue):NaN,Z,T+"")}(O,i,s,m)),as:x.map(O=>O+""),modified:n.modified.bind(n)}}(e,t),t)}}),Object(be.z)(Rh,ho,{transform(e,t){const n=e.subflow,r=e.field,i=s=>this.subflow(Zt(s),n,t,s);return(e.modified("field")||r&&t.modified(Object(be.g)(r)))&&Object(be.o)("PreFacet does not support field modification."),this.initTargets(),r?(t.visit(t.MOD,s=>{const f=i(s);r(s).forEach(m=>f.mod(m))}),t.visit(t.ADD,s=>{const f=i(s);r(s).forEach(m=>f.add(Dn(m)))}),t.visit(t.REM,s=>{const f=i(s);r(s).forEach(m=>f.rem(m))})):(t.visit(t.MOD,s=>i(s).mod(s)),t.visit(t.ADD,s=>i(s).add(s)),t.visit(t.REM,s=>i(s).rem(s))),t.clean()&&t.runAfter(()=>this.clean()),t}}),Ri.Definition={type:"Project",metadata:{generates:!0,changes:!0},params:[{name:"fields",type:"field",array:!0},{name:"as",type:"string",null:!0,array:!0}]},Object(be.z)(Ri,Ot,{transform(e,t){const n=t.fork(t.NO_SOURCE),r=e.fields,i=Ko(e.fields,e.as||[]),s=r?(m,x)=>function(O,T,M,H){for(let Z=0,ue=M.length;Z<ue;++Z)T[H[Z]]=M[Z](O);return T}(m,x,r,i):wr;let f;return this.value?f=this.value:(t=t.addAll(),f=this.value={}),t.visit(t.REM,m=>{const x=Zt(m);n.rem.push(f[x]),f[x]=null}),t.visit(t.ADD,m=>{const x=s(m,Dn({}));f[Zt(m)]=x,n.add.push(x)}),t.visit(t.MOD,m=>{n.mod.push(s(m,f[Zt(m)]))}),n}}),Object(be.z)(bi,Ot,{transform(e,t){return this.value=e.value,e.modified("value")?t.fork(t.NO_SOURCE|t.NO_FIELDS):t.StopPropagation}}),oa.Definition={type:"Quantile",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"probs",type:"number",array:!0},{name:"step",type:"number",default:.01},{name:"as",type:"string",array:!0,default:["prob","value"]}]};function Ld(e){Ot.call(this,null,e)}function zd(e){Ot.call(this,[],e),this.count=0}function Ud(e){Ot.call(this,null,e)}function Rp(e){Ot.call(this,null,e),this.modified(!0)}function zu(e){Ot.call(this,null,e)}Object(be.z)(oa,Ot,{transform(e,t){const n=t.fork(t.NO_SOURCE|t.NO_FIELDS),r=e.as||["prob","value"];if(this.value&&!e.modified()&&!t.changed())return n.source=this.value,n;const i=Oa(t.materialize(t.SOURCE).source,e.groupby,e.field),s=(e.groupby||[]).map(be.h),f=[],m=e.step||.01,x=e.probs||ys(m/2,1-1e-14,m),O=x.length;return i.forEach(T=>{const M=Zi(T,x);for(let H=0;H<O;++H){const Z={};for(let ue=0;ue<s.length;++ue)Z[s[ue]]=T.dims[ue];Z[r[0]]=x[H],Z[r[1]]=M[H],f.push(Dn(Z))}}),this.value&&(n.rem=this.value),this.value=n.add=n.source=f,n}}),Object(be.z)(Ld,Ot,{transform(e,t){let n,r;return this.value?r=this.value:(n=t=t.addAll(),r=this.value={}),e.derive&&(n=t.fork(t.NO_SOURCE),t.visit(t.REM,i=>{const s=Zt(i);n.rem.push(r[s]),r[s]=null}),t.visit(t.ADD,i=>{const s=hr(i);r[Zt(i)]=s,n.add.push(s)}),t.visit(t.MOD,i=>{const s=r[Zt(i)];for(const f in i)s[f]=i[f],n.modifies(f);n.mod.push(s)})),n}}),zd.Definition={type:"Sample",metadata:{},params:[{name:"size",type:"number",default:1e3}]},Object(be.z)(zd,Ot,{transform(e,t){const n=t.fork(t.NO_SOURCE),r=e.modified("size"),i=e.size,s=this.value.reduce((T,M)=>(T[Zt(M)]=1,T),{});let f=this.value,m=this.count,x=0;function O(T){let M,H;f.length<i?f.push(T):(H=~~((m+1)*jn()))<f.length&&H>=x&&(M=f[H],s[Zt(M)]&&n.rem.push(M),f[H]=T),++m}if(t.rem.length&&(t.visit(t.REM,T=>{const M=Zt(T);s[M]&&(s[M]=-1,n.rem.push(T)),--m}),f=f.filter(T=>s[Zt(T)]!==-1)),(t.rem.length||r)&&f.length<i&&t.source&&(x=m=f.length,t.visit(t.SOURCE,T=>{s[Zt(T)]||O(T)}),x=-1),r&&f.length>i){const T=f.length-i;for(let M=0;M<T;++M)s[Zt(f[M])]=-1,n.rem.push(f[M]);f=f.slice(T)}return t.mod.length&&t.visit(t.MOD,T=>{s[Zt(T)]&&n.mod.push(T)}),t.add.length&&t.visit(t.ADD,O),(t.add.length||x<0)&&(n.add=f.filter(T=>!s[Zt(T)])),this.count=m,this.value=n.source=f,n}}),Ud.Definition={type:"Sequence",metadata:{generates:!0,changes:!0},params:[{name:"start",type:"number",required:!0},{name:"stop",type:"number",required:!0},{name:"step",type:"number",default:1},{name:"as",type:"string",default:"data"}]},Object(be.z)(Ud,Ot,{transform(e,t){if(this.value&&!e.modified())return;const n=t.materialize().fork(t.MOD),r=e.as||"data";return n.rem=this.value?t.rem.concat(this.value):t.rem,this.value=ys(e.start,e.stop,e.step||1).map(i=>{const s={};return s[r]=i,Dn(s)}),n.add=t.add.concat(this.value),n}}),Object(be.z)(Rp,Ot,{transform(e,t){return this.value=t.source,t.changed()?t.fork(t.NO_SOURCE|t.NO_FIELDS):t.StopPropagation}});const ks=["unit0","unit1"];function $c(e){Ot.call(this,Object(be.t)(),e)}function Is(e){Ot.call(this,null,e)}zu.Definition={type:"TimeUnit",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"interval",type:"boolean",default:!0},{name:"units",type:"enum",values:ar.j,array:!0},{name:"step",type:"number",default:1},{name:"maxbins",type:"number",default:40},{name:"extent",type:"date",array:!0},{name:"timezone",type:"enum",default:"local",values:["local","utc"]},{name:"as",type:"string",array:!0,length:2,default:ks}]},Object(be.z)(zu,Ot,{transform(e,t){const n=e.field,r=e.interval!==!1,i=e.timezone==="utc",s=this._floor(e,t),f=(i?ar.v:ar.p)(s.unit).offset,m=e.as||ks,x=m[0],O=m[1],T=s.step;let M=s.start||1/0,H=s.stop||-1/0,Z=t.ADD;return(e.modified()||t.modified(Object(be.g)(n)))&&(Z=(t=t.reflow(!0)).SOURCE,M=1/0,H=-1/0),t.visit(Z,ue=>{const fe=n(ue);let Ie,Pe;fe==null?(ue[x]=null,r&&(ue[O]=null)):(ue[x]=Ie=Pe=s(fe),r&&(ue[O]=Pe=f(Ie,T)),Ie<M&&(M=Ie),Pe>H&&(H=Pe))}),s.start=M,s.stop=H,t.modifies(r?m:x)},_floor(e,t){const n=e.timezone==="utc",{units:r,step:i}=e.units?{units:e.units,step:e.step||1}:Object(ar.n)({extent:e.extent||Object(be.q)(t.materialize(t.SOURCE).source,e.field),maxbins:e.maxbins}),s=Object(ar.t)(r),f=this.value||{},m=(n?ar.u:ar.o)(s,i);return m.unit=Object(be.W)(s),m.units=s,m.step=i,m.start=f.start,m.stop=f.stop,this.value=m}}),Object(be.z)($c,Ot,{transform(e,t){const n=t.dataflow,r=e.field,i=this.value,s=m=>i.set(r(m),m);let f=!0;return e.modified("field")||t.modified(r.fields)?(i.clear(),t.visit(t.SOURCE,s)):t.changed()?(t.visit(t.REM,m=>i.delete(r(m))),t.visit(t.ADD,s)):f=!1,this.modified(f),i.empty>n.cleanThreshold&&n.runAfter(i.clean),t.fork()}}),Object(be.z)(Is,Ot,{transform(e,t){(!this.value||e.modified("field")||e.modified("sort")||t.changed()||e.sort&&t.modified(e.sort.fields))&&(this.value=(e.sort?t.source.slice().sort(Qr(e.sort)):t.source).map(e.field))}});const ru={row_number:function(){return{next:e=>e.index+1}},rank:function(){let e;return{init:()=>e=1,next:t=>{const n=t.index,r=t.data;return n&&t.compare(r[n-1],r[n])?e=n+1:e}}},dense_rank:function(){let e;return{init:()=>e=1,next:t=>{const n=t.index,r=t.data;return n&&t.compare(r[n-1],r[n])?++e:e}}},percent_rank:function(){const e=ru.rank(),t=e.next;return{init:e.init,next:n=>(t(n)-1)/(n.data.length-1)}},cume_dist:function(){let e;return{init:()=>e=0,next:t=>{const n=t.data,r=t.compare;let i=t.index;if(e<i){for(;i+1<n.length&&!r(n[i],n[i+1]);)++i;e=i}return(1+e)/n.length}}},ntile:function(e,t){(t=+t)>0||Object(be.o)("ntile num must be greater than zero.");const n=ru.cume_dist(),r=n.next;return{init:n.init,next:i=>Math.ceil(t*r(i))}},lag:function(e,t){return t=+t||1,{next:n=>{const r=n.index-t;return r>=0?e(n.data[r]):null}}},lead:function(e,t){return t=+t||1,{next:n=>{const r=n.index+t,i=n.data;return r<i.length?e(i[r]):null}}},first_value:function(e){return{next:t=>e(t.data[t.i0])}},last_value:function(e){return{next:t=>e(t.data[t.i1-1])}},nth_value:function(e,t){return(t=+t)>0||Object(be.o)("nth_value nth must be greater than zero."),{next:n=>{const r=n.i0+(t-1);return r<n.i1?e(n.data[r]):null}}},prev_value:function(e){let t;return{init:()=>t=null,next:n=>{const r=e(n.data[n.index]);return r!=null?t=r:t}}},next_value:function(e){let t,n;return{init:()=>(t=null,n=-1),next:r=>{const i=r.data;return r.index<=n?t:(n=function(s,f,m){for(let x=f.length;m<x;++m)if(s(f[m])!=null)return m;return-1}(e,i,r.index))<0?(n=i.length,t=null):t=e(i[n])}}}},Mh=Object.keys(ru);function Ni(e){const t=Object(be.i)(e.ops),n=Object(be.i)(e.fields),r=Object(be.i)(e.params),i=Object(be.i)(e.as),s=this.outputs=[],f=this.windows=[],m={},x={},O=[],T=[];let M=!0;function H(Z){Object(be.i)(Object(be.g)(Z)).forEach(ue=>m[ue]=1)}H(e.sort),t.forEach((Z,ue)=>{const fe=n[ue],Ie=Object(be.h)(fe),Pe=Tp(Z,Ie,i[ue]);if(H(fe),s.push(Pe),Object(be.w)(ru,Z))f.push(function(Le,rt,it,ut){const st=ru[Le](rt,it);return{init:st.init||be.Ma,update:function(mt,dt){dt[ut]=st.next(mt)}}}(Z,n[ue],r[ue],Pe));else{if(fe==null&&Z!=="count"&&Object(be.o)("Null aggregate field specified."),Z==="count")return void O.push(Pe);M=!1;let Le=x[Ie];Le||((Le=x[Ie]=[]).field=fe,T.push(Le)),Le.push(Sh(Z,Pe))}}),(O.length||T.length)&&(this.cell=function(Z,ue,fe){Z=Z.map(ut=>Of(ut,ut.field));const Ie={num:0,agg:null,store:!1,count:ue};if(!fe)for(var Pe=Z.length,Le=Ie.agg=Array(Pe),rt=0;rt<Pe;++rt)Le[rt]=new Z[rt](Ie);if(Ie.store)var it=Ie.data=new Id;return Ie.add=function(ut){if(Ie.num+=1,!fe){it&&it.add(ut);for(let st=0;st<Pe;++st)Le[st].add(Le[st].get(ut),ut)}},Ie.rem=function(ut){if(Ie.num-=1,!fe){it&&it.rem(ut);for(let st=0;st<Pe;++st)Le[st].rem(Le[st].get(ut),ut)}},Ie.set=function(ut){let st,mt;for(it&&it.values(),st=0,mt=ue.length;st<mt;++st)ut[ue[st]]=Ie.num;if(!fe)for(st=0,mt=Le.length;st<mt;++st)Le[st].set(ut)},Ie.init=function(){Ie.num=0,it&&it.reset();for(let ut=0;ut<Pe;++ut)Le[ut].init()},Ie}(T,O,M)),this.inputs=Object.keys(m)}const Sf=Ni.prototype;function Gc(e){Ot.call(this,{},e),this._mlen=0,this._mods=[]}function Sl(e,t,n,r){const i=r.sort,s=i&&!r.ignorePeers,f=r.frame||[null,0],m=e.data(n),x=m.length,O=s?Object(Ef.a)(i):null,T={i0:0,i1:0,p0:0,p1:0,index:0,data:m,compare:i||Object(be.m)(-1)};t.init();for(let M=0;M<x;++M)Wd(T,f,M,x),s&&Mp(T,O),t.update(T,m[M])}function Wd(e,t,n,r){e.p0=e.i0,e.p1=e.i1,e.i0=t[0]==null?0:Math.max(0,n-Math.abs(t[0])),e.i1=t[1]==null?r:Math.min(r,n+Math.abs(t[1])+1),e.index=n}function Mp(e,t){const n=e.i0,r=e.i1-1,i=e.compare,s=e.data,f=s.length-1;n>0&&!i(s[n],s[n-1])&&(e.i0=t.left(s,s[n])),r<f&&!i(s[r],s[r+1])&&(e.i1=t.right(s,s[r]))}function _l(e,t,n){e._context.bezierCurveTo((2*e._x0+e._x1)/3,(2*e._y0+e._y1)/3,(e._x0+2*e._x1)/3,(e._y0+2*e._y1)/3,(e._x0+4*e._x1+t)/6,(e._y0+4*e._y1+n)/6)}function jh(e){this._context=e}Sf.init=function(){this.windows.forEach(e=>e.init()),this.cell&&this.cell.init()},Sf.update=function(e,t){const n=this.cell,r=this.windows,i=e.data,s=r&&r.length;let f;if(n){for(f=e.p0;f<e.i0;++f)n.rem(i[f]);for(f=e.p1;f<e.i1;++f)n.add(i[f]);n.set(t)}for(f=0;f<s;++f)r[f].update(e,t)},Gc.Definition={type:"Window",metadata:{modifies:!0},params:[{name:"sort",type:"compare"},{name:"groupby",type:"field",array:!0},{name:"ops",type:"enum",array:!0,values:Mh.concat(Fd)},{name:"params",type:"number",null:!0,array:!0},{name:"fields",type:"field",null:!0,array:!0},{name:"as",type:"string",null:!0,array:!0},{name:"frame",type:"number",null:!0,array:!0,length:2,default:[null,0]},{name:"ignorePeers",type:"boolean",default:!1}]},Object(be.z)(Gc,Ot,{transform(e,t){this.stamp=t.stamp;const n=e.modified(),r=Qr(e.sort),i=xu(e.groupby),s=m=>this.group(i(m));let f=this.state;f&&!n||(f=this.state=new Ni(e)),n||t.modified(f.inputs)?(this.value={},t.visit(t.SOURCE,m=>s(m).add(m))):(t.visit(t.REM,m=>s(m).remove(m)),t.visit(t.ADD,m=>s(m).add(m)));for(let m=0,x=this._mlen;m<x;++m)Sl(this._mods[m],f,r,e);return this._mlen=0,this._mods=[],t.reflow(n).modifies(f.outputs)},group(e){let t=this.value[e];return t||((t=this.value[e]=Fp(Zt)).stamp=-1),t.stamp<this.stamp&&(t.stamp=this.stamp,this._mods[this._mlen++]=t),t}}),jh.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:_l(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1)}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:_l(this,e,t)}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};var Lo=function(){};function Bh(e){this._context=e}Bh.prototype={areaStart:Lo,areaEnd:Lo,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._y0=this._y1=this._y2=this._y3=this._y4=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x2,this._y2),this._context.closePath();break;case 2:this._context.moveTo((this._x2+2*this._x3)/3,(this._y2+2*this._y3)/3),this._context.lineTo((this._x3+2*this._x2)/3,(this._y3+2*this._y2)/3),this._context.closePath();break;case 3:this.point(this._x2,this._y2),this.point(this._x3,this._y3),this.point(this._x4,this._y4)}},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._x2=e,this._y2=t;break;case 1:this._point=2,this._x3=e,this._y3=t;break;case 2:this._point=3,this._x4=e,this._y4=t,this._context.moveTo((this._x0+4*this._x1+e)/6,(this._y0+4*this._y1+t)/6);break;default:_l(this,e,t)}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function Dl(e){this._context=e}Dl.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;var n=(this._x0+4*this._x1+e)/6,r=(this._y0+4*this._y1+t)/6;this._line?this._context.lineTo(n,r):this._context.moveTo(n,r);break;case 3:this._point=4;default:_l(this,e,t)}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function Ph(e,t){this._basis=new jh(e),this._beta=t}Ph.prototype={lineStart:function(){this._x=[],this._y=[],this._basis.lineStart()},lineEnd:function(){var e=this._x,t=this._y,n=e.length-1;if(n>0)for(var r,i=e[0],s=t[0],f=e[n]-i,m=t[n]-s,x=-1;++x<=n;)r=x/n,this._basis.point(this._beta*e[x]+(1-this._beta)*(i+r*f),this._beta*t[x]+(1-this._beta)*(s+r*m));this._x=this._y=null,this._basis.lineEnd()},point:function(e,t){this._x.push(+e),this._y.push(+t)}};var Tl=function e(t){function n(r){return t===1?new jh(r):new Ph(r,t)}return n.beta=function(r){return e(+r)},n}(.85);function Kc(e,t,n){e._context.bezierCurveTo(e._x1+e._k*(e._x2-e._x0),e._y1+e._k*(e._y2-e._y0),e._x2+e._k*(e._x1-t),e._y2+e._k*(e._y1-n),e._x2,e._y2)}function Ec(e,t){this._context=e,this._k=(1-t)/6}Ec.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:Kc(this,this._x1,this._y1)}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2,this._x1=e,this._y1=t;break;case 2:this._point=3;default:Kc(this,e,t)}this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};var Lh=function e(t){function n(r){return new Ec(r,t)}return n.tension=function(r){return e(+r)},n}(0);function _f(e,t){this._context=e,this._k=(1-t)/6}_f.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:Kc(this,e,t)}this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};var Nl=function e(t){function n(r){return new _f(r,t)}return n.tension=function(r){return e(+r)},n}(0);function Cc(e,t){this._context=e,this._k=(1-t)/6}Cc.prototype={areaStart:Lo,areaEnd:Lo,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x3,this._y3),this._context.closePath();break;case 2:this._context.lineTo(this._x3,this._y3),this._context.closePath();break;case 3:this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5)}},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._x3=e,this._y3=t;break;case 1:this._point=2,this._context.moveTo(this._x4=e,this._y4=t);break;case 2:this._point=3,this._x5=e,this._y5=t;break;default:Kc(this,e,t)}this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};var km=function e(t){function n(r){return new Cc(r,t)}return n.tension=function(r){return e(+r)},n}(0),Fl=Math.abs,ra=Math.atan2,Sa=Math.cos,Ia=Math.max,Mi=Math.min,Es=Math.sin,Oc=Math.sqrt,Ra=1e-12,Ac=Math.PI,Uu=Ac/2,Df=2*Ac;function Tf(e){return e>=1?Uu:e<=-1?-Uu:Math.asin(e)}function Xc(e,t,n){var r=e._x1,i=e._y1,s=e._x2,f=e._y2;if(e._l01_a>Ra){var m=2*e._l01_2a+3*e._l01_a*e._l12_a+e._l12_2a,x=3*e._l01_a*(e._l01_a+e._l12_a);r=(r*m-e._x0*e._l12_2a+e._x2*e._l01_2a)/x,i=(i*m-e._y0*e._l12_2a+e._y2*e._l01_2a)/x}if(e._l23_a>Ra){var O=2*e._l23_2a+3*e._l23_a*e._l12_a+e._l12_2a,T=3*e._l23_a*(e._l23_a+e._l12_a);s=(s*O+e._x1*e._l23_2a-t*e._l12_2a)/T,f=(f*O+e._y1*e._l23_2a-n*e._l12_2a)/T}e._context.bezierCurveTo(r,i,s,f,e._x2,e._y2)}function Vd(e,t){this._context=e,this._alpha=t}Vd.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:this.point(this._x2,this._y2)}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){if(e=+e,t=+t,this._point){var n=this._x2-e,r=this._y2-t;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+r*r,this._alpha))}switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3;default:Xc(this,e,t)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};var Wu=function e(t){function n(r){return t?new Vd(r,t):new Ec(r,0)}return n.alpha=function(r){return e(+r)},n}(.5);function Em(e,t){this._context=e,this._alpha=t}Em.prototype={areaStart:Lo,areaEnd:Lo,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x3,this._y3),this._context.closePath();break;case 2:this._context.lineTo(this._x3,this._y3),this._context.closePath();break;case 3:this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5)}},point:function(e,t){if(e=+e,t=+t,this._point){var n=this._x2-e,r=this._y2-t;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+r*r,this._alpha))}switch(this._point){case 0:this._point=1,this._x3=e,this._y3=t;break;case 1:this._point=2,this._context.moveTo(this._x4=e,this._y4=t);break;case 2:this._point=3,this._x5=e,this._y5=t;break;default:Xc(this,e,t)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};var qd=function e(t){function n(r){return t?new Em(r,t):new Cc(r,0)}return n.alpha=function(r){return e(+r)},n}(.5);function Il(e,t){this._context=e,this._alpha=t}Il.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){if(e=+e,t=+t,this._point){var n=this._x2-e,r=this._y2-t;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+r*r,this._alpha))}switch(this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:Xc(this,e,t)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};var jp=function e(t){function n(r){return t?new Il(r,t):new _f(r,0)}return n.alpha=function(r){return e(+r)},n}(.5);function Nf(e){this._context=e}Nf.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:this._context.lineTo(e,t)}}};var Yc=function(e){return new Nf(e)};function Hd(e){this._context=e}Hd.prototype={areaStart:Lo,areaEnd:Lo,lineStart:function(){this._point=0},lineEnd:function(){this._point&&this._context.closePath()},point:function(e,t){e=+e,t=+t,this._point?this._context.lineTo(e,t):(this._point=1,this._context.moveTo(e,t))}};function zh(e){return e<0?-1:1}function ba(e,t,n){var r=e._x1-e._x0,i=t-e._x1,s=(e._y1-e._y0)/(r||i<0&&-0),f=(n-e._y1)/(i||r<0&&-0),m=(s*i+f*r)/(r+i);return(zh(s)+zh(f))*Math.min(Math.abs(s),Math.abs(f),.5*Math.abs(m))||0}function Rl(e,t){var n=e._x1-e._x0;return n?(3*(e._y1-e._y0)/n-t)/2:t}function Cs(e,t,n){var r=e._x0,i=e._y0,s=e._x1,f=e._y1,m=(s-r)/3;e._context.bezierCurveTo(r+m,i+m*t,s-m,f-m*n,s,f)}function Ml(e){this._context=e}function Ff(e){this._context=new Uh(e)}function Uh(e){this._context=e}function $d(e){this._context=e}function If(e){var t,n,r=e.length-1,i=new Array(r),s=new Array(r),f=new Array(r);for(i[0]=0,s[0]=2,f[0]=e[0]+2*e[1],t=1;t<r-1;++t)i[t]=1,s[t]=4,f[t]=4*e[t]+2*e[t+1];for(i[r-1]=2,s[r-1]=7,f[r-1]=8*e[r-1]+e[r],t=1;t<r;++t)n=i[t]/s[t-1],s[t]-=n,f[t]-=n*f[t-1];for(i[r-1]=f[r-1]/s[r-1],t=r-2;t>=0;--t)i[t]=(f[t]-i[t+1])/s[t];for(s[r-1]=(e[r]+i[r-1])/2,t=0;t<r-1;++t)s[t]=2*e[t+1]-i[t+1];return[i,s]}Ml.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:Cs(this,this._t0,Rl(this,this._t0))}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){var n=NaN;if(t=+t,(e=+e)!==this._x1||t!==this._y1){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,Cs(this,Rl(this,n=ba(this,e,t)),n);break;default:Cs(this,this._t0,n=ba(this,e,t))}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t,this._t0=n}}},(Ff.prototype=Object.create(Ml.prototype)).point=function(e,t){Ml.prototype.point.call(this,t,e)},Uh.prototype={moveTo:function(e,t){this._context.moveTo(t,e)},closePath:function(){this._context.closePath()},lineTo:function(e,t){this._context.lineTo(t,e)},bezierCurveTo:function(e,t,n,r,i,s){this._context.bezierCurveTo(t,e,r,n,s,i)}},$d.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=[],this._y=[]},lineEnd:function(){var e=this._x,t=this._y,n=e.length;if(n)if(this._line?this._context.lineTo(e[0],t[0]):this._context.moveTo(e[0],t[0]),n===2)this._context.lineTo(e[1],t[1]);else for(var r=If(e),i=If(t),s=0,f=1;f<n;++s,++f)this._context.bezierCurveTo(r[0][s],i[0][s],r[1][s],i[1][s],e[f],t[f]);(this._line||this._line!==0&&n===1)&&this._context.closePath(),this._line=1-this._line,this._x=this._y=null},point:function(e,t){this._x.push(+e),this._y.push(+t)}};function jl(e,t){this._context=e,this._t=t}jl.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN,this._point=0},lineEnd:function(){0<this._t&&this._t<1&&this._point===2&&this._context.lineTo(this._x,this._y),(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:if(this._t<=0)this._context.lineTo(this._x,t),this._context.lineTo(e,t);else{var n=this._x*(1-this._t)+e*this._t;this._context.lineTo(n,this._y),this._context.lineTo(n,t)}}this._x=e,this._y=t}};const Gd=Math.PI,Kd=2*Gd,tn=Kd-1e-6;function Vs(){this._x0=this._y0=this._x1=this._y1=null,this._=""}function Un(){return new Vs}Vs.prototype=Un.prototype={constructor:Vs,moveTo:function(e,t){this._+="M"+(this._x0=this._x1=+e)+","+(this._y0=this._y1=+t)},closePath:function(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")},lineTo:function(e,t){this._+="L"+(this._x1=+e)+","+(this._y1=+t)},quadraticCurveTo:function(e,t,n,r){this._+="Q"+ +e+","+ +t+","+(this._x1=+n)+","+(this._y1=+r)},bezierCurveTo:function(e,t,n,r,i,s){this._+="C"+ +e+","+ +t+","+ +n+","+ +r+","+(this._x1=+i)+","+(this._y1=+s)},arcTo:function(e,t,n,r,i){e=+e,t=+t,n=+n,r=+r,i=+i;var s=this._x1,f=this._y1,m=n-e,x=r-t,O=s-e,T=f-t,M=O*O+T*T;if(i<0)throw new Error("negative radius: "+i);if(this._x1===null)this._+="M"+(this._x1=e)+","+(this._y1=t);else if(M>1e-6)if(Math.abs(T*m-x*O)>1e-6&&i){var H=n-s,Z=r-f,ue=m*m+x*x,fe=H*H+Z*Z,Ie=Math.sqrt(ue),Pe=Math.sqrt(M),Le=i*Math.tan((Gd-Math.acos((ue+M-fe)/(2*Ie*Pe)))/2),rt=Le/Pe,it=Le/Ie;Math.abs(rt-1)>1e-6&&(this._+="L"+(e+rt*O)+","+(t+rt*T)),this._+="A"+i+","+i+",0,0,"+ +(T*H>O*Z)+","+(this._x1=e+it*m)+","+(this._y1=t+it*x)}else this._+="L"+(this._x1=e)+","+(this._y1=t)},arc:function(e,t,n,r,i,s){e=+e,t=+t,s=!!s;var f=(n=+n)*Math.cos(r),m=n*Math.sin(r),x=e+f,O=t+m,T=1^s,M=s?r-i:i-r;if(n<0)throw new Error("negative radius: "+n);this._x1===null?this._+="M"+x+","+O:(Math.abs(this._x1-x)>1e-6||Math.abs(this._y1-O)>1e-6)&&(this._+="L"+x+","+O),n&&(M<0&&(M=M%Kd+Kd),M>tn?this._+="A"+n+","+n+",0,1,"+T+","+(e-f)+","+(t-m)+"A"+n+","+n+",0,1,"+T+","+(this._x1=x)+","+(this._y1=O):M>1e-6&&(this._+="A"+n+","+n+",0,"+ +(M>=Gd)+","+T+","+(this._x1=e+n*Math.cos(i))+","+(this._y1=t+n*Math.sin(i))))},rect:function(e,t,n,r){this._+="M"+(this._x0=this._x1=+e)+","+(this._y0=this._y1=+t)+"h"+ +n+"v"+ +r+"h"+-n+"Z"},toString:function(){return this._}};var Os=Un,io=function(e){return function(){return e}};function Bl(e){return e.innerRadius}function Rf(e){return e.outerRadius}function nr(e){return e.startAngle}function $a(e){return e.endAngle}function xa(e){return e&&e.padAngle}function Hi(e,t,n,r,i,s,f){var m=e-n,x=t-r,O=(f?s:-s)/Oc(m*m+x*x),T=O*x,M=-O*m,H=e+T,Z=t+M,ue=n+T,fe=r+M,Ie=(H+ue)/2,Pe=(Z+fe)/2,Le=ue-H,rt=fe-Z,it=Le*Le+rt*rt,ut=i-s,st=H*fe-ue*Z,mt=(rt<0?-1:1)*Oc(Ia(0,ut*ut*it-st*st)),dt=(st*rt-Le*mt)/it,en=(-st*Le-rt*mt)/it,mn=(st*rt+Le*mt)/it,sn=(-st*Le+rt*mt)/it,In=dt-Ie,Fn=en-Pe,zn=mn-Ie,Vn=sn-Pe;return In*In+Fn*Fn>zn*zn+Vn*Vn&&(dt=mn,en=sn),{cx:dt,cy:en,x01:-T,y01:-M,x11:dt*(i/ut-1),y11:en*(i/ut-1)}}var ku=function(e){return typeof e=="object"&&"length"in e?e:Array.from(e)};function ac(e){return e[0]}function qs(e){return e[1]}var sc=function(e,t){var n=io(!0),r=null,i=Yc,s=null;function f(m){var x,O,T,M=(m=ku(m)).length,H=!1;for(r==null&&(s=i(T=Os())),x=0;x<=M;++x)!(x<M&&n(O=m[x],x,m))===H&&((H=!H)?s.lineStart():s.lineEnd()),H&&s.point(+e(O,x,m),+t(O,x,m));if(T)return s=null,T+""||null}return e=typeof e=="function"?e:e===void 0?ac:io(e),t=typeof t=="function"?t:t===void 0?qs:io(t),f.x=function(m){return arguments.length?(e=typeof m=="function"?m:io(+m),f):e},f.y=function(m){return arguments.length?(t=typeof m=="function"?m:io(+m),f):t},f.defined=function(m){return arguments.length?(n=typeof m=="function"?m:io(!!m),f):n},f.curve=function(m){return arguments.length?(i=m,r!=null&&(s=i(r)),f):i},f.context=function(m){return arguments.length?(m==null?r=s=null:s=i(r=m),f):r},f},Xo=function(e,t,n){var r=null,i=io(!0),s=null,f=Yc,m=null;function x(T){var M,H,Z,ue,fe,Ie=(T=ku(T)).length,Pe=!1,Le=new Array(Ie),rt=new Array(Ie);for(s==null&&(m=f(fe=Os())),M=0;M<=Ie;++M){if(!(M<Ie&&i(ue=T[M],M,T))===Pe)if(Pe=!Pe)H=M,m.areaStart(),m.lineStart();else{for(m.lineEnd(),m.lineStart(),Z=M-1;Z>=H;--Z)m.point(Le[Z],rt[Z]);m.lineEnd(),m.areaEnd()}Pe&&(Le[M]=+e(ue,M,T),rt[M]=+t(ue,M,T),m.point(r?+r(ue,M,T):Le[M],n?+n(ue,M,T):rt[M]))}if(fe)return m=null,fe+""||null}function O(){return sc().defined(i).curve(f).context(s)}return e=typeof e=="function"?e:e===void 0?ac:io(+e),t=typeof t=="function"?t:io(t===void 0?0:+t),n=typeof n=="function"?n:n===void 0?qs:io(+n),x.x=function(T){return arguments.length?(e=typeof T=="function"?T:io(+T),r=null,x):e},x.x0=function(T){return arguments.length?(e=typeof T=="function"?T:io(+T),x):e},x.x1=function(T){return arguments.length?(r=T==null?null:typeof T=="function"?T:io(+T),x):r},x.y=function(T){return arguments.length?(t=typeof T=="function"?T:io(+T),n=null,x):t},x.y0=function(T){return arguments.length?(t=typeof T=="function"?T:io(+T),x):t},x.y1=function(T){return arguments.length?(n=T==null?null:typeof T=="function"?T:io(+T),x):n},x.lineX0=x.lineY0=function(){return O().x(e).y(t)},x.lineY1=function(){return O().x(e).y(n)},x.lineX1=function(){return O().x(r).y(t)},x.defined=function(T){return arguments.length?(i=typeof T=="function"?T:io(!!T),x):i},x.curve=function(T){return arguments.length?(f=T,s!=null&&(m=f(s)),x):f},x.context=function(T){return arguments.length?(T==null?s=m=null:m=f(s=T),x):s},x},Vu={draw:function(e,t){var n=Math.sqrt(t/Ac);e.moveTo(n,0),e.arc(0,0,n,0,Df)}};function Hs(e,t){if(typeof document<"u"&&document.createElement){const n=document.createElement("canvas");if(n&&n.getContext)return n.width=e,n.height=t,n}return null}const so=()=>typeof Image<"u"?Image:null,cs=Object(Ef.a)(Mn.a),_a=cs.right,ls=cs.left;Object(Ef.a)(zr).center;var Yo=_a;function $s(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e)}return this}function Eu(e,t){switch(arguments.length){case 0:break;case 1:typeof e=="function"?this.interpolator(e):this.range(e);break;default:this.domain(e),typeof t=="function"?this.interpolator(t):this.range(t)}return this}const qu=Symbol("implicit");function uc(){var e=new Map,t=[],n=[],r=qu;function i(s){var f=s+"",m=e.get(f);if(!m){if(r!==qu)return r;e.set(f,m=t.push(s))}return n[(m-1)%n.length]}return i.domain=function(s){if(!arguments.length)return t.slice();t=[],e=new Map;for(const f of s){const m=f+"";e.has(m)||e.set(m,t.push(f))}return i},i.range=function(s){return arguments.length?(n=Array.from(s),i):n.slice()},i.unknown=function(s){return arguments.length?(r=s,i):r},i.copy=function(){return uc(t,n).unknown(r)},$s.apply(i,arguments),i}var Cu=a(45),Jc=a(50);function Qc(e,t,n,r){var i,s=Object(Cu.c)(e,t,n);switch((r=Object(Jc.formatSpecifier)(r??",f")).type){case"s":var f=Math.max(Math.abs(e),Math.abs(t));return r.precision!=null||isNaN(i=Object(Jc.precisionPrefix)(s,f))||(r.precision=i),Object(Jc.formatPrefix)(r,f);case"":case"e":case"g":case"p":case"r":r.precision!=null||isNaN(i=Object(Jc.precisionRound)(s,Math.max(Math.abs(e),Math.abs(t))))||(r.precision=i-(r.type==="e"));break;case"f":case"%":r.precision!=null||isNaN(i=Object(Jc.precisionFixed)(s))||(r.precision=i-2*(r.type==="%"))}return Object(Jc.format)(r)}var Wh=function(e,t,n){e.prototype=t.prototype=n,n.constructor=e};function Zc(e,t){var n=Object.create(e.prototype);for(var r in t)n[r]=t[r];return n}function Gs(){}var Ou="\\s*([+-]?\\d+)\\s*",Au="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",iu="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Vh=/^#([0-9a-f]{3,8})$/,Mf=new RegExp("^rgb\\("+[Ou,Ou,Ou]+"\\)$"),jf=new RegExp("^rgb\\("+[iu,iu,iu]+"\\)$"),Pl=new RegExp("^rgba\\("+[Ou,Ou,Ou,Au]+"\\)$"),Bf=new RegExp("^rgba\\("+[iu,iu,iu,Au]+"\\)$"),Q=new RegExp("^hsl\\("+[Au,iu,iu]+"\\)$"),G=new RegExp("^hsla\\("+[Au,iu,iu,Au]+"\\)$"),C={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function N(){return this.rgb().formatHex()}function te(){return this.rgb().formatRgb()}function Be(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=Vh.exec(e))?(n=t[1].length,t=parseInt(t[1],16),n===6?Ge(t):n===3?new ct(t>>8&15|t>>4&240,t>>4&15|240&t,(15&t)<<4|15&t,1):n===8?ft(t>>24&255,t>>16&255,t>>8&255,(255&t)/255):n===4?ft(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|240&t,((15&t)<<4|15&t)/255):null):(t=Mf.exec(e))?new ct(t[1],t[2],t[3],1):(t=jf.exec(e))?new ct(255*t[1]/100,255*t[2]/100,255*t[3]/100,1):(t=Pl.exec(e))?ft(t[1],t[2],t[3],t[4]):(t=Bf.exec(e))?ft(255*t[1]/100,255*t[2]/100,255*t[3]/100,t[4]):(t=Q.exec(e))?Wn(t[1],t[2]/100,t[3]/100,1):(t=G.exec(e))?Wn(t[1],t[2]/100,t[3]/100,t[4]):C.hasOwnProperty(e)?Ge(C[e]):e==="transparent"?new ct(NaN,NaN,NaN,0):null}function Ge(e){return new ct(e>>16&255,e>>8&255,255&e,1)}function ft(e,t,n,r){return r<=0&&(e=t=n=NaN),new ct(e,t,n,r)}function Tt(e){return e instanceof Gs||(e=Be(e)),e?new ct((e=e.rgb()).r,e.g,e.b,e.opacity):new ct}function Wt(e,t,n,r){return arguments.length===1?Tt(e):new ct(e,t,n,r??1)}function ct(e,t,n,r){this.r=+e,this.g=+t,this.b=+n,this.opacity=+r}function bn(){return"#"+Nn(this.r)+Nn(this.g)+Nn(this.b)}function Sn(){var e=this.opacity;return((e=isNaN(e)?1:Math.max(0,Math.min(1,e)))===1?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(e===1?")":", "+e+")")}function Nn(e){return((e=Math.max(0,Math.min(255,Math.round(e)||0)))<16?"0":"")+e.toString(16)}function Wn(e,t,n,r){return r<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new rr(e,t,n,r)}function Rn(e){if(e instanceof rr)return new rr(e.h,e.s,e.l,e.opacity);if(e instanceof Gs||(e=Be(e)),!e)return new rr;if(e instanceof rr)return e;var t=(e=e.rgb()).r/255,n=e.g/255,r=e.b/255,i=Math.min(t,n,r),s=Math.max(t,n,r),f=NaN,m=s-i,x=(s+i)/2;return m?(f=t===s?(n-r)/m+6*(n<r):n===s?(r-t)/m+2:(t-n)/m+4,m/=x<.5?s+i:2-s-i,f*=60):m=x>0&&x<1?0:f,new rr(f,m,x,e.opacity)}function tr(e,t,n,r){return arguments.length===1?Rn(e):new rr(e,t,n,r??1)}function rr(e,t,n,r){this.h=+e,this.s=+t,this.l=+n,this.opacity=+r}function dr(e,t,n){return 255*(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)}function Tr(e,t,n,r,i){var s=e*e,f=s*e;return((1-3*e+3*s-f)*t+(4-6*s+3*f)*n+(1+3*e+3*s-3*f)*r+f*i)/6}Wh(Gs,Be,{copy:function(e){return Object.assign(new this.constructor,this,e)},displayable:function(){return this.rgb().displayable()},hex:N,formatHex:N,formatHsl:function(){return Rn(this).formatHsl()},formatRgb:te,toString:te}),Wh(ct,Wt,Zc(Gs,{brighter:function(e){return e=e==null?1/.7:Math.pow(1/.7,e),new ct(this.r*e,this.g*e,this.b*e,this.opacity)},darker:function(e){return e=e==null?.7:Math.pow(.7,e),new ct(this.r*e,this.g*e,this.b*e,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:bn,formatHex:bn,formatRgb:Sn,toString:Sn})),Wh(rr,tr,Zc(Gs,{brighter:function(e){return e=e==null?1/.7:Math.pow(1/.7,e),new rr(this.h,this.s,this.l*e,this.opacity)},darker:function(e){return e=e==null?.7:Math.pow(.7,e),new rr(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=this.h%360+360*(this.h<0),t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*t,i=2*n-r;return new ct(dr(e>=240?e-240:e+120,i,r),dr(e,i,r),dr(e<120?e+240:e-120,i,r),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var e=this.opacity;return((e=isNaN(e)?1:Math.max(0,Math.min(1,e)))===1?"hsl(":"hsla(")+(this.h||0)+", "+100*(this.s||0)+"%, "+100*(this.l||0)+"%"+(e===1?")":", "+e+")")}}));var Vr=function(e){var t=e.length-1;return function(n){var r=n<=0?n=0:n>=1?(n=1,t-1):Math.floor(n*t),i=e[r],s=e[r+1],f=r>0?e[r-1]:2*i-s,m=r<t-1?e[r+2]:2*s-i;return Tr((n-r/t)*t,f,i,s,m)}},xr=function(e){var t=e.length;return function(n){var r=Math.floor(((n%=1)<0?++n:n)*t),i=e[(r+t-1)%t],s=e[r%t],f=e[(r+1)%t],m=e[(r+2)%t];return Tr((n-r/t)*t,i,s,f,m)}},$r=e=>()=>e;function Wr(e,t){return function(n){return e+n*t}}function ai(e,t){var n=t-e;return n?Wr(e,n>180||n<-180?n-360*Math.round(n/360):n):$r(isNaN(e)?t:e)}function li(e){return(e=+e)==1?Hr:function(t,n){return n-t?function(r,i,s){return r=Math.pow(r,s),i=Math.pow(i,s)-r,s=1/s,function(f){return Math.pow(r+f*i,s)}}(t,n,e):$r(isNaN(t)?n:t)}}function Hr(e,t){var n=t-e;return n?Wr(e,n):$r(isNaN(e)?t:e)}var ni=function e(t){var n=li(t);function r(i,s){var f=n((i=Wt(i)).r,(s=Wt(s)).r),m=n(i.g,s.g),x=n(i.b,s.b),O=Hr(i.opacity,s.opacity);return function(T){return i.r=f(T),i.g=m(T),i.b=x(T),i.opacity=O(T),i+""}}return r.gamma=e,r}(1);function to(e){return function(t){var n,r,i=t.length,s=new Array(i),f=new Array(i),m=new Array(i);for(n=0;n<i;++n)r=Wt(t[n]),s[n]=r.r||0,f[n]=r.g||0,m[n]=r.b||0;return s=e(s),f=e(f),m=e(m),r.opacity=1,function(x){return r.r=s(x),r.g=f(x),r.b=m(x),r+""}}}var Qi=to(Vr),zo=to(xr),ji=function(e,t){t||(t=[]);var n,r=e?Math.min(t.length,e.length):0,i=t.slice();return function(s){for(n=0;n<r;++n)i[n]=e[n]*(1-s)+t[n]*s;return i}};function no(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}var ia=function(e,t){return(no(t)?ji:jo)(e,t)};function jo(e,t){var n,r=t?t.length:0,i=e?Math.min(r,e.length):0,s=new Array(i),f=new Array(r);for(n=0;n<i;++n)s[n]=aa(e[n],t[n]);for(;n<r;++n)f[n]=t[n];return function(m){for(n=0;n<i;++n)f[n]=s[n](m);return f}}var Jo=function(e,t){var n=new Date;return e=+e,t=+t,function(r){return n.setTime(e*(1-r)+t*r),n}},Fi=function(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}},Di=function(e,t){var n,r={},i={};for(n in e!==null&&typeof e=="object"||(e={}),t!==null&&typeof t=="object"||(t={}),t)n in e?r[n]=aa(e[n],t[n]):i[n]=t[n];return function(s){for(n in r)i[n]=r[n](s);return i}},mo=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,la=new RegExp(mo.source,"g"),ha=function(e,t){var n,r,i,s=mo.lastIndex=la.lastIndex=0,f=-1,m=[],x=[];for(e+="",t+="";(n=mo.exec(e))&&(r=la.exec(t));)(i=r.index)>s&&(i=t.slice(s,i),m[f]?m[f]+=i:m[++f]=i),(n=n[0])===(r=r[0])?m[f]?m[f]+=r:m[++f]=r:(m[++f]=null,x.push({i:f,x:Fi(n,r)})),s=la.lastIndex;return s<t.length&&(i=t.slice(s),m[f]?m[f]+=i:m[++f]=i),m.length<2?x[0]?function(O){return function(T){return O(T)+""}}(x[0].x):function(O){return function(){return O}}(t):(t=x.length,function(O){for(var T,M=0;M<t;++M)m[(T=x[M]).i]=T.x(O);return m.join("")})},aa=function(e,t){var n,r=typeof t;return t==null||r==="boolean"?$r(t):(r==="number"?Fi:r==="string"?(n=Be(t))?(t=n,ni):ha:t instanceof Be?ni:t instanceof Date?Jo:no(t)?ji:Array.isArray(t)?jo:typeof t.valueOf!="function"&&typeof t.toString!="function"||isNaN(t)?Di:Fi)(e,t)},Qo=function(e,t){return e=+e,t=+t,function(n){return Math.round(e*(1-n)+t*n)}};function Za(e){return+e}var da=[0,1];function go(e){return e}function wa(e,t){return(t-=e=+e)?function(n){return(n-e)/t}:function(n){return function(){return n}}(isNaN(t)?NaN:.5)}function Su(e,t,n){var r=e[0],i=e[1],s=t[0],f=t[1];return i<r?(r=wa(i,r),s=n(f,s)):(r=wa(r,i),s=n(s,f)),function(m){return s(r(m))}}function fs(e,t,n){var r=Math.min(e.length,t.length)-1,i=new Array(r),s=new Array(r),f=-1;for(e[r]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++f<r;)i[f]=wa(e[f],e[f+1]),s[f]=n(t[f],t[f+1]);return function(m){var x=Yo(e,m,1,r)-1;return s[x](i[x](m))}}function Ma(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function Fo(){var e,t,n,r,i,s,f=da,m=da,x=aa,O=go;function T(){var H=Math.min(f.length,m.length);return O!==go&&(O=function(Z,ue){var fe;return Z>ue&&(fe=Z,Z=ue,ue=fe),function(Ie){return Math.max(Z,Math.min(ue,Ie))}}(f[0],f[H-1])),r=H>2?fs:Su,i=s=null,M}function M(H){return H==null||isNaN(H=+H)?n:(i||(i=r(f.map(e),m,x)))(e(O(H)))}return M.invert=function(H){return O(t((s||(s=r(m,f.map(e),Fi)))(H)))},M.domain=function(H){return arguments.length?(f=Array.from(H,Za),T()):f.slice()},M.range=function(H){return arguments.length?(m=Array.from(H),T()):m.slice()},M.rangeRound=function(H){return m=Array.from(H),x=Qo,T()},M.clamp=function(H){return arguments.length?(O=!!H||go,T()):O!==go},M.interpolate=function(H){return arguments.length?(x=H,T()):x},M.unknown=function(H){return arguments.length?(n=H,M):n},function(H,Z){return e=H,t=Z,T()}}function cc(){return Fo()(go,go)}function Ks(e){var t=e.domain;return e.ticks=function(n){var r=t();return Object(Cu.a)(r[0],r[r.length-1],n??10)},e.tickFormat=function(n,r){var i=t();return Qc(i[0],i[i.length-1],n??10,r)},e.nice=function(n){n==null&&(n=10);var r,i,s=t(),f=0,m=s.length-1,x=s[f],O=s[m],T=10;for(O<x&&(i=x,x=O,O=i,i=f,f=m,m=i);T-- >0;){if((i=Object(Cu.b)(x,O,n))===r)return s[f]=x,s[m]=O,t(s);if(i>0)x=Math.floor(x/i)*i,O=Math.ceil(O/i)*i;else{if(!(i<0))break;x=Math.ceil(x*i)/i,O=Math.floor(O*i)/i}r=i}return e},e}function Rs(e,t){var n,r=0,i=(e=e.slice()).length-1,s=e[r],f=e[i];return f<s&&(n=r,r=i,i=n,n=s,s=f,f=n),e[r]=t.floor(s),e[i]=t.ceil(f),e}function Zo(e){return Math.log(e)}function Ms(e){return Math.exp(e)}function Io(e){return-Math.log(-e)}function As(e){return-Math.exp(-e)}function hs(e){return isFinite(e)?+("1e"+e):e<0?0:e}function oo(e){return function(t){return-e(-t)}}function Ss(e){var t,n,r=e(Zo,Ms),i=r.domain,s=10;function f(){return t=function(m){return m===Math.E?Math.log:m===10&&Math.log10||m===2&&Math.log2||(m=Math.log(m),function(x){return Math.log(x)/m})}(s),n=function(m){return m===10?hs:m===Math.E?Math.exp:function(x){return Math.pow(m,x)}}(s),i()[0]<0?(t=oo(t),n=oo(n),e(Io,As)):e(Zo,Ms),r}return r.base=function(m){return arguments.length?(s=+m,f()):s},r.domain=function(m){return arguments.length?(i(m),f()):i()},r.ticks=function(m){var x,O=i(),T=O[0],M=O[O.length-1];(x=M<T)&&(fe=T,T=M,M=fe);var H,Z,ue,fe=t(T),Ie=t(M),Pe=m==null?10:+m,Le=[];if(!(s%1)&&Ie-fe<Pe){if(fe=Math.floor(fe),Ie=Math.ceil(Ie),T>0){for(;fe<=Ie;++fe)for(Z=1,H=n(fe);Z<s;++Z)if(!((ue=H*Z)<T)){if(ue>M)break;Le.push(ue)}}else for(;fe<=Ie;++fe)for(Z=s-1,H=n(fe);Z>=1;--Z)if(!((ue=H*Z)<T)){if(ue>M)break;Le.push(ue)}2*Le.length<Pe&&(Le=Object(Cu.a)(T,M,Pe))}else Le=Object(Cu.a)(fe,Ie,Math.min(Ie-fe,Pe)).map(n);return x?Le.reverse():Le},r.tickFormat=function(m,x){if(x==null&&(x=s===10?".0e":","),typeof x!="function"&&(x=Object(Jc.format)(x)),m===1/0)return x;m==null&&(m=10);var O=Math.max(1,s*m/r.ticks().length);return function(T){var M=T/n(Math.round(t(T)));return M*s<s-.5&&(M*=s),M<=O?x(T):""}},r.nice=function(){return i(Rs(i(),{floor:function(m){return n(Math.floor(t(m)))},ceil:function(m){return n(Math.ceil(t(m)))}}))},r}function Ga(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}}function Xs(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function Sc(e){return e<0?-e*e:e*e}function Uo(e){var t=e(go,go),n=1;return t.exponent=function(r){return arguments.length?(n=+r)==1?e(go,go):n===.5?e(Xs,Sc):e(Ga(n),Ga(1/n)):n},Ks(t)}function es(){var e=Uo(Fo());return e.copy=function(){return Ma(e,es()).exponent(e.exponent())},$s.apply(e,arguments),e}function ja(e){return function(t){return Math.sign(t)*Math.log1p(Math.abs(t/e))}}function lc(e){return function(t){return Math.sign(t)*Math.expm1(Math.abs(t))*e}}function el(e){var t=1,n=e(ja(t),lc(t));return n.constant=function(r){return arguments.length?e(ja(t=+r),lc(t)):t},Ks(n)}var ci=a(12),Xd=a(182),tl=a(69),Ll=a(183),vg=a(184),yg=a(72),Cm=a(40),Om=a(135),bg=a(70),Am=a(180),xg=a(181),Pf=a(71),Yd=a(39),wg=a(134),kg=a(68);function Eg(e,t,n,r,i,s){const f=[[tl.a,1,ci.e],[tl.a,5,5*ci.e],[tl.a,15,15*ci.e],[tl.a,30,30*ci.e],[s,1,ci.c],[s,5,5*ci.c],[s,15,15*ci.c],[s,30,30*ci.c],[i,1,ci.b],[i,3,3*ci.b],[i,6,6*ci.b],[i,12,12*ci.b],[r,1,ci.a],[r,2,2*ci.a],[n,1,ci.f],[t,1,ci.d],[t,3,3*ci.d],[e,1,ci.g]];function m(x,O,T){const M=Math.abs(O-x)/T,H=Object(Ef.a)(([,,fe])=>fe).right(f,M);if(H===f.length)return e.every(Object(Cu.c)(x/ci.g,O/ci.g,T));if(H===0)return Xd.a.every(Math.max(Object(Cu.c)(x,O,T),1));const[Z,ue]=f[M/f[H-1][2]<f[H][2]/M?H-1:H];return Z.every(ue)}return[function(x,O,T){const M=O<x;M&&([x,O]=[O,x]);const H=T&&typeof T.range=="function"?T:m(x,O,T),Z=H?H.range(x,+O+1):[];return M?Z.reverse():Z},m]}const[_c,Lf]=Eg(kg.a,wg.a,Yd.b,Pf.a,xg.a,Am.a),[Jd,Sm]=Eg(bg.a,Om.a,Cm.b,yg.a,vg.a,Ll.a);var _m=a(100);function T0(e){return new Date(e)}function Dm(e){return e instanceof Date?+e:+new Date(+e)}function qh(e,t,n,r,i,s,f,m,x,O){var T=cc(),M=T.invert,H=T.domain,Z=O(".%L"),ue=O(":%S"),fe=O("%I:%M"),Ie=O("%I %p"),Pe=O("%a %d"),Le=O("%b %d"),rt=O("%B"),it=O("%Y");function ut(st){return(x(st)<st?Z:m(st)<st?ue:f(st)<st?fe:s(st)<st?Ie:r(st)<st?i(st)<st?Pe:Le:n(st)<st?rt:it)(st)}return T.invert=function(st){return new Date(M(st))},T.domain=function(st){return arguments.length?H(Array.from(st,Dm)):H().map(T0)},T.ticks=function(st){var mt=H();return e(mt[0],mt[mt.length-1],st??10)},T.tickFormat=function(st,mt){return mt==null?ut:O(mt)},T.nice=function(st){var mt=H();return st&&typeof st.range=="function"||(st=t(mt[0],mt[mt.length-1],st??10)),st?H(Rs(mt,st)):T},T.copy=function(){return Ma(T,qh(e,t,n,r,i,s,f,m,x,O))},T}function zf(){var e,t,n,r,i,s=0,f=1,m=go,x=!1;function O(M){return M==null||isNaN(M=+M)?i:m(n===0?.5:(M=(r(M)-e)*n,x?Math.max(0,Math.min(1,M)):M))}function T(M){return function(H){var Z,ue;return arguments.length?([Z,ue]=H,m=M(Z,ue),O):[m(0),m(1)]}}return O.domain=function(M){return arguments.length?([s,f]=M,e=r(s=+s),t=r(f=+f),n=e===t?0:1/(t-e),O):[s,f]},O.clamp=function(M){return arguments.length?(x=!!M,O):x},O.interpolator=function(M){return arguments.length?(m=M,O):m},O.range=T(aa),O.rangeRound=T(Qo),O.unknown=function(M){return arguments.length?(i=M,O):i},function(M){return r=M,e=M(s),t=M(f),n=e===t?0:1/(t-e),O}}function Dc(e,t){return t.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function Tm(){var e=Ks(zf()(go));return e.copy=function(){return Dc(e,Tm())},Eu.apply(e,arguments)}function Nm(){var e=Uo(zf());return e.copy=function(){return Dc(e,Nm()).exponent(e.exponent())},Eu.apply(e,arguments)}function _u(e,t){t===void 0&&(t=e,e=aa);for(var n=0,r=t.length-1,i=t[0],s=new Array(r<0?0:r);n<r;)s[n]=e(i,i=t[++n]);return function(f){var m=Math.max(0,Math.min(r-1,Math.floor(f*=r)));return s[m](f-m)}}function Fm(){var e,t,n,r,i,s,f,m=0,x=.5,O=1,T=1,M=go,H=!1;function Z(fe){return isNaN(fe=+fe)?f:(fe=.5+((fe=+s(fe))-t)*(T*fe<T*t?r:i),M(H?Math.max(0,Math.min(1,fe)):fe))}function ue(fe){return function(Ie){var Pe,Le,rt;return arguments.length?([Pe,Le,rt]=Ie,M=_u(fe,[Pe,Le,rt]),Z):[M(0),M(.5),M(1)]}}return Z.domain=function(fe){return arguments.length?([m,x,O]=fe,e=s(m=+m),t=s(x=+x),n=s(O=+O),r=e===t?0:.5/(t-e),i=t===n?0:.5/(n-t),T=t<e?-1:1,Z):[m,x,O]},Z.clamp=function(fe){return arguments.length?(H=!!fe,Z):H},Z.interpolator=function(fe){return arguments.length?(M=fe,Z):M},Z.range=ue(aa),Z.rangeRound=ue(Qo),Z.unknown=function(fe){return arguments.length?(f=fe,Z):f},function(fe){return s=fe,e=fe(m),t=fe(x),n=fe(O),r=e===t?0:.5/(t-e),i=t===n?0:.5/(n-t),T=t<e?-1:1,Z}}function Hh(){var e=Uo(Fm());return e.copy=function(){return Dc(e,Hh()).exponent(e.exponent())},Eu.apply(e,arguments)}var Qd,N0=function(e){var t=e.length;return function(n){return e[Math.max(0,Math.min(t-1,Math.floor(n*t)))]}},Zd=function(e,t){var n=ai(+e,+t);return function(r){var i=n(r);return i-360*Math.floor(i/360)}},Tc=180/Math.PI,ep={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1},Cg=function(e,t,n,r,i,s){var f,m,x;return(f=Math.sqrt(e*e+t*t))&&(e/=f,t/=f),(x=e*n+t*r)&&(n-=e*x,r-=t*x),(m=Math.sqrt(n*n+r*r))&&(n/=m,r/=m,x/=m),e*r<t*n&&(e=-e,t=-t,x=-x,f=-f),{translateX:i,translateY:s,rotate:Math.atan2(t,e)*Tc,skewX:Math.atan(x)*Tc,scaleX:f,scaleY:m}};function Og(e,t,n,r){function i(s){return s.length?s.pop()+" ":""}return function(s,f){var m=[],x=[];return s=e(s),f=e(f),function(O,T,M,H,Z,ue){if(O!==M||T!==H){var fe=Z.push("translate(",null,t,null,n);ue.push({i:fe-4,x:Fi(O,M)},{i:fe-2,x:Fi(T,H)})}else(M||H)&&Z.push("translate("+M+t+H+n)}(s.translateX,s.translateY,f.translateX,f.translateY,m,x),function(O,T,M,H){O!==T?(O-T>180?T+=360:T-O>180&&(O+=360),H.push({i:M.push(i(M)+"rotate(",null,r)-2,x:Fi(O,T)})):T&&M.push(i(M)+"rotate("+T+r)}(s.rotate,f.rotate,m,x),function(O,T,M,H){O!==T?H.push({i:M.push(i(M)+"skewX(",null,r)-2,x:Fi(O,T)}):T&&M.push(i(M)+"skewX("+T+r)}(s.skewX,f.skewX,m,x),function(O,T,M,H,Z,ue){if(O!==M||T!==H){var fe=Z.push(i(Z)+"scale(",null,",",null,")");ue.push({i:fe-4,x:Fi(O,M)},{i:fe-2,x:Fi(T,H)})}else M===1&&H===1||Z.push(i(Z)+"scale("+M+","+H+")")}(s.scaleX,s.scaleY,f.scaleX,f.scaleY,m,x),s=f=null,function(O){for(var T,M=-1,H=x.length;++M<H;)m[(T=x[M]).i]=T.x(O);return m.join("")}}}var Im=Og(function(e){const t=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(e+"");return t.isIdentity?ep:Cg(t.a,t.b,t.c,t.d,t.e,t.f)},"px, ","px)","deg)"),bv=Og(function(e){return e==null?ep:(Qd||(Qd=document.createElementNS("http://www.w3.org/2000/svg","g")),Qd.setAttribute("transform",e),(e=Qd.transform.baseVal.consolidate())?(e=e.matrix,Cg(e.a,e.b,e.c,e.d,e.e,e.f)):ep)},", ",")",")"),xv=1e-12;function uo(e){return((e=Math.exp(e))+1/e)/2}var Ag=function e(t,n,r){function i(s,f){var m,x,O=s[0],T=s[1],M=s[2],H=f[0],Z=f[1],ue=f[2],fe=H-O,Ie=Z-T,Pe=fe*fe+Ie*Ie;if(Pe<xv)x=Math.log(ue/M)/t,m=function(mt){return[O+mt*fe,T+mt*Ie,M*Math.exp(t*mt*x)]};else{var Le=Math.sqrt(Pe),rt=(ue*ue-M*M+r*Pe)/(2*M*n*Le),it=(ue*ue-M*M-r*Pe)/(2*ue*n*Le),ut=Math.log(Math.sqrt(rt*rt+1)-rt),st=Math.log(Math.sqrt(it*it+1)-it);x=(st-ut)/t,m=function(mt){var dt=mt*x,en=uo(ut),mn=M/(n*Le)*(en*function(sn){return((sn=Math.exp(2*sn))-1)/(sn+1)}(t*dt+ut)-function(sn){return((sn=Math.exp(sn))-1/sn)/2}(ut));return[O+mn*fe,T+mn*Ie,M*en/uo(t*dt+ut)]}}return m.duration=1e3*x*t/Math.SQRT2,m}return i.rho=function(s){var f=Math.max(.001,+s),m=f*f;return e(f,m,m*m)},i}(Math.SQRT2,2,4);function Sg(e){return function(t,n){var r=e((t=tr(t)).h,(n=tr(n)).h),i=Hr(t.s,n.s),s=Hr(t.l,n.l),f=Hr(t.opacity,n.opacity);return function(m){return t.h=r(m),t.s=i(m),t.l=s(m),t.opacity=f(m),t+""}}}var Bp=Sg(ai),_g=Sg(Hr);const tp=Math.PI/180,nl=180/Math.PI,rl=.96422,Dg=1,Tg=.82521,$h=4/29,Uf=6/29,Gh=3*Uf*Uf,wv=Uf*Uf*Uf;function Pp(e){if(e instanceof Du)return new Du(e.l,e.a,e.b,e.opacity);if(e instanceof Hu)return Fg(e);e instanceof ct||(e=Tt(e));var t,n,r=Ng(e.r),i=Ng(e.g),s=Ng(e.b),f=zl((.2225045*r+.7168786*i+.0606169*s)/Dg);return r===i&&i===s?t=n=f:(t=zl((.4360747*r+.3850649*i+.1430804*s)/rl),n=zl((.0139322*r+.0971045*i+.7141733*s)/Tg)),new Du(116*f-16,500*(t-f),200*(f-n),e.opacity)}function il(e,t,n,r){return arguments.length===1?Pp(e):new Du(e,t,n,r??1)}function Du(e,t,n,r){this.l=+e,this.a=+t,this.b=+n,this.opacity=+r}function zl(e){return e>wv?Math.pow(e,1/3):e/Gh+$h}function Ul(e){return e>Uf?e*e*e:Gh*(e-$h)}function Wl(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function Ng(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function Lp(e){if(e instanceof Hu)return new Hu(e.h,e.c,e.l,e.opacity);if(e instanceof Du||(e=Pp(e)),e.a===0&&e.b===0)return new Hu(NaN,0<e.l&&e.l<100?0:NaN,e.l,e.opacity);var t=Math.atan2(e.b,e.a)*nl;return new Hu(t<0?t+360:t,Math.sqrt(e.a*e.a+e.b*e.b),e.l,e.opacity)}function Tu(e,t,n,r){return arguments.length===1?Lp(e):new Hu(e,t,n,r??1)}function Hu(e,t,n,r){this.h=+e,this.c=+t,this.l=+n,this.opacity=+r}function Fg(e){if(isNaN(e.h))return new Du(e.l,0,0,e.opacity);var t=e.h*tp;return new Du(e.l,Math.cos(t)*e.c,Math.sin(t)*e.c,e.opacity)}function np(e,t){var n=Hr((e=il(e)).l,(t=il(t)).l),r=Hr(e.a,t.a),i=Hr(e.b,t.b),s=Hr(e.opacity,t.opacity);return function(f){return e.l=n(f),e.a=r(f),e.b=i(f),e.opacity=s(f),e+""}}function Rm(e){return function(t,n){var r=e((t=Tu(t)).h,(n=Tu(n)).h),i=Hr(t.c,n.c),s=Hr(t.l,n.l),f=Hr(t.opacity,n.opacity);return function(m){return t.h=r(m),t.c=i(m),t.l=s(m),t.opacity=f(m),t+""}}}Wh(Du,il,Zc(Gs,{brighter:function(e){return new Du(this.l+18*(e??1),this.a,this.b,this.opacity)},darker:function(e){return new Du(this.l-18*(e??1),this.a,this.b,this.opacity)},rgb:function(){var e=(this.l+16)/116,t=isNaN(this.a)?e:e+this.a/500,n=isNaN(this.b)?e:e-this.b/200;return new ct(Wl(3.1338561*(t=rl*Ul(t))-1.6168667*(e=Dg*Ul(e))-.4906146*(n=Tg*Ul(n))),Wl(-.9787684*t+1.9161415*e+.033454*n),Wl(.0719453*t-.2289914*e+1.4052427*n),this.opacity)}})),Wh(Hu,Tu,Zc(Gs,{brighter:function(e){return new Hu(this.h,this.c,this.l+18*(e??1),this.opacity)},darker:function(e){return new Hu(this.h,this.c,this.l-18*(e??1),this.opacity)},rgb:function(){return Fg(this).rgb()}}));var kv=Rm(ai),F0=Rm(Hr),Vl=-.29227,Kh=-.90649,Wf=1.97294,Vf=Wf*Kh,Ig=1.78277*Wf,Mm=1.78277*Vl- -.14861*Kh;function qf(e,t,n,r){return arguments.length===1?function(i){if(i instanceof ro)return new ro(i.h,i.s,i.l,i.opacity);i instanceof ct||(i=Tt(i));var s=i.r/255,f=i.g/255,m=i.b/255,x=(Mm*m+Vf*s-Ig*f)/(Mm+Vf-Ig),O=m-x,T=(Wf*(f-x)-Vl*O)/Kh,M=Math.sqrt(T*T+O*O)/(Wf*x*(1-x)),H=M?Math.atan2(T,O)*nl-120:NaN;return new ro(H<0?H+360:H,M,x,i.opacity)}(e):new ro(e,t,n,r??1)}function ro(e,t,n,r){this.h=+e,this.s=+t,this.l=+n,this.opacity=+r}function ql(e){return function t(n){function r(i,s){var f=e((i=qf(i)).h,(s=qf(s)).h),m=Hr(i.s,s.s),x=Hr(i.l,s.l),O=Hr(i.opacity,s.opacity);return function(T){return i.h=f(T),i.s=m(T),i.l=x(Math.pow(T,n)),i.opacity=O(T),i+""}}return n=+n,r.gamma=t,r}(1)}Wh(ro,qf,Zc(Gs,{brighter:function(e){return e=e==null?1/.7:Math.pow(1/.7,e),new ro(this.h,this.s,this.l*e,this.opacity)},darker:function(e){return e=e==null?.7:Math.pow(.7,e),new ro(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=isNaN(this.h)?0:(this.h+120)*tp,t=+this.l,n=isNaN(this.s)?0:this.s*t*(1-t),r=Math.cos(e),i=Math.sin(e);return new ct(255*(t+n*(-.14861*r+1.78277*i)),255*(t+n*(Vl*r+Kh*i)),255*(t+n*(Wf*r)),this.opacity)}}));var Xh=ql(ai),I0=ql(Hr),R0=function(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e(r/(t-1));return n};function zp(e,t,n){const r=e-t+2*n;return e?r>0?r:1:0}const Hl="linear",ol="log",rp="pow",Yh="sqrt",Hf="symlog",$l="time",Gl="utc",Nu="sequential",Jh="diverging",$f="quantile",al="quantize",Nc="threshold",Gf="ordinal",Up="point",Kf="band",Fc="bin-ordinal",ts="continuous",fc="discrete",Fu="discretizing",fu="interpolating",Qh="temporal";function Wp(){const e=uc().unknown(void 0),t=e.domain,n=e.range;let r,i,s=[0,1],f=!1,m=0,x=0,O=.5;function T(){const M=t().length,H=s[1]<s[0],Z=s[1-H],ue=zp(M,m,x);let fe=s[H-0];r=(Z-fe)/(ue||1),f&&(r=Math.floor(r)),fe+=(Z-fe-r*(M-m))*O,i=r*(1-m),f&&(fe=Math.round(fe),i=Math.round(i));const Ie=ys(M).map(Pe=>fe+r*Pe);return n(H?Ie.reverse():Ie)}return delete e.unknown,e.domain=function(M){return arguments.length?(t(M),T()):t()},e.range=function(M){return arguments.length?(s=[+M[0],+M[1]],T()):s.slice()},e.rangeRound=function(M){return s=[+M[0],+M[1]],f=!0,T()},e.bandwidth=function(){return i},e.step=function(){return r},e.round=function(M){return arguments.length?(f=!!M,T()):f},e.padding=function(M){return arguments.length?(x=Math.max(0,Math.min(1,M)),m=x,T()):m},e.paddingInner=function(M){return arguments.length?(m=Math.max(0,Math.min(1,M)),T()):m},e.paddingOuter=function(M){return arguments.length?(x=Math.max(0,Math.min(1,M)),T()):x},e.align=function(M){return arguments.length?(O=Math.max(0,Math.min(1,M)),T()):O},e.invertRange=function(M){if(M[0]==null||M[1]==null)return;const H=s[1]<s[0],Z=H?n().reverse():n(),ue=Z.length-1;let fe,Ie,Pe,Le=+M[0],rt=+M[1];return Le!=Le||rt!=rt||(rt<Le&&(Pe=Le,Le=rt,rt=Pe),rt<Z[0]||Le>s[1-H])?void 0:(fe=Math.max(0,_a(Z,Le)-1),Ie=Le===rt?fe:_a(Z,rt)-1,Le-Z[fe]>i+1e-10&&++fe,H&&(Pe=fe,fe=ue-Ie,Ie=ue-Pe),fe>Ie?void 0:t().slice(fe,Ie+1))},e.invert=function(M){const H=e.invertRange([M,M]);return H&&H[0]},e.copy=function(){return Wp().domain(t()).range(s).round(f).paddingInner(m).paddingOuter(x).align(O)},T()}var jm=Array.prototype.map;const Bm=Array.prototype.slice,ip={};function Ro(e,t,n){return arguments.length>1?(ip[e]=function(r,i,s){const f=function(){const m=i();return m.invertRange||(m.invertRange=m.invert?function(x){return function(O){let T,M=O[0],H=O[1];return H<M&&(T=M,M=H,H=T),[x.invert(M),x.invert(H)]}}(m):m.invertExtent?function(x){return function(O){const T=x.range();let M,H,Z,ue,fe=O[0],Ie=O[1],Pe=-1;for(Ie<fe&&(H=fe,fe=Ie,Ie=H),Z=0,ue=T.length;Z<ue;++Z)T[Z]>=fe&&T[Z]<=Ie&&(Pe<0&&(Pe=Z),M=Z);if(!(Pe<0))return fe=x.invertExtent(T[Pe]),Ie=x.invertExtent(T[M]),[fe[0]===void 0?fe[1]:fe[0],Ie[1]===void 0?Ie[0]:Ie[1]]}}(m):void 0),m.type=r,m};return f.metadata=Object(be.Fa)(Object(be.i)(s)),f}(e,t,n),this):op(e)?ip[e]:void 0}function op(e){return Object(be.w)(ip,e)}function hc(e,t){const n=ip[e];return n&&n.metadata[t]}function Xf(e){return hc(e,ts)}function Yf(e){return hc(e,fc)}function ap(e){return hc(e,Fu)}function Vp(e){return hc(e,ol)}function qp(e){return hc(e,fu)}function Hp(e){return hc(e,$f)}Ro("identity",function e(t){var n;function r(i){return i==null||isNaN(i=+i)?n:i}return r.invert=r,r.domain=r.range=function(i){return arguments.length?(t=Array.from(i,Za),r):t.slice()},r.unknown=function(i){return arguments.length?(n=i,r):n},r.copy=function(){return e(t).unknown(n)},t=arguments.length?Array.from(t,Za):[0,1],Ks(r)}),Ro(Hl,function e(){var t=cc();return t.copy=function(){return Ma(t,e())},$s.apply(t,arguments),Ks(t)},ts),Ro(ol,function e(){var t=Ss(Fo()).domain([1,10]);return t.copy=function(){return Ma(t,e()).base(t.base())},$s.apply(t,arguments),t},[ts,ol]),Ro(rp,es,ts),Ro(Yh,function(){return es.apply(null,arguments).exponent(.5)},ts),Ro(Hf,function e(){var t=el(Fo());return t.copy=function(){return Ma(t,e()).constant(t.constant())},$s.apply(t,arguments)},ts),Ro($l,function(){return $s.apply(qh(Jd,Sm,bg.a,Om.a,Cm.b,yg.a,vg.a,Ll.a,tl.a,_m.a).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)},[ts,Qh]),Ro(Gl,function(){return $s.apply(qh(_c,Lf,kg.a,wg.a,Yd.b,Pf.a,xg.a,Am.a,tl.a,_m.c).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)},[ts,Qh]),Ro(Nu,Tm,[ts,fu]),Ro("".concat(Nu,"-").concat(Hl),Tm,[ts,fu]),Ro("".concat(Nu,"-").concat(ol),function e(){var t=Ss(zf()).domain([1,10]);return t.copy=function(){return Dc(t,e()).base(t.base())},Eu.apply(t,arguments)},[ts,fu,ol]),Ro("".concat(Nu,"-").concat(rp),Nm,[ts,fu]),Ro("".concat(Nu,"-").concat(Yh),function(){return Nm.apply(null,arguments).exponent(.5)},[ts,fu]),Ro("".concat(Nu,"-").concat(Hf),function e(){var t=el(zf());return t.copy=function(){return Dc(t,e()).constant(t.constant())},Eu.apply(t,arguments)},[ts,fu]),Ro("".concat(Jh,"-").concat(Hl),function e(){var t=Ks(Fm()(go));return t.copy=function(){return Dc(t,e())},Eu.apply(t,arguments)},[ts,fu]),Ro("".concat(Jh,"-").concat(ol),function e(){var t=Ss(Fm()).domain([.1,1,10]);return t.copy=function(){return Dc(t,e()).base(t.base())},Eu.apply(t,arguments)},[ts,fu,ol]),Ro("".concat(Jh,"-").concat(rp),Hh,[ts,fu]),Ro("".concat(Jh,"-").concat(Yh),function(){return Hh.apply(null,arguments).exponent(.5)},[ts,fu]),Ro("".concat(Jh,"-").concat(Hf),function e(){var t=el(Fm());return t.copy=function(){return Dc(t,e()).constant(t.constant())},Eu.apply(t,arguments)},[ts,fu]),Ro($f,function e(){var t,n=[],r=[],i=[];function s(){var m=0,x=Math.max(1,r.length);for(i=new Array(x-1);++m<x;)i[m-1]=pi(n,m/x);return f}function f(m){return m==null||isNaN(m=+m)?t:r[Yo(i,m)]}return f.invertExtent=function(m){var x=r.indexOf(m);return x<0?[NaN,NaN]:[x>0?i[x-1]:n[0],x<i.length?i[x]:n[n.length-1]]},f.domain=function(m){if(!arguments.length)return n.slice();n=[];for(let x of m)x==null||isNaN(x=+x)||n.push(x);return n.sort(Mn.a),s()},f.range=function(m){return arguments.length?(r=Array.from(m),s()):r.slice()},f.unknown=function(m){return arguments.length?(t=m,f):t},f.quantiles=function(){return i.slice()},f.copy=function(){return e().domain(n).range(r).unknown(t)},$s.apply(f,arguments)},[Fu,$f]),Ro(al,function e(){var t,n=0,r=1,i=1,s=[.5],f=[0,1];function m(O){return O!=null&&O<=O?f[Yo(s,O,0,i)]:t}function x(){var O=-1;for(s=new Array(i);++O<i;)s[O]=((O+1)*r-(O-i)*n)/(i+1);return m}return m.domain=function(O){return arguments.length?([n,r]=O,n=+n,r=+r,x()):[n,r]},m.range=function(O){return arguments.length?(i=(f=Array.from(O)).length-1,x()):f.slice()},m.invertExtent=function(O){var T=f.indexOf(O);return T<0?[NaN,NaN]:T<1?[n,s[0]]:T>=i?[s[i-1],r]:[s[T-1],s[T]]},m.unknown=function(O){return arguments.length&&(t=O),m},m.thresholds=function(){return s.slice()},m.copy=function(){return e().domain([n,r]).range(f).unknown(t)},$s.apply(Ks(m),arguments)},Fu),Ro(Nc,function e(){var t,n=[.5],r=[0,1],i=1;function s(f){return f!=null&&f<=f?r[Yo(n,f,0,i)]:t}return s.domain=function(f){return arguments.length?(n=Array.from(f),i=Math.min(n.length,r.length-1),s):n.slice()},s.range=function(f){return arguments.length?(r=Array.from(f),i=Math.min(n.length,r.length-1),s):r.slice()},s.invertExtent=function(f){var m=r.indexOf(f);return[n[m-1],n[m]]},s.unknown=function(f){return arguments.length?(t=f,s):t},s.copy=function(){return e().domain(n).range(r).unknown(t)},$s.apply(s,arguments)},Fu),Ro(Fc,function e(){let t=[],n=[];function r(i){return i==null||i!=i?void 0:n[(Yo(t,i)-1)%n.length]}return r.domain=function(i){return arguments.length?(t=function(s){return jm.call(s,be.Ea)}(i),r):t.slice()},r.range=function(i){return arguments.length?(n=Bm.call(i),r):n.slice()},r.tickFormat=function(i,s){return Qc(t[0],Object(be.W)(t),i??10,s)},r.copy=function(){return e().domain(r.domain()).range(r.range())},r},[fc,Fu]),Ro(Gf,uc,fc),Ro(Kf,Wp,fc),Ro(Up,function(){return function e(t){const n=t.copy;return t.padding=t.paddingOuter,delete t.paddingInner,t.copy=function(){return e(n())},t}(Wp().paddingInner(1))},fc);const Rg=["clamp","base","constant","exponent"];function $p(e,t){const n=t[0],r=Object(be.W)(t)-n;return function(i){return e(n+i*r)}}function Kl(e,t,n){return _u(Kp(t||"rgb",n),e)}function Gp(e,t){const n=new Array(t),r=t+1;for(let i=0;i<t;)n[i]=e(++i/r);return n}function Zh(e,t,n){const r=n-t;let i,s,f;return r&&Number.isFinite(r)?(i=(s=e.type).indexOf("-"),s=i<0?s:s.slice(i+1),f=Ro(s)().domain([t,n]).range([0,1]),Rg.forEach(m=>e[m]?f[m](e[m]()):0),f):Object(be.m)(.5)}function Kp(e,t){const n=B[function(r){return"interpolate"+r.toLowerCase().split("-").map(i=>i[0].toUpperCase()+i.slice(1)).join("")}(e)];return t!=null&&n&&n.gamma?n.gamma(t):n}function Pm(e){const t=e.length/6|0,n=new Array(t);for(let r=0;r<t;)n[r]="#"+e.slice(6*r,6*++r);return n}function Lm(e,t){for(const n in e)zm(n,t(e[n]))}const sp={};function zm(e,t){return e=e&&e.toLowerCase(),arguments.length>1?(sp[e]=t,this):sp[e]}Lm({category10:"1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf",category20:"1f77b4aec7e8ff7f0effbb782ca02c98df8ad62728ff98969467bdc5b0d58c564bc49c94e377c2f7b6d27f7f7fc7c7c7bcbd22dbdb8d17becf9edae5",category20b:"393b795254a36b6ecf9c9ede6379398ca252b5cf6bcedb9c8c6d31bd9e39e7ba52e7cb94843c39ad494ad6616be7969c7b4173a55194ce6dbdde9ed6",category20c:"3182bd6baed69ecae1c6dbefe6550dfd8d3cfdae6bfdd0a231a35474c476a1d99bc7e9c0756bb19e9ac8bcbddcdadaeb636363969696bdbdbdd9d9d9",tableau10:"4c78a8f58518e4575672b7b254a24beeca3bb279a2ff9da69d755dbab0ac",tableau20:"4c78a89ecae9f58518ffbf7954a24b88d27ab79a20f2cf5b43989483bcb6e45756ff9d9879706ebab0acd67195fcbfd2b279a2d6a5c99e765fd8b5a5",accent:"7fc97fbeaed4fdc086ffff99386cb0f0027fbf5b17666666",dark2:"1b9e77d95f027570b3e7298a66a61ee6ab02a6761d666666",paired:"a6cee31f78b4b2df8a33a02cfb9a99e31a1cfdbf6fff7f00cab2d66a3d9affff99b15928",pastel1:"fbb4aeb3cde3ccebc5decbe4fed9a6ffffcce5d8bdfddaecf2f2f2",pastel2:"b3e2cdfdcdaccbd5e8f4cae4e6f5c9fff2aef1e2cccccccc",set1:"e41a1c377eb84daf4a984ea3ff7f00ffff33a65628f781bf999999",set2:"66c2a5fc8d628da0cbe78ac3a6d854ffd92fe5c494b3b3b3",set3:"8dd3c7ffffb3bebadafb807280b1d3fdb462b3de69fccde5d9d9d9bc80bdccebc5ffed6f"},Pm),Lm({blues:"cfe1f2bed8eca8cee58fc1de74b2d75ba3cf4592c63181bd206fb2125ca40a4a90",greens:"d3eecdc0e6baabdda594d3917bc77d60ba6c46ab5e329a512089430e7735036429",greys:"e2e2e2d4d4d4c4c4c4b1b1b19d9d9d8888887575756262624d4d4d3535351e1e1e",oranges:"fdd8b3fdc998fdb87bfda55efc9244f87f2cf06b18e4580bd14904b93d029f3303",purples:"e2e1efd4d4e8c4c5e0b4b3d6a3a0cc928ec3827cb97566ae684ea25c3696501f8c",reds:"fdc9b4fcb49afc9e80fc8767fa7051f6573fec3f2fdc2a25c81b1db21218970b13",blueGreen:"d5efedc1e8e0a7ddd18bd2be70c6a958ba9144ad77319c5d2089460e7736036429",bluePurple:"ccddecbad0e4a8c2dd9ab0d4919cc98d85be8b6db28a55a6873c99822287730f71",greenBlue:"d3eecec5e8c3b1e1bb9bd8bb82cec269c2ca51b2cd3c9fc7288abd1675b10b60a1",orangeRed:"fddcaffdcf9bfdc18afdad77fb9562f67d53ee6545e24932d32d1ebf130da70403",purpleBlue:"dbdaebc8cee4b1c3de97b7d87bacd15b9fc93a90c01e7fb70b70ab056199045281",purpleBlueGreen:"dbd8eac8cee4b0c3de93b7d872acd1549fc83892bb1c88a3097f8702736b016353",purpleRed:"dcc9e2d3b3d7ce9eccd186c0da6bb2e14da0e23189d91e6fc61159ab07498f023a",redPurple:"fccfccfcbec0faa9b8f98faff571a5ec539ddb3695c41b8aa908808d0179700174",yellowGreen:"e4f4acd1eca0b9e2949ed68880c97c62bb6e47aa5e3297502083440e723b036034",yellowOrangeBrown:"feeaa1fedd84fecc63feb746fca031f68921eb7215db5e0bc54c05ab3d038f3204",yellowOrangeRed:"fee087fed16ffebd59fea849fd903efc7335f9522bee3423de1b20ca0b22af0225",blueOrange:"134b852f78b35da2cb9dcae1d2e5eff2f0ebfce0bafbbf74e8932fc5690d994a07",brownBlueGreen:"704108a0651ac79548e3c78af3e6c6eef1eac9e9e48ed1c74da79e187a72025147",purpleGreen:"5b1667834792a67fb6c9aed3e6d6e8eff0efd9efd5aedda971bb75368e490e5e29",purpleOrange:"4114696647968f83b7b9b4d6dadbebf3eeeafce0bafbbf74e8932fc5690d994a07",redBlue:"8c0d25bf363adf745ef4ae91fbdbc9f2efeed2e5ef9dcae15da2cb2f78b3134b85",redGrey:"8c0d25bf363adf745ef4ae91fcdccbfaf4f1e2e2e2c0c0c0969696646464343434",yellowGreenBlue:"eff9bddbf1b4bde5b594d5b969c5be45b4c22c9ec02182b82163aa23479c1c3185",redYellowBlue:"a50026d4322cf16e43fcac64fedd90faf8c1dcf1ecabd6e875abd04a74b4313695",redYellowGreen:"a50026d4322cf16e43fcac63fedd8df9f7aed7ee8ea4d86e64bc6122964f006837",pinkYellowGreen:"8e0152c0267edd72adf0b3d6faddedf5f3efe1f2cab6de8780bb474f9125276419",spectral:"9e0142d13c4bf0704afcac63fedd8dfbf8b0e0f3a1a9dda269bda94288b55e4fa2",viridis:"440154470e61481a6c482575472f7d443a834144873d4e8a39568c35608d31688e2d708e2a788e27818e23888e21918d1f988b1fa08822a8842ab07f35b77943bf7154c56866cc5d7ad1518fd744a5db36bcdf27d2e21be9e51afde725",magma:"0000040404130b0924150e3720114b2c11603b0f704a107957157e651a80721f817f24828c29819a2e80a8327db6377ac43c75d1426fde4968e95462f1605df76f5cfa7f5efc8f65fe9f6dfeaf78febf84fece91fddea0fcedaffcfdbf",inferno:"0000040403130c0826170c3b240c4f330a5f420a68500d6c5d126e6b176e781c6d86216b932667a12b62ae305cbb3755c73e4cd24644dd513ae65c30ed6925f3771af8850ffb9506fca50afcb519fac62df6d645f2e661f3f484fcffa4",plasma:"0d088723069033059742039d5002a25d01a66a00a87801a88405a7900da49c179ea72198b12a90ba3488c33d80cb4779d35171da5a69e16462e76e5bed7953f2834cf68f44fa9a3dfca636fdb32ffec029fcce25f9dc24f5ea27f0f921",cividis:"00205100235800265d002961012b65042e670831690d346b11366c16396d1c3c6e213f6e26426e2c456e31476e374a6e3c4d6e42506e47536d4c566d51586e555b6e5a5e6e5e616e62646f66676f6a6a706e6d717270717573727976737c79747f7c75827f758682768985778c8877908b78938e789691789a94789e9778a19b78a59e77a9a177aea575b2a874b6ab73bbaf71c0b26fc5b66dc9b96acebd68d3c065d8c462ddc85fe2cb5ce7cf58ebd355f0d652f3da4ff7de4cfae249fce647",rainbow:"6e40aa883eb1a43db3bf3cafd83fa4ee4395fe4b83ff576eff6659ff7847ff8c38f3a130e2b72fcfcc36bee044aff05b8ff4576ff65b52f6673af27828ea8d1ddfa319d0b81cbecb23abd82f96e03d82e14c6edb5a5dd0664dbf6e40aa",sinebow:"ff4040fc582af47218e78d0bd5a703bfbf00a7d5038de70b72f41858fc2a40ff402afc5818f4720be78d03d5a700bfbf03a7d50b8de71872f42a58fc4040ff582afc7218f48d0be7a703d5bf00bfd503a7e70b8df41872fc2a58ff4040",turbo:"23171b32204a3e2a71453493493eae4b49c54a53d7485ee44569ee4074f53c7ff8378af93295f72e9ff42ba9ef28b3e926bce125c5d925cdcf27d5c629dcbc2de3b232e9a738ee9d3ff39347f68950f9805afc7765fd6e70fe667cfd5e88fc5795fb51a1f84badf545b9f140c5ec3cd0e637dae034e4d931ecd12ef4c92bfac029ffb626ffad24ffa223ff9821ff8d1fff821dff771cfd6c1af76118f05616e84b14df4111d5380fcb2f0dc0260ab61f07ac1805a313029b0f00950c00910b00",browns:"eedbbdecca96e9b97ae4a865dc9856d18954c7784cc0673fb85536ad44339f3632",tealBlues:"bce4d89dd3d181c3cb65b3c245a2b9368fae347da0306a932c5985",teals:"bbdfdfa2d4d58ac9c975bcbb61b0af4da5a43799982b8b8c1e7f7f127273006667",warmGreys:"dcd4d0cec5c1c0b8b4b3aaa7a59c9998908c8b827f7e7673726866665c5a59504e",goldGreen:"f4d166d5ca60b6c35c98bb597cb25760a6564b9c533f8f4f33834a257740146c36",goldOrange:"f4d166f8be5cf8aa4cf5983bf3852aef701be2621fd65322c54923b142239e3a26",goldRed:"f4d166f6be59f9aa51fc964ef6834bee734ae56249db5247cf4244c43141b71d3e",lightGreyRed:"efe9e6e1dad7d5cbc8c8bdb9bbaea9cd967ddc7b43e15f19df4011dc000b",lightGreyTeal:"e4eaead6dcddc8ced2b7c2c7a6b4bc64b0bf22a6c32295c11f85be1876bc",lightMulti:"e0f1f2c4e9d0b0de9fd0e181f6e072f6c053f3993ef77440ef4a3c",lightOrange:"f2e7daf7d5baf9c499fab184fa9c73f68967ef7860e8645bde515bd43d5b",lightTealBlue:"e3e9e0c0dccf9aceca7abfc859afc0389fb9328dad2f7ca0276b95255988",darkBlue:"3232322d46681a5c930074af008cbf05a7ce25c0dd38daed50f3faffffff",darkGold:"3c3c3c584b37725e348c7631ae8b2bcfa424ecc31ef9de30fff184ffffff",darkGreen:"3a3a3a215748006f4d048942489e4276b340a6c63dd2d836ffeb2cffffaa",darkMulti:"3737371f5287197d8c29a86995ce3fffe800ffffff",darkRed:"3434347036339e3c38cc4037e75d1eec8620eeab29f0ce32ffeb2c"},e=>Kl(Pm(e)));const Xp="symbol",Mg="discrete",sl=e=>Object(be.B)(e)?e.map(t=>String(t)):String(e),M0=(e,t)=>e[1]-t[1],jg=(e,t)=>t[1]-e[1];function up(e,t,n){let r;return Object(be.G)(t)&&(e.bins&&(t=Math.max(t,e.bins.length)),n!=null&&(t=Math.min(t,Math.floor(Object(be.Z)(e.domain())/n||1)))),Object(be.H)(t)&&(r=t.step,t=t.interval),Object(be.J)(t)&&(t=e.type===$l?Object(ar.p)(t):e.type==Gl?Object(ar.v)(t):Object(be.o)("Only time and utc scales accept interval strings."),r&&(t=t.every(r))),t}function Bg(e,t,n){let r=e.range(),i=r[0],s=Object(be.W)(r),f=M0;if(i>s&&(r=s,s=i,i=r,f=jg),i=Math.floor(i),s=Math.ceil(s),t=t.map(m=>[m,e(m)]).filter(m=>i<=m[1]&&m[1]<=s).sort(f).map(m=>m[0]),n>0&&t.length>1){const m=[t[0],Object(be.W)(t)];for(;t.length>n&&t.length>=3;)t=t.filter((x,O)=>!(O%2));t.length<3&&(t=m)}return t}function Xl(e,t){return e.bins?Bg(e,e.bins):e.ticks?e.ticks(t):e.domain()}function Pg(e,t,n,r,i,s){const f=t.type;let m=sl;if(f===$l||i===$l)m=e.timeFormat(r);else if(f===Gl||i===Gl)m=e.utcFormat(r);else if(Vp(f)){const x=e.formatFloat(r);if(s||t.bins)m=x;else{const O=cp(t,n,!1);m=T=>O(T)?x(T):""}}else if(t.tickFormat){const x=t.domain();m=e.formatSpan(x[0],x[x.length-1],n,r)}else r&&(m=e.format(r));return m}function cp(e,t,n){const r=Xl(e,t),i=e.base(),s=Math.log(i),f=Math.max(1,i*t/r.length),m=x=>{let O=x/Math.pow(i,Math.round(Math.log(x)/s));return O*i<i-.5&&(O*=i),O<=f};return n?r.filter(m):m}const Yp={[$f]:"quantiles",[al]:"thresholds",[Nc]:"domain"},Lg={[$f]:"quantiles",[al]:"domain"};function zg(e,t){return e.bins?function(n){const r=n.slice(0,-1);return r.max=Object(be.W)(n),r}(e.bins):e.type===ol?cp(e,t,!0):Yp[e.type]?function(n){const r=[-1/0].concat(n);return r.max=1/0,r}(e[Yp[e.type]]()):Xl(e,t)}const Um=e=>Yp[e.type]||e.bins;function Ug(e,t,n,r,i,s,f){const m=Lg[t.type]&&s!==$l&&s!==Gl?function(x,O,T){const M=O[Lg[O.type]](),H=M.length;let Z,ue=H>1?M[1]-M[0]:M[0];for(Z=1;Z<H;++Z)ue=Math.min(ue,M[Z]-M[Z-1]);return x.formatSpan(0,ue,30,T)}(e,t,i):Pg(e,t,n,i,s,f);return r===Xp&&Um(t)?Wg(m):r===Mg?j0(m):Vg(m)}const Wg=e=>(t,n,r)=>{const i=Jf(r[n+1],Jf(r.max,1/0)),s=ul(t,e),f=ul(i,e);return s&&f?s+"  "+f:f?"< "+f:" "+s},Jf=(e,t)=>e??t,j0=e=>(t,n)=>n?e(t):null,Vg=e=>t=>e(t),ul=(e,t)=>Number.isFinite(e)?t(e):null;function Wm(e,t,n,r){const i=r||t.type;return Object(be.J)(n)&&function(s){return hc(s,Qh)}(i)&&(n=n.replace(/%a/g,"%A").replace(/%b/g,"%B")),n||i!==$l?n||i!==Gl?Ug(e,t,5,null,n,r,!0):e.utcFormat("%A, %d %B %Y, %X UTC"):e.timeFormat("%A, %d %B %Y, %X")}function qg(e,t,n){n=n||{};const r=Math.max(3,n.maxlen||7),i=Wm(e,t,n.format,n.formatType);if(ap(t.type)){const s=zg(t).slice(1).map(i),f=s.length;return"".concat(f," boundar").concat(f===1?"y":"ies",": ").concat(s.join(", "))}if(Yf(t.type)){const s=t.domain(),f=s.length,m=f>r?s.slice(0,r-2).map(i).join(", ")+", ending with "+s.slice(-1).map(i):s.map(i).join(", ");return"".concat(f," value").concat(f===1?"":"s",": ").concat(m)}{const s=t.domain();return"values from ".concat(i(s[0])," to ").concat(i(Object(be.W)(s)))}}let Qf=0;const cl="p_";function Jp(e){return e&&e.gradient}function Vm(e,t,n){const r=e.gradient;let i=e.id,s=r==="radial"?cl:"";return i||(i=e.id="gradient_"+Qf++,r==="radial"?(e.x1=dc(e.x1,.5),e.y1=dc(e.y1,.5),e.r1=dc(e.r1,0),e.x2=dc(e.x2,.5),e.y2=dc(e.y2,.5),e.r2=dc(e.r2,.5),s=cl):(e.x1=dc(e.x1,0),e.y1=dc(e.y1,0),e.x2=dc(e.x2,1),e.y2=dc(e.y2,0))),t[i]=e,"url("+(n||"")+"#"+s+i+")"}function dc(e,t){return e??t}function qm(e,t){var n,r=[];return n={gradient:"linear",x1:e?e[0]:0,y1:e?e[1]:0,x2:t?t[0]:1,y2:t?t[1]:0,stops:r,stop:function(i,s){return r.push({offset:i,color:s}),n}}}const Hg={basis:{curve:function(e){return new jh(e)}},"basis-closed":{curve:function(e){return new Bh(e)}},"basis-open":{curve:function(e){return new Dl(e)}},bundle:{curve:Tl,tension:"beta",value:.85},cardinal:{curve:Lh,tension:"tension",value:0},"cardinal-open":{curve:Nl,tension:"tension",value:0},"cardinal-closed":{curve:km,tension:"tension",value:0},"catmull-rom":{curve:Wu,tension:"alpha",value:.5},"catmull-rom-closed":{curve:qd,tension:"alpha",value:.5},"catmull-rom-open":{curve:jp,tension:"alpha",value:.5},linear:{curve:Yc},"linear-closed":{curve:function(e){return new Hd(e)}},monotone:{horizontal:function(e){return new Ff(e)},vertical:function(e){return new Ml(e)}},natural:{curve:function(e){return new $d(e)}},step:{curve:function(e){return new jl(e,.5)}},"step-after":{curve:function(e){return new jl(e,1)}},"step-before":{curve:function(e){return new jl(e,0)}}};function Yl(e,t,n){var r=Object(be.w)(Hg,e)&&Hg[e],i=null;return r&&(i=r.curve||r[t||"vertical"],r.tension&&n!=null&&(i=i[r.tension](n))),i}const B0={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},ed=[/([MLHVCSQTAZmlhvcsqtaz])/g,/###/,/(\.\d+)(\.\d)/g,/(\d)([-+])/g,/\s|,|###/];function td(e){const t=[];let n,r,i,s,f,m,x,O,T,M;const H=e.slice().replace(ed[0],"###$1").split(ed[1]).slice(1);for(x=0,T=H.length;x<T;++x){for(r=(n=H[x]).slice(1).trim().replace(ed[2],"$1###$2").replace(ed[3],"$1###$2").split(ed[4]),i=[f=n.charAt(0)],O=0,M=r.length;O<M;++O)(s=+r[O])===s&&i.push(s);if(m=B0[f.toLowerCase()],i.length-1>m){const Z=i.length;for(O=1,t.push([f].concat(i.slice(O,O+=m))),f=f==="M"?"L":f==="m"?"l":f;O<Z;O+=m)t.push([f].concat(i.slice(O,O+m)))}else t.push(i)}return t}const Jl=Math.PI/180,$g=1e-14,Zf=Math.PI/2,pc=2*Math.PI,nd=Math.sqrt(3)/2;var lp={},Qp={},Hm=[].join;function Gg(e){const t=Hm.call(e);if(Qp[t])return Qp[t];var n=e[0],r=e[1],i=e[2],s=e[3],f=e[4],m=e[5],x=e[6],O=e[7];const T=O*f,M=-x*m,H=x*f,Z=O*m,ue=Math.cos(i),fe=Math.sin(i),Ie=Math.cos(s),Pe=Math.sin(s),Le=.5*(s-i),rt=Math.sin(.5*Le),it=8/3*rt*rt/Math.sin(Le),ut=n+ue-it*fe,st=r+fe+it*ue,mt=n+Ie,dt=r+Pe,en=mt+it*Pe,mn=dt-it*Ie;return Qp[t]=[T*ut+M*st,H*ut+Z*st,T*en+M*mn,H*en+Z*mn,T*mt+M*dt,H*mt+Z*dt]}const ns=["l",0,0,0,0,0,0,0];function Kg(e,t,n){const r=ns[0]=e[0];if(r==="a"||r==="A")ns[1]=t*e[1],ns[2]=n*e[2],ns[3]=e[3],ns[4]=e[4],ns[5]=e[5],ns[6]=t*e[6],ns[7]=n*e[7];else if(r==="h"||r==="H")ns[1]=t*e[1];else if(r==="v"||r==="V")ns[1]=n*e[1];else for(var i=1,s=e.length;i<s;++i)ns[i]=(i%2==1?t:n)*e[i];return ns}function rd(e,t,n,r,i,s){var f,m,x,O,T,M=null,H=0,Z=0,ue=0,fe=0;n==null&&(n=0),r==null&&(r=0),i==null&&(i=1),s==null&&(s=i),e.beginPath&&e.beginPath();for(var Ie=0,Pe=t.length;Ie<Pe;++Ie){switch(f=t[Ie],i===1&&s===1||(f=Kg(f,i,s)),f[0]){case"l":H+=f[1],Z+=f[2],e.lineTo(H+n,Z+r);break;case"L":H=f[1],Z=f[2],e.lineTo(H+n,Z+r);break;case"h":H+=f[1],e.lineTo(H+n,Z+r);break;case"H":H=f[1],e.lineTo(H+n,Z+r);break;case"v":Z+=f[1],e.lineTo(H+n,Z+r);break;case"V":Z=f[1],e.lineTo(H+n,Z+r);break;case"m":H+=f[1],Z+=f[2],e.moveTo(H+n,Z+r);break;case"M":H=f[1],Z=f[2],e.moveTo(H+n,Z+r);break;case"c":m=H+f[5],x=Z+f[6],ue=H+f[3],fe=Z+f[4],e.bezierCurveTo(H+f[1]+n,Z+f[2]+r,ue+n,fe+r,m+n,x+r),H=m,Z=x;break;case"C":H=f[5],Z=f[6],ue=f[3],fe=f[4],e.bezierCurveTo(f[1]+n,f[2]+r,ue+n,fe+r,H+n,Z+r);break;case"s":m=H+f[3],x=Z+f[4],ue=2*H-ue,fe=2*Z-fe,e.bezierCurveTo(ue+n,fe+r,H+f[1]+n,Z+f[2]+r,m+n,x+r),ue=H+f[1],fe=Z+f[2],H=m,Z=x;break;case"S":m=f[3],x=f[4],ue=2*H-ue,fe=2*Z-fe,e.bezierCurveTo(ue+n,fe+r,f[1]+n,f[2]+r,m+n,x+r),H=m,Z=x,ue=f[1],fe=f[2];break;case"q":m=H+f[3],x=Z+f[4],ue=H+f[1],fe=Z+f[2],e.quadraticCurveTo(ue+n,fe+r,m+n,x+r),H=m,Z=x;break;case"Q":m=f[3],x=f[4],e.quadraticCurveTo(f[1]+n,f[2]+r,m+n,x+r),H=m,Z=x,ue=f[1],fe=f[2];break;case"t":m=H+f[1],x=Z+f[2],M[0].match(/[QqTt]/)===null?(ue=H,fe=Z):M[0]==="t"?(ue=2*H-O,fe=2*Z-T):M[0]==="q"&&(ue=2*H-ue,fe=2*Z-fe),O=ue,T=fe,e.quadraticCurveTo(ue+n,fe+r,m+n,x+r),Z=x,ue=(H=m)+f[1],fe=Z+f[2];break;case"T":m=f[1],x=f[2],ue=2*H-ue,fe=2*Z-fe,e.quadraticCurveTo(ue+n,fe+r,m+n,x+r),H=m,Z=x;break;case"a":Xg(e,H+n,Z+r,[f[1],f[2],f[3],f[4],f[5],f[6]+H+n,f[7]+Z+r]),H+=f[6],Z+=f[7];break;case"A":Xg(e,H+n,Z+r,[f[1],f[2],f[3],f[4],f[5],f[6]+n,f[7]+r]),H=f[6],Z=f[7];break;case"z":case"Z":e.closePath()}M=f}}function Xg(e,t,n,r){const i=function(s,f,m,x,O,T,M,H,Z){const ue=Hm.call(arguments);if(lp[ue])return lp[ue];const fe=M*Jl,Ie=Math.sin(fe),Pe=Math.cos(fe),Le=Pe*(H-s)*.5+Ie*(Z-f)*.5,rt=Pe*(Z-f)*.5-Ie*(H-s)*.5;let it=Le*Le/((m=Math.abs(m))*m)+rt*rt/((x=Math.abs(x))*x);it>1&&(m*=it=Math.sqrt(it),x*=it);const ut=Pe/m,st=Ie/m,mt=-Ie/x,dt=Pe/x,en=ut*H+st*Z,mn=mt*H+dt*Z,sn=ut*s+st*f,In=mt*s+dt*f;let Fn=1/((sn-en)*(sn-en)+(In-mn)*(In-mn))-.25;Fn<0&&(Fn=0);let zn=Math.sqrt(Fn);T==O&&(zn=-zn);const Vn=.5*(en+sn)-zn*(In-mn),Qn=.5*(mn+In)+zn*(sn-en),mr=Math.atan2(mn-Qn,en-Vn);let Pr=Math.atan2(In-Qn,sn-Vn)-mr;Pr<0&&T===1?Pr+=pc:Pr>0&&T===0&&(Pr-=pc);const Cr=Math.ceil(Math.abs(Pr/(Zf+.001))),Jr=[];for(let gi=0;gi<Cr;++gi){const vi=mr+gi*Pr/Cr,zi=mr+(gi+1)*Pr/Cr;Jr[gi]=[Vn,Qn,vi,zi,m,x,Ie,Pe]}return lp[ue]=Jr}(r[5],r[6],r[0],r[1],r[3],r[4],r[2],t,n);for(let s=0;s<i.length;++s){const f=Gg(i[s]);e.bezierCurveTo(f[0],f[1],f[2],f[3],f[4],f[5])}}const Zp={circle:{draw:function(e,t){const n=Math.sqrt(t)/2;e.moveTo(n,0),e.arc(0,0,n,0,pc)}},cross:{draw:function(e,t){var n=Math.sqrt(t)/2,r=n/2.5;e.moveTo(-n,-r),e.lineTo(-n,r),e.lineTo(-r,r),e.lineTo(-r,n),e.lineTo(r,n),e.lineTo(r,r),e.lineTo(n,r),e.lineTo(n,-r),e.lineTo(r,-r),e.lineTo(r,-n),e.lineTo(-r,-n),e.lineTo(-r,-r),e.closePath()}},diamond:{draw:function(e,t){const n=Math.sqrt(t)/2;e.moveTo(-n,0),e.lineTo(0,-n),e.lineTo(n,0),e.lineTo(0,n),e.closePath()}},square:{draw:function(e,t){var n=Math.sqrt(t),r=-n/2;e.rect(r,r,n,n)}},arrow:{draw:function(e,t){var n=Math.sqrt(t)/2,r=n/7,i=n/2.5,s=n/8;e.moveTo(-r,n),e.lineTo(r,n),e.lineTo(r,-s),e.lineTo(i,-s),e.lineTo(0,-n),e.lineTo(-i,-s),e.lineTo(-r,-s),e.closePath()}},wedge:{draw:function(e,t){var n=Math.sqrt(t)/2,r=nd*n,i=r-.5773502691896257*n,s=n/4;e.moveTo(0,-r-i),e.lineTo(-s,r-i),e.lineTo(s,r-i),e.closePath()}},triangle:{draw:function(e,t){var n=Math.sqrt(t)/2,r=nd*n,i=r-.5773502691896257*n;e.moveTo(0,-r-i),e.lineTo(-n,r-i),e.lineTo(n,r-i),e.closePath()}},"triangle-up":{draw:function(e,t){var n=Math.sqrt(t)/2,r=nd*n;e.moveTo(0,-r),e.lineTo(-n,r),e.lineTo(n,r),e.closePath()}},"triangle-down":{draw:function(e,t){var n=Math.sqrt(t)/2,r=nd*n;e.moveTo(0,r),e.lineTo(-n,-r),e.lineTo(n,-r),e.closePath()}},"triangle-right":{draw:function(e,t){var n=Math.sqrt(t)/2,r=nd*n;e.moveTo(r,0),e.lineTo(-r,-n),e.lineTo(-r,n),e.closePath()}},"triangle-left":{draw:function(e,t){var n=Math.sqrt(t)/2,r=nd*n;e.moveTo(-r,0),e.lineTo(r,-n),e.lineTo(r,n),e.closePath()}},stroke:{draw:function(e,t){const n=Math.sqrt(t)/2;e.moveTo(-n,0),e.lineTo(n,0)}}};function Ql(e){return Object(be.w)(Zp,e)?Zp[e]:function(t){if(!Object(be.w)(fp,t)){const n=td(t);fp[t]={draw:function(r,i){rd(r,n,0,0,Math.sqrt(i)/2)}}}return fp[t]}(e)}var fp={};const ll=.448084975506;function Yg(e){return e.x}function em(e){return e.y}function tm(e){return e.width}function $m(e){return e.height}function Ic(e){return typeof e=="function"?e:()=>+e}function nm(e,t,n){return Math.max(t,Math.min(e,n))}function Jg(){var e=Yg,t=em,n=tm,r=$m,i=Ic(0),s=i,f=i,m=i,x=null;function O(T,M,H){var Z,ue=M??+e.call(this,T),fe=H??+t.call(this,T),Ie=+n.call(this,T),Pe=+r.call(this,T),Le=Math.min(Ie,Pe)/2,rt=nm(+i.call(this,T),0,Le),it=nm(+s.call(this,T),0,Le),ut=nm(+f.call(this,T),0,Le),st=nm(+m.call(this,T),0,Le);if(x||(x=Z=Os()),rt<=0&&it<=0&&ut<=0&&st<=0)x.rect(ue,fe,Ie,Pe);else{var mt=ue+Ie,dt=fe+Pe;x.moveTo(ue+rt,fe),x.lineTo(mt-it,fe),x.bezierCurveTo(mt-ll*it,fe,mt,fe+ll*it,mt,fe+it),x.lineTo(mt,dt-st),x.bezierCurveTo(mt,dt-ll*st,mt-ll*st,dt,mt-st,dt),x.lineTo(ue+ut,dt),x.bezierCurveTo(ue+ll*ut,dt,ue,dt-ll*ut,ue,dt-ut),x.lineTo(ue,fe+rt),x.bezierCurveTo(ue,fe+ll*rt,ue+ll*rt,fe,ue+rt,fe),x.closePath()}if(Z)return x=null,Z+""||null}return O.x=function(T){return arguments.length?(e=Ic(T),O):e},O.y=function(T){return arguments.length?(t=Ic(T),O):t},O.width=function(T){return arguments.length?(n=Ic(T),O):n},O.height=function(T){return arguments.length?(r=Ic(T),O):r},O.cornerRadius=function(T,M,H,Z){return arguments.length?(i=Ic(T),s=M!=null?Ic(M):i,m=H!=null?Ic(H):i,f=Z!=null?Ic(Z):s,O):i},O.context=function(T){return arguments.length?(x=T??null,O):x},O}function fl(){var e,t,n,r,i,s,f,m,x=null;function O(M,H,Z){const ue=Z/2;if(i){var fe=f-H,Ie=M-s;if(fe||Ie){var Pe=Math.sqrt(fe*fe+Ie*Ie),Le=(fe/=Pe)*m,rt=(Ie/=Pe)*m,it=Math.atan2(Ie,fe);x.moveTo(s-Le,f-rt),x.lineTo(M-fe*ue,H-Ie*ue),x.arc(M,H,ue,it-Math.PI,it),x.lineTo(s+Le,f+rt),x.arc(s,f,m,it,it+Math.PI)}else x.arc(M,H,ue,0,pc);x.closePath()}else i=1;s=M,f=H,m=ue}function T(M){var H,Z,ue,fe=M.length,Ie=!1;for(x==null&&(x=ue=Os()),H=0;H<=fe;++H)!(H<fe&&r(Z=M[H],H,M))===Ie&&(Ie=!Ie)&&(i=0),Ie&&O(+e(Z,H,M),+t(Z,H,M),+n(Z,H,M));if(ue)return x=null,ue+""||null}return T.x=function(M){return arguments.length?(e=M,T):e},T.y=function(M){return arguments.length?(t=M,T):t},T.size=function(M){return arguments.length?(n=M,T):n},T.defined=function(M){return arguments.length?(r=M,T):r},T.context=function(M){return arguments.length?(x=M??null,T):x},T}function hp(e,t){return e??t}const eh=e=>e.x||0,dp=e=>e.y||0,rs=e=>e.defined!==!1,rm=function(){var e=Bl,t=Rf,n=io(0),r=null,i=nr,s=$a,f=xa,m=null;function x(){var O,T,M=+e.apply(this,arguments),H=+t.apply(this,arguments),Z=i.apply(this,arguments)-Uu,ue=s.apply(this,arguments)-Uu,fe=Fl(ue-Z),Ie=ue>Z;if(m||(m=O=Os()),H<M&&(T=H,H=M,M=T),H>Ra)if(fe>Df-Ra)m.moveTo(H*Sa(Z),H*Es(Z)),m.arc(0,0,H,Z,ue,!Ie),M>Ra&&(m.moveTo(M*Sa(ue),M*Es(ue)),m.arc(0,0,M,ue,Z,Ie));else{var Pe,Le,rt=Z,it=ue,ut=Z,st=ue,mt=fe,dt=fe,en=f.apply(this,arguments)/2,mn=en>Ra&&(r?+r.apply(this,arguments):Oc(M*M+H*H)),sn=Mi(Fl(H-M)/2,+n.apply(this,arguments)),In=sn,Fn=sn;if(mn>Ra){var zn=Tf(mn/M*Es(en)),Vn=Tf(mn/H*Es(en));(mt-=2*zn)>Ra?(ut+=zn*=Ie?1:-1,st-=zn):(mt=0,ut=st=(Z+ue)/2),(dt-=2*Vn)>Ra?(rt+=Vn*=Ie?1:-1,it-=Vn):(dt=0,rt=it=(Z+ue)/2)}var Qn=H*Sa(rt),mr=H*Es(rt),Pr=M*Sa(st),Cr=M*Es(st);if(sn>Ra){var Jr,gi=H*Sa(it),vi=H*Es(it),zi=M*Sa(ut),wi=M*Es(ut);if(fe<Ac&&(Jr=function(ya,Ha,Ns,Fs,gs,kl,Vk,RA){var q1=Ns-ya,yv=Fs-Ha,H1=Vk-gs,cy=RA-kl,kh=cy*q1-H1*yv;if(!(kh*kh<Ra))return[ya+(kh=(H1*(Ha-kl)-cy*(ya-gs))/kh)*q1,Ha+kh*yv]}(Qn,mr,zi,wi,gi,vi,Pr,Cr))){var yi=Qn-Jr[0],_i=mr-Jr[1],vo=gi-Jr[0],na=vi-Jr[1],Ui=1/Es(function(ya){return ya>1?0:ya<-1?Ac:Math.acos(ya)}((yi*vo+_i*na)/(Oc(yi*yi+_i*_i)*Oc(vo*vo+na*na)))/2),va=Oc(Jr[0]*Jr[0]+Jr[1]*Jr[1]);In=Mi(sn,(M-va)/(Ui-1)),Fn=Mi(sn,(H-va)/(Ui+1))}}dt>Ra?Fn>Ra?(Pe=Hi(zi,wi,Qn,mr,H,Fn,Ie),Le=Hi(gi,vi,Pr,Cr,H,Fn,Ie),m.moveTo(Pe.cx+Pe.x01,Pe.cy+Pe.y01),Fn<sn?m.arc(Pe.cx,Pe.cy,Fn,ra(Pe.y01,Pe.x01),ra(Le.y01,Le.x01),!Ie):(m.arc(Pe.cx,Pe.cy,Fn,ra(Pe.y01,Pe.x01),ra(Pe.y11,Pe.x11),!Ie),m.arc(0,0,H,ra(Pe.cy+Pe.y11,Pe.cx+Pe.x11),ra(Le.cy+Le.y11,Le.cx+Le.x11),!Ie),m.arc(Le.cx,Le.cy,Fn,ra(Le.y11,Le.x11),ra(Le.y01,Le.x01),!Ie))):(m.moveTo(Qn,mr),m.arc(0,0,H,rt,it,!Ie)):m.moveTo(Qn,mr),M>Ra&&mt>Ra?In>Ra?(Pe=Hi(Pr,Cr,gi,vi,M,-In,Ie),Le=Hi(Qn,mr,zi,wi,M,-In,Ie),m.lineTo(Pe.cx+Pe.x01,Pe.cy+Pe.y01),In<sn?m.arc(Pe.cx,Pe.cy,In,ra(Pe.y01,Pe.x01),ra(Le.y01,Le.x01),!Ie):(m.arc(Pe.cx,Pe.cy,In,ra(Pe.y01,Pe.x01),ra(Pe.y11,Pe.x11),!Ie),m.arc(0,0,M,ra(Pe.cy+Pe.y11,Pe.cx+Pe.x11),ra(Le.cy+Le.y11,Le.cx+Le.x11),Ie),m.arc(Le.cx,Le.cy,In,ra(Le.y11,Le.x11),ra(Le.y01,Le.x01),!Ie))):m.arc(0,0,M,st,ut,Ie):m.lineTo(Pr,Cr)}else m.moveTo(0,0);if(m.closePath(),O)return m=null,O+""||null}return x.centroid=function(){var O=(+e.apply(this,arguments)+ +t.apply(this,arguments))/2,T=(+i.apply(this,arguments)+ +s.apply(this,arguments))/2-Ac/2;return[Sa(T)*O,Es(T)*O]},x.innerRadius=function(O){return arguments.length?(e=typeof O=="function"?O:io(+O),x):e},x.outerRadius=function(O){return arguments.length?(t=typeof O=="function"?O:io(+O),x):t},x.cornerRadius=function(O){return arguments.length?(n=typeof O=="function"?O:io(+O),x):n},x.padRadius=function(O){return arguments.length?(r=O==null?null:typeof O=="function"?O:io(+O),x):r},x.startAngle=function(O){return arguments.length?(i=typeof O=="function"?O:io(+O),x):i},x.endAngle=function(O){return arguments.length?(s=typeof O=="function"?O:io(+O),x):s},x.padAngle=function(O){return arguments.length?(f=typeof O=="function"?O:io(+O),x):f},x.context=function(O){return arguments.length?(m=O??null,x):m},x}().startAngle(e=>e.startAngle||0).endAngle(e=>e.endAngle||0).padAngle(e=>e.padAngle||0).innerRadius(e=>e.innerRadius||0).outerRadius(e=>e.outerRadius||0).cornerRadius(e=>e.cornerRadius||0),Gm=Xo().x(eh).y1(dp).y0(e=>(e.y||0)+(e.height||0)).defined(rs),pp=Xo().y(dp).x1(eh).x0(e=>(e.x||0)+(e.width||0)).defined(rs),mp=sc().x(eh).y(dp).defined(rs),Km=Jg().x(eh).y(dp).width(e=>e.width||0).height(e=>e.height||0).cornerRadius(e=>hp(e.cornerRadiusTopLeft,e.cornerRadius)||0,e=>hp(e.cornerRadiusTopRight,e.cornerRadius)||0,e=>hp(e.cornerRadiusBottomRight,e.cornerRadius)||0,e=>hp(e.cornerRadiusBottomLeft,e.cornerRadius)||0),Qg=function(e,t){var n=null;function r(){var i;if(n||(n=i=Os()),e.apply(this,arguments).draw(n,+t.apply(this,arguments)),i)return n=null,i+""||null}return e=typeof e=="function"?e:io(e||Vu),t=typeof t=="function"?t:io(t===void 0?64:+t),r.type=function(i){return arguments.length?(e=typeof i=="function"?i:io(i),r):e},r.size=function(i){return arguments.length?(t=typeof i=="function"?i:io(+i),r):t},r.context=function(i){return arguments.length?(n=i??null,r):n},r}().type(e=>Ql(e.shape||"circle")).size(e=>hp(e.size,64)),P0=fl().x(eh).y(dp).defined(rs).size(e=>e.size||1);function Rc(e){return e.cornerRadius||e.cornerRadiusTopLeft||e.cornerRadiusTopRight||e.cornerRadiusBottomRight||e.cornerRadiusBottomLeft}function th(e,t,n,r){return Km.context(e)(t,n,r)}var L0=1;function Zg(){L0=1}function Mc(e,t,n){var r=t.clip,i=e._defs,s=t.clip_id||(t.clip_id="clip"+L0++),f=i.clipping[s]||(i.clipping[s]={id:s});return Object(be.E)(r)?f.path=r(null):Rc(n)?f.path=th(null,n,0,0):(f.width=n.width||0,f.height=n.height||0),"url(#"+s+")"}function Ka(e){this.clear(),e&&this.union(e)}function id(e){this.mark=e,this.bounds=this.bounds||new Ka}function gp(e){id.call(this,e),this.items=this.items||[]}function im(e){this._pending=0,this._loader=e||Object(Yn.e)()}function e0(e){e._pending+=1}function om(e){e._pending-=1}function Zl(e,t,n){if(t.stroke&&t.opacity!==0&&t.strokeOpacity!==0){const r=t.strokeWidth!=null?+t.strokeWidth:1;e.expand(r+(n?function(i,s){return i.strokeJoin&&i.strokeJoin!=="miter"?0:s}(t,r):0))}return e}Ka.prototype={clone(){return new Ka(this)},clear(){return this.x1=+Number.MAX_VALUE,this.y1=+Number.MAX_VALUE,this.x2=-Number.MAX_VALUE,this.y2=-Number.MAX_VALUE,this},empty(){return this.x1===+Number.MAX_VALUE&&this.y1===+Number.MAX_VALUE&&this.x2===-Number.MAX_VALUE&&this.y2===-Number.MAX_VALUE},equals(e){return this.x1===e.x1&&this.y1===e.y1&&this.x2===e.x2&&this.y2===e.y2},set(e,t,n,r){return n<e?(this.x2=e,this.x1=n):(this.x1=e,this.x2=n),r<t?(this.y2=t,this.y1=r):(this.y1=t,this.y2=r),this},add(e,t){return e<this.x1&&(this.x1=e),t<this.y1&&(this.y1=t),e>this.x2&&(this.x2=e),t>this.y2&&(this.y2=t),this},expand(e){return this.x1-=e,this.y1-=e,this.x2+=e,this.y2+=e,this},round(){return this.x1=Math.floor(this.x1),this.y1=Math.floor(this.y1),this.x2=Math.ceil(this.x2),this.y2=Math.ceil(this.y2),this},scale(e){return this.x1*=e,this.y1*=e,this.x2*=e,this.y2*=e,this},translate(e,t){return this.x1+=e,this.x2+=e,this.y1+=t,this.y2+=t,this},rotate(e,t,n){const r=this.rotatedPoints(e,t,n);return this.clear().add(r[0],r[1]).add(r[2],r[3]).add(r[4],r[5]).add(r[6],r[7])},rotatedPoints(e,t,n){var{x1:r,y1:i,x2:s,y2:f}=this,m=Math.cos(e),x=Math.sin(e),O=t-t*m+n*x,T=n-t*x-n*m;return[m*r-x*i+O,x*r+m*i+T,m*r-x*f+O,x*r+m*f+T,m*s-x*i+O,x*s+m*i+T,m*s-x*f+O,x*s+m*f+T]},union(e){return e.x1<this.x1&&(this.x1=e.x1),e.y1<this.y1&&(this.y1=e.y1),e.x2>this.x2&&(this.x2=e.x2),e.y2>this.y2&&(this.y2=e.y2),this},intersect(e){return e.x1>this.x1&&(this.x1=e.x1),e.y1>this.y1&&(this.y1=e.y1),e.x2<this.x2&&(this.x2=e.x2),e.y2<this.y2&&(this.y2=e.y2),this},encloses(e){return e&&this.x1<=e.x1&&this.x2>=e.x2&&this.y1<=e.y1&&this.y2>=e.y2},alignsWith(e){return e&&(this.x1==e.x1||this.x2==e.x2||this.y1==e.y1||this.y2==e.y2)},intersects(e){return e&&!(this.x2<e.x1||this.x1>e.x2||this.y2<e.y1||this.y1>e.y2)},contains(e,t){return!(e<this.x1||e>this.x2||t<this.y1||t>this.y2)},width(){return this.x2-this.x1},height(){return this.y2-this.y1}},Object(be.z)(gp,id),im.prototype={pending(){return this._pending},sanitizeURL(e){const t=this;return e0(t),t._loader.sanitize(e,{context:"href"}).then(n=>(om(t),n)).catch(()=>(om(t),null))},loadImage(e){const t=this,n=so();return e0(t),t._loader.sanitize(e,{context:"image"}).then(r=>{const i=r.href;if(!i||!n)throw{url:i};const s=new n,f=Object(be.w)(r,"crossOrigin")?r.crossOrigin:"anonymous";return f!=null&&(s.crossOrigin=f),s.onload=()=>om(t),s.onerror=()=>om(t),s.src=i,s}).catch(r=>(om(t),{complete:!1,width:0,height:0,src:r&&r.url||""}))},ready(){const e=this;return new Promise(t=>{(function n(r){e.pending()?setTimeout(()=>{n(!0)},10):t(r)})(!1)})}};const Ev=pc-1e-8;let am,Wa,vp,nh,sm,yp,Xm,Ym;const ef=(e,t)=>am.add(e,t),$u=(e,t)=>ef(Wa=e,vp=t),t0=e=>ef(e,am.y1),n0=e=>ef(am.x1,e),od=(e,t)=>sm*e+Xm*t,bp=(e,t)=>yp*e+Ym*t,z0=(e,t)=>ef(od(e,t),bp(e,t)),Jm=(e,t)=>$u(od(e,t),bp(e,t));function um(e,t){return am=e,t?(nh=t*Jl,sm=Ym=Math.cos(nh),yp=Math.sin(nh),Xm=-yp):(sm=Ym=1,nh=yp=Xm=0),Ir}const Ir={beginPath(){},closePath(){},moveTo:Jm,lineTo:Jm,rect(e,t,n,r){nh?(z0(e+n,t),z0(e+n,t+r),z0(e,t+r),Jm(e,t)):(ef(e+n,t+r),$u(e,t))},quadraticCurveTo(e,t,n,r){const i=od(e,t),s=bp(e,t),f=od(n,r),m=bp(n,r);F(Wa,i,f,t0),F(vp,s,m,n0),$u(f,m)},bezierCurveTo(e,t,n,r,i,s){const f=od(e,t),m=bp(e,t),x=od(n,r),O=bp(n,r),T=od(i,s),M=bp(i,s);E(Wa,f,x,T,t0),E(vp,m,O,M,n0),$u(T,M)},arc(e,t,n,r,i,s){if(r+=nh,i+=nh,Wa=n*Math.cos(i)+e,vp=n*Math.sin(i)+t,Math.abs(i-r)>Ev)ef(e-n,t-n),ef(e+n,t+n);else{const f=O=>ef(n*Math.cos(O)+e,n*Math.sin(O)+t);let m,x;if(f(r),f(i),i!==r)if((r%=pc)<0&&(r+=pc),(i%=pc)<0&&(i+=pc),i<r&&(s=!s,m=r,r=i,i=m),s)for(i-=pc,m=r-r%Zf,x=0;x<4&&m>i;++x,m-=Zf)f(m);else for(m=r-r%Zf+Zf,x=0;x<4&&m<i;++x,m+=Zf)f(m)}}};function F(e,t,n,r){const i=(e-t)/(e+n-2*t);0<i&&i<1&&r(e+(t-e)*i)}function E(e,t,n,r,i){const s=r-e+3*t-3*n,f=e+n-2*t,m=e-t;let x,O=0,T=0;Math.abs(s)>$g?(x=f*f+m*s)>=0&&(O=(-f+(x=Math.sqrt(x)))/s,T=(-f-x)/s):O=.5*m/f,0<O&&O<1&&i(k(O,e,t,n,r)),0<T&&T<1&&i(k(T,e,t,n,r))}function k(e,t,n,r,i){const s=1-e,f=s*s,m=e*e;return f*s*t+3*f*e*n+3*s*m*r+m*e*i}var w=(w=Hs(1,1))?w.getContext("2d"):null;const _=new Ka;function L(e){return function(t,n){if(!w)return!0;e(w,t),_.clear().union(t.bounds).intersect(n).round();const{x1:r,y1:i,x2:s,y2:f}=_;for(let m=i;m<=f;++m)for(let x=r;x<=s;++x)if(w.isPointInPath(x,m))return!0;return!1}}function Y(e,t){return t.contains(e.x||0,e.y||0)}function ce(e,t){const n=e.x||0,r=e.y||0,i=e.width||0,s=e.height||0;return t.intersects(_.set(n,r,n+i,r+s))}function ve(e,t){const n=e.x||0,r=e.y||0;return De(t,n,r,e.x2!=null?e.x2:n,e.y2!=null?e.y2:r)}function De(e,t,n,r,i){const{x1:s,y1:f,x2:m,y2:x}=e,O=r-t,T=i-n;let M,H,Z,ue,fe=0,Ie=1;for(ue=0;ue<4;++ue){if(ue===0&&(M=-O,H=-(s-t)),ue===1&&(M=O,H=m-t),ue===2&&(M=-T,H=-(f-n)),ue===3&&(M=T,H=x-n),Math.abs(M)<1e-10&&H<0)return!1;if(Z=H/M,M<0){if(Z>Ie)return!1;Z>fe&&(fe=Z)}else if(M>0){if(Z<fe)return!1;Z<Ie&&(Ie=Z)}}return!0}function Ce(e,t){e.globalCompositeOperation=t.blend||"source-over"}function Xe(e,t){return e??t}function nt(e,t){const n=t.length;for(let r=0;r<n;++r)e.addColorStop(t[r].offset,t[r].color);return e}function Et(e,t,n){return Jp(n)?function(r,i,s){const f=s.width(),m=s.height();let x;if(i.gradient==="radial")x=r.createRadialGradient(s.x1+Xe(i.x1,.5)*f,s.y1+Xe(i.y1,.5)*m,Math.max(f,m)*Xe(i.r1,0),s.x1+Xe(i.x2,.5)*f,s.y1+Xe(i.y2,.5)*m,Math.max(f,m)*Xe(i.r2,.5));else{const O=Xe(i.x1,0),T=Xe(i.y1,0),M=Xe(i.x2,1),H=Xe(i.y2,0);if(O!==M&&T!==H&&f!==m){const Z=Hs(Math.ceil(f),Math.ceil(m)),ue=Z.getContext("2d");return ue.scale(f,m),ue.fillStyle=nt(ue.createLinearGradient(O,T,M,H),i.stops),ue.fillRect(0,0,f,m),r.createPattern(Z,"no-repeat")}x=r.createLinearGradient(s.x1+O*f,s.y1+T*m,s.x1+M*f,s.y1+H*m)}return nt(x,i.stops)}(e,n,t.bounds):n}function At(e,t,n){return(n*=t.fillOpacity==null?1:t.fillOpacity)>0&&(e.globalAlpha=n,e.fillStyle=Et(e,t,t.fill),!0)}var rn=[];function un(e,t,n){var r=(r=t.strokeWidth)!=null?r:1;return!(r<=0)&&(n*=t.strokeOpacity==null?1:t.strokeOpacity)>0&&(e.globalAlpha=n,e.strokeStyle=Et(e,t,t.stroke),e.lineWidth=r,e.lineCap=t.strokeCap||"butt",e.lineJoin=t.strokeJoin||"miter",e.miterLimit=t.strokeMiterLimit||10,e.setLineDash&&(e.setLineDash(t.strokeDash||rn),e.lineDashOffset=t.strokeDashOffset||0),!0)}function kn(e,t){return e.zindex-t.zindex||e.index-t.index}function En(e){if(!e.zdirty)return e.zitems;var t,n,r,i=e.items,s=[];for(n=0,r=i.length;n<r;++n)(t=i[n]).index=n,t.zindex&&s.push(t);return e.zdirty=!1,e.zitems=s.sort(kn)}function _n(e,t){var n,r,i=e.items;if(!i||!i.length)return;const s=En(e);if(s&&s.length){for(n=0,r=i.length;n<r;++n)i[n].zindex||t(i[n]);i=s}for(n=0,r=i.length;n<r;++n)t(i[n])}function Pn(e,t){var n,r,i=e.items;if(!i||!i.length)return null;const s=En(e);for(s&&s.length&&(i=s),r=i.length;--r>=0;)if(n=t(i[r]))return n;if(i===s){for(r=(i=e.items).length;--r>=0;)if(!i[r].zindex&&(n=t(i[r])))return n}return null}function dn(e){return function(t,n,r){_n(n,i=>{r&&!r.intersects(i.bounds)||cr(e,t,i,i)})}}function cr(e,t,n,r){var i=n.opacity==null?1:n.opacity;i!==0&&(e(t,r)||(Ce(t,n),n.fill&&At(t,n,i)&&t.fill(),n.stroke&&un(t,n,i)&&t.stroke()))}function yr(e){return e=e||be.Ia,function(t,n,r,i,s,f){return r*=t.pixelRatio,i*=t.pixelRatio,Pn(n,m=>{const x=m.bounds;if((!x||x.contains(s,f))&&x)return e(t,m,r,i,s,f)?m:void 0})}}function br(e,t){return function(n,r,i,s){var f,m,x=Array.isArray(r)?r[0]:r,O=t??x.fill,T=x.stroke&&n.isPointInStroke;return T&&(f=x.strokeWidth,m=x.strokeCap,n.lineWidth=f??1,n.lineCap=m??"butt"),!e(n,r)&&(O&&n.isPointInPath(i,s)||T&&n.isPointInStroke(i,s))}}function Br(e){return yr(br(e))}function Or(e,t){return"translate("+e+","+t+")"}function hi(e){return"rotate("+e+")"}function ki(e){return Or(e.x||0,e.y||0)}function xi(e,t,n){function r(i,s){var f=s.x||0,m=s.y||0,x=s.angle||0;i.translate(f,m),x&&i.rotate(x*=Jl),i.beginPath(),t(i,s),x&&i.rotate(-x),i.translate(-f,-m)}return{type:e,tag:"path",nested:!1,attr:function(i,s){i("transform",function(f){return Or(f.x||0,f.y||0)+(f.angle?" "+hi(f.angle):"")}(s)),i("d",t(null,s))},bound:function(i,s){return t(um(i,s.angle),s),Zl(i,s).translate(s.x||0,s.y||0)},draw:dn(r),pick:Br(r),isect:n||L(r)}}var xo=xi("arc",function(e,t){return rm.context(e)(t)});function Wo(e,t,n){function r(s,f){s.beginPath(),t(s,f)}const i=br(r);return{type:e,tag:"path",nested:!0,attr:function(s,f){var m=f.mark.items;m.length&&s("d",t(null,m))},bound:function(s,f){var m=f.items;return m.length===0?s:(t(um(s),m),Zl(s,m[0]))},draw:function(s){return function(f,m,x){!m.items.length||x&&!x.intersects(m.bounds)||cr(s,f,m.items[0],m.items)}}(r),pick:function(s,f,m,x,O,T){var M=f.items,H=f.bounds;return!M||!M.length||H&&!H.contains(O,T)?null:(m*=s.pixelRatio,x*=s.pixelRatio,i(s,M,m,x)?M[0]:null)},isect:Y,tip:n}}var To=Wo("area",function(e,t){const n=t[0],r=n.interpolate||"linear";return(n.orient==="horizontal"?pp:Gm).curve(Yl(r,n.orient,n.tension)).context(e)(t)},function(e,t){for(var n,r,i=e[0].orient==="horizontal"?t[1]:t[0],s=e[0].orient==="horizontal"?"y":"x",f=e.length,m=1/0;--f>=0;)e[f].defined!==!1&&(r=Math.abs(e[f][s]-i))<m&&(m=r,n=e[f]);return n});function Do(e,t){e.beginPath(),Rc(t)?th(e,t,0,0):e.rect(0,0,t.width||0,t.height||0),e.clip()}function Mo(e){const t=Xe(e.strokeWidth,1);return e.strokeOffset!=null?e.strokeOffset:e.stroke&&t>.5&&t<1.5?.5-Math.abs(t-1):0}function ea(e,t){const n=Mo(t);e("d",th(null,t,n,n))}function sa(e,t,n,r){const i=Mo(t);e.beginPath(),th(e,t,(n||0)+i,(r||0)+i)}const ka=br(sa),Ys=br(sa,!1),Ci=br(sa,!0);var Va={type:"group",tag:"g",nested:!1,attr:function(e,t){e("transform",ki(t))},bound:function(e,t){if(!t.clip&&t.items){const n=t.items,r=n.length;for(let i=0;i<r;++i)e.union(n[i].bounds)}return(t.clip||t.width||t.height)&&!t.noBound&&e.add(0,0).add(t.width||0,t.height||0),Zl(e,t),e.translate(t.x||0,t.y||0)},draw:function(e,t,n){_n(t,r=>{const i=r.x||0,s=r.y||0,f=r.strokeForeground,m=r.opacity==null?1:r.opacity;(r.stroke||r.fill)&&m&&(sa(e,r,i,s),Ce(e,r),r.fill&&At(e,r,m)&&e.fill(),r.stroke&&!f&&un(e,r,m)&&e.stroke()),e.save(),e.translate(i,s),r.clip&&Do(e,r),n&&n.translate(-i,-s),_n(r,x=>{this.draw(e,x,n)}),n&&n.translate(i,s),e.restore(),f&&r.stroke&&m&&(sa(e,r,i,s),Ce(e,r),un(e,r,m)&&e.stroke())})},pick:function(e,t,n,r,i,s){if(t.bounds&&!t.bounds.contains(i,s)||!t.items)return null;const f=n*e.pixelRatio,m=r*e.pixelRatio;return Pn(t,x=>{let O,T,M;const H=x.bounds;if(H&&!H.contains(i,s))return;T=x.x||0,M=x.y||0;const Z=T+(x.width||0),ue=M+(x.height||0),fe=x.clip;if(fe&&(i<T||i>Z||s<M||s>ue))return;if(e.save(),e.translate(T,M),T=i-T,M=s-M,fe&&Rc(x)&&!Ci(e,x,f,m))return e.restore(),null;const Ie=x.strokeForeground,Pe=t.interactive!==!1;return Pe&&Ie&&x.stroke&&Ys(e,x,f,m)?(e.restore(),x):(!(O=Pn(x,Le=>function(rt,it,ut){return(rt.interactive!==!1||rt.marktype==="group")&&rt.bounds&&rt.bounds.contains(it,ut)}(Le,T,M)?this.pick(Le,n,r,T,M):null))&&Pe&&(x.fill||!Ie&&x.stroke)&&ka(e,x,f,m)&&(O=x),e.restore(),O||null)})},isect:ce,content:function(e,t,n){e("clip-path",t.clip?Mc(n,t,t):null)},background:function(e,t){e("class","background"),e("aria-hidden",!0),ea(e,t)},foreground:function(e,t){e("class","foreground"),e("aria-hidden",!0),t.strokeForeground?ea(e,t):e("d","")}},Xa={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",version:"1.1"};function Js(e,t){var n=e.image;return(!n||e.url&&e.url!==n.url)&&(n={complete:!1,width:0,height:0},t.loadImage(e.url).then(r=>{e.image=r,e.image.url=e.url})),n}function _s(e,t){return e.width!=null?e.width:t&&t.width?e.aspect!==!1&&e.height?e.height*t.width/t.height:t.width:0}function hu(e,t){return e.height!=null?e.height:t&&t.height?e.aspect!==!1&&e.width?e.width*t.height/t.width:t.height:0}function du(e,t){return e==="center"?t/2:e==="right"?t:0}function pu(e,t){return e==="middle"?t/2:e==="bottom"?t:0}var ad={type:"image",tag:"image",nested:!1,attr:function(e,t,n){const r=Js(t,n),i=_s(t,r),s=hu(t,r),f=(t.x||0)-du(t.align,i),m=(t.y||0)-pu(t.baseline,s);e("href",!r.src&&r.toDataURL?r.toDataURL():r.src||"",Xa["xmlns:xlink"],"xlink:href"),e("transform",Or(f,m)),e("width",i),e("height",s),e("preserveAspectRatio",t.aspect===!1?"none":"xMidYMid")},bound:function(e,t){const n=t.image,r=_s(t,n),i=hu(t,n),s=(t.x||0)-du(t.align,r),f=(t.y||0)-pu(t.baseline,i);return e.set(s,f,s+r,f+i)},draw:function(e,t,n){_n(t,r=>{if(n&&!n.intersects(r.bounds))return;const i=Js(r,this);let s=_s(r,i),f=hu(r,i);if(s===0||f===0)return;let m,x,O,T,M=(r.x||0)-du(r.align,s),H=(r.y||0)-pu(r.baseline,f);r.aspect!==!1&&(x=i.width/i.height,O=r.width/r.height,x==x&&O==O&&x!==O&&(O<x?(H+=(f-(T=s/x))/2,f=T):(M+=(s-(T=f*x))/2,s=T))),(i.complete||i.toDataURL)&&(Ce(e,r),e.globalAlpha=(m=r.opacity)!=null?m:1,e.imageSmoothingEnabled=r.smooth!==!1,e.drawImage(i,M,H,s,f))})},pick:yr(),isect:be.Ia,get:Js,xOffset:du,yOffset:pu},rh=Wo("line",function(e,t){const n=t[0],r=n.interpolate||"linear";return mp.curve(Yl(r,n.orient,n.tension)).context(e)(t)},function(e,t){for(var n,r,i=Math.pow(e[0].strokeWidth||1,2),s=e.length;--s>=0;)if(e[s].defined!==!1&&(n=e[s].x-t[0])*n+(r=e[s].y-t[1])*r<i)return e[s];return null});function hl(e,t){var n=t.path;if(n==null)return!0;var r=t.x||0,i=t.y||0,s=t.scaleX||1,f=t.scaleY||1,m=(t.angle||0)*Jl,x=t.pathCache;x&&x.path===n||((t.pathCache=x=td(n)).path=n),m&&e.rotate&&e.translate?(e.translate(r,i),e.rotate(m),rd(e,x,0,0,s,f),e.rotate(-m),e.translate(-r,-i)):rd(e,x,r,i,s,f)}var tf={type:"path",tag:"path",nested:!1,attr:function(e,t){var n=t.scaleX||1,r=t.scaleY||1;n===1&&r===1||e("vector-effect","non-scaling-stroke"),e("transform",function(i){return Or(i.x||0,i.y||0)+(i.angle?" "+hi(i.angle):"")+(i.scaleX||i.scaleY?" "+function(s,f){return"scale("+s+","+f+")"}(i.scaleX||1,i.scaleY||1):"")}(t)),e("d",t.path)},bound:function(e,t){return hl(um(e,t.angle),t)?e.set(0,0,0,0):Zl(e,t,!0)},draw:dn(hl),pick:Br(hl),isect:L(hl)};function dl(e,t){e.beginPath(),th(e,t)}var Gu={type:"rect",tag:"path",nested:!1,attr:function(e,t){e("d",th(null,t))},bound:function(e,t){var n,r;return Zl(e.set(n=t.x||0,r=t.y||0,n+t.width||0,r+t.height||0),t)},draw:dn(dl),pick:Br(dl),isect:ce};function Ba(e,t,n){var r,i,s,f;return!(!t.stroke||!un(e,t,n))&&(r=t.x||0,i=t.y||0,s=t.x2!=null?t.x2:r,f=t.y2!=null?t.y2:i,e.beginPath(),e.moveTo(r,i),e.lineTo(s,f),!0)}var nf={type:"rule",tag:"line",nested:!1,attr:function(e,t){e("transform",ki(t)),e("x2",t.x2!=null?t.x2-(t.x||0):0),e("y2",t.y2!=null?t.y2-(t.y||0):0)},bound:function(e,t){var n,r;return Zl(e.set(n=t.x||0,r=t.y||0,t.x2!=null?t.x2:n,t.y2!=null?t.y2:r),t)},draw:function(e,t,n){_n(t,r=>{if(!n||n.intersects(r.bounds)){var i=r.opacity==null?1:r.opacity;i&&Ba(e,r,i)&&(Ce(e,r),e.stroke())}})},pick:yr(function(e,t,n,r){return!!e.isPointInStroke&&Ba(e,t,1)&&e.isPointInStroke(n,r)}),isect:ve},ih=xi("shape",function(e,t){return(t.mark.shape||t.shape).context(e)(t)}),sd=xi("symbol",function(e,t){return Qg.context(e)(t)},Y);const rf=Object(be.N)();var ds={height:Ku,measureWidth:jc,estimateWidth:ud,width:ud,canvas:oh};function oh(e){ds.width=e&&w?jc:ud}function ud(e,t){return cd(pl(e,t),Ku(e))}function cd(e,t){return~~(.8*e.length*t)}function jc(e,t){return Ku(e)<=0||!(t=pl(e,t))?0:xp(t,ld(e))}function xp(e,t){const n=`(${t}) ${e}`;let r=rf.get(n);return r===void 0&&(w.font=t,r=w.measureText(e).width,rf.set(n,r)),r}function Ku(e){return e.fontSize!=null?+e.fontSize||0:11}function Ds(e){return e.lineHeight!=null?e.lineHeight:Ku(e)+2}function Iu(e){return function(t){return Object(be.B)(t)?t.length>1?t:t[0]:t}(e.lineBreak&&e.text&&!Object(be.B)(e.text)?e.text.split(e.lineBreak):e.text)}function ps(e){const t=Iu(e);return(Object(be.B)(t)?t.length-1:0)*Ds(e)}function pl(e,t){const n=t==null?"":(t+"").trim();return e.limit>0&&n.length?function(r,i){var s=+r.limit,f=function(H){if(ds.width===jc){const Z=ld(H);return ue=>xp(ue,Z)}{const Z=Ku(H);return ue=>cd(ue,Z)}}(r);if(f(i)<s)return i;var m,x=r.ellipsis||"",O=r.dir==="rtl",T=0,M=i.length;if(s-=f(x),O){for(;T<M;)m=T+M>>>1,f(i.slice(m))>s?T=m+1:M=m;return x+i.slice(T)}for(;T<M;)m=1+(T+M>>>1),f(i.slice(0,m))<s?T=m:M=m-1;return i.slice(0,T)+x}(e,n):n}function ah(e,t){var n=e.font;return(t&&n?String(n).replace(/"/g,"'"):n)||"sans-serif"}function ld(e,t){return(e.fontStyle?e.fontStyle+" ":"")+(e.fontVariant?e.fontVariant+" ":"")+(e.fontWeight?e.fontWeight+" ":"")+Ku(e)+"px "+ah(e,t)}function sh(e){var t=e.baseline,n=Ku(e);return Math.round(t==="top"?.79*n:t==="middle"?.3*n:t==="bottom"?-.21*n:t==="line-top"?.29*n+.5*Ds(e):t==="line-bottom"?.29*n-.5*Ds(e):0)}oh(!0);const wp={left:"start",center:"middle",right:"end"},ml=new Ka;function ou(e){var t,n=e.x||0,r=e.y||0,i=e.radius||0;return i&&(t=(e.theta||0)-Zf,n+=i*Math.cos(t),r+=i*Math.sin(t)),ml.x1=n,ml.y1=r,ml}function Cv(e,t,n){var r,i=ds.height(t),s=t.align,f=ou(t),m=f.x1,x=f.y1,O=t.dx||0,T=(t.dy||0)+sh(t)-Math.round(.8*i),M=Iu(t);if(Object(be.B)(M)?(i+=Ds(t)*(M.length-1),r=M.reduce((H,Z)=>Math.max(H,ds.width(t,Z)),0)):r=ds.width(t,M),s==="center"?O-=r/2:s==="right"&&(O-=r),e.set(O+=m,T+=x,O+r,T+i),t.angle&&!n)e.rotate(t.angle*Jl,m,x);else if(n===2)return e.rotatedPoints(t.angle*Jl,m,x);return e}var gl={arc:xo,area:To,group:Va,image:ad,line:rh,path:tf,rect:Gu,rule:nf,shape:ih,symbol:sd,text:{type:"text",tag:"text",nested:!1,attr:function(e,t){var n,r=t.dx||0,i=(t.dy||0)+sh(t),s=ou(t),f=s.x1,m=s.y1,x=t.angle||0;e("text-anchor",wp[t.align]||"start"),x?(n=Or(f,m)+" "+hi(x),(r||i)&&(n+=" "+Or(r,i))):n=Or(f+r,m+i),e("transform",n)},bound:Cv,draw:function(e,t,n){_n(t,r=>{var i,s,f,m,x,O,T,M=r.opacity==null?1:r.opacity;if(!(n&&!n.intersects(r.bounds)||M===0||r.fontSize<=0||r.text==null||r.text.length===0)){if(e.font=ld(r),e.textAlign=r.align||"left",s=(i=ou(r)).x1,f=i.y1,r.angle&&(e.save(),e.translate(s,f),e.rotate(r.angle*Jl),s=f=0),s+=r.dx||0,f+=(r.dy||0)+sh(r),O=Iu(r),Ce(e,r),Object(be.B)(O))for(x=Ds(r),m=0;m<O.length;++m)T=pl(r,O[m]),r.fill&&At(e,r,M)&&e.fillText(T,s,f),r.stroke&&un(e,r,M)&&e.strokeText(T,s,f),f+=x;else T=pl(r,O),r.fill&&At(e,r,M)&&e.fillText(T,s,f),r.stroke&&un(e,r,M)&&e.strokeText(T,s,f);r.angle&&e.restore()}})},pick:yr(function(e,t,n,r,i,s){if(t.fontSize<=0)return!1;if(!t.angle)return!0;var f=ou(t),m=f.x1,x=f.y1,O=Cv(ml,t,1),T=-t.angle*Jl,M=Math.cos(T),H=Math.sin(T),Z=M*i-H*s+(m-M*m+H*x),ue=H*i+M*s+(x-H*m-M*x);return O.contains(Z,ue)}),isect:function(e,t){const n=Cv(ml,e,2);return De(t,n[0],n[1],n[2],n[3])||De(t,n[0],n[1],n[4],n[5])||De(t,n[4],n[5],n[6],n[7])||De(t,n[2],n[3],n[6],n[7])}},trail:Wo("trail",function(e,t){return P0.context(e)(t)},function(e,t){for(var n,r,i=e.length;--i>=0;)if(e[i].defined!==!1&&(n=e[i].x-t[0])*n+(r=e[i].y-t[1])*r<(n=e[i].size||1)*n)return e[i];return null})};function fd(e,t,n){var r=gl[e.mark.marktype],i=t||r.bound;return r.nested&&(e=e.mark),i(e.bounds||(e.bounds=new Ka),e,n)}var Ov={mark:null};function Av(e,t,n){var r,i,s,f,m=gl[e.marktype],x=m.bound,O=e.items,T=O&&O.length;if(m.nested)return T?s=O[0]:(Ov.mark=e,s=Ov),f=fd(s,x,n),t=t&&t.union(f)||f;if(t=t||e.bounds&&e.bounds.clear()||new Ka,T)for(r=0,i=O.length;r<i;++r)t.union(fd(O[r],x,n));return e.bounds=t}const Sv=["marktype","name","role","interactive","clip","items","zindex","x","y","width","height","align","baseline","fill","fillOpacity","opacity","blend","stroke","strokeOpacity","strokeWidth","strokeCap","strokeDash","strokeDashOffset","strokeForeground","strokeOffset","startAngle","endAngle","innerRadius","outerRadius","cornerRadius","padAngle","cornerRadiusTopLeft","cornerRadiusTopRight","cornerRadiusBottomLeft","cornerRadiusBottomRight","interpolate","tension","orient","defined","url","aspect","smooth","path","scaleX","scaleY","x2","y2","size","shape","text","angle","theta","radius","dir","dx","dy","ellipsis","limit","lineBreak","lineHeight","font","fontSize","fontWeight","fontStyle","fontVariant","description","aria","ariaRole","ariaRoleDescription"];function r0(e,t){return JSON.stringify(e,Sv,t)}function U0(e){return function t(n){var r,i,s,f=n.marktype,m=n.items;if(m)for(i=0,s=m.length;i<s;++i)r=f?"mark":"group",m[i][r]=n,m[i].zindex&&(m[i][r].zdirty=!0),(f||r)==="group"&&t(m[i]);return f&&Av(n),n}(typeof e=="string"?JSON.parse(e):e)}function i0(e){arguments.length?this.root=U0(e):(this.root=W0({marktype:"group",name:"root",role:"frame"}),this.root.items=[new gp(this.root)])}function W0(e,t){const n={bounds:new Ka,clip:!!e.clip,group:t,interactive:e.interactive!==!1,items:[],marktype:e.marktype,name:e.name||void 0,role:e.role||void 0,zindex:e.zindex||0};return e.aria!=null&&(n.aria=e.aria),e.description&&(n.description=e.description),n}function mc(e,t,n){return!e&&typeof document<"u"&&document.createElement&&(e=document),e?n?e.createElementNS(n,t):e.createElement(t):null}function _v(e,t){t=t.toLowerCase();for(var n=e.childNodes,r=0,i=n.length;r<i;++r)if(n[r].tagName.toLowerCase()===t)return n[r]}function Xu(e,t,n,r){var i,s=e.childNodes[t];return s&&s.tagName.toLowerCase()===n.toLowerCase()||(i=s||null,s=mc(e.ownerDocument,n,r),e.insertBefore(s,i)),s}function of(e,t){for(var n=e.childNodes,r=n.length;r>t;)e.removeChild(n[--r]);return e}function v(e){return"mark-"+e.marktype+(e.role?" role-"+e.role:"")+(e.name?" "+e.name:"")}function h(e,t){const n=t.getBoundingClientRect();return[e.clientX-n.left-(t.clientLeft||0),e.clientY-n.top-(t.clientTop||0)]}function u(e,t){this._active=null,this._handlers={},this._loader=e||Object(Yn.e)(),this._tooltip=t||d}function d(e,t,n,r){e.element().setAttribute("title",r||"")}function y(e){this._el=null,this._bgcolor=null,this._loader=new im(e)}i0.prototype={toJSON(e){return r0(this.root,e||0)},mark(e,t,n){const r=W0(e,t=t||this.root.items[0]);return t.items[n]=r,r.zindex&&(r.group.zdirty=!0),r}},u.prototype={initialize(e,t,n){return this._el=e,this._obj=n||null,this.origin(t)},element(){return this._el},canvas(){return this._el&&this._el.firstChild},origin(e){return arguments.length?(this._origin=e||[0,0],this):this._origin.slice()},scene(e){return arguments.length?(this._scene=e,this):this._scene},on(){},off(){},_handlerIndex(e,t,n){for(let r=e?e.length:0;--r>=0;)if(e[r].type===t&&(!n||e[r].handler===n))return r;return-1},handlers(e){const t=this._handlers,n=[];if(e)n.push(...t[this.eventName(e)]);else for(const r in t)n.push(...t[r]);return n},eventName(e){const t=e.indexOf(".");return t<0?e:e.slice(0,t)},handleHref(e,t,n){this._loader.sanitize(n,{context:"href"}).then(r=>{const i=new MouseEvent(e.type,e),s=mc(null,"a");for(const f in r)s.setAttribute(f,r[f]);s.dispatchEvent(i)}).catch(()=>{})},handleTooltip(e,t,n){if(t&&t.tooltip!=null){t=function(i,s,f,m){var x,O,T=i&&i.mark;if(T&&(x=gl[T.marktype]).tip){for((O=h(s,f))[0]-=m[0],O[1]-=m[1];i=i.mark.group;)O[0]-=i.x||0,O[1]-=i.y||0;i=x.tip(T.items,O)}return i}(t,e,this.canvas(),this._origin);const r=n&&t&&t.tooltip||null;this._tooltip.call(this._obj,this,e,t,r)}},getItemBoundingClientRect(e){const t=this.canvas();if(!t)return;const n=t.getBoundingClientRect(),r=this._origin,i=e.bounds,s=i.width(),f=i.height();let m=i.x1+r[0]+n.left,x=i.y1+r[1]+n.top;for(;e.mark&&(e=e.mark.group);)m+=e.x||0,x+=e.y||0;return{x:m,y:x,width:s,height:f,left:m,top:x,right:m+s,bottom:x+f}}},y.prototype={initialize(e,t,n,r,i){return this._el=e,this.resize(t,n,r,i)},element(){return this._el},canvas(){return this._el&&this._el.firstChild},background(e){return arguments.length===0?this._bgcolor:(this._bgcolor=e,this)},resize(e,t,n,r){return this._width=e,this._height=t,this._origin=n||[0,0],this._scale=r||1,this},dirty(){},render(e){const t=this;return t._call=function(){t._render(e)},t._call(),t._call=null,t},_render(){},renderAsync(e){const t=this.render(e);return this._ready?this._ready.then(()=>t):Promise.resolve(t)},_load(e,t){var n=this,r=n._loader[e](t);if(!n._ready){const i=n._call;n._ready=n._loader.ready().then(s=>{s&&i(),n._ready=null})}return r},sanitizeURL(e){return this._load("sanitizeURL",e)},loadImage(e){return this._load("loadImage",e)}};const D="dragleave",z="mousedown",X="mousemove",oe="mouseout",he="click",xe=["keydown","keypress","keyup","dragenter",D,"dragover",z,"mouseup",X,oe,"mouseover",he,"dblclick","wheel","mousewheel","touchstart","touchmove","touchend"],Fe=X,Re=oe,Me=he;function We(e,t){u.call(this,e,t),this._down=null,this._touch=null,this._first=!0,this._events={}}const Ze=e=>e==="touchstart"||e==="touchmove"||e==="touchend"?["touchstart","touchmove","touchend"]:[e];function Je(e,t){Ze(t).forEach(n=>function(r,i){const s=r.canvas();s&&!r._events[i]&&(r._events[i]=1,s.addEventListener(i,r[i]?f=>r[i](f):f=>r.fire(i,f)))}(e,n))}function at(e,t,n){return function(r){const i=this._active,s=this.pickEvent(r);s===i?this.fire(e,r):(i&&i.exit||this.fire(n,r),this._active=s,this.fire(t,r),this.fire(e,r))}}function yt(e){return function(t){this.fire(e,t),this._active=null}}Object(be.z)(We,u,{initialize(e,t,n){return this._canvas=e&&_v(e,"canvas"),[he,z,X,oe,D].forEach(r=>Je(this,r)),u.prototype.initialize.call(this,e,t,n)},canvas(){return this._canvas},context(){return this._canvas.getContext("2d")},events:xe,DOMMouseScroll(e){this.fire("mousewheel",e)},mousemove:at(X,"mouseover",oe),dragover:at("dragover","dragenter",D),mouseout:yt(oe),dragleave:yt(D),mousedown(e){this._down=this._active,this.fire(z,e)},click(e){this._down===this._active&&(this.fire(he,e),this._down=null)},touchstart(e){this._touch=this.pickEvent(e.changedTouches[0]),this._first&&(this._active=this._touch,this._first=!1),this.fire("touchstart",e,!0)},touchmove(e){this.fire("touchmove",e,!0)},touchend(e){this.fire("touchend",e,!0),this._touch=null},fire(e,t,n){const r=n?this._touch:this._active,i=this._handlers[e];if(t.vegaType=e,e===Me&&r&&r.href?this.handleHref(t,r,r.href):e!==Fe&&e!==Re||this.handleTooltip(t,r,e!==Re),i)for(let s=0,f=i.length;s<f;++s)i[s].handler.call(this._obj,t,r)},on(e,t){const n=this.eventName(e),r=this._handlers;return this._handlerIndex(r[n],e,t)<0&&(Je(this,e),(r[n]||(r[n]=[])).push({type:e,handler:t})),this},off(e,t){const n=this.eventName(e),r=this._handlers[n],i=this._handlerIndex(r,e,t);return i>=0&&r.splice(i,1),this},pickEvent(e){const t=h(e,this._canvas),n=this._origin;return this.pick(this._scene,t[0],t[1],t[0]-n[0],t[1]-n[1])},pick(e,t,n,r,i){const s=this.context();return gl[e.marktype].pick.call(this,s,e,t,n,r,i)}});var xt=typeof window<"u"&&window.devicePixelRatio||1;function kt(e){y.call(this,e),this._options={},this._redraw=!1,this._dirty=new Ka,this._tempb=new Ka}const It=y.prototype;function Jt(e,t){u.call(this,e,t);const n=this;n._hrefHandler=on(n,(r,i)=>{i&&i.href&&n.handleHref(r,i,i.href)}),n._tooltipHandler=on(n,(r,i)=>{n.handleTooltip(r,i,r.type!==Re)})}Object(be.z)(kt,y,{initialize(e,t,n,r,i,s){return this._options=s||{},this._canvas=this._options.externalContext?null:Hs(1,1,this._options.type),e&&this._canvas&&(of(e,0).appendChild(this._canvas),this._canvas.setAttribute("class","marks")),It.initialize.call(this,e,t,n,r,i)},resize(e,t,n,r){if(It.resize.call(this,e,t,n,r),this._canvas)(function(i,s,f,m,x,O){const T=typeof HTMLElement<"u"&&i instanceof HTMLElement&&i.parentNode!=null,M=i.getContext("2d"),H=T?xt:x;i.width=s*H,i.height=f*H;for(const Z in O)M[Z]=O[Z];T&&H!==1&&(i.style.width=s+"px",i.style.height=f+"px"),M.pixelRatio=H,M.setTransform(H,0,0,H,H*m[0],H*m[1])})(this._canvas,this._width,this._height,this._origin,this._scale,this._options.context);else{const i=this._options.externalContext;i||Object(be.o)("CanvasRenderer is missing a valid canvas or context"),i.scale(this._scale,this._scale),i.translate(this._origin[0],this._origin[1])}return this._redraw=!0,this},canvas(){return this._canvas},context(){return this._options.externalContext||(this._canvas?this._canvas.getContext("2d"):null)},dirty(e){const t=this._tempb.clear().union(e.bounds);let n=e.mark.group;for(;n;)t.translate(n.x||0,n.y||0),n=n.mark.group;this._dirty.union(t)},_render(e){const t=this.context(),n=this._origin,r=this._width,i=this._height,s=this._dirty,f=((x,O,T)=>new Ka().set(0,0,O,T).translate(-x[0],-x[1]))(n,r,i);t.save();const m=this._redraw||s.empty()?(this._redraw=!1,f.expand(1)):function(x,O,T){return O.expand(1).round(),x.pixelRatio%1&&O.scale(x.pixelRatio).round().scale(1/x.pixelRatio),O.translate(-T[0]%1,-T[1]%1),x.beginPath(),x.rect(O.x1,O.y1,O.width(),O.height()),x.clip(),O}(t,f.intersect(s),n);return this.clear(-n[0],-n[1],r,i),this.draw(t,e,m),t.restore(),s.clear(),this},draw(e,t,n){const r=gl[t.marktype];t.clip&&function(i,s){var f=s.clip;i.save(),Object(be.E)(f)?(i.beginPath(),f(i),i.clip()):Do(i,s.group)}(e,t),r.draw.call(this,e,t,n),t.clip&&e.restore()},clear(e,t,n,r){const i=this._options,s=this.context();i.type==="pdf"||i.externalContext||s.clearRect(e,t,n,r),this._bgcolor!=null&&(s.fillStyle=this._bgcolor,s.fillRect(e,t,n,r))}});const on=(e,t)=>n=>{let r=n.target.__data__;r=Array.isArray(r)?r[0]:r,n.vegaType=n.type,t.call(e._obj,n,r)};Object(be.z)(Jt,u,{initialize(e,t,n){let r=this._svg;return r&&(r.removeEventListener(Me,this._hrefHandler),r.removeEventListener(Fe,this._tooltipHandler),r.removeEventListener(Re,this._tooltipHandler)),this._svg=r=e&&_v(e,"svg"),r&&(r.addEventListener(Me,this._hrefHandler),r.addEventListener(Fe,this._tooltipHandler),r.addEventListener(Re,this._tooltipHandler)),u.prototype.initialize.call(this,e,t,n)},canvas(){return this._svg},on(e,t){const n=this.eventName(e),r=this._handlers;if(this._handlerIndex(r[n],e,t)<0){const i={type:e,handler:t,listener:on(this,t)};(r[n]||(r[n]=[])).push(i),this._svg&&this._svg.addEventListener(n,i.listener)}return this},off(e,t){const n=this.eventName(e),r=this._handlers[n],i=this._handlerIndex(r,e,t);return i>=0&&(this._svg&&this._svg.removeEventListener(n,r[i].listener),r.splice(i,1)),this}});const Qt="aria-hidden",cn="aria-label",vn="role",p="aria-roledescription",c="graphics-object",o="graphics-symbol",l=(e,t,n)=>({[vn]:e,[p]:t,[cn]:n||void 0}),g=Object(be.Fa)(["axis-domain","axis-grid","axis-label","axis-tick","axis-title","legend-band","legend-entry","legend-gradient","legend-label","legend-title","legend-symbol","title"]),S={axis:{desc:"axis",caption:function(e){const t=e.datum,n=e.orient,r=t.title?me(e):null,i=e.context,s=i.scales[t.scale].value,f=i.dataflow.locale(),m=s.type;return`${n==="left"||n==="right"?"Y":"X"}-axis`+(r?` titled '${r}'`:"")+` for a ${Yf(m)?"discrete":m} scale with ${qg(f,s,e)}`}},legend:{desc:"legend",caption:function(e){const t=e.datum,n=t.title?me(e):null,r=`${t.type||""} legend`.trim(),i=t.scales,s=Object.keys(i),f=e.context,m=f.scales[i[s[0]]].value,x=f.dataflow.locale();return function(O){return O.length?O[0].toUpperCase()+O.slice(1):O}(r)+(n?` titled '${n}'`:"")+` for ${function(O){return(O=O.map(T=>T+(T==="fill"||T==="stroke"?" color":""))).length<2?O[0]:O.slice(0,-1).join(", ")+" and "+Object(be.W)(O)}(s)} with ${qg(x,m,e)}`}},"title-text":{desc:"title",caption:e=>`Title text '${ae(e)}'`},"title-subtitle":{desc:"subtitle",caption:e=>`Subtitle text '${ae(e)}'`}},j={ariaRole:vn,ariaRoleDescription:p,description:cn};function V(e,t){const n=t.aria===!1;if(e(Qt,n||void 0),n||t.description==null)for(const r in j)e(j[r],void 0);else{const r=t.mark.marktype;e(cn,t.description),e(vn,t.ariaRole||(r==="group"?c:o)),e(p,t.ariaRoleDescription||`${r} mark`)}}function ne(e){return e.aria===!1?{[Qt]:!0}:g[e.role]?null:S[e.role]?function(t,n){try{const r=t.items[0],i=n.caption||(()=>"");return l(n.role||o,n.desc,r.description||i(r))}catch{return null}}(e,S[e.role]):function(t){const n=t.marktype,r=n==="group"||n==="text"||t.items.some(i=>i.description!=null&&i.aria!==!1);return l(r?c:o,`${n} mark container`,t.description)}(e)}function ae(e){return Object(be.i)(e.text).join(" ")}function me(e){try{return Object(be.i)(Object(be.W)(e.items).items[0].text).join(" ")}catch{return null}}const Ee=e=>(e+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),Se=e=>Ee(e).replace(/"/g,"&quot;").replace(/\t/g,"&#x9;").replace(/\n/g,"&#xA;").replace(/\r/g,"&#xD;");function Ne(){let e="",t="",n="";const r=[],i=()=>t=n="",s=(m,x)=>(x!=null&&(t+=` ${m}="${Se(x)}"`),f),f={open(m,...x){(O=>{t&&(e+=`${t}>${n}`,i()),r.push(O)})(m),t="<"+m;for(const O of x)for(const T in O)s(T,O[T]);return f},close(){const m=r.pop();return e+=t?t+(n?`>${n}</${m}>`:"/>"):`</${m}>`,i(),f},attr:s,text:m=>(n+=Ee(m),f),toString:()=>e};return f}const ze=e=>function t(n,r){if(n.open(r.tagName),r.hasAttributes()){const i=r.attributes,s=i.length;for(let f=0;f<s;++f)n.attr(i[f].name,i[f].value)}if(r.hasChildNodes()){const i=r.childNodes,s=i.length;for(let f=0;f<s;f++){const m=i[f];m.nodeType===3?n.text(m.nodeValue):t(n,m)}}return n.close()}(Ne(),e)+"",$e={fill:"fill",fillOpacity:"fill-opacity",stroke:"stroke",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",strokeCap:"stroke-linecap",strokeJoin:"stroke-linejoin",strokeDash:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeMiterLimit:"stroke-miterlimit",opacity:"opacity",blend:"mix-blend-mode"},qe={fill:"none","stroke-miterlimit":10},tt=Xa.xmlns;function lt(e){y.call(this,e),this._dirtyID=0,this._dirty=[],this._svg=null,this._root=null,this._defs=null}const ht=y.prototype;function vt(e,t){for(;e&&e.dirty!==t;e=e.mark.group){if(e.dirty=t,!e.mark||e.mark.dirty===t)return;e.mark.dirty=t}}function Ct(e,t,n){let r,i,s;if(t.gradient==="radial"){let f=Xu(e,n++,"pattern",tt);Xn(f,{id:cl+t.id,viewBox:"0,0,1,1",width:"100%",height:"100%",preserveAspectRatio:"xMidYMid slice"}),Xn(f=Xu(f,0,"rect",tt),{width:1,height:1,fill:`url(${sr()}#${t.id})`}),Xn(e=Xu(e,n++,"radialGradient",tt),{id:t.id,fx:t.x1,fy:t.y1,fr:t.r1,cx:t.x2,cy:t.y2,r:t.r2})}else Xn(e=Xu(e,n++,"linearGradient",tt),{id:t.id,x1:t.x1,x2:t.x2,y1:t.y1,y2:t.y2});for(r=0,i=t.stops.length;r<i;++r)(s=Xu(e,r,"stop",tt)).setAttribute("offset",t.stops[r].offset),s.setAttribute("stop-color",t.stops[r].color);return of(e,r),n}function Vt(e,t,n){return(e=Xu(e,n,"clipPath",tt)).setAttribute("id",t.id),t.path?Xu(e,0,"path",tt).setAttribute("d",t.path):Xn(Xu(e,0,"rect",tt),{x:0,y:0,width:t.width,height:t.height}),of(e,1),n+1}function Yt(e,t,n,r,i){let s,f=e._svg;if(!f&&(f=mc(s=t.ownerDocument,r,tt),e._svg=f,e.mark&&(f.__data__=e,f.__values__={fill:"default"},r==="g"))){const m=mc(s,"path",tt);f.appendChild(m),m.__data__=e;const x=mc(s,"g",tt);f.appendChild(x),x.__data__=e;const O=mc(s,"path",tt);f.appendChild(O),O.__data__=e,O.__values__={fill:"default"}}return(f.ownerSVGElement!==i||function(m,x){return m.parentNode&&m.parentNode.childNodes.length>1&&m.previousSibling!=x}(f,n))&&t.insertBefore(f,n?n.nextSibling:t.firstChild),f}Object(be.z)(lt,y,{initialize(e,t,n,r,i){return this._defs={},this._clearDefs(),e&&(this._svg=Xu(e,0,"svg",tt),this._svg.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns",tt),this._svg.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink",Xa["xmlns:xlink"]),this._svg.setAttribute("version",Xa.version),this._svg.setAttribute("class","marks"),of(e,1),this._root=Xu(this._svg,0,"g",tt),Xn(this._root,qe),of(this._svg,1)),this.background(this._bgcolor),ht.initialize.call(this,e,t,n,r,i)},background(e){return arguments.length&&this._svg&&this._svg.style.setProperty("background-color",e),ht.background.apply(this,arguments)},resize(e,t,n,r){return ht.resize.call(this,e,t,n,r),this._svg&&(Xn(this._svg,{width:this._width*this._scale,height:this._height*this._scale,viewBox:`0 0 ${this._width} ${this._height}`}),this._root.setAttribute("transform",`translate(${this._origin})`)),this._dirty=[],this},canvas(){return this._svg},svg(){const e=this._svg,t=this._bgcolor;if(!e)return null;let n;t&&(e.removeAttribute("style"),Xn(n=Xu(e,0,"rect",tt),{width:this._width,height:this._height,fill:t}));const r=ze(e);return t&&(e.removeChild(n),this._svg.style.setProperty("background-color",t)),r},_render(e){return this._dirtyCheck()&&(this._dirtyAll&&this._clearDefs(),this.mark(this._root,e),of(this._root,1)),this.defs(),this._dirty=[],++this._dirtyID,this},dirty(e){e.dirty!==this._dirtyID&&(e.dirty=this._dirtyID,this._dirty.push(e))},isDirty(e){return this._dirtyAll||!e._svg||e.dirty===this._dirtyID},_dirtyCheck(){this._dirtyAll=!0;const e=this._dirty;if(!e.length||!this._dirtyID)return!0;const t=++this._dirtyID;let n,r,i,s,f,m,x;for(f=0,m=e.length;f<m;++f)(r=(n=e[f]).mark).marktype!==i&&(i=r.marktype,s=gl[i]),r.zdirty&&r.dirty!==t&&(this._dirtyAll=!1,vt(n,t),r.items.forEach(O=>{O.dirty=t})),r.zdirty||(n.exit?(s.nested&&r.items.length?(x=r.items[0])._svg&&this._update(s,x._svg,x):n._svg&&(x=n._svg.parentNode)&&x.removeChild(n._svg),n._svg=null):(n=s.nested?r.items[0]:n)._update!==t&&(n._svg&&n._svg.ownerSVGElement?this._update(s,n._svg,n):(this._dirtyAll=!1,vt(n,t)),n._update=t));return!this._dirtyAll},mark(e,t,n){if(!this.isDirty(t))return t._svg;const r=this._svg,i=gl[t.marktype],s=t.interactive===!1?"none":null,f=i.tag==="g";let m=null,x=0;const O=Yt(t,e,n,"g",r);O.setAttribute("class",v(t));const T=ne(t);for(const H in T)er(O,H,T[H]);f||er(O,"pointer-events",s),er(O,"clip-path",t.clip?Mc(this,t,t.group):null);const M=H=>{const Z=this.isDirty(H),ue=Yt(H,O,m,i.tag,r);Z&&(this._update(i,ue,H),f&&function(fe,Ie,Pe){Ie=Ie.lastChild.previousSibling;let Le,rt=0;_n(Pe,it=>{Le=fe.mark(Ie,it,Le),++rt}),of(Ie,1+rt)}(this,ue,H)),m=ue,++x};return i.nested?t.items.length&&M(t.items[0]):_n(t,M),of(O,x),O},_update(e,t,n){qt=t,$t=t.__values__,V(On,n),e.attr(On,n,this);const r=yn[e.type];r&&r.call(this,e,t,n),qt&&this.style(qt,n)},style(e,t){if(t!=null)for(const n in $e){let r=n==="font"?ah(t):t[n];if(r===$t[n])continue;const i=$e[n];r==null?e.removeAttribute(i):(Jp(r)&&(r=Vm(r,this._defs.gradient,sr())),e.setAttribute(i,r+"")),$t[n]=r}},defs(){const e=this._svg,t=this._defs;let n=t.el,r=0;for(const i in t.gradient)n||(t.el=n=Xu(e,1,"defs",tt)),r=Ct(n,t.gradient[i],r);for(const i in t.clipping)n||(t.el=n=Xu(e,1,"defs",tt)),r=Vt(n,t.clipping[i],r);n&&(r===0?(e.removeChild(n),t.el=null):of(n,r))},_clearDefs(){const e=this._defs;e.gradient={},e.clipping={}}});let qt=null,$t=null;const yn={group(e,t,n){const r=qt=t.childNodes[2];$t=r.__values__,e.foreground(On,n,this),$t=t.__values__,qt=t.childNodes[1],e.content(On,n,this);const i=qt=t.childNodes[0];e.background(On,n,this);const s=n.mark.interactive===!1?"none":null;if(s!==$t.events&&(er(r,"pointer-events",s),er(i,"pointer-events",s),$t.events=s),n.strokeForeground&&n.stroke){const f=n.fill;er(r,"display",null),this.style(i,n),er(i,"stroke",null),f&&(n.fill=null),$t=r.__values__,this.style(r,n),f&&(n.fill=f),qt=null}else er(r,"display","none")},image(e,t,n){n.smooth===!1?(Cn(t,"image-rendering","optimizeSpeed"),Cn(t,"image-rendering","pixelated")):Cn(t,"image-rendering",null)},text(e,t,n){const r=Iu(n);let i,s,f,m;Object(be.B)(r)?(i=(s=r.map(x=>pl(n,x))).join(`
`))!==$t.text&&(of(t,0),f=t.ownerDocument,m=Ds(n),s.forEach((x,O)=>{const T=mc(f,"tspan",tt);T.__data__=n,T.textContent=x,O&&(T.setAttribute("x",0),T.setAttribute("dy",m)),t.appendChild(T)}),$t.text=i):(s=pl(n,r))!==$t.text&&(t.textContent=s,$t.text=s),er(t,"font-family",ah(n)),er(t,"font-size",Ku(n)+"px"),er(t,"font-style",n.fontStyle),er(t,"font-variant",n.fontVariant),er(t,"font-weight",n.fontWeight)}};function On(e,t,n){t!==$t[e]&&(n?function(r,i,s,f){s!=null?r.setAttributeNS(f,i,s):r.removeAttributeNS(f,i)}(qt,e,t,n):er(qt,e,t),$t[e]=t)}function Cn(e,t,n){n!==$t[t]&&(n==null?e.style.removeProperty(t):e.style.setProperty(t,n+""),$t[t]=n)}function Xn(e,t){for(const n in t)er(e,n,t[n])}function er(e,t,n){n!=null?e.setAttribute(t,n):e.removeAttribute(t)}function sr(){let e;return typeof window>"u"?"":(e=window.location).hash?e.href.slice(0,-e.hash.length):e.href}function lr(e){y.call(this,e),this._text=null,this._defs={gradient:{},clipping:{}}}Object(be.z)(lr,y,{svg(){return this._text},_render(e){const t=Ne();t.open("svg",Object(be.p)({},Xa,{class:"marks",width:this._width*this._scale,height:this._height*this._scale,viewBox:`0 0 ${this._width} ${this._height}`}));const n=this._bgcolor;return n&&n!=="transparent"&&n!=="none"&&t.open("rect",{width:this._width,height:this._height,fill:n}).close(),t.open("g",qe,{transform:"translate("+this._origin+")"}),this.mark(t,e),t.close(),this.defs(t),this._text=t.close()+"",this},mark(e,t){const n=gl[t.marktype],r=n.tag,i=[V,n.attr];e.open("g",{class:v(t),"clip-path":t.clip?Mc(this,t,t.group):null},ne(t),{"pointer-events":r!=="g"&&t.interactive===!1?"none":null});const s=f=>{const m=this.href(f);if(m&&e.open("a",m),e.open(r,this.attr(t,f,i,r!=="g"?r:null)),r==="text"){const x=Iu(f);if(Object(be.B)(x)){const O={x:0,dy:Ds(f)};for(let T=0;T<x.length;++T)e.open("tspan",T?O:null).text(pl(f,x[T])).close()}else e.text(pl(f,x))}else if(r==="g"){const x=f.strokeForeground,O=f.fill,T=f.stroke;x&&T&&(f.stroke=null),e.open("path",this.attr(t,f,n.background,"bgrect")).close(),e.open("g",this.attr(t,f,n.content)),_n(f,M=>this.mark(e,M)),e.close(),x&&T?(O&&(f.fill=null),f.stroke=T,e.open("path",this.attr(t,f,n.foreground,"bgrect")).close(),O&&(f.fill=O)):e.open("path",this.attr(t,f,n.foreground,"bgfore")).close()}e.close(),m&&e.close()};return n.nested?t.items&&t.items.length&&s(t.items[0]):_n(t,s),e.close()},href(e){const t=e.href;let n;if(t){if(n=this._hrefs&&this._hrefs[t])return n;this.sanitizeURL(t).then(r=>{r["xlink:href"]=r.href,r.href=null,(this._hrefs||(this._hrefs={}))[t]=r})}return null},attr(e,t,n,r){const i={},s=(f,m,x,O)=>{i[O||f]=m};return Array.isArray(n)?n.forEach(f=>f(s,t,this)):n(s,t,this),r&&function(f,m,x,O,T){if(m==null||(O==="bgrect"&&x.interactive===!1&&(f["pointer-events"]="none"),O==="bgfore"&&(x.interactive===!1&&(f["pointer-events"]="none"),f.display="none",m.fill!==null)))return f;O==="image"&&m.smooth===!1&&(f.style="image-rendering: optimizeSpeed; image-rendering: pixelated;"),O==="text"&&(f["font-family"]=ah(m),f["font-size"]=Ku(m)+"px",f["font-style"]=m.fontStyle,f["font-variant"]=m.fontVariant,f["font-weight"]=m.fontWeight);for(const M in $e){let H=m[M];const Z=$e[M];(H!=="transparent"||Z!=="fill"&&Z!=="stroke")&&H!=null&&(Jp(H)&&(H=Vm(H,T.gradient,"")),f[Z]=H)}}(i,t,e,r,this._defs),i},defs(e){const t=this._defs.gradient,n=this._defs.clipping;if(Object.keys(t).length+Object.keys(n).length!==0){e.open("defs");for(const r in t){const i=t[r],s=i.stops;i.gradient==="radial"?(e.open("pattern",{id:cl+r,viewBox:"0,0,1,1",width:"100%",height:"100%",preserveAspectRatio:"xMidYMid slice"}),e.open("rect",{width:"1",height:"1",fill:"url(#"+r+")"}).close(),e.close(),e.open("radialGradient",{id:r,fx:i.x1,fy:i.y1,fr:i.r1,cx:i.x2,cy:i.y2,r:i.r2})):e.open("linearGradient",{id:r,x1:i.x1,x2:i.x2,y1:i.y1,y2:i.y2});for(let f=0;f<s.length;++f)e.open("stop",{offset:s[f].offset,"stop-color":s[f].color}).close();e.close()}for(const r in n){const i=n[r];e.open("clipPath",{id:r}),i.path?e.open("path",{d:i.path}).close():e.open("rect",{x:0,y:0,width:i.width,height:i.height}).close(),e.close()}e.close()}}});const ur={Canvas:"canvas",PNG:"png",SVG:"svg",None:"none"},or={};function Er(e,t){return e=String(e||"").toLowerCase(),arguments.length>1?(or[e]=t,this):or[e]}function kr(e,t,n){const r=[],i=new Ka().union(t),s=e.marktype;return s?Ur(e,i,n,r):s==="group"?Zr(e,i,n,r):Object(be.o)("Intersect scene must be mark node or group item.")}function Ur(e,t,n,r){if(function(i,s,f){return i.bounds&&s.intersects(i.bounds)&&(i.marktype==="group"||i.interactive!==!1&&(!f||f(i)))}(e,t,n)){const i=e.items,s=e.marktype,f=i.length;let m=0;if(s==="group")for(;m<f;++m)Zr(i[m],t,n,r);else for(const x=gl[s].isect;m<f;++m){const O=i[m];mi(O,t,x)&&r.push(O)}}return r}function Zr(e,t,n,r){n&&n(e.mark)&&mi(e,t,gl.group.isect)&&r.push(e);const i=e.items,s=i&&i.length;if(s){const f=e.x||0,m=e.y||0;t.translate(-f,-m);for(let x=0;x<s;++x)Ur(i[x],t,n,r);t.translate(f,m)}return r}function mi(e,t,n){const r=e.bounds;return t.encloses(r)||t.intersects(r)&&n(e,t)}or.canvas=or.png={renderer:kt,headless:kt,handler:We},or.svg={renderer:lt,headless:lr,handler:Jt},or.none={};const co=new Ka;function lo(e){const t=e.clip;if(Object(be.E)(t))t(um(co.clear()));else{if(!t)return;co.set(0,0,e.group.width,e.group.height)}e.bounds.intersect(co)}const Eo=1e-9;function wo(e,t,n){return e===t||(n==="path"?Bo(e,t):e instanceof Date&&t instanceof Date?+e==+t:Object(be.G)(e)&&Object(be.G)(t)?Math.abs(e-t)<=Eo:e&&t&&(Object(be.H)(e)||Object(be.H)(t))?function(r,i){var s,f,m=Object.keys(r),x=Object.keys(i);if(m.length!==x.length)return!1;for(m.sort(),x.sort(),f=m.length-1;f>=0;f--)if(m[f]!=x[f])return!1;for(f=m.length-1;f>=0;f--)if(s=m[f],!wo(r[s],i[s],s))return!1;return typeof r==typeof i}(e,t):e==t)}function Bo(e,t){return wo(td(e),td(t))}function ta(){Zg(),Qf=0}const Pa="top",Xi="left",Co="right",Vo="bottom",au="top-left",js="top-right",Bs="bottom-left",hd="bottom-right",dd="start",kp="middle",mu="end",Qm="x",o0="y",pd="group",a0="axis",Ep="title",Ix="frame",Dv="scope",md="legend",Zy="row-header",Rx="row-footer",Mx="row-title",e1="column-header",t1="column-footer",n1="column-title",r5="padding",i5="symbol",jA="fit",o5="fit-x",a5="fit-y",s5="pad",qk="none",jx="all",Hk="each",$k="flush",Tv="column",Nv="row";function BA(e){Ot.call(this,null,e)}function Bx(e,t,n){return t(e.bounds.clear(),e,n)}Object(be.z)(BA,Ot,{transform(e,t){const n=t.dataflow,r=e.mark,i=r.marktype,s=gl[i],f=s.bound;let m,x=r.bounds;if(s.nested)r.items.length&&n.dirty(r.items[0]),x=Bx(r,f),r.items.forEach(O=>{O.bounds.clear().union(x)});else if(i===pd||e.modified())switch(t.visit(t.MOD,O=>n.dirty(O)),x.clear(),r.items.forEach(O=>x.union(Bx(O,f))),r.role){case a0:case md:case Ep:t.reflow()}else m=t.changed(t.REM),t.visit(t.ADD,O=>{x.union(Bx(O,f))}),t.visit(t.MOD,O=>{m=m||x.alignsWith(O.bounds),n.dirty(O),x.union(Bx(O,f))}),m&&(x.clear(),r.items.forEach(O=>x.union(O.bounds)));return lo(r),t.modifies("bounds")}});const PA=":vega_identifier:";function Gk(e){Ot.call(this,0,e)}function LA(e){Ot.call(this,null,e)}function zA(e){Ot.call(this,null,e)}Gk.Definition={type:"Identifier",metadata:{modifies:!0},params:[{name:"as",type:"string",required:!0}]},Object(be.z)(Gk,Ot,{transform(e,t){const n=function(s){return s._signals[PA]||(s._signals[PA]=s.add(0))}(t.dataflow),r=e.as;let i=n.value;return t.visit(t.ADD,s=>s[r]=s[r]||++i),n.set(this.value=i),t}}),Object(be.z)(LA,Ot,{transform(e,t){let n=this.value;n||((n=t.dataflow.scenegraph().mark(e.markdef,function(i){const s=i.groups,f=i.parent;return s&&s.size===1?s.get(Object.keys(s.object)[0]):s&&f?s.lookup(f):null}(e),e.index)).group.context=e.context,e.context.group||(e.context.group=n.group),n.source=this.source,n.clip=e.clip,n.interactive=e.interactive,this.value=n);const r=n.marktype===pd?gp:id;return t.visit(t.ADD,i=>r.call(i,n)),(e.modified("clip")||e.modified("interactive"))&&(n.clip=e.clip,n.interactive=!!e.interactive,n.zdirty=!0,t.reflow()),n.items=t.source,t}});const UA={parity:e=>e.filter((t,n)=>n%2?t.opacity=0:1),greedy:(e,t)=>{let n;return e.filter((r,i)=>i&&WA(n.bounds,r.bounds,t)?r.opacity=0:(n=r,1))}},WA=(e,t,n)=>n>Math.max(t.x1-e.x2,e.x1-t.x2,t.y1-e.y2,e.y1-t.y2),VA=(e,t)=>{for(var n,r=1,i=e.length,s=e[0].bounds;r<i;s=n,++r)if(WA(s,n=e[r].bounds,t))return!0},u5=e=>{const t=e.bounds;return t.width()>1&&t.height()>1},qA=e=>(e.forEach(t=>t.opacity=1),e),HA=(e,t)=>e.reflow(t.modified()).modifies("opacity");function $A(e){Ot.call(this,null,e)}Object(be.z)(zA,Ot,{transform(e,t){const n=UA[e.method]||UA.parity,r=e.separation||0;let i,s,f=t.materialize(t.SOURCE).source;if(!f||!f.length)return;if(!e.method)return e.modified("method")&&(qA(f),t=HA(t,e)),t;if(!(f=f.filter(u5)).length)return;if(e.sort&&(f=f.slice().sort(e.sort)),i=qA(f),t=HA(t,e),i.length>=3&&VA(i,r)){do i=n(i,r);while(i.length>=3&&VA(i,r));i.length<3&&!Object(be.W)(f).opacity&&(i.length>1&&(Object(be.W)(i).opacity=0),Object(be.W)(f).opacity=1)}e.boundScale&&e.boundTolerance>=0&&(s=((x,O,T)=>{var M=x.range(),H=new Ka;return O===Pa||O===Vo?H.set(M[0],-1/0,M[1],1/0):H.set(-1/0,M[0],1/0,M[1]),H.expand(T||1),Z=>H.encloses(Z.bounds)})(e.boundScale,e.boundOrient,+e.boundTolerance),f.forEach(x=>{s(x)||(x.opacity=0)}));const m=i[0].mark.bounds.clear();return f.forEach(x=>{x.opacity&&m.union(x.bounds)}),t}}),Object(be.z)($A,Ot,{transform(e,t){const n=t.dataflow;if(t.visit(t.ALL,r=>n.dirty(r)),t.fields&&t.fields.zindex){const r=t.source&&t.source[0];r&&(r.mark.zdirty=!0)}}});const af=new Ka;function r1(e,t,n){return e[t]===n?0:(e[t]=n,1)}function c5(e){var t=e.items[0].orient;return t===Xi||t===Co}function l5(e,t,n,r){var i,s,f=t.items[0],m=f.datum,x=f.translate!=null?f.translate:.5,O=f.orient,T=function(st){let mt=+st.grid;return[st.ticks?mt++:-1,st.labels?mt++:-1,mt+ +st.domain]}(m),M=f.range,H=f.offset,Z=f.position,ue=f.minExtent,fe=f.maxExtent,Ie=m.title&&f.items[T[2]].items[0],Pe=f.titlePadding,Le=f.bounds,rt=Ie&&ps(Ie),it=0,ut=0;switch(af.clear().union(Le),Le.clear(),(i=T[0])>-1&&Le.union(f.items[i].bounds),(i=T[1])>-1&&Le.union(f.items[i].bounds),O){case Pa:it=Z||0,ut=-H,s=Math.max(ue,Math.min(fe,-Le.y1)),Le.add(0,-s).add(M,0),Ie&&Px(e,Ie,s,Pe,rt,0,-1,Le);break;case Xi:it=-H,ut=Z||0,s=Math.max(ue,Math.min(fe,-Le.x1)),Le.add(-s,0).add(0,M),Ie&&Px(e,Ie,s,Pe,rt,1,-1,Le);break;case Co:it=n+H,ut=Z||0,s=Math.max(ue,Math.min(fe,Le.x2)),Le.add(0,0).add(s,M),Ie&&Px(e,Ie,s,Pe,rt,1,1,Le);break;case Vo:it=Z||0,ut=r+H,s=Math.max(ue,Math.min(fe,Le.y2)),Le.add(0,0).add(M,s),Ie&&Px(e,Ie,s,Pe,0,0,1,Le);break;default:it=f.x,ut=f.y}return Zl(Le.translate(it,ut),f),r1(f,"x",it+x)|r1(f,"y",ut+x)&&(f.bounds=af,e.dirty(f),f.bounds=Le,e.dirty(f)),f.mark.bounds.clear().union(Le)}function Px(e,t,n,r,i,s,f,m){const x=t.bounds;if(t.auto){const O=f*(n+i+r);let T=0,M=0;e.dirty(t),s?T=(t.x||0)-(t.x=O):M=(t.y||0)-(t.y=O),t.mark.bounds.clear().union(x.translate(-T,-M)),e.dirty(t)}m.union(x)}const GA=(e,t)=>Math.floor(Math.min(e,t)),KA=(e,t)=>Math.ceil(Math.max(e,t));function f5(e){return new Ka().set(0,0,e.width||0,e.height||0)}function h5(e){const t=e.bounds.clone();return t.empty()?t.set(0,0,0,0):t.translate(-(e.x||0),-(e.y||0))}function Qs(e,t,n){const r=Object(be.H)(e)?e[t]:e;return r??(n!==void 0?n:0)}function XA(e){return e<0?Math.ceil(-e):0}function YA(e,t,n){var r,i,s,f,m,x,O,T,M,H,Z,ue=!n.nodirty,fe=n.bounds===$k?f5:h5,Ie=af.set(0,0,0,0),Pe=Qs(n.align,Tv),Le=Qs(n.align,Nv),rt=Qs(n.padding,Tv),it=Qs(n.padding,Nv),ut=n.columns||t.length,st=ut<=0?1:Math.ceil(t.length/ut),mt=t.length,dt=Array(mt),en=Array(ut),mn=0,sn=Array(mt),In=Array(st),Fn=0,zn=Array(mt),Vn=Array(mt),Qn=Array(mt);for(i=0;i<ut;++i)en[i]=0;for(i=0;i<st;++i)In[i]=0;for(i=0;i<mt;++i)x=t[i],m=Qn[i]=fe(x),x.x=x.x||0,zn[i]=0,x.y=x.y||0,Vn[i]=0,s=i%ut,f=~~(i/ut),mn=Math.max(mn,O=Math.ceil(m.x2)),Fn=Math.max(Fn,T=Math.ceil(m.y2)),en[s]=Math.max(en[s],O),In[f]=Math.max(In[f],T),dt[i]=rt+XA(m.x1),sn[i]=it+XA(m.y1),ue&&e.dirty(t[i]);for(i=0;i<mt;++i)i%ut==0&&(dt[i]=0),i<ut&&(sn[i]=0);if(Pe===Hk)for(s=1;s<ut;++s){for(Z=0,i=s;i<mt;i+=ut)Z<dt[i]&&(Z=dt[i]);for(i=s;i<mt;i+=ut)dt[i]=Z+en[s-1]}else if(Pe===jx){for(Z=0,i=0;i<mt;++i)i%ut&&Z<dt[i]&&(Z=dt[i]);for(i=0;i<mt;++i)i%ut&&(dt[i]=Z+mn)}else for(Pe=!1,s=1;s<ut;++s)for(i=s;i<mt;i+=ut)dt[i]+=en[s-1];if(Le===Hk)for(f=1;f<st;++f){for(Z=0,r=(i=f*ut)+ut;i<r;++i)Z<sn[i]&&(Z=sn[i]);for(i=f*ut;i<r;++i)sn[i]=Z+In[f-1]}else if(Le===jx){for(Z=0,i=ut;i<mt;++i)Z<sn[i]&&(Z=sn[i]);for(i=ut;i<mt;++i)sn[i]=Z+Fn}else for(Le=!1,f=1;f<st;++f)for(r=(i=f*ut)+ut;i<r;++i)sn[i]+=In[f-1];for(M=0,i=0;i<mt;++i)M=dt[i]+(i%ut?M:0),zn[i]+=M-t[i].x;for(s=0;s<ut;++s)for(H=0,i=s;i<mt;i+=ut)H+=sn[i],Vn[i]+=H-t[i].y;if(Pe&&Qs(n.center,Tv)&&st>1)for(i=0;i<mt;++i)(M=(m=Pe===jx?mn:en[i%ut])-Qn[i].x2-t[i].x-zn[i])>0&&(zn[i]+=M/2);if(Le&&Qs(n.center,Nv)&&ut!==1)for(i=0;i<mt;++i)(H=(m=Le===jx?Fn:In[~~(i/ut)])-Qn[i].y2-t[i].y-Vn[i])>0&&(Vn[i]+=H/2);for(i=0;i<mt;++i)Ie.union(Qn[i].translate(zn[i],Vn[i]));switch(M=Qs(n.anchor,Qm),H=Qs(n.anchor,o0),Qs(n.anchor,Tv)){case mu:M-=Ie.width();break;case kp:M-=Ie.width()/2}switch(Qs(n.anchor,Nv)){case mu:H-=Ie.height();break;case kp:H-=Ie.height()/2}for(M=Math.round(M),H=Math.round(H),Ie.clear(),i=0;i<mt;++i)t[i].mark.bounds.clear();for(i=0;i<mt;++i)(x=t[i]).x+=zn[i]+=M,x.y+=Vn[i]+=H,Ie.union(x.mark.bounds.union(x.bounds.translate(zn[i],Vn[i]))),ue&&e.dirty(x);return Ie}function d5(e,t,n){var r,i,s,f,m,x,O,T=function(Le){var rt,it,ut=Le.items,st=ut.length,mt=0;const dt={marks:[],rowheaders:[],rowfooters:[],colheaders:[],colfooters:[],rowtitle:null,coltitle:null};for(;mt<st;++mt)if(it=(rt=ut[mt]).items,rt.marktype===pd)switch(rt.role){case a0:case md:case Ep:break;case Zy:dt.rowheaders.push(...it);break;case Rx:dt.rowfooters.push(...it);break;case e1:dt.colheaders.push(...it);break;case t1:dt.colfooters.push(...it);break;case Mx:dt.rowtitle=it[0];break;case n1:dt.coltitle=it[0];break;default:dt.marks.push(...it)}return dt}(t),M=T.marks,H=n.bounds===$k?p5:m5,Z=n.offset,ue=n.columns||M.length,fe=ue<=0?1:Math.ceil(M.length/ue),Ie=fe*ue;const Pe=YA(e,M,n);Pe.empty()&&Pe.set(0,0,0,0),T.rowheaders&&(x=Qs(n.headerBand,Nv,null),r=Lx(e,T.rowheaders,M,ue,fe,-Qs(Z,"rowHeader"),GA,0,H,"x1",0,ue,1,x)),T.colheaders&&(x=Qs(n.headerBand,Tv,null),i=Lx(e,T.colheaders,M,ue,ue,-Qs(Z,"columnHeader"),GA,1,H,"y1",0,1,ue,x)),T.rowfooters&&(x=Qs(n.footerBand,Nv,null),s=Lx(e,T.rowfooters,M,ue,fe,Qs(Z,"rowFooter"),KA,0,H,"x2",ue-1,ue,1,x)),T.colfooters&&(x=Qs(n.footerBand,Tv,null),f=Lx(e,T.colfooters,M,ue,ue,Qs(Z,"columnFooter"),KA,1,H,"y2",Ie-ue,1,ue,x)),T.rowtitle&&(m=Qs(n.titleAnchor,Nv),O=Qs(Z,"rowTitle"),O=m===mu?s+O:r-O,x=Qs(n.titleBand,Nv,.5),JA(e,T.rowtitle,O,0,Pe,x)),T.coltitle&&(m=Qs(n.titleAnchor,Tv),O=Qs(Z,"columnTitle"),O=m===mu?f+O:i-O,x=Qs(n.titleBand,Tv,.5),JA(e,T.coltitle,O,1,Pe,x))}function p5(e,t){return t==="x1"?e.x||0:t==="y1"?e.y||0:t==="x2"?(e.x||0)+(e.width||0):t==="y2"?(e.y||0)+(e.height||0):void 0}function m5(e,t){return e.bounds[t]}function Lx(e,t,n,r,i,s,f,m,x,O,T,M,H,Z){var ue,fe,Ie,Pe,Le,rt,it,ut,st,mt=n.length,dt=0,en=0;if(!mt)return dt;for(ue=T;ue<mt;ue+=M)n[ue]&&(dt=f(dt,x(n[ue],O)));if(!t.length)return dt;for(t.length>i&&(e.warn("Grid headers exceed limit: "+i),t=t.slice(0,i)),dt+=s,fe=0,Pe=t.length;fe<Pe;++fe)e.dirty(t[fe]),t[fe].mark.bounds.clear();for(ue=T,fe=0,Pe=t.length;fe<Pe;++fe,ue+=M){for(Le=(rt=t[fe]).mark.bounds,Ie=ue;Ie>=0&&(it=n[Ie])==null;Ie-=H);m?(ut=Z==null?it.x:Math.round(it.bounds.x1+Z*it.bounds.width()),st=dt):(ut=dt,st=Z==null?it.y:Math.round(it.bounds.y1+Z*it.bounds.height())),Le.union(rt.bounds.translate(ut-(rt.x||0),st-(rt.y||0))),rt.x=ut,rt.y=st,e.dirty(rt),en=f(en,Le[O])}return en}function JA(e,t,n,r,i,s){if(t){e.dirty(t);var f=n,m=n;r?f=Math.round(i.x1+s*i.width()):m=Math.round(i.y1+s*i.height()),t.bounds.translate(f-(t.x||0),m-(t.y||0)),t.mark.bounds.clear().union(t.bounds),t.x=f,t.y=m,e.dirty(t)}}function g5(e,t,n,r,i,s,f){const m=function(H,Z){const ue=H[Z]||{};return(fe,Ie)=>ue[fe]!=null?ue[fe]:H[fe]!=null?H[fe]:Ie}(n,t),x=function(H,Z){let ue=-1/0;return H.forEach(fe=>{fe.offset!=null&&(ue=Math.max(ue,fe.offset))}),ue>-1/0?ue:Z}(e,m("offset",0)),O=m("anchor",dd),T=O===mu?1:O===kp?.5:0,M={align:Hk,bounds:m("bounds",$k),columns:m("direction")==="vertical"?1:e.length,padding:m("margin",8),center:m("center"),nodirty:!0};switch(t){case Xi:M.anchor={x:Math.floor(r.x1)-x,column:mu,y:T*(f||r.height()+2*r.y1),row:O};break;case Co:M.anchor={x:Math.ceil(r.x2)+x,y:T*(f||r.height()+2*r.y1),row:O};break;case Pa:M.anchor={y:Math.floor(i.y1)-x,row:mu,x:T*(s||i.width()+2*i.x1),column:O};break;case Vo:M.anchor={y:Math.ceil(i.y2)+x,x:T*(s||i.width()+2*i.x1),column:O};break;case au:M.anchor={x,y:x};break;case js:M.anchor={x:s-x,y:x,column:mu};break;case Bs:M.anchor={x,y:f-x,row:mu};break;case hd:M.anchor={x:s-x,y:f-x,column:mu,row:mu}}return M}function v5(e,t){var n,r,i=t.items[0],s=i.datum,f=i.orient,m=i.bounds,x=i.x,O=i.y;return i._bounds?i._bounds.clear().union(m):i._bounds=m.clone(),m.clear(),function(T,M,H){var Z=M.padding,ue=Z-H.x,fe=Z-H.y;if(M.datum.title){var Ie=M.items[1].items[0],Pe=Ie.anchor,Le=M.titlePadding||0,rt=Z-Ie.x,it=Z-Ie.y;switch(Ie.orient){case Xi:ue+=Math.ceil(Ie.bounds.width())+Le;break;case Co:case Vo:break;default:fe+=Ie.bounds.height()+Le}switch((ue||fe)&&$1(T,H,ue,fe),Ie.orient){case Xi:it+=i1(M,H,Ie,Pe,1,1);break;case Co:rt+=i1(M,H,Ie,mu,0,0)+Le,it+=i1(M,H,Ie,Pe,1,1);break;case Vo:rt+=i1(M,H,Ie,Pe,0,0),it+=i1(M,H,Ie,mu,-1,0,1)+Le;break;default:rt+=i1(M,H,Ie,Pe,0,0)}(rt||it)&&$1(T,Ie,rt,it),(rt=Math.round(Ie.bounds.x1-Z))<0&&($1(T,H,-rt,0),$1(T,Ie,-rt,0))}else(ue||fe)&&$1(T,H,ue,fe)}(e,i,i.items[0].items[0]),m=function(T,M){return T.items.forEach(H=>M.union(H.bounds)),M.x1=T.padding,M.y1=T.padding,M}(i,m),n=2*i.padding,r=2*i.padding,m.empty()||(n=Math.ceil(m.width()+n),r=Math.ceil(m.height()+r)),s.type===i5&&function(T){const M=T.reduce((H,Z)=>(H[Z.column]=Math.max(Z.bounds.x2-Z.x,H[Z.column]||0),H),{});T.forEach(H=>{H.width=M[H.column],H.height=H.bounds.y2-H.y})}(i.items[0].items[0].items[0].items),f!==qk&&(i.x=x=0,i.y=O=0),i.width=n,i.height=r,Zl(m.set(x,O,x+n,O+r),i),i.mark.bounds.clear().union(m),i}function i1(e,t,n,r,i,s,f){const m=e.datum.type!=="symbol",x=n.datum.vgrad,O=(!m||!s&&x||f?t:t.items[0]).bounds[i?"y2":"x2"]-e.padding,T=x&&s?O:0,M=x&&s?0:O,H=i<=0?0:ps(n);return Math.round(r===dd?T:r===mu?M-H:.5*(O-H))}function $1(e,t,n,r){t.x+=n,t.y+=r,t.bounds.translate(n,r),t.mark.bounds.translate(n,r),e.dirty(t)}function QA(e){Ot.call(this,null,e)}function ZA(e,t){let n=0;if(t===void 0)for(let r of e)(r=+r)&&(n+=r);else{let r=-1;for(let i of e)(i=+t(i,++r,e))&&(n+=i)}return n}function eS(e){Ot.call(this,null,e)}function tS(e){Ot.call(this,null,e)}function y5(){return Dn({})}function nS(e){Ot.call(this,null,e)}function rS(e){Ot.call(this,[],e)}Object(be.z)(QA,Ot,{transform(e,t){const n=t.dataflow;return e.mark.items.forEach(r=>{e.layout&&d5(n,r,e.layout),function(i,s,f){var m,x,O,T,M,H=s.items,Z=Math.max(0,s.width||0),ue=Math.max(0,s.height||0),fe=new Ka().set(0,0,Z,ue),Ie=fe.clone(),Pe=fe.clone(),Le=[];for(T=0,M=H.length;T<M;++T)switch((x=H[T]).role){case a0:(c5(x)?Ie:Pe).union(l5(i,x,Z,ue));break;case Ep:m=x;break;case md:Le.push(v5(i,x));break;case Ix:case Dv:case Zy:case Rx:case Mx:case e1:case t1:case n1:Ie.union(x.bounds),Pe.union(x.bounds);break;default:fe.union(x.bounds)}if(Le.length){const rt={};Le.forEach(it=>{(O=it.orient||Co)!==qk&&(rt[O]||(rt[O]=[])).push(it)});for(const it in rt){const ut=rt[it];YA(i,ut,g5(ut,it,f.legends,Ie,Pe,Z,ue))}Le.forEach(it=>{const ut=it.bounds;if(ut.equals(it._bounds)||(it.bounds=it._bounds,i.dirty(it),it.bounds=ut,i.dirty(it)),f.autosize&&f.autosize.type===jA)switch(it.orient){case Xi:case Co:fe.add(ut.x1,0).add(ut.x2,0);break;case Pa:case Vo:fe.add(0,ut.y1).add(0,ut.y2)}else fe.union(ut)})}fe.union(Ie).union(Pe),m&&fe.union(function(rt,it,ut,st,mt){var dt,en=it.items[0],mn=en.frame,sn=en.orient,In=en.anchor,Fn=en.offset,zn=en.padding,Vn=en.items[0].items[0],Qn=en.items[1]&&en.items[1].items[0],mr=sn===Xi||sn===Co?st:ut,Pr=0,Cr=0,Jr=0,gi=0,vi=0;if(mn!==pd?sn===Xi?(Pr=mt.y2,mr=mt.y1):sn===Co?(Pr=mt.y1,mr=mt.y2):(Pr=mt.x1,mr=mt.x2):sn===Xi&&(Pr=st,mr=0),dt=In===dd?Pr:In===mu?mr:(Pr+mr)/2,Qn&&Qn.text){switch(sn){case Pa:case Vo:vi=Vn.bounds.height()+zn;break;case Xi:gi=Vn.bounds.width()+zn;break;case Co:gi=-Vn.bounds.width()-zn}af.clear().union(Qn.bounds),af.translate(gi-(Qn.x||0),vi-(Qn.y||0)),r1(Qn,"x",gi)|r1(Qn,"y",vi)&&(rt.dirty(Qn),Qn.bounds.clear().union(af),Qn.mark.bounds.clear().union(af),rt.dirty(Qn)),af.clear().union(Qn.bounds)}else af.clear();switch(af.union(Vn.bounds),sn){case Pa:Cr=dt,Jr=mt.y1-af.height()-Fn;break;case Xi:Cr=mt.x1-af.width()-Fn,Jr=dt;break;case Co:Cr=mt.x2+af.width()+Fn,Jr=dt;break;case Vo:Cr=dt,Jr=mt.y2+Fn;break;default:Cr=en.x,Jr=en.y}return r1(en,"x",Cr)|r1(en,"y",Jr)&&(af.translate(Cr,Jr),rt.dirty(en),en.bounds.clear().union(af),it.bounds.clear().union(af),rt.dirty(en)),en.bounds}(i,m,Z,ue,fe)),s.clip&&fe.set(0,0,s.width||0,s.height||0),function(rt,it,ut,st){const mt=st.autosize||{},dt=mt.type;if(rt._autosize<1||!dt)return;let en=rt._width,mn=rt._height,sn=Math.max(0,it.width||0),In=Math.max(0,Math.ceil(-ut.x1)),Fn=Math.max(0,it.height||0),zn=Math.max(0,Math.ceil(-ut.y1));const Vn=Math.max(0,Math.ceil(ut.x2-sn)),Qn=Math.max(0,Math.ceil(ut.y2-Fn));if(mt.contains===r5){const mr=rt.padding();en-=mr.left+mr.right,mn-=mr.top+mr.bottom}dt===qk?(In=0,zn=0,sn=en,Fn=mn):dt===jA?(sn=Math.max(0,en-In-Vn),Fn=Math.max(0,mn-zn-Qn)):dt===o5?(sn=Math.max(0,en-In-Vn),mn=Fn+zn+Qn):dt===a5?(en=sn+In+Vn,Fn=Math.max(0,mn-zn-Qn)):dt===s5&&(en=sn+In+Vn,mn=Fn+zn+Qn),rt._resizeView(en,mn,sn,Fn,[In,zn],mt.resize)}(i,s,fe,f)}(n,r,e)}),function(r){return r&&r.mark.role!=="legend-entry"}(e.mark.group)?t.reflow():t}}),Object(be.z)(eS,Ot,{transform(e,t){if(this.value&&!e.modified())return t.StopPropagation;var n=t.dataflow.locale(),r=t.fork(t.NO_SOURCE|t.NO_FIELDS),i=this.value,s=e.scale,f=up(s,e.count==null?e.values?e.values.length:10:e.count,e.minstep),m=e.format||Pg(n,s,f,e.formatSpecifier,e.formatType,!!e.values),x=e.values?Bg(s,e.values,f):Xl(s,f);return i&&(r.rem=i),i=x.map((O,T)=>Dn({index:T/(x.length-1||1),value:O,label:m(O)})),e.extra&&i.length&&i.push(Dn({index:-1,extra:{value:i[0].value},label:""})),r.source=i,r.add=i,this.value=i,r}}),Object(be.z)(tS,Ot,{transform(e,t){var n=t.dataflow,r=t.fork(t.NO_SOURCE|t.NO_FIELDS),i=e.item||y5,s=e.key||Zt,f=this.value;return Object(be.B)(r.encode)&&(r.encode=null),f&&(e.modified("key")||t.modified(s))&&Object(be.o)("DataJoin does not support modified key function or fields."),f||(t=t.addAll(),this.value=f=function(m){const x=Object(be.t)().test(O=>O.exit);return x.lookup=O=>x.get(m(O)),x}(s)),t.visit(t.ADD,m=>{const x=s(m);let O=f.get(x);O?O.exit?(f.empty--,r.add.push(O)):r.mod.push(O):(O=i(m),f.set(x,O),r.add.push(O)),O.datum=m,O.exit=!1}),t.visit(t.MOD,m=>{const x=s(m),O=f.get(x);O&&(O.datum=m,r.mod.push(O))}),t.visit(t.REM,m=>{const x=s(m),O=f.get(x);m!==O.datum||O.exit||(r.rem.push(O),O.exit=!0,++f.empty)}),t.changed(t.ADD_MOD)&&r.modifies("datum"),(t.clean()||e.clean&&f.empty>n.cleanThreshold)&&n.runAfter(f.clean),r}}),Object(be.z)(nS,Ot,{transform(e,t){var n=t.fork(t.ADD_REM),r=e.mod||!1,i=e.encoders,s=t.encode;if(Object(be.B)(s)){if(!n.changed()&&!s.every(M=>i[M]))return t.StopPropagation;s=s[0],n.encode=null}var f=s==="enter",m=i.update||be.s,x=i.enter||be.s,O=i.exit||be.s,T=(s&&!f?i[s]:m)||be.s;if(t.changed(t.ADD)&&(t.visit(t.ADD,M=>{x(M,e),m(M,e)}),n.modifies(x.output),n.modifies(m.output),T!==be.s&&T!==m&&(t.visit(t.ADD,M=>{T(M,e)}),n.modifies(T.output))),t.changed(t.REM)&&O!==be.s&&(t.visit(t.REM,M=>{O(M,e)}),n.modifies(O.output)),f||T!==be.s){const M=t.MOD|(e.modified()?t.REFLOW:0);f?(t.visit(M,H=>{const Z=x(H,e)||r;(T(H,e)||Z)&&n.mod.push(H)}),n.mod.length&&n.modifies(x.output)):t.visit(M,H=>{(T(H,e)||r)&&n.mod.push(H)}),n.mod.length&&n.modifies(T.output)}return n.changed()?n:t.StopPropagation}}),Object(be.z)(rS,Ot,{transform(e,t){if(this.value!=null&&!e.modified())return t.StopPropagation;var n,r,i,s,f,m=t.dataflow.locale(),x=t.fork(t.NO_SOURCE|t.NO_FIELDS),O=this.value,T=e.type||Xp,M=e.scale,H=+e.limit,Z=up(M,e.count==null?5:e.count,e.minstep),ue=!!e.values||T===Xp,fe=e.format||Ug(m,M,Z,T,e.formatSpecifier,e.formatType,ue),Ie=e.values||zg(M,Z);return O&&(x.rem=O),T===Xp?(H&&Ie.length>H?(t.dataflow.warn("Symbol legend count exceeds limit, filtering items."),O=Ie.slice(0,H-1),f=!0):O=Ie,Object(be.E)(i=e.size)?(e.values||M(O[0])!==0||(O=O.slice(1)),s=O.reduce((Pe,Le)=>Math.max(Pe,i(Le,e)),0)):i=Object(be.m)(s=i||8),O=O.map((Pe,Le)=>Dn({index:Le,label:fe(Pe,Le,O),value:Pe,offset:s,size:i(Pe,e)})),f&&(f=Ie[O.length],O.push(Dn({index:O.length,label:"".concat(Ie.length-O.length," entries"),value:f,offset:s,size:i(f,e)})))):T==="gradient"?(n=M.domain(),r=Zh(M,n[0],Object(be.W)(n)),Ie.length<3&&!e.values&&n[0]!==Object(be.W)(n)&&(Ie=[n[0],Object(be.W)(n)]),O=Ie.map((Pe,Le)=>Dn({index:Le,label:fe(Pe,Le,Ie),value:Pe,perc:r(Pe)}))):(i=Ie.length-1,r=function(Pe){const Le=Pe.domain(),rt=Le.length-1;let it=+Le[0],ut=+Object(be.W)(Le),st=ut-it;if(Pe.type===Nc){const mt=rt?st/rt:.1;st=(ut+=mt)-(it-=mt)}return mt=>(mt-it)/st}(M),O=Ie.map((Pe,Le)=>Dn({index:Le,label:fe(Pe,Le,Ie),value:Pe,perc:Le?r(Pe):0,perc2:Le===i?1:r(Ie[Le+1])}))),x.source=O,x.add=O,this.value=O,x}});const b5=e=>e.source.x,x5=e=>e.source.y,w5=e=>e.target.x,k5=e=>e.target.y;function Kk(e){Ot.call(this,{},e)}Kk.Definition={type:"LinkPath",metadata:{modifies:!0},params:[{name:"sourceX",type:"field",default:"source.x"},{name:"sourceY",type:"field",default:"source.y"},{name:"targetX",type:"field",default:"target.x"},{name:"targetY",type:"field",default:"target.y"},{name:"orient",type:"enum",default:"vertical",values:["horizontal","vertical","radial"]},{name:"shape",type:"enum",default:"line",values:["line","arc","curve","diagonal","orthogonal"]},{name:"require",type:"signal"},{name:"as",type:"string",default:"path"}]},Object(be.z)(Kk,Ot,{transform(e,t){var n=e.sourceX||b5,r=e.sourceY||x5,i=e.targetX||w5,s=e.targetY||k5,f=e.as||"path",m=e.orient||"vertical",x=e.shape||"line",O=sS.get(x+"-"+m)||sS.get(x);return O||Object(be.o)("LinkPath unsupported type: "+e.shape+(e.orient?"-"+e.orient:"")),t.visit(t.SOURCE,T=>{T[f]=O(n(T),r(T),i(T),s(T))}),t.reflow(e.modified()).modifies(f)}});const iS=(e,t,n,r)=>"M"+e+","+t+"L"+n+","+r,oS=(e,t,n,r)=>{var i=n-e,s=r-t,f=Math.sqrt(i*i+s*s)/2;return"M"+e+","+t+"A"+f+","+f+" "+180*Math.atan2(s,i)/Math.PI+" 0 1 "+n+","+r},aS=(e,t,n,r)=>{const i=n-e,s=r-t,f=.2*(i+s),m=.2*(s-i);return"M"+e+","+t+"C"+(e+f)+","+(t+m)+" "+(n+m)+","+(r-f)+" "+n+","+r},sS=Object(be.t)({line:iS,"line-radial":(e,t,n,r)=>iS(t*Math.cos(e),t*Math.sin(e),r*Math.cos(n),r*Math.sin(n)),arc:oS,"arc-radial":(e,t,n,r)=>oS(t*Math.cos(e),t*Math.sin(e),r*Math.cos(n),r*Math.sin(n)),curve:aS,"curve-radial":(e,t,n,r)=>aS(t*Math.cos(e),t*Math.sin(e),r*Math.cos(n),r*Math.sin(n)),"orthogonal-horizontal":(e,t,n,r)=>"M"+e+","+t+"V"+r+"H"+n,"orthogonal-vertical":(e,t,n,r)=>"M"+e+","+t+"H"+n+"V"+r,"orthogonal-radial":(e,t,n,r)=>{const i=Math.cos(e),s=Math.sin(e),f=Math.cos(n),m=Math.sin(n);return"M"+t*i+","+t*s+"A"+t+","+t+" 0 0,"+((Math.abs(n-e)>Math.PI?n<=e:n>e)?1:0)+" "+t*f+","+t*m+"L"+r*f+","+r*m},"diagonal-horizontal":(e,t,n,r)=>{const i=(e+n)/2;return"M"+e+","+t+"C"+i+","+t+" "+i+","+r+" "+n+","+r},"diagonal-vertical":(e,t,n,r)=>{const i=(t+r)/2;return"M"+e+","+t+"C"+e+","+i+" "+n+","+i+" "+n+","+r},"diagonal-radial":(e,t,n,r)=>{const i=Math.cos(e),s=Math.sin(e),f=Math.cos(n),m=Math.sin(n),x=(t+r)/2;return"M"+t*i+","+t*s+"C"+x*i+","+x*s+" "+x*f+","+x*m+" "+r*f+","+r*m}});function Xk(e){Ot.call(this,null,e)}Xk.Definition={type:"Pie",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"startAngle",type:"number",default:0},{name:"endAngle",type:"number",default:6.283185307179586},{name:"sort",type:"boolean",default:!1},{name:"as",type:"string",array:!0,length:2,default:["startAngle","endAngle"]}]},Object(be.z)(Xk,Ot,{transform(e,t){var n,r,i,s=e.as||["startAngle","endAngle"],f=s[0],m=s[1],x=e.field||be.Q,O=e.startAngle||0,T=e.endAngle!=null?e.endAngle:2*Math.PI,M=t.source,H=M.map(x),Z=H.length,ue=O,fe=(T-O)/ZA(H),Ie=ys(Z);for(e.sort&&Ie.sort((Pe,Le)=>H[Pe]-H[Le]),n=0;n<Z;++n)i=H[Ie[n]],(r=M[Ie[n]])[f]=ue,r[m]=ue+=i*fe;return this.value=H,t.reflow(e.modified()).modifies(s)}});const E5=5;function uS(e){return Xf(e)&&e!==Nu}const C5=Object(be.Fa)(["set","modified","clear","type","scheme","schemeExtent","schemeCount","domain","domainMin","domainMid","domainMax","domainRaw","domainImplicit","nice","zero","bins","range","rangeStep","round","reverse","interpolate","interpolateGamma"]);function cS(e){Ot.call(this,null,e),this.modified(!0)}function lS(e,t,n){return Vp(e)&&Math.abs(t.reduce((r,i)=>r+(i<0?-1:i>0?1:0),0))!==t.length&&n.warn("Log scale domain includes zero: "+Object(be.Ba)(t)),t}function fS(e,t,n){return Object(be.E)(e)&&(t||n)?$p(e,Yk(t||[0,1],n)):e}function Yk(e,t){return t?e.slice().reverse():e}function hS(e){Ot.call(this,null,e)}Object(be.z)(cS,Ot,{transform(e,t){var n=t.dataflow,r=this.value,i=function(s){var f,m=s.type,x="";return m===Nu?Nu+"-"+Hl:(function(O){const T=O.type;return Xf(T)&&T!==$l&&T!==Gl&&(O.scheme||O.range&&O.range.length&&O.range.every(be.J))}(s)&&(f=s.rawDomain?s.rawDomain.length:s.domain?s.domain.length+ +(s.domainMid!=null):0,x=f===2?Nu+"-":f===3?Jh+"-":""),(x+m||Hl).toLowerCase())}(e);for(i in r&&i===r.type||(this.value=r=Ro(i)()),e)if(!C5[i]){if(i==="padding"&&uS(r.type))continue;Object(be.E)(r[i])?r[i](e[i]):n.warn("Unsupported scale property: "+i)}return function(s,f,m){var x=s.type,O=f.round||!1,T=f.range;if(f.rangeStep!=null)T=function(M,H,Z){M!==Kf&&M!==Up&&Object(be.o)("Only band and point scales support rangeStep.");var ue=(H.paddingOuter!=null?H.paddingOuter:H.padding)||0,fe=M===Up?1:(H.paddingInner!=null?H.paddingInner:H.padding)||0;return[0,H.rangeStep*zp(Z,fe,ue)]}(x,f,m);else if(f.scheme&&(T=function(M,H,Z){var ue,fe,Ie=H.schemeExtent;return Object(be.B)(H.scheme)?fe=Kl(H.scheme,H.interpolate,H.interpolateGamma):(ue=H.scheme.toLowerCase(),(fe=zm(ue))||Object(be.o)("Unrecognized scheme name: ".concat(H.scheme))),Z=M===Nc?Z+1:M===Fc?Z-1:M===$f||M===al?+H.schemeCount||E5:Z,qp(M)?fS(fe,Ie,H.reverse):Object(be.E)(fe)?Gp(fS(fe,Ie),Z):M===Gf?fe:fe.slice(0,Z)}(x,f,m),Object(be.E)(T))){if(s.interpolator)return s.interpolator(T);Object(be.o)("Scale type ".concat(x," does not support interpolating color schemes."))}if(T&&qp(x))return s.interpolator(Kl(Yk(T,f.reverse),f.interpolate,f.interpolateGamma));T&&f.interpolate&&s.interpolate?s.interpolate(Kp(f.interpolate,f.interpolateGamma)):Object(be.E)(s.round)?s.round(O):Object(be.E)(s.rangeRound)&&s.interpolate(O?Qo:aa),T&&s.range(Yk(T,f.reverse))}(r,e,function(s,f,m){let x=f.bins;if(x&&!Object(be.B)(x)){const O=s.domain(),T=O[0],M=Object(be.W)(O),H=x.step;let Z=x.start==null?T:x.start,ue=x.stop==null?M:x.stop;H||Object(be.o)("Scale bins parameter missing step property."),Z<T&&(Z=H*Math.ceil(T/H)),ue>M&&(ue=H*Math.floor(M/H)),x=ys(Z,ue+H/2,H)}return x?s.bins=x:s.bins&&delete s.bins,s.type===Fc&&(x?f.domain||f.domainRaw||(s.domain(x),m=x.length):s.bins=s.domain()),m}(r,e,function(s,f,m){const x=function(ue,fe,Ie){return fe?(ue.domain(lS(ue.type,fe,Ie)),fe.length):-1}(s,f.domainRaw,m);if(x>-1)return x;var O,T,M=f.domain,H=s.type,Z=f.zero||f.zero===void 0&&function(ue){const fe=ue.type;return!ue.bins&&(fe===Hl||fe===rp||fe===Yh)}(s);if(!M)return 0;if(uS(H)&&f.padding&&M[0]!==Object(be.W)(M)&&(M=function(ue,fe,Ie,Pe,Le,rt){var it=Math.abs(Object(be.W)(Ie)-Ie[0]),ut=it/(it-2*Pe),st=ue===ol?Object(be.Oa)(fe,null,ut):ue===Yh?Object(be.Pa)(fe,null,ut,.5):ue===rp?Object(be.Pa)(fe,null,ut,Le||1):ue===Hf?Object(be.Qa)(fe,null,ut,rt||1):Object(be.Na)(fe,null,ut);return(fe=fe.slice())[0]=st[0],fe[fe.length-1]=st[1],fe}(H,M,f.range,f.padding,f.exponent,f.constant)),(Z||f.domainMin!=null||f.domainMax!=null||f.domainMid!=null)&&(O=(M=M.slice()).length-1||1,Z&&(M[0]>0&&(M[0]=0),M[O]<0&&(M[O]=0)),f.domainMin!=null&&(M[0]=f.domainMin),f.domainMax!=null&&(M[O]=f.domainMax),f.domainMid!=null)){const ue=(T=f.domainMid)>M[O]?O+1:T<M[0]?0:O;ue!==O&&m.warn("Scale domainMid exceeds domain min or max.",T),M.splice(ue,0,T)}return s.domain(lS(H,M,m)),H===Gf&&s.unknown(f.domainImplicit?qu:void 0),f.nice&&s.nice&&s.nice(f.nice!==!0&&up(s,f.nice)||null),M.length}(r,e,n))),t.fork(t.NO_SOURCE|t.NO_FIELDS)}}),Object(be.z)(hS,Ot,{transform(e,t){const n=e.modified("sort")||t.changed(t.ADD)||t.modified(e.sort.fields)||t.modified("datum");return n&&t.source.sort(Qr(e.sort)),this.modified(n),t}});const dS=["y0","y1"];function Jk(e){Ot.call(this,null,e)}function O5(e,t,n,r,i){for(var s,f=(t-e.sum)/2,m=e.length,x=0;x<m;++x)(s=e[x])[r]=f,s[i]=f+=Math.abs(n(s))}function A5(e,t,n,r,i){for(var s,f=1/e.sum,m=0,x=e.length,O=0,T=0;O<x;++O)(s=e[O])[r]=m,s[i]=m=f*(T+=Math.abs(n(s)))}function S5(e,t,n,r,i){for(var s,f,m=0,x=0,O=e.length,T=0;T<O;++T)(s=+n(f=e[T]))<0?(f[r]=x,f[i]=x+=s):(f[r]=m,f[i]=m+=s)}Jk.Definition={type:"Stack",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"groupby",type:"field",array:!0},{name:"sort",type:"compare"},{name:"offset",type:"enum",default:"zero",values:["zero","center","normalize"]},{name:"as",type:"string",array:!0,length:2,default:dS}]},Object(be.z)(Jk,Ot,{transform(e,t){var n,r,i,s,f=e.as||dS,m=f[0],x=f[1],O=Qr(e.sort),T=e.field||be.Q,M=e.offset==="center"?O5:e.offset==="normalize"?A5:S5;for(n=function(H,Z,ue,fe){var Ie,Pe,Le,rt,it,ut,st,mt,dt,en=[],mn=sn=>sn(it);if(Z==null)en.push(H.slice());else for(Ie={},Pe=0,Le=H.length;Pe<Le;++Pe)it=H[Pe],ut=Z.map(mn),(st=Ie[ut])||(Ie[ut]=st=[],en.push(st)),st.push(it);for(ut=0,dt=0,rt=en.length;ut<rt;++ut){for(st=en[ut],Pe=0,mt=0,Le=st.length;Pe<Le;++Pe)mt+=Math.abs(fe(st[Pe]));st.sum=mt,mt>dt&&(dt=mt),ue&&st.sort(ue)}return en.max=dt,en}(t.source,e.groupby,O,T),r=0,i=n.length,s=n.max;r<i;++r)M(n[r],s,T,m,x);return t.reflow(e.modified()).modifies(f)}});var G1=e=>e;function zx(e,t){e&&mS.hasOwnProperty(e.type)&&mS[e.type](e,t)}var pS={Feature:function(e,t){zx(e.geometry,t)},FeatureCollection:function(e,t){for(var n=e.features,r=-1,i=n.length;++r<i;)zx(n[r].geometry,t)}},mS={Sphere:function(e,t){t.sphere()},Point:function(e,t){e=e.coordinates,t.point(e[0],e[1],e[2])},MultiPoint:function(e,t){for(var n=e.coordinates,r=-1,i=n.length;++r<i;)e=n[r],t.point(e[0],e[1],e[2])},LineString:function(e,t){Qk(e.coordinates,t,0)},MultiLineString:function(e,t){for(var n=e.coordinates,r=-1,i=n.length;++r<i;)Qk(n[r],t,0)},Polygon:function(e,t){gS(e.coordinates,t)},MultiPolygon:function(e,t){for(var n=e.coordinates,r=-1,i=n.length;++r<i;)gS(n[r],t)},GeometryCollection:function(e,t){for(var n=e.geometries,r=-1,i=n.length;++r<i;)zx(n[r],t)}};function Qk(e,t,n){var r,i=-1,s=e.length-n;for(t.lineStart();++i<s;)r=e[i],t.point(r[0],r[1],r[2]);t.lineEnd()}function gS(e,t){var n=-1,r=e.length;for(t.polygonStart();++n<r;)Qk(e[n],t,1);t.polygonEnd()}var V0=function(e,t){e&&pS.hasOwnProperty(e.type)?pS[e.type](e,t):zx(e,t)};class uh{constructor(){this._partials=new Float64Array(32),this._n=0}add(t){const n=this._partials;let r=0;for(let i=0;i<this._n&&i<32;i++){const s=n[i],f=t+s,m=Math.abs(t)<Math.abs(s)?t-(f-s):s-(f-t);m&&(n[r++]=m),t=f}return n[r]=t,this._n=r+1,this}valueOf(){const t=this._partials;let n,r,i,s=this._n,f=0;if(s>0){for(f=t[--s];s>0&&(n=f,!(i=(r=t[--s])-((f=n+r)-n))););s>0&&(i<0&&t[s-1]<0||i>0&&t[s-1]>0)&&(r=2*i)==(n=f+r)-f&&(f=n)}return f}}var $i=1e-6,qo=Math.PI,gu=qo/2,Ux=qo/4,ch=2*qo,Ru=180/qo,Ho=qo/180,pa=Math.abs,o1=Math.atan,cm=Math.atan2,Yi=Math.cos,Wx=Math.ceil,vS=Math.exp,Zk=Math.hypot,Vx=Math.log,eE=Math.pow,Bi=Math.sin,lm=Math.sign||function(e){return e>0?1:e<0?-1:0},lh=Math.sqrt,tE=Math.tan;function yS(e){return e>1?0:e<-1?qo:Math.acos(e)}function gd(e){return e>1?gu:e<-1?-gu:Math.asin(e)}function vl(){}var bS,xS,nE,rE,iE=new uh,oE=new uh,Fv={point:vl,lineStart:vl,lineEnd:vl,polygonStart:function(){Fv.lineStart=_5,Fv.lineEnd=T5},polygonEnd:function(){Fv.lineStart=Fv.lineEnd=Fv.point=vl,iE.add(pa(oE)),oE=new uh},result:function(){var e=iE/2;return iE=new uh,e}};function _5(){Fv.point=D5}function D5(e,t){Fv.point=wS,bS=nE=e,xS=rE=t}function wS(e,t){oE.add(rE*e-nE*t),nE=e,rE=t}function T5(){wS(bS,xS)}var kS=Fv,a1=1/0,qx=a1,K1=-a1,Hx=K1,ES,CS,s0,u0,$x={point:function(e,t){e<a1&&(a1=e),e>K1&&(K1=e),t<qx&&(qx=t),t>Hx&&(Hx=t)},lineStart:vl,lineEnd:vl,polygonStart:vl,polygonEnd:vl,result:function(){var e=[[a1,qx],[K1,Hx]];return K1=Hx=-(qx=a1=1/0),e}},aE=0,sE=0,X1=0,Gx=0,Kx=0,s1=0,uE=0,cE=0,Y1=0,Zm={point:ly,lineStart:OS,lineEnd:AS,polygonStart:function(){Zm.lineStart=I5,Zm.lineEnd=R5},polygonEnd:function(){Zm.point=ly,Zm.lineStart=OS,Zm.lineEnd=AS},result:function(){var e=Y1?[uE/Y1,cE/Y1]:s1?[Gx/s1,Kx/s1]:X1?[aE/X1,sE/X1]:[NaN,NaN];return aE=sE=X1=Gx=Kx=s1=uE=cE=Y1=0,e}};function ly(e,t){aE+=e,sE+=t,++X1}function OS(){Zm.point=N5}function N5(e,t){Zm.point=F5,ly(s0=e,u0=t)}function F5(e,t){var n=e-s0,r=t-u0,i=lh(n*n+r*r);Gx+=i*(s0+e)/2,Kx+=i*(u0+t)/2,s1+=i,ly(s0=e,u0=t)}function AS(){Zm.point=ly}function I5(){Zm.point=M5}function R5(){SS(ES,CS)}function M5(e,t){Zm.point=SS,ly(ES=s0=e,CS=u0=t)}function SS(e,t){var n=e-s0,r=t-u0,i=lh(n*n+r*r);Gx+=i*(s0+e)/2,Kx+=i*(u0+t)/2,s1+=i,uE+=(i=u0*e-s0*t)*(s0+e),cE+=i*(u0+t),Y1+=3*i,ly(s0=e,u0=t)}var _S=Zm;function DS(e){this._context=e}DS.prototype={_radius:4.5,pointRadius:function(e){return this._radius=e,this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){this._line===0&&this._context.closePath(),this._point=NaN},point:function(e,t){switch(this._point){case 0:this._context.moveTo(e,t),this._point=1;break;case 1:this._context.lineTo(e,t);break;default:this._context.moveTo(e+this._radius,t),this._context.arc(e,t,this._radius,0,ch)}},result:vl};var lE,TS,NS,J1,Q1,fE=new uh,Xx={point:vl,lineStart:function(){Xx.point=j5},lineEnd:function(){lE&&FS(TS,NS),Xx.point=vl},polygonStart:function(){lE=!0},polygonEnd:function(){lE=null},result:function(){var e=+fE;return fE=new uh,e}};function j5(e,t){Xx.point=FS,TS=J1=e,NS=Q1=t}function FS(e,t){J1-=e,Q1-=t,fE.add(lh(J1*J1+Q1*Q1)),J1=e,Q1=t}var IS=Xx;function RS(){this._string=[]}function MS(e){return"m0,"+e+"a"+e+","+e+" 0 1,1 0,"+-2*e+"a"+e+","+e+" 0 1,1 0,"+2*e+"z"}RS.prototype={_radius:4.5,_circle:MS(4.5),pointRadius:function(e){return(e=+e)!==this._radius&&(this._radius=e,this._circle=null),this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){this._line===0&&this._string.push("Z"),this._point=NaN},point:function(e,t){switch(this._point){case 0:this._string.push("M",e,",",t),this._point=1;break;case 1:this._string.push("L",e,",",t);break;default:this._circle==null&&(this._circle=MS(this._radius)),this._string.push("M",e,",",t,this._circle)}},result:function(){if(this._string.length){var e=this._string.join("");return this._string=[],e}return null}};var jS=function(e,t){var n,r,i=4.5;function s(f){return f&&(typeof i=="function"&&r.pointRadius(+i.apply(this,arguments)),V0(f,n(r))),r.result()}return s.area=function(f){return V0(f,n(kS)),kS.result()},s.measure=function(f){return V0(f,n(IS)),IS.result()},s.bounds=function(f){return V0(f,n($x)),$x.result()},s.centroid=function(f){return V0(f,n(_S)),_S.result()},s.projection=function(f){return arguments.length?(n=f==null?(e=null,G1):(e=f).stream,s):e},s.context=function(f){return arguments.length?(r=f==null?(t=null,new RS):new DS(t=f),typeof i!="function"&&r.pointRadius(i),s):t},s.pointRadius=function(f){return arguments.length?(i=typeof f=="function"?f:(r.pointRadius(+f),+f),s):i},s.projection(e).context(t)},BS=function(){var e,t=[];return{point:function(n,r,i){e.push([n,r,i])},lineStart:function(){t.push(e=[])},lineEnd:vl,rejoin:function(){t.length>1&&t.push(t.pop().concat(t.shift()))},result:function(){var n=t;return t=[],e=null,n}}},Yx=function(e,t){return pa(e[0]-t[0])<$i&&pa(e[1]-t[1])<$i};function Jx(e,t,n,r){this.x=e,this.z=t,this.o=n,this.e=r,this.v=!1,this.n=this.p=null}var PS=function(e,t,n,r,i){var s,f,m=[],x=[];if(e.forEach(function(ue){if(!((fe=ue.length-1)<=0)){var fe,Ie,Pe=ue[0],Le=ue[fe];if(Yx(Pe,Le)){if(!Pe[2]&&!Le[2]){for(i.lineStart(),s=0;s<fe;++s)i.point((Pe=ue[s])[0],Pe[1]);return void i.lineEnd()}Le[0]+=2*$i}m.push(Ie=new Jx(Pe,ue,null,!0)),x.push(Ie.o=new Jx(Pe,null,Ie,!1)),m.push(Ie=new Jx(Le,ue,null,!1)),x.push(Ie.o=new Jx(Le,null,Ie,!0))}}),m.length){for(x.sort(t),LS(m),LS(x),s=0,f=x.length;s<f;++s)x[s].e=n=!n;for(var O,T,M=m[0];;){for(var H=M,Z=!0;H.v;)if((H=H.n)===M)return;O=H.z,i.lineStart();do{if(H.v=H.o.v=!0,H.e){if(Z)for(s=0,f=O.length;s<f;++s)i.point((T=O[s])[0],T[1]);else r(H.x,H.n.x,1,i);H=H.n}else{if(Z)for(O=H.p.z,s=O.length-1;s>=0;--s)i.point((T=O[s])[0],T[1]);else r(H.x,H.p.x,-1,i);H=H.p}O=(H=H.o).z,Z=!Z}while(!H.v);i.lineEnd()}}};function LS(e){if(t=e.length){for(var t,n,r=0,i=e[0];++r<t;)i.n=n=e[r],n.p=i,i=n;i.n=n=e[0],n.p=i}}function Qx(e){return[cm(e[1],e[0]),gd(e[2])]}function fy(e){var t=e[0],n=e[1],r=Yi(n);return[r*Yi(t),r*Bi(t),Bi(n)]}function Zx(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function u1(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]}function hE(e,t){e[0]+=t[0],e[1]+=t[1],e[2]+=t[2]}function e2(e,t){return[e[0]*t,e[1]*t,e[2]*t]}function t2(e){var t=lh(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]/=t,e[1]/=t,e[2]/=t}function dE(e){return pa(e[0])<=qo?e[0]:lm(e[0])*((pa(e[0])+qo)%ch-qo)}function zS(e){return Array.from(function*(t){for(const n of t)yield*n}(e))}var US=function(e,t,n,r){return function(i){var s,f,m,x=t(i),O=BS(),T=t(O),M=!1,H={point:Z,lineStart:fe,lineEnd:Ie,polygonStart:function(){H.point=Pe,H.lineStart=Le,H.lineEnd=rt,f=[],s=[]},polygonEnd:function(){H.point=Z,H.lineStart=fe,H.lineEnd=Ie,f=zS(f);var it=function(ut,st){var mt=dE(st),dt=st[1],en=Bi(dt),mn=[Bi(mt),-Yi(mt),0],sn=0,In=0,Fn=new uh;en===1?dt=gu+$i:en===-1&&(dt=-gu-$i);for(var zn=0,Vn=ut.length;zn<Vn;++zn)if(mr=(Qn=ut[zn]).length)for(var Qn,mr,Pr=Qn[mr-1],Cr=dE(Pr),Jr=Pr[1]/2+Ux,gi=Bi(Jr),vi=Yi(Jr),zi=0;zi<mr;++zi,Cr=yi,gi=vo,vi=na,Pr=wi){var wi=Qn[zi],yi=dE(wi),_i=wi[1]/2+Ux,vo=Bi(_i),na=Yi(_i),Ui=yi-Cr,va=Ui>=0?1:-1,ya=va*Ui,Ha=ya>qo,Ns=gi*vo;if(Fn.add(cm(Ns*va*Bi(ya),vi*na+Ns*Yi(ya))),sn+=Ha?Ui+va*ch:Ui,Ha^Cr>=mt^yi>=mt){var Fs=u1(fy(Pr),fy(wi));t2(Fs);var gs=u1(mn,Fs);t2(gs);var kl=(Ha^Ui>=0?-1:1)*gd(gs[2]);(dt>kl||dt===kl&&(Fs[0]||Fs[1]))&&(In+=Ha^Ui>=0?1:-1)}}return(sn<-$i||sn<$i&&Fn<-1e-12)^1&In}(s,r);f.length?(M||(i.polygonStart(),M=!0),PS(f,P5,it,n,i)):it&&(M||(i.polygonStart(),M=!0),i.lineStart(),n(null,null,1,i),i.lineEnd()),M&&(i.polygonEnd(),M=!1),f=s=null},sphere:function(){i.polygonStart(),i.lineStart(),n(null,null,1,i),i.lineEnd(),i.polygonEnd()}};function Z(it,ut){e(it,ut)&&i.point(it,ut)}function ue(it,ut){x.point(it,ut)}function fe(){H.point=ue,x.lineStart()}function Ie(){H.point=Z,x.lineEnd()}function Pe(it,ut){m.push([it,ut]),T.point(it,ut)}function Le(){T.lineStart(),m=[]}function rt(){Pe(m[0][0],m[0][1]),T.lineEnd();var it,ut,st,mt,dt=T.clean(),en=O.result(),mn=en.length;if(m.pop(),s.push(m),m=null,mn)if(1&dt){if((ut=(st=en[0]).length-1)>0){for(M||(i.polygonStart(),M=!0),i.lineStart(),it=0;it<ut;++it)i.point((mt=st[it])[0],mt[1]);i.lineEnd()}}else mn>1&&2&dt&&en.push(en.pop().concat(en.shift())),f.push(en.filter(B5))}return H}};function B5(e){return e.length>1}function P5(e,t){return((e=e.x)[0]<0?e[1]-gu-$i:gu-e[1])-((t=t.x)[0]<0?t[1]-gu-$i:gu-t[1])}var WS=US(function(){return!0},function(e){var t,n=NaN,r=NaN,i=NaN;return{lineStart:function(){e.lineStart(),t=1},point:function(s,f){var m=s>0?qo:-qo,x=pa(s-n);pa(x-qo)<$i?(e.point(n,r=(r+f)/2>0?gu:-gu),e.point(i,r),e.lineEnd(),e.lineStart(),e.point(m,r),e.point(s,r),t=0):i!==m&&x>=qo&&(pa(n-i)<$i&&(n-=i*$i),pa(s-m)<$i&&(s-=m*$i),r=function(O,T,M,H){var Z,ue,fe=Bi(O-M);return pa(fe)>$i?o1((Bi(T)*(ue=Yi(H))*Bi(M)-Bi(H)*(Z=Yi(T))*Bi(O))/(Z*ue*fe)):(T+H)/2}(n,r,s,f),e.point(i,r),e.lineEnd(),e.lineStart(),e.point(m,r),t=0),e.point(n=s,r=f),i=m},lineEnd:function(){e.lineEnd(),n=r=NaN},clean:function(){return 2-t}}},function(e,t,n,r){var i;if(e==null)i=n*gu,r.point(-qo,i),r.point(0,i),r.point(qo,i),r.point(qo,0),r.point(qo,-i),r.point(0,-i),r.point(-qo,-i),r.point(-qo,0),r.point(-qo,i);else if(pa(e[0]-t[0])>$i){var s=e[0]<t[0]?qo:-qo;i=n*s/2,r.point(-s,i),r.point(0,i),r.point(s,i)}else r.point(t[0],t[1])},[-qo,-gu]),pE=function(e,t){function n(r,i){return r=e(r,i),t(r[0],r[1])}return e.invert&&t.invert&&(n.invert=function(r,i){return(r=t.invert(r,i))&&e.invert(r[0],r[1])}),n};function mE(e,t){return[pa(e)>qo?e+Math.round(-e/ch)*ch:e,t]}function VS(e,t,n){return(e%=ch)?t||n?pE(HS(e),$S(t,n)):HS(e):t||n?$S(t,n):mE}function qS(e){return function(t,n){return[(t+=e)>qo?t-ch:t<-qo?t+ch:t,n]}}function HS(e){var t=qS(e);return t.invert=qS(-e),t}function $S(e,t){var n=Yi(e),r=Bi(e),i=Yi(t),s=Bi(t);function f(m,x){var O=Yi(x),T=Yi(m)*O,M=Bi(m)*O,H=Bi(x),Z=H*n+T*r;return[cm(M*i-Z*s,T*n-H*r),gd(Z*i+M*s)]}return f.invert=function(m,x){var O=Yi(x),T=Yi(m)*O,M=Bi(m)*O,H=Bi(x),Z=H*i-M*s;return[cm(M*i+H*s,T*n+Z*r),gd(Z*n-T*r)]},f}mE.invert=mE;var L5=function(e){function t(n){return(n=e(n[0]*Ho,n[1]*Ho))[0]*=Ru,n[1]*=Ru,n}return e=VS(e[0]*Ho,e[1]*Ho,e.length>2?e[2]*Ho:0),t.invert=function(n){return(n=e.invert(n[0]*Ho,n[1]*Ho))[0]*=Ru,n[1]*=Ru,n},t};function z5(e,t,n,r,i,s){if(n){var f=Yi(t),m=Bi(t),x=r*n;i==null?(i=t+r*ch,s=t-x/2):(i=GS(f,i),s=GS(f,s),(r>0?i<s:i>s)&&(i+=r*ch));for(var O,T=i;r>0?T>s:T<s;T-=x)O=Qx([f,-m*Yi(T),-m*Bi(T)]),e.point(O[0],O[1])}}function GS(e,t){(t=fy(t))[0]-=e,t2(t);var n=yS(-t[1]);return((-t[2]<0?-n:n)+ch-$i)%ch}var U5=function(e){var t=Yi(e),n=6*Ho,r=t>0,i=pa(t)>$i;function s(x,O){return Yi(x)*Yi(O)>t}function f(x,O,T){var M=[1,0,0],H=u1(fy(x),fy(O)),Z=Zx(H,H),ue=H[0],fe=Z-ue*ue;if(!fe)return!T&&x;var Ie=t*Z/fe,Pe=-t*ue/fe,Le=u1(M,H),rt=e2(M,Ie);hE(rt,e2(H,Pe));var it=Le,ut=Zx(rt,it),st=Zx(it,it),mt=ut*ut-st*(Zx(rt,rt)-1);if(!(mt<0)){var dt=lh(mt),en=e2(it,(-ut-dt)/st);if(hE(en,rt),en=Qx(en),!T)return en;var mn,sn=x[0],In=O[0],Fn=x[1],zn=O[1];In<sn&&(mn=sn,sn=In,In=mn);var Vn=In-sn,Qn=pa(Vn-qo)<$i;if(!Qn&&zn<Fn&&(mn=Fn,Fn=zn,zn=mn),Qn||Vn<$i?Qn?Fn+zn>0^en[1]<(pa(en[0]-sn)<$i?Fn:zn):Fn<=en[1]&&en[1]<=zn:Vn>qo^(sn<=en[0]&&en[0]<=In)){var mr=e2(it,(-ut+dt)/st);return hE(mr,rt),[en,Qx(mr)]}}}function m(x,O){var T=r?e:qo-e,M=0;return x<-T?M|=1:x>T&&(M|=2),O<-T?M|=4:O>T&&(M|=8),M}return US(s,function(x){var O,T,M,H,Z;return{lineStart:function(){H=M=!1,Z=1},point:function(ue,fe){var Ie,Pe=[ue,fe],Le=s(ue,fe),rt=r?Le?0:m(ue,fe):Le?m(ue+(ue<0?qo:-qo),fe):0;if(!O&&(H=M=Le)&&x.lineStart(),Le!==M&&(!(Ie=f(O,Pe))||Yx(O,Ie)||Yx(Pe,Ie))&&(Pe[2]=1),Le!==M)Z=0,Le?(x.lineStart(),Ie=f(Pe,O),x.point(Ie[0],Ie[1])):(Ie=f(O,Pe),x.point(Ie[0],Ie[1],2),x.lineEnd()),O=Ie;else if(i&&O&&r^Le){var it;rt&T||!(it=f(Pe,O,!0))||(Z=0,r?(x.lineStart(),x.point(it[0][0],it[0][1]),x.point(it[1][0],it[1][1]),x.lineEnd()):(x.point(it[1][0],it[1][1]),x.lineEnd(),x.lineStart(),x.point(it[0][0],it[0][1],3)))}!Le||O&&Yx(O,Pe)||x.point(Pe[0],Pe[1]),O=Pe,M=Le,T=rt},lineEnd:function(){M&&x.lineEnd(),O=null},clean:function(){return Z|(H&&M)<<1}}},function(x,O,T,M){z5(M,e,n,T,x,O)},r?[0,-e]:[-qo,e-qo])},W5=function(e,t,n,r,i,s){var f,m=e[0],x=e[1],O=0,T=1,M=t[0]-m,H=t[1]-x;if(f=n-m,M||!(f>0)){if(f/=M,M<0){if(f<O)return;f<T&&(T=f)}else if(M>0){if(f>T)return;f>O&&(O=f)}if(f=i-m,M||!(f<0)){if(f/=M,M<0){if(f>T)return;f>O&&(O=f)}else if(M>0){if(f<O)return;f<T&&(T=f)}if(f=r-x,H||!(f>0)){if(f/=H,H<0){if(f<O)return;f<T&&(T=f)}else if(H>0){if(f>T)return;f>O&&(O=f)}if(f=s-x,H||!(f<0)){if(f/=H,H<0){if(f>T)return;f>O&&(O=f)}else if(H>0){if(f<O)return;f<T&&(T=f)}return O>0&&(e[0]=m+O*M,e[1]=x+O*H),T<1&&(t[0]=m+T*M,t[1]=x+T*H),!0}}}}},Z1=1e9,n2=-Z1;function KS(e,t,n,r){function i(O,T){return e<=O&&O<=n&&t<=T&&T<=r}function s(O,T,M,H){var Z=0,ue=0;if(O==null||(Z=f(O,M))!==(ue=f(T,M))||x(O,T)<0^M>0)do H.point(Z===0||Z===3?e:n,Z>1?r:t);while((Z=(Z+M+4)%4)!==ue);else H.point(T[0],T[1])}function f(O,T){return pa(O[0]-e)<$i?T>0?0:3:pa(O[0]-n)<$i?T>0?2:1:pa(O[1]-t)<$i?T>0?1:0:T>0?3:2}function m(O,T){return x(O.x,T.x)}function x(O,T){var M=f(O,1),H=f(T,1);return M!==H?M-H:M===0?T[1]-O[1]:M===1?O[0]-T[0]:M===2?O[1]-T[1]:T[0]-O[0]}return function(O){var T,M,H,Z,ue,fe,Ie,Pe,Le,rt,it,ut=O,st=BS(),mt={point:dt,lineStart:function(){mt.point=en,M&&M.push(H=[]),rt=!0,Le=!1,Ie=Pe=NaN},lineEnd:function(){T&&(en(Z,ue),fe&&Le&&st.rejoin(),T.push(st.result())),mt.point=dt,Le&&ut.lineEnd()},polygonStart:function(){ut=st,T=[],M=[],it=!0},polygonEnd:function(){var mn=function(){for(var Fn=0,zn=0,Vn=M.length;zn<Vn;++zn)for(var Qn,mr,Pr=M[zn],Cr=1,Jr=Pr.length,gi=Pr[0],vi=gi[0],zi=gi[1];Cr<Jr;++Cr)Qn=vi,mr=zi,gi=Pr[Cr],vi=gi[0],zi=gi[1],mr<=r?zi>r&&(vi-Qn)*(r-mr)>(zi-mr)*(e-Qn)&&++Fn:zi<=r&&(vi-Qn)*(r-mr)<(zi-mr)*(e-Qn)&&--Fn;return Fn}(),sn=it&&mn,In=(T=zS(T)).length;(sn||In)&&(O.polygonStart(),sn&&(O.lineStart(),s(null,null,1,O),O.lineEnd()),In&&PS(T,m,mn,s,O),O.polygonEnd()),ut=O,T=M=H=null}};function dt(mn,sn){i(mn,sn)&&ut.point(mn,sn)}function en(mn,sn){var In=i(mn,sn);if(M&&H.push([mn,sn]),rt)Z=mn,ue=sn,fe=In,rt=!1,In&&(ut.lineStart(),ut.point(mn,sn));else if(In&&Le)ut.point(mn,sn);else{var Fn=[Ie=Math.max(n2,Math.min(Z1,Ie)),Pe=Math.max(n2,Math.min(Z1,Pe))],zn=[mn=Math.max(n2,Math.min(Z1,mn)),sn=Math.max(n2,Math.min(Z1,sn))];W5(Fn,zn,e,t,n,r)?(Le||(ut.lineStart(),ut.point(Fn[0],Fn[1])),ut.point(zn[0],zn[1]),In||ut.lineEnd(),it=!1):In&&(ut.lineStart(),ut.point(mn,sn),it=!1)}Ie=mn,Pe=sn,Le=In}return mt}}function r2(e){return function(t){var n=new gE;for(var r in e)n[r]=e[r];return n.stream=t,n}}function gE(){}function vE(e,t,n){var r=e.clipExtent&&e.clipExtent();return e.scale(150).translate([0,0]),r!=null&&e.clipExtent(null),V0(n,e.stream($x)),t($x.result()),r!=null&&e.clipExtent(r),e}function i2(e,t,n){return vE(e,function(r){var i=t[1][0]-t[0][0],s=t[1][1]-t[0][1],f=Math.min(i/(r[1][0]-r[0][0]),s/(r[1][1]-r[0][1])),m=+t[0][0]+(i-f*(r[1][0]+r[0][0]))/2,x=+t[0][1]+(s-f*(r[1][1]+r[0][1]))/2;e.scale(150*f).translate([m,x])},n)}function yE(e,t,n){return i2(e,[[0,0],t],n)}function bE(e,t,n){return vE(e,function(r){var i=+t,s=i/(r[1][0]-r[0][0]),f=(i-s*(r[1][0]+r[0][0]))/2,m=-s*r[0][1];e.scale(150*s).translate([f,m])},n)}function xE(e,t,n){return vE(e,function(r){var i=+t,s=i/(r[1][1]-r[0][1]),f=-s*r[0][0],m=(i-s*(r[1][1]+r[0][1]))/2;e.scale(150*s).translate([f,m])},n)}gE.prototype={constructor:gE,point:function(e,t){this.stream.point(e,t)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};var XS=16,V5=Yi(30*Ho),YS=function(e,t){return+t?function(n,r){function i(s,f,m,x,O,T,M,H,Z,ue,fe,Ie,Pe,Le){var rt=M-s,it=H-f,ut=rt*rt+it*it;if(ut>4*r&&Pe--){var st=x+ue,mt=O+fe,dt=T+Ie,en=lh(st*st+mt*mt+dt*dt),mn=gd(dt/=en),sn=pa(pa(dt)-1)<$i||pa(m-Z)<$i?(m+Z)/2:cm(mt,st),In=n(sn,mn),Fn=In[0],zn=In[1],Vn=Fn-s,Qn=zn-f,mr=it*Vn-rt*Qn;(mr*mr/ut>r||pa((rt*Vn+it*Qn)/ut-.5)>.3||x*ue+O*fe+T*Ie<V5)&&(i(s,f,m,x,O,T,Fn,zn,sn,st/=en,mt/=en,dt,Pe,Le),Le.point(Fn,zn),i(Fn,zn,sn,st,mt,dt,M,H,Z,ue,fe,Ie,Pe,Le))}}return function(s){var f,m,x,O,T,M,H,Z,ue,fe,Ie,Pe,Le={point:rt,lineStart:it,lineEnd:st,polygonStart:function(){s.polygonStart(),Le.lineStart=mt},polygonEnd:function(){s.polygonEnd(),Le.lineStart=it}};function rt(mn,sn){mn=n(mn,sn),s.point(mn[0],mn[1])}function it(){Z=NaN,Le.point=ut,s.lineStart()}function ut(mn,sn){var In=fy([mn,sn]),Fn=n(mn,sn);i(Z,ue,H,fe,Ie,Pe,Z=Fn[0],ue=Fn[1],H=mn,fe=In[0],Ie=In[1],Pe=In[2],XS,s),s.point(Z,ue)}function st(){Le.point=rt,s.lineEnd()}function mt(){it(),Le.point=dt,Le.lineEnd=en}function dt(mn,sn){ut(f=mn,sn),m=Z,x=ue,O=fe,T=Ie,M=Pe,Le.point=ut}function en(){i(Z,ue,H,fe,Ie,Pe,m,x,f,O,T,M,XS,s),Le.lineEnd=st,st()}return Le}}(e,t):function(n){return r2({point:function(r,i){r=n(r,i),this.stream.point(r[0],r[1])}})}(e)},q5=r2({point:function(e,t){this.stream.point(e*Ho,t*Ho)}});function JS(e,t,n,r,i,s){if(!s)return function(fe,Ie,Pe,Le,rt){function it(ut,st){return[Ie+fe*(ut*=Le),Pe-fe*(st*=rt)]}return it.invert=function(ut,st){return[(ut-Ie)/fe*Le,(Pe-st)/fe*rt]},it}(e,t,n,r,i);var f=Yi(s),m=Bi(s),x=f*e,O=m*e,T=f/e,M=m/e,H=(m*n-f*t)/e,Z=(m*t+f*n)/e;function ue(fe,Ie){return[x*(fe*=r)-O*(Ie*=i)+t,n-O*fe-x*Ie]}return ue.invert=function(fe,Ie){return[r*(T*fe-M*Ie+H),i*(Z-M*fe-T*Ie)]},ue}function c0(e){return QS(function(){return e})()}function QS(e){var t,n,r,i,s,f,m,x,O,T,M=150,H=480,Z=250,ue=0,fe=0,Ie=0,Pe=0,Le=0,rt=0,it=1,ut=1,st=null,mt=WS,dt=null,en=G1,mn=.5;function sn(Vn){return x(Vn[0]*Ho,Vn[1]*Ho)}function In(Vn){return(Vn=x.invert(Vn[0],Vn[1]))&&[Vn[0]*Ru,Vn[1]*Ru]}function Fn(){var Vn=JS(M,0,0,it,ut,rt).apply(null,t(ue,fe)),Qn=JS(M,H-Vn[0],Z-Vn[1],it,ut,rt);return n=VS(Ie,Pe,Le),m=pE(t,Qn),x=pE(n,m),f=YS(m,mn),zn()}function zn(){return O=T=null,sn}return sn.stream=function(Vn){return O&&T===Vn?O:O=q5(function(Qn){return r2({point:function(mr,Pr){var Cr=Qn(mr,Pr);return this.stream.point(Cr[0],Cr[1])}})}(n)(mt(f(en(T=Vn)))))},sn.preclip=function(Vn){return arguments.length?(mt=Vn,st=void 0,zn()):mt},sn.postclip=function(Vn){return arguments.length?(en=Vn,dt=r=i=s=null,zn()):en},sn.clipAngle=function(Vn){return arguments.length?(mt=+Vn?U5(st=Vn*Ho):(st=null,WS),zn()):st*Ru},sn.clipExtent=function(Vn){return arguments.length?(en=Vn==null?(dt=r=i=s=null,G1):KS(dt=+Vn[0][0],r=+Vn[0][1],i=+Vn[1][0],s=+Vn[1][1]),zn()):dt==null?null:[[dt,r],[i,s]]},sn.scale=function(Vn){return arguments.length?(M=+Vn,Fn()):M},sn.translate=function(Vn){return arguments.length?(H=+Vn[0],Z=+Vn[1],Fn()):[H,Z]},sn.center=function(Vn){return arguments.length?(ue=Vn[0]%360*Ho,fe=Vn[1]%360*Ho,Fn()):[ue*Ru,fe*Ru]},sn.rotate=function(Vn){return arguments.length?(Ie=Vn[0]%360*Ho,Pe=Vn[1]%360*Ho,Le=Vn.length>2?Vn[2]%360*Ho:0,Fn()):[Ie*Ru,Pe*Ru,Le*Ru]},sn.angle=function(Vn){return arguments.length?(rt=Vn%360*Ho,Fn()):rt*Ru},sn.reflectX=function(Vn){return arguments.length?(it=Vn?-1:1,Fn()):it<0},sn.reflectY=function(Vn){return arguments.length?(ut=Vn?-1:1,Fn()):ut<0},sn.precision=function(Vn){return arguments.length?(f=YS(m,mn=Vn*Vn),zn()):lh(mn)},sn.fitExtent=function(Vn,Qn){return i2(sn,Vn,Qn)},sn.fitSize=function(Vn,Qn){return yE(sn,Vn,Qn)},sn.fitWidth=function(Vn,Qn){return bE(sn,Vn,Qn)},sn.fitHeight=function(Vn,Qn){return xE(sn,Vn,Qn)},function(){return t=e.apply(this,arguments),sn.invert=t.invert&&In,Fn()}}function wE(e){var t=0,n=qo/3,r=QS(e),i=r(t,n);return i.parallels=function(s){return arguments.length?r(t=s[0]*Ho,n=s[1]*Ho):[t*Ru,n*Ru]},i}function H5(e,t){var n=Bi(e),r=(n+Bi(t))/2;if(pa(r)<$i)return function(m){var x=Yi(m);function O(T,M){return[T*x,Bi(M)/x]}return O.invert=function(T,M){return[T/x,gd(M*x)]},O}(e);var i=1+n*(2*r-n),s=lh(i)/r;function f(m,x){var O=lh(i-2*r*Bi(x))/r;return[O*Bi(m*=r),s-O*Yi(m)]}return f.invert=function(m,x){var O=s-x,T=cm(m,pa(O))*lm(O);return O*r<0&&(T-=qo*lm(m)*lm(O)),[T/r,gd((i-(m*m+O*O)*r*r)/(2*r))]},f}var o2=function(){return wE(H5).scale(155.424).center([0,33.6442])},ZS=function(){return o2().parallels([29.5,45.5]).scale(1070).translate([480,250]).rotate([96,0]).center([-.6,38.7])};function e_(e){return function(t,n){var r=Yi(t),i=Yi(n),s=e(r*i);return s===1/0?[2,0]:[s*i*Bi(t),s*Bi(n)]}}function eb(e){return function(t,n){var r=lh(t*t+n*n),i=e(r),s=Bi(i),f=Yi(i);return[cm(t*s,r*f),gd(r&&n*s/r)]}}var t_=e_(function(e){return lh(2/(1+e))});t_.invert=eb(function(e){return 2*gd(e/2)});var n_=e_(function(e){return(e=yS(e))&&e/Bi(e)});n_.invert=eb(function(e){return e});function a2(e,t){return[e,Vx(tE((gu+t)/2))]}a2.invert=function(e,t){return[e,2*o1(vS(t))-gu]};function r_(e){var t,n,r,i=c0(e),s=i.center,f=i.scale,m=i.translate,x=i.clipExtent,O=null;function T(){var M=qo*f(),H=i(L5(i.rotate()).invert([0,0]));return x(O==null?[[H[0]-M,H[1]-M],[H[0]+M,H[1]+M]]:e===a2?[[Math.max(H[0]-M,O),t],[Math.min(H[0]+M,n),r]]:[[O,Math.max(H[1]-M,t)],[n,Math.min(H[1]+M,r)]])}return i.scale=function(M){return arguments.length?(f(M),T()):f()},i.translate=function(M){return arguments.length?(m(M),T()):m()},i.center=function(M){return arguments.length?(s(M),T()):s()},i.clipExtent=function(M){return arguments.length?(M==null?O=t=n=r=null:(O=+M[0][0],t=+M[0][1],n=+M[1][0],r=+M[1][1]),T()):O==null?null:[[O,t],[n,r]]},T()}function s2(e){return tE((gu+e)/2)}function $5(e,t){var n=Yi(e),r=e===t?Bi(e):Vx(n/Yi(t))/Vx(s2(t)/s2(e)),i=n*eE(s2(e),r)/r;if(!r)return a2;function s(f,m){i>0?m<-gu+$i&&(m=-gu+$i):m>gu-$i&&(m=gu-$i);var x=i/eE(s2(m),r);return[x*Bi(r*f),i-x*Yi(r*f)]}return s.invert=function(f,m){var x=i-m,O=lm(r)*lh(f*f+x*x),T=cm(f,pa(x))*lm(x);return x*r<0&&(T-=qo*lm(f)*lm(x)),[T/r,2*o1(eE(i/O,1/r))-gu]},s}function u2(e,t){return[e,t]}u2.invert=u2;function G5(e,t){var n=Yi(e),r=e===t?Bi(e):(n-Yi(t))/(t-e),i=n/r+e;if(pa(r)<$i)return u2;function s(f,m){var x=i-m,O=r*f;return[x*Bi(O),i-x*Yi(O)]}return s.invert=function(f,m){var x=i-m,O=cm(f,pa(x))*lm(x);return x*r<0&&(O-=qo*lm(f)*lm(x)),[O/r,i-lm(r)*lh(f*f+x*x)]},s}var tb=1.340264,nb=-.081106,rb=893e-6,ib=.003796,c2=lh(3)/2;function i_(e,t){var n=gd(c2*Bi(t)),r=n*n,i=r*r*r;return[e*Yi(n)/(c2*(tb+3*nb*r+i*(7*rb+9*ib*r))),n*(tb+nb*r+i*(rb+ib*r))]}i_.invert=function(e,t){for(var n,r=t,i=r*r,s=i*i*i,f=0;f<12&&(s=(i=(r-=n=(r*(tb+nb*i+s*(rb+ib*i))-t)/(tb+3*nb*i+s*(7*rb+9*ib*i)))*r)*i*i,!(pa(n)<1e-12));++f);return[c2*e*(tb+3*nb*i+s*(7*rb+9*ib*i))/Yi(r),gd(Bi(r)/c2)]};function o_(e,t){var n=Yi(t),r=Yi(e)*n;return[n*Bi(e)/r,Bi(t)/r]}o_.invert=eb(o1);function a_(e,t){var n=t*t,r=n*n;return[e*(.8707-.131979*n+r*(r*(.003971*n-.001529*r)-.013791)),t*(1.007226+n*(.015085+r*(.028874*n-.044475-.005916*r)))]}a_.invert=function(e,t){var n,r=t,i=25;do{var s=r*r,f=s*s;r-=n=(r*(1.007226+s*(.015085+f*(.028874*s-.044475-.005916*f)))-t)/(1.007226+s*(.045255+f*(.259866*s-.311325-.005916*11*f)))}while(pa(n)>$i&&--i>0);return[e/(.8707+(s=r*r)*(s*(s*s*s*(.003971-.001529*s)-.013791)-.131979)),r]};function s_(e,t){return[Yi(t)*Bi(e),Bi(t)]}s_.invert=eb(gd);function u_(e,t){var n=Yi(t),r=1+Yi(e)*n;return[n*Bi(e)/r,Bi(t)/r]}u_.invert=eb(function(e){return 2*o1(e)});function c_(e,t){return[Vx(tE((gu+t)/2)),-e]}c_.invert=function(e,t){return[-t,2*o1(vS(e))-gu]};var K5=Math.abs,kE=Math.cos,l2=Math.sin,X5=1e-6,l_=Math.PI,EE=l_/2,f_=Y5(2);function h_(e){return e>1?EE:e<-1?-EE:Math.asin(e)}function Y5(e){return e>0?Math.sqrt(e):0}var J5=function(e,t,n){function r(i,s){return[e*i*kE(s=function(f,m){var x,O=f*l2(m),T=30;do m-=x=(m+l2(m)-O)/(1+kE(m));while(K5(x)>X5&&--T>0);return m/2}(n,s)),t*l2(s)]}return r.invert=function(i,s){return s=h_(s/t),[i/(e*kE(s)),h_((2*s+l2(2*s))/n)]},r}(f_/EE,f_,l_);const Q5=jS(),CE=["clipAngle","clipExtent","scale","translate","center","rotate","parallels","precision","reflectX","reflectY","coefficient","distance","fraction","lobes","parallel","radius","ratio","spacing","tilt"];function OE(e,t){if(!e||typeof e!="string")throw new Error("Projection type must be a name string.");return e=e.toLowerCase(),arguments.length>1?(f2[e]=function(n,r){return function i(){const s=r();return s.type=n,s.path=jS().projection(s),s.copy=s.copy||function(){const f=i();return CE.forEach(m=>{s[m]&&f[m](s[m]())}),f.path.pointRadius(s.path.pointRadius()),f},s}}(e,t),this):f2[e]||null}function d_(e){return e&&e.path||Q5}const f2={albers:ZS,albersusa:function(){var e,t,n,r,i,s,f=ZS(),m=o2().rotate([154,0]).center([-2,58.5]).parallels([55,65]),x=o2().rotate([157,0]).center([-3,19.9]).parallels([8,18]),O={point:function(H,Z){s=[H,Z]}};function T(H){var Z=H[0],ue=H[1];return s=null,n.point(Z,ue),s||(r.point(Z,ue),s)||(i.point(Z,ue),s)}function M(){return e=t=null,T}return T.invert=function(H){var Z=f.scale(),ue=f.translate(),fe=(H[0]-ue[0])/Z,Ie=(H[1]-ue[1])/Z;return(Ie>=.12&&Ie<.234&&fe>=-.425&&fe<-.214?m:Ie>=.166&&Ie<.234&&fe>=-.214&&fe<-.115?x:f).invert(H)},T.stream=function(H){return e&&t===H?e:e=function(Z){var ue=Z.length;return{point:function(fe,Ie){for(var Pe=-1;++Pe<ue;)Z[Pe].point(fe,Ie)},sphere:function(){for(var fe=-1;++fe<ue;)Z[fe].sphere()},lineStart:function(){for(var fe=-1;++fe<ue;)Z[fe].lineStart()},lineEnd:function(){for(var fe=-1;++fe<ue;)Z[fe].lineEnd()},polygonStart:function(){for(var fe=-1;++fe<ue;)Z[fe].polygonStart()},polygonEnd:function(){for(var fe=-1;++fe<ue;)Z[fe].polygonEnd()}}}([f.stream(t=H),m.stream(H),x.stream(H)])},T.precision=function(H){return arguments.length?(f.precision(H),m.precision(H),x.precision(H),M()):f.precision()},T.scale=function(H){return arguments.length?(f.scale(H),m.scale(.35*H),x.scale(H),T.translate(f.translate())):f.scale()},T.translate=function(H){if(!arguments.length)return f.translate();var Z=f.scale(),ue=+H[0],fe=+H[1];return n=f.translate(H).clipExtent([[ue-.455*Z,fe-.238*Z],[ue+.455*Z,fe+.238*Z]]).stream(O),r=m.translate([ue-.307*Z,fe+.201*Z]).clipExtent([[ue-.425*Z+$i,fe+.12*Z+$i],[ue-.214*Z-$i,fe+.234*Z-$i]]).stream(O),i=x.translate([ue-.205*Z,fe+.212*Z]).clipExtent([[ue-.214*Z+$i,fe+.166*Z+$i],[ue-.115*Z-$i,fe+.234*Z-$i]]).stream(O),M()},T.fitExtent=function(H,Z){return i2(T,H,Z)},T.fitSize=function(H,Z){return yE(T,H,Z)},T.fitWidth=function(H,Z){return bE(T,H,Z)},T.fitHeight=function(H,Z){return xE(T,H,Z)},T.scale(1070)},azimuthalequalarea:function(){return c0(t_).scale(124.75).clipAngle(179.999)},azimuthalequidistant:function(){return c0(n_).scale(79.4188).clipAngle(179.999)},conicconformal:function(){return wE($5).scale(109.5).parallels([30,30])},conicequalarea:o2,conicequidistant:function(){return wE(G5).scale(131.154).center([0,13.9389])},equalEarth:function(){return c0(i_).scale(177.158)},equirectangular:function(){return c0(u2).scale(152.63)},gnomonic:function(){return c0(o_).scale(144.049).clipAngle(60)},identity:function(){var e,t,n,r,i,s,f,m=1,x=0,O=0,T=1,M=1,H=0,Z=null,ue=1,fe=1,Ie=r2({point:function(it,ut){var st=rt([it,ut]);this.stream.point(st[0],st[1])}}),Pe=G1;function Le(){return ue=m*T,fe=m*M,s=f=null,rt}function rt(it){var ut=it[0]*ue,st=it[1]*fe;if(H){var mt=st*e-ut*t;ut=ut*e+st*t,st=mt}return[ut+x,st+O]}return rt.invert=function(it){var ut=it[0]-x,st=it[1]-O;if(H){var mt=st*e+ut*t;ut=ut*e-st*t,st=mt}return[ut/ue,st/fe]},rt.stream=function(it){return s&&f===it?s:s=Ie(Pe(f=it))},rt.postclip=function(it){return arguments.length?(Pe=it,Z=n=r=i=null,Le()):Pe},rt.clipExtent=function(it){return arguments.length?(Pe=it==null?(Z=n=r=i=null,G1):KS(Z=+it[0][0],n=+it[0][1],r=+it[1][0],i=+it[1][1]),Le()):Z==null?null:[[Z,n],[r,i]]},rt.scale=function(it){return arguments.length?(m=+it,Le()):m},rt.translate=function(it){return arguments.length?(x=+it[0],O=+it[1],Le()):[x,O]},rt.angle=function(it){return arguments.length?(t=Bi(H=it%360*Ho),e=Yi(H),Le()):H*Ru},rt.reflectX=function(it){return arguments.length?(T=it?-1:1,Le()):T<0},rt.reflectY=function(it){return arguments.length?(M=it?-1:1,Le()):M<0},rt.fitExtent=function(it,ut){return i2(rt,it,ut)},rt.fitSize=function(it,ut){return yE(rt,it,ut)},rt.fitWidth=function(it,ut){return bE(rt,it,ut)},rt.fitHeight=function(it,ut){return xE(rt,it,ut)},rt},mercator:function(){return r_(a2).scale(961/ch)},mollweide:function(){return c0(J5).scale(169.529)},naturalEarth1:function(){return c0(a_).scale(175.295)},orthographic:function(){return c0(s_).scale(249.5).clipAngle(90+$i)},stereographic:function(){return c0(u_).scale(250).clipAngle(142)},transversemercator:function(){var e=r_(c_),t=e.center,n=e.rotate;return e.center=function(r){return arguments.length?t([-r[1],r[0]]):[(r=t())[1],-r[0]]},e.rotate=function(r){return arguments.length?n([r[0],r[1],r.length>2?r[2]+90:90]):[(r=n())[0],r[1],r[2]-90]},n([0,0,90]).scale(159.155)}};for(const e in f2)OE(e,f2[e]);function p_(e,t,n){var r=ys(e,t-$i,n).concat(t);return function(i){return r.map(function(s){return[i,s]})}}function m_(e,t,n){var r=ys(e,t-$i,n).concat(t);return function(i){return r.map(function(s){return[s,i]})}}function Z5(){var e,t,n,r,i,s,f,m,x,O,T,M,H=10,Z=H,ue=90,fe=360,Ie=2.5;function Pe(){return{type:"MultiLineString",coordinates:Le()}}function Le(){return ys(Wx(r/ue)*ue,n,ue).map(T).concat(ys(Wx(m/fe)*fe,f,fe).map(M)).concat(ys(Wx(t/H)*H,e,H).filter(function(rt){return pa(rt%ue)>$i}).map(x)).concat(ys(Wx(s/Z)*Z,i,Z).filter(function(rt){return pa(rt%fe)>$i}).map(O))}return Pe.lines=function(){return Le().map(function(rt){return{type:"LineString",coordinates:rt}})},Pe.outline=function(){return{type:"Polygon",coordinates:[T(r).concat(M(f).slice(1),T(n).reverse().slice(1),M(m).reverse().slice(1))]}},Pe.extent=function(rt){return arguments.length?Pe.extentMajor(rt).extentMinor(rt):Pe.extentMinor()},Pe.extentMajor=function(rt){return arguments.length?(r=+rt[0][0],n=+rt[1][0],m=+rt[0][1],f=+rt[1][1],r>n&&(rt=r,r=n,n=rt),m>f&&(rt=m,m=f,f=rt),Pe.precision(Ie)):[[r,m],[n,f]]},Pe.extentMinor=function(rt){return arguments.length?(t=+rt[0][0],e=+rt[1][0],s=+rt[0][1],i=+rt[1][1],t>e&&(rt=t,t=e,e=rt),s>i&&(rt=s,s=i,i=rt),Pe.precision(Ie)):[[t,s],[e,i]]},Pe.step=function(rt){return arguments.length?Pe.stepMajor(rt).stepMinor(rt):Pe.stepMinor()},Pe.stepMajor=function(rt){return arguments.length?(ue=+rt[0],fe=+rt[1],Pe):[ue,fe]},Pe.stepMinor=function(rt){return arguments.length?(H=+rt[0],Z=+rt[1],Pe):[H,Z]},Pe.precision=function(rt){return arguments.length?(Ie=+rt,x=p_(s,i,90),O=m_(t,e,Ie),T=p_(m,f,90),M=m_(r,n,Ie),Pe):Ie},Pe.extentMajor([[-180,-90+$i],[180,90-$i]]).extentMinor([[-180,-80-$i],[180,80+$i]])}function eM(){}const q0=[[],[[[1,1.5],[.5,1]]],[[[1.5,1],[1,1.5]]],[[[1.5,1],[.5,1]]],[[[1,.5],[1.5,1]]],[[[1,1.5],[.5,1]],[[1,.5],[1.5,1]]],[[[1,.5],[1,1.5]]],[[[1,.5],[.5,1]]],[[[.5,1],[1,.5]]],[[[1,1.5],[1,.5]]],[[[.5,1],[1,.5]],[[1.5,1],[1,1.5]]],[[[1.5,1],[1,.5]]],[[[.5,1],[1.5,1]]],[[[1,1.5],[1.5,1]]],[[[.5,1],[1,1.5]]],[]];function g_(){var e=1,t=1,n=f;function r(m,x){return x.map(O=>i(m,O))}function i(m,x){var O=[],T=[];return function(M,H,Z){var ue,fe,Ie,Pe,Le,rt,it=new Array,ut=new Array;for(ue=fe=-1,Pe=M[0]>=H,q0[Pe<<1].forEach(st);++ue<e-1;)Ie=Pe,Pe=M[ue+1]>=H,q0[Ie|Pe<<1].forEach(st);for(q0[Pe<<0].forEach(st);++fe<t-1;){for(ue=-1,Pe=M[fe*e+e]>=H,Le=M[fe*e]>=H,q0[Pe<<1|Le<<2].forEach(st);++ue<e-1;)Ie=Pe,Pe=M[fe*e+e+ue+1]>=H,rt=Le,Le=M[fe*e+ue+1]>=H,q0[Ie|Pe<<1|Le<<2|rt<<3].forEach(st);q0[Pe|Le<<3].forEach(st)}for(ue=-1,Le=M[fe*e]>=H,q0[Le<<2].forEach(st);++ue<e-1;)rt=Le,Le=M[fe*e+ue+1]>=H,q0[Le<<2|rt<<3].forEach(st);function st(mt){var dt,en,mn=[mt[0][0]+ue,mt[0][1]+fe],sn=[mt[1][0]+ue,mt[1][1]+fe],In=s(mn),Fn=s(sn);(dt=ut[In])?(en=it[Fn])?(delete ut[dt.end],delete it[en.start],dt===en?(dt.ring.push(sn),Z(dt.ring)):it[dt.start]=ut[en.end]={start:dt.start,end:en.end,ring:dt.ring.concat(en.ring)}):(delete ut[dt.end],dt.ring.push(sn),ut[dt.end=Fn]=dt):(dt=it[Fn])?(en=ut[In])?(delete it[dt.start],delete ut[en.end],dt===en?(dt.ring.push(sn),Z(dt.ring)):it[en.start]=ut[dt.end]={start:en.start,end:dt.end,ring:en.ring.concat(dt.ring)}):(delete it[dt.start],dt.ring.unshift(mn),it[dt.start=In]=dt):it[In]=ut[Fn]={start:In,end:Fn,ring:[mn,sn]}}q0[Le<<3].forEach(st)}(m,x,M=>{n(M,m,x),function(H){for(var Z=0,ue=H.length,fe=H[ue-1][1]*H[0][0]-H[ue-1][0]*H[0][1];++Z<ue;)fe+=H[Z-1][1]*H[Z][0]-H[Z-1][0]*H[Z][1];return fe}(M)>0?O.push([M]):T.push(M)}),T.forEach(M=>{for(var H,Z=0,ue=O.length;Z<ue;++Z)if(tM((H=O[Z])[0],M)!==-1)return void H.push(M)}),{type:"MultiPolygon",value:x,coordinates:O}}function s(m){return 2*m[0]+m[1]*(e+1)*4}function f(m,x,O){m.forEach(T=>{var M,H=T[0],Z=T[1],ue=0|H,fe=0|Z,Ie=x[fe*e+ue];H>0&&H<e&&ue===H&&(M=x[fe*e+ue-1],T[0]=H+(O-M)/(Ie-M)-.5),Z>0&&Z<t&&fe===Z&&(M=x[(fe-1)*e+ue],T[1]=Z+(O-M)/(Ie-M)-.5)})}return r.contour=i,r.size=function(m){if(!arguments.length)return[e,t];var x=Math.floor(m[0]),O=Math.floor(m[1]);return x>=0&&O>=0||Object(be.o)("invalid size"),e=x,t=O,r},r.smooth=function(m){return arguments.length?(n=m?f:eM,r):n===f},r}function tM(e,t){for(var n,r=-1,i=t.length;++r<i;)if(n=nM(e,t[r]))return n;return 0}function nM(e,t){for(var n=t[0],r=t[1],i=-1,s=0,f=e.length,m=f-1;s<f;m=s++){var x=e[s],O=x[0],T=x[1],M=e[m],H=M[0],Z=M[1];if(rM(x,M,t))return 0;T>r!=Z>r&&n<(H-O)*(r-T)/(Z-T)+O&&(i=-i)}return i}function rM(e,t,n){var r;return function(i,s,f){return(s[0]-i[0])*(f[1]-i[1])==(f[0]-i[0])*(s[1]-i[1])}(e,t,n)&&function(i,s,f){return i<=s&&s<=f||f<=s&&s<=i}(e[r=+(e[0]===t[0])],n[r],t[r])}function v_(e,t,n){return function(r){var i=Object(be.q)(r),s=n?Math.min(i[0],0):i[0],f=i[1],m=f-s,x=t?Object(Cu.c)(s,f,e):m/(e+1);return ys(s+x,f,x)}}function AE(e){Ot.call(this,null,e)}function y_(e,t,n,r,i){const s=e.x1||0,f=e.y1||0,m=t*n<0;function x(M){M.forEach(O)}function O(M){m&&M.reverse(),M.forEach(T)}function T(M){M[0]=(M[0]-s)*t+r,M[1]=(M[1]-f)*n+i}return function(M){return M.coordinates.forEach(x),M}}function b_(e,t,n){const r=e>=0?e:qr(t,n);return Math.round((Math.sqrt(4*r*r+1)-1)/2)}function SE(e){return Object(be.E)(e)?e:Object(be.m)(+e)}function x_(){var e=x=>x[0],t=x=>x[1],n=be.Q,r=[-1,-1],i=960,s=500,f=2;function m(x,O){const T=b_(r[0],x,e)>>f,M=b_(r[1],x,t)>>f,H=T?T+2:0,Z=M?M+2:0,ue=2*H+(i>>f),fe=2*Z+(s>>f),Ie=new Float32Array(ue*fe),Pe=new Float32Array(ue*fe);let Le=Ie;x.forEach(it=>{const ut=H+(+e(it)>>f),st=Z+(+t(it)>>f);ut>=0&&ut<ue&&st>=0&&st<fe&&(Ie[ut+st*ue]+=+n(it))}),T>0&&M>0?(c1(ue,fe,Ie,Pe,T),l1(ue,fe,Pe,Ie,M),c1(ue,fe,Ie,Pe,T),l1(ue,fe,Pe,Ie,M),c1(ue,fe,Ie,Pe,T),l1(ue,fe,Pe,Ie,M)):T>0?(c1(ue,fe,Ie,Pe,T),c1(ue,fe,Pe,Ie,T),c1(ue,fe,Ie,Pe,T),Le=Pe):M>0&&(l1(ue,fe,Ie,Pe,M),l1(ue,fe,Pe,Ie,M),l1(ue,fe,Ie,Pe,M),Le=Pe);const rt=O?Math.pow(2,-2*f):1/ZA(Le);for(let it=0,ut=ue*fe;it<ut;++it)Le[it]*=rt;return{values:Le,scale:1<<f,width:ue,height:fe,x1:H,y1:Z,x2:H+(i>>f),y2:Z+(s>>f)}}return m.x=function(x){return arguments.length?(e=SE(x),m):e},m.y=function(x){return arguments.length?(t=SE(x),m):t},m.weight=function(x){return arguments.length?(n=SE(x),m):n},m.size=function(x){if(!arguments.length)return[i,s];var O=+x[0],T=+x[1];return O>=0&&T>=0||Object(be.o)("invalid size"),i=O,s=T,m},m.cellSize=function(x){return arguments.length?((x=+x)>=1||Object(be.o)("invalid cell size"),f=Math.floor(Math.log(x)/Math.LN2),m):1<<f},m.bandwidth=function(x){return arguments.length?((x=Object(be.i)(x)).length===1&&(x=[+x[0],+x[0]]),x.length!==2&&Object(be.o)("invalid bandwidth"),r=x,m):r},m}function c1(e,t,n,r,i){const s=1+(i<<1);for(let f=0;f<t;++f)for(let m=0,x=0;m<e+i;++m)m<e&&(x+=n[m+f*e]),m>=i&&(m>=s&&(x-=n[m-s+f*e]),r[m-i+f*e]=x/Math.min(m+1,e-1+s-m,s))}function l1(e,t,n,r,i){const s=1+(i<<1);for(let f=0;f<e;++f)for(let m=0,x=0;m<t+i;++m)m<t&&(x+=n[f+m*e]),m>=i&&(m>=s&&(x-=n[f+(m-s)*e]),r[f+(m-i)*e]=x/Math.min(m+1,t-1+s-m,s))}function _E(e){Ot.call(this,null,e)}AE.Definition={type:"Isocontour",metadata:{generates:!0},params:[{name:"field",type:"field"},{name:"thresholds",type:"number",array:!0},{name:"levels",type:"number"},{name:"nice",type:"boolean",default:!1},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"zero",type:"boolean",default:!0},{name:"smooth",type:"boolean",default:!0},{name:"scale",type:"number",expr:!0},{name:"translate",type:"number",array:!0,expr:!0},{name:"as",type:"string",null:!0,default:"contour"}]},Object(be.z)(AE,Ot,{transform(e,t){if(this.value&&!t.changed()&&!e.modified())return t.StopPropagation;var n=t.fork(t.NO_SOURCE|t.NO_FIELDS),r=t.materialize(t.SOURCE).source,i=e.field||be.y,s=g_().smooth(e.smooth!==!1),f=e.thresholds||function(O,T,M){const H=v_(M.levels||10,M.nice,M.zero!==!1);return M.resolve!=="shared"?H:H(O.map(Z=>Gn(T(Z).values)))}(r,i,e),m=e.as===null?null:e.as||"contour",x=[];return r.forEach(O=>{const T=i(O),M=s.size([T.width,T.height])(T.values,Object(be.B)(f)?f:f(T.values));(function(H,Z,ue,fe){let Ie=fe.scale||Z.scale,Pe=fe.translate||Z.translate;if(Object(be.E)(Ie)&&(Ie=Ie(ue,fe)),Object(be.E)(Pe)&&(Pe=Pe(ue,fe)),(Ie===1||Ie==null)&&!Pe)return;const Le=(Object(be.G)(Ie)?Ie:Ie[0])||1,rt=(Object(be.G)(Ie)?Ie:Ie[1])||1,it=Pe&&Pe[0]||0,ut=Pe&&Pe[1]||0;H.forEach(y_(Z,Le,rt,it,ut))})(M,T,O,e),M.forEach(H=>{x.push(wr(O,Dn(m!=null?{[m]:H}:H)))})}),this.value&&(n.rem=this.value),this.value=n.source=n.add=x,n}}),_E.Definition={type:"KDE2D",metadata:{generates:!0},params:[{name:"size",type:"number",array:!0,length:2,required:!0},{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"weight",type:"field"},{name:"groupby",type:"field",array:!0},{name:"cellSize",type:"number"},{name:"bandwidth",type:"number",array:!0,length:2},{name:"counts",type:"boolean",default:!1},{name:"as",type:"string",default:"grid"}]};const iM=["x","y","weight","size","cellSize","bandwidth"];function w_(e,t){return iM.forEach(n=>t[n]!=null?e[n](t[n]):0),e}function DE(e){Ot.call(this,null,e)}Object(be.z)(_E,Ot,{transform(e,t){if(this.value&&!t.changed()&&!e.modified())return t.StopPropagation;var n,r=t.fork(t.NO_SOURCE|t.NO_FIELDS),i=function(x,O){var T,M,H,Z,ue,fe,Ie=[],Pe=Le=>Le(Z);if(O==null)Ie.push(x);else for(T={},M=0,H=x.length;M<H;++M)Z=x[M],ue=O.map(Pe),(fe=T[ue])||(T[ue]=fe=[],fe.dims=ue,Ie.push(fe)),fe.push(Z);return Ie}(t.materialize(t.SOURCE).source,e.groupby),s=(e.groupby||[]).map(be.h),f=w_(x_(),e),m=e.as||"grid";return n=i.map(x=>Dn(function(O,T){for(let M=0;M<s.length;++M)O[s[M]]=T[M];return O}({[m]:f(x,e.counts)},x.dims))),this.value&&(r.rem=this.value),this.value=r.source=r.add=n,r}}),DE.Definition={type:"Contour",metadata:{generates:!0},params:[{name:"size",type:"number",array:!0,length:2,required:!0},{name:"values",type:"number",array:!0},{name:"x",type:"field"},{name:"y",type:"field"},{name:"weight",type:"field"},{name:"cellSize",type:"number"},{name:"bandwidth",type:"number"},{name:"count",type:"number"},{name:"nice",type:"boolean",default:!1},{name:"thresholds",type:"number",array:!0},{name:"smooth",type:"boolean",default:!0}]},Object(be.z)(DE,Ot,{transform(e,t){if(this.value&&!t.changed()&&!e.modified())return t.StopPropagation;var n,r,i=t.fork(t.NO_SOURCE|t.NO_FIELDS),s=g_().smooth(e.smooth!==!1),f=e.values,m=e.thresholds||v_(e.count||10,e.nice,!!f),x=e.size;return f||(f=t.materialize(t.SOURCE).source,r=y_(n=w_(x_(),e)(f,!0),n.scale||1,n.scale||1,0,0),x=[n.width,n.height],f=n.values),m=Object(be.B)(m)?m:m(f),f=s.size(x)(f,m),r&&f.forEach(r),this.value&&(i.rem=this.value),this.value=i.source=i.add=(f||[]).map(Dn),i}});const TE="Feature",NE="FeatureCollection";function FE(e){Ot.call(this,null,e)}function IE(e){Ot.call(this,null,e)}function RE(e){Ot.call(this,null,e)}function ME(e){Ot.call(this,null,e)}function jE(e){Ot.call(this,[],e),this.generator=Z5()}function BE(e){Ot.call(this,null,e)}function k_(e){if(!Object(be.E)(e))return!1;const t=Object(be.Fa)(Object(be.g)(e));return t.$x||t.$y||t.$value||t.$max}function E_(e){Ot.call(this,null,e),this.modified(!0)}function C_(e,t,n){Object(be.E)(e[t])&&e[t](n)}FE.Definition={type:"GeoJSON",metadata:{},params:[{name:"fields",type:"field",array:!0,length:2},{name:"geojson",type:"field"}]},Object(be.z)(FE,Ot,{transform(e,t){var n,r=this._features,i=this._points,s=e.fields,f=s&&s[0],m=s&&s[1],x=e.geojson||!s&&be.y,O=t.ADD;n=e.modified()||t.changed(t.REM)||t.modified(Object(be.g)(x))||f&&t.modified(Object(be.g)(f))||m&&t.modified(Object(be.g)(m)),this.value&&!n||(O=t.SOURCE,this._features=r=[],this._points=i=[]),x&&t.visit(O,T=>r.push(x(T))),f&&m&&(t.visit(O,T=>{var M=f(T),H=m(T);M!=null&&H!=null&&(M=+M)===M&&(H=+H)===H&&i.push([M,H])}),r=r.concat({type:TE,geometry:{type:"MultiPoint",coordinates:i}})),this.value={type:NE,features:r}}}),IE.Definition={type:"GeoPath",metadata:{modifies:!0},params:[{name:"projection",type:"projection"},{name:"field",type:"field"},{name:"pointRadius",type:"number",expr:!0},{name:"as",type:"string",default:"path"}]},Object(be.z)(IE,Ot,{transform(e,t){var n=t.fork(t.ALL),r=this.value,i=e.field||be.y,s=e.as||"path",f=n.SOURCE;!r||e.modified()?(this.value=r=d_(e.projection),n.materialize().reflow()):f=i===be.y||t.modified(i.fields)?n.ADD_MOD:n.ADD;const m=function(x,O){const T=x.pointRadius();return x.context(null),O!=null&&x.pointRadius(O),T}(r,e.pointRadius);return n.visit(f,x=>x[s]=r(i(x))),r.pointRadius(m),n.modifies(s)}}),RE.Definition={type:"GeoPoint",metadata:{modifies:!0},params:[{name:"projection",type:"projection",required:!0},{name:"fields",type:"field",array:!0,required:!0,length:2},{name:"as",type:"string",array:!0,length:2,default:["x","y"]}]},Object(be.z)(RE,Ot,{transform(e,t){var n,r=e.projection,i=e.fields[0],s=e.fields[1],f=e.as||["x","y"],m=f[0],x=f[1];function O(T){const M=r([i(T),s(T)]);M?(T[m]=M[0],T[x]=M[1]):(T[m]=void 0,T[x]=void 0)}return e.modified()?t=t.materialize().reflow(!0).visit(t.SOURCE,O):(n=t.modified(i.fields)||t.modified(s.fields),t.visit(n?t.ADD_MOD:t.ADD,O)),t.modifies(f)}}),ME.Definition={type:"GeoShape",metadata:{modifies:!0,nomod:!0},params:[{name:"projection",type:"projection"},{name:"field",type:"field",default:"datum"},{name:"pointRadius",type:"number",expr:!0},{name:"as",type:"string",default:"shape"}]},Object(be.z)(ME,Ot,{transform(e,t){var n=t.fork(t.ALL),r=this.value,i=e.as||"shape",s=n.ADD;return r&&!e.modified()||(this.value=r=function(f,m,x){const O=x==null?T=>f(m(T)):T=>{var M=f.pointRadius(),H=f.pointRadius(x)(m(T));return f.pointRadius(M),H};return O.context=T=>(f.context(T),O),O}(d_(e.projection),e.field||Object(be.u)("datum"),e.pointRadius),n.materialize().reflow(),s=n.SOURCE),n.visit(s,f=>f[i]=r),n.modifies(i)}}),jE.Definition={type:"Graticule",metadata:{changes:!0,generates:!0},params:[{name:"extent",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"extentMajor",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"extentMinor",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"step",type:"number",array:!0,length:2},{name:"stepMajor",type:"number",array:!0,length:2,default:[90,360]},{name:"stepMinor",type:"number",array:!0,length:2,default:[10,10]},{name:"precision",type:"number",default:2.5}]},Object(be.z)(jE,Ot,{transform(e,t){var n,r=this.value,i=this.generator;if(!r.length||e.modified())for(const s in e)Object(be.E)(i[s])&&i[s](e[s]);return n=i(),r.length?t.mod.push(gr(r[0],n)):t.add.push(Dn(n)),r[0]=n,t}}),BE.Definition={type:"heatmap",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"color",type:"string",expr:!0},{name:"opacity",type:"number",expr:!0},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"as",type:"string",default:"image"}]},Object(be.z)(BE,Ot,{transform(e,t){if(!t.changed()&&!e.modified())return t.StopPropagation;var n=t.materialize(t.SOURCE).source,r=e.resolve==="shared",i=e.field||be.y,s=function(O,T){let M;return Object(be.E)(O)?(M=H=>O(H,T)).dep=k_(O):O?M=Object(be.m)(O):(M=H=>H.$value/H.$max||0).dep=!0,M}(e.opacity,e),f=function(O,T){let M;return Object(be.E)(O)?(M=H=>Wt(O(H,T))).dep=k_(O):M=Object(be.m)(Wt(O||"#888")),M}(e.color,e),m=e.as||"image",x={$x:0,$y:0,$value:0,$max:r?Gn(n.map(O=>Gn(i(O).values))):0};return n.forEach(O=>{const T=i(O),M=Object(be.p)({},O,x);r||(M.$max=Gn(T.values||[])),O[m]=function(H,Z,ue,fe){const Ie=H.width,Pe=H.height,Le=H.x1||0,rt=H.y1||0,it=H.x2||Ie,ut=H.y2||Pe,st=H.values,mt=st?In=>st[In]:be.Ma,dt=Hs(it-Le,ut-rt),en=dt.getContext("2d"),mn=en.getImageData(0,0,it-Le,ut-rt),sn=mn.data;for(let In=rt,Fn=0;In<ut;++In){Z.$y=In-rt;for(let zn=Le,Vn=In*Ie;zn<it;++zn,Fn+=4){Z.$x=zn-Le,Z.$value=mt(zn+Vn);const Qn=ue(Z);sn[Fn+0]=Qn.r,sn[Fn+1]=Qn.g,sn[Fn+2]=Qn.b,sn[Fn+3]=~~(255*fe(Z))}}return en.putImageData(mn,0,0),dt}(T,M,f.dep?f:Object(be.m)(f(M)),s.dep?s:Object(be.m)(s(M)))}),t.reflow(!0).modifies(m)}}),Object(be.z)(E_,Ot,{transform(e,t){let n=this.value;return!n||e.modified("type")?(this.value=n=function(r){const i=OE((r||"mercator").toLowerCase());return i||Object(be.o)("Unrecognized projection type: "+r),i()}(e.type),CE.forEach(r=>{e[r]!=null&&C_(n,r,e[r])})):CE.forEach(r=>{e.modified(r)&&C_(n,r,e[r])}),e.pointRadius!=null&&n.path.pointRadius(e.pointRadius),e.fit&&function(r,i){const s=function(f){return(f=Object(be.i)(f)).length===1?f[0]:{type:NE,features:f.reduce((m,x)=>m.concat(function(O){return O.type===NE?O.features:Object(be.i)(O).filter(T=>T!=null).map(T=>T.type===TE?T:{type:TE,geometry:T})}(x)),[])}}(i.fit);i.extent?r.fitExtent(i.extent,s):i.size&&r.fitSize(i.size,s)}(n,e),t.fork(t.NO_SOURCE|t.NO_FIELDS)}});function O_(e,t,n,r){if(isNaN(t)||isNaN(n))return e;var i,s,f,m,x,O,T,M,H,Z=e._root,ue={data:r},fe=e._x0,Ie=e._y0,Pe=e._x1,Le=e._y1;if(!Z)return e._root=ue,e;for(;Z.length;)if((O=t>=(s=(fe+Pe)/2))?fe=s:Pe=s,(T=n>=(f=(Ie+Le)/2))?Ie=f:Le=f,i=Z,!(Z=Z[M=T<<1|O]))return i[M]=ue,e;if(m=+e._x.call(null,Z.data),x=+e._y.call(null,Z.data),t===m&&n===x)return ue.next=Z,i?i[M]=ue:e._root=ue,e;do i=i?i[M]=new Array(4):e._root=new Array(4),(O=t>=(s=(fe+Pe)/2))?fe=s:Pe=s,(T=n>=(f=(Ie+Le)/2))?Ie=f:Le=f;while((M=T<<1|O)==(H=(x>=f)<<1|m>=s));return i[H]=Z,i[M]=ue,e}var fh=function(e,t,n,r,i){this.node=e,this.x0=t,this.y0=n,this.x1=r,this.y1=i};function oM(e){return e[0]}function aM(e){return e[1]}function PE(e,t,n){var r=new LE(t??oM,n??aM,NaN,NaN,NaN,NaN);return e==null?r:r.addAll(e)}function LE(e,t,n,r,i,s){this._x=e,this._y=t,this._x0=n,this._y0=r,this._x1=i,this._y1=s,this._root=void 0}function A_(e){for(var t={data:e.data},n=t;e=e.next;)n=n.next={data:e.data};return t}var hh=PE.prototype=LE.prototype;hh.copy=function(){var e,t,n=new LE(this._x,this._y,this._x0,this._y0,this._x1,this._y1),r=this._root;if(!r)return n;if(!r.length)return n._root=A_(r),n;for(e=[{source:r,target:n._root=new Array(4)}];r=e.pop();)for(var i=0;i<4;++i)(t=r.source[i])&&(t.length?e.push({source:t,target:r.target[i]=new Array(4)}):r.target[i]=A_(t));return n},hh.add=function(e){const t=+this._x.call(null,e),n=+this._y.call(null,e);return O_(this.cover(t,n),t,n,e)},hh.addAll=function(e){var t,n,r,i,s=e.length,f=new Array(s),m=new Array(s),x=1/0,O=1/0,T=-1/0,M=-1/0;for(n=0;n<s;++n)isNaN(r=+this._x.call(null,t=e[n]))||isNaN(i=+this._y.call(null,t))||(f[n]=r,m[n]=i,r<x&&(x=r),r>T&&(T=r),i<O&&(O=i),i>M&&(M=i));if(x>T||O>M)return this;for(this.cover(x,O).cover(T,M),n=0;n<s;++n)O_(this,f[n],m[n],e[n]);return this},hh.cover=function(e,t){if(isNaN(e=+e)||isNaN(t=+t))return this;var n=this._x0,r=this._y0,i=this._x1,s=this._y1;if(isNaN(n))i=(n=Math.floor(e))+1,s=(r=Math.floor(t))+1;else{for(var f,m,x=i-n||1,O=this._root;n>e||e>=i||r>t||t>=s;)switch(m=(t<r)<<1|e<n,(f=new Array(4))[m]=O,O=f,x*=2,m){case 0:i=n+x,s=r+x;break;case 1:n=i-x,s=r+x;break;case 2:i=n+x,r=s-x;break;case 3:n=i-x,r=s-x}this._root&&this._root.length&&(this._root=O)}return this._x0=n,this._y0=r,this._x1=i,this._y1=s,this},hh.data=function(){var e=[];return this.visit(function(t){if(!t.length)do e.push(t.data);while(t=t.next)}),e},hh.extent=function(e){return arguments.length?this.cover(+e[0][0],+e[0][1]).cover(+e[1][0],+e[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]},hh.find=function(e,t,n){var r,i,s,f,m,x,O,T=this._x0,M=this._y0,H=this._x1,Z=this._y1,ue=[],fe=this._root;for(fe&&ue.push(new fh(fe,T,M,H,Z)),n==null?n=1/0:(T=e-n,M=t-n,H=e+n,Z=t+n,n*=n);x=ue.pop();)if(!(!(fe=x.node)||(i=x.x0)>H||(s=x.y0)>Z||(f=x.x1)<T||(m=x.y1)<M))if(fe.length){var Ie=(i+f)/2,Pe=(s+m)/2;ue.push(new fh(fe[3],Ie,Pe,f,m),new fh(fe[2],i,Pe,Ie,m),new fh(fe[1],Ie,s,f,Pe),new fh(fe[0],i,s,Ie,Pe)),(O=(t>=Pe)<<1|e>=Ie)&&(x=ue[ue.length-1],ue[ue.length-1]=ue[ue.length-1-O],ue[ue.length-1-O]=x)}else{var Le=e-+this._x.call(null,fe.data),rt=t-+this._y.call(null,fe.data),it=Le*Le+rt*rt;if(it<n){var ut=Math.sqrt(n=it);T=e-ut,M=t-ut,H=e+ut,Z=t+ut,r=fe.data}}return r},hh.remove=function(e){if(isNaN(s=+this._x.call(null,e))||isNaN(f=+this._y.call(null,e)))return this;var t,n,r,i,s,f,m,x,O,T,M,H,Z=this._root,ue=this._x0,fe=this._y0,Ie=this._x1,Pe=this._y1;if(!Z)return this;if(Z.length)for(;;){if((O=s>=(m=(ue+Ie)/2))?ue=m:Ie=m,(T=f>=(x=(fe+Pe)/2))?fe=x:Pe=x,t=Z,!(Z=Z[M=T<<1|O]))return this;if(!Z.length)break;(t[M+1&3]||t[M+2&3]||t[M+3&3])&&(n=t,H=M)}for(;Z.data!==e;)if(r=Z,!(Z=Z.next))return this;return(i=Z.next)&&delete Z.next,r?(i?r.next=i:delete r.next,this):t?(i?t[M]=i:delete t[M],(Z=t[0]||t[1]||t[2]||t[3])&&Z===(t[3]||t[2]||t[1]||t[0])&&!Z.length&&(n?n[H]=Z:this._root=Z),this):(this._root=i,this)},hh.removeAll=function(e){for(var t=0,n=e.length;t<n;++t)this.remove(e[t]);return this},hh.root=function(){return this._root},hh.size=function(){var e=0;return this.visit(function(t){if(!t.length)do++e;while(t=t.next)}),e},hh.visit=function(e){var t,n,r,i,s,f,m=[],x=this._root;for(x&&m.push(new fh(x,this._x0,this._y0,this._x1,this._y1));t=m.pop();)if(!e(x=t.node,r=t.x0,i=t.y0,s=t.x1,f=t.y1)&&x.length){var O=(r+s)/2,T=(i+f)/2;(n=x[3])&&m.push(new fh(n,O,T,s,f)),(n=x[2])&&m.push(new fh(n,r,T,O,f)),(n=x[1])&&m.push(new fh(n,O,i,s,T)),(n=x[0])&&m.push(new fh(n,r,i,O,T))}return this},hh.visitAfter=function(e){var t,n=[],r=[];for(this._root&&n.push(new fh(this._root,this._x0,this._y0,this._x1,this._y1));t=n.pop();){var i=t.node;if(i.length){var s,f=t.x0,m=t.y0,x=t.x1,O=t.y1,T=(f+x)/2,M=(m+O)/2;(s=i[0])&&n.push(new fh(s,f,m,T,M)),(s=i[1])&&n.push(new fh(s,T,m,x,M)),(s=i[2])&&n.push(new fh(s,f,M,T,O)),(s=i[3])&&n.push(new fh(s,T,M,x,O))}r.push(t)}for(;t=r.pop();)e(t.node,t.x0,t.y0,t.x1,t.y1);return this},hh.x=function(e){return arguments.length?(this._x=e,this):this._x},hh.y=function(e){return arguments.length?(this._y=e,this):this._y};var dh=function(e){return function(){return e}},Iv=function(e){return 1e-6*(e()-.5)};function sM(e){return e.x+e.vx}function uM(e){return e.y+e.vy}var cM={value:()=>{}};function S_(){for(var e,t=0,n=arguments.length,r={};t<n;++t){if(!(e=arguments[t]+"")||e in r||/[\s.]/.test(e))throw new Error("illegal type: "+e);r[e]=[]}return new h2(r)}function h2(e){this._=e}function lM(e,t){for(var n,r=0,i=e.length;r<i;++r)if((n=e[r]).name===t)return n.value}function __(e,t,n){for(var r=0,i=e.length;r<i;++r)if(e[r].name===t){e[r]=cM,e=e.slice(0,r).concat(e.slice(r+1));break}return n!=null&&e.push({name:t,value:n}),e}h2.prototype=S_.prototype={constructor:h2,on:function(e,t){var n,r=this._,i=function(m,x){return m.trim().split(/^|\s+/).map(function(O){var T="",M=O.indexOf(".");if(M>=0&&(T=O.slice(M+1),O=O.slice(0,M)),O&&!x.hasOwnProperty(O))throw new Error("unknown type: "+O);return{type:O,name:T}})}(e+"",r),s=-1,f=i.length;if(!(arguments.length<2)){if(t!=null&&typeof t!="function")throw new Error("invalid callback: "+t);for(;++s<f;)if(n=(e=i[s]).type)r[n]=__(r[n],e.name,t);else if(t==null)for(n in r)r[n]=__(r[n],e.name,null);return this}for(;++s<f;)if((n=(e=i[s]).type)&&(n=lM(r[n],e.name)))return n},copy:function(){var e={},t=this._;for(var n in t)e[n]=t[n].slice();return new h2(e)},call:function(e,t){if((n=arguments.length-2)>0)for(var n,r,i=new Array(n),s=0;s<n;++s)i[s]=arguments[s+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(s=0,n=(r=this._[e]).length;s<n;++s)r[s].value.apply(t,i)},apply:function(e,t,n){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var r=this._[e],i=0,s=r.length;i<s;++i)r[i].value.apply(t,n)}};var d2,ob,fM=S_,f1=0,ab=0,sb=0,D_=1e3,p2=0,hy=0,m2=0,ub=typeof performance=="object"&&performance.now?performance:Date,T_=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function zE(){return hy||(T_(hM),hy=ub.now()+m2)}function hM(){hy=0}function g2(){this._call=this._time=this._next=null}function N_(e,t,n){var r=new g2;return r.restart(e,t,n),r}function F_(){hy=(p2=ub.now())+m2,f1=ab=0;try{(function(){zE(),++f1;for(var e,t=d2;t;)(e=hy-t._time)>=0&&t._call.call(null,e),t=t._next;--f1})()}finally{f1=0,function(){for(var e,t,n=d2,r=1/0;n;)n._call?(r>n._time&&(r=n._time),e=n,n=n._next):(t=n._next,n._next=null,n=e?e._next=t:d2=t);ob=e,UE(r)}(),hy=0}}function dM(){var e=ub.now(),t=e-p2;t>D_&&(m2-=t,p2=e)}function UE(e){f1||(ab&&(ab=clearTimeout(ab)),e-hy>24?(e<1/0&&(ab=setTimeout(F_,e-ub.now()-m2)),sb&&(sb=clearInterval(sb))):(sb||(p2=ub.now(),sb=setInterval(dM,D_)),f1=1,T_(F_)))}g2.prototype=N_.prototype={constructor:g2,restart:function(e,t,n){if(typeof e!="function")throw new TypeError("callback is not a function");n=(n==null?zE():+n)+(t==null?0:+t),this._next||ob===this||(ob?ob._next=this:d2=this,ob=this),this._call=e,this._time=n,UE()},stop:function(){this._call&&(this._call=null,this._time=1/0,UE())}};function pM(e){return e.x}function mM(e){return e.y}var gM=10,vM=Math.PI*(3-Math.sqrt(5)),yM=function(e){var t,n=1,r=.001,i=1-Math.pow(r,1/300),s=0,f=.6,m=new Map,x=N_(M),O=fM("tick","end"),T=function(){let fe=1;return()=>(fe=(1664525*fe+1013904223)%4294967296)/4294967296}();function M(){H(),O.call("tick",t),n<r&&(x.stop(),O.call("end",t))}function H(fe){var Ie,Pe,Le=e.length;fe===void 0&&(fe=1);for(var rt=0;rt<fe;++rt)for(n+=(s-n)*i,m.forEach(function(it){it(n)}),Ie=0;Ie<Le;++Ie)(Pe=e[Ie]).fx==null?Pe.x+=Pe.vx*=f:(Pe.x=Pe.fx,Pe.vx=0),Pe.fy==null?Pe.y+=Pe.vy*=f:(Pe.y=Pe.fy,Pe.vy=0);return t}function Z(){for(var fe,Ie=0,Pe=e.length;Ie<Pe;++Ie){if((fe=e[Ie]).index=Ie,fe.fx!=null&&(fe.x=fe.fx),fe.fy!=null&&(fe.y=fe.fy),isNaN(fe.x)||isNaN(fe.y)){var Le=gM*Math.sqrt(.5+Ie),rt=Ie*vM;fe.x=Le*Math.cos(rt),fe.y=Le*Math.sin(rt)}(isNaN(fe.vx)||isNaN(fe.vy))&&(fe.vx=fe.vy=0)}}function ue(fe){return fe.initialize&&fe.initialize(e,T),fe}return e==null&&(e=[]),Z(),t={tick:H,restart:function(){return x.restart(M),t},stop:function(){return x.stop(),t},nodes:function(fe){return arguments.length?(e=fe,Z(),m.forEach(ue),t):e},alpha:function(fe){return arguments.length?(n=+fe,t):n},alphaMin:function(fe){return arguments.length?(r=+fe,t):r},alphaDecay:function(fe){return arguments.length?(i=+fe,t):+i},alphaTarget:function(fe){return arguments.length?(s=+fe,t):s},velocityDecay:function(fe){return arguments.length?(f=1-fe,t):1-f},randomSource:function(fe){return arguments.length?(T=fe,m.forEach(ue),t):T},force:function(fe,Ie){return arguments.length>1?(Ie==null?m.delete(fe):m.set(fe,ue(Ie)),t):m.get(fe)},find:function(fe,Ie,Pe){var Le,rt,it,ut,st,mt=0,dt=e.length;for(Pe==null?Pe=1/0:Pe*=Pe,mt=0;mt<dt;++mt)(it=(Le=fe-(ut=e[mt]).x)*Le+(rt=Ie-ut.y)*rt)<Pe&&(st=ut,Pe=it);return st},on:function(fe,Ie){return arguments.length>1?(O.on(fe,Ie),t):O.on(fe)}}};function bM(e){return e.index}function I_(e,t){var n=e.get(t);if(!n)throw new Error("node not found: "+t);return n}const R_={center:function(e,t){var n,r=1;function i(){var s,f,m=n.length,x=0,O=0;for(s=0;s<m;++s)x+=(f=n[s]).x,O+=f.y;for(x=(x/m-e)*r,O=(O/m-t)*r,s=0;s<m;++s)(f=n[s]).x-=x,f.y-=O}return e==null&&(e=0),t==null&&(t=0),i.initialize=function(s){n=s},i.x=function(s){return arguments.length?(e=+s,i):e},i.y=function(s){return arguments.length?(t=+s,i):t},i.strength=function(s){return arguments.length?(r=+s,i):r},i},collide:function(e){var t,n,r,i=1,s=1;function f(){for(var O,T,M,H,Z,ue,fe,Ie=t.length,Pe=0;Pe<s;++Pe)for(T=PE(t,sM,uM).visitAfter(m),O=0;O<Ie;++O)M=t[O],ue=n[M.index],fe=ue*ue,H=M.x+M.vx,Z=M.y+M.vy,T.visit(Le);function Le(rt,it,ut,st,mt){var dt=rt.data,en=rt.r,mn=ue+en;if(!dt)return it>H+mn||st<H-mn||ut>Z+mn||mt<Z-mn;if(dt.index>M.index){var sn=H-dt.x-dt.vx,In=Z-dt.y-dt.vy,Fn=sn*sn+In*In;Fn<mn*mn&&(sn===0&&(Fn+=(sn=Iv(r))*sn),In===0&&(Fn+=(In=Iv(r))*In),Fn=(mn-(Fn=Math.sqrt(Fn)))/Fn*i,M.vx+=(sn*=Fn)*(mn=(en*=en)/(fe+en)),M.vy+=(In*=Fn)*mn,dt.vx-=sn*(mn=1-mn),dt.vy-=In*mn)}}}function m(O){if(O.data)return O.r=n[O.data.index];for(var T=O.r=0;T<4;++T)O[T]&&O[T].r>O.r&&(O.r=O[T].r)}function x(){if(t){var O,T,M=t.length;for(n=new Array(M),O=0;O<M;++O)T=t[O],n[T.index]=+e(T,O,t)}}return typeof e!="function"&&(e=dh(e==null?1:+e)),f.initialize=function(O,T){t=O,r=T,x()},f.iterations=function(O){return arguments.length?(s=+O,f):s},f.strength=function(O){return arguments.length?(i=+O,f):i},f.radius=function(O){return arguments.length?(e=typeof O=="function"?O:dh(+O),x(),f):e},f},nbody:function(){var e,t,n,r,i,s=dh(-30),f=1,m=1/0,x=.81;function O(Z){var ue,fe=e.length,Ie=PE(e,pM,mM).visitAfter(M);for(r=Z,ue=0;ue<fe;++ue)t=e[ue],Ie.visit(H)}function T(){if(e){var Z,ue,fe=e.length;for(i=new Array(fe),Z=0;Z<fe;++Z)ue=e[Z],i[ue.index]=+s(ue,Z,e)}}function M(Z){var ue,fe,Ie,Pe,Le,rt=0,it=0;if(Z.length){for(Ie=Pe=Le=0;Le<4;++Le)(ue=Z[Le])&&(fe=Math.abs(ue.value))&&(rt+=ue.value,it+=fe,Ie+=fe*ue.x,Pe+=fe*ue.y);Z.x=Ie/it,Z.y=Pe/it}else{(ue=Z).x=ue.data.x,ue.y=ue.data.y;do rt+=i[ue.data.index];while(ue=ue.next)}Z.value=rt}function H(Z,ue,fe,Ie){if(!Z.value)return!0;var Pe=Z.x-t.x,Le=Z.y-t.y,rt=Ie-ue,it=Pe*Pe+Le*Le;if(rt*rt/x<it)return it<m&&(Pe===0&&(it+=(Pe=Iv(n))*Pe),Le===0&&(it+=(Le=Iv(n))*Le),it<f&&(it=Math.sqrt(f*it)),t.vx+=Pe*Z.value*r/it,t.vy+=Le*Z.value*r/it),!0;if(!(Z.length||it>=m)){(Z.data!==t||Z.next)&&(Pe===0&&(it+=(Pe=Iv(n))*Pe),Le===0&&(it+=(Le=Iv(n))*Le),it<f&&(it=Math.sqrt(f*it)));do Z.data!==t&&(rt=i[Z.data.index]*r/it,t.vx+=Pe*rt,t.vy+=Le*rt);while(Z=Z.next)}}return O.initialize=function(Z,ue){e=Z,n=ue,T()},O.strength=function(Z){return arguments.length?(s=typeof Z=="function"?Z:dh(+Z),T(),O):s},O.distanceMin=function(Z){return arguments.length?(f=Z*Z,O):Math.sqrt(f)},O.distanceMax=function(Z){return arguments.length?(m=Z*Z,O):Math.sqrt(m)},O.theta=function(Z){return arguments.length?(x=Z*Z,O):Math.sqrt(x)},O},link:function(e){var t,n,r,i,s,f,m=bM,x=function(fe){return 1/Math.min(i[fe.source.index],i[fe.target.index])},O=dh(30),T=1;function M(fe){for(var Ie=0,Pe=e.length;Ie<T;++Ie)for(var Le,rt,it,ut,st,mt,dt,en=0;en<Pe;++en)rt=(Le=e[en]).source,ut=(it=Le.target).x+it.vx-rt.x-rt.vx||Iv(f),st=it.y+it.vy-rt.y-rt.vy||Iv(f),ut*=mt=((mt=Math.sqrt(ut*ut+st*st))-n[en])/mt*fe*t[en],st*=mt,it.vx-=ut*(dt=s[en]),it.vy-=st*dt,rt.vx+=ut*(dt=1-dt),rt.vy+=st*dt}function H(){if(r){var fe,Ie,Pe=r.length,Le=e.length,rt=new Map(r.map((it,ut)=>[m(it,ut,r),it]));for(fe=0,i=new Array(Pe);fe<Le;++fe)(Ie=e[fe]).index=fe,typeof Ie.source!="object"&&(Ie.source=I_(rt,Ie.source)),typeof Ie.target!="object"&&(Ie.target=I_(rt,Ie.target)),i[Ie.source.index]=(i[Ie.source.index]||0)+1,i[Ie.target.index]=(i[Ie.target.index]||0)+1;for(fe=0,s=new Array(Le);fe<Le;++fe)Ie=e[fe],s[fe]=i[Ie.source.index]/(i[Ie.source.index]+i[Ie.target.index]);t=new Array(Le),Z(),n=new Array(Le),ue()}}function Z(){if(r)for(var fe=0,Ie=e.length;fe<Ie;++fe)t[fe]=+x(e[fe],fe,e)}function ue(){if(r)for(var fe=0,Ie=e.length;fe<Ie;++fe)n[fe]=+O(e[fe],fe,e)}return e==null&&(e=[]),M.initialize=function(fe,Ie){r=fe,f=Ie,H()},M.links=function(fe){return arguments.length?(e=fe,H(),M):e},M.id=function(fe){return arguments.length?(m=fe,M):m},M.iterations=function(fe){return arguments.length?(T=+fe,M):T},M.strength=function(fe){return arguments.length?(x=typeof fe=="function"?fe:dh(+fe),Z(),M):x},M.distance=function(fe){return arguments.length?(O=typeof fe=="function"?fe:dh(+fe),ue(),M):O},M},x:function(e){var t,n,r,i=dh(.1);function s(m){for(var x,O=0,T=t.length;O<T;++O)(x=t[O]).vx+=(r[O]-x.x)*n[O]*m}function f(){if(t){var m,x=t.length;for(n=new Array(x),r=new Array(x),m=0;m<x;++m)n[m]=isNaN(r[m]=+e(t[m],m,t))?0:+i(t[m],m,t)}}return typeof e!="function"&&(e=dh(e==null?0:+e)),s.initialize=function(m){t=m,f()},s.strength=function(m){return arguments.length?(i=typeof m=="function"?m:dh(+m),f(),s):i},s.x=function(m){return arguments.length?(e=typeof m=="function"?m:dh(+m),f(),s):e},s},y:function(e){var t,n,r,i=dh(.1);function s(m){for(var x,O=0,T=t.length;O<T;++O)(x=t[O]).vy+=(r[O]-x.y)*n[O]*m}function f(){if(t){var m,x=t.length;for(n=new Array(x),r=new Array(x),m=0;m<x;++m)n[m]=isNaN(r[m]=+e(t[m],m,t))?0:+i(t[m],m,t)}}return typeof e!="function"&&(e=dh(e==null?0:+e)),s.initialize=function(m){t=m,f()},s.strength=function(m){return arguments.length?(i=typeof m=="function"?m:dh(+m),f(),s):i},s.y=function(m){return arguments.length?(e=typeof m=="function"?m:dh(+m),f(),s):e},s}},cb="forces",WE=["alpha","alphaMin","alphaTarget","velocityDecay","forces"],xM=["static","iterations"],M_=["x","y","vx","vy"];function VE(e){Ot.call(this,null,e)}function j_(e,t,n,r){var i,s,f,m,x=Object(be.i)(t.forces);for(i=0,s=WE.length;i<s;++i)(f=WE[i])!==cb&&t.modified(f)&&e[f](t[f]);for(i=0,s=x.length;i<s;++i)m=cb+i,(f=n||t.modified(cb,i)?kM(x[i]):r&&wM(x[i],r)?e.force(m):null)&&e.force(m,f);for(s=e.numForces||0;i<s;++i)e.force(cb+i,null);return e.numForces=x.length,e}function wM(e,t){var n,r;for(n in e)if(Object(be.E)(r=e[n])&&t.modified(Object(be.g)(r)))return 1;return 0}function kM(e){var t,n;for(n in Object(be.w)(R_,e.force)||Object(be.o)("Unrecognized force: "+e.force),t=R_[e.force](),e)Object(be.E)(t[n])&&EM(t[n],e[n],e);return t}function EM(e,t,n){e(Object(be.E)(t)?r=>t(r,n):t)}function CM(e){var t=0,n=e.children,r=n&&n.length;if(r)for(;--r>=0;)t+=n[r].value;else t=1;e.value=t}VE.Definition={type:"Force",metadata:{modifies:!0},params:[{name:"static",type:"boolean",default:!1},{name:"restart",type:"boolean",default:!1},{name:"iterations",type:"number",default:300},{name:"alpha",type:"number",default:1},{name:"alphaMin",type:"number",default:.001},{name:"alphaTarget",type:"number",default:0},{name:"velocityDecay",type:"number",default:.4},{name:"forces",type:"param",array:!0,params:[{key:{force:"center"},params:[{name:"x",type:"number",default:0},{name:"y",type:"number",default:0}]},{key:{force:"collide"},params:[{name:"radius",type:"number",expr:!0},{name:"strength",type:"number",default:.7},{name:"iterations",type:"number",default:1}]},{key:{force:"nbody"},params:[{name:"strength",type:"number",default:-30},{name:"theta",type:"number",default:.9},{name:"distanceMin",type:"number",default:1},{name:"distanceMax",type:"number"}]},{key:{force:"link"},params:[{name:"links",type:"data"},{name:"id",type:"field"},{name:"distance",type:"number",default:30,expr:!0},{name:"strength",type:"number",expr:!0},{name:"iterations",type:"number",default:1}]},{key:{force:"x"},params:[{name:"strength",type:"number",default:.1},{name:"x",type:"field"}]},{key:{force:"y"},params:[{name:"strength",type:"number",default:.1},{name:"y",type:"field"}]}]},{name:"as",type:"string",array:!0,modify:!1,default:M_}]},Object(be.z)(VE,Ot,{transform(e,t){var n=this.value,r=t.changed(t.ADD_REM),i=e.modified(WE),s=e.iterations||300;if(n?(r&&(t.modifies("index"),n.nodes(t.source)),(i||t.changed(t.MOD))&&j_(n,e,0,t)):(this.value=n=function(f,m){const x=yM(f),O=x.stop,T=x.restart;let M=!1;return x.stopped=()=>M,x.restart=()=>(M=!1,T()),x.stop=()=>(M=!0,O()),j_(x,m,!0).on("end",()=>M=!0)}(t.source,e),n.on("tick",function(f,m){return()=>f.touch(m).run()}(t.dataflow,this)),e.static||(r=!0,n.tick()),t.modifies("index")),i||r||e.modified(xM)||t.changed()&&e.restart){if(n.alpha(Math.max(n.alpha(),e.alpha||1)).alphaDecay(1-Math.pow(n.alphaMin(),1/s)),e.static)for(n.stop();--s>=0;)n.tick();else if(n.stopped()&&n.restart(),!r)return t.StopPropagation}return this.finish(e,t)},finish(e,t){const n=t.dataflow;for(let m,x=this._argops,O=0,T=x.length;O<T;++O)if((m=x[O]).name===cb&&m.op._argval.force==="link"){for(var r,i=m.op._argops,s=0,f=i.length;s<f;++s)if(i[s].name==="links"&&(r=i[s].op.source)){n.pulse(r,n.changeset().reflow());break}}return t.reflow(e.modified()).modifies(M_)}});function qE(e,t){e instanceof Map?(e=[void 0,e],t===void 0&&(t=AM)):t===void 0&&(t=OM);for(var n,r,i,s,f,m=new h1(e),x=[m];n=x.pop();)if((i=t(n.data))&&(f=(i=Array.from(i)).length))for(n.children=i,s=f-1;s>=0;--s)x.push(r=i[s]=new h1(i[s])),r.parent=n,r.depth=n.depth+1;return m.eachBefore(B_)}function OM(e){return e.children}function AM(e){return Array.isArray(e)?e[1]:null}function SM(e){e.data.value!==void 0&&(e.value=e.data.value),e.data=e.data.data}function B_(e){var t=0;do e.height=t;while((e=e.parent)&&e.height<++t)}function h1(e){this.data=e,this.depth=this.height=0,this.parent=null}h1.prototype=qE.prototype={constructor:h1,count:function(){return this.eachAfter(CM)},each:function(e,t){let n=-1;for(const r of this)e.call(t,r,++n,this);return this},eachAfter:function(e,t){for(var n,r,i,s=this,f=[s],m=[],x=-1;s=f.pop();)if(m.push(s),n=s.children)for(r=0,i=n.length;r<i;++r)f.push(n[r]);for(;s=m.pop();)e.call(t,s,++x,this);return this},eachBefore:function(e,t){for(var n,r,i=this,s=[i],f=-1;i=s.pop();)if(e.call(t,i,++f,this),n=i.children)for(r=n.length-1;r>=0;--r)s.push(n[r]);return this},find:function(e,t){let n=-1;for(const r of this)if(e.call(t,r,++n,this))return r},sum:function(e){return this.eachAfter(function(t){for(var n=+e(t.data)||0,r=t.children,i=r&&r.length;--i>=0;)n+=r[i].value;t.value=n})},sort:function(e){return this.eachBefore(function(t){t.children&&t.children.sort(e)})},path:function(e){for(var t=this,n=function(s,f){if(s===f)return s;var m=s.ancestors(),x=f.ancestors(),O=null;for(s=m.pop(),f=x.pop();s===f;)O=s,s=m.pop(),f=x.pop();return O}(t,e),r=[t];t!==n;)t=t.parent,r.push(t);for(var i=r.length;e!==n;)r.splice(i,0,e),e=e.parent;return r},ancestors:function(){for(var e=this,t=[e];e=e.parent;)t.push(e);return t},descendants:function(){return Array.from(this)},leaves:function(){var e=[];return this.eachBefore(function(t){t.children||e.push(t)}),e},links:function(){var e=this,t=[];return e.each(function(n){n!==e&&t.push({source:n.parent,target:n})}),t},copy:function(){return qE(this).eachBefore(SM)},[Symbol.iterator]:function*(){var e,t,n,r,i=this,s=[i];do for(e=s.reverse(),s=[];i=e.pop();)if(yield i,t=i.children)for(n=0,r=t.length;n<r;++n)s.push(t[n]);while(s.length)}};var _M=function(e){return typeof e=="object"&&"length"in e?e:Array.from(e)},DM=function(e){for(var t,n,r=0,i=(e=function(f){for(var m,x,O=f.length;O;)x=Math.random()*O--|0,m=f[O],f[O]=f[x],f[x]=m;return f}(Array.from(e))).length,s=[];r<i;)t=e[r],n&&P_(n,t)?++r:(n=NM(s=TM(s,t)),r=0);return n};function TM(e,t){var n,r;if(HE(t,e))return[t];for(n=0;n<e.length;++n)if(v2(t,e[n])&&HE(lb(e[n],t),e))return[e[n],t];for(n=0;n<e.length-1;++n)for(r=n+1;r<e.length;++r)if(v2(lb(e[n],e[r]),t)&&v2(lb(e[n],t),e[r])&&v2(lb(e[r],t),e[n])&&HE(L_(e[n],e[r],t),e))return[e[n],e[r],t];throw new Error}function v2(e,t){var n=e.r-t.r,r=t.x-e.x,i=t.y-e.y;return n<0||n*n<r*r+i*i}function P_(e,t){var n=e.r-t.r+1e-9*Math.max(e.r,t.r,1),r=t.x-e.x,i=t.y-e.y;return n>0&&n*n>r*r+i*i}function HE(e,t){for(var n=0;n<t.length;++n)if(!P_(e,t[n]))return!1;return!0}function NM(e){switch(e.length){case 1:return function(t){return{x:t.x,y:t.y,r:t.r}}(e[0]);case 2:return lb(e[0],e[1]);case 3:return L_(e[0],e[1],e[2])}}function lb(e,t){var n=e.x,r=e.y,i=e.r,s=t.x,f=t.y,m=t.r,x=s-n,O=f-r,T=m-i,M=Math.sqrt(x*x+O*O);return{x:(n+s+x/M*T)/2,y:(r+f+O/M*T)/2,r:(M+i+m)/2}}function L_(e,t,n){var r=e.x,i=e.y,s=e.r,f=t.x,m=t.y,x=t.r,O=n.x,T=n.y,M=n.r,H=r-f,Z=r-O,ue=i-m,fe=i-T,Ie=x-s,Pe=M-s,Le=r*r+i*i-s*s,rt=Le-f*f-m*m+x*x,it=Le-O*O-T*T+M*M,ut=Z*ue-H*fe,st=(ue*it-fe*rt)/(2*ut)-r,mt=(fe*Ie-ue*Pe)/ut,dt=(Z*rt-H*it)/(2*ut)-i,en=(H*Pe-Z*Ie)/ut,mn=mt*mt+en*en-1,sn=2*(s+st*mt+dt*en),In=st*st+dt*dt-s*s,Fn=-(mn?(sn+Math.sqrt(sn*sn-4*mn*In))/(2*mn):In/sn);return{x:r+st+mt*Fn,y:i+dt+en*Fn,r:Fn}}function z_(e,t,n){var r,i,s,f,m=e.x-t.x,x=e.y-t.y,O=m*m+x*x;O?(i=t.r+n.r,i*=i,f=e.r+n.r,i>(f*=f)?(r=(O+f-i)/(2*O),s=Math.sqrt(Math.max(0,f/O-r*r)),n.x=e.x-r*m-s*x,n.y=e.y-r*x+s*m):(r=(O+i-f)/(2*O),s=Math.sqrt(Math.max(0,i/O-r*r)),n.x=t.x+r*m-s*x,n.y=t.y+r*x+s*m)):(n.x=t.x+n.r,n.y=t.y)}function U_(e,t){var n=e.r+t.r-1e-6,r=t.x-e.x,i=t.y-e.y;return n>0&&n*n>r*r+i*i}function W_(e){var t=e._,n=e.next._,r=t.r+n.r,i=(t.x*n.r+n.x*t.r)/r,s=(t.y*n.r+n.y*t.r)/r;return i*i+s*s}function y2(e){this._=e,this.next=null,this.previous=null}function FM(e){if(!(i=(e=_M(e)).length))return 0;var t,n,r,i,s,f,m,x,O,T,M;if((t=e[0]).x=0,t.y=0,!(i>1))return t.r;if(n=e[1],t.x=-n.r,n.x=t.r,n.y=0,!(i>2))return t.r+n.r;z_(n,t,r=e[2]),t=new y2(t),n=new y2(n),r=new y2(r),t.next=r.previous=n,n.next=t.previous=r,r.next=n.previous=t;e:for(m=3;m<i;++m){z_(t._,n._,r=e[m]),r=new y2(r),x=n.next,O=t.previous,T=n._.r,M=t._.r;do if(T<=M){if(U_(x._,r._)){n=x,t.next=n,n.previous=t,--m;continue e}T+=x._.r,x=x.next}else{if(U_(O._,r._)){(t=O).next=n,n.previous=t,--m;continue e}M+=O._.r,O=O.previous}while(x!==O.next);for(r.previous=t,r.next=n,t.next=n.previous=n=r,s=W_(t);(r=r.next)!==n;)(f=W_(r))<s&&(t=r,s=f);n=t.next}for(t=[n._],r=n;(r=r.next)!==n;)t.push(r._);for(r=DM(t),m=0;m<i;++m)(t=e[m]).x-=r.x,t.y-=r.y;return r.r}function b2(e){if(typeof e!="function")throw new Error;return e}function dy(){return 0}var d1=function(e){return function(){return e}};function IM(e){return Math.sqrt(e.value)}function V_(e){return function(t){t.children||(t.r=Math.max(0,+e(t)||0))}}function $E(e,t){return function(n){if(r=n.children){var r,i,s,f=r.length,m=e(n)*t||0;if(m)for(i=0;i<f;++i)r[i].r+=m;if(s=FM(r),m)for(i=0;i<f;++i)r[i].r-=m;n.r=s+m}}}function q_(e){return function(t){var n=t.parent;t.r*=e,n&&(t.x=n.x+e*t.x,t.y=n.y+e*t.y)}}var H_=function(e){e.x0=Math.round(e.x0),e.y0=Math.round(e.y0),e.x1=Math.round(e.x1),e.y1=Math.round(e.y1)},fb=function(e,t,n,r,i){for(var s,f=e.children,m=-1,x=f.length,O=e.value&&(r-t)/e.value;++m<x;)(s=f[m]).y0=n,s.y1=i,s.x0=t,s.x1=t+=s.value*O},RM={depth:-1},$_={};function MM(e){return e.id}function jM(e){return e.parentId}var G_=function(){var e=MM,t=jM;function n(r){var i,s,f,m,x,O,T,M=Array.from(r),H=M.length,Z=new Map;for(s=0;s<H;++s)i=M[s],x=M[s]=new h1(i),(O=e(i,s,r))!=null&&(O+="")&&(T=x.id=O,Z.set(T,Z.has(T)?$_:x)),(O=t(i,s,r))!=null&&(O+="")&&(x.parent=O);for(s=0;s<H;++s)if(O=(x=M[s]).parent){if(!(m=Z.get(O)))throw new Error("missing: "+O);if(m===$_)throw new Error("ambiguous: "+O);m.children?m.children.push(x):m.children=[x],x.parent=m}else{if(f)throw new Error("multiple roots");f=x}if(!f)throw new Error("no root");if(f.parent=RM,f.eachBefore(function(ue){ue.depth=ue.parent.depth+1,--H}).eachBefore(B_),f.parent=null,H>0)throw new Error("cycle");return f}return n.id=function(r){return arguments.length?(e=b2(r),n):e},n.parentId=function(r){return arguments.length?(t=b2(r),n):t},n};function BM(e,t){return e.parent===t.parent?1:2}function GE(e){var t=e.children;return t?t[0]:e.t}function KE(e){var t=e.children;return t?t[t.length-1]:e.t}function PM(e,t,n){var r=n/(t.i-e.i);t.c-=r,t.s+=n,e.c+=r,t.z+=n,t.m+=n}function LM(e,t,n){return e.a.parent===t.parent?e.a:n}function x2(e,t){this._=e,this.parent=null,this.children=null,this.A=null,this.a=this,this.z=0,this.m=0,this.c=0,this.s=0,this.t=null,this.i=t}x2.prototype=Object.create(h1.prototype);function zM(e,t){return e.parent===t.parent?1:2}function UM(e,t){return e+t.x}function WM(e,t){return Math.max(e,t.y)}var w2=function(e,t,n,r,i){for(var s,f=e.children,m=-1,x=f.length,O=e.value&&(i-n)/e.value;++m<x;)(s=f[m]).x0=t,s.x1=r,s.y0=n,s.y1=n+=s.value*O},K_=(1+Math.sqrt(5))/2;function X_(e,t,n,r,i,s){for(var f,m,x,O,T,M,H,Z,ue,fe,Ie,Pe=[],Le=t.children,rt=0,it=0,ut=Le.length,st=t.value;rt<ut;){x=i-n,O=s-r;do T=Le[it++].value;while(!T&&it<ut);for(M=H=T,Ie=T*T*(fe=Math.max(O/x,x/O)/(st*e)),ue=Math.max(H/Ie,Ie/M);it<ut;++it){if(T+=m=Le[it].value,m<M&&(M=m),m>H&&(H=m),Ie=T*T*fe,(Z=Math.max(H/Ie,Ie/M))>ue){T-=m;break}ue=Z}Pe.push(f={value:T,dice:x<O,children:Le.slice(rt,it)}),f.dice?fb(f,n,r,i,st?r+=O*T/st:s):w2(f,n,r,st?n+=x*T/st:i,s),st-=T,rt=it}return Pe}var Y_=function e(t){function n(r,i,s,f,m){X_(t,r,i,s,f,m)}return n.ratio=function(r){return e((r=+r)>1?r:1)},n}(K_),VM=function e(t){function n(r,i,s,f,m){if((x=r._squarify)&&x.ratio===t)for(var x,O,T,M,H,Z=-1,ue=x.length,fe=r.value;++Z<ue;){for(T=(O=x[Z]).children,M=O.value=0,H=T.length;M<H;++M)O.value+=T[M].value;O.dice?fb(O,i,s,f,fe?s+=(m-s)*O.value/fe:m):w2(O,i,s,fe?i+=(f-i)*O.value/fe:f,m),fe-=O.value}else r._squarify=x=X_(t,r,i,s,f,m),x.ratio=t}return n.ratio=function(r){return e((r=+r)>1?r:1)},n}(K_);function XE(e,t,n){const r={};return e.each(i=>{const s=i.data;n(s)&&(r[t(s)]=i)}),e.lookup=r,e}function YE(e){Ot.call(this,null,e)}YE.Definition={type:"Nest",metadata:{treesource:!0,changes:!0},params:[{name:"keys",type:"field",array:!0},{name:"generate",type:"boolean"}]};const qM=e=>e.values;function H0(e){Ot.call(this,null,e)}Object(be.z)(YE,Ot,{transform(e,t){t.source||Object(be.o)("Nest transform requires an upstream data source.");var n=e.generate,r=e.modified(),i=t.clone(),s=this.value;return(!s||r||t.changed())&&(s&&s.each(f=>{f.children&&Kt(f.data)&&i.rem.push(f.data)}),this.value=s=qE({values:Object(be.i)(e.keys).reduce((f,m)=>(f.key(m),f),function(){const f=[],m={entries:x=>function O(T,M){if(++M>f.length)return T;const H=[];for(const Z in T)H.push({key:Z,values:O(T[Z],M)});return H}(function O(T,M){if(M>=f.length)return T;const H=T.length,Z=f[M++],ue={},fe={};let Ie,Pe,Le,rt=-1;for(;++rt<H;)Ie=Z(Pe=T[rt])+"",(Le=ue[Ie])?Le.push(Pe):ue[Ie]=[Pe];for(Ie in ue)fe[Ie]=O(ue[Ie],M);return fe}(x,0),0),key:x=>(f.push(x),m)};return m}()).entries(i.source)},qM),n&&s.each(f=>{f.children&&(f=Dn(f.data),i.add.push(f),i.source.push(f))}),XE(s,Zt,Zt)),i.source.root=s,i}});const HM=(e,t)=>e.parent===t.parent?1:2;Object(be.z)(H0,Ot,{transform(e,t){t.source&&t.source.root||Object(be.o)(this.constructor.name+" transform requires a backing tree data source.");const n=this.layout(e.method),r=this.fields,i=t.source.root,s=e.as||r;e.field?i.sum(e.field):i.count(),e.sort&&i.sort(Qr(e.sort,f=>f.data)),function(f,m,x){for(let O,T=0,M=m.length;T<M;++T)(O=m[T])in x&&f[O](x[O])}(n,this.params,e),n.separation&&n.separation(e.separation!==!1?HM:be.Q);try{this.value=n(i)}catch(f){Object(be.o)(f)}return i.each(f=>function(m,x,O){const T=m.data,M=x.length-1;for(let H=0;H<M;++H)T[O[H]]=m[x[H]];T[O[M]]=m.children?m.children.length:0}(f,r,s)),t.reflow(e.modified()).modifies(s).modifies("leaf")}});const JE=["x","y","r","depth","children"];function QE(e){H0.call(this,e)}QE.Definition={type:"Pack",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"padding",type:"number",default:0},{name:"radius",type:"field",default:null},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:JE.length,default:JE}]},Object(be.z)(QE,H0,{layout:function(){var e=null,t=1,n=1,r=dy;function i(s){return s.x=t/2,s.y=n/2,e?s.eachBefore(V_(e)).eachAfter($E(r,.5)).eachBefore(q_(1)):s.eachBefore(V_(IM)).eachAfter($E(dy,1)).eachAfter($E(r,s.r/Math.min(t,n))).eachBefore(q_(Math.min(t,n)/(2*s.r))),s}return i.radius=function(s){return arguments.length?(e=function(f){return f==null?null:b2(f)}(s),i):e},i.size=function(s){return arguments.length?(t=+s[0],n=+s[1],i):[t,n]},i.padding=function(s){return arguments.length?(r=typeof s=="function"?s:d1(+s),i):r},i},params:["radius","size","padding"],fields:JE});const ZE=["x0","y0","x1","y1","depth","children"];function e3(e){H0.call(this,e)}function t3(e){Ot.call(this,null,e)}e3.Definition={type:"Partition",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"padding",type:"number",default:0},{name:"round",type:"boolean",default:!1},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:ZE.length,default:ZE}]},Object(be.z)(e3,H0,{layout:function(){var e=1,t=1,n=0,r=!1;function i(s){var f=s.height+1;return s.x0=s.y0=n,s.x1=e,s.y1=t/f,s.eachBefore(function(m,x){return function(O){O.children&&fb(O,O.x0,m*(O.depth+1)/x,O.x1,m*(O.depth+2)/x);var T=O.x0,M=O.y0,H=O.x1-n,Z=O.y1-n;H<T&&(T=H=(T+H)/2),Z<M&&(M=Z=(M+Z)/2),O.x0=T,O.y0=M,O.x1=H,O.y1=Z}}(t,f)),r&&s.eachBefore(H_),s}return i.round=function(s){return arguments.length?(r=!!s,i):r},i.size=function(s){return arguments.length?(e=+s[0],t=+s[1],i):[e,t]},i.padding=function(s){return arguments.length?(n=+s,i):n},i},params:["size","round","padding"],fields:ZE}),t3.Definition={type:"Stratify",metadata:{treesource:!0},params:[{name:"key",type:"field",required:!0},{name:"parentKey",type:"field",required:!0}]},Object(be.z)(t3,Ot,{transform(e,t){t.source||Object(be.o)("Stratify transform requires an upstream data source.");let n=this.value;const r=e.modified(),i=t.fork(t.ALL).materialize(t.SOURCE),s=!n||r||t.changed(t.ADD_REM)||t.modified(e.key.fields)||t.modified(e.parentKey.fields);return i.source=i.source.slice(),s&&(n=i.source.length?XE(G_().id(e.key).parentId(e.parentKey)(i.source),e.key,be.Ia):XE(G_()([{}]),e.key,e.key)),i.source.root=this.value=n,i}});const J_={tidy:function(){var e=BM,t=1,n=1,r=null;function i(x){var O=function(Pe){for(var Le,rt,it,ut,st,mt=new x2(Pe,0),dt=[mt];Le=dt.pop();)if(it=Le._.children)for(Le.children=new Array(st=it.length),ut=st-1;ut>=0;--ut)dt.push(rt=Le.children[ut]=new x2(it[ut],ut)),rt.parent=Le;return(mt.parent=new x2(null,0)).children=[mt],mt}(x);if(O.eachAfter(s),O.parent.m=-O.z,O.eachBefore(f),r)x.eachBefore(m);else{var T=x,M=x,H=x;x.eachBefore(function(Pe){Pe.x<T.x&&(T=Pe),Pe.x>M.x&&(M=Pe),Pe.depth>H.depth&&(H=Pe)});var Z=T===M?1:e(T,M)/2,ue=Z-T.x,fe=t/(M.x+Z+ue),Ie=n/(H.depth||1);x.eachBefore(function(Pe){Pe.x=(Pe.x+ue)*fe,Pe.y=Pe.depth*Ie})}return x}function s(x){var O=x.children,T=x.parent.children,M=x.i?T[x.i-1]:null;if(O){(function(Z){for(var ue,fe=0,Ie=0,Pe=Z.children,Le=Pe.length;--Le>=0;)(ue=Pe[Le]).z+=fe,ue.m+=fe,fe+=ue.s+(Ie+=ue.c)})(x);var H=(O[0].z+O[O.length-1].z)/2;M?(x.z=M.z+e(x._,M._),x.m=x.z-H):x.z=H}else M&&(x.z=M.z+e(x._,M._));x.parent.A=function(Z,ue,fe){if(ue){for(var Ie,Pe=Z,Le=Z,rt=ue,it=Pe.parent.children[0],ut=Pe.m,st=Le.m,mt=rt.m,dt=it.m;rt=KE(rt),Pe=GE(Pe),rt&&Pe;)it=GE(it),(Le=KE(Le)).a=Z,(Ie=rt.z+mt-Pe.z-ut+e(rt._,Pe._))>0&&(PM(LM(rt,Z,fe),Z,Ie),ut+=Ie,st+=Ie),mt+=rt.m,ut+=Pe.m,dt+=it.m,st+=Le.m;rt&&!KE(Le)&&(Le.t=rt,Le.m+=mt-st),Pe&&!GE(it)&&(it.t=Pe,it.m+=ut-dt,fe=Z)}return fe}(x,M,x.parent.A||T[0])}function f(x){x._.x=x.z+x.parent.m,x.m+=x.parent.m}function m(x){x.x*=t,x.y=x.depth*n}return i.separation=function(x){return arguments.length?(e=x,i):e},i.size=function(x){return arguments.length?(r=!1,t=+x[0],n=+x[1],i):r?null:[t,n]},i.nodeSize=function(x){return arguments.length?(r=!0,t=+x[0],n=+x[1],i):r?[t,n]:null},i},cluster:function(){var e=zM,t=1,n=1,r=!1;function i(s){var f,m=0;s.eachAfter(function(H){var Z=H.children;Z?(H.x=function(ue){return ue.reduce(UM,0)/ue.length}(Z),H.y=function(ue){return 1+ue.reduce(WM,0)}(Z)):(H.x=f?m+=e(H,f):0,H.y=0,f=H)});var x=function(H){for(var Z;Z=H.children;)H=Z[0];return H}(s),O=function(H){for(var Z;Z=H.children;)H=Z[Z.length-1];return H}(s),T=x.x-e(x,O)/2,M=O.x+e(O,x)/2;return s.eachAfter(r?function(H){H.x=(H.x-s.x)*t,H.y=(s.y-H.y)*n}:function(H){H.x=(H.x-T)/(M-T)*t,H.y=(1-(s.y?H.y/s.y:1))*n})}return i.separation=function(s){return arguments.length?(e=s,i):e},i.size=function(s){return arguments.length?(r=!1,t=+s[0],n=+s[1],i):r?null:[t,n]},i.nodeSize=function(s){return arguments.length?(r=!0,t=+s[0],n=+s[1],i):r?[t,n]:null},i}},n3=["x","y","depth","children"];function r3(e){H0.call(this,e)}function i3(e){Ot.call(this,[],e)}r3.Definition={type:"Tree",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"method",type:"enum",default:"tidy",values:["tidy","cluster"]},{name:"size",type:"number",array:!0,length:2},{name:"nodeSize",type:"number",array:!0,length:2},{name:"separation",type:"boolean",default:!0},{name:"as",type:"string",array:!0,length:n3.length,default:n3}]},Object(be.z)(r3,H0,{layout(e){const t=e||"tidy";if(Object(be.w)(J_,t))return J_[t]();Object(be.o)("Unrecognized Tree layout method: "+t)},params:["size","nodeSize"],fields:n3}),i3.Definition={type:"TreeLinks",metadata:{tree:!0,generates:!0,changes:!0},params:[]},Object(be.z)(i3,Ot,{transform(e,t){const n=this.value,r=t.source&&t.source.root,i=t.fork(t.NO_SOURCE),s={};return r||Object(be.o)("TreeLinks transform requires a tree data source."),t.changed(t.ADD_REM)?(i.rem=n,t.visit(t.SOURCE,f=>s[Zt(f)]=1),r.each(f=>{const m=f.data,x=f.parent&&f.parent.data;x&&s[Zt(m)]&&s[Zt(x)]&&i.add.push(Dn({source:x,target:m}))}),this.value=i.add):t.changed(t.MOD)&&(t.visit(t.MOD,f=>s[Zt(f)]=1),n.forEach(f=>{(s[Zt(f.source)]||s[Zt(f.target)])&&i.mod.push(f)})),i}});const Q_={binary:function(e,t,n,r,i){var s,f,m=e.children,x=m.length,O=new Array(x+1);for(O[0]=f=s=0;s<x;++s)O[s+1]=f+=m[s].value;(function T(M,H,Z,ue,fe,Ie,Pe){if(M>=H-1){var Le=m[M];return Le.x0=ue,Le.y0=fe,Le.x1=Ie,void(Le.y1=Pe)}for(var rt=O[M],it=Z/2+rt,ut=M+1,st=H-1;ut<st;){var mt=ut+st>>>1;O[mt]<it?ut=mt+1:st=mt}it-O[ut-1]<O[ut]-it&&M+1<ut&&--ut;var dt=O[ut]-rt,en=Z-dt;if(Ie-ue>Pe-fe){var mn=Z?(ue*en+Ie*dt)/Z:Ie;T(M,ut,dt,ue,fe,mn,Pe),T(ut,H,en,mn,fe,Ie,Pe)}else{var sn=Z?(fe*en+Pe*dt)/Z:Pe;T(M,ut,dt,ue,fe,Ie,sn),T(ut,H,en,ue,sn,Ie,Pe)}})(0,x,e.value,t,n,r,i)},dice:fb,slice:w2,slicedice:function(e,t,n,r,i){(1&e.depth?w2:fb)(e,t,n,r,i)},squarify:Y_,resquarify:VM},o3=["x0","y0","x1","y1","depth","children"];function a3(e){H0.call(this,e)}a3.Definition={type:"Treemap",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"method",type:"enum",default:"squarify",values:["squarify","resquarify","binary","dice","slice","slicedice"]},{name:"padding",type:"number",default:0},{name:"paddingInner",type:"number",default:0},{name:"paddingOuter",type:"number",default:0},{name:"paddingTop",type:"number",default:0},{name:"paddingRight",type:"number",default:0},{name:"paddingBottom",type:"number",default:0},{name:"paddingLeft",type:"number",default:0},{name:"ratio",type:"number",default:1.618033988749895},{name:"round",type:"boolean",default:!1},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:o3.length,default:o3}]},Object(be.z)(a3,H0,{layout(){const e=function(){var t=Y_,n=!1,r=1,i=1,s=[0],f=dy,m=dy,x=dy,O=dy,T=dy;function M(Z){return Z.x0=Z.y0=0,Z.x1=r,Z.y1=i,Z.eachBefore(H),s=[0],n&&Z.eachBefore(H_),Z}function H(Z){var ue=s[Z.depth],fe=Z.x0+ue,Ie=Z.y0+ue,Pe=Z.x1-ue,Le=Z.y1-ue;Pe<fe&&(fe=Pe=(fe+Pe)/2),Le<Ie&&(Ie=Le=(Ie+Le)/2),Z.x0=fe,Z.y0=Ie,Z.x1=Pe,Z.y1=Le,Z.children&&(ue=s[Z.depth+1]=f(Z)/2,fe+=T(Z)-ue,Ie+=m(Z)-ue,Pe-=x(Z)-ue,Le-=O(Z)-ue,Pe<fe&&(fe=Pe=(fe+Pe)/2),Le<Ie&&(Ie=Le=(Ie+Le)/2),t(Z,fe,Ie,Pe,Le))}return M.round=function(Z){return arguments.length?(n=!!Z,M):n},M.size=function(Z){return arguments.length?(r=+Z[0],i=+Z[1],M):[r,i]},M.tile=function(Z){return arguments.length?(t=b2(Z),M):t},M.padding=function(Z){return arguments.length?M.paddingInner(Z).paddingOuter(Z):M.paddingInner()},M.paddingInner=function(Z){return arguments.length?(f=typeof Z=="function"?Z:d1(+Z),M):f},M.paddingOuter=function(Z){return arguments.length?M.paddingTop(Z).paddingRight(Z).paddingBottom(Z).paddingLeft(Z):M.paddingTop()},M.paddingTop=function(Z){return arguments.length?(m=typeof Z=="function"?Z:d1(+Z),M):m},M.paddingRight=function(Z){return arguments.length?(x=typeof Z=="function"?Z:d1(+Z),M):x},M.paddingBottom=function(Z){return arguments.length?(O=typeof Z=="function"?Z:d1(+Z),M):O},M.paddingLeft=function(Z){return arguments.length?(T=typeof Z=="function"?Z:d1(+Z),M):T},M}();return e.ratio=t=>{const n=e.tile();n.ratio&&e.tile(n.ratio(t))},e.method=t=>{Object(be.w)(Q_,t)?e.tile(Q_[t]):Object(be.o)("Unrecognized Treemap layout method: "+t)},e},params:["method","ratio","size","round","padding","paddingInner","paddingOuter","paddingTop","paddingRight","paddingBottom","paddingLeft"],fields:o3});const $M=4278190080,GM=268435456,KM=.0625;function XM(e,t,n,r){const i=e.width,s=e.height,f=n||r,m=Hs(i,s).getContext("2d");t.forEach(Ie=>function Pe(Le,rt,it){if(!rt.length)return;const ut=rt[0].mark.marktype;ut==="group"?rt.forEach(st=>{st.items.forEach(mt=>Pe(Le,mt.items,it))}):gl[ut].draw(Le,{items:it?rt.map(YM):rt})}(m,Ie,f));const x=new Uint32Array(m.getImageData(0,0,i,s).data.buffer),O=e.bitmap(),T=f&&e.bitmap();let M,H,Z,ue,fe;for(H=0;H<s;++H)for(M=0;M<i;++M)(fe=x[H*i+M]&$M)&&(Z=e(M),ue=e(H),r||O.set(Z,ue),f&&fe^GM&&T.set(Z,ue));return[O,T]}function YM(e){const t=wr(e,{});return t.stroke&&(t.strokeOpacity=1),t.fill&&(t.fillOpacity=KM,t.stroke="#000",t.strokeOpacity=1,t.strokeWidth=2),t}const $0=5,ph=31,hb=32,Rv=new Uint32Array(hb+1),eg=new Uint32Array(hb+1);eg[0]=0,Rv[0]=~eg[0];for(let e=1;e<=hb;++e)eg[e]=eg[e-1]<<1|1,Rv[e]=~eg[e];function JM(e,t,n){const r=Math.max(1,Math.sqrt(e*t/1e6)),i=~~((e+2*n+r)/r),s=~~((t+2*n+r)/r),f=m=>~~((m+n)/r);return f.invert=m=>m*r-n,f.bitmap=()=>function(m,x){const O=new Uint32Array(~~((m*x+hb)/hb));function T(H,Z){O[H]|=Z}function M(H,Z){O[H]&=Z}return{array:O,get:(H,Z)=>{const ue=Z*m+H;return O[ue>>>$0]&1<<(ue&ph)},set:(H,Z)=>{const ue=Z*m+H;T(ue>>>$0,1<<(ue&ph))},clear:(H,Z)=>{const ue=Z*m+H;M(ue>>>$0,~(1<<(ue&ph)))},getRange:(H,Z,ue,fe)=>{let Ie,Pe,Le,rt,it=fe;for(;it>=Z;--it)if((Le=(Ie=it*m+H)>>>$0)==(rt=(Pe=it*m+ue)>>>$0)){if(O[Le]&Rv[Ie&ph]&eg[1+(Pe&ph)])return!0}else{if(O[Le]&Rv[Ie&ph]||O[rt]&eg[1+(Pe&ph)])return!0;for(let ut=Le+1;ut<rt;++ut)if(O[ut])return!0}return!1},setRange:(H,Z,ue,fe)=>{let Ie,Pe,Le,rt,it;for(;Z<=fe;++Z)if((Le=(Ie=Z*m+H)>>>$0)==(rt=(Pe=Z*m+ue)>>>$0))T(Le,Rv[Ie&ph]&eg[1+(Pe&ph)]);else for(T(Le,Rv[Ie&ph]),T(rt,eg[1+(Pe&ph)]),it=Le+1;it<rt;++it)T(it,4294967295)},clearRange:(H,Z,ue,fe)=>{let Ie,Pe,Le,rt,it;for(;Z<=fe;++Z)if((Le=(Ie=Z*m+H)>>>$0)==(rt=(Pe=Z*m+ue)>>>$0))M(Le,eg[Ie&ph]|Rv[1+(Pe&ph)]);else for(M(Le,eg[Ie&ph]),M(rt,Rv[1+(Pe&ph)]),it=Le+1;it<rt;++it)M(it,0)},outOfBounds:(H,Z,ue,fe)=>H<0||Z<0||fe>=x||ue>=m}}(i,s),f.ratio=r,f.padding=n,f.width=e,f.height=t,f}function k2(e,t,n,r,i,s){let f=n/2;return e-f<0||e+f>i||t-(f=r/2)<0||t+f>s}function Mv(e,t,n,r,i,s,f,m){const x=i*s/(2*r),O=e(t-x),T=e(t+x),M=e(n-(s/=2)),H=e(n+s);return f.outOfBounds(O,M,T,H)||f.getRange(O,M,T,H)||m&&m.getRange(O,M,T,H)}const QM=[-1,-1,1,1],ZM=[-1,1,-1,1],e6=["right","center","left"],t6=["bottom","middle","top"];function Z_(e,t,n,r,i,s,f,m,x,O,T,M){return!(i.outOfBounds(e,n,t,r)||(M&&s?s.getRange(e,n,t,r)||!function(H,Z,ue,fe,Ie){return Ie[0]<=H&&ue<=Ie[2]&&Ie[3]<=Z&&fe<=Ie[5]}(f,x,m,O,T):i.getRange(e,n,t,r)))}const n6={"top-left":0,top:1,"top-right":2,left:4,middle:5,right:6,"bottom-left":8,bottom:9,"bottom-right":10},r6={naive:function(e,t,n,r){const i=e.width,s=e.height;return function(f){const m=f.datum.datum.items[r].items,x=m.length,O=f.datum.fontSize,T=ds.width(f.datum,f.datum.text);let M,H,Z,ue,fe,Ie,Pe,Le=0;for(let rt=0;rt<x;++rt)M=m[rt].x,Z=m[rt].y,fe=(M+(H=m[rt].x2===void 0?M:m[rt].x2))/2,Ie=(Z+(ue=m[rt].y2===void 0?Z:m[rt].y2))/2,(Pe=Math.abs(H-M+ue-Z))>=Le&&(Le=Pe,f.x=fe,f.y=Ie);return fe=T/2,Ie=O/2,M=f.x-fe,H=f.x+fe,Z=f.y-Ie,ue=f.y+Ie,f.align="center",M<0&&H<=i?f.align="left":0<=M&&i<H&&(f.align="right"),f.baseline="middle",Z<0&&ue<=s?f.baseline="top":0<=Z&&s<ue&&(f.baseline="bottom"),!0}},"reduced-search":function(e,t,n,r){const i=e.width,s=e.height,f=t[0],m=t[1];function x(O,T,M,H,Z){const ue=e.invert(O),fe=e.invert(T);let Ie,Pe=M,Le=s;if(!k2(ue,fe,H,Z,i,s)&&!Mv(e,ue,fe,Z,H,Pe,f,m)&&!Mv(e,ue,fe,Z,H,Z,f,null)){for(;Le-Pe>=1;)Mv(e,ue,fe,Z,H,Ie=(Pe+Le)/2,f,m)?Le=Ie:Pe=Ie;if(Pe>M)return[ue,fe,Pe,!0]}}return function(O){const T=O.datum.datum.items[r].items,M=T.length,H=O.datum.fontSize,Z=ds.width(O.datum,O.datum.text);let ue,fe,Ie,Pe,Le,rt,it,ut,st,mt,dt,en,mn,sn,In,Fn,zn,Vn=n?H:0,Qn=!1,mr=!1,Pr=0;for(let Cr=0;Cr<M;++Cr){for(ue=T[Cr].x,Ie=T[Cr].y,fe=T[Cr].x2===void 0?ue:T[Cr].x2,Pe=T[Cr].y2===void 0?Ie:T[Cr].y2,ue>fe&&(zn=ue,ue=fe,fe=zn),Ie>Pe&&(zn=Ie,Ie=Pe,Pe=zn),mt=~~(((st=e(ue))+(dt=e(fe)))/2),mn=~~(((en=e(Ie))+(sn=e(Pe)))/2),it=mt;it>=st;--it)for(ut=mn;ut>=en;--ut)(Fn=x(it,ut,Vn,Z,H))&&([O.x,O.y,Vn,Qn]=Fn);for(it=mt;it<=dt;++it)for(ut=mn;ut<=sn;++ut)(Fn=x(it,ut,Vn,Z,H))&&([O.x,O.y,Vn,Qn]=Fn);Qn||n||(Le=(ue+fe)/2,rt=(Ie+Pe)/2,(In=Math.abs(fe-ue+Pe-Ie))>=Pr&&!k2(Le,rt,Z,H,i,s)&&!Mv(e,Le,rt,H,Z,H,f,null)&&(Pr=In,O.x=Le,O.y=rt,mr=!0))}return!(!Qn&&!mr||(Le=Z/2,rt=H/2,f.setRange(e(O.x-Le),e(O.y-rt),e(O.x+Le),e(O.y+rt)),O.align="center",O.baseline="middle",0))}},floodfill:function(e,t,n,r){const i=e.width,s=e.height,f=t[0],m=t[1],x=e.bitmap();return function(O){const T=O.datum.datum.items[r].items,M=T.length,H=O.datum.fontSize,Z=ds.width(O.datum,O.datum.text),ue=[];let fe,Ie,Pe,Le,rt,it,ut,st,mt,dt,en,mn,sn=n?H:0,In=!1,Fn=!1,zn=0;for(let Vn=0;Vn<M;++Vn){for(fe=T[Vn].x,Pe=T[Vn].y,Ie=T[Vn].x2===void 0?fe:T[Vn].x2,Le=T[Vn].y2===void 0?Pe:T[Vn].y2,ue.push([e((fe+Ie)/2),e((Pe+Le)/2)]);ue.length;)if([ut,st]=ue.pop(),!(f.get(ut,st)||m.get(ut,st)||x.get(ut,st))){x.set(ut,st);for(let Qn=0;Qn<4;++Qn)rt=ut+QM[Qn],it=st+ZM[Qn],x.outOfBounds(rt,it,rt,it)||ue.push([rt,it]);if(rt=e.invert(ut),it=e.invert(st),mt=sn,dt=s,!k2(rt,it,Z,H,i,s)&&!Mv(e,rt,it,H,Z,mt,f,m)&&!Mv(e,rt,it,H,Z,H,f,null)){for(;dt-mt>=1;)Mv(e,rt,it,H,Z,en=(mt+dt)/2,f,m)?dt=en:mt=en;mt>sn&&(O.x=rt,O.y=it,sn=mt,In=!0)}}In||n||(rt=(fe+Ie)/2,it=(Pe+Le)/2,(mn=Math.abs(Ie-fe+Le-Pe))>=zn&&!k2(rt,it,Z,H,i,s)&&!Mv(e,rt,it,H,Z,H,f,null)&&(zn=mn,O.x=rt,O.y=it,Fn=!0))}return!(!In&&!Fn||(rt=Z/2,it=H/2,f.setRange(e(O.x-rt),e(O.y-it),e(O.x+rt),e(O.y+it)),O.align="center",O.baseline="middle",0))}}};function i6(e,t,n,r,i,s,f,m,x,O,T){if(!e.length)return e;const M=Math.max(r.length,i.length),H=function(mt,dt){const en=new Float64Array(dt),mn=mt.length;for(let sn=0;sn<mn;++sn)en[sn]=mt[sn]||0;for(let sn=mn;sn<dt;++sn)en[sn]=en[mn-1];return en}(r,M),Z=function(mt,dt){const en=new Int8Array(dt),mn=mt.length;for(let sn=0;sn<mn;++sn)en[sn]|=n6[mt[sn]];for(let sn=mn;sn<dt;++sn)en[sn]=en[mn-1];return en}(i,M),ue=function(mt){return mt&&mt.mark&&mt.mark.marktype}(e[0].datum),fe=ue==="group"&&e[0].datum.items[x].marktype,Ie=fe==="area",Pe=function(mt,dt,en,mn){const sn=In=>[In.x,In.x,In.x,In.y,In.y,In.y];return mt?mt==="line"||mt==="area"?In=>sn(In.datum):dt==="line"?In=>{const Fn=In.datum.items[mn].items;return sn(Fn.length?Fn[en==="start"?0:Fn.length-1]:{x:NaN,y:NaN})}:In=>{const Fn=In.datum.bounds;return[Fn.x1,(Fn.x1+Fn.x2)/2,Fn.x2,Fn.y1,(Fn.y1+Fn.y2)/2,Fn.y2]}:sn}(ue,fe,m,x),Le=JM(t[0],t[1],O),rt=Ie&&T==="naive",it=e.map(mt=>({datum:mt,opacity:0,x:void 0,y:void 0,align:void 0,baseline:void 0,boundary:Pe(mt)}));let ut;if(!rt){n&&it.sort((dt,en)=>n(dt.datum,en.datum));let mt=!1;for(let dt=0;dt<Z.length&&!mt;++dt)mt=Z[dt]===5||H[dt]<0;ue&&(f||Ie)&&(s=[e.map(dt=>dt.datum)].concat(s)),ut=s.length?XM(Le,s,mt,Ie):function(dt,en){const mn=dt.bitmap();return(en||[]).forEach(sn=>mn.set(dt(sn.boundary[0]),dt(sn.boundary[3]))),[mn,void 0]}(Le,f&&it)}const st=Ie?r6[T](Le,ut,f,x):function(mt,dt,en,mn){const sn=mt.width,In=mt.height,Fn=dt[0],zn=dt[1],Vn=mn.length;return function(Qn){const mr=Qn.boundary,Pr=Qn.datum.fontSize;if(mr[2]<0||mr[5]<0||mr[0]>sn||mr[3]>In)return!1;let Cr,Jr,gi,vi,zi,wi,yi,_i,vo,na,Ui,va,ya,Ha,Ns,Fs=0;for(let gs=0;gs<Vn;++gs){if(Cr=(3&en[gs])-1,Jr=(en[gs]>>>2&3)-1,gi=Cr===0&&Jr===0||mn[gs]<0,vi=Cr&&Jr?Math.SQRT1_2:1,zi=mn[gs]<0?-1:1,wi=mr[1+Cr]+mn[gs]*Cr*vi,_i=(Ui=mr[4+Jr]+zi*Pr*Jr/2+mn[gs]*Jr*vi)-Pr/2,vo=Ui+Pr/2,va=mt(wi),Ha=mt(_i),Ns=mt(vo),!Fs){if(!Z_(va,va,Ha,Ns,Fn,zn,wi,wi,_i,vo,mr,gi))continue;Fs=ds.width(Qn.datum,Qn.datum.text)}if(yi=(na=wi+zi*Fs*Cr/2)+Fs/2,Z_(va=mt(wi=na-Fs/2),ya=mt(yi),Ha,Ns,Fn,zn,wi,yi,_i,vo,mr,gi))return Qn.x=Cr?Cr*zi<0?yi:wi:na,Qn.y=Jr?Jr*zi<0?vo:_i:Ui,Qn.align=e6[Cr*zi+1],Qn.baseline=t6[Jr*zi+1],Fn.setRange(va,Ha,ya,Ns),!0}return!1}}(Le,ut,Z,H);return it.forEach(mt=>mt.opacity=+st(mt)),it}const s3=["x","y","opacity","align","baseline"],e4=["top-left","left","bottom-left","top","bottom","top-right","right","bottom-right"];function u3(e){Ot.call(this,null,e)}function t4(e,t){var n,r,i,s,f,m,x=[],O=function(T){return T(s)};if(t==null)x.push(e);else for(n={},r=0,i=e.length;r<i;++r)s=e[r],(m=n[f=t.map(O)])||(n[f]=m=[],m.dims=f,x.push(m)),m.push(s);return x}function c3(e){Ot.call(this,null,e)}u3.Definition={type:"Label",metadata:{modifies:!0},params:[{name:"size",type:"number",array:!0,length:2,required:!0},{name:"sort",type:"compare"},{name:"anchor",type:"string",array:!0,default:e4},{name:"offset",type:"number",array:!0,default:[1]},{name:"padding",type:"number",default:0},{name:"lineAnchor",type:"string",values:["start","end"],default:"end"},{name:"markIndex",type:"number",default:0},{name:"avoidBaseMark",type:"boolean",default:!0},{name:"avoidMarks",type:"data",array:!0},{name:"method",type:"string",default:"naive"},{name:"as",type:"string",array:!0,length:s3.length,default:s3}]},Object(be.z)(u3,Ot,{transform(e,t){const n=e.modified();if(!(n||t.changed(t.ADD_REM)||function(i){const s=e[i];return Object(be.E)(s)&&t.modified(s.fields)}("sort")))return;e.size&&e.size.length===2||Object(be.o)("Size parameter should be specified as a [width, height] array.");const r=e.as||s3;return i6(t.materialize(t.SOURCE).source,e.size,e.sort,Object(be.i)(e.offset||1),Object(be.i)(e.anchor||e4),e.avoidMarks||[],e.avoidBaseMark!==!1,e.lineAnchor||"end",e.markIndex||0,e.padding||0,e.method||"naive").forEach(i=>{const s=i.datum;s[r[0]]=i.x,s[r[1]]=i.y,s[r[2]]=i.opacity,s[r[3]]=i.align,s[r[4]]=i.baseline}),t.reflow(n).modifies(r)}}),c3.Definition={type:"Loess",metadata:{generates:!0},params:[{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"groupby",type:"field",array:!0},{name:"bandwidth",type:"number",default:.3},{name:"as",type:"string",array:!0}]},Object(be.z)(c3,Ot,{transform(e,t){const n=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){const r=t4(t.materialize(t.SOURCE).source,e.groupby),i=(e.groupby||[]).map(be.h),s=i.length,f=e.as||[Object(be.h)(e.x),Object(be.h)(e.y)],m=[];r.forEach(x=>{xf(x,e.x,e.y,e.bandwidth||.3).forEach(O=>{const T={};for(let M=0;M<s;++M)T[i[M]]=x.dims[M];T[f[0]]=O[0],T[f[1]]=O[1],m.push(Dn(T))})}),this.value&&(n.rem=this.value),this.value=n.add=n.source=m}return n}});const l3={linear:ss,log:Ca,exp:nc,pow:Cl,quad:rc,poly:cu};function f3(e){Ot.call(this,null,e)}f3.Definition={type:"Regression",metadata:{generates:!0},params:[{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"groupby",type:"field",array:!0},{name:"method",type:"string",default:"linear",values:Object.keys(l3)},{name:"order",type:"number",default:3},{name:"extent",type:"number",array:!0,length:2},{name:"params",type:"boolean",default:!1},{name:"as",type:"string",array:!0}]},Object(be.z)(f3,Ot,{transform(e,t){const n=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){const r=t4(t.materialize(t.SOURCE).source,e.groupby),i=(e.groupby||[]).map(be.h),s=e.method||"linear",f=e.order||3,m=((H,Z)=>H==="poly"?Z:H==="quad"?2:1)(s,f),x=e.as||[Object(be.h)(e.x),Object(be.h)(e.y)],O=l3[s],T=[];let M=e.extent;Object(be.w)(l3,s)||Object(be.o)("Invalid regression method: "+s),M!=null&&s==="log"&&M[0]<=0&&(t.dataflow.warn("Ignoring extent with values <= 0 for log regression."),M=null),r.forEach(H=>{if(H.length<=m)return void t.dataflow.warn("Skipping regression with more parameters than data points.");const Z=O(H,e.x,e.y,f);if(e.params)return void T.push(Dn({keys:H.dims,coef:Z.coef,rSquared:Z.rSquared}));const ue=M||Object(be.q)(H,e.x),fe=Ie=>{const Pe={};for(let Le=0;Le<i.length;++Le)Pe[i[Le]]=H.dims[Le];Pe[x[0]]=Ie[0],Pe[x[1]]=Ie[1],T.push(Dn(Pe))};s==="linear"?ue.forEach(Ie=>fe([Ie,Z.predict(Ie)])):wf(Z.predict,ue,25,200).forEach(fe)}),this.value&&(n.rem=this.value),this.value=n.add=n.source=T}return n}});const n4=Math.pow(2,-52),E2=new Uint32Array(512);class C2{static from(t,n=function(i){return i[0]},r=function(i){return i[1]}){const i=t.length,s=new Float64Array(2*i);for(let f=0;f<i;f++){const m=t[f];s[2*f]=n(m),s[2*f+1]=r(m)}return new C2(s)}constructor(t){const n=t.length>>1;if(n>0&&typeof t[0]!="number")throw new Error("Expected coords to contain numbers.");this.coords=t;const r=Math.max(2*n-5,0);this._triangles=new Uint32Array(3*r),this._halfedges=new Int32Array(3*r),this._hashSize=Math.ceil(Math.sqrt(n)),this._hullPrev=new Uint32Array(n),this._hullNext=new Uint32Array(n),this._hullTri=new Uint32Array(n),this._hullHash=new Int32Array(this._hashSize).fill(-1),this._ids=new Uint32Array(n),this._dists=new Float64Array(n),this.update()}update(){const{coords:t,_hullPrev:n,_hullNext:r,_hullTri:i,_hullHash:s}=this,f=t.length>>1;let m=1/0,x=1/0,O=-1/0,T=-1/0;for(let mn=0;mn<f;mn++){const sn=t[2*mn],In=t[2*mn+1];sn<m&&(m=sn),In<x&&(x=In),sn>O&&(O=sn),In>T&&(T=In),this._ids[mn]=mn}const M=(m+O)/2,H=(x+T)/2;let Z,ue,fe,Ie=1/0;for(let mn=0;mn<f;mn++){const sn=h3(M,H,t[2*mn],t[2*mn+1]);sn<Ie&&(Z=mn,Ie=sn)}const Pe=t[2*Z],Le=t[2*Z+1];Ie=1/0;for(let mn=0;mn<f;mn++){if(mn===Z)continue;const sn=h3(Pe,Le,t[2*mn],t[2*mn+1]);sn<Ie&&sn>0&&(ue=mn,Ie=sn)}let rt=t[2*ue],it=t[2*ue+1],ut=1/0;for(let mn=0;mn<f;mn++){if(mn===Z||mn===ue)continue;const sn=a6(Pe,Le,rt,it,t[2*mn],t[2*mn+1]);sn<ut&&(fe=mn,ut=sn)}let st=t[2*fe],mt=t[2*fe+1];if(ut===1/0){for(let In=0;In<f;In++)this._dists[In]=t[2*In]-t[0]||t[2*In+1]-t[1];p1(this._ids,this._dists,0,f-1);const mn=new Uint32Array(f);let sn=0;for(let In=0,Fn=-1/0;In<f;In++){const zn=this._ids[In];this._dists[zn]>Fn&&(mn[sn++]=zn,Fn=this._dists[zn])}return this.hull=mn.subarray(0,sn),this.triangles=new Uint32Array(0),void(this.halfedges=new Uint32Array(0))}if(O2(Pe,Le,rt,it,st,mt)){const mn=ue,sn=rt,In=it;ue=fe,rt=st,it=mt,fe=mn,st=sn,mt=In}const dt=function(mn,sn,In,Fn,zn,Vn){const Qn=In-mn,mr=Fn-sn,Pr=zn-mn,Cr=Vn-sn,Jr=Qn*Qn+mr*mr,gi=Pr*Pr+Cr*Cr,vi=.5/(Qn*Cr-mr*Pr);return{x:mn+(Cr*Jr-mr*gi)*vi,y:sn+(Qn*gi-Pr*Jr)*vi}}(Pe,Le,rt,it,st,mt);this._cx=dt.x,this._cy=dt.y;for(let mn=0;mn<f;mn++)this._dists[mn]=h3(t[2*mn],t[2*mn+1],dt.x,dt.y);p1(this._ids,this._dists,0,f-1),this._hullStart=Z;let en=3;r[Z]=n[fe]=ue,r[ue]=n[Z]=fe,r[fe]=n[ue]=Z,i[Z]=0,i[ue]=1,i[fe]=2,s.fill(-1),s[this._hashKey(Pe,Le)]=Z,s[this._hashKey(rt,it)]=ue,s[this._hashKey(st,mt)]=fe,this.trianglesLen=0,this._addTriangle(Z,ue,fe,-1,-1,-1);for(let mn,sn,In=0;In<this._ids.length;In++){const Fn=this._ids[In],zn=t[2*Fn],Vn=t[2*Fn+1];if(In>0&&Math.abs(zn-mn)<=n4&&Math.abs(Vn-sn)<=n4||(mn=zn,sn=Vn,Fn===Z||Fn===ue||Fn===fe))continue;let Qn=0;for(let gi=0,vi=this._hashKey(zn,Vn);gi<this._hashSize&&((Qn=s[(vi+gi)%this._hashSize])===-1||Qn===r[Qn]);gi++);let mr,Pr=Qn=n[Qn];for(;mr=r[Pr],!O2(zn,Vn,t[2*Pr],t[2*Pr+1],t[2*mr],t[2*mr+1]);)if((Pr=mr)===Qn){Pr=-1;break}if(Pr===-1)continue;let Cr=this._addTriangle(Pr,Fn,r[Pr],-1,-1,i[Pr]);i[Fn]=this._legalize(Cr+2),i[Pr]=Cr,en++;let Jr=r[Pr];for(;mr=r[Jr],O2(zn,Vn,t[2*Jr],t[2*Jr+1],t[2*mr],t[2*mr+1]);)Cr=this._addTriangle(Jr,Fn,mr,i[Fn],-1,i[Jr]),i[Fn]=this._legalize(Cr+2),r[Jr]=Jr,en--,Jr=mr;if(Pr===Qn)for(;O2(zn,Vn,t[2*(mr=n[Pr])],t[2*mr+1],t[2*Pr],t[2*Pr+1]);)Cr=this._addTriangle(mr,Fn,Pr,-1,i[Pr],i[mr]),this._legalize(Cr+2),i[mr]=Cr,r[Pr]=Pr,en--,Pr=mr;this._hullStart=n[Fn]=Pr,r[Pr]=n[Jr]=Fn,r[Fn]=Jr,s[this._hashKey(zn,Vn)]=Fn,s[this._hashKey(t[2*Pr],t[2*Pr+1])]=Pr}this.hull=new Uint32Array(en);for(let mn=0,sn=this._hullStart;mn<en;mn++)this.hull[mn]=sn,sn=r[sn];this.triangles=this._triangles.subarray(0,this.trianglesLen),this.halfedges=this._halfedges.subarray(0,this.trianglesLen)}_hashKey(t,n){return Math.floor(function(r,i){const s=r/(Math.abs(r)+Math.abs(i));return(i>0?3-s:1+s)/4}(t-this._cx,n-this._cy)*this._hashSize)%this._hashSize}_legalize(t){const{_triangles:n,_halfedges:r,coords:i}=this;let s=0,f=0;for(;;){const m=r[t],x=t-t%3;if(f=x+(t+2)%3,m===-1){if(s===0)break;t=E2[--s];continue}const O=m-m%3,T=x+(t+1)%3,M=O+(m+2)%3,H=n[f],Z=n[t],ue=n[T],fe=n[M];if(o6(i[2*H],i[2*H+1],i[2*Z],i[2*Z+1],i[2*ue],i[2*ue+1],i[2*fe],i[2*fe+1])){n[t]=fe,n[m]=H;const Ie=r[M];if(Ie===-1){let Le=this._hullStart;do{if(this._hullTri[Le]===M){this._hullTri[Le]=t;break}Le=this._hullPrev[Le]}while(Le!==this._hullStart)}this._link(t,Ie),this._link(m,r[f]),this._link(f,M);const Pe=O+(m+1)%3;s<E2.length&&(E2[s++]=Pe)}else{if(s===0)break;t=E2[--s]}}return f}_link(t,n){this._halfedges[t]=n,n!==-1&&(this._halfedges[n]=t)}_addTriangle(t,n,r,i,s,f){const m=this.trianglesLen;return this._triangles[m]=t,this._triangles[m+1]=n,this._triangles[m+2]=r,this._link(m,i),this._link(m+1,s),this._link(m+2,f),this.trianglesLen+=3,m}}function h3(e,t,n,r){const i=e-n,s=t-r;return i*i+s*s}function d3(e,t,n,r,i,s){const f=(r-t)*(i-e),m=(n-e)*(s-t);return Math.abs(f-m)>=33306690738754716e-32*Math.abs(f+m)?f-m:0}function O2(e,t,n,r,i,s){return(d3(i,s,e,t,n,r)||d3(e,t,n,r,i,s)||d3(n,r,i,s,e,t))<0}function o6(e,t,n,r,i,s,f,m){const x=e-f,O=t-m,T=n-f,M=r-m,H=i-f,Z=s-m,ue=T*T+M*M,fe=H*H+Z*Z;return x*(M*fe-ue*Z)-O*(T*fe-ue*H)+(x*x+O*O)*(T*Z-M*H)<0}function a6(e,t,n,r,i,s){const f=n-e,m=r-t,x=i-e,O=s-t,T=f*f+m*m,M=x*x+O*O,H=.5/(f*O-m*x),Z=(O*T-m*M)*H,ue=(f*M-x*T)*H;return Z*Z+ue*ue}function p1(e,t,n,r){if(r-n<=20)for(let i=n+1;i<=r;i++){const s=e[i],f=t[s];let m=i-1;for(;m>=n&&t[e[m]]>f;)e[m+1]=e[m--];e[m+1]=s}else{let i=n+1,s=r;db(e,n+r>>1,i),t[e[n]]>t[e[r]]&&db(e,n,r),t[e[i]]>t[e[r]]&&db(e,i,r),t[e[n]]>t[e[i]]&&db(e,n,i);const f=e[i],m=t[f];for(;;){do i++;while(t[e[i]]<m);do s--;while(t[e[s]]>m);if(s<i)break;db(e,i,s)}e[n+1]=e[s],e[s]=f,r-i+1>=s-n?(p1(e,t,i,r),p1(e,t,n,s-1)):(p1(e,t,n,s-1),p1(e,t,i,r))}}function db(e,t,n){const r=e[t];e[t]=e[n],e[n]=r}const r4=1e-6;class py{constructor(){this._x0=this._y0=this._x1=this._y1=null,this._=""}moveTo(t,n){this._+=`M${this._x0=this._x1=+t},${this._y0=this._y1=+n}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")}lineTo(t,n){this._+=`L${this._x1=+t},${this._y1=+n}`}arc(t,n,r){const i=(t=+t)+(r=+r),s=n=+n;if(r<0)throw new Error("negative radius");this._x1===null?this._+=`M${i},${s}`:(Math.abs(this._x1-i)>r4||Math.abs(this._y1-s)>r4)&&(this._+="L"+i+","+s),r&&(this._+=`A${r},${r},0,1,1,${t-r},${n}A${r},${r},0,1,1,${this._x1=i},${this._y1=s}`)}rect(t,n,r,i){this._+=`M${this._x0=this._x1=+t},${this._y0=this._y1=+n}h${+r}v${+i}h${-r}Z`}value(){return this._||null}}class p3{constructor(){this._=[]}moveTo(t,n){this._.push([t,n])}closePath(){this._.push(this._[0].slice())}lineTo(t,n){this._.push([t,n])}value(){return this._.length?this._:null}}class s6{constructor(t,[n,r,i,s]=[0,0,960,500]){if(!((i=+i)>=(n=+n)&&(s=+s)>=(r=+r)))throw new Error("invalid bounds");this.delaunay=t,this._circumcenters=new Float64Array(2*t.points.length),this.vectors=new Float64Array(2*t.points.length),this.xmax=i,this.xmin=n,this.ymax=s,this.ymin=r,this._init()}update(){return this.delaunay.update(),this._init(),this}_init(){const{delaunay:{points:t,hull:n,triangles:r},vectors:i}=this,s=this.circumcenters=this._circumcenters.subarray(0,r.length/3*2);for(let Z,ue,fe=0,Ie=0,Pe=r.length;fe<Pe;fe+=3,Ie+=2){const Le=2*r[fe],rt=2*r[fe+1],it=2*r[fe+2],ut=t[Le],st=t[Le+1],mt=t[rt],dt=t[rt+1],en=t[it],mn=t[it+1],sn=mt-ut,In=dt-st,Fn=en-ut,zn=mn-st,Vn=sn*sn+In*In,Qn=Fn*Fn+zn*zn,mr=2*(sn*zn-In*Fn);if(mr)if(Math.abs(mr)<1e-8)Z=(ut+en)/2,ue=(st+mn)/2;else{const Pr=1/mr;Z=ut+(zn*Vn-In*Qn)*Pr,ue=st+(sn*Qn-Fn*Vn)*Pr}else Z=(ut+en)/2-1e8*zn,ue=(st+mn)/2+1e8*Fn;s[Ie]=Z,s[Ie+1]=ue}let f,m,x,O=n[n.length-1],T=4*O,M=t[2*O],H=t[2*O+1];i.fill(0);for(let Z=0;Z<n.length;++Z)f=T,m=M,x=H,T=4*(O=n[Z]),M=t[2*O],H=t[2*O+1],i[f+2]=i[T]=x-H,i[f+3]=i[T+1]=M-m}render(t){const n=t==null?t=new py:void 0,{delaunay:{halfedges:r,inedges:i,hull:s},circumcenters:f,vectors:m}=this;if(s.length<=1)return null;for(let T=0,M=r.length;T<M;++T){const H=r[T];if(H<T)continue;const Z=2*Math.floor(T/3),ue=2*Math.floor(H/3),fe=f[Z],Ie=f[Z+1],Pe=f[ue],Le=f[ue+1];this._renderSegment(fe,Ie,Pe,Le,t)}let x,O=s[s.length-1];for(let T=0;T<s.length;++T){x=O,O=s[T];const M=2*Math.floor(i[O]/3),H=f[M],Z=f[M+1],ue=4*x,fe=this._project(H,Z,m[ue+2],m[ue+3]);fe&&this._renderSegment(H,Z,fe[0],fe[1],t)}return n&&n.value()}renderBounds(t){const n=t==null?t=new py:void 0;return t.rect(this.xmin,this.ymin,this.xmax-this.xmin,this.ymax-this.ymin),n&&n.value()}renderCell(t,n){const r=n==null?n=new py:void 0,i=this._clip(t);if(i===null||!i.length)return;n.moveTo(i[0],i[1]);let s=i.length;for(;i[0]===i[s-2]&&i[1]===i[s-1]&&s>1;)s-=2;for(let f=2;f<s;f+=2)i[f]===i[f-2]&&i[f+1]===i[f-1]||n.lineTo(i[f],i[f+1]);return n.closePath(),r&&r.value()}*cellPolygons(){const{delaunay:{points:t}}=this;for(let n=0,r=t.length/2;n<r;++n){const i=this.cellPolygon(n);i&&(i.index=n,yield i)}}cellPolygon(t){const n=new p3;return this.renderCell(t,n),n.value()}_renderSegment(t,n,r,i,s){let f;const m=this._regioncode(t,n),x=this._regioncode(r,i);m===0&&x===0?(s.moveTo(t,n),s.lineTo(r,i)):(f=this._clipSegment(t,n,r,i,m,x))&&(s.moveTo(f[0],f[1]),s.lineTo(f[2],f[3]))}contains(t,n,r){return(n=+n)==n&&(r=+r)==r&&this.delaunay._step(t,n,r)===t}*neighbors(t){const n=this._clip(t);if(n)for(const r of this.delaunay.neighbors(t)){const i=this._clip(r);if(i){e:for(let s=0,f=n.length;s<f;s+=2)for(let m=0,x=i.length;m<x;m+=2)if(n[s]==i[m]&&n[s+1]==i[m+1]&&n[(s+2)%f]==i[(m+x-2)%x]&&n[(s+3)%f]==i[(m+x-1)%x]){yield r;break e}}}}_cell(t){const{circumcenters:n,delaunay:{inedges:r,halfedges:i,triangles:s}}=this,f=r[t];if(f===-1)return null;const m=[];let x=f;do{const O=Math.floor(x/3);if(m.push(n[2*O],n[2*O+1]),s[x=x%3==2?x-2:x+1]!==t)break;x=i[x]}while(x!==f&&x!==-1);return m}_clip(t){if(t===0&&this.delaunay.hull.length===1)return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];const n=this._cell(t);if(n===null)return null;const{vectors:r}=this,i=4*t;return r[i]||r[i+1]?this._clipInfinite(t,n,r[i],r[i+1],r[i+2],r[i+3]):this._clipFinite(t,n)}_clipFinite(t,n){const r=n.length;let i,s,f,m,x,O=null,T=n[r-2],M=n[r-1],H=this._regioncode(T,M);for(let Z=0;Z<r;Z+=2)if(i=T,s=M,T=n[Z],M=n[Z+1],f=H,H=this._regioncode(T,M),f===0&&H===0)m=x,x=0,O?O.push(T,M):O=[T,M];else{let ue,fe,Ie,Pe,Le;if(f===0){if((ue=this._clipSegment(i,s,T,M,f,H))===null)continue;[fe,Ie,Pe,Le]=ue}else{if((ue=this._clipSegment(T,M,i,s,H,f))===null)continue;[Pe,Le,fe,Ie]=ue,m=x,x=this._edgecode(fe,Ie),m&&x&&this._edge(t,m,x,O,O.length),O?O.push(fe,Ie):O=[fe,Ie]}m=x,x=this._edgecode(Pe,Le),m&&x&&this._edge(t,m,x,O,O.length),O?O.push(Pe,Le):O=[Pe,Le]}if(O)m=x,x=this._edgecode(O[0],O[1]),m&&x&&this._edge(t,m,x,O,O.length);else if(this.contains(t,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2))return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];return O}_clipSegment(t,n,r,i,s,f){for(;;){if(s===0&&f===0)return[t,n,r,i];if(s&f)return null;let m,x,O=s||f;8&O?(m=t+(r-t)*(this.ymax-n)/(i-n),x=this.ymax):4&O?(m=t+(r-t)*(this.ymin-n)/(i-n),x=this.ymin):2&O?(x=n+(i-n)*(this.xmax-t)/(r-t),m=this.xmax):(x=n+(i-n)*(this.xmin-t)/(r-t),m=this.xmin),s?(t=m,n=x,s=this._regioncode(t,n)):(r=m,i=x,f=this._regioncode(r,i))}}_clipInfinite(t,n,r,i,s,f){let m,x=Array.from(n);if((m=this._project(x[0],x[1],r,i))&&x.unshift(m[0],m[1]),(m=this._project(x[x.length-2],x[x.length-1],s,f))&&x.push(m[0],m[1]),x=this._clipFinite(t,x))for(let O,T=0,M=x.length,H=this._edgecode(x[M-2],x[M-1]);T<M;T+=2)O=H,H=this._edgecode(x[T],x[T+1]),O&&H&&(T=this._edge(t,O,H,x,T),M=x.length);else this.contains(t,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2)&&(x=[this.xmin,this.ymin,this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax]);return x}_edge(t,n,r,i,s){for(;n!==r;){let f,m;switch(n){case 5:n=4;continue;case 4:n=6,f=this.xmax,m=this.ymin;break;case 6:n=2;continue;case 2:n=10,f=this.xmax,m=this.ymax;break;case 10:n=8;continue;case 8:n=9,f=this.xmin,m=this.ymax;break;case 9:n=1;continue;case 1:n=5,f=this.xmin,m=this.ymin}i[s]===f&&i[s+1]===m||!this.contains(t,f,m)||(i.splice(s,0,f,m),s+=2)}if(i.length>4)for(let f=0;f<i.length;f+=2){const m=(f+2)%i.length,x=(f+4)%i.length;(i[f]===i[m]&&i[m]===i[x]||i[f+1]===i[m+1]&&i[m+1]===i[x+1])&&(i.splice(m,2),f-=2)}return s}_project(t,n,r,i){let s,f,m,x=1/0;if(i<0){if(n<=this.ymin)return null;(s=(this.ymin-n)/i)<x&&(m=this.ymin,f=t+(x=s)*r)}else if(i>0){if(n>=this.ymax)return null;(s=(this.ymax-n)/i)<x&&(m=this.ymax,f=t+(x=s)*r)}if(r>0){if(t>=this.xmax)return null;(s=(this.xmax-t)/r)<x&&(f=this.xmax,m=n+(x=s)*i)}else if(r<0){if(t<=this.xmin)return null;(s=(this.xmin-t)/r)<x&&(f=this.xmin,m=n+(x=s)*i)}return[f,m]}_edgecode(t,n){return(t===this.xmin?1:t===this.xmax?2:0)|(n===this.ymin?4:n===this.ymax?8:0)}_regioncode(t,n){return(t<this.xmin?1:t>this.xmax?2:0)|(n<this.ymin?4:n>this.ymax?8:0)}}const u6=2*Math.PI,m1=Math.pow;function c6(e,t,n){return[e+Math.sin(e+t)*n,t+Math.cos(e-t)*n]}class m3{static from(t,n=function(s){return s[0]},r=function(s){return s[1]},i){return new m3("length"in t?function(s,f,m,x){const O=s.length,T=new Float64Array(2*O);for(let M=0;M<O;++M){const H=s[M];T[2*M]=f.call(x,H,M,s),T[2*M+1]=m.call(x,H,M,s)}return T}(t,n,r,i):Float64Array.from(function*(s,f,m,x){let O=0;for(const T of s)yield f.call(x,T,O,s),yield m.call(x,T,O,s),++O}(t,n,r,i)))}constructor(t){this._delaunator=new C2(t),this.inedges=new Int32Array(t.length/2),this._hullIndex=new Int32Array(t.length/2),this.points=this._delaunator.coords,this._init()}update(){return this._delaunator.update(),this._init(),this}_init(){const t=this._delaunator,n=this.points;if(t.hull&&t.hull.length>2&&function(x){const{triangles:O,coords:T}=x;for(let M=0;M<O.length;M+=3){const H=2*O[M],Z=2*O[M+1],ue=2*O[M+2];if((T[ue]-T[H])*(T[Z+1]-T[H+1])-(T[Z]-T[H])*(T[ue+1]-T[H+1])>1e-10)return!1}return!0}(t)){this.collinear=Int32Array.from({length:n.length/2},(H,Z)=>Z).sort((H,Z)=>n[2*H]-n[2*Z]||n[2*H+1]-n[2*Z+1]);const x=this.collinear[0],O=this.collinear[this.collinear.length-1],T=[n[2*x],n[2*x+1],n[2*O],n[2*O+1]],M=1e-8*Math.hypot(T[3]-T[1],T[2]-T[0]);for(let H=0,Z=n.length/2;H<Z;++H){const ue=c6(n[2*H],n[2*H+1],M);n[2*H]=ue[0],n[2*H+1]=ue[1]}this._delaunator=new C2(n)}else delete this.collinear;const r=this.halfedges=this._delaunator.halfedges,i=this.hull=this._delaunator.hull,s=this.triangles=this._delaunator.triangles,f=this.inedges.fill(-1),m=this._hullIndex.fill(-1);for(let x=0,O=r.length;x<O;++x){const T=s[x%3==2?x-2:x+1];r[x]!==-1&&f[T]!==-1||(f[T]=x)}for(let x=0,O=i.length;x<O;++x)m[i[x]]=x;i.length<=2&&i.length>0&&(this.triangles=new Int32Array(3).fill(-1),this.halfedges=new Int32Array(3).fill(-1),this.triangles[0]=i[0],this.triangles[1]=i[1],this.triangles[2]=i[1],f[i[0]]=1,i.length===2&&(f[i[1]]=0))}voronoi(t){return new s6(this,t)}*neighbors(t){const{inedges:n,hull:r,_hullIndex:i,halfedges:s,triangles:f,collinear:m}=this;if(m){const M=m.indexOf(t);return M>0&&(yield m[M-1]),void(M<m.length-1&&(yield m[M+1]))}const x=n[t];if(x===-1)return;let O=x,T=-1;do{if(yield T=f[O],f[O=O%3==2?O-2:O+1]!==t)return;if((O=s[O])===-1){const M=r[(i[t]+1)%r.length];return void(M!==T&&(yield M))}}while(O!==x)}find(t,n,r=0){if((t=+t)!=t||(n=+n)!=n)return-1;const i=r;let s;for(;(s=this._step(r,t,n))>=0&&s!==r&&s!==i;)r=s;return s}_step(t,n,r){const{inedges:i,hull:s,_hullIndex:f,halfedges:m,triangles:x,points:O}=this;if(i[t]===-1||!O.length)return(t+1)%(O.length>>1);let T=t,M=m1(n-O[2*t],2)+m1(r-O[2*t+1],2);const H=i[t];let Z=H;do{let ue=x[Z];const fe=m1(n-O[2*ue],2)+m1(r-O[2*ue+1],2);if(fe<M&&(M=fe,T=ue),x[Z=Z%3==2?Z-2:Z+1]!==t)break;if((Z=m[Z])===-1){if((Z=s[(f[t]+1)%s.length])!==ue&&m1(n-O[2*Z],2)+m1(r-O[2*Z+1],2)<M)return Z;break}}while(Z!==H);return T}render(t){const n=t==null?t=new py:void 0,{points:r,halfedges:i,triangles:s}=this;for(let f=0,m=i.length;f<m;++f){const x=i[f];if(x<f)continue;const O=2*s[f],T=2*s[x];t.moveTo(r[O],r[O+1]),t.lineTo(r[T],r[T+1])}return this.renderHull(t),n&&n.value()}renderPoints(t,n=2){const r=t==null?t=new py:void 0,{points:i}=this;for(let s=0,f=i.length;s<f;s+=2){const m=i[s],x=i[s+1];t.moveTo(m+n,x),t.arc(m,x,n,0,u6)}return r&&r.value()}renderHull(t){const n=t==null?t=new py:void 0,{hull:r,points:i}=this,s=2*r[0],f=r.length;t.moveTo(i[s],i[s+1]);for(let m=1;m<f;++m){const x=2*r[m];t.lineTo(i[x],i[x+1])}return t.closePath(),n&&n.value()}hullPolygon(){const t=new p3;return this.renderHull(t),t.value()}renderTriangle(t,n){const r=n==null?n=new py:void 0,{points:i,triangles:s}=this,f=2*s[t*=3],m=2*s[t+1],x=2*s[t+2];return n.moveTo(i[f],i[f+1]),n.lineTo(i[m],i[m+1]),n.lineTo(i[x],i[x+1]),n.closePath(),r&&r.value()}*trianglePolygons(){const{triangles:t}=this;for(let n=0,r=t.length/3;n<r;++n)yield this.trianglePolygon(n)}trianglePolygon(t){const n=new p3;return this.renderTriangle(t,n),n.value()}}function g3(e){Ot.call(this,null,e)}g3.Definition={type:"Voronoi",metadata:{modifies:!0},params:[{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"size",type:"number",array:!0,length:2},{name:"extent",type:"array",array:!0,length:2,default:[[-1e5,-1e5],[1e5,1e5]],content:{type:"number",array:!0,length:2}},{name:"as",type:"string",default:"path"}]};const l6=[-1e5,-1e5,1e5,1e5];function f6(e){const t=e[0][0],n=e[0][1];let r=e.length-1;for(;e[r][0]===t&&e[r][1]===n;--r);return"M"+e.slice(0,r+1).join("L")+"Z"}Object(be.z)(g3,Ot,{transform(e,t){const n=e.as||"path",r=t.source;if(!r||!r.length)return t;let i=e.size;i=i?[0,0,i[0],i[1]]:(i=e.extent)?[i[0][0],i[0][1],i[1][0],i[1][1]]:l6;const s=this.value=m3.from(r,e.x,e.y).voronoi(i);for(let f=0,m=r.length;f<m;++f){const x=s.cellPolygon(f);r[f][n]=x?f6(x):null}return t.reflow(e.modified()).modifies(n)}});var v3=Math.PI/180,pb=64,A2=2048;function h6(){var e,t,n,r,i,s,f,m=[256,256],x=i4,O=[],T=Math.random,M={};function H(Z,ue,fe){for(var Ie,Pe,Le,rt=ue.x,it=ue.y,ut=Math.sqrt(m[0]*m[0]+m[1]*m[1]),st=x(m),mt=T()<.5?1:-1,dt=-mt;(Ie=st(dt+=mt))&&(Pe=~~Ie[0],Le=~~Ie[1],!(Math.min(Math.abs(Pe),Math.abs(Le))>=ut));)if(ue.x=rt+Pe,ue.y=it+Le,!(ue.x+ue.x0<0||ue.y+ue.y0<0||ue.x+ue.x1>m[0]||ue.y+ue.y1>m[1])&&(!fe||!p6(ue,Z,m[0]))&&(!fe||g6(ue,fe))){for(var en,mn=ue.sprite,sn=ue.width>>5,In=m[0]>>5,Fn=ue.x-(sn<<4),zn=127&Fn,Vn=32-zn,Qn=ue.y1-ue.y0,mr=(ue.y+ue.y0)*In+(Fn>>5),Pr=0;Pr<Qn;Pr++){en=0;for(var Cr=0;Cr<=sn;Cr++)Z[mr+Cr]|=en<<Vn|(Cr<sn?(en=mn[Pr*sn+Cr])>>>zn:0);mr+=In}return ue.sprite=null,!0}return!1}return M.layout=function(){for(var Z=function(ut){ut.width=ut.height=1;var st=Math.sqrt(ut.getContext("2d").getImageData(0,0,1,1).data.length>>2);ut.width=(pb<<5)/st,ut.height=A2/st;var mt=ut.getContext("2d");return mt.fillStyle=mt.strokeStyle="red",mt.textAlign="center",{context:mt,ratio:st}}(Hs()),ue=function(ut){for(var st=[],mt=-1;++mt<ut;)st[mt]=0;return st}((m[0]>>5)*m[1]),fe=null,Ie=O.length,Pe=-1,Le=[],rt=O.map(ut=>({text:e(ut),font:t(ut),style:r(ut),weight:i(ut),rotate:s(ut),size:~~(n(ut)+1e-14),padding:f(ut),xoff:0,yoff:0,x1:0,y1:0,x0:0,y0:0,hasText:!1,sprite:null,datum:ut})).sort((ut,st)=>st.size-ut.size);++Pe<Ie;){var it=rt[Pe];it.x=m[0]*(T()+.5)>>1,it.y=m[1]*(T()+.5)>>1,d6(Z,it,rt,Pe),it.hasText&&H(ue,it,fe)&&(Le.push(it),fe?m6(fe,it):fe=[{x:it.x+it.x0,y:it.y+it.y0},{x:it.x+it.x1,y:it.y+it.y1}],it.x-=m[0]>>1,it.y-=m[1]>>1)}return Le},M.words=function(Z){return arguments.length?(O=Z,M):O},M.size=function(Z){return arguments.length?(m=[+Z[0],+Z[1]],M):m},M.font=function(Z){return arguments.length?(t=my(Z),M):t},M.fontStyle=function(Z){return arguments.length?(r=my(Z),M):r},M.fontWeight=function(Z){return arguments.length?(i=my(Z),M):i},M.rotate=function(Z){return arguments.length?(s=my(Z),M):s},M.text=function(Z){return arguments.length?(e=my(Z),M):e},M.spiral=function(Z){return arguments.length?(x=v6[Z]||Z,M):x},M.fontSize=function(Z){return arguments.length?(n=my(Z),M):n},M.padding=function(Z){return arguments.length?(f=my(Z),M):f},M.random=function(Z){return arguments.length?(T=Z,M):T},M}function d6(e,t,n,r){if(!t.sprite){var i=e.context,s=e.ratio;i.clearRect(0,0,(pb<<5)/s,A2/s);var f,m,x,O,T,M=0,H=0,Z=0,ue=n.length;for(--r;++r<ue;){if(t=n[r],i.save(),i.font=t.style+" "+t.weight+" "+~~((t.size+1)/s)+"px "+t.font,f=i.measureText(t.text+"m").width*s,x=t.size<<1,t.rotate){var fe=Math.sin(t.rotate*v3),Ie=Math.cos(t.rotate*v3),Pe=f*Ie,Le=f*fe,rt=x*Ie,it=x*fe;f=Math.max(Math.abs(Pe+it),Math.abs(Pe-it))+31>>5<<5,x=~~Math.max(Math.abs(Le+rt),Math.abs(Le-rt))}else f=f+31>>5<<5;if(x>Z&&(Z=x),M+f>=pb<<5&&(M=0,H+=Z,Z=0),H+x>=A2)break;i.translate((M+(f>>1))/s,(H+(x>>1))/s),t.rotate&&i.rotate(t.rotate*v3),i.fillText(t.text,0,0),t.padding&&(i.lineWidth=2*t.padding,i.strokeText(t.text,0,0)),i.restore(),t.width=f,t.height=x,t.xoff=M,t.yoff=H,t.x1=f>>1,t.y1=x>>1,t.x0=-t.x1,t.y0=-t.y1,t.hasText=!0,M+=f}for(var ut=i.getImageData(0,0,(pb<<5)/s,A2/s).data,st=[];--r>=0;)if((t=n[r]).hasText){for(m=(f=t.width)>>5,x=t.y1-t.y0,O=0;O<x*m;O++)st[O]=0;if((M=t.xoff)==null)return;H=t.yoff;var mt=0,dt=-1;for(T=0;T<x;T++){for(O=0;O<f;O++){var en=m*T+(O>>5),mn=ut[(H+T)*(pb<<5)+(M+O)<<2]?1<<31-O%32:0;st[en]|=mn,mt|=mn}mt?dt=T:(t.y0++,x--,T--,H++)}t.y1=t.y0+dt,t.sprite=st.slice(0,(t.y1-t.y0)*m)}}}function p6(e,t,n){n>>=5;for(var r,i=e.sprite,s=e.width>>5,f=e.x-(s<<4),m=127&f,x=32-m,O=e.y1-e.y0,T=(e.y+e.y0)*n+(f>>5),M=0;M<O;M++){r=0;for(var H=0;H<=s;H++)if((r<<x|(H<s?(r=i[M*s+H])>>>m:0))&t[T+H])return!0;T+=n}return!1}function m6(e,t){var n=e[0],r=e[1];t.x+t.x0<n.x&&(n.x=t.x+t.x0),t.y+t.y0<n.y&&(n.y=t.y+t.y0),t.x+t.x1>r.x&&(r.x=t.x+t.x1),t.y+t.y1>r.y&&(r.y=t.y+t.y1)}function g6(e,t){return e.x+e.x1>t[0].x&&e.x+e.x0<t[1].x&&e.y+e.y1>t[0].y&&e.y+e.y0<t[1].y}function i4(e){var t=e[0]/e[1];return function(n){return[t*(n*=.1)*Math.cos(n),n*Math.sin(n)]}}function my(e){return typeof e=="function"?e:function(){return e}}var v6={archimedean:i4,rectangular:function(e){var t=4*e[0]/e[1],n=0,r=0;return function(i){var s=i<0?-1:1;switch(Math.sqrt(1+4*s*i)-s&3){case 0:n+=t;break;case 1:r+=4;break;case 2:n-=t;break;default:r-=4}return[n,r]}}};const o4=["x","y","font","fontSize","fontStyle","fontWeight","angle"],y6=["text","font","rotate","fontSize","fontStyle","fontWeight"];function y3(e){Ot.call(this,h6(),e)}y3.Definition={type:"Wordcloud",metadata:{modifies:!0},params:[{name:"size",type:"number",array:!0,length:2},{name:"font",type:"string",expr:!0,default:"sans-serif"},{name:"fontStyle",type:"string",expr:!0,default:"normal"},{name:"fontWeight",type:"string",expr:!0,default:"normal"},{name:"fontSize",type:"number",expr:!0,default:14},{name:"fontSizeRange",type:"number",array:"nullable",default:[10,50]},{name:"rotate",type:"number",expr:!0,default:0},{name:"text",type:"field"},{name:"spiral",type:"string",values:["archimedean","rectangular"]},{name:"padding",type:"number",expr:!0},{name:"as",type:"string",array:!0,length:7,default:o4}]},Object(be.z)(y3,Ot,{transform(e,t){!e.size||e.size[0]&&e.size[1]||Object(be.o)("Wordcloud size dimensions must be non-zero.");const n=e.modified();if(!(n||t.changed(t.ADD_REM)||y6.some(function(Z){const ue=e[Z];return Object(be.E)(ue)&&t.modified(ue.fields)})))return;const r=t.materialize(t.SOURCE).source,i=this.value,s=e.as||o4;let f,m=e.fontSize||14;if(Object(be.E)(m)?f=e.fontSizeRange:m=Object(be.m)(m),f){const Z=m,ue=Ro("sqrt")().domain(Object(be.q)(r,Z)).range(f);m=fe=>ue(Z(fe))}r.forEach(Z=>{Z[s[0]]=NaN,Z[s[1]]=NaN,Z[s[3]]=0});const x=i.words(r).text(e.text).size(e.size||[500,500]).padding(e.padding||1).spiral(e.spiral||"archimedean").rotate(e.rotate||0).font(e.font||"sans-serif").fontStyle(e.fontStyle||"normal").fontWeight(e.fontWeight||"normal").fontSize(m).random(jn).layout(),O=i.size(),T=O[0]>>1,M=O[1]>>1,H=x.length;for(let Z,ue,fe=0;fe<H;++fe)(ue=(Z=x[fe]).datum)[s[0]]=Z.x+T,ue[s[1]]=Z.y+M,ue[s[2]]=Z.font,ue[s[3]]=Z.size,ue[s[4]]=Z.style,ue[s[5]]=Z.weight,ue[s[6]]=Z.rotate;return t.reflow(n).modifies(s)}});var b6=function(e,t){return Array.from(t,n=>e[n])};const x6=e=>new Uint8Array(e),w6=e=>new Uint16Array(e),mb=e=>new Uint32Array(e);function S2(e,t,n){const r=(t<257?x6:t<65537?w6:mb)(e);return n&&r.set(n),r}function a4(e,t,n){const r=1<<t;return{one:r,zero:~r,range:n.slice(),bisect:e.bisect,index:e.index,size:e.size,onAdd(i,s){const f=this.bisect(this.range,i.value),m=i.index,x=f[0],O=f[1],T=m.length;let M;for(M=0;M<x;++M)s[m[M]]|=r;for(M=O;M<T;++M)s[m[M]]|=r;return this}}}function s4(){let e=mb(0),t=[],n=0;return{insert:function(r,i,s){if(!i.length)return[];const f=n,m=i.length,x=mb(m);let O,T,M,H=Array(m);for(M=0;M<m;++M)H[M]=r(i[M]),x[M]=M;if(H=function(Z,ue){return Z.sort.call(ue,(fe,Ie)=>{const Pe=Z[fe],Le=Z[Ie];return Pe<Le?-1:Pe>Le?1:0}),b6(Z,ue)}(H,x),f)O=t,T=e,t=Array(f+m),e=mb(f+m),function(Z,ue,fe,Ie,Pe,Le,rt,it,ut){let st,mt=0,dt=0;for(st=0;mt<Ie&&dt<rt;++st)ue[mt]<Pe[dt]?(it[st]=ue[mt],ut[st]=fe[mt++]):(it[st]=Pe[dt],ut[st]=Le[dt++]+Z);for(;mt<Ie;++mt,++st)it[st]=ue[mt],ut[st]=fe[mt];for(;dt<rt;++dt,++st)it[st]=Pe[dt],ut[st]=Le[dt]+Z}(s,O,T,f,H,x,m,t,e);else{if(s>0)for(M=0;M<m;++M)x[M]+=s;t=H,e=x}return n=f+m,{index:x,value:H}},remove:function(r,i){const s=n;let f,m,x;for(m=0;!i[e[m]]&&m<s;++m);for(x=m;m<s;++m)i[f=e[m]]||(e[x]=f,t[x]=t[m],++x);n=s-r},bisect:function(r,i){let s;return i?s=i.length:(i=t,s=n),[ls(i,r[0],0,s),_a(i,r[1],0,s)]},reindex:function(r){for(let i=0,s=n;i<s;++i)e[i]=r[e[i]]},index:()=>e,size:()=>n}}function b3(e){Ot.call(this,function(){let t=8,n=[],r=mb(0),i=S2(0,t),s=S2(0,t);return{data:()=>n,seen:()=>r=function(f,m,x){return f.length>=m?f:((x=x||new f.constructor(m)).set(f),x)}(r,n.length),add(f){for(let m,x=0,O=n.length,T=f.length;x<T;++x)(m=f[x])._index=O++,n.push(m)},remove(f,m){const x=n.length,O=Array(x-f),T=n;let M,H,Z;for(H=0;!m[H]&&H<x;++H)O[H]=n[H],T[H]=H;for(Z=H;H<x;++H)M=n[H],m[H]?T[H]=-1:(T[H]=Z,i[Z]=i[H],s[Z]=s[H],O[Z]=M,M._index=Z++),i[H]=0;return n=O,T},size:()=>n.length,curr:()=>i,prev:()=>s,reset:f=>s[f]=i[f],all:()=>t<257?255:t<65537?65535:4294967295,set(f,m){i[f]|=m},clear(f,m){i[f]&=~m},resize(f,m){(f>i.length||m>t)&&(t=Math.max(m,t),i=S2(f,t,i),s=S2(f,t))}}}(),e),this._indices=null,this._dims=null}function x3(e){Ot.call(this,null,e)}b3.Definition={type:"CrossFilter",metadata:{},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"query",type:"array",array:!0,required:!0,content:{type:"number",array:!0,length:2}}]},Object(be.z)(b3,Ot,{transform(e,t){return this._dims?e.modified("fields")||e.fields.some(n=>t.modified(n.fields))?this.reinit(e,t):this.eval(e,t):this.init(e,t)},init(e,t){const n=e.fields,r=e.query,i=this._indices={},s=this._dims=[],f=r.length;let m,x,O=0;for(;O<f;++O)x=i[m=n[O].fname]||(i[m]=s4()),s.push(a4(x,O,r[O]));return this.eval(e,t)},reinit(e,t){const n=t.materialize().fork(),r=e.fields,i=e.query,s=this._indices,f=this._dims,m=this.value,x=m.curr(),O=m.prev(),T=m.all(),M=n.rem=n.add,H=n.mod,Z=i.length,ue={};let fe,Ie,Pe,Le,rt,it,ut,st,mt;if(O.set(x),t.rem.length&&(rt=this.remove(e,t,n)),t.add.length&&m.add(t.add),t.mod.length)for(it={},ut=0,st=(Le=t.mod).length;ut<st;++ut)it[Le[ut]._index]=1;for(ut=0;ut<Z;++ut)mt=r[ut],(!f[ut]||e.modified("fields",ut)||t.modified(mt.fields))&&((fe=ue[Pe=mt.fname])||(s[Pe]=Ie=s4(),ue[Pe]=fe=Ie.insert(mt,t.source,0)),f[ut]=a4(Ie,ut,i[ut]).onAdd(fe,x));for(ut=0,st=m.data().length;ut<st;++ut)rt[ut]||(O[ut]!==x[ut]?M.push(ut):it[ut]&&x[ut]!==T&&H.push(ut));return m.mask=(1<<Z)-1,n},eval(e,t){const n=t.materialize().fork(),r=this._dims.length;let i=0;return t.rem.length&&(this.remove(e,t,n),i|=(1<<r)-1),e.modified("query")&&!e.modified("fields")&&(i|=this.update(e,t,n)),t.add.length&&(this.insert(e,t,n),i|=(1<<r)-1),t.mod.length&&(this.modify(t,n),i|=(1<<r)-1),this.value.mask=i,n},insert(e,t,n){const r=t.add,i=this.value,s=this._dims,f=this._indices,m=e.fields,x={},O=n.add,T=i.size()+r.length,M=s.length;let H,Z,ue,fe=i.size();i.resize(T,M),i.add(r);const Ie=i.curr(),Pe=i.prev(),Le=i.all();for(H=0;H<M;++H)ue=x[Z=m[H].fname]||(x[Z]=f[Z].insert(m[H],r,fe)),s[H].onAdd(ue,Ie);for(;fe<T;++fe)Pe[fe]=Le,Ie[fe]!==Le&&O.push(fe)},modify(e,t){const n=t.mod,r=this.value,i=r.curr(),s=r.all(),f=e.mod;let m,x,O;for(m=0,x=f.length;m<x;++m)i[O=f[m]._index]!==s&&n.push(O)},remove(e,t,n){const r=this._indices,i=this.value,s=i.curr(),f=i.prev(),m=i.all(),x={},O=n.rem,T=t.rem;let M,H,Z,ue;for(M=0,H=T.length;M<H;++M)x[Z=T[M]._index]=1,f[Z]=ue=s[Z],s[Z]=m,ue!==m&&O.push(Z);for(Z in r)r[Z].remove(H,x);return this.reindex(t,H,x),x},reindex(e,t,n){const r=this._indices,i=this.value;e.runAfter(()=>{const s=i.remove(t,n);for(const f in r)r[f].reindex(s)})},update(e,t,n){const r=this._dims,i=e.query,s=t.stamp,f=r.length;let m,x,O=0;for(n.filters=0,x=0;x<f;++x)e.modified("query",x)&&(m=x,++O);if(O===1)O=r[m].one,this.incrementOne(r[m],i[m],n.add,n.rem);else for(x=0,O=0;x<f;++x)e.modified("query",x)&&(O|=r[x].one,this.incrementAll(r[x],i[x],s,n.add),n.rem=n.add);return O},incrementAll(e,t,n,r){const i=this.value,s=i.seen(),f=i.curr(),m=i.prev(),x=e.index(),O=e.bisect(e.range),T=e.bisect(t),M=T[0],H=T[1],Z=O[0],ue=O[1],fe=e.one;let Ie,Pe,Le;if(M<Z)for(Ie=M,Pe=Math.min(Z,H);Ie<Pe;++Ie)s[Le=x[Ie]]!==n&&(m[Le]=f[Le],s[Le]=n,r.push(Le)),f[Le]^=fe;else if(M>Z)for(Ie=Z,Pe=Math.min(M,ue);Ie<Pe;++Ie)s[Le=x[Ie]]!==n&&(m[Le]=f[Le],s[Le]=n,r.push(Le)),f[Le]^=fe;if(H>ue)for(Ie=Math.max(M,ue),Pe=H;Ie<Pe;++Ie)s[Le=x[Ie]]!==n&&(m[Le]=f[Le],s[Le]=n,r.push(Le)),f[Le]^=fe;else if(H<ue)for(Ie=Math.max(Z,H),Pe=ue;Ie<Pe;++Ie)s[Le=x[Ie]]!==n&&(m[Le]=f[Le],s[Le]=n,r.push(Le)),f[Le]^=fe;e.range=t.slice()},incrementOne(e,t,n,r){const i=this.value.curr(),s=e.index(),f=e.bisect(e.range),m=e.bisect(t),x=m[0],O=m[1],T=f[0],M=f[1],H=e.one;let Z,ue,fe;if(x<T)for(Z=x,ue=Math.min(T,O);Z<ue;++Z)i[fe=s[Z]]^=H,n.push(fe);else if(x>T)for(Z=T,ue=Math.min(x,M);Z<ue;++Z)i[fe=s[Z]]^=H,r.push(fe);if(O>M)for(Z=Math.max(x,M),ue=O;Z<ue;++Z)i[fe=s[Z]]^=H,n.push(fe);else if(O<M)for(Z=Math.max(T,O),ue=M;Z<ue;++Z)i[fe=s[Z]]^=H,r.push(fe);e.range=t.slice()}}),x3.Definition={type:"ResolveFilter",metadata:{},params:[{name:"ignore",type:"number",required:!0,description:"A bit mask indicating which filters to ignore."},{name:"filter",type:"object",required:!0,description:"Per-tuple filter bitmaps from a CrossFilter transform."}]},Object(be.z)(x3,Ot,{transform(e,t){const n=~(e.ignore||0),r=e.filter,i=r.mask;if(!(i&n))return t.StopPropagation;const s=t.fork(t.ALL),f=r.data(),m=r.curr(),x=r.prev(),O=T=>m[T]&n?null:f[T];return s.filter(s.MOD,O),i&i-1?(s.filter(s.ADD,T=>{const M=m[T]&n;return!M&&M^x[T]&n?f[T]:null}),s.filter(s.REM,T=>{const M=m[T]&n;return M&&!(M^M^x[T]&n)?f[T]:null})):(s.filter(s.ADD,O),s.filter(s.REM,T=>(m[T]&n)===i?f[T]:null)),s.filter(s.SOURCE,T=>O(T._index))}});const k6="RawCode",g1="Literal",E6="Property",C6="Identifier",O6="ArrayExpression",A6="BinaryExpression",u4="CallExpression",S6="ConditionalExpression",_6="LogicalExpression",D6="MemberExpression",T6="ObjectExpression",N6="UnaryExpression";function tg(e){this.type=e}var G0,Oi,Ar,sf,Ya;tg.prototype.visit=function(e){let t,n,r;if(e(this))return 1;for(n=0,r=(t=function(i){switch(i.type){case O6:return i.elements;case A6:case _6:return[i.left,i.right];case u4:return[i.callee].concat(i.arguments);case S6:return[i.test,i.consequent,i.alternate];case D6:return[i.object,i.property];case T6:return i.properties;case E6:return[i.key,i.value];case N6:return[i.argument];case C6:case g1:case k6:default:return[]}}(this)).length;n<r;++n)if(t[n].visit(e))return 1};var _2=1,gb=2,gy=3,jv=4,D2=5,vy=6,vd=7,vb=8;(G0={})[_2]="Boolean",G0[gb]="<end>",G0[gy]="Identifier",G0[jv]="Keyword",G0[D2]="Null",G0[vy]="Numeric",G0[vd]="Punctuator",G0[vb]="String",G0[9]="RegularExpression";var F6="ArrayExpression",I6="BinaryExpression",R6="CallExpression",M6="ConditionalExpression",c4="Identifier",j6="Literal",B6="LogicalExpression",P6="MemberExpression",L6="ObjectExpression",z6="Property",U6="UnaryExpression",Bc="Unexpected token %0",W6="Unexpected number",V6="Unexpected string",q6="Unexpected identifier",H6="Unexpected reserved word",$6="Unexpected end of input",w3="Invalid regular expression",k3="Invalid regular expression: missing /",l4="Octal literals are not allowed in strict mode.",G6="Duplicate data property in object literal not allowed in strict mode",yl="ILLEGAL",yb="Disabled.",K6=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0370-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0620-\\u064A\\u066E\\u066F\\u0671-\\u06D3\\u06D5\\u06E5\\u06E6\\u06EE\\u06EF\\u06FA-\\u06FC\\u06FF\\u0710\\u0712-\\u072F\\u074D-\\u07A5\\u07B1\\u07CA-\\u07EA\\u07F4\\u07F5\\u07FA\\u0800-\\u0815\\u081A\\u0824\\u0828\\u0840-\\u0858\\u08A0-\\u08B2\\u0904-\\u0939\\u093D\\u0950\\u0958-\\u0961\\u0971-\\u0980\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BD\\u09CE\\u09DC\\u09DD\\u09DF-\\u09E1\\u09F0\\u09F1\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A59-\\u0A5C\\u0A5E\\u0A72-\\u0A74\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABD\\u0AD0\\u0AE0\\u0AE1\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3D\\u0B5C\\u0B5D\\u0B5F-\\u0B61\\u0B71\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BD0\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D\\u0C58\\u0C59\\u0C60\\u0C61\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBD\\u0CDE\\u0CE0\\u0CE1\\u0CF1\\u0CF2\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D\\u0D4E\\u0D60\\u0D61\\u0D7A-\\u0D7F\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0E01-\\u0E30\\u0E32\\u0E33\\u0E40-\\u0E46\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB0\\u0EB2\\u0EB3\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EDC-\\u0EDF\\u0F00\\u0F40-\\u0F47\\u0F49-\\u0F6C\\u0F88-\\u0F8C\\u1000-\\u102A\\u103F\\u1050-\\u1055\\u105A-\\u105D\\u1061\\u1065\\u1066\\u106E-\\u1070\\u1075-\\u1081\\u108E\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1711\\u1720-\\u1731\\u1740-\\u1751\\u1760-\\u176C\\u176E-\\u1770\\u1780-\\u17B3\\u17D7\\u17DC\\u1820-\\u1877\\u1880-\\u18A8\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1950-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19C1-\\u19C7\\u1A00-\\u1A16\\u1A20-\\u1A54\\u1AA7\\u1B05-\\u1B33\\u1B45-\\u1B4B\\u1B83-\\u1BA0\\u1BAE\\u1BAF\\u1BBA-\\u1BE5\\u1C00-\\u1C23\\u1C4D-\\u1C4F\\u1C5A-\\u1C7D\\u1CE9-\\u1CEC\\u1CEE-\\u1CF1\\u1CF5\\u1CF6\\u1D00-\\u1DBF\\u1E00-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u2071\\u207F\\u2090-\\u209C\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CEE\\u2CF2\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D80-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2E2F\\u3005-\\u3007\\u3021-\\u3029\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA61F\\uA62A\\uA62B\\uA640-\\uA66E\\uA67F-\\uA69D\\uA6A0-\\uA6EF\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA801\\uA803-\\uA805\\uA807-\\uA80A\\uA80C-\\uA822\\uA840-\\uA873\\uA882-\\uA8B3\\uA8F2-\\uA8F7\\uA8FB\\uA90A-\\uA925\\uA930-\\uA946\\uA960-\\uA97C\\uA984-\\uA9B2\\uA9CF\\uA9E0-\\uA9E4\\uA9E6-\\uA9EF\\uA9FA-\\uA9FE\\uAA00-\\uAA28\\uAA40-\\uAA42\\uAA44-\\uAA4B\\uAA60-\\uAA76\\uAA7A\\uAA7E-\\uAAAF\\uAAB1\\uAAB5\\uAAB6\\uAAB9-\\uAABD\\uAAC0\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEA\\uAAF2-\\uAAF4\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABE2\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D\\uFB1F-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF21-\\uFF3A\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]"),X6=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0300-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u0483-\\u0487\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u0591-\\u05BD\\u05BF\\u05C1\\u05C2\\u05C4\\u05C5\\u05C7\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0610-\\u061A\\u0620-\\u0669\\u066E-\\u06D3\\u06D5-\\u06DC\\u06DF-\\u06E8\\u06EA-\\u06FC\\u06FF\\u0710-\\u074A\\u074D-\\u07B1\\u07C0-\\u07F5\\u07FA\\u0800-\\u082D\\u0840-\\u085B\\u08A0-\\u08B2\\u08E4-\\u0963\\u0966-\\u096F\\u0971-\\u0983\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BC-\\u09C4\\u09C7\\u09C8\\u09CB-\\u09CE\\u09D7\\u09DC\\u09DD\\u09DF-\\u09E3\\u09E6-\\u09F1\\u0A01-\\u0A03\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A3C\\u0A3E-\\u0A42\\u0A47\\u0A48\\u0A4B-\\u0A4D\\u0A51\\u0A59-\\u0A5C\\u0A5E\\u0A66-\\u0A75\\u0A81-\\u0A83\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABC-\\u0AC5\\u0AC7-\\u0AC9\\u0ACB-\\u0ACD\\u0AD0\\u0AE0-\\u0AE3\\u0AE6-\\u0AEF\\u0B01-\\u0B03\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3C-\\u0B44\\u0B47\\u0B48\\u0B4B-\\u0B4D\\u0B56\\u0B57\\u0B5C\\u0B5D\\u0B5F-\\u0B63\\u0B66-\\u0B6F\\u0B71\\u0B82\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BBE-\\u0BC2\\u0BC6-\\u0BC8\\u0BCA-\\u0BCD\\u0BD0\\u0BD7\\u0BE6-\\u0BEF\\u0C00-\\u0C03\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D-\\u0C44\\u0C46-\\u0C48\\u0C4A-\\u0C4D\\u0C55\\u0C56\\u0C58\\u0C59\\u0C60-\\u0C63\\u0C66-\\u0C6F\\u0C81-\\u0C83\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBC-\\u0CC4\\u0CC6-\\u0CC8\\u0CCA-\\u0CCD\\u0CD5\\u0CD6\\u0CDE\\u0CE0-\\u0CE3\\u0CE6-\\u0CEF\\u0CF1\\u0CF2\\u0D01-\\u0D03\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D-\\u0D44\\u0D46-\\u0D48\\u0D4A-\\u0D4E\\u0D57\\u0D60-\\u0D63\\u0D66-\\u0D6F\\u0D7A-\\u0D7F\\u0D82\\u0D83\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0DCA\\u0DCF-\\u0DD4\\u0DD6\\u0DD8-\\u0DDF\\u0DE6-\\u0DEF\\u0DF2\\u0DF3\\u0E01-\\u0E3A\\u0E40-\\u0E4E\\u0E50-\\u0E59\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB9\\u0EBB-\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EC8-\\u0ECD\\u0ED0-\\u0ED9\\u0EDC-\\u0EDF\\u0F00\\u0F18\\u0F19\\u0F20-\\u0F29\\u0F35\\u0F37\\u0F39\\u0F3E-\\u0F47\\u0F49-\\u0F6C\\u0F71-\\u0F84\\u0F86-\\u0F97\\u0F99-\\u0FBC\\u0FC6\\u1000-\\u1049\\u1050-\\u109D\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u135D-\\u135F\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1714\\u1720-\\u1734\\u1740-\\u1753\\u1760-\\u176C\\u176E-\\u1770\\u1772\\u1773\\u1780-\\u17D3\\u17D7\\u17DC\\u17DD\\u17E0-\\u17E9\\u180B-\\u180D\\u1810-\\u1819\\u1820-\\u1877\\u1880-\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1920-\\u192B\\u1930-\\u193B\\u1946-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19B0-\\u19C9\\u19D0-\\u19D9\\u1A00-\\u1A1B\\u1A20-\\u1A5E\\u1A60-\\u1A7C\\u1A7F-\\u1A89\\u1A90-\\u1A99\\u1AA7\\u1AB0-\\u1ABD\\u1B00-\\u1B4B\\u1B50-\\u1B59\\u1B6B-\\u1B73\\u1B80-\\u1BF3\\u1C00-\\u1C37\\u1C40-\\u1C49\\u1C4D-\\u1C7D\\u1CD0-\\u1CD2\\u1CD4-\\u1CF6\\u1CF8\\u1CF9\\u1D00-\\u1DF5\\u1DFC-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u200C\\u200D\\u203F\\u2040\\u2054\\u2071\\u207F\\u2090-\\u209C\\u20D0-\\u20DC\\u20E1\\u20E5-\\u20F0\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D7F-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2DE0-\\u2DFF\\u2E2F\\u3005-\\u3007\\u3021-\\u302F\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u3099\\u309A\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA62B\\uA640-\\uA66F\\uA674-\\uA67D\\uA67F-\\uA69D\\uA69F-\\uA6F1\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA827\\uA840-\\uA873\\uA880-\\uA8C4\\uA8D0-\\uA8D9\\uA8E0-\\uA8F7\\uA8FB\\uA900-\\uA92D\\uA930-\\uA953\\uA960-\\uA97C\\uA980-\\uA9C0\\uA9CF-\\uA9D9\\uA9E0-\\uA9FE\\uAA00-\\uAA36\\uAA40-\\uAA4D\\uAA50-\\uAA59\\uAA60-\\uAA76\\uAA7A-\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEF\\uAAF2-\\uAAF6\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABEA\\uABEC\\uABED\\uABF0-\\uABF9\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE00-\\uFE0F\\uFE20-\\uFE2D\\uFE33\\uFE34\\uFE4D-\\uFE4F\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF10-\\uFF19\\uFF21-\\uFF3A\\uFF3F\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]");function T2(e,t){if(!e)throw new Error("ASSERT: "+t)}function K0(e){return e>=48&&e<=57}function E3(e){return"0123456789abcdefABCDEF".indexOf(e)>=0}function bb(e){return"01234567".indexOf(e)>=0}function Y6(e){return e===32||e===9||e===11||e===12||e===160||e>=5760&&[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(e)>=0}function xb(e){return e===10||e===13||e===8232||e===8233}function wb(e){return e===36||e===95||e>=65&&e<=90||e>=97&&e<=122||e===92||e>=128&&K6.test(String.fromCharCode(e))}function N2(e){return e===36||e===95||e>=65&&e<=90||e>=97&&e<=122||e>=48&&e<=57||e===92||e>=128&&X6.test(String.fromCharCode(e))}const J6={if:1,in:1,do:1,var:1,for:1,new:1,try:1,let:1,this:1,else:1,case:1,void:1,with:1,enum:1,while:1,break:1,catch:1,throw:1,const:1,yield:1,class:1,super:1,return:1,typeof:1,delete:1,switch:1,export:1,import:1,public:1,static:1,default:1,finally:1,extends:1,package:1,private:1,function:1,continue:1,debugger:1,interface:1,protected:1,instanceof:1,implements:1};function f4(){for(;Ar<sf;){const e=Oi.charCodeAt(Ar);if(!Y6(e)&&!xb(e))break;++Ar}}function C3(e){var t,n,r,i=0;for(n=e==="u"?4:2,t=0;t<n;++t)Ar<sf&&E3(Oi[Ar])?(r=Oi[Ar++],i=16*i+"0123456789abcdef".indexOf(r.toLowerCase())):Da({},Bc,yl);return String.fromCharCode(i)}function Q6(){var e,t,n,r;for(t=0,(e=Oi[Ar])==="}"&&Da({},Bc,yl);Ar<sf&&E3(e=Oi[Ar++]);)t=16*t+"0123456789abcdef".indexOf(e.toLowerCase());return(t>1114111||e!=="}")&&Da({},Bc,yl),t<=65535?String.fromCharCode(t):(n=55296+(t-65536>>10),r=56320+(t-65536&1023),String.fromCharCode(n,r))}function h4(){var e,t;for(e=Oi.charCodeAt(Ar++),t=String.fromCharCode(e),e===92&&(Oi.charCodeAt(Ar)!==117&&Da({},Bc,yl),++Ar,(e=C3("u"))&&e!=="\\"&&wb(e.charCodeAt(0))||Da({},Bc,yl),t=e);Ar<sf&&N2(e=Oi.charCodeAt(Ar));)++Ar,t+=String.fromCharCode(e),e===92&&(t=t.substr(0,t.length-1),Oi.charCodeAt(Ar)!==117&&Da({},Bc,yl),++Ar,(e=C3("u"))&&e!=="\\"&&N2(e.charCodeAt(0))||Da({},Bc,yl),t+=e);return t}function Z6(){var e,t;return e=Ar,{type:(t=Oi.charCodeAt(Ar)===92?h4():function(){var n,r;for(n=Ar++;Ar<sf;){if((r=Oi.charCodeAt(Ar))===92)return Ar=n,h4();if(!N2(r))break;++Ar}return Oi.slice(n,Ar)}()).length===1?gy:J6.hasOwnProperty(t)?jv:t==="null"?D2:t==="true"||t==="false"?_2:gy,value:t,start:e,end:Ar}}function O3(){var e,t,n,r,i=Ar,s=Oi.charCodeAt(Ar),f=Oi[Ar];switch(s){case 46:case 40:case 41:case 59:case 44:case 123:case 125:case 91:case 93:case 58:case 63:case 126:return++Ar,{type:vd,value:String.fromCharCode(s),start:i,end:Ar};default:if((e=Oi.charCodeAt(Ar+1))===61)switch(s){case 43:case 45:case 47:case 60:case 62:case 94:case 124:case 37:case 38:case 42:return Ar+=2,{type:vd,value:String.fromCharCode(s)+String.fromCharCode(e),start:i,end:Ar};case 33:case 61:return Ar+=2,Oi.charCodeAt(Ar)===61&&++Ar,{type:vd,value:Oi.slice(i,Ar),start:i,end:Ar}}}return(r=Oi.substr(Ar,4))===">>>="?{type:vd,value:r,start:i,end:Ar+=4}:(n=r.substr(0,3))===">>>"||n==="<<="||n===">>="?{type:vd,value:n,start:i,end:Ar+=3}:f===(t=n.substr(0,2))[1]&&"+-<>&|".indexOf(f)>=0||t==="=>"?{type:vd,value:t,start:i,end:Ar+=2}:(t==="//"&&Da({},Bc,yl),"<>=!+-*%&|^/".indexOf(f)>=0?{type:vd,value:f,start:i,end:++Ar}:void Da({},Bc,yl))}function d4(){var e,t,n;if(T2(K0((n=Oi[Ar]).charCodeAt(0))||n===".","Numeric literal must start with a decimal digit or a decimal point"),t=Ar,e="",n!=="."){if(e=Oi[Ar++],n=Oi[Ar],e==="0"){if(n==="x"||n==="X")return++Ar,function(r){let i="";for(;Ar<sf&&E3(Oi[Ar]);)i+=Oi[Ar++];return i.length===0&&Da({},Bc,yl),wb(Oi.charCodeAt(Ar))&&Da({},Bc,yl),{type:vy,value:parseInt("0x"+i,16),start:r,end:Ar}}(t);if(bb(n))return function(r){let i="0"+Oi[Ar++];for(;Ar<sf&&bb(Oi[Ar]);)i+=Oi[Ar++];return(wb(Oi.charCodeAt(Ar))||K0(Oi.charCodeAt(Ar)))&&Da({},Bc,yl),{type:vy,value:parseInt(i,8),octal:!0,start:r,end:Ar}}(t);n&&K0(n.charCodeAt(0))&&Da({},Bc,yl)}for(;K0(Oi.charCodeAt(Ar));)e+=Oi[Ar++];n=Oi[Ar]}if(n==="."){for(e+=Oi[Ar++];K0(Oi.charCodeAt(Ar));)e+=Oi[Ar++];n=Oi[Ar]}if(n==="e"||n==="E")if(e+=Oi[Ar++],(n=Oi[Ar])!=="+"&&n!=="-"||(e+=Oi[Ar++]),K0(Oi.charCodeAt(Ar)))for(;K0(Oi.charCodeAt(Ar));)e+=Oi[Ar++];else Da({},Bc,yl);return wb(Oi.charCodeAt(Ar))&&Da({},Bc,yl),{type:vy,value:parseFloat(e),start:t,end:Ar}}function ej(){var e,t,n,r;return Ya=null,f4(),e=Ar,t=function(){var i,s,f,m;for(T2((i=Oi[Ar])==="/","Regular expression literal must start with a slash"),s=Oi[Ar++],f=!1,m=!1;Ar<sf;)if(s+=i=Oi[Ar++],i==="\\")xb((i=Oi[Ar++]).charCodeAt(0))&&Da({},k3),s+=i;else if(xb(i.charCodeAt(0)))Da({},k3);else if(f)i==="]"&&(f=!1);else{if(i==="/"){m=!0;break}i==="["&&(f=!0)}return m||Da({},k3),{value:s.substr(1,s.length-2),literal:s}}(),n=function(){var i,s,f;for(s="",f="";Ar<sf&&N2((i=Oi[Ar]).charCodeAt(0));)++Ar,i==="\\"&&Ar<sf?Da({},Bc,yl):(f+=i,s+=i);return f.search(/[^gimuy]/g)>=0&&Da({},w3,f),{value:f,literal:s}}(),r=function(i,s){let f=i;s.indexOf("u")>=0&&(f=f.replace(/\\u\{([0-9a-fA-F]+)\}/g,(m,x)=>{if(parseInt(x,16)<=1114111)return"x";Da({},w3)}).replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,"x"));try{new RegExp(f)}catch{Da({},w3)}try{return new RegExp(i,s)}catch{return null}}(t.value,n.value),{literal:t.literal+n.literal,value:r,regex:{pattern:t.value,flags:n.value},start:e,end:Ar}}function p4(){if(f4(),Ar>=sf)return{type:gb,start:Ar,end:Ar};const e=Oi.charCodeAt(Ar);return wb(e)?Z6():e===40||e===41||e===59?O3():e===39||e===34?function(){var t,n,r,i,s="",f=!1;for(T2((t=Oi[Ar])==="'"||t==='"',"String literal must starts with a quote"),n=Ar,++Ar;Ar<sf;){if((r=Oi[Ar++])===t){t="";break}if(r==="\\")if((r=Oi[Ar++])&&xb(r.charCodeAt(0)))r==="\r"&&Oi[Ar]===`
`&&++Ar;else switch(r){case"u":case"x":Oi[Ar]==="{"?(++Ar,s+=Q6()):s+=C3(r);break;case"n":s+=`
`;break;case"r":s+="\r";break;case"t":s+="	";break;case"b":s+="\b";break;case"f":s+="\f";break;case"v":s+="\v";break;default:bb(r)?((i="01234567".indexOf(r))!==0&&(f=!0),Ar<sf&&bb(Oi[Ar])&&(f=!0,i=8*i+"01234567".indexOf(Oi[Ar++]),"0123".indexOf(r)>=0&&Ar<sf&&bb(Oi[Ar])&&(i=8*i+"01234567".indexOf(Oi[Ar++]))),s+=String.fromCharCode(i)):s+=r}else{if(xb(r.charCodeAt(0)))break;s+=r}}return t!==""&&Da({},Bc,yl),{type:vb,value:s,octal:f,start:n,end:Ar}}():e===46?K0(Oi.charCodeAt(Ar+1))?d4():O3():K0(e)?d4():O3()}function yd(){const e=Ya;return Ar=e.end,Ya=p4(),Ar=e.end,e}function m4(){const e=Ar;Ya=p4(),Ar=e}function g4(e,t,n){const r=new tg(e==="||"||e==="&&"?B6:I6);return r.operator=e,r.left=t,r.right=n,r}function tj(e,t){const n=new tg(R6);return n.callee=e,n.arguments=t,n}function A3(e){const t=new tg(c4);return t.name=e,t}function kb(e){const t=new tg(j6);return t.value=e.value,t.raw=Oi.slice(e.start,e.end),e.regex&&(t.raw==="//"&&(t.raw="/(?:)/"),t.regex=e.regex),t}function v4(e,t,n){const r=new tg(P6);return r.computed=e==="[",r.object=t,r.property=n,r.computed||(n.member=!0),r}function y4(e,t,n){const r=new tg(z6);return r.key=t,r.value=n,r.kind=e,r}function Da(e,t){var n,r=Array.prototype.slice.call(arguments,2),i=t.replace(/%(\d)/g,(s,f)=>(T2(f<r.length,"Message reference must be in range"),r[f]));throw(n=new Error(i)).index=Ar,n.description=i,n}function F2(e){e.type===gb&&Da(e,$6),e.type===vy&&Da(e,W6),e.type===vb&&Da(e,V6),e.type===gy&&Da(e,q6),e.type===jv&&Da(e,H6),Da(e,Bc,e.value)}function uf(e){const t=yd();t.type===vd&&t.value===e||F2(t)}function Ps(e){return Ya.type===vd&&Ya.value===e}function S3(e){return Ya.type===jv&&Ya.value===e}function nj(){const e=[];for(Ar=Ya.start,uf("[");!Ps("]");)Ps(",")?(yd(),e.push(null)):(e.push(yy()),Ps("]")||uf(","));return yd(),function(t){const n=new tg(F6);return n.elements=t,n}(e)}function b4(){Ar=Ya.start;const e=yd();return e.type===vb||e.type===vy?(e.octal&&Da(e,l4),kb(e)):A3(e.value)}function rj(){var e,t,n;return Ar=Ya.start,(e=Ya).type===gy?(n=b4(),uf(":"),y4("init",n,yy())):e.type!==gb&&e.type!==vd?(t=b4(),uf(":"),y4("init",t,yy())):void F2(e)}function ij(){var e,t,n=[],r={},i=String;for(Ar=Ya.start,uf("{");!Ps("}");)t="$"+((e=rj()).key.type===c4?e.key.name:i(e.key.value)),Object.prototype.hasOwnProperty.call(r,t)?Da({},G6):r[t]=!0,n.push(e),Ps("}")||uf(",");return uf("}"),function(s){const f=new tg(L6);return f.properties=s,f}(n)}const oj={if:1};function aj(){var e,t,n;if(Ps("("))return function(){uf("(");const r=_3();return uf(")"),r}();if(Ps("["))return nj();if(Ps("{"))return ij();if(e=Ya.type,Ar=Ya.start,e===gy||oj[Ya.value])n=A3(yd().value);else if(e===vb||e===vy)Ya.octal&&Da(Ya,l4),n=kb(yd());else{if(e===jv)throw new Error(yb);e===_2?((t=yd()).value=t.value==="true",n=kb(t)):e===D2?((t=yd()).value=null,n=kb(t)):Ps("/")||Ps("/=")?(n=kb(ej()),m4()):F2(yd())}return n}function sj(){const e=[];if(uf("("),!Ps(")"))for(;Ar<sf&&(e.push(yy()),!Ps(")"));)uf(",");return uf(")"),e}function uj(){Ar=Ya.start;const e=yd();return function(t){return t.type===gy||t.type===jv||t.type===_2||t.type===D2}(e)||F2(e),A3(e.value)}function cj(){uf("[");const e=_3();return uf("]"),e}function x4(){const e=function(){var t;for(t=aj();;)if(Ps("."))uf("."),t=v4(".",t,uj());else if(Ps("("))t=tj(t,sj());else{if(!Ps("["))break;t=v4("[",t,cj())}return t}();if(Ya.type===vd&&(Ps("++")||Ps("--")))throw new Error(yb);return e}function I2(){var e,t;if(Ya.type!==vd&&Ya.type!==jv)t=x4();else{if(Ps("++")||Ps("--"))throw new Error(yb);if(Ps("+")||Ps("-")||Ps("~")||Ps("!"))e=yd(),t=I2(),t=function(n,r){const i=new tg(U6);return i.operator=n,i.argument=r,i.prefix=!0,i}(e.value,t);else{if(S3("delete")||S3("void")||S3("typeof"))throw new Error(yb);t=x4()}}return t}function w4(e){let t=0;if(e.type!==vd&&e.type!==jv)return 0;switch(e.value){case"||":t=1;break;case"&&":t=2;break;case"|":t=3;break;case"^":t=4;break;case"&":t=5;break;case"==":case"!=":case"===":case"!==":t=6;break;case"<":case">":case"<=":case">=":case"instanceof":case"in":t=7;break;case"<<":case">>":case">>>":t=8;break;case"+":case"-":t=9;break;case"*":case"/":case"%":t=11}return t}function yy(){var e,t;return e=function(){var n,r,i,s,f,m,x,O,T,M;if(n=Ya,T=I2(),(f=w4(s=Ya))===0)return T;for(s.prec=f,yd(),r=[n,Ya],m=[T,s,x=I2()];(f=w4(Ya))>0;){for(;m.length>2&&f<=m[m.length-2].prec;)x=m.pop(),O=m.pop().value,T=m.pop(),r.pop(),i=g4(O,T,x),m.push(i);(s=yd()).prec=f,m.push(s),r.push(Ya),i=I2(),m.push(i)}for(i=m[M=m.length-1],r.pop();M>1;)r.pop(),i=g4(m[M-1].value,m[M-2],i),M-=2;return i}(),Ps("?")&&(yd(),t=yy(),uf(":"),e=function(n,r,i){const s=new tg(M6);return s.test=n,s.consequent=r,s.alternate=i,s}(e,t,yy())),e}function _3(){const e=yy();if(Ps(","))throw new Error(yb);return e}var k4={NaN:"NaN",E:"Math.E",LN2:"Math.LN2",LN10:"Math.LN10",LOG2E:"Math.LOG2E",LOG10E:"Math.LOG10E",PI:"Math.PI",SQRT1_2:"Math.SQRT1_2",SQRT2:"Math.SQRT2",MIN_VALUE:"Number.MIN_VALUE",MAX_VALUE:"Number.MAX_VALUE"};function E4(e){function t(r,i,s){return f=>function(m,x,O,T){let M=e(x[0]);return O&&(M=O+"("+M+")",O.lastIndexOf("new ",0)===0&&(M="("+M+")")),M+"."+m+(T<0?"":T===0?"()":"("+x.slice(1).map(e).join(",")+")")}(r,f,i,s)}const n="new Date";return{isNaN:"Number.isNaN",isFinite:"Number.isFinite",abs:"Math.abs",acos:"Math.acos",asin:"Math.asin",atan:"Math.atan",atan2:"Math.atan2",ceil:"Math.ceil",cos:"Math.cos",exp:"Math.exp",floor:"Math.floor",log:"Math.log",max:"Math.max",min:"Math.min",pow:"Math.pow",random:"Math.random",round:"Math.round",sin:"Math.sin",sqrt:"Math.sqrt",tan:"Math.tan",clamp:function(r){r.length<3&&Object(be.o)("Missing arguments to clamp function."),r.length>3&&Object(be.o)("Too many arguments to clamp function.");const i=r.map(e);return"Math.max("+i[1]+", Math.min("+i[2]+","+i[0]+"))"},now:"Date.now",utc:"Date.UTC",datetime:n,date:t("getDate",n,0),day:t("getDay",n,0),year:t("getFullYear",n,0),month:t("getMonth",n,0),hours:t("getHours",n,0),minutes:t("getMinutes",n,0),seconds:t("getSeconds",n,0),milliseconds:t("getMilliseconds",n,0),time:t("getTime",n,0),timezoneoffset:t("getTimezoneOffset",n,0),utcdate:t("getUTCDate",n,0),utcday:t("getUTCDay",n,0),utcyear:t("getUTCFullYear",n,0),utcmonth:t("getUTCMonth",n,0),utchours:t("getUTCHours",n,0),utcminutes:t("getUTCMinutes",n,0),utcseconds:t("getUTCSeconds",n,0),utcmilliseconds:t("getUTCMilliseconds",n,0),length:t("length",null,-1),parseFloat:"parseFloat",parseInt:"parseInt",upper:t("toUpperCase","String",0),lower:t("toLowerCase","String",0),substring:t("substring","String"),split:t("split","String"),trim:t("trim","String",0),regexp:"RegExp",test:t("test","RegExp"),if:function(r){r.length<3&&Object(be.o)("Missing arguments to if function."),r.length>3&&Object(be.o)("Too many arguments to if function.");const i=r.map(e);return"("+i[0]+"?"+i[1]+":"+i[2]+")"}}}var C4,O4,D3,T3,N3,R2=new uh,M2=new uh,l0={point:vl,lineStart:vl,lineEnd:vl,polygonStart:function(){R2=new uh,l0.lineStart=lj,l0.lineEnd=fj},polygonEnd:function(){var e=+R2;M2.add(e<0?ch+e:e),this.lineStart=this.lineEnd=this.point=vl},sphere:function(){M2.add(ch)}};function lj(){l0.point=hj}function fj(){A4(C4,O4)}function hj(e,t){l0.point=A4,C4=e,O4=t,D3=e*=Ho,T3=Yi(t=(t*=Ho)/2+Ux),N3=Bi(t)}function A4(e,t){t=(t*=Ho)/2+Ux;var n=(e*=Ho)-D3,r=n>=0?1:-1,i=r*n,s=Yi(t),f=Bi(t),m=N3*f,x=T3*s+m*Yi(i),O=m*r*Bi(i);R2.add(cm(O,x)),D3=e,T3=s,N3=f}var su,bd,vu,Cp,by,S4,_4,v1,Eb,Bv,X0,Y0={point:F3,lineStart:T4,lineEnd:N4,polygonStart:function(){Y0.point=F4,Y0.lineStart=dj,Y0.lineEnd=pj,Eb=new uh,l0.polygonStart()},polygonEnd:function(){l0.polygonEnd(),Y0.point=F3,Y0.lineStart=T4,Y0.lineEnd=N4,R2<0?(su=-(vu=180),bd=-(Cp=90)):Eb>$i?Cp=90:Eb<-$i&&(bd=-90),X0[0]=su,X0[1]=vu},sphere:function(){su=-(vu=180),bd=-(Cp=90)}};function F3(e,t){Bv.push(X0=[su=e,vu=e]),t<bd&&(bd=t),t>Cp&&(Cp=t)}function D4(e,t){var n=fy([e*Ho,t*Ho]);if(v1){var r=u1(v1,n),i=u1([r[1],-r[0],0],r);t2(i),i=Qx(i);var s,f=e-by,m=f>0?1:-1,x=i[0]*Ru*m,O=pa(f)>180;O^(m*by<x&&x<m*e)?(s=i[1]*Ru)>Cp&&(Cp=s):O^(m*by<(x=(x+360)%360-180)&&x<m*e)?(s=-i[1]*Ru)<bd&&(bd=s):(t<bd&&(bd=t),t>Cp&&(Cp=t)),O?e<by?Op(su,e)>Op(su,vu)&&(vu=e):Op(e,vu)>Op(su,vu)&&(su=e):vu>=su?(e<su&&(su=e),e>vu&&(vu=e)):e>by?Op(su,e)>Op(su,vu)&&(vu=e):Op(e,vu)>Op(su,vu)&&(su=e)}else Bv.push(X0=[su=e,vu=e]);t<bd&&(bd=t),t>Cp&&(Cp=t),v1=n,by=e}function T4(){Y0.point=D4}function N4(){X0[0]=su,X0[1]=vu,Y0.point=F3,v1=null}function F4(e,t){if(v1){var n=e-by;Eb.add(pa(n)>180?n+(n>0?360:-360):n)}else S4=e,_4=t;l0.point(e,t),D4(e,t)}function dj(){l0.lineStart()}function pj(){F4(S4,_4),l0.lineEnd(),pa(Eb)>$i&&(su=-(vu=180)),X0[0]=su,X0[1]=vu,v1=null}function Op(e,t){return(t-=e)<0?t+360:t}function mj(e,t){return e[0]-t[0]}function I4(e,t){return e[0]<=e[1]?e[0]<=t&&t<=e[1]:t<e[0]||e[1]<t}var j2,B2,P2,L2,z2,U2,W2,V2,I3,R3,M3,R4,M4,mh,gh,vh,ng={sphere:vl,point:j3,lineStart:j4,lineEnd:B4,polygonStart:function(){ng.lineStart=yj,ng.lineEnd=bj},polygonEnd:function(){ng.lineStart=j4,ng.lineEnd=B4}};function j3(e,t){e*=Ho;var n=Yi(t*=Ho);Cb(n*Yi(e),n*Bi(e),Bi(t))}function Cb(e,t,n){P2+=(e-P2)/++j2,L2+=(t-L2)/j2,z2+=(n-z2)/j2}function j4(){ng.point=gj}function gj(e,t){e*=Ho;var n=Yi(t*=Ho);mh=n*Yi(e),gh=n*Bi(e),vh=Bi(t),ng.point=vj,Cb(mh,gh,vh)}function vj(e,t){e*=Ho;var n=Yi(t*=Ho),r=n*Yi(e),i=n*Bi(e),s=Bi(t),f=cm(lh((f=gh*s-vh*i)*f+(f=vh*r-mh*s)*f+(f=mh*i-gh*r)*f),mh*r+gh*i+vh*s);B2+=f,U2+=f*(mh+(mh=r)),W2+=f*(gh+(gh=i)),V2+=f*(vh+(vh=s)),Cb(mh,gh,vh)}function B4(){ng.point=j3}function yj(){ng.point=xj}function bj(){P4(R4,M4),ng.point=j3}function xj(e,t){R4=e,M4=t,e*=Ho,t*=Ho,ng.point=P4;var n=Yi(t);mh=n*Yi(e),gh=n*Bi(e),vh=Bi(t),Cb(mh,gh,vh)}function P4(e,t){e*=Ho;var n=Yi(t*=Ho),r=n*Yi(e),i=n*Bi(e),s=Bi(t),f=gh*s-vh*i,m=vh*r-mh*s,x=mh*i-gh*r,O=Zk(f,m,x),T=gd(O),M=O&&-T/O;I3.add(M*f),R3.add(M*m),M3.add(M*x),B2+=T,U2+=T*(mh+(mh=r)),W2+=T*(gh+(gh=i)),V2+=T*(vh+(vh=s)),Cb(mh,gh,vh)}const wj="Literal";var J0,kj=1,Ej=2,Cj=3,Oj=4,Aj=5,Sj=6,_j=7,Dj=8;(J0={})[kj]="Boolean",J0[Ej]="<end>",J0[Cj]="Identifier",J0[Oj]="Keyword",J0[Aj]="Null",J0[Sj]="Numeric",J0[_j]="Punctuator",J0[Dj]="String",J0[9]="RegularExpression";const B3="intersect",L4="union",Tj="vlMulti",Nj="vlPoint",z4="or",Fj="and",Ij="E",Rj="R",Mj="R-E",jj="R-LE",Bj="R-RE",q2="index:unit";function U4(e,t){for(var n,r,i=t.fields,s=t.values,f=i.length,m=0;m<f;++m)if((r=i[m]).getter=be.u.getter||Object(be.u)(r.field),n=r.getter(e),Object(be.D)(n)&&(n=Object(be.Ea)(n)),Object(be.D)(s[m])&&(s[m]=Object(be.Ea)(s[m])),Object(be.D)(s[m][0])&&(s[m]=s[m].map(be.Ea)),r.type===Ij){if(Object(be.B)(s[m])?s[m].indexOf(n)<0:n!==s[m])return!1}else if(r.type===Rj){if(!Object(be.A)(n,s[m]))return!1}else if(r.type===Bj){if(!Object(be.A)(n,s[m],!0,!1))return!1}else if(r.type===Mj){if(!Object(be.A)(n,s[m],!1,!1))return!1}else if(r.type===jj&&!Object(be.A)(n,s[m],!1,!0))return!1;return!0}const P3=Object(be.u)("_vgsid_"),W4=function(e){let t=e,n=e;function r(i,s,f,m){for(f==null&&(f=0),m==null&&(m=i.length);f<m;){const x=f+m>>>1;n(i[x],s)<0?f=x+1:m=x}return f}return e.length===1&&(t=(i,s)=>e(i)-s,n=function(i){return(s,f)=>function(m,x){return m<x?-1:m>x?1:m>=x?0:NaN}(i(s),f)}(e)),{left:r,center:function(i,s,f,m){f==null&&(f=0),m==null&&(m=i.length);const x=r(i,s,f,m-1);return x>f&&t(i[x-1],s)>-t(i[x],s)?x-1:x},right:function(i,s,f,m){for(f==null&&(f=0),m==null&&(m=i.length);f<m;){const x=f+m>>>1;n(i[x],s)>0?m=x:f=x+1}return f}}}(P3),Pj=W4.left,Lj=W4.right;var V4={E_union:function(e,t){if(!e.length)return t;for(var n=0,r=t.length;n<r;++n)e.indexOf(t[n])<0&&e.push(t[n]);return e},E_intersect:function(e,t){return e.length?e.filter(n=>t.indexOf(n)>=0):t},R_union:function(e,t){var n=Object(be.Ea)(t[0]),r=Object(be.Ea)(t[1]);return n>r&&(n=t[1],r=t[0]),e.length?(e[0]>n&&(e[0]=n),e[1]<r&&(e[1]=r),e):[n,r]},R_intersect:function(e,t){var n=Object(be.Ea)(t[0]),r=Object(be.Ea)(t[1]);return n>r&&(n=t[1],r=t[0]),e.length?r<e[0]||e[1]<n?[]:(e[0]<n&&(e[0]=n),e[1]>r&&(e[1]=r),e):[n,r]}};const zj=":",Uj="@";function L3(e,t,n,r){t[0].type!==wj&&Object(be.o)("First argument to selection functions must be a string literal.");const i=t[0].value,s=t.length>=2&&Object(be.W)(t).value,f=Uj+"unit",m=zj+i;s!==B3||Object(be.w)(r,f)||(r[f]=n.getData(i).indataRef(n,"unit")),Object(be.w)(r,m)||(r[m]=n.getData(i).tuplesRef())}function q4(e){const t=this.context.data[e];return t?t.values.value:[]}const Ob=e=>function(t,n){return this.context.dataflow.locale()[e](n)(t)},Wj=Ob("format"),H4=Ob("timeFormat"),Vj=Ob("utcFormat"),qj=Ob("timeParse"),Hj=Ob("utcParse"),H2=new Date(2e3,0,1);function $2(e,t,n){return Number.isInteger(e)&&Number.isInteger(t)?(H2.setYear(2e3),H2.setMonth(e),H2.setDate(t),H4.call(this,H2,n)):""}const $j=":",Gj="@",z3="%",$4="$";function U3(e,t,n,r){t[0].type!==g1&&Object(be.o)("First argument to data functions must be a string literal.");const i=t[0].value,s=$j+i;if(!Object(be.w)(s,r))try{r[s]=n.getData(i).tuplesRef()}catch{}}function xd(e,t,n,r){if(t[0].type===g1)G4(n,r,t[0].value);else for(e in n.scales)G4(n,r,e)}function G4(e,t,n){const r=z3+n;if(!Object(be.w)(t,r))try{t[r]=e.scaleRef(n)}catch{}}function Q0(e,t){let n;return Object(be.E)(e)?e:Object(be.J)(e)?(n=t.scales[e])&&n.value:void 0}function W3(e,t){return function(n,r,i){if(n){const s=Q0(n,(i||this).context);return s&&s.path[e](r)}return t(r)}}const Kj=W3("area",function(e){return M2=new uh,V0(e,l0),2*M2}),Xj=W3("bounds",function(e){var t,n,r,i,s,f,m;if(Cp=vu=-(su=bd=1/0),Bv=[],V0(e,Y0),n=Bv.length){for(Bv.sort(mj),t=1,s=[r=Bv[0]];t<n;++t)I4(r,(i=Bv[t])[0])||I4(r,i[1])?(Op(r[0],i[1])>Op(r[0],r[1])&&(r[1]=i[1]),Op(i[0],r[1])>Op(r[0],r[1])&&(r[0]=i[0])):s.push(r=i);for(f=-1/0,t=0,r=s[n=s.length-1];t<=n;r=i,++t)i=s[t],(m=Op(r[1],i[0]))>f&&(f=m,su=i[0],vu=r[1])}return Bv=X0=null,su===1/0||bd===1/0?[[NaN,NaN],[NaN,NaN]]:[[su,bd],[vu,Cp]]}),Yj=W3("centroid",function(e){j2=B2=P2=L2=z2=U2=W2=V2=0,I3=new uh,R3=new uh,M3=new uh,V0(e,ng);var t=+I3,n=+R3,r=+M3,i=Zk(t,n,r);return i<1e-12&&(t=U2,n=W2,r=V2,B2<$i&&(t=P2,n=L2,r=z2),(i=Zk(t,n,r))<1e-12)?[NaN,NaN]:[cm(n,t)*Ru,gd(r/i)*Ru]});function V3(e,t,n){try{e[t].apply(e,["EXPRESSION"].concat([].slice.call(n)))}catch(r){e.warn(r)}return n[n.length-1]}function q3(e){const t=e/255;return t<=.03928?t/12.92:Math.pow((t+.055)/1.055,2.4)}function H3(e){const t=Wt(e);return .2126*q3(t.r)+.7152*q3(t.g)+.0722*q3(t.b)}function K4(e,t){return e===t||e!=e&&t!=t||(Object(be.B)(e)?!(!Object(be.B)(t)||e.length!==t.length)&&function(n,r){for(let i=0,s=n.length;i<s;++i)if(!K4(n[i],r[i]))return!1;return!0}(e,t):!(!Object(be.H)(e)||!Object(be.H)(t))&&X4(e,t))}function X4(e,t){for(const n in e)if(!K4(e[n],t[n]))return!1;return!0}function Y4(e){return t=>X4(e,t)}const J4={};function $3(e){return Object(be.B)(e)||ArrayBuffer.isView(e)?e:null}function G3(e){return $3(e)||(Object(be.J)(e)?e:null)}const Q4=e=>e.data;function Z4(e,t){const n=q4.call(t,e);return n.root&&n.root.lookup||{}}const eD=()=>typeof window<"u"&&window||null,Ab={random:()=>jn(),cumulativeNormal:qi,cumulativeLogNormal:Dd,cumulativeUniform:Ch,densityNormal:Eh,densityLogNormal:xc,densityUniform:yf,quantileNormal:ec,quantileLogNormal:as,quantileUniform:wc,sampleNormal:vs,sampleLogNormal:Bu,sampleUniform:Pu,isArray:be.B,isBoolean:be.C,isDate:be.D,isDefined:e=>e!==void 0,isNumber:be.G,isObject:be.H,isRegExp:be.I,isString:be.J,isTuple:Kt,isValid:e=>e!=null&&e==e,toBoolean:be.Ca,toDate:be.Da,toNumber:be.Ea,toString:be.Ga,indexof:function(e,...t){return G3(e).indexOf(...t)},join:function(e,...t){return $3(e).join(...t)},lastindexof:function(e,...t){return G3(e).lastIndexOf(...t)},replace:function(e,t,n){return Object(be.E)(n)&&Object(be.o)("Function argument passed to replace."),String(e).replace(t,n)},reverse:function(e){return $3(e).slice().reverse()},slice:function(e,...t){return G3(e).slice(...t)},flush:be.v,lerp:be.L,merge:function(){const e=[].slice.call(arguments);return e.unshift({}),Object(be.p)(...e)},pad:be.R,peek:be.W,pluck:function(e,t){const n=J4[t]||(J4[t]=Object(be.u)(t));return Object(be.B)(e)?e.map(n):n(e)},span:be.Z,inrange:be.A,truncate:be.Ha,rgb:Wt,lab:il,hcl:Tu,hsl:tr,luminance:H3,contrast:function(e,t){const n=H3(e),r=H3(t);return(Math.max(n,r)+.05)/(Math.min(n,r)+.05)},sequence:ys,format:Wj,utcFormat:Vj,utcParse:Hj,utcOffset:ar.w,utcSequence:ar.x,timeFormat:H4,timeParse:qj,timeOffset:ar.q,timeSequence:ar.r,timeUnitSpecifier:ar.s,monthFormat:function(e){return $2.call(this,e,1,"%B")},monthAbbrevFormat:function(e){return $2.call(this,e,1,"%b")},dayFormat:function(e){return $2.call(this,0,2+e,"%A")},dayAbbrevFormat:function(e){return $2.call(this,0,2+e,"%a")},quarter:be.X,utcquarter:be.Ja,week:ar.A,utcweek:ar.z,dayofyear:ar.m,utcdayofyear:ar.y,warn:function(){return V3(this.context.dataflow,"warn",arguments)},info:function(){return V3(this.context.dataflow,"info",arguments)},debug:function(){return V3(this.context.dataflow,"debug",arguments)},extent:be.q,inScope:function(e){const t=this.context.group;let n=!1;if(t)for(;e;){if(e===t){n=!0;break}e=e.mark.group}return n},intersect:function(e,t,n){if(!e)return[];const[r,i]=e,s=new Ka().set(r[0],r[1],i[0],i[1]);return kr(n||this.context.dataflow.scenegraph().root,s,function(f){let m=null;if(f){const x=Object(be.i)(f.marktype),O=Object(be.i)(f.markname);m=T=>(!x.length||x.some(M=>T.marktype===M))&&(!O.length||O.some(M=>T.name===M))}return m}(t))},clampRange:be.k,pinchDistance:function(e){const t=e.touches,n=t[0].clientX-t[1].clientX,r=t[0].clientY-t[1].clientY;return Math.sqrt(n*n+r*r)},pinchAngle:function(e){const t=e.touches;return Math.atan2(t[0].clientY-t[1].clientY,t[0].clientX-t[1].clientX)},screen:function(){const e=eD();return e?e.screen:{}},containerSize:function(){const e=this.context.dataflow,t=e.container&&e.container();return t?[t.clientWidth,t.clientHeight]:[void 0,void 0]},windowSize:function(){const e=eD();return e?[e.innerWidth,e.innerHeight]:[void 0,void 0]},bandspace:function(e,t,n){return zp(e||0,t||0,n||0)},setdata:function(e,t){const n=this.context.dataflow,r=this.context.data[e].input;return n.pulse(r,n.changeset().remove(be.Ia).insert(t)),1},pathShape:function(e){let t=null;return function(n){return n?rd(n,t=t||td(e)):e}},panLinear:be.S,panLog:be.T,panPow:be.U,panSymlog:be.V,zoomLinear:be.Na,zoomLog:be.Oa,zoomPow:be.Pa,zoomSymlog:be.Qa,encode:function(e,t,n){if(e){const r=this.context.dataflow,i=e.mark.source;r.pulse(i,r.changeset().encode(e,t))}return n!==void 0?n:e},modify:function(e,t,n,r,i,s){const f=this.context.dataflow,m=this.context.data[e],x=m.input,O=f.stamp();let T,M,H=m.changes;if(f._trigger===!1||!(x.value.length||t||r))return 0;if((!H||H.stamp<O)&&(m.changes=H=f.changeset(),H.stamp=O,f.runAfter(()=>{m.modified=!0,f.pulse(x,H).run()},!0,1)),n&&(T=n===!0?be.Ia:Object(be.B)(n)||Kt(n)?n:Y4(n),H.remove(T)),t&&H.insert(t),r&&(T=Y4(r),x.value.some(T)?H.remove(T):H.insert(r)),i)for(M in s)H.modify(i,M,s[M]);return 1}},Jj=["view","item","group","xy","x","y"],Qj="event.vega.",tD="this.",K3={},nD={forbidden:["_"],allowed:["datum","event","item"],fieldvar:"datum",globalvar:e=>`_[${Object(be.Ba)($4+e)}]`,functions:function(e){const t=E4(e);Jj.forEach(n=>t[n]=Qj+n);for(const n in Ab)t[n]=tD+n;return Object(be.p)(t,function(n,r,i){r.__bandwidth=f=>f&&f.bandwidth?f.bandwidth():0,i._bandwidth=xd,i._range=xd,i._scale=xd;const s=f=>"_["+(f.type===g1?Object(be.Ba)(z3+f.value):Object(be.Ba)(z3)+"+"+n(f))+"]";return{_bandwidth:f=>`this.__bandwidth(${s(f[0])})`,_range:f=>`${s(f[0])}.range()`,_scale:f=>`${s(f[0])}(${n(f[1])})`}}(e,Ab,K3)),t},constants:k4,visitors:K3},X3=function(e){const t=(e=e||{}).allowed?Object(be.Fa)(e.allowed):{},n=e.forbidden?Object(be.Fa)(e.forbidden):{},r=e.constants||k4,i=(e.functions||E4)(M),s=e.globalvar,f=e.fieldvar,m=Object(be.E)(s)?s:ue=>`${s}["${ue}"]`;let x={},O={},T=0;function M(ue){if(Object(be.J)(ue))return ue;const fe=H[ue.type];return fe==null&&Object(be.o)("Unsupported type: "+ue.type),fe(ue)}const H={Literal:ue=>ue.raw,Identifier:ue=>{const fe=ue.name;return T>0?fe:Object(be.w)(n,fe)?Object(be.o)("Illegal identifier: "+fe):Object(be.w)(r,fe)?r[fe]:Object(be.w)(t,fe)?fe:(x[fe]=1,m(fe))},MemberExpression:ue=>{const fe=!ue.computed,Ie=M(ue.object);fe&&(T+=1);const Pe=M(ue.property);return Ie===f&&(O[function(Le){const rt=Le&&Le.length-1;return rt&&(Le[0]==='"'&&Le[rt]==='"'||Le[0]==="'"&&Le[rt]==="'")?Le.slice(1,-1):Le}(Pe)]=1),fe&&(T-=1),Ie+(fe?"."+Pe:"["+Pe+"]")},CallExpression:ue=>{ue.callee.type!=="Identifier"&&Object(be.o)("Illegal callee type: "+ue.callee.type);const fe=ue.callee.name,Ie=ue.arguments,Pe=Object(be.w)(i,fe)&&i[fe];return Pe||Object(be.o)("Unrecognized function: "+fe),Object(be.E)(Pe)?Pe(Ie):Pe+"("+Ie.map(M).join(",")+")"},ArrayExpression:ue=>"["+ue.elements.map(M).join(",")+"]",BinaryExpression:ue=>"("+M(ue.left)+" "+ue.operator+" "+M(ue.right)+")",UnaryExpression:ue=>"("+ue.operator+M(ue.argument)+")",ConditionalExpression:ue=>"("+M(ue.test)+"?"+M(ue.consequent)+":"+M(ue.alternate)+")",LogicalExpression:ue=>"("+M(ue.left)+ue.operator+M(ue.right)+")",ObjectExpression:ue=>"{"+ue.properties.map(M).join(",")+"}",Property:ue=>{T+=1;const fe=M(ue.key);return T-=1,fe+":"+M(ue.value)}};function Z(ue){const fe={code:M(ue),globals:Object.keys(x),fields:Object.keys(O)};return x={},O={},fe}return Z.functions=i,Z.constants=r,Z}(nD);function Yu(e,t,n){return arguments.length===1?Ab[e]:(Ab[e]=t,n&&(K3[e]=n),X3&&(X3.functions[e]=tD+e),this)}function f0(e,t){const n={};let r;try{r=function(s){Ar=0,sf=(Oi=s).length,Ya=null,m4();const f=_3();if(Ya.type!==gb)throw new Error("Unexpect token after expression.");return f}(e=Object(be.J)(e)?e:Object(be.Ba)(e)+"")}catch{Object(be.o)("Expression parse error: "+e)}r.visit(s=>{if(s.type!==u4)return;const f=s.callee.name,m=nD.visitors[f];m&&m(f,s.arguments,t,n)});const i=X3(r);return i.globals.forEach(s=>{const f=$4+s;!Object(be.w)(n,f)&&t.getSignal(s)&&(n[f]=t.signalRef(s))}),{$expr:Object(be.p)({code:i.code},t.options.ast?{ast:r}:null),$fields:i.fields,$params:n}}Yu("bandwidth",function(e,t){const n=Q0(e,(t||this).context);return n&&n.bandwidth?n.bandwidth():0},xd),Yu("copy",function(e,t){const n=Q0(e,(t||this).context);return n?n.copy():void 0},xd),Yu("domain",function(e,t){const n=Q0(e,(t||this).context);return n?n.domain():[]},xd),Yu("range",function(e,t){const n=Q0(e,(t||this).context);return n&&n.range?n.range():[]},xd),Yu("invert",function(e,t,n){const r=Q0(e,(n||this).context);return r?Object(be.B)(t)?(r.invertRange||r.invert)(t):(r.invert||r.invertExtent)(t):void 0},xd),Yu("scale",function(e,t,n){const r=Q0(e,(n||this).context);return r?r(t):void 0},xd),Yu("gradient",function(e,t,n,r,i){e=Q0(e,(i||this).context);const s=qm(t,n);let f=e.domain(),m=f[0],x=Object(be.W)(f),O=be.y;return x-m?O=Zh(e,m,x):e=(e.interpolator?Ro("sequential")().interpolator(e.interpolator()):Ro("linear")().interpolate(e.interpolate()).range(e.range())).domain([m=0,x=1]),e.ticks&&(m!==(f=e.ticks(+r||15))[0]&&f.unshift(m),x!==Object(be.W)(f)&&f.push(x)),f.forEach(T=>s.stop(O(T),e(T))),s},xd),Yu("geoArea",Kj,xd),Yu("geoBounds",Xj,xd),Yu("geoCentroid",Yj,xd),Yu("geoShape",function(e,t,n){const r=Q0(e,(n||this).context);return function(i){return r?r.path.context(i)(t):""}},xd),Yu("indata",function(e,t,n){const r=this.context.data[e]["index:"+t],i=r?r.value.get(n):void 0;return i&&i.count},function(e,t,n,r){t[0].type!==g1&&Object(be.o)("First argument to indata must be a string literal."),t[1].type!==g1&&Object(be.o)("Second argument to indata must be a string literal.");const i=t[0].value,s=t[1].value,f=Gj+s;Object(be.w)(f,r)||(r[f]=n.getData(i).indataRef(n,s))}),Yu("data",q4,U3),Yu("treePath",function(e,t,n){const r=Z4(e,this),i=r[t],s=r[n];return i&&s?i.path(s).map(Q4):void 0},U3),Yu("treeAncestors",function(e,t){const n=Z4(e,this)[t];return n?n.ancestors().map(Q4):void 0},U3),Yu("vlSelectionTest",function(e,t,n){for(var r,i,s,f,m,x=this.context.data[e],O=x?x.values.value:[],T=x?x[q2]&&x[q2].value:void 0,M=n===B3,H=O.length,Z=0;Z<H;++Z)if(r=O[Z],T&&M){if((s=(i=i||{})[f=r.unit]||0)===-1)continue;if(m=U4(t,r),i[f]=m?-1:++s,m&&T.size===1)return!0;if(!m&&s===T.get(f).count)return!1}else if(M^(m=U4(t,r)))return m;return H&&M},L3),Yu("vlSelectionIdTest",function(e,t,n){const r=this.context.data[e],i=r?r.values.value:[],s=r?r[q2]&&r[q2].value:void 0,f=n===B3,m=P3(t),x=Pj(i,m);if(x===i.length||P3(i[x])!==m)return!1;if(s&&f){if(s.size===1)return!0;if(Lj(i,m)-x<s.size)return!1}return!0},L3),Yu("vlSelectionResolve",function(e,t,n,r){for(var i,s,f,m,x,O,T,M,H,Z,ue,fe=this.context.data[e],Ie=fe?fe.values.value:[],Pe={},Le={},rt={},it=Ie.length,ut=0;ut<it;++ut){for(m=(i=Ie[ut]).unit,s=i.fields,f=i.values,Z=0,ue=s.length;Z<ue;++Z)x=s[Z],T=(O=Pe[x.field]||(Pe[x.field]={}))[m]||(O[m]=[]),rt[x.field]=M=x.type.charAt(0),H=V4[M+"_union"],O[m]=H(T,Object(be.i)(f[Z]));n&&(T=Le[m]||(Le[m]=[])).push(Object(be.i)(f).reduce((st,mt,dt)=>(st[s[dt].field]=mt,st),{}))}return t=t||L4,Object.keys(Pe).forEach(st=>{Pe[st]=Object.keys(Pe[st]).map(mt=>Pe[st][mt]).reduce((mt,dt)=>mt===void 0?dt:V4[rt[st]+"_"+t](mt,dt))}),Ie=Object.keys(Le),n&&Ie.length&&(Pe[r?Nj:Tj]=t===L4?{[z4]:Ie.reduce((st,mt)=>(st.push(...Le[mt]),st),[])}:{[Fj]:Ie.map(st=>({[z4]:Le[st]}))}),Pe},L3),Yu("vlSelectionTuples",function(e,t){return e.map(n=>Object(be.p)({values:t.fields.map(r=>(r.getter||(r.getter=Object(be.u)(r.field)))(n.datum))},t))});const Zj=Object(be.Fa)(["rule"]),rD=Object(be.Fa)(["group","image","rect"]);function Y3(e){return(e+"").toLowerCase()}function Sb(e,t,n){n[n.length-1]!==";"&&(n="return("+n+");");const r=Function(...t.concat(n));return e&&e.functions?r.bind(e.functions):r}var e9={operator:(e,t)=>Sb(e,["_"],t.code),parameter:(e,t)=>Sb(e,["datum","_"],t.code),event:(e,t)=>Sb(e,["event"],t.code),handler:(e,t)=>Sb(e,["_","event"],"var datum=event.item&&event.item.datum;return ".concat(t.code,";")),encode:(e,t)=>{const{marktype:n,channels:r}=t;let i="var o=item,datum=o.datum,m=0,$;";for(const s in r){const f="o["+Object(be.Ba)(s)+"]";i+="$=".concat(r[s].code,";if(").concat(f,"!==$)").concat(f,"=$,m=1;")}return i+=function(s,f){let m="";return Zj[f]||(s.x2&&(s.x?(rD[f]&&(m+="if(o.x>o.x2)$=o.x,o.x=o.x2,o.x2=$;"),m+="o.width=o.x2-o.x;"):m+="o.x=o.x2-(o.width||0);"),s.xc&&(m+="o.x=o.xc-(o.width||0)/2;"),s.y2&&(s.y?(rD[f]&&(m+="if(o.y>o.y2)$=o.y,o.y=o.y2,o.y2=$;"),m+="o.height=o.y2-o.y;"):m+="o.y=o.y2-(o.height||0);"),s.yc&&(m+="o.y=o.yc-(o.height||0)/2;")),m}(r,n),Sb(e,["item","_"],i+="return m;")},codegen:{get(e){const t="[".concat(e.map(be.Ba).join("]["),"]"),n=Function("_","return _".concat(t,";"));return n.path=t,n},comparator(e,t){let n;const r=Function("a","b","var u, v; return "+e.map((i,s)=>{const f=t[s];let m,x;return i.path?(m="a".concat(i.path),x="b".concat(i.path)):((n=n||{})["f"+s]=i,m="this.f".concat(s,"(a)"),x="this.f".concat(s,"(b)")),function(O,T,M,H){return"((u = ".concat(O,") < (v = ").concat(T,") || u == null) && v != null ? ").concat(M,`
  : (u > v || v == null) && u != null ? `).concat(H,`
  : ((v = v instanceof Date ? +v : v), (u = u instanceof Date ? +u : u)) !== u && v === v ? `).concat(M,`
  : v !== v && u === u ? `).concat(H," : ")}(m,x,-f,f)}).join("")+"0;");return n?r.bind(n):r}}};function iD(e,t,n){if(!e||!Object(be.H)(e))return e;for(let r,i=0,s=oD.length;i<s;++i)if(r=oD[i],Object(be.w)(e,r.key))return r.parse(e,t,n);return e}var oD=[{key:"$ref",parse:function(e,t){return t.get(e.$ref)||Object(be.o)("Operator not defined: "+e.$ref)}},{key:"$key",parse:function(e,t){const n="k:"+e.$key+"_"+!!e.$flat;return t.fn[n]||(t.fn[n]=Object(be.K)(e.$key,e.$flat,t.expr.codegen))}},{key:"$expr",parse:function(e,t,n){e.$params&&t.parseParameters(e.$params,n);const r="e:"+e.$expr.code+"_"+e.$name;return t.fn[r]||(t.fn[r]=Object(be.f)(t.parameterExpression(e.$expr),e.$fields,e.$name))}},{key:"$field",parse:function(e,t){if(!e.$field)return null;const n="f:"+e.$field+"_"+e.$name;return t.fn[n]||(t.fn[n]=Object(be.u)(e.$field,e.$name,t.expr.codegen))}},{key:"$encode",parse:function(e,t){const n=e.$encode,r={};for(const i in n){const s=n[i];r[i]=Object(be.f)(t.encodeExpression(s.$expr),s.$fields),r[i].output=s.$output}return r}},{key:"$compare",parse:function(e,t){const n="c:"+e.$compare+"_"+e.$order,r=Object(be.i)(e.$compare).map(i=>i&&i.$tupleid?Zt:i);return t.fn[n]||(t.fn[n]=Object(be.l)(r,e.$order,t.expr.codegen))}},{key:"$context",parse:function(e,t){return t}},{key:"$subflow",parse:function(e,t){const n=e.$subflow;return function(r,i,s){const f=t.fork().parse(n),m=f.get(n.operators[0].id),x=f.signals.parent;return x&&x.set(s),m.detachSubflow=()=>t.detach(f),m}}},{key:"$tupleid",parse:function(){return Zt}}];const t9={skip:!0};function aD(e,t,n,r){return new sD(e,t,n,r)}function sD(e,t,n,r){this.dataflow=e,this.transforms=t,this.events=e.events.bind(e),this.expr=r||e9,this.signals={},this.scales={},this.nodes={},this.data={},this.fn={},n&&(this.functions=Object.create(n),this.functions.context=this)}function uD(e){this.dataflow=e.dataflow,this.transforms=e.transforms,this.events=e.events,this.expr=e.expr,this.signals=Object.create(e.signals),this.scales=Object.create(e.scales),this.nodes=Object.create(e.nodes),this.data=Object.create(e.data),this.fn=Object.create(e.fn),e.functions&&(this.functions=Object.create(e.functions),this.functions.context=this)}sD.prototype=uD.prototype={fork(){const e=new uD(this);return(this.subcontext||(this.subcontext=[])).push(e),e},detach(e){this.subcontext=this.subcontext.filter(n=>n!==e);const t=Object.keys(e.nodes);for(const n of t)e.nodes[n]._targets=null;for(const n of t)e.nodes[n].detach();e.nodes=null},get(e){return this.nodes[e]},set(e,t){return this.nodes[e]=t},add(e,t){const n=this,r=n.dataflow,i=e.value;if(n.set(e.id,t),function(s){return Y3(s)==="collect"}(e.type)&&i&&(i.$ingest?r.ingest(t,i.$ingest,i.$format):i.$request?r.preload(t,i.$request,i.$format):r.pulse(t,r.changeset().insert(i))),e.root&&(n.root=t),e.parent){let s=n.get(e.parent.$ref);s?(r.connect(s,[t]),t.targets().add(s)):(n.unresolved=n.unresolved||[]).push(()=>{s=n.get(e.parent.$ref),r.connect(s,[t]),t.targets().add(s)})}if(e.signal&&(n.signals[e.signal]=t),e.scale&&(n.scales[e.scale]=t),e.data)for(const s in e.data){const f=n.data[s]||(n.data[s]={});e.data[s].forEach(m=>f[m]=t)}},resolve(){return(this.unresolved||[]).forEach(e=>e()),delete this.unresolved,this},operator(e,t){this.add(e,this.dataflow.add(e.value,t))},transform(e,t){this.add(e,this.dataflow.add(this.transforms[Y3(t)]))},stream(e,t){this.set(e.id,t)},update(e,t,n,r,i){this.dataflow.on(t,n,r,i,e.options)},operatorExpression(e){return this.expr.operator(this,e)},parameterExpression(e){return this.expr.parameter(this,e)},eventExpression(e){return this.expr.event(this,e)},handlerExpression(e){return this.expr.handler(this,e)},encodeExpression(e){return this.expr.encode(this,e)},parse:function(e){const t=this,n=e.operators||[];return e.background&&(t.background=e.background),e.eventConfig&&(t.eventConfig=e.eventConfig),e.locale&&(t.locale=e.locale),n.forEach(r=>t.parseOperator(r)),n.forEach(r=>t.parseOperatorParameters(r)),(e.streams||[]).forEach(r=>t.parseStream(r)),(e.updates||[]).forEach(r=>t.parseUpdate(r)),t.resolve()},parseOperator:function(e){const t=this;!function(n){return Y3(n)==="operator"}(e.type)&&e.type?t.transform(e,e.type):t.operator(e,e.update?t.operatorExpression(e.update):null)},parseOperatorParameters:function(e){const t=this;if(e.params){const n=t.get(e.id);n||Object(be.o)("Invalid operator id: "+e.id),t.dataflow.connect(n,n.parameters(t.parseParameters(e.params),e.react,e.initonly))}},parseParameters:function(e,t){t=t||{};const n=this;for(const r in e){const i=e[r];t[r]=Object(be.B)(i)?i.map(s=>iD(s,n,t)):iD(i,n,t)}return t},parseStream:function(e){var t,n=this,r=e.filter!=null?n.eventExpression(e.filter):void 0,i=e.stream!=null?n.get(e.stream):void 0;e.source?i=n.events(e.source,e.type,r):e.merge&&(i=(t=e.merge.map(s=>n.get(s)))[0].merge.apply(t[0],t.slice(1))),e.between&&(t=e.between.map(s=>n.get(s)),i=i.between(t[0],t[1])),e.filter&&(i=i.filter(r)),e.throttle!=null&&(i=i.throttle(+e.throttle)),e.debounce!=null&&(i=i.debounce(+e.debounce)),i==null&&Object(be.o)("Invalid stream definition: "+JSON.stringify(e)),e.consume&&i.consume(!0),n.stream(e,i)},parseUpdate:function(e){var t,n=Object(be.H)(n=e.source)?n.$ref:n,r=this.get(n),i=e.update,s=void 0;r||Object(be.o)("Source not defined: "+e.source),t=e.target&&e.target.$expr?this.eventExpression(e.target.$expr):this.get(e.target),i&&i.$expr&&(i.$params&&(s=this.parseParameters(i.$params)),i=this.handlerExpression(i.$expr)),this.update(e,r,t,i,s)},getState:function(e){var t=this,n={};if(e.signals){var r=n.signals={};Object.keys(t.signals).forEach(s=>{const f=t.signals[s];e.signals(s,f)&&(r[s]=f.value)})}if(e.data){var i=n.data={};Object.keys(t.data).forEach(s=>{const f=t.data[s];e.data(s,f)&&(i[s]=f.input.value)})}return t.subcontext&&e.recurse!==!1&&(n.subcontext=t.subcontext.map(s=>s.getState(e))),n},setState:function(e){var t=this,n=t.dataflow,r=e.data,i=e.signals;Object.keys(i||{}).forEach(s=>{n.update(t.signals[s],i[s],t9)}),Object.keys(r||{}).forEach(s=>{n.pulse(t.data[s].input,n.changeset().remove(be.Ia).insert(r[s]))}),(e.subcontext||[]).forEach((s,f)=>{const m=t.subcontext[f];m&&m.setState(s)})}};var n9=function(e,t,n){var r=new g2,i=t;return t==null?(r.restart(e,t,n),r):(r._restart=r.restart,r.restart=function(s,f,m){f=+f,m=m==null?zE():+m,r._restart(function x(O){O+=i,r._restart(x,i+=f,m),s(O)},f,m)},r.restart(e,t,n),r)};function cD(e,t){e&&(t==null?e.removeAttribute("aria-label"):e.setAttribute("aria-label",t))}const J3="default";function Q3(e,t){const n=e.globalCursor()?typeof document<"u"&&document.body:e.container();if(n)return t==null?n.style.removeProperty("cursor"):n.style.cursor=t}function G2(e,t){var n=e._runtime.data;return Object(be.w)(n,t)||Object(be.o)("Unrecognized data set: "+t),n[t]}function K2(e,t){ti(t)||Object(be.o)("Second argument to changes must be a changeset.");const n=G2(this,e);return n.modified=!0,this.pulse(n.input,t)}function lD(e){var t=e.padding();return Math.max(0,e._viewWidth+t.left+t.right)}function fD(e){var t=e.padding();return Math.max(0,e._viewHeight+t.top+t.bottom)}function X2(e){var t=e.padding(),n=e._origin;return[t.left+n[0],t.top+n[1]]}function r9(e,t,n){var r,i,s=e._renderer,f=s&&s.canvas();return f&&(i=X2(e),(r=h(t.changedTouches?t.changedTouches[0]:t,f))[0]-=i[0],r[1]-=i[1]),t.dataflow=e,t.item=n,t.vega=function(m,x,O){const T=x?x.mark.marktype==="group"?x:x.mark.group:null;function M(Z){var ue,fe=T;if(Z){for(ue=x;ue;ue=ue.mark.group)if(ue.mark.name===Z){fe=ue;break}}return fe&&fe.mark&&fe.mark.interactive?fe:{}}function H(Z){if(!Z)return O;Object(be.J)(Z)&&(Z=M(Z));const ue=O.slice();for(;Z;)ue[0]-=Z.x||0,ue[1]-=Z.y||0,Z=Z.mark&&Z.mark.group;return ue}return{view:Object(be.m)(m),item:Object(be.m)(x||{}),group:M,xy:H,x:Z=>H(Z)[0],y:Z=>H(Z)[1]}}(e,n,r),t}const hD="view",i9="timer",o9="window",a9={trap:!1};function dD(e,t,n,r){e._eventListeners.push({type:n,sources:Object(be.i)(t),handler:r})}function Y2(e,t,n){const r=e._eventConfig&&e._eventConfig[t];return!(r===!1||Object(be.H)(r)&&!r[n])||(e.warn(`Blocked ${t} ${n} event listener.`),!1)}function pD(e){return e.item}function mD(e){return e.item.mark.source}function gD(e){return function(t,n){return n.vega.view().changeset().encode(n.item,e)}}function Ap(e,t,n){const r=document.createElement(e);for(const i in t)r.setAttribute(i,t[i]);return n!=null&&(r.textContent=n),r}const s9="vega-bind",u9="vega-bind-name",c9="vega-bind-radio";function l9(e,t,n,r){const i=n.event||"input",s=()=>e.update(t.value);r.signal(n.signal,t.value),t.addEventListener(i,s),dD(r,t,i,s),e.set=f=>{t.value=f,t.dispatchEvent(function(m){return typeof Event<"u"?new Event(m):{type:m}}(i))}}function f9(e,t,n,r){const i=r.signal(n.signal),s=Ap("div",{class:s9}),f=n.input==="radio"?s:s.appendChild(Ap("label"));f.appendChild(Ap("span",{class:u9},n.name||n.signal)),t.appendChild(s);let m=h9;switch(n.input){case"checkbox":m=d9;break;case"select":m=p9;break;case"radio":m=m9;break;case"range":m=g9}m(e,f,n,i)}function h9(e,t,n,r){const i=Ap("input");for(const s in n)s!=="signal"&&s!=="element"&&i.setAttribute(s==="input"?"type":s,n[s]);i.setAttribute("name",n.signal),i.value=r,t.appendChild(i),i.addEventListener("input",()=>e.update(i.value)),e.elements=[i],e.set=s=>i.value=s}function d9(e,t,n,r){const i={type:"checkbox",name:n.signal};r&&(i.checked=!0);const s=Ap("input",i);t.appendChild(s),s.addEventListener("change",()=>e.update(s.checked)),e.elements=[s],e.set=f=>s.checked=!!f||null}function p9(e,t,n,r){const i=Ap("select",{name:n.signal}),s=n.labels||[];n.options.forEach((f,m)=>{const x={value:f};J2(f,r)&&(x.selected=!0),i.appendChild(Ap("option",x,(s[m]||f)+""))}),t.appendChild(i),i.addEventListener("change",()=>{e.update(n.options[i.selectedIndex])}),e.elements=[i],e.set=f=>{for(let m=0,x=n.options.length;m<x;++m)if(J2(n.options[m],f))return void(i.selectedIndex=m)}}function m9(e,t,n,r){const i=Ap("span",{class:c9}),s=n.labels||[];t.appendChild(i),e.elements=n.options.map((f,m)=>{const x={type:"radio",name:n.signal,value:f};J2(f,r)&&(x.checked=!0);const O=Ap("input",x);O.addEventListener("change",()=>e.update(f));const T=Ap("label",{},(s[m]||f)+"");return T.prepend(O),i.appendChild(T),O}),e.set=f=>{const m=e.elements,x=m.length;for(let O=0;O<x;++O)J2(m[O].value,f)&&(m[O].checked=!0)}}function g9(e,t,n,r){r=r!==void 0?r:(+n.max+ +n.min)/2;const i=n.max!=null?n.max:Math.max(100,+r)||100,s=n.min||Math.min(0,i,+r)||0,f=n.step||Object(Cu.c)(s,i,100),m=Ap("input",{type:"range",name:n.signal,min:s,max:i,step:f});m.value=r;const x=Ap("span",{},+r);t.appendChild(m),t.appendChild(x);const O=()=>{x.textContent=m.value,e.update(+m.value)};m.addEventListener("input",O),m.addEventListener("change",O),e.elements=[m],e.set=T=>{m.value=T,x.textContent=T}}function J2(e,t){return e===t||e+""==t+""}function vD(e,t,n,r,i,s){return(t=t||new r(e.loader())).initialize(n,lD(e),fD(e),X2(e),i,s).background(e.background())}function Z3(e,t){return t?function(){try{t.apply(this,arguments)}catch(n){e.error(n)}}:null}function eC(e,t,n){if(typeof t=="string"){if(typeof document>"u")return e.error("DOM document instance not found."),null;if(!(t=document.querySelector(t)))return e.error("Signal bind element not found: "+t),null}if(t&&n)try{t.innerHTML=""}catch(r){t=null,e.error(r)}return t}const _b=e=>+e||0,v9=e=>({top:e,bottom:e,left:e,right:e});function yD(e){return Object(be.H)(e)?{top:_b(e.top),bottom:_b(e.bottom),left:_b(e.left),right:_b(e.right)}:v9(_b(e))}async function tC(e,t,n,r){const i=Er(t),s=i&&i.headless;return s||Object(be.o)("Unrecognized renderer type: "+t),await e.runAsync(),vD(e,null,null,s,n,r).renderAsync(e._scenegraph.root)}var bD="width",xD="height",nC="padding",wD={skip:!0};function kD(e,t){var n=e.autosize(),r=e.padding();return t-(n&&n.contains===nC?r.left+r.right:0)}function ED(e,t){var n=e.autosize(),r=e.padding();return t-(n&&n.contains===nC?r.top+r.bottom:0)}function y9(e,t){return t.modified&&Object(be.B)(t.input.value)&&e.indexOf("_:vega:_")}function b9(e,t){return!(e==="parent"||t instanceof pn.proxy)}function x9(e,t,n,r){const i=e.element();i&&i.setAttribute("title",function(s){return s==null?"":Object(be.B)(s)?CD(s):Object(be.H)(s)&&!Object(be.D)(s)?function(f){return Object.keys(f).map(m=>{const x=f[m];return m+": "+(Object(be.B)(x)?CD(x):OD(x))}).join(`
`)}(s):s+""}(r))}function CD(e){return"["+e.map(OD).join(", ")+"]"}function OD(e){return Object(be.B)(e)?"[]":Object(be.H)(e)&&!Object(be.D)(e)?"{}":e}function AD(e,t){const n=this;if(t=t||{},qn.call(n),t.loader&&n.loader(t.loader),t.logger&&n.logger(t.logger),t.logLevel!=null&&n.logLevel(t.logLevel),t.locale||e.locale){const s=Object(be.p)({},e.locale,t.locale);n.locale(Object(Dr.b)(s.number,s.time))}n._el=null,n._elBind=null,n._renderType=t.renderer||ur.Canvas,n._scenegraph=new i0;const r=n._scenegraph.root;n._renderer=null,n._tooltip=t.tooltip||x9,n._redraw=!0,n._handler=new We().scene(r),n._globalCursor=!1,n._preventDefault=!1,n._timers=[],n._eventListeners=[],n._resizeListeners=[],n._eventConfig=function(s){const f=Object(be.p)({defaults:{}},s),m=(x,O)=>{O.forEach(T=>{Object(be.B)(x[T])&&(x[T]=Object(be.Fa)(x[T]))})};return m(f.defaults,["prevent","allow"]),m(f,["view","window","selector"]),f}(e.eventConfig),n.globalCursor(n._eventConfig.globalCursor);const i=function(s,f,m){return aD(s,pn,Ab,m).parse(f)}(n,e,t.expr);n._runtime=i,n._signals=i.signals,n._bind=(e.bindings||[]).map(s=>({state:null,param:Object(be.p)({},s)})),i.root&&i.root.set(r),r.source=i.data.root.input,n.pulse(i.data.root.input,n.changeset().insert(r.items)),n._width=n.width(),n._height=n.height(),n._viewWidth=kD(n,n._width),n._viewHeight=ED(n,n._height),n._origin=[0,0],n._resize=0,n._autosize=1,function(s){var f=s._signals,m=f[bD],x=f[xD],O=f[nC];function T(){s._autosize=s._resize=1}s._resizeWidth=s.add(null,H=>{s._width=H.size,s._viewWidth=kD(s,H.size),T()},{size:m}),s._resizeHeight=s.add(null,H=>{s._height=H.size,s._viewHeight=ED(s,H.size),T()},{size:x});const M=s.add(null,T,{pad:O});s._resizeWidth.rank=m.rank+1,s._resizeHeight.rank=x.rank+1,M.rank=O.rank+1}(n),function(s){s.add(null,f=>(s._background=f.bg,s._resize=1,f.bg),{bg:s._signals.background})}(n),function(s){const f=s._signals.cursor||(s._signals.cursor=s.add({user:J3,item:null}));s.on(s.events("view","mousemove"),f,(m,x)=>{const O=f.value,T=O?Object(be.J)(O)?O:O.user:J3,M=x.item&&x.item.cursor||null;return O&&T===O.user&&M==O.item?O:{user:T,item:M}}),s.add(null,function(m){let x=m.cursor,O=this.value;return Object(be.J)(x)||(O=x.item,x=x.user),Q3(s,x&&x!==J3?x:O||x),O},{cursor:f})}(n),n.description(e.description),t.hover&&n.hover(),t.container&&n.initialize(t.container,t.bind)}function Q2(e,t){return Object(be.w)(e._signals,t)?e._signals[t]:Object(be.o)("Unrecognized signal name: "+Object(be.Ba)(t))}function SD(e,t){const n=(e._targets||[]).filter(r=>r._update&&r._update.handler===t);return n.length?n[0]:null}function _D(e,t,n,r){let i=SD(n,r);return i||((i=Z3(e,()=>r(t,n.value))).handler=r,e.on(n,null,i)),e}function DD(e,t,n){const r=SD(t,n);return r&&t._targets.remove(r),e}Object(be.z)(AD,qn,{async evaluate(e,t,n){if(await qn.prototype.evaluate.call(this,e,t),this._redraw||this._resize)try{this._renderer&&(this._resize&&(this._resize=0,function(r){var i=X2(r),s=lD(r),f=fD(r);r._renderer.background(r.background()),r._renderer.resize(s,f,i),r._handler.origin(i),r._resizeListeners.forEach(m=>{try{m(s,f)}catch(x){r.error(x)}})}(this)),await this._renderer.renderAsync(this._scenegraph.root)),this._redraw=!1}catch(r){this.error(r)}return n&&Nr(this,n),this},dirty(e){this._redraw=!0,this._renderer&&this._renderer.dirty(e)},description(e){if(arguments.length){const t=e!=null?e+"":null;return t!==this._desc&&cD(this._el,this._desc=t),this}return this._desc},container(){return this._el},scenegraph(){return this._scenegraph},origin(){return this._origin.slice()},signal(e,t,n){const r=Q2(this,e);return arguments.length===1?r.value:this.update(r,t,n)},width(e){return arguments.length?this.signal("width",e):this.signal("width")},height(e){return arguments.length?this.signal("height",e):this.signal("height")},padding(e){return arguments.length?this.signal("padding",yD(e)):yD(this.signal("padding"))},autosize(e){return arguments.length?this.signal("autosize",e):this.signal("autosize")},background(e){return arguments.length?this.signal("background",e):this.signal("background")},renderer(e){return arguments.length?(Er(e)||Object(be.o)("Unrecognized renderer type: "+e),e!==this._renderType&&(this._renderType=e,this._resetRenderer()),this):this._renderType},tooltip(e){return arguments.length?(e!==this._tooltip&&(this._tooltip=e,this._resetRenderer()),this):this._tooltip},loader(e){return arguments.length?(e!==this._loader&&(qn.prototype.loader.call(this,e),this._resetRenderer()),this):this._loader},resize(){return this._autosize=1,this.touch(Q2(this,"autosize"))},_resetRenderer(){this._renderer&&(this._renderer=null,this.initialize(this._el,this._elBind))},_resizeView:function(e,t,n,r,i,s){this.runAfter(f=>{let m=0;f._autosize=0,f.width()!==n&&(m=1,f.signal(bD,n,wD),f._resizeWidth.skip(!0)),f.height()!==r&&(m=1,f.signal(xD,r,wD),f._resizeHeight.skip(!0)),f._viewWidth!==e&&(f._resize=1,f._viewWidth=e),f._viewHeight!==t&&(f._resize=1,f._viewHeight=t),f._origin[0]===i[0]&&f._origin[1]===i[1]||(f._resize=1,f._origin=i),m&&f.run("enter"),s&&f.runAfter(x=>x.resize())},!1,1)},addEventListener(e,t,n){let r=t;return n&&n.trap===!1||((r=Z3(this,t)).raw=t),this._handler.on(e,r),this},removeEventListener(e,t){for(var n,r,i=this._handler.handlers(e),s=i.length;--s>=0;)if(r=i[s].type,n=i[s].handler,e===r&&(t===n||t===n.raw)){this._handler.off(r,n);break}return this},addResizeListener(e){const t=this._resizeListeners;return t.indexOf(e)<0&&t.push(e),this},removeResizeListener(e){var t=this._resizeListeners,n=t.indexOf(e);return n>=0&&t.splice(n,1),this},addSignalListener(e,t){return _D(this,e,Q2(this,e),t)},removeSignalListener(e,t){return DD(this,Q2(this,e),t)},addDataListener(e,t){return _D(this,e,G2(this,e).values,t)},removeDataListener(e,t){return DD(this,G2(this,e).values,t)},globalCursor(e){if(arguments.length){if(this._globalCursor!==!!e){const t=Q3(this,null);this._globalCursor=!!e,t&&Q3(this,t)}return this}return this._globalCursor},preventDefault(e){return arguments.length?(this._preventDefault=e,this):this._preventDefault},timer:function(e,t){this._timers.push(n9(function(n){e({timestamp:Date.now(),elapsed:n})},t))},events:function(e,t,n){var r,i=this,s=new Ei(n),f=function(O,T){i.runAsync(null,()=>{e===hD&&function(M,H){var Z=M._eventConfig.defaults,ue=Z.prevent,fe=Z.allow;return ue!==!1&&fe!==!0&&(ue===!0||fe===!1||(ue?ue[H]:fe?!fe[H]:M.preventDefault()))}(i,t)&&O.preventDefault(),s.receive(r9(i,O,T))})};if(e===i9)Y2(i,"timer",t)&&i.timer(f,t);else if(e===hD)Y2(i,"view",t)&&i.addEventListener(t,f,a9);else if(e===o9?Y2(i,"window",t)&&typeof window<"u"&&(r=[window]):typeof document<"u"&&Y2(i,"selector",t)&&(r=document.querySelectorAll(e)),r){for(var m=0,x=r.length;m<x;++m)r[m].addEventListener(t,f);dD(i,r,t,f)}else i.warn("Can not resolve event source: "+e);return s},finalize:function(){var e,t,n,r=this._tooltip,i=this._timers,s=this._eventListeners;for(e=i.length;--e>=0;)i[e].stop();for(e=s.length;--e>=0;)for(t=(n=s[e]).sources.length;--t>=0;)n.sources[t].removeEventListener(n.type,n.handler);return r&&r.call(this,this._handler,null,null,null),this},hover:function(e,t){return e=[e||"hover"],t=[t||"update",e[0]],this.on(this.events("view","mouseover",pD),mD,gD(e)),this.on(this.events("view","mouseout",pD),mD,gD(t)),this},data:function(e,t){return arguments.length<2?G2(this,e).values.value:K2.call(this,e,Mr().remove(be.Ia).insert(t))},change:K2,insert:function(e,t){return K2.call(this,e,Mr().insert(t))},remove:function(e,t){return K2.call(this,e,Mr().remove(t))},scale:function(e){var t=this._runtime.scales;return Object(be.w)(t,e)||Object(be.o)("Unrecognized scale or projection: "+e),t[e].value},initialize:function(e,t){const n=this,r=n._renderType,i=n._eventConfig.bind,s=Er(r);e=n._el=e?eC(n,e,!0):null,function(x){const O=x.container();O&&(O.setAttribute("role","graphics-document"),O.setAttribute("aria-roleDescription","visualization"),cD(O,x.description()))}(n),s||n.error("Unrecognized renderer type: "+r);const f=s.handler||We,m=e?s.renderer:s.headless;return n._renderer=m?vD(n,n._renderer,e,m):null,n._handler=function(x,O,T,M){const H=new M(x.loader(),Z3(x,x.tooltip())).scene(x.scenegraph().root).initialize(T,X2(x),x);return O&&O.handlers().forEach(Z=>{H.on(Z.type,Z.handler)}),H}(n,n._handler,e,f),n._redraw=!0,e&&i!=="none"&&(t=t?n._elBind=eC(n,t,!0):e.appendChild(Ap("form",{class:"vega-bindings"})),n._bind.forEach(x=>{x.param.element&&i!=="container"&&(x.element=eC(n,x.param.element,!!x.param.input))}),n._bind.forEach(x=>{(function(O,T,M){if(!T)return;const H=M.param;let Z=M.state;Z||(Z=M.state={elements:null,active:!1,set:null,update:ue=>{ue!=O.signal(H.signal)&&O.runAsync(null,()=>{Z.source=!0,O.signal(H.signal,ue)})}},H.debounce&&(Z.update=Object(be.n)(H.debounce,Z.update))),(H.input==null&&H.element?l9:f9)(Z,T,H,O),Z.active||(O.on(O._signals[H.signal],null,()=>{Z.source?Z.source=!1:Z.set(O.signal(H.signal))}),Z.active=!0)})(n,x.element||t,x)})),n},toImageURL:async function(e,t){e!==ur.Canvas&&e!==ur.SVG&&e!==ur.PNG&&Object(be.o)("Unrecognized image type: "+e);const n=await tC(this,e,t);return e===ur.SVG?function(r,i){const s=new Blob([r],{type:i});return window.URL.createObjectURL(s)}(n.svg(),"image/svg+xml"):n.canvas().toDataURL("image/png")},toCanvas:async function(e,t){return(await tC(this,ur.Canvas,e,t)).canvas()},toSVG:async function(e){return(await tC(this,ur.SVG,e)).svg()},getState:function(e){return this._runtime.getState(e||{data:y9,signals:b9,recurse:!0})},setState:function(e){return this.runAsync(null,t=>{t._trigger=!1,t._runtime.setState(e)},t=>{t._trigger=!0}),this}});const w9="view",Z2="[",ew="]",TD="{",ND="}",k9=":",FD=",",E9="@",C9=">",O9=/[[\]{}]/,A9={"*":1,arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1};let ID,RD;function Db(e,t,n,r,i){const s=e.length;let f,m=0;for(;t<s;++t){if(f=e[t],!m&&f===n)return t;i&&i.indexOf(f)>=0?--m:r&&r.indexOf(f)>=0&&++m}return t}function MD(e){const t=[],n=e.length;let r=0,i=0;for(;i<n;)i=Db(e,i,FD,Z2+TD,ew+ND),t.push(e.substring(r,i).trim()),r=++i;if(t.length===0)throw"Empty event selector: "+e;return t}function rC(e){return e[0]==="["?function(t){const n=t.length;let r,i=1;if((i=Db(t,i,ew,Z2,ew))===n)throw"Empty between selector: "+t;if((r=MD(t.substring(1,i))).length!==2)throw"Between selector must have two elements: "+t;if((t=t.slice(i+1).trim())[0]!==C9)throw"Expected '>' after between selector: "+t;r=r.map(rC);const s=rC(t.slice(1).trim());return s.between?{between:r,stream:s}:(s.between=r,s)}(e):function(t){const n={source:ID},r=[];let i,s,f=[0,0],m=0,x=0,O=t.length,T=0;if(t[O-1]===ND){if(!((T=t.lastIndexOf(TD))>=0))throw"Unmatched right brace: "+t;try{f=function(M){const H=M.split(FD);if(!M.length||H.length>2)throw M;return H.map(Z=>{const ue=+Z;if(ue!=ue)throw M;return ue})}(t.substring(T+1,O-1))}catch{throw"Invalid throttle specification: "+t}t=t.slice(0,T).trim(),O=t.length,T=0}if(!O)throw t;if(t[0]===E9&&(m=++T),(i=Db(t,T,k9))<O&&(r.push(t.substring(x,i).trim()),x=T=++i),(T=Db(t,T,Z2))===O)r.push(t.substring(x,O).trim());else if(r.push(t.substring(x,T).trim()),s=[],(x=++T)===O)throw"Unmatched left bracket: "+t;for(;T<O;){if((T=Db(t,T,ew))===O)throw"Unmatched left bracket: "+t;if(s.push(t.substring(x,T).trim()),T<O-1&&t[++T]!==Z2)throw"Expected left bracket: "+t;x=++T}if(!(O=r.length)||O9.test(r[O-1]))throw"Invalid event selector: "+t;return O>1?(n.type=r[1],m?n.markname=r[0].slice(1):function(M){return RD[M]}(r[0])?n.marktype=r[0]:n.source=r[0]):n.type=r[0],n.type.slice(-1)==="!"&&(n.consume=!0,n.type=n.type.slice(0,-1)),s!=null&&(n.filter=s),f[0]&&(n.throttle=f[0]),f[1]&&(n.debounce=f[1]),n}(e)}const Tb=e=>+e||0,S9=e=>({top:e,bottom:e,left:e,right:e}),Pc=e=>Object(be.H)(e)&&!Object(be.B)(e)?Object(be.p)({},e):{value:e};function jD(e,t,n,r){return n!=null?(Object(be.H)(n)&&!Object(be.B)(n)||Object(be.B)(n)&&n.length&&Object(be.H)(n[0])?e.update[t]=n:e[r||"enter"][t]={value:n},1):0}function bl(e,t,n){for(const r in t)jD(e,r,t[r]);for(const r in n)jD(e,r,n[r],"update")}function y1(e,t,n){for(const r in t)n&&Object(be.w)(n,r)||(e[r]=Object(be.p)(e[r]||{},t[r]));return e}function b1(e,t){return t&&(t.enter&&t.enter[e]||t.update&&t.update[e])}const iC="mark",oC="frame",aC="scope",_9="axis",D9="axis-domain",T9="axis-grid",N9="axis-label",F9="axis-tick",I9="axis-title",R9="legend",M9="legend-band",j9="legend-entry",B9="legend-gradient",BD="legend-label",P9="legend-symbol",L9="legend-title",z9="title",U9="title-text",W9="title-subtitle";function sC(e,t,n){e[t]=n&&n.signal?{signal:n.signal}:{value:n}}const PD=e=>Object(be.J)(e)?Object(be.Ba)(e):e.signal?`(${e.signal})`:LD(e);function tw(e){if(e.gradient!=null)return function(n){const r=[n.start,n.stop,n.count].map(i=>i==null?null:Object(be.Ba)(i));for(;r.length&&Object(be.W)(r)==null;)r.pop();return r.unshift(PD(n.gradient)),`gradient(${r.join(",")})`}(e);let t=e.signal?`(${e.signal})`:e.color?function(n){return n.c?nw("hcl",n.h,n.c,n.l):n.h||n.s?nw("hsl",n.h,n.s,n.l):n.l||n.a?nw("lab",n.l,n.a,n.b):n.r||n.g||n.b?nw("rgb",n.r,n.g,n.b):null}(e.color):e.field!=null?LD(e.field):e.value!==void 0?Object(be.Ba)(e.value):void 0;return e.scale!=null&&(t=function(n,r){const i=PD(n.scale);return n.range!=null?r=`lerp(_range(${i}), ${+n.range})`:(r!==void 0&&(r=`_scale(${i}, ${r})`),n.band&&(r=(r?r+"+":"")+`_bandwidth(${i})`+(+n.band==1?"":"*"+rw(n.band)),n.extra&&(r=`(datum.extra ? _scale(${i}, datum.extra.value) : ${r})`)),r==null&&(r="0")),r}(e,t)),t===void 0&&(t=null),e.exponent!=null&&(t=`pow(${t},${rw(e.exponent)})`),e.mult!=null&&(t+=`*${rw(e.mult)}`),e.offset!=null&&(t+=`+${rw(e.offset)}`),e.round&&(t=`round(${t})`),t}const nw=(e,t,n,r)=>`(${e}(${[t,n,r].map(tw).join(",")})+'')`;function rw(e){return Object(be.H)(e)?"("+tw(e)+")":e}function LD(e){return function t(n){let r,i,s;if(n.signal)r="datum",s=n.signal;else if(n.group||n.parent){for(i=Math.max(1,n.level||1),r="item";i-- >0;)r+=".mark.group";n.parent?(s=n.parent,r+=".datum"):s=n.group}else n.datum?(r="datum",s=n.datum):Object(be.o)("Invalid field reference: "+Object(be.Ba)(n));return n.signal||(s=Object(be.J)(s)?Object(be.Aa)(s).map(be.Ba).join("]["):t(s)),r+"["+s+"]"}(Object(be.H)(e)?e:{datum:e})}function zD(e,t,n,r,i,s){const f={};(s=s||{}).encoders={$encode:f},e=function(m,x,O,T,M){const H={},Z={};let ue,fe,Ie;for(fe in fe="lineBreak",x!=="text"||M[fe]==null||b1(fe,m)||sC(H,fe,M[fe]),(O=="legend"||String(O).startsWith("axis"))&&(O=null),Ie=O===oC?M.group:O===iC?Object(be.p)({},M.mark,M[x]):null)b1(fe,m)||(fe==="fill"||fe==="stroke")&&(b1("fill",m)||b1("stroke",m))||sC(H,fe,Ie[fe]);for(fe in Object(be.i)(T).forEach(Pe=>{const Le=M.style&&M.style[Pe];for(const rt in Le)b1(rt,m)||sC(H,rt,Le[rt])}),m=Object(be.p)({},m),H)(Ie=H[fe]).signal?(ue=ue||{})[fe]=Ie:Z[fe]=Ie;return m.enter=Object(be.p)(Z,m.enter),ue&&(m.update=Object(be.p)(ue,m.update)),m}(e,t,n,r,i.config);for(const m in e)f[m]=V9(e[m],t,s,i);return s}function V9(e,t,n,r){const i={},s={};for(const f in e)e[f]!=null&&(i[f]=H9(q9(e[f]),r,n,s));return{$expr:{marktype:t,channels:i},$fields:Object.keys(s),$output:Object.keys(e)}}function q9(e){return Object(be.B)(e)?function(t){let n="";return t.forEach(r=>{const i=tw(r);n+=r.test?`(${r.test})?${i}:`:i}),Object(be.W)(n)===":"&&(n+="null"),n}(e):tw(e)}function H9(e,t,n,r){const i=f0(e,t);return i.$fields.forEach(s=>r[s]=1),Object(be.p)(n,i.$params),i.$expr}const $9="outer",G9=["value","update","init","react","bind"];function UD(e,t){Object(be.o)(e+' for "outer" push: '+Object(be.Ba)(t))}function WD(e,t){const n=e.name;if(e.push===$9)t.signals[n]||UD("No prior signal definition",n),G9.forEach(r=>{e[r]!==void 0&&UD("Invalid property ",r)});else{const r=t.addSignal(n,e.value);e.react===!1&&(r.react=!1),e.bind&&t.addBinding(n,e.bind)}}function uC(e,t,n,r){this.id=-1,this.type=e,this.value=t,this.params=n,r&&(this.parent=r)}function iw(e,t,n,r){return new uC(e,t,n,r)}function ow(e,t){return iw("operator",e,t)}function Pi(e){const t={$ref:e.id};return e.id<0&&(e.refs=e.refs||[]).push(t),t}function Nb(e,t){return t?{$field:e,$name:t}:{$field:e}}const cC=Nb("key");function VD(e,t){return{$compare:e,$order:t}}const K9="descending";function aw(e,t){return(e&&e.signal?"$"+e.signal:e||"")+(e&&t?"_":"")+(t&&t.signal?"$"+t.signal:t||"")}const lC="scope",fC="view";function gc(e){return e&&e.signal}function sw(e){if(gc(e))return!0;if(Object(be.H)(e)){for(const t in e)if(sw(e[t]))return!0}return!1}function rg(e,t){return e??t}function xy(e){return e&&e.signal||e}const qD="timer";function Fb(e,t){return(e.merge?X9:e.stream?Y9:e.type?J9:Object(be.o)("Invalid stream specification: "+Object(be.Ba)(e)))(e,t)}function X9(e,t){const n=hC({merge:e.merge.map(r=>Fb(r,t))},e,t);return t.addStream(n).id}function Y9(e,t){const n=hC({stream:Fb(e.stream,t)},e,t);return t.addStream(n).id}function J9(e,t){let n;e.type===qD?(n=t.event(qD,e.throttle),e={between:e.between,filter:e.filter}):n=t.event(function(i){return i===lC?fC:i||fC}(e.source),e.type);const r=hC({stream:n},e,t);return Object.keys(r).length===1?n:t.addStream(r).id}function hC(e,t,n){let r=t.between;return r&&(r.length!==2&&Object(be.o)('Stream "between" parameter must have 2 entries: '+Object(be.Ba)(t)),e.between=[Fb(r[0],n),Fb(r[1],n)]),r=t.filter?[].concat(t.filter):[],(t.marktype||t.markname||t.markrole)&&r.push(function(i,s,f){const m="event.item";return m+(i&&i!=="*"?"&&"+m+".mark.marktype==='"+i+"'":"")+(f?"&&"+m+".mark.role==='"+f+"'":"")+(s?"&&"+m+".mark.name==='"+s+"'":"")}(t.marktype,t.markname,t.markrole)),t.source===lC&&r.push("inScope(event.item)"),r.length&&(e.filter=f0("("+r.join(")&&(")+")",n).$expr),(r=t.throttle)!=null&&(e.throttle=+r),(r=t.debounce)!=null&&(e.debounce=+r),t.consume&&(e.consume=!0),e}const Q9={code:"_.$value",ast:{type:"Identifier",value:"value"}};function Z9(e,t,n){const r=e.encode,i={target:n};let s=e.events,f=e.update,m=[];s||Object(be.o)("Signal update missing events specification."),Object(be.J)(s)&&(s=function(x,O,T){return ID=O||w9,RD=T||A9,MD(x.trim()).map(rC)}(s,t.isSubscope()?lC:fC)),s=Object(be.i)(s).filter(x=>x.signal||x.scale?(m.push(x),0):1),m.length>1&&(m=[function(x){return{signal:"["+x.map(O=>O.scale?'scale("'+O.scale+'")':O.signal)+"]"}}(m)]),s.length&&m.push(s.length>1?{merge:s}:s[0]),r!=null&&(f&&Object(be.o)("Signal encode and update are mutually exclusive."),f="encode(item(),"+Object(be.Ba)(r)+")"),i.update=Object(be.J)(f)?f0(f,t):f.expr!=null?f0(f.expr,t):f.value!=null?f.value:f.signal!=null?{$expr:Q9,$params:{$value:t.signalRef(f.signal)}}:Object(be.o)("Invalid signal update specification."),e.force&&(i.options={force:!0}),m.forEach(x=>t.addUpdate(Object(be.p)(function(O,T){return{source:O.signal?T.signalRef(O.signal):O.scale?T.scaleRef(O.scale):Fb(O,T)}}(x,t),i)))}const is=e=>(t,n,r)=>iw(e,n,t||void 0,r),HD=is("aggregate"),e8=is("axisticks"),$D=is("bound"),ig=is("collect"),GD=is("compare"),t8=is("datajoin"),KD=is("encode"),n8=is("expression"),r8=is("facet"),i8=is("field"),o8=is("key"),a8=is("legendentries"),s8=is("load"),u8=is("mark"),c8=is("multiextent"),l8=is("multivalues"),f8=is("overlap"),h8=is("params"),XD=is("prefacet"),d8=is("projection"),p8=is("proxy"),m8=is("relay"),YD=is("render"),g8=is("scale"),wy=is("sieve"),v8=is("sortitems"),JD=is("viewlayout"),y8=is("values");let b8=0;const QD={min:"min",max:"max",count:"sum"};function x8(e,t){const n=t.getScale(e.name).params;let r;for(r in n.domain=ZD(e.domain,e,t),e.range!=null&&(n.range=function i(s,f,m){const x=f.config.range;let O=s.range;if(O.signal)return f.signalRef(O.signal);if(Object(be.J)(O)){if(x&&Object(be.w)(x,O))return s=Object(be.p)({},s,{range:x[O]}),i(s,f,m);O==="width"?O=[0,{signal:"width"}]:O==="height"?O=Yf(s.type)?[0,{signal:"height"}]:[{signal:"height"},0]:Object(be.o)("Unrecognized scale range value: "+Object(be.Ba)(O))}else{if(O.scheme)return m.scheme=Object(be.B)(O.scheme)?uw(O.scheme,f):fm(O.scheme,f),O.extent&&(m.schemeExtent=uw(O.extent,f)),void(O.count&&(m.schemeCount=fm(O.count,f)));if(O.step)return void(m.rangeStep=fm(O.step,f));if(Yf(s.type)&&!Object(be.B)(O))return ZD(O,s,f);Object(be.B)(O)||Object(be.o)("Unsupported range type: "+Object(be.Ba)(O))}return O.map(T=>(Object(be.B)(T)?uw:fm)(T,f))}(e,t,n)),e.interpolate!=null&&function(i,s){s.interpolate=fm(i.type||i),i.gamma!=null&&(s.interpolateGamma=fm(i.gamma))}(e.interpolate,n),e.nice!=null&&(n.nice=function(i){return Object(be.H)(i)?{interval:fm(i.interval),step:fm(i.step)}:fm(i)}(e.nice)),e.bins!=null&&(n.bins=function(i,s){return i.signal||Object(be.B)(i)?uw(i,s):s.objectProperty(i)}(e.bins,t)),e)Object(be.w)(n,r)||r==="name"||(n[r]=fm(e[r],t))}function fm(e,t){return Object(be.H)(e)?e.signal?t.signalRef(e.signal):Object(be.o)("Unsupported object: "+Object(be.Ba)(e)):e}function uw(e,t){return e.signal?t.signalRef(e.signal):e.map(n=>fm(n,t))}function cw(e){Object(be.o)("Can not find data set: "+Object(be.Ba)(e))}function ZD(e,t,n){if(e)return e.signal?n.signalRef(e.signal):(Object(be.B)(e)?function(r,i,s){return r.map(f=>fm(f,s))}:e.fields?function(r,i,s){const f=r.data,m=r.fields.reduce((x,O)=>(O=Object(be.J)(O)?{data:f,field:O}:Object(be.B)(O)||O.signal?function(T,M){const H="_:vega:_"+b8++,Z=ig({});if(Object(be.B)(T))Z.value={$ingest:T};else if(T.signal){const ue="setdata("+Object(be.Ba)(H)+","+T.signal+")";Z.params.input=M.signalRef(ue)}return M.addDataPipeline(H,[Z,wy({})]),{data:H,field:"data"}}(O,s):O,x.push(O),x),[]);return(Yf(i.type)?function(x,O,T){const M=eT(x.sort,!0);let H,Z;const ue=T.map(Pe=>{const Le=O.getData(Pe.data);return Le||cw(Pe.data),Le.countsRef(O,Pe.field,M)}),fe={groupby:cC,pulse:ue};M&&(H=M.op||"count",Z=M.field?aw(H,M.field):"count",fe.ops=[QD[H]],fe.fields=[O.fieldRef(Z)],fe.as=[Z]),H=O.add(HD(fe));const Ie=O.add(ig({pulse:Pi(H)}));return Pi(Z=O.add(y8({field:cC,sort:O.sortRef(M),pulse:Pi(Ie)})))}:Hp(i.type)?function(x,O,T){const M=T.map(H=>{const Z=O.getData(H.data);return Z||cw(H.data),Z.domainRef(O,H.field)});return Pi(O.add(l8({values:M})))}:function(x,O,T){const M=T.map(H=>{const Z=O.getData(H.data);return Z||cw(H.data),Z.extentRef(O,H.field)});return Pi(O.add(c8({extents:M})))})(r,s,m)}:function(r,i,s){const f=s.getData(r.data);return f||cw(r.data),Yf(i.type)?f.valuesRef(s,r.field,eT(r.sort,!1)):Hp(i.type)?f.domainRef(s,r.field):f.extentRef(s,r.field)})(e,t,n);t.domainMin==null&&t.domainMax==null||Object(be.o)("No scale domain defined for domainMin/domainMax to override.")}function eT(e,t){return e&&(e.field||e.op?e.field||e.op==="count"?t&&e.field&&e.op&&!QD[e.op]&&Object(be.o)("Multiple domain scales can not be sorted using "+e.op):Object(be.o)("No field provided for sort aggregate op: "+e.op):Object(be.H)(e)?e.field="key":e={field:"key"}),e}function dC(e,t,n){return Object(be.B)(e)?e.map(r=>dC(r,t,n)):Object(be.H)(e)?e.signal?n.signalRef(e.signal):t==="fit"?e:Object(be.o)("Unsupported parameter object: "+Object(be.Ba)(e)):e}const og="top",Pv="bottom",w8="vertical",k8="start",E8="end",pC="index",mC="label",C8="offset",x1="perc",O8="perc2",hm="value",Ib="guide-label",gC="guide-title",A8="group-title",S8="group-subtitle",tT="symbol",lw="gradient",vC="discrete",yC="size",bC=[yC,"shape","fill","stroke","strokeWidth","strokeDash","opacity"],Rb={name:1,style:1,interactive:1},ma={value:0},dm={value:1},fw="group",nT="rect",xC="rule",_8="symbol",ky="text";function Mb(e){return e.type=fw,e.interactive=e.interactive||!1,e}function wd(e,t){const n=(r,i)=>rg(e[r],rg(t[r],i));return n.isVertical=r=>w8===rg(e.direction,t.direction||(r?t.symbolDirection:t.gradientDirection)),n.gradientLength=()=>rg(e.gradientLength,t.gradientLength||t.gradientWidth),n.gradientThickness=()=>rg(e.gradientThickness,t.gradientThickness||t.gradientHeight),n.entryColumns=()=>rg(e.columns,rg(t.columns,+n.isVertical(!0))),n}function rT(e,t){const n=t&&(t.update&&t.update[e]||t.enter&&t.enter[e]);return n&&n.signal?n:n?n.value:null}function hw(e,t,n){return`item.anchor === '${k8}' ? ${e} : item.anchor === '${E8}' ? ${t} : ${n}`}const wC=hw(Object(be.Ba)("left"),Object(be.Ba)("right"),Object(be.Ba)("center"));function Sp(e,t){return t?(e.name=t.name,e.style=t.style||e.style,e.interactive=!!t.interactive,e.encode=y1(e.encode,t,Rb)):e.interactive=!1,e}const D8=`datum.${x1}<=0?"left":datum.${x1}>=1?"right":"center"`,T8=`datum.${x1}<=0?"${Pv}":datum.${x1}>=1?"${og}":"middle"`;function iT(e,t,n,r){const i=wd(e,t),s=i.isVertical(),f=Pc(i.gradientThickness()),m=i.gradientLength();let x,O,T,M,H=i("labelOverlap"),Z="";const ue={enter:x={opacity:ma},update:O={opacity:dm,text:{field:mC}},exit:{opacity:ma}};return bl(ue,{fill:i("labelColor"),fillOpacity:i("labelOpacity"),font:i("labelFont"),fontSize:i("labelFontSize"),fontStyle:i("labelFontStyle"),fontWeight:i("labelFontWeight"),limit:rg(e.labelLimit,t.gradientLabelLimit)}),s?(x.align={value:"left"},x.baseline=O.baseline={signal:T8},T="y",M="x",Z="1-"):(x.align=O.align={signal:D8},x.baseline={value:"top"},T="x",M="y"),x[T]=O[T]={signal:Z+"datum."+x1,mult:m},x[M]=O[M]=f,f.offset=rg(e.labelOffset,t.gradientLabelOffset)||0,H=H?{separation:i("labelSeparation"),method:H,order:"datum."+pC}:void 0,Sp({type:ky,role:BD,style:Ib,key:hm,from:r,encode:ue,overlap:H},n)}const dw='(item.orient === "left" || item.orient === "right")',N8=`datum.vgrad && ${dw}`,F8=hw('"top"','"bottom"','"middle"'),I8=`datum.vgrad && item.orient === "right" ? (${hw('"right"','"left"','"center"')}) : (${dw} && !(datum.vgrad && item.orient === "left")) ? "left" : ${wC}`,R8=`item._anchor || (${dw} ? "middle" : "start")`,M8=`${N8} ? (item.orient === "left" ? -90 : 90) : 0`,j8=`${dw} ? (datum.vgrad ? (item.orient === "right" ? "bottom" : "top") : ${F8}) : "top"`;function oT(e){return Object(be.H)(e)&&e.signal?e.signal:Object(be.Ba)(e)}function aT(e){const t=e.role||"";return t.indexOf("axis")&&t.indexOf("legend")&&t.indexOf("title")?e.type===fw?aC:t||iC:t}function kC(e,t){const n=Ht(e.type);n||Object(be.o)("Unrecognized transform type: "+Object(be.Ba)(e.type));const r=iw(n.type.toLowerCase(),null,sT(n,e,t));return e.signal&&t.addSignal(e.signal,t.proxy(r)),r.metadata=n.metadata||{},r}function sT(e,t,n){const r={},i=e.params.length;for(let s=0;s<i;++s){const f=e.params[s];r[f.name]=B8(f,t,n)}return r}function B8(e,t,n){const r=e.type,i=t[e.name];return r==="index"?function(s,f,m){return Object(be.J)(f.from)||Object(be.o)('Lookup "from" parameter must be a string literal.'),m.getData(f.from).lookupRef(m,f.key)}(0,t,n):i!==void 0?r==="param"?function(s,f,m){const x=f[s.name];return s.array?(Object(be.B)(x)||Object(be.o)("Expected an array of sub-parameters. Instead: "+Object(be.Ba)(x)),x.map(O=>cT(s,O,m))):cT(s,x,m)}(e,t,n):r==="projection"?n.projectionRef(t[e.name]):e.array&&!gc(i)?i.map(s=>uT(e,s,n)):uT(e,i,n):void(e.required&&Object(be.o)("Missing required "+Object(be.Ba)(t.type)+" parameter: "+Object(be.Ba)(e.name)))}function uT(e,t,n){const r=e.type;if(gc(t))return lT(r)?Object(be.o)("Expression references can not be signals."):EC(r)?n.fieldRef(t):fT(r)?n.compareRef(t):n.signalRef(t.signal);{const i=e.expr||EC(r);return i&&P8(t)?n.exprRef(t.expr,t.as):i&&L8(t)?Nb(t.field,t.as):lT(r)?f0(t,n):z8(r)?Pi(n.getData(t).values):EC(r)?Nb(t):fT(r)?n.compareRef(t):t}}function cT(e,t,n){const r=e.params.length;let i;for(let f=0;f<r;++f){i=e.params[f];for(const m in i.key)if(i.key[m]!==t[m]){i=null;break}if(i)break}i||Object(be.o)("Unsupported parameter: "+Object(be.Ba)(t));const s=Object(be.p)(sT(i,t,n),i.key);return Pi(n.add(h8(s)))}const P8=e=>e&&e.expr,L8=e=>e&&e.field,z8=e=>e==="data",lT=e=>e==="expr",EC=e=>e==="field",fT=e=>e==="compare";function pw(e,t){return e.$ref?e:e.data&&e.data.$ref?e.data:Pi(t.getData(e.data).output)}function Ey(e,t,n,r,i){this.scope=e,this.input=t,this.output=n,this.values=r,this.aggregate=i,this.index={}}function hT(e){return Object(be.J)(e)?e:null}function dT(e,t,n){const r=aw(n.op,n.field);let i;if(t.ops){for(let s=0,f=t.as.length;s<f;++s)if(t.as[s]===r)return}else t.ops=["count"],t.fields=[null],t.as=["count"];n.op&&(t.ops.push((i=n.op.signal)?e.signalRef(i):n.op),t.fields.push(e.fieldRef(n.field)),t.as.push(r))}function jb(e,t,n,r,i,s,f){const m=t[n]||(t[n]={}),x=function(H){return Object(be.H)(H)?(H.order===K9?"-":"+")+aw(H.op,H.field):""}(s);let O,T,M=hT(i);if(M!=null&&(e=t.scope,O=m[M+=x?"|"+x:""]),!O){const H=s?{field:cC,pulse:t.countsRef(e,i,s)}:{field:e.fieldRef(i),pulse:Pi(t.output)};x&&(H.sort=e.sortRef(s)),T=e.add(iw(r,void 0,H)),f&&(t.index[i]=T),O=Pi(T),M!=null&&(m[M]=O)}return O}function pT(e,t,n){const r=e.remove,i=e.insert,s=e.toggle,f=e.modify,m=e.values,x=t.add(ow()),O=f0("if("+e.trigger+',modify("'+n+'",'+[i,r,s,f,m].map(T=>T??"null").join(",")+"),0)",t);x.update=O.$expr,x.params=O.$params}function mw(e,t){const n=aT(e),r=e.type===fw,i=e.from&&e.from.facet,s=e.overlap;let f,m,x,O,T,M,H,Z=e.layout||n===aC||n===oC;const ue=n===iC||Z||i,fe=function(st,mt,dt){let en,mn,sn,In,Fn;return st?(en=st.facet)&&(mt||Object(be.o)("Only group marks can be faceted."),en.field!=null?In=Fn=pw(en,dt):(st.data?Fn=Pi(dt.getData(st.data).aggregate):((sn=kC(Object(be.p)({type:"aggregate",groupby:Object(be.i)(en.groupby)},en.aggregate),dt)).params.key=dt.keyRef(en.groupby),sn.params.pulse=pw(en,dt),In=Fn=Pi(dt.add(sn))),mn=dt.keyRef(en.groupby,!0))):In=Pi(dt.add(ig(null,[{}]))),In||(In=pw(st,dt)),{key:mn,pulse:In,parent:Fn}}(e.from,r,t),Ie=Pi(m=t.add(t8({key:fe.key||(e.key?Nb(e.key):void 0),pulse:fe.pulse,clean:!r})));m=x=t.add(ig({pulse:Ie}));const Pe=Pi(m=t.add(u8({markdef:function(st){return{marktype:st.type,name:st.name||void 0,role:st.role||aT(st),zindex:+st.zindex||void 0,aria:st.aria,description:st.description}}(e),interactive:function(st,mt){return st&&st.signal?mt.signalRef(st.signal):st!==!1}(e.interactive,t),clip:function(st,mt){let dt;return Object(be.H)(st)&&(st.signal?dt=st.signal:st.path?dt="pathShape("+oT(st.path)+")":st.sphere&&(dt="geoShape("+oT(st.sphere)+', {type: "Sphere"})')),dt?mt.signalRef(dt):!!st}(e.clip,t),context:{$context:!0},groups:t.lookup(),parent:t.signals.parent?t.signalRef("parent"):null,index:t.markpath(),pulse:Pi(m)})));(m=O=t.add(KD(zD(e.encode,e.type,n,e.style,t,{mod:!1,pulse:Pe})))).params.parent=t.encode(),e.transform&&e.transform.forEach(st=>{const mt=kC(st,t),dt=mt.metadata;(dt.generates||dt.changes)&&Object(be.o)("Mark transforms should not generate new data."),dt.nomod||(O.params.mod=!0),mt.params.pulse=Pi(m),t.add(m=mt)}),e.sort&&(m=t.add(v8({sort:t.compareRef(e.sort),pulse:Pi(m)})));const Le=Pi(m);(i||Z)&&(M=Pi(Z=t.add(JD({layout:t.objectProperty(e.layout),legends:t.legends,mark:Pe,pulse:Le}))));const rt=t.add($D({mark:Pe,pulse:M||Le}));H=Pi(rt),r&&(ue&&((f=t.operators).pop(),Z&&f.pop()),t.pushState(Le,M||H,Ie),i?function(st,mt,dt){const en=st.from.facet,mn=en.name,sn=pw(en,mt);let In;en.name||Object(be.o)("Facet must have a name: "+Object(be.Ba)(en)),en.data||Object(be.o)("Facet must reference a data set: "+Object(be.Ba)(en)),en.field?In=mt.add(XD({field:mt.fieldRef(en.field),pulse:sn})):en.groupby?In=mt.add(r8({key:mt.keyRef(en.groupby),group:Pi(mt.proxy(dt.parent)),pulse:sn})):Object(be.o)("Facet must specify groupby or field: "+Object(be.Ba)(en));const Fn=mt.fork(),zn=Fn.add(ig()),Vn=Fn.add(wy({pulse:Pi(zn)}));Fn.addData(mn,new Ey(Fn,zn,zn,Vn)),Fn.addSignal("parent",null),In.params.subflow={$subflow:Fn.parse(st).toRuntime()}}(e,t,fe):ue?function(st,mt,dt){const en=mt.add(XD({pulse:dt.pulse})),mn=mt.fork();mn.add(wy()),mn.addSignal("parent",null),en.params.subflow={$subflow:mn.parse(st).toRuntime()}}(e,t,fe):t.parse(e),t.popState(),ue&&(Z&&f.push(Z),f.push(rt))),s&&(H=function(st,mt,dt){const en=st.method,mn=st.bound,sn=st.separation,In={separation:gc(sn)?dt.signalRef(sn.signal):sn,method:gc(en)?dt.signalRef(en.signal):en,pulse:mt};if(st.order&&(In.sort=dt.compareRef({field:st.order})),mn){const Fn=mn.tolerance;In.boundTolerance=gc(Fn)?dt.signalRef(Fn.signal):+Fn,In.boundScale=dt.scaleRef(mn.scale),In.boundOrient=mn.orient}return Pi(dt.add(f8(In)))}(s,H,t));const it=t.add(YD({pulse:H})),ut=t.add(wy({pulse:Pi(it)},void 0,t.parent()));e.name!=null&&(T=e.name,t.addData(T,new Ey(t,x,it,ut)),e.on&&e.on.forEach(st=>{(st.insert||st.remove||st.toggle)&&Object(be.o)("Marks only support modify triggers."),pT(st,t,T)}))}function U8(e,t){const n=t.config.legend,r=e.encode||{},i=wd(e,n),s=r.legend||{},f=s.name||void 0,m=s.interactive,x=s.style,O={};let T,M,H,Z=0;bC.forEach(Le=>e[Le]?(O[Le]=e[Le],Z=Z||e[Le]):0),Z||Object(be.o)("Missing valid scale for legend.");const ue=function(Le,rt){let it=Le.type||tT;return Le.type||function(ut){return bC.reduce((st,mt)=>st+(ut[mt]?1:0),0)}(Le)!==1||!Le.fill&&!Le.stroke||(it=Xf(rt)?lw:ap(rt)?vC:tT),it!==lw?it:ap(rt)?vC:lw}(e,t.scaleType(Z)),fe={title:e.title!=null,scales:O,type:ue,vgrad:ue!=="symbol"&&i.isVertical()},Ie=Pi(t.add(ig(null,[fe]))),Pe=Pi(t.add(a8(M={type:ue,scale:t.scaleRef(Z),count:t.objectProperty(i("tickCount")),limit:t.property(i("symbolLimit")),values:t.objectProperty(e.values),minstep:t.property(e.tickMinStep),formatType:t.property(e.formatType),formatSpecifier:t.property(e.format)})));return ue===lw?(H=[function(Le,rt,it,ut){const st=wd(Le,it),mt=st.isVertical(),dt=st.gradientThickness(),en=st.gradientLength();let mn,sn,In,Fn,zn;mt?(sn=[0,1],In=[0,0],Fn=dt,zn=en):(sn=[0,0],In=[1,0],Fn=en,zn=dt);const Vn={enter:mn={opacity:ma,x:ma,y:ma,width:Pc(Fn),height:Pc(zn)},update:Object(be.p)({},mn,{opacity:dm,fill:{gradient:rt,start:sn,stop:In}}),exit:{opacity:ma}};return bl(Vn,{stroke:st("gradientStrokeColor"),strokeWidth:st("gradientStrokeWidth")},{opacity:st("gradientOpacity")}),Sp({type:nT,role:B9,encode:Vn},ut)}(e,Z,n,r.gradient),iT(e,n,r.labels,Pe)],M.count=M.count||t.signalRef(`max(2,2*floor((${xy(i.gradientLength())})/100))`)):ue===vC?H=[function(Le,rt,it,ut,st){const mt=wd(Le,it),dt=mt.isVertical(),en=mt.gradientThickness(),mn=mt.gradientLength();let sn,In,Fn,zn,Vn="";dt?(sn="y",Fn="y2",In="x",zn="width",Vn="1-"):(sn="x",Fn="x2",In="y",zn="height");const Qn={opacity:ma,fill:{scale:rt,field:hm}};Qn[sn]={signal:Vn+"datum."+x1,mult:mn},Qn[In]=ma,Qn[Fn]={signal:Vn+"datum."+O8,mult:mn},Qn[zn]=Pc(en);const mr={enter:Qn,update:Object(be.p)({},Qn,{opacity:dm}),exit:{opacity:ma}};return bl(mr,{stroke:mt("gradientStrokeColor"),strokeWidth:mt("gradientStrokeWidth")},{opacity:mt("gradientOpacity")}),Sp({type:nT,role:M9,key:hm,from:st,encode:mr},ut)}(e,Z,n,r.gradient,Pe),iT(e,n,r.labels,Pe)]:(T=function(Le,rt){const it=wd(Le,rt);return{align:it("gridAlign"),columns:it.entryColumns(),center:{row:!0,column:!1},padding:{row:it("rowPadding"),column:it("columnPadding")}}}(e,n),H=[function(Le,rt,it,ut,st){const mt=wd(Le,rt),dt=it.entries,en=!(!dt||!dt.interactive),mn=dt?dt.name:void 0,sn=mt("clipHeight"),In=mt("symbolOffset"),Fn={data:"value"},zn=`(${st}) ? datum.${C8} : datum.${yC}`,Vn=sn?Pc(sn):{field:yC},Qn=`datum.${pC}`,mr=`max(1, ${st})`;let Pr,Cr,Jr,gi,vi;Vn.mult=.5,Pr={enter:Cr={opacity:ma,x:{signal:zn,mult:.5,offset:In},y:Vn},update:Jr={opacity:dm,x:Cr.x,y:Cr.y},exit:{opacity:ma}};let zi=null,wi=null;Le.fill||(zi=rt.symbolBaseFillColor,wi=rt.symbolBaseStrokeColor),bl(Pr,{fill:mt("symbolFillColor",zi),shape:mt("symbolType"),size:mt("symbolSize"),stroke:mt("symbolStrokeColor",wi),strokeDash:mt("symbolDash"),strokeDashOffset:mt("symbolDashOffset"),strokeWidth:mt("symbolStrokeWidth")},{opacity:mt("symbolOpacity")}),bC.forEach(na=>{Le[na]&&(Jr[na]=Cr[na]={scale:Le[na],field:hm})});const yi=Sp({type:_8,role:P9,key:hm,from:Fn,clip:!!sn||void 0,encode:Pr},it.symbols),_i=Pc(In);_i.offset=mt("labelOffset"),bl(Pr={enter:Cr={opacity:ma,x:{signal:zn,offset:_i},y:Vn},update:Jr={opacity:dm,text:{field:mC},x:Cr.x,y:Cr.y},exit:{opacity:ma}},{align:mt("labelAlign"),baseline:mt("labelBaseline"),fill:mt("labelColor"),fillOpacity:mt("labelOpacity"),font:mt("labelFont"),fontSize:mt("labelFontSize"),fontStyle:mt("labelFontStyle"),fontWeight:mt("labelFontWeight"),limit:mt("labelLimit")});const vo=Sp({type:ky,role:BD,style:Ib,key:hm,from:Fn,encode:Pr},it.labels);return Pr={enter:{noBound:{value:!sn},width:ma,height:sn?Pc(sn):ma,opacity:ma},exit:{opacity:ma},update:Jr={opacity:dm,row:{signal:null},column:{signal:null}}},mt.isVertical(!0)?(gi=`ceil(item.mark.items.length / ${mr})`,Jr.row.signal=`${Qn}%${gi}`,Jr.column.signal=`floor(${Qn} / ${gi})`,vi={field:["row",Qn]}):(Jr.row.signal=`floor(${Qn} / ${mr})`,Jr.column.signal=`${Qn} % ${mr}`,vi={field:Qn}),Jr.column.signal=`(${st})?${Jr.column.signal}:${Qn}`,Mb({role:aC,from:ut={facet:{data:ut,name:"value",groupby:pC}},encode:y1(Pr,dt,Rb),marks:[yi,vo],name:mn,interactive:en,sort:vi})}(e,n,r,Pe,xy(T.columns))],M.size=function(Le,rt,it){const ut=xy(mT("size",Le,it)),st=xy(mT("strokeWidth",Le,it)),mt=xy(function(dt,en,mn){return rT("fontSize",dt)||function(sn,In,Fn){const zn=In.config.style[Fn];return zn&&zn[sn]}("fontSize",en,mn)}(it[1].encode,rt,Ib));return f0(`max(ceil(sqrt(${ut})+${st}),${mt})`,rt)}(e,t,H[0].marks)),H=[Mb({role:j9,from:Ie,encode:{enter:{x:{value:0},y:{value:0}}},marks:H,layout:T,interactive:m})],fe.title&&H.push(function(Le,rt,it,ut){const st=wd(Le,rt),mt={enter:{opacity:ma},update:{opacity:dm,x:{field:{group:"padding"}},y:{field:{group:"padding"}}},exit:{opacity:ma}};return bl(mt,{orient:st("titleOrient"),_anchor:st("titleAnchor"),anchor:{signal:R8},angle:{signal:M8},align:{signal:I8},baseline:{signal:j8},text:Le.title,fill:st("titleColor"),fillOpacity:st("titleOpacity"),font:st("titleFont"),fontSize:st("titleFontSize"),fontStyle:st("titleFontStyle"),fontWeight:st("titleFontWeight"),limit:st("titleLimit"),lineHeight:st("titleLineHeight")},{align:st("titleAlign"),baseline:st("titleBaseline")}),Sp({type:ky,role:L9,style:gC,from:ut,encode:mt},it)}(e,n,r.title,Ie)),mw(Mb({role:R9,from:Ie,encode:y1(function(Le,rt,it){const ut={enter:{},update:{}};return bl(ut,{orient:Le("orient"),offset:Le("offset"),padding:Le("padding"),titlePadding:Le("titlePadding"),cornerRadius:Le("cornerRadius"),fill:Le("fillColor"),stroke:Le("strokeColor"),strokeWidth:it.strokeWidth,strokeDash:it.strokeDash,x:Le("legendX"),y:Le("legendY"),format:rt.format,formatType:rt.formatType}),ut}(i,e,n),s,Rb),marks:H,aria:i("aria"),description:i("description"),zindex:i("zindex"),name:f,interactive:m,style:x}),t)}function mT(e,t,n){return t[e]?`scale("${t[e]}",datum)`:rT(e,n[0].encode)}Ey.fromEntries=function(e,t){const n=t.length,r=t[n-1],i=t[n-2];let s=t[0],f=null,m=1;for(s&&s.type==="load"&&(s=t[1]),e.add(t[0]);m<n;++m)t[m].params.pulse=Pi(t[m-1]),e.add(t[m]),t[m].type==="aggregate"&&(f=t[m]);return new Ey(e,s,i,r,f)},Ey.prototype={countsRef(e,t,n){const r=this,i=r.counts||(r.counts={}),s=hT(t);let f,m,x;return s!=null&&(e=r.scope,f=i[s]),f?n&&n.field&&dT(e,f.agg.params,n):(x={groupby:e.fieldRef(t,"key"),pulse:Pi(r.output)},n&&n.field&&dT(e,x,n),f={agg:m=e.add(HD(x)),ref:Pi(f=e.add(ig({pulse:Pi(m)})))},s!=null&&(i[s]=f)),f.ref},tuplesRef(){return Pi(this.values)},extentRef(e,t){return jb(e,this,"extent","extent",t,!1)},domainRef(e,t){return jb(e,this,"domain","values",t,!1)},valuesRef(e,t,n){return jb(e,this,"vals","values",t,n||!0)},lookupRef(e,t){return jb(e,this,"lookup","tupleindex",t,!1)},indataRef(e,t){return jb(e,this,"indata","tupleindex",t,!0,!0)}};const W8='item.orient==="left"?-90:item.orient==="right"?90:0';function V8(e,t){const n=wd(e=Object(be.J)(e)?{text:e}:e,t.config.title),r=e.encode||{},i=r.group||{},s=i.name||void 0,f=i.interactive,m=i.style,x=[],O=Pi(t.add(ig(null,[{}])));return x.push(function(T,M,H,Z){const ue={value:0},fe=T.text,Ie={enter:{opacity:ue},update:{opacity:{value:1}},exit:{opacity:ue}};return bl(Ie,{text:fe,align:{signal:"item.mark.group.align"},angle:{signal:"item.mark.group.angle"},limit:{signal:"item.mark.group.limit"},baseline:"top",dx:M("dx"),dy:M("dy"),fill:M("color"),font:M("font"),fontSize:M("fontSize"),fontStyle:M("fontStyle"),fontWeight:M("fontWeight"),lineHeight:M("lineHeight")},{align:M("align"),angle:M("angle"),baseline:M("baseline")}),Sp({type:ky,role:U9,style:A8,from:Z,encode:Ie},H)}(e,n,function(T){const M=T.encode;return M&&M.title||Object(be.p)({name:T.name,interactive:T.interactive,style:T.style},M)}(e),O)),e.subtitle&&x.push(function(T,M,H,Z){const ue={value:0},fe=T.subtitle,Ie={enter:{opacity:ue},update:{opacity:{value:1}},exit:{opacity:ue}};return bl(Ie,{text:fe,align:{signal:"item.mark.group.align"},angle:{signal:"item.mark.group.angle"},limit:{signal:"item.mark.group.limit"},baseline:"top",dx:M("dx"),dy:M("dy"),fill:M("subtitleColor"),font:M("subtitleFont"),fontSize:M("subtitleFontSize"),fontStyle:M("subtitleFontStyle"),fontWeight:M("subtitleFontWeight"),lineHeight:M("subtitleLineHeight")},{align:M("align"),angle:M("angle"),baseline:M("baseline")}),Sp({type:ky,role:W9,style:S8,from:Z,encode:Ie},H)}(e,n,r.subtitle,O)),mw(Mb({role:z9,from:O,encode:function(T,M){const H={enter:{},update:{}};return bl(H,{orient:T("orient"),anchor:T("anchor"),align:{signal:wC},angle:{signal:W8},limit:T("limit"),frame:T("frame"),offset:T("offset")||0,padding:T("subtitlePadding")}),y1(H,M,Rb)}(n,i),marks:x,aria:n("aria"),description:n("description"),zindex:n("zindex"),name:s,interactive:f,style:m}),t)}function q8(e,t){const n=[];e.transform&&e.transform.forEach(r=>{n.push(kC(r,t))}),e.on&&e.on.forEach(r=>{pT(r,t,e.name)}),t.addDataPipeline(e.name,function(r,i,s){const f=[];let m,x,O,T,M,H=null,Z=!1,ue=!1;for(r.values?gc(r.values)||sw(r.format)?(f.push(gT(i,r)),f.push(H=Cy())):f.push(H=Cy({$ingest:r.values,$format:r.format})):r.url?sw(r.url)||sw(r.format)?(f.push(gT(i,r)),f.push(H=Cy())):f.push(H=Cy({$request:r.url,$format:r.format})):r.source&&(H=m=Object(be.i)(r.source).map(fe=>Pi(i.getData(fe).output)),f.push(null)),x=0,O=s.length;x<O;++x)T=s[x],M=T.metadata,H||M.source||f.push(H=Cy()),f.push(T),M.generates&&(ue=!0),M.modifies&&!ue&&(Z=!0),M.source?H=T:M.changes&&(H=null);return m&&(O=m.length-1,f[0]=m8({derive:Z,pulse:O?m:m[0]}),(Z||O)&&f.splice(1,0,Cy())),H||f.push(Cy()),f.push(wy({})),f}(e,t,n))}function Cy(e){const t=ig({},e);return t.metadata={source:!0},t}function gT(e,t){return s8({url:t.url?e.property(t.url):void 0,async:t.async?e.property(t.async):void 0,values:t.values?e.property(t.values):void 0,format:e.objectProperty(t.format)})}const vT=e=>e===Pv||e===og,gw=(e,t,n)=>gc(e)?K8(e.signal,t,n):e==="left"||e===og?t:n,Lc=(e,t,n)=>gc(e)?$8(e.signal,t,n):vT(e)?t:n,ag=(e,t,n)=>gc(e)?G8(e.signal,t,n):vT(e)?n:t,yT=(e,t,n)=>gc(e)?X8(e.signal,t,n):e===og?{value:t}:{value:n},H8=(e,t,n)=>gc(e)?Y8(e.signal,t,n):e==="right"?{value:t}:{value:n},$8=(e,t,n)=>bT(`${e} === '${og}' || ${e} === '${Pv}'`,t,n),G8=(e,t,n)=>bT(`${e} !== '${og}' && ${e} !== '${Pv}'`,t,n),K8=(e,t,n)=>CC(`${e} === 'left' || ${e} === '${og}'`,t,n),X8=(e,t,n)=>CC(`${e} === '${og}'`,t,n),Y8=(e,t,n)=>CC(`${e} === 'right'`,t,n),bT=(e,t,n)=>(t=t!=null?Pc(t):t,n=n!=null?Pc(n):n,xT(t)&&xT(n)?{signal:`${e} ? (${t=t?t.signal||Object(be.Ba)(t.value):null}) : (${n=n?n.signal||Object(be.Ba)(n.value):null})`}:[Object(be.p)({test:e},t)].concat(n||[])),xT=e=>e==null||Object.keys(e).length===1,CC=(e,t,n)=>({signal:`${e} ? (${w1(t)}) : (${w1(n)})`}),J8=(e,t,n,r,i)=>({signal:(r!=null?`${e} === 'left' ? (${w1(r)}) : `:"")+(n!=null?`${e} === '${Pv}' ? (${w1(n)}) : `:"")+(i!=null?`${e} === 'right' ? (${w1(i)}) : `:"")+(t!=null?`${e} === '${og}' ? (${w1(t)}) : `:"")+"(null)"}),w1=e=>gc(e)?e.signal:e==null?null:Object(be.Ba)(e),Q8=(e,t)=>t===0?0:gc(e)?{signal:`(${e.signal}) * ${t}`}:{value:e*t},k1=(e,t)=>{const n=e.signal;return n&&n.endsWith("(null)")?{signal:n.slice(0,-6)+t.signal}:e};function E1(e,t,n,r){let i;if(t&&Object(be.w)(t,e))return t[e];if(Object(be.w)(n,e))return n[e];if(e.startsWith("title")){switch(e){case"titleColor":i="fill";break;case"titleFont":case"titleFontSize":case"titleFontWeight":i=e[5].toLowerCase()+e.slice(6)}return r[gC][i]}if(e.startsWith("label")){switch(e){case"labelColor":i="fill";break;case"labelFont":case"labelFontSize":i=e[5].toLowerCase()+e.slice(6)}return r[Ib][i]}return null}function wT(e){const t={};for(const n of e)if(n)for(const r in n)t[r]=1;return Object.keys(t)}function kT(e,t){return{scale:e.scale,range:t}}function Z8(e,t,n,r,i){const s=wd(e,t),f=e.orient,m=e.gridScale,x=gw(f,1,-1),O=function(Le,rt){if(rt!==1)if(Object(be.H)(Le)){let it=Le=Object(be.p)({},Le);for(;it.mult!=null;){if(!Object(be.H)(it.mult))return it.mult=gc(rt)?{signal:`(${it.mult}) * (${rt.signal})`}:it.mult*rt,Le;it=it.mult=Object(be.p)({},it.mult)}it.mult=rt}else Le=gc(rt)?{signal:`(${rt.signal}) * (${Le||0})`}:rt*(Le||0);return Le}(e.offset,x);let T,M,H;const Z={enter:T={opacity:ma},update:H={opacity:dm},exit:M={opacity:ma}};bl(Z,{stroke:s("gridColor"),strokeCap:s("gridCap"),strokeDash:s("gridDash"),strokeDashOffset:s("gridDashOffset"),strokeOpacity:s("gridOpacity"),strokeWidth:s("gridWidth")});const ue={scale:e.scale,field:hm,band:i.band,extra:i.extra,offset:i.offset,round:s("tickRound")},fe=Lc(f,{signal:"height"},{signal:"width"}),Ie=m?{scale:m,range:0,mult:x,offset:O}:{value:0,offset:O},Pe=m?{scale:m,range:1,mult:x,offset:O}:Object(be.p)(fe,{mult:x,offset:O});return T.x=H.x=Lc(f,ue,Ie),T.y=H.y=ag(f,ue,Ie),T.x2=H.x2=ag(f,Pe),T.y2=H.y2=Lc(f,Pe),M.x=Lc(f,ue),M.y=ag(f,ue),Sp({type:xC,role:T9,key:hm,from:r,encode:Z},n)}function OC(e,t,n,r,i){return{signal:'flush(range("'+e+'"), scale("'+e+'", datum.value), '+t+","+n+","+r+","+i+")"}}function eB(e,t,n,r,i,s){const f=wd(e,t),m=e.orient,x=e.scale,O=gw(m,-1,1),T=xy(f("labelFlush")),M=xy(f("labelFlushOffset")),H=f("labelAlign"),Z=f("labelBaseline");let ue,fe=T===0||!!T;const Ie=Pc(i);Ie.mult=O,Ie.offset=Pc(f("labelPadding")||0),Ie.offset.mult=O;const Pe={scale:x,field:hm,band:.5,offset:function en(mn,sn){return sn?mn?Object(be.H)(mn)?Object.assign({},mn,{offset:en(mn.offset,sn)}):{value:mn,offset:sn}:sn:mn}(s.offset,f("labelOffset"))},Le=Lc(m,fe?OC(x,T,'"left"','"right"','"center"'):{value:"center"},H8(m,"left","right")),rt=Lc(m,yT(m,"bottom","top"),fe?OC(x,T,'"top"','"bottom"','"middle"'):{value:"middle"}),it=OC(x,T,`-(${M})`,M,0);fe=fe&&M;const ut={opacity:ma,x:Lc(m,Pe,Ie),y:ag(m,Pe,Ie)},st={enter:ut,update:ue={opacity:dm,text:{field:mC},x:ut.x,y:ut.y,align:Le,baseline:rt},exit:{opacity:ma,x:ut.x,y:ut.y}};bl(st,{dx:!H&&fe?Lc(m,it):null,dy:!Z&&fe?ag(m,it):null}),bl(st,{angle:f("labelAngle"),fill:f("labelColor"),fillOpacity:f("labelOpacity"),font:f("labelFont"),fontSize:f("labelFontSize"),fontWeight:f("labelFontWeight"),fontStyle:f("labelFontStyle"),limit:f("labelLimit"),lineHeight:f("labelLineHeight")},{align:H,baseline:Z});const mt=f("labelBound");let dt=f("labelOverlap");return dt=dt||mt?{separation:f("labelSeparation"),method:dt,order:"datum.index",bound:mt?{scale:x,orient:m,tolerance:mt}:null}:void 0,ue.align!==Le&&(ue.align=k1(ue.align,Le)),ue.baseline!==rt&&(ue.baseline=k1(ue.baseline,rt)),Sp({type:ky,role:N9,style:Ib,key:hm,from:r,encode:st,overlap:dt},n)}function tB(e,t,n,r){const i=wd(e,t),s=e.orient,f=gw(s,-1,1);let m,x;const O={enter:m={opacity:ma,anchor:Pc(i("titleAnchor",null)),align:{signal:wC}},update:x=Object(be.p)({},m,{opacity:dm,text:Pc(e.title)}),exit:{opacity:ma}},T={signal:`lerp(range("${e.scale}"), ${hw(0,1,.5)})`};return x.x=Lc(s,T),x.y=ag(s,T),m.angle=Lc(s,ma,Q8(f,90)),m.baseline=Lc(s,yT(s,Pv,og),{value:Pv}),x.angle=m.angle,x.baseline=m.baseline,bl(O,{fill:i("titleColor"),fillOpacity:i("titleOpacity"),font:i("titleFont"),fontSize:i("titleFontSize"),fontStyle:i("titleFontStyle"),fontWeight:i("titleFontWeight"),limit:i("titleLimit"),lineHeight:i("titleLineHeight")},{align:i("titleAlign"),angle:i("titleAngle"),baseline:i("titleBaseline")}),function(M,H,Z,ue){const fe=(Le,rt)=>Le!=null?(Z.update[rt]=k1(Pc(Le),Z.update[rt]),!1):!b1(rt,ue),Ie=fe(M("titleX"),"x"),Pe=fe(M("titleY"),"y");Z.enter.auto=Pe===Ie?Pc(Pe):Lc(H,Pc(Pe),Pc(Ie))}(i,s,O,n),O.update.align=k1(O.update.align,m.align),O.update.angle=k1(O.update.angle,m.angle),O.update.baseline=k1(O.update.baseline,m.baseline),Sp({type:ky,role:I9,style:gC,from:r,encode:O},n)}function nB(e,t){const n=function(fe,Ie){var Pe,Le,rt,it=Ie.config,ut=it.style,st=it.axis,mt=Ie.scaleType(fe.scale)==="band"&&it.axisBand,dt=fe.orient;if(gc(dt)){const en=wT([it.axisX,it.axisY]),mn=wT([it.axisTop,it.axisBottom,it.axisLeft,it.axisRight]);for(rt of(Pe={},en))Pe[rt]=Lc(dt,E1(rt,it.axisX,st,ut),E1(rt,it.axisY,st,ut));for(rt of(Le={},mn))Le[rt]=J8(dt.signal,E1(rt,it.axisTop,st,ut),E1(rt,it.axisBottom,st,ut),E1(rt,it.axisLeft,st,ut),E1(rt,it.axisRight,st,ut))}else Pe=dt===og||dt===Pv?it.axisX:it.axisY,Le=it["axis"+dt[0].toUpperCase()+dt.slice(1)];return Pe||Le||mt?Object(be.p)({},st,Pe,Le,mt):st}(e,t),r=e.encode||{},i=r.axis||{},s=i.name||void 0,f=i.interactive,m=i.style,x=wd(e,n),O=function(fe){const Ie=fe("tickBand");let Pe,Le,rt=fe("tickOffset");return Ie?Ie.signal?(Pe={signal:`(${Ie.signal}) === 'extent' ? 1 : 0.5`},Le={signal:`(${Ie.signal}) === 'extent'`},Object(be.H)(rt)||(rt={signal:`(${Ie.signal}) === 'extent' ? 0 : ${rt}`})):Ie==="extent"?(Pe=1,Le=!0,rt=0):(Pe=.5,Le=!1):(Pe=fe("bandPosition"),Le=fe("tickExtra")),{extra:Le,band:Pe,offset:rt}}(x),T={scale:e.scale,ticks:!!x("ticks"),labels:!!x("labels"),grid:!!x("grid"),domain:!!x("domain"),title:e.title!=null},M=Pi(t.add(ig({},[T]))),H=Pi(t.add(e8({scale:t.scaleRef(e.scale),extra:t.property(O.extra),count:t.objectProperty(e.tickCount),values:t.objectProperty(e.values),minstep:t.property(e.tickMinStep),formatType:t.property(e.formatType),formatSpecifier:t.property(e.format)}))),Z=[];let ue;return T.grid&&Z.push(Z8(e,n,r.grid,H,O)),T.ticks&&(ue=x("tickSize"),Z.push(function(fe,Ie,Pe,Le,rt,it){const ut=wd(fe,Ie),st=fe.orient,mt=gw(st,-1,1);let dt,en,mn;const sn={enter:dt={opacity:ma},update:mn={opacity:dm},exit:en={opacity:ma}};bl(sn,{stroke:ut("tickColor"),strokeCap:ut("tickCap"),strokeDash:ut("tickDash"),strokeDashOffset:ut("tickDashOffset"),strokeOpacity:ut("tickOpacity"),strokeWidth:ut("tickWidth")});const In=Pc(rt);In.mult=mt;const Fn={scale:fe.scale,field:hm,band:it.band,extra:it.extra,offset:it.offset,round:ut("tickRound")};return mn.y=dt.y=Lc(st,ma,Fn),mn.y2=dt.y2=Lc(st,In),en.x=Lc(st,Fn),mn.x=dt.x=ag(st,ma,Fn),mn.x2=dt.x2=ag(st,In),en.y=ag(st,Fn),Sp({type:xC,role:F9,key:hm,from:Le,encode:sn},Pe)}(e,n,r.ticks,H,ue,O))),T.labels&&(ue=T.ticks?ue:0,Z.push(eB(e,n,r.labels,H,ue,O))),T.domain&&Z.push(function(fe,Ie,Pe,Le){const rt=wd(fe,Ie),it=fe.orient;let ut,st;const mt={enter:ut={opacity:ma},update:st={opacity:dm},exit:{opacity:ma}};bl(mt,{stroke:rt("domainColor"),strokeCap:rt("domainCap"),strokeDash:rt("domainDash"),strokeDashOffset:rt("domainDashOffset"),strokeWidth:rt("domainWidth"),strokeOpacity:rt("domainOpacity")});const dt=kT(fe,0),en=kT(fe,1);return ut.x=st.x=Lc(it,dt,ma),ut.x2=st.x2=Lc(it,en),ut.y=st.y=ag(it,dt,ma),ut.y2=st.y2=ag(it,en),Sp({type:xC,role:D9,from:Le,encode:mt},Pe)}(e,n,r.domain,M)),T.title&&Z.push(tB(e,n,r.title,M)),mw(Mb({role:_9,from:M,encode:y1(function(fe,Ie){const Pe={enter:{},update:{}};return bl(Pe,{orient:fe("orient"),offset:fe("offset")||0,position:rg(Ie.position,0),titlePadding:fe("titlePadding"),minExtent:fe("minExtent"),maxExtent:fe("maxExtent"),range:{signal:`abs(span(range("${Ie.scale}")))`},translate:fe("translate"),format:Ie.format,formatType:Ie.formatType}),Pe}(x,e),i,Rb),marks:Z,aria:x("aria"),description:x("description"),zindex:x("zindex"),name:s,interactive:f,style:m}),t)}function ET(e,t,n){const r=Object(be.i)(e.signals),i=Object(be.i)(e.scales);return n||r.forEach(s=>WD(s,t)),Object(be.i)(e.projections).forEach(s=>function(f,m){const x=m.config.projection||{},O={};for(const T in f)T!=="name"&&(O[T]=dC(f[T],T,m));for(const T in x)O[T]==null&&(O[T]=dC(x[T],T,m));m.addProjection(f.name,O)}(s,t)),i.forEach(s=>function(f,m){const x=f.type||"linear";op(x)||Object(be.o)("Unrecognized scale type: "+Object(be.Ba)(x)),m.addScale(f.name,{type:x,domain:void 0})}(s,t)),Object(be.i)(e.data).forEach(s=>q8(s,t)),i.forEach(s=>x8(s,t)),(n||r).forEach(s=>function(f,m){const x=m.getSignal(f.name);let O=f.update;f.init&&(O?Object(be.o)("Signals can not include both init and update expressions."):(O=f.init,x.initonly=!0)),O&&(O=f0(O,m),x.update=O.$expr,x.params=O.$params),f.on&&f.on.forEach(T=>Z9(T,m,x.id))}(s,t)),Object(be.i)(e.axes).forEach(s=>nB(s,t)),Object(be.i)(e.marks).forEach(s=>mw(s,t)),Object(be.i)(e.legends).forEach(s=>U8(s,t)),e.title&&V8(e.title,t),t.parseLambdas(),t}const rB=e=>y1({enter:{x:{value:0},y:{value:0}},update:{width:{signal:"width"},height:{signal:"height"}}},e);function iB(e,t){const n=t.config,r=Pi(t.root=t.add(ow())),i=function(O,T){const M=fe=>rg(O[fe],T[fe]),H=[Bb("background",M("background")),Bb("autosize",function(fe){return Object(be.H)(fe)?fe:{type:fe||"pad"}}(M("autosize"))),Bb("padding",function(fe){return Object(be.H)(fe)?fe.signal?fe:{top:Tb(fe.top),bottom:Tb(fe.bottom),left:Tb(fe.left),right:Tb(fe.right)}:S9(Tb(fe))}(M("padding"))),Bb("width",M("width")||0),Bb("height",M("height")||0)],Z=H.reduce((fe,Ie)=>(fe[Ie.name]=Ie,fe),{}),ue={};return Object(be.i)(O.signals).forEach(fe=>{Object(be.w)(Z,fe.name)?fe=Object(be.p)(Z[fe.name],fe):H.push(fe),ue[fe.name]=fe}),Object(be.i)(T.signals).forEach(fe=>{Object(be.w)(ue,fe.name)||Object(be.w)(Z,fe.name)||H.push(fe)}),H}(e,n);i.forEach(O=>WD(O,t)),t.description=e.description||n.description,t.eventConfig=n.events,t.legends=t.objectProperty(n.legend&&n.legend.layout),t.locale=n.locale;const s=t.add(ig()),f=t.add(KD(zD(rB(e.encode),fw,oC,e.style,t,{pulse:Pi(s)}))),m=t.add(JD({layout:t.objectProperty(e.layout),legends:t.legends,autosize:t.signalRef("autosize"),mark:r,pulse:Pi(f)}));t.operators.pop(),t.pushState(Pi(f),Pi(m),null),ET(e,t,i),t.operators.push(m);let x=t.add($D({mark:r,pulse:Pi(m)}));return x=t.add(YD({pulse:Pi(x)})),x=t.add(wy({pulse:Pi(x)})),t.addData("root",new Ey(t,s,s,x)),t}function Bb(e,t){return t&&t.signal?{name:e,update:t.signal}:{name:e,value:t}}function CT(e,t){this.config=e||{},this.options=t||{},this.bindings=[],this.field={},this.signals={},this.lambdas={},this.scales={},this.events={},this.data={},this.streams=[],this.updates=[],this.operators=[],this.eventConfig=null,this.locale=null,this._id=0,this._subid=0,this._nextsub=[0],this._parent=[],this._encode=[],this._lookup=[],this._markpath=[]}function OT(e){this.config=e.config,this.options=e.options,this.legends=e.legends,this.field=Object.create(e.field),this.signals=Object.create(e.signals),this.lambdas=Object.create(e.lambdas),this.scales=Object.create(e.scales),this.events=Object.create(e.events),this.data=Object.create(e.data),this.streams=[],this.updates=[],this.operators=[],this._id=0,this._subid=++e._nextsub[0],this._nextsub=e._nextsub,this._parent=e._parent.slice(),this._encode=e._encode.slice(),this._lookup=e._lookup.slice(),this._markpath=e._markpath}function AC(e){return(Object(be.B)(e)?function(t){const n=t.length;let r="[";for(let i=0;i<n;++i){const s=t[i];r+=(i>0?",":"")+(Object(be.H)(s)?s.signal||AC(s):Object(be.Ba)(s))}return r+"]"}:function(t){let n,r,i="{",s=0;for(n in t)r=t[n],i+=(++s>1?",":"")+Object(be.Ba)(n)+":"+(Object(be.H)(r)?r.signal||AC(r):Object(be.Ba)(r));return i+"}"})(e)}function oB(e,t,n){return Object(be.H)(e)||Object(be.o)("Input Vega specification must be an object."),iB(e,new CT(t=Object(be.P)({description:"Vega visualization",padding:0,autosize:"pad",background:null,events:{defaults:{allow:["wheel"]}},group:null,mark:null,arc:{fill:"#4c78a8"},area:{fill:"#4c78a8"},image:null,line:{stroke:"#4c78a8",strokeWidth:2},path:{stroke:"#4c78a8"},rect:{fill:"#4c78a8"},rule:{stroke:"#000"},shape:{stroke:"#4c78a8"},symbol:{fill:"#4c78a8",size:64},text:{fill:"#000",font:"sans-serif",fontSize:11},trail:{fill:"#4c78a8",size:2},style:{"guide-label":{fill:"#000",font:"sans-serif",fontSize:10},"guide-title":{fill:"#000",font:"sans-serif",fontSize:11,fontWeight:"bold"},"group-title":{fill:"#000",font:"sans-serif",fontSize:13,fontWeight:"bold"},"group-subtitle":{fill:"#000",font:"sans-serif",fontSize:12},point:{size:30,strokeWidth:2,shape:"circle"},circle:{size:30,strokeWidth:2},square:{size:30,strokeWidth:2,shape:"square"},cell:{fill:"transparent",stroke:"#ddd"}},title:{orient:"top",anchor:"middle",offset:4,subtitlePadding:3},axis:{minExtent:0,maxExtent:200,bandPosition:.5,domain:!0,domainWidth:1,domainColor:"#888",grid:!1,gridWidth:1,gridColor:"#ddd",labels:!0,labelAngle:0,labelLimit:180,labelOffset:0,labelPadding:2,ticks:!0,tickColor:"#888",tickOffset:0,tickRound:!0,tickSize:5,tickWidth:1,titlePadding:4},axisBand:{tickOffset:-.5},projection:{type:"mercator"},legend:{orient:"right",padding:0,gridAlign:"each",columnPadding:10,rowPadding:2,symbolDirection:"vertical",gradientDirection:"vertical",gradientLength:200,gradientThickness:16,gradientStrokeColor:"#ddd",gradientStrokeWidth:0,gradientLabelOffset:2,labelAlign:"left",labelBaseline:"middle",labelLimit:160,labelOffset:4,labelOverlap:!0,symbolLimit:30,symbolType:"circle",symbolSize:100,symbolOffset:0,symbolStrokeWidth:1.5,symbolBaseFillColor:"transparent",symbolBaseStrokeColor:"#888",titleLimit:180,titleOrient:"top",titlePadding:5,layout:{offset:18,direction:"horizontal",left:{direction:"vertical"},right:{direction:"vertical"}}},range:{category:{scheme:"tableau10"},ordinal:{scheme:"blues"},heatmap:{scheme:"yellowgreenblue"},ramp:{scheme:"blues"},diverging:{scheme:"blueorange",extent:[1,0]},symbol:["circle","square","triangle-up","cross","diamond","triangle-right","triangle-down","triangle-left"]}},t,e.config),n)).toRuntime()}CT.prototype=OT.prototype={parse(e){return ET(e,this)},fork(){return new OT(this)},isSubscope(){return this._subid>0},toRuntime(){return this.finish(),{description:this.description,operators:this.operators,streams:this.streams,updates:this.updates,bindings:this.bindings,eventConfig:this.eventConfig,locale:this.locale}},id(){return(this._subid?this._subid+":":0)+this._id++},add(e){return this.operators.push(e),e.id=this.id(),e.refs&&(e.refs.forEach(t=>{t.$ref=e.id}),e.refs=null),e},proxy(e){const t=e instanceof uC?Pi(e):e;return this.add(p8({value:t}))},addStream(e){return this.streams.push(e),e.id=this.id(),e},addUpdate(e){return this.updates.push(e),e},finish(){let e,t;for(e in this.root&&(this.root.root=!0),this.signals)this.signals[e].signal=e;for(e in this.scales)this.scales[e].scale=e;function n(r,i,s){let f;r&&((f=r.data||(r.data={}))[i]||(f[i]=[])).push(s)}for(e in this.data){n((t=this.data[e]).input,e,"input"),n(t.output,e,"output"),n(t.values,e,"values");for(const r in t.index)n(t.index[r],e,"index:"+r)}return this},pushState(e,t,n){this._encode.push(Pi(this.add(wy({pulse:e})))),this._parent.push(t),this._lookup.push(n?Pi(this.proxy(n)):null),this._markpath.push(-1)},popState(){this._encode.pop(),this._parent.pop(),this._lookup.pop(),this._markpath.pop()},parent(){return Object(be.W)(this._parent)},encode(){return Object(be.W)(this._encode)},lookup(){return Object(be.W)(this._lookup)},markpath(){const e=this._markpath;return++e[e.length-1]},fieldRef(e,t){if(Object(be.J)(e))return Nb(e,t);e.signal||Object(be.o)("Unsupported field reference: "+Object(be.Ba)(e));const n=e.signal;let r=this.field[n];if(!r){const i={name:this.signalRef(n)};t&&(i.as=t),this.field[n]=r=Pi(this.add(i8(i)))}return r},compareRef(e){let t=!1;const n=s=>gc(s)?(t=!0,this.signalRef(s.signal)):function(f){return f&&f.expr}(s)?(t=!0,this.exprRef(s.expr)):s,r=Object(be.i)(e.field).map(n),i=Object(be.i)(e.order).map(n);return t?Pi(this.add(GD({fields:r,orders:i}))):VD(r,i)},keyRef(e,t){let n=!1;const r=this.signals;return e=Object(be.i)(e).map(i=>gc(i)?(n=!0,Pi(r[i.signal])):i),n?Pi(this.add(o8({fields:e,flat:t}))):function(i,s){const f={$key:i};return s&&(f.$flat=!0),f}(e,t)},sortRef(e){if(!e)return e;const t=aw(e.op,e.field),n=e.order||"ascending";return n.signal?Pi(this.add(GD({fields:t,orders:this.signalRef(n.signal)}))):VD(t,n)},event(e,t){const n=e+":"+t;if(!this.events[n]){const r=this.id();this.streams.push({id:r,source:e,type:t}),this.events[n]=r}return this.events[n]},hasOwnSignal(e){return Object(be.w)(this.signals,e)},addSignal(e,t){this.hasOwnSignal(e)&&Object(be.o)("Duplicate signal name: "+Object(be.Ba)(e));const n=t instanceof uC?t:this.add(ow(t));return this.signals[e]=n},getSignal(e){return this.signals[e]||Object(be.o)("Unrecognized signal name: "+Object(be.Ba)(e)),this.signals[e]},signalRef(e){return this.signals[e]?Pi(this.signals[e]):(Object(be.w)(this.lambdas,e)||(this.lambdas[e]=this.add(ow(null))),Pi(this.lambdas[e]))},parseLambdas(){const e=Object.keys(this.lambdas);for(let t=0,n=e.length;t<n;++t){const r=e[t],i=f0(r,this),s=this.lambdas[r];s.params=i.$params,s.update=i.$expr}},property(e){return e&&e.signal?this.signalRef(e.signal):e},objectProperty(e){return e&&Object(be.H)(e)?this.signalRef(e.signal||AC(e)):e},exprRef(e,t){const n={expr:f0(e,this)};return t&&(n.expr.$name=t),Pi(this.add(n8(n)))},addBinding(e,t){this.bindings||Object(be.o)("Nested signals do not support binding: "+Object(be.Ba)(e)),this.bindings.push(Object(be.p)({signal:e},t))},addScaleProj(e,t){Object(be.w)(this.scales,e)&&Object(be.o)("Duplicate scale or projection name: "+Object(be.Ba)(e)),this.scales[e]=this.add(t)},addScale(e,t){this.addScaleProj(e,g8(t))},addProjection(e,t){this.addScaleProj(e,d8(t))},getScale(e){return this.scales[e]||Object(be.o)("Unrecognized scale name: "+Object(be.Ba)(e)),this.scales[e]},scaleRef(e){return Pi(this.getScale(e))},scaleType(e){return this.getScale(e).params.type},projectionRef(e){return this.scaleRef(e)},projectionType(e){return this.scaleType(e)},addData(e,t){return Object(be.w)(this.data,e)&&Object(be.o)("Duplicate data set name: "+Object(be.Ba)(e)),this.data[e]=t},getData(e){return this.data[e]||Object(be.o)("Undefined data set name: "+Object(be.Ba)(e)),this.data[e]},addDataPipeline(e,t){return Object(be.w)(this.data,e)&&Object(be.o)("Duplicate data set name: "+Object(be.Ba)(e)),this.addData(e,Ey.fromEntries(this,t))}};const aB="RawCode",sB="Literal",uB="Property",cB="Identifier",lB="ArrayExpression",fB="BinaryExpression",hB="CallExpression",dB="ConditionalExpression",pB="LogicalExpression",mB="MemberExpression",gB="ObjectExpression",vB="UnaryExpression";function sg(e){this.type=e}var Z0,Ai,Sr,cf,Ja;sg.prototype.visit=function(e){let t,n,r;if(e(this))return 1;for(n=0,r=(t=function(i){switch(i.type){case lB:return i.elements;case fB:case pB:return[i.left,i.right];case hB:return[i.callee].concat(i.arguments);case dB:return[i.test,i.consequent,i.alternate];case mB:return[i.object,i.property];case gB:return i.properties;case uB:return[i.key,i.value];case vB:return[i.argument];case cB:case sB:case aB:default:return[]}}(this)).length;n<r;++n)if(t[n].visit(e))return 1};var vw=1,Pb=2,Oy=3,Lv=4,yw=5,Ay=6,kd=7,Lb=8;(Z0={})[vw]="Boolean",Z0[Pb]="<end>",Z0[Oy]="Identifier",Z0[Lv]="Keyword",Z0[yw]="Null",Z0[Ay]="Numeric",Z0[kd]="Punctuator",Z0[Lb]="String",Z0[9]="RegularExpression";var yB="ArrayExpression",bB="BinaryExpression",xB="CallExpression",wB="ConditionalExpression",AT="Identifier",kB="Literal",EB="LogicalExpression",CB="MemberExpression",OB="ObjectExpression",AB="Property",SB="UnaryExpression",zc="Unexpected token %0",_B="Unexpected number",DB="Unexpected string",TB="Unexpected identifier",NB="Unexpected reserved word",FB="Unexpected end of input",SC="Invalid regular expression",_C="Invalid regular expression: missing /",ST="Octal literals are not allowed in strict mode.",IB="Duplicate data property in object literal not allowed in strict mode",xl="ILLEGAL",zb="Disabled.",RB=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0370-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0620-\\u064A\\u066E\\u066F\\u0671-\\u06D3\\u06D5\\u06E5\\u06E6\\u06EE\\u06EF\\u06FA-\\u06FC\\u06FF\\u0710\\u0712-\\u072F\\u074D-\\u07A5\\u07B1\\u07CA-\\u07EA\\u07F4\\u07F5\\u07FA\\u0800-\\u0815\\u081A\\u0824\\u0828\\u0840-\\u0858\\u08A0-\\u08B2\\u0904-\\u0939\\u093D\\u0950\\u0958-\\u0961\\u0971-\\u0980\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BD\\u09CE\\u09DC\\u09DD\\u09DF-\\u09E1\\u09F0\\u09F1\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A59-\\u0A5C\\u0A5E\\u0A72-\\u0A74\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABD\\u0AD0\\u0AE0\\u0AE1\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3D\\u0B5C\\u0B5D\\u0B5F-\\u0B61\\u0B71\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BD0\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D\\u0C58\\u0C59\\u0C60\\u0C61\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBD\\u0CDE\\u0CE0\\u0CE1\\u0CF1\\u0CF2\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D\\u0D4E\\u0D60\\u0D61\\u0D7A-\\u0D7F\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0E01-\\u0E30\\u0E32\\u0E33\\u0E40-\\u0E46\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB0\\u0EB2\\u0EB3\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EDC-\\u0EDF\\u0F00\\u0F40-\\u0F47\\u0F49-\\u0F6C\\u0F88-\\u0F8C\\u1000-\\u102A\\u103F\\u1050-\\u1055\\u105A-\\u105D\\u1061\\u1065\\u1066\\u106E-\\u1070\\u1075-\\u1081\\u108E\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1711\\u1720-\\u1731\\u1740-\\u1751\\u1760-\\u176C\\u176E-\\u1770\\u1780-\\u17B3\\u17D7\\u17DC\\u1820-\\u1877\\u1880-\\u18A8\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1950-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19C1-\\u19C7\\u1A00-\\u1A16\\u1A20-\\u1A54\\u1AA7\\u1B05-\\u1B33\\u1B45-\\u1B4B\\u1B83-\\u1BA0\\u1BAE\\u1BAF\\u1BBA-\\u1BE5\\u1C00-\\u1C23\\u1C4D-\\u1C4F\\u1C5A-\\u1C7D\\u1CE9-\\u1CEC\\u1CEE-\\u1CF1\\u1CF5\\u1CF6\\u1D00-\\u1DBF\\u1E00-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u2071\\u207F\\u2090-\\u209C\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CEE\\u2CF2\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D80-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2E2F\\u3005-\\u3007\\u3021-\\u3029\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA61F\\uA62A\\uA62B\\uA640-\\uA66E\\uA67F-\\uA69D\\uA6A0-\\uA6EF\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA801\\uA803-\\uA805\\uA807-\\uA80A\\uA80C-\\uA822\\uA840-\\uA873\\uA882-\\uA8B3\\uA8F2-\\uA8F7\\uA8FB\\uA90A-\\uA925\\uA930-\\uA946\\uA960-\\uA97C\\uA984-\\uA9B2\\uA9CF\\uA9E0-\\uA9E4\\uA9E6-\\uA9EF\\uA9FA-\\uA9FE\\uAA00-\\uAA28\\uAA40-\\uAA42\\uAA44-\\uAA4B\\uAA60-\\uAA76\\uAA7A\\uAA7E-\\uAAAF\\uAAB1\\uAAB5\\uAAB6\\uAAB9-\\uAABD\\uAAC0\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEA\\uAAF2-\\uAAF4\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABE2\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D\\uFB1F-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF21-\\uFF3A\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]"),MB=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0300-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u0483-\\u0487\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u0591-\\u05BD\\u05BF\\u05C1\\u05C2\\u05C4\\u05C5\\u05C7\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0610-\\u061A\\u0620-\\u0669\\u066E-\\u06D3\\u06D5-\\u06DC\\u06DF-\\u06E8\\u06EA-\\u06FC\\u06FF\\u0710-\\u074A\\u074D-\\u07B1\\u07C0-\\u07F5\\u07FA\\u0800-\\u082D\\u0840-\\u085B\\u08A0-\\u08B2\\u08E4-\\u0963\\u0966-\\u096F\\u0971-\\u0983\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BC-\\u09C4\\u09C7\\u09C8\\u09CB-\\u09CE\\u09D7\\u09DC\\u09DD\\u09DF-\\u09E3\\u09E6-\\u09F1\\u0A01-\\u0A03\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A3C\\u0A3E-\\u0A42\\u0A47\\u0A48\\u0A4B-\\u0A4D\\u0A51\\u0A59-\\u0A5C\\u0A5E\\u0A66-\\u0A75\\u0A81-\\u0A83\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABC-\\u0AC5\\u0AC7-\\u0AC9\\u0ACB-\\u0ACD\\u0AD0\\u0AE0-\\u0AE3\\u0AE6-\\u0AEF\\u0B01-\\u0B03\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3C-\\u0B44\\u0B47\\u0B48\\u0B4B-\\u0B4D\\u0B56\\u0B57\\u0B5C\\u0B5D\\u0B5F-\\u0B63\\u0B66-\\u0B6F\\u0B71\\u0B82\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BBE-\\u0BC2\\u0BC6-\\u0BC8\\u0BCA-\\u0BCD\\u0BD0\\u0BD7\\u0BE6-\\u0BEF\\u0C00-\\u0C03\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D-\\u0C44\\u0C46-\\u0C48\\u0C4A-\\u0C4D\\u0C55\\u0C56\\u0C58\\u0C59\\u0C60-\\u0C63\\u0C66-\\u0C6F\\u0C81-\\u0C83\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBC-\\u0CC4\\u0CC6-\\u0CC8\\u0CCA-\\u0CCD\\u0CD5\\u0CD6\\u0CDE\\u0CE0-\\u0CE3\\u0CE6-\\u0CEF\\u0CF1\\u0CF2\\u0D01-\\u0D03\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D-\\u0D44\\u0D46-\\u0D48\\u0D4A-\\u0D4E\\u0D57\\u0D60-\\u0D63\\u0D66-\\u0D6F\\u0D7A-\\u0D7F\\u0D82\\u0D83\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0DCA\\u0DCF-\\u0DD4\\u0DD6\\u0DD8-\\u0DDF\\u0DE6-\\u0DEF\\u0DF2\\u0DF3\\u0E01-\\u0E3A\\u0E40-\\u0E4E\\u0E50-\\u0E59\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB9\\u0EBB-\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EC8-\\u0ECD\\u0ED0-\\u0ED9\\u0EDC-\\u0EDF\\u0F00\\u0F18\\u0F19\\u0F20-\\u0F29\\u0F35\\u0F37\\u0F39\\u0F3E-\\u0F47\\u0F49-\\u0F6C\\u0F71-\\u0F84\\u0F86-\\u0F97\\u0F99-\\u0FBC\\u0FC6\\u1000-\\u1049\\u1050-\\u109D\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u135D-\\u135F\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1714\\u1720-\\u1734\\u1740-\\u1753\\u1760-\\u176C\\u176E-\\u1770\\u1772\\u1773\\u1780-\\u17D3\\u17D7\\u17DC\\u17DD\\u17E0-\\u17E9\\u180B-\\u180D\\u1810-\\u1819\\u1820-\\u1877\\u1880-\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1920-\\u192B\\u1930-\\u193B\\u1946-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19B0-\\u19C9\\u19D0-\\u19D9\\u1A00-\\u1A1B\\u1A20-\\u1A5E\\u1A60-\\u1A7C\\u1A7F-\\u1A89\\u1A90-\\u1A99\\u1AA7\\u1AB0-\\u1ABD\\u1B00-\\u1B4B\\u1B50-\\u1B59\\u1B6B-\\u1B73\\u1B80-\\u1BF3\\u1C00-\\u1C37\\u1C40-\\u1C49\\u1C4D-\\u1C7D\\u1CD0-\\u1CD2\\u1CD4-\\u1CF6\\u1CF8\\u1CF9\\u1D00-\\u1DF5\\u1DFC-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u200C\\u200D\\u203F\\u2040\\u2054\\u2071\\u207F\\u2090-\\u209C\\u20D0-\\u20DC\\u20E1\\u20E5-\\u20F0\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D7F-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2DE0-\\u2DFF\\u2E2F\\u3005-\\u3007\\u3021-\\u302F\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u3099\\u309A\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA62B\\uA640-\\uA66F\\uA674-\\uA67D\\uA67F-\\uA69D\\uA69F-\\uA6F1\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA827\\uA840-\\uA873\\uA880-\\uA8C4\\uA8D0-\\uA8D9\\uA8E0-\\uA8F7\\uA8FB\\uA900-\\uA92D\\uA930-\\uA953\\uA960-\\uA97C\\uA980-\\uA9C0\\uA9CF-\\uA9D9\\uA9E0-\\uA9FE\\uAA00-\\uAA36\\uAA40-\\uAA4D\\uAA50-\\uAA59\\uAA60-\\uAA76\\uAA7A-\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEF\\uAAF2-\\uAAF6\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABEA\\uABEC\\uABED\\uABF0-\\uABF9\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE00-\\uFE0F\\uFE20-\\uFE2D\\uFE33\\uFE34\\uFE4D-\\uFE4F\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF10-\\uFF19\\uFF21-\\uFF3A\\uFF3F\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]");function bw(e,t){if(!e)throw new Error("ASSERT: "+t)}function ev(e){return e>=48&&e<=57}function DC(e){return"0123456789abcdefABCDEF".indexOf(e)>=0}function Ub(e){return"01234567".indexOf(e)>=0}function jB(e){return e===32||e===9||e===11||e===12||e===160||e>=5760&&[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(e)>=0}function Wb(e){return e===10||e===13||e===8232||e===8233}function Vb(e){return e===36||e===95||e>=65&&e<=90||e>=97&&e<=122||e===92||e>=128&&RB.test(String.fromCharCode(e))}function xw(e){return e===36||e===95||e>=65&&e<=90||e>=97&&e<=122||e>=48&&e<=57||e===92||e>=128&&MB.test(String.fromCharCode(e))}const BB={if:1,in:1,do:1,var:1,for:1,new:1,try:1,let:1,this:1,else:1,case:1,void:1,with:1,enum:1,while:1,break:1,catch:1,throw:1,const:1,yield:1,class:1,super:1,return:1,typeof:1,delete:1,switch:1,export:1,import:1,public:1,static:1,default:1,finally:1,extends:1,package:1,private:1,function:1,continue:1,debugger:1,interface:1,protected:1,instanceof:1,implements:1};function _T(){for(;Sr<cf;){const e=Ai.charCodeAt(Sr);if(!jB(e)&&!Wb(e))break;++Sr}}function TC(e){var t,n,r,i=0;for(n=e==="u"?4:2,t=0;t<n;++t)Sr<cf&&DC(Ai[Sr])?(r=Ai[Sr++],i=16*i+"0123456789abcdef".indexOf(r.toLowerCase())):Ta({},zc,xl);return String.fromCharCode(i)}function PB(){var e,t,n,r;for(t=0,(e=Ai[Sr])==="}"&&Ta({},zc,xl);Sr<cf&&DC(e=Ai[Sr++]);)t=16*t+"0123456789abcdef".indexOf(e.toLowerCase());return(t>1114111||e!=="}")&&Ta({},zc,xl),t<=65535?String.fromCharCode(t):(n=55296+(t-65536>>10),r=56320+(t-65536&1023),String.fromCharCode(n,r))}function DT(){var e,t;for(e=Ai.charCodeAt(Sr++),t=String.fromCharCode(e),e===92&&(Ai.charCodeAt(Sr)!==117&&Ta({},zc,xl),++Sr,(e=TC("u"))&&e!=="\\"&&Vb(e.charCodeAt(0))||Ta({},zc,xl),t=e);Sr<cf&&xw(e=Ai.charCodeAt(Sr));)++Sr,t+=String.fromCharCode(e),e===92&&(t=t.substr(0,t.length-1),Ai.charCodeAt(Sr)!==117&&Ta({},zc,xl),++Sr,(e=TC("u"))&&e!=="\\"&&xw(e.charCodeAt(0))||Ta({},zc,xl),t+=e);return t}function LB(){var e,t;return e=Sr,{type:(t=Ai.charCodeAt(Sr)===92?DT():function(){var n,r;for(n=Sr++;Sr<cf;){if((r=Ai.charCodeAt(Sr))===92)return Sr=n,DT();if(!xw(r))break;++Sr}return Ai.slice(n,Sr)}()).length===1?Oy:BB.hasOwnProperty(t)?Lv:t==="null"?yw:t==="true"||t==="false"?vw:Oy,value:t,start:e,end:Sr}}function NC(){var e,t,n,r,i=Sr,s=Ai.charCodeAt(Sr),f=Ai[Sr];switch(s){case 46:case 40:case 41:case 59:case 44:case 123:case 125:case 91:case 93:case 58:case 63:case 126:return++Sr,{type:kd,value:String.fromCharCode(s),start:i,end:Sr};default:if((e=Ai.charCodeAt(Sr+1))===61)switch(s){case 43:case 45:case 47:case 60:case 62:case 94:case 124:case 37:case 38:case 42:return Sr+=2,{type:kd,value:String.fromCharCode(s)+String.fromCharCode(e),start:i,end:Sr};case 33:case 61:return Sr+=2,Ai.charCodeAt(Sr)===61&&++Sr,{type:kd,value:Ai.slice(i,Sr),start:i,end:Sr}}}return(r=Ai.substr(Sr,4))===">>>="?{type:kd,value:r,start:i,end:Sr+=4}:(n=r.substr(0,3))===">>>"||n==="<<="||n===">>="?{type:kd,value:n,start:i,end:Sr+=3}:f===(t=n.substr(0,2))[1]&&"+-<>&|".indexOf(f)>=0||t==="=>"?{type:kd,value:t,start:i,end:Sr+=2}:(t==="//"&&Ta({},zc,xl),"<>=!+-*%&|^/".indexOf(f)>=0?{type:kd,value:f,start:i,end:++Sr}:void Ta({},zc,xl))}function TT(){var e,t,n;if(bw(ev((n=Ai[Sr]).charCodeAt(0))||n===".","Numeric literal must start with a decimal digit or a decimal point"),t=Sr,e="",n!=="."){if(e=Ai[Sr++],n=Ai[Sr],e==="0"){if(n==="x"||n==="X")return++Sr,function(r){let i="";for(;Sr<cf&&DC(Ai[Sr]);)i+=Ai[Sr++];return i.length===0&&Ta({},zc,xl),Vb(Ai.charCodeAt(Sr))&&Ta({},zc,xl),{type:Ay,value:parseInt("0x"+i,16),start:r,end:Sr}}(t);if(Ub(n))return function(r){let i="0"+Ai[Sr++];for(;Sr<cf&&Ub(Ai[Sr]);)i+=Ai[Sr++];return(Vb(Ai.charCodeAt(Sr))||ev(Ai.charCodeAt(Sr)))&&Ta({},zc,xl),{type:Ay,value:parseInt(i,8),octal:!0,start:r,end:Sr}}(t);n&&ev(n.charCodeAt(0))&&Ta({},zc,xl)}for(;ev(Ai.charCodeAt(Sr));)e+=Ai[Sr++];n=Ai[Sr]}if(n==="."){for(e+=Ai[Sr++];ev(Ai.charCodeAt(Sr));)e+=Ai[Sr++];n=Ai[Sr]}if(n==="e"||n==="E")if(e+=Ai[Sr++],(n=Ai[Sr])!=="+"&&n!=="-"||(e+=Ai[Sr++]),ev(Ai.charCodeAt(Sr)))for(;ev(Ai.charCodeAt(Sr));)e+=Ai[Sr++];else Ta({},zc,xl);return Vb(Ai.charCodeAt(Sr))&&Ta({},zc,xl),{type:Ay,value:parseFloat(e),start:t,end:Sr}}function zB(){var e,t,n,r;return Ja=null,_T(),e=Sr,t=function(){var i,s,f,m;for(bw((i=Ai[Sr])==="/","Regular expression literal must start with a slash"),s=Ai[Sr++],f=!1,m=!1;Sr<cf;)if(s+=i=Ai[Sr++],i==="\\")Wb((i=Ai[Sr++]).charCodeAt(0))&&Ta({},_C),s+=i;else if(Wb(i.charCodeAt(0)))Ta({},_C);else if(f)i==="]"&&(f=!1);else{if(i==="/"){m=!0;break}i==="["&&(f=!0)}return m||Ta({},_C),{value:s.substr(1,s.length-2),literal:s}}(),n=function(){var i,s,f;for(s="",f="";Sr<cf&&xw((i=Ai[Sr]).charCodeAt(0));)++Sr,i==="\\"&&Sr<cf?Ta({},zc,xl):(f+=i,s+=i);return f.search(/[^gimuy]/g)>=0&&Ta({},SC,f),{value:f,literal:s}}(),r=function(i,s){let f=i;s.indexOf("u")>=0&&(f=f.replace(/\\u\{([0-9a-fA-F]+)\}/g,(m,x)=>{if(parseInt(x,16)<=1114111)return"x";Ta({},SC)}).replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,"x"));try{new RegExp(f)}catch{Ta({},SC)}try{return new RegExp(i,s)}catch{return null}}(t.value,n.value),{literal:t.literal+n.literal,value:r,regex:{pattern:t.value,flags:n.value},start:e,end:Sr}}function NT(){if(_T(),Sr>=cf)return{type:Pb,start:Sr,end:Sr};const e=Ai.charCodeAt(Sr);return Vb(e)?LB():e===40||e===41||e===59?NC():e===39||e===34?function(){var t,n,r,i,s="",f=!1;for(bw((t=Ai[Sr])==="'"||t==='"',"String literal must starts with a quote"),n=Sr,++Sr;Sr<cf;){if((r=Ai[Sr++])===t){t="";break}if(r==="\\")if((r=Ai[Sr++])&&Wb(r.charCodeAt(0)))r==="\r"&&Ai[Sr]===`
`&&++Sr;else switch(r){case"u":case"x":Ai[Sr]==="{"?(++Sr,s+=PB()):s+=TC(r);break;case"n":s+=`
`;break;case"r":s+="\r";break;case"t":s+="	";break;case"b":s+="\b";break;case"f":s+="\f";break;case"v":s+="\v";break;default:Ub(r)?((i="01234567".indexOf(r))!==0&&(f=!0),Sr<cf&&Ub(Ai[Sr])&&(f=!0,i=8*i+"01234567".indexOf(Ai[Sr++]),"0123".indexOf(r)>=0&&Sr<cf&&Ub(Ai[Sr])&&(i=8*i+"01234567".indexOf(Ai[Sr++]))),s+=String.fromCharCode(i)):s+=r}else{if(Wb(r.charCodeAt(0)))break;s+=r}}return t!==""&&Ta({},zc,xl),{type:Lb,value:s,octal:f,start:n,end:Sr}}():e===46?ev(Ai.charCodeAt(Sr+1))?TT():NC():ev(e)?TT():NC()}function Ed(){const e=Ja;return Sr=e.end,Ja=NT(),Sr=e.end,e}function FT(){const e=Sr;Ja=NT(),Sr=e}function IT(e,t,n){const r=new sg(e==="||"||e==="&&"?EB:bB);return r.operator=e,r.left=t,r.right=n,r}function UB(e,t){const n=new sg(xB);return n.callee=e,n.arguments=t,n}function FC(e){const t=new sg(AT);return t.name=e,t}function qb(e){const t=new sg(kB);return t.value=e.value,t.raw=Ai.slice(e.start,e.end),e.regex&&(t.raw==="//"&&(t.raw="/(?:)/"),t.regex=e.regex),t}function RT(e,t,n){const r=new sg(CB);return r.computed=e==="[",r.object=t,r.property=n,r.computed||(n.member=!0),r}function MT(e,t,n){const r=new sg(AB);return r.key=t,r.value=n,r.kind=e,r}function Ta(e,t){var n,r=Array.prototype.slice.call(arguments,2),i=t.replace(/%(\d)/g,(s,f)=>(bw(f<r.length,"Message reference must be in range"),r[f]));throw(n=new Error(i)).index=Sr,n.description=i,n}function ww(e){e.type===Pb&&Ta(e,FB),e.type===Ay&&Ta(e,_B),e.type===Lb&&Ta(e,DB),e.type===Oy&&Ta(e,TB),e.type===Lv&&Ta(e,NB),Ta(e,zc,e.value)}function lf(e){const t=Ed();t.type===kd&&t.value===e||ww(t)}function Ls(e){return Ja.type===kd&&Ja.value===e}function IC(e){return Ja.type===Lv&&Ja.value===e}function WB(){const e=[];for(Sr=Ja.start,lf("[");!Ls("]");)Ls(",")?(Ed(),e.push(null)):(e.push(Sy()),Ls("]")||lf(","));return Ed(),function(t){const n=new sg(yB);return n.elements=t,n}(e)}function jT(){Sr=Ja.start;const e=Ed();return e.type===Lb||e.type===Ay?(e.octal&&Ta(e,ST),qb(e)):FC(e.value)}function VB(){var e,t,n;return Sr=Ja.start,(e=Ja).type===Oy?(n=jT(),lf(":"),MT("init",n,Sy())):e.type!==Pb&&e.type!==kd?(t=jT(),lf(":"),MT("init",t,Sy())):void ww(e)}function qB(){var e,t,n=[],r={},i=String;for(Sr=Ja.start,lf("{");!Ls("}");)t="$"+((e=VB()).key.type===AT?e.key.name:i(e.key.value)),Object.prototype.hasOwnProperty.call(r,t)?Ta({},IB):r[t]=!0,n.push(e),Ls("}")||lf(",");return lf("}"),function(s){const f=new sg(OB);return f.properties=s,f}(n)}const HB={if:1};function $B(){var e,t,n;if(Ls("("))return function(){lf("(");const r=RC();return lf(")"),r}();if(Ls("["))return WB();if(Ls("{"))return qB();if(e=Ja.type,Sr=Ja.start,e===Oy||HB[Ja.value])n=FC(Ed().value);else if(e===Lb||e===Ay)Ja.octal&&Ta(Ja,ST),n=qb(Ed());else{if(e===Lv)throw new Error(zb);e===vw?((t=Ed()).value=t.value==="true",n=qb(t)):e===yw?((t=Ed()).value=null,n=qb(t)):Ls("/")||Ls("/=")?(n=qb(zB()),FT()):ww(Ed())}return n}function GB(){const e=[];if(lf("("),!Ls(")"))for(;Sr<cf&&(e.push(Sy()),!Ls(")"));)lf(",");return lf(")"),e}function KB(){Sr=Ja.start;const e=Ed();return function(t){return t.type===Oy||t.type===Lv||t.type===vw||t.type===yw}(e)||ww(e),FC(e.value)}function XB(){lf("[");const e=RC();return lf("]"),e}function BT(){const e=function(){var t;for(t=$B();;)if(Ls("."))lf("."),t=RT(".",t,KB());else if(Ls("("))t=UB(t,GB());else{if(!Ls("["))break;t=RT("[",t,XB())}return t}();if(Ja.type===kd&&(Ls("++")||Ls("--")))throw new Error(zb);return e}function kw(){var e,t;if(Ja.type!==kd&&Ja.type!==Lv)t=BT();else{if(Ls("++")||Ls("--"))throw new Error(zb);if(Ls("+")||Ls("-")||Ls("~")||Ls("!"))e=Ed(),t=kw(),t=function(n,r){const i=new sg(SB);return i.operator=n,i.argument=r,i.prefix=!0,i}(e.value,t);else{if(IC("delete")||IC("void")||IC("typeof"))throw new Error(zb);t=BT()}}return t}function PT(e){let t=0;if(e.type!==kd&&e.type!==Lv)return 0;switch(e.value){case"||":t=1;break;case"&&":t=2;break;case"|":t=3;break;case"^":t=4;break;case"&":t=5;break;case"==":case"!=":case"===":case"!==":t=6;break;case"<":case">":case"<=":case">=":case"instanceof":case"in":t=7;break;case"<<":case">>":case">>>":t=8;break;case"+":case"-":t=9;break;case"*":case"/":case"%":t=11}return t}function Sy(){var e,t;return e=function(){var n,r,i,s,f,m,x,O,T,M;if(n=Ja,T=kw(),(f=PT(s=Ja))===0)return T;for(s.prec=f,Ed(),r=[n,Ja],m=[T,s,x=kw()];(f=PT(Ja))>0;){for(;m.length>2&&f<=m[m.length-2].prec;)x=m.pop(),O=m.pop().value,T=m.pop(),r.pop(),i=IT(O,T,x),m.push(i);(s=Ed()).prec=f,m.push(s),r.push(Ja),i=kw(),m.push(i)}for(i=m[M=m.length-1],r.pop();M>1;)r.pop(),i=IT(m[M-1].value,m[M-2],i),M-=2;return i}(),Ls("?")&&(Ed(),t=Sy(),lf(":"),e=function(n,r,i){const s=new sg(wB);return s.test=n,s.consequent=r,s.alternate=i,s}(e,t,Sy())),e}function RC(){const e=Sy();if(Ls(","))throw new Error(zb);return e}function YB(e){Sr=0,cf=(Ai=e).length,Ja=null,FT();const t=RC();if(Ja.type!==Pb)throw new Error("Unexpect token after expression.");return t}var JB={NaN:"NaN",E:"Math.E",LN2:"Math.LN2",LN10:"Math.LN10",LOG2E:"Math.LOG2E",LOG10E:"Math.LOG10E",PI:"Math.PI",SQRT1_2:"Math.SQRT1_2",SQRT2:"Math.SQRT2",MIN_VALUE:"Number.MIN_VALUE",MAX_VALUE:"Number.MAX_VALUE"};function QB(e){function t(r,i,s){return f=>function(m,x,O,T){let M=e(x[0]);return O&&(M=O+"("+M+")",O.lastIndexOf("new ",0)===0&&(M="("+M+")")),M+"."+m+(T<0?"":T===0?"()":"("+x.slice(1).map(e).join(",")+")")}(r,f,i,s)}const n="new Date";return{isNaN:"Number.isNaN",isFinite:"Number.isFinite",abs:"Math.abs",acos:"Math.acos",asin:"Math.asin",atan:"Math.atan",atan2:"Math.atan2",ceil:"Math.ceil",cos:"Math.cos",exp:"Math.exp",floor:"Math.floor",log:"Math.log",max:"Math.max",min:"Math.min",pow:"Math.pow",random:"Math.random",round:"Math.round",sin:"Math.sin",sqrt:"Math.sqrt",tan:"Math.tan",clamp:function(r){r.length<3&&Object(be.o)("Missing arguments to clamp function."),r.length>3&&Object(be.o)("Too many arguments to clamp function.");const i=r.map(e);return"Math.max("+i[1]+", Math.min("+i[2]+","+i[0]+"))"},now:"Date.now",utc:"Date.UTC",datetime:n,date:t("getDate",n,0),day:t("getDay",n,0),year:t("getFullYear",n,0),month:t("getMonth",n,0),hours:t("getHours",n,0),minutes:t("getMinutes",n,0),seconds:t("getSeconds",n,0),milliseconds:t("getMilliseconds",n,0),time:t("getTime",n,0),timezoneoffset:t("getTimezoneOffset",n,0),utcdate:t("getUTCDate",n,0),utcday:t("getUTCDay",n,0),utcyear:t("getUTCFullYear",n,0),utcmonth:t("getUTCMonth",n,0),utchours:t("getUTCHours",n,0),utcminutes:t("getUTCMinutes",n,0),utcseconds:t("getUTCSeconds",n,0),utcmilliseconds:t("getUTCMilliseconds",n,0),length:t("length",null,-1),parseFloat:"parseFloat",parseInt:"parseInt",upper:t("toUpperCase","String",0),lower:t("toLowerCase","String",0),substring:t("substring","String"),split:t("split","String"),trim:t("trim","String",0),regexp:"RegExp",test:t("test","RegExp"),if:function(r){r.length<3&&Object(be.o)("Missing arguments to if function."),r.length>3&&Object(be.o)("Too many arguments to if function.");const i=r.map(e);return"("+i[0]+"?"+i[1]+":"+i[2]+")"}}}function ZB(e){const t=(e=e||{}).allowed?Object(be.Fa)(e.allowed):{},n=e.forbidden?Object(be.Fa)(e.forbidden):{},r=e.constants||JB,i=(e.functions||QB)(M),s=e.globalvar,f=e.fieldvar,m=Object(be.E)(s)?s:ue=>"".concat(s,'["').concat(ue,'"]');let x={},O={},T=0;function M(ue){if(Object(be.J)(ue))return ue;const fe=H[ue.type];return fe==null&&Object(be.o)("Unsupported type: "+ue.type),fe(ue)}const H={Literal:ue=>ue.raw,Identifier:ue=>{const fe=ue.name;return T>0?fe:Object(be.w)(n,fe)?Object(be.o)("Illegal identifier: "+fe):Object(be.w)(r,fe)?r[fe]:Object(be.w)(t,fe)?fe:(x[fe]=1,m(fe))},MemberExpression:ue=>{const fe=!ue.computed,Ie=M(ue.object);fe&&(T+=1);const Pe=M(ue.property);return Ie===f&&(O[function(Le){const rt=Le&&Le.length-1;return rt&&(Le[0]==='"'&&Le[rt]==='"'||Le[0]==="'"&&Le[rt]==="'")?Le.slice(1,-1):Le}(Pe)]=1),fe&&(T-=1),Ie+(fe?"."+Pe:"["+Pe+"]")},CallExpression:ue=>{ue.callee.type!=="Identifier"&&Object(be.o)("Illegal callee type: "+ue.callee.type);const fe=ue.callee.name,Ie=ue.arguments,Pe=Object(be.w)(i,fe)&&i[fe];return Pe||Object(be.o)("Unrecognized function: "+fe),Object(be.E)(Pe)?Pe(Ie):Pe+"("+Ie.map(M).join(",")+")"},ArrayExpression:ue=>"["+ue.elements.map(M).join(",")+"]",BinaryExpression:ue=>"("+M(ue.left)+" "+ue.operator+" "+M(ue.right)+")",UnaryExpression:ue=>"("+ue.operator+M(ue.argument)+")",ConditionalExpression:ue=>"("+M(ue.test)+"?"+M(ue.consequent)+":"+M(ue.alternate)+")",LogicalExpression:ue=>"("+M(ue.left)+ue.operator+M(ue.right)+")",ObjectExpression:ue=>"{"+ue.properties.map(M).join(",")+"}",Property:ue=>{T+=1;const fe=M(ue.key);return T-=1,fe+":"+M(ue.value)}};function Z(ue){const fe={code:M(ue),globals:Object.keys(x),fields:Object.keys(O)};return x={},O={},fe}return Z.functions=i,Z.constants=r,Z}const e7="view",Ew="[",Cw="]",LT="{",zT="}",t7=":",UT=",",n7="@",r7=">",i7=/[[\]{}]/,o7={"*":1,arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1};let WT,VT;function _y(e,t,n){return WT=t||e7,VT=n||o7,qT(e.trim()).map(MC)}function Hb(e,t,n,r,i){const s=e.length;let f,m=0;for(;t<s;++t){if(f=e[t],!m&&f===n)return t;i&&i.indexOf(f)>=0?--m:r&&r.indexOf(f)>=0&&++m}return t}function qT(e){const t=[],n=e.length;let r=0,i=0;for(;i<n;)i=Hb(e,i,UT,Ew+LT,Cw+zT),t.push(e.substring(r,i).trim()),r=++i;if(t.length===0)throw"Empty event selector: "+e;return t}function MC(e){return e[0]==="["?function(t){const n=t.length;let r,i=1;if((i=Hb(t,i,Cw,Ew,Cw))===n)throw"Empty between selector: "+t;if((r=qT(t.substring(1,i))).length!==2)throw"Between selector must have two elements: "+t;if((t=t.slice(i+1).trim())[0]!==r7)throw"Expected '>' after between selector: "+t;r=r.map(MC);const s=MC(t.slice(1).trim());return s.between?{between:r,stream:s}:(s.between=r,s)}(e):function(t){const n={source:WT},r=[];let i,s,f=[0,0],m=0,x=0,O=t.length,T=0;if(t[O-1]===zT){if(!((T=t.lastIndexOf(LT))>=0))throw"Unmatched right brace: "+t;try{f=function(M){const H=M.split(UT);if(!M.length||H.length>2)throw M;return H.map(Z=>{const ue=+Z;if(ue!=ue)throw M;return ue})}(t.substring(T+1,O-1))}catch{throw"Invalid throttle specification: "+t}t=t.slice(0,T).trim(),O=t.length,T=0}if(!O)throw t;if(t[0]===n7&&(m=++T),(i=Hb(t,T,t7))<O&&(r.push(t.substring(x,i).trim()),x=T=++i),(T=Hb(t,T,Ew))===O)r.push(t.substring(x,O).trim());else if(r.push(t.substring(x,T).trim()),s=[],(x=++T)===O)throw"Unmatched left bracket: "+t;for(;T<O;){if((T=Hb(t,T,Cw))===O)throw"Unmatched left bracket: "+t;if(s.push(t.substring(x,T).trim()),T<O-1&&t[++T]!==Ew)throw"Expected left bracket: "+t;x=++T}if(!(O=r.length)||i7.test(r[O-1]))throw"Invalid event selector: "+t;return O>1?(n.type=r[1],m?n.markname=r[0].slice(1):function(M){return VT[M]}(r[0])?n.marktype=r[0]:n.source=r[0]):n.type=r[0],n.type.slice(-1)==="!"&&(n.consume=!0,n.type=n.type.slice(0,-1)),s!=null&&(n.filter=s),f[0]&&(n.throttle=f[0]),f[1]&&(n.debounce=f[1]),n}(e)}var a7="5.20.0";Object(be.p)(pn,U,re,J,R,W,P,q,ee,I,se,ie);const s7=a7;var u7=a(245),C1=function(e,t,n){return e.fields=t||[],e.fname=n,e},c7=function(e){return e.length===1?l7(e[0]):f7(e)};const l7=e=>function(t){return t[e]},f7=e=>{const t=e.length;return function(n){for(let r=0;r<t;++r)n=n[e[r]];return n}};var jC=function(e){throw Error(e)},Dy=function(e){var t,n,r,i=[],s=null,f=0,m=e.length,x="";function O(){i.push(x+e.substring(t,n)),x="",t=n+1}for(e+="",t=n=0;n<m;++n)if((r=e[n])==="\\")x+=e.substring(t,n),x+=e.substring(++n,++n),t=n;else if(r===s)O(),s=null,f=-1;else{if(s)continue;t===f&&r==='"'||t===f&&r==="'"?(t=n+1,s=r):r!=="."||f?r==="["?(n>t&&O(),f=t=n+1):r==="]"&&(f||jC("Access path missing open bracket: "+e),f>0&&O(),f=0,t=n+1):n>t?O():t=n+1}return f&&jC("Access path missing closing bracket: "+e),s&&jC("Access path missing closing quote: "+e),n>t&&(n++,O()),i},h7=function(e,t,n){const r=Dy(e);return e=r.length===1?r[0]:e,C1((n&&n.get||c7)(r),[e],t||e)},$b=[],d7=(h7("id"),C1(function(e){return e},$b,"identity"));C1(function(){return 0},$b,"zero"),C1(function(){return 1},$b,"one"),C1(function(){return!0},$b,"true"),C1(function(){return!1},$b,"false");function Ow(e,t,n){var r=[t].concat([].slice.call(n));console[e].apply(console,r)}var Gi=Array.isArray,Uc=function(e){return e===Object(e)};const HT=e=>e!=="__proto__";function $T(...e){return e.reduce((t,n)=>{for(var r in n)if(r==="signals")t.signals=p7(t.signals,n.signals);else{var i=r==="legend"?{layout:1}:r==="style"||null;BC(t,r,n[r],i)}return t},{})}function BC(e,t,n,r){var i,s;if(HT(t))if(Uc(n)&&!Gi(n))for(i in s=Uc(e[t])?e[t]:e[t]={},n)r&&(r===!0||r[i])?BC(s,i,n[i]):HT(i)&&(s[i]=n[i]);else e[t]=n}function p7(e,t){if(e==null)return t;const n={},r=[];function i(s){n[s.name]||(n[s.name]=1,r.push(s))}return t.forEach(i),e.forEach(i),r}var Mu=function(e){return e!=null?Gi(e)?e:[e]:[]},m7=function(e){return typeof e=="function"};const g7=Object.prototype.hasOwnProperty;var Ty=function(e,t){return g7.call(e,t)},Gb=function(e){return typeof e=="boolean"},Ju=function(e){return typeof e=="number"},$o=function(e){return typeof e=="string"};function ga(e){return Gi(e)?"["+e.map(ga)+"]":Uc(e)||$o(e)?JSON.stringify(e).replace("\u2028","\\u2028").replace("\u2029","\\u2029"):e}var Ny=function(e){for(var t={},n=0,r=e.length;n<r;++n)t[e[n]]=!0;return t};function Li(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function"){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}Array.prototype.flat||Object.defineProperty(Array.prototype,"flat",{configurable:!0,value:function e(){var t=isNaN(arguments[0])?1:Number(arguments[0]);return t?Array.prototype.reduce.call(this,function(n,r){return Array.isArray(r)?n.push.apply(n,e.call(r,t-1)):n.push(r),n},[]):Array.prototype.slice.call(this)},writable:!0}),Array.prototype.flatMap||Object.defineProperty(Array.prototype,"flatMap",{configurable:!0,value:function(e){return Array.prototype.map.apply(this,arguments).flat()},writable:!0});var v7=a(244),y7=a.n(v7),b7=a(243),x7=a.n(b7),w7=a(86),Kb=a.n(w7);function PC(e){return!!e.or}function LC(e){return!!e.and}function zC(e){return!!e.not}const Xb=x7.a,Go=y7.a;function Yb(e,t){const n={};for(const r of t)Ty(e,r)&&(n[r]=e[r]);return n}function tv(e,t){const n=Object.assign({},e);for(const r of t)delete n[r];return n}Set.prototype.toJSON=function(){return`Set(${[...this].map(e=>Kb()(e)).join(",")})`};const Zs=Kb.a;function Ea(e){if(Ju(e))return e;const t=$o(e)?e:Kb()(e);if(t.length<250)return t;let n=0;for(let r=0;r<t.length;r++)n=(n<<5)-n+t.charCodeAt(r),n&=n;return n}function GT(e){return e===!1||e===null}function Ji(e,t){return e.indexOf(t)>-1}function Jb(e,t){let n=0;for(const[r,i]of e.entries())if(t(i,r,n++))return!0;return!1}function KT(e,t){let n=0;for(const[r,i]of e.entries())if(!t(i,r,n++))return!1;return!0}function k7(e,t){for(const n of Kr(t))BC(e,n,t[n],!0)}function zv(e,t){const n=[],r={};let i;for(const s of e)(i=t(s))in r||(r[i]=1,n.push(s));return n}function XT(e,t){for(const n of e)if(t.has(n))return!0;return!1}function YT(e){const t=new Set;for(const n of e){const r=Dy(n).map((s,f)=>f===0?s:`[${s}]`),i=r.map((s,f)=>r.slice(0,f+1).join(""));for(const s of i)t.add(s)}return t}function JT(e,t){return e===void 0||t===void 0||XT(YT(e),YT(t))}function ms(e){return Kr(e).length===0}const Kr=Object.keys,Uv=Object.values;function QT(e){const t=[];for(const n in e)Ty(e,n)&&t.push({key:n,value:e[n]});return t}function Aw(e){return e===!0||e===!1}function eu(e){const t=e.replace(/\W/g,"_");return(e.match(/^\d+/)?"_":"")+t}function Qb(e,t){return zC(e)?"!("+Qb(e.not,t)+")":LC(e)?"("+e.and.map(n=>Qb(n,t)).join(") && (")+")":PC(e)?"("+e.or.map(n=>Qb(n,t)).join(") || (")+")":t(e)}function UC(e,t){if(t.length===0)return!0;const n=t.shift();return n in e&&UC(e[n],t)&&delete e[n],ms(e)}function Sw(e){return e.charAt(0).toUpperCase()+e.substr(1)}function ZT(e,t="datum"){const n=Dy(e),r=[];for(let i=1;i<=n.length;i++){const s=`[${n.slice(0,i).map(ga).join("][")}]`;r.push(`${t}${s}`)}return r.join(" && ")}function E7(e){return e.replace(/(\[|\]|\.|'|")/g,"\\$1")}function Wv(e){return`${Dy(e).map(E7).join("\\.")}`}function O1(e,t,n){return e.replace(new RegExp(t.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&"),"g"),n)}function eN(e){return`${Dy(e).join(".")}`}function Zb(e){return e?Dy(e).length:0}function Qu(...e){for(const t of e)if(t!==void 0)return t}let C7=42;function O7(e){const t=++C7;return e?String(e)+t:t}function _w(e){if(e!==void 0)return(e%360+360)%360}function WC(e){return!!Ju(e)||!isNaN(e)&&!isNaN(parseFloat(e))}const tN={domainColor:{part:"domain",vgProp:"stroke"},labelAlign:{part:"labels",vgProp:"align"},labelBaseline:{part:"labels",vgProp:"baseline"},labelColor:{part:"labels",vgProp:"fill"},labelFont:{part:"labels",vgProp:"font"},labelFontSize:{part:"labels",vgProp:"fontSize"},labelFontStyle:{part:"labels",vgProp:"fontStyle"},labelFontWeight:{part:"labels",vgProp:"fontWeight"},labelOpacity:{part:"labels",vgProp:"opacity"},labelOffset:null,labelPadding:null,gridColor:{part:"grid",vgProp:"stroke"},gridDash:{part:"grid",vgProp:"strokeDash"},gridDashOffset:{part:"grid",vgProp:"strokeDash"},gridOpacity:{part:"grid",vgProp:"opacity"},gridWidth:{part:"grid",vgProp:"strokeWidth"},tickColor:{part:"ticks",vgProp:"stroke"},tickDash:{part:"ticks",vgProp:"strokeDash"},tickDashOffset:{part:"ticks",vgProp:"strokeDash"},tickOpacity:{part:"ticks",vgProp:"opacity"},tickSize:null,tickWidth:{part:"ticks",vgProp:"strokeWidth"},titleColor:{part:"title",vgProp:"fill"},title:null};function VC(e){return e&&e.condition}const nN=["domain","grid","labels","ticks","title"],A7={grid:"grid",gridCap:"grid",gridColor:"grid",gridDash:"grid",gridDashOffset:"grid",gridOpacity:"grid",gridScale:"grid",gridWidth:"grid",orient:"main",bandPosition:"both",aria:"main",description:"main",domain:"main",domainCap:"main",domainColor:"main",domainDash:"main",domainDashOffset:"main",domainOpacity:"main",domainWidth:"main",format:"main",formatType:"main",labelAlign:"main",labelAngle:"main",labelBaseline:"main",labelBound:"main",labelColor:"main",labelFlush:"main",labelFlushOffset:"main",labelFont:"main",labelFontSize:"main",labelFontStyle:"main",labelFontWeight:"main",labelLimit:"main",labelLineHeight:"main",labelOffset:"main",labelOpacity:"main",labelOverlap:"main",labelPadding:"main",labels:"main",labelSeparation:"main",maxExtent:"main",minExtent:"main",offset:"both",position:"main",tickCap:"main",tickColor:"main",tickDash:"main",tickDashOffset:"main",tickMinStep:"main",tickOffset:"both",tickOpacity:"main",tickRound:"both",ticks:"main",tickSize:"main",tickWidth:"both",title:"main",titleAlign:"main",titleAnchor:"main",titleAngle:"main",titleBaseline:"main",titleColor:"main",titleFont:"main",titleFontSize:"main",titleFontStyle:"main",titleFontWeight:"main",titleLimit:"main",titleLineHeight:"main",titleOpacity:"main",titlePadding:"main",titleX:"main",titleY:"main",encode:"both",scale:"both",tickBand:"both",tickCount:"both",tickExtra:"both",translate:"both",values:"both",zindex:"both"},rN={orient:1,aria:1,bandPosition:1,description:1,domain:1,domainCap:1,domainColor:1,domainDash:1,domainDashOffset:1,domainOpacity:1,domainWidth:1,format:1,formatType:1,grid:1,gridCap:1,gridColor:1,gridDash:1,gridDashOffset:1,gridOpacity:1,gridWidth:1,labelAlign:1,labelAngle:1,labelBaseline:1,labelBound:1,labelColor:1,labelFlush:1,labelFlushOffset:1,labelFont:1,labelFontSize:1,labelFontStyle:1,labelFontWeight:1,labelLimit:1,labelLineHeight:1,labelOffset:1,labelOpacity:1,labelOverlap:1,labelPadding:1,labels:1,labelSeparation:1,maxExtent:1,minExtent:1,offset:1,position:1,tickBand:1,tickCap:1,tickColor:1,tickCount:1,tickDash:1,tickDashOffset:1,tickExtra:1,tickMinStep:1,tickOffset:1,tickOpacity:1,tickRound:1,ticks:1,tickSize:1,tickWidth:1,title:1,titleAlign:1,titleAnchor:1,titleAngle:1,titleBaseline:1,titleColor:1,titleFont:1,titleFontSize:1,titleFontStyle:1,titleFontWeight:1,titleLimit:1,titleLineHeight:1,titleOpacity:1,titlePadding:1,titleX:1,titleY:1,translate:1,values:1,zindex:1},S7=Object.assign(Object.assign({},rN),{style:1,labelExpr:1,encoding:1});function iN(e){return!!S7[e]}const yh={arc:"arc",area:"area",bar:"bar",image:"image",line:"line",point:"point",rect:"rect",rule:"rule",text:"text",tick:"tick",trail:"trail",circle:"circle",square:"square",geoshape:"geoshape"},oN=yh.arc,Dw=yh.area,Tw=yh.bar,_7=yh.image,Nw=yh.line,Fw=yh.point,D7=yh.rect,Iw=yh.rule,aN=yh.text,qC=yh.tick,T7=yh.trail,HC=yh.circle,$C=yh.square,sN=yh.geoshape;function Fy(e){return Ji(["line","area","trail"],e)}function uN(e){return Ji(["rect","bar","image","arc"],e)}const cN=Kr(yh);function h0(e){return e.type}Ny(cN);const N7=["stroke","strokeWidth","strokeDash","strokeDashOffset","strokeOpacity","strokeJoin","strokeMiterLimit","fill","fillOpacity"],lN=Kr({color:1,filled:1,invalid:1,order:1,radius2:1,theta2:1,timeUnitBand:1,timeUnitBandPosition:1}),F7={horizontal:["cornerRadiusTopRight","cornerRadiusBottomRight"],vertical:["cornerRadiusTopLeft","cornerRadiusTopRight"]},I7={binSpacing:1,continuousBandSize:5,timeUnitBandPosition:.5},R7={binSpacing:0,continuousBandSize:5,timeUnitBandPosition:.5};function nv(e){return"mark"in e}class Rw{constructor(t,n){this.name=t,this.run=n}hasMatchingType(t){return!!nv(t)&&function(n){return h0(n)?n.type:n}(t.mark)===this.name}}const M7={argmax:1,argmin:1,average:1,count:1,distinct:1,product:1,max:1,mean:1,median:1,min:1,missing:1,q1:1,q3:1,ci0:1,ci1:1,stderr:1,stdev:1,stdevp:1,sum:1,valid:1,values:1,variance:1,variancep:1},j7={count:1,min:1,max:1};function Vv(e){return!!e&&!!e.argmin}function Iy(e){return!!e&&!!e.argmax}function GC(e){return $o(e)&&!!M7[e]}const B7=["count","valid","missing","distinct"];function fN(e){return $o(e)&&Ji(B7,e)}const P7=["count","sum","distinct","valid","missing"],L7=Ny(["mean","average","median","q1","q3","min","max"]),rv="row",iv="column",Mw="facet",uu="x",vc="y",ug="x2",d0="y2",p0="radius",ov="radius2",cg="theta",av="theta2",m0="latitude",g0="longitude",lg="latitude2",pm="longitude2",Cd="color",v0="fill",y0="stroke",Od="shape",sv="size",Ry="angle",uv="opacity",qv="fillOpacity",Hv="strokeOpacity",$v="strokeWidth",Gv="strokeDash",ex="text",tx="order",nx="detail",jw="key",My="tooltip",Bw="href",Pw="url",Lw="description",hN={theta:1,theta2:1,radius:1,radius2:1};function dN(e){return e in hN}const KC={longitude:1,longitude2:1,latitude:1,latitude2:1},z7=Kr(KC),pN=Object.assign(Object.assign(Object.assign(Object.assign({},{x:1,y:1,x2:1,y2:1}),hN),KC),{color:1,fill:1,stroke:1,opacity:1,fillOpacity:1,strokeOpacity:1,strokeWidth:1,strokeDash:1,size:1,angle:1,shape:1,order:1,text:1,detail:1,key:1,tooltip:1,href:1,url:1,description:1});function A1(e){return e===Cd||e===v0||e===y0}const mN={row:1,column:1,facet:1},mm=Kr(mN),XC=Object.assign(Object.assign({},pN),mN),gN=Kr(XC),U7=Li(XC,["order","detail","tooltip"]),W7=Li(U7,["row","column","facet"]);function V7(e){return!!W7[e]}function vN(e){return!!XC[e]}const q7=[ug,d0,lg,pm,av,ov];function yN(e){return jy(e)!==e}function jy(e){switch(e){case ug:return uu;case d0:return vc;case lg:return m0;case pm:return g0;case av:return cg;case ov:return p0}return e}function Kv(e){if(dN(e))switch(e){case cg:return"startAngle";case av:return"endAngle";case p0:return"outerRadius";case ov:return"innerRadius"}return e}function b0(e){switch(e){case uu:return ug;case vc:return d0;case m0:return lg;case g0:return pm;case cg:return av;case p0:return ov}}function x0(e){switch(e){case uu:case ug:return"width";case vc:case d0:return"height"}}const YC=Li(pN,["x","y","x2","y2","latitude","longitude","latitude2","longitude2","theta","theta2","radius","radius2"]),H7=Kr(YC),Xv={x:1,y:1},gm=Kr(Xv);function w0(e){return e in Xv}const JC={theta:1,radius:1},$7=Kr(JC);function zw(e){return e==="width"?uu:vc}const bN=Li(YC,["text","tooltip","href","url","description","detail","key","order"]),G7=Kr(bN),xN=Object.assign(Object.assign(Object.assign({},Xv),JC),bN),Uw=Kr(xN);function Yv(e){return!!xN[e]}function K7(e,t){return function(n){switch(n){case Cd:case v0:case y0:case Lw:case nx:case jw:case My:case Bw:case tx:case uv:case qv:case Hv:case $v:case Mw:case rv:case iv:return wN;case uu:case vc:case m0:case g0:return X7;case ug:case d0:case lg:case pm:return{area:"always",bar:"always",image:"always",rect:"always",rule:"always",circle:"binned",point:"binned",square:"binned",tick:"binned",line:"binned",trail:"binned"};case sv:return{point:"always",tick:"always",rule:"always",circle:"always",square:"always",bar:"always",text:"always",line:"always",trail:"always"};case Gv:return{line:"always",point:"always",tick:"always",rule:"always",circle:"always",square:"always",bar:"always",geoshape:"always"};case Od:return{point:"always",geoshape:"always"};case ex:return{text:"always"};case Ry:return{point:"always",square:"always",text:"always"};case Pw:return{image:"always"};case cg:case p0:return{text:"always",arc:"always"};case av:case ov:return{arc:"always"}}}(e)[t]}const wN={arc:"always",area:"always",bar:"always",circle:"always",geoshape:"always",image:"always",line:"always",rule:"always",point:"always",rect:"always",square:"always",trail:"always",text:"always",tick:"always"},X7=Li(wN,["geoshape"]);function Ww(e){switch(e){case uu:case vc:case cg:case p0:case sv:case Ry:case $v:case uv:case qv:case Hv:case ug:case d0:case av:case ov:return;case Mw:case rv:case iv:case Od:case Gv:case ex:case My:case Bw:case Pw:case Lw:return"discrete";case Cd:case v0:case y0:return"flexible";case m0:case g0:case lg:case pm:case nx:case jw:case tx:return}}function kN(e){return Gb(e)&&(e=Zw(e,void 0)),"bin"+Kr(e).map(t=>Vw(e[t])?eu(`_${t}_${Object.entries(e[t])}`):eu(`_${t}_${e[t]}`)).join("")}function Ts(e){return e===!0||rx(e)&&!e.binned}function bh(e){return e==="binned"||rx(e)&&e.binned===!0}function rx(e){return Uc(e)}function Vw(e){return e==null?void 0:e.selection}function EN(e){switch(e){case rv:case iv:case sv:case Cd:case v0:case y0:case $v:case uv:case qv:case Hv:case Od:return 6;case Gv:return 4;default:return 10}}function Y7(e){return`Invalid specification ${JSON.stringify(e)}. Make sure the specification includes at least one of the following properties: "mark", "layer", "facet", "hconcat", "vconcat", "concat", or "repeat".`}const J7='Autosize "fit" only works for single views and layered views.';function Q7(e){return`${e=="width"?"Width":"Height"} "container" only works for single views and layered views.`}function Z7(e){return`${e=="width"?"Width":"Height"} "container" only works well with autosize "fit" or "fit-${e=="width"?"x":"y"}".`}function eP(e){return e?`Dropping "fit-${e}" because spec has discrete ${x0(e)}.`:'Dropping "fit" because spec has discrete size.'}function tP(e){return`Cannot project a selection on encoding channel "${e}", which has no field.`}function nP(e,t){return`Cannot project a selection on encoding channel "${e}" as it uses an aggregate function ("${t}").`}function rP(e){return`The "nearest" transform is not supported for ${e} marks.`}function iP(e){return`Selection not supported for ${e} yet.`}function oP(e){return`Cannot find a selection named "${e}".`}const aP="Scale bindings are currently only supported for scales with unbinned, continuous domains.",sP="Legend bindings are only supported for selections over an individual field or encoding channel.";function uP(e){return`Cannot define and lookup the "${e}" selection in the same view. Try moving the lookup into a second, layered view?`}function cP(e){return`Unknown repeated value "${e}".`}function lP(e){return`The "columns" property cannot be used when "${e}" has nested row/column.`}const fP="Axes cannot be shared in concatenated or repeated views yet (https://github.com/vega/vega-lite/issues/2415).";function hP(e){return`Unrecognized parse "${e}".`}function dP(e,t,n){return`An ancestor parsed field "${e}" as ${n} but a child wants to parse the field as ${t}.`}function pP(e){return`Ignoring an invalid transform: ${Zs(e)}.`}const mP='If "from.fields" is not specified, "as" has to be a string that specifies the key to be used for the data from the secondary source.';function gP(e){return`Config.customFormatTypes is not true, thus custom format type and format for channel ${e} are dropped.`}function vP(e){return`Layer's shared ${e.join(",")} channel ${e.length===1?"is":"are"} overriden.`}function yP(e){const{parentProjection:t,projection:n}=e;return`Layer's shared projection ${Zs(t)} is overridden by a child projection ${Zs(n)}.`}const bP="Arc marks uses theta channel rather than angle, replacing angle with theta.";function xP(e,t,n){return`Channel ${e} is a ${t}. Converted to {value: ${Zs(n)}}.`}function wP(e){return`Invalid field type "${e}".`}function kP(e,t){return`Invalid field type "${e}" for aggregate: "${t}", using "quantitative" instead.`}function EP(e){return`Invalid aggregation operator "${e}".`}function CP(e,t){return`Missing type for channel "${e}", using "${t}" instead.`}function OP(e,t){const{fill:n,stroke:r}=t;return`Dropping color ${e} as the plot also has ${n&&r?"fill and stroke":n?"fill":"stroke"}.`}function AP(e,t){return`Dropping ${Zs(e)} from channel "${t}" since it does not contain any data field, datum, value, or signal.`}function SP(e,t,n){return`${e}-encoding with type ${t} is deprecated. Replacing with ${n}-encoding.`}const _P="Line marks cannot encode size with a non-groupby field. You may want to use trail marks instead.";function DP(e,t,n){return`${e} dropped as it is incompatible with "${t}"${n?` when ${n}`:""}.`}function TP(e){return`${e}-encoding is dropped as ${e} is not a valid encoding channel.`}function NP(e){return`${e} encoding should be discrete (ordinal / nominal / binned).`}function FP(e){return`Facet encoding dropped as ${e.join(" and ")} ${e.length>1?"are":"is"} also specified.`}function IP(e,t){return`Using discrete channel "${e}" to encode "${t}" field can be misleading as it does not encode ${t==="ordinal"?"order":"magnitude"}.`}function RP(e,t){return`Line mark is for continuous lines and thus cannot be used with ${e&&t?"x2 and y2":e?"x2":"y2"}. We will use the rule mark (line segments) instead.`}function MP(e,t){return`Specified orient "${e}" overridden with "${t}".`}const jP="Custom domain scale cannot be unioned with default field-based domain.",BP=`Scale's "rangeStep" is deprecated and will be removed in Vega-Lite 5.0. Please use "width"/"height": {"step": ...} instead. See https://vega.github.io/vega-lite/docs/size.html.`;function PP(e){return`Cannot use the scale property "${e}" with non-color channel.`}function LP(e){return`Using unaggregated domain with raw field has no effect (${Zs(e)}).`}function zP(e){return`Unaggregated domain not applicable for "${e}" since it produces values outside the origin domain of the source data.`}function UP(e){return`Unaggregated domain is currently unsupported for log scale (${Zs(e)}).`}function WP(e){return`Cannot apply size to non-oriented mark "${e}".`}function VP(e,t,n){return`Channel "${e}" does not work with "${t}" scale. We are using "${n}" scale instead.`}function qP(e,t){return`FieldDef does not work with "${e}" scale. We are using "${t}" scale instead.`}function HP(e,t,n){return`${n}-scale's "${t}" is dropped as it does not work with ${e} scale.`}function $P(e,t){return`Scale type "${t}" does not work with mark "${e}".`}function GP(e){return`The step for "${e}" is dropped because the ${e==="width"?"x":"y"} is continuous.`}function KP(e,t,n,r){return`Conflicting ${t.toString()} property "${e.toString()}" (${Zs(n)} and ${Zs(r)}). Using ${Zs(n)}.`}function XP(e,t,n,r){return`Conflicting ${t.toString()} property "${e.toString()}" (${Zs(n)} and ${Zs(r)}). Using the union of the two domains.`}function YP(e){return`Setting the scale to be independent for "${e}" means we also have to set the guide (axis or legend) to be independent.`}function JP(e){return`Dropping sort property ${Zs(e)} as unioned domains only support boolean or op "count", "min", and "max".`}const QP="Domains that should be unioned has conflicting sort properties. Sort will be set to true.",ZP="Detected faceted independent scales that union domain of multiple fields from different data sources. We will use the first field. The result view size may be incorrect.",eL="Detected faceted independent scales that union domain of the same fields from different source. We will assume that this is the same field from a different fork of the same data source. However, if this is not the case, the result view size may be incorrect.",tL="Detected faceted independent scales that union domain of multiple fields from the same data source. We will use the first field. The result view size may be incorrect.",nL="Invalid channel for axis.";function rL(e){return`Cannot stack "${e}" if there is already "${e}2".`}function iL(e){return`Cannot stack non-linear scale (${e}).`}function oL(e){return`Stacking is applied even though the aggregate function is non-summative ("${e}").`}function aL(e,t){return`Invalid ${e}: ${Zs(t)}.`}function sL(e){return`Dropping day from datetime ${Zs(e)} as day cannot be combined with other units.`}function uL(e,t){return`${t?"extent ":""}${t&&e?"and ":""}${e?"center ":""}${t&&e?"are ":"is "}not needed when data are aggregated.`}function cL(e,t,n){return`${e} is not usually used with ${t} for ${n}.`}function lL(e,t){return`Continuous axis should not have customized aggregation function ${e}; ${t} already agregates the axis.`}function fL(e,t){return`Center is not needed to be specified in ${t} when extent is ${e}.`}function hL(e){return`1D error band does not support ${e}.`}function dL(e){return`Channel ${e} is required for "binned" bin.`}function pL(e){return`Domain for ${e} is required for threshold scale.`}const CN=function(e,t){var n=e||0;return{level:function(r){return arguments.length?(n=+r,this):n},error:function(){return n>=1&&Ow(t||"error","ERROR",arguments),this},warn:function(){return n>=2&&Ow(t||"warn","WARN",arguments),this},info:function(){return n>=3&&Ow(t||"log","INFO",arguments),this},debug:function(){return n>=4&&Ow(t||"log","DEBUG",arguments),this}}}(2);let qw=CN;function mL(){return qw=CN}function Gr(...e){qw.warn(...e)}function S1(e){if(e&&Uc(e)){for(const t of ZC)if(t in e)return!0}return!1}const ON=["january","february","march","april","may","june","july","august","september","october","november","december"],gL=ON.map(e=>e.substr(0,3)),AN=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],vL=AN.map(e=>e.substr(0,3));function QC(e,t){const n=[];if(t&&e.day!==void 0&&Kr(e).length>1&&(Gr(de.droppedDay(e)),delete(e=Go(e)).day),e.year!==void 0?n.push(e.year):n.push(2012),e.month!==void 0){const r=t?function(i){if(WC(i)&&(i=+i),Ju(i))return i-1;{const s=i.toLowerCase(),f=ON.indexOf(s);if(f!==-1)return f;const m=s.substr(0,3),x=gL.indexOf(m);if(x!==-1)return x;throw new Error(de.invalidTimeUnit("month",i))}}(e.month):e.month;n.push(r)}else if(e.quarter!==void 0){const r=t?function(i){if(WC(i)&&(i=+i),Ju(i))return i>4&&Gr(de.invalidTimeUnit("quarter",i)),i-1;throw new Error(de.invalidTimeUnit("quarter",i))}(e.quarter):e.quarter;n.push(Ju(r)?3*r:r+"*3")}else n.push(0);if(e.date!==void 0)n.push(e.date);else if(e.day!==void 0){const r=t?function(i){if(WC(i)&&(i=+i),Ju(i))return i%7;{const s=i.toLowerCase(),f=AN.indexOf(s);if(f!==-1)return f;const m=s.substr(0,3),x=vL.indexOf(m);if(x!==-1)return x;throw new Error(de.invalidTimeUnit("day",i))}}(e.day):e.day;n.push(Ju(r)?r+1:r+"+1")}else n.push(1);for(const r of["hours","minutes","seconds","milliseconds"]){const i=e[r];n.push(i===void 0?0:i)}return n}function ix(e){const t=QC(e,!0).join(", ");return e.utc?`utc(${t})`:`datetime(${t})`}const SN={year:1,quarter:1,month:1,week:1,day:1,dayofyear:1,date:1,hours:1,minutes:1,seconds:1,milliseconds:1},ZC=Kr(SN);function eO(e){return e.startsWith("utc")}const yL={"year-month":"%b %Y ","year-month-date":"%b %d, %Y "};function tO(e){const t=[];for(const n of ZC)_N(e,n)&&t.push(n);return t}function _N(e,t){const n=e.indexOf(t);return!(n<0)&&!(n>0&&t==="seconds"&&e.charAt(n-1)==="i")&&!(e.length>n+3&&t==="day"&&e.charAt(n+3)==="o")&&!(n>0&&t==="year"&&e.charAt(n-1)==="f")}function bL(e,t,{end:n}={end:!1}){const r=ZT(t),i=eO(e)?"utc":"";function s(x){return x==="quarter"?`(${i}quarter(${r})-1)`:`${i}${x}(${r})`}let f;const m={};for(const x of ZC)_N(e,x)&&(m[x]=s(x),f=x);return n&&(m[f]+="+1"),function(x){const O=QC(x,!1).join(", ");return x.utc?`utc(${O})`:`datetime(${O})`}(m)}function DN(e){if(!e)return;const t=tO(e);return`timeUnitSpecifier(${Kb()(t)}, ${Kb()(yL)})`}function xh(e){if(!e)return;let t;return $o(e)?t={unit:e}:Uc(e)&&(t=Object.assign(Object.assign({},e),e.unit?{unit:e.unit}:{})),eO(t.unit)&&(t.utc=!0,t.unit=function(n){return n.substr(3)}(t.unit)),t}function po(e){return e&&!!e.signal}function Jv(e){return!!e.step}function Qv(e){return!Gi(e)&&"field"in e&&"data"in e}const xL=Kr({aria:1,description:1,ariaRole:1,ariaRoleDescription:1,blend:1,opacity:1,fill:1,fillOpacity:1,stroke:1,strokeCap:1,strokeWidth:1,strokeOpacity:1,strokeDash:1,strokeDashOffset:1,strokeJoin:1,strokeOffset:1,strokeMiterLimit:1,startAngle:1,endAngle:1,padAngle:1,innerRadius:1,outerRadius:1,size:1,shape:1,interpolate:1,tension:1,orient:1,align:1,baseline:1,text:1,dir:1,dx:1,dy:1,ellipsis:1,limit:1,radius:1,theta:1,angle:1,font:1,fontSize:1,fontWeight:1,fontStyle:1,lineBreak:1,lineHeight:1,cursor:1,href:1,tooltip:1,cornerRadius:1,cornerRadiusTopLeft:1,cornerRadiusTopRight:1,cornerRadiusBottomLeft:1,cornerRadiusBottomRight:1,aspect:1,width:1,height:1}),wL={arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1},nO=["cornerRadius","cornerRadiusTopLeft","cornerRadiusTopRight","cornerRadiusBottomLeft","cornerRadiusBottomRight"];function rO(e){return e&&!!e.field&&e.equal!==void 0}function TN(e){return e&&!!e.field&&e.lt!==void 0}function NN(e){return e&&!!e.field&&e.lte!==void 0}function FN(e){return e&&!!e.field&&e.gt!==void 0}function IN(e){return e&&!!e.field&&e.gte!==void 0}function iO(e){return!!(e&&e.field&&(Gi(e.range)&&e.range.length===2||po(e.range)))}function oO(e){return e&&!!e.field&&(Gi(e.oneOf)||Gi(e.in))}function RN(e){return oO(e)||rO(e)||iO(e)||TN(e)||FN(e)||NN(e)||IN(e)}function k0(e,t){return EO(e,{timeUnit:t,wrapTime:!0})}function MN(e,t=!0){var n;const{field:r}=e,i=(n=xh(e.timeUnit))===null||n===void 0?void 0:n.unit,s=i?"time("+bL(i,r)+")":ei(e,{expr:"datum"});if(rO(e))return s+"==="+k0(e.equal,i);if(TN(e))return`${s}<${k0(e.lt,i)}`;if(FN(e))return`${s}>${k0(e.gt,i)}`;if(NN(e))return`${s}<=${k0(e.lte,i)}`;if(IN(e))return`${s}>=${k0(e.gte,i)}`;if(oO(e))return`indexof([${function(f,m){return f.map(x=>k0(x,m))}(e.oneOf,i).join(",")}], ${s}) !== -1`;if(function(f){return f&&!!f.field&&f.valid!==void 0}(e))return aO(s,e.valid);if(iO(e)){const{range:f}=e,m=po(f)?{signal:`${f.signal}[0]`}:f[0],x=po(f)?{signal:`${f.signal}[1]`}:f[1];if(m!==null&&x!==null&&t)return"inrange("+s+", ["+k0(m,i)+", "+k0(x,i)+"])";const O=[];return m!==null&&O.push(`${s} >= ${k0(m,i)}`),x!==null&&O.push(`${s} <= ${k0(x,i)}`),O.length>0?O.join(" && "):"true"}throw new Error(`Invalid field predicate: ${JSON.stringify(e)}`)}function aO(e,t=!0){return t?`isValid(${e}) && isFinite(+${e})`:`!isValid(${e}) || !isFinite(+${e})`}function kL(e){var t;return RN(e)&&e.timeUnit?Object.assign(Object.assign({},e),{timeUnit:(t=xh(e.timeUnit))===null||t===void 0?void 0:t.unit}):e}const _1={quantitative:"quantitative",ordinal:"ordinal",temporal:"temporal",nominal:"nominal",geojson:"geojson"},By=_1.quantitative,sO=_1.ordinal,D1=_1.temporal,uO=_1.nominal,T1=_1.geojson,EL=Kr(_1),Zu={LINEAR:"linear",LOG:"log",POW:"pow",SQRT:"sqrt",SYMLOG:"symlog",IDENTITY:"identity",SEQUENTIAL:"sequential",TIME:"time",UTC:"utc",QUANTILE:"quantile",QUANTIZE:"quantize",THRESHOLD:"threshold",BIN_ORDINAL:"bin-ordinal",ORDINAL:"ordinal",POINT:"point",BAND:"band"},cO={linear:"numeric",log:"numeric",pow:"numeric",sqrt:"numeric",symlog:"numeric",identity:"numeric",sequential:"numeric",time:"time",utc:"time",ordinal:"ordinal","bin-ordinal":"bin-ordinal",point:"ordinal-position",band:"ordinal-position",quantile:"discretizing",quantize:"discretizing",threshold:"discretizing"},CL=Kr(cO);function OL(e,t){const n=cO[e],r=cO[t];return n===r||n==="ordinal-position"&&r==="time"||r==="ordinal-position"&&n==="time"}const AL={linear:0,log:1,pow:1,sqrt:1,symlog:1,identity:1,sequential:1,time:0,utc:0,point:10,band:11,ordinal:0,"bin-ordinal":0,quantile:0,quantize:0,threshold:0};function jN(e){return AL[e]}const BN=["linear","log","pow","sqrt","symlog","time","utc"],SL=Ny(BN),_L=Ny(["linear","log","pow","sqrt","symlog"]),DL=Ny(["quantile","quantize","threshold"]),TL=Ny(BN.concat(["quantile","quantize","threshold","sequential","identity"])),NL=Ny(["ordinal","bin-ordinal","point","band"]);function Ad(e){return e in NL}function vm(e){return e in TL}function fg(e){return e in SL}function Hw(e){return e in DL}function PN(e){return e==null?void 0:e.selection}const FL={type:1,domain:1,domainMid:1,align:1,range:1,scheme:1,bins:1,reverse:1,round:1,clamp:1,nice:1,base:1,exponent:1,constant:1,interpolate:1,zero:1,padding:1,paddingInner:1,paddingOuter:1},IL=Li(FL,["type","domain","range","scheme"]),RL=Kr(IL);(function(){var e;const t={};for(const n of gN)for(const r of EL)for(const i of CL){const s=ML(n,r);WN(n,i)&&UN(i,r)&&(t[s]=(e=t[s])!==null&&e!==void 0?e:[],t[s].push(i))}})();function LN(e,t){switch(t){case"type":case"domain":case"reverse":case"range":return!0;case"scheme":case"interpolate":return!Ji(["point","band","identity"],e);case"bins":return!Ji(["point","band","identity","ordinal"],e);case"round":return fg(e)||e==="band"||e==="point";case"padding":return fg(e)||Ji(["point","band"],e);case"paddingOuter":case"align":return Ji(["point","band"],e);case"paddingInner":return e==="band";case"domainMid":case"clamp":return fg(e);case"nice":return fg(e)||e==="quantize"||e==="threshold";case"exponent":return e==="pow";case"base":return e==="log";case"constant":return e==="symlog";case"zero":return vm(e)&&!Ji(["log","time","utc","threshold","quantile"],e)}}function zN(e,t){switch(t){case"interpolate":case"scheme":case"domainMid":return A1(e)?void 0:de.cannotUseScalePropertyWithNonColor(e);case"align":case"type":case"bins":case"domain":case"range":case"base":case"exponent":case"constant":case"nice":case"padding":case"paddingInner":case"paddingOuter":case"reverse":case"round":case"clamp":case"zero":return}}function UN(e,t){return Ji([sO,uO],t)?e===void 0||Ad(e):t===D1?Ji([Zu.TIME,Zu.UTC,void 0],e):t!==By||Ji([Zu.LOG,Zu.POW,Zu.SQRT,Zu.SYMLOG,Zu.QUANTILE,Zu.QUANTIZE,Zu.THRESHOLD,Zu.LINEAR,void 0],e)}function WN(e,t){if(!Yv(e))return!1;switch(e){case uu:case vc:case cg:case p0:return fg(t)||Ji(["band","point"],t);case sv:case $v:case uv:case qv:case Hv:case Ry:return fg(t)||Hw(t)||Ji(["band","point","ordinal"],t);case Cd:case v0:case y0:return t!=="band";case Gv:return t==="ordinal"||Hw(t);case Od:return t==="ordinal"}}function ML(e,t){return e+"_"+t}function lO(e){const{channel:t,channelDef:n,markDef:r,scale:i,config:s}=e,f=qN(e);return si(n)&&!fN(n.aggregate)&&i&&fg(i.get("type"))&&i.get("zero")===!1?VN({fieldDef:n,channel:t,markDef:r,ref:f,config:s}):f}function VN({fieldDef:e,channel:t,markDef:n,ref:r,config:i}){return Fy(n.type)||qa("invalid",n,i)===null?r:[function(s,f){const m=fO(s,!0),x=jy(f)==="y"?{field:{group:"height"}}:{value:0};return Object.assign({test:m},x)}(e,t),r]}function fO(e,t=!0){return aO($o(e)?e:ei(e,{expr:"datum"}),!t)}function Py(e,t,n,r){const i={};if(t&&(i.scale=t),ey(e)){const{datum:s}=e;S1(s)?i.signal=ix(s):po(s)?i.signal=s.signal:i.value=s}else i.field=ei(e,n);if(r){const{offset:s,band:f}=r;s&&(i.offset=s),f&&(i.band=f)}return i}function $w({scaleName:e,fieldOrDatumDef:t,fieldOrDatumDef2:n,offset:r,startSuffix:i,band:s=.5}){const f=0<s&&s<1?"datum":void 0,m=ei(t,{expr:f,suffix:i}),x=n!==void 0?ei(n,{expr:f}):ei(t,{suffix:"end",expr:f}),O={};if(s===0||s===1){O.scale=e;const T=s===0?m:x;O.field=T}else{const T=`${s} * ${m} + ${1-s} * ${x}`;O.signal=`scale("${e}", ${T})`}return r&&(O.offset=r),O}function qN({channel:e,channelDef:t,channel2Def:n,markDef:r,config:i,scaleName:s,scale:f,stack:m,offset:x,defaultRef:O,band:T}){var M;if(t){if(Oo(t)){if(_p(t)){T=T??sx({channel:e,fieldDef:t,fieldDef2:n,markDef:r,stack:m,config:i,isMidPoint:!0});const{bin:Z,timeUnit:ue,type:fe}=t;if(Ts(Z)||T&&ue&&fe===D1)return m&&m.impute?Py(t,s,{binSuffix:"mid"},{offset:x}):T?$w({scaleName:s,fieldOrDatumDef:t,band:T,offset:x}):Py(t,s,ux(t,e)?{binSuffix:"range"}:{},{offset:x});if(bh(Z)){if(si(n))return $w({scaleName:s,fieldOrDatumDef:t,fieldOrDatumDef2:n,band:T,offset:x});{const Ie=e===uu?ug:d0;Gr(de.channelRequiredForBinned(Ie))}}}const H=f==null?void 0:f.get("type");return Py(t,s,Ad(H)?{binSuffix:"range"}:{},{offset:x,band:H==="band"?(M=T??t.band)!==null&&M!==void 0?M:.5:void 0})}if(cv(t)){const H=t.value,Z=x?{offset:x}:{};return Object.assign(Object.assign({},ox(e,H)),Z)}}return m7(O)&&(O=O()),O&&Object.assign(Object.assign({},O),x?{offset:x}:{})}function ox(e,t){return Ji(["x","x2"],e)&&t==="width"?{field:{group:"width"}}:Ji(["y","y2"],e)&&t==="height"?{field:{group:"height"}}:ju(t)}function Ly(e){return e&&e!=="number"&&e!=="time"}function HN(e,t,n){return`${e}(${t}${n?`, ${JSON.stringify(n)}`:""})`}const jL="  ";function hO({fieldOrDatumDef:e,format:t,formatType:n,expr:r,normalizeStack:i,config:s}){var f,m;if(Ly(n))return dO({fieldOrDatumDef:e,format:t,formatType:n,expr:r,config:s});const x=$N(e,r,i);if(ek(e)){const O=function(T,M,H,Z,ue){return!M||H?(H=$o(H)?H:Z,`${ue?"utc":"time"}Format(${T}, '${H}')`):function(fe,Ie,Pe){if(!fe)return;const Le=DN(fe);return`${Pe||eO(fe)?"utc":"time"}Format(${Ie}, ${Le})`}(M,T,ue)}(x,si(e)?(f=xh(e.timeUnit))===null||f===void 0?void 0:f.unit:void 0,t,s.timeFormat,bO(e)&&((m=e.scale)===null||m===void 0?void 0:m.type)===Zu.UTC);return O?{signal:O}:void 0}return t=XN(Zv(e),t,s),si(e)&&Ts(e.bin)?{signal:Gw(x,ei(e,{expr:r,binSuffix:"end"}),t,n,s)}:t||Zv(e)==="quantitative"?{signal:`${YN(x,t)}`}:{signal:`isValid(${x}) ? ${x} : ""+${x}`}}function $N(e,t,n){return si(e)?n?`${ei(e,{expr:t,suffix:"end"})}-${ei(e,{expr:t,suffix:"start"})}`:ei(e,{expr:t}):function(r){const{datum:i}=r;return S1(i)?ix(i):`${JSON.stringify(i)}`}(e)}function dO({fieldOrDatumDef:e,format:t,formatType:n,expr:r,normalizeStack:i,config:s,field:f}){return f=f??$N(e,r,i),si(e)&&Ts(e.bin)?{signal:Gw(f,ei(e,{expr:r,binSuffix:"end"}),t,n,s)}:{signal:HN(n,f,t)}}function GN(e,t,n,r,i,s){var f;if(!Ly(r))return ek(e)?function(m,x,O,T){return m||(x?{signal:DN(x)}:T?void 0:O.timeFormat)}(n,si(e)?(f=xh(e.timeUnit))===null||f===void 0?void 0:f.unit:void 0,i,s):XN(t,n,i)}function KN(e,t,n){return e&&(po(e)||e==="number"||e==="time")?e:ek(t)&&n!=="time"&&n!=="utc"?"time":void 0}function XN(e,t,n){return $o(t)?t:e===By?n.numberFormat:void 0}function YN(e,t){return`format(${e}, "${t||""}")`}function JN(e,t,n,r){var i;return Ly(n)?HN(n,e,t):YN(e,(i=$o(t)?t:void 0)!==null&&i!==void 0?i:r.numberFormat)}function Gw(e,t,n,r,i){const s=JN(e,n,r,i),f=JN(t,n,r,i);return`${aO(e,!1)} ? "null" : ${s} + "${jL}" + ${f}`}const Kw="min",BL={x:1,y:1,color:1,fill:1,stroke:1,strokeWidth:1,size:1,shape:1,fillOpacity:1,strokeOpacity:1,opacity:1,text:1};function QN(e){return e in BL}function ZN(e){return!!e&&!!e.encoding}function E0(e){return!(!e||e.op!=="count"&&!e.field)}function eF(e){return!!e&&Gi(e)}function ax(e){return"row"in e||"column"in e}function pO(e){return!!e&&"header"in e}function Xw(e){return"facet"in e}function tF(e){const{field:t,timeUnit:n,bin:r,aggregate:i}=e;return Object.assign(Object.assign(Object.assign(Object.assign({},n?{timeUnit:n}:{}),r?{bin:r}:{}),i?{aggregate:i}:{}),{field:t})}function nF(e){return _p(e)&&"sort"in e}function sx({channel:e,fieldDef:t,fieldDef2:n,markDef:r,stack:i,config:s,isMidPoint:f}){if(Oo(t)&&t.band!==void 0)return t.band;if(si(t)){const{timeUnit:m,bin:x}=t;if(m&&!n)return f?Wy("timeUnitBandPosition",r,s):uN(r.type)?Wy("timeUnitBand",r,s):0;if(Ts(x))return uN(r.type)&&!f?1:.5}return(i==null?void 0:i.fieldChannel)===e&&f?.5:void 0}function mO(e,t,n,r,i,s){return!!(Ts(t.bin)||t.timeUnit&&_p(t)&&t.type==="temporal")&&!!sx({channel:e,fieldDef:t,fieldDef2:n,stack:r,markDef:i,config:s})}function gO(e){return!!e&&"condition"in e}function Yw(e){const t=e&&e.condition;return!!t&&!Gi(t)&&si(t)}function vO(e){const t=e&&e.condition;return!!t&&!Gi(t)&&Oo(t)}function si(e){return!(!e||!e.field&&e.aggregate!=="count")}function Zv(e){return e&&e.type}function ey(e){return!!e&&"datum"in e}function C0(e){return _p(e)&&aF(e)||yO(e)}function yO(e){return ey(e)&&Ju(e.datum)}function Oo(e){return si(e)||ey(e)}function _p(e){return!!e&&("field"in e&&"type"in e||e.aggregate==="count")}function cv(e){return e&&"value"in e&&"value"in e}function bO(e){return!!e&&("scale"in e||"sort"in e)}function xO(e){return e&&("axis"in e||"stack"in e||"impute"in e)}function rF(e){return!!e&&"legend"in e}function iF(e){return!!e&&("format"in e||"formatType"in e)}function ei(e,t={}){var n,r,i;let s=e.field;const f=t.prefix;let m=t.suffix,x="";if(function(O){return O.aggregate==="count"}(e))s=function(O){return function(T){return T.indexOf("__")===0}(O)?O:`__${O}`}("count");else{let O;if(!t.nofn)if(function(T){return"op"in T}(e))O=e.op;else{const{bin:T,aggregate:M,timeUnit:H}=e;Ts(T)?(O=kN(T),m=((n=t.binSuffix)!==null&&n!==void 0?n:"")+((r=t.suffix)!==null&&r!==void 0?r:"")):M?Iy(M)?(x=`["${s}"]`,s=`argmax_${M.argmax}`):Vv(M)?(x=`["${s}"]`,s=`argmin_${M.argmin}`):O=String(M):H&&(O=function(Z){const ue=xh(Z),{utc:fe}=ue,Ie=Li(ue,["utc"]);return Ie.unit?(fe?"utc":"")+Kr(Ie).map(Pe=>eu(`${Pe==="unit"?"":`_${Pe}_`}${Ie[Pe]}`)).join(""):(fe?"utc":"")+"timeunit"+Kr(Ie).map(Pe=>eu(`_${Pe}_${Ie[Pe]}`)).join("")}(H),m=(!Ji(["range","mid"],t.binSuffix)&&t.binSuffix||"")+((i=t.suffix)!==null&&i!==void 0?i:""))}O&&(s=s?`${O}_${s}`:O)}return m&&(s=`${s}_${m}`),f&&(s=`${f}_${s}`),t.forAs?eN(s):t.expr?function(O,T="datum"){return`${T}[${ga(Dy(O).join("."))}]`}(s,t.expr)+x:Wv(s)+x}function oF(e){switch(e.type){case"nominal":case"ordinal":case"geojson":return!0;case"quantitative":return si(e)&&!!e.bin;case"temporal":return!1}throw new Error(de.invalidFieldType(e.type))}function aF(e){return!oF(e)}const sF=(e,t)=>{switch(t.fieldTitle){case"plain":return e.field;case"functional":return function(n){const{aggregate:r,bin:i,timeUnit:s,field:f}=n;if(Iy(r))return`${f} for argmax(${r.argmax})`;if(Vv(r))return`${f} for argmin(${r.argmin})`;const m=xh(s),x=r||(m==null?void 0:m.unit)||(m==null?void 0:m.maxbins)&&"timeunit"||Ts(i)&&"bin";return x?x.toUpperCase()+"("+f+")":f}(e);default:return function(n,r){var i;const{field:s,bin:f,timeUnit:m,aggregate:x}=n;if(x==="count")return r.countTitle;if(Ts(f))return`${s} (binned)`;if(m){const O=(i=xh(m))===null||i===void 0?void 0:i.unit;if(O)return`${s} (${tO(O).join("-")})`}else if(x)return Iy(x)?`${s} for max ${x.argmax}`:Vv(x)?`${s} for min ${x.argmin}`:`${Sw(x)} of ${s}`;return s}(e,t)}};let uF=sF;function cF(e){uF=e}function zy(e,t,{allowDisabling:n,includeDefault:r=!0}){var i,s;const f=((i=wO(e))!==null&&i!==void 0?i:{}).title;if(!si(e))return f;const m=e,x=r?lF(m,t):void 0;return n?Qu(f,m.title,x):(s=f??m.title)!==null&&s!==void 0?s:x}function wO(e){return xO(e)&&e.axis?e.axis:rF(e)&&e.legend?e.legend:pO(e)&&e.header?e.header:void 0}function lF(e,t){return uF(e,t)}function Jw(e){var t;if(iF(e)){const{format:n,formatType:r}=e;return{format:n,formatType:r}}{const n=(t=wO(e))!==null&&t!==void 0?t:{},{format:r,formatType:i}=n;return{format:r,formatType:i}}}function O0(e){return si(e)?e:Yw(e)?e.condition:void 0}function yc(e){return Oo(e)?e:vO(e)?e.condition:void 0}function kO(e,t,n){if($o(e)||Ju(e)||Gb(e)){const r=$o(e)?"string":Ju(e)?"number":"boolean";return Gr(de.primitiveChannelDef(t,r,e)),{value:e}}return Oo(e)?Qw(e,t,n):vO(e)?Object.assign(Object.assign({},e),{condition:Qw(e.condition,t,n)}):e}function Qw(e,t,n){if(iF(e)){const{format:r,formatType:i}=e,s=Li(e,["format","formatType"]);if(Ly(i)&&!n.customFormatTypes)return Gr(de.customFormatTypeNotAllowed(t)),Qw(s,t,n)}else{const r=xO(e)?"axis":rF(e)?"legend":pO(e)?"header":null;if(r&&e[r]){const i=e[r],{format:s,formatType:f}=i,m=Li(i,["format","formatType"]);if(Ly(f)&&!n.customFormatTypes)return Gr(de.customFormatTypeNotAllowed(t)),Qw(Object.assign(Object.assign({},e),{[r]:m}),t,n)}}return si(e)?fF(e,t):function(r){let i=r.type;if(i)return r;const{datum:s}=r;return i=Ju(s)?"quantitative":$o(s)?"nominal":S1(s)?"temporal":void 0,Object.assign(Object.assign({},r),{type:i})}(e)}function fF(e,t){const{aggregate:n,timeUnit:r,bin:i,field:s}=e,f=Object.assign({},e);if(!n||GC(n)||Iy(n)||Vv(n)||(Gr(de.invalidAggregate(n)),delete f.aggregate),r&&(f.timeUnit=xh(r)),s&&(f.field=`${s}`),Ts(i)&&(f.bin=Zw(i,t)),bh(i)&&!w0(t)&&Gr(`Channel ${t} should not be used with "binned" bin.`),_p(f)){const{type:m}=f,x=function(O){if(O)switch(O=O.toLowerCase()){case"q":case By:return"quantitative";case"t":case D1:return"temporal";case"o":case sO:return"ordinal";case"n":case uO:return"nominal";case T1:return"geojson"}}(m);m!==x&&(f.type=x),m!=="quantitative"&&fN(n)&&(Gr(de.invalidFieldTypeForCountAggregate(m,n)),f.type="quantitative")}else if(!yN(t)){const m=function(x,O){if(x.timeUnit)return"temporal";if(Ts(x.bin))return"quantitative";switch(Ww(O)){case"continuous":return"quantitative";case"discrete":case"flexible":return"nominal";default:return"quantitative"}}(f,t);Gr(de.missingFieldType(t,m)),f.type=m}if(_p(f)){const{compatible:m,warning:x}=function(O,T){const M=O.type;if(M==="geojson"&&T!=="shape")return{compatible:!1,warning:`Channel ${T} should not be used with a geojson data.`};switch(T){case rv:case iv:case Mw:return aF(O)?{compatible:!1,warning:de.facetChannelShouldBeDiscrete(T)}:Uy;case uu:case vc:case Cd:case v0:case y0:case ex:case nx:case jw:case My:case Bw:case Pw:case Ry:case cg:case p0:case Lw:return Uy;case g0:case pm:case m0:case lg:return M!==By?{compatible:!1,warning:`Channel ${T} should be used with a quantitative field only, not ${O.type} field.`}:Uy;case uv:case qv:case Hv:case $v:case sv:case av:case ov:case ug:case d0:return M!=="nominal"||O.sort?Uy:{compatible:!1,warning:`Channel ${T} should not be used with an unsorted discrete field.`};case Gv:return Ji(["ordinal","nominal"],O.type)?Uy:{compatible:!1,warning:"StrokeDash channel should be used with only discrete data."};case Od:return Ji(["ordinal","nominal","geojson"],O.type)?Uy:{compatible:!1,warning:"Shape channel should be used with only either discrete or geojson data."};case tx:return O.type!=="nominal"||"sort"in O?Uy:{compatible:!1,warning:"Channel order is inappropriate for nominal field, which has no inherent order."}}}(f,t);m||Gr(x)}if(nF(f)&&$o(f.sort)){const{sort:m}=f;if(QN(m))return Object.assign(Object.assign({},f),{sort:{encoding:m}});const x=m.substr(1);if(m.charAt(0)==="-"&&QN(x))return Object.assign(Object.assign({},f),{sort:{encoding:x,order:"descending"}})}if(pO(f)){const{header:m}=f,{orient:x}=m,O=Li(m,["orient"]);if(x)return Object.assign(Object.assign({},f),{header:Object.assign(Object.assign({},O),{labelOrient:m.labelOrient||x,titleOrient:m.titleOrient||x})})}return f}function Zw(e,t){return Gb(e)?{maxbins:EN(t)}:e==="binned"?{binned:!0}:e.maxbins||e.step?e:Object.assign(Object.assign({},e),{maxbins:EN(t)})}const Uy={compatible:!0};function ek(e){const{formatType:t}=Jw(e);return t==="time"||!t&&function(n){return n&&(n.type==="temporal"||si(n)&&!!n.timeUnit)}(e)}function EO(e,{timeUnit:t,type:n,wrapTime:r,undefinedIfExprNotRequired:i}){var s;const f=t&&((s=xh(t))===null||s===void 0?void 0:s.unit);let m,x=f||n==="temporal";return po(e)?m=e.signal:S1(e)?(x=!0,m=ix(e)):($o(e)||Ju(e))&&x&&(m=`datetime(${JSON.stringify(e)})`,function(O){return!!SN[O]}(f)&&(Ju(e)&&e<1e4||$o(e)&&isNaN(Date.parse(e)))&&(m=ix({[f]:e}))),m?r&&x?`time(${m})`:m:i?void 0:JSON.stringify(e)}function hF(e,t){const{type:n}=e;return t.map(r=>{const i=EO(r,{timeUnit:si(e)?e.timeUnit:void 0,type:n,undefinedIfExprNotRequired:!0});return i!==void 0?{signal:i}:r})}function ux(e,t){return Ts(e.bin)?Yv(t)&&Ji(["ordinal","nominal"],e.type):(console.warn("Only call this method for binned field defs."),!1)}function dF(e){const{anchor:t,frame:n,offset:r,orient:i,color:s,subtitleColor:f,subtitleFont:m,subtitleFontSize:x,subtitleFontStyle:O,subtitleFontWeight:T,subtitleLineHeight:M,subtitlePadding:H}=e,Z=Li(e,["anchor","frame","offset","orient","color","subtitleColor","subtitleFont","subtitleFontSize","subtitleFontStyle","subtitleFontWeight","subtitleLineHeight","subtitlePadding"]),ue=Object.assign(Object.assign({},Z),s?{fill:s}:{}),fe=Object.assign(Object.assign(Object.assign(Object.assign({},t?{anchor:t}:{}),n?{frame:n}:{}),r?{offset:r}:{}),i?{orient:i}:{}),Ie=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},f?{subtitleColor:f}:{}),m?{subtitleFont:m}:{}),x?{subtitleFontSize:x}:{}),O?{subtitleFontStyle:O}:{}),T?{subtitleFontWeight:T}:{}),M?{subtitleLineHeight:M}:{}),H?{subtitlePadding:H}:{});return{titleMarkConfig:ue,subtitleMarkConfig:Yb(ue,["align","baseline","dx","dy","limit"]),nonMark:fe,subtitle:Ie}}function ty(e){return $o(e)||Gi(e)&&$o(e[0])}function ju(e){return po(e)?e:e!==void 0?{value:e}:void 0}function pF(e){return po(e)?e.signal:ga(e.value)}function cx(e){return po(e)?e.signal:e==null?null:ga(e)}function mF(e){var t;return[].concat(e.type,(t=e.style)!==null&&t!==void 0?t:[])}function qa(e,t,n,r={}){const{vgChannel:i,ignoreVgConfig:s}=r;return i&&t[i]!==void 0?t[i]:t[e]!==void 0?t[e]:!s||i&&i!==e?Wy(e,t,n,r):void 0}function Wy(e,t,n,{vgChannel:r}={}){return Qu(r?tk(e,t,n.style):void 0,tk(e,t,n.style),r?n[t.type][r]:void 0,n[t.type][e],r?n.mark[r]:n.mark[e])}function tk(e,t,n){return gF(e,mF(t),n)}function gF(e,t,n){let r;t=Mu(t);for(const i of t){const s=n[i];s&&s[e]!==void 0&&(r=s[e])}return r}function vF(e,t){return Mu(e).reduce((n,r)=>{var i;return n.field.push(ei(r,t)),n.order.push((i=r.sort)!==null&&i!==void 0?i:"ascending"),n},{field:[],order:[]})}function yF(e,t){const n=[...e];return t.forEach(r=>{for(const i of n)if(Xb(i,r))return;n.push(r)}),n}function bF(e,t){return Xb(e,t)||!t?e:e?[...Mu(e),...Mu(t)].join(", "):t}function xF(e,t){const n=e.value,r=t.value;if(n==null||r===null)return{explicit:e.explicit,value:null};if((ty(n)||po(n))&&(ty(r)||po(r)))return{explicit:e.explicit,value:bF(n,r)};if(ty(n)||po(n))return{explicit:e.explicit,value:n};if(ty(r)||po(r))return{explicit:e.explicit,value:r};if(!(ty(n)||po(n)||ty(r)||po(r)))return{explicit:e.explicit,value:yF(n,r)};throw new Error("It should never reach here")}function Vy(e,t){const n=e&&e[t];return!!n&&(Gi(n)?Jb(n,r=>!!r.field):si(n)||Yw(n))}function CO(e){return Jb(gN,t=>{if(Vy(e,t)){const n=e[t];if(Gi(n))return Jb(n,r=>!!r.aggregate);{const r=O0(n);return r&&!!r.aggregate}}return!1})}function OO(e,t){const n=[],r=[],i=[],s=[],f={};return AO(e,(m,x)=>{if(si(m)){const{field:O,aggregate:T,bin:M,timeUnit:H}=m,Z=Li(m,["field","aggregate","bin","timeUnit"]);if(T||H||M){const ue=wO(m),fe=ue&&ue.title;let Ie=ei(m,{forAs:!0});const Pe=Object.assign(Object.assign(Object.assign({},fe?[]:{title:zy(m,t,{allowDisabling:!0})}),Z),{field:Ie});if(T){let Le;if(Iy(T)?(Le="argmax",Ie=ei({op:"argmax",field:T.argmax},{forAs:!0}),Pe.field=`${Ie}.${O}`):Vv(T)?(Le="argmin",Ie=ei({op:"argmin",field:T.argmin},{forAs:!0}),Pe.field=`${Ie}.${O}`):T!=="boxplot"&&T!=="errorbar"&&T!=="errorband"&&(Le=T),Le){const rt={op:Le,as:Ie};O&&(rt.field=O),s.push(rt)}}else if(n.push(Ie),_p(m)&&Ts(M)){if(r.push({bin:M,field:O,as:Ie}),n.push(ei(m,{binSuffix:"end"})),ux(m,x)&&n.push(ei(m,{binSuffix:"range"})),w0(x)){const Le={field:Ie+"_end"};f[x+"2"]=Le}Pe.bin="binned",yN(x)||(Pe.type=By)}else if(H){i.push({timeUnit:H,field:O,as:Ie});const Le=_p(m)&&m.type!==D1&&"time";Le&&(x===ex||x===My?Pe.formatType=Le:function(rt){return!!YC[rt]}(x)?Pe.legend=Object.assign({formatType:Le},Pe.legend):w0(x)&&(Pe.axis=Object.assign({formatType:Le},Pe.axis)))}f[x]=Pe}else n.push(O),f[x]=e[x]}else f[x]=e[x]}),{bins:r,timeUnits:i,aggregate:s,groupby:n,encoding:f}}function PL(e,t,n){const r=t.type;return Kr(e).reduce((i,s)=>{if(!vN(s))return Gr(de.invalidEncodingChannel(s)),i;const f=e[s];if(s!=="angle"||r!=="arc"||e.theta||(Gr(de.REPLACE_ANGLE_WITH_THETA),s=cg),!function(m,x,O){const T=K7(x,O);if(!T)return!1;if(T==="binned"){const M=m[x===ug?uu:vc];return!!(si(M)&&si(m[x])&&bh(M.bin))}return!0}(e,s,r))return Gr(de.incompatibleChannel(s,r)),i;if(s===sv&&r==="line"){const m=O0(e[s]);if(m!=null&&m.aggregate)return Gr(de.LINE_WITH_VARYING_SIZE),i}if(s===Cd&&(t.filled?"fill"in e:"stroke"in e))return Gr(de.droppingColor("encoding",{fill:"fill"in e,stroke:"stroke"in e})),i;if(s===nx||s===tx&&!Gi(f)&&!cv(f)||s===My&&Gi(f))f&&(i[s]=Mu(f).reduce((m,x)=>(si(x)?m.push(fF(x,s)):Gr(de.emptyFieldDef(x,s)),m),[]));else{if(s===My&&f===null)i[s]=null;else if(!(si(f)||ey(f)||cv(f)||gO(f)||po(f)))return Gr(de.emptyFieldDef(f,s)),i;i[s]=kO(f,s,n)}return i},{})}function AO(e,t,n){if(e)for(const r of Kr(e)){const i=e[r];if(Gi(i))for(const s of i)t.call(n,s,r);else t.call(n,i,r)}}function wF(e,t,n,r){return e?Kr(e).reduce((i,s)=>{const f=e[s];return Gi(f)?f.reduce((m,x)=>t.call(r,m,x,s),i):t.call(r,i,f,s)},n):n}function kF(e,t){return Kr(t).reduce((n,r)=>{switch(r){case uu:case vc:case Bw:case Lw:case Pw:case ug:case d0:case cg:case av:case p0:case ov:case m0:case g0:case lg:case pm:case ex:case Od:case Ry:case My:return n;case tx:if(e==="line"||e==="trail")return n;case nx:case jw:{const i=t[r];if(Gi(i)||si(i))for(const s of Mu(i))s.aggregate||n.push(ei(s,{}));return n}case sv:if(e==="trail")return n;case Cd:case v0:case y0:case uv:case qv:case Hv:case Gv:case $v:{const i=O0(t[r]);return i&&!i.aggregate&&n.push(ei(i,{})),n}}},[])}function SO(e,t,n,r=!0){return"tooltip"in n?{tooltip:n.tooltip}:{tooltip:[...e.map(({fieldPrefix:i,titlePrefix:s})=>{const f=r?` of ${t.field}`:"";return{field:i+t.field,type:t.type,title:po(s)?{signal:s+`"${escape(f)}"`}:s+f}}),...function(i){const s=[];for(const f of Kr(i))if(Vy(i,f)){const m=i[f],x=Mu(m);for(const O of x)si(O)?s.push(O):Yw(O)&&s.push(O.condition)}return s}(n)]}}function EF(e){const{axis:t,title:n,field:r}=e;return t&&t.title!==void 0?void 0:Qu(n,r)}function _O(e,t,n,r,i){const{scale:s,axis:f}=n;return({partName:m,mark:x,positionPrefix:O,endPositionPrefix:T,aria:M,extraEncoding:H={}})=>{const Z=EF(n);return CF(e,m,i,M,{mark:x,encoding:Object.assign(Object.assign(Object.assign({[t]:Object.assign(Object.assign(Object.assign({field:O+"_"+n.field,type:n.type},Z!==void 0?{title:Z}:{}),s!==void 0?{scale:s}:{}),f!==void 0?{axis:f}:{})},$o(T)?{[t+"2"]:{field:T+"_"+n.field}}:{}),r),H)})}}function CF(e,t,n,r,i){const{clip:s,color:f,opacity:m}=e,x=e.type;return e[t]||e[t]===void 0&&n[t]?[Object.assign(Object.assign({},i),{mark:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},n[t]),s?{clip:s}:{}),f?{color:f}:{}),m?{opacity:m}:{}),h0(i.mark)?i.mark:{type:i.mark}),{style:`${x}-${t}`}),Gb(e[t])?{}:e[t]),r===!1?{aria:r}:{})})]:[]}function OF(e,t,n){const{encoding:r}=e,i=t==="vertical"?"y":"x",s=r[i],f=r[i+"2"],m=r[i+"Error"],x=r[i+"Error2"];return{continuousAxisChannelDef:nk(s,n),continuousAxisChannelDef2:nk(f,n),continuousAxisChannelDefError:nk(m,n),continuousAxisChannelDefError2:nk(x,n),continuousAxis:i}}function nk(e,t){if(e&&e.aggregate){const{aggregate:n}=e,r=Li(e,["aggregate"]);return n!==t&&Gr(de.errorBarContinuousAxisHasCustomizedAggregate(n,t)),r}return e}function AF(e,t){const{mark:n,encoding:r}=e,{x:i,y:s}=r;if(C0(i)){if(C0(s)){const f=si(i)&&i.aggregate,m=si(s)&&s.aggregate;if(f||m!==t){if(m||f!==t){if(f===t&&m===t)throw new Error("Both x and y cannot have aggregate");return h0(n)&&n.orient?n.orient:"vertical"}return"horizontal"}return"vertical"}return"horizontal"}if(C0(s))return"vertical";throw new Error("Need a valid continuous axis for "+t+"s")}const rk="boxplot",LL=new Rw(rk,_F);function SF(e){return Ju(e)?"tukey":e}function _F(e,{config:t}){var n,r;const{mark:i,encoding:s,selection:f,projection:m}=e,x=Li(e,["mark","encoding","selection","projection"]),O=h0(i)?i:{type:i};f&&Gr(de.selectionNotSupported("boxplot"));const T=(n=O.extent)!==null&&n!==void 0?n:t.boxplot.extent,M=qa("size",O,t),H=SF(T),{transform:Z,continuousAxisChannelDef:ue,continuousAxis:fe,groupby:Ie,aggregate:Pe,encodingWithoutContinuousAxis:Le,ticksOrient:rt,boxOrient:it,customTooltipWithoutAggregatedField:ut}=function(Cr,Jr,gi){const vi=AF(Cr,rk),{continuousAxisChannelDef:zi,continuousAxis:wi}=OF(Cr,vi,rk),yi=zi.field,_i=SF(Jr),vo=[...DF(yi),{op:"median",field:yi,as:"mid_box_"+yi},{op:"min",field:yi,as:(_i==="min-max"?"lower_whisker_":"min_")+yi},{op:"max",field:yi,as:(_i==="min-max"?"upper_whisker_":"max_")+yi}],na=_i==="min-max"||_i==="tukey"?[]:[{calculate:`datum["upper_box_${yi}"] - datum["lower_box_${yi}"]`,as:"iqr_"+yi},{calculate:`min(datum["upper_box_${yi}"] + datum["iqr_${yi}"] * ${Jr}, datum["max_${yi}"])`,as:"upper_whisker_"+yi},{calculate:`max(datum["lower_box_${yi}"] - datum["iqr_${yi}"] * ${Jr}, datum["min_${yi}"])`,as:"lower_whisker_"+yi}],Ui=Cr.encoding,va=wi,ya=(Ui[va],Li(Ui,[typeof va=="symbol"?va:va+""])),{customTooltipWithoutAggregatedField:Ha,filteredEncoding:Ns}=function(q1){const{tooltip:yv}=q1,H1=Li(q1,["tooltip"]);if(!yv)return{filteredEncoding:q1};let cy,kh;if(Gi(yv)){for(const MA of yv)MA.aggregate?(cy||(cy=[]),cy.push(MA)):(kh||(kh=[]),kh.push(MA));cy&&(H1.tooltip=cy)}else yv.aggregate?H1.tooltip=yv:kh=yv;return Gi(kh)&&kh.length===1&&(kh=kh[0]),{customTooltipWithoutAggregatedField:kh,filteredEncoding:H1}}(ya),{bins:Fs,timeUnits:gs,aggregate:kl,groupby:Vk,encoding:RA}=OO(Ns,gi);return{transform:[...Fs,...gs,{aggregate:[...kl,...vo],groupby:Vk},...na],groupby:Vk,aggregate:kl,continuousAxisChannelDef:zi,continuousAxis:wi,encodingWithoutContinuousAxis:RA,ticksOrient:vi==="vertical"?"horizontal":"vertical",boxOrient:vi,customTooltipWithoutAggregatedField:Ha}}(e,T,t),{color:st,size:mt}=Le,dt=Li(Le,["color","size"]),en=Cr=>_O(O,fe,ue,Cr,t.boxplot),mn=en(dt),sn=en(Le),In=en(Object.assign(Object.assign({},dt),mt?{size:mt}:{})),Fn=SO([{fieldPrefix:H==="min-max"?"upper_whisker_":"max_",titlePrefix:"Max"},{fieldPrefix:"upper_box_",titlePrefix:"Q3"},{fieldPrefix:"mid_box_",titlePrefix:"Median"},{fieldPrefix:"lower_box_",titlePrefix:"Q1"},{fieldPrefix:H==="min-max"?"lower_whisker_":"min_",titlePrefix:"Min"}],ue,Le),zn={type:"tick",color:"black",opacity:1,orient:rt,invalid:null},Vn=H==="min-max"?Fn:SO([{fieldPrefix:"upper_whisker_",titlePrefix:"Upper Whisker"},{fieldPrefix:"lower_whisker_",titlePrefix:"Lower Whisker"}],ue,Le),Qn=[...mn({partName:"rule",mark:{type:"rule",invalid:null},positionPrefix:"lower_whisker",endPositionPrefix:"lower_box",aria:!1,extraEncoding:Vn}),...mn({partName:"rule",mark:{type:"rule",invalid:null},positionPrefix:"upper_box",endPositionPrefix:"upper_whisker",aria:!1,extraEncoding:Vn}),...mn({partName:"ticks",mark:zn,positionPrefix:"lower_whisker",aria:!1,extraEncoding:Vn}),...mn({partName:"ticks",mark:zn,positionPrefix:"upper_whisker",aria:!1,extraEncoding:Vn})],mr=[...H!=="tukey"?Qn:[],...sn({partName:"box",mark:Object.assign(Object.assign({type:"bar"},M?{size:M}:{}),{orient:it,invalid:null}),positionPrefix:"lower_box",endPositionPrefix:"upper_box",aria:!1,extraEncoding:Fn}),...In({partName:"median",mark:Object.assign(Object.assign(Object.assign({type:"tick",invalid:null},Uc(t.boxplot.median)&&t.boxplot.median.color?{color:t.boxplot.median.color}:{}),M?{size:M}:{}),{orient:rt,ariaRoleDescription:"box"}),positionPrefix:"mid_box",extraEncoding:Fn})];let Pr;if(H!=="min-max"){const Cr=`datum["lower_box_${ue.field}"]`,Jr=`datum["upper_box_${ue.field}"]`,gi=`(${Jr} - ${Cr})`,vi=`${Cr} - ${T} * ${gi}`,zi=`${Jr} + ${T} * ${gi}`,wi=`datum["${ue.field}"]`,yi={joinaggregate:DF(ue.field),groupby:Ie};let _i;H==="tukey"&&(_i={transform:[{filter:`(${vi} <= ${wi}) && (${wi} <= ${zi})`},{aggregate:[{op:"min",field:ue.field,as:"lower_whisker_"+ue.field},{op:"max",field:ue.field,as:"upper_whisker_"+ue.field},{op:"min",field:"lower_box_"+ue.field,as:"lower_box_"+ue.field},{op:"max",field:"upper_box_"+ue.field,as:"upper_box_"+ue.field},...Pe],groupby:Ie}],layer:Qn});const vo=Li(dt,["tooltip"]),{scale:na,axis:Ui}=ue,va=EF(ue),ya=CF(O,"outliers",t.boxplot,!0,{transform:[{filter:`(${wi} < ${vi}) || (${wi} > ${zi})`}],mark:"point",encoding:Object.assign(Object.assign({[fe]:Object.assign(Object.assign(Object.assign({field:ue.field,type:ue.type},va!==void 0?{title:va}:{}),na!==void 0?{scale:na}:{}),Ui!==void 0?{axis:Ui}:{})},vo),ut?{tooltip:ut}:{})})[0];ya&&_i?Pr={transform:[yi],layer:[ya,_i]}:ya?(Pr=ya).transform.unshift(yi):_i&&(Pr=_i).transform.unshift(yi)}return Pr?Object.assign(Object.assign({},x),{layer:[Pr,{transform:Z,layer:mr}]}):Object.assign(Object.assign({},x),{transform:((r=x.transform)!==null&&r!==void 0?r:[]).concat(Z),layer:mr})}function DF(e){return[{op:"q1",field:e,as:"lower_box_"+e},{op:"q3",field:e,as:"upper_box_"+e}]}const DO="errorbar",zL=new Rw(DO,TF);function TF(e,{config:t}){const{transform:n,continuousAxisChannelDef:r,continuousAxis:i,encodingWithoutContinuousAxis:s,ticksOrient:f,markDef:m,outerSpec:x,tooltipEncoding:O}=NF(e,DO,t),T=_O(m,i,r,s,t.errorbar),M={type:"tick",orient:f},H=[...T({partName:"ticks",mark:M,positionPrefix:"lower",aria:!1,extraEncoding:O}),...T({partName:"ticks",mark:M,positionPrefix:"upper",aria:!1,extraEncoding:O}),...T({partName:"rule",mark:{type:"rule",ariaRoleDescription:"errorbar"},positionPrefix:"lower",endPositionPrefix:"upper",extraEncoding:O})];return Object.assign(Object.assign(Object.assign({},x),{transform:n}),H.length>1?{layer:H}:Object.assign({},H[0]))}function UL(e,t){const{encoding:n}=e;if(function(m){return(Oo(m.x)||Oo(m.y))&&!Oo(m.x2)&&!Oo(m.y2)&&!Oo(m.xError)&&!Oo(m.xError2)&&!Oo(m.yError)&&!Oo(m.yError2)}(n))return{orient:AF(e,t),inputType:"raw"};const r=function(m){return Oo(m.x2)||Oo(m.y2)}(n),i=function(m){return Oo(m.xError)||Oo(m.xError2)||Oo(m.yError)||Oo(m.yError2)}(n),s=n.x,f=n.y;if(r){if(i)throw new Error(`${t} cannot be both type aggregated-upper-lower and aggregated-error`);const m=n.x2,x=n.y2;if(Oo(m)&&Oo(x))throw new Error(`${t} cannot have both x2 and y2`);if(Oo(m)){if(C0(s))return{orient:"horizontal",inputType:"aggregated-upper-lower"};throw new Error(`Both x and x2 have to be quantitative in ${t}`)}if(Oo(x)){if(C0(f))return{orient:"vertical",inputType:"aggregated-upper-lower"};throw new Error(`Both y and y2 have to be quantitative in ${t}`)}throw new Error("No ranged axis")}{const m=n.xError,x=n.xError2,O=n.yError,T=n.yError2;if(Oo(x)&&!Oo(m))throw new Error(`${t} cannot have xError2 without xError`);if(Oo(T)&&!Oo(O))throw new Error(`${t} cannot have yError2 without yError`);if(Oo(m)&&Oo(O))throw new Error(`${t} cannot have both xError and yError with both are quantiative`);if(Oo(m)){if(C0(s))return{orient:"horizontal",inputType:"aggregated-error"};throw new Error("All x, xError, and xError2 (if exist) have to be quantitative")}if(Oo(O)){if(C0(f))return{orient:"vertical",inputType:"aggregated-error"};throw new Error("All y, yError, and yError2 (if exist) have to be quantitative")}throw new Error("No ranged axis")}}function NF(e,t,n){var r;const{mark:i,encoding:s,selection:f,projection:m}=e,x=Li(e,["mark","encoding","selection","projection"]),O=h0(i)?i:{type:i};f&&Gr(de.selectionNotSupported(t));const{orient:T,inputType:M}=UL(e,t),{continuousAxisChannelDef:H,continuousAxisChannelDef2:Z,continuousAxisChannelDefError:ue,continuousAxisChannelDefError2:fe,continuousAxis:Ie}=OF(e,T,t),{errorBarSpecificAggregate:Pe,postAggregateCalculates:Le,tooltipSummary:rt,tooltipTitleWithFieldName:it}=function(Cr,Jr,gi,vi,zi,wi,yi,_i){let vo=[],na=[];const Ui=Jr.field;let va,ya=!1;if(wi==="raw"){const Ha=Cr.center?Cr.center:Cr.extent?Cr.extent==="iqr"?"median":"mean":_i.errorbar.center,Ns=Cr.extent?Cr.extent:Ha==="mean"?"stderr":"iqr";if(Ha==="median"!=(Ns==="iqr")&&Gr(de.errorBarCenterIsUsedWithWrongExtent(Ha,Ns,yi)),Ns==="stderr"||Ns==="stdev")vo=[{op:Ns,field:Ui,as:"extent_"+Ui},{op:Ha,field:Ui,as:"center_"+Ui}],na=[{calculate:`datum["center_${Ui}"] + datum["extent_${Ui}"]`,as:"upper_"+Ui},{calculate:`datum["center_${Ui}"] - datum["extent_${Ui}"]`,as:"lower_"+Ui}],va=[{fieldPrefix:"center_",titlePrefix:Sw(Ha)},{fieldPrefix:"upper_",titlePrefix:FF(Ha,Ns,"+")},{fieldPrefix:"lower_",titlePrefix:FF(Ha,Ns,"-")}],ya=!0;else{let Fs,gs,kl;Cr.center&&Cr.extent&&Gr(de.errorBarCenterIsNotNeeded(Cr.extent,yi)),Ns==="ci"?(Fs="mean",gs="ci0",kl="ci1"):(Fs="median",gs="q1",kl="q3"),vo=[{op:gs,field:Ui,as:"lower_"+Ui},{op:kl,field:Ui,as:"upper_"+Ui},{op:Fs,field:Ui,as:"center_"+Ui}],va=[{fieldPrefix:"upper_",titlePrefix:zy({field:Ui,aggregate:kl,type:"quantitative"},_i,{allowDisabling:!1})},{fieldPrefix:"lower_",titlePrefix:zy({field:Ui,aggregate:gs,type:"quantitative"},_i,{allowDisabling:!1})},{fieldPrefix:"center_",titlePrefix:zy({field:Ui,aggregate:Fs,type:"quantitative"},_i,{allowDisabling:!1})}]}}else{(Cr.center||Cr.extent)&&Gr(de.errorBarCenterAndExtentAreNotNeeded(Cr.center,Cr.extent)),wi==="aggregated-upper-lower"?(va=[],na=[{calculate:`datum["${gi.field}"]`,as:"upper_"+Ui},{calculate:`datum["${Ui}"]`,as:"lower_"+Ui}]):wi==="aggregated-error"&&(va=[{fieldPrefix:"",titlePrefix:Ui}],na=[{calculate:`datum["${Ui}"] + datum["${vi.field}"]`,as:"upper_"+Ui}],zi?na.push({calculate:`datum["${Ui}"] + datum["${zi.field}"]`,as:"lower_"+Ui}):na.push({calculate:`datum["${Ui}"] - datum["${vi.field}"]`,as:"lower_"+Ui}));for(const Ha of na)va.push({fieldPrefix:Ha.as.substring(0,6),titlePrefix:O1(O1(Ha.calculate,'datum["',""),'"]',"")})}return{postAggregateCalculates:na,errorBarSpecificAggregate:vo,tooltipSummary:va,tooltipTitleWithFieldName:ya}}(O,H,Z,ue,fe,M,t,n),ut=s,st=Ie,mt=(ut[st],Ie==="x"?"x2":"y2"),dt=(ut[mt],Ie==="x"?"xError":"yError"),en=(ut[dt],Ie==="x"?"xError2":"yError2"),mn=(ut[en],Li(ut,[typeof st=="symbol"?st:st+"",typeof mt=="symbol"?mt:mt+"",typeof dt=="symbol"?dt:dt+"",typeof en=="symbol"?en:en+""])),{bins:sn,timeUnits:In,aggregate:Fn,groupby:zn,encoding:Vn}=OO(mn,n),Qn=[...Fn,...Pe],mr=M!=="raw"?[]:zn,Pr=SO(rt,H,Vn,it);return{transform:[...(r=x.transform)!==null&&r!==void 0?r:[],...sn,...In,...Qn.length===0?[]:[{aggregate:Qn,groupby:mr}],...Le],groupby:mr,continuousAxisChannelDef:H,continuousAxis:Ie,encodingWithoutContinuousAxis:Vn,ticksOrient:T==="vertical"?"horizontal":"vertical",markDef:O,outerSpec:x,tooltipEncoding:Pr}}function FF(e,t,n){return Sw(e)+" "+n+" "+t}const TO="errorband",WL=new Rw(TO,IF);function IF(e,{config:t}){const{transform:n,continuousAxisChannelDef:r,continuousAxis:i,encodingWithoutContinuousAxis:s,markDef:f,outerSpec:m,tooltipEncoding:x}=NF(e,TO,t),O=f,T=_O(O,i,r,s,t.errorband),M=e.encoding.x!==void 0&&e.encoding.y!==void 0;let H={type:M?"area":"rect"},Z={type:M?"line":"rule"};const ue=Object.assign(Object.assign({},O.interpolate?{interpolate:O.interpolate}:{}),O.tension&&O.interpolate?{tension:O.tension}:{});return M?(H=Object.assign(Object.assign(Object.assign({},H),ue),{ariaRoleDescription:"errorband"}),Z=Object.assign(Object.assign({},Z),ue)):O.interpolate?Gr(de.errorBand1DNotSupport("interpolate")):O.tension&&Gr(de.errorBand1DNotSupport("tension")),Object.assign(Object.assign({},m),{transform:n,layer:[...T({partName:"band",mark:H,positionPrefix:"lower",endPositionPrefix:"upper",extraEncoding:x}),...T({partName:"borders",mark:Z,positionPrefix:"lower",aria:!1,extraEncoding:x}),...T({partName:"borders",mark:Z,positionPrefix:"upper",aria:!1,extraEncoding:x})]})}const RF={};function NO(e,t,n){const r=new Rw(e,t);RF[e]={normalizer:r,parts:n}}NO(rk,_F,["box","median","outliers","rule","ticks"]),NO(DO,TF,["ticks","rule"]),NO(TO,IF,["band","borders"]);const VL=["gradientHorizontalMaxLength","gradientHorizontalMinLength","gradientVerticalMaxLength","gradientVerticalMinLength","unselectedOpacity"],MF=["size","shape","fill","stroke","strokeDash","strokeWidth","opacity"],qL={fillColor:{part:"legend",vgProp:"fill"},gradientStrokeColor:{part:"gradient",vgProp:"stroke"},labelColor:{part:"labels",vgProp:"fill"},strokeColor:{part:"legend",vgProp:"stroke"},symbolFillColor:{part:"symbols",vgProp:"fill"},symbolStrokeColor:{part:"symbols",vgProp:"stroke"},titleColor:{part:"title",vgProp:"fill"}},HL={aria:1,clipHeight:1,columnPadding:1,columns:1,cornerRadius:1,description:1,direction:1,fillColor:1,format:1,formatType:1,gradientLength:1,gradientOpacity:1,gradientStrokeColor:1,gradientStrokeWidth:1,gradientThickness:1,gridAlign:1,labelAlign:1,labelBaseline:1,labelColor:1,labelFont:1,labelFontSize:1,labelFontStyle:1,labelFontWeight:1,labelLimit:1,labelOffset:1,labelOpacity:1,labelOverlap:1,labelPadding:1,labelSeparation:1,legendX:1,legendY:1,offset:1,orient:1,padding:1,rowPadding:1,strokeColor:1,symbolDash:1,symbolDashOffset:1,symbolFillColor:1,symbolLimit:1,symbolOffset:1,symbolOpacity:1,symbolSize:1,symbolStrokeColor:1,symbolStrokeWidth:1,symbolType:1,tickCount:1,tickMinStep:1,title:1,titleAlign:1,titleAnchor:1,titleBaseline:1,titleColor:1,titleFont:1,titleFontSize:1,titleFontStyle:1,titleFontWeight:1,titleLimit:1,titleLineHeight:1,titleOpacity:1,titleOrient:1,titlePadding:1,type:1,values:1,zindex:1},N1="_vgsid_",$L={single:{on:"click",fields:[N1],resolve:"global",empty:"all",clear:"dblclick"},multi:{on:"click",fields:[N1],toggle:"event.shiftKey",resolve:"global",empty:"all",clear:"dblclick"},interval:{on:"[mousedown, window:mouseup] > window:mousemove!",encodings:["x","y"],translate:"[mousedown, window:mouseup] > window:mousemove!",zoom:"wheel!",mark:{fill:"#333",fillOpacity:.125,stroke:"white"},resolve:"global",clear:"dblclick"}};function FO(e){return!(!e||e!=="legend"&&!e.legend)}function IO(e){return FO(e)&&Uc(e)}function RO(e){return"concat"in e}function ik(e){return"vconcat"in e}function MO(e){return"hconcat"in e}function A0(e){return Uc(e)&&e.step!==void 0}function jF(e){return e.view||e.width||e.height}const GL=Kr({align:1,bounds:1,center:1,columns:1,spacing:1});function jO(e,t){var n;return(n=e[t])!==null&&n!==void 0?n:e[t==="width"?"continuousWidth":"continuousHeight"]}function ok(e,t){const n=lx(e,t);return A0(n)?n.step:BO}function lx(e,t){var n;return Qu((n=e[t])!==null&&n!==void 0?n:e[t==="width"?"discreteWidth":"discreteHeight"],{step:e.step})}const BO=20,KL={background:"white",padding:5,timeFormat:"%b %d, %Y",countTitle:"Count of Records",view:{continuousWidth:200,continuousHeight:200,step:BO},mark:{color:"#4c78a8",invalid:"filter",timeUnitBand:1},arc:{},area:{},bar:I7,circle:{},geoshape:{},image:{},line:{},point:{},rect:R7,rule:{color:"black"},square:{},text:{color:"black"},tick:{thickness:1},trail:{},boxplot:{size:14,extent:1.5,box:{},median:{color:"white"},outliers:{},rule:{},ticks:null},errorbar:{center:"mean",rule:!0,ticks:!1},errorband:{band:{opacity:.3},borders:!1},scale:{pointPadding:.5,barBandPaddingInner:.1,rectBandPaddingInner:0,minBandSize:2,minFontSize:8,maxFontSize:40,minOpacity:.3,maxOpacity:.8,minSize:9,minStrokeWidth:1,maxStrokeWidth:4,quantileCount:4,quantizeCount:4},projection:{},legend:{gradientHorizontalMaxLength:200,gradientHorizontalMinLength:100,gradientVerticalMaxLength:200,gradientVerticalMinLength:64,unselectedOpacity:.35},header:{titlePadding:10,labelPadding:10},headerColumn:{},headerRow:{},headerFacet:{},selection:$L,style:{},title:{},facet:{spacing:20},concat:{spacing:20}},lv=["#4c78a8","#f58518","#e45756","#72b7b2","#54a24b","#eeca3b","#b279a2","#ff9da6","#9d755d","#bab0ac"],BF={text:11,guideLabel:10,guideTitle:11,groupTitle:13,groupSubtitle:12},PF={blue:lv[0],orange:lv[1],red:lv[2],teal:lv[3],green:lv[4],yellow:lv[5],purple:lv[6],pink:lv[7],brown:lv[8],gray0:"#000",gray1:"#111",gray2:"#222",gray3:"#333",gray4:"#444",gray5:"#555",gray6:"#666",gray7:"#777",gray8:"#888",gray9:"#999",gray10:"#aaa",gray11:"#bbb",gray12:"#ccc",gray13:"#ddd",gray14:"#eee",gray15:"#fff"};function LF(e={}){const{color:t,font:n,fontSize:r}=e,i=Li(e,["color","font","fontSize"]);return $T({},KL,n?function(s){return{text:{font:s},style:{"guide-label":{font:s},"guide-title":{font:s},"group-title":{font:s},"group-subtitle":{font:s}}}}(n):{},t?function(s={}){return{signals:[{name:"color",value:Uc(s)?Object.assign(Object.assign({},PF),s):PF}],mark:{color:{signal:"color.blue"}},rule:{color:{signal:"color.gray0"}},text:{color:{signal:"color.gray0"}},style:{"guide-label":{fill:{signal:"color.gray0"}},"guide-title":{fill:{signal:"color.gray0"}},"group-title":{fill:{signal:"color.gray0"}},"group-subtitle":{fill:{signal:"color.gray0"}},cell:{stroke:{signal:"color.gray8"}}},axis:{domainColor:{signal:"color.gray13"},gridColor:{signal:"color.gray8"},tickColor:{signal:"color.gray13"}},range:{category:[{signal:"color.blue"},{signal:"color.orange"},{signal:"color.red"},{signal:"color.teal"},{signal:"color.green"},{signal:"color.yellow"},{signal:"color.purple"},{signal:"color.pink"},{signal:"color.brown"},{signal:"color.grey8"}]}}}(t):{},r?function(s){return{signals:[{name:"fontSize",value:Uc(s)?Object.assign(Object.assign({},BF),s):BF}],text:{fontSize:{signal:"fontSize.text"}},style:{"guide-label":{fontSize:{signal:"fontSize.guideLabel"}},"guide-title":{fontSize:{signal:"fontSize.guideTitle"}},"group-title":{fontSize:{signal:"fontSize.groupTitle"}},"group-subtitle":{fontSize:{signal:"fontSize.groupSubtitle"}}}}}(r):{},i||{})}const XL=["view",...cN],YL=["color","fontSize","background","padding","facet","concat","numberFormat","timeFormat","countTitle","header","axisQuantitative","axisTemporal","axisDiscrete","axisPoint","axisXBand","axisXPoint","axisXDiscrete","axisXQuantitative","axisXTemporal","axisYBand","axisYPoint","axisYDiscrete","axisYQuantitative","axisYTemporal","scale","selection","overlay"],JL=Object.assign({view:["continuousWidth","continuousHeight","discreteWidth","discreteHeight","step"]},{area:["line","point"],bar:["binSpacing","continuousBandSize","discreteBandSize"],rect:["binSpacing","continuousBandSize","discreteBandSize"],line:["point"],tick:["bandSize","thickness"]});function QL(e){e=Go(e);for(const t of YL)delete e[t];if(e.axis)for(const t in e.axis)VC(e.axis[t])&&delete e.axis[t];if(e.legend)for(const t of VL)delete e.legend[t];if(e.mark){for(const t of lN)delete e.mark[t];e.mark.tooltip&&Uc(e.mark.tooltip)&&delete e.mark.tooltip}for(const t of XL){for(const r of lN)delete e[t][r];const n=JL[t];if(n)for(const r of n)delete e[t][r];ZL(e,t)}for(const t of Kr(RF))delete e[t];(function(t){const{titleMarkConfig:n,subtitleMarkConfig:r,subtitle:i}=dF(t.title);ms(n)||(t.style["group-title"]=Object.assign(Object.assign({},t.style["group-title"]),n)),ms(r)||(t.style["group-subtitle"]=Object.assign(Object.assign({},t.style["group-subtitle"]),r)),ms(i)?delete t.title:t.title=i})(e);for(const t in e)Uc(e[t])&&ms(e[t])&&delete e[t];return ms(e)?void 0:e}function ZL(e,t,n,r){const i=r?e[t][r]:e[t];t==="view"&&(n="cell");const s=Object.assign(Object.assign({},i),e.style[n??t]);ms(s)||(e.style[n??t]=s),r||delete e[t]}function ak(e){return"layer"in e}class zF{map(t,n){return Xw(t)?this.mapFacet(t,n):function(r){return"repeat"in r}(t)?this.mapRepeat(t,n):MO(t)?this.mapHConcat(t,n):ik(t)?this.mapVConcat(t,n):RO(t)?this.mapConcat(t,n):this.mapLayerOrUnit(t,n)}mapLayerOrUnit(t,n){if(ak(t))return this.mapLayer(t,n);if(nv(t))return this.mapUnit(t,n);throw new Error(de.invalidSpec(t))}mapLayer(t,n){return Object.assign(Object.assign({},t),{layer:t.layer.map(r=>this.mapLayerOrUnit(r,n))})}mapHConcat(t,n){return Object.assign(Object.assign({},t),{hconcat:t.hconcat.map(r=>this.map(r,n))})}mapVConcat(t,n){return Object.assign(Object.assign({},t),{vconcat:t.vconcat.map(r=>this.map(r,n))})}mapConcat(t,n){const{concat:r}=t,i=Li(t,["concat"]);return Object.assign(Object.assign({},i),{concat:r.map(s=>this.map(s,n))})}mapFacet(t,n){return Object.assign(Object.assign({},t),{spec:this.map(t.spec,n)})}mapRepeat(t,n){return Object.assign(Object.assign({},t),{spec:this.map(t.spec,n)})}}const ez={zero:1,center:1,normalize:1},tz=new Set([oN,Tw,Dw,Iw,Fw,HC,$C,Nw,aN,qC]),nz=new Set([Tw,Dw,oN]);function UF(e,t){var n,r;const i=t==="x"?"y":"radius",s=e[t],f=e[i];if(si(s)&&si(f))if(Zv(s)==="quantitative"&&Zv(f)==="quantitative"){if(s.stack)return t;if(f.stack)return i;const m=si(s)&&!!s.aggregate;if(m!==(si(f)&&!!f.aggregate))return m?t:i;{const x=(n=s.scale)===null||n===void 0?void 0:n.type,O=(r=f.scale)===null||r===void 0?void 0:r.type;if(x&&x!=="linear")return i;if(O&&O!=="linear")return t}}else{if(Zv(s)==="quantitative")return t;if(Zv(f)==="quantitative")return i}else{if(Zv(s)==="quantitative")return t;if(Zv(f)==="quantitative")return i}}function WF(e,t,n={}){const r=h0(e)?e.type:e;if(!tz.has(r))return null;const i=UF(t,"x")||UF(t,"theta");if(!i)return null;const s=t[i],f=si(s)?ei(s,{}):void 0;let m=function(H){switch(H){case"x":return"y";case"y":return"x";case"theta":return"radius";case"radius":return"theta"}}(i),x=t[m],O=si(x)?ei(x,{}):void 0;O===f&&(O=void 0,x=void 0,m=void 0);const T=H7.reduce((H,Z)=>{if(Z!=="tooltip"&&Vy(t,Z)){const ue=t[Z];for(const fe of Mu(ue)){const Ie=O0(fe);if(Ie.aggregate)continue;const Pe=ei(Ie,{});Pe&&Pe===O||H.push({channel:Z,fieldDef:Ie})}}return H},[]);let M;if(s.stack!==void 0?M=Gb(s.stack)?s.stack?"zero":null:s.stack:T.length>0&&nz.has(r)&&(M="zero"),!M||!function(H){return H in ez}(M)||CO(t)&&T.length===0)return null;if(s.scale&&s.scale.type&&s.scale.type!==Zu.LINEAR){if(n.disallowNonLinearStack)return null;Gr(de.cannotStackNonLinearScale(s.scale.type))}return Oo(t[b0(i)])?(s.stack!==void 0&&Gr(de.cannotStackRangedMark(i)),null):(si(s)&&s.aggregate&&!Ji(P7,s.aggregate)&&Gr(de.stackNonSummativeAggregate(s.aggregate)),{groupbyChannel:x?m:void 0,groupbyField:O,fieldChannel:i,impute:s.impute!==null&&Fy(r),stackBy:T,offset:M})}function PO(e,t={},n){return e.point==="transparent"?{opacity:0}:e.point?Uc(e.point)?e.point:{}:e.point!==void 0?null:t.point||n.shape?Uc(t.point)?t.point:{}:void 0}function VF(e,t={}){return e.line?e.line===!0?{}:e.line:e.line!==void 0?null:t.line?t.line===!0?{}:t.line:void 0}class rz{constructor(){this.name="path-overlay"}hasMatchingType(t,n){if(nv(t)){const{mark:r,encoding:i}=t,s=h0(r)?r:{type:r};switch(s.type){case"line":case"rule":case"trail":return!!PO(s,n[s.type],i);case"area":return!!PO(s,n[s.type],i)||!!VF(s,n[s.type])}}return!1}run(t,n,r){const{config:i}=n,{selection:s,projection:f,encoding:m,mark:x}=t,O=Li(t,["selection","projection","encoding","mark"]),T=h0(x)?x:{type:x},M=PO(T,i[T.type],m),H=T.type==="area"&&VF(T,i[T.type]),Z=[Object.assign(Object.assign({},s?{selection:s}:{}),{mark:function(Ie){const Pe=Li(Ie,["point","line"]);return Kr(Pe).length>1?Pe:Pe.type}(Object.assign(Object.assign({},T.type==="area"&&T.opacity===void 0&&T.fillOpacity===void 0?{opacity:.7}:{}),T)),encoding:tv(m,["shape"])})],ue=WF(T,m);let fe=m;if(ue){const{fieldChannel:Ie,offset:Pe}=ue;fe=Object.assign(Object.assign({},m),{[Ie]:Object.assign(Object.assign({},m[Ie]),Pe?{stack:Pe}:{})})}return H&&Z.push(Object.assign(Object.assign({},f?{projection:f}:{}),{mark:Object.assign(Object.assign({type:"line"},Yb(T,["clip","interpolate","tension","tooltip"])),H),encoding:fe})),M&&Z.push(Object.assign(Object.assign({},f?{projection:f}:{}),{mark:Object.assign(Object.assign({type:"point",opacity:1,filled:!0},Yb(T,["clip","tooltip"])),M),encoding:fe})),r(Object.assign(Object.assign({},O),{layer:Z}),Object.assign(Object.assign({},n),{config:function(Ie){for(const Pe of["line","area","rule","trail"])Ie[Pe]&&(Ie=Object.assign(Object.assign({},Ie),{[Pe]:tv(Ie[Pe],["point","line"])}));return Ie}(i)}))}}class iz{constructor(){this.name="RangeStep"}hasMatchingType(t){var n;if(nv(t)&&t.encoding)for(const r of gm){const i=t.encoding[r];if(i&&Oo(i)&&(!((n=i==null?void 0:i.scale)===null||n===void 0)&&n.rangeStep))return!0}return!1}run(t){var n;const r={};let i=Object.assign({},t.encoding);for(const s of gm){const f=x0(s),m=i[s];if(m&&Oo(m)&&(!((n=m==null?void 0:m.scale)===null||n===void 0)&&n.rangeStep)){const{scale:x}=m,O=Li(m,["scale"]),T=x,M=Li(T,["rangeStep"]);r[f]={step:x.rangeStep},Gr(de.RANGE_STEP_DEPRECATED),i=Object.assign(Object.assign({},i),{[s]:Object.assign(Object.assign({},O),ms(M)?{}:{scale:M})})}}return Object.assign(Object.assign(Object.assign({},r),t),{encoding:i})}}function LO(e,t){return t?GF(e,t):e}function zO(e,t,n){const r=t[e];return function(i){return i&&!$o(i)&&"repeat"in i}(r)?r.repeat in n?Object.assign(Object.assign({},t),{[e]:n[r.repeat]}):void Gr(de.noSuchRepeatedValue(r.repeat)):t}function qF(e,t){if((e=zO("field",e,t))!==void 0){if(e===null)return null;if(nF(e)&&E0(e.sort)){const n=zO("field",e.sort,t);e=Object.assign(Object.assign({},e),n?{sort:n}:{})}return e}}function HF(e,t){if(si(e))return qF(e,t);{const n=zO("datum",e,t);return n===e||n.type||(n.type="nominal"),n}}function $F(e,t){if(!Oo(e)){if(vO(e)){const n=HF(e.condition,t);return n?Object.assign(Object.assign({},e),{condition:n}):Li(e,["condition"])}return e}{const n=HF(e,t);if(n)return n;if(gO(e))return{condition:e.condition}}}function GF(e,t){const n={};for(const r in e)if(Ty(e,r)){const i=e[r];if(Gi(i))n[r]=i.map(s=>$F(s,t)).filter(s=>s);else{const s=$F(i,t);s!==void 0&&(n[r]=s)}}return n}class oz{constructor(){this.name="RuleForRangedLine"}hasMatchingType(t){if(nv(t)){const{encoding:n,mark:r}=t;if(r==="line")for(const i of q7){const s=n[jy(i)];if(n[i]&&(si(s)&&!bh(s.bin)||ey(s)))return!0}}return!1}run(t,n,r){const{encoding:i}=t;return Gr(de.lineWithRange(!!i.x2,!!i.y2)),r(Object.assign(Object.assign({},t),{mark:"rule"}),n)}}function KF(e){const{parentEncoding:t,encoding:n}=e;if(t&&n){const i=Kr(t).reduce((s,f)=>(n[f]&&s.push(f),s),[]);i.length>0&&Gr(de.encodingOverridden(i))}const r=Object.assign(Object.assign({},t??{}),n??{});return ms(r)?void 0:r}function XF(e){const{parentProjection:t,projection:n}=e;return t&&n&&Gr(de.projectionOverridden({parentProjection:t,projection:n})),n??t}function YF(e,t){t===void 0&&(t=LF(e.config));const n=function(f,m={}){return az.map(f,{config:m})}(e,t),{width:r,height:i}=e,s=function(f,m,x){let{width:O,height:T}=m;const M=nv(f)||ak(f),H={};M?O=="container"&&T=="container"?(H.type="fit",H.contains="padding"):O=="container"?(H.type="fit-x",H.contains="padding"):T=="container"&&(H.type="fit-y",H.contains="padding"):(O=="container"&&(Gr(de.containerSizeNonSingle("width")),O=void 0),T=="container"&&(Gr(de.containerSizeNonSingle("height")),T=void 0));const Z=Object.assign(Object.assign(Object.assign({type:"pad"},H),x?JF(x.autosize):{}),JF(f.autosize));if(Z.type!=="fit"||M||(Gr(de.FIT_NON_SINGLE),Z.type="pad"),O=="container"&&Z.type!="fit"&&Z.type!="fit-x"&&Gr(de.containerSizeNotCompatibleWithAutosize("width")),T=="container"&&Z.type!="fit"&&Z.type!="fit-y"&&Gr(de.containerSizeNotCompatibleWithAutosize("height")),!Xb(Z,{type:"pad"}))return Z}(n,{width:r,height:i,autosize:e.autosize},t);return Object.assign(Object.assign({},n),s?{autosize:s}:{})}const az=new class extends zF{constructor(){super(...arguments),this.nonFacetUnitNormalizers=[LL,zL,WL,new rz,new oz,new iz]}map(e,t){if(nv(e)){const n=Vy(e.encoding,rv),r=Vy(e.encoding,iv),i=Vy(e.encoding,Mw);if(n||r||i)return this.mapFacetedUnit(e,t)}return super.map(e,t)}mapUnit(e,t){const{parentEncoding:n,parentProjection:r}=t,i=Object.assign(Object.assign({},e),{encoding:LO(e.encoding,t.repeater)});if(n||r)return this.mapUnitWithParentEncodingOrProjection(i,t);const s=this.mapLayerOrUnit.bind(this);for(const f of this.nonFacetUnitNormalizers)if(f.hasMatchingType(i,t.config))return f.run(i,t,s);return i}mapRepeat(e,t){return function(n){return!Gi(n.repeat)&&n.repeat.layer}(e)?this.mapLayerRepeat(e,t):this.mapNonLayerRepeat(e,t)}mapLayerRepeat(e,t){const{repeat:n,spec:r}=e,i=Li(e,["repeat","spec"]),{row:s,column:f,layer:m}=n,{repeater:x={},repeaterPrefix:O=""}=t;return s||f?this.mapRepeat(Object.assign(Object.assign({},e),{repeat:Object.assign(Object.assign({},s?{row:s}:{}),f?{column:f}:{}),spec:{repeat:{layer:m},spec:r}}),t):Object.assign(Object.assign({},i),{layer:m.map(T=>{const M=Object.assign(Object.assign({},x),{layer:T}),H=(r.name||"")+O+`child__layer_${eu(T)}`,Z=this.mapLayerOrUnit(r,Object.assign(Object.assign({},t),{repeater:M,repeaterPrefix:H}));return Z.name=H,Z})})}mapNonLayerRepeat(e,t){var n;const{repeat:r,spec:i,data:s}=e,f=Li(e,["repeat","spec","data"]);!Gi(r)&&e.columns&&(e=tv(e,["columns"]),Gr(de.columnsNotSupportByRowCol("repeat")));const m=[],{repeater:x={},repeaterPrefix:O=""}=t,T=!Gi(r)&&r.row||[x?x.row:null],M=!Gi(r)&&r.column||[x?x.column:null],H=Gi(r)&&r||[x?x.repeat:null];for(const ue of H)for(const fe of T)for(const Ie of M){const Pe={repeat:ue,row:fe,column:Ie,layer:x.layer},Le=(i.name||"")+O+"child__"+(Gi(r)?`${eu(ue)}`:(r.row?`row_${eu(fe)}`:"")+(r.column?`column_${eu(Ie)}`:"")),rt=this.map(i,Object.assign(Object.assign({},t),{repeater:Pe,repeaterPrefix:Le}));rt.name=Le,m.push(tv(rt,["data"]))}const Z=Gi(r)?e.columns:r.column?r.column.length:1;return Object.assign(Object.assign({data:(n=i.data)!==null&&n!==void 0?n:s,align:"all"},f),{columns:Z,concat:m})}mapFacet(e,t){const{facet:n}=e;return ax(n)&&e.columns&&(e=tv(e,["columns"]),Gr(de.columnsNotSupportByRowCol("facet"))),super.mapFacet(e,t)}mapUnitWithParentEncodingOrProjection(e,t){const{encoding:n,projection:r}=e,{parentEncoding:i,parentProjection:s,config:f}=t,m=XF({parentProjection:s,projection:r}),x=KF({parentEncoding:i,encoding:LO(n,t.repeater)});return this.mapUnit(Object.assign(Object.assign(Object.assign({},e),m?{projection:m}:{}),x?{encoding:x}:{}),{config:f})}mapFacetedUnit(e,t){const n=e.encoding,{row:r,column:i,facet:s}=n,f=Li(n,["row","column","facet"]),{mark:m,width:x,projection:O,height:T,view:M,selection:H,encoding:Z}=e,ue=Li(e,["mark","width","projection","height","view","selection","encoding"]),{facetMapping:fe,layout:Ie}=this.getFacetMappingAndLayout({row:r,column:i,facet:s},t),Pe=LO(f,t.repeater);return this.mapFacet(Object.assign(Object.assign(Object.assign({},ue),Ie),{facet:fe,spec:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},x?{width:x}:{}),T?{height:T}:{}),M?{view:M}:{}),O?{projection:O}:{}),{mark:m,encoding:Pe}),H?{selection:H}:{})}),t)}getFacetMappingAndLayout(e,t){var n;const{row:r,column:i,facet:s}=e;if(r||i){s&&Gr(de.facetChannelDropped([...r?[rv]:[],...i?[iv]:[]]));const f={},m={};for(const x of[rv,iv]){const O=e[x];if(O){const T=Li(O,["align","center","spacing","columns"]);f[x]=T;for(const M of["align","center","spacing"])O[M]!==void 0&&(m[M]=(n=m[M])!==null&&n!==void 0?n:{},m[M][x]=O[M])}}return{facetMapping:f,layout:m}}{const{align:f,center:m,spacing:x,columns:O}=s;return{facetMapping:function(T,M){return M?ax(T)?GF(T,M):qF(T,M):T}(Li(s,["align","center","spacing","columns"]),t.repeater),layout:Object.assign(Object.assign(Object.assign(Object.assign({},f?{align:f}:{}),m?{center:m}:{}),x?{spacing:x}:{}),O?{columns:O}:{})}}}mapLayer(e,t){var{parentEncoding:n,parentProjection:r}=t,i=Li(t,["parentEncoding","parentProjection"]);const{encoding:s,projection:f}=e,m=Li(e,["encoding","projection"]),x=Object.assign(Object.assign({},i),{parentEncoding:KF({parentEncoding:n,encoding:s}),parentProjection:XF({parentProjection:r,projection:f})});return super.mapLayer(m,x)}};function JF(e){return $o(e)?{type:e}:e??{}}const sz=["background","padding"];function QF(e){return sz.reduce((t,n)=>(e&&e[n]!==void 0&&(t[n]=e[n]),t),{})}class fv{constructor(t={},n={}){this.explicit=t,this.implicit=n}clone(){return new fv(Go(this.explicit),Go(this.implicit))}combine(){return Object.assign(Object.assign({},this.explicit),this.implicit)}get(t){return Qu(this.explicit[t],this.implicit[t])}getWithExplicit(t){return this.explicit[t]!==void 0?{explicit:!0,value:this.explicit[t]}:this.implicit[t]!==void 0?{explicit:!1,value:this.implicit[t]}:{explicit:!1,value:void 0}}setWithExplicit(t,n){n.value!==void 0&&this.set(t,n.value,n.explicit)}set(t,n,r){return delete this[r?"implicit":"explicit"][t],this[r?"explicit":"implicit"][t]=n,this}copyKeyFromSplit(t,n){n.explicit[t]!==void 0?this.set(t,n.explicit[t],!0):n.implicit[t]!==void 0&&this.set(t,n.implicit[t],!1)}copyKeyFromObject(t,n){n[t]!==void 0&&this.set(t,n[t],!0)}copyAll(t){for(const n of Kr(t.combine())){const r=t.getWithExplicit(n);this.setWithExplicit(n,r)}}}function qy(e){return{explicit:!0,value:e}}function hg(e){return{explicit:!1,value:e}}function ZF(e){return(t,n,r,i)=>{const s=e(t.value,n.value);return s>0?t:s<0?n:sk(t,n,r,i)}}function sk(e,t,n,r){return e.explicit&&t.explicit&&Gr(de.mergeConflictingProperty(n,r,e.value,t.value)),e}function ny(e,t,n,r,i=sk){return e===void 0||e.value===void 0?t:e.explicit&&!t.explicit?e:t.explicit&&!e.explicit?t:Xb(e.value,t.value)?e:i(e,t,n,r)}class uz extends fv{constructor(t={},n={},r=!1){super(t,n),this.explicit=t,this.implicit=n,this.parseNothing=r}clone(){const t=super.clone();return t.parseNothing=this.parseNothing,t}}function fx(e){return"url"in e}function uk(e){return"values"in e}function eI(e){return"name"in e&&!fx(e)&&!uk(e)&&!Hy(e)}function Hy(e){return e&&(tI(e)||nI(e)||UO(e))}function tI(e){return"sequence"in e}function nI(e){return"sphere"in e}function UO(e){return"graticule"in e}const ff="main",ck="raw";function rI(e){return"filter"in e}function cz(e){return"lookup"in e}function lz(e){return"pivot"in e}function fz(e){return"density"in e}function hz(e){return"quantile"in e}function dz(e){return"regression"in e}function pz(e){return"loess"in e}function mz(e){return"sample"in e}function gz(e){return"window"in e}function vz(e){return"joinaggregate"in e}function yz(e){return"flatten"in e}function bz(e){return"calculate"in e}function xz(e){return"bin"in e}function wz(e){return"impute"in e}function kz(e){return"timeUnit"in e}function Ez(e){return"aggregate"in e}function Cz(e){return"stack"in e}function Oz(e){return"fold"in e}function Az(e){return e.map(t=>rI(t)?{filter:function n(r,i){return zC(r)?{not:n(r.not,i)}:LC(r)?{and:r.and.map(s=>n(s,i))}:PC(r)?{or:r.or.map(s=>n(s,i))}:i(r)}(t.filter,kL)}:t)}function hx(e,t,n,r){const i=gO(t)&&t.condition,s=r(t);return i?{[n]:[...Mu(i).map(f=>{const m=r(f),x=function(O){return O.selection}(f)?UI(e,f.selection):wk(e,f.test);return Object.assign({test:x},m)}),...s!==void 0?[s]:[]]}:s!==void 0?{[n]:s}:{}}function WO(e,t="text"){const n=e.encoding[t];return hx(e,n,t,r=>lk(r,e.config))}function lk(e,t,n="datum"){if(e){if(cv(e))return ju(e.value);if(Oo(e)){const{format:r,formatType:i}=Jw(e);return hO({fieldOrDatumDef:e,format:r,formatType:i,expr:n,config:t})}}}function iI(e,t={}){const{encoding:n,markDef:r,config:i,stack:s}=e,f=n.tooltip;if(Gi(f))return{tooltip:aI({tooltip:f},s,i,t)};{const m=t.reactiveGeom?"datum.datum":"datum";return hx(e,f,"tooltip",x=>{const O=lk(x,i,m);if(O)return O;if(x===null)return;let T=qa("tooltip",r,i);return T===!0&&(T={content:"encoding"}),$o(T)?{value:T}:Uc(T)?T.content==="encoding"?aI(n,s,i,t):{signal:m}:void 0})}}function oI(e,t,n,{reactiveGeom:r}={}){const i={},s=r?"datum.datum":"datum",f=[];function m(O,T){const M=jy(T),H=_p(O)?O:Object.assign(Object.assign({},O),{type:e[M].type}),Z=Mu(zy(H,n,{allowDisabling:!1})).join(", ");let ue;if(w0(T)){const fe=T==="x"?"x2":"y2",Ie=O0(e[fe]);if(bh(H.bin)&&Ie){const Pe=ei(H,{expr:s}),Le=ei(Ie,{expr:s}),{format:rt,formatType:it}=Jw(H);ue=Gw(Pe,Le,rt,it,n),i[fe]=!0}else if(t&&t.fieldChannel===T&&t.offset==="normalize"){const{format:Pe,formatType:Le}=Jw(H);ue=hO({fieldOrDatumDef:H,format:Pe,formatType:Le,expr:s,config:n,normalizeStack:!0}).signal}}ue=ue??lk(H,n,s).signal,f.push({channel:T,key:Z,value:ue})}AO(e,(O,T)=>{si(O)?m(O,T):Yw(O)&&m(O.condition,T)});const x={};for(const{channel:O,key:T,value:M}of f)i[O]||x[T]||(x[ga(T)]=M);return x}function aI(e,t,n,{reactiveGeom:r}={}){const i=QT(oI(e,t,n,{reactiveGeom:r})).map(({key:s,value:f})=>`${s}: ${f}`);return i.length>0?{signal:`{${i.join(", ")}}`}:void 0}function Sz(e){const{markDef:t,config:n}=e,r=qa("aria",t,n);return r===!1?{}:Object.assign(Object.assign(Object.assign({},r?{aria:r}:{}),function(i){const{mark:s,markDef:f,config:m}=i;if(m.aria===!1)return{};const x=qa("ariaRoleDescription",f,m);return x!=null?{ariaRoleDescription:{value:x}}:s in wL?{}:{ariaRoleDescription:{value:s}}}(e)),function(i){const{encoding:s,markDef:f,config:m,stack:x}=i,O=s.description;if(O)return hx(i,O,"description",H=>lk(H,i.config));const T=qa("description",f,m);if(T!=null)return{description:ju(T)};if(m.aria===!1)return{};const M=oI(s,x,m);if(!ms(M))return{description:{signal:QT(M).map(({key:H,value:Z})=>`${H} + ": " + (${Z})`).join(' + "; " + ')}}}(e))}function Wc(e,t,n={}){const{markDef:r,encoding:i,config:s}=t,{vgChannel:f}=n;let{defaultRef:m,defaultValue:x}=n;m===void 0&&(x=x??qa(e,r,s,{vgChannel:f,ignoreVgConfig:!0}))!==void 0&&(m=ju(x));const O=i[e];return hx(t,O,f??e,T=>qN({channel:e,channelDef:T,markDef:r,config:s,scaleName:t.scaleName(e),scale:t.getScaleComponent(e),stack:null,defaultRef:m}))}function sI(e,t={filled:void 0}){var n,r,i,s;const{markDef:f,encoding:m,config:x}=e,{type:O}=f,T=(n=t.filled)!==null&&n!==void 0?n:qa("filled",f,x),M=Ji(["bar","point","circle","square","geoshape"],O)?"transparent":void 0,H=(i=(r=qa(T===!0?"color":void 0,f,x,{vgChannel:"fill"}))!==null&&r!==void 0?r:x.mark[T===!0&&"color"])!==null&&i!==void 0?i:M,Z=(s=qa(T===!1?"color":void 0,f,x,{vgChannel:"stroke"}))!==null&&s!==void 0?s:x.mark[T===!1&&"color"],ue=T?"fill":"stroke",fe=Object.assign(Object.assign({},H?{fill:ju(H)}:{}),Z?{stroke:ju(Z)}:{});return f.color&&(T?f.fill:f.stroke)&&Gr(de.droppingColor("property",{fill:"fill"in f,stroke:"stroke"in f})),Object.assign(Object.assign(Object.assign(Object.assign({},fe),Wc("color",e,{vgChannel:ue,defaultValue:T?H:Z})),Wc("fill",e,{defaultValue:m.fill?H:void 0})),Wc("stroke",e,{defaultValue:m.stroke?Z:void 0}))}function fk(e,t){const n=t[function(r){switch(r){case uu:return"xOffset";case vc:return"yOffset";case ug:return"x2Offset";case d0:return"y2Offset";case cg:return"thetaOffset";case p0:return"radiusOffset";case av:return"theta2Offset";case ov:return"radius2Offset"}}(e)];if(n)return n}function hf(e,t,{defaultPos:n,vgChannel:r,isMidPoint:i}){const{encoding:s,markDef:f,config:m,stack:x}=t,O=s[e],T=s[b0(e)],M=t.scaleName(e),H=t.getScaleComponent(e),Z=fk(e,f),ue=VO({model:t,defaultPos:n,channel:e,scaleName:M,scale:H}),fe=!O&&w0(e)&&(s.latitude||s.longitude)?{field:t.getName(e)}:function(Ie){const{channel:Pe,channelDef:Le,isMidPoint:rt,scaleName:it,stack:ut,offset:st,markDef:mt,config:dt}=Ie;if(Oo(Le)&&ut&&Pe===ut.fieldChannel){if(si(Le)){const en=sx({channel:Pe,fieldDef:Le,isMidPoint:rt,markDef:mt,stack:ut,config:dt});if(en!==void 0)return $w({scaleName:it,fieldOrDatumDef:Le,startSuffix:"start",band:en,offset:st})}return Py(Le,it,{suffix:"end"},{offset:st})}return lO(Ie)}({channel:e,channelDef:O,channel2Def:T,markDef:f,config:m,isMidPoint:i,scaleName:M,scale:H,stack:x,offset:Z,defaultRef:ue});return fe?{[r||e]:fe}:void 0}function VO({model:e,defaultPos:t,channel:n,scaleName:r,scale:i}){const{markDef:s,config:f}=e;return()=>{const m=jy(n),x=Kv(n),O=qa(n,s,f,{vgChannel:x});if(O!==void 0)return ox(n,O);switch(t){case"zeroOrMin":case"zeroOrMax":if(r){const T=i.get("type");if(!Ji([Zu.LOG,Zu.TIME,Zu.UTC],T)){if(i.domainDefinitelyIncludesZero())return{scale:r,value:0}}}if(t==="zeroOrMin")return m==="y"?{field:{group:"height"}}:{value:0};switch(m){case"radius":return{signal:`min(${e.width.signal},${e.height.signal})/2`};case"theta":return{signal:"2*PI"};case"x":return{field:{group:"width"}};case"y":return{value:0}}break;case"mid":{const T=e[x0(n)];return Object.assign(Object.assign({},T),{mult:.5})}}}}const _z={left:"x",center:"xc",right:"x2"},Dz={top:"y",middle:"yc",bottom:"y2"};function uI(e,t,n,r="middle"){if(e==="radius"||e==="theta")return Kv(e);const i=qa(e==="x"?"align":"baseline",t,n);return e==="x"?_z[i||(r==="top"?"left":"center")]:Dz[i||r]}function hk(e,t,{defaultPos:n,defaultPos2:r,range:i}){return i?cI(e,t,{defaultPos:n,defaultPos2:r}):hf(e,t,{defaultPos:n})}function cI(e,t,{defaultPos:n,defaultPos2:r}){const{markDef:i,config:s}=t,f=b0(e),m=x0(e),x=function(T,M,H){const{encoding:Z,mark:ue,markDef:fe,stack:Ie,config:Pe}=T,Le=jy(H),rt=x0(H),it=Kv(H),ut=Z[Le],st=T.scaleName(Le),mt=T.getScaleComponent(Le),dt=fk(H in Z||H in fe?H:Le,T.markDef);if(!ut&&(H==="x2"||H==="y2")&&(Z.latitude||Z.longitude))return{[it]:{field:T.getName(H)}};const en=function({channel:mn,channelDef:sn,channel2Def:In,markDef:Fn,config:zn,scaleName:Vn,scale:Qn,stack:mr,offset:Pr,defaultRef:Cr}){return Oo(sn)&&mr&&mn.charAt(0)===mr.fieldChannel.charAt(0)?Py(sn,Vn,{suffix:"start"},{offset:Pr}):lO({channel:mn,channelDef:In,scaleName:Vn,scale:Qn,stack:mr,markDef:Fn,config:zn,offset:Pr,defaultRef:Cr})}({channel:H,channelDef:ut,channel2Def:Z[H],markDef:fe,config:Pe,scaleName:st,scale:mt,stack:Ie,offset:dt,defaultRef:void 0});return en!==void 0?{[it]:en}:dk(H,fe)||dk(H,{[H]:tk(H,fe,Pe.style),[rt]:tk(rt,fe,Pe.style)})||dk(H,Pe[ue])||dk(H,Pe.mark)||{[it]:VO({model:T,defaultPos:M,channel:H,scaleName:st,scale:mt})()}}(t,r,f),O=x[m]?uI(e,i,s):Kv(e);return Object.assign(Object.assign({},hf(e,t,{defaultPos:n,vgChannel:O})),x)}function dk(e,t){const n=x0(e),r=Kv(e);return t[r]!==void 0?{[r]:ox(e,t[r])}:t[e]!==void 0?{[r]:ox(e,t[e])}:t[n]?{[n]:ox(e,t[n])}:void 0}function ry(e,t,n){var r,i,s,f;const{config:m,encoding:x,markDef:O,stack:T}=e,M=b0(t),H=x0(t),Z=x[t],ue=x[M],fe=e.getScaleComponent(t),Ie=fe?fe.get("type"):void 0,Pe=e.scaleName(t),Le=O.orient,rt=(i=(r=x[H])!==null&&r!==void 0?r:x.size)!==null&&i!==void 0?i:qa("size",O,m,{vgChannel:H}),it=n==="bar"&&(t==="x"?Le==="vertical":Le==="horizontal");if(si(Z)&&(Ts(Z.bin)||bh(Z.bin)||Z.timeUnit&&!ue)&&!rt&&!Ad(Ie)){const ut=sx({channel:t,fieldDef:Z,stack:T,markDef:O,config:m}),st=(s=e.component.axes[t])===null||s===void 0?void 0:s[0];return function({fieldDef:mt,fieldDef2:dt,channel:en,band:mn,scaleName:sn,markDef:In,spacing:Fn=0,axisTranslate:zn,reverse:Vn,config:Qn}){const mr=b0(en),Pr=Kv(en),Cr=Kv(mr),Jr=fk(en,In);if(Ts(mt.bin)||mt.timeUnit)return{[Cr]:lI({channel:en,fieldDef:mt,scaleName:sn,markDef:In,band:(1-mn)/2,offset:dx(mr,Fn,Vn,zn,Jr),config:Qn}),[Pr]:lI({channel:en,fieldDef:mt,scaleName:sn,markDef:In,band:1-(1-mn)/2,offset:dx(en,Fn,Vn,zn,Jr),config:Qn})};if(bh(mt.bin)){const gi=Py(mt,sn,{},{offset:dx(mr,Fn,Vn,zn,Jr)});if(si(dt))return{[Cr]:gi,[Pr]:Py(dt,sn,{},{offset:dx(en,Fn,Vn,zn,Jr)})};if(rx(mt.bin)&&mt.bin.step)return{[Cr]:gi,[Pr]:{signal:`scale("${sn}", ${ei(mt,{expr:"datum"})} + ${mt.bin.step})`,offset:dx(en,Fn,Vn,zn,Jr)}}}return void Gr(de.channelRequiredForBinned(mr))}({fieldDef:Z,fieldDef2:ue,channel:t,markDef:O,scaleName:Pe,band:ut,axisTranslate:(f=st==null?void 0:st.get("translate"))!==null&&f!==void 0?f:.5,spacing:w0(t)?qa("binSpacing",O,m):void 0,reverse:fe.get("reverse"),config:m})}return(Oo(Z)&&Ad(Ie)||it)&&!ue?function(ut,st,mt,dt){var en;const{markDef:mn,encoding:sn,config:In,stack:Fn}=dt,zn=mn.orient,Vn=dt.scaleName(mt),Qn=dt.getScaleComponent(mt),mr=x0(mt),Pr=b0(mt),Cr=zn==="horizontal"&&mt==="y"||zn==="vertical"&&mt==="x",Jr=qa(Cr?"size":mr,mn,In,{vgChannel:mr});let gi;(sn.size||Jr!==void 0)&&(Cr?gi=Wc("size",dt,{vgChannel:mr,defaultValue:Jr}):Gr(de.cannotApplySizeToNonOrientedMark(mn.type)));const vi=(en=Oo(st)?sx({channel:mt,fieldDef:st,markDef:mn,stack:Fn,config:In}):void 0)!==null&&en!==void 0?en:1;gi=gi||{[mr]:function(vo,na,Ui,va,ya,Ha){if(va){const gs=va.get("type");if(gs==="point"||gs==="band"){if(ya[vo].discreteBandSize!==void 0)return{value:ya[vo].discreteBandSize};if(gs===Zu.POINT){const kl=va.get("range");return Jv(kl)&&Ju(kl.step)?{value:kl.step-2}:{value:BO-2}}return{scale:Ui,band:Ha}}return{value:ya[vo].continuousBandSize}}const Ns=ok(ya.view,na),Fs=Qu(ya[vo].discreteBandSize,Ns-2);return Fs!==void 0?{value:Fs}:void 0}(ut,mr,Vn,Qn,In,vi)};const zi=(Qn==null?void 0:Qn.get("type"))!=="band"||!("band"in gi[mr]),wi=uI(mt,mn,In,zi?"middle":"top"),yi=fk(mt,mn),_i=lO({channel:mt,channelDef:st,markDef:mn,config:In,scaleName:Vn,scale:Qn,stack:Fn,offset:yi,defaultRef:VO({model:dt,defaultPos:"mid",channel:mt,scaleName:Vn,scale:Qn}),band:zi?.5:(1-vi)/2});if(mr)return Object.assign({[wi]:_i},gi);{const vo=Kv(Pr),na=gi[mr],Ui=yi?Object.assign(Object.assign({},na),{offset:yi}):na;return{[wi]:_i,[vo]:Gi(_i)?[_i[0],Object.assign(Object.assign({},_i[1]),{offset:Ui})]:Object.assign(Object.assign({},_i),{offset:Ui})}}}(n,Z,t,e):cI(t,e,{defaultPos:"zeroOrMax",defaultPos2:"zeroOrMin"})}function dx(e,t,n,r,i){if(dN(e))return 0;const s=e==="x"||e==="y2"?-t/2:t/2;if(po(n)){const f=cx(i);return{signal:`${n.signal} ? ${r-s}${f?"-"+f:""} : ${r+s}${f?"+"+f:""}`}}if(po(i)){const f=r+(n?-s:s);return{signal:`${f||""}${n?" - ":f?" + ":""}${i.signal}`}}return i=i||0,r+(n?-i-s:+i+s)}function lI({channel:e,fieldDef:t,scaleName:n,markDef:r,band:i,offset:s,config:f}){return VN({fieldDef:t,channel:e,markDef:r,ref:$w({scaleName:n,fieldOrDatumDef:t,band:i,offset:s}),config:f})}const Tz=new Set(["aria"]);function ym(e,t){const{fill:n,stroke:r}=t.color==="include"?sI(e):{};return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},function(i,s){return xL.reduce((f,m)=>(Tz.has(m)||i[m]===void 0||s[m]==="ignore"||(f[m]=ju(i[m])),f),{})}(e.markDef,t)),fI(e,"fill",n)),fI(e,"stroke",r)),Wc("opacity",e)),Wc("fillOpacity",e)),Wc("strokeOpacity",e)),Wc("strokeWidth",e)),Wc("strokeDash",e)),iI(e)),WO(e,"href")),Sz(e))}function fI(e,t,n){const{config:r,mark:i,markDef:s}=e;if(qa("invalid",s,r)==="hide"&&n&&!Fy(i)){const f=function(m,{invalid:x=!1,channels:O}){const T=O.reduce((H,Z)=>{const ue=m.getScaleComponent(Z);if(ue){const fe=ue.get("type"),Ie=m.vgField(Z,{expr:"datum"});Ie&&vm(fe)&&(H[Ie]=!0)}return H},{}),M=Kr(T);if(M.length>0){const H=x?"||":"&&";return M.map(Z=>fO(Z,x)).join(` ${H} `)}}(e,{invalid:!0,channels:Uw});if(f)return{[t]:[{test:f,value:null},...Mu(n)]}}return n?{[t]:n}:{}}function qO(e){const{config:t,markDef:n}=e;if(qa("invalid",n,t)){const r=function(i,{invalid:s=!1,channels:f}){const m=f.reduce((O,T)=>{const M=i.getScaleComponent(T);if(M){const H=M.get("type"),Z=i.vgField(T,{expr:"datum"});Z&&vm(H)&&(O[Z]=!0)}return O},{}),x=Kr(m);if(x.length>0){const O=s?"||":"&&";return x.map(T=>fO(T,s)).join(` ${O} `)}}(e,{channels:gm});if(r)return{defined:{signal:r}}}return{}}function hI(e,t){if(t!==void 0)return{[e]:ju(t)}}var dI={has:e=>e.type!=="interval"&&e.nearest,parse:(e,t)=>{if(t.events)for(const n of t.events)n.markname=e.getName("voronoi")},marks:(e,t,n)=>{const{x:r,y:i}=t.project.hasChannel,s=e.mark;if(Fy(s))return Gr(de.nearestNotSupportForContinuous(s)),n;const f={name:e.getName("voronoi"),type:"path",interactive:!0,from:{data:e.getName("marks")},encode:{update:Object.assign({fill:{value:"transparent"},strokeWidth:{value:.35},stroke:{value:"transparent"},isVoronoi:{value:!0}},iI(e,{reactiveGeom:!0}))},transform:[{type:"voronoi",x:{expr:r||!i?"datum.datum.x || 0":"0"},y:{expr:i||!r?"datum.datum.y || 0":"0"},size:[e.getSizeSignalRef("width"),e.getSizeSignalRef("height")]}]};let m=0,x=!1;return n.forEach((O,T)=>{var M;const H=(M=O.name)!==null&&M!==void 0?M:"";H===e.component.mark[0].name?m=T:H.indexOf("voronoi")>=0&&(x=!0)}),x||n.splice(m+1,0,f),n}};class os{constructor(t,n){this.debugName=n,this._children=[],this._parent=null,t&&(this.parent=t)}clone(){throw new Error("Cannot clone node")}get parent(){return this._parent}set parent(t){this._parent=t,t&&t.addChild(this)}get children(){return this._children}numChildren(){return this._children.length}addChild(t,n){this._children.indexOf(t)>-1?console.warn("Attempt to add the same child twice."):n!==void 0?this._children.splice(n,0,t):this._children.push(t)}removeChild(t){const n=this._children.indexOf(t);return this._children.splice(n,1),n}remove(){let t=this._parent.removeChild(this);for(const n of this._children)n._parent=this._parent,this._parent.addChild(n,t++)}insertAsParentOf(t){const n=t.parent;n.removeChild(this),this.parent=n,t.parent=this}swapWithParent(){const t=this._parent,n=t.parent;for(const r of this._children)r.parent=t;this._children=[],t.removeChild(this),t.parent.removeChild(t),this.parent=n,t.parent=this}}class wh extends os{constructor(t,n,r,i){super(t,n),this.type=r,this.refCounts=i,this._source=this._name=n,!this.refCounts||this._name in this.refCounts||(this.refCounts[this._name]=0)}clone(){const t=new this.constructor;return t.debugName="clone_"+this.debugName,t._source=this._source,t._name="clone_"+this._name,t.type=this.type,t.refCounts=this.refCounts,t.refCounts[t._name]=0,t}dependentFields(){return new Set}producedFields(){return new Set}hash(){return this._hash===void 0&&(this._hash=`Output ${O7()}`),this._hash}getSource(){return this.refCounts[this._name]++,this._source}isRequired(){return!!this.refCounts[this._name]}setSource(t){this._source=t}}class S0 extends os{constructor(t,n){super(t),this.formula=n}clone(){return new S0(null,Go(this.formula))}static makeFromEncoding(t,n){const r=n.reduceFieldDef((i,s,f)=>{const{field:m,timeUnit:x}=s,O=yu(n)?n.encoding[b0(f)]:void 0,T=yu(n)&&mO(f,s,O,n.stack,n.markDef,n.config);if(x){const M=ei(s,{forAs:!0});i[Ea({as:M,field:m,timeUnit:x})]=Object.assign({as:M,field:m,timeUnit:x},T?{band:!0}:{})}return i},{});return ms(r)?null:new S0(t,r)}static makeFromTransform(t,n){const r=Object.assign({},n),{timeUnit:i}=r,s=Li(r,["timeUnit"]),f=xh(i),m=Object.assign(Object.assign({},s),{timeUnit:f});return new S0(t,{[Ea(m)]:m})}merge(t){this.formula=Object.assign({},this.formula);for(const n in t.formula)this.formula[n]&&!t.formula[n].band||(this.formula[n]=t.formula[n]);for(const n of t.children)t.removeChild(n),n.parent=this;t.remove()}producedFields(){return new Set(Uv(this.formula).map(t=>t.as))}dependentFields(){return new Set(Uv(this.formula).map(t=>t.field))}hash(){return`TimeUnit ${Ea(this.formula)}`}assemble(){const t=[];for(const n of Uv(this.formula)){const{field:r,as:i,timeUnit:s}=n,f=xh(s),{unit:m,utc:x}=f,O=Li(f,["unit","utc"]);t.push(Object.assign(Object.assign(Object.assign(Object.assign({field:Wv(r),type:"timeunit"},m?{units:tO(m)}:{}),x?{timezone:"utc"}:{}),O),{as:[i,`${i}_end`]}))}return t}}const px="_tuple_fields";var pI={has:e=>e.type==="single"&&e.resolve==="global"&&e.bind&&e.bind!=="scales"&&!FO(e.bind),parse:(e,t,n,r)=>{r.on||delete t.events,r.clear||delete t.clear},topLevelSignals:(e,t,n)=>{const r=t.name,i=t.project,s=t.bind,f=t.init&&t.init[0],m=dI.has(t)?"(item().isVoronoi ? datum.datum : datum)":"datum";return i.items.forEach((x,O)=>{var T,M;const H=eu(`${r}_${x.field}`);n.filter(Z=>Z.name===H).length||n.unshift(Object.assign(Object.assign({name:H},f?{init:F1(f[O])}:{value:null}),{on:t.events?[{events:t.events,update:`datum && item().mark.marktype !== 'group' ? ${m}[${ga(x.field)}] : null`}]:[],bind:(M=(T=s[x.field])!==null&&T!==void 0?T:s[x.channel])!==null&&M!==void 0?M:s}))}),n},signals:(e,t,n)=>{const r=t.name,i=t.project,s=n.filter(O=>O.name===r+_0)[0],f=r+px,m=i.items.map(O=>eu(`${r}_${O.field}`)),x=m.map(O=>`${O} !== null`).join(" && ");return m.length&&(s.update=`${x} ? {fields: ${f}, values: [${m.join(", ")}]} : null`),delete s.value,delete s.on,n}},mI={has:e=>e.type==="multi"&&!!e.toggle,signals:(e,t,n)=>n.concat({name:t.name+"_toggle",value:!1,on:[{events:t.events,update:t.toggle}]}),modifyExpr:(e,t)=>{const n=t.name+_0,r=t.name+"_toggle";return`${r} ? null : ${n}, `+(t.resolve==="global"?`${r} ? null : true, `:`${r} ? null : {unit: ${hv(e)}}, `)+`${r} ? ${n} : null`}},iy={has:e=>e.type==="interval"&&e.resolve==="global"&&e.bind&&e.bind==="scales",parse:(e,t)=>{const n=t.scales=[];for(const r of t.project.items){const i=r.channel;if(!Yv(i))continue;const s=e.getScaleComponent(i),f=s?s.get("type"):void 0;if(!s||!vm(f)){Gr(de.SCALE_BINDINGS_CONTINUOUS);continue}const m={selection:t.name,field:r.field};s.set("selectionExtent",m,!0),n.push(r)}},topLevelSignals:(e,t,n)=>{const r=t.scales.filter(f=>n.filter(m=>m.name===f.signals.data).length===0);if(!e.parent||$O(e)||r.length===0)return n;const i=n.filter(f=>f.name===t.name)[0];let s=i.update;if(s.indexOf(AI)>=0)i.update=`{${r.map(f=>`${ga(f.field)}: ${f.signals.data}`).join(", ")}}`;else{for(const f of r){const m=`${ga(f.field)}: ${f.signals.data}`;s.indexOf(m)<0&&(s=`${s.substring(0,s.length-1)}, ${m}}`)}i.update=s}return n.concat(r.map(f=>({name:f.signals.data})))},signals:(e,t,n)=>{if(e.parent&&!$O(e))for(const r of t.scales){const i=n.filter(s=>s.name===r.signals.data)[0];i.push="outer",delete i.value,delete i.update}return n}};function HO(e,t){return`domain(${ga(e.scaleName(t))})`}function $O(e){var t;return e.parent&&U1(e.parent)&&((t=!e.parent.parent)!==null&&t!==void 0?t:$O(e.parent.parent))}const gI={has:e=>{const t=e.resolve==="global"&&e.bind&&FO(e.bind),n=e.project.items.length===1&&e.project.items[0].field!==N1;return t&&!n&&Gr(de.LEGEND_BINDINGS_PROJECT_LENGTH),t&&n},parse:(e,t,n,r)=>{var i;if(r.on||delete t.events,r.clear||delete t.clear,r.on||r.clear){const m='event.item && indexof(event.item.mark.role, "legend") < 0';for(const x of t.events)x.filter=Mu((i=x.filter)!==null&&i!==void 0?i:[]),x.filter.indexOf(m)<0&&x.filter.push(m)}const s=IO(t.bind)?t.bind.legend:"click",f=$o(s)?_y(s,"view"):Mu(s);t.bind={legend:{merge:f}}},topLevelSignals:(e,t,n)=>{const r=t.name,i=IO(t.bind)&&t.bind.legend,s=f=>m=>{const x=Go(m);return x.markname=f,x};for(const f of t.project.items){if(!f.hasLegend)continue;const m=`${eu(f.field)}_legend`,x=`${r}_${m}`;if(n.filter(O=>O.name===x).length===0){const O=i.merge.map(s(`${m}_symbols`)).concat(i.merge.map(s(`${m}_labels`))).concat(i.merge.map(s(`${m}_entries`)));n.unshift(Object.assign(Object.assign({name:x},t.init?{}:{value:null}),{on:[{events:O,update:"datum.value || item().items[0].items[0].datum.value",force:!0},{events:i.merge,update:`!event.item || !datum ? null : ${x}`,force:!0}]}))}}return n},signals:(e,t,n)=>{const r=t.name,i=t.project,s=n.find(M=>M.name===r+_0),f=r+px,m=i.items.filter(M=>M.hasLegend).map(M=>eu(`${r}_${eu(M.field)}_legend`)),x=`${m.map(M=>`${M} !== null`).join(" && ")} ? {fields: ${f}, values: [${m.join(", ")}]} : null`;t.events&&m.length>0?s.on.push({events:m.map(M=>({signal:M})),update:x}):m.length>0&&(s.update=x,delete s.value,delete s.on);const O=n.find(M=>M.name===r+"_toggle"),T=IO(t.bind)&&t.bind.legend;return O&&(t.events?O.on.push(Object.assign(Object.assign({},O.on[0]),{events:T})):O.on[0].events=T),n}},vI="_translate_anchor",yI="_translate_delta";function bI(e,t,n,r,i){var s;const f=t.name,m=f+vI,x=f+yI,O=n.channel,T=iy.has(t),M=i.filter(Pe=>Pe.name===n.signals[T?"data":"visual"])[0],H=e.getSizeSignalRef(r).signal,Z=e.getScaleComponent(O),ue=Z.get("type"),fe=`${m}.extent_${O}`,Ie=`${T?ue==="log"?"panLog":ue==="pow"?"panPow":"panLinear":"panLinear"}(${fe}, ${`${T&&O===uu?"-":""}${x}.${O} / `+(T?`${H}`:`span(${fe})`)}`+(T&&ue==="pow"?`, ${(s=Z.get("exponent"))!==null&&s!==void 0?s:1}`:"")+")";M.on.push({events:{signal:x},update:T?Ie:`clampRange(${Ie}, 0, ${H})`})}const xI="_zoom_anchor",wI="_zoom_delta";function kI(e,t,n,r,i){var s;const f=t.name,m=n.channel,x=iy.has(t),O=i.filter(Ie=>Ie.name===n.signals[x?"data":"visual"])[0],T=e.getSizeSignalRef(r).signal,M=e.getScaleComponent(m),H=M.get("type"),Z=x?HO(e,m):O.name,ue=f+wI,fe=`${x?H==="log"?"zoomLog":H==="pow"?"zoomPow":"zoomLinear":"zoomLinear"}(${Z}, ${`${f}${xI}.${m}`}, ${ue}`+(x&&H==="pow"?`, ${(s=M.get("exponent"))!==null&&s!==void 0?s:1}`:"")+")";O.on.push({events:{signal:ue},update:x?fe:`clampRange(${fe}, 0, ${T})`})}const Nz=[{has:()=>!0,parse:(e,t,n)=>{var r,i,s;const f=t.name,m=(r=t.project)!==null&&r!==void 0?r:t.project=new class{constructor(...H){this.items=H,this.hasChannel={},this.hasField={}}},x={},O={},T=new Set,M=(H,Z)=>{const ue=Z==="visual"?H.channel:H.field;let fe=eu(`${f}_${ue}`);for(let Ie=1;T.has(fe);Ie++)fe=eu(`${f}_${ue}_${Ie}`);return T.add(fe),{[Z]:fe}};if(!n.fields&&!n.encodings){const H=e.config.selection[n.type];if(n.init)for(const Z of Mu(n.init))for(const ue of Kr(Z))V7(ue)?(n.encodings||(n.encodings=[])).push(ue):n.type==="interval"?(Gr('Interval selections should be initialized using "x" and/or "y" keys.'),n.encodings=H.encodings):(n.fields||(n.fields=[])).push(ue);else n.encodings=H.encodings,n.fields=H.fields}for(const H of(i=n.fields)!==null&&i!==void 0?i:[]){const Z={type:"E",field:H};Z.signals=Object.assign({},M(Z,"data")),m.items.push(Z),m.hasField[H]=Z}for(const H of(s=n.encodings)!==null&&s!==void 0?s:[]){const Z=e.fieldDef(H);if(Z){let ue=Z.field;if(Z.aggregate){Gr(de.cannotProjectAggregate(H,Z.aggregate));continue}if(!ue){Gr(de.cannotProjectOnChannelWithoutField(H));continue}if(Z.timeUnit){ue=e.vgField(H);const fe={timeUnit:Z.timeUnit,as:ue,field:Z.field};O[Ea(fe)]=fe}if(!x[ue]){let fe="E";t.type==="interval"?vm(e.getScaleComponent(H).get("type"))&&(fe="R"):Z.bin&&(fe="R-RE");const Ie={field:ue,channel:H,type:fe};Ie.signals=Object.assign(Object.assign({},M(Ie,"data")),M(Ie,"visual")),m.items.push(x[ue]=Ie),m.hasField[ue]=m.hasChannel[H]=x[ue]}}else Gr(de.cannotProjectOnChannelWithoutField(H))}if(n.init){const H=Z=>m.items.map(ue=>Z[ue.channel]!==void 0?Z[ue.channel]:Z[ue.field]);if(n.type==="interval")t.init=H(n.init);else{const Z=Mu(n.init);t.init=Z.map(H)}}ms(O)||(m.timeUnit=new S0(null,O))},signals:(e,t,n)=>{const r=t.name+px;return n.filter(i=>i.name===r).length>0?n:n.concat({name:r,value:t.project.items.map(i=>{const s=Li(i,["signals","hasLegend"]);return s.field=Wv(s.field),s})})}},mI,iy,gI,{has:e=>e.type==="interval"&&e.translate,signals:(e,t,n)=>{const r=t.name,i=iy.has(t),s=r+vI,{x:f,y:m}=t.project.hasChannel;let x=_y(t.translate,"scope");return i||(x=x.map(O=>(O.between[0].markname=r+mx,O))),n.push({name:s,value:{},on:[{events:x.map(O=>O.between[0]),update:"{x: x(unit), y: y(unit)"+(f!==void 0?", extent_x: "+(i?HO(e,uu):`slice(${f.signals.visual})`):"")+(m!==void 0?", extent_y: "+(i?HO(e,vc):`slice(${m.signals.visual})`):"")+"}"}]},{name:r+yI,value:{},on:[{events:x,update:`{x: ${s}.x - x(unit), y: ${s}.y - y(unit)}`}]}),f!==void 0&&bI(e,t,f,"width",n),m!==void 0&&bI(e,t,m,"height",n),n}},{has:e=>e.type==="interval"&&e.zoom,signals:(e,t,n)=>{const r=t.name,i=iy.has(t),s=r+wI,{x:f,y:m}=t.project.hasChannel,x=ga(e.scaleName(uu)),O=ga(e.scaleName(vc));let T=_y(t.zoom,"scope");return i||(T=T.map(M=>(M.markname=r+mx,M))),n.push({name:r+xI,on:[{events:T,update:i?"{"+[x?`x: invert(${x}, x(unit))`:"",O?`y: invert(${O}, y(unit))`:""].filter(M=>!!M).join(", ")+"}":"{x: x(unit), y: y(unit)}"}]},{name:s,on:[{events:T,force:!0,update:"pow(1.001, event.deltaY * pow(16, event.deltaMode))"}]}),f!==void 0&&kI(e,t,f,"width",n),m!==void 0&&kI(e,t,m,"height",n),n}},pI,dI,{has:e=>e.clear!==void 0&&e.clear!==!1,parse:(e,t,n)=>{n.clear&&(t.clear=$o(n.clear)?_y(n.clear,"scope"):n.clear)},topLevelSignals:(e,t,n)=>{if(pI.has(t))for(const r of t.project.items){const i=n.findIndex(s=>s.name===eu(`${t.name}_${r.field}`));i!==-1&&n[i].on.push({events:t.clear,update:"null"})}return n},signals:(e,t,n)=>{function r(i,s){i!==-1&&n[i].on&&n[i].on.push({events:t.clear,update:s})}if(t.type==="interval")for(const i of t.project.items){const s=n.findIndex(f=>f.name===i.signals.visual);r(s,"[0, 0]"),s===-1&&r(n.findIndex(f=>f.name===i.signals.data),"null")}else{let i=n.findIndex(s=>s.name===t.name+_0);r(i,"null"),mI.has(t)&&r(i=n.findIndex(s=>s.name===t.name+"_toggle"),"false")}return n}}];function pk(e,t){for(const n of Nz)n.has(e)&&t(n)}function F1(e,t=!0,n=d7){if(Gi(e)){const r=e.map(i=>F1(i,t,n));return t?`[${r.join(", ")}]`:r}return S1(e)?n(t?ix(e):function(r){const i=QC(r,!0);return r.utc?+new Date(Date.UTC(...i)):+new Date(...i)}(e)):t?n(JSON.stringify(e)):e}function EI(e,t){return Gy(e,(n,r)=>{t=r.marks?r.marks(e,n,t):t,pk(n,i=>{i.marks&&(t=i.marks(e,n,t))})}),t}function GO(e){return e.map(t=>(t.on&&!t.on.length&&delete t.on,t))}const mx="_brush",KO="_scale_trigger",Fz={signals:(e,t)=>{const n=t.name,r=n+px,i=iy.has(t),s=[],f=[],m=[];if(t.translate&&!i){const T=`!event.item || event.item.mark.name !== ${ga(n+mx)}`;CI(t,(M,H)=>{var Z;const ue=Mu((Z=H.between[0].filter)!==null&&Z!==void 0?Z:H.between[0].filter=[]);return ue.indexOf(T)<0&&ue.push(T),M})}t.project.items.forEach((T,M)=>{const H=T.channel;if(H!==uu&&H!==vc)return void Gr("Interval selections only support x and y encoding channels.");const Z=t.init?t.init[M]:null,ue=function(rt,it,ut,st){const mt=ut.channel,dt=ut.signals.visual,en=ut.signals.data,mn=iy.has(it),sn=ga(rt.scaleName(mt)),In=rt.getScaleComponent(mt),Fn=In?In.get("type"):void 0,zn=Pr=>`scale(${sn}, ${Pr})`,Vn=rt.getSizeSignalRef(mt===uu?"width":"height").signal,Qn=`${mt}(unit)`,mr=CI(it,(Pr,Cr)=>[...Pr,{events:Cr.between[0],update:`[${Qn}, ${Qn}]`},{events:Cr,update:`[${dt}[0], clamp(${Qn}, 0, ${Vn})]`}]);return mr.push({events:{signal:it.name+KO},update:vm(Fn)?`[${zn(`${en}[0]`)}, ${zn(`${en}[1]`)}]`:"[0, 0]"}),mn?[{name:en,on:[]}]:[Object.assign(Object.assign({name:dt},st?{init:F1(st,!0,zn)}:{value:[]}),{on:mr}),Object.assign(Object.assign({name:en},st?{init:F1(st)}:{}),{on:[{events:{signal:dt},update:`${dt}[0] === ${dt}[1] ? null : invert(${sn}, ${dt})`}]})]}(e,t,T,Z),fe=T.signals.data,Ie=T.signals.visual,Pe=ga(e.scaleName(H)),Le=vm(e.getScaleComponent(H).get("type"))?"+":"";s.push(...ue),f.push(fe),m.push({scaleName:e.scaleName(H),expr:`(!isArray(${fe}) || (${Le}invert(${Pe}, ${Ie})[0] === ${Le}${fe}[0] && ${Le}invert(${Pe}, ${Ie})[1] === ${Le}${fe}[1]))`})}),i||s.push({name:n+KO,value:{},on:[{events:m.map(T=>({scale:T.scaleName})),update:m.map(T=>T.expr).join(" && ")+` ? ${n+KO} : {}`}]});const x=t.init,O=`unit: ${hv(e)}, fields: ${r}, values`;return s.concat(Object.assign(Object.assign({name:n+_0},x?{init:`{${O}: ${F1(x)}}`}:{}),{on:[{events:[{signal:f.join(" || ")}],update:f.join(" && ")+` ? {${O}: [${f}]} : null`}]}))},modifyExpr:(e,t)=>t.name+_0+", "+(t.resolve==="global"?"true":`{unit: ${hv(e)}}`),marks:(e,t,n)=>{const r=t.name,{x:i,y:s}=t.project.hasChannel,f=i&&i.signals.visual,m=s&&s.signals.visual,x=`data(${ga(t.name+$y)})`;if(iy.has(t))return n;const O={x:i!==void 0?{signal:`${f}[0]`}:{value:0},y:s!==void 0?{signal:`${m}[0]`}:{value:0},x2:i!==void 0?{signal:`${f}[1]`}:{field:{group:"width"}},y2:s!==void 0?{signal:`${m}[1]`}:{field:{group:"height"}}};if(t.resolve==="global")for(const Ie of Kr(O))O[Ie]=[Object.assign({test:`${x}.length && ${x}[0].unit === ${hv(e)}`},O[Ie]),{value:0}];const T=t.mark,{fill:M,fillOpacity:H,cursor:Z}=T,ue=Li(T,["fill","fillOpacity","cursor"]),fe=Kr(ue).reduce((Ie,Pe)=>(Ie[Pe]=[{test:[i!==void 0&&`${f}[0] !== ${f}[1]`,s!==void 0&&`${m}[0] !== ${m}[1]`].filter(Le=>Le).join(" && "),value:ue[Pe]},{value:null}],Ie),{});return[{name:r+mx+"_bg",type:"rect",clip:!0,encode:{enter:{fill:{value:M},fillOpacity:{value:H}},update:O}},...n,{name:r+mx,type:"rect",clip:!0,encode:{enter:Object.assign(Object.assign({},Z?{cursor:{value:Z}}:{}),{fill:{value:"transparent"}}),update:Object.assign(Object.assign({},O),fe)}}]}};function CI(e,t){return e.events.reduce((n,r)=>r.between?t(n,r):(Gr(`${r} is not an ordered event stream for interval selections.`),n),[])}function OI(e,t){const n=t.name,r=n+px,i="(item().isVoronoi ? datum.datum : datum)",s=t.project.items.map(x=>{const O=e.fieldDef(x.channel);return O&&O.bin?`[${i}[${ga(e.vgField(x.channel,{}))}], ${i}[${ga(e.vgField(x.channel,{binSuffix:"end"}))}]]`:`${i}[${ga(x.field)}]`}).join(", "),f=`unit: ${hv(e)}, fields: ${r}, values`,m=t.events;return[{name:n+_0,on:m?[{events:m,update:`datum && item().mark.marktype !== 'group' ? {${f}: [${s}]} : null`,force:!0}]:[]}]}const Iz={signals:OI,modifyExpr:(e,t)=>t.name+_0+", "+(t.resolve==="global"?"null":`{unit: ${hv(e)}}`)},Rz={signals:OI,modifyExpr:(e,t)=>t.name+_0+", "+(t.resolve==="global"?"true":`{unit: ${hv(e)}}`)},$y="_store",_0="_tuple",Mz="_modify",AI="vlSelectionResolve",jz={single:Rz,multi:Iz,interval:Fz};function Gy(e,t){const n=e.component.selection;if(n){for(const r of Uv(n))if(t(r,jz[r.type])===!0)break}}function hv(e,{escape:t}={escape:!0}){let n=t?ga(e.name):e.name;const r=function(i){let s=i.parent;for(;s&&!gg(s);)s=s.parent;return s}(e);if(r){const{facet:i}=r;for(const s of mm)i[s]&&(n+=` + '__facet_${s}_' + (facet[${ga(r.vgField(s))}])`)}return n}function XO(e){let t=!1;return Gy(e,n=>{t=t||n.project.items.some(r=>r.field===N1)}),t}const Bz="RawCode",Pz="Literal",Lz="Property",zz="Identifier",Uz="ArrayExpression",Wz="BinaryExpression",Vz="CallExpression",qz="ConditionalExpression",Hz="LogicalExpression",$z="MemberExpression",Gz="ObjectExpression",Kz="UnaryExpression";function dg(e){this.type=e}var dv,Si,_r,df,Qa;dg.prototype.visit=function(e){let t,n,r;if(e(this))return 1;for(n=0,r=(t=function(i){switch(i.type){case Uz:return i.elements;case Wz:case Hz:return[i.left,i.right];case Vz:return[i.callee].concat(i.arguments);case qz:return[i.test,i.consequent,i.alternate];case $z:return[i.object,i.property];case Gz:return i.properties;case Lz:return[i.key,i.value];case Kz:return[i.argument];case zz:case Pz:case Bz:default:return[]}}(this)).length;n<r;++n)if(t[n].visit(e))return 1};var mk=1,gx=2,Ky=3,oy=4,gk=5,Xy=6,Sd=7,vx=8;(dv={})[mk]="Boolean",dv[gx]="<end>",dv[Ky]="Identifier",dv[oy]="Keyword",dv[gk]="Null",dv[Xy]="Numeric",dv[Sd]="Punctuator",dv[vx]="String",dv[9]="RegularExpression";var Xz="ArrayExpression",Yz="BinaryExpression",Jz="CallExpression",Qz="ConditionalExpression",SI="Identifier",Zz="Literal",eU="LogicalExpression",tU="MemberExpression",nU="ObjectExpression",rU="Property",iU="UnaryExpression",wl="Unexpected token %0",oU="Unexpected number",aU="Unexpected string",sU="Unexpected identifier",uU="Unexpected reserved word",cU="Unexpected end of input",YO="Invalid regular expression",JO="Invalid regular expression: missing /",_I="Octal literals are not allowed in strict mode.",lU="Duplicate data property in object literal not allowed in strict mode",pf="ILLEGAL",yx="Disabled.",fU=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0370-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0620-\\u064A\\u066E\\u066F\\u0671-\\u06D3\\u06D5\\u06E5\\u06E6\\u06EE\\u06EF\\u06FA-\\u06FC\\u06FF\\u0710\\u0712-\\u072F\\u074D-\\u07A5\\u07B1\\u07CA-\\u07EA\\u07F4\\u07F5\\u07FA\\u0800-\\u0815\\u081A\\u0824\\u0828\\u0840-\\u0858\\u08A0-\\u08B2\\u0904-\\u0939\\u093D\\u0950\\u0958-\\u0961\\u0971-\\u0980\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BD\\u09CE\\u09DC\\u09DD\\u09DF-\\u09E1\\u09F0\\u09F1\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A59-\\u0A5C\\u0A5E\\u0A72-\\u0A74\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABD\\u0AD0\\u0AE0\\u0AE1\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3D\\u0B5C\\u0B5D\\u0B5F-\\u0B61\\u0B71\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BD0\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D\\u0C58\\u0C59\\u0C60\\u0C61\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBD\\u0CDE\\u0CE0\\u0CE1\\u0CF1\\u0CF2\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D\\u0D4E\\u0D60\\u0D61\\u0D7A-\\u0D7F\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0E01-\\u0E30\\u0E32\\u0E33\\u0E40-\\u0E46\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB0\\u0EB2\\u0EB3\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EDC-\\u0EDF\\u0F00\\u0F40-\\u0F47\\u0F49-\\u0F6C\\u0F88-\\u0F8C\\u1000-\\u102A\\u103F\\u1050-\\u1055\\u105A-\\u105D\\u1061\\u1065\\u1066\\u106E-\\u1070\\u1075-\\u1081\\u108E\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1711\\u1720-\\u1731\\u1740-\\u1751\\u1760-\\u176C\\u176E-\\u1770\\u1780-\\u17B3\\u17D7\\u17DC\\u1820-\\u1877\\u1880-\\u18A8\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1950-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19C1-\\u19C7\\u1A00-\\u1A16\\u1A20-\\u1A54\\u1AA7\\u1B05-\\u1B33\\u1B45-\\u1B4B\\u1B83-\\u1BA0\\u1BAE\\u1BAF\\u1BBA-\\u1BE5\\u1C00-\\u1C23\\u1C4D-\\u1C4F\\u1C5A-\\u1C7D\\u1CE9-\\u1CEC\\u1CEE-\\u1CF1\\u1CF5\\u1CF6\\u1D00-\\u1DBF\\u1E00-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u2071\\u207F\\u2090-\\u209C\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CEE\\u2CF2\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D80-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2E2F\\u3005-\\u3007\\u3021-\\u3029\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA61F\\uA62A\\uA62B\\uA640-\\uA66E\\uA67F-\\uA69D\\uA6A0-\\uA6EF\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA801\\uA803-\\uA805\\uA807-\\uA80A\\uA80C-\\uA822\\uA840-\\uA873\\uA882-\\uA8B3\\uA8F2-\\uA8F7\\uA8FB\\uA90A-\\uA925\\uA930-\\uA946\\uA960-\\uA97C\\uA984-\\uA9B2\\uA9CF\\uA9E0-\\uA9E4\\uA9E6-\\uA9EF\\uA9FA-\\uA9FE\\uAA00-\\uAA28\\uAA40-\\uAA42\\uAA44-\\uAA4B\\uAA60-\\uAA76\\uAA7A\\uAA7E-\\uAAAF\\uAAB1\\uAAB5\\uAAB6\\uAAB9-\\uAABD\\uAAC0\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEA\\uAAF2-\\uAAF4\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABE2\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D\\uFB1F-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF21-\\uFF3A\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]"),hU=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0300-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u0483-\\u0487\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u0591-\\u05BD\\u05BF\\u05C1\\u05C2\\u05C4\\u05C5\\u05C7\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0610-\\u061A\\u0620-\\u0669\\u066E-\\u06D3\\u06D5-\\u06DC\\u06DF-\\u06E8\\u06EA-\\u06FC\\u06FF\\u0710-\\u074A\\u074D-\\u07B1\\u07C0-\\u07F5\\u07FA\\u0800-\\u082D\\u0840-\\u085B\\u08A0-\\u08B2\\u08E4-\\u0963\\u0966-\\u096F\\u0971-\\u0983\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BC-\\u09C4\\u09C7\\u09C8\\u09CB-\\u09CE\\u09D7\\u09DC\\u09DD\\u09DF-\\u09E3\\u09E6-\\u09F1\\u0A01-\\u0A03\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A3C\\u0A3E-\\u0A42\\u0A47\\u0A48\\u0A4B-\\u0A4D\\u0A51\\u0A59-\\u0A5C\\u0A5E\\u0A66-\\u0A75\\u0A81-\\u0A83\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABC-\\u0AC5\\u0AC7-\\u0AC9\\u0ACB-\\u0ACD\\u0AD0\\u0AE0-\\u0AE3\\u0AE6-\\u0AEF\\u0B01-\\u0B03\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3C-\\u0B44\\u0B47\\u0B48\\u0B4B-\\u0B4D\\u0B56\\u0B57\\u0B5C\\u0B5D\\u0B5F-\\u0B63\\u0B66-\\u0B6F\\u0B71\\u0B82\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BBE-\\u0BC2\\u0BC6-\\u0BC8\\u0BCA-\\u0BCD\\u0BD0\\u0BD7\\u0BE6-\\u0BEF\\u0C00-\\u0C03\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D-\\u0C44\\u0C46-\\u0C48\\u0C4A-\\u0C4D\\u0C55\\u0C56\\u0C58\\u0C59\\u0C60-\\u0C63\\u0C66-\\u0C6F\\u0C81-\\u0C83\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBC-\\u0CC4\\u0CC6-\\u0CC8\\u0CCA-\\u0CCD\\u0CD5\\u0CD6\\u0CDE\\u0CE0-\\u0CE3\\u0CE6-\\u0CEF\\u0CF1\\u0CF2\\u0D01-\\u0D03\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D-\\u0D44\\u0D46-\\u0D48\\u0D4A-\\u0D4E\\u0D57\\u0D60-\\u0D63\\u0D66-\\u0D6F\\u0D7A-\\u0D7F\\u0D82\\u0D83\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0DCA\\u0DCF-\\u0DD4\\u0DD6\\u0DD8-\\u0DDF\\u0DE6-\\u0DEF\\u0DF2\\u0DF3\\u0E01-\\u0E3A\\u0E40-\\u0E4E\\u0E50-\\u0E59\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB9\\u0EBB-\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EC8-\\u0ECD\\u0ED0-\\u0ED9\\u0EDC-\\u0EDF\\u0F00\\u0F18\\u0F19\\u0F20-\\u0F29\\u0F35\\u0F37\\u0F39\\u0F3E-\\u0F47\\u0F49-\\u0F6C\\u0F71-\\u0F84\\u0F86-\\u0F97\\u0F99-\\u0FBC\\u0FC6\\u1000-\\u1049\\u1050-\\u109D\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u135D-\\u135F\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1714\\u1720-\\u1734\\u1740-\\u1753\\u1760-\\u176C\\u176E-\\u1770\\u1772\\u1773\\u1780-\\u17D3\\u17D7\\u17DC\\u17DD\\u17E0-\\u17E9\\u180B-\\u180D\\u1810-\\u1819\\u1820-\\u1877\\u1880-\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1920-\\u192B\\u1930-\\u193B\\u1946-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19B0-\\u19C9\\u19D0-\\u19D9\\u1A00-\\u1A1B\\u1A20-\\u1A5E\\u1A60-\\u1A7C\\u1A7F-\\u1A89\\u1A90-\\u1A99\\u1AA7\\u1AB0-\\u1ABD\\u1B00-\\u1B4B\\u1B50-\\u1B59\\u1B6B-\\u1B73\\u1B80-\\u1BF3\\u1C00-\\u1C37\\u1C40-\\u1C49\\u1C4D-\\u1C7D\\u1CD0-\\u1CD2\\u1CD4-\\u1CF6\\u1CF8\\u1CF9\\u1D00-\\u1DF5\\u1DFC-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u200C\\u200D\\u203F\\u2040\\u2054\\u2071\\u207F\\u2090-\\u209C\\u20D0-\\u20DC\\u20E1\\u20E5-\\u20F0\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D7F-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2DE0-\\u2DFF\\u2E2F\\u3005-\\u3007\\u3021-\\u302F\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u3099\\u309A\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA62B\\uA640-\\uA66F\\uA674-\\uA67D\\uA67F-\\uA69D\\uA69F-\\uA6F1\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA827\\uA840-\\uA873\\uA880-\\uA8C4\\uA8D0-\\uA8D9\\uA8E0-\\uA8F7\\uA8FB\\uA900-\\uA92D\\uA930-\\uA953\\uA960-\\uA97C\\uA980-\\uA9C0\\uA9CF-\\uA9D9\\uA9E0-\\uA9FE\\uAA00-\\uAA36\\uAA40-\\uAA4D\\uAA50-\\uAA59\\uAA60-\\uAA76\\uAA7A-\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEF\\uAAF2-\\uAAF6\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABEA\\uABEC\\uABED\\uABF0-\\uABF9\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE00-\\uFE0F\\uFE20-\\uFE2D\\uFE33\\uFE34\\uFE4D-\\uFE4F\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF10-\\uFF19\\uFF21-\\uFF3A\\uFF3F\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]");function vk(e,t){if(!e)throw new Error("ASSERT: "+t)}function pv(e){return e>=48&&e<=57}function QO(e){return"0123456789abcdefABCDEF".indexOf(e)>=0}function bx(e){return"01234567".indexOf(e)>=0}function dU(e){return e===32||e===9||e===11||e===12||e===160||e>=5760&&[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(e)>=0}function xx(e){return e===10||e===13||e===8232||e===8233}function wx(e){return e===36||e===95||e>=65&&e<=90||e>=97&&e<=122||e===92||e>=128&&fU.test(String.fromCharCode(e))}function yk(e){return e===36||e===95||e>=65&&e<=90||e>=97&&e<=122||e>=48&&e<=57||e===92||e>=128&&hU.test(String.fromCharCode(e))}var pU={if:1,in:1,do:1,var:1,for:1,new:1,try:1,let:1,this:1,else:1,case:1,void:1,with:1,enum:1,while:1,break:1,catch:1,throw:1,const:1,yield:1,class:1,super:1,return:1,typeof:1,delete:1,switch:1,export:1,import:1,public:1,static:1,default:1,finally:1,extends:1,package:1,private:1,function:1,continue:1,debugger:1,interface:1,protected:1,instanceof:1,implements:1};function DI(){for(var e;_r<df&&(dU(e=Si.charCodeAt(_r))||xx(e));)++_r}function ZO(e){var t,n,r,i=0;for(n=e==="u"?4:2,t=0;t<n;++t)_r<df&&QO(Si[_r])?(r=Si[_r++],i=16*i+"0123456789abcdef".indexOf(r.toLowerCase())):La({},wl,pf);return String.fromCharCode(i)}function mU(){var e,t,n,r;for(t=0,(e=Si[_r])==="}"&&La({},wl,pf);_r<df&&QO(e=Si[_r++]);)t=16*t+"0123456789abcdef".indexOf(e.toLowerCase());return(t>1114111||e!=="}")&&La({},wl,pf),t<=65535?String.fromCharCode(t):(n=55296+(t-65536>>10),r=56320+(t-65536&1023),String.fromCharCode(n,r))}function TI(){var e,t;for(e=Si.charCodeAt(_r++),t=String.fromCharCode(e),e===92&&(Si.charCodeAt(_r)!==117&&La({},wl,pf),++_r,(e=ZO("u"))&&e!=="\\"&&wx(e.charCodeAt(0))||La({},wl,pf),t=e);_r<df&&yk(e=Si.charCodeAt(_r));)++_r,t+=String.fromCharCode(e),e===92&&(t=t.substr(0,t.length-1),Si.charCodeAt(_r)!==117&&La({},wl,pf),++_r,(e=ZO("u"))&&e!=="\\"&&yk(e.charCodeAt(0))||La({},wl,pf),t+=e);return t}function gU(){var e,t;return e=_r,{type:(t=Si.charCodeAt(_r)===92?TI():function(){var n,r;for(n=_r++;_r<df;){if((r=Si.charCodeAt(_r))===92)return _r=n,TI();if(!yk(r))break;++_r}return Si.slice(n,_r)}()).length===1?Ky:pU.hasOwnProperty(t)?oy:t==="null"?gk:t==="true"||t==="false"?mk:Ky,value:t,start:e,end:_r}}function eA(){var e,t,n,r,i=_r,s=Si.charCodeAt(_r),f=Si[_r];switch(s){case 46:case 40:case 41:case 59:case 44:case 123:case 125:case 91:case 93:case 58:case 63:case 126:return++_r,{type:Sd,value:String.fromCharCode(s),start:i,end:_r};default:if((e=Si.charCodeAt(_r+1))===61)switch(s){case 43:case 45:case 47:case 60:case 62:case 94:case 124:case 37:case 38:case 42:return _r+=2,{type:Sd,value:String.fromCharCode(s)+String.fromCharCode(e),start:i,end:_r};case 33:case 61:return _r+=2,Si.charCodeAt(_r)===61&&++_r,{type:Sd,value:Si.slice(i,_r),start:i,end:_r}}}return(r=Si.substr(_r,4))===">>>="?{type:Sd,value:r,start:i,end:_r+=4}:(n=r.substr(0,3))===">>>"||n==="<<="||n===">>="?{type:Sd,value:n,start:i,end:_r+=3}:f===(t=n.substr(0,2))[1]&&"+-<>&|".indexOf(f)>=0||t==="=>"?{type:Sd,value:t,start:i,end:_r+=2}:"<>=!+-*%&|^/".indexOf(f)>=0?{type:Sd,value:f,start:i,end:++_r}:void La({},wl,pf)}function NI(){var e,t,n;if(vk(pv((n=Si[_r]).charCodeAt(0))||n===".","Numeric literal must start with a decimal digit or a decimal point"),t=_r,e="",n!=="."){if(e=Si[_r++],n=Si[_r],e==="0"){if(n==="x"||n==="X")return++_r,function(r){for(var i="";_r<df&&QO(Si[_r]);)i+=Si[_r++];return i.length===0&&La({},wl,pf),wx(Si.charCodeAt(_r))&&La({},wl,pf),{type:Xy,value:parseInt("0x"+i,16),start:r,end:_r}}(t);if(bx(n))return function(r){for(var i="0"+Si[_r++];_r<df&&bx(Si[_r]);)i+=Si[_r++];return(wx(Si.charCodeAt(_r))||pv(Si.charCodeAt(_r)))&&La({},wl,pf),{type:Xy,value:parseInt(i,8),octal:!0,start:r,end:_r}}(t);n&&pv(n.charCodeAt(0))&&La({},wl,pf)}for(;pv(Si.charCodeAt(_r));)e+=Si[_r++];n=Si[_r]}if(n==="."){for(e+=Si[_r++];pv(Si.charCodeAt(_r));)e+=Si[_r++];n=Si[_r]}if(n==="e"||n==="E")if(e+=Si[_r++],(n=Si[_r])!=="+"&&n!=="-"||(e+=Si[_r++]),pv(Si.charCodeAt(_r)))for(;pv(Si.charCodeAt(_r));)e+=Si[_r++];else La({},wl,pf);return wx(Si.charCodeAt(_r))&&La({},wl,pf),{type:Xy,value:parseFloat(e),start:t,end:_r}}function vU(){var e,t,n,r;return Qa=null,DI(),e=_r,t=function(){var i,s,f,m;for(vk((i=Si[_r])==="/","Regular expression literal must start with a slash"),s=Si[_r++],f=!1,m=!1;_r<df;)if(s+=i=Si[_r++],i==="\\")xx((i=Si[_r++]).charCodeAt(0))&&La({},JO),s+=i;else if(xx(i.charCodeAt(0)))La({},JO);else if(f)i==="]"&&(f=!1);else{if(i==="/"){m=!0;break}i==="["&&(f=!0)}return m||La({},JO),{value:s.substr(1,s.length-2),literal:s}}(),n=function(){var i,s,f;for(s="",f="";_r<df&&yk((i=Si[_r]).charCodeAt(0));)++_r,i==="\\"&&_r<df?La({},wl,pf):(f+=i,s+=i);return f.search(/[^gimuy]/g)>=0&&La({},YO,f),{value:f,literal:s}}(),r=function(i,s){var f=i;s.indexOf("u")>=0&&(f=f.replace(/\\u\{([0-9a-fA-F]+)\}/g,function(m,x){if(parseInt(x,16)<=1114111)return"x";La({},YO)}).replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,"x"));try{new RegExp(f)}catch{La({},YO)}try{return new RegExp(i,s)}catch{return null}}(t.value,n.value),{literal:t.literal+n.literal,value:r,regex:{pattern:t.value,flags:n.value},start:e,end:_r}}function FI(){var e;return DI(),_r>=df?{type:gx,start:_r,end:_r}:wx(e=Si.charCodeAt(_r))?gU():e===40||e===41||e===59?eA():e===39||e===34?function(){var t,n,r,i,s="",f=!1;for(vk((t=Si[_r])==="'"||t==='"',"String literal must starts with a quote"),n=_r,++_r;_r<df;){if((r=Si[_r++])===t){t="";break}if(r==="\\")if((r=Si[_r++])&&xx(r.charCodeAt(0)))r==="\r"&&Si[_r]===`
`&&++_r;else switch(r){case"u":case"x":Si[_r]==="{"?(++_r,s+=mU()):s+=ZO(r);break;case"n":s+=`
`;break;case"r":s+="\r";break;case"t":s+="	";break;case"b":s+="\b";break;case"f":s+="\f";break;case"v":s+="\v";break;default:bx(r)?((i="01234567".indexOf(r))!==0&&(f=!0),_r<df&&bx(Si[_r])&&(f=!0,i=8*i+"01234567".indexOf(Si[_r++]),"0123".indexOf(r)>=0&&_r<df&&bx(Si[_r])&&(i=8*i+"01234567".indexOf(Si[_r++]))),s+=String.fromCharCode(i)):s+=r}else{if(xx(r.charCodeAt(0)))break;s+=r}}return t!==""&&La({},wl,pf),{type:vx,value:s,octal:f,start:n,end:_r}}():e===46?pv(Si.charCodeAt(_r+1))?NI():eA():pv(e)?NI():eA()}function _d(){var e;return _r=(e=Qa).end,Qa=FI(),_r=e.end,e}function II(){var e;e=_r,Qa=FI(),_r=e}function RI(e,t,n){var r=new dg(e==="||"||e==="&&"?eU:Yz);return r.operator=e,r.left=t,r.right=n,r}function yU(e,t){var n=new dg(Jz);return n.callee=e,n.arguments=t,n}function tA(e){var t=new dg(SI);return t.name=e,t}function kx(e){var t=new dg(Zz);return t.value=e.value,t.raw=Si.slice(e.start,e.end),e.regex&&(t.raw==="//"&&(t.raw="/(?:)/"),t.regex=e.regex),t}function MI(e,t,n){var r=new dg(tU);return r.computed=e==="[",r.object=t,r.property=n,r.computed||(n.member=!0),r}function jI(e,t,n){var r=new dg(rU);return r.key=t,r.value=n,r.kind=e,r}function La(e,t){var n,r=Array.prototype.slice.call(arguments,2),i=t.replace(/%(\d)/g,function(s,f){return vk(f<r.length,"Message reference must be in range"),r[f]});throw(n=new Error(i)).index=_r,n.description=i,n}function bk(e){e.type===gx&&La(e,cU),e.type===Xy&&La(e,oU),e.type===vx&&La(e,aU),e.type===Ky&&La(e,sU),e.type===oy&&La(e,uU),La(e,wl,e.value)}function mf(e){var t=_d();t.type===Sd&&t.value===e||bk(t)}function zs(e){return Qa.type===Sd&&Qa.value===e}function nA(e){return Qa.type===oy&&Qa.value===e}function bU(){var e=[];for(_r=Qa.start,mf("[");!zs("]");)zs(",")?(_d(),e.push(null)):(e.push(Yy()),zs("]")||mf(","));return _d(),function(t){var n=new dg(Xz);return n.elements=t,n}(e)}function BI(){var e;return _r=Qa.start,(e=_d()).type===vx||e.type===Xy?(e.octal&&La(e,_I),kx(e)):tA(e.value)}function xU(){var e,t,n;return _r=Qa.start,(e=Qa).type===Ky?(n=BI(),mf(":"),jI("init",n,Yy())):e.type!==gx&&e.type!==Sd?(t=BI(),mf(":"),jI("init",t,Yy())):void bk(e)}function wU(){var e,t,n=[],r={},i=String;for(_r=Qa.start,mf("{");!zs("}");)t="$"+((e=xU()).key.type===SI?e.key.name:i(e.key.value)),Object.prototype.hasOwnProperty.call(r,t)?La({},lU):r[t]=!0,n.push(e),zs("}")||mf(",");return mf("}"),function(s){var f=new dg(nU);return f.properties=s,f}(n)}var kU={if:1};function EU(){var e,t,n;if(zs("("))return function(){var r;return mf("("),r=rA(),mf(")"),r}();if(zs("["))return bU();if(zs("{"))return wU();if(e=Qa.type,_r=Qa.start,e===Ky||kU[Qa.value])n=tA(_d().value);else if(e===vx||e===Xy)Qa.octal&&La(Qa,_I),n=kx(_d());else{if(e===oy)throw new Error(yx);e===mk?((t=_d()).value=t.value==="true",n=kx(t)):e===gk?((t=_d()).value=null,n=kx(t)):zs("/")||zs("/=")?(n=kx(vU()),II()):bk(_d())}return n}function CU(){var e=[];if(mf("("),!zs(")"))for(;_r<df&&(e.push(Yy()),!zs(")"));)mf(",");return mf(")"),e}function OU(){var e;return _r=Qa.start,function(t){return t.type===Ky||t.type===oy||t.type===mk||t.type===gk}(e=_d())||bk(e),tA(e.value)}function AU(){var e;return mf("["),e=rA(),mf("]"),e}function PI(){var e=function(){var t;for(t=EU();;)if(zs("."))mf("."),t=MI(".",t,OU());else if(zs("("))t=yU(t,CU());else{if(!zs("["))break;t=MI("[",t,AU())}return t}();if(Qa.type===Sd&&(zs("++")||zs("--")))throw new Error(yx);return e}function xk(){var e,t;if(Qa.type!==Sd&&Qa.type!==oy)t=PI();else{if(zs("++")||zs("--"))throw new Error(yx);if(zs("+")||zs("-")||zs("~")||zs("!"))e=_d(),t=xk(),t=function(n,r){var i=new dg(iU);return i.operator=n,i.argument=r,i.prefix=!0,i}(e.value,t);else{if(nA("delete")||nA("void")||nA("typeof"))throw new Error(yx);t=PI()}}return t}function LI(e){var t=0;if(e.type!==Sd&&e.type!==oy)return 0;switch(e.value){case"||":t=1;break;case"&&":t=2;break;case"|":t=3;break;case"^":t=4;break;case"&":t=5;break;case"==":case"!=":case"===":case"!==":t=6;break;case"<":case">":case"<=":case">=":case"instanceof":case"in":t=7;break;case"<<":case">>":case">>>":t=8;break;case"+":case"-":t=9;break;case"*":case"/":case"%":t=11}return t}function Yy(){var e,t;return e=function(){var n,r,i,s,f,m,x,O,T,M;if(n=Qa,T=xk(),(f=LI(s=Qa))===0)return T;for(s.prec=f,_d(),r=[n,Qa],m=[T,s,x=xk()];(f=LI(Qa))>0;){for(;m.length>2&&f<=m[m.length-2].prec;)x=m.pop(),O=m.pop().value,T=m.pop(),r.pop(),i=RI(O,T,x),m.push(i);(s=_d()).prec=f,m.push(s),r.push(Qa),i=xk(),m.push(i)}for(i=m[M=m.length-1],r.pop();M>1;)r.pop(),i=RI(m[M-1].value,m[M-2],i),M-=2;return i}(),zs("?")&&(_d(),t=Yy(),mf(":"),e=function(n,r,i){var s=new dg(Qz);return s.test=n,s.consequent=r,s.alternate=i,s}(e,t,Yy())),e}function rA(){var e=Yy();if(zs(","))throw new Error(yx);return e}var SU=function(e){_r=0,df=(Si=e).length,Qa=null,II();var t=rA();if(Qa.type!==gx)throw new Error("Unexpect token after expression.");return t};function I1(e,t,n){return e.fields=t||[],e.fname=n,e}function _U(e){return e.length===1?DU(e[0]):TU(e)}const DU=e=>function(t){return t[e]},TU=e=>{const t=e.length;return function(n){for(let r=0;r<t;++r)n=n[e[r]];return n}};function iA(e){throw Error(e)}function NU(e){const t=[],n=e.length;let r,i,s,f=null,m=0,x="";function O(){t.push(x+e.substring(r,i)),x="",r=i+1}for(e+="",r=i=0;i<n;++i)if((s=e[i])==="\\")x+=e.substring(r,i),x+=e.substring(++i,++i),r=i;else if(s===f)O(),f=null,m=-1;else{if(f)continue;r===m&&s==='"'||r===m&&s==="'"?(r=i+1,f=s):s!=="."||m?s==="["?(i>r&&O(),m=r=i+1):s==="]"&&(m||iA("Access path missing open bracket: "+e),m>0&&O(),m=0,r=i+1):i>r?O():r=i+1}return m&&iA("Access path missing closing bracket: "+e),f&&iA("Access path missing closing quote: "+e),i>r&&(i++,O()),t}function FU(e,t,n){const r=NU(e);return e=r.length===1?r[0]:e,I1((n&&n.get||_U)(r),[e],t||e)}FU("id"),I1(e=>e,[],"identity"),I1(()=>0,[],"zero"),I1(()=>1,[],"one"),I1(()=>!0,[],"true"),I1(()=>!1,[],"false");function zI(e){const t=SU(e),n=new Set;return t.visit(r=>{r.type==="MemberExpression"&&function i(s){return s.object.type==="MemberExpression"?i(s.object):s.object.name==="datum"}(r)&&n.add(function i(s){const f=[];return s.type==="Identifier"?[s.name]:s.type==="Literal"?[s.value]:(s.type==="MemberExpression"&&(f.push(...i(s.object)),f.push(...i(s.property))),f)}(r).slice(1).join("."))}),n}class R1 extends os{constructor(t,n,r){super(t),this.model=n,this.filter=r,this.expr=wk(this.model,this.filter,this),this._dependentFields=zI(this.expr)}clone(){return new R1(null,this.model,Go(this.filter))}dependentFields(){return this._dependentFields}producedFields(){return new Set}assemble(){return{type:"filter",expr:this.expr}}hash(){return`Filter ${this.expr}`}}function UI(e,t,n,r="datum"){const i=[],s=Qb(t,function(f){const m=eu(f),x=e.getSelectionComponent(m,f),O=ga(m+$y);if(x.project.timeUnit){const T=n??e.component.data.raw,M=x.project.timeUnit.clone();T.parent?M.insertAsParentOf(T):T.parent=M}return x.empty!=="none"&&i.push(O),`vlSelectionTest(${O}, ${r}`+(x.resolve==="global"?")":`, ${ga(x.resolve)})`)});return(i.length?"!("+i.map(f=>`length(data(${f}))`).join(" || ")+") || ":"")+`(${s})`}function WI(e,t){const n=t.encoding;let r=t.field;if(n||r){if(n&&!r){const i=e.project.items.filter(s=>s.channel===n);!i.length||i.length>1?(r=e.project.items[0].field,Gr((i.length?"Multiple ":"No ")+`matching ${ga(n)} encoding found for selection ${ga(t.selection)}. Using "field": ${ga(r)}.`)):r=i[0].field}}else r=e.project.items[0].field,e.project.items.length>1&&Gr(`A "field" or "encoding" must be specified when using a selection as a scale domain. Using "field": ${ga(r)}.`);return`${e.name}[${ga(r)}]`}function wk(e,t,n){return Qb(t,r=>$o(r)?r:function(i){return i==null?void 0:i.selection}(r)?UI(e,r.selection,n):MN(r))}function oA(e,t,n,r){var i,s,f;e.encode=(i=e.encode)!==null&&i!==void 0?i:{},e.encode[t]=(s=e.encode[t])!==null&&s!==void 0?s:{},e.encode[t].update=(f=e.encode[t].update)!==null&&f!==void 0?f:{},e.encode[t].update[n]=r}function Ex(e,t,n,r={header:!1}){var i,s;const f=e.combine(),{disable:m,orient:x,scale:O,labelExpr:T,title:M,zindex:H}=f,Z=Li(f,["disable","orient","scale","labelExpr","title","zindex"]);if(!m){for(const ue in Z){const fe=A7[ue],Ie=Z[ue];if(fe&&fe!==t&&fe!=="both")delete Z[ue];else if(VC(Ie)){const{condition:Pe}=Ie,Le=Li(Ie,["condition"]),rt=Mu(Pe),it=tN[ue];if(it){const{vgProp:ut,part:st}=it;oA(Z,st,ut,[...rt.map(mt=>{const{test:dt}=mt,en=Li(mt,["test"]);return Object.assign({test:wk(null,dt)},en)}),Le]),delete Z[ue]}else if(it===null){const ut={signal:rt.map(st=>{const{test:mt}=st,dt=Li(st,["test"]);return`${wk(null,mt)} ? ${pF(dt)} : `}).join("")+pF(Le)};Z[ue]=ut}}else if(po(Ie)){const Pe=tN[ue];if(Pe){const{vgProp:Le,part:rt}=Pe;oA(Z,rt,Le,Ie),delete Z[ue]}}}if(t==="grid"){if(!Z.grid)return;if(Z.encode){const{grid:ue}=Z.encode;Z.encode=Object.assign({},ue?{grid:ue}:{}),ms(Z.encode)&&delete Z.encode}return Object.assign(Object.assign({scale:O,orient:x},Z),{domain:!1,labels:!1,aria:!1,maxExtent:0,minExtent:0,ticks:!1,zindex:Qu(H,0)})}{if(!r.header&&e.mainExtracted)return;if(T!==void 0){let fe=T;!((s=(i=Z.encode)===null||i===void 0?void 0:i.labels)===null||s===void 0)&&s.update&&po(Z.encode.labels.update.text)&&(fe=O1(T,"datum.label",Z.encode.labels.update.text.signal)),oA(Z,"labels","text",{signal:fe})}if(Z.labelAlign===null&&delete Z.labelAlign,Z.encode){for(const fe of nN)e.hasAxisPart(fe)||delete Z.encode[fe];ms(Z.encode)&&delete Z.encode}const ue=function(fe,Ie){if(fe)return Gi(fe)&&!ty(fe)?fe.map(Pe=>lF(Pe,Ie)).join(", "):fe}(M,n);return Object.assign(Object.assign(Object.assign(Object.assign({scale:O,orient:x,grid:!1},ue?{title:ue}:{}),Z),n.aria===!1?{aria:!1}:{}),{zindex:Qu(H,0)})}}}function VI(e){const{axes:t}=e.component,n=[];for(const r of gm)if(t[r]){for(const i of t[r])if(!i.get("disable")&&!i.get("gridScale")){const s=r==="x"?"height":"width",f=e.getSizeSignalRef(s).signal;s!==f&&n.push({name:s,update:f})}}return n}const qI={titleAlign:"align",titleAnchor:"anchor",titleAngle:"angle",titleBaseline:"baseline",titleColor:"color",titleFont:"font",titleFontSize:"fontSize",titleFontStyle:"fontStyle",titleFontWeight:"fontWeight",titleLimit:"limit",titleLineHeight:"lineHeight",titleOrient:"orient",titlePadding:"offset"},HI={labelAlign:"align",labelAnchor:"anchor",labelAngle:"angle",labelBaseline:"baseline",labelColor:"color",labelFont:"font",labelFontSize:"fontSize",labelFontStyle:"fontStyle",labelFontWeight:"fontWeight",labelLimit:"limit",labelLineHeight:"lineHeight",labelOrient:"orient",labelPadding:"offset"},IU=Kr(qI),RU=Kr(HI);function $I(e,t,n,r){return Object.assign.apply(null,[{},...e.map(i=>{if(i==="axisOrient"){const s=n==="x"?"bottom":"left",f=t[n==="x"?"axisBottom":"axisLeft"]||{},m=t[n==="x"?"axisTop":"axisRight"]||{},x=new Set([...Kr(f),...Kr(m)]),O={};for(const T of x.values())O[T]={signal:`${r.signal} === "${s}" ? ${cx(f[T])} : ${cx(m[T])}`};return O}return t[i]})])}function MU(e,t,n,r){const i=t==="band"?["axisDiscrete","axisBand"]:t==="point"?["axisDiscrete","axisPoint"]:function(O){return O in _L}(t)?["axisQuantitative"]:t==="time"||t==="utc"?["axisTemporal"]:[],s=e==="x"?"axisX":"axisY",f=po(n)?"axisOrient":"axis"+Sw(n),m=[...i,...i.map(O=>s+O.substr(4))],x=["axis",f,s];return{vlOnlyAxisConfig:$I(m,r,e,n),vgAxisConfig:$I(x,r,e,n),axisConfigStyle:function(O,T){var M;const H=[{}];for(const Z of O){let ue=(M=T[Z])===null||M===void 0?void 0:M.style;if(ue){ue=Mu(ue);for(const fe of ue)H.push(T.style[fe])}}return Object.assign.apply(null,H)}([...x,...m],r)}}function aA(e,t,n,r={}){var i;const s=gF(e,n,t.style);if(s!==void 0)return{configFrom:"style",configValue:s};for(const f of["vlOnlyAxisConfig","vgAxisConfig","axisConfigStyle"])if(((i=r[f])===null||i===void 0?void 0:i[e])!==void 0)return{configFrom:f,configValue:r[f][e]};return{}}const GI={scale:({model:e,channel:t})=>e.scaleName(t),format:({fieldOrDatumDef:e,config:t,axis:n})=>{const{format:r,formatType:i}=n;return GN(e,e.type,r,i,t,!0)},formatType:({axis:e,fieldOrDatumDef:t,scaleType:n})=>{const{formatType:r}=e;return KN(r,t,n)},grid:({fieldOrDatumDef:e,axis:t,scaleType:n})=>{var r;return(!si(e)||!bh(e.bin))&&((r=t.grid)!==null&&r!==void 0?r:function(i,s){return!Ad(i)&&si(s)&&!Ts(s==null?void 0:s.bin)}(n,e))},gridScale:({model:e,channel:t})=>function(n,r){const i=r==="x"?"y":"x";if(n.getScaleComponent(i))return n.scaleName(i)}(e,t),labelAlign:({axis:e,labelAngle:t,orient:n,channel:r})=>e.labelAlign||XI(t,n,r),labelAngle:({labelAngle:e})=>e,labelBaseline:({axis:e,labelAngle:t,orient:n,channel:r})=>e.labelBaseline||KI(t,n,r),labelFlush:({axis:e,fieldOrDatumDef:t,channel:n})=>{var r;return(r=e.labelFlush)!==null&&r!==void 0?r:function(i,s){if(s==="x"&&Ji(["quantitative","temporal"],i))return!0}(t.type,n)},labelOverlap:({axis:e,fieldOrDatumDef:t,scaleType:n})=>{var r;return(r=e.labelOverlap)!==null&&r!==void 0?r:function(i,s){if(i!=="nominal")return s!=="log"||"greedy"}(t.type,n)},orient:({orient:e})=>e,tickCount:({channel:e,model:t,axis:n,fieldOrDatumDef:r,scaleType:i})=>{var s;const f=e==="x"?"width":e==="y"?"height":void 0,m=f?t.getSizeSignalRef(f):void 0;return(s=n.tickCount)!==null&&s!==void 0?s:function({fieldOrDatumDef:x,scaleType:O,size:T,values:M}){var H;if(!M&&!Ad(O)&&O!=="log"){if(si(x)){if(Ts(x.bin))return{signal:`ceil(${T.signal}/10)`};if(x.timeUnit&&Ji(["month","hours","day","quarter"],(H=xh(x.timeUnit))===null||H===void 0?void 0:H.unit))return}return{signal:`ceil(${T.signal}/40)`}}}({fieldOrDatumDef:r,scaleType:i,size:m,values:n.values})},title:({axis:e,model:t,channel:n})=>{if(e.title!==void 0)return e.title;const r=YI(t,n);if(r!==void 0)return r;const i=t.typedFieldDef(n),s=n==="x"?"x2":"y2",f=t.fieldDef(s);return yF(i?[tF(i)]:[],si(f)?[tF(f)]:[])},values:({axis:e,fieldOrDatumDef:t})=>function(n,r){const i=n.values;if(Gi(i))return hF(r,i);if(po(i))return i}(e,t),zindex:({axis:e,fieldOrDatumDef:t,mark:n})=>{var r;return(r=e.zindex)!==null&&r!==void 0?r:function(i,s){return i==="rect"&&oF(s)?1:0}(n,t)}};function sA(e){return`(((${e.signal} % 360) + 360) % 360)`}function KI(e,t,n,r){if(e!==void 0){if(n==="x"){if(po(e)){const i=sA(e);return{signal:`(45 < ${i} && ${i} < 135) || (225 < ${i} && ${i} < 315) ? "middle" :(${i} <= 45 || 315 <= ${i}) === ${po(t)?`(${t.signal} === "top")`:t==="top"} ? "bottom" : "top"`}}if(45<e&&e<135||225<e&&e<315)return"middle";if(po(t)){const i=e<=45||315<=e?"===":"!==";return{signal:`${t.signal} ${i} "top" ? "bottom" : "top"`}}return(e<=45||315<=e)==(t==="top")?"bottom":"top"}if(po(e)){const i=sA(e),s=po(t)?`(${t.signal} === "left")`:t==="left";return{signal:`${i} <= 45 || 315 <= ${i} || (135 <= ${i} && ${i} <= 225) ? ${r?'"middle"':"null"} : (45 <= ${i} && ${i} <= 135) === ${s} ? "top" : "bottom"`}}if(e<=45||315<=e||135<=e&&e<=225)return r?"middle":null;if(po(t)){const i=45<=e&&e<=135?"===":"!==";return{signal:`${t.signal} ${i} "left" ? "top" : "bottom"`}}return(45<=e&&e<=135)==(t==="left")?"top":"bottom"}}function XI(e,t,n){if(e===void 0)return;const r=n==="x",i=r?0:90,s=r?"bottom":"left";if(po(e)){const f=sA(e),m=po(t)?`(${t.signal} === "${s}")`:t===s;return{signal:`(${i?"("+f+" + 90)":f} % 180 === 0) ? ${r?null:'"center"'} :(${i} < ${f} && ${f} < ${180+i}) === ${m} ? "left" : "right"`}}if((e+i)%180==0)return r?null:"center";if(po(t)){const f=i<e&&e<180+i?"===":"!==";return{signal:`${`${t.signal} ${f} "${s}"`} ? "left" : "right"`}}return(i<e&&e<180+i)==(t===s)?"left":"right"}function YI(e,t){const n=t==="x"?"x2":"y2",r=e.fieldDef(t),i=e.fieldDef(n),s=r?r.title:void 0,f=i?i.title:void 0;return s&&f?bF(s,f):s||f||(s!==void 0?s:f!==void 0?f:void 0)}class M1 extends os{constructor(t,n){super(t),this.transform=n,this._dependentFields=zI(this.transform.calculate)}clone(){return new M1(null,Go(this.transform))}static parseAllForSortIndex(t,n){return n.forEachFieldDef((r,i)=>{if(bO(r)&&eF(r.sort)){const{field:s,timeUnit:f}=r,m=r.sort,x=m.map((O,T)=>`${MN({field:s,timeUnit:f,equal:O})} ? ${T} : `).join("")+m.length;t=new M1(t,{calculate:x,as:j1(r,i,{forAs:!0})})}}),t}producedFields(){return new Set([this.transform.as])}dependentFields(){return this._dependentFields}assemble(){return{type:"formula",expr:this.transform.calculate,as:this.transform.as}}hash(){return`Calculate ${Ea(this.transform)}`}}function j1(e,t,n){return ei(e,Object.assign({prefix:t,suffix:"sort_index"},n??{}))}function kk(e,t){return Ji(["top","bottom"],t)?"column":Ji(["left","right"],t)||e==="row"?"row":"column"}function B1(e,t,n,r){const i=r==="row"?n.headerRow:r==="column"?n.headerColumn:n.headerFacet;return Qu(((t==null?void 0:t.header)||{})[e],i[e],n.header[e])}function Ek(e,t,n,r){const i={};for(const s of e){const f=B1(s,t,n,r);f!==void 0&&(i[s]=f)}return i}const uA=["row","column"],cA=["header","footer"];function jU(e,t){const n=e.component.layoutHeaders[t].title,r=e.config?e.config:void 0,i=e.component.layoutHeaders[t].facetFieldDef?e.component.layoutHeaders[t].facetFieldDef:void 0,{titleAnchor:s,titleAngle:f,titleOrient:m}=Ek(["titleAnchor","titleAngle","titleOrient"],i,r,t),x=kk(t,m),O=_w(f);return{name:`${t}-title`,type:"group",role:`${x}-title`,title:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({text:n},t==="row"?{orient:"left"}:{}),{style:"guide-title"}),QI(O,x)),JI(x,O,s)),ZI(r,i,t,IU,qI))}}function JI(e,t,n="middle"){switch(n){case"start":return{align:"left"};case"end":return{align:"right"}}const r=XI(t,e==="row"?"left":"top",e==="row"?"y":"x");return r?{align:r}:{}}function QI(e,t){const n=KI(e,t==="row"?"left":"top",t==="row"?"y":"x",!0);return n?{baseline:n}:{}}function BU(e,t){const n=e.component.layoutHeaders[t],r=[];for(const i of cA)if(n[i])for(const s of n[i]){const f=PU(e,t,i,n,s);f!=null&&r.push(f)}return r}function lA(e,t,n){const{format:r,formatType:i,labelAngle:s,labelAnchor:f,labelOrient:m,labelExpr:x}=Ek(["format","formatType","labelAngle","labelAnchor","labelOrient","labelExpr"],e,n,t),O=hO({fieldOrDatumDef:e,format:r,formatType:i,expr:"parent",config:n}).signal,T=kk(t,m);return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({text:{signal:x?O1(O1(x,"datum.label",O),"datum.value",ei(e,{expr:"parent"})):O}},t==="row"?{orient:"left"}:{}),{style:"guide-label",frame:"group"}),QI(s,T)),JI(T,s,f)),ZI(n,e,t,RU,HI))}function PU(e,t,n,r,i){if(i){let s=null;const{facetFieldDef:f}=r,m=e.config?e.config:void 0;if(f&&i.labels){const{labelOrient:M}=Ek(["labelOrient"],f,m,t);(t==="row"&&!Ji(["top","bottom"],M)||t==="column"&&!Ji(["left","right"],M))&&(s=lA(f,t,m))}const x=gg(e)&&!ax(e.facet),O=i.axes,T=(O==null?void 0:O.length)>0;if(s||T){const M=t==="row"?"height":"width";return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:e.getName(`${t}_${n}`),type:"group",role:`${t}-${n}`},r.facetFieldDef?{from:{data:e.getName(t+"_domain")},sort:function(H,Z){var ue;const{sort:fe}=H;return E0(fe)?{field:ei(fe,{expr:"datum"}),order:(ue=fe.order)!==null&&ue!==void 0?ue:"ascending"}:Gi(fe)?{field:j1(H,Z,{expr:"datum"}),order:"ascending"}:{field:ei(H,{expr:"datum"}),order:fe??"ascending"}}(f,t)}:{}),T&&x?{from:{data:e.getName(`facet_domain_${t}`)}}:{}),s?{title:s}:{}),i.sizeSignal?{encode:{update:{[M]:i.sizeSignal}}}:{}),T?{axes:O}:{})}}return null}const LU={column:{start:0,end:1},row:{start:1,end:0}};function zU(e,t){return LU[t][e]}function ZI(e,t,n,r,i){const s={};for(const f of r){if(!i[f])continue;const m=B1(f,t,e,n);m!==void 0&&(s[i[f]]=m)}return s}function fA(e){return[...Ck(e,"width"),...Ck(e,"height"),...Ck(e,"childWidth"),...Ck(e,"childHeight")]}function Ck(e,t){const n=t==="width"?"x":"y",r=e.component.layoutSize.get(t);if(!r||r==="merged")return[];const i=e.getSizeSignalRef(t).signal;if(r==="step"){const s=e.getScaleComponent(n);if(s){const f=s.get("type"),m=s.get("range");if(Ad(f)&&Jv(m)){const x=e.scaleName(n);return gg(e.parent)&&e.parent.component.resolve.scale[n]==="independent"?[eR(x,m)]:[eR(x,m),{name:i,update:tR(x,s,`domain('${x}').length`)}]}}throw new Error("layout size is step although width/height is not step.")}if(r=="container"){const s=i.endsWith("width"),f=s?"containerSize()[0]":"containerSize()[1]",m=`isFinite(${f}) ? ${f} : ${jO(e.config.view,s?"width":"height")}`;return[{name:i,init:m,on:[{update:m,events:"window:resize"}]}]}return[{name:i,value:r}]}function eR(e,t){return{name:e+"_step",value:t.step}}function tR(e,t,n){const r=t.get("type"),i=t.get("padding"),s=Qu(t.get("paddingOuter"),i);let f=t.get("paddingInner");return`bandspace(${n}, ${f=r==="band"?f!==void 0?f:i:1}, ${s}) * ${e}_step`}function nR(e){return e==="childWidth"?"width":e==="childHeight"?"height":e}function rR(e,t){return Kr(e).reduce((n,r)=>{const i=e[r];return Object.assign(Object.assign({},n),hx(t,i,r,s=>po(s)?s:{value:s.value}))},{})}function UU(e,t){if(U1(t)||gg(t))return"shared";if(CA(t))return w0(e)?"independent":"shared";throw new Error("invalid model type for resolve")}function hA(e,t){const n=e.scale[t],r=w0(t)?"axis":"legend";return n==="independent"?(e[r][t]==="shared"&&Gr(de.independentScaleMeansIndependentGuide(t)),"independent"):e[r][t]||"shared"}const WU=Object.assign(Object.assign({},HL),{disable:1,labelExpr:1,selections:1,opacity:1,shape:1,stroke:1,fill:1,size:1,strokeWidth:1,strokeDash:1,encode:1}),iR=Kr(WU);class VU extends fv{}const oR={symbols:function(e,{fieldOrDatumDef:t,model:n,channel:r,legendCmpt:i,legendType:s}){var f,m,x,O,T;if(s!=="symbol")return;const{markDef:M,encoding:H,config:Z,mark:ue}=n,fe=M.filled&&ue!=="trail";let Ie=Object.assign(Object.assign({},function(Le,rt,it){for(const ut of it){const st=Wy(ut,rt.markDef,rt.config);st!==void 0&&(Le[ut]=ju(st))}return Le}({},n,N7)),sI(n,{filled:fe}));const Pe=(f=aR(H.opacity))!==null&&f!==void 0?f:M.opacity;if(Ie.fill){if(r==="fill"||fe&&r===Cd)delete Ie.fill;else if(Ie.fill.field)i.get("symbolFillColor")?delete Ie.fill:(Ie.fill=ju((m=Z.legend.symbolBaseFillColor)!==null&&m!==void 0?m:"black"),Ie.fillOpacity=ju(Pe??1));else if(Gi(Ie.fill)){const Le=(T=(O=dA((x=H.fill)!==null&&x!==void 0?x:H.color))!==null&&O!==void 0?O:M.fill)!==null&&T!==void 0?T:fe&&M.color;Le&&(Ie.fill=ju(Le))}}if(Ie.stroke){if(r==="stroke"||!fe&&r===Cd)delete Ie.stroke;else if(Ie.stroke.field)delete Ie.stroke;else if(Gi(Ie.stroke)){const Le=Qu(dA(H.stroke||H.color),M.stroke,fe?M.color:void 0);Le&&(Ie.stroke={value:Le})}}if(r!==uv){const Le=si(t)&&uR(n,i,t);Le?Ie.opacity=[Object.assign({test:Le},ju(Pe??1)),ju(Z.legend.unselectedOpacity)]:Pe&&(Ie.opacity=ju(Pe))}return ms(Ie=Object.assign(Object.assign({},Ie),e))?void 0:Ie},gradient:function(e,{model:t,legendType:n}){if(n!=="gradient")return;let r={};const i=aR(t.encoding.opacity)||t.markDef.opacity;return i&&(r.opacity=ju(i)),ms(r=Object.assign(Object.assign({},r),e))?void 0:r},labels:function(e,{fieldOrDatumDef:t,model:n,channel:r,legendCmpt:i}){const s=n.legend(r)||{},f=n.config,m=si(t)?uR(n,i,t):void 0,x=m?[{test:m,value:1},{value:f.legend.unselectedOpacity}]:void 0,{format:O,formatType:T}=s,M=Ly(T)?dO({fieldOrDatumDef:t,field:"datum.value",format:O,formatType:T,config:f}):void 0,H=Object.assign(Object.assign(Object.assign({},x?{opacity:x}:{}),M?{text:M}:{}),e);return ms(H)?void 0:H},entries:function(e,{legendCmpt:t}){const n=t.get("selections");return n!=null&&n.length?Object.assign(Object.assign({},e),{fill:{value:"transparent"}}):e}};function aR(e){return sR(e,(t,n)=>Math.max(t,n.value))}function dA(e){return sR(e,(t,n)=>Qu(t,n.value))}function sR(e,t){return function(n){const r=n&&n.condition;return!!r&&(Gi(r)||cv(r))}(e)?Mu(e.condition).reduce(t,e.value):cv(e)?e.value:void 0}function uR(e,t,n){const r=t.get("selections");if(!(r!=null&&r.length))return;const i=ga(n.field);return r.map(s=>`(!length(data(${ga(eu(s)+$y)})) || (${s}[${i}] && indexof(${s}[${i}], datum.value) >= 0))`).join(" || ")}const cR={direction:({direction:e})=>e,format:({fieldOrDatumDef:e,legend:t,config:n})=>{const{format:r,formatType:i}=t;return GN(e,e.type,r,i,n,!1)},formatType:({legend:e,fieldOrDatumDef:t,scaleType:n})=>{const{formatType:r}=e;return KN(r,t,n)},gradientLength:e=>{var t,n;const{legend:r,legendConfig:i}=e;return(n=(t=r.gradientLength)!==null&&t!==void 0?t:i.gradientLength)!==null&&n!==void 0?n:function({legendConfig:s,model:f,direction:m,orient:x,scaleType:O}){const{gradientHorizontalMaxLength:T,gradientHorizontalMinLength:M,gradientVerticalMaxLength:H,gradientVerticalMinLength:Z}=s;if(fg(O))return m==="horizontal"?x==="top"||x==="bottom"?lR(f,"width",M,T):M:lR(f,"height",Z,H)}(e)},labelOverlap:({legend:e,legendConfig:t,scaleType:n})=>{var r,i;return(i=(r=e.labelOverlap)!==null&&r!==void 0?r:t.labelOverlap)!==null&&i!==void 0?i:function(s){if(Ji(["quantile","threshold","log"],s))return"greedy"}(n)},symbolType:({legend:e,markDef:t,channel:n,encoding:r})=>{var i;return(i=e.symbolType)!==null&&i!==void 0?i:function(s,f,m,x){var O;if(f!=="shape"){const T=(O=dA(m))!==null&&O!==void 0?O:x;if(T)return T}switch(s){case"bar":case"rect":case"image":case"square":return"square";case"line":case"trail":case"rule":return"stroke";case"arc":case"point":case"circle":case"tick":case"geoshape":case"area":case"text":return"circle"}}(t.type,n,r.shape,t.shape)},title:({fieldOrDatumDef:e,config:t})=>zy(e,t,{allowDisabling:!0}),type:({legendType:e,scaleType:t,channel:n})=>{if(A1(n)&&fg(t)){if(e==="gradient")return}else if(e==="symbol")return;return e},values:({fieldOrDatumDef:e,legend:t})=>function(n,r){const i=n.values;if(Gi(i))return hF(r,i);if(po(i))return i}(t,e)};function qU(e){const{legend:t}=e;return Qu(t.type,function({channel:n,timeUnit:r,scaleType:i}){if(A1(n)){if(Ji(["quarter","month","day"],r))return"symbol";if(fg(i))return"gradient"}return"symbol"}(e))}function HU({legendConfig:e,legendType:t,orient:n,legend:r}){var i,s;return(s=(i=r.direction)!==null&&i!==void 0?i:e[t?"gradientDirection":"symbolDirection"])!==null&&s!==void 0?s:function(f,m){switch(f){case"top":case"bottom":return"horizontal";case"left":case"right":case"none":case void 0:return;default:return m==="gradient"?"horizontal":void 0}}(n,t)}function lR(e,t,n,r){return{signal:`clamp(${e.getSizeSignalRef(t).signal}, ${n}, ${r})`}}function fR(e){const t=yu(e)?function(n){const{encoding:r}=n,i={};for(const s of[Cd,...MF]){const f=yc(r[s]);f&&n.getScaleComponent(s)&&(s===Od&&si(f)&&f.type===T1||(i[s]=GU(n,s)))}return i}(e):function(n){const{legends:r,resolve:i}=n.component;for(const s of n.children){fR(s);for(const f of Kr(s.component.legends))i.legend[f]=hA(n.component.resolve,f),i.legend[f]==="shared"&&(r[f]=hR(r[f],s.component.legends[f]),r[f]||(i.legend[f]="independent",delete r[f]))}for(const s of Kr(r))for(const f of n.children)f.component.legends[s]&&i.legend[s]==="shared"&&delete f.component.legends[s];return r}(e);return e.component.legends=t,t}function $U(e,t,n,r){switch(t){case"disable":return n!==void 0;case"values":return!!(n!=null&&n.values);case"title":if(t==="title"&&e===(r==null?void 0:r.title))return!0}return e===(n||{})[t]}function GU(e,t){var n,r,i;let s=e.legend(t);const{markDef:f,encoding:m,config:x}=e,O=x.legend,T=new VU({},function(st,mt){const dt=st.scaleName(mt);if(st.mark==="trail"){if(mt==="color")return{stroke:dt};if(mt==="size")return{strokeWidth:dt}}return mt==="color"?st.markDef.filled?{fill:dt}:{stroke:dt}:{[mt]:dt}}(e,t));(function(st,mt,dt){var en;const mn=(en=st.fieldDef(mt))===null||en===void 0?void 0:en.field;Gy(st,sn=>{var In,Fn;const zn=(In=sn.project.hasField[mn])!==null&&In!==void 0?In:sn.project.hasChannel[mt];if(zn&&gI.has(sn)){const Vn=(Fn=dt.get("selections"))!==null&&Fn!==void 0?Fn:[];Vn.push(sn.name),dt.set("selections",Vn,!1),zn.hasLegend=!0}})})(e,t,T);const M=s!==void 0?!s:O.disable;if(T.set("disable",M,s!==void 0),M)return T;s=s||{};const H=e.getScaleComponent(t).get("type"),Z=yc(m[t]),ue=si(Z)?(n=xh(Z.timeUnit))===null||n===void 0?void 0:n.unit:void 0,fe=s.orient||x.legend.orient||"right",Ie=qU({legend:s,channel:t,timeUnit:ue,scaleType:H}),Pe={legend:s,channel:t,model:e,markDef:f,encoding:m,fieldOrDatumDef:Z,legendConfig:O,config:x,scaleType:H,orient:fe,legendType:Ie,direction:HU({legend:s,legendType:Ie,orient:fe,legendConfig:O})};for(const st of iR){const mt=st in cR?cR[st](Pe):s[st];if(mt!==void 0){const dt=$U(mt,st,s,e.fieldDef(t));(dt||x.legend[st]===void 0)&&T.set(st,mt,dt)}}const Le=(r=s==null?void 0:s.encoding)!==null&&r!==void 0?r:{},rt=T.get("selections"),it={},ut={fieldOrDatumDef:Z,model:e,channel:t,legendCmpt:T,legendType:Ie};for(const st of["labels","legend","title","symbols","gradient","entries"]){const mt=rR((i=Le[st])!==null&&i!==void 0?i:{},e),dt=st in oR?oR[st](mt,ut):mt;dt===void 0||ms(dt)||(it[st]=Object.assign(Object.assign(Object.assign({},rt!=null&&rt.length&&si(Z)?{name:`${eu(Z.field)}_legend_${st}`}:{}),rt!=null&&rt.length?{interactive:!!rt}:{}),{update:dt}))}return ms(it)||T.set("encode",it,!!(s!=null&&s.encoding)),T}function hR(e,t){var n,r,i,s;if(!e)return t.clone();const f=e.getWithExplicit("orient"),m=t.getWithExplicit("orient");if(f.explicit&&m.explicit&&f.value!==m.value)return;let x=!1;for(const O of iR){const T=ny(e.getWithExplicit(O),t.getWithExplicit(O),O,"legend",(M,H)=>{switch(O){case"symbolType":return KU(M,H);case"title":return xF(M,H);case"type":return x=!0,hg("symbol")}return sk(M,H,O,"legend")});e.setWithExplicit(O,T)}return x&&(!((r=(n=e.implicit)===null||n===void 0?void 0:n.encode)===null||r===void 0)&&r.gradient&&UC(e.implicit,["encode","gradient"]),!((s=(i=e.explicit)===null||i===void 0?void 0:i.encode)===null||s===void 0)&&s.gradient&&UC(e.explicit,["encode","gradient"])),e}function KU(e,t){return t.value==="circle"?t:e}function dR(e,t,n,r){var i,s,f;e.encode=(i=e.encode)!==null&&i!==void 0?i:{},e.encode[t]=(s=e.encode[t])!==null&&s!==void 0?s:{},e.encode[t].update=(f=e.encode[t].update)!==null&&f!==void 0?f:{},e.encode[t].update[n]=r}function pR(e){const t=e.component.legends,n={};for(const r of Kr(t)){const i=e.getScaleComponent(r),s=Zs(i.get("domains"));if(n[s])for(const f of n[s])hR(f,t[r])||n[s].push(t[r]);else n[s]=[t[r].clone()]}return Uv(n).flat().map(r=>function(i,s){var f,m,x;const O=i.combine(),{disable:T,labelExpr:M,selections:H}=O,Z=Li(O,["disable","labelExpr","selections"]);if(!T){if(s.aria===!1&&Z.aria==null&&(Z.aria=!1),!((f=Z.encode)===null||f===void 0)&&f.symbols){const ue=Z.encode.symbols.update;!ue.fill||ue.fill.value==="transparent"||ue.stroke||Z.stroke||(ue.stroke={value:"transparent"});for(const fe of MF)Z[fe]&&delete ue[fe]}if(Z.title||delete Z.title,M!==void 0){let ue=M;!((x=(m=Z.encode)===null||m===void 0?void 0:m.labels)===null||x===void 0)&&x.update&&po(Z.encode.labels.update.text)&&(ue=O1(M,"datum.label",Z.encode.labels.update.text.signal)),dR(Z,"labels","text",{signal:ue})}for(const ue in Z){const fe=Z[ue];if(po(fe)){const Ie=qL[ue];if(Ie){const{vgProp:Pe,part:Le}=Ie;dR(Z,Le,Pe,fe),delete Z[ue]}}}return Z}}(r,e.config)).filter(r=>r!==void 0)}function XU(e){return U1(e)||CA(e)?function(t){return t.children.reduce((n,r)=>n.concat(r.assembleProjections()),mR(t))}(e):mR(e)}function mR(e){const t=e.component.projection;if(!t||t.merged)return[];const n=t.combine(),{name:r}=n;if(t.data){const i={signal:`[${t.size.map(f=>f.signal).join(", ")}]`},s=t.data.reduce((f,m)=>{const x=po(m)?m.signal:`data('${e.lookupDataSource(m)}')`;return Ji(f,x)||f.push(x),f},[]);if(s.length<=0)throw new Error("Projection's fit didn't find any data sources");return[Object.assign({name:r,size:i,fit:{signal:s.length>1?`[${s.join(", ")}]`:s[0]}},n)]}return[Object.assign(Object.assign({name:r},{translate:{signal:"[width / 2, height / 2]"}}),n)]}const YU=["type","clipAngle","clipExtent","center","rotate","precision","reflectX","reflectY","coefficient","distance","fraction","lobes","parallel","radius","ratio","spacing","tilt"];class gR extends fv{constructor(t,n,r,i){super(Object.assign({},n),{name:t}),this.specifiedProjection=n,this.size=r,this.data=i,this.merged=!1}get isFit(){return!!this.data}}function vR(e){e.component.projection=yu(e)?function(t){var n;if(t.hasProjection){const r=t.specifiedProjection,i=!(r&&(r.scale!=null||r.translate!=null)),s=i?[t.getSizeSignalRef("width"),t.getSizeSignalRef("height")]:void 0,f=i?function(m){const x=[],{encoding:O}=m;for(const T of[[g0,m0],[pm,lg]])(yc(O[T[0]])||yc(O[T[1]]))&&x.push({signal:m.getName(`geojson_${x.length}`)});return m.channelHasField(Od)&&m.typedFieldDef(Od).type===T1&&x.push({signal:m.getName(`geojson_${x.length}`)}),x.length===0&&x.push(m.requestDataName(ff)),x}(t):void 0;return new gR(t.projectionName(!0),Object.assign(Object.assign({},(n=t.config.projection)!==null&&n!==void 0?n:{}),r??{}),s,f)}}(e):function(t){if(t.children.length===0)return;let n;for(const i of t.children)vR(i);const r=KT(t.children,i=>{const s=i.component.projection;if(s){if(n){const f=function(m,x){const O=KT(YU,T=>!Ty(m.explicit,T)&&!Ty(x.explicit,T)||!(!Ty(m.explicit,T)||!Ty(x.explicit,T)||Zs(m.get(T))!==Zs(x.get(T))));if(Zs(m.size)===Zs(x.size)){if(O)return m;if(Zs(m.explicit)===Zs({}))return x;if(Zs(x.explicit)===Zs({}))return m}return null}(n,s);return f&&(n=f),!!f}return n=s,!0}return!0});if(n&&r){const i=t.projectionName(!0),s=new gR(i,n.specifiedProjection,n.size,Go(n.data));for(const f of t.children){const m=f.component.projection;m&&(m.isFit&&s.data.push(...f.component.projection.data),f.renameProjection(m.get("name"),i),m.merged=!0)}return s}}(e)}function yR(e,t){return`${kN(e)}_${t}`}function pA(e,t,n){var r;const i=yR((r=Zw(n,void 0))!==null&&r!==void 0?r:{},t);return e.getName(`${i}_bins`)}function bR(e,t,n){let r,i;r=function(O){return"as"in O}(e)?$o(e.as)?[e.as,`${e.as}_end`]:[e.as[0],e.as[1]]:[ei(e,{forAs:!0}),ei(e,{binSuffix:"end",forAs:!0})];const s=Object.assign({},Zw(t,void 0)),f=yR(s,e.field),{signal:m,extentSignal:x}=function(O,T){return{signal:O.getName(`${T}_bins`),extentSignal:O.getName(`${T}_extent`)}}(n,f);if(Vw(s.extent)){const O=s.extent,T=O.selection;i=WI(n.getSelectionComponent(eu(T),T),O),delete s.extent}return{key:f,binComponent:Object.assign(Object.assign(Object.assign({bin:s,field:e.field,as:[r]},m?{signal:m}:{}),x?{extentSignal:x}:{}),i?{span:i}:{})}}class D0 extends os{constructor(t,n){super(t),this.bins=n}clone(){return new D0(null,Go(this.bins))}static makeFromEncoding(t,n){const r=n.reduceFieldDef((i,s,f)=>{if(_p(s)&&Ts(s.bin)){const{key:m,binComponent:x}=bR(s,s.bin,n);i[m]=Object.assign(Object.assign(Object.assign({},x),i[m]),function(O,T,M,H){var Z,ue;if(ux(T,M)){const fe=yu(O)&&(ue=(Z=O.axis(M))!==null&&Z!==void 0?Z:O.legend(M))!==null&&ue!==void 0?ue:{},Ie=ei(T,{expr:"datum"}),Pe=ei(T,{expr:"datum",binSuffix:"end"});return{formulaAs:ei(T,{binSuffix:"range",forAs:!0}),formula:Gw(Ie,Pe,fe.format,fe.formatType,H)}}return{}}(n,s,f,n.config))}return i},{});return ms(r)?null:new D0(t,r)}static makeFromTransform(t,n,r){const{key:i,binComponent:s}=bR(n,n.bin,r);return new D0(t,{[i]:s})}merge(t,n){for(const r of Kr(t.bins))r in this.bins?(n(t.bins[r].signal,this.bins[r].signal),this.bins[r].as=zv([...this.bins[r].as,...t.bins[r].as],Ea)):this.bins[r]=t.bins[r];for(const r of t.children)t.removeChild(r),r.parent=this;t.remove()}producedFields(){return new Set(Uv(this.bins).map(t=>t.as).flat(2))}dependentFields(){return new Set(Uv(this.bins).map(t=>t.field))}hash(){return`Bin ${Ea(this.bins)}`}assemble(){return Uv(this.bins).flatMap(t=>{const n=[],[r,...i]=t.as,s=t.bin,{extent:f}=s,m=Li(s,["extent"]),x=Object.assign(Object.assign(Object.assign({type:"bin",field:Wv(t.field),as:r,signal:t.signal},Vw(f)?{extent:null}:{extent:f}),t.span?{span:{signal:`span(${t.span})`}}:{}),m);!f&&t.extentSignal&&(n.push({type:"extent",field:Wv(t.field),signal:t.extentSignal}),x.extent={signal:t.extentSignal}),n.push(x);for(const O of i)for(let T=0;T<2;T++)n.push({type:"formula",expr:ei({field:r[T]},{expr:"datum"}),as:O[T]});return t.formula&&n.push({type:"formula",expr:t.formula,as:t.formulaAs}),n})}}class P1 extends os{constructor(t){let n;if(super(null),Hy(t=t??{name:"source"})||(n=t.format?Object.assign({},tv(t.format,["parse"])):{}),uk(t))this._data={values:t.values};else if(fx(t)){if(this._data={url:t.url},!n.type){let r=/(?:\.([^.]+))?$/.exec(t.url)[1];Ji(["json","csv","tsv","dsv","topojson"],r)||(r="json"),n.type=r}}else nI(t)?this._data={values:[{type:"Sphere"}]}:(eI(t)||Hy(t))&&(this._data={});this._generator=Hy(t),t.name&&(this._name=t.name),n&&!ms(n)&&(this._data.format=n)}dependentFields(){return new Set}producedFields(){}get data(){return this._data}hasName(){return!!this._name}get isGenerator(){return this._generator}get dataName(){return this._name}set dataName(t){this._name=t}set parent(t){throw new Error("Source nodes have to be roots.")}remove(){throw new Error("Source nodes are roots and cannot be removed.")}hash(){throw new Error("Cannot hash sources")}assemble(){return Object.assign(Object.assign({name:this._name},this._data),{transform:[]})}}function mA(e){for(const t of e){for(const n of t.children)if(n.parent!==t)return console.error("Dataflow graph is inconsistent.",t,n),!1;if(!mA(t.children))return!1}return!0}class Cx extends os{constructor(t,n){super(t),this.params=n}clone(){return new Cx(null,this.params)}dependentFields(){return new Set}producedFields(){}hash(){return`Graticule ${Ea(this.params)}`}assemble(){return Object.assign({type:"graticule"},this.params===!0?{}:this.params)}}class Ox extends os{constructor(t,n){super(t),this.params=n}clone(){return new Ox(null,this.params)}dependentFields(){return new Set}producedFields(){var t;return new Set([(t=this.params.as)!==null&&t!==void 0?t:"data"])}hash(){return`Hash ${Ea(this.params)}`}assemble(){return Object.assign({type:"sequence"},this.params)}}function Ok(e){return e instanceof P1||e instanceof Cx||e instanceof Ox}class xR{constructor(){this._mutated=!1}setMutated(){this._mutated=!0}get mutatedFlag(){return this._mutated}}class mv extends xR{constructor(){super(),this._continue=!1}setContinue(){this._continue=!0}get continueFlag(){return this._continue}get flags(){return{continueFlag:this.continueFlag,mutatedFlag:this.mutatedFlag}}set flags({continueFlag:t,mutatedFlag:n}){t&&this.setContinue(),n&&this.setMutated()}reset(){}optimizeNextFromLeaves(t){if(Ok(t))return!1;const n=t.parent,{continueFlag:r}=this.run(t);return r&&this.optimizeNextFromLeaves(n),this.mutatedFlag}}class gA extends xR{}function JU(e,t,n,r){const i=yu(r)?r.encoding[b0(t)]:void 0;if(_p(n)&&yu(r)&&mO(t,n,i,r.stack,r.markDef,r.config))e.add(ei(n,{})),e.add(ei(n,{suffix:"end"})),n.bin&&ux(n,t)&&e.add(ei(n,{binSuffix:"range"}));else if(function(s){return s in KC}(t)){const s=function(f){switch(f){case m0:return"y";case lg:return"y2";case g0:return"x";case pm:return"x2"}}(t);e.add(r.getName(s))}else e.add(ei(n));return e}class pg extends os{constructor(t,n,r){super(t),this.dimensions=n,this.measures=r}clone(){return new pg(null,new Set(this.dimensions),Go(this.measures))}get groupBy(){return this.dimensions}static makeFromEncoding(t,n){let r=!1;n.forEachFieldDef(f=>{f.aggregate&&(r=!0)});const i={},s=new Set;return r?(n.forEachFieldDef((f,m)=>{var x,O,T,M;const{aggregate:H,field:Z}=f;if(H)if(H==="count")i["*"]=(x=i["*"])!==null&&x!==void 0?x:{},i["*"].count=new Set([ei(f,{forAs:!0})]);else{if(Vv(H)||Iy(H)){const ue=Vv(H)?"argmin":"argmax",fe=H[ue];i[fe]=(O=i[fe])!==null&&O!==void 0?O:{},i[fe][ue]=new Set([ei({op:ue,field:fe},{forAs:!0})])}else i[Z]=(T=i[Z])!==null&&T!==void 0?T:{},i[Z][H]=new Set([ei(f,{forAs:!0})]);Yv(m)&&n.scaleDomain(m)==="unaggregated"&&(i[Z]=(M=i[Z])!==null&&M!==void 0?M:{},i[Z].min=new Set([ei({field:Z,aggregate:"min"},{forAs:!0})]),i[Z].max=new Set([ei({field:Z,aggregate:"max"},{forAs:!0})]))}else JU(s,m,f,n)}),s.size+Kr(i).length===0?null:new pg(t,s,i)):null}static makeFromTransform(t,n){var r,i,s;const f=new Set,m={};for(const x of n.aggregate){const{op:O,field:T,as:M}=x;O&&(O==="count"?(m["*"]=(r=m["*"])!==null&&r!==void 0?r:{},m["*"].count=new Set([M||ei(x,{forAs:!0})])):(m[T]=(i=m[T])!==null&&i!==void 0?i:{},m[T][O]=new Set([M||ei(x,{forAs:!0})])))}for(const x of(s=n.groupby)!==null&&s!==void 0?s:[])f.add(x);return f.size+Kr(m).length===0?null:new pg(t,f,m)}merge(t){return function(n,r){if(n.size!==r.size)return!1;for(const i of n)if(!r.has(i))return!1;return!0}(this.dimensions,t.dimensions)?(function(n,r){var i;for(const s of Kr(r)){const f=r[s];for(const m of Kr(f))s in n?n[s][m]=new Set([...(i=n[s][m])!==null&&i!==void 0?i:[],...f[m]]):n[s]={[m]:f[m]}}}(this.measures,t.measures),!0):(function(...n){qw.debug(...n)}("different dimensions, cannot merge"),!1)}addDimensions(t){t.forEach(this.dimensions.add,this.dimensions)}dependentFields(){return new Set([...this.dimensions,...Kr(this.measures)])}producedFields(){const t=new Set;for(const n of Kr(this.measures))for(const r of Kr(this.measures[n])){const i=this.measures[n][r];i.size===0?t.add(`${r}_${n}`):i.forEach(t.add,t)}return t}hash(){return`Aggregate ${Ea({dimensions:this.dimensions,measures:this.measures})}`}assemble(){const t=[],n=[],r=[];for(const i of Kr(this.measures))for(const s of Kr(this.measures[i]))for(const f of this.measures[i][s])r.push(f),t.push(s),n.push(i==="*"?null:Wv(i));return{type:"aggregate",groupby:[...this.dimensions].map(Wv),ops:t,fields:n,as:r}}}class L1 extends os{constructor(t,n,r,i){super(t),this.model=n,this.name=r,this.data=i;for(const s of mm){const f=n.facet[s];if(f){const{bin:m,sort:x}=f;this[s]=Object.assign({name:n.getName(`${s}_domain`),fields:[ei(f),...Ts(m)?[ei(f,{binSuffix:"end"})]:[]]},E0(x)?{sortField:x}:Gi(x)?{sortIndexField:j1(f,s)}:{})}}this.childModel=n.child}hash(){let t="Facet";for(const n of mm)this[n]&&(t+=` ${n.charAt(0)}:${Ea(this[n])}`);return t}get fields(){var t;const n=[];for(const r of mm)!((t=this[r])===null||t===void 0)&&t.fields&&n.push(...this[r].fields);return n}dependentFields(){const t=new Set(this.fields);for(const n of mm)this[n]&&(this[n].sortField&&t.add(this[n].sortField.field),this[n].sortIndexField&&t.add(this[n].sortIndexField));return t}producedFields(){return new Set}getSource(){return this.name}getChildIndependentFieldsWithStep(){const t={};for(const n of gm){const r=this.childModel.component.scales[n];if(r&&!r.merged){const i=r.get("type"),s=r.get("range");if(Ad(i)&&Jv(s)){const f=kA(Sk(this.childModel,n));f?t[n]=f:Gr(`Unknown field for ${n}. Cannot calculate view size.`)}}}return t}assembleRowColumnHeaderData(t,n,r){const i={row:"y",column:"x"}[t],s=[],f=[],m=[];r&&r[i]&&(n?(s.push(`distinct_${r[i]}`),f.push("max")):(s.push(r[i]),f.push("distinct")),m.push(`distinct_${r[i]}`));const{sortField:x,sortIndexField:O}=this[t];if(x){const{op:T=Kw,field:M}=x;s.push(M),f.push(T),m.push(ei(x,{forAs:!0}))}else O&&(s.push(O),f.push("max"),m.push(O));return{name:this[t].name,source:n??this.data,transform:[Object.assign({type:"aggregate",groupby:this[t].fields},s.length?{fields:s,ops:f,as:m}:{})]}}assembleFacetHeaderData(t){var n,r;const{columns:i}=this.model.layout,{layoutHeaders:s}=this.model.component,f=[],m={};for(const T of uA){for(const M of cA){const H=(n=s[T]&&s[T][M])!==null&&n!==void 0?n:[];for(const Z of H)if(((r=Z.axes)===null||r===void 0?void 0:r.length)>0){m[T]=!0;break}}if(m[T]){const M=`length(data("${this.facet.name}"))`,H=T==="row"?i?{signal:`ceil(${M} / ${i})`}:1:i?{signal:`min(${M}, ${i})`}:{signal:M};f.push({name:`${this.facet.name}_${T}`,transform:[{type:"sequence",start:0,stop:H}]})}}const{row:x,column:O}=m;return(x||O)&&f.unshift(this.assembleRowColumnHeaderData("facet",null,t)),f}assemble(){var t,n;const r=[];let i=null;const s=this.getChildIndependentFieldsWithStep(),{column:f,row:m,facet:x}=this;if(f&&m&&(s.x||s.y)){i=`cross_${this.column.name}_${this.row.name}`;const O=[].concat((t=s.x)!==null&&t!==void 0?t:[],(n=s.y)!==null&&n!==void 0?n:[]),T=O.map(()=>"distinct");r.push({name:i,source:this.data,transform:[{type:"aggregate",groupby:this.fields,fields:O,ops:T}]})}for(const O of[iv,rv])this[O]&&r.push(this.assembleRowColumnHeaderData(O,i,s));if(x){const O=this.assembleFacetHeaderData(s);O&&r.push(...O)}return r}}function wR(e){return e[0]==="'"&&e[e.length-1]==="'"||e[0]==='"'&&e[e.length-1]==='"'?e.slice(1,-1):e}function QU(e){const t={};return function n(r,i){if(zC(r))n(r.not,i);else if(LC(r))for(const s of r.and)n(s,i);else if(PC(r))for(const s of r.or)n(s,i);else i(r)}(e.filter,n=>{var r;if(RN(n)){let i=null;rO(n)?i=n.equal:iO(n)?i=n.range[0]:oO(n)&&(i=((r=n.oneOf)!==null&&r!==void 0?r:n.in)[0]),i&&(S1(i)?t[n.field]="date":Ju(i)?t[n.field]="number":$o(i)&&(t[n.field]="string")),n.timeUnit&&(t[n.field]="date")}}),t}function ZU(e){const t={};function n(r){ek(r)?t[r.field]="date":r.type==="quantitative"&&function(i){return $o(i)&&Ji(["min","max"],i)}(r.aggregate)?t[r.field]="number":Zb(r.field)>1?r.field in t||(t[r.field]="flatten"):bO(r)&&E0(r.sort)&&Zb(r.sort.field)>1&&(r.sort.field in t||(t[r.sort.field]="flatten"))}if((yu(e)||gg(e))&&e.forEachFieldDef((r,i)=>{if(_p(r))n(r);else{const s=jy(i),f=e.fieldDef(s);n(Object.assign(Object.assign({},r),{type:f.type}))}}),yu(e)){const{mark:r,markDef:i,encoding:s}=e;if(Fy(r)&&!e.encoding.order){const f=s[i.orient==="horizontal"?"y":"x"];!si(f)||f.type!=="quantitative"||f.field in t||(t[f.field]="number")}}return t}class gf extends os{constructor(t,n){super(t),this._parse=n}clone(){return new gf(null,Go(this._parse))}hash(){return`Parse ${Ea(this._parse)}`}static makeExplicit(t,n,r){let i={};const s=n.data;return!Hy(s)&&s&&s.format&&s.format.parse&&(i=s.format.parse),this.makeWithAncestors(t,i,{},r)}static makeWithAncestors(t,n,r,i){for(const m of Kr(r)){const x=i.getWithExplicit(m);x.value!==void 0&&(x.explicit||x.value===r[m]||x.value==="derived"||r[m]==="flatten"?delete r[m]:Gr(de.differentParse(m,r[m],x.value)))}for(const m of Kr(n)){const x=i.get(m);x!==void 0&&(x===n[m]?delete n[m]:Gr(de.differentParse(m,n[m],x)))}const s=new fv(n,r);i.copyAll(s);const f={};for(const m of Kr(s.combine())){const x=s.get(m);x!==null&&(f[m]=x)}return Kr(f).length===0||i.parseNothing?null:new gf(t,f)}get parse(){return this._parse}merge(t){this._parse=Object.assign(Object.assign({},this._parse),t.parse),t.remove()}assembleFormatParse(){const t={};for(const n of Kr(this._parse)){const r=this._parse[n];Zb(n)===1&&(t[n]=r)}return t}producedFields(){return new Set(Kr(this._parse))}dependentFields(){return new Set(Kr(this._parse))}assembleTransforms(t=!1){return Kr(this._parse).filter(n=>!t||Zb(n)>1).map(n=>{const r=function(i,s){const f=ZT(i);return s==="number"?`toNumber(${f})`:s==="boolean"?`toBoolean(${f})`:s==="string"?`toString(${f})`:s==="date"?`toDate(${f})`:s==="flatten"?f:s.indexOf("date:")===0?`timeParse(${f},'${wR(s.slice(5,s.length))}')`:s.indexOf("utc:")===0?`utcParse(${f},'${wR(s.slice(4,s.length))}')`:(Gr(de.unrecognizedParse(s)),null)}(n,this._parse[n]);return r?{type:"formula",expr:r,as:eN(n)}:null}).filter(n=>n!==null)}}class ay extends os{clone(){return new ay(null)}constructor(t){super(t)}dependentFields(){return new Set}producedFields(){return new Set([N1])}hash(){return"Identifier"}assemble(){return{type:"identifier",as:N1}}}class Jy extends os{constructor(t,n){super(t),this.transform=n}clone(){return new Jy(null,Go(this.transform))}addDimensions(t){this.transform.groupby=zv(this.transform.groupby.concat(t),n=>n)}dependentFields(){const t=new Set;return this.transform.groupby&&this.transform.groupby.forEach(t.add,t),this.transform.joinaggregate.map(n=>n.field).filter(n=>n!==void 0).forEach(t.add,t),t}producedFields(){return new Set(this.transform.joinaggregate.map(this.getDefaultName))}getDefaultName(t){var n;return(n=t.as)!==null&&n!==void 0?n:ei(t)}hash(){return`JoinAggregateTransform ${Ea(this.transform)}`}assemble(){const t=[],n=[],r=[];for(const s of this.transform.joinaggregate)n.push(s.op),r.push(this.getDefaultName(s)),t.push(s.field===void 0?null:s.field);const i=this.transform.groupby;return Object.assign({type:"joinaggregate",as:r,ops:n,fields:t},i!==void 0?{groupby:i}:{})}}class gv extends os{constructor(t,n){super(t),this._stack=n}clone(){return new gv(null,Go(this._stack))}static makeFromTransform(t,n){const{stack:r,groupby:i,as:s,offset:f="zero"}=n,m=[],x=[];if(n.sort!==void 0)for(const M of n.sort)m.push(M.field),x.push(Qu(M.order,"ascending"));const O={field:m,order:x};let T;return T=function(M){return Gi(M)&&M.every(H=>$o(H))&&M.length>1}(s)?s:$o(s)?[s,s+"_end"]:[n.stack+"_start",n.stack+"_end"],new gv(t,{stackField:r,groupby:i,offset:f,sort:O,facetby:[],as:T})}static makeFromEncoding(t,n){const r=n.stack,{encoding:i}=n;if(!r)return null;const{groupbyChannel:s,fieldChannel:f,offset:m,impute:x}=r;let O;s&&(O=O0(i[s]));const T=function(Z){return Z.stack.stackBy.reduce((ue,fe)=>{const Ie=ei(fe.fieldDef);return Ie&&ue.push(Ie),ue},[])}(n),M=n.encoding.order;let H;return H=Gi(M)||si(M)?vF(M):T.reduce((Z,ue)=>(Z.field.push(ue),Z.order.push(f==="y"?"descending":"ascending"),Z),{field:[],order:[]}),new gv(t,{dimensionFieldDef:O,stackField:n.vgField(f),facetby:[],stackby:T,sort:H,offset:m,impute:x,as:[n.vgField(f,{suffix:"start",forAs:!0}),n.vgField(f,{suffix:"end",forAs:!0})]})}get stack(){return this._stack}addDimensions(t){this._stack.facetby.push(...t)}dependentFields(){const t=new Set;return t.add(this._stack.stackField),this.getGroupbyFields().forEach(t.add,t),this._stack.facetby.forEach(t.add,t),this._stack.sort.field.forEach(t.add,t),t}producedFields(){return new Set(this._stack.as)}hash(){return`Stack ${Ea(this._stack)}`}getGroupbyFields(){const{dimensionFieldDef:t,impute:n,groupby:r}=this._stack;return t?t.bin?n?[ei(t,{binSuffix:"mid"})]:[ei(t,{}),ei(t,{binSuffix:"end"})]:[ei(t)]:r??[]}assemble(){const t=[],{facetby:n,dimensionFieldDef:r,stackField:i,stackby:s,sort:f,offset:m,impute:x,as:O}=this._stack;if(x&&r){const{band:T=.5,bin:M}=r;M&&t.push({type:"formula",expr:`${T}*`+ei(r,{expr:"datum"})+`+${1-T}*`+ei(r,{expr:"datum",binSuffix:"end"}),as:ei(r,{binSuffix:"mid",forAs:!0})}),t.push({type:"impute",field:i,groupby:[...s,...n],key:ei(r,{binSuffix:"mid"}),method:"value",value:0})}return t.push({type:"stack",groupby:[...this.getGroupbyFields(),...n],field:i,sort:f,as:O,offset:m}),t}}class z1 extends os{constructor(t,n){super(t),this.transform=n}clone(){return new z1(null,Go(this.transform))}addDimensions(t){this.transform.groupby=zv(this.transform.groupby.concat(t),n=>n)}dependentFields(){var t,n;const r=new Set;return((t=this.transform.groupby)!==null&&t!==void 0?t:[]).forEach(r.add,r),((n=this.transform.sort)!==null&&n!==void 0?n:[]).forEach(i=>r.add(i.field)),this.transform.window.map(i=>i.field).filter(i=>i!==void 0).forEach(r.add,r),r}producedFields(){return new Set(this.transform.window.map(this.getDefaultName))}getDefaultName(t){var n;return(n=t.as)!==null&&n!==void 0?n:ei(t)}hash(){return`WindowTransform ${Ea(this.transform)}`}assemble(){var t;const n=[],r=[],i=[],s=[];for(const H of this.transform.window)r.push(H.op),i.push(this.getDefaultName(H)),s.push(H.param===void 0?null:H.param),n.push(H.field===void 0?null:H.field);const f=this.transform.frame,m=this.transform.groupby;if(f&&f[0]===null&&f[1]===null&&r.every(H=>GC(H)))return Object.assign({type:"joinaggregate",as:i,ops:r,fields:n},m!==void 0?{groupby:m}:{});const x=[],O=[];if(this.transform.sort!==void 0)for(const H of this.transform.sort)x.push(H.field),O.push((t=H.order)!==null&&t!==void 0?t:"ascending");const T={field:x,order:O},M=this.transform.ignorePeers;return Object.assign(Object.assign(Object.assign({type:"window",params:s,as:i,ops:r,fields:n,sort:T},M!==void 0?{ignorePeers:M}:{}),m!==void 0?{groupby:m}:{}),f!==void 0?{frame:f}:{})}}class eW extends mv{run(t){const n=t.parent;if(t instanceof gf){if(Ok(n))return this.flags;if(n.numChildren()>1)return this.setContinue(),this.flags;if(n instanceof gf)this.setMutated(),n.merge(t);else{if(JT(n.producedFields(),t.dependentFields()))return this.setContinue(),this.flags;this.setMutated(),t.swapWithParent()}}return this.setContinue(),this.flags}}class tW extends gA{mergeNodes(t,n){const r=n.shift();for(const i of n)t.removeChild(i),i.parent=r,i.remove()}run(t){const n=t.children.map(i=>i.hash()),r={};for(let i=0;i<n.length;i++)r[n[i]]===void 0?r[n[i]]=[t.children[i]]:r[n[i]].push(t.children[i]);for(const i of Kr(r))r[i].length>1&&(this.setMutated(),this.mergeNodes(t,r[i]));for(const i of t.children)this.run(i);return this.mutatedFlag}}class nW extends mv{run(t){return t instanceof wh||t.numChildren()>0||t instanceof L1?this.flags:(this.setMutated(),t.remove(),this.flags)}}class rW extends mv{constructor(){super(...arguments),this.fields=new Set,this.prev=null}run(t){if(this.setContinue(),t instanceof S0){const n=t.producedFields();XT(n,this.fields)?(this.setMutated(),this.prev.remove()):this.fields=new Set([...this.fields,...n]),this.prev=t}return this.flags}reset(){this.fields.clear()}}class iW extends mv{run(t){this.setContinue();const n=t.parent.children.filter(i=>i instanceof S0),r=n.pop();for(const i of n)this.setMutated(),r.merge(i);return this.flags}}function vA(e){if(e instanceof L1)if(e.numChildren()!==1||e.children[0]instanceof wh){const t=e.model.component.data.main;(function i(s){if(s instanceof wh&&s.type===ff&&s.numChildren()===1){const f=s.children[0];f instanceof L1||(f.swapWithParent(),i(s))}})(t);const n=function(i){return function s(f){if(!(f instanceof L1)){const m=f.clone();if(m instanceof wh){const x=yA+m.getSource();m.setSource(x),i.model.component.data.outputNodes[x]=m}else(m instanceof pg||m instanceof gv||m instanceof z1||m instanceof Jy)&&m.addDimensions(i.fields);for(const x of f.children.flatMap(s))x.parent=m;return[m]}return f.children.flatMap(s)}}(e),r=e.children.map(n).flat();for(const i of r)i.parent=t}else{const t=e.children[0];(t instanceof pg||t instanceof gv||t instanceof z1||t instanceof Jy)&&t.addDimensions(e.fields),t.swapWithParent(),vA(e)}else e.children.map(vA)}class oW extends gA{constructor(){super()}run(t){t instanceof wh&&!t.isRequired()&&(this.setMutated(),t.remove());for(const n of t.children)this.run(n);return this.mutatedFlag}}class aW extends gA{constructor(t){super(),this.requiresSelectionId=t&&XO(t)}run(t){t instanceof ay&&(this.requiresSelectionId&&(Ok(t.parent)||t.parent instanceof pg||t.parent instanceof gf)||(this.setMutated(),t.remove()));for(const n of t.children)this.run(n);return this.mutatedFlag}}class sW extends mv{run(t){const n=t.parent,r=[...n.children],i=n.children.filter(s=>s instanceof gf);if(n.numChildren()>1&&i.length>=1){const s={},f=new Set;for(const m of i){const x=m.parse;for(const O of Kr(x))O in s?s[O]!==x[O]&&f.add(O):s[O]=x[O]}for(const m of f)delete s[m];if(!ms(s)){this.setMutated();const m=new gf(n,s);for(const x of r){if(x instanceof gf)for(const O of Kr(s))delete x.parse[O];n.removeChild(x),x.parent=m,x instanceof gf&&Kr(x.parse).length===0&&x.remove()}}}return this.setContinue(),this.flags}}class uW extends mv{run(t){const n=t.parent,r=n.children.filter(s=>s instanceof pg),i={};for(const s of r){const f=Ea(s.groupBy);f in i||(i[f]=[]),i[f].push(s)}for(const s of Kr(i)){const f=i[s];if(f.length>1){const m=f.pop();for(const x of f)m.merge(x)&&(n.removeChild(x),x.parent=m,x.remove(),this.setMutated())}}return this.setContinue(),this.flags}}class cW extends mv{constructor(t){super(),this.model=t}run(t){const n=t.parent,r=!(Ok(n)||n instanceof R1||n instanceof gf||n instanceof ay),i=[],s=[];for(const f of n.children)f instanceof D0&&(r&&!JT(n.producedFields(),f.dependentFields())?i.push(f):s.push(f));if(i.length>0){const f=i.pop();for(const m of i)f.merge(m,this.model.renameSignal.bind(this.model));this.setMutated(),n instanceof D0?n.merge(f,this.model.renameSignal.bind(this.model)):f.swapWithParent()}if(s.length>1){const f=s.pop();for(const m of s)f.merge(m,this.model.renameSignal.bind(this.model));this.setMutated()}return this.setContinue(),this.flags}}class lW extends mv{run(t){const n=t.parent,r=[...n.children];if(!Jb(r,f=>f instanceof wh)||n.numChildren()<=1)return this.setContinue(),this.flags;const i=[];let s;for(const f of r)if(f instanceof wh){let m=f;for(;m.numChildren()===1;){const x=m.children[0];if(!(x instanceof wh))break;m=x}i.push(...m.children),s?(n.removeChild(f),f.parent=s.parent,s.parent.removeChild(s),s.parent=m,this.setMutated()):s=m}else i.push(f);if(i.length){this.setMutated();for(const f of i)f.parent.removeChild(f),f.parent=s}return this.setContinue(),this.flags}}const yA="scale_",Ak=5;function sy(e){const t=[];function n(r){if(r.numChildren()===0)t.push(r);else for(const i of r.children)n(i)}for(const r of e)n(r);return t}function fW(e){return e}function mg(e,t){return t.map(n=>{if(e instanceof mv){const r=e.optimizeNextFromLeaves(n);return e.reset(),r}return e.run(n)}).some(fW)}function kR(e,t){let n=e.sources;const r=new Set;return r.add(mg(new oW,n)),r.add(mg(new aW(t),n)),n=n.filter(i=>i.numChildren()>0),r.add(mg(new nW,sy(n))),n=n.filter(i=>i.numChildren()>0),r.add(mg(new eW,sy(n))),r.add(mg(new cW(t),sy(n))),r.add(mg(new rW,sy(n))),r.add(mg(new sW,sy(n))),r.add(mg(new uW,sy(n))),r.add(mg(new iW,sy(n))),r.add(mg(new tW,n)),r.add(mg(new lW,sy(n))),e.sources=n,r.has(!0)}class Dp{constructor(t){Object.defineProperty(this,"signal",{enumerable:!0,get:t})}static fromName(t,n){return new Dp(()=>t(n))}}function ER(e){yu(e)?function(t){const n=t.component.scales;for(const r of Kr(n)){const i=hW(t,r);if(n[r].setWithExplicit("domains",i),dW(t,r),t.component.data.isFaceted){let f=t;for(;!gg(f)&&f.parent;)f=f.parent;if(f.component.resolve.scale[r]==="shared")for(const x of i.value)Qv(x)&&(x.data=yA+x.data.replace(yA,""))}}}(e):function(t){for(const r of t.children)ER(r);const n=t.component.scales;for(const r of Kr(n)){let i,s=null;for(const f of t.children){const m=f.component.scales[r];if(m){i=i===void 0?m.getWithExplicit("domains"):ny(i,m.getWithExplicit("domains"),"domains","scale",wA);const x=m.get("selectionExtent");s&&x&&s.selection!==x.selection&&Gr("The same selection must be used to override scale domains in a layered view."),s=x}}n[r].setWithExplicit("domains",i),s&&n[r].set("selectionExtent",s,!0)}}(e)}function hW(e,t){const n=e.getScaleComponent(t).get("type"),{encoding:r}=e,i=function(s,f,m,x){if(s==="unaggregated"){const{valid:O,reason:T}=CR(f,m);if(!O)return void Gr(T)}else if(s===void 0&&x.useUnaggregatedDomain){const{valid:O}=CR(f,m);if(O)return"unaggregated"}return s}(e.scaleDomain(t),e.typedFieldDef(t),n,e.config.scale);return i!==e.scaleDomain(t)&&(e.specifiedScales[t]=Object.assign(Object.assign({},e.specifiedScales[t]),{domain:i})),t==="x"&&yc(r.x2)?yc(r.x)?ny(uy(n,i,e,"x"),uy(n,i,e,"x2"),"domain","scale",wA):uy(n,i,e,"x2"):t==="y"&&yc(r.y2)?yc(r.y)?ny(uy(n,i,e,"y"),uy(n,i,e,"y2"),"domain","scale",wA):uy(n,i,e,"y2"):uy(n,i,e,t)}function bA(e,t,n){var r;const i=(r=xh(n))===null||r===void 0?void 0:r.unit;return t==="temporal"||i?function(s,f,m){return s.map(x=>({signal:`{data: ${EO(x,{timeUnit:m,type:f})}}`}))}(e,t,i):[e]}function uy(e,t,n,r){const{encoding:i}=n,s=yc(i[r]),{type:f}=s,m=s.timeUnit;if(function(M){return M&&M.unionWith}(t)){const M=uy(e,void 0,n,r),H=bA(t.unionWith,f,m);return qy([...M.value,...H])}if(po(t))return qy([t]);if(t&&t!=="unaggregated"&&!PN(t))return qy(bA(t,f,m));const x=n.stack;if(x&&r===x.fieldChannel){if(x.offset==="normalize")return hg([[0,1]]);const M=n.requestDataName(ff);return hg([{data:M,field:n.vgField(r,{suffix:"start"})},{data:M,field:n.vgField(r,{suffix:"end"})}])}const O=Yv(r)&&si(s)?function(M,H,Z){if(!Ad(Z))return;const ue=M.fieldDef(H),fe=ue.sort;if(eF(fe))return{op:"min",field:j1(ue,H),order:"ascending"};const{stack:Ie}=M,Pe=Ie?[...Ie.groupbyField?[Ie.groupbyField]:[],...Ie.stackBy.map(Le=>Le.fieldDef.field)]:void 0;if(E0(fe)){const Le=Ie&&!Ji(Pe,fe.field);return xA(fe,Le)}if(ZN(fe)){const{encoding:Le,order:rt}=fe,it=M.fieldDef(Le),{aggregate:ut,field:st}=it,mt=Ie&&!Ji(Pe,st);if(Vv(ut)||Iy(ut))return xA({field:ei(it),order:rt},mt);if(GC(ut)||!ut)return xA({op:ut,field:st,order:rt},mt)}else{if(fe==="descending")return{op:"min",field:M.vgField(H),order:"descending"};if(Ji(["ascending",void 0],fe))return!0}}(n,r,e):void 0;if(ey(s))return hg(bA([s.datum],f,m));const T=s;if(t==="unaggregated"){const M=n.requestDataName(ff),{field:H}=s;return hg([{data:M,field:ei({field:H,aggregate:"min"})},{data:M,field:ei({field:H,aggregate:"max"})}])}if(Ts(T.bin)){if(Ad(e))return hg(e==="bin-ordinal"?[]:[{data:Aw(O)?n.requestDataName(ff):n.requestDataName(ck),field:n.vgField(r,ux(T,r)?{binSuffix:"range"}:{}),sort:O!==!0&&Uc(O)?O:{field:n.vgField(r,{}),op:"min"}}]);{const{bin:M}=T;if(Ts(M)){const H=pA(n,T.field,M);return hg([new Dp(()=>{const Z=n.getSignalName(H);return`[${Z}.start, ${Z}.stop]`})])}return hg([{data:n.requestDataName(ff),field:n.vgField(r,{})}])}}if(T.timeUnit&&Ji(["time","utc"],e)&&mO(r,T,yu(n)?n.encoding[b0(r)]:void 0,n.stack,n.markDef,n.config)){const M=n.requestDataName(ff);return hg([{data:M,field:n.vgField(r)},{data:M,field:n.vgField(r,{suffix:"end"})}])}return hg(O?[{data:Aw(O)?n.requestDataName(ff):n.requestDataName(ck),field:n.vgField(r),sort:O}]:[{data:n.requestDataName(ff),field:n.vgField(r)}])}function xA(e,t){const{op:n,field:r,order:i}=e;return Object.assign(Object.assign({op:n??(t?"sum":Kw)},r?{field:Wv(r)}:{}),i?{order:i}:{})}function dW(e,t){var n;const r=e.component.scales[t],i=e.specifiedScales[t].domain,s=(n=e.fieldDef(t))===null||n===void 0?void 0:n.bin,f=PN(i)&&i,m=rx(s)&&Vw(s.extent)&&s.extent;(f||m)&&r.set("selectionExtent",f??m,!0)}function CR(e,t){const{aggregate:n,type:r}=e;return n?$o(n)&&!L7[n]?{valid:!1,reason:de.unaggregateDomainWithNonSharedDomainOp(n)}:r==="quantitative"&&t==="log"?{valid:!1,reason:de.unaggregatedDomainWithLogScale(e)}:{valid:!0}:{valid:!1,reason:de.unaggregateDomainHasNoEffectForRawField(e)}}function wA(e,t,n,r){return e.explicit&&t.explicit&&Gr(de.mergeConflictingDomainProperty(n,r,e.value,t.value)),{explicit:e.explicit,value:[...e.value,...t.value]}}function kA(e){if(Qv(e)&&$o(e.field))return e.field;if(function(t){return!Gi(t)&&"fields"in t&&!("data"in t)}(e)){let t;for(const n of e.fields)if(Qv(n)&&$o(n.field))if(t){if(t!==n.field)return Gr(de.FACETED_INDEPENDENT_DIFFERENT_SOURCES),t}else t=n.field;return Gr(de.FACETED_INDEPENDENT_SAME_FIELDS_DIFFERENT_SOURCES),t}if(function(t){return!Gi(t)&&"fields"in t&&"data"in t}(e)){Gr(de.FACETED_INDEPENDENT_SAME_SOURCE);const t=e.fields[0];return $o(t)?t:void 0}}function Sk(e,t){return function(n){const r=zv(n.map(x=>Qv(x)?Li(x,["sort"]):x),Ea),i=zv(n.map(x=>{if(Qv(x)){const O=x.sort;return O===void 0||Aw(O)||("op"in O&&O.op==="count"&&delete O.field,O.order==="ascending"&&delete O.order),O}}).filter(x=>x!==void 0),Ea);if(r.length===0)return;if(r.length===1){const x=n[0];if(Qv(x)&&i.length>0){let O=i[0];if(i.length>1)Gr(de.MORE_THAN_ONE_SORT),O=!0;else if(Uc(O)&&"field"in O){const T=O.field;x.field===T&&(O=!O.order||{order:O.order})}return Object.assign(Object.assign({},x),{sort:O})}return x}const s=zv(i.map(x=>Aw(x)||!("op"in x)||x.op in j7?x:(Gr(de.domainSortDropped(x)),!0)),Ea);let f;s.length===1?f=s[0]:s.length>1&&(Gr(de.MORE_THAN_ONE_SORT),f=!0);const m=zv(n.map(x=>Qv(x)?x.data:null),x=>x);return m.length===1&&m[0]!==null?Object.assign({data:m[0],fields:r.map(x=>x.field)},f?{sort:f}:{}):Object.assign({fields:r},f?{sort:f}:{})}(e.component.scales[t].get("domains").map(n=>(Qv(n)&&(n.data=e.lookupDataSource(n.data)),n)))}function OR(e){return Kr(e.component.scales).reduce((t,n)=>{const r=e.component.scales[n];if(r.merged)return t;const i=r.combine(),{name:s,type:f,selectionExtent:m,domains:x,range:O,reverse:T}=i,M=Li(i,["name","type","selectionExtent","domains","range","reverse"]),H=function(fe,Ie,Pe){return w0(Pe)&&Jv(fe)?{step:{signal:Ie+"_step"}}:fe}(i.range,s,n);let Z;m&&(Z=function(fe,Ie){const Pe=Ie.selection;return{signal:WI(fe.getSelectionComponent(Pe,eu(Pe)),Ie)}}(e,m));const ue=Sk(e,n);return t.push(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:s,type:f},ue?{domain:ue}:{}),Z?{domainRaw:Z}:{}),{range:H}),T!==void 0?{reverse:T}:{}),M)),t},[])}class AR extends fv{constructor(t,n){super({},{name:t}),this.merged=!1,this.setWithExplicit("type",n)}domainDefinitelyIncludesZero(){return this.get("zero")!==!1||Jb(this.get("domains"),t=>Gi(t)&&t.length===2&&t[0]<=0&&t[1]>=0)}}const pW=["range","scheme"];function SR(e){return e==="x"?"width":e==="y"?"height":void 0}function _R(e,t){const n=e.fieldDef(t);if(n&&n.bin&&Ts(n.bin)){const r=pA(e,n.field,n.bin),i=SR(t),s=e.getName(i);return new Dp(()=>{const f=e.getSignalName(r),m=`(${f}.stop - ${f}.start) / ${f}.step`;return`${e.getSignalName(s)} / (${m})`})}}function mW(e,t){const n=t.specifiedScales[e],{size:r}=t,i=t.getScaleComponent(e).get("type");for(const s of pW)if(n[s]!==void 0){const f=LN(i,s),m=zN(e,s);if(f)if(m)Gr(m);else switch(s){case"range":return Gi(n.range)&&w0(e)?qy(n.range.map(x=>{if(x==="width"||x==="height"){const O=t.getName(x),T=t.getSignalName.bind(t);return Dp.fromName(T,O)}return x})):qy(n.range);case"scheme":return qy(gW(n[s]))}else Gr(de.scalePropertyNotWorkWithScaleType(i,s,e))}if(e===uu||e===vc){const s=e===uu?"width":"height",f=r[s];if(A0(f)){if(Ad(i))return qy({step:f.step});Gr(de.stepDropped(s))}}return hg(function(s,f){const{size:m,config:x,mark:O,encoding:T}=f,M=f.getSignalName.bind(f),{type:H}=yc(T[s]),Z=f.getScaleComponent(s).get("type"),{domain:ue,domainMid:fe}=f.specifiedScales[s];switch(s){case uu:case vc:{if(Ji(["point","band"],Z))if(s!==uu||m.width){if(s===vc&&!m.height){const Le=lx(x.view,"height");if(A0(Le))return Le}}else{const Le=lx(x.view,"width");if(A0(Le))return Le}const Ie=SR(s),Pe=f.getName(Ie);return s===vc&&vm(Z)?[Dp.fromName(M,Pe),0]:[0,Dp.fromName(M,Pe)]}case sv:{const Ie=f.component.scales[s].get("zero"),Pe=function rt(it,ut,st){if(ut)return po(ut)?{signal:`${ut.signal} ? 0 : ${rt(it,!1,st)}`}:0;switch(it){case"bar":case"tick":return st.scale.minBandSize;case"line":case"trail":case"rule":return st.scale.minStrokeWidth;case"text":return st.scale.minFontSize;case"point":case"square":case"circle":return st.scale.minSize}throw new Error(de.incompatibleChannel("size",it))}(O,Ie,x),Le=function(rt,it,ut,st){const mt={x:_R(ut,"x"),y:_R(ut,"y")};switch(rt){case"bar":case"tick":{if(st.scale.maxBandSize!==void 0)return st.scale.maxBandSize;const dt=TR(it,mt,st.view);return Ju(dt)?dt-1:new Dp(()=>`${dt.signal} - 1`)}case"line":case"trail":case"rule":return st.scale.maxStrokeWidth;case"text":return st.scale.maxFontSize;case"point":case"square":case"circle":{if(st.scale.maxSize)return st.scale.maxSize;const dt=TR(it,mt,st.view);return Ju(dt)?Math.pow(DR*dt,2):new Dp(()=>`pow(${DR} * ${dt.signal}, 2)`)}}throw new Error(de.incompatibleChannel("size",rt))}(O,m,f,x);return Hw(Z)?function(rt,it,ut){const st=()=>{const mt=cx(it),dt=cx(rt),en=`(${mt} - ${dt}) / (${ut} - 1)`;return`sequence(${dt}, ${mt} + ${en}, ${en})`};return po(it)?new Dp(st):{signal:st()}}(Pe,Le,function(rt,it,ut,st){switch(rt){case"quantile":return it.scale.quantileCount;case"quantize":return it.scale.quantizeCount;case"threshold":return ut!==void 0&&Gi(ut)?ut.length+1:(Gr(de.domainRequiredForThresholdScale(st)),3)}}(Z,x,ue,s)):[Pe,Le]}case cg:return[0,2*Math.PI];case Ry:return[0,360];case p0:return[0,new Dp(()=>{const Ie=f.getSignalName("width"),Pe=f.getSignalName("height");return`min(${Ie},${Pe})/2`})];case $v:return[x.scale.minStrokeWidth,x.scale.maxStrokeWidth];case Gv:return[[1,0],[4,2],[2,1],[1,1],[1,2,4,2]];case Od:return"symbol";case Cd:case v0:case y0:return Z==="ordinal"?H==="nominal"?"category":"ordinal":fe!==void 0?"diverging":O==="rect"||O==="geoshape"?"heatmap":"ramp";case uv:case qv:case Hv:return[x.scale.minOpacity,x.scale.maxOpacity]}throw new Error(`Scale range undefined for channel ${s}`)}(e,t))}function gW(e){return function(t){return!$o(t)&&!!t.name}(e)?Object.assign({scheme:e.name},tv(e,["name"])):{scheme:e}}const DR=.95;function TR(e,t,n){const r=A0(e.width)?e.width.step:ok(n,"width"),i=A0(e.height)?e.height.step:ok(n,"height");return t.x||t.y?new Dp(()=>`min(${[t.x?t.x.signal:r,t.y?t.y.signal:i].join(", ")})`):Math.min(r,i)}function NR(e,t){yu(e)?function(n,r){const i=n.component.scales,{config:s,encoding:f,markDef:m,specifiedScales:x}=n;for(const O of Kr(i)){const T=x[O],M=i[O],H=n.getScaleComponent(O),Z=yc(f[O]),ue=T[r],fe=H.get("type"),Ie=H.get("padding"),Pe=H.get("paddingInner"),Le=LN(fe,r),rt=zN(O,r);if(ue!==void 0&&(Le?rt&&Gr(rt):Gr(de.scalePropertyNotWorkWithScaleType(fe,r,O))),Le&&rt===void 0)if(ue!==void 0)M.copyKeyFromObject(r,T);else{const it=r in FR?FR[r]({model:n,channel:O,fieldOrDatumDef:Z,scaleType:fe,scalePadding:Ie,scalePaddingInner:Pe,domain:T.domain,markDef:m,config:s}):s.scale[r];it!==void 0&&M.set(r,it,!1)}}}(e,t):RR(e,t)}const FR={bins:({model:e,fieldOrDatumDef:t})=>si(t)?function(n,r){const i=r.bin;if(Ts(i)){const s=pA(n,r.field,i);return new Dp(()=>n.getSignalName(s))}if(bh(i)&&rx(i)&&i.step!==void 0)return{step:i.step}}(e,t):void 0,interpolate:({channel:e,fieldOrDatumDef:t})=>function(n,r){if(Ji([Cd,v0,y0],n)&&r!=="nominal")return"hcl"}(e,t.type),nice:({scaleType:e,channel:t,fieldOrDatumDef:n})=>function(r,i,s){var f;if(!(!((f=O0(s))===null||f===void 0)&&f.bin||Ji([Zu.TIME,Zu.UTC],r)))return i in Xv||void 0}(e,t,n),padding:({channel:e,scaleType:t,fieldOrDatumDef:n,markDef:r,config:i})=>function(s,f,m,x,O,T){if(s in Xv){if(fg(f)){if(m.continuousPadding!==void 0)return m.continuousPadding;const{type:M,orient:H}=O;if(M==="bar"&&(!si(x)||!x.bin&&!x.timeUnit)&&(H==="vertical"&&s==="x"||H==="horizontal"&&s==="y"))return T.continuousBandSize}if(f===Zu.POINT)return m.pointPadding}}(e,t,i.scale,n,r,i.bar),paddingInner:({scalePadding:e,channel:t,markDef:n,config:r})=>function(i,s,f,m){if(i===void 0&&s in Xv){const{bandPaddingInner:x,barBandPaddingInner:O,rectBandPaddingInner:T}=m;return Qu(x,f==="bar"?O:T)}}(e,t,n.type,r.scale),paddingOuter:({scalePadding:e,channel:t,scaleType:n,markDef:r,scalePaddingInner:i,config:s})=>function(f,m,x,O,T,M){if(f===void 0&&m in Xv&&x===Zu.BAND){const{bandPaddingOuter:H}=M;return Qu(H,po(T)?{signal:`${T.signal}/2`}:T/2)}}(e,t,n,r.type,i,s.scale),reverse:({fieldOrDatumDef:e,scaleType:t,channel:n,config:r})=>function(i,s,f,m){if(f==="x"&&m.xReverse!==void 0)return vm(i)&&s==="descending"?po(m.xReverse)?{signal:`!${m.xReverse.signal}`}:!m.xReverse:m.xReverse;if(vm(i)&&s==="descending")return!0}(t,si(e)?e.sort:void 0,n,r.scale),zero:({channel:e,fieldOrDatumDef:t,domain:n,markDef:r,scaleType:i})=>function(s,f,m,x,O){if(m&&m!=="unaggregated"&&vm(O)){if(Gi(m)){const T=m[0],M=m[m.length-1];if(T<=0&&M>=0)return!0}return!1}if(s==="size"&&f.type==="quantitative"&&!Hw(O))return!0;if((!si(f)||!f.bin)&&Ji([...gm,...$7],s)){const{orient:T,type:M}=x;return!Ji(["bar","area","line","trail"],M)||!(T==="horizontal"&&s==="y"||T==="vertical"&&s==="x")}return!1}(e,t,n,r,i)};function IR(e){yu(e)?function(t){const n=t.component.scales;for(const r of Uw){const i=n[r];if(!i)continue;const s=mW(r,t);i.setWithExplicit("range",s)}}(e):RR(e,"range")}function RR(e,t){const n=e.component.scales;for(const r of e.children)t==="range"?IR(r):NR(r,t);for(const r of Kr(n)){let i;for(const s of e.children){const f=s.component.scales[r];f&&(i=ny(i,f.getWithExplicit(t),t,"scale",ZF((m,x)=>{switch(t){case"range":return m.step&&x.step?m.step-x.step:0}return 0})))}n[r].setWithExplicit(t,i)}}function vW(e,t,n,r){const i=function(f,m,x){var O;switch(m.type){case"nominal":case"ordinal":if(A1(f)||Ww(f)==="discrete")return f==="shape"&&m.type==="ordinal"&&Gr(de.discreteChannelCannotEncode(f,"ordinal")),"ordinal";if(f in Xv){if(Ji(["rect","bar","image","rule"],x))return"band"}else if(x==="arc"&&f in JC)return"band";return m.band!==void 0||xO(m)&&(!((O=m.axis)===null||O===void 0)&&O.tickBand)?"band":"point";case"temporal":return A1(f)?"time":Ww(f)==="discrete"?(Gr(de.discreteChannelCannotEncode(f,"temporal")),"ordinal"):si(m)&&m.timeUnit&&xh(m.timeUnit).utc?"utc":"time";case"quantitative":return A1(f)?si(m)&&Ts(m.bin)?"bin-ordinal":"linear":Ww(f)==="discrete"?(Gr(de.discreteChannelCannotEncode(f,"quantitative")),"ordinal"):"linear";case"geojson":return}throw new Error(de.invalidFieldType(m.type))}(t,n,r),{type:s}=e;return Yv(t)?s!==void 0?WN(t,s)?si(n)&&!UN(s,n.type)?(Gr(de.scaleTypeNotWorkWithFieldDef(s,i)),i):s:(Gr(de.scaleTypeNotWorkWithChannel(t,s,i)),i):i:null}function MR(e){yu(e)?e.component.scales=function(t){const{encoding:n,mark:r}=t;return Uw.reduce((i,s)=>{const f=yc(n[s]);if(f&&r===sN&&s===Od&&f.type===T1)return i;let m=f&&f.scale;if(f&&m!==null&&m!==!1){const x=vW(m=m??{},s,f,r);i[s]=new AR(t.scaleName(s+"",!0),{value:x,explicit:m.type===x})}return i},{})}(e):e.component.scales=function(t){var n;const r=t.component.scales={},i={},s=t.component.resolve;for(const f of t.children){MR(f);for(const m of Kr(f.component.scales))if(s.scale[m]=(n=s.scale[m])!==null&&n!==void 0?n:UU(m,t),s.scale[m]==="shared"){const x=i[m],O=f.component.scales[m].getWithExplicit("type");x?OL(x.value,O.value)?i[m]=ny(x,O,"type","scale",yW):(s.scale[m]="independent",delete i[m]):i[m]=O}}for(const f of Kr(i)){const m=t.scaleName(f,!0),x=i[f];r[f]=new AR(m,x);for(const O of t.children){const T=O.component.scales[f];T&&(O.renameScale(T.get("name"),m),T.merged=!0)}}return r}(e)}const yW=ZF((e,t)=>jN(e)-jN(t));class EA{constructor(){this.nameMap={}}rename(t,n){this.nameMap[t]=n}has(t){return this.nameMap[t]!==void 0}get(t){for(;this.nameMap[t]&&t!==this.nameMap[t];)t=this.nameMap[t];return t}}function yu(e){return(e==null?void 0:e.type)==="unit"}function gg(e){return(e==null?void 0:e.type)==="facet"}function CA(e){return(e==null?void 0:e.type)==="concat"}function U1(e){return(e==null?void 0:e.type)==="layer"}class OA{constructor(t,n,r,i,s,f,m){var x,O;this.type=n,this.parent=r,this.config=s,this.view=m,this.children=[],this.correctDataNames=T=>(T.from&&T.from.data&&(T.from.data=this.lookupDataSource(T.from.data)),T.from&&T.from.facet&&T.from.facet.data&&(T.from.facet.data=this.lookupDataSource(T.from.facet.data)),T),this.parent=r,this.config=s,this.name=(x=t.name)!==null&&x!==void 0?x:i,this.title=ty(t.title)?{text:t.title}:t.title,this.scaleNameMap=r?r.scaleNameMap:new EA,this.projectionNameMap=r?r.projectionNameMap:new EA,this.signalNameMap=r?r.signalNameMap:new EA,this.data=t.data,this.description=t.description,this.transforms=Az((O=t.transform)!==null&&O!==void 0?O:[]),this.layout=n==="layer"||n==="unit"?{}:function(T,M,H){var Z,ue;const fe=H[M],Ie={},{spacing:Pe,columns:Le}=fe;Pe!==void 0&&(Ie.spacing=Pe),Le!==void 0&&(Xw(T)&&!ax(T.facet)||RO(T))&&(Ie.columns=Le),ik(T)&&(Ie.columns=1);for(const rt of GL)if(T[rt]!==void 0)if(rt==="spacing"){const it=T[rt];Ie[rt]=Ju(it)?it:{row:(Z=it.row)!==null&&Z!==void 0?Z:Pe,column:(ue=it.column)!==null&&ue!==void 0?ue:Pe}}else Ie[rt]=T[rt];return Ie}(t,n,s),this.component={data:{sources:r?r.component.data.sources:[],outputNodes:r?r.component.data.outputNodes:{},outputNodeRefCounts:r?r.component.data.outputNodeRefCounts:{},isFaceted:Xw(t)||r&&r.component.data.isFaceted&&t.data===void 0},layoutSize:new fv,layoutHeaders:{row:{},column:{},facet:{}},mark:null,resolve:Object.assign({scale:{},axis:{},legend:{}},f?Go(f):{}),selection:null,scales:null,projection:null,axes:{},legends:{}}}get width(){return this.getSizeSignalRef("width")}get height(){return this.getSizeSignalRef("height")}parse(){this.parseScale(),this.parseLayoutSize(),this.renameTopLevelLayoutSizeSignal(),this.parseSelections(),this.parseProjection(),this.parseData(),this.parseAxesAndHeaders(),this.parseLegends(),this.parseMarkGroup()}parseScale(){(function(t,{ignoreRange:n}={}){MR(t),ER(t);for(const r of RL)NR(t,r);n||IR(t)})(this)}parseProjection(){vR(this)}renameTopLevelLayoutSizeSignal(){this.getName("width")!=="width"&&this.renameSignal(this.getName("width"),"width"),this.getName("height")!=="height"&&this.renameSignal(this.getName("height"),"height")}parseLegends(){fR(this)}assembleGroupStyle(){var t,n;if(this.type==="unit"||this.type==="layer")return(n=(t=this.view)===null||t===void 0?void 0:t.style)!==null&&n!==void 0?n:"cell"}assembleEncodeFromView(t){const n=Li(t,["style"]),r={};for(const i of Kr(n)){const s=n[i];s!==void 0&&(r[i]=ju(s))}return r}assembleGroupEncodeEntry(t){let n={};return this.view&&(n=this.assembleEncodeFromView(this.view)),t||(this.description&&(n.description=ju(this.description)),this.type!=="unit"&&this.type!=="layer")?ms(n)?void 0:n:Object.assign({width:this.getSizeSignalRef("width"),height:this.getSizeSignalRef("height")},n??{})}assembleLayout(){if(!this.layout)return;const t=this.layout,{spacing:n}=t,r=Li(t,["spacing"]),{component:i,config:s}=this,f=function(m,x){const O={};for(const T of mm){const M=m[T];if(M!=null&&M.facetFieldDef){const{titleAnchor:H,titleOrient:Z}=Ek(["titleAnchor","titleOrient"],M.facetFieldDef,x,T),ue=kk(T,Z),fe=zU(H,ue);fe!==void 0&&(O[ue]=fe)}}return ms(O)?void 0:O}(i.layoutHeaders,s);return Object.assign(Object.assign(Object.assign({padding:n},this.assembleDefaultLayout()),r),f?{titleBand:f}:{})}assembleDefaultLayout(){return{}}assembleHeaderMarks(){const{layoutHeaders:t}=this.component;let n=[];for(const r of mm)t[r].title&&n.push(jU(this,r));for(const r of uA)n=n.concat(BU(this,r));return n}assembleAxes(){return function(t,n){const{x:r=[],y:i=[]}=t;return[...r.map(s=>Ex(s,"grid",n)),...i.map(s=>Ex(s,"grid",n)),...r.map(s=>Ex(s,"main",n)),...i.map(s=>Ex(s,"main",n))].filter(s=>s)}(this.component.axes,this.config)}assembleLegends(){return pR(this)}assembleProjections(){return XU(this)}assembleTitle(){var t,n,r;const i=(t=this.title)!==null&&t!==void 0?t:{},{encoding:s}=i,f=Li(i,["encoding"]),m=Object.assign(Object.assign(Object.assign({},dF(this.config.title).nonMark),f),s?{encode:{update:s}}:{});if(m.text)return Ji(["unit","layer"],this.type)?Ji(["middle",void 0],m.anchor)&&(m.frame=(n=m.frame)!==null&&n!==void 0?n:"group"):m.anchor=(r=m.anchor)!==null&&r!==void 0?r:"start",ms(m)?void 0:m}assembleGroup(t=[]){const n={};(t=t.concat(this.assembleSignals())).length>0&&(n.signals=t);const r=this.assembleLayout();r&&(n.layout=r),n.marks=[].concat(this.assembleHeaderMarks(),this.assembleMarks());const i=!this.parent||gg(this.parent)?function m(x){return U1(x)||CA(x)?x.children.reduce((O,T)=>O.concat(m(T)),OR(x)):OR(x)}(this):[];i.length>0&&(n.scales=i);const s=this.assembleAxes();s.length>0&&(n.axes=s);const f=this.assembleLegends();return f.length>0&&(n.legends=f),n}getName(t){return eu((this.name?this.name+"_":"")+t)}requestDataName(t){var n;const r=this.getName(t),i=this.component.data.outputNodeRefCounts;return i[r]=((n=i[r])!==null&&n!==void 0?n:0)+1,r}getSizeSignalRef(t){if(gg(this.parent)){const n=zw(nR(t)),r=this.component.scales[n];if(r&&!r.merged){const i=r.get("type"),s=r.get("range");if(Ad(i)&&Jv(s)){const f=r.get("name"),m=kA(Sk(this,n));return m?{signal:tR(f,r,ei({aggregate:"distinct",field:m},{expr:"datum"}))}:(Gr(`Unknown field for ${n}. Cannot calculate view size.`),null)}}}return{signal:this.signalNameMap.get(this.getName(t))}}lookupDataSource(t){const n=this.component.data.outputNodes[t];return n?n.getSource():t}getSignalName(t){return this.signalNameMap.get(t)}renameSignal(t,n){this.signalNameMap.rename(t,n)}renameScale(t,n){this.scaleNameMap.rename(t,n)}renameProjection(t,n){this.projectionNameMap.rename(t,n)}scaleName(t,n){return n?this.getName(t):vN(t)&&Yv(t)&&this.component.scales[t]||this.scaleNameMap.has(this.getName(t))?this.scaleNameMap.get(this.getName(t)):void 0}projectionName(t){return t?this.getName("projection"):this.component.projection&&!this.component.projection.merged||this.projectionNameMap.has(this.getName("projection"))?this.projectionNameMap.get(this.getName("projection")):void 0}getScaleComponent(t){if(!this.component.scales)throw new Error("getScaleComponent cannot be called before parseScale(). Make sure you have called parseScale or use parseUnitModelWithScale().");const n=this.component.scales[t];return n&&!n.merged?n:this.parent?this.parent.getScaleComponent(t):void 0}getSelectionComponent(t,n){let r=this.component.selection[t];if(!r&&this.parent&&(r=this.parent.getSelectionComponent(t,n)),!r)throw new Error(de.selectionNotFound(n));return r}hasAxisOrientSignalRef(){var t,n;return((t=this.component.axes.x)===null||t===void 0?void 0:t.some(r=>r.hasOrientSignalRef()))||((n=this.component.axes.y)===null||n===void 0?void 0:n.some(r=>r.hasOrientSignalRef()))}}class jR extends OA{vgField(t,n={}){const r=this.fieldDef(t);if(r)return ei(r,n)}reduceFieldDef(t,n){return wF(this.getMapping(),(r,i,s)=>{const f=O0(i);return f?t(r,f,s):r},n)}forEachFieldDef(t,n){AO(this.getMapping(),(r,i)=>{const s=O0(r);s&&t(s,i)},n)}}class _k extends os{constructor(t,n){var r,i,s;super(t),this.transform=n,this.transform=Go(n);const f=(r=this.transform.as)!==null&&r!==void 0?r:[void 0,void 0];this.transform.as=[(i=f[0])!==null&&i!==void 0?i:"value",(s=f[1])!==null&&s!==void 0?s:"density"]}clone(){return new _k(null,Go(this.transform))}dependentFields(){var t;return new Set([this.transform.density,...(t=this.transform.groupby)!==null&&t!==void 0?t:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`DensityTransform ${Ea(this.transform)}`}assemble(){const t=this.transform,{density:n}=t,r=Li(t,["density"]);return Object.assign({type:"kde",field:n},r)}}class Ax extends os{constructor(t,n){super(t),this.filter=n}clone(){return new Ax(null,Object.assign({},this.filter))}static make(t,n){const{config:r,mark:i,markDef:s}=n;if(qa("invalid",s,r)!=="filter")return null;const f=n.reduceFieldDef((m,x,O)=>{const T=Yv(O)&&n.getScaleComponent(O);return T&&vm(T.get("type"))&&x.aggregate!=="count"&&!Fy(i)&&(m[x.field]=x),m},{});return Kr(f).length?new Ax(t,f):null}dependentFields(){return new Set(Kr(this.filter))}producedFields(){return new Set}hash(){return`FilterInvalid ${Ea(this.filter)}`}assemble(){const t=Kr(this.filter).reduce((n,r)=>{const i=this.filter[r],s=ei(i,{expr:"datum"});return i!==null&&(i.type==="temporal"?n.push(`(isDate(${s}) || (isValid(${s}) && isFinite(+${s})))`):i.type==="quantitative"&&(n.push(`isValid(${s})`),n.push(`isFinite(+${s})`))),n},[]);return t.length>0?{type:"filter",expr:t.join(" && ")}:null}}class Dk extends os{constructor(t,n){super(t),this.transform=n,this.transform=Go(n);const{flatten:r,as:i=[]}=this.transform;this.transform.as=r.map((s,f)=>{var m;return(m=i[f])!==null&&m!==void 0?m:s})}clone(){return new Dk(this.parent,Go(this.transform))}dependentFields(){return new Set(this.transform.flatten)}producedFields(){return new Set(this.transform.as)}hash(){return`FlattenTransform ${Ea(this.transform)}`}assemble(){const{flatten:t,as:n}=this.transform;return{type:"flatten",fields:t,as:n}}}class Tk extends os{constructor(t,n){var r,i,s;super(t),this.transform=n,this.transform=Go(n);const f=(r=this.transform.as)!==null&&r!==void 0?r:[void 0,void 0];this.transform.as=[(i=f[0])!==null&&i!==void 0?i:"key",(s=f[1])!==null&&s!==void 0?s:"value"]}clone(){return new Tk(null,Go(this.transform))}dependentFields(){return new Set(this.transform.fold)}producedFields(){return new Set(this.transform.as)}hash(){return`FoldTransform ${Ea(this.transform)}`}assemble(){const{fold:t,as:n}=this.transform;return{type:"fold",fields:t,as:n}}}class W1 extends os{constructor(t,n,r,i){super(t),this.fields=n,this.geojson=r,this.signal=i}clone(){return new W1(null,Go(this.fields),this.geojson,this.signal)}static parseAll(t,n){if(n.component.projection&&!n.component.projection.isFit)return t;let r=0;for(const i of[[g0,m0],[pm,lg]]){const s=i.map(f=>{const m=yc(n.encoding[f]);return si(m)?m.field:ey(m)?{expr:`${m.datum}`}:cv(m)?{expr:`${m.value}`}:void 0});(s[0]||s[1])&&(t=new W1(t,s,null,n.getName(`geojson_${r++}`)))}if(n.channelHasField(Od)){const i=n.typedFieldDef(Od);i.type===T1&&(t=new W1(t,null,i.field,n.getName(`geojson_${r++}`)))}return t}dependentFields(){var t;const n=((t=this.fields)!==null&&t!==void 0?t:[]).filter($o);return new Set([...this.geojson?[this.geojson]:[],...n])}producedFields(){return new Set}hash(){return`GeoJSON ${this.geojson} ${this.signal} ${Ea(this.fields)}`}assemble(){return Object.assign(Object.assign(Object.assign({type:"geojson"},this.fields?{fields:this.fields}:{}),this.geojson?{geojson:this.geojson}:{}),{signal:this.signal})}}class Sx extends os{constructor(t,n,r,i){super(t),this.projection=n,this.fields=r,this.as=i}clone(){return new Sx(null,this.projection,Go(this.fields),Go(this.as))}static parseAll(t,n){if(!n.projectionName())return t;for(const r of[[g0,m0],[pm,lg]]){const i=r.map(f=>{const m=yc(n.encoding[f]);return si(m)?m.field:ey(m)?{expr:`${m.datum}`}:cv(m)?{expr:`${m.value}`}:void 0}),s=r[0]===pm?"2":"";(i[0]||i[1])&&(t=new Sx(t,n.projectionName(),i,[n.getName("x"+s),n.getName("y"+s)]))}return t}dependentFields(){return new Set(this.fields.filter($o))}producedFields(){return new Set(this.as)}hash(){return`Geopoint ${this.projection} ${Ea(this.fields)} ${Ea(this.as)}`}assemble(){return{type:"geopoint",projection:this.projection,fields:this.fields,as:this.as}}}class Qy extends os{constructor(t,n){super(t),this.transform=n}clone(){return new Qy(null,Go(this.transform))}dependentFields(){var t;return new Set([this.transform.impute,this.transform.key,...(t=this.transform.groupby)!==null&&t!==void 0?t:[]])}producedFields(){return new Set([this.transform.impute])}processSequence(t){const{start:n=0,stop:r,step:i}=t;return{signal:`sequence(${[n,r,...i?[i]:[]].join(",")})`}}static makeFromTransform(t,n){return new Qy(t,n)}static makeFromEncoding(t,n){const r=n.encoding,i=r.x,s=r.y;if(si(i)&&si(s)){const f=i.impute?i:s.impute?s:void 0;if(f===void 0)return;const m=i.impute?s:s.impute?i:void 0,{method:x,value:O,frame:T,keyvals:M}=f.impute,H=kF(n.mark,r);return new Qy(t,Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({impute:f.field,key:m.field},x?{method:x}:{}),O!==void 0?{value:O}:{}),T?{frame:T}:{}),M!==void 0?{keyvals:M}:{}),H.length?{groupby:H}:{}))}return null}hash(){return`Impute ${Ea(this.transform)}`}assemble(){const{impute:t,key:n,keyvals:r,method:i,groupby:s,value:f,frame:m=[null,null]}=this.transform,x=Object.assign(Object.assign(Object.assign(Object.assign({type:"impute",field:t,key:n},r?{keyvals:function(O){return(O==null?void 0:O.stop)!==void 0}(r)?this.processSequence(r):r}:{}),{method:"value"}),s?{groupby:s}:{}),{value:i&&i!=="value"?null:f});return i&&i!=="value"?[x,Object.assign({type:"window",as:[`imputed_${t}_value`],ops:[i],fields:[t],frame:m,ignorePeers:!1},s?{groupby:s}:{}),{type:"formula",expr:`datum.${t} === null ? datum.imputed_${t}_value : datum.${t}`,as:t}]:[x]}}class Nk extends os{constructor(t,n){var r,i,s;super(t),this.transform=n,this.transform=Go(n);const f=(r=this.transform.as)!==null&&r!==void 0?r:[void 0,void 0];this.transform.as=[(i=f[0])!==null&&i!==void 0?i:n.on,(s=f[1])!==null&&s!==void 0?s:n.loess]}clone(){return new Nk(null,Go(this.transform))}dependentFields(){var t;return new Set([this.transform.loess,this.transform.on,...(t=this.transform.groupby)!==null&&t!==void 0?t:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`LoessTransform ${Ea(this.transform)}`}assemble(){const t=this.transform,{loess:n,on:r}=t,i=Li(t,["loess","on"]);return Object.assign({type:"loess",x:r,y:n},i)}}class _x extends os{constructor(t,n,r){super(t),this.transform=n,this.secondary=r}clone(){return new _x(null,Go(this.transform),this.secondary)}static make(t,n,r,i){const s=n.component.data.sources,{from:f}=r;let m=null;if(function(x){return"data"in x}(f)){let x=zR(f.data,s);x||(x=new P1(f.data),s.push(x));const O=n.getName(`lookup_${i}`);m=new wh(x,O,"lookup",n.component.data.outputNodeRefCounts),n.component.data.outputNodes[O]=m}else if(function(x){return"selection"in x}(f)){const x=f.selection;if(r=Object.assign({as:x},r),!(m=n.getSelectionComponent(eu(x),x).materialized))throw new Error(de.noSameUnitLookup(x))}return new _x(t,r,m.getSource())}dependentFields(){return new Set([this.transform.lookup])}producedFields(){return new Set(this.transform.as?Mu(this.transform.as):this.transform.from.fields)}hash(){return`Lookup ${Ea({transform:this.transform,secondary:this.secondary})}`}assemble(){let t;if(this.transform.from.fields)t=Object.assign({values:this.transform.from.fields},this.transform.as?{as:Mu(this.transform.as)}:{});else{let n=this.transform.as;$o(n)||(Gr(de.NO_FIELDS_NEEDS_AS),n="_lookup"),t={as:[n]}}return Object.assign(Object.assign({type:"lookup",from:this.secondary,key:this.transform.from.key,fields:[this.transform.lookup]},t),this.transform.default?{default:this.transform.default}:{})}}class Fk extends os{constructor(t,n){var r,i,s;super(t),this.transform=n,this.transform=Go(n);const f=(r=this.transform.as)!==null&&r!==void 0?r:[void 0,void 0];this.transform.as=[(i=f[0])!==null&&i!==void 0?i:"prob",(s=f[1])!==null&&s!==void 0?s:"value"]}clone(){return new Fk(null,Go(this.transform))}dependentFields(){var t;return new Set([this.transform.quantile,...(t=this.transform.groupby)!==null&&t!==void 0?t:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`QuantileTransform ${Ea(this.transform)}`}assemble(){const t=this.transform,{quantile:n}=t,r=Li(t,["quantile"]);return Object.assign({type:"quantile",field:n},r)}}class Ik extends os{constructor(t,n){var r,i,s;super(t),this.transform=n,this.transform=Go(n);const f=(r=this.transform.as)!==null&&r!==void 0?r:[void 0,void 0];this.transform.as=[(i=f[0])!==null&&i!==void 0?i:n.on,(s=f[1])!==null&&s!==void 0?s:n.regression]}clone(){return new Ik(null,Go(this.transform))}dependentFields(){var t;return new Set([this.transform.regression,this.transform.on,...(t=this.transform.groupby)!==null&&t!==void 0?t:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`RegressionTransform ${Ea(this.transform)}`}assemble(){const t=this.transform,{regression:n,on:r}=t,i=Li(t,["regression","on"]);return Object.assign({type:"regression",x:r,y:n},i)}}class Rk extends os{constructor(t,n){super(t),this.transform=n}clone(){return new Rk(null,Go(this.transform))}addDimensions(t){var n;this.transform.groupby=zv(((n=this.transform.groupby)!==null&&n!==void 0?n:[]).concat(t),r=>r)}producedFields(){}dependentFields(){var t;return new Set([this.transform.pivot,this.transform.value,...(t=this.transform.groupby)!==null&&t!==void 0?t:[]])}hash(){return`PivotTransform ${Ea(this.transform)}`}assemble(){const{pivot:t,value:n,groupby:r,limit:i,op:s}=this.transform;return Object.assign(Object.assign(Object.assign({type:"pivot",field:t,value:n},i!==void 0?{limit:i}:{}),s!==void 0?{op:s}:{}),r!==void 0?{groupby:r}:{})}}class Mk extends os{constructor(t,n){super(t),this.transform=n}clone(){return new Mk(null,Go(this.transform))}dependentFields(){return new Set}producedFields(){return new Set}hash(){return`SampleTransform ${Ea(this.transform)}`}assemble(){return{type:"sample",size:this.transform.sample}}}function BR(e){let t=0;return function n(r,i){var s;if(r instanceof P1&&!r.isGenerator&&!fx(r.data)&&(e.push(i),i={name:null,source:i.name,transform:[]}),r instanceof gf&&(r.parent instanceof P1&&!i.source?(i.format=Object.assign(Object.assign({},(s=i.format)!==null&&s!==void 0?s:{}),{parse:r.assembleFormatParse()}),i.transform.push(...r.assembleTransforms(!0))):i.transform.push(...r.assembleTransforms())),r instanceof L1){i.name||(i.name=`data_${t++}`),!i.source||i.transform.length>0?(e.push(i),r.data=i.name):r.data=i.source;for(const f of r.assemble())e.push(f)}else switch((r instanceof Cx||r instanceof Ox||r instanceof Ax||r instanceof R1||r instanceof M1||r instanceof Sx||r instanceof W1||r instanceof pg||r instanceof _x||r instanceof z1||r instanceof Jy||r instanceof Tk||r instanceof Dk||r instanceof _k||r instanceof Nk||r instanceof Fk||r instanceof Ik||r instanceof ay||r instanceof Mk||r instanceof Rk)&&i.transform.push(r.assemble()),(r instanceof D0||r instanceof S0||r instanceof Qy||r instanceof gv)&&i.transform.push(...r.assemble()),r instanceof wh&&(i.source&&i.transform.length===0?r.setSource(i.source):r.parent instanceof wh?r.setSource(i.name):(i.name||(i.name=`data_${t++}`),r.setSource(i.name),r.numChildren()===1&&(e.push(i),i={name:null,source:i.name,transform:[]}))),r.numChildren()){case 0:r instanceof wh&&(!i.source||i.transform.length>0)&&e.push(i);break;case 1:n(r.children[0],i);break;default:{i.name||(i.name=`data_${t++}`);let f=i.name;!i.source||i.transform.length>0?e.push(i):f=i.source;for(const m of r.children)n(m,{name:null,source:f,transform:[]});break}}}}function bW(e){return e==="top"||e==="left"||po(e)?"header":"footer"}function xW(e,t){var n;const{facet:r,config:i,child:s,component:f}=e;if(e.channelHasField(t)){const m=r[t],x=B1("title",null,i,t);let O=zy(m,i,{allowDisabling:!0,includeDefault:x===void 0||!!x});s.component.layoutHeaders[t].title&&(O=Gi(O)?O.join(", "):O,O+=" / "+s.component.layoutHeaders[t].title,s.component.layoutHeaders[t].title=null);const T=B1("labelOrient",m,i,t),M=Qu(((n=m.header)!==null&&n!==void 0?n:{}).labels,i.header.labels,!0),H=Ji(["bottom","right"],T)?"footer":"header";f.layoutHeaders[t]={title:O,facetFieldDef:m,[H]:t==="facet"?[]:[PR(e,t,M)]}}}function PR(e,t,n){const r=t==="row"?"height":"width";return{labels:n,sizeSignal:e.child.component.layoutSize.get(r)?e.child.getSizeSignalRef(r):void 0,axes:[]}}function LR(e,t){var n;const{child:r}=e;if(r.component.axes[t]){const{layoutHeaders:i,resolve:s}=e.component;if(s.axis[t]=hA(s,t),s.axis[t]==="shared"){const f=t==="x"?"column":"row",m=i[f];for(const x of r.component.axes[t]){const O=bW(x.get("orient"));m[O]=(n=m[O])!==null&&n!==void 0?n:[PR(e,f,!1)];const T=Ex(x,"main",e.config,{header:!0});T&&m[O][0].axes.push(T),x.mainExtracted=!0}}}}function wW(e){AA(e);const t=e.layout.columns===1?"width":"childWidth",n=e.layout.columns===void 0?"height":"childHeight";jk(e,t),jk(e,n)}function AA(e){for(const t of e.children)t.parseLayoutSize()}function jk(e,t){const n=nR(t),r=zw(n),i=e.component.resolve,s=e.component.layoutSize;let f;for(const m of e.children){const x=m.component.layoutSize.getWithExplicit(n),O=i.scale[r];if(O==="independent"&&x.value==="step"){f=void 0;break}if(f){if(O==="independent"&&f.value!==x.value){f=void 0;break}f=ny(f,x,n,"")}else f=x}if(f){for(const m of e.children)e.renameSignal(m.getName(n),e.getName(t)),m.component.layoutSize.set(n,"merged",!1);s.setWithExplicit(t,f)}else s.setWithExplicit(t,{explicit:!1,value:void 0})}function kW(e,t){const n=t==="width"?"x":"y",r=e.config,i=e.getScaleComponent(n);if(i){const s=i.get("type"),f=i.get("range");if(Ad(s)){const m=lx(r.view,t);return Jv(f)||A0(m)?"step":m}return jO(r.view,t)}if(e.hasProjection||e.mark==="arc")return jO(r.view,t);{const s=lx(r.view,t);return A0(s)?s.step:s}}function SA(e,t,n){return ei(t,Object.assign({suffix:`by_${ei(e)}`},n??{}))}class Dx extends jR{constructor(t,n,r,i){super(t,"facet",n,r,i,t.resolve),this.child=NA(t.spec,this,this.getName("child"),void 0,i),this.children=[this.child],this.facet=this.initFacet(t.facet,i)}initFacet(t,n){return ax(t)?wF(t,(r,i,s)=>Ji([rv,iv],s)?i.field===void 0?(Gr(de.emptyFieldDef(i,s)),r):(r[s]=kO(i,s,n),r):(Gr(de.incompatibleChannel(s,"facet")),r),{}):{facet:kO(t,"facet",n)}}channelHasField(t){return!!this.facet[t]}fieldDef(t){return this.facet[t]}parseData(){this.component.data=Bk(this),this.child.parseData()}parseLayoutSize(){AA(this)}parseSelections(){this.child.parseSelections(),this.component.selection=this.child.component.selection}parseMarkGroup(){this.child.parseMarkGroup()}parseAxesAndHeaders(){this.child.parseAxesAndHeaders(),function(t){for(const n of mm)xW(t,n);LR(t,"x"),LR(t,"y")}(this)}assembleSelectionTopLevelSignals(t){return this.child.assembleSelectionTopLevelSignals(t)}assembleSignals(){return this.child.assembleSignals(),[]}assembleSelectionData(t){return this.child.assembleSelectionData(t)}getHeaderLayoutMixins(){var t,n,r;const i={};for(const s of mm)for(const f of cA){const m=this.component.layoutHeaders[s],x=m[f],{facetFieldDef:O}=m;if(O){const T=B1("titleOrient",O,this.config,s);if(Ji(["right","bottom"],T)){const M=kk(s,T);i.titleAnchor=(t=i.titleAnchor)!==null&&t!==void 0?t:{},i.titleAnchor[M]="end"}}if(x!=null&&x[0]){const T=s==="row"?"height":"width",M=f==="header"?"headerBand":"footerBand";s==="facet"||this.child.component.layoutSize.get(T)||(i[M]=(n=i[M])!==null&&n!==void 0?n:{},i[M][s]=.5),m.title&&(i.offset=(r=i.offset)!==null&&r!==void 0?r:{},i.offset[s==="row"?"rowTitle":"columnTitle"]=10)}}return i}assembleDefaultLayout(){const{column:t,row:n}=this.facet,r=t?this.columnDistinctSignal():n?1:void 0;let i="all";return(n||this.component.resolve.scale.x!=="independent")&&(t||this.component.resolve.scale.y!=="independent")||(i="none"),Object.assign(Object.assign(Object.assign({},this.getHeaderLayoutMixins()),r?{columns:r}:{}),{bounds:"full",align:i})}assembleLayoutSignals(){return this.child.assembleLayoutSignals()}columnDistinctSignal(){if(!(this.parent&&this.parent instanceof Dx))return{signal:`length(data('${this.getName("column_domain")}'))`}}assembleGroup(t){return this.parent&&this.parent instanceof Dx?Object.assign(Object.assign({},this.channelHasField("column")?{encode:{update:{columns:{field:ei(this.facet.column,{prefix:"distinct"})}}}}:{}),super.assembleGroup(t)):super.assembleGroup(t)}getCardinalityAggregateForChild(){const t=[],n=[],r=[];if(this.child instanceof Dx){if(this.child.channelHasField("column")){const i=ei(this.child.facet.column);t.push(i),n.push("distinct"),r.push(`distinct_${i}`)}}else for(const i of gm){const s=this.child.component.scales[i];if(s&&!s.merged){const f=s.get("type"),m=s.get("range");if(Ad(f)&&Jv(m)){const x=kA(Sk(this.child,i));x?(t.push(x),n.push("distinct"),r.push(`distinct_${x}`)):Gr(`Unknown field for ${i}. Cannot calculate view size.`)}}}return{fields:t,ops:n,as:r}}assembleFacet(){const{name:t,data:n}=this.component.data.facetRoot,{row:r,column:i}=this.facet,{fields:s,ops:f,as:m}=this.getCardinalityAggregateForChild(),x=[];for(const T of mm){const M=this.facet[T];if(M){x.push(ei(M));const{bin:H,sort:Z}=M;if(Ts(H)&&x.push(ei(M,{binSuffix:"end"})),E0(Z)){const{field:ue,op:fe=Kw}=Z,Ie=SA(M,Z);r&&i?(s.push(Ie),f.push("max"),m.push(Ie)):(s.push(ue),f.push(fe),m.push(Ie))}else if(Gi(Z)){const ue=j1(M,T);s.push(ue),f.push("max"),m.push(ue)}}}const O=!!r&&!!i;return Object.assign({name:t,data:n,groupby:x},O||s.length>0?{aggregate:Object.assign(Object.assign({},O?{cross:O}:{}),s.length?{fields:s,ops:f,as:m}:{})}:{})}facetSortFields(t){const{facet:n}=this,r=n[t];return r?E0(r.sort)?[SA(r,r.sort,{expr:"datum"})]:Gi(r.sort)?[j1(r,t,{expr:"datum"})]:[ei(r,{expr:"datum"})]:[]}facetSortOrder(t){const{facet:n}=this,r=n[t];if(r){const{sort:i}=r;return[(E0(i)?i.order:!Gi(i)&&i)||"ascending"]}return[]}assembleLabelTitle(){const{facet:t,config:n}=this;if(t.facet)return lA(t.facet,"facet",n);const r={row:["top","bottom"],column:["left","right"]};for(const i of uA)if(t[i]){const s=B1("labelOrient",t[i],n,i);if(Ji(r[i],s))return lA(t[i],i,n)}}assembleMarks(){const{child:t}=this,n=function(f){const m=[],x=BR(m);for(const O of f.children)x(O,{source:f.name,name:null,transform:[]});return m}(this.component.data.facetRoot),r=t.assembleGroupEncodeEntry(!1),i=this.assembleLabelTitle()||t.assembleTitle(),s=t.assembleGroupStyle();return[Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:this.getName("cell"),type:"group"},i?{title:i}:{}),s?{style:s}:{}),{from:{facet:this.assembleFacet()},sort:{field:mm.map(f=>this.facetSortFields(f)).flat(),order:mm.map(f=>this.facetSortOrder(f)).flat()}}),n.length>0?{data:n}:{}),r?{encode:{update:r}}:{}),t.assembleGroup(function(f,m){if(f.component.selection&&Kr(f.component.selection).length){const x=ga(f.getName("cell"));m.unshift({name:"facet",value:{},on:[{events:_y("mousemove","scope"),update:`isTuple(facet) ? facet : group(${x}).datum`}]})}return GO(m)}(this,[])))]}getMapping(){return this.facet}}function zR(e,t){var n,r,i,s,f,m,x,O,T,M;for(const H of t){const Z=H.data;if((!e.name||!H.hasName()||e.name===H.dataName)&&!(!((n=e.format)===null||n===void 0)&&n.mesh&&(!((r=Z.format)===null||r===void 0)&&r.feature)||(!((i=e.format)===null||i===void 0)&&i.feature||!((s=Z.format)===null||s===void 0)&&s.feature)&&((f=e.format)===null||f===void 0?void 0:f.feature)!==((m=Z.format)===null||m===void 0?void 0:m.feature)||(!((x=e.format)===null||x===void 0)&&x.mesh||!((O=Z.format)===null||O===void 0)&&O.mesh)&&((T=e.format)===null||T===void 0?void 0:T.mesh)!==((M=Z.format)===null||M===void 0?void 0:M.mesh))){if(uk(e)&&uk(Z)){if(Xb(e.values,Z.values))return H}else if(fx(e)&&fx(Z)){if(e.url===Z.url)return H}else if(eI(e)&&e.name===H.dataName)return H}}return null}function EW(e,t){if(e.data||!e.parent){if(e.data===null){const r=new P1({values:[]});return t.push(r),r}const n=zR(e.data,t);if(n)return Hy(e.data)||(n.data.format=function(r,...i){for(const s of i)k7(r,s??{});return r}({},e.data.format,n.data.format)),!n.hasName()&&e.data.name&&(n.dataName=e.data.name),n;{const r=new P1(e.data);return t.push(r),r}}return e.parent.component.data.facetRoot?e.parent.component.data.facetRoot:e.parent.component.data.main}function Bk(e){var t,n,r,i,s,f,m,x,O,T;let M=EW(e,e.component.data.sources);const{outputNodes:H,outputNodeRefCounts:Z}=e.component.data,ue=e.parent?e.parent.component.data.ancestorParse.clone():new uz,fe=e.data;Hy(fe)?(tI(fe)?M=new Ox(M,fe.sequence):UO(fe)&&(M=new Cx(M,fe.graticule)),ue.parseNothing=!0):((t=fe==null?void 0:fe.format)===null||t===void 0?void 0:t.parse)===null&&(ue.parseNothing=!0),M=(n=gf.makeExplicit(M,e,ue))!==null&&n!==void 0?n:M,M=new ay(M);const Ie=e.parent&&U1(e.parent);(yu(e)||gg(e))&&Ie&&(M=(r=D0.makeFromEncoding(M,e))!==null&&r!==void 0?r:M),e.transforms.length>0&&(M=function(dt,en,mn){var sn,In;let Fn=0;for(const zn of en.transforms){let Vn,Qn;if(bz(zn))Vn=dt=new M1(dt,zn),Qn="derived";else if(rI(zn)){const mr=QU(zn);Vn=dt=(sn=gf.makeWithAncestors(dt,{},mr,mn))!==null&&sn!==void 0?sn:dt,dt=new R1(dt,en,zn.filter)}else if(xz(zn))Vn=dt=D0.makeFromTransform(dt,zn,en),Qn="number";else if(kz(zn))Qn="date",mn.getWithExplicit(zn.field).value===void 0&&(dt=new gf(dt,{[zn.field]:Qn}),mn.set(zn.field,Qn,!1)),Vn=dt=S0.makeFromTransform(dt,zn);else if(Ez(zn))Vn=dt=pg.makeFromTransform(dt,zn),Qn="number",XO(en)&&(dt=new ay(dt));else if(cz(zn))Vn=dt=_x.make(dt,en,zn,Fn++),Qn="derived";else if(gz(zn))Vn=dt=new z1(dt,zn),Qn="number";else if(vz(zn))Vn=dt=new Jy(dt,zn),Qn="number";else if(Cz(zn))Vn=dt=gv.makeFromTransform(dt,zn),Qn="derived";else if(Oz(zn))Vn=dt=new Tk(dt,zn),Qn="derived";else if(yz(zn))Vn=dt=new Dk(dt,zn),Qn="derived";else if(lz(zn))Vn=dt=new Rk(dt,zn),Qn="derived";else if(mz(zn))dt=new Mk(dt,zn);else if(wz(zn))Vn=dt=Qy.makeFromTransform(dt,zn),Qn="derived";else if(fz(zn))Vn=dt=new _k(dt,zn),Qn="derived";else if(hz(zn))Vn=dt=new Fk(dt,zn),Qn="derived";else if(dz(zn))Vn=dt=new Ik(dt,zn),Qn="derived";else{if(!pz(zn)){Gr(de.invalidTransformIgnored(zn));continue}Vn=dt=new Nk(dt,zn),Qn="derived"}if(Vn&&Qn!==void 0)for(const mr of(In=Vn.producedFields())!==null&&In!==void 0?In:[])mn.set(mr,Qn,!1)}return dt}(M,e,ue));const Pe=function(dt){const en={};if(yu(dt)&&dt.component.selection)for(const mn of Kr(dt.component.selection)){const sn=dt.component.selection[mn];for(const In of sn.project.items)!In.channel&&Zb(In.field)>1&&(en[In.field]="flatten")}return en}(e),Le=ZU(e);M=(i=gf.makeWithAncestors(M,{},Object.assign(Object.assign({},Pe),Le),ue))!==null&&i!==void 0?i:M,yu(e)&&(M=W1.parseAll(M,e),M=Sx.parseAll(M,e)),(yu(e)||gg(e))&&(Ie||(M=(s=D0.makeFromEncoding(M,e))!==null&&s!==void 0?s:M),M=(f=S0.makeFromEncoding(M,e))!==null&&f!==void 0?f:M,M=M1.parseAllForSortIndex(M,e));const rt=e.getName(ck),it=new wh(M,rt,ck,Z);if(H[rt]=it,M=it,yu(e)){const dt=pg.makeFromEncoding(M,e);dt&&(M=dt,XO(e)&&(M=new ay(M))),M=(m=Qy.makeFromEncoding(M,e))!==null&&m!==void 0?m:M,M=(x=gv.makeFromEncoding(M,e))!==null&&x!==void 0?x:M}yu(e)&&(M=(O=Ax.make(M,e))!==null&&O!==void 0?O:M);const ut=e.getName(ff),st=new wh(M,ut,ff,Z);H[ut]=st,M=st,yu(e)&&function(dt,en){Gy(dt,mn=>{const sn=mn.name,In=dt.getName(`lookup_${sn}`);dt.component.data.outputNodes[In]=mn.materialized=new wh(new R1(en,dt,{selection:sn}),In,"lookup",dt.component.data.outputNodeRefCounts)})}(e,st);let mt=null;if(gg(e)){const dt=e.getName("facet");M=(T=function(en,mn){const{row:sn,column:In}=mn;if(sn&&In){let Fn=null;for(const zn of[sn,In])if(E0(zn.sort)){const{field:Vn,op:Qn=Kw}=zn.sort;en=Fn=new Jy(en,{joinaggregate:[{op:Qn,field:Vn,as:SA(zn,zn.sort,{forAs:!0})}],groupby:[ei(zn)]})}return Fn}return null}(M,e.facet))!==null&&T!==void 0?T:M,mt=new L1(M,e,dt,st.getSource()),H[dt]=mt}return Object.assign(Object.assign({},e.component.data),{outputNodes:H,outputNodeRefCounts:Z,raw:it,main:st,facetRoot:mt,ancestorParse:ue})}class CW extends OA{constructor(t,n,r,i){var s,f,m,x;super(t,"concat",n,r,i,t.resolve),((f=(s=t.resolve)===null||s===void 0?void 0:s.axis)===null||f===void 0?void 0:f.x)!=="shared"&&((x=(m=t.resolve)===null||m===void 0?void 0:m.axis)===null||x===void 0?void 0:x.y)!=="shared"||Gr(de.CONCAT_CANNOT_SHARE_AXIS),this.children=this.getChildren(t).map((O,T)=>NA(O,this,this.getName("concat_"+T),void 0,i))}parseData(){this.component.data=Bk(this);for(const t of this.children)t.parseData()}parseSelections(){this.component.selection={};for(const t of this.children){t.parseSelections();for(const n of Kr(t.component.selection))this.component.selection[n]=t.component.selection[n]}}parseMarkGroup(){for(const t of this.children)t.parseMarkGroup()}parseAxesAndHeaders(){for(const t of this.children)t.parseAxesAndHeaders()}getChildren(t){return ik(t)?t.vconcat:MO(t)?t.hconcat:t.concat}parseLayoutSize(){wW(this)}parseAxisGroup(){return null}assembleSelectionTopLevelSignals(t){return this.children.reduce((n,r)=>r.assembleSelectionTopLevelSignals(n),t)}assembleSignals(){return this.children.forEach(t=>t.assembleSignals()),[]}assembleLayoutSignals(){const t=fA(this);for(const n of this.children)t.push(...n.assembleLayoutSignals());return t}assembleSelectionData(t){return this.children.reduce((n,r)=>r.assembleSelectionData(n),t)}assembleMarks(){return this.children.map(t=>{const n=t.assembleTitle(),r=t.assembleGroupStyle(),i=t.assembleGroupEncodeEntry(!1);return Object.assign(Object.assign(Object.assign(Object.assign({type:"group",name:t.getName("group")},n?{title:n}:{}),r?{style:r}:{}),i?{encode:{update:i}}:{}),t.assembleGroup())})}assembleDefaultLayout(){const t=this.layout.columns;return Object.assign(Object.assign({},t!=null?{columns:t}:{}),{bounds:"full",align:"each"})}}const OW=Object.assign(Object.assign({disable:1,gridScale:1,scale:1},rN),{labelExpr:1,encode:1}),UR=Kr(OW);class _A extends fv{constructor(t={},n={},r=!1){super(),this.explicit=t,this.implicit=n,this.mainExtracted=r}clone(){return new _A(Go(this.explicit),Go(this.implicit),this.mainExtracted)}hasAxisPart(t){return t==="axis"||(t==="grid"||t==="title"?!!this.get(t):!function(n){return n===!1||n===null}(this.get(t)))}hasOrientSignalRef(){return po(this.explicit.orient)}}function AW(e){return gm.reduce((t,n)=>(e.component.scales[n]&&(t[n]=[function(r,i){var s,f,m;let x=i.axis(r);const O=new _A,T=yc(i.encoding[r]),{mark:M,config:H}=i,Z=(x==null?void 0:x.orient)||((s=H[r==="x"?"axisX":"axisY"])===null||s===void 0?void 0:s.orient)||((f=H.axis)===null||f===void 0?void 0:f.orient)||function(ut){return ut==="x"?"bottom":"left"}(r),ue=i.getScaleComponent(r).get("type"),fe=MU(r,ue,Z,i.config),Ie=x!==void 0?!x:aA("disable",H,x==null?void 0:x.style,fe).configValue;if(O.set("disable",Ie,x!==void 0),Ie)return O;const Pe=function(ut,st,mt,dt,en){const mn=st==null?void 0:st.labelAngle;if(mn!==void 0)return po(mn)?mn:_w(mn);{const{configValue:sn}=aA("labelAngle",ut.config,st==null?void 0:st.style,en);return sn!==void 0?_w(sn):mt===uu&&Ji([uO,sO],dt.type)?270:void 0}}(i,x=x||{},r,T,fe),Le={fieldOrDatumDef:T,axis:x,channel:r,model:i,scaleType:ue,orient:Z,labelAngle:Pe,mark:M,config:H};for(const ut of UR){const st=ut in GI?GI[ut](Le):iN(ut)?x[ut]:void 0,mt=st!==void 0,dt=TW(st,ut,x,i,r);if(mt&&dt)O.set(ut,st,dt);else{const{configValue:en,configFrom:mn}=iN(ut)&&ut!=="values"?aA(ut,i.config,x.style,fe):{},sn=en!==void 0;mt&&!sn?O.set(ut,st,dt):(mn!=="vgAxisConfig"||NW.has(ut)&&sn||VC(en)||po(en))&&O.set(ut,en,!1)}}const rt=(m=x.encoding)!==null&&m!==void 0?m:{},it=nN.reduce((ut,st)=>{var mt;if(!O.hasAxisPart(st))return ut;const dt=rR((mt=rt[st])!==null&&mt!==void 0?mt:{},i),en=st==="labels"?function(mn,sn,In){var Fn;const{encoding:zn,config:Vn}=mn,Qn=(Fn=yc(zn[sn]))!==null&&Fn!==void 0?Fn:yc(zn[b0(sn)]),mr=mn.axis(sn)||{},{format:Pr,formatType:Cr}=mr;return Ly(Cr)?Object.assign({text:dO({fieldOrDatumDef:Qn,field:"datum.value",format:Pr,formatType:Cr,config:Vn})},In):In}(i,r,dt):dt;return en===void 0||ms(en)||(ut[st]={update:en}),ut},{});return ms(it)||O.set("encode",it,!!x.encoding||x.labelAngle!==void 0),O}(n,e)]),t),{})}const SW={bottom:"top",top:"bottom",left:"right",right:"left"};function _W(e,t){if(!e)return t.map(n=>n.clone());{if(e.length!==t.length)return;const n=e.length;for(let r=0;r<n;r++){const i=e[r],s=t[r];if(!!i!=!!s)return;if(i&&s){const f=i.getWithExplicit("orient"),m=s.getWithExplicit("orient");if(f.explicit&&m.explicit&&f.value!==m.value)return;e[r]=DW(i,s)}}}return e}function DW(e,t){for(const n of UR){const r=ny(e.getWithExplicit(n),t.getWithExplicit(n),n,"axis",(i,s)=>{switch(n){case"title":return xF(i,s);case"gridScale":return{explicit:i.explicit,value:Qu(i.value,s.value)}}return sk(i,s,n,"axis")});e.setWithExplicit(n,r)}return e}function TW(e,t,n,r,i){if(t==="disable")return n!==void 0;switch(n=n||{},t){case"titleAngle":case"labelAngle":return e===(po(n.labelAngle)?n.labelAngle:_w(n.labelAngle));case"values":return!!n.values;case"encode":return!!n.encoding||!!n.labelAngle;case"title":if(e===YI(r,i))return!0}return e===n[t]}const NW=new Set(["grid","translate","format","formatType","orient","labelExpr","tickCount","position","tickMinStep"]);function FW(e,t,n,{graticule:r}){const i=h0(e)?Object.assign({},e):{type:e},s=qa("orient",i,n);if(i.orient=function(f,m,x){switch(f){case Fw:case HC:case $C:case aN:case D7:case _7:return}const{x:O,y:T,x2:M,y2:H}=m;switch(f){case Tw:if(si(O)&&(bh(O.bin)||si(T)&&T.aggregate&&!O.aggregate))return"vertical";if(si(T)&&(bh(T.bin)||si(O)&&O.aggregate&&!T.aggregate))return"horizontal";if(H||M){if(x)return x;if(!M&&(si(O)&&O.type===By&&!Ts(O.bin)||yO(O)))return"horizontal";if(!H&&(si(T)&&T.type===By&&!Ts(T.bin)||yO(T)))return"vertical"}case Iw:if(M&&(!si(O)||!bh(O.bin))&&H&&(!si(T)||!bh(T.bin)))return;case Dw:if(H)return si(T)&&bh(T.bin)?"horizontal":"vertical";if(M)return si(O)&&bh(O.bin)?"vertical":"horizontal";if(f===Iw){if(O&&!T)return"vertical";if(T&&!O)return"horizontal"}case Nw:case qC:{const Z=C0(O),ue=C0(T);if(Z&&!ue)return f!=="tick"?"horizontal":"vertical";if(!Z&&ue)return f!=="tick"?"vertical":"horizontal";if(Z&&ue){const fe=O,Ie=T,Pe=fe.type===D1,Le=Ie.type===D1;return Pe&&!Le?f!=="tick"?"vertical":"horizontal":!Pe&&Le?f!=="tick"?"horizontal":"vertical":!fe.aggregate&&Ie.aggregate?f!=="tick"?"vertical":"horizontal":fe.aggregate&&!Ie.aggregate?f!=="tick"?"horizontal":"vertical":x||"vertical"}return x||void 0}}return"vertical"}(i.type,t,s),s!==void 0&&s!==i.orient&&Gr(de.orientOverridden(i.orient,s)),i.type==="bar"&&i.orient){const f=qa("cornerRadiusEnd",i,n);if(f!==void 0){const m=i.orient==="horizontal"&&t.x2||i.orient==="vertical"&&t.y2?["cornerRadius"]:F7[i.orient];for(const x of m)i[x]=f;i.cornerRadiusEnd!==void 0&&delete i.cornerRadiusEnd}}return qa("opacity",i,n)===void 0&&(i.opacity=function(f,m){if(Ji([Fw,qC,HC,$C],f)&&!CO(m))return .7}(i.type,t)),i.filled===void 0&&(i.filled=!r&&function(f,m){const x=Wy("filled",f,m),O=f.type;return Qu(x,O!==Fw&&O!==Nw&&O!==Iw)}(i,n)),qa("cursor",i,n)===void 0&&(i.cursor=function(f,m,x){return m.href||f.href||qa("href",f,x)?"pointer":f.cursor}(i,t,n)),i}function DA(e,t){return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},ym(e,{align:"ignore",baseline:"ignore",color:"include",size:"include",orient:"ignore",theta:"ignore"})),hf("x",e,{defaultPos:"mid"})),hf("y",e,{defaultPos:"mid"})),Wc("size",e)),Wc("angle",e)),function(n,r,i){return i?{shape:{value:i}}:Wc("shape",n)}(e,0,t))}const Pk={arc:{vgMark:"arc",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},ym(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})),hf("x",e,{defaultPos:"mid"})),hf("y",e,{defaultPos:"mid"})),ry(e,"radius","arc")),ry(e,"theta","arc"))},area:{vgMark:"area",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign({},ym(e,{align:"ignore",baseline:"ignore",color:"include",orient:"include",size:"ignore",theta:"ignore"})),hk("x",e,{defaultPos:"zeroOrMin",defaultPos2:"zeroOrMin",range:e.markDef.orient==="horizontal"})),hk("y",e,{defaultPos:"zeroOrMin",defaultPos2:"zeroOrMin",range:e.markDef.orient==="vertical"})),qO(e))},bar:{vgMark:"rect",encodeEntry:e=>Object.assign(Object.assign(Object.assign({},ym(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),ry(e,"x","bar")),ry(e,"y","bar"))},circle:{vgMark:"symbol",encodeEntry:e=>DA(e,"circle")},geoshape:{vgMark:"shape",encodeEntry:e=>Object.assign({},ym(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})),postEncodingTransform:e=>{const{encoding:t}=e,n=t.shape;return[Object.assign({type:"geoshape",projection:e.projectionName()},n&&si(n)&&n.type===T1?{field:ei(n,{expr:"datum"})}:{})]}},image:{vgMark:"image",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign({},ym(e,{align:"ignore",baseline:"ignore",color:"ignore",orient:"ignore",size:"ignore",theta:"ignore"})),ry(e,"x","image")),ry(e,"y","image")),WO(e,"url"))},line:{vgMark:"line",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},ym(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})),hf("x",e,{defaultPos:"mid"})),hf("y",e,{defaultPos:"mid"})),Wc("size",e,{vgChannel:"strokeWidth"})),qO(e))},point:{vgMark:"symbol",encodeEntry:e=>DA(e)},rect:{vgMark:"rect",encodeEntry:e=>Object.assign(Object.assign(Object.assign({},ym(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),ry(e,"x","rect")),ry(e,"y","rect"))},rule:{vgMark:"rule",encodeEntry:e=>{const{markDef:t}=e,n=t.orient;return e.encoding.x||e.encoding.y||e.encoding.latitude||e.encoding.longitude?Object.assign(Object.assign(Object.assign(Object.assign({},ym(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),hk("x",e,{defaultPos:n==="horizontal"?"zeroOrMax":"mid",defaultPos2:"zeroOrMin",range:n!=="vertical"})),hk("y",e,{defaultPos:n==="vertical"?"zeroOrMax":"mid",defaultPos2:"zeroOrMin",range:n!=="horizontal"})),Wc("size",e,{vgChannel:"strokeWidth"})):{}}},square:{vgMark:"symbol",encodeEntry:e=>DA(e,"square")},text:{vgMark:"text",encodeEntry:e=>{const{config:t,encoding:n}=e;return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},ym(e,{align:"include",baseline:"include",color:"include",size:"ignore",orient:"ignore",theta:"include"})),hf("x",e,{defaultPos:"mid"})),hf("y",e,{defaultPos:"mid"})),WO(e)),Wc("size",e,{vgChannel:"fontSize"})),Wc("angle",e)),hI("align",function(r,i,s){if(qa("align",r,s)===void 0)return"center"}(e.markDef,0,t))),hI("baseline",function(r,i,s){if(qa("baseline",r,s)===void 0)return"middle"}(e.markDef,0,t))),hf("radius",e,{defaultPos:null,isMidPoint:!0})),hf("theta",e,{defaultPos:null,isMidPoint:!0}))}},tick:{vgMark:"rect",encodeEntry:e=>{const{config:t,markDef:n}=e,r=n.orient,i=r==="horizontal"?"width":"height",s=r==="horizontal"?"height":"width";return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},ym(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),hf("x",e,{defaultPos:"mid",vgChannel:"xc"})),hf("y",e,{defaultPos:"mid",vgChannel:"yc"})),Wc("size",e,{defaultValue:function(f){var m;const{config:x,markDef:O}=f,{orient:T}=O,M=T==="horizontal"?"width":"height",H=f.getScaleComponent(T==="horizontal"?"x":"y"),Z=(m=qa("size",O,x,{vgChannel:M}))!==null&&m!==void 0?m:x.tick.bandSize;if(Z!==void 0)return Z;{const ue=H?H.get("range"):void 0;return ue&&Jv(ue)&&Ju(ue.step)?3*ue.step/4:3*ok(x.view,M)/4}}(e),vgChannel:i})),{[s]:ju(qa("thickness",n,t))})}},trail:{vgMark:"trail",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},ym(e,{align:"ignore",baseline:"ignore",color:"include",size:"include",orient:"ignore",theta:"ignore"})),hf("x",e,{defaultPos:"mid"})),hf("y",e,{defaultPos:"mid"})),Wc("size",e)),qO(e))}};function IW(e){return Ji([Nw,Dw,T7],e.mark)?function(t){const n=kF(t.mark,t.encoding),r=Lk(t,{fromPrefix:n.length>0?WR:""});return n.length>0?[{name:t.getName("pathgroup"),type:"group",from:{facet:{name:WR+t.requestDataName(ff),data:t.requestDataName(ff),groupby:n}},encode:{update:{width:{field:{group:"width"}},height:{field:{group:"height"}}}},marks:r}]:r}(e):Ji([Tw],e.mark)?function(t){const n=nO.some(r=>qa(r,t.markDef,t.config));if(t.stack&&!t.fieldDef("size")&&n){const[r]=Lk(t,{fromPrefix:VR}),i=t.scaleName(t.stack.fieldChannel),s=(H={})=>t.vgField(t.stack.fieldChannel,H),f=(H,Z)=>{const ue=[s({prefix:"min",suffix:"start",expr:Z}),s({prefix:"max",suffix:"start",expr:Z}),s({prefix:"min",suffix:"end",expr:Z}),s({prefix:"max",suffix:"end",expr:Z})];return`${H}(${ue.map(fe=>`scale('${i}',${fe})`).join(",")})`};let m,x;t.stack.fieldChannel==="x"?(m=Object.assign(Object.assign({},Yb(r.encode.update,["y","yc","y2","height",...nO])),{x:{signal:f("min","datum")},x2:{signal:f("max","datum")},clip:{value:!0}}),x={x:{field:{group:"x"},mult:-1},height:{field:{group:"height"}}},r.encode.update=Object.assign(Object.assign({},tv(r.encode.update,["y","yc","y2"])),{height:{field:{group:"height"}}})):(m=Object.assign(Object.assign({},Yb(r.encode.update,["x","xc","x2","width"])),{y:{signal:f("min","datum")},y2:{signal:f("max","datum")},clip:{value:!0}}),x={y:{field:{group:"y"},mult:-1},width:{field:{group:"width"}}},r.encode.update=Object.assign(Object.assign({},tv(r.encode.update,["x","xc","x2"])),{width:{field:{group:"width"}}}));for(const H of nO){const Z=Wy(H,t.markDef,t.config);r.encode.update[H]?(m[H]=r.encode.update[H],delete r.encode.update[H]):Z&&(m[H]=ju(Z)),Z&&(r.encode.update[H]={value:0})}const O=t.fieldDef(t.stack.groupbyChannel),T=ei(O)?[ei(O)]:[];return(O!=null&&O.bin||O!=null&&O.timeUnit)&&T.push(ei(O,{binSuffix:"end"})),(m=["stroke","strokeWidth","strokeJoin","strokeCap","strokeDash","strokeDashOffset","strokeMiterLimit","strokeOpacity"].reduce((H,Z)=>{if(r.encode.update[Z])return Object.assign(Object.assign({},H),{[Z]:r.encode.update[Z]});{const ue=Wy(Z,t.markDef,t.config);return ue!==void 0?Object.assign(Object.assign({},H),{[Z]:ju(ue)}):H}},m)).stroke&&(m.strokeForeground={value:!0},m.strokeOffset={value:0}),[{type:"group",from:{facet:{data:t.requestDataName(ff),name:VR+t.requestDataName(ff),groupby:T,aggregate:{fields:[s({suffix:"start"}),s({suffix:"start"}),s({suffix:"end"}),s({suffix:"end"})],ops:["min","max","min","max"]}}},encode:{update:m},marks:[{type:"group",encode:{update:x},marks:[r]}]}]}return Lk(t)}(e):Lk(e)}const WR="faceted_path_",VR="stack_group_";function Lk(e,t={fromPrefix:""}){const{mark:n,markDef:r,config:i}=e,s=Qu(r.clip,function(H){const Z=H.getScaleComponent("x"),ue=H.getScaleComponent("y");return!!(Z&&Z.get("selectionExtent")||ue&&ue.get("selectionExtent"))||void 0}(e),function(H){const Z=H.component.projection;return!(!Z||Z.isFit)||void 0}(e)),f=mF(r),m=e.encoding.key,x=function(H){const{encoding:Z,stack:ue,mark:fe,markDef:Ie,config:Pe}=H,Le=Z.order;if(!(!Gi(Le)&&cv(Le)&&GT(Le.value)||!Le&&GT(qa("order",Ie,Pe)))){if((Gi(Le)||si(Le))&&!ue)return vF(Le,{expr:"datum"});if(Fy(fe)){const rt=Ie.orient==="horizontal"?"y":"x",it=Z[rt];if(si(it)){const ut=it.sort;return Gi(ut)?{field:ei(it,{prefix:rt,suffix:"sort_index",expr:"datum"})}:E0(ut)?{field:ei({aggregate:CO(H.encoding)?ut.op:void 0,field:ut.field},{expr:"datum"})}:ZN(ut)?{field:ei(H.fieldDef(ut.encoding),{expr:"datum"}),order:ut.order}:ut===null?void 0:{field:ei(it,{binSuffix:H.stack&&H.stack.impute?"mid":void 0,expr:"datum"})}}}}}(e),O=function(H){if(!H.component.selection)return null;const Z=Kr(H.component.selection).length;let ue=Z,fe=H.parent;for(;fe&&ue===0;)ue=Kr(fe.component.selection).length,fe=fe.parent;return ue?{interactive:Z>0}:null}(e),T=qa("aria",r,i),M=Pk[n].postEncodingTransform?Pk[n].postEncodingTransform(e):null;return[Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:e.getName("marks"),type:Pk[n].vgMark},s?{clip:!0}:{}),f?{style:f}:{}),m?{key:m.field}:{}),x?{sort:x}:{}),O||{}),T===!1?{aria:T}:{}),{from:{data:t.fromPrefix+e.requestDataName(ff)},encode:{update:Pk[n].encodeEntry(e)}}),M?{transform:M}:{})]}class qR extends jR{constructor(t,n,r,i={},s){var f,m;super(t,"unit",n,r,s,void 0,jF(t)?t.view:void 0),this.specifiedScales={},this.specifiedAxes={},this.specifiedLegends={},this.specifiedProjection={},this.selection={},this.children=[];const x=h0(t.mark)?t.mark.type:t.mark;this.markDef=FW(t.mark,(f=t.encoding)!==null&&f!==void 0?f:{},s,{graticule:t.data&&UO(t.data)});const O=this.encoding=PL((m=t.encoding)!==null&&m!==void 0?m:{},this.markDef,s);this.size=function({encoding:T,size:M}){for(const H of gm){const Z=x0(H);A0(M[Z])&&C0(T[H])&&(delete M[Z],Gr(de.stepDropped(Z)))}return M}({encoding:O,size:jF(t)?Object.assign(Object.assign(Object.assign({},i),t.width?{width:t.width}:{}),t.height?{height:t.height}:{}):i}),this.stack=WF(x,O),this.specifiedScales=this.initScales(x,O),this.specifiedAxes=this.initAxes(O),this.specifiedLegends=this.initLegend(O),this.specifiedProjection=t.projection,this.selection=t.selection}get hasProjection(){const{encoding:t}=this,n=this.mark===sN,r=t&&z7.some(i=>Oo(t[i]));return n||r}scaleDomain(t){const n=this.specifiedScales[t];return n?n.domain:void 0}axis(t){return this.specifiedAxes[t]}legend(t){return this.specifiedLegends[t]}initScales(t,n){return Uw.reduce((r,i)=>{var s;const f=yc(n[i]);return f&&(r[i]=(s=f.scale)!==null&&s!==void 0?s:{}),r},{})}initAxes(t){return gm.reduce((n,r)=>{const i=t[r];if(Oo(i)||r===uu&&Oo(t.x2)||r===vc&&Oo(t.y2)){const s=Oo(i)?i.axis:void 0;n[r]=s&&Object.assign({},s)}return n},{})}initLegend(t){return G7.reduce((n,r)=>{const i=yc(t[r]);if(i&&function(s){switch(s){case Cd:case v0:case y0:case sv:case Od:case uv:case $v:case Gv:return!0;case qv:case Hv:case Ry:return!1}}(r)){const s=i.legend;n[r]=s&&Object.assign({},s)}return n},{})}parseData(){this.component.data=Bk(this)}parseLayoutSize(){(function(t){const{size:n,component:r}=t;for(const i of gm){const s=x0(i);if(n[s]){const f=n[s];r.layoutSize.set(s,A0(f)?"step":f,!0)}else{const f=kW(t,s);r.layoutSize.set(s,f,!1)}}})(this)}parseSelections(){this.component.selection=function(t,n){var r;const i={},s=t.config.selection;for(const f of Kr(n??{})){const m=Go(n[f]),x=s[m.type],O=Li(x,["fields","encodings"]);for(const H in O)H==="encodings"&&m.fields||H==="fields"&&m.encodings||(H==="mark"&&(m[H]=Object.assign(Object.assign({},O[H]),m[H])),m[H]!==void 0&&m[H]!==!0||(m[H]=(r=O[H])!==null&&r!==void 0?r:m[H]));const T=eu(f),M=i[T]=Object.assign(Object.assign({},m),{name:T,events:$o(m.on)?_y(m.on,"scope"):Go(m.on)});pk(M,H=>{H.has(M)&&H.parse&&H.parse(t,M,m,n[f])})}return i}(this,this.selection)}parseMarkGroup(){this.component.mark=IW(this)}parseAxesAndHeaders(){this.component.axes=AW(this)}assembleSelectionTopLevelSignals(t){return function(n,r){let i=!1;return Gy(n,(s,f)=>{const m=s.name,x=ga(m+$y);if(r.filter(O=>O.name===m).length===0){const O=s.resolve==="global"?"union":s.resolve,T=s.type==="multi"?", true)":")";r.push({name:s.name,update:`${AI}(${x}, ${ga(O)}${T}`})}i=!0,f.topLevelSignals&&(r=f.topLevelSignals(n,s,r)),pk(s,O=>{O.topLevelSignals&&(r=O.topLevelSignals(n,s,r))})}),i&&r.filter(s=>s.name==="unit").length===0&&r.unshift({name:"unit",value:{},on:[{events:"mousemove",update:"isTuple(group()) ? group() : unit"}]}),GO(r)}(this,t)}assembleSignals(){return[...VI(this),...function(t,n){return Gy(t,(r,i)=>{const s=r.name;let f=i.modifyExpr(t,r);n.push(...i.signals(t,r)),pk(r,m=>{m.signals&&(n=m.signals(t,r,n)),m.modifyExpr&&(f=m.modifyExpr(t,r,f))}),n.push({name:s+Mz,on:[{events:{signal:r.name+_0},update:`modify(${ga(r.name+$y)}, ${f})`}]})}),GO(n)}(this,[])]}assembleSelectionData(t){return function(n,r){const i=[...r];return Gy(n,s=>{const f={name:s.name+$y};if(s.init){const m=s.project.items.map(O=>Li(O,["signals"])),x=s.init.map(O=>F1(O,!1));f.values=s.type==="interval"?[{unit:hv(n,{escape:!1}),fields:m,values:x}]:x.map(O=>({unit:hv(n,{escape:!1}),fields:m,values:O}))}i.filter(m=>m.name===s.name+$y).length||i.push(f)}),i}(this,t)}assembleLayout(){return null}assembleLayoutSignals(){return fA(this)}assembleMarks(){var t;let n=(t=this.component.mark)!==null&&t!==void 0?t:[];return this.parent&&U1(this.parent)||(n=EI(this,n)),n.map(this.correctDataNames)}getMapping(){return this.encoding}get mark(){return this.markDef.type}channelHasField(t){return Vy(this.encoding,t)}fieldDef(t){return O0(this.encoding[t])}typedFieldDef(t){const n=this.fieldDef(t);return _p(n)?n:null}}class TA extends OA{constructor(t,n,r,i,s){super(t,"layer",n,r,s,t.resolve,t.view);const f=Object.assign(Object.assign(Object.assign({},i),t.width?{width:t.width}:{}),t.height?{height:t.height}:{});this.children=t.layer.map((m,x)=>{if(ak(m))return new TA(m,this,this.getName("layer_"+x),f,s);if(nv(m))return new qR(m,this,this.getName("layer_"+x),f,s);throw new Error(de.invalidSpec(m))})}parseData(){this.component.data=Bk(this);for(const t of this.children)t.parseData()}parseLayoutSize(){(function(t){AA(t),jk(t,"width"),jk(t,"height")})(this)}parseSelections(){this.component.selection={};for(const t of this.children){t.parseSelections();for(const n of Kr(t.component.selection))this.component.selection[n]=t.component.selection[n]}}parseMarkGroup(){for(const t of this.children)t.parseMarkGroup()}parseAxesAndHeaders(){(function(t){var n;const{axes:r,resolve:i}=t.component,s={top:0,bottom:0,right:0,left:0};for(const f of t.children){f.parseAxesAndHeaders();for(const m of Kr(f.component.axes))i.axis[m]=hA(t.component.resolve,m),i.axis[m]==="shared"&&(r[m]=_W(r[m],f.component.axes[m]),r[m]||(i.axis[m]="independent",delete r[m]))}for(const f of gm){for(const m of t.children)if(m.component.axes[f]){if(i.axis[f]==="independent"){r[f]=((n=r[f])!==null&&n!==void 0?n:[]).concat(m.component.axes[f]);for(const x of m.component.axes[f]){const{value:O,explicit:T}=x.getWithExplicit("orient");if(!po(O)){if(s[O]>0&&!T){const M=SW[O];s[O]>s[M]&&x.set("orient",M,!1)}s[O]++}}}delete m.component.axes[f]}if(i.axis[f]==="independent"&&r[f]&&r[f].length>1)for(const m of r[f])m.get("grid")&&!m.explicit.grid&&(m.implicit.grid=!1)}})(this)}assembleSelectionTopLevelSignals(t){return this.children.reduce((n,r)=>r.assembleSelectionTopLevelSignals(n),t)}assembleSignals(){return this.children.reduce((t,n)=>t.concat(n.assembleSignals()),VI(this))}assembleLayoutSignals(){return this.children.reduce((t,n)=>t.concat(n.assembleLayoutSignals()),fA(this))}assembleSelectionData(t){return this.children.reduce((n,r)=>r.assembleSelectionData(n),t)}assembleTitle(){let t=super.assembleTitle();if(t)return t;for(const n of this.children)if(t=n.assembleTitle())return t}assembleLayout(){return null}assembleMarks(){return function(t,n){for(const r of t.children)yu(r)&&(n=EI(r,n));return n}(this,this.children.flatMap(t=>t.assembleMarks()))}assembleLegends(){return this.children.reduce((t,n)=>t.concat(n.assembleLegends()),pR(this))}}function NA(e,t,n,r,i){if(Xw(e))return new Dx(e,t,n,i);if(ak(e))return new TA(e,t,n,r,i);if(nv(e))return new qR(e,t,n,r,i);if(function(s){return ik(s)||MO(s)||RO(s)}(e))return new CW(e,t,n,i);throw new Error(de.invalidSpec(e))}function RW(e,t={}){t.logger&&function(n){qw=n}(t.logger),t.fieldTitle&&cF(t.fieldTitle);try{const n=LF($T(t.config,e.config)),r=YF(e,n),i=NA(r,null,"",void 0,n);return i.parse(),function(s,f){mA(s.sources);let m=0,x=0;for(let O=0;O<Ak&&kR(s,f);O++)m++;s.sources.map(vA);for(let O=0;O<Ak&&kR(s,f);O++)x++;mA(s.sources),Math.max(m,x)===Ak&&Gr(`Maximum optimization runs(${Ak}) reached.`)}(i.component.data,i),{spec:function(s,f,m={},x){const O=s.config?QL(s.config):void 0,T=[].concat(s.assembleSelectionData([]),function(Ie,Pe){var Le,rt;const it=[],ut=BR(it);let st=0;for(const dt of Ie.sources)dt.hasName()||(dt.dataName=`source_${st++}`),ut(dt,dt.assemble());for(const dt of it)dt.transform.length===0&&delete dt.transform;let mt=0;for(const[dt,en]of it.entries())((Le=en.transform)!==null&&Le!==void 0?Le:[]).length!==0||en.source||it.splice(mt++,0,it.splice(dt,1)[0]);for(const dt of it)for(const en of(rt=dt.transform)!==null&&rt!==void 0?rt:[])en.type==="lookup"&&(en.from=Ie.outputNodes[en.from].getSource());for(const dt of it)dt.name in Pe&&(dt.values=Pe[dt.name]);return it}(s.component.data,m)),M=s.assembleProjections(),H=s.assembleTitle(),Z=s.assembleGroupStyle(),ue=s.assembleGroupEncodeEntry(!0);let fe=s.assembleLayoutSignals();return fe=fe.filter(Ie=>Ie.name!=="width"&&Ie.name!=="height"||Ie.value===void 0||(f[Ie.name]=+Ie.value,!1)),Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({$schema:"https://vega.github.io/schema/vega/v5.json"},s.description?{description:s.description}:{}),f),H?{title:H}:{}),Z?{style:Z}:{}),ue?{encode:{update:ue}}:{}),{data:T}),M.length>0?{projections:M}:{}),s.assembleGroup([...fe,...s.assembleSelectionTopLevelSignals([])])),O?{config:O}:{}),x?{usermeta:x}:{})}(i,function(s,f,m,x){const O=x.component.layoutSize.get("width"),T=x.component.layoutSize.get("height");if(f===void 0?(f={type:"pad"},x.hasAxisOrientSignalRef()&&(f.resize=!0)):$o(f)&&(f={type:f}),O&&T&&function(M){return M==="fit"||M==="fit-x"||M==="fit-y"}(f.type)){if(O==="step"&&T==="step")Gr(de.droppingFit()),f.type="pad";else if(O==="step"||T==="step"){const M=O==="step"?"width":"height";Gr(de.droppingFit(zw(M)));const H=M==="width"?"height":"width";f.type=function(Z){return Z?`fit-${zw(Z)}`:"fit"}(H)}}return Object.assign(Object.assign(Object.assign({},Kr(f).length===1&&f.type?f.type==="pad"?{}:{autosize:f.type}:{autosize:f}),QF(m)),QF(s))}(e,r.autosize,n,i),e.datasets,e.usermeta),normalized:r}}finally{t.logger&&mL(),t.fieldTitle&&cF(sF)}}const MW=new class extends zF{mapUnit(e,{config:t}){if(e.encoding){const{encoding:n,transform:r}=e,{bins:i,timeUnits:s,aggregate:f,groupby:m,encoding:x}=OO(n,t),O=[...r||[],...i,...s,...f.length===0?[]:[{aggregate:f,groupby:m}]];return Object.assign(Object.assign(Object.assign({},e),O.length>0?{transform:O}:{}),{encoding:x})}return e}};function jW(e,t){return MW.map(e,{config:t})}const BW=u7.version;var HR=function(e){const[t,n]=/schema\/([\w-]+)\/([\w\.\-]+)\.json$/g.exec(e).slice(1,3);return{library:t,version:n}};const PW={background:"#333",title:{color:"#fff",subtitleColor:"#fff"},style:{"guide-label":{fill:"#fff"},"guide-title":{fill:"#fff"}},axis:{domainColor:"#fff",gridColor:"#888",tickColor:"#fff"}},LW={background:"#fff",arc:{fill:"#4572a7"},area:{fill:"#4572a7"},line:{stroke:"#4572a7",strokeWidth:2},path:{stroke:"#4572a7"},rect:{fill:"#4572a7"},shape:{stroke:"#4572a7"},symbol:{fill:"#4572a7",strokeWidth:1.5,size:50},axis:{bandPosition:.5,grid:!0,gridColor:"#000000",gridOpacity:1,gridWidth:.5,labelPadding:10,tickSize:5,tickWidth:.5},axisBand:{grid:!1,tickExtra:!0},legend:{labelBaseline:"middle",labelFontSize:11,symbolSize:50,symbolType:"square"},range:{category:["#4572a7","#aa4643","#8aa453","#71598e","#4598ae","#d98445","#94aace","#d09393","#b9cc98","#a99cbc"]}},zW={arc:{fill:"#30a2da"},area:{fill:"#30a2da"},axis:{domainColor:"#cbcbcb",grid:!0,gridColor:"#cbcbcb",gridWidth:1,labelColor:"#999",labelFontSize:10,titleColor:"#333",tickColor:"#cbcbcb",tickSize:10,titleFontSize:14,titlePadding:10,labelPadding:4},axisBand:{grid:!1},background:"#f0f0f0",group:{fill:"#f0f0f0"},legend:{labelColor:"#333",labelFontSize:11,padding:1,symbolSize:30,symbolType:"square",titleColor:"#333",titleFontSize:14,titlePadding:10},line:{stroke:"#30a2da",strokeWidth:2},path:{stroke:"#30a2da",strokeWidth:.5},rect:{fill:"#30a2da"},range:{category:["#30a2da","#fc4f30","#e5ae38","#6d904f","#8b8b8b","#b96db8","#ff9e27","#56cc60","#52d2ca","#52689e","#545454","#9fe4f8"],diverging:["#cc0020","#e77866","#f6e7e1","#d6e8ed","#91bfd9","#1d78b5"],heatmap:["#d6e8ed","#cee0e5","#91bfd9","#549cc6","#1d78b5"]},point:{filled:!0,shape:"circle"},shape:{stroke:"#30a2da"},bar:{binSpacing:2,fill:"#30a2da",stroke:null},title:{anchor:"start",fontSize:24,fontWeight:600,offset:20}},UW={group:{fill:"#e5e5e5"},arc:{fill:"#000"},area:{fill:"#000"},line:{stroke:"#000"},path:{stroke:"#000"},rect:{fill:"#000"},shape:{stroke:"#000"},symbol:{fill:"#000",size:40},axis:{domain:!1,grid:!0,gridColor:"#FFFFFF",gridOpacity:1,labelColor:"#7F7F7F",labelPadding:4,tickColor:"#7F7F7F",tickSize:5.67,titleFontSize:16,titleFontWeight:"normal"},legend:{labelBaseline:"middle",labelFontSize:11,symbolSize:40},range:{category:["#000000","#7F7F7F","#1A1A1A","#999999","#333333","#B0B0B0","#4D4D4D","#C9C9C9","#666666","#DCDCDC"]}},FA="Benton Gothic Bold, sans-serif",Tx={"category-6":["#ec8431","#829eb1","#c89d29","#3580b1","#adc839","#ab7fb4"],"fire-7":["#fbf2c7","#f9e39c","#f8d36e","#f4bb6a","#e68a4f","#d15a40","#ab4232"],"fireandice-6":["#e68a4f","#f4bb6a","#f9e39c","#dadfe2","#a6b7c6","#849eae"],"ice-7":["#edefee","#dadfe2","#c4ccd2","#a6b7c6","#849eae","#607785","#47525d"]},WW={background:"#ffffff",title:{anchor:"start",color:"#000000",font:FA,fontSize:22,fontWeight:"normal"},arc:{fill:"#82c6df"},area:{fill:"#82c6df"},line:{stroke:"#82c6df",strokeWidth:2},path:{stroke:"#82c6df"},rect:{fill:"#82c6df"},shape:{stroke:"#82c6df"},symbol:{fill:"#82c6df",size:30},axis:{labelFont:"Benton Gothic, sans-serif",labelFontSize:11.5,labelFontWeight:"normal",titleFont:FA,titleFontSize:13,titleFontWeight:"normal"},axisX:{labelAngle:0,labelPadding:4,tickSize:3},axisY:{labelBaseline:"middle",maxExtent:45,minExtent:45,tickSize:2,titleAlign:"left",titleAngle:0,titleX:-45,titleY:-11},legend:{labelFont:"Benton Gothic, sans-serif",labelFontSize:11.5,symbolType:"square",titleFont:FA,titleFontSize:13,titleFontWeight:"normal"},range:{category:Tx["category-6"],diverging:Tx["fireandice-6"],heatmap:Tx["fire-7"],ordinal:Tx["fire-7"],ramp:Tx["fire-7"]}},VW={background:"#f9f9f9",arc:{fill:"#ab5787"},area:{fill:"#ab5787"},line:{stroke:"#ab5787"},path:{stroke:"#ab5787"},rect:{fill:"#ab5787"},shape:{stroke:"#ab5787"},symbol:{fill:"#ab5787",size:30},axis:{domainColor:"#979797",domainWidth:.5,gridWidth:.2,labelColor:"#979797",tickColor:"#979797",tickWidth:.2,titleColor:"#979797"},axisBand:{grid:!1},axisX:{grid:!0,tickSize:10},axisY:{domain:!1,grid:!0,tickSize:0},legend:{labelFontSize:11,padding:1,symbolSize:30,symbolType:"square"},range:{category:["#ab5787","#51b2e5","#703c5c","#168dd9","#d190b6","#00609f","#d365ba","#154866","#666666","#c4c4c4"]}},qW={background:"#fff",arc:{fill:"#3e5c69"},area:{fill:"#3e5c69"},line:{stroke:"#3e5c69"},path:{stroke:"#3e5c69"},rect:{fill:"#3e5c69"},shape:{stroke:"#3e5c69"},symbol:{fill:"#3e5c69"},axis:{domainWidth:.5,grid:!0,labelPadding:2,tickSize:5,tickWidth:.5,titleFontWeight:"normal"},axisBand:{grid:!1},axisX:{gridWidth:.2},axisY:{gridDash:[3],gridWidth:.4},legend:{labelFontSize:11,padding:1,symbolType:"square"},range:{category:["#3e5c69","#6793a6","#182429","#0570b0","#3690c0","#74a9cf","#a6bddb","#e2ddf2"]}},Nx={"main-colors":["#1696d2","#d2d2d2","#000000","#fdbf11","#ec008b","#55b748","#5c5859","#db2b27"],"shades-blue":["#CFE8F3","#A2D4EC","#73BFE2","#46ABDB","#1696D2","#12719E","#0A4C6A","#062635"],"shades-gray":["#F5F5F5","#ECECEC","#E3E3E3","#DCDBDB","#D2D2D2","#9D9D9D","#696969","#353535"],"shades-yellow":["#FFF2CF","#FCE39E","#FDD870","#FCCB41","#FDBF11","#E88E2D","#CA5800","#843215"],"shades-magenta":["#F5CBDF","#EB99C2","#E46AA7","#E54096","#EC008B","#AF1F6B","#761548","#351123"],"shades-green":["#DCEDD9","#BCDEB4","#98CF90","#78C26D","#55B748","#408941","#2C5C2D","#1A2E19"],"shades-black":["#D5D5D4","#ADABAC","#848081","#5C5859","#332D2F","#262223","#1A1717","#0E0C0D"],"shades-red":["#F8D5D4","#F1AAA9","#E9807D","#E25552","#DB2B27","#A4201D","#6E1614","#370B0A"],"one-group":["#1696d2","#000000"],"two-groups-cat-1":["#1696d2","#000000"],"two-groups-cat-2":["#1696d2","#fdbf11"],"two-groups-cat-3":["#1696d2","#db2b27"],"two-groups-seq":["#a2d4ec","#1696d2"],"three-groups-cat":["#1696d2","#fdbf11","#000000"],"three-groups-seq":["#a2d4ec","#1696d2","#0a4c6a"],"four-groups-cat-1":["#000000","#d2d2d2","#fdbf11","#1696d2"],"four-groups-cat-2":["#1696d2","#ec0008b","#fdbf11","#5c5859"],"four-groups-seq":["#cfe8f3","#73bf42","#1696d2","#0a4c6a"],"five-groups-cat-1":["#1696d2","#fdbf11","#d2d2d2","#ec008b","#000000"],"five-groups-cat-2":["#1696d2","#0a4c6a","#d2d2d2","#fdbf11","#332d2f"],"five-groups-seq":["#cfe8f3","#73bf42","#1696d2","#0a4c6a","#000000"],"six-groups-cat-1":["#1696d2","#ec008b","#fdbf11","#000000","#d2d2d2","#55b748"],"six-groups-cat-2":["#1696d2","#d2d2d2","#ec008b","#fdbf11","#332d2f","#0a4c6a"],"six-groups-seq":["#cfe8f3","#a2d4ec","#73bfe2","#46abdb","#1696d2","#12719e"],"diverging-colors":["#ca5800","#fdbf11","#fdd870","#fff2cf","#cfe8f3","#73bfe2","#1696d2","#0a4c6a"]},HW={background:"#FFFFFF",title:{anchor:"start",fontSize:18,font:"Lato"},axisX:{domain:!0,domainColor:"#000000",domainWidth:1,grid:!1,labelFontSize:12,labelFont:"Lato",labelAngle:0,tickColor:"#000000",tickSize:5,titleFontSize:12,titlePadding:10,titleFont:"Lato"},axisY:{domain:!1,domainWidth:1,grid:!0,gridColor:"#DEDDDD",gridWidth:1,labelFontSize:12,labelFont:"Lato",labelPadding:8,ticks:!1,titleFontSize:12,titlePadding:10,titleFont:"Lato",titleAngle:0,titleY:-10,titleX:18},legend:{labelFontSize:12,labelFont:"Lato",symbolSize:100,titleFontSize:12,titlePadding:10,titleFont:"Lato",orient:"right",offset:10},view:{stroke:"transparent"},range:{category:Nx["six-groups-cat-1"],diverging:Nx["diverging-colors"],heatmap:Nx["diverging-colors"],ordinal:Nx["six-groups-seq"],ramp:Nx["shades-blue"]},area:{fill:"#1696d2"},rect:{fill:"#1696d2"},line:{color:"#1696d2",stroke:"#1696d2",strokeWidth:5},trail:{color:"#1696d2",stroke:"#1696d2",strokeWidth:0,size:1},path:{stroke:"#1696d2",strokeWidth:.5},point:{filled:!0},text:{font:"Lato",color:"#1696d2",fontSize:11,align:"center",fontWeight:400,size:11},style:{bar:{fill:"#1696d2",stroke:null}},arc:{fill:"#1696d2"},shape:{stroke:"#1696d2"},symbol:{fill:"#1696d2",size:30}},$W={arc:{fill:"#3366CC"},area:{fill:"#3366CC"},path:{stroke:"#3366CC"},rect:{fill:"#3366CC"},shape:{stroke:"#3366CC"},symbol:{stroke:"#3366CC"},circle:{fill:"#3366CC"},background:"#fff",padding:{top:10,right:10,bottom:10,left:10},style:{"guide-label":{font:"Arial, sans-serif",fontSize:12},"guide-title":{font:"Arial, sans-serif",fontSize:12},"group-title":{font:"Arial, sans-serif",fontSize:12}},title:{font:"Arial, sans-serif",fontSize:14,fontWeight:"bold",dy:-3,anchor:"start"},axis:{gridColor:"#ccc",tickColor:"#ccc",domain:!1,grid:!0},range:{category:["#4285F4","#DB4437","#F4B400","#0F9D58","#AB47BC","#00ACC1","#FF7043","#9E9D24","#5C6BC0","#F06292","#00796B","#C2185B"],heatmap:["#c6dafc","#5e97f6","#2a56c6"]}},GW="2.10.0";var KW=`#vg-tooltip-element {
  visibility: hidden;
  padding: 8px;
  position: fixed;
  z-index: 1000;
  font-family: sans-serif;
  font-size: 11px;
  border-radius: 3px;
  box-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
  /* The default theme is the light theme. */
  background-color: rgba(255, 255, 255, 0.95);
  border: 1px solid #d9d9d9;
  color: black; }
  #vg-tooltip-element.visible {
    visibility: visible; }
  #vg-tooltip-element h2 {
    margin-top: 0;
    margin-bottom: 10px;
    font-size: 13px; }
  #vg-tooltip-element img {
    max-width: 200px;
    max-height: 200px; }
  #vg-tooltip-element table {
    border-spacing: 0; }
    #vg-tooltip-element table tr {
      border: none; }
      #vg-tooltip-element table tr td {
        overflow: hidden;
        text-overflow: ellipsis;
        padding-top: 2px;
        padding-bottom: 2px; }
        #vg-tooltip-element table tr td.key {
          color: #808080;
          max-width: 150px;
          text-align: right;
          padding-right: 4px; }
        #vg-tooltip-element table tr td.value {
          display: block;
          max-width: 300px;
          max-height: 7em;
          text-align: left; }
  #vg-tooltip-element.dark-theme {
    background-color: rgba(32, 32, 32, 0.9);
    border: 1px solid #f5f5f5;
    color: white; }
    #vg-tooltip-element.dark-theme td.key {
      color: #bfbfbf; }
`;const $R="vg-tooltip-element",XW={offsetX:10,offsetY:10,id:$R,styleId:"vega-tooltip-style",theme:"light",disableDefaultStyle:!1,sanitize:function(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;")},maxDepth:2};function YW(e,t,n){if(Object(be.B)(e))return`[${e.map(r=>t(Object(be.J)(r)?r:GR(r,n))).join(", ")}]`;if(Object(be.H)(e)){let r="";const i=e,{title:s,image:f}=i,m=function(O,T){var M={};for(var H in O)Object.prototype.hasOwnProperty.call(O,H)&&T.indexOf(H)<0&&(M[H]=O[H]);if(O!=null&&typeof Object.getOwnPropertySymbols=="function"){var Z=0;for(H=Object.getOwnPropertySymbols(O);Z<H.length;Z++)T.indexOf(H[Z])<0&&Object.prototype.propertyIsEnumerable.call(O,H[Z])&&(M[H[Z]]=O[H[Z]])}return M}(i,["title","image"]);s&&(r+=`<h2>${t(s)}</h2>`),f&&(r+=`<img src="${t(f)}">`);const x=Object.keys(m);if(x.length>0){r+="<table>";for(const O of x){let T=m[O];T!==void 0&&(Object(be.H)(T)&&(T=GR(T,n)),r+=`<tr><td class="key">${t(O)}:</td><td class="value">${t(T)}</td></tr>`)}r+="</table>"}return r||"{}"}return t(e)}function GR(e,t){return JSON.stringify(e,function(n){const r=[];return function(i,s){if(typeof s!="object"||s===null)return s;const f=r.indexOf(this)+1;return r.length=f,r.length>n?"[Object]":r.indexOf(s)>=0?"[Circular]":(r.push(s),s)}}(t))}class JW{constructor(t){this.options=Object.assign(Object.assign({},XW),t);const n=this.options.id;if(this.el=null,this.call=this.tooltipHandler.bind(this),!this.options.disableDefaultStyle&&!document.getElementById(this.options.styleId)){const r=document.createElement("style");r.setAttribute("id",this.options.styleId),r.innerHTML=function(s){if(!/^[A-Za-z]+[-:.\w]*$/.test(s))throw new Error("Invalid HTML ID");return KW.toString().replace($R,s)}(n);const i=document.head;i.childNodes.length>0?i.insertBefore(r,i.childNodes[0]):i.appendChild(r)}}tooltipHandler(t,n,r,i){if(this.el=document.getElementById(this.options.id),this.el||(this.el=document.createElement("div"),this.el.setAttribute("id",this.options.id),this.el.classList.add("vg-tooltip"),document.body.appendChild(this.el)),(document.fullscreenElement!=null?document.fullscreenElement:document.body).appendChild(this.el),i==null||i==="")return void this.el.classList.remove("visible",`${this.options.theme}-theme`);this.el.innerHTML=YW(i,this.options.sanitize,this.options.maxDepth),this.el.classList.add("visible",`${this.options.theme}-theme`);const{x:s,y:f}=function(m,x,O,T){let M=m.clientX+O;M+x.width>window.innerWidth&&(M=+m.clientX-O-x.width);let H=m.clientY+T;return H+x.height>window.innerHeight&&(H=+m.clientY-T-x.height),{x:M,y:H}}(n,this.el.getBoundingClientRect(),this.options.offsetX,this.options.offsetY);this.el.setAttribute("style",`top: ${f}px; left: ${s}px`)}}/*! *****************************************************************************
	Copyright (c) Microsoft Corporation.

	Permission to use, copy, modify, and/or distribute this software for any
	purpose with or without fee is hereby granted.

	THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
	REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
	AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
	INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
	LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
	OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
	PERFORMANCE OF THIS SOFTWARE.
	***************************************************************************** */function zk(e,t,n,r){return new(n||(n=Promise))(function(i,s){function f(O){try{x(r.next(O))}catch(T){s(T)}}function m(O){try{x(r.throw(O))}catch(T){s(T)}}function x(O){O.done?i(O.value):function(T){return T instanceof n?T:new n(function(M){M(T)})}(O.value).then(f,m)}x((r=r.apply(e,t||[])).next())})}a.d(A,"DEFAULT_ACTIONS",function(){return XR}),a.d(A,"guessMode",function(){return JR}),a.d(A,"vega",function(){return vv}),a.d(A,"vegaLite",function(){return V1});var IA,QW=`.vega-embed {
  position: relative;
  display: inline-block;
  box-sizing: border-box; }
  .vega-embed.has-actions {
    padding-right: 38px; }
  .vega-embed details:not([open]) > :not(summary) {
    display: none !important; }
  .vega-embed summary {
    list-style: none;
    position: absolute;
    top: 0;
    right: 0;
    padding: 6px;
    z-index: 1000;
    background: white;
    box-shadow: 1px 1px 3px rgba(0, 0, 0, 0.1);
    color: #1b1e23;
    border: 1px solid #aaa;
    border-radius: 999px;
    opacity: 0.2;
    transition: opacity 0.4s ease-in;
    outline: none;
    cursor: pointer;
    line-height: 0px; }
    .vega-embed summary::-webkit-details-marker {
      display: none; }
    .vega-embed summary:active {
      box-shadow: #aaa 0px 0px 0px 1px inset; }
    .vega-embed summary svg {
      width: 14px;
      height: 14px; }
  .vega-embed details[open] summary {
    opacity: 0.7; }
  .vega-embed:hover summary,
  .vega-embed:focus summary {
    opacity: 1 !important;
    transition: opacity 0.2s ease; }
  .vega-embed .vega-actions {
    position: absolute;
    z-index: 1001;
    top: 35px;
    right: -9px;
    display: flex;
    flex-direction: column;
    padding-bottom: 8px;
    padding-top: 8px;
    border-radius: 4px;
    box-shadow: 0 2px 8px 0 rgba(0, 0, 0, 0.2);
    border: 1px solid #d9d9d9;
    background: white;
    animation-duration: 0.15s;
    animation-name: scale-in;
    animation-timing-function: cubic-bezier(0.2, 0, 0.13, 1.5);
    text-align: left; }
    .vega-embed .vega-actions a {
      padding: 8px 16px;
      font-family: sans-serif;
      font-size: 14px;
      font-weight: 600;
      white-space: nowrap;
      color: #434a56;
      text-decoration: none; }
      .vega-embed .vega-actions a:hover {
        background-color: #f7f7f9;
        color: black; }
    .vega-embed .vega-actions::before, .vega-embed .vega-actions::after {
      content: "";
      display: inline-block;
      position: absolute; }
    .vega-embed .vega-actions::before {
      left: auto;
      right: 14px;
      top: -16px;
      border: 8px solid #0000;
      border-bottom-color: #d9d9d9; }
    .vega-embed .vega-actions::after {
      left: auto;
      right: 15px;
      top: -14px;
      border: 7px solid #0000;
      border-bottom-color: #fff; }
  .vega-embed .chart-wrapper {
    width: 100%;
    height: 100%; }

.vega-embed-wrapper {
  max-width: 100%;
  overflow: auto;
  padding-right: 14px; }

@keyframes scale-in {
  from {
    opacity: 0;
    transform: scale(0.6); }
  to {
    opacity: 1;
    transform: scale(1); } }
`;function KR(e,...t){for(const n of t)ZW(e,n);return e}function ZW(e,t){for(const n of Object.keys(t))Object(be.La)(e,n,t[n],!0)}String.prototype.startsWith||(String.prototype.startsWith=function(e,t){return this.substr(!t||t<0?0:+t,e.length)===e});const vv=K;let V1=pe;const Uk=typeof window<"u"?window:void 0;V1===void 0&&(!((IA=Uk==null?void 0:Uk.vl)===null||IA===void 0)&&IA.compile)&&(V1=Uk.vl);const XR={export:{svg:!0,png:!0},source:!0,compiled:!0,editor:!0},eV={CLICK_TO_VIEW_ACTIONS:"Click to view actions",COMPILED_ACTION:"View Compiled Vega",EDITOR_ACTION:"Open in Vega Editor",PNG_ACTION:"Save as PNG",SOURCE_ACTION:"View Source",SVG_ACTION:"Save as SVG"},Fx={vega:"Vega","vega-lite":"Vega-Lite"},Wk={vega:vv.version,"vega-lite":V1?V1.version:"not available"},tV={vega:e=>e,"vega-lite":(e,t)=>V1.compile(e,{config:t}).spec},nV=`
<svg viewBox="0 0 16 16" fill="currentColor" stroke="none" stroke-width="1" stroke-linecap="round" stroke-linejoin="round">
  <circle r="2" cy="8" cx="2"></circle>
  <circle r="2" cy="8" cx="8"></circle>
  <circle r="2" cy="8" cx="14"></circle>
</svg>`,rV="chart-wrapper";function YR(e,t,n,r){const i=`<html><head>${t}</head><body><pre><code class="json">`,s=`</code></pre>${n}</body></html>`,f=window.open("");f.document.write(i+e+s),f.document.title=`${Fx[r]} JSON Source`}function JR(e,t){var n;if(e.$schema){const r=HR(e.$schema);t&&t!==r.library&&console.warn(`The given visualization spec is written in ${Fx[r.library]}, but mode argument sets ${(n=Fx[t])!==null&&n!==void 0?n:t}.`);const i=r.library;return Object(Kn.satisfies)(Wk[i],`^${r.version.slice(1)}`)||console.warn(`The input spec uses ${Fx[i]} ${r.version}, but the current version of ${Fx[i]} is v${Wk[i]}.`),i}return"mark"in e||"encoding"in e||"layer"in e||"hconcat"in e||"vconcat"in e||"facet"in e||"repeat"in e?"vega-lite":"marks"in e||"signals"in e||"scales"in e||"axes"in e?"vega":t??"vega"}function QR(e){return function(t){return!!(t&&"load"in t)}(e)?e:vv.loader(e)}function ZR(e){var t;return(t=e.usermeta&&e.usermeta.embedOptions)!==null&&t!==void 0?t:{}}function e5(e,t){var n;return zk(this,void 0,void 0,function*(){const r=Object(be.J)(e.config)?JSON.parse(yield t.load(e.config)):(n=e.config)!==null&&n!==void 0?n:{},i=Object(be.J)(e.patch)?JSON.parse(yield t.load(e.patch)):e.patch;return Object.assign(Object.assign(Object.assign({},e),i?{patch:i}:{}),r?{config:r}:{})})}A.default=function(e,t,n={}){var r,i,s;return zk(this,void 0,void 0,function*(){let f,m;Object(be.J)(t)?(m=QR(n.loader),f=JSON.parse(yield m.load(t))):f=t;const x=ZR(f).loader;m&&!x||(m=QR((r=n.loader)!==null&&r!==void 0?r:x));const O=yield e5(ZR(f),m),T=yield e5(n,m),M=Object.assign(Object.assign({},KR(T,O)),{config:Object(be.P)((i=T.config)!==null&&i!==void 0?i:{},(s=O.config)!==null&&s!==void 0?s:{})});return yield function(H,Z,ue={},fe){var Ie,Pe,Le,rt,it,ut;return zk(this,void 0,void 0,function*(){const st=ue.theme?Object(be.P)(Ae[ue.theme],(Ie=ue.config)!==null&&Ie!==void 0?Ie:{}):ue.config,mt=Object(be.C)(ue.actions)?ue.actions:KR({},XR,(Pe=ue.actions)!==null&&Pe!==void 0?Pe:{}),dt=Object.assign(Object.assign({},eV),ue.i18n),en=(Le=ue.renderer)!==null&&Le!==void 0?Le:"canvas",mn=(rt=ue.logLevel)!==null&&rt!==void 0?rt:vv.Warn,sn=(it=ue.downloadFileName)!==null&&it!==void 0?it:"visualization",In=typeof H=="string"?document.querySelector(H):H;if(!In)throw new Error(`${H} does not exist`);if(ue.defaultStyle!==!1){const vi="vega-embed-style",{root:zi,rootContainer:wi}=function(yi){var _i;const vo=yi.getRootNode?yi.getRootNode():document;return vo instanceof ShadowRoot?{root:vo,rootContainer:vo}:{root:document,rootContainer:(_i=document.head)!==null&&_i!==void 0?_i:document.body}}(In);if(!zi.getElementById(vi)){const yi=document.createElement("style");yi.id=vi,yi.innerText=ue.defaultStyle===void 0||ue.defaultStyle===!0?QW.toString():ue.defaultStyle,wi.appendChild(yi)}}const Fn=JR(Z,ue.mode);let zn=tV[Fn](Z,st);if(Fn==="vega-lite"&&zn.$schema){const vi=HR(zn.$schema);Object(Kn.satisfies)(Wk.vega,`^${vi.version.slice(1)}`)||console.warn(`The compiled spec uses Vega ${vi.version}, but current version is v${Wk.vega}.`)}In.classList.add("vega-embed"),mt&&In.classList.add("has-actions"),In.innerHTML="";let Vn=In;if(mt){const vi=document.createElement("div");vi.classList.add(rV),In.appendChild(vi),Vn=vi}const Qn=ue.patch;Qn&&(zn=Qn instanceof Function?Qn(zn):gn(zn,Qn,!0,!1).newDocument),ue.formatLocale&&vv.formatLocale(ue.formatLocale),ue.timeFormatLocale&&vv.timeFormatLocale(ue.timeFormatLocale);const{ast:mr}=ue,Pr=vv.parse(zn,Fn==="vega-lite"?{}:st,{ast:mr}),Cr=new(ue.viewClass||vv.View)(Pr,Object.assign({loader:fe,logLevel:mn,renderer:en},mr?{expr:vv.expressionInterpreter}:{}));if(ue.tooltip!==!1){let vi;vi=function(zi){return typeof zi=="function"}(ue.tooltip)?ue.tooltip:new JW(ue.tooltip===!0?{}:ue.tooltip).call,Cr.tooltip(vi)}let Jr,{hover:gi}=ue;if(gi===void 0&&(gi=Fn==="vega"),gi){const{hoverSet:vi,updateSet:zi}=typeof gi=="boolean"?{}:gi;Cr.hover(vi,zi)}if(ue&&(ue.width!=null&&Cr.width(ue.width),ue.height!=null&&Cr.height(ue.height),ue.padding!=null&&Cr.padding(ue.padding)),yield Cr.initialize(Vn,ue.bind).runAsync(),mt!==!1){let vi=In;if(ue.defaultStyle!==!1){const wi=document.createElement("details");wi.title=dt.CLICK_TO_VIEW_ACTIONS,In.append(wi),vi=wi;const yi=document.createElement("summary");yi.innerHTML=nV,wi.append(yi),Jr=_i=>{wi.contains(_i.target)||wi.removeAttribute("open")},document.addEventListener("click",Jr)}const zi=document.createElement("div");if(vi.append(zi),zi.classList.add("vega-actions"),mt===!0||mt.export!==!1){for(const wi of["svg","png"])if(mt===!0||mt.export===!0||mt.export[wi]){const yi=dt[`${wi.toUpperCase()}_ACTION`],_i=document.createElement("a");_i.text=yi,_i.href="#",_i.target="_blank",_i.download=`${sn}.${wi}`,_i.addEventListener("mousedown",function(vo){return zk(this,void 0,void 0,function*(){vo.preventDefault();const na=yield Cr.toImageURL(wi,ue.scaleFactor);this.href=na})}),zi.append(_i)}}if(mt===!0||mt.source!==!1){const wi=document.createElement("a");wi.text=dt.SOURCE_ACTION,wi.href="#",wi.addEventListener("click",function(yi){var _i,vo;YR(xn()(Z),(_i=ue.sourceHeader)!==null&&_i!==void 0?_i:"",(vo=ue.sourceFooter)!==null&&vo!==void 0?vo:"",Fn),yi.preventDefault()}),zi.append(wi)}if(Fn==="vega-lite"&&(mt===!0||mt.compiled!==!1)){const wi=document.createElement("a");wi.text=dt.COMPILED_ACTION,wi.href="#",wi.addEventListener("click",function(yi){var _i,vo;YR(xn()(zn),(_i=ue.sourceHeader)!==null&&_i!==void 0?_i:"",(vo=ue.sourceFooter)!==null&&vo!==void 0?vo:"","vega"),yi.preventDefault()}),zi.append(wi)}if(mt===!0||mt.editor!==!1){const wi=(ut=ue.editorUrl)!==null&&ut!==void 0?ut:"https://vega.github.io/editor/",yi=document.createElement("a");yi.text=dt.EDITOR_ACTION,yi.href="#",yi.addEventListener("click",function(_i){(function(vo,na,Ui){const va=vo.open(na),ya=250,{origin:Ha}=new URL(na);let Ns=~~(1e4/ya);vo.addEventListener("message",function Fs(gs){gs.source===va&&(Ns=0,vo.removeEventListener("message",Fs,!1))},!1),setTimeout(function Fs(){Ns<=0||(va.postMessage(Ui,Ha),setTimeout(Fs,ya),Ns-=1)},ya)})(window,wi,{config:st,mode:Fn,renderer:en,spec:xn()(Z)}),_i.preventDefault()}),zi.append(yi)}}return{view:Cr,spec:Z,vgSpec:zn,finalize:function(){Jr&&document.removeEventListener("click",Jr),Cr.finalize()}}})}(e,f,M,m)})}},function(Oe,A,a){const{MAX_LENGTH:b}=a(117),{re:$,t:U}=a(90),B=a(32),re=a(115);Oe.exports=(J,R)=>{if(R=re(R),J instanceof B)return J;if(typeof J!="string"||J.length>b||!(R.loose?$[U.LOOSE]:$[U.FULL]).test(J))return null;try{return new B(J,R)}catch{return null}}},function(Oe,A,a){const{MAX_SAFE_COMPONENT_LENGTH:b}=a(117),$=a(116),U=(A=Oe.exports={}).re=[],B=A.src=[],re=A.t={};let J=0;const R=(W,q,P)=>{const ee=J++;$(ee,q),re[W]=ee,B[ee]=q,U[ee]=new RegExp(q,P?"g":void 0)};R("NUMERICIDENTIFIER","0|[1-9]\\d*"),R("NUMERICIDENTIFIERLOOSE","[0-9]+"),R("NONNUMERICIDENTIFIER","\\d*[a-zA-Z-][a-zA-Z0-9-]*"),R("MAINVERSION",`(${B[re.NUMERICIDENTIFIER]})\\.(${B[re.NUMERICIDENTIFIER]})\\.(${B[re.NUMERICIDENTIFIER]})`),R("MAINVERSIONLOOSE",`(${B[re.NUMERICIDENTIFIERLOOSE]})\\.(${B[re.NUMERICIDENTIFIERLOOSE]})\\.(${B[re.NUMERICIDENTIFIERLOOSE]})`),R("PRERELEASEIDENTIFIER",`(?:${B[re.NUMERICIDENTIFIER]}|${B[re.NONNUMERICIDENTIFIER]})`),R("PRERELEASEIDENTIFIERLOOSE",`(?:${B[re.NUMERICIDENTIFIERLOOSE]}|${B[re.NONNUMERICIDENTIFIER]})`),R("PRERELEASE",`(?:-(${B[re.PRERELEASEIDENTIFIER]}(?:\\.${B[re.PRERELEASEIDENTIFIER]})*))`),R("PRERELEASELOOSE",`(?:-?(${B[re.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${B[re.PRERELEASEIDENTIFIERLOOSE]})*))`),R("BUILDIDENTIFIER","[0-9A-Za-z-]+"),R("BUILD",`(?:\\+(${B[re.BUILDIDENTIFIER]}(?:\\.${B[re.BUILDIDENTIFIER]})*))`),R("FULLPLAIN",`v?${B[re.MAINVERSION]}${B[re.PRERELEASE]}?${B[re.BUILD]}?`),R("FULL",`^${B[re.FULLPLAIN]}$`),R("LOOSEPLAIN",`[v=\\s]*${B[re.MAINVERSIONLOOSE]}${B[re.PRERELEASELOOSE]}?${B[re.BUILD]}?`),R("LOOSE",`^${B[re.LOOSEPLAIN]}$`),R("GTLT","((?:<|>)?=?)"),R("XRANGEIDENTIFIERLOOSE",`${B[re.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),R("XRANGEIDENTIFIER",`${B[re.NUMERICIDENTIFIER]}|x|X|\\*`),R("XRANGEPLAIN",`[v=\\s]*(${B[re.XRANGEIDENTIFIER]})(?:\\.(${B[re.XRANGEIDENTIFIER]})(?:\\.(${B[re.XRANGEIDENTIFIER]})(?:${B[re.PRERELEASE]})?${B[re.BUILD]}?)?)?`),R("XRANGEPLAINLOOSE",`[v=\\s]*(${B[re.XRANGEIDENTIFIERLOOSE]})(?:\\.(${B[re.XRANGEIDENTIFIERLOOSE]})(?:\\.(${B[re.XRANGEIDENTIFIERLOOSE]})(?:${B[re.PRERELEASELOOSE]})?${B[re.BUILD]}?)?)?`),R("XRANGE",`^${B[re.GTLT]}\\s*${B[re.XRANGEPLAIN]}$`),R("XRANGELOOSE",`^${B[re.GTLT]}\\s*${B[re.XRANGEPLAINLOOSE]}$`),R("COERCE",`(^|[^\\d])(\\d{1,${b}})(?:\\.(\\d{1,${b}}))?(?:\\.(\\d{1,${b}}))?(?:$|[^\\d])`),R("COERCERTL",B[re.COERCE],!0),R("LONETILDE","(?:~>?)"),R("TILDETRIM",`(\\s*)${B[re.LONETILDE]}\\s+`,!0),A.tildeTrimReplace="$1~",R("TILDE",`^${B[re.LONETILDE]}${B[re.XRANGEPLAIN]}$`),R("TILDELOOSE",`^${B[re.LONETILDE]}${B[re.XRANGEPLAINLOOSE]}$`),R("LONECARET","(?:\\^)"),R("CARETTRIM",`(\\s*)${B[re.LONECARET]}\\s+`,!0),A.caretTrimReplace="$1^",R("CARET",`^${B[re.LONECARET]}${B[re.XRANGEPLAIN]}$`),R("CARETLOOSE",`^${B[re.LONECARET]}${B[re.XRANGEPLAINLOOSE]}$`),R("COMPARATORLOOSE",`^${B[re.GTLT]}\\s*(${B[re.LOOSEPLAIN]})$|^$`),R("COMPARATOR",`^${B[re.GTLT]}\\s*(${B[re.FULLPLAIN]})$|^$`),R("COMPARATORTRIM",`(\\s*)${B[re.GTLT]}\\s*(${B[re.LOOSEPLAIN]}|${B[re.XRANGEPLAIN]})`,!0),A.comparatorTrimReplace="$1$2$3",R("HYPHENRANGE",`^\\s*(${B[re.XRANGEPLAIN]})\\s+-\\s+(${B[re.XRANGEPLAIN]})\\s*$`),R("HYPHENRANGELOOSE",`^\\s*(${B[re.XRANGEPLAINLOOSE]})\\s+-\\s+(${B[re.XRANGEPLAINLOOSE]})\\s*$`),R("STAR","(<|>)?=?\\s*\\*"),R("GTE0","^\\s*>=\\s*0.0.0\\s*$"),R("GTE0PRE","^\\s*>=\\s*0.0.0-0\\s*$")},function(Oe,A,a){/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Object.defineProperty(A,"__esModule",{value:!0});var b=a(25),$=a(103),U=a(29),B=a(21),re=a(373),J=a(28);function R(P,ee,I,se){if(se==null&&(se=B.inferDtype(P)),se==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!B.isTypedArray(P)&&!Array.isArray(P)&&typeof P!="number"&&typeof P!="boolean"&&typeof P!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(ee!=null){B.assertNonNegativeIntegerDimensions(ee);var ie=B.sizeFromShape(ee),K=B.sizeFromShape(I);B.assert(ie===K,function(){return"Based on the provided shape, ["+ee+"], the tensor should have "+ie+" values but has "+K});for(var de=0;de<I.length;++de){var pe=I[de],Ae=de!==I.length-1||pe!==B.sizeFromShape(ee.slice(de));B.assert(I[de]===ee[de]||!Ae,function(){return"Error creating a new Tensor. Inferred shape ("+I+") does not match the provided shape ("+ee+"). "})}}return B.isTypedArray(P)||Array.isArray(P)||(P=[P]),ee=ee||I,P=se!=="string"?B.toTypedArray(P,se,$.env().getBool("DEBUG")):B.flatten(P,[],!0),b.ENGINE.makeTensor(P,ee,se)}function W(P,ee){B.assertNonNull(P);var I=U.inferShape(P,ee);if(I.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return R(P,null,I,ee)}function q(P,ee){if(ee===void 0&&(ee="float32"),ee==="complex64"){var I=q(P,"float32"),se=q(P,"float32");return re.complex(I,se)}var ie=B.makeZerosTypedArray(B.sizeFromShape(P),ee);return b.ENGINE.makeTensor(ie,P,ee)}A.tensor=function(P,ee,I){return R(P,ee,U.inferShape(P,I),I)},A.scalar=function(P,ee){if((B.isTypedArray(P)&&ee!=="string"||Array.isArray(P))&&ee!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(ee==="string"&&B.isTypedArray(P)&&!(P instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return R(P,[],[],ee)},A.tensor1d=W,A.tensor2d=function(P,ee,I){if(B.assertNonNull(P),ee!=null&&ee.length!==2)throw new Error("tensor2d() requires shape to have two numbers");var se=U.inferShape(P,I);if(se.length!==2&&se.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(se.length===1&&ee==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return R(P,ee,se,I)},A.tensor3d=function(P,ee,I){if(B.assertNonNull(P),ee!=null&&ee.length!==3)throw new Error("tensor3d() requires shape to have three numbers");var se=U.inferShape(P,I);if(se.length!==3&&se.length!==1)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(se.length===1&&ee==null)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return R(P,ee,se,I)},A.tensor4d=function(P,ee,I){if(B.assertNonNull(P),ee!=null&&ee.length!==4)throw new Error("tensor4d() requires shape to have four numbers");var se=U.inferShape(P,I);if(se.length!==4&&se.length!==1)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(se.length===1&&ee==null)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return R(P,ee,se,I)},A.tensor5d=function(P,ee,I){if(B.assertNonNull(P),ee!=null&&ee.length!==5)throw new Error("tensor5d() requires shape to have five numbers");var se=U.inferShape(P,I);if(se.length!==5&&se.length!==1)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(se.length===1&&ee==null)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return R(P,ee,se,I)},A.tensor6d=function(P,ee,I){if(B.assertNonNull(P),ee!=null&&ee.length!==6)throw new Error("tensor6d() requires shape to have six numbers");var se=U.inferShape(P,I);if(se.length!==6&&se.length!==1)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(se.length===1&&ee==null)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return R(P,ee=ee||se,se,I)},A.variable=function(P,ee,I,se){return ee===void 0&&(ee=!0),b.ENGINE.makeVariable(P,ee,I,se)},A.ones=function P(ee,I){if(I===void 0&&(I="float32"),I==="complex64"){var se=P(ee,"float32"),ie=q(ee,"float32");return re.complex(se,ie)}var K=B.makeOnesTypedArray(B.sizeFromShape(ee),I);return b.ENGINE.makeTensor(K,ee,I)},A.zeros=q,A.fill=function(P,ee,I){return b.ENGINE.runKernelFunc(function(se){return se.fill(P,ee,I)},{})},A.linspace=function(P,ee,I){if(I<=0)throw new Error("The number of values should be positive.");return b.ENGINE.runKernelFunc(function(se){return se.linspace(P,ee,I)},{})},A.range=function(P,ee,I,se){if(I===void 0&&(I=1),se===void 0&&(se="float32"),I===0)throw new Error("Cannot have a step of zero");if(P===ee||P<ee&&I<0||ee<P&&I>1)return q([0],se);var ie=Math.abs(Math.ceil((ee-P)/I)),K=B.makeZerosTypedArray(ie,se);ee<P&&I===1&&(I=-1),K[0]=P;for(var de=1;de<K.length;de++)K[de]=K[de-1]+I;return W(K,se)},A.onesLike=J.op({onesLike_:function(P){var ee=U.convertToTensor(P,"x","onesLike");if(ee.dtype==="complex64"){var I=A.onesLike(re.real(ee)),se=A.zerosLike(re.imag(ee));return re.complex(I,se)}return b.ENGINE.runKernelFunc(function(ie){return ie.onesLike(ee)},{x:ee},function(ie,K){return{x:function(){return A.zerosLike(ie)}}},"OnesLike")}}),A.zerosLike=J.op({zerosLike_:function(P){var ee=U.convertToTensor(P,"x","zerosLike");return b.ENGINE.runKernelFunc(function(I){return I.zerosLike(ee)},{x:ee},function(I,se){return{x:function(){return A.zerosLike(I)}}},"ZerosLike")}})},function(Oe,A,a){(function(b){/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <http://feross.org>
 * @license  MIT
 */var $=a(394),U=a(393),B=a(392);function re(){return R.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function J(Ve,Qe){if(re()<Qe)throw new RangeError("Invalid typed array length");return R.TYPED_ARRAY_SUPPORT?(Ve=new Uint8Array(Qe)).__proto__=R.prototype:(Ve===null&&(Ve=new R(Qe)),Ve.length=Qe),Ve}function R(Ve,Qe,He){if(!(R.TYPED_ARRAY_SUPPORT||this instanceof R))return new R(Ve,Qe,He);if(typeof Ve=="number"){if(typeof Qe=="string")throw new Error("If encoding is specified then the first argument must be a string");return P(this,Ve)}return W(this,Ve,Qe,He)}function W(Ve,Qe,He,pt){if(typeof Qe=="number")throw new TypeError('"value" argument must not be a number');return typeof ArrayBuffer<"u"&&Qe instanceof ArrayBuffer?function(Lt,zt,Tn,xn){if(zt.byteLength,Tn<0||zt.byteLength<Tn)throw new RangeError("'offset' is out of bounds");if(zt.byteLength<Tn+(xn||0))throw new RangeError("'length' is out of bounds");return zt=Tn===void 0&&xn===void 0?new Uint8Array(zt):xn===void 0?new Uint8Array(zt,Tn):new Uint8Array(zt,Tn,xn),R.TYPED_ARRAY_SUPPORT?(Lt=zt).__proto__=R.prototype:Lt=ee(Lt,zt),Lt}(Ve,Qe,He,pt):typeof Qe=="string"?function(Lt,zt,Tn){if(typeof Tn=="string"&&Tn!==""||(Tn="utf8"),!R.isEncoding(Tn))throw new TypeError('"encoding" must be a valid string encoding');var xn=0|se(zt,Tn),Kn=(Lt=J(Lt,xn)).write(zt,Tn);return Kn!==xn&&(Lt=Lt.slice(0,Kn)),Lt}(Ve,Qe,He):function(Lt,zt){if(R.isBuffer(zt)){var Tn=0|I(zt.length);return(Lt=J(Lt,Tn)).length===0||zt.copy(Lt,0,0,Tn),Lt}if(zt){if(typeof ArrayBuffer<"u"&&zt.buffer instanceof ArrayBuffer||"length"in zt)return typeof zt.length!="number"||function(xn){return xn!=xn}(zt.length)?J(Lt,0):ee(Lt,zt);if(zt.type==="Buffer"&&B(zt.data))return ee(Lt,zt.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(Ve,Qe)}function q(Ve){if(typeof Ve!="number")throw new TypeError('"size" argument must be a number');if(Ve<0)throw new RangeError('"size" argument must not be negative')}function P(Ve,Qe){if(q(Qe),Ve=J(Ve,Qe<0?0:0|I(Qe)),!R.TYPED_ARRAY_SUPPORT)for(var He=0;He<Qe;++He)Ve[He]=0;return Ve}function ee(Ve,Qe){var He=Qe.length<0?0:0|I(Qe.length);Ve=J(Ve,He);for(var pt=0;pt<He;pt+=1)Ve[pt]=255&Qe[pt];return Ve}function I(Ve){if(Ve>=re())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+re().toString(16)+" bytes");return 0|Ve}function se(Ve,Qe){if(R.isBuffer(Ve))return Ve.length;if(typeof ArrayBuffer<"u"&&typeof ArrayBuffer.isView=="function"&&(ArrayBuffer.isView(Ve)||Ve instanceof ArrayBuffer))return Ve.byteLength;typeof Ve!="string"&&(Ve=""+Ve);var He=Ve.length;if(He===0)return 0;for(var pt=!1;;)switch(Qe){case"ascii":case"latin1":case"binary":return He;case"utf8":case"utf-8":case void 0:return Bn(Ve).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*He;case"hex":return He>>>1;case"base64":return Hn(Ve).length;default:if(pt)return Bn(Ve).length;Qe=(""+Qe).toLowerCase(),pt=!0}}function ie(Ve,Qe,He){var pt=Ve[Qe];Ve[Qe]=Ve[He],Ve[He]=pt}function K(Ve,Qe,He,pt,Lt){if(Ve.length===0)return-1;if(typeof He=="string"?(pt=He,He=0):He>2147483647?He=2147483647:He<-2147483648&&(He=-2147483648),He=+He,isNaN(He)&&(He=Lt?0:Ve.length-1),He<0&&(He=Ve.length+He),He>=Ve.length){if(Lt)return-1;He=Ve.length-1}else if(He<0){if(!Lt)return-1;He=0}if(typeof Qe=="string"&&(Qe=R.from(Qe,pt)),R.isBuffer(Qe))return Qe.length===0?-1:de(Ve,Qe,He,pt,Lt);if(typeof Qe=="number")return Qe&=255,R.TYPED_ARRAY_SUPPORT&&typeof Uint8Array.prototype.indexOf=="function"?Lt?Uint8Array.prototype.indexOf.call(Ve,Qe,He):Uint8Array.prototype.lastIndexOf.call(Ve,Qe,He):de(Ve,[Qe],He,pt,Lt);throw new TypeError("val must be string, number or Buffer")}function de(Ve,Qe,He,pt,Lt){var zt,Tn=1,xn=Ve.length,Kn=Qe.length;if(pt!==void 0&&((pt=String(pt).toLowerCase())==="ucs2"||pt==="ucs-2"||pt==="utf16le"||pt==="utf-16le")){if(Ve.length<2||Qe.length<2)return-1;Tn=2,xn/=2,Kn/=2,He/=2}function be(Nr,Fr){return Tn===1?Nr[Fr]:Nr.readUInt16BE(Fr*Tn)}if(Lt){var Yn=-1;for(zt=He;zt<xn;zt++)if(be(Ve,zt)===be(Qe,Yn===-1?0:zt-Yn)){if(Yn===-1&&(Yn=zt),zt-Yn+1===Kn)return Yn*Tn}else Yn!==-1&&(zt-=zt-Yn),Yn=-1}else for(He+Kn>xn&&(He=xn-Kn),zt=He;zt>=0;zt--){for(var Dr=!0,pr=0;pr<Kn;pr++)if(be(Ve,zt+pr)!==be(Qe,pr)){Dr=!1;break}if(Dr)return zt}return-1}function pe(Ve,Qe,He,pt){He=Number(He)||0;var Lt=Ve.length-He;pt?(pt=Number(pt))>Lt&&(pt=Lt):pt=Lt;var zt=Qe.length;if(zt%2!=0)throw new TypeError("Invalid hex string");pt>zt/2&&(pt=zt/2);for(var Tn=0;Tn<pt;++Tn){var xn=parseInt(Qe.substr(2*Tn,2),16);if(isNaN(xn))return Tn;Ve[He+Tn]=xn}return Tn}function Ae(Ve,Qe,He,pt){return hn(Bn(Qe,Ve.length-He),Ve,He,pt)}function Te(Ve,Qe,He,pt){return hn(function(Lt){for(var zt=[],Tn=0;Tn<Lt.length;++Tn)zt.push(255&Lt.charCodeAt(Tn));return zt}(Qe),Ve,He,pt)}function je(Ve,Qe,He,pt){return Te(Ve,Qe,He,pt)}function we(Ve,Qe,He,pt){return hn(Hn(Qe),Ve,He,pt)}function ot(Ve,Qe,He,pt){return hn(function(Lt,zt){for(var Tn,xn,Kn,be=[],Yn=0;Yn<Lt.length&&!((zt-=2)<0);++Yn)Tn=Lt.charCodeAt(Yn),xn=Tn>>8,Kn=Tn%256,be.push(Kn),be.push(xn);return be}(Qe,Ve.length-He),Ve,He,pt)}function _t(Ve,Qe,He){return Qe===0&&He===Ve.length?$.fromByteArray(Ve):$.fromByteArray(Ve.slice(Qe,He))}function Ut(Ve,Qe,He){He=Math.min(Ve.length,He);for(var pt=[],Lt=Qe;Lt<He;){var zt,Tn,xn,Kn,be=Ve[Lt],Yn=null,Dr=be>239?4:be>223?3:be>191?2:1;if(Lt+Dr<=He)switch(Dr){case 1:be<128&&(Yn=be);break;case 2:(192&(zt=Ve[Lt+1]))==128&&(Kn=(31&be)<<6|63&zt)>127&&(Yn=Kn);break;case 3:zt=Ve[Lt+1],Tn=Ve[Lt+2],(192&zt)==128&&(192&Tn)==128&&(Kn=(15&be)<<12|(63&zt)<<6|63&Tn)>2047&&(Kn<55296||Kn>57343)&&(Yn=Kn);break;case 4:zt=Ve[Lt+1],Tn=Ve[Lt+2],xn=Ve[Lt+3],(192&zt)==128&&(192&Tn)==128&&(192&xn)==128&&(Kn=(15&be)<<18|(63&zt)<<12|(63&Tn)<<6|63&xn)>65535&&Kn<1114112&&(Yn=Kn)}Yn===null?(Yn=65533,Dr=1):Yn>65535&&(Yn-=65536,pt.push(Yn>>>10&1023|55296),Yn=56320|1023&Yn),pt.push(Yn),Lt+=Dr}return function(pr){var Nr=pr.length;if(Nr<=Xt)return String.fromCharCode.apply(String,pr);for(var Fr="",an=0;an<Nr;)Fr+=String.fromCharCode.apply(String,pr.slice(an,an+=Xt));return Fr}(pt)}A.Buffer=R,A.SlowBuffer=function(Ve){return+Ve!=Ve&&(Ve=0),R.alloc(+Ve)},A.INSPECT_MAX_BYTES=50,R.TYPED_ARRAY_SUPPORT=b.TYPED_ARRAY_SUPPORT!==void 0?b.TYPED_ARRAY_SUPPORT:function(){try{var Ve=new Uint8Array(1);return Ve.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},Ve.foo()===42&&typeof Ve.subarray=="function"&&Ve.subarray(1,1).byteLength===0}catch{return!1}}(),A.kMaxLength=re(),R.poolSize=8192,R._augment=function(Ve){return Ve.__proto__=R.prototype,Ve},R.from=function(Ve,Qe,He){return W(null,Ve,Qe,He)},R.TYPED_ARRAY_SUPPORT&&(R.prototype.__proto__=Uint8Array.prototype,R.__proto__=Uint8Array,typeof Symbol<"u"&&Symbol.species&&R[Symbol.species]===R&&Object.defineProperty(R,Symbol.species,{value:null,configurable:!0})),R.alloc=function(Ve,Qe,He){return function(pt,Lt,zt,Tn){return q(Lt),Lt<=0?J(pt,Lt):zt!==void 0?typeof Tn=="string"?J(pt,Lt).fill(zt,Tn):J(pt,Lt).fill(zt):J(pt,Lt)}(null,Ve,Qe,He)},R.allocUnsafe=function(Ve){return P(null,Ve)},R.allocUnsafeSlow=function(Ve){return P(null,Ve)},R.isBuffer=function(Ve){return!(Ve==null||!Ve._isBuffer)},R.compare=function(Ve,Qe){if(!R.isBuffer(Ve)||!R.isBuffer(Qe))throw new TypeError("Arguments must be Buffers");if(Ve===Qe)return 0;for(var He=Ve.length,pt=Qe.length,Lt=0,zt=Math.min(He,pt);Lt<zt;++Lt)if(Ve[Lt]!==Qe[Lt]){He=Ve[Lt],pt=Qe[Lt];break}return He<pt?-1:pt<He?1:0},R.isEncoding=function(Ve){switch(String(Ve).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},R.concat=function(Ve,Qe){if(!B(Ve))throw new TypeError('"list" argument must be an Array of Buffers');if(Ve.length===0)return R.alloc(0);var He;if(Qe===void 0)for(Qe=0,He=0;He<Ve.length;++He)Qe+=Ve[He].length;var pt=R.allocUnsafe(Qe),Lt=0;for(He=0;He<Ve.length;++He){var zt=Ve[He];if(!R.isBuffer(zt))throw new TypeError('"list" argument must be an Array of Buffers');zt.copy(pt,Lt),Lt+=zt.length}return pt},R.byteLength=se,R.prototype._isBuffer=!0,R.prototype.swap16=function(){var Ve=this.length;if(Ve%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var Qe=0;Qe<Ve;Qe+=2)ie(this,Qe,Qe+1);return this},R.prototype.swap32=function(){var Ve=this.length;if(Ve%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var Qe=0;Qe<Ve;Qe+=4)ie(this,Qe,Qe+3),ie(this,Qe+1,Qe+2);return this},R.prototype.swap64=function(){var Ve=this.length;if(Ve%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var Qe=0;Qe<Ve;Qe+=8)ie(this,Qe,Qe+7),ie(this,Qe+1,Qe+6),ie(this,Qe+2,Qe+5),ie(this,Qe+3,Qe+4);return this},R.prototype.toString=function(){var Ve=0|this.length;return Ve===0?"":arguments.length===0?Ut(this,0,Ve):function(Qe,He,pt){var Lt=!1;if((He===void 0||He<0)&&(He=0),He>this.length||((pt===void 0||pt>this.length)&&(pt=this.length),pt<=0)||(pt>>>=0)<=(He>>>=0))return"";for(Qe||(Qe="utf8");;)switch(Qe){case"hex":return Gt(this,He,pt);case"utf8":case"utf-8":return Ut(this,He,pt);case"ascii":return ke(this,He,pt);case"latin1":case"binary":return Ft(this,He,pt);case"base64":return _t(this,He,pt);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return jt(this,He,pt);default:if(Lt)throw new TypeError("Unknown encoding: "+Qe);Qe=(Qe+"").toLowerCase(),Lt=!0}}.apply(this,arguments)},R.prototype.equals=function(Ve){if(!R.isBuffer(Ve))throw new TypeError("Argument must be a Buffer");return this===Ve||R.compare(this,Ve)===0},R.prototype.inspect=function(){var Ve="",Qe=A.INSPECT_MAX_BYTES;return this.length>0&&(Ve=this.toString("hex",0,Qe).match(/.{2}/g).join(" "),this.length>Qe&&(Ve+=" ... ")),"<Buffer "+Ve+">"},R.prototype.compare=function(Ve,Qe,He,pt,Lt){if(!R.isBuffer(Ve))throw new TypeError("Argument must be a Buffer");if(Qe===void 0&&(Qe=0),He===void 0&&(He=Ve?Ve.length:0),pt===void 0&&(pt=0),Lt===void 0&&(Lt=this.length),Qe<0||He>Ve.length||pt<0||Lt>this.length)throw new RangeError("out of range index");if(pt>=Lt&&Qe>=He)return 0;if(pt>=Lt)return-1;if(Qe>=He)return 1;if(Qe>>>=0,He>>>=0,pt>>>=0,Lt>>>=0,this===Ve)return 0;for(var zt=Lt-pt,Tn=He-Qe,xn=Math.min(zt,Tn),Kn=this.slice(pt,Lt),be=Ve.slice(Qe,He),Yn=0;Yn<xn;++Yn)if(Kn[Yn]!==be[Yn]){zt=Kn[Yn],Tn=be[Yn];break}return zt<Tn?-1:Tn<zt?1:0},R.prototype.includes=function(Ve,Qe,He){return this.indexOf(Ve,Qe,He)!==-1},R.prototype.indexOf=function(Ve,Qe,He){return K(this,Ve,Qe,He,!0)},R.prototype.lastIndexOf=function(Ve,Qe,He){return K(this,Ve,Qe,He,!1)},R.prototype.write=function(Ve,Qe,He,pt){if(Qe===void 0)pt="utf8",He=this.length,Qe=0;else if(He===void 0&&typeof Qe=="string")pt=Qe,He=this.length,Qe=0;else{if(!isFinite(Qe))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");Qe|=0,isFinite(He)?(He|=0,pt===void 0&&(pt="utf8")):(pt=He,He=void 0)}var Lt=this.length-Qe;if((He===void 0||He>Lt)&&(He=Lt),Ve.length>0&&(He<0||Qe<0)||Qe>this.length)throw new RangeError("Attempt to write outside buffer bounds");pt||(pt="utf8");for(var zt=!1;;)switch(pt){case"hex":return pe(this,Ve,Qe,He);case"utf8":case"utf-8":return Ae(this,Ve,Qe,He);case"ascii":return Te(this,Ve,Qe,He);case"latin1":case"binary":return je(this,Ve,Qe,He);case"base64":return we(this,Ve,Qe,He);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ot(this,Ve,Qe,He);default:if(zt)throw new TypeError("Unknown encoding: "+pt);pt=(""+pt).toLowerCase(),zt=!0}},R.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var Xt=4096;function ke(Ve,Qe,He){var pt="";He=Math.min(Ve.length,He);for(var Lt=Qe;Lt<He;++Lt)pt+=String.fromCharCode(127&Ve[Lt]);return pt}function Ft(Ve,Qe,He){var pt="";He=Math.min(Ve.length,He);for(var Lt=Qe;Lt<He;++Lt)pt+=String.fromCharCode(Ve[Lt]);return pt}function Gt(Ve,Qe,He){var pt=Ve.length;(!Qe||Qe<0)&&(Qe=0),(!He||He<0||He>pt)&&(He=pt);for(var Lt="",zt=Qe;zt<He;++zt)Lt+=wn(Ve[zt]);return Lt}function jt(Ve,Qe,He){for(var pt=Ve.slice(Qe,He),Lt="",zt=0;zt<pt.length;zt+=2)Lt+=String.fromCharCode(pt[zt]+256*pt[zt+1]);return Lt}function Ye(Ve,Qe,He){if(Ve%1!=0||Ve<0)throw new RangeError("offset is not uint");if(Ve+Qe>He)throw new RangeError("Trying to access beyond buffer length")}function ln(Ve,Qe,He,pt,Lt,zt){if(!R.isBuffer(Ve))throw new TypeError('"buffer" argument must be a Buffer instance');if(Qe>Lt||Qe<zt)throw new RangeError('"value" argument is out of bounds');if(He+pt>Ve.length)throw new RangeError("Index out of range")}function nn(Ve,Qe,He,pt){Qe<0&&(Qe=65535+Qe+1);for(var Lt=0,zt=Math.min(Ve.length-He,2);Lt<zt;++Lt)Ve[He+Lt]=(Qe&255<<8*(pt?Lt:1-Lt))>>>8*(pt?Lt:1-Lt)}function Bt(Ve,Qe,He,pt){Qe<0&&(Qe=4294967295+Qe+1);for(var Lt=0,zt=Math.min(Ve.length-He,4);Lt<zt;++Lt)Ve[He+Lt]=Qe>>>8*(pt?Lt:3-Lt)&255}function Pt(Ve,Qe,He,pt,Lt,zt){if(He+pt>Ve.length)throw new RangeError("Index out of range");if(He<0)throw new RangeError("Index out of range")}function gn(Ve,Qe,He,pt,Lt){return Lt||Pt(Ve,0,He,4),U.write(Ve,Qe,He,pt,23,4),He+4}function Dt(Ve,Qe,He,pt,Lt){return Lt||Pt(Ve,0,He,8),U.write(Ve,Qe,He,pt,52,8),He+8}R.prototype.slice=function(Ve,Qe){var He,pt=this.length;if(Ve=~~Ve,Qe=Qe===void 0?pt:~~Qe,Ve<0?(Ve+=pt)<0&&(Ve=0):Ve>pt&&(Ve=pt),Qe<0?(Qe+=pt)<0&&(Qe=0):Qe>pt&&(Qe=pt),Qe<Ve&&(Qe=Ve),R.TYPED_ARRAY_SUPPORT)(He=this.subarray(Ve,Qe)).__proto__=R.prototype;else{var Lt=Qe-Ve;He=new R(Lt,void 0);for(var zt=0;zt<Lt;++zt)He[zt]=this[zt+Ve]}return He},R.prototype.readUIntLE=function(Ve,Qe,He){Ve|=0,Qe|=0,He||Ye(Ve,Qe,this.length);for(var pt=this[Ve],Lt=1,zt=0;++zt<Qe&&(Lt*=256);)pt+=this[Ve+zt]*Lt;return pt},R.prototype.readUIntBE=function(Ve,Qe,He){Ve|=0,Qe|=0,He||Ye(Ve,Qe,this.length);for(var pt=this[Ve+--Qe],Lt=1;Qe>0&&(Lt*=256);)pt+=this[Ve+--Qe]*Lt;return pt},R.prototype.readUInt8=function(Ve,Qe){return Qe||Ye(Ve,1,this.length),this[Ve]},R.prototype.readUInt16LE=function(Ve,Qe){return Qe||Ye(Ve,2,this.length),this[Ve]|this[Ve+1]<<8},R.prototype.readUInt16BE=function(Ve,Qe){return Qe||Ye(Ve,2,this.length),this[Ve]<<8|this[Ve+1]},R.prototype.readUInt32LE=function(Ve,Qe){return Qe||Ye(Ve,4,this.length),(this[Ve]|this[Ve+1]<<8|this[Ve+2]<<16)+16777216*this[Ve+3]},R.prototype.readUInt32BE=function(Ve,Qe){return Qe||Ye(Ve,4,this.length),16777216*this[Ve]+(this[Ve+1]<<16|this[Ve+2]<<8|this[Ve+3])},R.prototype.readIntLE=function(Ve,Qe,He){Ve|=0,Qe|=0,He||Ye(Ve,Qe,this.length);for(var pt=this[Ve],Lt=1,zt=0;++zt<Qe&&(Lt*=256);)pt+=this[Ve+zt]*Lt;return pt>=(Lt*=128)&&(pt-=Math.pow(2,8*Qe)),pt},R.prototype.readIntBE=function(Ve,Qe,He){Ve|=0,Qe|=0,He||Ye(Ve,Qe,this.length);for(var pt=Qe,Lt=1,zt=this[Ve+--pt];pt>0&&(Lt*=256);)zt+=this[Ve+--pt]*Lt;return zt>=(Lt*=128)&&(zt-=Math.pow(2,8*Qe)),zt},R.prototype.readInt8=function(Ve,Qe){return Qe||Ye(Ve,1,this.length),128&this[Ve]?-1*(255-this[Ve]+1):this[Ve]},R.prototype.readInt16LE=function(Ve,Qe){Qe||Ye(Ve,2,this.length);var He=this[Ve]|this[Ve+1]<<8;return 32768&He?4294901760|He:He},R.prototype.readInt16BE=function(Ve,Qe){Qe||Ye(Ve,2,this.length);var He=this[Ve+1]|this[Ve]<<8;return 32768&He?4294901760|He:He},R.prototype.readInt32LE=function(Ve,Qe){return Qe||Ye(Ve,4,this.length),this[Ve]|this[Ve+1]<<8|this[Ve+2]<<16|this[Ve+3]<<24},R.prototype.readInt32BE=function(Ve,Qe){return Qe||Ye(Ve,4,this.length),this[Ve]<<24|this[Ve+1]<<16|this[Ve+2]<<8|this[Ve+3]},R.prototype.readFloatLE=function(Ve,Qe){return Qe||Ye(Ve,4,this.length),U.read(this,Ve,!0,23,4)},R.prototype.readFloatBE=function(Ve,Qe){return Qe||Ye(Ve,4,this.length),U.read(this,Ve,!1,23,4)},R.prototype.readDoubleLE=function(Ve,Qe){return Qe||Ye(Ve,8,this.length),U.read(this,Ve,!0,52,8)},R.prototype.readDoubleBE=function(Ve,Qe){return Qe||Ye(Ve,8,this.length),U.read(this,Ve,!1,52,8)},R.prototype.writeUIntLE=function(Ve,Qe,He,pt){Ve=+Ve,Qe|=0,He|=0,pt||ln(this,Ve,Qe,He,Math.pow(2,8*He)-1,0);var Lt=1,zt=0;for(this[Qe]=255&Ve;++zt<He&&(Lt*=256);)this[Qe+zt]=Ve/Lt&255;return Qe+He},R.prototype.writeUIntBE=function(Ve,Qe,He,pt){Ve=+Ve,Qe|=0,He|=0,pt||ln(this,Ve,Qe,He,Math.pow(2,8*He)-1,0);var Lt=He-1,zt=1;for(this[Qe+Lt]=255&Ve;--Lt>=0&&(zt*=256);)this[Qe+Lt]=Ve/zt&255;return Qe+He},R.prototype.writeUInt8=function(Ve,Qe,He){return Ve=+Ve,Qe|=0,He||ln(this,Ve,Qe,1,255,0),R.TYPED_ARRAY_SUPPORT||(Ve=Math.floor(Ve)),this[Qe]=255&Ve,Qe+1},R.prototype.writeUInt16LE=function(Ve,Qe,He){return Ve=+Ve,Qe|=0,He||ln(this,Ve,Qe,2,65535,0),R.TYPED_ARRAY_SUPPORT?(this[Qe]=255&Ve,this[Qe+1]=Ve>>>8):nn(this,Ve,Qe,!0),Qe+2},R.prototype.writeUInt16BE=function(Ve,Qe,He){return Ve=+Ve,Qe|=0,He||ln(this,Ve,Qe,2,65535,0),R.TYPED_ARRAY_SUPPORT?(this[Qe]=Ve>>>8,this[Qe+1]=255&Ve):nn(this,Ve,Qe,!1),Qe+2},R.prototype.writeUInt32LE=function(Ve,Qe,He){return Ve=+Ve,Qe|=0,He||ln(this,Ve,Qe,4,4294967295,0),R.TYPED_ARRAY_SUPPORT?(this[Qe+3]=Ve>>>24,this[Qe+2]=Ve>>>16,this[Qe+1]=Ve>>>8,this[Qe]=255&Ve):Bt(this,Ve,Qe,!0),Qe+4},R.prototype.writeUInt32BE=function(Ve,Qe,He){return Ve=+Ve,Qe|=0,He||ln(this,Ve,Qe,4,4294967295,0),R.TYPED_ARRAY_SUPPORT?(this[Qe]=Ve>>>24,this[Qe+1]=Ve>>>16,this[Qe+2]=Ve>>>8,this[Qe+3]=255&Ve):Bt(this,Ve,Qe,!1),Qe+4},R.prototype.writeIntLE=function(Ve,Qe,He,pt){if(Ve=+Ve,Qe|=0,!pt){var Lt=Math.pow(2,8*He-1);ln(this,Ve,Qe,He,Lt-1,-Lt)}var zt=0,Tn=1,xn=0;for(this[Qe]=255&Ve;++zt<He&&(Tn*=256);)Ve<0&&xn===0&&this[Qe+zt-1]!==0&&(xn=1),this[Qe+zt]=(Ve/Tn>>0)-xn&255;return Qe+He},R.prototype.writeIntBE=function(Ve,Qe,He,pt){if(Ve=+Ve,Qe|=0,!pt){var Lt=Math.pow(2,8*He-1);ln(this,Ve,Qe,He,Lt-1,-Lt)}var zt=He-1,Tn=1,xn=0;for(this[Qe+zt]=255&Ve;--zt>=0&&(Tn*=256);)Ve<0&&xn===0&&this[Qe+zt+1]!==0&&(xn=1),this[Qe+zt]=(Ve/Tn>>0)-xn&255;return Qe+He},R.prototype.writeInt8=function(Ve,Qe,He){return Ve=+Ve,Qe|=0,He||ln(this,Ve,Qe,1,127,-128),R.TYPED_ARRAY_SUPPORT||(Ve=Math.floor(Ve)),Ve<0&&(Ve=255+Ve+1),this[Qe]=255&Ve,Qe+1},R.prototype.writeInt16LE=function(Ve,Qe,He){return Ve=+Ve,Qe|=0,He||ln(this,Ve,Qe,2,32767,-32768),R.TYPED_ARRAY_SUPPORT?(this[Qe]=255&Ve,this[Qe+1]=Ve>>>8):nn(this,Ve,Qe,!0),Qe+2},R.prototype.writeInt16BE=function(Ve,Qe,He){return Ve=+Ve,Qe|=0,He||ln(this,Ve,Qe,2,32767,-32768),R.TYPED_ARRAY_SUPPORT?(this[Qe]=Ve>>>8,this[Qe+1]=255&Ve):nn(this,Ve,Qe,!1),Qe+2},R.prototype.writeInt32LE=function(Ve,Qe,He){return Ve=+Ve,Qe|=0,He||ln(this,Ve,Qe,4,2147483647,-2147483648),R.TYPED_ARRAY_SUPPORT?(this[Qe]=255&Ve,this[Qe+1]=Ve>>>8,this[Qe+2]=Ve>>>16,this[Qe+3]=Ve>>>24):Bt(this,Ve,Qe,!0),Qe+4},R.prototype.writeInt32BE=function(Ve,Qe,He){return Ve=+Ve,Qe|=0,He||ln(this,Ve,Qe,4,2147483647,-2147483648),Ve<0&&(Ve=4294967295+Ve+1),R.TYPED_ARRAY_SUPPORT?(this[Qe]=Ve>>>24,this[Qe+1]=Ve>>>16,this[Qe+2]=Ve>>>8,this[Qe+3]=255&Ve):Bt(this,Ve,Qe,!1),Qe+4},R.prototype.writeFloatLE=function(Ve,Qe,He){return gn(this,Ve,Qe,!0,He)},R.prototype.writeFloatBE=function(Ve,Qe,He){return gn(this,Ve,Qe,!1,He)},R.prototype.writeDoubleLE=function(Ve,Qe,He){return Dt(this,Ve,Qe,!0,He)},R.prototype.writeDoubleBE=function(Ve,Qe,He){return Dt(this,Ve,Qe,!1,He)},R.prototype.copy=function(Ve,Qe,He,pt){if(He||(He=0),pt||pt===0||(pt=this.length),Qe>=Ve.length&&(Qe=Ve.length),Qe||(Qe=0),pt>0&&pt<He&&(pt=He),pt===He||Ve.length===0||this.length===0)return 0;if(Qe<0)throw new RangeError("targetStart out of bounds");if(He<0||He>=this.length)throw new RangeError("sourceStart out of bounds");if(pt<0)throw new RangeError("sourceEnd out of bounds");pt>this.length&&(pt=this.length),Ve.length-Qe<pt-He&&(pt=Ve.length-Qe+He);var Lt,zt=pt-He;if(this===Ve&&He<Qe&&Qe<pt)for(Lt=zt-1;Lt>=0;--Lt)Ve[Lt+Qe]=this[Lt+He];else if(zt<1e3||!R.TYPED_ARRAY_SUPPORT)for(Lt=0;Lt<zt;++Lt)Ve[Lt+Qe]=this[Lt+He];else Uint8Array.prototype.set.call(Ve,this.subarray(He,He+zt),Qe);return zt},R.prototype.fill=function(Ve,Qe,He,pt){if(typeof Ve=="string"){if(typeof Qe=="string"?(pt=Qe,Qe=0,He=this.length):typeof He=="string"&&(pt=He,He=this.length),Ve.length===1){var Lt=Ve.charCodeAt(0);Lt<256&&(Ve=Lt)}if(pt!==void 0&&typeof pt!="string")throw new TypeError("encoding must be a string");if(typeof pt=="string"&&!R.isEncoding(pt))throw new TypeError("Unknown encoding: "+pt)}else typeof Ve=="number"&&(Ve&=255);if(Qe<0||this.length<Qe||this.length<He)throw new RangeError("Out of range index");if(He<=Qe)return this;var zt;if(Qe>>>=0,He=He===void 0?this.length:He>>>0,Ve||(Ve=0),typeof Ve=="number")for(zt=Qe;zt<He;++zt)this[zt]=Ve;else{var Tn=R.isBuffer(Ve)?Ve:Bn(new R(Ve,pt).toString()),xn=Tn.length;for(zt=0;zt<He-Qe;++zt)this[zt+Qe]=Tn[zt%xn]}return this};var St=/[^+\/0-9A-Za-z-_]/g;function wn(Ve){return Ve<16?"0"+Ve.toString(16):Ve.toString(16)}function Bn(Ve,Qe){var He;Qe=Qe||1/0;for(var pt=Ve.length,Lt=null,zt=[],Tn=0;Tn<pt;++Tn){if((He=Ve.charCodeAt(Tn))>55295&&He<57344){if(!Lt){if(He>56319){(Qe-=3)>-1&&zt.push(239,191,189);continue}if(Tn+1===pt){(Qe-=3)>-1&&zt.push(239,191,189);continue}Lt=He;continue}if(He<56320){(Qe-=3)>-1&&zt.push(239,191,189),Lt=He;continue}He=65536+(Lt-55296<<10|He-56320)}else Lt&&(Qe-=3)>-1&&zt.push(239,191,189);if(Lt=null,He<128){if((Qe-=1)<0)break;zt.push(He)}else if(He<2048){if((Qe-=2)<0)break;zt.push(He>>6|192,63&He|128)}else if(He<65536){if((Qe-=3)<0)break;zt.push(He>>12|224,He>>6&63|128,63&He|128)}else{if(!(He<1114112))throw new Error("Invalid code point");if((Qe-=4)<0)break;zt.push(He>>18|240,He>>12&63|128,He>>6&63|128,63&He|128)}}return zt}function Hn(Ve){return $.toByteArray(function(Qe){if((Qe=function(He){return He.trim?He.trim():He.replace(/^\s+|\s+$/g,"")}(Qe).replace(St,"")).length<2)return"";for(;Qe.length%4!=0;)Qe+="=";return Qe}(Ve))}function hn(Ve,Qe,He,pt){for(var Lt=0;Lt<pt&&!(Lt+He>=Qe.length||Lt>=Ve.length);++Lt)Qe[Lt+He]=Ve[Lt];return Lt}}).call(this,a(59))},function(Oe,A,a){var b=a(38);Oe.exports=function($,U,B){for(var re in U)b($,re,U[re],B);return $}},function(Oe,A){Oe.exports=function(a,b,$,U){if(!(a instanceof b)||U!==void 0&&U in a)throw TypeError($+": incorrect invocation!");return a}},function(Oe,A,a){var b=a(16),$=a(26),U=a(27),B=a(19)("species");Oe.exports=function(re){var J=b[re];U&&J&&!J[B]&&$.f(J,B,{configurable:!0,get:function(){return this}})}},function(Oe,A){Oe.exports={}},function(Oe,A,a){var b=a(8),$=a(61),U=a(15),B=a(169),re="["+B+"]",J=RegExp("^"+re+re+"*"),R=RegExp(re+re+"*$"),W=function(P,ee,I){var se={},ie=U(function(){return!!B[P]()||""[P]()!=""}),K=se[P]=ie?ee(q):B[P];I&&(se[I]=K),b(b.P+b.F*ie,"String",se)},q=W.trim=function(P,ee){return P=String($(P)),1&ee&&(P=P.replace(J,"")),2&ee&&(P=P.replace(R,"")),P};Oe.exports=W},function(Oe,A,a){var b=a(26).f,$=a(43),U=a(19)("toStringTag");Oe.exports=function(B,re,J){B&&!$(B=J?B:B.prototype,U)&&b(B,U,{configurable:!0,value:re})}},function(Oe,A,a){var b,$=typeof Reflect=="object"?Reflect:null,U=$&&typeof $.apply=="function"?$.apply:function(K,de,pe){return Function.prototype.apply.call(K,de,pe)};b=$&&typeof $.ownKeys=="function"?$.ownKeys:Object.getOwnPropertySymbols?function(K){return Object.getOwnPropertyNames(K).concat(Object.getOwnPropertySymbols(K))}:function(K){return Object.getOwnPropertyNames(K)};var B=Number.isNaN||function(K){return K!=K};function re(){re.init.call(this)}Oe.exports=re,Oe.exports.once=function(K,de){return new Promise(function(pe,Ae){function Te(we){K.removeListener(de,je),Ae(we)}function je(){typeof K.removeListener=="function"&&K.removeListener("error",Te),pe([].slice.call(arguments))}ie(K,de,je,{once:!0}),de!=="error"&&function(we,ot,_t){typeof we.on=="function"&&ie(we,"error",ot,_t)}(K,Te,{once:!0})})},re.EventEmitter=re,re.prototype._events=void 0,re.prototype._eventsCount=0,re.prototype._maxListeners=void 0;var J=10;function R(K){if(typeof K!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof K)}function W(K){return K._maxListeners===void 0?re.defaultMaxListeners:K._maxListeners}function q(K,de,pe,Ae){var Te,je,we;if(R(pe),(je=K._events)===void 0?(je=K._events=Object.create(null),K._eventsCount=0):(je.newListener!==void 0&&(K.emit("newListener",de,pe.listener?pe.listener:pe),je=K._events),we=je[de]),we===void 0)we=je[de]=pe,++K._eventsCount;else if(typeof we=="function"?we=je[de]=Ae?[pe,we]:[we,pe]:Ae?we.unshift(pe):we.push(pe),(Te=W(K))>0&&we.length>Te&&!we.warned){we.warned=!0;var ot=new Error("Possible EventEmitter memory leak detected. "+we.length+" "+String(de)+" listeners added. Use emitter.setMaxListeners() to increase limit");ot.name="MaxListenersExceededWarning",ot.emitter=K,ot.type=de,ot.count=we.length,function(_t){console&&console.warn&&console.warn(_t)}(ot)}return K}function P(K,de,pe){var Ae={fired:!1,wrapFn:void 0,target:K,type:de,listener:pe},Te=function(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}.bind(Ae);return Te.listener=pe,Ae.wrapFn=Te,Te}function ee(K,de,pe){var Ae=K._events;if(Ae===void 0)return[];var Te=Ae[de];return Te===void 0?[]:typeof Te=="function"?pe?[Te.listener||Te]:[Te]:pe?function(je){for(var we=new Array(je.length),ot=0;ot<we.length;++ot)we[ot]=je[ot].listener||je[ot];return we}(Te):se(Te,Te.length)}function I(K){var de=this._events;if(de!==void 0){var pe=de[K];if(typeof pe=="function")return 1;if(pe!==void 0)return pe.length}return 0}function se(K,de){for(var pe=new Array(de),Ae=0;Ae<de;++Ae)pe[Ae]=K[Ae];return pe}function ie(K,de,pe,Ae){if(typeof K.on=="function")Ae.once?K.once(de,pe):K.on(de,pe);else{if(typeof K.addEventListener!="function")throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof K);K.addEventListener(de,function Te(je){Ae.once&&K.removeEventListener(de,Te),pe(je)})}}Object.defineProperty(re,"defaultMaxListeners",{enumerable:!0,get:function(){return J},set:function(K){if(typeof K!="number"||K<0||B(K))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+K+".");J=K}}),re.init=function(){this._events!==void 0&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},re.prototype.setMaxListeners=function(K){if(typeof K!="number"||K<0||B(K))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+K+".");return this._maxListeners=K,this},re.prototype.getMaxListeners=function(){return W(this)},re.prototype.emit=function(K){for(var de=[],pe=1;pe<arguments.length;pe++)de.push(arguments[pe]);var Ae=K==="error",Te=this._events;if(Te!==void 0)Ae=Ae&&Te.error===void 0;else if(!Ae)return!1;if(Ae){var je;if(de.length>0&&(je=de[0]),je instanceof Error)throw je;var we=new Error("Unhandled error."+(je?" ("+je.message+")":""));throw we.context=je,we}var ot=Te[K];if(ot===void 0)return!1;if(typeof ot=="function")U(ot,this,de);else{var _t=ot.length,Ut=se(ot,_t);for(pe=0;pe<_t;++pe)U(Ut[pe],this,de)}return!0},re.prototype.addListener=function(K,de){return q(this,K,de,!1)},re.prototype.on=re.prototype.addListener,re.prototype.prependListener=function(K,de){return q(this,K,de,!0)},re.prototype.once=function(K,de){return R(de),this.on(K,P(this,K,de)),this},re.prototype.prependOnceListener=function(K,de){return R(de),this.prependListener(K,P(this,K,de)),this},re.prototype.removeListener=function(K,de){var pe,Ae,Te,je,we;if(R(de),(Ae=this._events)===void 0)return this;if((pe=Ae[K])===void 0)return this;if(pe===de||pe.listener===de)--this._eventsCount==0?this._events=Object.create(null):(delete Ae[K],Ae.removeListener&&this.emit("removeListener",K,pe.listener||de));else if(typeof pe!="function"){for(Te=-1,je=pe.length-1;je>=0;je--)if(pe[je]===de||pe[je].listener===de){we=pe[je].listener,Te=je;break}if(Te<0)return this;Te===0?pe.shift():function(ot,_t){for(;_t+1<ot.length;_t++)ot[_t]=ot[_t+1];ot.pop()}(pe,Te),pe.length===1&&(Ae[K]=pe[0]),Ae.removeListener!==void 0&&this.emit("removeListener",K,we||de)}return this},re.prototype.off=re.prototype.removeListener,re.prototype.removeAllListeners=function(K){var de,pe,Ae;if((pe=this._events)===void 0)return this;if(pe.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):pe[K]!==void 0&&(--this._eventsCount==0?this._events=Object.create(null):delete pe[K]),this;if(arguments.length===0){var Te,je=Object.keys(pe);for(Ae=0;Ae<je.length;++Ae)(Te=je[Ae])!=="removeListener"&&this.removeAllListeners(Te);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(typeof(de=pe[K])=="function")this.removeListener(K,de);else if(de!==void 0)for(Ae=de.length-1;Ae>=0;Ae--)this.removeListener(K,de[Ae]);return this},re.prototype.listeners=function(K){return ee(this,K,!0)},re.prototype.rawListeners=function(K){return ee(this,K,!1)},re.listenerCount=function(K,de){return typeof K.listenerCount=="function"?K.listenerCount(de):I.call(K,de)},re.prototype.listenerCount=I,re.prototype.eventNames=function(){return this._eventsCount>0?b(this._events):[]}},function(Oe,A,a){a.d(A,"a",function(){return $}),a.d(A,"b",function(){return U}),a.d(A,"c",function(){return B}),a.d(A,"d",function(){return re});var b,$,U,B,re,J=a(246);(function(R){b=Object(J.a)(R),$=b.format,U=b.parse,B=b.utcFormat,re=b.utcParse})({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]})},function(Oe,A,a){Object.defineProperty(A,"__esModule",{value:!0}),A.default=function($){return typeof $=="string"&&b.test($)};var b=/-webkit-|-moz-|-ms-/;Oe.exports=A.default},function(Oe,A,a){Object.defineProperty(A,"__esModule",{value:!0}),A.compose=A.merge=A.$=A.style=A.presets=A.keyframes=A.fontFace=A.insertGlobal=A.insertRule=A.plugins=A.styleSheet=void 0,A.speedy=function(He){return q.speedy(He)},A.simulations=function(){var He=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];ie=!!He},A.simulate=function(){for(var He=arguments.length,pt=Array(He),Lt=0;Lt<He;Lt++)pt[Lt]=arguments[Lt];return(pt=(0,B.default)(pt))?ie?pt.reduce(function(zt,Tn){return zt["data-simulate-"+Ae(Tn)]="",zt},{}):(K||(console.warn("can't simulate without once calling simulations(true)"),K=!0),ee||I||de||(console.warn("don't use simulation outside dev"),de=!0),{}):{}},A.cssLabels=function(He){pe=!!He},A.isLikeRule=je,A.idFor=we,A.css=Hn,A.rehydrate=function(He){(0,b.default)(Gt,He.reduce(function(pt,Lt){return pt[Lt]=!0,pt},{}))},A.flush=function(){Gt=q.inserted={},jt=q.registered={},ln={},q.flush(),q.inject()},A.select=Ve,A.parent=function(He){for(var pt=arguments.length,Lt=Array(pt>1?pt-1:0),zt=1;zt<pt;zt++)Lt[zt-1]=arguments[zt];return Hn(W({},He+" &",Lt))},A.media=function(He){for(var pt=arguments.length,Lt=Array(pt>1?pt-1:0),zt=1;zt<pt;zt++)Lt[zt-1]=arguments[zt];return Hn(W({},"@media "+He,Lt))},A.pseudo=Qe,A.active=function(He){return Qe(":active",He)},A.any=function(He){return Qe(":any",He)},A.checked=function(He){return Qe(":checked",He)},A.disabled=function(He){return Qe(":disabled",He)},A.empty=function(He){return Qe(":empty",He)},A.enabled=function(He){return Qe(":enabled",He)},A._default=function(He){return Qe(":default",He)},A.first=function(He){return Qe(":first",He)},A.firstChild=function(He){return Qe(":first-child",He)},A.firstOfType=function(He){return Qe(":first-of-type",He)},A.fullscreen=function(He){return Qe(":fullscreen",He)},A.focus=function(He){return Qe(":focus",He)},A.hover=function(He){return Qe(":hover",He)},A.indeterminate=function(He){return Qe(":indeterminate",He)},A.inRange=function(He){return Qe(":in-range",He)},A.invalid=function(He){return Qe(":invalid",He)},A.lastChild=function(He){return Qe(":last-child",He)},A.lastOfType=function(He){return Qe(":last-of-type",He)},A.left=function(He){return Qe(":left",He)},A.link=function(He){return Qe(":link",He)},A.onlyChild=function(He){return Qe(":only-child",He)},A.onlyOfType=function(He){return Qe(":only-of-type",He)},A.optional=function(He){return Qe(":optional",He)},A.outOfRange=function(He){return Qe(":out-of-range",He)},A.readOnly=function(He){return Qe(":read-only",He)},A.readWrite=function(He){return Qe(":read-write",He)},A.required=function(He){return Qe(":required",He)},A.right=function(He){return Qe(":right",He)},A.root=function(He){return Qe(":root",He)},A.scope=function(He){return Qe(":scope",He)},A.target=function(He){return Qe(":target",He)},A.valid=function(He){return Qe(":valid",He)},A.visited=function(He){return Qe(":visited",He)},A.dir=function(He,pt){return Qe(":dir("+He+")",pt)},A.lang=function(He,pt){return Qe(":lang("+He+")",pt)},A.not=function(He,pt){var Lt=He.split(",").map(function(zt){return zt.trim()}).map(function(zt){return":not("+zt+")"});return Lt.length===1?Qe(":not("+He+")",pt):Ve(Lt.join(""),pt)},A.nthChild=function(He,pt){return Qe(":nth-child("+He+")",pt)},A.nthLastChild=function(He,pt){return Qe(":nth-last-child("+He+")",pt)},A.nthLastOfType=function(He,pt){return Qe(":nth-last-of-type("+He+")",pt)},A.nthOfType=function(He,pt){return Qe(":nth-of-type("+He+")",pt)},A.after=function(He){return Qe("::after",He)},A.before=function(He){return Qe("::before",He)},A.firstLetter=function(He){return Qe("::first-letter",He)},A.firstLine=function(He){return Qe("::first-line",He)},A.selection=function(He){return Qe("::selection",He)},A.backdrop=function(He){return Qe("::backdrop",He)},A.placeholder=function(He){return Hn({"::placeholder":He})},A.cssFor=function(){for(var He=arguments.length,pt=Array(He),Lt=0;Lt<He;Lt++)pt[Lt]=arguments[Lt];return(pt=(0,B.default)(pt))?pt.map(function(zt){var Tn={label:[]};return gn(Tn,{src:zt}),Ft(Te(Tn),ke(Tn)).join("")}).join(""):""},A.attribsFor=function(){for(var He=arguments.length,pt=Array(He),Lt=0;Lt<He;Lt++)pt[Lt]=arguments[Lt];return(pt=(0,B.default)(pt))?pt.map(function(zt){we(zt);var Tn=Object.keys(zt)[0],xn=zt[Tn];return Tn+'="'+(xn||"")+'"'}).join(" "):""};var b=R(a(139)),$=a(320),U=a(201),B=R(a(311)),re=a(310),J=R(a(293));function R(He){return He&&He.__esModule?He:{default:He}}function W(He,pt,Lt){return pt in He?Object.defineProperty(He,pt,{value:Lt,enumerable:!0,configurable:!0,writable:!0}):He[pt]=Lt,He}var q=A.styleSheet=new $.StyleSheet;q.inject();var P=A.plugins=q.plugins=new re.PluginSet([re.prefixes,re.contentWrap,re.fallbacks]);P.media=new re.PluginSet,P.fontFace=new re.PluginSet,P.keyframes=new re.PluginSet([re.prefixes,re.fallbacks]);var ee=!1,I=!1,se=typeof window<"u",ie=ee,K=!1,de=!1,pe=ee;function Ae(He){var pt=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";return He.toLowerCase().replace(/[^a-z0-9]/g,pt)}function Te(He){var pt=JSON.stringify(He),Lt=(0,J.default)(pt).toString(36);return He.label&&He.label.length>0&&ee?Ae(He.label.join("."),"-")+"-"+Lt:Lt}function je(He){var pt=Object.keys(He).filter(function(Lt){return Lt!=="toString"});return pt.length===1&&!!/data\-css\-([a-zA-Z0-9\-_]+)/.exec(pt[0])}function we(He){var pt=Object.keys(He).filter(function(zt){return zt!=="toString"});if(pt.length!==1)throw new Error("not a rule");var Lt=/data\-css\-([a-zA-Z0-9\-_]+)/.exec(pt[0]);if(!Lt)throw new Error("not a rule");return Lt[1]}var ot=/[(),]|"(?:\\.|[^"\n])*"|'(?:\\.|[^'\n])*'|\/\*[\s\S]*?\*\//g;function _t(He){if(He.indexOf(",")===-1)return[He];for(var pt,Lt=[],zt=[],Tn=0;pt=ot.exec(He);)switch(pt[0]){case"(":Tn++;break;case")":Tn--;break;case",":if(Tn)break;Lt.push(pt.index)}for(pt=Lt.length;pt--;)zt.unshift(He.slice(Lt[pt]+1)),He=He.slice(0,Lt[pt]);return zt.unshift(He),zt}function Ut(He,pt){if(!He)return pt.replace(/\&/g,"");if(!pt)return".css-"+He+",[data-css-"+He+"]";var Lt=_t(pt).map(function(zt){return zt.indexOf("&")>=0?[zt.replace(/\&/gm,".css-"+He),zt.replace(/\&/gm,"[data-css-"+He+"]")].join(","):".css-"+He+zt+",[data-css-"+He+"]"+zt}).join(",");return ie&&/^\&\:/.exec(pt)&&!/\s/.exec(pt)&&(Lt+=",.css-"+He+"[data-simulate-"+Ae(pt)+"],[data-css-"+He+"][data-simulate-"+Ae(pt)+"]"),Lt}function Xt(He){var pt=He.selector,Lt=He.style,zt=P.transform({selector:pt,style:Lt});return zt.selector+"{"+(0,U.createMarkupForStyles)(zt.style)+"}"}function ke(He){var pt=void 0,Lt=void 0,zt=void 0,Tn=void 0;return Object.keys(He).forEach(function(xn){xn.indexOf("&")>=0?(Lt=Lt||{})[xn]=He[xn]:xn.indexOf("@media")===0?(zt=zt||{})[xn]=ke(He[xn]):xn.indexOf("@supports")===0?(Tn=Tn||{})[xn]=ke(He[xn]):xn==="label"?He.label.length>0&&((pt=pt||{}).label=pe?He.label.join("."):""):(pt=pt||{})[xn]=He[xn]}),{plain:pt,selects:Lt,medias:zt,supports:Tn}}function Ft(He,pt){var Lt=[],zt=pt.plain,Tn=pt.selects,xn=pt.medias,Kn=pt.supports;return zt&&Lt.push(Xt({style:zt,selector:Ut(He)})),Tn&&Object.keys(Tn).forEach(function(be){return Lt.push(Xt({style:Tn[be],selector:Ut(He,be)}))}),xn&&Object.keys(xn).forEach(function(be){return Lt.push(be+"{"+Ft(He,xn[be]).join("")+"}")}),Kn&&Object.keys(Kn).forEach(function(be){return Lt.push(be+"{"+Ft(He,Kn[be]).join("")+"}")}),Lt}var Gt=q.inserted={},jt=q.registered={};function Ye(He){jt[He.id]||(jt[He.id]=He)}var ln={};function nn(He){if(Ye(He),function(Lt){if(!Gt[Lt.id]){Gt[Lt.id]=!0;var zt=ke(Lt.style),Tn=Ft(Lt.id,zt);Gt[Lt.id]=!!se||Tn,Tn.forEach(function(xn){return q.insert(xn)})}}(He),ln[He.id])return ln[He.id];var pt=W({},"data-css-"+He.id,pe&&He.label||"");return Object.defineProperty(pt,"toString",{enumerable:!1,value:function(){return"css-"+He.id}}),ln[He.id]=pt,pt}function Bt(He,pt){var Lt=_t(He).map(function(zt){return zt.indexOf("&")>=0?zt:"&"+zt});return _t(pt).map(function(zt){return zt.indexOf("&")>=0?zt:"&"+zt}).reduce(function(zt,Tn){return zt.concat(Lt.map(function(xn){return Tn.replace(/\&/g,xn)}))},[]).join(",")}var Pt={"::placeholder":["::-webkit-input-placeholder","::-moz-placeholder","::-ms-input-placeholder"],":fullscreen":[":-webkit-full-screen",":-moz-full-screen",":-ms-fullscreen"]};function gn(He,pt){var Lt=pt.selector,zt=Lt===void 0?"":Lt,Tn=pt.mq,xn=Tn===void 0?"":Tn,Kn=pt.supp,be=Kn===void 0?"":Kn,Yn=pt.src,Dr=Yn===void 0?{}:Yn;Array.isArray(Dr)||(Dr=[Dr]),(Dr=function pr(Nr){for(var Fr=[],an=0;an<Nr.length;an++)Fr=Array.isArray(Nr[an])?Fr.concat(pr(Nr[an])):Fr.concat(Nr[an]);return Fr}(Dr)).forEach(function(pr){if(je(pr)){var Nr=function(Fr){if(je(Fr)){var an=jt[we(Fr)];if(an==null)throw new Error("[glamor] an unexpected rule cache miss occurred. This is probably a sign of multiple glamor instances in your app. See https://github.com/threepointone/glamor/issues/79");return an}return Fr}(pr);if(Nr.type!=="css")throw new Error("cannot merge this rule");pr=Nr.style}(pr=(0,B.default)(pr))&&pr.composes&&gn(He,{selector:zt,mq:xn,supp:be,src:pr.composes}),Object.keys(pr||{}).forEach(function(Fr){if(function(Kt){for(var Zt=[":",".","[",">"," "],$n=!1,Dn=Kt.charAt(0),hr=0;hr<Zt.length;hr++)if(Dn===Zt[hr]){$n=!0;break}return $n||Kt.indexOf("&")>=0}(Fr))Pt[Fr]&&Pt[Fr].forEach(function(Kt){return gn(He,{selector:Bt(zt,Kt),mq:xn,supp:be,src:pr[Fr]})}),gn(He,{selector:Bt(zt,Fr),mq:xn,supp:be,src:pr[Fr]});else if(function(Kt){return Kt.indexOf("@media")===0}(Fr))gn(He,{selector:zt,mq:function(Kt,Zt){return Kt?"@media "+Kt.substring(6)+" and "+Zt.substring(6):Zt}(xn,Fr),supp:be,src:pr[Fr]});else if(function(Kt){return Kt.indexOf("@supports")===0}(Fr))gn(He,{selector:zt,mq:xn,supp:function(Kt,Zt){return Kt?"@supports "+Kt.substring(9)+" and "+Zt.substring(9):Zt}(be,Fr),src:pr[Fr]});else if(Fr!=="composes"){var an=He;be&&(an[be]=an[be]||{},an=an[be]),xn&&(an[xn]=an[xn]||{},an=an[xn]),zt&&(an[zt]=an[zt]||{},an=an[zt]),Fr==="label"?pe&&(He.label=He.label.concat(pr.label)):an[Fr]=pr[Fr]}})})}function Dt(He){var pt={label:[]};return gn(pt,{src:He}),nn({id:Te(pt),style:pt,label:pe?pt.label.join("."):"",type:"css"})}var St={};Object.defineProperty(St,"toString",{enumerable:!1,value:function(){return"css-nil"}});var wn=typeof WeakMap<"u"?[St,new WeakMap,new WeakMap,new WeakMap]:[St],Bn=typeof WeakMap<"u"?function(He){return function(pt){if(wn[pt.length]){for(var Lt=wn[pt.length],zt=0;zt<pt.length-1;)Lt.has(pt[zt])||Lt.set(pt[zt],new WeakMap),Lt=Lt.get(pt[zt]),zt++;if(Lt.has(pt[pt.length-1])){var Tn=Lt.get(pt[zt]);if(jt[Tn.toString().substring(4)])return Tn}}var xn=He(pt);if(wn[pt.length]){for(var Kn=0,be=wn[pt.length];Kn<pt.length-1;)be=be.get(pt[Kn]),Kn++;try{be.set(pt[Kn],xn)}catch{}}return xn}}(Dt):Dt;function Hn(){for(var He=arguments.length,pt=Array(He),Lt=0;Lt<He;Lt++)pt[Lt]=arguments[Lt];if(pt[0]&&pt[0].length&&pt[0].raw)throw new Error("you forgot to include glamor/babel in your babel plugins.");return(pt=(0,B.default)(pt))?Bn(pt):St}Hn.insert=function(He){var pt={id:Te(He),css:He,type:"raw"};Ye(pt),Gt[pt.id]||(q.insert(pt.css),Gt[pt.id]=!!se||[pt.css])},A.insertRule=Hn.insert,Hn.global=function(He,pt){if(pt=(0,B.default)(pt))return Hn.insert(Xt({selector:He,style:pt}))},A.insertGlobal=Hn.global,Hn.keyframes=function(He,pt){pt||(pt=He,He="animation");var Lt={id:Te({name:He,kfs:pt=(0,B.default)(pt)||{}}),type:"keyframes",name:He,keyframes:pt};return Ye(Lt),function(zt){if(!Gt[zt.id]){var Tn=Object.keys(zt.keyframes).map(function(Kn){var be=P.keyframes.transform({id:zt.id,name:Kn,style:zt.keyframes[Kn]});return be.name+"{"+(0,U.createMarkupForStyles)(be.style)+"}"}).join(""),xn=["-webkit-","-moz-","-o-",""].map(function(Kn){return"@"+Kn+"keyframes "+zt.name+"_"+zt.id+"{"+Tn+"}"});xn.forEach(function(Kn){return q.insert(Kn)}),Gt[zt.id]=!!se||xn}}(Lt),He+"_"+Lt.id},Hn.fontFace=function(He){var pt={id:Te(He=(0,B.default)(He)),type:"font-face",font:He};return Ye(pt),function(Lt){if(!Gt[Lt.id]){var zt="@font-face{"+(0,U.createMarkupForStyles)(Lt.font)+"}";q.insert(zt),Gt[Lt.id]=!!se||[zt]}}(pt),He.fontFamily},A.fontFace=Hn.fontFace,A.keyframes=Hn.keyframes,A.presets={mobile:"(min-width: 400px)",Mobile:"@media (min-width: 400px)",phablet:"(min-width: 550px)",Phablet:"@media (min-width: 550px)",tablet:"(min-width: 750px)",Tablet:"@media (min-width: 750px)",desktop:"(min-width: 1000px)",Desktop:"@media (min-width: 1000px)",hd:"(min-width: 1200px)",Hd:"@media (min-width: 1200px)"};var hn=A.style=Hn;function Ve(He){for(var pt=arguments.length,Lt=Array(pt>1?pt-1:0),zt=1;zt<pt;zt++)Lt[zt-1]=arguments[zt];return He?Hn(W({},He,Lt)):hn(Lt)}A.$=Ve,A.merge=Hn,A.compose=Hn;function Qe(He){for(var pt=arguments.length,Lt=Array(pt>1?pt-1:0),zt=1;zt<pt;zt++)Lt[zt-1]=arguments[zt];return Hn(W({},He,Lt))}},function(Oe,A,a){/**
* @license
* Copyright 2017 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Object.defineProperty(A,"__esModule",{value:!0});var b=function(){function U(B){this.global=B,this.flags={},this.flagRegistry={},this.urlFlags={},this.populateURLFlags()}return U.prototype.setPlatform=function(B,re){this.platform!=null&&console.warn("Platform "+this.platformName+" has already been set. Overwriting the platform with "+re+"."),this.platformName=B,this.platform=re},U.prototype.registerFlag=function(B,re,J){if(this.flagRegistry[B]={evaluationFn:re,setHook:J},this.urlFlags[B]!=null){var R=this.urlFlags[B];console.warn("Setting feature override from URL "+B+": "+R+"."),this.set(B,R)}},U.prototype.get=function(B){return B in this.flags?this.flags[B]:(this.flags[B]=this.evaluateFlag(B),this.flags[B])},U.prototype.getNumber=function(B){return this.get(B)},U.prototype.getBool=function(B){return this.get(B)},U.prototype.getFlags=function(){return this.flags},Object.defineProperty(U.prototype,"features",{get:function(){return this.flags},enumerable:!0,configurable:!0}),U.prototype.set=function(B,re){if(this.flagRegistry[B]==null)throw new Error("Cannot set flag "+B+" as it has not been registered.");this.flags[B]=re,this.flagRegistry[B].setHook!=null&&this.flagRegistry[B].setHook(re)},U.prototype.evaluateFlag=function(B){if(this.flagRegistry[B]==null)throw new Error("Cannot evaluate flag '"+B+"': no evaluation function found.");return this.flagRegistry[B].evaluationFn()},U.prototype.setFlags=function(B){this.flags=Object.assign({},B)},U.prototype.reset=function(){this.flags={},this.urlFlags={},this.populateURLFlags()},U.prototype.populateURLFlags=function(){var B=this;if(this.global!==void 0&&this.global.location!==void 0&&this.global.location.search!==void 0){var re=$(this.global.location.search);"tfjsflags"in re&&re.tfjsflags.split(",").forEach(function(J){var R=J.split(":"),W=R[0],q=R[1];B.urlFlags[W]=function(P,ee){if((ee=ee.toLowerCase())==="true"||ee==="false")return ee==="true";if(""+ +ee===ee)return+ee;throw new Error("Could not parse value flag value "+ee+" for flag "+P+".")}(W,q)})}},U}();function $(U){var B={};return U.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,function(re){for(var J=[],R=1;R<arguments.length;R++)J[R-1]=arguments[R];return function(W,q,P){W[decodeURIComponent(q)]=decodeURIComponent(P||"")}(B,J[0],J[1]),J.join("=")}),B}A.Environment=b,A.getQueryParams=$,A.env=function(){return A.ENV},A.ENV=null,A.setEnvironmentGlobal=function(U){A.ENV=U}},function(Oe,A,a){var b=a(14),$=a(55),U=a(19)("species");Oe.exports=function(B,re){var J,R=b(B).constructor;return R===void 0||(J=b(R)[U])==null?re:$(J)}},function(Oe,A,a){var b=a(62),$=a(19)("toStringTag"),U=b(function(){return arguments}())=="Arguments";Oe.exports=function(B){var re,J,R;return B===void 0?"Undefined":B===null?"Null":typeof(J=function(W,q){try{return W[q]}catch{}}(re=Object(B),$))=="string"?J:U?b(re):(R=b(re))=="Object"&&typeof re.callee=="function"?"Arguments":R}},function(Oe,A){A.f={}.propertyIsEnumerable},function(Oe,A,a){var b=a(62);Oe.exports=Object("z").propertyIsEnumerable(0)?Object:function($){return b($)=="String"?$.split(""):Object($)}},function(Oe,A,a){var b=a(87);A.a=function($){let U=$,B=$;function re(J,R,W,q){for(W==null&&(W=0),q==null&&(q=J.length);W<q;){const P=W+q>>>1;B(J[P],R)<0?W=P+1:q=P}return W}return $.length===1&&(U=(J,R)=>$(J)-R,B=function(J){return(R,W)=>Object(b.a)(J(R),W)}($)),{left:re,center:function(J,R,W,q){W==null&&(W=0),q==null&&(q=J.length);const P=re(J,R,W,q-1);return P>W&&U(J[P-1],R)>-U(J[P],R)?P-1:P},right:function(J,R,W,q){for(W==null&&(W=0),q==null&&(q=J.length);W<q;){const P=W+q>>>1;B(J[P],R)>0?q=P:W=P+1}return W}}}},function(Oe,A,a){/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Object.defineProperty(A,"__esModule",{value:!0});const b=a(50),$=a(247),U=a(102),B=a(46);A.table=function(J,R,W={}){if(R&&R.headers==null)throw new Error('Data to render must have a "headers" property');if(R&&R.values==null)throw new Error('Data to render must have a "values" property');const q=B.getDrawArea(J),P=Object.assign({},re,W);let ee=$.select(q).select("table.tf-table");const I=U.css({fontSize:P.fontSize||".875rem",width:"100%",maxWidth:"64rem",marginRight:"auto",marginLeft:"auto"});if(ee.size()===0&&((ee=$.select(q).append("table")).attr("class",` ${I} tf-table`),ee.append("thead").append("tr"),ee.append("tbody")),ee.size()!==1)throw new Error("Error inserting table");const se=U.css({fontWeight:"600",borderBottomStyle:"solid",borderBottomWidth:"1px",borderColor:"rgba( 0, 0, 0, .2 )",textAlign:"left",paddingBottom:"1rem",paddingRight:"1rem",backgroundColor:"#fff"}),ie=ee.select("thead").select("tr").selectAll("th").data(R.headers),K=ie.enter().append("th").attr("class",`${se}`);ie.merge(K).html(ot=>ot),ie.exit().remove();const de=b.format(",.4~f"),pe=ee.select("tbody").selectAll("tr").data(R.values),Ae=pe.enter().append("tr"),Te=U.css({padding:"0.25rem",borderBottomStyle:"solid",borderBottomWidth:"1px",borderColor:"rgba( 0, 0, 0, .2 )"}),je=pe.merge(Ae).selectAll("td").data(ot=>ot),we=je.enter().append("td").attr("class",`${Te}`);je.merge(we).html(ot=>typeof ot=="number"?de(ot):ot),je.exit().remove(),pe.exit().remove()};const re={fontSize:14}},function(Oe,A,a){/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/var b=this&&this.__awaiter||function(B,re,J,R){return new(J||(J=Promise))(function(W,q){function P(se){try{I(R.next(se))}catch(ie){q(ie)}}function ee(se){try{I(R.throw(se))}catch(ie){q(ie)}}function I(se){se.done?W(se.value):new J(function(ie){ie(se.value)}).then(P,ee)}I((R=R.apply(B,re||[])).next())})};Object.defineProperty(A,"__esModule",{value:!0});const $=a(0),U=a(111);A.arrayStats=function(B){if(!Array.isArray(B))throw new Error("input must be an array");if(B.length===0)return{numVals:0,numNans:0,numZeros:0,max:void 0,min:void 0};const re=B.length;let J=-1/0,R=1/0,W=0,q=0,P=0;for(let I=0;I<re;I++){const se=B[I];se>J&&(J=se),se<R&&(R=se),se===0&&(W+=1),isNaN(se)?q+=1:isFinite(se)||(P+=1)}const ee={numVals:re,numZeros:W,numNans:q,max:J,min:R,numInfs:P};return ee.max===-1/0&&(ee.max=NaN),ee.min===1/0&&(ee.min=NaN),ee},A.tensorStats=function(B){return b(this,void 0,void 0,function*(){const[re,J,R]=$.tidy(()=>{const W=$.scalar(0,B.dtype);return[B.min(),B.max(),B.equal(W).sum()]});return Promise.all([B.data(),re.data(),J.data(),R.data()]).then(([W,q,P,ee])=>{const I=W.length;let se=0,ie=0;for(let pe=0;pe<I;pe++){const Ae=W[pe];isNaN(Ae)?se+=1:isFinite(Ae)||(ie+=1)}let K=q[0],de=P[0];return se===I&&(K=NaN,de=NaN),{numVals:I,numZeros:ee[0],numNans:se,min:K,max:de,numInfs:ie}})})},A.confusionMatrix=function(B,re,J,R){return b(this,void 0,void 0,function*(){U.assert(B.rank===1,"labels must be a 1D tensor"),U.assert(re.rank===1,"predictions must be a 1D tensor"),U.assert(B.size===re.size,"labels and predictions must be the same length"),R!=null&&U.assert(R.size===re.size,"labels and predictions must be the same length");const W=B.cast("int32"),q=re.cast("int32");J==null&&(J=$.tidy(()=>$.maximum(W.max(),q.max()).cast("int32").dataSync()[0]+1));let P=Promise.resolve(null);return R!=null&&(P=R.data()),Promise.all([W.data(),q.data(),P]).then(([ee,I,se])=>{const ie=Array(J).fill(0);for(let K=0;K<J;K++)ie[K]=Array(J).fill(0);for(let K=0;K<ee.length;K++){const de=ee[K],pe=I[K];ie[de][pe]+=se!=null?se[K]:1}return ie})})},A.accuracy=function(B,re){return b(this,void 0,void 0,function*(){U.assertShapesMatch(B.shape,re.shape,"Error computing accuracy.");const J=B.equal(re),R=J.mean(),W=(yield R.data())[0];return $.dispose([J,R]),W})},A.perClassAccuracy=function(B,re,J){return b(this,void 0,void 0,function*(){return U.assert(B.rank===1,"labels must be a 1D tensor"),U.assert(re.rank===1,"predictions must be a 1D tensor"),U.assert(B.size===re.size,"labels and predictions must be the same length"),J==null&&(J=$.tidy(()=>$.maximum(B.max(),re.max()).dataSync()[0]+1)),Promise.all([B.data(),re.data()]).then(([R,W])=>{const q=Array(J).fill(0),P=Array(J).fill(0);for(let I=0;I<R.length;I++){const se=R[I],ie=W[I];q[se]+=1,se===ie&&(P[se]+=1)}const ee=[];for(let I=0;I<q.length;I++)ee.push({count:q[I],accuracy:q[I]===0?0:P[I]/q[I]});return ee})})}},function(Oe,A,a){/*
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function b(U,B){if(!U)throw new Error(typeof B=="string"?B:B())}function $(U,B){if(U.length!==B.length)return!1;for(let re=0;re<U.length;re++)if(U[re]!==B[re])return!1;return!0}Object.defineProperty(A,"__esModule",{value:!0}),A.assert=b,A.assertShapesMatch=function(U,B,re=""){b($(U,B),re+` Shapes ${U} and ${B} must match`)},A.arraysEqual=$,A.DECIMAL_PLACES_TO_CHECK=4},function(Oe,A,a){const b=a(47);Oe.exports=($,U,B)=>{try{U=new b(U,B)}catch{return!1}return U.test($)}},function(Oe,A,a){const b=Symbol("SemVer ANY");class ${static get ANY(){return b}constructor(ee,I){if(I=U(I),ee instanceof $){if(ee.loose===!!I.loose)return ee;ee=ee.value}R("comparator",ee,I),this.options=I,this.loose=!!I.loose,this.parse(ee),this.semver===b?this.value="":this.value=this.operator+this.semver.version,R("comp",this)}parse(ee){const I=this.options.loose?B[re.COMPARATORLOOSE]:B[re.COMPARATOR],se=ee.match(I);if(!se)throw new TypeError(`Invalid comparator: ${ee}`);this.operator=se[1]!==void 0?se[1]:"",this.operator==="="&&(this.operator=""),se[2]?this.semver=new W(se[2],this.options.loose):this.semver=b}toString(){return this.value}test(ee){if(R("Comparator.test",ee,this.options.loose),this.semver===b||ee===b)return!0;if(typeof ee=="string")try{ee=new W(ee,this.options)}catch{return!1}return J(ee,this.operator,this.semver,this.options)}intersects(ee,I){if(!(ee instanceof $))throw new TypeError("a Comparator is required");if(I&&typeof I=="object"||(I={loose:!!I,includePrerelease:!1}),this.operator==="")return this.value===""||new q(ee.value,I).test(this.value);if(ee.operator==="")return ee.value===""||new q(this.value,I).test(ee.semver);const se=!(this.operator!==">="&&this.operator!==">"||ee.operator!==">="&&ee.operator!==">"),ie=!(this.operator!=="<="&&this.operator!=="<"||ee.operator!=="<="&&ee.operator!=="<"),K=this.semver.version===ee.semver.version,de=!(this.operator!==">="&&this.operator!=="<="||ee.operator!==">="&&ee.operator!=="<="),pe=J(this.semver,"<",ee.semver,I)&&(this.operator===">="||this.operator===">")&&(ee.operator==="<="||ee.operator==="<"),Ae=J(this.semver,">",ee.semver,I)&&(this.operator==="<="||this.operator==="<")&&(ee.operator===">="||ee.operator===">");return se||ie||K&&de||pe||Ae}}Oe.exports=$;const U=a(115),{re:B,t:re}=a(90),J=a(203),R=a(116),W=a(32),q=a(47)},function(Oe,A,a){const b=a(48);Oe.exports=($,U,B)=>b($,U,B)>0},function(Oe,A){const a=["includePrerelease","loose","rtl"];Oe.exports=b=>b?typeof b!="object"?{loose:!0}:a.filter($=>b[$]).reduce(($,U)=>($[U]=!0,$),{}):{}},function(Oe,A,a){(function(b){const $=typeof b=="object"&&b.env&&b.env.NODE_DEBUG&&/\bsemver\b/i.test(b.env.NODE_DEBUG)?(...U)=>console.error("SEMVER",...U):()=>{};Oe.exports=$}).call(this,a(75))},function(Oe,A){const a=Number.MAX_SAFE_INTEGER||9007199254740991;Oe.exports={SEMVER_SPEC_VERSION:"2.0.0",MAX_LENGTH:256,MAX_SAFE_INTEGER:a,MAX_SAFE_COMPONENT_LENGTH:16}},function(Oe,A,a){for(var b,$=a(16),U=a(42),B=a(84),re=B("typed_array"),J=B("view"),R=!(!$.ArrayBuffer||!$.DataView),W=R,q=0,P="Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array".split(",");q<9;)(b=$[P[q++]])?(U(b.prototype,re,!0),U(b.prototype,J,!0)):W=!1;Oe.exports={ABV:R,CONSTR:W,TYPED:re,VIEW:J}},function(Oe,A,a){var b=a(16),$=a(8),U=a(38),B=a(93),re=a(65),J=a(121),R=a(94),W=a(13),q=a(15),P=a(125),ee=a(98),I=a(168);Oe.exports=function(se,ie,K,de,pe,Ae){var Te=b[se],je=Te,we=pe?"set":"add",ot=je&&je.prototype,_t={},Ut=function(Ye){var ln=ot[Ye];U(ot,Ye,Ye=="delete"?function(nn){return!(Ae&&!W(nn))&&ln.call(this,nn===0?0:nn)}:Ye=="has"?function(nn){return!(Ae&&!W(nn))&&ln.call(this,nn===0?0:nn)}:Ye=="get"?function(nn){return Ae&&!W(nn)?void 0:ln.call(this,nn===0?0:nn)}:Ye=="add"?function(nn){return ln.call(this,nn===0?0:nn),this}:function(nn,Bt){return ln.call(this,nn===0?0:nn,Bt),this})};if(typeof je=="function"&&(Ae||ot.forEach&&!q(function(){new je().entries().next()}))){var Xt=new je,ke=Xt[we](Ae?{}:-0,1)!=Xt,Ft=q(function(){Xt.has(1)}),Gt=P(function(Ye){new je(Ye)}),jt=!Ae&&q(function(){for(var Ye=new je,ln=5;ln--;)Ye[we](ln,ln);return!Ye.has(-0)});Gt||((je=ie(function(Ye,ln){R(Ye,je,se);var nn=I(new Te,Ye,je);return ln!=null&&J(ln,pe,nn[we],nn),nn})).prototype=ot,ot.constructor=je),(Ft||jt)&&(Ut("delete"),Ut("has"),pe&&Ut("get")),(jt||ke)&&Ut(we),Ae&&ot.clear&&delete ot.clear}else je=de.getConstructor(ie,se,pe,we),B(je.prototype,K),re.NEED=!0;return ee(je,se),_t[se]=je,$($.G+$.W+$.F*(je!=Te),_t),Ae||de.setStrong(je,se,pe),je}},function(Oe,A,a){var b=a(16).navigator;Oe.exports=b&&b.userAgent||""},function(Oe,A,a){var b=a(56),$=a(225),U=a(159),B=a(14),re=a(22),J=a(157),R={},W={};(A=Oe.exports=function(q,P,ee,I,se){var ie,K,de,pe,Ae=se?function(){return q}:J(q),Te=b(ee,I,P?2:1),je=0;if(typeof Ae!="function")throw TypeError(q+" is not iterable!");if(U(Ae)){for(ie=re(q.length);ie>je;je++)if((pe=P?Te(B(K=q[je])[0],K[1]):Te(q[je]))===R||pe===W)return pe}else for(de=Ae.call(q);!(K=de.next()).done;)if((pe=$(de,Te,K.value,P))===R||pe===W)return pe}).BREAK=R,A.RETURN=W},function(Oe,A,a){a(220);var b=a(38),$=a(42),U=a(15),B=a(61),re=a(19),J=a(154),R=re("species"),W=!U(function(){var P=/./;return P.exec=function(){var ee=[];return ee.groups={a:"7"},ee},"".replace(P,"$<a>")!=="7"}),q=function(){var P=/(?:)/,ee=P.exec;P.exec=function(){return ee.apply(this,arguments)};var I="ab".split(P);return I.length===2&&I[0]==="a"&&I[1]==="b"}();Oe.exports=function(P,ee,I){var se=re(P),ie=!U(function(){var je={};return je[se]=function(){return 7},""[P](je)!=7}),K=ie?!U(function(){var je=!1,we=/a/;return we.exec=function(){return je=!0,null},P==="split"&&(we.constructor={},we.constructor[R]=function(){return we}),we[se](""),!je}):void 0;if(!ie||!K||P==="replace"&&!W||P==="split"&&!q){var de=/./[se],pe=I(B,se,""[P],function(je,we,ot,_t,Ut){return we.exec===J?ie&&!Ut?{done:!0,value:de.call(we,ot,_t)}:{done:!0,value:je.call(ot,we,_t)}:{done:!1}}),Ae=pe[0],Te=pe[1];b(String.prototype,P,Ae),$(RegExp.prototype,se,ee==2?function(je,we){return Te.call(je,this,we)}:function(je){return Te.call(je,this)})}}},function(Oe,A,a){var b=a(105),$=RegExp.prototype.exec;Oe.exports=function(U,B){var re=U.exec;if(typeof re=="function"){var J=re.call(U,B);if(typeof J!="object")throw new TypeError("RegExp exec method returned something other than an Object or null");return J}if(b(U)!=="RegExp")throw new TypeError("RegExp#exec called on incompatible receiver");return $.call(U,B)}},function(Oe,A,a){var b=a(14);Oe.exports=function(){var $=b(this),U="";return $.global&&(U+="g"),$.ignoreCase&&(U+="i"),$.multiline&&(U+="m"),$.unicode&&(U+="u"),$.sticky&&(U+="y"),U}},function(Oe,A,a){var b=a(19)("iterator"),$=!1;try{var U=[7][b]();U.return=function(){$=!0},Array.from(U,function(){throw 2})}catch{}Oe.exports=function(B,re){if(!re&&!$)return!1;var J=!1;try{var R=[7],W=R[b]();W.next=function(){return{done:J=!0}},R[b]=function(){return W},B(R)}catch{}return J}},function(Oe,A,a){var b=a(62);Oe.exports=Array.isArray||function($){return b($)=="Array"}},function(Oe,A){A.f=Object.getOwnPropertySymbols},function(Oe,A,a){var b=a(41),$=a(22),U=a(81);Oe.exports=function(B){return function(re,J,R){var W,q=b(re),P=$(q.length),ee=U(R,P);if(B&&J!=J){for(;P>ee;)if((W=q[ee++])!=W)return!0}else for(;P>ee;ee++)if((B||ee in q)&&q[ee]===J)return B||ee||0;return!B&&-1}}},function(Oe,A,a){var b=a(24),$=a(16),U=$["__core-js_shared__"]||($["__core-js_shared__"]={});(Oe.exports=function(B,re){return U[B]||(U[B]=re!==void 0?re:{})})("versions",[]).push({version:b.version,mode:a(83)?"pure":"global",copyright:" 2020 Denis Pushkarev (zloirock.ru)"})},function(Oe,A,a){a.r(A),function(b,$){a.d(A,"array",function(){return Tn}),a.d(A,"Dataset",function(){return Lt}),a.d(A,"zip",function(){return xn}),a.d(A,"CSVDataset",function(){return an}),a.d(A,"TextLineDataset",function(){return be}),a.d(A,"csv",function(){return oi}),a.d(A,"func",function(){return Ao}),a.d(A,"generator",function(){return Wi}),a.d(A,"microphone",function(){return bt}),a.d(A,"webcam",function(){return Ei}),a.d(A,"FileDataSource",function(){return Xr}),a.d(A,"URLDataSource",function(){return fi}),a.d(A,"version_data",function(){return Lr});var U=a(0),B=function(Mt,ge){return(B=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(le,ye){le.__proto__=ye}||function(le,ye){for(var _e in ye)ye.hasOwnProperty(_e)&&(le[_e]=ye[_e])})(Mt,ge)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function re(Mt,ge){function le(){this.constructor=Mt}B(Mt,ge),Mt.prototype=ge===null?Object.create(ge):(le.prototype=ge.prototype,new le)}function J(Mt,ge,le,ye){return new(le||(le=Promise))(function(_e,et){function gt(Jn){try{fn(ye.next(Jn))}catch(An){et(An)}}function Rt(Jn){try{fn(ye.throw(Jn))}catch(An){et(An)}}function fn(Jn){Jn.done?_e(Jn.value):new le(function(An){An(Jn.value)}).then(gt,Rt)}fn((ye=ye.apply(Mt,ge||[])).next())})}function R(Mt,ge){var le,ye,_e,et,gt={label:0,sent:function(){if(1&_e[0])throw _e[1];return _e[1]},trys:[],ops:[]};return et={next:Rt(0),throw:Rt(1),return:Rt(2)},typeof Symbol=="function"&&(et[Symbol.iterator]=function(){return this}),et;function Rt(fn){return function(Jn){return function(An){if(le)throw new TypeError("Generator is already executing.");for(;gt;)try{if(le=1,ye&&(_e=2&An[0]?ye.return:An[0]?ye.throw||((_e=ye.return)&&_e.call(ye),0):ye.next)&&!(_e=_e.call(ye,An[1])).done)return _e;switch(ye=0,_e&&(An=[2&An[0],_e.value]),An[0]){case 0:case 1:_e=An;break;case 4:return gt.label++,{value:An[1],done:!1};case 5:gt.label++,ye=An[1],An=[0];continue;case 7:An=gt.ops.pop(),gt.trys.pop();continue;default:if(!(_e=(_e=gt.trys).length>0&&_e[_e.length-1])&&(An[0]===6||An[0]===2)){gt=0;continue}if(An[0]===3&&(!_e||An[1]>_e[0]&&An[1]<_e[3])){gt.label=An[1];break}if(An[0]===6&&gt.label<_e[1]){gt.label=_e[1],_e=An;break}if(_e&&gt.label<_e[2]){gt.label=_e[2],gt.ops.push(An);break}_e[2]&&gt.ops.pop(),gt.trys.pop();continue}An=ge.call(Mt,gt)}catch(Ln){An=[6,Ln],ye=0}finally{le=_e=0}if(5&An[0])throw An[1];return{value:An[0]?An[1]:void 0,done:!0}}([fn,Jn])}}}function W(Mt,ge){return Mt(ge={exports:{}},ge.exports),ge.exports}var q=W(function(Mt){(function(ge,le,ye){function _e(gt,Rt){return Rt.c=gt.c,Rt.s0=gt.s0,Rt.s1=gt.s1,Rt.s2=gt.s2,Rt}function et(gt,Rt){var fn=new function(Ln){var qn,Nt=this,Ot=(qn=4022871197,function(pn){pn=pn.toString();for(var Ht=0;Ht<pn.length;Ht++){var Ue=.02519603282416938*(qn+=pn.charCodeAt(Ht));Ue-=qn=Ue>>>0,qn=(Ue*=qn)>>>0,qn+=4294967296*(Ue-=qn)}return 23283064365386963e-26*(qn>>>0)});Nt.next=function(){var pn=2091639*Nt.s0+23283064365386963e-26*Nt.c;return Nt.s0=Nt.s1,Nt.s1=Nt.s2,Nt.s2=pn-(Nt.c=0|pn)},Nt.c=1,Nt.s0=Ot(" "),Nt.s1=Ot(" "),Nt.s2=Ot(" "),Nt.s0-=Ot(Ln),Nt.s0<0&&(Nt.s0+=1),Nt.s1-=Ot(Ln),Nt.s1<0&&(Nt.s1+=1),Nt.s2-=Ot(Ln),Nt.s2<0&&(Nt.s2+=1),Ot=null}(gt),Jn=Rt&&Rt.state,An=fn.next;return An.int32=function(){return 4294967296*fn.next()|0},An.double=function(){return An()+11102230246251565e-32*(2097152*An()|0)},An.quick=An,Jn&&(typeof Jn=="object"&&_e(Jn,fn),An.state=function(){return _e(fn,{})}),An}le&&le.exports?le.exports=et:this.alea=et})(0,Mt)}),P=W(function(Mt){(function(ge,le,ye){function _e(gt,Rt){return Rt.x=gt.x,Rt.y=gt.y,Rt.z=gt.z,Rt.w=gt.w,Rt}function et(gt,Rt){var fn=new function(Ln){var qn=this,Nt="";qn.x=0,qn.y=0,qn.z=0,qn.w=0,qn.next=function(){var pn=qn.x^qn.x<<11;return qn.x=qn.y,qn.y=qn.z,qn.z=qn.w,qn.w^=qn.w>>>19^pn^pn>>>8},Ln===(0|Ln)?qn.x=Ln:Nt+=Ln;for(var Ot=0;Ot<Nt.length+64;Ot++)qn.x^=0|Nt.charCodeAt(Ot),qn.next()}(gt),Jn=Rt&&Rt.state,An=function(){return(fn.next()>>>0)/4294967296};return An.double=function(){do var Ln=((fn.next()>>>11)+(fn.next()>>>0)/4294967296)/2097152;while(Ln===0);return Ln},An.int32=fn.next,An.quick=An,Jn&&(typeof Jn=="object"&&_e(Jn,fn),An.state=function(){return _e(fn,{})}),An}le&&le.exports?le.exports=et:this.xor128=et})(0,Mt)}),ee=W(function(Mt){(function(ge,le,ye){function _e(gt,Rt){return Rt.x=gt.x,Rt.y=gt.y,Rt.z=gt.z,Rt.w=gt.w,Rt.v=gt.v,Rt.d=gt.d,Rt}function et(gt,Rt){var fn=new function(Ln){var qn=this,Nt="";qn.next=function(){var pn=qn.x^qn.x>>>2;return qn.x=qn.y,qn.y=qn.z,qn.z=qn.w,qn.w=qn.v,(qn.d=qn.d+362437|0)+(qn.v=qn.v^qn.v<<4^pn^pn<<1)|0},qn.x=0,qn.y=0,qn.z=0,qn.w=0,qn.v=0,Ln===(0|Ln)?qn.x=Ln:Nt+=Ln;for(var Ot=0;Ot<Nt.length+64;Ot++)qn.x^=0|Nt.charCodeAt(Ot),Ot==Nt.length&&(qn.d=qn.x<<10^qn.x>>>4),qn.next()}(gt),Jn=Rt&&Rt.state,An=function(){return(fn.next()>>>0)/4294967296};return An.double=function(){do var Ln=((fn.next()>>>11)+(fn.next()>>>0)/4294967296)/2097152;while(Ln===0);return Ln},An.int32=fn.next,An.quick=An,Jn&&(typeof Jn=="object"&&_e(Jn,fn),An.state=function(){return _e(fn,{})}),An}le&&le.exports?le.exports=et:this.xorwow=et})(0,Mt)}),I=W(function(Mt){(function(ge,le,ye){function _e(gt,Rt){return Rt.x=gt.x.slice(),Rt.i=gt.i,Rt}function et(gt,Rt){gt==null&&(gt=+new Date);var fn=new function(Ln){var qn=this;qn.next=function(){var Nt,Ot,pn=qn.x,Ht=qn.i;return Nt=pn[Ht],Ot=(Nt^=Nt>>>7)^Nt<<24,Ot^=(Nt=pn[Ht+1&7])^Nt>>>10,Ot^=(Nt=pn[Ht+3&7])^Nt>>>3,Ot^=(Nt=pn[Ht+4&7])^Nt<<7,Nt=pn[Ht+7&7],Ot^=(Nt^=Nt<<13)^Nt<<9,pn[Ht]=Ot,qn.i=Ht+1&7,Ot},function(Nt,Ot){var pn,Ht=[];if(Ot===(0|Ot))Ht[0]=Ot;else for(Ot=""+Ot,pn=0;pn<Ot.length;++pn)Ht[7&pn]=Ht[7&pn]<<15^Ot.charCodeAt(pn)+Ht[pn+1&7]<<13;for(;Ht.length<8;)Ht.push(0);for(pn=0;pn<8&&Ht[pn]===0;++pn);for(pn==8?Ht[7]=-1:Ht[pn],Nt.x=Ht,Nt.i=0,pn=256;pn>0;--pn)Nt.next()}(qn,Ln)}(gt),Jn=Rt&&Rt.state,An=function(){return(fn.next()>>>0)/4294967296};return An.double=function(){do var Ln=((fn.next()>>>11)+(fn.next()>>>0)/4294967296)/2097152;while(Ln===0);return Ln},An.int32=fn.next,An.quick=An,Jn&&(Jn.x&&_e(Jn,fn),An.state=function(){return _e(fn,{})}),An}le&&le.exports?le.exports=et:this.xorshift7=et})(0,Mt)}),se=W(function(Mt){(function(ge,le,ye){function _e(gt,Rt){return Rt.i=gt.i,Rt.w=gt.w,Rt.X=gt.X.slice(),Rt}function et(gt,Rt){gt==null&&(gt=+new Date);var fn=new function(Ln){var qn=this;qn.next=function(){var Nt,Ot,pn=qn.w,Ht=qn.X,Ue=qn.i;return qn.w=pn=pn+1640531527|0,Ot=Ht[Ue+34&127],Nt=Ht[Ue=Ue+1&127],Ot^=Ot<<13,Nt^=Nt<<17,Ot^=Ot>>>15,Nt^=Nt>>>12,Ot=Ht[Ue]=Ot^Nt,qn.i=Ue,Ot+(pn^pn>>>16)|0},function(Nt,Ot){var pn,Ht,Ue,Mn,Gn,Zn=[],ir=128;for(Ot===(0|Ot)?(Ht=Ot,Ot=null):(Ot+="\0",Ht=0,ir=Math.max(ir,Ot.length)),Ue=0,Mn=-32;Mn<ir;++Mn)Ot&&(Ht^=Ot.charCodeAt((Mn+32)%Ot.length)),Mn===0&&(Gn=Ht),Ht^=Ht<<10,Ht^=Ht>>>15,Ht^=Ht<<4,Ht^=Ht>>>13,Mn>=0&&(Gn=Gn+1640531527|0,Ue=(pn=Zn[127&Mn]^=Ht+Gn)==0?Ue+1:0);for(Ue>=128&&(Zn[127&(Ot&&Ot.length||0)]=-1),Ue=127,Mn=512;Mn>0;--Mn)Ht=Zn[Ue+34&127],pn=Zn[Ue=Ue+1&127],Ht^=Ht<<13,pn^=pn<<17,Ht^=Ht>>>15,pn^=pn>>>12,Zn[Ue]=Ht^pn;Nt.w=Gn,Nt.X=Zn,Nt.i=Ue}(qn,Ln)}(gt),Jn=Rt&&Rt.state,An=function(){return(fn.next()>>>0)/4294967296};return An.double=function(){do var Ln=((fn.next()>>>11)+(fn.next()>>>0)/4294967296)/2097152;while(Ln===0);return Ln},An.int32=fn.next,An.quick=An,Jn&&(Jn.X&&_e(Jn,fn),An.state=function(){return _e(fn,{})}),An}le&&le.exports?le.exports=et:this.xor4096=et})(0,Mt)}),ie=W(function(Mt){(function(ge,le,ye){function _e(gt,Rt){return Rt.a=gt.a,Rt.b=gt.b,Rt.c=gt.c,Rt.d=gt.d,Rt}function et(gt,Rt){var fn=new function(Ln){var qn=this,Nt="";qn.next=function(){var pn=qn.b,Ht=qn.c,Ue=qn.d,Mn=qn.a;return pn=pn<<25^pn>>>7^Ht,Ht=Ht-Ue|0,Ue=Ue<<24^Ue>>>8^Mn,Mn=Mn-pn|0,qn.b=pn=pn<<20^pn>>>12^Ht,qn.c=Ht=Ht-Ue|0,qn.d=Ue<<16^Ht>>>16^Mn,qn.a=Mn-pn|0},qn.a=0,qn.b=0,qn.c=-1640531527,qn.d=1367130551,Ln===Math.floor(Ln)?(qn.a=Ln/4294967296|0,qn.b=0|Ln):Nt+=Ln;for(var Ot=0;Ot<Nt.length+20;Ot++)qn.b^=0|Nt.charCodeAt(Ot),qn.next()}(gt),Jn=Rt&&Rt.state,An=function(){return(fn.next()>>>0)/4294967296};return An.double=function(){do var Ln=((fn.next()>>>11)+(fn.next()>>>0)/4294967296)/2097152;while(Ln===0);return Ln},An.int32=fn.next,An.quick=An,Jn&&(typeof Jn=="object"&&_e(Jn,fn),An.state=function(){return _e(fn,{})}),An}le&&le.exports?le.exports=et:this.tychei=et})(0,Mt)}),K=W(function(Mt){(function(ge,le){var ye,_e=this,et=256,gt=6,Rt="random",fn=le.pow(et,gt),Jn=le.pow(2,52),An=2*Jn,Ln=et-1;function qn(Ht,Ue,Mn){var Gn=[],Zn=Ot(function vr(pi,fo){var ui,Zi=[],Ti=typeof pi;if(fo&&Ti=="object")for(ui in pi)try{Zi.push(vr(pi[ui],fo-1))}catch{}return Zi.length?Zi:Ti=="string"?pi:pi+"\0"}((Ue=Ue==1?{entropy:!0}:Ue||{}).entropy?[Ht,pn(ge)]:Ht??function(){try{var vr;return ye&&(vr=ye.randomBytes)?vr=vr(et):(vr=new Uint8Array(et),(_e.crypto||_e.msCrypto).getRandomValues(vr)),pn(vr)}catch{var pi=_e.navigator,fo=pi&&pi.plugins;return[+new Date,_e,fo,_e.screen,pn(ge)]}}(),3),Gn),ir=new function(vr){var pi,fo=vr.length,ui=this,Zi=0,Ti=ui.i=ui.j=0,qr=ui.S=[];for(fo||(vr=[fo++]);Zi<et;)qr[Zi]=Zi++;for(Zi=0;Zi<et;Zi++)qr[Zi]=qr[Ti=Ln&Ti+vr[Zi%fo]+(pi=qr[Zi])],qr[Ti]=pi;(ui.g=function(jr){for(var jn,ri=0,Vi=ui.i,Rr=ui.j,ao=ui.S;jr--;)jn=ao[Vi=Ln&Vi+1],ri=ri*et+ao[Ln&(ao[Vi]=ao[Rr=Ln&Rr+jn])+(ao[Rr]=jn)];return ui.i=Vi,ui.j=Rr,ri})(et)}(Gn),zr=function(){for(var vr=ir.g(gt),pi=fn,fo=0;vr<Jn;)vr=(vr+fo)*et,pi*=et,fo=ir.g(1);for(;vr>=An;)vr/=2,pi/=2,fo>>>=1;return(vr+fo)/pi};return zr.int32=function(){return 0|ir.g(4)},zr.quick=function(){return ir.g(4)/4294967296},zr.double=zr,Ot(pn(ir.S),ge),(Ue.pass||Mn||function(vr,pi,fo,ui){return ui&&(ui.S&&Nt(ui,ir),vr.state=function(){return Nt(ir,{})}),fo?(le[Rt]=vr,pi):vr})(zr,Zn,"global"in Ue?Ue.global:this==le,Ue.state)}function Nt(Ht,Ue){return Ue.i=Ht.i,Ue.j=Ht.j,Ue.S=Ht.S.slice(),Ue}function Ot(Ht,Ue){for(var Mn,Gn=Ht+"",Zn=0;Zn<Gn.length;)Ue[Ln&Zn]=Ln&(Mn^=19*Ue[Ln&Zn])+Gn.charCodeAt(Zn++);return pn(Ue)}function pn(Ht){return String.fromCharCode.apply(0,Ht)}if(le["seed"+Rt]=qn,Ot(le.random(),ge),Mt.exports){Mt.exports=qn;try{ye=a(387)}catch{}}})([],Math)});K.alea=q,K.xor128=P,K.xorwow=ee,K.xorshift7=I,K.xor4096=se,K.tychei=ie;var de=K.alea;function pe(Mt,ge,le,ye){if(le===void 0&&(le=new Map),ye===void 0&&(ye=new Set),Mt==null)return null;if(ye.has(Mt))throw new Error("Circular references are not supported.");if(le.has(Mt))return le.get(Mt);var _e=ge(Mt);if(_e.recurse&&_e.value!==null)throw new Error("A deep map function may not return both a value and recurse=true.");if(_e.recurse){if(we(Mt)){var et=Array.isArray(Mt)?[]:{};for(var gt in ye.add(Mt),Mt){var Rt=pe(Mt[gt],ge,le,ye);et[gt]=Rt}return ye.delete(Mt),et}throw new Error("Can't recurse into non-iterable type: "+Mt)}return le.set(Mt,_e.value),_e.value}function Ae(Mt,ge){return ge===void 0&&(ge=Te),function le(ye,_e,et){et===void 0&&(et=new Set);var gt=ye[0];if(et.has(gt))throw new Error("Circular references are not supported.");var Rt=_e(ye);if(Rt.recurse&&Rt.value!==null)throw new Error("A deep zip function may not return both a value and recurse=true.");if(Rt.recurse){if(we(gt)){var fn=Array.isArray(gt)?[]:{};et.add(gt);var Jn=function(Ln){var qn=le(ye.map(function(Nt){return Nt[Ln]}),_e,et);fn[Ln]=qn};for(var An in gt)Jn(An);return et.delete(gt),fn}throw new Error("Can't recurse into non-iterable type: "+gt)}return Rt.value}(Mt,ge)}function Te(Mt){return Mt===null?null:we(Mt[0])?{value:null,recurse:!0}:{value:Mt,recurse:!1}}function je(Mt,ge){return J(this,void 0,void 0,function(){var le,ye,_e,et,gt,Rt;return R(this,function(fn){switch(fn.label){case 0:le=new Map,pe(Mt,ge,le),ye=0,_e=Array.from(le.keys()),fn.label=1;case 1:return ye<_e.length?(et=_e[ye],(gt=le.get(et))instanceof Promise?[4,gt]:[3,3]):[3,4];case 2:Rt=fn.sent(),le.set(et,Rt),fn.label=3;case 3:return ye++,[3,1];case 4:return[2,pe(Mt,ge,le)]}})})}function we(Mt){return Mt!=null&&!ArrayBuffer.isView(Mt)&&(Array.isArray(Mt)||typeof Mt=="object"&&!(Mt instanceof U.Tensor))}function ot(Mt){return function(ge,le){return pe(ge,le)}(Mt,_t)}function _t(Mt){return Mt instanceof U.Tensor?{value:Mt.clone(),recurse:!1}:we(Mt)?{value:null,recurse:!0}:{value:Mt,recurse:!1}}var Ut=function(){function Mt(ge){if(this.capacity=ge,this.begin=0,this.end=0,ge==null)throw new RangeError("Can't create a ring buffer of unknown capacity.");if(ge<1)throw new RangeError("Can't create ring buffer of capacity < 1.");this.data=new Array(ge),this.doubledCapacity=2*ge}return Mt.prototype.wrap=function(ge){for(;ge<0;)ge+=this.doubledCapacity;return ge%this.doubledCapacity},Mt.prototype.get=function(ge){if(ge<0)throw new RangeError("Can't get item at a negative index.");return this.data[ge%this.capacity]},Mt.prototype.set=function(ge,le){if(ge<0)throw new RangeError("Can't set item at a negative index.");this.data[ge%this.capacity]=le},Mt.prototype.length=function(){var ge=this.end-this.begin;return ge<0&&(ge=this.doubledCapacity+ge),ge},Mt.prototype.isFull=function(){return this.length()===this.capacity},Mt.prototype.isEmpty=function(){return this.length()===0},Mt.prototype.push=function(ge){if(this.isFull())throw new RangeError("Ring buffer is full.");this.set(this.end,ge),this.end=this.wrap(this.end+1)},Mt.prototype.pushAll=function(ge){for(var le=0,ye=ge;le<ye.length;le++){var _e=ye[le];this.push(_e)}},Mt.prototype.pop=function(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");this.end=this.wrap(this.end-1);var ge=this.get(this.end);return this.set(this.end,void 0),ge},Mt.prototype.unshift=function(ge){if(this.isFull())throw new RangeError("Ring buffer is full.");this.begin=this.wrap(this.begin-1),this.set(this.begin,ge)},Mt.prototype.shift=function(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");var ge=this.get(this.begin);return this.set(this.begin,void 0),this.begin=this.wrap(this.begin+1),ge},Mt.prototype.shuffleExcise=function(ge){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");var le=this.wrap(this.begin+ge),ye=this.get(le);return this.set(le,this.pop()),ye},Mt}(),Xt=function(Mt){function ge(){return Mt.call(this,ge.INITIAL_CAPACITY)||this}return re(ge,Mt),ge.prototype.isFull=function(){return!1},ge.prototype.push=function(le){Mt.prototype.isFull.call(this)&&this.expand(),Mt.prototype.push.call(this,le)},ge.prototype.unshift=function(le){Mt.prototype.isFull.call(this)&&this.expand(),Mt.prototype.unshift.call(this,le)},ge.prototype.expand=function(){for(var le=2*this.capacity,ye=new Array(le),_e=this.length(),et=0;et<_e;et++)ye[et]=this.get(this.wrap(this.begin+et));this.data=ye,this.capacity=le,this.doubledCapacity=2*this.capacity,this.begin=0,this.end=_e},ge.INITIAL_CAPACITY=32,ge}(Ut);function ke(Mt){return new Ye(Mt)}function Ft(Mt){return new ln(Mt)}var Gt,jt=function(){function Mt(){}return Mt.prototype.toArray=function(){return J(this,void 0,void 0,function(){var ge,le;return R(this,function(ye){switch(ye.label){case 0:return ge=[],[4,this.next()];case 1:le=ye.sent(),ye.label=2;case 2:return le.done?[3,4]:(ge.push(le.value),[4,this.next()]);case 3:return le=ye.sent(),[3,2];case 4:return[2,ge]}})})},Mt.prototype.toArrayForTest=function(){return J(this,void 0,void 0,function(){var ge,le,ye;return R(this,function(_e){switch(_e.label){case 0:return ge=this.prefetch(100),le=[],[4,ge.next()];case 1:ye=_e.sent(),_e.label=2;case 2:return ye.done?[3,4]:(le.push(ye.value),[4,ge.next()]);case 3:return ye=_e.sent(),[3,2];case 4:return[2,le]}})})},Mt.prototype.resolveFully=function(){return J(this,void 0,void 0,function(){var ge;return R(this,function(le){switch(le.label){case 0:return[4,this.next()];case 1:ge=le.sent(),le.label=2;case 2:return ge.done?[3,4]:[4,this.next()];case 3:return ge=le.sent(),[3,2];case 4:return[2]}})})},Mt.prototype.resolveWhile=function(ge){return J(this,void 0,void 0,function(){var le,ye;return R(this,function(_e){switch(_e.label){case 0:return[4,this.next()];case 1:le=_e.sent(),ye=ge(le.value),_e.label=2;case 2:return le.done||!ye?[3,4]:[4,this.next()];case 3:return le=_e.sent(),ye=ge(le.value),[3,2];case 4:return[2]}})})},Mt.prototype.handleErrors=function(ge){return new wn(this,ge)},Mt.prototype.filter=function(ge){return new Dt(this,ge)},Mt.prototype.map=function(ge){return new St(this,ge)},Mt.prototype.mapAsync=function(ge){return new Bn(this,ge)},Mt.prototype.serialMapAsync=function(ge){return new Bn(this,ge).serial()},Mt.prototype.flatmap=function(ge){return new hn(this,ge)},Mt.prototype.forEachAsync=function(ge){return J(this,void 0,void 0,function(){return R(this,function(le){return[2,this.map(ge).resolveFully()]})})},Mt.prototype.serialForEach=function(ge){return J(this,void 0,void 0,function(){return R(this,function(le){return[2,this.serialMapAsync(ge).resolveWhile(function(ye){return ye===!0})]})})},Mt.prototype.rowMajorBatch=function(ge,le){return le===void 0&&(le=!0),new gn(this,ge,le)},Mt.prototype.columnMajorBatch=function(ge,le,ye){return le===void 0&&(le=!0),ye===void 0&&(ye=Te),this.rowMajorBatch(ge,le).map(function(_e){return Ae(_e,ye)})},Mt.prototype.concatenate=function(ge,le){return new Ve(ke([this,ge]),le)},Mt.prototype.take=function(ge){return ge<0||ge==null?this:new Pt(this,ge)},Mt.prototype.skip=function(ge){return ge<0||ge==null?this:new Bt(this,ge)},Mt.prototype.prefetch=function(ge){return new He(this,ge)},Mt.prototype.shuffle=function(ge,le){return new pt(this,ge,le)},Mt.prototype.serial=function(){return new nn(this)},Mt}(),Ye=function(Mt){function ge(le){var ye=Mt.call(this)||this;return ye.items=le,ye.trav=0,ye}return re(ge,Mt),ge.prototype.summary=function(){return"Array of "+this.items.length+" items"},ge.prototype.next=function(){return J(this,void 0,void 0,function(){var le;return R(this,function(ye){return this.trav>=this.items.length?[2,{value:null,done:!0}]:(le=this.items[this.trav],this.trav++,[2,{value:ot(le),done:!1}])})})},ge}(jt),ln=function(Mt){function ge(le){var ye=Mt.call(this)||this;return ye.nextFn=le,ye}return re(ge,Mt),ge.prototype.summary=function(){return"Function call"},ge.prototype.next=function(){return J(this,void 0,void 0,function(){return R(this,function(le){try{return[2,this.nextFn()]}catch(ye){throw ye.message="Error thrown while iterating through a dataset: "+ye.message,ye}return[2]})})},ge}(jt),nn=function(Mt){function ge(le){var ye=Mt.call(this)||this;return ye.upstream=le,ye.lastRead=Promise.resolve({value:null,done:!1}),ye}return re(ge,Mt),ge.prototype.summary=function(){return this.upstream.summary()+" -> Serial"},ge.prototype.next=function(){return J(this,void 0,void 0,function(){var le=this;return R(this,function(ye){return this.lastRead=this.lastRead.then(function(){return le.serialNext()}),[2,this.lastRead]})})},ge.prototype.serialNext=function(){return J(this,void 0,void 0,function(){return R(this,function(le){return[2,this.upstream.next()]})})},ge}(jt),Bt=function(Mt){function ge(le,ye){var _e=Mt.call(this)||this;return _e.upstream=le,_e.maxCount=ye,_e.count=0,_e.lastRead=Promise.resolve({value:null,done:!1}),_e}return re(ge,Mt),ge.prototype.summary=function(){return this.upstream.summary()+" -> Skip"},ge.prototype.next=function(){return J(this,void 0,void 0,function(){var le=this;return R(this,function(ye){return this.lastRead=this.lastRead.then(function(){return le.serialNext()}),[2,this.lastRead]})})},ge.prototype.serialNext=function(){return J(this,void 0,void 0,function(){var le;return R(this,function(ye){switch(ye.label){case 0:return this.count++<this.maxCount?[4,this.upstream.next()]:[3,2];case 1:return(le=ye.sent()).done?[2,le]:(Object(U.dispose)(le.value),[3,0]);case 2:return[2,this.upstream.next()]}})})},ge}(jt),Pt=function(Mt){function ge(le,ye){var _e=Mt.call(this)||this;return _e.upstream=le,_e.maxCount=ye,_e.count=0,_e}return re(ge,Mt),ge.prototype.summary=function(){return this.upstream.summary()+" -> Take"},ge.prototype.next=function(){return J(this,void 0,void 0,function(){return R(this,function(le){return this.count++>=this.maxCount?[2,{value:null,done:!0}]:[2,this.upstream.next()]})})},ge}(jt),gn=function(Mt){function ge(le,ye,_e){_e===void 0&&(_e=!0);var et=Mt.call(this)||this;return et.upstream=le,et.batchSize=ye,et.enableSmallLastBatch=_e,et.lastRead=Promise.resolve({value:null,done:!1}),et}return re(ge,Mt),ge.prototype.summary=function(){return this.upstream.summary()+" -> RowMajorBatch"},ge.prototype.next=function(){return J(this,void 0,void 0,function(){var le=this;return R(this,function(ye){return this.lastRead=this.lastRead.then(function(){return le.serialNext()}),[2,this.lastRead]})})},ge.prototype.serialNext=function(){return J(this,void 0,void 0,function(){var le,ye;return R(this,function(_e){switch(_e.label){case 0:le=[],_e.label=1;case 1:return le.length<this.batchSize?[4,this.upstream.next()]:[3,3];case 2:return(ye=_e.sent()).done?this.enableSmallLastBatch&&le.length>0?[2,{value:le,done:!1}]:[2,{value:null,done:!0}]:(le.push(ye.value),[3,1]);case 3:return[2,{value:le,done:!1}]}})})},ge}(jt),Dt=function(Mt){function ge(le,ye){var _e=Mt.call(this)||this;return _e.upstream=le,_e.predicate=ye,_e.lastRead=Promise.resolve({value:null,done:!1}),_e}return re(ge,Mt),ge.prototype.summary=function(){return this.upstream.summary()+" -> Filter"},ge.prototype.next=function(){return J(this,void 0,void 0,function(){var le=this;return R(this,function(ye){return this.lastRead=this.lastRead.then(function(){return le.serialNext()}),[2,this.lastRead]})})},ge.prototype.serialNext=function(){return J(this,void 0,void 0,function(){var le;return R(this,function(ye){switch(ye.label){case 0:return[4,this.upstream.next()];case 1:return(le=ye.sent()).done||this.predicate(le.value)?[2,le]:(Object(U.dispose)(le.value),[3,0]);case 2:return[2]}})})},ge}(jt),St=function(Mt){function ge(le,ye){var _e=Mt.call(this)||this;return _e.upstream=le,_e.transform=ye,_e}return re(ge,Mt),ge.prototype.summary=function(){return this.upstream.summary()+" -> Map"},ge.prototype.next=function(){return J(this,void 0,void 0,function(){var le,ye,_e,et,gt,Rt,fn;return R(this,function(Jn){switch(Jn.label){case 0:return[4,this.upstream.next()];case 1:if((le=Jn.sent()).done)return[2,{value:null,done:!0}];for(ye=U.tensor_util.getTensorsInContainer(le.value),_e=this.transform(le.value),et=U.tensor_util.getTensorsInContainer(_e),gt=0,Rt=ye;gt<Rt.length;gt++)fn=Rt[gt],U.tensor_util.isTensorInList(fn,et)||fn.dispose();return[2,{value:_e,done:!1}]}})})},ge}(jt),wn=function(Mt){function ge(le,ye){var _e=Mt.call(this)||this;return _e.upstream=le,_e.handler=ye,_e.count=0,_e.lastRead=Promise.resolve({value:null,done:!1}),_e}return re(ge,Mt),ge.prototype.summary=function(){return this.upstream.summary()+" -> handleErrors"},ge.prototype.next=function(){return J(this,void 0,void 0,function(){var le=this;return R(this,function(ye){return this.lastRead=this.lastRead.then(function(){return le.serialNext()}),[2,this.lastRead]})})},ge.prototype.serialNext=function(){return J(this,void 0,void 0,function(){var le;return R(this,function(ye){switch(ye.label){case 0:ye.label=1;case 1:return ye.trys.push([1,3,,4]),[4,this.upstream.next()];case 2:return[2,ye.sent()];case 3:return le=ye.sent(),this.handler(le)?[3,4]:[2,{value:null,done:!0}];case 4:return[3,0];case 5:return[2]}})})},ge}(jt),Bn=function(Mt){function ge(le,ye){var _e=Mt.call(this)||this;return _e.upstream=le,_e.transform=ye,_e}return re(ge,Mt),ge.prototype.summary=function(){return this.upstream.summary()+" -> AsyncMap"},ge.prototype.next=function(){return J(this,void 0,void 0,function(){var le,ye,_e,et,gt,Rt,fn;return R(this,function(Jn){switch(Jn.label){case 0:return[4,this.upstream.next()];case 1:return(le=Jn.sent()).done?[2,{value:null,done:!0}]:(ye=U.tensor_util.getTensorsInContainer(le.value),[4,this.transform(le.value)]);case 2:for(_e=Jn.sent(),et=U.tensor_util.getTensorsInContainer(_e),gt=0,Rt=ye;gt<Rt.length;gt++)fn=Rt[gt],U.tensor_util.isTensorInList(fn,et)||fn.dispose();return[2,{value:_e,done:!1}]}})})},ge}(jt),Hn=function(Mt){function ge(){var le=Mt.call(this)||this;return le.outputQueue=new Xt,le.lastRead=Promise.resolve({value:null,done:!1}),le}return re(ge,Mt),ge.prototype.next=function(){return J(this,void 0,void 0,function(){var le=this;return R(this,function(ye){return this.lastRead=this.lastRead.then(function(){return le.serialNext()}),[2,this.lastRead]})})},ge.prototype.serialNext=function(){return J(this,void 0,void 0,function(){return R(this,function(le){switch(le.label){case 0:return this.outputQueue.length()!==0?[3,2]:[4,this.pump()];case 1:return le.sent()?[3,0]:[2,{value:null,done:!0}];case 2:return[2,{value:this.outputQueue.shift(),done:!1}]}})})},ge}(jt),hn=function(Mt){function ge(le,ye){var _e=Mt.call(this)||this;return _e.upstream=le,_e.transform=ye,_e}return re(ge,Mt),ge.prototype.summary=function(){return this.upstream.summary()+" -> Flatmap"},ge.prototype.pump=function(){return J(this,void 0,void 0,function(){var le,ye,_e,et,gt,Rt,fn;return R(this,function(Jn){switch(Jn.label){case 0:return[4,this.upstream.next()];case 1:if((le=Jn.sent()).done)return[2,!1];for(ye=U.tensor_util.getTensorsInContainer(le.value),_e=this.transform(le.value),et=U.tensor_util.getTensorsInContainer(_e),this.outputQueue.pushAll(_e),gt=0,Rt=ye;gt<Rt.length;gt++)fn=Rt[gt],U.tensor_util.isTensorInList(fn,et)||fn.dispose();return[2,!0]}})})},ge}(Hn),Ve=function(Mt){function ge(le,ye){var _e=Mt.call(this)||this;return _e.baseErrorHandler=ye,_e.lastRead=null,_e.iterator=null,_e.moreIterators=le,_e}return re(ge,Mt),ge.prototype.summary=function(){return"TODO: fill in upstream of chained summaries -> Chained"},ge.prototype.next=function(){return J(this,void 0,void 0,function(){return R(this,function(le){return this.lastRead=this.readFromChain(this.lastRead),[2,this.lastRead]})})},ge.prototype.readFromChain=function(le){return J(this,void 0,void 0,function(){var ye,_e;return R(this,function(et){switch(et.label){case 0:return[4,le];case 1:return et.sent(),this.iterator!=null?[3,3]:[4,this.moreIterators.next()];case 2:if((ye=et.sent()).done)return[2,{value:null,done:!0}];this.iterator=ye.value,this.baseErrorHandler!=null&&(this.iterator=this.iterator.handleErrors(this.baseErrorHandler)),et.label=3;case 3:return[4,this.iterator.next()];case 4:return(_e=et.sent()).done?(this.iterator=null,[2,this.readFromChain(le)]):[2,_e]}})})},ge}(jt);(function(Mt){Mt[Mt.FAIL=0]="FAIL",Mt[Mt.SHORTEST=1]="SHORTEST",Mt[Mt.LONGEST=2]="LONGEST"})(Gt||(Gt={}));var Qe=function(Mt){function ge(le,ye){ye===void 0&&(ye=Gt.FAIL);var _e=Mt.call(this)||this;return _e.iterators=le,_e.mismatchMode=ye,_e.count=0,_e.currentPromise=null,_e}return re(ge,Mt),ge.prototype.summary=function(){return"{TODO: fill in upstream of zip summaries} -> Zip"},ge.prototype.nextState=function(le){return J(this,void 0,void 0,function(){function ye(Rt){return Rt instanceof jt?{value:Rt.next().then(function(fn){return _e++,fn.done&&et++,fn.value}),recurse:!1}:{value:null,recurse:!0}}var _e,et,gt;return R(this,function(Rt){switch(Rt.label){case 0:return[4,le];case 1:return Rt.sent(),_e=0,et=0,[4,je(this.iterators,ye)];case 2:if(gt=Rt.sent(),_e===et)return[2,{value:null,done:!0}];if(et>0)switch(this.mismatchMode){case Gt.FAIL:throw new Error("Zipped streams should have the same length. Mismatched at element "+this.count+".");case Gt.SHORTEST:return[2,{value:null,done:!0}];case Gt.LONGEST:}return this.count++,[2,{value:gt,done:!1}]}})})},ge.prototype.next=function(){return J(this,void 0,void 0,function(){return R(this,function(le){return this.currentPromise=this.nextState(this.currentPromise),[2,this.currentPromise]})})},ge}(jt),He=function(Mt){function ge(le,ye){var _e=Mt.call(this)||this;return _e.upstream=le,_e.bufferSize=ye,_e.buffer=new Ut(ye),_e}return re(ge,Mt),ge.prototype.summary=function(){return this.upstream.summary()+" -> Prefetch"},ge.prototype.refill=function(){for(;!this.buffer.isFull();){var le=this.upstream.next();this.buffer.push(le)}},ge.prototype.next=function(){return this.refill(),this.buffer.shift()},ge}(jt),pt=function(Mt){function ge(le,ye,_e){var et=Mt.call(this,le,ye)||this;return et.upstream=le,et.windowSize=ye,et.upstreamExhausted=!1,et.random=de(_e||U.util.now().toString()),et.lastRead=Promise.resolve({value:null,done:!1}),et}return re(ge,Mt),ge.prototype.next=function(){return J(this,void 0,void 0,function(){var le=this;return R(this,function(ye){return this.lastRead=this.lastRead.then(function(){return le.serialNext()}),[2,this.lastRead]})})},ge.prototype.randomInt=function(le){return Math.floor(this.random()*le)},ge.prototype.chooseIndex=function(){return this.randomInt(this.buffer.length())},ge.prototype.serialNext=function(){return J(this,void 0,void 0,function(){var le,ye;return R(this,function(_e){switch(_e.label){case 0:this.upstreamExhausted||this.refill(),_e.label=1;case 1:return this.buffer.isEmpty()?[3,3]:(le=this.chooseIndex(),[4,this.buffer.shuffleExcise(le)]);case 2:return(ye=_e.sent()).done?(this.upstreamExhausted=!0,[3,1]):(this.refill(),[2,ye]);case 3:return[2,{value:null,done:!0}]}})})},ge}(He),Lt=function(){function Mt(){this.size=null}return Mt.prototype.batch=function(ge,le){var ye=this;le===void 0&&(le=!0);var _e=this;return U.util.assert(ge>0,function(){return`batchSize needs to be positive, but it is
      `+ge}),zt(function(){return J(ye,void 0,void 0,function(){return R(this,function(et){switch(et.label){case 0:return[4,_e.iterator()];case 1:return[2,et.sent().columnMajorBatch(ge,le,Kn)]}})})},this.size===1/0||this.size==null?this.size:le?Math.ceil(this.size/ge):Math.floor(this.size/ge))},Mt.prototype.concatenate=function(ge){var le=this,ye=this;return zt(function(){return J(le,void 0,void 0,function(){var _e,et;return R(this,function(gt){switch(gt.label){case 0:return[4,ye.iterator()];case 1:return et=(_e=gt.sent()).concatenate,[4,ge.iterator()];case 2:return[2,et.apply(_e,[gt.sent()])]}})})},this.size===1/0||ge.size===1/0?1/0:this.size!=null&&ge.size!=null?this.size+ge.size:null)},Mt.prototype.filter=function(ge){var le=this,ye=this;return zt(function(){return J(le,void 0,void 0,function(){return R(this,function(_e){switch(_e.label){case 0:return[4,ye.iterator()];case 1:return[2,_e.sent().filter(function(et){return Object(U.tidy)(function(){return ge(et)})})]}})})},this.size===1/0?1/0:null)},Mt.prototype.forEachAsync=function(ge){return J(this,void 0,void 0,function(){return R(this,function(le){switch(le.label){case 0:return[4,this.iterator()];case 1:return[2,le.sent().forEachAsync(ge)]}})})},Mt.prototype.forEach=function(ge){return J(this,void 0,void 0,function(){return R(this,function(le){return Object(U.deprecationWarn)("dataset.forEach() is deprecated and will be removed. Please use dataset.forEachAsync() instead"),[2,this.forEachAsync(ge)]})})},Mt.prototype.map=function(ge){var le=this,ye=this;return zt(function(){return J(le,void 0,void 0,function(){return R(this,function(_e){switch(_e.label){case 0:return[4,ye.iterator()];case 1:return[2,_e.sent().map(function(et){return Object(U.tidy)(function(){return ge(et)})})]}})})},this.size)},Mt.prototype.mapAsync=function(ge){var le=this,ye=this;return zt(function(){return J(le,void 0,void 0,function(){return R(this,function(_e){switch(_e.label){case 0:return[4,ye.iterator()];case 1:return[2,_e.sent().mapAsync(ge)]}})})},this.size)},Mt.prototype.prefetch=function(ge){var le=this;if(ge==null)throw new RangeError("`Dataset.prefetch()` requires bufferSize to be specified.");var ye=this;return zt(function(){return J(le,void 0,void 0,function(){return R(this,function(_e){switch(_e.label){case 0:return[4,ye.iterator()];case 1:return[2,_e.sent().prefetch(ge)]}})})},this.size)},Mt.prototype.repeat=function(ge){var le=this,ye=this;return zt(function(){return J(le,void 0,void 0,function(){var _e=this;return R(this,function(et){return[2,function(gt,Rt){return new Ve(gt,Rt)}(Ft(function(){return J(_e,void 0,void 0,function(){var gt;return R(this,function(Rt){switch(Rt.label){case 0:return gt={},[4,ye.iterator()];case 1:return[2,(gt.value=Rt.sent(),gt.done=!1,gt)]}})})}).take(ge))]})})},this.size!=null&&ge>0?this.size*ge:ge===0?0:this.size!=null&&(ge===void 0||ge<0)?1/0:null)},Mt.prototype.skip=function(ge){var le=this,ye=this;return zt(function(){return J(le,void 0,void 0,function(){return R(this,function(_e){switch(_e.label){case 0:return[4,ye.iterator()];case 1:return[2,_e.sent().skip(ge)]}})})},this.size!=null&&ge>=0&&this.size>=ge?this.size-ge:this.size!=null&&(this.size<ge||ge===void 0||ge<0)?0:null)},Mt.prototype.shuffle=function(ge,le,ye){var _e=this;if(ye===void 0&&(ye=!0),ge==null||ge<0)throw this.size==null?new RangeError("`Dataset.shuffle()` requires bufferSize to be specified."):new RangeError("`Dataset.shuffle()` requires bufferSize to be specified.  If your data fits in main memory (for regular JS objects), and/or GPU memory (for `tf.Tensor`s), consider setting bufferSize to the dataset size ("+this.size+" elements)");var et=this,gt=de(le||U.util.now().toString());return zt(function(){return J(_e,void 0,void 0,function(){var Rt;return R(this,function(fn){switch(fn.label){case 0:return Rt=gt.int32(),ye&&(Rt+=gt.int32()),[4,et.iterator()];case 1:return[2,fn.sent().shuffle(ge,Rt.toString())]}})})},this.size)},Mt.prototype.take=function(ge){var le=this,ye=this;return zt(function(){return J(le,void 0,void 0,function(){return R(this,function(_e){switch(_e.label){case 0:return[4,ye.iterator()];case 1:return[2,_e.sent().take(ge)]}})})},this.size!=null&&this.size>ge?ge:this.size!=null&&this.size<=ge?this.size:null)},Mt.prototype.toArray=function(){return J(this,void 0,void 0,function(){return R(this,function(ge){switch(ge.label){case 0:if(this.size===1/0)throw new Error("Can not convert infinite data stream to array.");return[4,this.iterator()];case 1:return[2,ge.sent().toArray()]}})})},Mt.prototype.toArrayForTest=function(){return J(this,void 0,void 0,function(){return R(this,function(ge){switch(ge.label){case 0:if(this.size===1/0)throw new Error("Can not convert infinite data stream to array.");return[4,this.iterator()];case 1:return[2,ge.sent().toArrayForTest()]}})})},Mt.MAX_BUFFER_SIZE=1e4,Mt}();function zt(Mt,ge){return ge===void 0&&(ge=null),new(function(le){function ye(){var _e=le!==null&&le.apply(this,arguments)||this;return _e.size=ge,_e}return re(ye,le),ye.prototype.iterator=function(){return J(this,void 0,void 0,function(){return R(this,function(_e){return[2,Mt()]})})},ye}(Lt))}function Tn(Mt){var ge=this;return zt(function(){return J(ge,void 0,void 0,function(){return R(this,function(le){return[2,ke(Mt)]})})},Mt.length)}function xn(Mt){var ge,le=this;if(!we(Mt))throw new Error("The argument to zip() must be an object or array.");if(Array.isArray(Mt))for(var ye=0;ye<Mt.length;ye++)ge=ge==null?Mt[ye].size:Math.min(ge,Mt[ye].size);else if(Mt instanceof Object)for(var _e in Mt)ge=ge==null?Mt[_e].size:Math.min(ge,Mt[_e].size);return zt(function(){return J(le,void 0,void 0,function(){return R(this,function(et){switch(et.label){case 0:return[4,je(Mt,function(gt){if(gt instanceof Lt)return{value:gt.iterator(),recurse:!1};if(we(gt))return{value:null,recurse:!0};throw new Error("Leaves of the structure passed to zip() must be Datasets, not primitives.")})];case 1:return[2,function(gt,Rt){return Rt===void 0&&(Rt=Gt.FAIL),new Qe(gt,Rt)}(et.sent(),Gt.SHORTEST)]}})})},ge)}function Kn(Mt){return Mt===null?null:function(ge){return ge==null||function(le){return le===null||typeof le!="object"&&typeof le!="function"}(ge)||Array.isArray(ge)||typeof ge=="object"&&ge instanceof U.Tensor||U.util.isTypedArray(ge)}(Mt[0])?{value:function(ge){if(ge.length===0)throw new Error("Can't make a batch of zero elements.");return ge[0]instanceof U.Tensor?Object(U.stack)(ge):Object(U.tensor)(ge)}(Mt),recurse:!1}:{value:null,recurse:!0}}var be=function(Mt){function ge(le){var ye=Mt.call(this)||this;return ye.input=le,ye}return re(ge,Mt),ge.prototype.iterator=function(){return J(this,void 0,void 0,function(){var le;return R(this,function(ye){switch(ye.label){case 0:return[4,this.input.iterator()];case 1:return le=ye.sent(),[2,le.decodeUTF8().split(`
`).map(function(_e){return _e.endsWith("\r")&&(_e=_e.slice(0,-1)),_e})]}})})},ge}(Lt),Yn=Symbol("out"),Dr=Symbol("field"),pr=Symbol("quote"),Nr=Symbol("quoteafterquote"),Fr=Symbol("quoteinquote"),an=function(Mt){function ge(le,ye){var _e=Mt.call(this)||this;return _e.input=le,_e.hasHeader=!0,_e.fullColumnNames=null,_e.columnNamesValidated=!1,_e.columnConfigs=null,_e.configuredColumnsOnly=!1,_e.delimiter=",",_e.delimWhitespace=!1,_e.base=new be(le),ye||(ye={}),_e.hasHeader=ye.hasHeader!==!1,_e.fullColumnNames=ye.columnNames,_e.columnConfigs=ye.columnConfigs,_e.configuredColumnsOnly=ye.configuredColumnsOnly,ye.delimWhitespace?(U.util.assert(ye.delimiter==null,function(){return"Delimiter should not be provided when delimWhitespace is true."}),_e.delimWhitespace=!0,_e.delimiter=" "):_e.delimiter=ye.delimiter?ye.delimiter:",",_e}return re(ge,Mt),ge.prototype.columnNames=function(){return J(this,void 0,void 0,function(){return R(this,function(le){switch(le.label){case 0:return this.columnNamesValidated?[3,2]:[4,this.setColumnNames()];case 1:le.sent(),le.label=2;case 2:return[2,this.configuredColumnsOnly?Object.keys(this.columnConfigs):this.fullColumnNames]}})})},ge.prototype.setColumnNames=function(){return J(this,void 0,void 0,function(){var le,ye,_e,et,gt,Rt,fn=this;return R(this,function(Jn){switch(Jn.label){case 0:return[4,this.maybeReadHeaderLine()];case 1:if(le=Jn.sent(),!this.fullColumnNames&&!le)throw new Error("Column names must be provided if there is no header line.");if(this.fullColumnNames&&le&&U.util.assert(le.length===this.fullColumnNames.length,function(){return"The length of provided columnNames ("+fn.fullColumnNames.length.toString()+") does not match the length of the header line read from file ("+le.length.toString()+")."}),this.fullColumnNames||(this.fullColumnNames=le),ye=this.fullColumnNames.reduce(function(An,Ln){return An[Ln]=An[Ln]+1||1,An},{}),_e=Object.keys(ye).filter(function(An){return ye[An]>1}),U.util.assert(_e.length===0,function(){return"Duplicate column names found: "+_e.toString()}),this.columnConfigs){for(et=0,gt=Object.keys(this.columnConfigs);et<gt.length;et++)if(Rt=gt[et],this.fullColumnNames.indexOf(Rt)===-1)throw new Error('The key "'+Rt+'" provided in columnConfigs does not match any of the column names ('+this.fullColumnNames.toString()+").")}return this.columnNamesValidated=!0,[2]}})})},ge.prototype.maybeReadHeaderLine=function(){return J(this,void 0,void 0,function(){var le,ye;return R(this,function(_e){switch(_e.label){case 0:return this.hasHeader?[4,this.base.iterator()]:[3,3];case 1:return[4,_e.sent().next()];case 2:if((le=_e.sent()).done)throw new Error("No data was found for CSV parsing.");return ye=le.value,[2,this.parseRow(ye,!1)];case 3:return[2,null]}})})},ge.prototype.iterator=function(){return J(this,void 0,void 0,function(){var le,ye=this;return R(this,function(_e){switch(_e.label){case 0:return this.columnNamesValidated?[3,2]:[4,this.setColumnNames()];case 1:_e.sent(),_e.label=2;case 2:return[4,this.base.iterator()];case 3:return le=_e.sent(),this.hasHeader&&(le=le.skip(1)),[2,le.map(function(et){return ye.makeDataElement(et)})]}})})},ge.prototype.makeDataElement=function(le){for(var ye=this.parseRow(le),_e={},et={},gt=0;gt<this.fullColumnNames.length;gt++){var Rt=this.fullColumnNames[gt],fn=this.columnConfigs?this.columnConfigs[Rt]:null;if(!this.configuredColumnsOnly||fn){var Jn=ye[gt],An=null;if(Jn==="")if(fn&&fn.default!==void 0)An=fn.default;else{if(fn&&(fn.required||fn.isLabel))throw new Error("Required column "+Rt+" is empty in this line: "+le);An=void 0}else{var Ln=Number(Jn);if(isNaN(Ln))An=fn&&fn.dtype==="bool"?this.getBoolean(Jn):Jn;else if(fn&&fn.dtype)switch(fn.dtype){case"float32":An=Ln;break;case"int32":An=Math.floor(Ln);break;case"bool":An=this.getBoolean(Jn);break;default:An=Ln}else An=Ln}fn&&fn.isLabel?et[Rt]=An:_e[Rt]=An}}return Object.keys(et).length===0?_e:{xs:_e,ys:et}},ge.prototype.getBoolean=function(le){return le==="1"||le.toLowerCase()==="true"?1:0},ge.prototype.parseRow=function(le,ye){ye===void 0&&(ye=!0);for(var _e=[],et=0,gt=le.length,Rt=Yn,fn=0;fn<gt;fn++)switch(Rt){case Yn:switch(le.charAt(fn)){case'"':et=fn+1,Rt=pr;break;case this.delimiter:if(et=fn+1,this.delimiter===" "&&this.delimWhitespace)break;_e.push(""),Rt=Yn;break;default:Rt=Dr,et=fn}break;case Dr:switch(le.charAt(fn)){case this.delimiter:_e.push(le.substring(et,fn)),Rt=Yn,et=fn+1}break;case pr:switch(le.charAt(fn)){case'"':Rt=Nr}break;case Nr:switch(le.charAt(fn)){case this.delimiter:_e.push(le.substring(et,fn-1)),Rt=Yn,et=fn+1;break;case'"':Rt=pr;break;default:Rt=Fr}break;case Fr:switch(le.charAt(fn)){case'"':Rt=pr}}if(Rt===Nr?_e.push(le.substring(et,gt-1)):_e.push(le.substring(et)),ye&&_e.length!==this.fullColumnNames.length)throw new Error("Invalid row in csv file. Should have "+this.fullColumnNames.length+" elements in a row, but got "+_e);return _e},ge}(Lt),Kt=function(Mt){function ge(le){var ye=Mt.call(this)||this;ye.microphoneConfig=le,ye.isClosed=!1,ye.fftSize=le.fftSize||1024;var _e=Math.log2(ye.fftSize);if(ye.fftSize<0||_e<4||_e>14||!Number.isInteger(_e))throw new Error("Invalid fftSize: it must be a power of 2 between 2 to 4 and 2 to 14, but got "+ye.fftSize);if(ye.numFrames=le.numFramesPerSpectrogram||43,ye.sampleRateHz=le.sampleRateHz,ye.columnTruncateLength=le.columnTruncateLength||ye.fftSize,ye.audioTrackConstraints=le.audioTrackConstraints,ye.smoothingTimeConstant=le.smoothingTimeConstant||0,ye.includeSpectrogram=le.includeSpectrogram!==!1,ye.includeWaveform=le.includeWaveform===!0,!ye.includeSpectrogram&&!ye.includeWaveform)throw new Error("Both includeSpectrogram and includeWaveform are false. At least one type of data should be returned.");return ye}return re(ge,Mt),ge.prototype.summary=function(){return"microphone"},ge.create=function(le){return le===void 0&&(le={}),J(this,void 0,void 0,function(){var ye;return R(this,function(_e){switch(_e.label){case 0:if(Object(U.env)().get("IS_NODE"))throw new Error("microphone API is only supported in browser environment.");return[4,(ye=new ge(le)).start()];case 1:return _e.sent(),[2,ye]}})})},ge.prototype.start=function(){return J(this,void 0,void 0,function(){var le,ye,_e,et;return R(this,function(gt){switch(gt.label){case 0:return gt.trys.push([0,2,,3]),le=this,[4,navigator.mediaDevices.getUserMedia({audio:this.audioTrackConstraints==null||this.audioTrackConstraints,video:!1})];case 1:return le.stream=gt.sent(),[3,3];case 2:throw ye=gt.sent(),new Error("Error thrown while initializing video stream: "+ye.message);case 3:if(!this.stream)throw new Error("Could not obtain audio from microphone.");if(_e=window.AudioContext||window.webkitAudioContext,this.audioContext=new _e,this.sampleRateHz){if(this.audioContext.sampleRate!==this.sampleRateHz)throw new Error("Mismatch in sampling rate: Expected: "+this.sampleRateHz+"; Actual: "+this.audioContext.sampleRate)}else this.sampleRateHz=this.audioContext.sampleRate;return et=this.audioContext.createMediaStreamSource(this.stream),this.analyser=this.audioContext.createAnalyser(),this.analyser.fftSize=2*this.fftSize,this.analyser.smoothingTimeConstant=this.smoothingTimeConstant,et.connect(this.analyser),this.freqData=new Float32Array(this.fftSize),this.timeData=new Float32Array(this.fftSize),[2]}})})},ge.prototype.next=function(){return J(this,void 0,void 0,function(){var le,ye,_e,et,gt;return R(this,function(Rt){switch(Rt.label){case 0:return this.isClosed?[2,{value:null,done:!0}]:[4,this.getAudioData()];case 1:return _e=Rt.sent(),this.includeSpectrogram&&(et=this.flattenQueue(_e.freqDataQueue),le=this.getTensorFromAudioDataArray(et,[this.numFrames,this.columnTruncateLength,1])),this.includeWaveform&&(gt=this.flattenQueue(_e.timeDataQueue),ye=this.getTensorFromAudioDataArray(gt,[this.numFrames*this.fftSize,1])),[2,{value:{spectrogram:le,waveform:ye},done:!1}]}})})},ge.prototype.capture=function(){return J(this,void 0,void 0,function(){return R(this,function(le){switch(le.label){case 0:return[4,this.next()];case 1:return[2,le.sent().value]}})})},ge.prototype.getAudioData=function(){return J(this,void 0,void 0,function(){var le,ye,_e,et=this;return R(this,function(gt){return le=[],ye=[],_e=0,[2,new Promise(function(Rt){var fn=setInterval(function(){et.includeSpectrogram&&(et.analyser.getFloatFrequencyData(et.freqData),et.freqData[0]===-1/0&&Rt({freqDataQueue:le,timeDataQueue:ye}),le.push(et.freqData.slice(0,et.columnTruncateLength))),et.includeWaveform&&(et.analyser.getFloatTimeDomainData(et.timeData),ye.push(et.timeData.slice())),++_e===et.numFrames&&(clearInterval(fn),Rt({freqDataQueue:le,timeDataQueue:ye}))},et.fftSize/et.sampleRateHz*1e3)})]})})},ge.prototype.stop=function(){this.isClosed||(this.isClosed=!0,this.analyser.disconnect(),this.audioContext.close(),this.stream!=null&&this.stream.getTracks().length>0&&this.stream.getTracks()[0].stop())},ge.prototype.toArray=function(){throw new Error("Can not convert infinite audio stream to array.")},ge.prototype.getSampleRate=function(){return this.sampleRateHz},ge.prototype.flattenQueue=function(le){var ye=le[0].length,_e=new Float32Array(le.length*ye);return le.forEach(function(et,gt){return _e.set(et,gt*ye)}),_e},ge.prototype.getTensorFromAudioDataArray=function(le,ye){var _e=new Float32Array(U.util.sizeFromShape(ye));return _e.set(le,_e.length-le.length),Object(U.tensor)(_e,ye)},ge}(jt),Zt=function(Mt){function ge(le,ye){var _e=Mt.call(this)||this;if(_e.webcamVideoElement=le,_e.webcamConfig=ye,_e.isClosed=!0,_e.resize=!1,_e.needToResize())if(_e.resize=!0,_e.cropSize=[_e.webcamConfig.resizeHeight,_e.webcamConfig.resizeWidth],_e.cropBoxInd=Object(U.tensor1d)([0],"int32"),_e.webcamConfig.centerCrop){var et=1*_e.webcamConfig.resizeWidth/_e.webcamVideoElement.width,gt=1*_e.webcamConfig.resizeHeight/_e.webcamVideoElement.height,Rt=(1-et)/2,fn=(1-gt)/2,Jn=Rt+et,An=gt+fn;_e.cropBox=Object(U.tensor2d)([fn,Rt,An,Jn],[1,4])}else _e.cropBox=Object(U.tensor2d)([0,0,1,1],[1,4]);return _e}return re(ge,Mt),ge.prototype.summary=function(){return"webcam"},ge.create=function(le,ye){return ye===void 0&&(ye={}),J(this,void 0,void 0,function(){var _e;return R(this,function(et){switch(et.label){case 0:if(Object(U.env)().get("IS_NODE"))throw new Error("tf.data.webcam is only supported in browser environment.");if(!le){if(le=document.createElement("video"),!ye.resizeWidth||!ye.resizeHeight)throw new Error("Please provide webcam video element, or resizeWidth and resizeHeight to create a hidden video element.");le.width=ye.resizeWidth,le.height=ye.resizeHeight}return[4,(_e=new ge(le,ye)).start()];case 1:return et.sent(),[2,_e]}})})},ge.prototype.start=function(){return J(this,void 0,void 0,function(){var le,ye,_e=this;return R(this,function(et){switch(et.label){case 0:this.webcamConfig.facingMode&&U.util.assert(this.webcamConfig.facingMode==="user"||this.webcamConfig.facingMode==="environment",function(){return"Invalid webcam facing mode: "+_e.webcamConfig.facingMode+". Please provide 'user' or 'environment'"}),et.label=1;case 1:return et.trys.push([1,3,,4]),le=this,[4,navigator.mediaDevices.getUserMedia({video:{deviceId:this.webcamConfig.deviceId,facingMode:this.webcamConfig.facingMode?this.webcamConfig.facingMode:"user",width:this.webcamVideoElement.width,height:this.webcamVideoElement.height}})];case 2:return le.stream=et.sent(),[3,4];case 3:throw(ye=et.sent()).message="Error thrown while initializing video stream: "+ye.message,ye;case 4:if(!this.stream)throw new Error("Could not obtain video from webcam.");try{this.webcamVideoElement.srcObject=this.stream}catch(gt){console.log(gt),this.webcamVideoElement.src=window.URL.createObjectURL(this.stream)}return this.webcamVideoElement.play(),this.isClosed=!1,[2,new Promise(function(gt){_e.webcamVideoElement.onloadedmetadata=function(){gt()}})]}})})},ge.prototype.next=function(){return J(this,void 0,void 0,function(){var le;return R(this,function(ye){if(this.isClosed)return[2,{value:null,done:!0}];try{le=U.browser.fromPixels(this.webcamVideoElement)}catch(_e){throw new Error("Error thrown converting video to pixels: "+JSON.stringify(_e))}if(!this.resize)return[2,{value:le,done:!1}];try{return[2,{value:this.cropAndResizeFrame(le),done:!1}]}catch(_e){throw new Error("Error thrown cropping the video: "+_e.message)}finally{le.dispose()}return[2]})})},ge.prototype.needToResize=function(){return!(!this.webcamConfig.resizeWidth||!this.webcamConfig.resizeHeight||this.webcamVideoElement.width===this.webcamConfig.resizeWidth&&this.webcamVideoElement.height===this.webcamConfig.resizeHeight)},ge.prototype.cropAndResizeFrame=function(le){var ye=this;return Object(U.tidy)(function(){var _e,et=le.toFloat().expandDims(0),gt=(_e=U.image.cropAndResize(et,ye.cropBox,ye.cropBoxInd,ye.cropSize,"bilinear")).shape;return _e.reshape(gt.slice(1))})},ge.prototype.capture=function(){return J(this,void 0,void 0,function(){return R(this,function(le){switch(le.label){case 0:return[4,this.next()];case 1:return[2,le.sent().value]}})})},ge.prototype.stop=function(){this.stream.getTracks().forEach(function(le){return le.stop()});try{this.webcamVideoElement.srcObject=null}catch(le){console.log(le),this.webcamVideoElement.src=null}this.isClosed=!0},ge.prototype.toArray=function(){throw new Error("Can not convert infinite video stream to array.")},ge}(jt),$n=function(){},Dn=function(Mt){function ge(){return Mt!==null&&Mt.apply(this,arguments)||this}return re(ge,Mt),ge.prototype.split=function(le){return new hr(this,le)},ge}(jt),hr=function(Mt){function ge(le,ye){var _e=Mt.call(this)||this;return _e.upstream=le,_e.impl=new wr(le,ye),_e}return re(ge,Mt),ge.prototype.summary=function(){return this.impl.summary()},ge.prototype.next=function(){return J(this,void 0,void 0,function(){return R(this,function(le){return[2,this.impl.next()]})})},ge}(Dn),wr=function(Mt){function ge(le,ye){var _e=Mt.call(this)||this;return _e.upstream=le,_e.separator=ye,_e.carryover="",_e}return re(ge,Mt),ge.prototype.summary=function(){return this.upstream.summary()+" -> Split('"+this.separator+"')"},ge.prototype.pump=function(){return J(this,void 0,void 0,function(){var le,ye,_e,et,gt;return R(this,function(Rt){switch(Rt.label){case 0:return[4,this.upstream.next()];case 1:if((le=Rt.sent()).done)return this.carryover===""?[2,!1]:(this.outputQueue.push(this.carryover),this.carryover="",[2,!0]);for((ye=le.value.split(this.separator))[0]=this.carryover+ye[0],_e=0,et=ye.slice(0,-1);_e<et.length;_e++)gt=et[_e],this.outputQueue.push(gt);return this.carryover=ye[ye.length-1],[2,!0]}})})},ge}(Hn),gr=function(Mt){function ge(){return Mt!==null&&Mt.apply(this,arguments)||this}return re(ge,Mt),ge.prototype.decodeUTF8=function(){return new Qr(this)},ge}(jt),Qr=function(Mt){function ge(le){var ye=Mt.call(this)||this;return ye.upstream=le,ye.impl=new ti(le),ye}return re(ge,Mt),ge.prototype.summary=function(){return this.impl.summary()},ge.prototype.next=function(){return J(this,void 0,void 0,function(){return R(this,function(le){return[2,this.impl.next()]})})},ge}(Dn),ti=function(Mt){function ge(le){var ye=Mt.call(this)||this;if(ye.upstream=le,Object(U.env)().get("IS_BROWSER"))ye.decoder=new TextDecoder("utf-8");else{var _e=a(386).StringDecoder;ye.decoder=new _e("utf8")}return ye}return re(ge,Mt),ge.prototype.summary=function(){return this.upstream.summary()+" -> Utf8"},ge.prototype.pump=function(){return J(this,void 0,void 0,function(){var le,ye,_e;return R(this,function(et){switch(et.label){case 0:return[4,this.upstream.next()];case 1:return(le=et.sent()).done?[2,!1]:(ye=le.value,_e=Object(U.env)().get("IS_BROWSER")?this.decoder.decode(ye,{stream:!0}):this.decoder.write($.from(ye.buffer)),this.outputQueue.push(_e),[2,!0])}})})},ge}(Hn),Mr=function(Mt){function ge(le,ye){ye===void 0&&(ye={});var _e=Mt.call(this)||this;return _e.file=le,_e.options=ye,U.util.assert(le instanceof Uint8Array||!!Object(U.env)().get("IS_BROWSER")&&(le instanceof File||le instanceof Blob),function(){return"FileChunkIterator only supports File, Blob and Uint8Array right now."}),_e.offset=ye.offset||0,_e.chunkSize=ye.chunkSize||1048576,_e}return re(ge,Mt),ge.prototype.summary=function(){return"FileChunks "+this.file},ge.prototype.next=function(){return J(this,void 0,void 0,function(){var le,ye,_e=this;return R(this,function(et){switch(et.label){case 0:return this.offset>=(this.file instanceof Uint8Array?this.file.byteLength:this.file.size)?[2,{value:null,done:!0}]:(le=new Promise(function(gt,Rt){var fn=_e.offset+_e.chunkSize;if(_e.file instanceof Uint8Array)gt(new Uint8Array(_e.file.slice(_e.offset,fn)));else{var Jn=new FileReader;Jn.onload=function(Ln){var qn=Jn.result;if(qn instanceof ArrayBuffer&&(qn=new Uint8Array(qn)),!(qn instanceof Uint8Array))return Rt(new TypeError("FileReader returned unknown type."));gt(qn)},Jn.onabort=function(Ln){return Rt(new Error("Aborted"))},Jn.onerror=function(Ln){return Rt(new Error(Ln.type))};var An=_e.file.slice(_e.offset,fn);Jn.readAsArrayBuffer(An)}_e.offset=fn}),ye={},[4,le]);case 1:return[2,(ye.value=et.sent(),ye.done=!1,ye)]}})})},ge}(gr),di=function(Mt){return{method:Mt.method,headers:Mt.headers,body:Mt.body,mode:Mt.mode,credentials:Mt.credentials,cache:Mt.cache,redirect:Mt.redirect,referrer:Mt.referrer,integrity:Mt.integrity}};function Yr(Mt){return typeof Mt=="string"&&Mt.substr(0,7)==="file://"}var Xr=function(Mt){function ge(le,ye){ye===void 0&&(ye={});var _e=Mt.call(this)||this;return _e.input=le,_e.options=ye,_e}return re(ge,Mt),ge.prototype.iterator=function(){return J(this,void 0,void 0,function(){var le;return R(this,function(ye){return Yr(this.input)&&Object(U.env)().get("IS_NODE")&&(le=a(385),this.input=le.readFileSync(this.input.substr(7))),[2,new Mr(this.input,this.options)]})})},ge}($n),fi=function(Mt){function ge(le,ye){ye===void 0&&(ye={});var _e=Mt.call(this)||this;return _e.url=le,_e.fileOptions=ye,_e}return re(ge,Mt),ge.prototype.iterator=function(){return J(this,void 0,void 0,function(){return R(this,function(le){return Yr(this.url)?[2,new Xr(this.url,this.fileOptions).iterator()]:[2,function(ye,_e){return _e===void 0&&(_e={}),J(this,void 0,void 0,function(){var et,gt,Rt,fn,Jn;return R(this,function(An){switch(An.label){case 0:return typeof ye=="string"?et=ye:(et=ye.url,gt=di(ye)),[4,U.util.fetch(et,gt)];case 1:return(Rt=An.sent()).ok?(Jn=Uint8Array.bind,[4,Rt.arrayBuffer()]):[3,3];case 2:return fn=new(Jn.apply(Uint8Array,[void 0,An.sent()])),[2,new Mr(fn,_e)];case 3:throw new Error(Rt.statusText)}})})}(this.url,this.fileOptions)]})})},ge}($n);function oi(Mt,ge){return ge===void 0&&(ge={}),new an(new fi(Mt),ge)}function Ao(Mt){var ge=this,le=Ft(Mt);return zt(function(){return J(ge,void 0,void 0,function(){return R(this,function(ye){return[2,le]})})})}function Wi(Mt){var ge=this;return zt(function(){return J(ge,void 0,void 0,function(){var le;return R(this,function(ye){switch(ye.label){case 0:return[4,Mt()];case 1:return le=ye.sent(),[2,Ft(function(){return le.next()})]}})})})}function Ei(Mt,ge){return J(this,void 0,void 0,function(){return R(this,function(le){return[2,Zt.create(Mt,ge)]})})}function bt(Mt){return J(this,void 0,void 0,function(){return R(this,function(ge){return[2,Kt.create(Mt)]})})}var Lr="1.7.4"}.call(this,a(59),a(92).Buffer)},function(Oe,A,a){function b($){var U="";if(!$)try{$=a(185)}catch(B){U=B.toString()}return{readFile:$?function(B){return new Promise(function(re,J){$.readFile(B,function(R,W){return R?J(R):re(W)})})}:function(){throw new Error("readFile - failed to require fs in nodejs environment with error: "+U)}}}a.d(A,"a",function(){return b})},function(Oe){Oe.exports={a:"0.12.2"}},function(Oe,A,a){var b=/("(?:[^\\"]|\\.)*")|[:,]/g;Oe.exports=function($,U){var B,re,J;return U=U||{},B=JSON.stringify([1],void 0,U.indent===void 0?2:U.indent).slice(2,-3),re=B===""?1/0:U.maxLength===void 0?80:U.maxLength,J=U.replacer,function R(W,q,P){var ee,I,se,ie,K,de,pe,Ae,Te,je,we,ot;if(W&&typeof W.toJSON=="function"&&(W=W.toJSON()),(we=JSON.stringify(W,J))===void 0)return we;if(pe=re-q.length-P,we.length<=pe&&(Te=we.replace(b,function(_t,Ut){return Ut||_t+" "})).length<=pe)return Te;if(J!=null&&(W=JSON.parse(we),J=void 0),typeof W=="object"&&W!==null){if(Ae=q+B,se=[],I=0,Array.isArray(W))for(je="[",ee="]",pe=W.length;I<pe;I++)se.push(R(W[I],Ae,I===pe-1?0:1)||"null");else for(je="{",ee="}",pe=(de=Object.keys(W)).length;I<pe;I++)ie=de[I],K=JSON.stringify(ie)+": ",(ot=R(W[ie],Ae,K.length+(I===pe-1?0:1)))!==void 0&&se.push(K+ot);if(se.length>0)return[je,B+se.join(`,
`+Ae),ee].join(`
`+q)}return we}($,"",0)}},function(Oe,A,a){var b=a(31),$=Object(b.a)(function(U){U.setUTCDate(1),U.setUTCHours(0,0,0,0)},function(U,B){U.setUTCMonth(U.getUTCMonth()+B)},function(U,B){return B.getUTCMonth()-U.getUTCMonth()+12*(B.getUTCFullYear()-U.getUTCFullYear())},function(U){return U.getUTCMonth()});A.a=$,$.range},function(Oe,A,a){var b=a(31),$=Object(b.a)(function(U){U.setDate(1),U.setHours(0,0,0,0)},function(U,B){U.setMonth(U.getMonth()+B)},function(U,B){return B.getMonth()-U.getMonth()+12*(B.getFullYear()-U.getFullYear())},function(U){return U.getMonth()});A.a=$,$.range},function(Oe,A,a){(function(b){var $=a(36),U=a(275),B=a(193),re={"Content-Type":"application/x-www-form-urlencoded"};function J(W,q){!$.isUndefined(W)&&$.isUndefined(W["Content-Type"])&&(W["Content-Type"]=q)}var R={transitional:{silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},adapter:function(){var W;return(typeof XMLHttpRequest<"u"||b!==void 0&&Object.prototype.toString.call(b)==="[object process]")&&(W=a(192)),W}(),transformRequest:[function(W,q){return U(q,"Accept"),U(q,"Content-Type"),$.isFormData(W)||$.isArrayBuffer(W)||$.isBuffer(W)||$.isStream(W)||$.isFile(W)||$.isBlob(W)?W:$.isArrayBufferView(W)?W.buffer:$.isURLSearchParams(W)?(J(q,"application/x-www-form-urlencoded;charset=utf-8"),W.toString()):$.isObject(W)||q&&q["Content-Type"]==="application/json"?(J(q,"application/json"),function(P,ee,I){if($.isString(P))try{return(ee||JSON.parse)(P),$.trim(P)}catch(se){if(se.name!=="SyntaxError")throw se}return(I||JSON.stringify)(P)}(W)):W}],transformResponse:[function(W){var q=this.transitional,P=q&&q.silentJSONParsing,ee=q&&q.forcedJSONParsing,I=!P&&this.responseType==="json";if(I||ee&&$.isString(W)&&W.length)try{return JSON.parse(W)}catch(se){if(I)throw se.name==="SyntaxError"?B(se,this,"E_JSON_PARSE"):se}return W}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,validateStatus:function(W){return W>=200&&W<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};$.forEach(["delete","get","head"],function(W){R.headers[W]={}}),$.forEach(["post","put","patch"],function(W){R.headers[W]=$.merge(re)}),Oe.exports=R}).call(this,a(75))},function(Oe,A,a){/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/var b=this&&this.__awaiter||function(q,P,ee,I){return new(ee||(ee=Promise))(function(se,ie){function K(Ae){try{pe(I.next(Ae))}catch(Te){ie(Te)}}function de(Ae){try{pe(I.throw(Ae))}catch(Te){ie(Te)}}function pe(Ae){Ae.done?se(Ae.value):new ee(function(Te){Te(Ae.value)}).then(K,de)}pe((I=I.apply(q,P||[])).next())})},$=this&&this.__importDefault||function(q){return q&&q.__esModule?q:{default:q}};Object.defineProperty(A,"__esModule",{value:!0});const U=a(50),B=$(a(88)),re=a(64),J=a(110),R=a(109),W={maxBins:12,fontSize:11};A.histogram=function(q,P,ee={}){return b(this,void 0,void 0,function*(){const I=function(pe){if(pe.length==null)throw new Error("input data must be an array");if(pe.length===0)return[];if(typeof pe[0]=="object"){if(pe[0].value==null)throw new Error("input data must have a value field");return pe}{const Ae=Array(pe.length);for(let Te=0;Te<pe.length;Te++)Ae[Te]={value:pe[Te]};return Ae}}(P),se=Object.assign({},W,ee),ie=re.subSurface(q,"histogram");if(ee.stats!==!1){const pe=re.subSurface(q,"stats",{prepend:!0});(function(Ae,Te,je){const we=U.format(",.4~f"),ot=U.format(".4~p"),_t=[],Ut=[];if(Ae.numVals!=null&&(_t.push("Num Vals"),Ut.push(we(Ae.numVals))),Ae.min!=null&&(_t.push("Min"),Ut.push(we(Ae.min))),Ae.max!=null&&(_t.push("Max"),Ut.push(we(Ae.max))),Ae.numZeros!=null){_t.push("# Zeros");let Xt="";Ae.numVals&&(Xt=Ae.numZeros>0?`(${ot(Ae.numZeros/Ae.numVals)})`:""),Ut.push(`${we(Ae.numZeros)} ${Xt}`)}if(Ae.numNans!=null){_t.push("# NaNs");let Xt="";Ae.numVals&&(Xt=Ae.numNans>0?`(${ot(Ae.numNans/Ae.numVals)})`:""),Ut.push(`${we(Ae.numNans)} ${Xt}`)}if(Ae.numInfs!=null){_t.push("# Infinity");let Xt="";Ae.numVals&&(Xt=Ae.numInfs>0?`(${ot(Ae.numInfs/Ae.numVals)})`:""),Ut.push(`${we(Ae.numInfs)} ${Xt}`)}R.table(Te,{headers:_t,values:[Ut]},je)})(ee.stats?ee.stats:J.arrayStats(I.map(Ae=>Ae.value)),pe,{fontSize:se.fontSize})}if(I.length===0)return;const K=[];for(let pe=0;pe<I.length;pe++){const Ae=I[pe].value;Ae!=null&&isFinite(Ae)&&K.push(I[pe])}const de={width:se.width||re.getDefaultWidth(ie),height:se.height||re.getDefaultHeight(ie),padding:0,autosize:{type:"fit",contains:"padding",resize:!0},data:{values:K},mark:{type:"bar",tooltip:!0},config:{axis:{labelFontSize:se.fontSize,titleFontSize:se.fontSize},text:{fontSize:se.fontSize},legend:{labelFontSize:se.fontSize,titleFontSize:se.fontSize}},encoding:{x:{bin:{maxbins:se.maxBins},field:"value",type:"quantitative"},y:{aggregate:"count",type:"quantitative"},color:{value:se.color||"#001B44"}}};return B.default(ie,de,{actions:!1,mode:"vega-lite",defaultStyle:!1})})}},function(Oe,A,a){a.r(A),a.d(A,"h",function(){return B}),a.d(A,"createElement",function(){return B}),a.d(A,"cloneElement",function(){return R}),a.d(A,"Component",function(){return Bt}),a.d(A,"render",function(){return Pt}),a.d(A,"rerender",function(){return ee}),a.d(A,"options",function(){return b});var b={},$=[],U=[];function B(Dt,St){var wn,Bn,Hn,hn,Ve=U;for(hn=arguments.length;hn-- >2;)$.push(arguments[hn]);for(St&&St.children!=null&&($.length||$.push(St.children),delete St.children);$.length;)if((Bn=$.pop())&&Bn.pop!==void 0)for(hn=Bn.length;hn--;)$.push(Bn[hn]);else typeof Bn=="boolean"&&(Bn=null),(Hn=typeof Dt!="function")&&(Bn==null?Bn="":typeof Bn=="number"?Bn=String(Bn):typeof Bn!="string"&&(Hn=!1)),Hn&&wn?Ve[Ve.length-1]+=Bn:Ve===U?Ve=[Bn]:Ve.push(Bn),wn=Hn;var Qe=new function(){};return Qe.nodeName=Dt,Qe.children=Ve,Qe.attributes=St??void 0,Qe.key=St==null?void 0:St.key,b.vnode!==void 0&&b.vnode(Qe),Qe}function re(Dt,St){for(var wn in St)Dt[wn]=St[wn];return Dt}var J=typeof Promise=="function"?Promise.resolve().then.bind(Promise.resolve()):setTimeout;function R(Dt,St){return B(Dt.nodeName,re(re({},Dt.attributes),St),arguments.length>2?[].slice.call(arguments,2):Dt.children)}var W=/acit|ex(?:s|g|n|p|$)|rph|ows|mnc|ntw|ine[ch]|zoo|^ord/i,q=[];function P(Dt){!Dt._dirty&&(Dt._dirty=!0)&&q.push(Dt)==1&&(b.debounceRendering||J)(ee)}function ee(){var Dt,St=q;for(q=[];Dt=St.pop();)Dt._dirty&&ln(Dt)}function I(Dt,St,wn){return typeof St=="string"||typeof St=="number"?Dt.splitText!==void 0:typeof St.nodeName=="string"?!Dt._componentConstructor&&se(Dt,St.nodeName):wn||Dt._componentConstructor===St.nodeName}function se(Dt,St){return Dt.normalizedNodeName===St||Dt.nodeName.toLowerCase()===St.toLowerCase()}function ie(Dt){var St=re({},Dt.attributes);St.children=Dt.children;var wn=Dt.nodeName.defaultProps;if(wn!==void 0)for(var Bn in wn)St[Bn]===void 0&&(St[Bn]=wn[Bn]);return St}function K(Dt){var St=Dt.parentNode;St&&St.removeChild(Dt)}function de(Dt,St,wn,Bn,Hn){if(St==="className"&&(St="class"),St!=="key")if(St==="ref")wn&&wn(null),Bn&&Bn(Dt);else if(St!=="class"||Hn)if(St==="style"){if(Bn&&typeof Bn!="string"&&typeof wn!="string"||(Dt.style.cssText=Bn||""),Bn&&typeof Bn=="object"){if(typeof wn!="string")for(var hn in wn)hn in Bn||(Dt.style[hn]="");for(var hn in Bn)Dt.style[hn]=typeof Bn[hn]=="number"&&W.test(hn)===!1?Bn[hn]+"px":Bn[hn]}}else if(St==="dangerouslySetInnerHTML")Bn&&(Dt.innerHTML=Bn.__html||"");else if(St[0]=="o"&&St[1]=="n"){var Ve=St!==(St=St.replace(/Capture$/,""));St=St.toLowerCase().substring(2),Bn?wn||Dt.addEventListener(St,pe,Ve):Dt.removeEventListener(St,pe,Ve),(Dt._listeners||(Dt._listeners={}))[St]=Bn}else if(St!=="list"&&St!=="type"&&!Hn&&St in Dt)(function(He,pt,Lt){try{He[pt]=Lt}catch{}})(Dt,St,Bn??""),Bn!=null&&Bn!==!1||Dt.removeAttribute(St);else{var Qe=Hn&&St!==(St=St.replace(/^xlink:?/,""));Bn==null||Bn===!1?Qe?Dt.removeAttributeNS("http://www.w3.org/1999/xlink",St.toLowerCase()):Dt.removeAttribute(St):typeof Bn!="function"&&(Qe?Dt.setAttributeNS("http://www.w3.org/1999/xlink",St.toLowerCase(),Bn):Dt.setAttribute(St,Bn))}else Dt.className=Bn||""}function pe(Dt){return this._listeners[Dt.type](b.event&&b.event(Dt)||Dt)}var Ae=[],Te=0,je=!1,we=!1;function ot(){for(var Dt;Dt=Ae.pop();)b.afterMount&&b.afterMount(Dt),Dt.componentDidMount&&Dt.componentDidMount()}function _t(Dt,St,wn,Bn,Hn,hn){Te++||(je=Hn!=null&&Hn.ownerSVGElement!==void 0,we=Dt!=null&&!("__preactattr_"in Dt));var Ve=Ut(Dt,St,wn,Bn,hn);return Hn&&Ve.parentNode!==Hn&&Hn.appendChild(Ve),--Te||(we=!1,hn||ot()),Ve}function Ut(Dt,St,wn,Bn,Hn){var hn=Dt,Ve=je;if(St!=null&&typeof St!="boolean"||(St=""),typeof St=="string"||typeof St=="number")return Dt&&Dt.splitText!==void 0&&Dt.parentNode&&(!Dt._component||Hn)?Dt.nodeValue!=St&&(Dt.nodeValue=St):(hn=document.createTextNode(St),Dt&&(Dt.parentNode&&Dt.parentNode.replaceChild(hn,Dt),Xt(Dt,!0))),hn.__preactattr_=!0,hn;var Qe=St.nodeName;if(typeof Qe=="function")return function(xn,Kn,be,Yn){for(var Dr=xn&&xn._component,pr=Dr,Nr=xn,Fr=Dr&&xn._componentConstructor===Kn.nodeName,an=Fr,Kt=ie(Kn);Dr&&!an&&(Dr=Dr._parentComponent);)an=Dr.constructor===Kn.nodeName;return Dr&&an&&(!Yn||Dr._component)?(Ye(Dr,Kt,3,be,Yn),xn=Dr.base):(pr&&!Fr&&(nn(pr),xn=Nr=null),Dr=Gt(Kn.nodeName,Kt,be),xn&&!Dr.nextBase&&(Dr.nextBase=xn,Nr=null),Ye(Dr,Kt,1,be,Yn),xn=Dr.base,Nr&&xn!==Nr&&(Nr._component=null,Xt(Nr,!1))),xn}(Dt,St,wn,Bn);if(je=Qe==="svg"||Qe!=="foreignObject"&&je,Qe=String(Qe),(!Dt||!se(Dt,Qe))&&(hn=function(xn,Kn){var be=Kn?document.createElementNS("http://www.w3.org/2000/svg",xn):document.createElement(xn);return be.normalizedNodeName=xn,be}(Qe,je),Dt)){for(;Dt.firstChild;)hn.appendChild(Dt.firstChild);Dt.parentNode&&Dt.parentNode.replaceChild(hn,Dt),Xt(Dt,!0)}var He=hn.firstChild,pt=hn.__preactattr_,Lt=St.children;if(pt==null){pt=hn.__preactattr_={};for(var zt=hn.attributes,Tn=zt.length;Tn--;)pt[zt[Tn].name]=zt[Tn].value}return!we&&Lt&&Lt.length===1&&typeof Lt[0]=="string"&&He!=null&&He.splitText!==void 0&&He.nextSibling==null?He.nodeValue!=Lt[0]&&(He.nodeValue=Lt[0]):(Lt&&Lt.length||He!=null)&&function(xn,Kn,be,Yn,Dr){var pr,Nr,Fr,an,Kt,Zt=xn.childNodes,$n=[],Dn={},hr=0,wr=0,gr=Zt.length,Qr=0,ti=Kn?Kn.length:0;if(gr!==0)for(var Mr=0;Mr<gr;Mr++){var di=Zt[Mr],Yr=di.__preactattr_,Xr=ti&&Yr?di._component?di._component.__key:Yr.key:null;Xr!=null?(hr++,Dn[Xr]=di):(Yr||(di.splitText!==void 0?!Dr||di.nodeValue.trim():Dr))&&($n[Qr++]=di)}if(ti!==0)for(var Mr=0;Mr<ti;Mr++){an=Kn[Mr],Kt=null;var Xr=an.key;if(Xr!=null)hr&&Dn[Xr]!==void 0&&(Kt=Dn[Xr],Dn[Xr]=void 0,hr--);else if(!Kt&&wr<Qr){for(pr=wr;pr<Qr;pr++)if($n[pr]!==void 0&&I(Nr=$n[pr],an,Dr)){Kt=Nr,$n[pr]=void 0,pr===Qr-1&&Qr--,pr===wr&&wr++;break}}Kt=Ut(Kt,an,be,Yn),Fr=Zt[Mr],Kt&&Kt!==xn&&Kt!==Fr&&(Fr==null?xn.appendChild(Kt):Kt===Fr.nextSibling?K(Fr):xn.insertBefore(Kt,Fr))}if(hr)for(var Mr in Dn)Dn[Mr]!==void 0&&Xt(Dn[Mr],!1);for(;wr<=Qr;)(Kt=$n[Qr--])!==void 0&&Xt(Kt,!1)}(hn,Lt,wn,Bn,we||pt.dangerouslySetInnerHTML!=null),function(xn,Kn,be){var Yn;for(Yn in be)Kn&&Kn[Yn]!=null||be[Yn]==null||de(xn,Yn,be[Yn],be[Yn]=void 0,je);for(Yn in Kn)Yn==="children"||Yn==="innerHTML"||Yn in be&&Kn[Yn]===(Yn==="value"||Yn==="checked"?xn[Yn]:be[Yn])||de(xn,Yn,be[Yn],be[Yn]=Kn[Yn],je)}(hn,St.attributes,pt),je=Ve,hn}function Xt(Dt,St){var wn=Dt._component;wn?nn(wn):(Dt.__preactattr_!=null&&Dt.__preactattr_.ref&&Dt.__preactattr_.ref(null),St!==!1&&Dt.__preactattr_!=null||K(Dt),ke(Dt))}function ke(Dt){for(Dt=Dt.lastChild;Dt;){var St=Dt.previousSibling;Xt(Dt,!0),Dt=St}}var Ft={};function Gt(Dt,St,wn){var Bn,Hn=Ft[Dt.name];if(Dt.prototype&&Dt.prototype.render?(Bn=new Dt(St,wn),Bt.call(Bn,St,wn)):((Bn=new Bt(St,wn)).constructor=Dt,Bn.render=jt),Hn){for(var hn=Hn.length;hn--;)if(Hn[hn].constructor===Dt){Bn.nextBase=Hn[hn].nextBase,Hn.splice(hn,1);break}}return Bn}function jt(Dt,St,wn){return this.constructor(Dt,wn)}function Ye(Dt,St,wn,Bn,Hn){Dt._disable||(Dt._disable=!0,(Dt.__ref=St.ref)&&delete St.ref,(Dt.__key=St.key)&&delete St.key,!Dt.base||Hn?Dt.componentWillMount&&Dt.componentWillMount():Dt.componentWillReceiveProps&&Dt.componentWillReceiveProps(St,Bn),Bn&&Bn!==Dt.context&&(Dt.prevContext||(Dt.prevContext=Dt.context),Dt.context=Bn),Dt.prevProps||(Dt.prevProps=Dt.props),Dt.props=St,Dt._disable=!1,wn!==0&&(wn!==1&&b.syncComponentUpdates===!1&&Dt.base?P(Dt):ln(Dt,1,Hn)),Dt.__ref&&Dt.__ref(Dt))}function ln(Dt,St,wn,Bn){if(!Dt._disable){var Hn,hn,Ve,Qe=Dt.props,He=Dt.state,pt=Dt.context,Lt=Dt.prevProps||Qe,zt=Dt.prevState||He,Tn=Dt.prevContext||pt,xn=Dt.base,Kn=Dt.nextBase,be=xn||Kn,Yn=Dt._component,Dr=!1;if(xn&&(Dt.props=Lt,Dt.state=zt,Dt.context=Tn,St!==2&&Dt.shouldComponentUpdate&&Dt.shouldComponentUpdate(Qe,He,pt)===!1?Dr=!0:Dt.componentWillUpdate&&Dt.componentWillUpdate(Qe,He,pt),Dt.props=Qe,Dt.state=He,Dt.context=pt),Dt.prevProps=Dt.prevState=Dt.prevContext=Dt.nextBase=null,Dt._dirty=!1,!Dr){Hn=Dt.render(Qe,He,pt),Dt.getChildContext&&(pt=re(re({},pt),Dt.getChildContext()));var pr,Nr,Fr=Hn&&Hn.nodeName;if(typeof Fr=="function"){var an=ie(Hn);(hn=Yn)&&hn.constructor===Fr&&an.key==hn.__key?Ye(hn,an,1,pt,!1):(pr=hn,Dt._component=hn=Gt(Fr,an,pt),hn.nextBase=hn.nextBase||Kn,hn._parentComponent=Dt,Ye(hn,an,0,pt,!1),ln(hn,1,wn,!0)),Nr=hn.base}else Ve=be,(pr=Yn)&&(Ve=Dt._component=null),(be||St===1)&&(Ve&&(Ve._component=null),Nr=_t(Ve,Hn,pt,wn||!xn,be&&be.parentNode,!0));if(be&&Nr!==be&&hn!==Yn){var Kt=be.parentNode;Kt&&Nr!==Kt&&(Kt.replaceChild(Nr,be),pr||(be._component=null,Xt(be,!1)))}if(pr&&nn(pr),Dt.base=Nr,Nr&&!Bn){for(var Zt=Dt,$n=Dt;$n=$n._parentComponent;)(Zt=$n).base=Nr;Nr._component=Zt,Nr._componentConstructor=Zt.constructor}}if(!xn||wn?Ae.unshift(Dt):Dr||(Dt.componentDidUpdate&&Dt.componentDidUpdate(Lt,zt,Tn),b.afterUpdate&&b.afterUpdate(Dt)),Dt._renderCallbacks!=null)for(;Dt._renderCallbacks.length;)Dt._renderCallbacks.pop().call(Dt);Te||Bn||ot()}}function nn(Dt){b.beforeUnmount&&b.beforeUnmount(Dt);var St=Dt.base;Dt._disable=!0,Dt.componentWillUnmount&&Dt.componentWillUnmount(),Dt.base=null;var wn=Dt._component;wn?nn(wn):St&&(St.__preactattr_&&St.__preactattr_.ref&&St.__preactattr_.ref(null),Dt.nextBase=St,K(St),function(Bn){var Hn=Bn.constructor.name;(Ft[Hn]||(Ft[Hn]=[])).push(Bn)}(Dt),ke(St)),Dt.__ref&&Dt.__ref(null)}function Bt(Dt,St){this._dirty=!0,this.context=St,this.props=Dt,this.state=this.state||{}}function Pt(Dt,St,wn){return _t(wn,Dt,{},!1,St,!1)}re(Bt.prototype,{setState:function(Dt,St){var wn=this.state;this.prevState||(this.prevState=re({},wn)),re(wn,typeof Dt=="function"?Dt(wn,this.props):Dt),St&&(this._renderCallbacks=this._renderCallbacks||[]).push(St),P(this)},forceUpdate:function(Dt){Dt&&(this._renderCallbacks=this._renderCallbacks||[]).push(Dt),ln(this,2)},render:function(){}});var gn={h:B,createElement:B,cloneElement:R,Component:Bt,render:Pt,rerender:ee,options:b};A.default=gn},function(Oe,A,a){/*
object-assign
(c) Sindre Sorhus
@license MIT
*/var b=Object.getOwnPropertySymbols,$=Object.prototype.hasOwnProperty,U=Object.prototype.propertyIsEnumerable;Oe.exports=function(){try{if(!Object.assign)return!1;var B=new String("abc");if(B[5]="de",Object.getOwnPropertyNames(B)[0]==="5")return!1;for(var re={},J=0;J<10;J++)re["_"+String.fromCharCode(J)]=J;if(Object.getOwnPropertyNames(re).map(function(W){return re[W]}).join("")!=="0123456789")return!1;var R={};return"abcdefghijklmnopqrst".split("").forEach(function(W){R[W]=W}),Object.keys(Object.assign({},R)).join("")==="abcdefghijklmnopqrst"}catch{return!1}}()?Object.assign:function(B,re){for(var J,R,W=function(I){if(I==null)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(I)}(B),q=1;q<arguments.length;q++){for(var P in J=Object(arguments[q]))$.call(J,P)&&(W[P]=J[P]);if(b){R=b(J);for(var ee=0;ee<R.length;ee++)U.call(J,R[ee])&&(W[R[ee]]=J[R[ee]])}}return W}},function(Oe,A,a){const b=a(32),$=a(113),{ANY:U}=$,B=a(47),re=a(112),J=a(114),R=a(143),W=a(141),q=a(142);Oe.exports=(P,ee,I,se)=>{let ie,K,de,pe,Ae;switch(P=new b(P,se),ee=new B(ee,se),I){case">":ie=J,K=W,de=R,pe=">",Ae=">=";break;case"<":ie=R,K=q,de=J,pe="<",Ae="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(re(P,ee,se))return!1;for(let Te=0;Te<ee.set.length;++Te){let je=null,we=null;if(ee.set[Te].forEach(ot=>{ot.semver===U&&(ot=new $(">=0.0.0")),je=je||ot,we=we||ot,ie(ot.semver,je.semver,se)?je=ot:de(ot.semver,we.semver,se)&&(we=ot)}),je.operator===pe||je.operator===Ae||(!we.operator||we.operator===pe)&&K(P,we.semver)||we.operator===Ae&&de(P,we.semver))return!1}return!0}},function(Oe,A,a){const b=a(48);Oe.exports=($,U,B)=>b($,U,B)<=0},function(Oe,A,a){const b=a(48);Oe.exports=($,U,B)=>b($,U,B)>=0},function(Oe,A,a){const b=a(48);Oe.exports=($,U,B)=>b($,U,B)<0},function(Oe,A,a){const b=a(32);Oe.exports=($,U,B)=>{const re=new b($,B),J=new b(U,B);return re.compare(J)||re.compareBuild(J)}},function(Oe,A,a){const b=a(48);Oe.exports=($,U,B)=>b($,U,B)===0},function(Oe,A){const a=/^[0-9]+$/,b=($,U)=>{const B=a.test($),re=a.test(U);return B&&re&&($=+$,U=+U),$===U?0:B&&!re?-1:re&&!B?1:$<U?-1:1};Oe.exports={compareIdentifiers:b,rcompareIdentifiers:($,U)=>b(U,$)}},function(Oe,A,a){/**
* @license
* Copyright 2017 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Object.defineProperty(A,"__esModule",{value:!0}),A.getBroadcastDims=function(b,$){for(var U=b.length,B=[],re=0;re<U;re++){var J=U-1-re,R=b[J]||1;($[$.length-1-re]||1)>1&&R===1&&B.unshift(J)}return B},A.getReductionAxes=function(b,$){for(var U=[],B=0;B<$.length;B++){var re=b[b.length-B-1],J=$.length-B-1,R=$[J];(re==null||re===1&&R>1)&&U.unshift(J)}return U},A.assertAndGetBroadcastShape=function(b,$){for(var U=[],B=Math.max(b.length,$.length),re=0;re<B;re++){var J=b[b.length-re-1];J==null&&(J=1);var R=$[$.length-re-1];if(R==null&&(R=1),J===1)U.unshift(R);else if(R===1)U.unshift(J);else{if(J!==R)throw Error("Operands could not be broadcast together with shapes "+b+" and "+$+".");U.unshift(J)}}return U}},function(Oe,A,a){Oe.exports=!a(208)(function(){return Object.defineProperty({},"a",{get:function(){return 7}}).a!=7})},function(Oe,A){Oe.exports=function(a){return typeof a=="object"?a!==null:typeof a=="function"}},function(Oe,A){var a=Oe.exports=typeof window<"u"&&window.Math==Math?window:typeof self<"u"&&self.Math==Math?self:Function("return this")();typeof __g=="number"&&(__g=a)},function(Oe,A,a){var b=a(16),$=a(27),U=a(83),B=a(118),re=a(42),J=a(93),R=a(15),W=a(94),q=a(54),P=a(22),ee=a(213),I=a(79).f,se=a(26).f,ie=a(156),K=a(98),de="prototype",pe="Wrong index!",Ae=b.ArrayBuffer,Te=b.DataView,je=b.Math,we=b.RangeError,ot=b.Infinity,_t=Ae,Ut=je.abs,Xt=je.pow,ke=je.floor,Ft=je.log,Gt=je.LN2,jt=$?"_b":"buffer",Ye=$?"_l":"byteLength",ln=$?"_o":"byteOffset";function nn(xn,Kn,be){var Yn,Dr,pr,Nr=new Array(be),Fr=8*be-Kn-1,an=(1<<Fr)-1,Kt=an>>1,Zt=Kn===23?Xt(2,-24)-Xt(2,-77):0,$n=0,Dn=xn<0||xn===0&&1/xn<0?1:0;for((xn=Ut(xn))!=xn||xn===ot?(Dr=xn!=xn?1:0,Yn=an):(Yn=ke(Ft(xn)/Gt),xn*(pr=Xt(2,-Yn))<1&&(Yn--,pr*=2),(xn+=Yn+Kt>=1?Zt/pr:Zt*Xt(2,1-Kt))*pr>=2&&(Yn++,pr/=2),Yn+Kt>=an?(Dr=0,Yn=an):Yn+Kt>=1?(Dr=(xn*pr-1)*Xt(2,Kn),Yn+=Kt):(Dr=xn*Xt(2,Kt-1)*Xt(2,Kn),Yn=0));Kn>=8;Nr[$n++]=255&Dr,Dr/=256,Kn-=8);for(Yn=Yn<<Kn|Dr,Fr+=Kn;Fr>0;Nr[$n++]=255&Yn,Yn/=256,Fr-=8);return Nr[--$n]|=128*Dn,Nr}function Bt(xn,Kn,be){var Yn,Dr=8*be-Kn-1,pr=(1<<Dr)-1,Nr=pr>>1,Fr=Dr-7,an=be-1,Kt=xn[an--],Zt=127&Kt;for(Kt>>=7;Fr>0;Zt=256*Zt+xn[an],an--,Fr-=8);for(Yn=Zt&(1<<-Fr)-1,Zt>>=-Fr,Fr+=Kn;Fr>0;Yn=256*Yn+xn[an],an--,Fr-=8);if(Zt===0)Zt=1-Nr;else{if(Zt===pr)return Yn?NaN:Kt?-ot:ot;Yn+=Xt(2,Kn),Zt-=Nr}return(Kt?-1:1)*Yn*Xt(2,Zt-Kn)}function Pt(xn){return xn[3]<<24|xn[2]<<16|xn[1]<<8|xn[0]}function gn(xn){return[255&xn]}function Dt(xn){return[255&xn,xn>>8&255]}function St(xn){return[255&xn,xn>>8&255,xn>>16&255,xn>>24&255]}function wn(xn){return nn(xn,52,8)}function Bn(xn){return nn(xn,23,4)}function Hn(xn,Kn,be){se(xn[de],Kn,{get:function(){return this[be]}})}function hn(xn,Kn,be,Yn){var Dr=ee(+be);if(Dr+Kn>xn[Ye])throw we(pe);var pr=xn[jt]._b,Nr=Dr+xn[ln],Fr=pr.slice(Nr,Nr+Kn);return Yn?Fr:Fr.reverse()}function Ve(xn,Kn,be,Yn,Dr,pr){var Nr=ee(+be);if(Nr+Kn>xn[Ye])throw we(pe);for(var Fr=xn[jt]._b,an=Nr+xn[ln],Kt=Yn(+Dr),Zt=0;Zt<Kn;Zt++)Fr[an+Zt]=Kt[pr?Zt:Kn-Zt-1]}if(B.ABV){if(!R(function(){Ae(1)})||!R(function(){new Ae(-1)})||R(function(){return new Ae,new Ae(1.5),new Ae(NaN),Ae.name!="ArrayBuffer"})){for(var Qe,He=(Ae=function(xn){return W(this,Ae),new _t(ee(xn))})[de]=_t[de],pt=I(_t),Lt=0;pt.length>Lt;)(Qe=pt[Lt++])in Ae||re(Ae,Qe,_t[Qe]);U||(He.constructor=Ae)}var zt=new Te(new Ae(2)),Tn=Te[de].setInt8;zt.setInt8(0,2147483648),zt.setInt8(1,2147483649),!zt.getInt8(0)&&zt.getInt8(1)||J(Te[de],{setInt8:function(xn,Kn){Tn.call(this,xn,Kn<<24>>24)},setUint8:function(xn,Kn){Tn.call(this,xn,Kn<<24>>24)}},!0)}else Ae=function(xn){W(this,Ae,"ArrayBuffer");var Kn=ee(xn);this._b=ie.call(new Array(Kn),0),this[Ye]=Kn},Te=function(xn,Kn,be){W(this,Te,"DataView"),W(xn,Ae,"DataView");var Yn=xn[Ye],Dr=q(Kn);if(Dr<0||Dr>Yn)throw we("Wrong offset!");if(Dr+(be=be===void 0?Yn-Dr:P(be))>Yn)throw we("Wrong length!");this[jt]=xn,this[ln]=Dr,this[Ye]=be},$&&(Hn(Ae,"byteLength","_l"),Hn(Te,"buffer","_b"),Hn(Te,"byteLength","_l"),Hn(Te,"byteOffset","_o")),J(Te[de],{getInt8:function(xn){return hn(this,1,xn)[0]<<24>>24},getUint8:function(xn){return hn(this,1,xn)[0]},getInt16:function(xn){var Kn=hn(this,2,xn,arguments[1]);return(Kn[1]<<8|Kn[0])<<16>>16},getUint16:function(xn){var Kn=hn(this,2,xn,arguments[1]);return Kn[1]<<8|Kn[0]},getInt32:function(xn){return Pt(hn(this,4,xn,arguments[1]))},getUint32:function(xn){return Pt(hn(this,4,xn,arguments[1]))>>>0},getFloat32:function(xn){return Bt(hn(this,4,xn,arguments[1]),23,4)},getFloat64:function(xn){return Bt(hn(this,8,xn,arguments[1]),52,8)},setInt8:function(xn,Kn){Ve(this,1,xn,gn,Kn)},setUint8:function(xn,Kn){Ve(this,1,xn,gn,Kn)},setInt16:function(xn,Kn){Ve(this,2,xn,Dt,Kn,arguments[2])},setUint16:function(xn,Kn){Ve(this,2,xn,Dt,Kn,arguments[2])},setInt32:function(xn,Kn){Ve(this,4,xn,St,Kn,arguments[2])},setUint32:function(xn,Kn){Ve(this,4,xn,St,Kn,arguments[2])},setFloat32:function(xn,Kn){Ve(this,4,xn,Bn,Kn,arguments[2])},setFloat64:function(xn,Kn){Ve(this,8,xn,wn,Kn,arguments[2])}});K(Ae,"ArrayBuffer"),K(Te,"DataView"),re(Te[de],B.VIEW,!0),A.ArrayBuffer=Ae,A.DataView=Te},function(Oe,A,a){var b,$,U,B=a(56),re=a(232),J=a(171),R=a(175),W=a(16),q=W.process,P=W.setImmediate,ee=W.clearImmediate,I=W.MessageChannel,se=W.Dispatch,ie=0,K={},de=function(){var Ae=+this;if(K.hasOwnProperty(Ae)){var Te=K[Ae];delete K[Ae],Te()}},pe=function(Ae){de.call(Ae.data)};P&&ee||(P=function(Ae){for(var Te=[],je=1;arguments.length>je;)Te.push(arguments[je++]);return K[++ie]=function(){re(typeof Ae=="function"?Ae:Function(Ae),Te)},b(ie),ie},ee=function(Ae){delete K[Ae]},a(62)(q)=="process"?b=function(Ae){q.nextTick(B(de,Ae,1))}:se&&se.now?b=function(Ae){se.now(B(de,Ae,1))}:I?(U=($=new I).port2,$.port1.onmessage=pe,b=B(U.postMessage,U,1)):W.addEventListener&&typeof postMessage=="function"&&!W.importScripts?(b=function(Ae){W.postMessage(Ae+"","*")},W.addEventListener("message",pe,!1)):b="onreadystatechange"in R("script")?function(Ae){J.appendChild(R("script")).onreadystatechange=function(){J.removeChild(this),de.call(Ae)}}:function(Ae){setTimeout(B(de,Ae,1),0)}),Oe.exports={set:P,clear:ee}},function(Oe,A,a){var b=a(164)(!0);Oe.exports=function($,U,B){return U+(B?b($,U).length:1)}},function(Oe,A,a){var b=a(124),$=RegExp.prototype.exec,U=String.prototype.replace,B=$,re=function(){var R=/a/,W=/b*/g;return $.call(R,"a"),$.call(W,"a"),R.lastIndex!==0||W.lastIndex!==0}(),J=/()??/.exec("")[1]!==void 0;(re||J)&&(B=function(R){var W,q,P,ee,I=this;return J&&(q=new RegExp("^"+I.source+"$(?!\\s)",b.call(I))),re&&(W=I.lastIndex),P=$.call(I,R),re&&P&&(I.lastIndex=I.global?P.index+P[0].length:W),J&&P&&P.length>1&&U.call(P[0],q,function(){for(ee=1;ee<arguments.length-2;ee++)arguments[ee]===void 0&&(P[ee]=void 0)}),P}),Oe.exports=B},function(Oe,A,a){var b=a(77),$=a(221),U=a(96),B=a(41);Oe.exports=a(163)(Array,"Array",function(re,J){this._t=B(re),this._i=0,this._k=J},function(){var re=this._t,J=this._k,R=this._i++;return!re||R>=re.length?(this._t=void 0,$(1)):$(0,J=="keys"?R:J=="values"?re[R]:[R,re[R]])},"values"),U.Arguments=U.Array,b("keys"),b("values"),b("entries")},function(Oe,A,a){var b=a(34),$=a(81),U=a(22);Oe.exports=function(B){for(var re=b(this),J=U(re.length),R=arguments.length,W=$(R>1?arguments[1]:void 0,J),q=R>2?arguments[2]:void 0,P=q===void 0?J:$(q,J);P>W;)re[W++]=B;return re}},function(Oe,A,a){var b=a(105),$=a(19)("iterator"),U=a(96);Oe.exports=a(24).getIteratorMethod=function(B){if(B!=null)return B[$]||B["@@iterator"]||U[b(B)]}},function(Oe,A,a){var b=a(26),$=a(85);Oe.exports=function(U,B,re){B in U?b.f(U,B,$(0,re)):U[B]=re}},function(Oe,A,a){var b=a(96),$=a(19)("iterator"),U=Array.prototype;Oe.exports=function(B){return B!==void 0&&(b.Array===B||U[$]===B)}},function(Oe,A,a){var b=a(19)("match");Oe.exports=function($){var U=/./;try{"/./"[$](U)}catch{try{return U[b]=!1,!"/./"[$](U)}catch{}}return!0}},function(Oe,A,a){var b=a(13),$=a(62),U=a(19)("match");Oe.exports=function(B){var re;return b(B)&&((re=B[U])!==void 0?!!re:$(B)=="RegExp")}},function(Oe,A,a){var b=a(161),$=a(61);Oe.exports=function(U,B,re){if(b(B))throw TypeError("String#"+re+" doesn't accept regex!");return String($(U))}},function(Oe,A,a){var b=a(83),$=a(8),U=a(38),B=a(42),re=a(96),J=a(226),R=a(98),W=a(78),q=a(19)("iterator"),P=!([].keys&&"next"in[].keys()),ee=function(){return this};Oe.exports=function(I,se,ie,K,de,pe,Ae){J(ie,se,K);var Te,je,we,ot=function(ln){if(!P&&ln in ke)return ke[ln];switch(ln){case"keys":case"values":return function(){return new ie(this,ln)}}return function(){return new ie(this,ln)}},_t=se+" Iterator",Ut=de=="values",Xt=!1,ke=I.prototype,Ft=ke[q]||ke["@@iterator"]||de&&ke[de],Gt=Ft||ot(de),jt=de?Ut?ot("entries"):Gt:void 0,Ye=se=="Array"&&ke.entries||Ft;if(Ye&&(we=W(Ye.call(new I)))!==Object.prototype&&we.next&&(R(we,_t,!0),b||typeof we[q]=="function"||B(we,q,ee)),Ut&&Ft&&Ft.name!=="values"&&(Xt=!0,Gt=function(){return Ft.call(this)}),b&&!Ae||!P&&!Xt&&ke[q]||B(ke,q,Gt),re[se]=Gt,re[_t]=ee,de)if(Te={values:Ut?Gt:ot("values"),keys:pe?Gt:ot("keys"),entries:jt},Ae)for(je in Te)je in ke||U(ke,je,Te[je]);else $($.P+$.F*(P||Xt),se,Te);return Te}},function(Oe,A,a){var b=a(54),$=a(61);Oe.exports=function(U){return function(B,re){var J,R,W=String($(B)),q=b(re),P=W.length;return q<0||q>=P?U?"":void 0:(J=W.charCodeAt(q))<55296||J>56319||q+1===P||(R=W.charCodeAt(q+1))<56320||R>57343?U?W.charAt(q):J:U?W.slice(q,q+2):R-56320+(J-55296<<10)+65536}}},function(Oe,A){var a=Math.expm1;Oe.exports=!a||a(10)>22025.465794806718||a(10)<22025.465794806718||a(-2e-17)!=-2e-17?function(b){return(b=+b)==0?b:b>-1e-6&&b<1e-6?b+b*b/2:Math.exp(b)-1}:a},function(Oe,A){Oe.exports=Math.sign||function(a){return(a=+a)==0||a!=a?a:a<0?-1:1}},function(Oe,A,a){var b=a(54),$=a(61);Oe.exports=function(U){var B=String($(this)),re="",J=b(U);if(J<0||J==1/0)throw RangeError("Count can't be negative");for(;J>0;(J>>>=1)&&(B+=B))1&J&&(re+=B);return re}},function(Oe,A,a){var b=a(13),$=a(170).set;Oe.exports=function(U,B,re){var J,R=B.constructor;return R!==re&&typeof R=="function"&&(J=R.prototype)!==re.prototype&&b(J)&&$&&$(U,J),U}},function(Oe,A){Oe.exports=`	
\v\f\r \u2028\u2029\uFEFF`},function(Oe,A,a){var b=a(13),$=a(14),U=function(B,re){if($(B),!b(re)&&re!==null)throw TypeError(re+": can't set as prototype!")};Oe.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(B,re,J){try{(J=a(56)(Function.call,a(53).f(Object.prototype,"__proto__").set,2))(B,[]),re=!(B instanceof Array)}catch{re=!0}return function(R,W){return U(R,W),re?R.__proto__=W:J(R,W),R}}({},!1):void 0),check:U}},function(Oe,A,a){var b=a(16).document;Oe.exports=b&&b.documentElement},function(Oe,A){Oe.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(Oe,A,a){var b=a(129)("keys"),$=a(84);Oe.exports=function(U){return b[U]||(b[U]=$(U))}},function(Oe,A,a){A.f=a(19)},function(Oe,A,a){var b=a(13),$=a(16).document,U=b($)&&b($.createElement);Oe.exports=function(B){return U?$.createElement(B):{}}},function(Oe,A,a){var b=function(pe){return pe},$=function(pe){if(pe==null)return b;var Ae,Te,je=pe.scale[0],we=pe.scale[1],ot=pe.translate[0],_t=pe.translate[1];return function(Ut,Xt){Xt||(Ae=Te=0);var ke=2,Ft=Ut.length,Gt=new Array(Ft);for(Gt[0]=(Ae+=Ut[0])*je+ot,Gt[1]=(Te+=Ut[1])*we+_t;ke<Ft;)Gt[ke]=Ut[ke],++ke;return Gt}},U=function(pe){var Ae,Te=$(pe.transform),je=1/0,we=je,ot=-je,_t=-je;function Ut(ke){(ke=Te(ke))[0]<je&&(je=ke[0]),ke[0]>ot&&(ot=ke[0]),ke[1]<we&&(we=ke[1]),ke[1]>_t&&(_t=ke[1])}function Xt(ke){switch(ke.type){case"GeometryCollection":ke.geometries.forEach(Xt);break;case"Point":Ut(ke.coordinates);break;case"MultiPoint":ke.coordinates.forEach(Ut)}}for(Ae in pe.arcs.forEach(function(ke){for(var Ft,Gt=-1,jt=ke.length;++Gt<jt;)(Ft=Te(ke[Gt],Gt))[0]<je&&(je=Ft[0]),Ft[0]>ot&&(ot=Ft[0]),Ft[1]<we&&(we=Ft[1]),Ft[1]>_t&&(_t=Ft[1])}),pe.objects)Xt(pe.objects[Ae]);return[je,we,ot,_t]},B=function(pe,Ae){for(var Te,je=pe.length,we=je-Ae;we<--je;)Te=pe[we],pe[we++]=pe[je],pe[je]=Te},re=function(pe,Ae){return typeof Ae=="string"&&(Ae=pe.objects[Ae]),Ae.type==="GeometryCollection"?{type:"FeatureCollection",features:Ae.geometries.map(function(Te){return J(pe,Te)})}:J(pe,Ae)};function J(pe,Ae){var Te=Ae.id,je=Ae.bbox,we=Ae.properties==null?{}:Ae.properties,ot=R(pe,Ae);return Te==null&&je==null?{type:"Feature",properties:we,geometry:ot}:je==null?{type:"Feature",id:Te,properties:we,geometry:ot}:{type:"Feature",id:Te,bbox:je,properties:we,geometry:ot}}function R(pe,Ae){var Te=$(pe.transform),je=pe.arcs;function we(ke,Ft){Ft.length&&Ft.pop();for(var Gt=je[ke<0?~ke:ke],jt=0,Ye=Gt.length;jt<Ye;++jt)Ft.push(Te(Gt[jt],jt));ke<0&&B(Ft,Ye)}function ot(ke){return Te(ke)}function _t(ke){for(var Ft=[],Gt=0,jt=ke.length;Gt<jt;++Gt)we(ke[Gt],Ft);return Ft.length<2&&Ft.push(Ft[0]),Ft}function Ut(ke){for(var Ft=_t(ke);Ft.length<4;)Ft.push(Ft[0]);return Ft}function Xt(ke){return ke.map(Ut)}return function ke(Ft){var Gt,jt=Ft.type;switch(jt){case"GeometryCollection":return{type:jt,geometries:Ft.geometries.map(ke)};case"Point":Gt=ot(Ft.coordinates);break;case"MultiPoint":Gt=Ft.coordinates.map(ot);break;case"LineString":Gt=_t(Ft.arcs);break;case"MultiLineString":Gt=Ft.arcs.map(_t);break;case"Polygon":Gt=Xt(Ft.arcs);break;case"MultiPolygon":Gt=Ft.arcs.map(Xt);break;default:return null}return{type:jt,coordinates:Gt}}(Ae)}var W=function(pe,Ae){var Te={},je={},we={},ot=[],_t=-1;function Ut(Xt,ke){for(var Ft in Xt){var Gt=Xt[Ft];delete ke[Gt.start],delete Gt.start,delete Gt.end,Gt.forEach(function(jt){Te[jt<0?~jt:jt]=1}),ot.push(Gt)}}return Ae.forEach(function(Xt,ke){var Ft,Gt=pe.arcs[Xt<0?~Xt:Xt];Gt.length<3&&!Gt[1][0]&&!Gt[1][1]&&(Ft=Ae[++_t],Ae[_t]=Xt,Ae[ke]=Ft)}),Ae.forEach(function(Xt){var ke,Ft,Gt=function(Bt){var Pt,gn=pe.arcs[Bt<0?~Bt:Bt],Dt=gn[0];return pe.transform?(Pt=[0,0],gn.forEach(function(St){Pt[0]+=St[0],Pt[1]+=St[1]})):Pt=gn[gn.length-1],Bt<0?[Pt,Dt]:[Dt,Pt]}(Xt),jt=Gt[0],Ye=Gt[1];if(ke=we[jt])if(delete we[ke.end],ke.push(Xt),ke.end=Ye,Ft=je[Ye]){delete je[Ft.start];var ln=Ft===ke?ke:ke.concat(Ft);je[ln.start=ke.start]=we[ln.end=Ft.end]=ln}else je[ke.start]=we[ke.end]=ke;else if(ke=je[Ye])if(delete je[ke.start],ke.unshift(Xt),ke.start=jt,Ft=we[jt]){delete we[Ft.end];var nn=Ft===ke?ke:Ft.concat(ke);je[nn.start=Ft.start]=we[nn.end=ke.end]=nn}else je[ke.start]=we[ke.end]=ke;else je[(ke=[Xt]).start=jt]=we[ke.end=Ye]=ke}),Ut(we,je),Ut(je,we),Ae.forEach(function(Xt){Te[Xt<0?~Xt:Xt]||ot.push([Xt])}),ot},q=function(pe){return R(pe,P.apply(this,arguments))};function P(pe,Ae,Te){var je,we,ot;if(arguments.length>1)je=function(_t,Ut,Xt){var ke,Ft=[],Gt=[];function jt(nn){var Bt=nn<0?~nn:nn;(Gt[Bt]||(Gt[Bt]=[])).push({i:nn,g:ke})}function Ye(nn){nn.forEach(jt)}function ln(nn){nn.forEach(Ye)}return function nn(Bt){switch(ke=Bt,Bt.type){case"GeometryCollection":Bt.geometries.forEach(nn);break;case"LineString":Ye(Bt.arcs);break;case"MultiLineString":case"Polygon":ln(Bt.arcs);break;case"MultiPolygon":(function(Pt){Pt.forEach(ln)})(Bt.arcs)}}(Ut),Gt.forEach(Xt==null?function(nn){Ft.push(nn[0].i)}:function(nn){Xt(nn[0].g,nn[nn.length-1].g)&&Ft.push(nn[0].i)}),Ft}(0,Ae,Te);else for(we=0,je=new Array(ot=pe.arcs.length);we<ot;++we)je[we]=we;return{type:"MultiLineString",arcs:W(pe,je)}}var ee=function(pe){return R(pe,I.apply(this,arguments))};function I(pe,Ae){var Te={},je=[],we=[];function ot(Ut){Ut.forEach(function(Xt){Xt.forEach(function(ke){(Te[ke=ke<0?~ke:ke]||(Te[ke]=[])).push(Ut)})}),je.push(Ut)}function _t(Ut){return function(Xt){for(var ke,Ft=-1,Gt=Xt.length,jt=Xt[Gt-1],Ye=0;++Ft<Gt;)ke=jt,jt=Xt[Ft],Ye+=ke[0]*jt[1]-ke[1]*jt[0];return Math.abs(Ye)}(R(pe,{type:"Polygon",arcs:[Ut]}).coordinates[0])}return Ae.forEach(function Ut(Xt){switch(Xt.type){case"GeometryCollection":Xt.geometries.forEach(Ut);break;case"Polygon":ot(Xt.arcs);break;case"MultiPolygon":Xt.arcs.forEach(ot)}}),je.forEach(function(Ut){if(!Ut._){var Xt=[],ke=[Ut];for(Ut._=1,we.push(Xt);Ut=ke.pop();)Xt.push(Ut),Ut.forEach(function(Ft){Ft.forEach(function(Gt){Te[Gt<0?~Gt:Gt].forEach(function(jt){jt._||(jt._=1,ke.push(jt))})})})}}),je.forEach(function(Ut){delete Ut._}),{type:"MultiPolygon",arcs:we.map(function(Ut){var Xt,ke=[];if(Ut.forEach(function(ln){ln.forEach(function(nn){nn.forEach(function(Bt){Te[Bt<0?~Bt:Bt].length<2&&ke.push(Bt)})})}),(Xt=(ke=W(pe,ke)).length)>1)for(var Ft,Gt,jt=1,Ye=_t(ke[0]);jt<Xt;++jt)(Ft=_t(ke[jt]))>Ye&&(Gt=ke[0],ke[0]=ke[jt],ke[jt]=Gt,Ye=Ft);return ke}).filter(function(Ut){return Ut.length>0})}}var se=function(pe,Ae){for(var Te=0,je=pe.length;Te<je;){var we=Te+je>>>1;pe[we]<Ae?Te=we+1:je=we}return Te},ie=function(pe){var Ae={},Te=pe.map(function(){return[]});function je(ln,nn){ln.forEach(function(Bt){Bt<0&&(Bt=~Bt);var Pt=Ae[Bt];Pt?Pt.push(nn):Ae[Bt]=[nn]})}function we(ln,nn){ln.forEach(function(Bt){je(Bt,nn)})}var ot={LineString:je,MultiLineString:we,Polygon:we,MultiPolygon:function(ln,nn){ln.forEach(function(Bt){we(Bt,nn)})}};for(var _t in pe.forEach(function ln(nn,Bt){nn.type==="GeometryCollection"?nn.geometries.forEach(function(Pt){ln(Pt,Bt)}):nn.type in ot&&ot[nn.type](nn.arcs,Bt)}),Ae)for(var Ut=Ae[_t],Xt=Ut.length,ke=0;ke<Xt;++ke)for(var Ft=ke+1;Ft<Xt;++Ft){var Gt,jt=Ut[ke],Ye=Ut[Ft];(Gt=Te[jt])[_t=se(Gt,Ye)]!==Ye&&Gt.splice(_t,0,Ye),(Gt=Te[Ye])[_t=se(Gt,jt)]!==jt&&Gt.splice(_t,0,jt)}return Te},K=function(pe){if(pe==null)return b;var Ae,Te,je=pe.scale[0],we=pe.scale[1],ot=pe.translate[0],_t=pe.translate[1];return function(Ut,Xt){Xt||(Ae=Te=0);var ke=2,Ft=Ut.length,Gt=new Array(Ft),jt=Math.round((Ut[0]-ot)/je),Ye=Math.round((Ut[1]-_t)/we);for(Gt[0]=jt-Ae,Ae=jt,Gt[1]=Ye-Te,Te=Ye;ke<Ft;)Gt[ke]=Ut[ke],++ke;return Gt}},de=function(pe,Ae){if(pe.transform)throw new Error("already quantized");if(Ae&&Ae.scale)Ut=pe.bbox;else{if(!((Te=Math.floor(Ae))>=2))throw new Error("n must be 2");var Te,je=(Ut=pe.bbox||U(pe))[0],we=Ut[1],ot=Ut[2],_t=Ut[3];Ae={scale:[ot-je?(ot-je)/(Te-1):1,_t-we?(_t-we)/(Te-1):1],translate:[je,we]}}var Ut,Xt,ke=K(Ae),Ft=pe.objects,Gt={};function jt(ln){return ke(ln)}function Ye(ln){var nn;switch(ln.type){case"GeometryCollection":nn={type:"GeometryCollection",geometries:ln.geometries.map(Ye)};break;case"Point":nn={type:"Point",coordinates:jt(ln.coordinates)};break;case"MultiPoint":nn={type:"MultiPoint",coordinates:ln.coordinates.map(jt)};break;default:return ln}return ln.id!=null&&(nn.id=ln.id),ln.bbox!=null&&(nn.bbox=ln.bbox),ln.properties!=null&&(nn.properties=ln.properties),nn}for(Xt in Ft)Gt[Xt]=Ye(Ft[Xt]);return{type:"Topology",bbox:Ut,transform:Ae,objects:Gt,arcs:pe.arcs.map(function(ln){var nn,Bt=0,Pt=1,gn=ln.length,Dt=new Array(gn);for(Dt[0]=ke(ln[0],0);++Bt<gn;)((nn=ke(ln[Bt],Bt))[0]||nn[1])&&(Dt[Pt++]=nn);return Pt===1&&(Dt[Pt++]=[0,0]),Dt.length=Pt,Dt})}};a.d(A,!1,function(){return U}),a.d(A,"a",function(){return re}),a.d(A,"b",function(){return q}),a.d(A,!1,function(){return P}),a.d(A,!1,function(){return ee}),a.d(A,!1,function(){return I}),a.d(A,!1,function(){return ie}),a.d(A,!1,function(){return de}),a.d(A,!1,function(){return $}),a.d(A,!1,function(){return K})},function(Oe,A,a){(function(b,$){function U(){return typeof b=="object"&&Oe!==void 0&&$!==void 0&&!!$.version}a.d(A,"a",function(){return U})}).call(this,a(59),a(75))},function(Oe,A,a){(function(b){a.d(A,"a",function(){return B});var $=a(5),U=a(131);function B(){var re=b.Canvas||b.HTMLCanvasElement,J=b.Image||b.HTMLImageElement,R=b.fetch||function(){throw new Error("fetch - missing fetch implementation for nodejs environment")},W=Object(U.a)();return Object($.a)({Canvas:re||function(){return function(){}}(),CanvasRenderingContext2D:b.CanvasRenderingContext2D||function(){return function(){}}(),Image:J||function(){return function(){}}(),ImageData:b.ImageData||function(){return function(){}}(),Video:b.HTMLVideoElement||function(){return function(){}}(),createCanvasElement:function(){if(re)return new re;throw new Error("createCanvasElement - missing Canvas implementation for nodejs environment")},createImageElement:function(){if(J)return new J;throw new Error("createImageElement - missing Image implementation for nodejs environment")},fetch:R},W)}}).call(this,a(59))},function(Oe,A,a){const b=a(90);Oe.exports={re:b.re,src:b.src,tokens:b.t,SEMVER_SPEC_VERSION:a(117).SEMVER_SPEC_VERSION,SemVer:a(32),compareIdentifiers:a(146).compareIdentifiers,rcompareIdentifiers:a(146).rcompareIdentifiers,parse:a(89),valid:a(348),clean:a(347),inc:a(346),diff:a(345),major:a(344),minor:a(343),patch:a(342),prerelease:a(341),compare:a(48),rcompare:a(340),compareLoose:a(339),compareBuild:a(144),sort:a(338),rsort:a(337),gt:a(114),lt:a(143),eq:a(145),neq:a(204),gte:a(142),lte:a(141),cmp:a(203),coerce:a(336),Comparator:a(113),Range:a(47),satisfies:a(112),toComparators:a(332),maxSatisfying:a(331),minSatisfying:a(330),minVersion:a(329),validRange:a(328),outside:a(140),gtr:a(327),ltr:a(326),intersects:a(325),simplifyRange:a(324),subset:a(323)}},function(Oe,A,a){var b=a(31),$=a(12),U=Object(b.a)(function(B){B.setUTCSeconds(0,0)},function(B,re){B.setTime(+B+re*$.c)},function(B,re){return(re-B)/$.c},function(B){return B.getUTCMinutes()});A.a=U,U.range},function(Oe,A,a){var b=a(31),$=a(12),U=Object(b.a)(function(B){B.setUTCMinutes(0,0,0)},function(B,re){B.setTime(+B+re*$.b)},function(B,re){return(re-B)/$.b},function(B){return B.getUTCHours()});A.a=U,U.range},function(Oe,A,a){var b=a(31),$=Object(b.a)(function(){},function(U,B){U.setTime(+U+B)},function(U,B){return B-U});$.every=function(U){return U=Math.floor(U),isFinite(U)&&U>0?U>1?Object(b.a)(function(B){B.setTime(Math.floor(B/U)*U)},function(B,re){B.setTime(+B+re*U)},function(B,re){return(re-B)/U}):$:null},A.a=$,$.range},function(Oe,A,a){var b=a(31),$=a(12),U=Object(b.a)(function(B){B.setTime(B-B.getMilliseconds()-B.getSeconds()*$.e)},function(B,re){B.setTime(+B+re*$.c)},function(B,re){return(re-B)/$.c},function(B){return B.getMinutes()});A.a=U,U.range},function(Oe,A,a){var b=a(31),$=a(12),U=Object(b.a)(function(B){B.setTime(B-B.getMilliseconds()-B.getSeconds()*$.e-B.getMinutes()*$.c)},function(B,re){B.setTime(+B+re*$.b)},function(B,re){return(re-B)/$.b},function(B){return B.getHours()});A.a=U,U.range},function(Oe,A){},function(Oe,A){Oe.exports=function(a,b){(b==null||b>a.length)&&(b=a.length);for(var $=0,U=new Array(b);$<b;$++)U[$]=a[$];return U},Oe.exports.__esModule=!0,Oe.exports.default=Oe.exports},function(Oe,A,a){var b=a(186);Oe.exports=function($,U){if($){if(typeof $=="string")return b($,U);var B=Object.prototype.toString.call($).slice(8,-1);return B==="Object"&&$.constructor&&(B=$.constructor.name),B==="Map"||B==="Set"?Array.from($):B==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(B)?b($,U):void 0}},Oe.exports.__esModule=!0,Oe.exports.default=Oe.exports},function(Oe,A,a){function b($){this.message=$}b.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},b.prototype.__CANCEL__=!0,Oe.exports=b},function(Oe,A,a){var b=a(36);Oe.exports=function($,U){U=U||{};var B={},re=["url","method","data"],J=["headers","auth","proxy","params"],R=["baseURL","transformRequest","transformResponse","paramsSerializer","timeout","timeoutMessage","withCredentials","adapter","responseType","xsrfCookieName","xsrfHeaderName","onUploadProgress","onDownloadProgress","decompress","maxContentLength","maxBodyLength","maxRedirects","transport","httpAgent","httpsAgent","cancelToken","socketPath","responseEncoding"],W=["validateStatus"];function q(se,ie){return b.isPlainObject(se)&&b.isPlainObject(ie)?b.merge(se,ie):b.isPlainObject(ie)?b.merge({},ie):b.isArray(ie)?ie.slice():ie}function P(se){b.isUndefined(U[se])?b.isUndefined($[se])||(B[se]=q(void 0,$[se])):B[se]=q($[se],U[se])}b.forEach(re,function(se){b.isUndefined(U[se])||(B[se]=q(void 0,U[se]))}),b.forEach(J,P),b.forEach(R,function(se){b.isUndefined(U[se])?b.isUndefined($[se])||(B[se]=q(void 0,$[se])):B[se]=q(void 0,U[se])}),b.forEach(W,function(se){se in U?B[se]=q($[se],U[se]):se in $&&(B[se]=q(void 0,$[se]))});var ee=re.concat(J).concat(R).concat(W),I=Object.keys($).concat(Object.keys(U)).filter(function(se){return ee.indexOf(se)===-1});return b.forEach(I,P),B}},function(Oe,A,a){Oe.exports=function(b){return!(!b||!b.__CANCEL__)}},function(Oe,A,a){var b=a(193);Oe.exports=function($,U,B,re,J){var R=new Error($);return b(R,U,B,re,J)}},function(Oe,A,a){var b=a(36),$=a(274),U=a(273),B=a(194),re=a(272),J=a(269),R=a(268),W=a(191);Oe.exports=function(q){return new Promise(function(P,ee){var I=q.data,se=q.headers,ie=q.responseType;b.isFormData(I)&&delete se["Content-Type"];var K=new XMLHttpRequest;if(q.auth){var de=q.auth.username||"",pe=q.auth.password?unescape(encodeURIComponent(q.auth.password)):"";se.Authorization="Basic "+btoa(de+":"+pe)}var Ae=re(q.baseURL,q.url);function Te(){if(K){var we="getAllResponseHeaders"in K?J(K.getAllResponseHeaders()):null,ot={data:ie&&ie!=="text"&&ie!=="json"?K.response:K.responseText,status:K.status,statusText:K.statusText,headers:we,config:q,request:K};$(P,ee,ot),K=null}}if(K.open(q.method.toUpperCase(),B(Ae,q.params,q.paramsSerializer),!0),K.timeout=q.timeout,"onloadend"in K?K.onloadend=Te:K.onreadystatechange=function(){K&&K.readyState===4&&(K.status!==0||K.responseURL&&K.responseURL.indexOf("file:")===0)&&setTimeout(Te)},K.onabort=function(){K&&(ee(W("Request aborted",q,"ECONNABORTED",K)),K=null)},K.onerror=function(){ee(W("Network Error",q,null,K)),K=null},K.ontimeout=function(){var we="timeout of "+q.timeout+"ms exceeded";q.timeoutErrorMessage&&(we=q.timeoutErrorMessage),ee(W(we,q,q.transitional&&q.transitional.clarifyTimeoutError?"ETIMEDOUT":"ECONNABORTED",K)),K=null},b.isStandardBrowserEnv()){var je=(q.withCredentials||R(Ae))&&q.xsrfCookieName?U.read(q.xsrfCookieName):void 0;je&&(se[q.xsrfHeaderName]=je)}"setRequestHeader"in K&&b.forEach(se,function(we,ot){I===void 0&&ot.toLowerCase()==="content-type"?delete se[ot]:K.setRequestHeader(ot,we)}),b.isUndefined(q.withCredentials)||(K.withCredentials=!!q.withCredentials),ie&&ie!=="json"&&(K.responseType=q.responseType),typeof q.onDownloadProgress=="function"&&K.addEventListener("progress",q.onDownloadProgress),typeof q.onUploadProgress=="function"&&K.upload&&K.upload.addEventListener("progress",q.onUploadProgress),q.cancelToken&&q.cancelToken.promise.then(function(we){K&&(K.abort(),ee(we),K=null)}),I||(I=null),K.send(I)})}},function(Oe,A,a){Oe.exports=function(b,$,U,B,re){return b.config=$,U&&(b.code=U),b.request=B,b.response=re,b.isAxiosError=!0,b.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code}},b}},function(Oe,A,a){var b=a(36);function $(U){return encodeURIComponent(U).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}Oe.exports=function(U,B,re){if(!B)return U;var J;if(re)J=re(B);else if(b.isURLSearchParams(B))J=B.toString();else{var R=[];b.forEach(B,function(q,P){q!=null&&(b.isArray(q)?P+="[]":q=[q],b.forEach(q,function(ee){b.isDate(ee)?ee=ee.toISOString():b.isObject(ee)&&(ee=JSON.stringify(ee)),R.push($(P)+"="+$(ee))}))}),J=R.join("&")}if(J){var W=U.indexOf("#");W!==-1&&(U=U.slice(0,W)),U+=(U.indexOf("?")===-1?"?":"&")+J}return U}},function(Oe,A,a){Oe.exports=function(b,$){return function(){for(var U=new Array(arguments.length),B=0;B<U.length;B++)U[B]=arguments[B];return b.apply($,U)}}},function(Oe,A,a){/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/var b=this&&this.__awaiter||function(W,q,P,ee){return new(P||(P=Promise))(function(I,se){function ie(pe){try{de(ee.next(pe))}catch(Ae){se(Ae)}}function K(pe){try{de(ee.throw(pe))}catch(Ae){se(Ae)}}function de(pe){pe.done?I(pe.value):new P(function(Ae){Ae(pe.value)}).then(ie,K)}de((ee=ee.apply(W,q||[])).next())})},$=this&&this.__importDefault||function(W){return W&&W.__esModule?W:{default:W}};Object.defineProperty(A,"__esModule",{value:!0});const U=$(a(88)),B=a(64),re=a(111),J=a(46);A.linechart=function(W,q,P={}){return b(this,void 0,void 0,function*(){const ee=Array.isArray(q.values[0])?q.values:[q.values],I=ee[0].length,se=q.series?q.series:ee.map((je,we)=>`Series ${we+1}`);re.assert(se.length===ee.length,"Must have an equal number of series labels as there are data series"),P.seriesColors!=null&&re.assert(P.seriesColors.length===ee.length,"Must have an equal number of series colors as there are data series");const ie=[];for(let je=0;je<I;je++){const we={x:je};se.forEach((ot,_t)=>{const Ut=ee[_t][je].y;we[ot]=Ut,we[`${ot}-name`]=ot}),ie.push(we)}const K=Object.assign({},R,P),de={x:{field:"x",type:K.xType,title:K.xLabel},tooltip:[{field:"x",type:"quantitative"},...se.map(je=>({field:je,type:"quantitative"}))]},pe=se.map(je=>({data:void 0,mark:{type:"line",clip:!0},encoding:{y:{field:je,type:K.yType,title:K.yLabel,scale:K.zoomToFit?{zero:!1}:K.yAxisDomain!=null?{domain:K.yAxisDomain}:void 0},color:{field:`${je}-name`,type:"nominal",legend:{values:se,title:null},scale:{range:K.seriesColors}}}})),Ae=J.getDrawArea(W),Te={width:K.width||B.getDefaultWidth(Ae),height:K.height||B.getDefaultHeight(Ae),padding:0,autosize:{type:"fit",contains:"padding",resize:!0},config:{axis:{labelFontSize:K.fontSize,titleFontSize:K.fontSize},text:{fontSize:K.fontSize},legend:{labelFontSize:K.fontSize,titleFontSize:K.fontSize}},data:{values:ie},encoding:de,layer:[...pe,{mark:"rule",selection:{hover:{type:"single",on:"mouseover",nearest:!0,clear:"mouseout"}},encoding:{color:{value:"grey",condition:{selection:{not:"hover"},value:"transparent"}}}}]};return yield U.default(Ae,Te,{actions:!1,mode:"vega-lite",defaultStyle:!1}),Promise.resolve()})};const R={xLabel:"x",yLabel:"y",xType:"quantitative",yType:"quantitative",zoomToFit:!1,fontSize:11}},function(Oe,A,a){/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Object.defineProperty(A,"__esModule",{value:!0});const b=a(292);let $;const U="Visor",B="tfjs-visor-container";A.visor=function(){if(typeof document>"u")throw new Error("No document defined. This library needs a browser/dom to work");if(document.getElementById(B)&&$!=null)return $;let J,R=document.getElementById(B);function W(ee,I){let se=null;return J=b.VisorComponent.render(ee,J,{ref:ie=>se=ie,surfaceList:Array.from(I.values())}),se}R==null&&((R=document.createElement("div")).id=B,document.body.appendChild(R));const q=new Map,P=W(R,q);return $=new re(P,R,q,W)};class re{constructor(R,W,q,P){this.visorComponent=R,this.el=W,this.surfaceList=q,this.renderVisor=P}surface(R){const{name:W}=R,q=R.tab==null?U:R.tab;if(W==null||!(typeof W=="string"||W instanceof String))throw new Error("You must pass a config object with a 'name' property to create or retrieve a surface");const P=Object.assign({},R,{tab:q}),ee=`${W}-${q}`;return this.surfaceList.has(ee)||this.surfaceList.set(ee,P),this.renderVisor(this.el,this.surfaceList),this.visorComponent.getSurface(W,q)}isFullscreen(){return this.visorComponent.isFullscreen()}isOpen(){return this.visorComponent.isOpen()}close(){return this.visorComponent.close()}open(){return this.visorComponent.open()}toggle(){return this.visorComponent.toggle()}toggleFullScreen(){return this.visorComponent.toggleFullScreen()}bindKeys(){return this.visorComponent.bindKeys()}unbindKeys(){return this.visorComponent.unbindKeys()}setActiveTab(R){if(!this.visorComponent.state.tabs.has(R))throw new Error(`Tab '${R}' does not exist`);this.visorComponent.setState({activeTab:R})}}A.Visor=re},function(Oe,A,a){Object.defineProperty(A,"__esModule",{value:!0}),A.isSurfaceInfo=function(b){return b.name!=null},A.isSurface=function(b){return b.drawArea instanceof HTMLElement}},function(Oe,A,a){Object.defineProperty(A,"__esModule",{value:!0}),A.default=function(b){return b.charAt(0).toUpperCase()+b.slice(1)},Oe.exports=A.default},function(Oe,A,a){var b=a(315);Oe.exports=b},function(Oe,A,a){Object.defineProperty(A,"__esModule",{value:!0}),A.processStyleName=void 0,A.createMarkupForStyles=function(J,R){var W="";for(var q in J){var P=q.indexOf("--")===0;if(J.hasOwnProperty(q)&&q!=="label"){var ee=J[q];ee!=null&&(P?W+=q+":"+ee+";":(W+=re(q)+":",W+=(0,b.default)(q,ee,R)+";"))}}return W||null},B(a(319));var b=B(a(317)),$=B(a(314)),U=B(a(312));B(a(200));function B(J){return J&&J.__esModule?J:{default:J}}var re=A.processStyleName=(0,U.default)($.default)},function(Oe,A,a){a.r(A),a.d(A,"default",function(){return B}),a.d(A,"point",function(){return re});var b=a(null),$=a(null),U=a(null);function B(){var J,R,W=Object(U.a)().unknown(void 0),q=W.domain,P=W.range,ee=0,I=1,se=!1,ie=0,K=0,de=.5;function pe(){var Ae=q().length,Te=I<ee,je=Te?I:ee,we=Te?ee:I;J=(we-je)/Math.max(1,Ae-ie+2*K),se&&(J=Math.floor(J)),je+=(we-je-J*(Ae-ie))*de,R=J*(1-ie),se&&(je=Math.round(je),R=Math.round(R));var ot=Object(b.a)(Ae).map(function(_t){return je+J*_t});return P(Te?ot.reverse():ot)}return delete W.unknown,W.domain=function(Ae){return arguments.length?(q(Ae),pe()):q()},W.range=function(Ae){return arguments.length?([ee,I]=Ae,ee=+ee,I=+I,pe()):[ee,I]},W.rangeRound=function(Ae){return[ee,I]=Ae,ee=+ee,I=+I,se=!0,pe()},W.bandwidth=function(){return R},W.step=function(){return J},W.round=function(Ae){return arguments.length?(se=!!Ae,pe()):se},W.padding=function(Ae){return arguments.length?(ie=Math.min(1,K=+Ae),pe()):ie},W.paddingInner=function(Ae){return arguments.length?(ie=Math.min(1,Ae),pe()):ie},W.paddingOuter=function(Ae){return arguments.length?(K=+Ae,pe()):K},W.align=function(Ae){return arguments.length?(de=Math.max(0,Math.min(1,Ae)),pe()):de},W.copy=function(){return B(q(),[ee,I]).round(se).paddingInner(ie).paddingOuter(K).align(de)},$.a.apply(pe(),arguments)}function re(){return function J(R){var W=R.copy;return R.padding=R.paddingOuter,delete R.paddingInner,delete R.paddingOuter,R.copy=function(){return J(W())},R}(B.apply(null,arguments).paddingInner(1))}},function(Oe,A,a){const b=a(145),$=a(204),U=a(114),B=a(142),re=a(143),J=a(141);Oe.exports=(R,W,q,P)=>{switch(W){case"===":return typeof R=="object"&&(R=R.version),typeof q=="object"&&(q=q.version),R===q;case"!==":return typeof R=="object"&&(R=R.version),typeof q=="object"&&(q=q.version),R!==q;case"":case"=":case"==":return b(R,q,P);case"!=":return $(R,q,P);case">":return U(R,q,P);case">=":return B(R,q,P);case"<":return re(R,q,P);case"<=":return J(R,q,P);default:throw new TypeError(`Invalid operator: ${W}`)}}},function(Oe,A,a){const b=a(48);Oe.exports=($,U,B)=>b($,U,B)!==0},function(Oe,A,a){/**
* @license
* Copyright 2020 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Object.defineProperty(A,"__esModule",{value:!0});var b=a(25),$=a(73),U=a(74),B=a(29),re=a(374),J=a(28);A.div=J.op({div_:function(R,W){var q,P=B.convertToTensor(R,"a","div"),ee=B.convertToTensor(W,"b","div");if(q=U.makeTypesMatch(P,ee),P=q[0],ee=q[1],P.dtype==="int32"&&ee.dtype==="int32")return re.floorDiv(P,ee);var I={a:P,b:ee};return b.ENGINE.runKernelFunc(function(se,ie){var K=se.realDivide(P,ee);return ie([P,ee]),K},I,null,$.Div,{})}})},function(Oe,A,a){Object.defineProperty(A,"__esModule",{value:!0});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var b=a(25),$=a(73),U=a(74),B=a(29),re=a(28);A.add=re.op({add_:function(J,R){var W,q=B.convertToTensor(J,"a","add"),P=B.convertToTensor(R,"b","add");W=U.makeTypesMatch(q,P),q=W[0],P=W[1];var ee={a:q,b:P};return b.ENGINE.runKernelFunc(function(I,se){var ie=I.add(q,P);return se([q,P]),ie},ee,null,$.Add)}})},function(Oe,A,a){(function(b){var $=b!==void 0&&b||typeof self<"u"&&self||window,U=Function.prototype.apply;function B(re,J){this._id=re,this._clearFn=J}A.setTimeout=function(){return new B(U.call(setTimeout,$,arguments),clearTimeout)},A.setInterval=function(){return new B(U.call(setInterval,$,arguments),clearInterval)},A.clearTimeout=A.clearInterval=function(re){re&&re.close()},B.prototype.unref=B.prototype.ref=function(){},B.prototype.close=function(){this._clearFn.call($,this._id)},A.enroll=function(re,J){clearTimeout(re._idleTimeoutId),re._idleTimeout=J},A.unenroll=function(re){clearTimeout(re._idleTimeoutId),re._idleTimeout=-1},A._unrefActive=A.active=function(re){clearTimeout(re._idleTimeoutId);var J=re._idleTimeout;J>=0&&(re._idleTimeoutId=setTimeout(function(){re._onTimeout&&re._onTimeout()},J))},a(391),A.setImmediate=typeof self<"u"&&self.setImmediate||b!==void 0&&b.setImmediate||this&&this.setImmediate,A.clearImmediate=typeof self<"u"&&self.clearImmediate||b!==void 0&&b.clearImmediate||this&&this.clearImmediate}).call(this,a(59))},function(Oe,A){Oe.exports=function(a){try{return!!a()}catch{return!0}}},function(Oe,A){var a=Oe.exports={version:"2.6.12"};typeof __e=="number"&&(__e=a)},function(Oe,A,a){var b=a(27),$=a(82),U=a(41),B=a(106).f;Oe.exports=function(re){return function(J){for(var R,W=U(J),q=$(W),P=q.length,ee=0,I=[];P>ee;)R=q[ee++],b&&!B.call(W,R)||I.push(re?[R,W[R]]:W[R]);return I}}},function(Oe,A,a){var b=a(22),$=a(167),U=a(61);Oe.exports=function(B,re,J,R){var W=String(U(B)),q=W.length,P=J===void 0?" ":String(J),ee=b(re);if(ee<=q||P=="")return W;var I=ee-q,se=$.call(P,Math.ceil(I/P.length));return se.length>I&&(se=se.slice(0,I)),R?se+W:W+se}},function(Oe,A,a){var b=a(79),$=a(127),U=a(14),B=a(16).Reflect;Oe.exports=B&&B.ownKeys||function(re){var J=b.f(U(re)),R=$.f;return R?J.concat(R(re)):J}},function(Oe,A,a){var b=a(54),$=a(22);Oe.exports=function(U){if(U===void 0)return 0;var B=b(U),re=$(B);if(B!==re)throw RangeError("Wrong length!");return re}},function(Oe,A,a){var b=a(93),$=a(65).getWeak,U=a(14),B=a(13),re=a(94),J=a(121),R=a(51),W=a(43),q=a(76),P=R(5),ee=R(6),I=0,se=function(de){return de._l||(de._l=new ie)},ie=function(){this.a=[]},K=function(de,pe){return P(de.a,function(Ae){return Ae[0]===pe})};ie.prototype={get:function(de){var pe=K(this,de);if(pe)return pe[1]},has:function(de){return!!K(this,de)},set:function(de,pe){var Ae=K(this,de);Ae?Ae[1]=pe:this.a.push([de,pe])},delete:function(de){var pe=ee(this.a,function(Ae){return Ae[0]===de});return~pe&&this.a.splice(pe,1),!!~pe}},Oe.exports={getConstructor:function(de,pe,Ae,Te){var je=de(function(we,ot){re(we,je,pe,"_i"),we._t=pe,we._i=I++,we._l=void 0,ot!=null&&J(ot,Ae,we[Te],we)});return b(je.prototype,{delete:function(we){if(!B(we))return!1;var ot=$(we);return ot===!0?se(q(this,pe)).delete(we):ot&&W(ot,this._i)&&delete ot[this._i]},has:function(we){if(!B(we))return!1;var ot=$(we);return ot===!0?se(q(this,pe)).has(we):ot&&W(ot,this._i)}}),je},def:function(de,pe,Ae){var Te=$(U(pe),!0);return Te===!0?se(de).set(pe,Ae):Te[de._i]=Ae,de},ufstore:se}},function(Oe,A,a){var b=a(26).f,$=a(80),U=a(93),B=a(56),re=a(94),J=a(121),R=a(163),W=a(221),q=a(95),P=a(27),ee=a(65).fastKey,I=a(76),se=P?"_s":"size",ie=function(K,de){var pe,Ae=ee(de);if(Ae!=="F")return K._i[Ae];for(pe=K._f;pe;pe=pe.n)if(pe.k==de)return pe};Oe.exports={getConstructor:function(K,de,pe,Ae){var Te=K(function(je,we){re(je,Te,de,"_i"),je._t=de,je._i=$(null),je._f=void 0,je._l=void 0,je[se]=0,we!=null&&J(we,pe,je[Ae],je)});return U(Te.prototype,{clear:function(){for(var je=I(this,de),we=je._i,ot=je._f;ot;ot=ot.n)ot.r=!0,ot.p&&(ot.p=ot.p.n=void 0),delete we[ot.i];je._f=je._l=void 0,je[se]=0},delete:function(je){var we=I(this,de),ot=ie(we,je);if(ot){var _t=ot.n,Ut=ot.p;delete we._i[ot.i],ot.r=!0,Ut&&(Ut.n=_t),_t&&(_t.p=Ut),we._f==ot&&(we._f=_t),we._l==ot&&(we._l=Ut),we[se]--}return!!ot},forEach:function(je){I(this,de);for(var we,ot=B(je,arguments.length>1?arguments[1]:void 0,3);we=we?we.n:this._f;)for(ot(we.v,we.k,this);we&&we.r;)we=we.p},has:function(je){return!!ie(I(this,de),je)}}),P&&b(Te.prototype,"size",{get:function(){return I(this,de)[se]}}),Te},def:function(K,de,pe){var Ae,Te,je=ie(K,de);return je?je.v=pe:(K._l=je={i:Te=ee(de,!0),k:de,v:pe,p:Ae=K._l,n:void 0,r:!1},K._f||(K._f=je),Ae&&(Ae.n=je),K[se]++,Te!=="F"&&(K._i[Te]=je)),K},getEntry:ie,setStrong:function(K,de,pe){R(K,de,function(Ae,Te){this._t=I(Ae,de),this._k=Te,this._l=void 0},function(){for(var Ae=this._k,Te=this._l;Te&&Te.r;)Te=Te.p;return this._t&&(this._l=Te=Te?Te.n:this._t._f)?W(0,Ae=="keys"?Te.k:Ae=="values"?Te.v:[Te.k,Te.v]):(this._t=void 0,W(1))},pe?"entries":"values",!pe,!0),q(de)}}},function(Oe,A,a){var b=a(14),$=a(13),U=a(217);Oe.exports=function(B,re){if(b(B),$(re)&&re.constructor===B)return re;var J=U.f(B);return(0,J.resolve)(re),J.promise}},function(Oe,A,a){var b=a(55);Oe.exports.f=function($){return new function(U){var B,re;this.promise=new U(function(J,R){if(B!==void 0||re!==void 0)throw TypeError("Bad Promise constructor");B=J,re=R}),this.resolve=b(B),this.reject=b(re)}($)}},function(Oe,A,a){var b,$,U,B,re=a(83),J=a(16),R=a(56),W=a(105),q=a(8),P=a(13),ee=a(55),I=a(94),se=a(121),ie=a(104),K=a(152).set,de=a(466)(),pe=a(217),Ae=a(465),Te=a(120),je=a(216),we=J.TypeError,ot=J.process,_t=ot&&ot.versions,Ut=_t&&_t.v8||"",Xt=J.Promise,ke=W(ot)=="process",Ft=function(){},Gt=$=pe.f,jt=!!function(){try{var St=Xt.resolve(1),wn=(St.constructor={})[a(19)("species")]=function(Bn){Bn(Ft,Ft)};return(ke||typeof PromiseRejectionEvent=="function")&&St.then(Ft)instanceof wn&&Ut.indexOf("6.6")!==0&&Te.indexOf("Chrome/66")===-1}catch{}}(),Ye=function(St){var wn;return!(!P(St)||typeof(wn=St.then)!="function")&&wn},ln=function(St,wn){if(!St._n){St._n=!0;var Bn=St._c;de(function(){for(var Hn=St._v,hn=St._s==1,Ve=0,Qe=function(He){var pt,Lt,zt,Tn=hn?He.ok:He.fail,xn=He.resolve,Kn=He.reject,be=He.domain;try{Tn?(hn||(St._h==2&&Pt(St),St._h=1),Tn===!0?pt=Hn:(be&&be.enter(),pt=Tn(Hn),be&&(be.exit(),zt=!0)),pt===He.promise?Kn(we("Promise-chain cycle")):(Lt=Ye(pt))?Lt.call(pt,xn,Kn):xn(pt)):Kn(Hn)}catch(Yn){be&&!zt&&be.exit(),Kn(Yn)}};Bn.length>Ve;)Qe(Bn[Ve++]);St._c=[],St._n=!1,wn&&!St._h&&nn(St)})}},nn=function(St){K.call(J,function(){var wn,Bn,Hn,hn=St._v,Ve=Bt(St);if(Ve&&(wn=Ae(function(){ke?ot.emit("unhandledRejection",hn,St):(Bn=J.onunhandledrejection)?Bn({promise:St,reason:hn}):(Hn=J.console)&&Hn.error&&Hn.error("Unhandled promise rejection",hn)}),St._h=ke||Bt(St)?2:1),St._a=void 0,Ve&&wn.e)throw wn.v})},Bt=function(St){return St._h!==1&&(St._a||St._c).length===0},Pt=function(St){K.call(J,function(){var wn;ke?ot.emit("rejectionHandled",St):(wn=J.onrejectionhandled)&&wn({promise:St,reason:St._v})})},gn=function(St){var wn=this;wn._d||(wn._d=!0,(wn=wn._w||wn)._v=St,wn._s=2,wn._a||(wn._a=wn._c.slice()),ln(wn,!0))},Dt=function(St){var wn,Bn=this;if(!Bn._d){Bn._d=!0,Bn=Bn._w||Bn;try{if(Bn===St)throw we("Promise can't be resolved itself");(wn=Ye(St))?de(function(){var Hn={_w:Bn,_d:!1};try{wn.call(St,R(Dt,Hn,1),R(gn,Hn,1))}catch(hn){gn.call(Hn,hn)}}):(Bn._v=St,Bn._s=1,ln(Bn,!1))}catch(Hn){gn.call({_w:Bn,_d:!1},Hn)}}};jt||(Xt=function(St){I(this,Xt,"Promise","_h"),ee(St),b.call(this);try{St(R(Dt,this,1),R(gn,this,1))}catch(wn){gn.call(this,wn)}},(b=function(St){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1}).prototype=a(93)(Xt.prototype,{then:function(St,wn){var Bn=Gt(ie(this,Xt));return Bn.ok=typeof St!="function"||St,Bn.fail=typeof wn=="function"&&wn,Bn.domain=ke?ot.domain:void 0,this._c.push(Bn),this._a&&this._a.push(Bn),this._s&&ln(this,!1),Bn.promise},catch:function(St){return this.then(void 0,St)}}),U=function(){var St=new b;this.promise=St,this.resolve=R(Dt,St,1),this.reject=R(gn,St,1)},pe.f=Gt=function(St){return St===Xt||St===B?new U(St):$(St)}),q(q.G+q.W+q.F*!jt,{Promise:Xt}),a(98)(Xt,"Promise"),a(95)("Promise"),B=a(24).Promise,q(q.S+q.F*!jt,"Promise",{reject:function(St){var wn=Gt(this);return(0,wn.reject)(St),wn.promise}}),q(q.S+q.F*(re||!jt),"Promise",{resolve:function(St){return je(re&&this===B?Xt:this,St)}}),q(q.S+q.F*!(jt&&a(125)(function(St){Xt.all(St).catch(Ft)})),"Promise",{all:function(St){var wn=this,Bn=Gt(wn),Hn=Bn.resolve,hn=Bn.reject,Ve=Ae(function(){var Qe=[],He=0,pt=1;se(St,!1,function(Lt){var zt=He++,Tn=!1;Qe.push(void 0),pt++,wn.resolve(Lt).then(function(xn){Tn||(Tn=!0,Qe[zt]=xn,--pt||Hn(Qe))},hn)}),--pt||Hn(Qe)});return Ve.e&&hn(Ve.v),Bn.promise},race:function(St){var wn=this,Bn=Gt(wn),Hn=Bn.reject,hn=Ae(function(){se(St,!1,function(Ve){wn.resolve(Ve).then(Bn.resolve,Hn)})});return hn.e&&Hn(hn.v),Bn.promise}})},function(Oe,A,a){a(27)&&/./g.flags!="g"&&a(26).f(RegExp.prototype,"flags",{configurable:!0,get:a(124)})},function(Oe,A,a){var b=a(154);a(8)({target:"RegExp",proto:!0,forced:b!==/./.exec},{exec:b})},function(Oe,A){Oe.exports=function(a,b){return{value:b,done:!!a}}},function(Oe,A,a){var b=a(34),$=a(81),U=a(22);Oe.exports=[].copyWithin||function(B,re){var J=b(this),R=U(J.length),W=$(B,R),q=$(re,R),P=arguments.length>2?arguments[2]:void 0,ee=Math.min((P===void 0?R:$(P,R))-q,R-W),I=1;for(q<W&&W<q+ee&&(I=-1,q+=ee-1,W+=ee-1);ee-- >0;)q in J?J[W]=J[q]:delete J[W],W+=I,q+=I;return J}},function(Oe,A,a){var b=a(55),$=a(34),U=a(107),B=a(22);Oe.exports=function(re,J,R,W,q){b(J);var P=$(re),ee=U(P),I=B(P.length),se=q?I-1:0,ie=q?-1:1;if(R<2)for(;;){if(se in ee){W=ee[se],se+=ie;break}if(se+=ie,q?se<0:I<=se)throw TypeError("Reduce of empty array with no initial value")}for(;q?se>=0:I>se;se+=ie)se in ee&&(W=J(W,ee[se],se,P));return W}},function(Oe,A,a){var b=a(486);Oe.exports=function($,U){return new(b($))(U)}},function(Oe,A,a){var b=a(14);Oe.exports=function($,U,B,re){try{return re?U(b(B)[0],B[1]):U(B)}catch(R){var J=$.return;throw J!==void 0&&b(J.call($)),R}}},function(Oe,A,a){var b=a(80),$=a(85),U=a(98),B={};a(42)(B,a(19)("iterator"),function(){return this}),Oe.exports=function(re,J,R){re.prototype=b(B,{next:$(1,R)}),U(re,J+" Iterator")}},function(Oe,A){Oe.exports=Math.log1p||function(a){return(a=+a)>-1e-8&&a<1e-8?a-a*a/2:Math.log(1+a)}},function(Oe,A,a){var b=a(13),$=Math.floor;Oe.exports=function(U){return!b(U)&&isFinite(U)&&$(U)===U}},function(Oe,A,a){var b=a(62);Oe.exports=function($,U){if(typeof $!="number"&&b($)!="Number")throw TypeError(U);return+$}},function(Oe,A,a){var b=a(16).parseFloat,$=a(97).trim;Oe.exports=1/b(a(169)+"-0")!=-1/0?function(U){var B=$(String(U),3),re=b(B);return re===0&&B.charAt(0)=="-"?-0:re}:b},function(Oe,A,a){var b=a(16).parseInt,$=a(97).trim,U=a(169),B=/^[-+]?0[xX]/;Oe.exports=b(U+"08")!==8||b(U+"0x16")!==22?function(re,J){var R=$(String(re),3);return b(R,J>>>0||(B.test(R)?16:10))}:b},function(Oe,A){Oe.exports=function(a,b,$){var U=$===void 0;switch(b.length){case 0:return U?a():a.call($);case 1:return U?a(b[0]):a.call($,b[0]);case 2:return U?a(b[0],b[1]):a.call($,b[0],b[1]);case 3:return U?a(b[0],b[1],b[2]):a.call($,b[0],b[1],b[2]);case 4:return U?a(b[0],b[1],b[2],b[3]):a.call($,b[0],b[1],b[2],b[3])}return a.apply($,b)}},function(Oe,A,a){var b=a(55),$=a(13),U=a(232),B=[].slice,re={};Oe.exports=Function.bind||function(J){var R=b(this),W=B.call(arguments,1),q=function(){var P=W.concat(B.call(arguments));return this instanceof q?function(ee,I,se){if(!(I in re)){for(var ie=[],K=0;K<I;K++)ie[K]="a["+K+"]";re[I]=Function("F,a","return new F("+ie.join(",")+")")}return re[I](ee,se)}(R,P.length,P):U(R,P,J)};return $(R.prototype)&&(q.prototype=R.prototype),q}},function(Oe,A){Oe.exports=Object.is||function(a,b){return a===b?a!==0||1/a==1/b:a!=a&&b!=b}},function(Oe,A,a){var b=a(27),$=a(82),U=a(127),B=a(106),re=a(34),J=a(107),R=Object.assign;Oe.exports=!R||a(15)(function(){var W={},q={},P=Symbol(),ee="abcdefghijklmnopqrst";return W[P]=7,ee.split("").forEach(function(I){q[I]=I}),R({},W)[P]!=7||Object.keys(R({},q)).join("")!=ee})?function(W,q){for(var P=re(W),ee=arguments.length,I=1,se=U.f,ie=B.f;ee>I;)for(var K,de=J(arguments[I++]),pe=se?$(de).concat(se(de)):$(de),Ae=pe.length,Te=0;Ae>Te;)K=pe[Te++],b&&!ie.call(de,K)||(P[K]=de[K]);return P}:R},function(Oe,A,a){var b=a(41),$=a(79).f,U={}.toString,B=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];Oe.exports.f=function(re){return B&&U.call(re)=="[object Window]"?function(J){try{return $(J)}catch{return B.slice()}}(re):$(b(re))}},function(Oe,A,a){var b=a(26),$=a(14),U=a(82);Oe.exports=a(27)?Object.defineProperties:function(B,re){$(B);for(var J,R=U(re),W=R.length,q=0;W>q;)b.f(B,J=R[q++],re[J]);return B}},function(Oe,A,a){var b=a(43),$=a(41),U=a(128)(!1),B=a(173)("IE_PROTO");Oe.exports=function(re,J){var R,W=$(re),q=0,P=[];for(R in W)R!=B&&b(W,R)&&P.push(R);for(;J.length>q;)b(W,R=J[q++])&&(~U(P,R)||P.push(R));return P}},function(Oe,A,a){var b=a(16),$=a(24),U=a(83),B=a(174),re=a(26).f;Oe.exports=function(J){var R=$.Symbol||($.Symbol=U?{}:b.Symbol||{});J.charAt(0)=="_"||J in R||re(R,J,{value:B.f(J)})}},function(Oe,A,a){Oe.exports=!a(27)&&!a(15)(function(){return Object.defineProperty(a(175)("div"),"a",{get:function(){return 7}}).a!=7})},function(Oe,A,a){Object.defineProperty(A,"__esModule",{value:!0});var b=a(2);A.tf=b,function($){for(var U in $)A.hasOwnProperty(U)||(A[U]=$[U])}(a(257))},function(Oe,A,a){/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */(function(b,$,U){const B={1:{name:"/m/01g317",id:1,displayName:"person"},2:{name:"/m/0199g",id:2,displayName:"bicycle"},3:{name:"/m/0k4j",id:3,displayName:"car"},4:{name:"/m/04_sv",id:4,displayName:"motorcycle"},5:{name:"/m/05czz6l",id:5,displayName:"airplane"},6:{name:"/m/01bjv",id:6,displayName:"bus"},7:{name:"/m/07jdr",id:7,displayName:"train"},8:{name:"/m/07r04",id:8,displayName:"truck"},9:{name:"/m/019jd",id:9,displayName:"boat"},10:{name:"/m/015qff",id:10,displayName:"traffic light"},11:{name:"/m/01pns0",id:11,displayName:"fire hydrant"},13:{name:"/m/02pv19",id:13,displayName:"stop sign"},14:{name:"/m/015qbp",id:14,displayName:"parking meter"},15:{name:"/m/0cvnqh",id:15,displayName:"bench"},16:{name:"/m/015p6",id:16,displayName:"bird"},17:{name:"/m/01yrx",id:17,displayName:"cat"},18:{name:"/m/0bt9lr",id:18,displayName:"dog"},19:{name:"/m/03k3r",id:19,displayName:"horse"},20:{name:"/m/07bgp",id:20,displayName:"sheep"},21:{name:"/m/01xq0k1",id:21,displayName:"cow"},22:{name:"/m/0bwd_0j",id:22,displayName:"elephant"},23:{name:"/m/01dws",id:23,displayName:"bear"},24:{name:"/m/0898b",id:24,displayName:"zebra"},25:{name:"/m/03bk1",id:25,displayName:"giraffe"},27:{name:"/m/01940j",id:27,displayName:"backpack"},28:{name:"/m/0hnnb",id:28,displayName:"umbrella"},31:{name:"/m/080hkjn",id:31,displayName:"handbag"},32:{name:"/m/01rkbr",id:32,displayName:"tie"},33:{name:"/m/01s55n",id:33,displayName:"suitcase"},34:{name:"/m/02wmf",id:34,displayName:"frisbee"},35:{name:"/m/071p9",id:35,displayName:"skis"},36:{name:"/m/06__v",id:36,displayName:"snowboard"},37:{name:"/m/018xm",id:37,displayName:"sports ball"},38:{name:"/m/02zt3",id:38,displayName:"kite"},39:{name:"/m/03g8mr",id:39,displayName:"baseball bat"},40:{name:"/m/03grzl",id:40,displayName:"baseball glove"},41:{name:"/m/06_fw",id:41,displayName:"skateboard"},42:{name:"/m/019w40",id:42,displayName:"surfboard"},43:{name:"/m/0dv9c",id:43,displayName:"tennis racket"},44:{name:"/m/04dr76w",id:44,displayName:"bottle"},46:{name:"/m/09tvcd",id:46,displayName:"wine glass"},47:{name:"/m/08gqpm",id:47,displayName:"cup"},48:{name:"/m/0dt3t",id:48,displayName:"fork"},49:{name:"/m/04ctx",id:49,displayName:"knife"},50:{name:"/m/0cmx8",id:50,displayName:"spoon"},51:{name:"/m/04kkgm",id:51,displayName:"bowl"},52:{name:"/m/09qck",id:52,displayName:"banana"},53:{name:"/m/014j1m",id:53,displayName:"apple"},54:{name:"/m/0l515",id:54,displayName:"sandwich"},55:{name:"/m/0cyhj_",id:55,displayName:"orange"},56:{name:"/m/0hkxq",id:56,displayName:"broccoli"},57:{name:"/m/0fj52s",id:57,displayName:"carrot"},58:{name:"/m/01b9xk",id:58,displayName:"hot dog"},59:{name:"/m/0663v",id:59,displayName:"pizza"},60:{name:"/m/0jy4k",id:60,displayName:"donut"},61:{name:"/m/0fszt",id:61,displayName:"cake"},62:{name:"/m/01mzpv",id:62,displayName:"chair"},63:{name:"/m/02crq1",id:63,displayName:"couch"},64:{name:"/m/03fp41",id:64,displayName:"potted plant"},65:{name:"/m/03ssj5",id:65,displayName:"bed"},67:{name:"/m/04bcr3",id:67,displayName:"dining table"},70:{name:"/m/09g1w",id:70,displayName:"toilet"},72:{name:"/m/07c52",id:72,displayName:"tv"},73:{name:"/m/01c648",id:73,displayName:"laptop"},74:{name:"/m/020lf",id:74,displayName:"mouse"},75:{name:"/m/0qjjc",id:75,displayName:"remote"},76:{name:"/m/01m2v",id:76,displayName:"keyboard"},77:{name:"/m/050k8",id:77,displayName:"cell phone"},78:{name:"/m/0fx9l",id:78,displayName:"microwave"},79:{name:"/m/029bxz",id:79,displayName:"oven"},80:{name:"/m/01k6s3",id:80,displayName:"toaster"},81:{name:"/m/0130jx",id:81,displayName:"sink"},82:{name:"/m/040b_t",id:82,displayName:"refrigerator"},84:{name:"/m/0bt_c3",id:84,displayName:"book"},85:{name:"/m/01x3z",id:85,displayName:"clock"},86:{name:"/m/02s195",id:86,displayName:"vase"},87:{name:"/m/01lsmm",id:87,displayName:"scissors"},88:{name:"/m/0kmg4",id:88,displayName:"teddy bear"},89:{name:"/m/03wvsk",id:89,displayName:"hair drier"},90:{name:"/m/012xff",id:90,displayName:"toothbrush"}};class re{constructor(R,W){this.modelPath=W||`https://storage.googleapis.com/tfjs-models/savedmodel/${this.getPrefix(R)}/model.json`}getPrefix(R){return R==="lite_mobilenet_v2"?`ssd${R}`:`ssd_${R}`}async load(){this.model=await $.loadGraphModel(this.modelPath);const R=U.zeros([1,300,300,3],"int32"),W=await this.model.executeAsync(R);await Promise.all(W.map(q=>q.data())),W.map(q=>q.dispose()),R.dispose()}async infer(R,W,q){const P=U.tidy(()=>(R instanceof U.Tensor||(R=U.browser.fromPixels(R)),U.expandDims(R))),ee=P.shape[1],I=P.shape[2],se=await this.model.executeAsync(P),ie=se[0].dataSync(),K=se[1].dataSync();P.dispose(),U.dispose(se);const[de,pe]=this.calculateMaxScores(ie,se[0].shape[1],se[0].shape[2]),Ae=U.getBackend();U.getBackend()==="webgl"&&U.setBackend("cpu");const Te=U.tidy(()=>{const we=U.tensor2d(K,[se[1].shape[1],se[1].shape[3]]);return U.image.nonMaxSuppression(we,de,W,q,q)}),je=Te.dataSync();return Te.dispose(),Ae!==U.getBackend()&&U.setBackend(Ae),this.buildDetectedObjects(I,ee,K,de,je,pe)}buildDetectedObjects(R,W,q,P,ee,I){const se=ee.length,ie=[];for(let K=0;K<se;K++){const de=[];for(let we=0;we<4;we++)de[we]=q[4*ee[K]+we];const pe=de[0]*W,Ae=de[1]*R,Te=de[2]*W,je=de[3]*R;de[0]=Ae,de[1]=pe,de[2]=je-Ae,de[3]=Te-pe,ie.push({bbox:de,class:B[I[ee[K]]+1].displayName,score:P[ee[K]]})}return ie}calculateMaxScores(R,W,q){const P=[],ee=[];for(let I=0;I<W;I++){let se=Number.MIN_VALUE,ie=-1;for(let K=0;K<q;K++)R[I*q+K]>se&&(se=R[I*q+K],ie=K);P[I]=se,ee[I]=ie}return[P,ee]}async detect(R,W=20,q=.5){return this.infer(R,W,q)}dispose(){this.model!=null&&this.model.dispose()}}b.ObjectDetection=re,b.load=async function(J={}){if(U==null)throw new Error("Cannot find TensorFlow.js. If you are using a <script> tag, please also include @tensorflow/tfjs on the page before using this model.");const R=J.base||"lite_mobilenet_v2",W=J.modelUrl;if(["mobilenet_v1","mobilenet_v2","lite_mobilenet_v2"].indexOf(R)===-1)throw new Error(`ObjectDetection constructed with invalid base model ${R}. Valid names are 'mobilenet_v1', 'mobilenet_v2' and 'lite_mobilenet_v2'.`);const q=new re(R,W);return await q.load(),q},b.version="2.2.2",Object.defineProperty(b,"__esModule",{value:!0})})(A,a(20),a(0))},function(Oe,A,a){Oe.exports=function b($,U){if($===U)return!0;if($&&U&&typeof $=="object"&&typeof U=="object"){if($.constructor!==U.constructor)return!1;var B,re,J;if(Array.isArray($)){if((B=$.length)!=U.length)return!1;for(re=B;re--!=0;)if(!b($[re],U[re]))return!1;return!0}if($.constructor===RegExp)return $.source===U.source&&$.flags===U.flags;if($.valueOf!==Object.prototype.valueOf)return $.valueOf()===U.valueOf();if($.toString!==Object.prototype.toString)return $.toString()===U.toString();if((B=(J=Object.keys($)).length)!==Object.keys(U).length)return!1;for(re=B;re--!=0;)if(!Object.prototype.hasOwnProperty.call(U,J[re]))return!1;for(re=B;re--!=0;){var R=J[re];if(!b($[R],U[R]))return!1}return!0}return $!=$&&U!=U}},function(Oe,A,a){(function(b){var $=function(){function U(P,ee){return ee!=null&&P instanceof ee}var B,re,J;try{B=Map}catch{B=function(){}}try{re=Set}catch{re=function(){}}try{J=Promise}catch{J=function(){}}function R(P,ee,I,se,ie){typeof ee=="object"&&(I=ee.depth,se=ee.prototype,ie=ee.includeNonEnumerable,ee=ee.circular);var K=[],de=[],pe=b!==void 0;return ee===void 0&&(ee=!0),I===void 0&&(I=1/0),function Ae(Te,je){if(Te===null)return null;if(je===0)return Te;var we,ot;if(typeof Te!="object")return Te;if(U(Te,B))we=new B;else if(U(Te,re))we=new re;else if(U(Te,J))we=new J(function(ln,nn){Te.then(function(Bt){ln(Ae(Bt,je-1))},function(Bt){nn(Ae(Bt,je-1))})});else if(R.__isArray(Te))we=[];else if(R.__isRegExp(Te))we=new RegExp(Te.source,q(Te)),Te.lastIndex&&(we.lastIndex=Te.lastIndex);else if(R.__isDate(Te))we=new Date(Te.getTime());else{if(pe&&b.isBuffer(Te))return we=b.allocUnsafe?b.allocUnsafe(Te.length):new b(Te.length),Te.copy(we),we;U(Te,Error)?we=Object.create(Te):se===void 0?(ot=Object.getPrototypeOf(Te),we=Object.create(ot)):(we=Object.create(se),ot=se)}if(ee){var _t=K.indexOf(Te);if(_t!=-1)return de[_t];K.push(Te),de.push(we)}for(var Ut in U(Te,B)&&Te.forEach(function(ln,nn){var Bt=Ae(nn,je-1),Pt=Ae(ln,je-1);we.set(Bt,Pt)}),U(Te,re)&&Te.forEach(function(ln){var nn=Ae(ln,je-1);we.add(nn)}),Te){var Xt;ot&&(Xt=Object.getOwnPropertyDescriptor(ot,Ut)),Xt&&Xt.set==null||(we[Ut]=Ae(Te[Ut],je-1))}if(Object.getOwnPropertySymbols){var ke=Object.getOwnPropertySymbols(Te);for(Ut=0;Ut<ke.length;Ut++){var Ft=ke[Ut];(!(jt=Object.getOwnPropertyDescriptor(Te,Ft))||jt.enumerable||ie)&&(we[Ft]=Ae(Te[Ft],je-1),jt.enumerable||Object.defineProperty(we,Ft,{enumerable:!1}))}}if(ie){var Gt=Object.getOwnPropertyNames(Te);for(Ut=0;Ut<Gt.length;Ut++){var jt,Ye=Gt[Ut];(jt=Object.getOwnPropertyDescriptor(Te,Ye))&&jt.enumerable||(we[Ye]=Ae(Te[Ye],je-1),Object.defineProperty(we,Ye,{enumerable:!1}))}}return we}(P,I)}function W(P){return Object.prototype.toString.call(P)}function q(P){var ee="";return P.global&&(ee+="g"),P.ignoreCase&&(ee+="i"),P.multiline&&(ee+="m"),ee}return R.clonePrototype=function(P){if(P===null)return null;var ee=function(){};return ee.prototype=P,new ee},R.__objToStr=W,R.__isDate=function(P){return typeof P=="object"&&W(P)==="[object Date]"},R.__isArray=function(P){return typeof P=="object"&&W(P)==="[object Array]"},R.__isRegExp=function(P){return typeof P=="object"&&W(P)==="[object RegExp]"},R.__getRegExpFlags=q,R}();typeof Oe=="object"&&Oe.exports&&(Oe.exports=$)}).call(this,a(92).Buffer)},function(Oe){Oe.exports={name:"vega-lite",author:'Dominik Moritz, Kanit "Ham" Wongsuphasawat, Arvind Satyanarayan, Jeffrey Heer',version:"4.13.1",collaborators:["Kanit Wongsuphasawat (http://kanitw.yellowpigz.com)","Dominik Moritz (https://www.domoritz.de)","Arvind Satyanarayan (https://arvindsatya.com)","Jeffrey Heer (https://jheer.org)"],homepage:"https://vega.github.io/vega-lite/",description:"Vega-Lite is a concise high-level language for interactive visualization.",main:"build/vega-lite.js",unpkg:"build/vega-lite.min.js",jsdelivr:"build/vega-lite.min.js",module:"build/src/index",types:"build/src/index.d.ts",bin:{vl2png:"./bin/vl2png",vl2svg:"./bin/vl2svg",vl2pdf:"./bin/vl2pdf",vl2vg:"./bin/vl2vg"},directories:{test:"test"},scripts:{changelog:"conventional-changelog -p angular -r 2",build:"yarn build:only","build:only":"yarn tsc:src && rollup -c",postbuild:"terser build/vega-lite.js -cm --source-map content=build/vega-lite.js.map,filename=build/vega-lite.min.js.map -o build/vega-lite.min.js && yarn schema && babel build/vega-lite.js --out-dir build-es5 --config-file ./babel.config.js","prebuild:examples":"yarn build:only","build:examples":"yarn data && TZ=America/Los_Angeles scripts/build-examples.sh","prebuild:examples-full":"yarn build:only","build:examples-full":"TZ=America/Los_Angeles scripts/build-examples.sh 1","build:example":"TZ=America/Los_Angeles scripts/build-example.sh","build:toc":"yarn build:jekyll && scripts/generate-toc","build:site":"yarn tsc:site && rollup -c site/rollup.config.js","build:jekyll":"pushd site && bundle exec jekyll build -q && popd","build:versions":"scripts/update-version.sh",clean:"find build ! -name 'vega-lite-schema.json' -type f -delete && rm -rf site/data/* && rm -f examples/compiled/*.png && find site/examples ! -name 'index.md' ! -name 'data' -type f -delete","predeploy:site":"yarn presite","deploy:site":"gh-pages -d site",data:"rsync -r node_modules/vega-datasets/data/* site/data",schema:"mkdir -p build && ts-json-schema-generator -f tsconfig.json -p src/index.ts -t TopLevelSpec --no-type-check --no-ref-encode > build/vega-lite-schema.json && yarn renameschema && cp build/vega-lite-schema.json site/_data/",renameschema:"scripts/rename-schema.sh",presite:"yarn data && yarn schema && yarn build:site && yarn build:versions && scripts/create-example-pages.sh",site:"pushd site && bundle exec jekyll serve -I -l && popd","tsc:src":"tsc -b src/tsconfig.src.json","tsc:site":"tsc -b site/tsconfig.site.json",prettierbase:"prettier '**/*.{md,css,yml}'",eslintbase:"eslint .",format:"yarn eslintbase --fix && yarn prettierbase --write",lint:"yarn eslintbase && yarn prettierbase --check",test:"jest test/ && yarn lint && yarn schema && jest examples/ && yarn test:runtime","test:inspect":"node --inspect-brk ./node_modules/.bin/jest --runInBand test","test:runtime":"TZ=America/Los_Angeles jest test-runtime/","test:runtime:generate":"yarn build:only && rm -Rf test-runtime/resources && VL_GENERATE_TESTS=true yarn test:runtime","watch:build":"yarn build:only && concurrently --kill-others -n Typescript,Rollup 'yarn tsc:src -w' 'rollup -c -w'","watch:site":"concurrently --kill-others -n Typescript,Rollup 'yarn tsc:site -w' 'rollup -c site/rollup.config.js -w'","watch:test":"jest --watch"},repository:{type:"git",url:"https://github.com/vega/vega-lite.git"},license:"BSD-3-Clause",bugs:{url:"https://github.com/vega/vega-lite/issues"},devDependencies:{"@babel/cli":"^7.10.1","@babel/core":"^7.10.1","@babel/preset-env":"^7.10.1","@rollup/plugin-commonjs":"12.0.0","@rollup/plugin-json":"^4.0.3","@rollup/plugin-node-resolve":"^8.0.0","@types/chai":"^4.2.11","@types/d3":"^5.7.2","@types/jest":"^25.2.3","@types/mkdirp":"^1.0.0","@types/puppeteer":"^3.0.0","@typescript-eslint/eslint-plugin":"^3.0.2","@typescript-eslint/parser":"^3.0.2",ajv:"^6.12.2",chai:"^4.2.0",cheerio:"^1.0.0-rc.3",codecov:"^3.7.0",concurrently:"^5.2.0","conventional-changelog-cli":"^2.0.34",d3:"^5.16.0",eslint:"^7.1.0","eslint-config-prettier":"^6.11.0","eslint-plugin-jest":"^23.13.2","eslint-plugin-prettier":"^3.1.3","gh-pages":"^2.2.0","highlight.js":"^10.0.3","http-server":"^0.12.3",jest:"^26.0.1","jest-puppeteer":"^4.4.0",mkdirp:"^1.0.4",prettier:"^2.0.5",puppeteer:"^3.1.0",rollup:"^2.11.0","rollup-plugin-sourcemaps":"^0.6.2","rollup-plugin-terser":"^6.1.0","svg2png-many":"^0.0.7",terser:"^4.7.0","ts-jest":"^26.0.0","ts-json-schema-generator":"^0.68.1",typescript:"~3.9.3","vega-cli":"^5.12.1","vega-datasets":"^1.30.2","vega-embed":"^6.8.0","vega-tooltip":"^0.23.0","vega-typings":"^0.17.0","yaml-front-matter":"^4.1.0"},dependencies:{"@types/clone":"~0.1.30","@types/fast-json-stable-stringify":"^2.0.0","array-flat-polyfill":"^1.0.1",clone:"~2.1.2","fast-deep-equal":"~3.1.1","fast-json-stable-stringify":"~2.1.0","json-stringify-pretty-compact":"~2.0.0",tslib:"~2.0.0","vega-event-selector":"~2.0.3","vega-expression":"~2.6.5","vega-util":"~1.14.0",yargs:"~15.3.1"},peerDependencies:{vega:"^5.12.1"},jest:{preset:"jest-puppeteer",transform:{"^.+\\.tsx?$":"ts-jest"},testRegex:"(/__tests__/.*|(\\.|/)(test|spec))\\.(jsx?|tsx?)$",moduleFileExtensions:["ts","tsx","js","jsx","json","node"],testPathIgnorePatterns:["<rootDir>/node_modules","<rootDir>/build","<rootDir>/_site","<rootDir>/src"],coverageDirectory:"./coverage/",collectCoverage:!1}}},function(Oe,A,a){a.d(A,"a",function(){return P});var b=a(39),$=a(71),U=a(40),B=a(72),re=a(70),J=a(68);function R(_e){if(0<=_e.y&&_e.y<100){var et=new Date(-1,_e.m,_e.d,_e.H,_e.M,_e.S,_e.L);return et.setFullYear(_e.y),et}return new Date(_e.y,_e.m,_e.d,_e.H,_e.M,_e.S,_e.L)}function W(_e){if(0<=_e.y&&_e.y<100){var et=new Date(Date.UTC(-1,_e.m,_e.d,_e.H,_e.M,_e.S,_e.L));return et.setUTCFullYear(_e.y),et}return new Date(Date.UTC(_e.y,_e.m,_e.d,_e.H,_e.M,_e.S,_e.L))}function q(_e,et,gt){return{y:_e,m:et,d:gt,H:0,M:0,S:0,L:0}}function P(_e){var et=_e.dateTime,gt=_e.date,Rt=_e.time,fn=_e.periods,Jn=_e.days,An=_e.shortDays,Ln=_e.months,qn=_e.shortMonths,Nt=pe(fn),Ot=Ae(fn),pn=pe(Jn),Ht=Ae(Jn),Ue=pe(An),Mn=Ae(An),Gn=pe(Ln),Zn=Ae(Ln),ir=pe(qn),zr=Ae(qn),vr={a:function(qr){return An[qr.getDay()]},A:function(qr){return Jn[qr.getDay()]},b:function(qr){return qn[qr.getMonth()]},B:function(qr){return Ln[qr.getMonth()]},c:null,d:Bn,e:Bn,f:He,g:Nr,G:an,H:Hn,I:hn,j:Ve,L:Qe,m:pt,M:Lt,p:function(qr){return fn[+(qr.getHours()>=12)]},q:function(qr){return 1+~~(qr.getMonth()/3)},Q:le,s:ye,S:zt,u:Tn,U:xn,V:be,w:Yn,W:Dr,x:null,X:null,y:pr,Y:Fr,Z:Kt,"%":ge},pi={a:function(qr){return An[qr.getUTCDay()]},A:function(qr){return Jn[qr.getUTCDay()]},b:function(qr){return qn[qr.getUTCMonth()]},B:function(qr){return Ln[qr.getUTCMonth()]},c:null,d:Zt,e:Zt,f:gr,g:Ei,G:Lr,H:$n,I:Dn,j:hr,L:wr,m:Qr,M:ti,p:function(qr){return fn[+(qr.getUTCHours()>=12)]},q:function(qr){return 1+~~(qr.getUTCMonth()/3)},Q:le,s:ye,S:Mr,u:di,U:Yr,V:fi,w:oi,W:Ao,x:null,X:null,y:Wi,Y:bt,Z:Mt,"%":ge},fo={a:function(qr,jr,jn){var ri=Ue.exec(jr.slice(jn));return ri?(qr.w=Mn.get(ri[0].toLowerCase()),jn+ri[0].length):-1},A:function(qr,jr,jn){var ri=pn.exec(jr.slice(jn));return ri?(qr.w=Ht.get(ri[0].toLowerCase()),jn+ri[0].length):-1},b:function(qr,jr,jn){var ri=ir.exec(jr.slice(jn));return ri?(qr.m=zr.get(ri[0].toLowerCase()),jn+ri[0].length):-1},B:function(qr,jr,jn){var ri=Gn.exec(jr.slice(jn));return ri?(qr.m=Zn.get(ri[0].toLowerCase()),jn+ri[0].length):-1},c:function(qr,jr,jn){return Ti(qr,et,jr,jn)},d:jt,e:jt,f:gn,g:Xt,G:Ut,H:ln,I:ln,j:Ye,L:Pt,m:Gt,M:nn,p:function(qr,jr,jn){var ri=Nt.exec(jr.slice(jn));return ri?(qr.p=Ot.get(ri[0].toLowerCase()),jn+ri[0].length):-1},q:Ft,Q:St,s:wn,S:Bt,u:je,U:we,V:ot,w:Te,W:_t,x:function(qr,jr,jn){return Ti(qr,gt,jr,jn)},X:function(qr,jr,jn){return Ti(qr,Rt,jr,jn)},y:Xt,Y:Ut,Z:ke,"%":Dt};function ui(qr,jr){return function(jn){var ri,Vi,Rr,ao=[],yo=-1,eo=0,bo=qr.length;for(jn instanceof Date||(jn=new Date(+jn));++yo<bo;)qr.charCodeAt(yo)===37&&(ao.push(qr.slice(eo,yo)),(Vi=ee[ri=qr.charAt(++yo)])!=null?ri=qr.charAt(++yo):Vi=ri==="e"?" ":"0",(Rr=jr[ri])&&(ri=Rr(jn,Vi)),ao.push(ri),eo=yo+1);return ao.push(qr.slice(eo,yo)),ao.join("")}}function Zi(qr,jr){return function(jn){var ri,Vi,Rr=q(1900,void 0,1);if(Ti(Rr,qr,jn+="",0)!=jn.length)return null;if("Q"in Rr)return new Date(Rr.Q);if("s"in Rr)return new Date(1e3*Rr.s+("L"in Rr?Rr.L:0));if(!jr||"Z"in Rr||(Rr.Z=0),"p"in Rr&&(Rr.H=Rr.H%12+12*Rr.p),Rr.m===void 0&&(Rr.m="q"in Rr?Rr.q:0),"V"in Rr){if(Rr.V<1||Rr.V>53)return null;"w"in Rr||(Rr.w=1),"Z"in Rr?(ri=(Vi=(ri=W(q(Rr.y,0,1))).getUTCDay())>4||Vi===0?b.a.ceil(ri):Object(b.a)(ri),ri=$.a.offset(ri,7*(Rr.V-1)),Rr.y=ri.getUTCFullYear(),Rr.m=ri.getUTCMonth(),Rr.d=ri.getUTCDate()+(Rr.w+6)%7):(ri=(Vi=(ri=R(q(Rr.y,0,1))).getDay())>4||Vi===0?U.a.ceil(ri):Object(U.a)(ri),ri=B.a.offset(ri,7*(Rr.V-1)),Rr.y=ri.getFullYear(),Rr.m=ri.getMonth(),Rr.d=ri.getDate()+(Rr.w+6)%7)}else("W"in Rr||"U"in Rr)&&("w"in Rr||(Rr.w="u"in Rr?Rr.u%7:"W"in Rr?1:0),Vi="Z"in Rr?W(q(Rr.y,0,1)).getUTCDay():R(q(Rr.y,0,1)).getDay(),Rr.m=0,Rr.d="W"in Rr?(Rr.w+6)%7+7*Rr.W-(Vi+5)%7:Rr.w+7*Rr.U-(Vi+6)%7);return"Z"in Rr?(Rr.H+=Rr.Z/100|0,Rr.M+=Rr.Z%100,W(Rr)):R(Rr)}}function Ti(qr,jr,jn,ri){for(var Vi,Rr,ao=0,yo=jr.length,eo=jn.length;ao<yo;){if(ri>=eo)return-1;if((Vi=jr.charCodeAt(ao++))===37){if(Vi=jr.charAt(ao++),!(Rr=fo[Vi in ee?jr.charAt(ao++):Vi])||(ri=Rr(qr,jn,ri))<0)return-1}else if(Vi!=jn.charCodeAt(ri++))return-1}return ri}return vr.x=ui(gt,vr),vr.X=ui(Rt,vr),vr.c=ui(et,vr),pi.x=ui(gt,pi),pi.X=ui(Rt,pi),pi.c=ui(et,pi),{format:function(qr){var jr=ui(qr+="",vr);return jr.toString=function(){return qr},jr},parse:function(qr){var jr=Zi(qr+="",!1);return jr.toString=function(){return qr},jr},utcFormat:function(qr){var jr=ui(qr+="",pi);return jr.toString=function(){return qr},jr},utcParse:function(qr){var jr=Zi(qr+="",!0);return jr.toString=function(){return qr},jr}}}var ee={"-":"",_:" ",0:"0"},I=/^\s*\d+/,se=/^%/,ie=/[\\^$*+?|[\]().{}]/g;function K(_e,et,gt){var Rt=_e<0?"-":"",fn=(Rt?-_e:_e)+"",Jn=fn.length;return Rt+(Jn<gt?new Array(gt-Jn+1).join(et)+fn:fn)}function de(_e){return _e.replace(ie,"\\$&")}function pe(_e){return new RegExp("^(?:"+_e.map(de).join("|")+")","i")}function Ae(_e){return new Map(_e.map((et,gt)=>[et.toLowerCase(),gt]))}function Te(_e,et,gt){var Rt=I.exec(et.slice(gt,gt+1));return Rt?(_e.w=+Rt[0],gt+Rt[0].length):-1}function je(_e,et,gt){var Rt=I.exec(et.slice(gt,gt+1));return Rt?(_e.u=+Rt[0],gt+Rt[0].length):-1}function we(_e,et,gt){var Rt=I.exec(et.slice(gt,gt+2));return Rt?(_e.U=+Rt[0],gt+Rt[0].length):-1}function ot(_e,et,gt){var Rt=I.exec(et.slice(gt,gt+2));return Rt?(_e.V=+Rt[0],gt+Rt[0].length):-1}function _t(_e,et,gt){var Rt=I.exec(et.slice(gt,gt+2));return Rt?(_e.W=+Rt[0],gt+Rt[0].length):-1}function Ut(_e,et,gt){var Rt=I.exec(et.slice(gt,gt+4));return Rt?(_e.y=+Rt[0],gt+Rt[0].length):-1}function Xt(_e,et,gt){var Rt=I.exec(et.slice(gt,gt+2));return Rt?(_e.y=+Rt[0]+(+Rt[0]>68?1900:2e3),gt+Rt[0].length):-1}function ke(_e,et,gt){var Rt=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(et.slice(gt,gt+6));return Rt?(_e.Z=Rt[1]?0:-(Rt[2]+(Rt[3]||"00")),gt+Rt[0].length):-1}function Ft(_e,et,gt){var Rt=I.exec(et.slice(gt,gt+1));return Rt?(_e.q=3*Rt[0]-3,gt+Rt[0].length):-1}function Gt(_e,et,gt){var Rt=I.exec(et.slice(gt,gt+2));return Rt?(_e.m=Rt[0]-1,gt+Rt[0].length):-1}function jt(_e,et,gt){var Rt=I.exec(et.slice(gt,gt+2));return Rt?(_e.d=+Rt[0],gt+Rt[0].length):-1}function Ye(_e,et,gt){var Rt=I.exec(et.slice(gt,gt+3));return Rt?(_e.m=0,_e.d=+Rt[0],gt+Rt[0].length):-1}function ln(_e,et,gt){var Rt=I.exec(et.slice(gt,gt+2));return Rt?(_e.H=+Rt[0],gt+Rt[0].length):-1}function nn(_e,et,gt){var Rt=I.exec(et.slice(gt,gt+2));return Rt?(_e.M=+Rt[0],gt+Rt[0].length):-1}function Bt(_e,et,gt){var Rt=I.exec(et.slice(gt,gt+2));return Rt?(_e.S=+Rt[0],gt+Rt[0].length):-1}function Pt(_e,et,gt){var Rt=I.exec(et.slice(gt,gt+3));return Rt?(_e.L=+Rt[0],gt+Rt[0].length):-1}function gn(_e,et,gt){var Rt=I.exec(et.slice(gt,gt+6));return Rt?(_e.L=Math.floor(Rt[0]/1e3),gt+Rt[0].length):-1}function Dt(_e,et,gt){var Rt=se.exec(et.slice(gt,gt+1));return Rt?gt+Rt[0].length:-1}function St(_e,et,gt){var Rt=I.exec(et.slice(gt));return Rt?(_e.Q=+Rt[0],gt+Rt[0].length):-1}function wn(_e,et,gt){var Rt=I.exec(et.slice(gt));return Rt?(_e.s=+Rt[0],gt+Rt[0].length):-1}function Bn(_e,et){return K(_e.getDate(),et,2)}function Hn(_e,et){return K(_e.getHours(),et,2)}function hn(_e,et){return K(_e.getHours()%12||12,et,2)}function Ve(_e,et){return K(1+B.a.count(Object(re.a)(_e),_e),et,3)}function Qe(_e,et){return K(_e.getMilliseconds(),et,3)}function He(_e,et){return Qe(_e,et)+"000"}function pt(_e,et){return K(_e.getMonth()+1,et,2)}function Lt(_e,et){return K(_e.getMinutes(),et,2)}function zt(_e,et){return K(_e.getSeconds(),et,2)}function Tn(_e){var et=_e.getDay();return et===0?7:et}function xn(_e,et){return K(U.b.count(Object(re.a)(_e)-1,_e),et,2)}function Kn(_e){var et=_e.getDay();return et>=4||et===0?Object(U.c)(_e):U.c.ceil(_e)}function be(_e,et){return _e=Kn(_e),K(U.c.count(Object(re.a)(_e),_e)+(Object(re.a)(_e).getDay()===4),et,2)}function Yn(_e){return _e.getDay()}function Dr(_e,et){return K(U.a.count(Object(re.a)(_e)-1,_e),et,2)}function pr(_e,et){return K(_e.getFullYear()%100,et,2)}function Nr(_e,et){return K((_e=Kn(_e)).getFullYear()%100,et,2)}function Fr(_e,et){return K(_e.getFullYear()%1e4,et,4)}function an(_e,et){var gt=_e.getDay();return K((_e=gt>=4||gt===0?Object(U.c)(_e):U.c.ceil(_e)).getFullYear()%1e4,et,4)}function Kt(_e){var et=_e.getTimezoneOffset();return(et>0?"-":(et*=-1,"+"))+K(et/60|0,"0",2)+K(et%60,"0",2)}function Zt(_e,et){return K(_e.getUTCDate(),et,2)}function $n(_e,et){return K(_e.getUTCHours(),et,2)}function Dn(_e,et){return K(_e.getUTCHours()%12||12,et,2)}function hr(_e,et){return K(1+$.a.count(Object(J.a)(_e),_e),et,3)}function wr(_e,et){return K(_e.getUTCMilliseconds(),et,3)}function gr(_e,et){return wr(_e,et)+"000"}function Qr(_e,et){return K(_e.getUTCMonth()+1,et,2)}function ti(_e,et){return K(_e.getUTCMinutes(),et,2)}function Mr(_e,et){return K(_e.getUTCSeconds(),et,2)}function di(_e){var et=_e.getUTCDay();return et===0?7:et}function Yr(_e,et){return K(b.b.count(Object(J.a)(_e)-1,_e),et,2)}function Xr(_e){var et=_e.getUTCDay();return et>=4||et===0?Object(b.c)(_e):b.c.ceil(_e)}function fi(_e,et){return _e=Xr(_e),K(b.c.count(Object(J.a)(_e),_e)+(Object(J.a)(_e).getUTCDay()===4),et,2)}function oi(_e){return _e.getUTCDay()}function Ao(_e,et){return K(b.a.count(Object(J.a)(_e)-1,_e),et,2)}function Wi(_e,et){return K(_e.getUTCFullYear()%100,et,2)}function Ei(_e,et){return K((_e=Xr(_e)).getUTCFullYear()%100,et,2)}function bt(_e,et){return K(_e.getUTCFullYear()%1e4,et,4)}function Lr(_e,et){var gt=_e.getUTCDay();return K((_e=gt>=4||gt===0?Object(b.c)(_e):b.c.ceil(_e)).getUTCFullYear()%1e4,et,4)}function Mt(){return"+0000"}function ge(){return"%"}function le(_e){return+_e}function ye(_e){return Math.floor(+_e/1e3)}},function(Oe,A,a){a.r(A);var b="http://www.w3.org/1999/xhtml",$={svg:"http://www.w3.org/2000/svg",xhtml:b,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"},U=function(an){var Kt=an+="",Zt=Kt.indexOf(":");return Zt>=0&&(Kt=an.slice(0,Zt))!=="xmlns"&&(an=an.slice(Zt+1)),$.hasOwnProperty(Kt)?{space:$[Kt],local:an}:an},B=function(an){var Kt=U(an);return(Kt.local?function(Zt){return function(){return this.ownerDocument.createElementNS(Zt.space,Zt.local)}}:function(Zt){return function(){var $n=this.ownerDocument,Dn=this.namespaceURI;return Dn===b&&$n.documentElement.namespaceURI===b?$n.createElement(Zt):$n.createElementNS(Dn,Zt)}})(Kt)};function re(){}var J=function(an){return an==null?re:function(){return this.querySelector(an)}};function R(){return[]}var W=function(an){return an==null?R:function(){return this.querySelectorAll(an)}},q=function(an){return function(){return this.matches(an)}};if(typeof document<"u"){var P=document.documentElement;if(!P.matches){var ee=P.webkitMatchesSelector||P.msMatchesSelector||P.mozMatchesSelector||P.oMatchesSelector;q=function(an){return function(){return ee.call(this,an)}}}}var I=q,se=function(an){return new Array(an.length)};function ie(an,Kt){this.ownerDocument=an.ownerDocument,this.namespaceURI=an.namespaceURI,this._next=null,this._parent=an,this.__data__=Kt}ie.prototype={constructor:ie,appendChild:function(an){return this._parent.insertBefore(an,this._next)},insertBefore:function(an,Kt){return this._parent.insertBefore(an,Kt)},querySelector:function(an){return this._parent.querySelector(an)},querySelectorAll:function(an){return this._parent.querySelectorAll(an)}};var K="$";function de(an,Kt,Zt,$n,Dn,hr){for(var wr,gr=0,Qr=Kt.length,ti=hr.length;gr<ti;++gr)(wr=Kt[gr])?(wr.__data__=hr[gr],$n[gr]=wr):Zt[gr]=new ie(an,hr[gr]);for(;gr<Qr;++gr)(wr=Kt[gr])&&(Dn[gr]=wr)}function pe(an,Kt,Zt,$n,Dn,hr,wr){var gr,Qr,ti,Mr={},di=Kt.length,Yr=hr.length,Xr=new Array(di);for(gr=0;gr<di;++gr)(Qr=Kt[gr])&&(Xr[gr]=ti=K+wr.call(Qr,Qr.__data__,gr,Kt),ti in Mr?Dn[gr]=Qr:Mr[ti]=Qr);for(gr=0;gr<Yr;++gr)(Qr=Mr[ti=K+wr.call(an,hr[gr],gr,hr)])?($n[gr]=Qr,Qr.__data__=hr[gr],Mr[ti]=null):Zt[gr]=new ie(an,hr[gr]);for(gr=0;gr<di;++gr)(Qr=Kt[gr])&&Mr[Xr[gr]]===Qr&&(Dn[gr]=Qr)}function Ae(an,Kt){return an<Kt?-1:an>Kt?1:an>=Kt?0:NaN}var Te=function(an){return an.ownerDocument&&an.ownerDocument.defaultView||an.document&&an||an.defaultView};function je(an,Kt){return an.style.getPropertyValue(Kt)||Te(an).getComputedStyle(an,null).getPropertyValue(Kt)}function we(an){return an.trim().split(/^|\s+/)}function ot(an){return an.classList||new _t(an)}function _t(an){this._node=an,this._names=we(an.getAttribute("class")||"")}function Ut(an,Kt){for(var Zt=ot(an),$n=-1,Dn=Kt.length;++$n<Dn;)Zt.add(Kt[$n])}function Xt(an,Kt){for(var Zt=ot(an),$n=-1,Dn=Kt.length;++$n<Dn;)Zt.remove(Kt[$n])}_t.prototype={add:function(an){this._names.indexOf(an)<0&&(this._names.push(an),this._node.setAttribute("class",this._names.join(" ")))},remove:function(an){var Kt=this._names.indexOf(an);Kt>=0&&(this._names.splice(Kt,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(an){return this._names.indexOf(an)>=0}};function ke(){this.textContent=""}function Ft(){this.innerHTML=""}function Gt(){this.nextSibling&&this.parentNode.appendChild(this)}function jt(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function Ye(){return null}function ln(){var an=this.parentNode;an&&an.removeChild(this)}function nn(){return this.parentNode.insertBefore(this.cloneNode(!1),this.nextSibling)}function Bt(){return this.parentNode.insertBefore(this.cloneNode(!0),this.nextSibling)}var Pt={},gn=null;typeof document<"u"&&("onmouseenter"in document.documentElement||(Pt={mouseenter:"mouseover",mouseleave:"mouseout"}));function Dt(an,Kt,Zt){return an=St(an,Kt,Zt),function($n){var Dn=$n.relatedTarget;Dn&&(Dn===this||8&Dn.compareDocumentPosition(this))||an.call(this,$n)}}function St(an,Kt,Zt){return function($n){var Dn=gn;gn=$n;try{an.call(this,this.__data__,Kt,Zt)}finally{gn=Dn}}}function wn(an){return function(){var Kt=this.__on;if(Kt){for(var Zt,$n=0,Dn=-1,hr=Kt.length;$n<hr;++$n)Zt=Kt[$n],an.type&&Zt.type!==an.type||Zt.name!==an.name?Kt[++Dn]=Zt:this.removeEventListener(Zt.type,Zt.listener,Zt.capture);++Dn?Kt.length=Dn:delete this.__on}}}function Bn(an,Kt,Zt){var $n=Pt.hasOwnProperty(an.type)?Dt:St;return function(Dn,hr,wr){var gr,Qr=this.__on,ti=$n(Kt,hr,wr);if(Qr){for(var Mr=0,di=Qr.length;Mr<di;++Mr)if((gr=Qr[Mr]).type===an.type&&gr.name===an.name)return this.removeEventListener(gr.type,gr.listener,gr.capture),this.addEventListener(gr.type,gr.listener=ti,gr.capture=Zt),void(gr.value=Kt)}this.addEventListener(an.type,ti,Zt),gr={type:an.type,name:an.name,value:Kt,listener:ti,capture:Zt},Qr?Qr.push(gr):this.__on=[gr]}}function Hn(an,Kt,Zt,$n){var Dn=gn;an.sourceEvent=gn,gn=an;try{return Kt.apply(Zt,$n)}finally{gn=Dn}}function hn(an,Kt,Zt){var $n=Te(an),Dn=$n.CustomEvent;typeof Dn=="function"?Dn=new Dn(Kt,Zt):(Dn=$n.document.createEvent("Event"),Zt?(Dn.initEvent(Kt,Zt.bubbles,Zt.cancelable),Dn.detail=Zt.detail):Dn.initEvent(Kt,!1,!1)),an.dispatchEvent(Dn)}var Ve=[null];function Qe(an,Kt){this._groups=an,this._parents=Kt}function He(){return new Qe([[document.documentElement]],Ve)}Qe.prototype=He.prototype={constructor:Qe,select:function(an){typeof an!="function"&&(an=J(an));for(var Kt=this._groups,Zt=Kt.length,$n=new Array(Zt),Dn=0;Dn<Zt;++Dn)for(var hr,wr,gr=Kt[Dn],Qr=gr.length,ti=$n[Dn]=new Array(Qr),Mr=0;Mr<Qr;++Mr)(hr=gr[Mr])&&(wr=an.call(hr,hr.__data__,Mr,gr))&&("__data__"in hr&&(wr.__data__=hr.__data__),ti[Mr]=wr);return new Qe($n,this._parents)},selectAll:function(an){typeof an!="function"&&(an=W(an));for(var Kt=this._groups,Zt=Kt.length,$n=[],Dn=[],hr=0;hr<Zt;++hr)for(var wr,gr=Kt[hr],Qr=gr.length,ti=0;ti<Qr;++ti)(wr=gr[ti])&&($n.push(an.call(wr,wr.__data__,ti,gr)),Dn.push(wr));return new Qe($n,Dn)},filter:function(an){typeof an!="function"&&(an=I(an));for(var Kt=this._groups,Zt=Kt.length,$n=new Array(Zt),Dn=0;Dn<Zt;++Dn)for(var hr,wr=Kt[Dn],gr=wr.length,Qr=$n[Dn]=[],ti=0;ti<gr;++ti)(hr=wr[ti])&&an.call(hr,hr.__data__,ti,wr)&&Qr.push(hr);return new Qe($n,this._parents)},data:function(an,Kt){if(!an)return Xr=new Array(this.size()),ti=-1,this.each(function(Mt){Xr[++ti]=Mt}),Xr;var Zt=Kt?pe:de,$n=this._parents,Dn=this._groups;typeof an!="function"&&(an=function(Mt){return function(){return Mt}}(an));for(var hr=Dn.length,wr=new Array(hr),gr=new Array(hr),Qr=new Array(hr),ti=0;ti<hr;++ti){var Mr=$n[ti],di=Dn[ti],Yr=di.length,Xr=an.call(Mr,Mr&&Mr.__data__,ti,$n),fi=Xr.length,oi=gr[ti]=new Array(fi),Ao=wr[ti]=new Array(fi);Zt(Mr,di,oi,Ao,Qr[ti]=new Array(Yr),Xr,Kt);for(var Wi,Ei,bt=0,Lr=0;bt<fi;++bt)if(Wi=oi[bt]){for(bt>=Lr&&(Lr=bt+1);!(Ei=Ao[Lr])&&++Lr<fi;);Wi._next=Ei||null}}return(wr=new Qe(wr,$n))._enter=gr,wr._exit=Qr,wr},enter:function(){return new Qe(this._enter||this._groups.map(se),this._parents)},exit:function(){return new Qe(this._exit||this._groups.map(se),this._parents)},merge:function(an){for(var Kt=this._groups,Zt=an._groups,$n=Kt.length,Dn=Zt.length,hr=Math.min($n,Dn),wr=new Array($n),gr=0;gr<hr;++gr)for(var Qr,ti=Kt[gr],Mr=Zt[gr],di=ti.length,Yr=wr[gr]=new Array(di),Xr=0;Xr<di;++Xr)(Qr=ti[Xr]||Mr[Xr])&&(Yr[Xr]=Qr);for(;gr<$n;++gr)wr[gr]=Kt[gr];return new Qe(wr,this._parents)},order:function(){for(var an=this._groups,Kt=-1,Zt=an.length;++Kt<Zt;)for(var $n,Dn=an[Kt],hr=Dn.length-1,wr=Dn[hr];--hr>=0;)($n=Dn[hr])&&(wr&&wr!==$n.nextSibling&&wr.parentNode.insertBefore($n,wr),wr=$n);return this},sort:function(an){function Kt(di,Yr){return di&&Yr?an(di.__data__,Yr.__data__):!di-!Yr}an||(an=Ae);for(var Zt=this._groups,$n=Zt.length,Dn=new Array($n),hr=0;hr<$n;++hr){for(var wr,gr=Zt[hr],Qr=gr.length,ti=Dn[hr]=new Array(Qr),Mr=0;Mr<Qr;++Mr)(wr=gr[Mr])&&(ti[Mr]=wr);ti.sort(Kt)}return new Qe(Dn,this._parents).order()},call:function(){var an=arguments[0];return arguments[0]=this,an.apply(null,arguments),this},nodes:function(){var an=new Array(this.size()),Kt=-1;return this.each(function(){an[++Kt]=this}),an},node:function(){for(var an=this._groups,Kt=0,Zt=an.length;Kt<Zt;++Kt)for(var $n=an[Kt],Dn=0,hr=$n.length;Dn<hr;++Dn){var wr=$n[Dn];if(wr)return wr}return null},size:function(){var an=0;return this.each(function(){++an}),an},empty:function(){return!this.node()},each:function(an){for(var Kt=this._groups,Zt=0,$n=Kt.length;Zt<$n;++Zt)for(var Dn,hr=Kt[Zt],wr=0,gr=hr.length;wr<gr;++wr)(Dn=hr[wr])&&an.call(Dn,Dn.__data__,wr,hr);return this},attr:function(an,Kt){var Zt=U(an);if(arguments.length<2){var $n=this.node();return Zt.local?$n.getAttributeNS(Zt.space,Zt.local):$n.getAttribute(Zt)}return this.each((Kt==null?Zt.local?function(Dn){return function(){this.removeAttributeNS(Dn.space,Dn.local)}}:function(Dn){return function(){this.removeAttribute(Dn)}}:typeof Kt=="function"?Zt.local?function(Dn,hr){return function(){var wr=hr.apply(this,arguments);wr==null?this.removeAttributeNS(Dn.space,Dn.local):this.setAttributeNS(Dn.space,Dn.local,wr)}}:function(Dn,hr){return function(){var wr=hr.apply(this,arguments);wr==null?this.removeAttribute(Dn):this.setAttribute(Dn,wr)}}:Zt.local?function(Dn,hr){return function(){this.setAttributeNS(Dn.space,Dn.local,hr)}}:function(Dn,hr){return function(){this.setAttribute(Dn,hr)}})(Zt,Kt))},style:function(an,Kt,Zt){return arguments.length>1?this.each((Kt==null?function($n){return function(){this.style.removeProperty($n)}}:typeof Kt=="function"?function($n,Dn,hr){return function(){var wr=Dn.apply(this,arguments);wr==null?this.style.removeProperty($n):this.style.setProperty($n,wr,hr)}}:function($n,Dn,hr){return function(){this.style.setProperty($n,Dn,hr)}})(an,Kt,Zt??"")):je(this.node(),an)},property:function(an,Kt){return arguments.length>1?this.each((Kt==null?function(Zt){return function(){delete this[Zt]}}:typeof Kt=="function"?function(Zt,$n){return function(){var Dn=$n.apply(this,arguments);Dn==null?delete this[Zt]:this[Zt]=Dn}}:function(Zt,$n){return function(){this[Zt]=$n}})(an,Kt)):this.node()[an]},classed:function(an,Kt){var Zt=we(an+"");if(arguments.length<2){for(var $n=ot(this.node()),Dn=-1,hr=Zt.length;++Dn<hr;)if(!$n.contains(Zt[Dn]))return!1;return!0}return this.each((typeof Kt=="function"?function(wr,gr){return function(){(gr.apply(this,arguments)?Ut:Xt)(this,wr)}}:Kt?function(wr){return function(){Ut(this,wr)}}:function(wr){return function(){Xt(this,wr)}})(Zt,Kt))},text:function(an){return arguments.length?this.each(an==null?ke:(typeof an=="function"?function(Kt){return function(){var Zt=Kt.apply(this,arguments);this.textContent=Zt??""}}:function(Kt){return function(){this.textContent=Kt}})(an)):this.node().textContent},html:function(an){return arguments.length?this.each(an==null?Ft:(typeof an=="function"?function(Kt){return function(){var Zt=Kt.apply(this,arguments);this.innerHTML=Zt??""}}:function(Kt){return function(){this.innerHTML=Kt}})(an)):this.node().innerHTML},raise:function(){return this.each(Gt)},lower:function(){return this.each(jt)},append:function(an){var Kt=typeof an=="function"?an:B(an);return this.select(function(){return this.appendChild(Kt.apply(this,arguments))})},insert:function(an,Kt){var Zt=typeof an=="function"?an:B(an),$n=Kt==null?Ye:typeof Kt=="function"?Kt:J(Kt);return this.select(function(){return this.insertBefore(Zt.apply(this,arguments),$n.apply(this,arguments)||null)})},remove:function(){return this.each(ln)},clone:function(an){return this.select(an?Bt:nn)},datum:function(an){return arguments.length?this.property("__data__",an):this.node().__data__},on:function(an,Kt,Zt){var $n,Dn,hr=function(di){return di.trim().split(/^|\s+/).map(function(Yr){var Xr="",fi=Yr.indexOf(".");return fi>=0&&(Xr=Yr.slice(fi+1),Yr=Yr.slice(0,fi)),{type:Yr,name:Xr}})}(an+""),wr=hr.length;if(!(arguments.length<2)){for(gr=Kt?Bn:wn,Zt==null&&(Zt=!1),$n=0;$n<wr;++$n)this.each(gr(hr[$n],Kt,Zt));return this}var gr=this.node().__on;if(gr){for(var Qr,ti=0,Mr=gr.length;ti<Mr;++ti)for($n=0,Qr=gr[ti];$n<wr;++$n)if((Dn=hr[$n]).type===Qr.type&&Dn.name===Qr.name)return Qr.value}},dispatch:function(an,Kt){return this.each((typeof Kt=="function"?function(Zt,$n){return function(){return hn(this,Zt,$n.apply(this,arguments))}}:function(Zt,$n){return function(){return hn(this,Zt,$n)}})(an,Kt))}};var pt=He,Lt=function(an){return typeof an=="string"?new Qe([[document.querySelector(an)]],[document.documentElement]):new Qe([[an]],Ve)},zt=function(an){return Lt(B(an).call(document.documentElement))},Tn=0;function xn(){return new Kn}function Kn(){this._="@"+(++Tn).toString(36)}Kn.prototype=xn.prototype={constructor:Kn,get:function(an){for(var Kt=this._;!(Kt in an);)if(!(an=an.parentNode))return;return an[Kt]},set:function(an,Kt){return an[this._]=Kt},remove:function(an){return this._ in an&&delete an[this._]},toString:function(){return this._}};var be=function(){for(var an,Kt=gn;an=Kt.sourceEvent;)Kt=an;return Kt},Yn=function(an,Kt){var Zt=an.ownerSVGElement||an;if(Zt.createSVGPoint){var $n=Zt.createSVGPoint();return $n.x=Kt.clientX,$n.y=Kt.clientY,[($n=$n.matrixTransform(an.getScreenCTM().inverse())).x,$n.y]}var Dn=an.getBoundingClientRect();return[Kt.clientX-Dn.left-an.clientLeft,Kt.clientY-Dn.top-an.clientTop]},Dr=function(an){var Kt=be();return Kt.changedTouches&&(Kt=Kt.changedTouches[0]),Yn(an,Kt)},pr=function(an){return typeof an=="string"?new Qe([document.querySelectorAll(an)],[document.documentElement]):new Qe([an??[]],Ve)},Nr=function(an,Kt,Zt){arguments.length<3&&(Zt=Kt,Kt=be().changedTouches);for(var $n,Dn=0,hr=Kt?Kt.length:0;Dn<hr;++Dn)if(($n=Kt[Dn]).identifier===Zt)return Yn(an,$n);return null},Fr=function(an,Kt){Kt==null&&(Kt=be().touches);for(var Zt=0,$n=Kt?Kt.length:0,Dn=new Array($n);Zt<$n;++Zt)Dn[Zt]=Yn(an,Kt[Zt]);return Dn};a.d(A,"create",function(){return zt}),a.d(A,"creator",function(){return B}),a.d(A,"local",function(){return xn}),a.d(A,"matcher",function(){return I}),a.d(A,"mouse",function(){return Dr}),a.d(A,"namespace",function(){return U}),a.d(A,"namespaces",function(){return $}),a.d(A,"clientPoint",function(){return Yn}),a.d(A,"select",function(){return Lt}),a.d(A,"selectAll",function(){return pr}),a.d(A,"selection",function(){return pt}),a.d(A,"selector",function(){return J}),a.d(A,"selectorAll",function(){return W}),a.d(A,"style",function(){return je}),a.d(A,"touch",function(){return Nr}),a.d(A,"touches",function(){return Fr}),a.d(A,"window",function(){return Te}),a.d(A,"event",function(){return gn}),a.d(A,"customEvent",function(){return Hn})},function(Oe,A,a){a.r(A);var b={};a.d(b,"load",function(){return Dt});var $={};a.d($,"Darknet",function(){return He}),a.d($,"load",function(){return pt});var U={};a.d(U,"Doodlenet",function(){return Yn}),a.d(U,"load",function(){return Dr});var B={};a.d(B,"array3DToImage",function(){return an}),a.d(B,"processVideo",function(){return Fr}),a.d(B,"cropImage",function(){return Kt}),a.d(B,"imgToTensor",function(){return $n}),a.d(B,"isInstanceOfSupportedElement",function(){return Dn}),a.d(B,"flipImage",function(){return Zt}),a.d(B,"imgToPixelArray",function(){return hr});var re={};a.d(re,"SpeechCommands",function(){return ir}),a.d(re,"load",function(){return zr});var J={};a.d(J,"isTensor",function(){return io}),a.d(J,"isTensor1D",function(){return Bl}),a.d(J,"isTensor2D",function(){return Rf}),a.d(J,"isTensor3D",function(){return nr}),a.d(J,"isTensor4D",function(){return $a}),a.d(J,"isFloat",function(){return xa}),a.d(J,"isEven",function(){return Hi}),a.d(J,"round",function(){return ku}),a.d(J,"isDimensions",function(){return ac}),a.d(J,"computeReshapedDimensions",function(){return qs}),a.d(J,"getCenterPoint",function(){return sc}),a.d(J,"range",function(){return Xo}),a.d(J,"isValidNumber",function(){return Vu}),a.d(J,"isValidProbablitiy",function(){return Hs});var R={};a.d(R,"drawContour",function(){return Vs}),a.d(R,"drawDetections",function(){return tr}),a.d(R,"drawFaceExpressions",function(){return Xs}),a.d(R,"DrawBoxOptions",function(){return Wn}),a.d(R,"DrawBox",function(){return Rn}),a.d(R,"DrawFaceLandmarksOptions",function(){return es}),a.d(R,"DrawFaceLandmarks",function(){return ja}),a.d(R,"drawFaceLandmarks",function(){return lc}),a.d(R,"AnchorPosition",function(){return Tt}),a.d(R,"DrawTextFieldOptions",function(){return Sn}),a.d(R,"DrawTextField",function(){return Nn});var W={};a.d(W,"draw",function(){return R}),a.d(W,"utils",function(){return J}),a.d(W,"tf",function(){return tn}),a.d(W,"env",function(){return Wt}),a.d(W,"FaceLandmarkNet",function(){return xg}),a.d(W,"createFaceRecognitionNet",function(){return Sm}),a.d(W,"createMtcnn",function(){return zm}),a.d(W,"sigmoid",function(){return Qc}),a.d(W,"inverseSigmoid",function(){return Wh}),a.d(W,"createSsdMobilenetv1",function(){return Cg}),a.d(W,"createFaceDetectionNet",function(){return Og}),a.d(W,"FaceDetectionNet",function(){return bv}),a.d(W,"createTinyFaceDetector",function(){return Xp}),a.d(W,"TinyYolov2",function(){return Gh}),a.d(W,"createTinyYolov2",function(){return wv}),a.d(W,"euclideanDistance",function(){return Lm}),a.d(W,"NeuralNetwork",function(){return Di}),a.d(W,"resizeResults",function(){return Mg}),a.d(W,"AgeGenderNet",function(){return yg}),a.d(W,"Gender",function(){return Ll}),a.d(W,"BoundingBox",function(){return _a}),a.d(W,"Box",function(){return cs}),a.d(W,"Dimensions",function(){return Os}),a.d(W,"FaceDetection",function(){return Yo}),a.d(W,"FaceLandmarks",function(){return Gs}),a.d(W,"FaceLandmarks5",function(){return Ou}),a.d(W,"FaceLandmarks68",function(){return Au}),a.d(W,"FaceMatch",function(){return iu}),a.d(W,"LabeledBox",function(){return Vh}),a.d(W,"LabeledFaceDescriptors",function(){return Mf}),a.d(W,"ObjectDetection",function(){return ls}),a.d(W,"Point",function(){return so}),a.d(W,"PredictedBox",function(){return jf}),a.d(W,"Rect",function(){return Zc}),a.d(W,"awaitMediaLoaded",function(){return dr}),a.d(W,"bufferToImage",function(){return Tr}),a.d(W,"createCanvas",function(){return xr}),a.d(W,"createCanvasFromMedia",function(){return $r}),a.d(W,"extractFaces",function(){return to}),a.d(W,"extractFaceTensors",function(){return Qi}),a.d(W,"fetchImage",function(){return ji}),a.d(W,"fetchJson",function(){return no}),a.d(W,"fetchNetWeights",function(){return ia}),a.d(W,"fetchOrThrow",function(){return zo}),a.d(W,"getContext2dOrThrow",function(){return bn}),a.d(W,"getMediaDimensions",function(){return Vr}),a.d(W,"imageTensorToCanvas",function(){return Wr}),a.d(W,"imageToSquare",function(){return li}),a.d(W,"isMediaElement",function(){return ai}),a.d(W,"isMediaLoaded",function(){return rr}),a.d(W,"loadWeightMap",function(){return Jo}),a.d(W,"matchDimensions",function(){return Fi}),a.d(W,"NetInput",function(){return Hr}),a.d(W,"resolveInput",function(){return ct}),a.d(W,"toNetInput",function(){return ni}),a.d(W,"FaceExpressionNet",function(){return oo}),a.d(W,"FACE_EXPRESSION_LABELS",function(){return As}),a.d(W,"FaceExpressions",function(){return hs}),a.d(W,"FaceLandmark68Net",function(){return Om}),a.d(W,"FaceLandmark68TinyNet",function(){return Am}),a.d(W,"FaceRecognitionNet",function(){return Jd}),a.d(W,"extendWithFaceDescriptor",function(){return _m}),a.d(W,"isWithFaceDetection",function(){return Pl}),a.d(W,"extendWithFaceDetection",function(){return Bf}),a.d(W,"isWithFaceExpressions",function(){return Ss}),a.d(W,"extendWithFaceExpressions",function(){return Ga}),a.d(W,"isWithFaceLandmarks",function(){return Sc}),a.d(W,"extendWithFaceLandmarks",function(){return Uo}),a.d(W,"isWithAge",function(){return T0}),a.d(W,"extendWithAge",function(){return Dm}),a.d(W,"isWithGender",function(){return qh}),a.d(W,"extendWithGender",function(){return zf}),a.d(W,"allFacesSsdMobilenetv1",function(){return Gp}),a.d(W,"allFacesTinyYolov2",function(){return Zh}),a.d(W,"allFacesMtcnn",function(){return Kp}),a.d(W,"allFaces",function(){return Pm}),a.d(W,"ComposableTask",function(){return il}),a.d(W,"ComputeFaceDescriptorsTaskBase",function(){return op}),a.d(W,"ComputeAllFaceDescriptorsTask",function(){return hc}),a.d(W,"ComputeSingleFaceDescriptorTask",function(){return Xf}),a.d(W,"detectSingleFace",function(){return $p}),a.d(W,"detectAllFaces",function(){return Kl}),a.d(W,"DetectFacesTaskBase",function(){return qp}),a.d(W,"DetectAllFacesTask",function(){return Hp}),a.d(W,"DetectSingleFaceTask",function(){return Rg}),a.d(W,"DetectFaceLandmarksTaskBase",function(){return Yf}),a.d(W,"DetectAllFaceLandmarksTask",function(){return ap}),a.d(W,"DetectSingleFaceLandmarksTask",function(){return Vp}),a.d(W,"FaceMatcher",function(){return sp}),a.d(W,"nets",function(){return ro}),a.d(W,"ssdMobilenetv1",function(){return ql}),a.d(W,"tinyFaceDetector",function(){return Xh}),a.d(W,"tinyYolov2",function(){return I0}),a.d(W,"mtcnn",function(){return R0}),a.d(W,"detectFaceLandmarks",function(){return zp}),a.d(W,"detectFaceLandmarksTiny",function(){return Hl}),a.d(W,"computeFaceDescriptor",function(){return ol}),a.d(W,"recognizeFaceExpressions",function(){return rp}),a.d(W,"predictAgeAndGender",function(){return Yh}),a.d(W,"loadSsdMobilenetv1Model",function(){return Hf}),a.d(W,"loadTinyFaceDetectorModel",function(){return $l}),a.d(W,"loadMtcnnModel",function(){return Gl}),a.d(W,"loadTinyYolov2Model",function(){return Nu}),a.d(W,"loadFaceLandmarkModel",function(){return Jh}),a.d(W,"loadFaceLandmarkTinyModel",function(){return $f}),a.d(W,"loadFaceRecognitionModel",function(){return al}),a.d(W,"loadFaceExpressionModel",function(){return Nc}),a.d(W,"loadAgeGenderModel",function(){return Gf}),a.d(W,"loadFaceDetectionModel",function(){return Up}),a.d(W,"locateFaces",function(){return Kf}),a.d(W,"detectLandmarks",function(){return Fc}),a.d(W,"Mtcnn",function(){return Wf}),a.d(W,"MtcnnOptions",function(){return Dc}),a.d(W,"iou",function(){return $s}),a.d(W,"minBbox",function(){return Eu}),a.d(W,"nonMaxSuppression",function(){return qu}),a.d(W,"normalize",function(){return uc}),a.d(W,"padToSquare",function(){return Cu}),a.d(W,"shuffleArray",function(){return Jc}),a.d(W,"SsdMobilenetv1",function(){return ep}),a.d(W,"SsdMobilenetv1Options",function(){return Tc}),a.d(W,"TinyFaceDetector",function(){return qf}),a.d(W,"TinyFaceDetectorOptions",function(){return Pp}),a.d(W,"TinyYolov2SizeType",function(){return Im}),a.d(W,"TinyYolov2Options",function(){return $h}),a.d(W,"validateConfig",function(){return _g});var q={};a.d(q,"getRobin",function(){return bp}),a.d(q,"getImageData",function(){return z0});var P=a(18),ee=a.n(P),I=a(2),se=a(67),ie=a(6),K=a.n(ie),de=a(10),pe=a.n(de),Ae=a(9),Te=a.n(Ae),je=a(4),we=a.n(je);function ot(F,E){return E?new Promise(function(k,w){F.then(function(_){E(void 0,_),k(_)}).catch(function(_){E(_),w(_)})}):F}var _t=function(){function F(E,k,w,_){pe()(this,F),this.model=E,this.audioContext=k,this.stream=w,this.frequency=null,this.ready=ot(this.loadModel(E),_)}return Te()(F,[{key:"loadModel",value:function(){var E=K()(we.a.mark(function k(w){return we.a.wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return _.next=2,I.loadLayersModel("".concat(w,"/model.json"));case 2:if(this.model=_.sent,!this.audioContext){_.next=8;break}return _.next=6,this.processStream();case 6:_.next=9;break;case 8:throw new Error("Could not access microphone - getUserMedia not available");case 9:return _.abrupt("return",this);case 10:case"end":return _.stop()}},k,this)}));return function(k){return E.apply(this,arguments)}}()},{key:"processStream",value:function(){var E=K()(we.a.mark(function k(){var w,_,L,Y,ce;return we.a.wrap(function(ve){for(;;)switch(ve.prev=ve.next){case 0:return ve.next=2,I.nextFrame();case 2:for(w=this.audioContext.createMediaStreamSource(this.stream),_=this.audioContext.sampleRate/16e3*1024,L=4;L<_;)L*=2;(Y=this.audioContext.createScriptProcessor(L,1,1)).onaudioprocess=this.processMicrophoneBuffer.bind(this),(ce=this.audioContext.createGain()).gain.setValueAtTime(0,this.audioContext.currentTime),w.connect(Y),Y.connect(ce),ce.connect(this.audioContext.destination),this.audioContext.state!=="running"&&console.warn("User gesture needed to start AudioContext, please click");case 14:case"end":return ve.stop()}},k,this)}));return function(){return E.apply(this,arguments)}}()},{key:"processMicrophoneBuffer",value:function(){var E=K()(we.a.mark(function k(w){var _=this;return we.a.wrap(function(L){for(;;)switch(L.prev=L.next){case 0:return L.next=2,I.nextFrame();case 2:this.results={},F.resample(w.inputBuffer,function(Y){I.tidy(function(){var ce=I.add(I.linspace(0,7180,360),I.tensor(1997.379408437619));_.running=!0;var ve=I.tensor(Y.slice(0,1024)),De=I.sub(ve,I.mean(ve)),Ce=I.tensor(I.norm(De).dataSync()/Math.sqrt(1024)),Xe=I.div(De,Ce).reshape([1,1024]),nt=_.model.predict([Xe]).reshape([360]),Et=nt.max().dataSync()[0],At=nt.argMax().dataSync()[0];_.results.confidence=Et.toFixed(3);var rn=Math.max(0,At-4),un=Math.min(360,At+5),kn=nt.slice([rn],[un-rn]),En=ce.slice([rn],[un-rn]),_n=I.mul(kn,En).dataSync().reduce(function(cr,yr){return cr+yr},0)/kn.dataSync().reduce(function(cr,yr){return cr+yr},0),Pn=10*Math.pow(2,_n/1200),dn=Et>.5?Pn:null;_.frequency=dn})});case 4:case"end":return L.stop()}},k,this)}));return function(k){return E.apply(this,arguments)}}()},{key:"getPitch",value:function(){var E=K()(we.a.mark(function k(w){var _;return we.a.wrap(function(L){for(;;)switch(L.prev=L.next){case 0:return L.next=2,this.ready;case 2:return L.next=4,I.nextFrame();case 4:return _=this.frequency,w&&w(void 0,_),L.abrupt("return",_);case 7:case"end":return L.stop()}},k,this)}));return function(k){return E.apply(this,arguments)}}()}],[{key:"resample",value:function(E,k){for(var w=E.sampleRate%16e3!=0,_=E.sampleRate/16e3,L=E.getChannelData(0),Y=new Float32Array(1024),ce=0;ce<1024;ce+=1)if(w){var ve=Math.floor(ce*_),De=ve+1,Ce=ce*_-ve;Y[ce]=(1-Ce)*L[ve]+Ce*L[De]}else Y[ce]=L[ce*_];k(Y)}}]),F}(),Ut=function(){var F=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"./",E=arguments.length>1?arguments[1]:void 0,k=arguments.length>2?arguments[2]:void 0,w=arguments.length>3?arguments[3]:void 0;return new _t(F,E,k,w)},Xt=a(7),ke=a.n(Xt),Ft=a(17),Gt=a.n(Ft),jt=a(20),Ye=a(0);/**
    * @license
    * Copyright 2019 Google LLC. All Rights Reserved.
    * Licensed under the Apache License, Version 2.0 (the "License");
    * you may not use this file except in compliance with the License.
    * You may obtain a copy of the License at
    *
    * http://www.apache.org/licenses/LICENSE-2.0
    *
    * Unless required by applicable law or agreed to in writing, software
    * distributed under the License is distributed on an "AS IS" BASIS,
    * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    * See the License for the specific language governing permissions and
    * limitations under the License.
    * =============================================================================
    */function ln(F,E,k,w){return new(k||(k=Promise))(function(_,L){function Y(De){try{ve(w.next(De))}catch(Ce){L(Ce)}}function ce(De){try{ve(w.throw(De))}catch(Ce){L(Ce)}}function ve(De){De.done?_(De.value):new k(function(Ce){Ce(De.value)}).then(Y,ce)}ve((w=w.apply(F,E||[])).next())})}function nn(F,E){var k,w,_,L,Y={label:0,sent:function(){if(1&_[0])throw _[1];return _[1]},trys:[],ops:[]};return L={next:ce(0),throw:ce(1),return:ce(2)},typeof Symbol=="function"&&(L[Symbol.iterator]=function(){return this}),L;function ce(ve){return function(De){return function(Ce){if(k)throw new TypeError("Generator is already executing.");for(;Y;)try{if(k=1,w&&(_=2&Ce[0]?w.return:Ce[0]?w.throw||((_=w.return)&&_.call(w),0):w.next)&&!(_=_.call(w,Ce[1])).done)return _;switch(w=0,_&&(Ce=[2&Ce[0],_.value]),Ce[0]){case 0:case 1:_=Ce;break;case 4:return Y.label++,{value:Ce[1],done:!1};case 5:Y.label++,w=Ce[1],Ce=[0];continue;case 7:Ce=Y.ops.pop(),Y.trys.pop();continue;default:if(!(_=(_=Y.trys).length>0&&_[_.length-1])&&(Ce[0]===6||Ce[0]===2)){Y=0;continue}if(Ce[0]===3&&(!_||Ce[1]>_[0]&&Ce[1]<_[3])){Y.label=Ce[1];break}if(Ce[0]===6&&Y.label<_[1]){Y.label=_[1],_=Ce;break}if(_&&Y.label<_[2]){Y.label=_[2],Y.ops.push(Ce);break}_[2]&&Y.ops.pop(),Y.trys.pop();continue}Ce=E.call(F,Y)}catch(Xe){Ce=[6,Xe],w=0}finally{k=_=0}if(5&Ce[0])throw Ce[1];return{value:Ce[0]?Ce[1]:void 0,done:!0}}([ve,De])}}}var Bt={0:"tench, Tinca tinca",1:"goldfish, Carassius auratus",2:"great white shark, white shark, man-eater, man-eating shark, Carcharodon carcharias",3:"tiger shark, Galeocerdo cuvieri",4:"hammerhead, hammerhead shark",5:"electric ray, crampfish, numbfish, torpedo",6:"stingray",7:"cock",8:"hen",9:"ostrich, Struthio camelus",10:"brambling, Fringilla montifringilla",11:"goldfinch, Carduelis carduelis",12:"house finch, linnet, Carpodacus mexicanus",13:"junco, snowbird",14:"indigo bunting, indigo finch, indigo bird, Passerina cyanea",15:"robin, American robin, Turdus migratorius",16:"bulbul",17:"jay",18:"magpie",19:"chickadee",20:"water ouzel, dipper",21:"kite",22:"bald eagle, American eagle, Haliaeetus leucocephalus",23:"vulture",24:"great grey owl, great gray owl, Strix nebulosa",25:"European fire salamander, Salamandra salamandra",26:"common newt, Triturus vulgaris",27:"eft",28:"spotted salamander, Ambystoma maculatum",29:"axolotl, mud puppy, Ambystoma mexicanum",30:"bullfrog, Rana catesbeiana",31:"tree frog, tree-frog",32:"tailed frog, bell toad, ribbed toad, tailed toad, Ascaphus trui",33:"loggerhead, loggerhead turtle, Caretta caretta",34:"leatherback turtle, leatherback, leathery turtle, Dermochelys coriacea",35:"mud turtle",36:"terrapin",37:"box turtle, box tortoise",38:"banded gecko",39:"common iguana, iguana, Iguana iguana",40:"American chameleon, anole, Anolis carolinensis",41:"whiptail, whiptail lizard",42:"agama",43:"frilled lizard, Chlamydosaurus kingi",44:"alligator lizard",45:"Gila monster, Heloderma suspectum",46:"green lizard, Lacerta viridis",47:"African chameleon, Chamaeleo chamaeleon",48:"Komodo dragon, Komodo lizard, dragon lizard, giant lizard, Varanus komodoensis",49:"African crocodile, Nile crocodile, Crocodylus niloticus",50:"American alligator, Alligator mississipiensis",51:"triceratops",52:"thunder snake, worm snake, Carphophis amoenus",53:"ringneck snake, ring-necked snake, ring snake",54:"hognose snake, puff adder, sand viper",55:"green snake, grass snake",56:"king snake, kingsnake",57:"garter snake, grass snake",58:"water snake",59:"vine snake",60:"night snake, Hypsiglena torquata",61:"boa constrictor, Constrictor constrictor",62:"rock python, rock snake, Python sebae",63:"Indian cobra, Naja naja",64:"green mamba",65:"sea snake",66:"horned viper, cerastes, sand viper, horned asp, Cerastes cornutus",67:"diamondback, diamondback rattlesnake, Crotalus adamanteus",68:"sidewinder, horned rattlesnake, Crotalus cerastes",69:"trilobite",70:"harvestman, daddy longlegs, Phalangium opilio",71:"scorpion",72:"black and gold garden spider, Argiope aurantia",73:"barn spider, Araneus cavaticus",74:"garden spider, Aranea diademata",75:"black widow, Latrodectus mactans",76:"tarantula",77:"wolf spider, hunting spider",78:"tick",79:"centipede",80:"black grouse",81:"ptarmigan",82:"ruffed grouse, partridge, Bonasa umbellus",83:"prairie chicken, prairie grouse, prairie fowl",84:"peacock",85:"quail",86:"partridge",87:"African grey, African gray, Psittacus erithacus",88:"macaw",89:"sulphur-crested cockatoo, Kakatoe galerita, Cacatua galerita",90:"lorikeet",91:"coucal",92:"bee eater",93:"hornbill",94:"hummingbird",95:"jacamar",96:"toucan",97:"drake",98:"red-breasted merganser, Mergus serrator",99:"goose",100:"black swan, Cygnus atratus",101:"tusker",102:"echidna, spiny anteater, anteater",103:"platypus, duckbill, duckbilled platypus, duck-billed platypus, Ornithorhynchus anatinus",104:"wallaby, brush kangaroo",105:"koala, koala bear, kangaroo bear, native bear, Phascolarctos cinereus",106:"wombat",107:"jelly fish",108:"sea anemone, anemone",109:"brain coral",110:"flatworm, platyhelminth",111:"nematode, nematode worm, roundworm",112:"conch",113:"snail",114:"slug",115:"sea slug, nudibranch",116:"chiton, coat-of-mail shell, sea cradle, polyplacophore",117:"chambered nautilus, pearly nautilus, nautilus",118:"Dungeness crab, Cancer magister",119:"rock crab, Cancer irroratus",120:"fiddler crab",121:"king crab, Alaska crab, Alaskan king crab, Alaska king crab, Paralithodes camtschatica",122:"American lobster, Northern lobster, Maine lobster, Homarus americanus",123:"spiny lobster, langouste, rock lobster, crawfish, crayfish, sea crawfish",124:"crayfish, crawfish, crawdad, crawdaddy",125:"hermit crab",126:"isopod",127:"white stork, Ciconia ciconia",128:"black stork, Ciconia nigra",129:"spoonbill",130:"flamingo",131:"little blue heron, Egretta caerulea",132:"American egret, great white heron, Egretta albus",133:"bittern",134:"crane",135:"limpkin, Aramus pictus",136:"European gallinule, Porphyrio porphyrio",137:"American coot, marsh hen, mud hen, water hen, Fulica americana",138:"bustard",139:"ruddy turnstone, Arenaria interpres",140:"red-backed sandpiper, dunlin, Erolia alpina",141:"redshank, Tringa totanus",142:"dowitcher",143:"oystercatcher, oyster catcher",144:"pelican",145:"king penguin, Aptenodytes patagonica",146:"albatross, mollymawk",147:"grey whale, gray whale, devilfish, Eschrichtius gibbosus, Eschrichtius robustus",148:"killer whale, killer, orca, grampus, sea wolf, Orcinus orca",149:"dugong, Dugong dugon",150:"sea lion",151:"Chihuahua",152:"Japanese spaniel",153:"Maltese dog, Maltese terrier, Maltese",154:"Pekinese, Pekingese, Peke",155:"Shih-Tzu",156:"Blenheim spaniel",157:"papillon",158:"toy terrier",159:"Rhodesian ridgeback",160:"Afghan hound, Afghan",161:"basset, basset hound",162:"beagle",163:"bloodhound, sleuthhound",164:"bluetick",165:"black-and-tan coonhound",166:"Walker hound, Walker foxhound",167:"English foxhound",168:"redbone",169:"borzoi, Russian wolfhound",170:"Irish wolfhound",171:"Italian greyhound",172:"whippet",173:"Ibizan hound, Ibizan Podenco",174:"Norwegian elkhound, elkhound",175:"otterhound, otter hound",176:"Saluki, gazelle hound",177:"Scottish deerhound, deerhound",178:"Weimaraner",179:"Staffordshire bullterrier, Staffordshire bull terrier",180:"American Staffordshire terrier, Staffordshire terrier, American pit bull terrier, pit bull terrier",181:"Bedlington terrier",182:"Border terrier",183:"Kerry blue terrier",184:"Irish terrier",185:"Norfolk terrier",186:"Norwich terrier",187:"Yorkshire terrier",188:"wire-haired fox terrier",189:"Lakeland terrier",190:"Sealyham terrier, Sealyham",191:"Airedale, Airedale terrier",192:"cairn, cairn terrier",193:"Australian terrier",194:"Dandie Dinmont, Dandie Dinmont terrier",195:"Boston bull, Boston terrier",196:"miniature schnauzer",197:"giant schnauzer",198:"standard schnauzer",199:"Scotch terrier, Scottish terrier, Scottie",200:"Tibetan terrier, chrysanthemum dog",201:"silky terrier, Sydney silky",202:"soft-coated wheaten terrier",203:"West Highland white terrier",204:"Lhasa, Lhasa apso",205:"flat-coated retriever",206:"curly-coated retriever",207:"golden retriever",208:"Labrador retriever",209:"Chesapeake Bay retriever",210:"German short-haired pointer",211:"vizsla, Hungarian pointer",212:"English setter",213:"Irish setter, red setter",214:"Gordon setter",215:"Brittany spaniel",216:"clumber, clumber spaniel",217:"English springer, English springer spaniel",218:"Welsh springer spaniel",219:"cocker spaniel, English cocker spaniel, cocker",220:"Sussex spaniel",221:"Irish water spaniel",222:"kuvasz",223:"schipperke",224:"groenendael",225:"malinois",226:"briard",227:"kelpie",228:"komondor",229:"Old English sheepdog, bobtail",230:"Shetland sheepdog, Shetland sheep dog, Shetland",231:"collie",232:"Border collie",233:"Bouvier des Flandres, Bouviers des Flandres",234:"Rottweiler",235:"German shepherd, German shepherd dog, German police dog, alsatian",236:"Doberman, Doberman pinscher",237:"miniature pinscher",238:"Greater Swiss Mountain dog",239:"Bernese mountain dog",240:"Appenzeller",241:"EntleBucher",242:"boxer",243:"bull mastiff",244:"Tibetan mastiff",245:"French bulldog",246:"Great Dane",247:"Saint Bernard, St Bernard",248:"Eskimo dog, husky",249:"malamute, malemute, Alaskan malamute",250:"Siberian husky",251:"dalmatian, coach dog, carriage dog",252:"affenpinscher, monkey pinscher, monkey dog",253:"basenji",254:"pug, pug-dog",255:"Leonberg",256:"Newfoundland, Newfoundland dog",257:"Great Pyrenees",258:"Samoyed, Samoyede",259:"Pomeranian",260:"chow, chow chow",261:"keeshond",262:"Brabancon griffon",263:"Pembroke, Pembroke Welsh corgi",264:"Cardigan, Cardigan Welsh corgi",265:"toy poodle",266:"miniature poodle",267:"standard poodle",268:"Mexican hairless",269:"timber wolf, grey wolf, gray wolf, Canis lupus",270:"white wolf, Arctic wolf, Canis lupus tundrarum",271:"red wolf, maned wolf, Canis rufus, Canis niger",272:"coyote, prairie wolf, brush wolf, Canis latrans",273:"dingo, warrigal, warragal, Canis dingo",274:"dhole, Cuon alpinus",275:"African hunting dog, hyena dog, Cape hunting dog, Lycaon pictus",276:"hyena, hyaena",277:"red fox, Vulpes vulpes",278:"kit fox, Vulpes macrotis",279:"Arctic fox, white fox, Alopex lagopus",280:"grey fox, gray fox, Urocyon cinereoargenteus",281:"tabby, tabby cat",282:"tiger cat",283:"Persian cat",284:"Siamese cat, Siamese",285:"Egyptian cat",286:"cougar, puma, catamount, mountain lion, painter, panther, Felis concolor",287:"lynx, catamount",288:"leopard, Panthera pardus",289:"snow leopard, ounce, Panthera uncia",290:"jaguar, panther, Panthera onca, Felis onca",291:"lion, king of beasts, Panthera leo",292:"tiger, Panthera tigris",293:"cheetah, chetah, Acinonyx jubatus",294:"brown bear, bruin, Ursus arctos",295:"American black bear, black bear, Ursus americanus, Euarctos americanus",296:"ice bear, polar bear, Ursus Maritimus, Thalarctos maritimus",297:"sloth bear, Melursus ursinus, Ursus ursinus",298:"mongoose",299:"meerkat, mierkat",300:"tiger beetle",301:"ladybug, ladybeetle, lady beetle, ladybird, ladybird beetle",302:"ground beetle, carabid beetle",303:"long-horned beetle, longicorn, longicorn beetle",304:"leaf beetle, chrysomelid",305:"dung beetle",306:"rhinoceros beetle",307:"weevil",308:"fly",309:"bee",310:"ant, emmet, pismire",311:"grasshopper, hopper",312:"cricket",313:"walking stick, walkingstick, stick insect",314:"cockroach, roach",315:"mantis, mantid",316:"cicada, cicala",317:"leafhopper",318:"lacewing, lacewing fly",319:"dragonfly, darning needle, devil's darning needle, sewing needle, snake feeder, snake doctor, mosquito hawk, skeeter hawk",320:"damselfly",321:"admiral",322:"ringlet, ringlet butterfly",323:"monarch, monarch butterfly, milkweed butterfly, Danaus plexippus",324:"cabbage butterfly",325:"sulphur butterfly, sulfur butterfly",326:"lycaenid, lycaenid butterfly",327:"starfish, sea star",328:"sea urchin",329:"sea cucumber, holothurian",330:"wood rabbit, cottontail, cottontail rabbit",331:"hare",332:"Angora, Angora rabbit",333:"hamster",334:"porcupine, hedgehog",335:"fox squirrel, eastern fox squirrel, Sciurus niger",336:"marmot",337:"beaver",338:"guinea pig, Cavia cobaya",339:"sorrel",340:"zebra",341:"hog, pig, grunter, squealer, Sus scrofa",342:"wild boar, boar, Sus scrofa",343:"warthog",344:"hippopotamus, hippo, river horse, Hippopotamus amphibius",345:"ox",346:"water buffalo, water ox, Asiatic buffalo, Bubalus bubalis",347:"bison",348:"ram, tup",349:"bighorn, bighorn sheep, cimarron, Rocky Mountain bighorn, Rocky Mountain sheep, Ovis canadensis",350:"ibex, Capra ibex",351:"hartebeest",352:"impala, Aepyceros melampus",353:"gazelle",354:"Arabian camel, dromedary, Camelus dromedarius",355:"llama",356:"weasel",357:"mink",358:"polecat, fitch, foulmart, foumart, Mustela putorius",359:"black-footed ferret, ferret, Mustela nigripes",360:"otter",361:"skunk, polecat, wood pussy",362:"badger",363:"armadillo",364:"three-toed sloth, ai, Bradypus tridactylus",365:"orangutan, orang, orangutang, Pongo pygmaeus",366:"gorilla, Gorilla gorilla",367:"chimpanzee, chimp, Pan troglodytes",368:"gibbon, Hylobates lar",369:"siamang, Hylobates syndactylus, Symphalangus syndactylus",370:"guenon, guenon monkey",371:"patas, hussar monkey, Erythrocebus patas",372:"baboon",373:"macaque",374:"langur",375:"colobus, colobus monkey",376:"proboscis monkey, Nasalis larvatus",377:"marmoset",378:"capuchin, ringtail, Cebus capucinus",379:"howler monkey, howler",380:"titi, titi monkey",381:"spider monkey, Ateles geoffroyi",382:"squirrel monkey, Saimiri sciureus",383:"Madagascar cat, ring-tailed lemur, Lemur catta",384:"indri, indris, Indri indri, Indri brevicaudatus",385:"Indian elephant, Elephas maximus",386:"African elephant, Loxodonta africana",387:"lesser panda, red panda, panda, bear cat, cat bear, Ailurus fulgens",388:"giant panda, panda, panda bear, coon bear, Ailuropoda melanoleuca",389:"barracouta, snoek",390:"eel",391:"coho, cohoe, coho salmon, blue jack, silver salmon, Oncorhynchus kisutch",392:"rock beauty, Holocanthus tricolor",393:"anemone fish",394:"sturgeon",395:"gar, garfish, garpike, billfish, Lepisosteus osseus",396:"lionfish",397:"puffer, pufferfish, blowfish, globefish",398:"abacus",399:"abaya",400:"academic gown, academic robe, judge's robe",401:"accordion, piano accordion, squeeze box",402:"acoustic guitar",403:"aircraft carrier, carrier, flattop, attack aircraft carrier",404:"airliner",405:"airship, dirigible",406:"altar",407:"ambulance",408:"amphibian, amphibious vehicle",409:"analog clock",410:"apiary, bee house",411:"apron",412:"ashcan, trash can, garbage can, wastebin, ash bin, ash-bin, ashbin, dustbin, trash barrel, trash bin",413:"assault rifle, assault gun",414:"backpack, back pack, knapsack, packsack, rucksack, haversack",415:"bakery, bakeshop, bakehouse",416:"balance beam, beam",417:"balloon",418:"ballpoint, ballpoint pen, ballpen, Biro",419:"Band Aid",420:"banjo",421:"bannister, banister, balustrade, balusters, handrail",422:"barbell",423:"barber chair",424:"barbershop",425:"barn",426:"barometer",427:"barrel, cask",428:"barrow, garden cart, lawn cart, wheelbarrow",429:"baseball",430:"basketball",431:"bassinet",432:"bassoon",433:"bathing cap, swimming cap",434:"bath towel",435:"bathtub, bathing tub, bath, tub",436:"beach wagon, station wagon, wagon, estate car, beach waggon, station waggon, waggon",437:"beacon, lighthouse, beacon light, pharos",438:"beaker",439:"bearskin, busby, shako",440:"beer bottle",441:"beer glass",442:"bell cote, bell cot",443:"bib",444:"bicycle-built-for-two, tandem bicycle, tandem",445:"bikini, two-piece",446:"binder, ring-binder",447:"binoculars, field glasses, opera glasses",448:"birdhouse",449:"boathouse",450:"bobsled, bobsleigh, bob",451:"bolo tie, bolo, bola tie, bola",452:"bonnet, poke bonnet",453:"bookcase",454:"bookshop, bookstore, bookstall",455:"bottlecap",456:"bow",457:"bow tie, bow-tie, bowtie",458:"brass, memorial tablet, plaque",459:"brassiere, bra, bandeau",460:"breakwater, groin, groyne, mole, bulwark, seawall, jetty",461:"breastplate, aegis, egis",462:"broom",463:"bucket, pail",464:"buckle",465:"bulletproof vest",466:"bullet train, bullet",467:"butcher shop, meat market",468:"cab, hack, taxi, taxicab",469:"caldron, cauldron",470:"candle, taper, wax light",471:"cannon",472:"canoe",473:"can opener, tin opener",474:"cardigan",475:"car mirror",476:"carousel, carrousel, merry-go-round, roundabout, whirligig",477:"carpenter's kit, tool kit",478:"carton",479:"car wheel",480:"cash machine, cash dispenser, automated teller machine, automatic teller machine, automated teller, automatic teller, ATM",481:"cassette",482:"cassette player",483:"castle",484:"catamaran",485:"CD player",486:"cello, violoncello",487:"cellular telephone, cellular phone, cellphone, cell, mobile phone",488:"chain",489:"chainlink fence",490:"chain mail, ring mail, mail, chain armor, chain armour, ring armor, ring armour",491:"chain saw, chainsaw",492:"chest",493:"chiffonier, commode",494:"chime, bell, gong",495:"china cabinet, china closet",496:"Christmas stocking",497:"church, church building",498:"cinema, movie theater, movie theatre, movie house, picture palace",499:"cleaver, meat cleaver, chopper",500:"cliff dwelling",501:"cloak",502:"clog, geta, patten, sabot",503:"cocktail shaker",504:"coffee mug",505:"coffeepot",506:"coil, spiral, volute, whorl, helix",507:"combination lock",508:"computer keyboard, keypad",509:"confectionery, confectionary, candy store",510:"container ship, containership, container vessel",511:"convertible",512:"corkscrew, bottle screw",513:"cornet, horn, trumpet, trump",514:"cowboy boot",515:"cowboy hat, ten-gallon hat",516:"cradle",517:"crane",518:"crash helmet",519:"crate",520:"crib, cot",521:"Crock Pot",522:"croquet ball",523:"crutch",524:"cuirass",525:"dam, dike, dyke",526:"desk",527:"desktop computer",528:"dial telephone, dial phone",529:"diaper, nappy, napkin",530:"digital clock",531:"digital watch",532:"dining table, board",533:"dishrag, dishcloth",534:"dishwasher, dish washer, dishwashing machine",535:"disk brake, disc brake",536:"dock, dockage, docking facility",537:"dogsled, dog sled, dog sleigh",538:"dome",539:"doormat, welcome mat",540:"drilling platform, offshore rig",541:"drum, membranophone, tympan",542:"drumstick",543:"dumbbell",544:"Dutch oven",545:"electric fan, blower",546:"electric guitar",547:"electric locomotive",548:"entertainment center",549:"envelope",550:"espresso maker",551:"face powder",552:"feather boa, boa",553:"file, file cabinet, filing cabinet",554:"fireboat",555:"fire engine, fire truck",556:"fire screen, fireguard",557:"flagpole, flagstaff",558:"flute, transverse flute",559:"folding chair",560:"football helmet",561:"forklift",562:"fountain",563:"fountain pen",564:"four-poster",565:"freight car",566:"French horn, horn",567:"frying pan, frypan, skillet",568:"fur coat",569:"garbage truck, dustcart",570:"gasmask, respirator, gas helmet",571:"gas pump, gasoline pump, petrol pump, island dispenser",572:"goblet",573:"go-kart",574:"golf ball",575:"golfcart, golf cart",576:"gondola",577:"gong, tam-tam",578:"gown",579:"grand piano, grand",580:"greenhouse, nursery, glasshouse",581:"grille, radiator grille",582:"grocery store, grocery, food market, market",583:"guillotine",584:"hair slide",585:"hair spray",586:"half track",587:"hammer",588:"hamper",589:"hand blower, blow dryer, blow drier, hair dryer, hair drier",590:"hand-held computer, hand-held microcomputer",591:"handkerchief, hankie, hanky, hankey",592:"hard disc, hard disk, fixed disk",593:"harmonica, mouth organ, harp, mouth harp",594:"harp",595:"harvester, reaper",596:"hatchet",597:"holster",598:"home theater, home theatre",599:"honeycomb",600:"hook, claw",601:"hoopskirt, crinoline",602:"horizontal bar, high bar",603:"horse cart, horse-cart",604:"hourglass",605:"iPod",606:"iron, smoothing iron",607:"jack-o'-lantern",608:"jean, blue jean, denim",609:"jeep, landrover",610:"jersey, T-shirt, tee shirt",611:"jigsaw puzzle",612:"jinrikisha, ricksha, rickshaw",613:"joystick",614:"kimono",615:"knee pad",616:"knot",617:"lab coat, laboratory coat",618:"ladle",619:"lampshade, lamp shade",620:"laptop, laptop computer",621:"lawn mower, mower",622:"lens cap, lens cover",623:"letter opener, paper knife, paperknife",624:"library",625:"lifeboat",626:"lighter, light, igniter, ignitor",627:"limousine, limo",628:"liner, ocean liner",629:"lipstick, lip rouge",630:"Loafer",631:"lotion",632:"loudspeaker, speaker, speaker unit, loudspeaker system, speaker system",633:"loupe, jeweler's loupe",634:"lumbermill, sawmill",635:"magnetic compass",636:"mailbag, postbag",637:"mailbox, letter box",638:"maillot",639:"maillot, tank suit",640:"manhole cover",641:"maraca",642:"marimba, xylophone",643:"mask",644:"matchstick",645:"maypole",646:"maze, labyrinth",647:"measuring cup",648:"medicine chest, medicine cabinet",649:"megalith, megalithic structure",650:"microphone, mike",651:"microwave, microwave oven",652:"military uniform",653:"milk can",654:"minibus",655:"miniskirt, mini",656:"minivan",657:"missile",658:"mitten",659:"mixing bowl",660:"mobile home, manufactured home",661:"Model T",662:"modem",663:"monastery",664:"monitor",665:"moped",666:"mortar",667:"mortarboard",668:"mosque",669:"mosquito net",670:"motor scooter, scooter",671:"mountain bike, all-terrain bike, off-roader",672:"mountain tent",673:"mouse, computer mouse",674:"mousetrap",675:"moving van",676:"muzzle",677:"nail",678:"neck brace",679:"necklace",680:"nipple",681:"notebook, notebook computer",682:"obelisk",683:"oboe, hautboy, hautbois",684:"ocarina, sweet potato",685:"odometer, hodometer, mileometer, milometer",686:"oil filter",687:"organ, pipe organ",688:"oscilloscope, scope, cathode-ray oscilloscope, CRO",689:"overskirt",690:"oxcart",691:"oxygen mask",692:"packet",693:"paddle, boat paddle",694:"paddlewheel, paddle wheel",695:"padlock",696:"paintbrush",697:"pajama, pyjama, pj's, jammies",698:"palace",699:"panpipe, pandean pipe, syrinx",700:"paper towel",701:"parachute, chute",702:"parallel bars, bars",703:"park bench",704:"parking meter",705:"passenger car, coach, carriage",706:"patio, terrace",707:"pay-phone, pay-station",708:"pedestal, plinth, footstall",709:"pencil box, pencil case",710:"pencil sharpener",711:"perfume, essence",712:"Petri dish",713:"photocopier",714:"pick, plectrum, plectron",715:"pickelhaube",716:"picket fence, paling",717:"pickup, pickup truck",718:"pier",719:"piggy bank, penny bank",720:"pill bottle",721:"pillow",722:"ping-pong ball",723:"pinwheel",724:"pirate, pirate ship",725:"pitcher, ewer",726:"plane, carpenter's plane, woodworking plane",727:"planetarium",728:"plastic bag",729:"plate rack",730:"plow, plough",731:"plunger, plumber's helper",732:"Polaroid camera, Polaroid Land camera",733:"pole",734:"police van, police wagon, paddy wagon, patrol wagon, wagon, black Maria",735:"poncho",736:"pool table, billiard table, snooker table",737:"pop bottle, soda bottle",738:"pot, flowerpot",739:"potter's wheel",740:"power drill",741:"prayer rug, prayer mat",742:"printer",743:"prison, prison house",744:"projectile, missile",745:"projector",746:"puck, hockey puck",747:"punching bag, punch bag, punching ball, punchball",748:"purse",749:"quill, quill pen",750:"quilt, comforter, comfort, puff",751:"racer, race car, racing car",752:"racket, racquet",753:"radiator",754:"radio, wireless",755:"radio telescope, radio reflector",756:"rain barrel",757:"recreational vehicle, RV, R.V.",758:"reel",759:"reflex camera",760:"refrigerator, icebox",761:"remote control, remote",762:"restaurant, eating house, eating place, eatery",763:"revolver, six-gun, six-shooter",764:"rifle",765:"rocking chair, rocker",766:"rotisserie",767:"rubber eraser, rubber, pencil eraser",768:"rugby ball",769:"rule, ruler",770:"running shoe",771:"safe",772:"safety pin",773:"saltshaker, salt shaker",774:"sandal",775:"sarong",776:"sax, saxophone",777:"scabbard",778:"scale, weighing machine",779:"school bus",780:"schooner",781:"scoreboard",782:"screen, CRT screen",783:"screw",784:"screwdriver",785:"seat belt, seatbelt",786:"sewing machine",787:"shield, buckler",788:"shoe shop, shoe-shop, shoe store",789:"shoji",790:"shopping basket",791:"shopping cart",792:"shovel",793:"shower cap",794:"shower curtain",795:"ski",796:"ski mask",797:"sleeping bag",798:"slide rule, slipstick",799:"sliding door",800:"slot, one-armed bandit",801:"snorkel",802:"snowmobile",803:"snowplow, snowplough",804:"soap dispenser",805:"soccer ball",806:"sock",807:"solar dish, solar collector, solar furnace",808:"sombrero",809:"soup bowl",810:"space bar",811:"space heater",812:"space shuttle",813:"spatula",814:"speedboat",815:"spider web, spider's web",816:"spindle",817:"sports car, sport car",818:"spotlight, spot",819:"stage",820:"steam locomotive",821:"steel arch bridge",822:"steel drum",823:"stethoscope",824:"stole",825:"stone wall",826:"stopwatch, stop watch",827:"stove",828:"strainer",829:"streetcar, tram, tramcar, trolley, trolley car",830:"stretcher",831:"studio couch, day bed",832:"stupa, tope",833:"submarine, pigboat, sub, U-boat",834:"suit, suit of clothes",835:"sundial",836:"sunglass",837:"sunglasses, dark glasses, shades",838:"sunscreen, sunblock, sun blocker",839:"suspension bridge",840:"swab, swob, mop",841:"sweatshirt",842:"swimming trunks, bathing trunks",843:"swing",844:"switch, electric switch, electrical switch",845:"syringe",846:"table lamp",847:"tank, army tank, armored combat vehicle, armoured combat vehicle",848:"tape player",849:"teapot",850:"teddy, teddy bear",851:"television, television system",852:"tennis ball",853:"thatch, thatched roof",854:"theater curtain, theatre curtain",855:"thimble",856:"thresher, thrasher, threshing machine",857:"throne",858:"tile roof",859:"toaster",860:"tobacco shop, tobacconist shop, tobacconist",861:"toilet seat",862:"torch",863:"totem pole",864:"tow truck, tow car, wrecker",865:"toyshop",866:"tractor",867:"trailer truck, tractor trailer, trucking rig, rig, articulated lorry, semi",868:"tray",869:"trench coat",870:"tricycle, trike, velocipede",871:"trimaran",872:"tripod",873:"triumphal arch",874:"trolleybus, trolley coach, trackless trolley",875:"trombone",876:"tub, vat",877:"turnstile",878:"typewriter keyboard",879:"umbrella",880:"unicycle, monocycle",881:"upright, upright piano",882:"vacuum, vacuum cleaner",883:"vase",884:"vault",885:"velvet",886:"vending machine",887:"vestment",888:"viaduct",889:"violin, fiddle",890:"volleyball",891:"waffle iron",892:"wall clock",893:"wallet, billfold, notecase, pocketbook",894:"wardrobe, closet, press",895:"warplane, military plane",896:"washbasin, handbasin, washbowl, lavabo, wash-hand basin",897:"washer, automatic washer, washing machine",898:"water bottle",899:"water jug",900:"water tower",901:"whiskey jug",902:"whistle",903:"wig",904:"window screen",905:"window shade",906:"Windsor tie",907:"wine bottle",908:"wing",909:"wok",910:"wooden spoon",911:"wool, woolen, woollen",912:"worm fence, snake fence, snake-rail fence, Virginia fence",913:"wreck",914:"yawl",915:"yurt",916:"web site, website, internet site, site",917:"comic book",918:"crossword puzzle, crossword",919:"street sign",920:"traffic light, traffic signal, stoplight",921:"book jacket, dust cover, dust jacket, dust wrapper",922:"menu",923:"plate",924:"guacamole",925:"consomme",926:"hot pot, hotpot",927:"trifle",928:"ice cream, icecream",929:"ice lolly, lolly, lollipop, popsicle",930:"French loaf",931:"bagel, beigel",932:"pretzel",933:"cheeseburger",934:"hotdog, hot dog, red hot",935:"mashed potato",936:"head cabbage",937:"broccoli",938:"cauliflower",939:"zucchini, courgette",940:"spaghetti squash",941:"acorn squash",942:"butternut squash",943:"cucumber, cuke",944:"artichoke, globe artichoke",945:"bell pepper",946:"cardoon",947:"mushroom",948:"Granny Smith",949:"strawberry",950:"orange",951:"lemon",952:"fig",953:"pineapple, ananas",954:"banana",955:"jackfruit, jak, jack",956:"custard apple",957:"pomegranate",958:"hay",959:"carbonara",960:"chocolate sauce, chocolate syrup",961:"dough",962:"meat loaf, meatloaf",963:"pizza, pizza pie",964:"potpie",965:"burrito",966:"red wine",967:"espresso",968:"cup",969:"eggnog",970:"alp",971:"bubble",972:"cliff, drop, drop-off",973:"coral reef",974:"geyser",975:"lakeside, lakeshore",976:"promontory, headland, head, foreland",977:"sandbar, sand bar",978:"seashore, coast, seacoast, sea-coast",979:"valley, vale",980:"volcano",981:"ballplayer, baseball player",982:"groom, bridegroom",983:"scuba diver",984:"rapeseed",985:"daisy",986:"yellow lady's slipper, yellow lady-slipper, Cypripedium calceolus, Cypripedium parviflorum",987:"corn",988:"acorn",989:"hip, rose hip, rosehip",990:"buckeye, horse chestnut, conker",991:"coral fungus",992:"agaric",993:"gyromitra",994:"stinkhorn, carrion fungus",995:"earthstar",996:"hen-of-the-woods, hen of the woods, Polyporus frondosus, Grifola frondosa",997:"bolete",998:"ear, spike, capitulum",999:"toilet tissue, toilet paper, bathroom tissue"},Pt={"1.00":"module_apply_default/MobilenetV1/Logits/global_pool","2.00":"module_apply_default/MobilenetV2/Logits/AvgPool"},gn={"1.00":{.25:{url:"https://tfhub.dev/google/imagenet/mobilenet_v1_025_224/classification/1",inputRange:[0,1]},"0.50":{url:"https://tfhub.dev/google/imagenet/mobilenet_v1_050_224/classification/1",inputRange:[0,1]},.75:{url:"https://tfhub.dev/google/imagenet/mobilenet_v1_075_224/classification/1",inputRange:[0,1]},"1.00":{url:"https://tfhub.dev/google/imagenet/mobilenet_v1_100_224/classification/1",inputRange:[0,1]}},"2.00":{"0.50":{url:"https://tfhub.dev/google/imagenet/mobilenet_v2_050_224/classification/2",inputRange:[0,1]},.75:{url:"https://tfhub.dev/google/imagenet/mobilenet_v2_075_224/classification/2",inputRange:[0,1]},"1.00":{url:"https://tfhub.dev/google/imagenet/mobilenet_v2_100_224/classification/2",inputRange:[0,1]}}};function Dt(F){return F===void 0&&(F={version:1,alpha:1}),ln(this,void 0,void 0,function(){var E,k,w,_,L,Y;return nn(this,function(ce){switch(ce.label){case 0:if(Ye==null)throw new Error("Cannot find TensorFlow.js. If you are using a <script> tag, please also include @tensorflow/tfjs on the page before using this model.");if(k=F.version.toFixed(2),w=F.alpha?F.alpha.toFixed(2):"",_=-1,L=1,F.modelUrl==null){if(!(k in gn))throw new Error("Invalid version of MobileNet. Valid versions are: "+Object.keys(gn));if(!(w in gn[k]))throw new Error("MobileNet constructed with invalid alpha "+F.alpha+". Valid multipliers for this version are: "+Object.keys(gn[k])+".");E=gn[k][w].inputRange,_=E[0],L=E[1]}return[4,(Y=new St(k,w,F.modelUrl,_,L)).load()];case 1:return ce.sent(),[2,Y]}})})}var St=function(){function F(E,k,w,_,L){_===void 0&&(_=-1),L===void 0&&(L=1),this.version=E,this.alpha=k,this.modelUrl=w,this.inputMin=_,this.inputMax=L,this.inputRange=L-_}return F.prototype.load=function(){return ln(this,void 0,void 0,function(){var E,k,w,_,L=this;return nn(this,function(Y){switch(Y.label){case 0:return this.modelUrl?(E=this,[4,Object(jt.loadGraphModel)(this.modelUrl)]):[3,2];case 1:return E.model=Y.sent(),[3,4];case 2:return k=gn[this.version][this.alpha].url,w=this,[4,Object(jt.loadGraphModel)(k,{fromTFHub:!0})];case 3:w.model=Y.sent(),Y.label=4;case 4:return[4,(_=Object(Ye.tidy)(function(){return L.model.predict(Object(Ye.zeros)([1,224,224,3]))})).data()];case 5:return Y.sent(),_.dispose(),[2]}})})},F.prototype.infer=function(E,k){var w=this;return k===void 0&&(k=!1),Object(Ye.tidy)(function(){E instanceof Ye.Tensor||(E=Ye.browser.fromPixels(E));var _=E.toFloat().mul(w.inputRange).add(w.inputMin),L=_;E.shape[0]===224&&E.shape[1]===224||(L=Ye.image.resizeBilinear(_,[224,224],!0));var Y,ce=L.reshape([-1,224,224,3]);if(k){var ve=Pt[w.version];Y=w.model.execute(ce,ve).squeeze([1,2])}else Y=w.model.predict(ce).slice([0,1],[-1,1e3]);return Y})},F.prototype.classify=function(E,k){return k===void 0&&(k=3),ln(this,void 0,void 0,function(){var w,_;return nn(this,function(L){switch(L.label){case 0:return[4,function(Y,ce){return ln(this,void 0,void 0,function(){var ve,De,Ce,Xe,nt,Et,At;return nn(this,function(rn){switch(rn.label){case 0:return[4,(ve=Y.softmax()).data()];case 1:for(De=rn.sent(),ve.dispose(),Ce=[],At=0;At<De.length;At++)Ce.push({value:De[At],index:At});for(Ce.sort(function(un,kn){return kn.value-un.value}),Xe=new Float32Array(ce),nt=new Int32Array(ce),At=0;At<ce;At++)Xe[At]=Ce[At].value,nt[At]=Ce[At].index;for(Et=[],At=0;At<nt.length;At++)Et.push({className:Bt[nt[At]],probability:Xe[At]});return[2,Et]}})})}(w=this.infer(E),k)];case 1:return _=L.sent(),w.dispose(),[2,_]}})})},F}();function wn(F,E,k){for(var w=[],_=0;_<F.length;_+=1)w.push({value:F[_],index:_});w.sort(function(Ce,Xe){return Xe.value-Ce.value});for(var L=new Float32Array(E),Y=new Int32Array(E),ce=0;ce<E;ce+=1)L[ce]=w[ce].value,Y[ce]=w[ce].index;for(var ve=[],De=0;De<Y.length;De+=1)ve.push({className:k[Y[De]],probability:L[De]});return ve}function Bn(F,E,k){return Hn.apply(this,arguments)}function Hn(){return(Hn=K()(we.a.mark(function F(E,k,w){var _;return we.a.wrap(function(L){for(;;)switch(L.prev=L.next){case 0:return L.next=2,E.data();case 2:return _=L.sent,L.abrupt("return",wn(_,k,w));case 4:case"end":return L.stop()}},F)}))).apply(this,arguments)}var hn=["kit fox","English setter","Siberian husky","Australian terrier","English springer","grey whale","lesser panda","Egyptian cat","ibex","Persian cat","cougar","gazelle","porcupine","sea lion","malamute","badger","Great Dane","Walker hound","Welsh springer spaniel","whippet","Scottish deerhound","killer whale","mink","African elephant","Weimaraner","soft-coated wheaten terrier","Dandie Dinmont","red wolf","Old English sheepdog","jaguar","otterhound","bloodhound","Airedale","hyena","meerkat","giant schnauzer","titi","three-toed sloth","sorrel","black-footed ferret","dalmatian","black-and-tan coonhound","papillon","skunk","Staffordshire bullterrier","Mexican hairless","Bouvier des Flandres","weasel","miniature poodle","Cardigan","malinois","bighorn","fox squirrel","colobus","tiger cat","Lhasa","impala","coyote","Yorkshire terrier","Newfoundland","brown bear","red fox","Norwegian elkhound","Rottweiler","hartebeest","Saluki","grey fox","schipperke","Pekinese","Brabancon griffon","West Highland white terrier","Sealyham terrier","guenon","mongoose","indri","tiger","Irish wolfhound","wild boar","EntleBucher","zebra","ram","French bulldog","orangutan","basenji","leopard","Bernese mountain dog","Maltese dog","Norfolk terrier","toy terrier","vizsla","cairn","squirrel monkey","groenendael","clumber","Siamese cat","chimpanzee","komondor","Afghan hound","Japanese spaniel","proboscis monkey","guinea pig","white wolf","ice bear","gorilla","borzoi","toy poodle","Kerry blue terrier","ox","Scotch terrier","Tibetan mastiff","spider monkey","Doberman","Boston bull","Greater Swiss Mountain dog","Appenzeller","Shih-Tzu","Irish water spaniel","Pomeranian","Bedlington terrier","warthog","Arabian camel","siamang","miniature schnauzer","collie","golden retriever","Irish terrier","affenpinscher","Border collie","hare","boxer","silky terrier","beagle","Leonberg","German short-haired pointer","patas","dhole","baboon","macaque","Chesapeake Bay retriever","bull mastiff","kuvasz","capuchin","pug","curly-coated retriever","Norwich terrier","flat-coated retriever","hog","keeshond","Eskimo dog","Brittany spaniel","standard poodle","Lakeland terrier","snow leopard","Gordon setter","dingo","standard schnauzer","hamster","Tibetan terrier","Arctic fox","wire-haired fox terrier","basset","water buffalo","American black bear","Angora","bison","howler monkey","hippopotamus","chow","giant panda","American Staffordshire terrier","Shetland sheepdog","Great Pyrenees","Chihuahua","tabby","marmoset","Labrador retriever","Saint Bernard","armadillo","Samoyed","bluetick","redbone","polecat","marmot","kelpie","gibbon","llama","miniature pinscher","wood rabbit","Italian greyhound","lion","cocker spaniel","Irish setter","dugong","Indian elephant","beaver","Sussex spaniel","Pembroke","Blenheim spaniel","Madagascar cat","Rhodesian ridgeback","lynx","African hunting dog","langur","Ibizan hound","timber wolf","cheetah","English foxhound","briard","sloth bear","Border terrier","German shepherd","otter","koala","tusker","echidna","wallaby","platypus","wombat","revolver","umbrella","schooner","soccer ball","accordion","ant","starfish","chambered nautilus","grand piano","laptop","strawberry","airliner","warplane","airship","balloon","space shuttle","fireboat","gondola","speedboat","lifeboat","canoe","yawl","catamaran","trimaran","container ship","liner","pirate","aircraft carrier","submarine","wreck","half track","tank","missile","bobsled","dogsled","bicycle-built-for-two","mountain bike","freight car","passenger car","barrow","shopping cart","motor scooter","forklift","electric locomotive","steam locomotive","amphibian","ambulance","beach wagon","cab","convertible","jeep","limousine","minivan","Model T","racer","sports car","go-kart","golfcart","moped","snowplow","fire engine","garbage truck","pickup","tow truck","trailer truck","moving van","police van","recreational vehicle","streetcar","snowmobile","tractor","mobile home","tricycle","unicycle","horse cart","jinrikisha","oxcart","bassinet","cradle","crib","four-poster","bookcase","china cabinet","medicine chest","chiffonier","table lamp","file","park bench","barber chair","throne","folding chair","rocking chair","studio couch","toilet seat","desk","pool table","dining table","entertainment center","wardrobe","Granny Smith","orange","lemon","fig","pineapple","banana","jackfruit","custard apple","pomegranate","acorn","hip","ear","rapeseed","corn","buckeye","organ","upright","chime","drum","gong","maraca","marimba","steel drum","banjo","cello","violin","harp","acoustic guitar","electric guitar","cornet","French horn","trombone","harmonica","ocarina","panpipe","bassoon","oboe","sax","flute","daisy","yellow lady's slipper","cliff","valley","alp","volcano","promontory","sandbar","coral reef","lakeside","seashore","geyser","hatchet","cleaver","letter opener","plane","power drill","lawn mower","hammer","corkscrew","can opener","plunger","screwdriver","shovel","plow","chain saw","cock","hen","ostrich","brambling","goldfinch","house finch","junco","indigo bunting","robin","bulbul","jay","magpie","chickadee","water ouzel","kite","bald eagle","vulture","great grey owl","black grouse","ptarmigan","ruffed grouse","prairie chicken","peacock","quail","partridge","African grey","macaw","sulphur-crested cockatoo","lorikeet","coucal","bee eater","hornbill","hummingbird","jacamar","toucan","drake","red-breasted merganser","goose","black swan","white stork","black stork","spoonbill","flamingo","American egret","little blue heron","bittern","crane","limpkin","American coot","bustard","ruddy turnstone","red-backed sandpiper","redshank","dowitcher","oystercatcher","European gallinule","pelican","king penguin","albatross","great white shark","tiger shark","hammerhead","electric ray","stingray","barracouta","coho","tench","goldfish","eel","rock beauty","anemone fish","lionfish","puffer","sturgeon","gar","loggerhead","leatherback turtle","mud turtle","terrapin","box turtle","banded gecko","common iguana","American chameleon","whiptail","agama","frilled lizard","alligator lizard","Gila monster","green lizard","African chameleon","Komodo dragon","triceratops","African crocodile","American alligator","thunder snake","ringneck snake","hognose snake","green snake","king snake","garter snake","water snake","vine snake","night snake","boa constrictor","rock python","Indian cobra","green mamba","sea snake","horned viper","diamondback","sidewinder","European fire salamander","common newt","eft","spotted salamander","axolotl","bullfrog","tree frog","tailed frog","whistle","wing","paintbrush","hand blower","oxygen mask","snorkel","loudspeaker","microphone","screen","mouse","electric fan","oil filter","strainer","space heater","stove","guillotine","barometer","rule","odometer","scale","analog clock","digital clock","wall clock","hourglass","sundial","parking meter","stopwatch","digital watch","stethoscope","syringe","magnetic compass","binoculars","projector","sunglasses","loupe","radio telescope","bow","cannon","assault rifle","rifle","projectile","computer keyboard","typewriter keyboard","crane","lighter","abacus","cash machine","slide rule","desktop computer","hand-held computer","notebook","web site","harvester","thresher","printer","slot","vending machine","sewing machine","joystick","switch","hook","car wheel","paddlewheel","pinwheel","potter's wheel","gas pump","carousel","swing","reel","radiator","puck","hard disc","sunglass","pick","car mirror","solar dish","remote control","disk brake","buckle","hair slide","knot","combination lock","padlock","nail","safety pin","screw","muzzle","seat belt","ski","candle","jack-o'-lantern","spotlight","torch","neck brace","pier","tripod","maypole","mousetrap","spider web","trilobite","harvestman","scorpion","black and gold garden spider","barn spider","garden spider","black widow","tarantula","wolf spider","tick","centipede","isopod","Dungeness crab","rock crab","fiddler crab","king crab","American lobster","spiny lobster","crayfish","hermit crab","tiger beetle","ladybug","ground beetle","long-horned beetle","leaf beetle","dung beetle","rhinoceros beetle","weevil","fly","bee","grasshopper","cricket","walking stick","cockroach","mantis","cicada","leafhopper","lacewing","dragonfly","damselfly","admiral","ringlet","monarch","cabbage butterfly","sulphur butterfly","lycaenid","jellyfish","sea anemone","brain coral","flatworm","nematode","conch","snail","slug","sea slug","chiton","sea urchin","sea cucumber","iron","espresso maker","microwave","Dutch oven","rotisserie","toaster","waffle iron","vacuum","dishwasher","refrigerator","washer","Crock Pot","frying pan","wok","caldron","coffeepot","teapot","spatula","altar","triumphal arch","patio","steel arch bridge","suspension bridge","viaduct","barn","greenhouse","palace","monastery","library","apiary","boathouse","church","mosque","stupa","planetarium","restaurant","cinema","home theater","lumbermill","coil","obelisk","totem pole","castle","prison","grocery store","bakery","barbershop","bookshop","butcher shop","confectionery","shoe shop","tobacco shop","toyshop","fountain","cliff dwelling","yurt","dock","brass","megalith","bannister","breakwater","dam","chainlink fence","picket fence","worm fence","stone wall","grille","sliding door","turnstile","mountain tent","scoreboard","honeycomb","plate rack","pedestal","beacon","mashed potato","bell pepper","head cabbage","broccoli","cauliflower","zucchini","spaghetti squash","acorn squash","butternut squash","cucumber","artichoke","cardoon","mushroom","shower curtain","jean","carton","handkerchief","sandal","ashcan","safe","plate","necklace","croquet ball","fur coat","thimble","pajama","running shoe","cocktail shaker","chest","manhole cover","modem","tub","tray","balance beam","bagel","prayer rug","kimono","hot pot","whiskey jug","knee pad","book jacket","spindle","ski mask","beer bottle","crash helmet","bottlecap","tile roof","mask","maillot","Petri dish","football helmet","bathing cap","teddy","holster","pop bottle","photocopier","vestment","crossword puzzle","golf ball","trifle","suit","water tower","feather boa","cloak","red wine","drumstick","shield","Christmas stocking","hoopskirt","menu","stage","bonnet","meat loaf","baseball","face powder","scabbard","sunscreen","beer glass","hen-of-the-woods","guacamole","lampshade","wool","hay","bow tie","mailbag","water jug","bucket","dishrag","soup bowl","eggnog","mortar","trench coat","paddle","chain","swab","mixing bowl","potpie","wine bottle","shoji","bulletproof vest","drilling platform","binder","cardigan","sweatshirt","pot","birdhouse","hamper","ping-pong ball","pencil box","pay-phone","consomme","apron","punching bag","backpack","groom","bearskin","pencil sharpener","broom","mosquito net","abaya","mortarboard","poncho","crutch","Polaroid camera","space bar","cup","racket","traffic light","quill","radio","dough","cuirass","military uniform","lipstick","shower cap","monitor","oscilloscope","mitten","brassiere","French loaf","vase","milk can","rugby ball","paper towel","earthstar","envelope","miniskirt","cowboy hat","trolleybus","perfume","bathtub","hotdog","coral fungus","bullet train","pillow","toilet tissue","cassette","carpenter's kit","ladle","stinkhorn","lotion","hair spray","academic gown","dome","crate","wig","burrito","pill bottle","chain mail","theater curtain","window shade","barrel","washbasin","ballpoint","basketball","bath towel","cowboy boot","gown","window screen","agaric","cellular telephone","nipple","barbell","mailbox","lab coat","fire screen","minibus","packet","maze","pole","horizontal bar","sombrero","pickelhaube","rain barrel","wallet","cassette player","comic book","piggy bank","street sign","bell cote","fountain pen","Windsor tie","volleyball","overskirt","sarong","purse","bolo tie","bib","parachute","sleeping bag","television","swimming trunks","measuring cup","espresso","pizza","breastplate","shopping basket","wooden spoon","saltshaker","chocolate sauce","ballplayer","goblet","gyromitra","stretcher","water bottle","dial telephone","soap dispenser","jersey","school bus","jigsaw puzzle","plastic bag","reflex camera","diaper","Band Aid","ice lolly","velvet","tennis ball","gasmask","doormat","Loafer","ice cream","pretzel","quilt","maillot","tape player","clog","iPod","bolete","scuba diver","pitcher","matchstick","bikini","sock","CD player","lens cap","thatch","vault","beaker","bubble","cheeseburger","parallel bars","flagpole","coffee mug","rubber eraser","stole","carbonara","dumbbell"],Ve={DARKNET_URL:"https://cdn.jsdelivr.net/gh/ml5js/ml5-data-and-models@master/models/darknetclassifier/darknetreference/model.json",DARKNET_TINY_URL:"https://cdn.jsdelivr.net/gh/ml5js/ml5-data-and-models@master/models/darknetclassifier/darknettiny/model.json",IMAGE_SIZE_DARKNET:256,IMAGE_SIZE_DARKNET_TINY:224};function Qe(F,E){var k;F instanceof I.Tensor?k=F:F instanceof HTMLImageElement||F instanceof HTMLVideoElement||F instanceof HTMLCanvasElement||F instanceof ImageData?k=I.browser.fromPixels(F):ke()(F)==="object"&&(F.elt instanceof HTMLImageElement||F.elt instanceof HTMLVideoElement||F.elt instanceof HTMLCanvasElement||F.elt instanceof ImageData)&&(k=I.browser.fromPixels(F.elt));var w=k.toFloat().div(I.scalar(255)),_=w;return(w.shape[0]!==E||w.shape[1]!==E)&&(_=I.image.resizeBilinear(w,[E,E],!0)),_.reshape([1,E,E,3])}var He=function(){function F(E){switch(pe()(this,F),this.version=E,this.version){case"reference":this.imgSize=Ve.IMAGE_SIZE_DARKNET;break;case"tiny":this.imgSize=Ve.IMAGE_SIZE_DARKNET_TINY}}return Te()(F,[{key:"load",value:function(){var E=K()(we.a.mark(function k(){var w,_=this;return we.a.wrap(function(L){for(;;)switch(L.prev=L.next){case 0:L.t0=this.version,L.next=L.t0==="reference"?3:L.t0==="tiny"?7:11;break;case 3:return L.next=5,I.loadLayersModel(Ve.DARKNET_URL);case 5:return this.model=L.sent,L.abrupt("break",12);case 7:return L.next=9,I.loadLayersModel(Ve.DARKNET_TINY_URL);case 9:return this.model=L.sent,L.abrupt("break",12);case 11:return L.abrupt("break",12);case 12:return w=I.tidy(function(){return _.model.predict(I.zeros([1,_.imgSize,_.imgSize,3]))}),L.next=15,w.data();case 15:w.dispose();case 16:case"end":return L.stop()}},k,this)}));return function(){return E.apply(this,arguments)}}()},{key:"classify",value:function(){var E=K()(we.a.mark(function k(w){var _,L,Y,ce=this,ve=arguments;return we.a.wrap(function(De){for(;;)switch(De.prev=De.next){case 0:return _=ve.length>1&&ve[1]!==void 0?ve[1]:3,L=I.tidy(function(){var Ce=Qe(w,ce.imgSize),Xe=ce.model.predict(Ce);return I.softmax(Xe)}),De.next=4,Bn(L,_,hn);case 4:return Y=De.sent,L.dispose(),De.abrupt("return",Y);case 7:case"end":return De.stop()}},k)}));return function(k){return E.apply(this,arguments)}}()}]),F}();function pt(F){return Lt.apply(this,arguments)}function Lt(){return(Lt=K()(we.a.mark(function F(E){var k,w;return we.a.wrap(function(_){for(;;)switch(_.prev=_.next){case 0:if((k=E.version)==="reference"||k==="tiny"){_.next=3;break}throw new Error("Please select a version: darknet-reference or darknet-tiny");case 3:return w=new He(k),_.next=6,w.load();case 6:return _.abrupt("return",w);case 7:case"end":return _.stop()}},F)}))).apply(this,arguments)}var zt=a(23),Tn=a.n(zt),xn=["flashlight","belt","mushroom","pond","strawberry","pineapple","sun","cow","ear","bush","pliers","watermelon","apple","baseball","feather","shoe","leaf","lollipop","crown","ocean","horse","mountain","mosquito","mug","hospital","saw","castle","angel","underwear","traffic_light","cruise_ship","marker","blueberry","flamingo","face","hockey_stick","bucket","campfire","asparagus","skateboard","door","suitcase","skull","cloud","paint_can","hockey_puck","steak","house_plant","sleeping_bag","bench","snowman","arm","crayon","fan","shovel","leg","washing_machine","harp","toothbrush","tree","bear","rake","megaphone","knee","guitar","calculator","hurricane","grapes","paintbrush","couch","nose","square","wristwatch","penguin","bridge","octagon","submarine","screwdriver","rollerskates","ladder","wine_bottle","cake","bracelet","broom","yoga","finger","fish","line","truck","snake","bus","stitches","snorkel","shorts","bowtie","pickup_truck","tooth","snail","foot","crab","school_bus","train","dresser","sock","tractor","map","hedgehog","coffee_cup","computer","matches","beard","frog","crocodile","bathtub","rain","moon","bee","knife","boomerang","lighthouse","chandelier","jail","pool","stethoscope","frying_pan","cell_phone","binoculars","purse","lantern","birthday_cake","clarinet","palm_tree","aircraft_carrier","vase","eraser","shark","skyscraper","bicycle","sink","teapot","circle","tornado","bird","stereo","mouth","key","hot_dog","spoon","laptop","cup","bottlecap","The_Great_Wall_of_China","The_Mona_Lisa","smiley_face","waterslide","eyeglasses","ceiling_fan","lobster","moustache","carrot","garden","police_car","postcard","necklace","helmet","blackberry","beach","golf_club","car","panda","alarm_clock","t-shirt","dog","bread","wine_glass","lighter","flower","bandage","drill","butterfly","swan","owl","raccoon","squiggle","calendar","giraffe","elephant","trumpet","rabbit","trombone","sheep","onion","church","flip_flops","spreadsheet","pear","clock","roller_coaster","parachute","kangaroo","duck","remote_control","compass","monkey","rainbow","tennis_racquet","lion","pencil","string_bean","oven","star","cat","pizza","soccer_ball","syringe","flying_saucer","eye","cookie","floor_lamp","mouse","toilet","toaster","The_Eiffel_Tower","airplane","stove","cello","stop_sign","tent","diving_board","light_bulb","hammer","scorpion","headphones","basket","spider","paper_clip","sweater","ice_cream","envelope","sea_turtle","donut","hat","hourglass","broccoli","jacket","backpack","book","lightning","drums","snowflake","radio","banana","camel","canoe","toothpaste","chair","picture_frame","parrot","sandwich","lipstick","pants","violin","brain","power_outlet","triangle","hamburger","dragon","bulldozer","cannon","dolphin","zebra","animal_migration","camouflage","scissors","basketball","elbow","umbrella","windmill","table","rifle","hexagon","potato","anvil","sword","peanut","axe","television","rhinoceros","baseball_bat","speedboat","sailboat","zigzag","garden_hose","river","house","pillow","ant","tiger","stairs","cooler","see_saw","piano","fireplace","popsicle","dumbbell","mailbox","barn","hot_tub","teddy-bear","fork","dishwasher","peas","hot_air_balloon","keyboard","microwave","wheel","fire_hydrant","van","camera","whale","candle","octopus","pig","swing_set","helicopter","saxophone","passport","bat","ambulance","diamond","goatee","fence","grass","mermaid","motorbike","microphone","toe","cactus","nail","telephone","hand","squirrel","streetlight","bed","firetruck"],Kn={DOODLENET_URL:"https://cdn.jsdelivr.net/gh/ml5js/ml5-data-and-models@master/models/doodlenet/model.json",IMAGE_SIZE_DOODLENET:28};function be(F,E){var k;F instanceof I.Tensor?k=F:F instanceof HTMLImageElement||F instanceof HTMLVideoElement||F instanceof HTMLCanvasElement||F instanceof ImageData?k=I.browser.fromPixels(F):ke()(F)==="object"&&(F.elt instanceof HTMLImageElement||F.elt instanceof HTMLVideoElement||F.elt instanceof HTMLCanvasElement||F.elt instanceof ImageData)&&(k=I.browser.fromPixels(F.elt));var w=I.scalar(1).sub(k.toFloat().div(I.scalar(255))),_=w;w.shape[0]===E&&w.shape[1]===E||(_=I.image.resizeBilinear(w,[E,E]));var L=I.split(_,3,3),Y=Tn()(L,3),ce=Y[0],ve=Y[1],De=Y[2];return ce.add(ve).add(De).div(I.scalar(3)).floor().reshape([1,E,E,1])}var Yn=function(){function F(){pe()(this,F),this.imgSize=Kn.IMAGE_SIZE_DOODLENET}return Te()(F,[{key:"load",value:function(){var E=K()(we.a.mark(function k(){var w,_=this;return we.a.wrap(function(L){for(;;)switch(L.prev=L.next){case 0:return L.next=2,I.loadLayersModel(Kn.DOODLENET_URL);case 2:return this.model=L.sent,w=I.tidy(function(){return _.model.predict(I.zeros([1,_.imgSize,_.imgSize,1]))}),L.next=6,w.data();case 6:w.dispose();case 7:case"end":return L.stop()}},k,this)}));return function(){return E.apply(this,arguments)}}()},{key:"classify",value:function(){var E=K()(we.a.mark(function k(w){var _,L,Y,ce=this,ve=arguments;return we.a.wrap(function(De){for(;;)switch(De.prev=De.next){case 0:return _=ve.length>1&&ve[1]!==void 0?ve[1]:10,L=I.tidy(function(){var Ce=be(w,ce.imgSize);return ce.model.predict(Ce)}),De.next=4,Bn(L,_,xn);case 4:return Y=De.sent,L.dispose(),De.abrupt("return",Y);case 7:case"end":return De.stop()}},k)}));return function(k){return E.apply(this,arguments)}}()}]),F}();function Dr(){return pr.apply(this,arguments)}function pr(){return(pr=K()(we.a.mark(function F(){var E;return we.a.wrap(function(k){for(;;)switch(k.prev=k.next){case 0:return E=new Yn,k.next=3,E.load();case 3:return k.abrupt("return",E);case 4:case"end":return k.stop()}},F)}))).apply(this,arguments)}var Nr=new(function(){function F(){pe()(this,F),typeof window<"u"&&(this.m_p5Instance=window)}return Te()(F,[{key:"setP5Instance",value:function(E){this.m_p5Instance=E}},{key:"p5Instance",get:function(){return this.m_p5Instance!==void 0&&typeof this.m_p5Instance.loadImage=="function"?this.m_p5Instance:this.m_p5Instance.p5!==void 0&&this.m_p5Instance.p5.Image!==void 0&&typeof this.m_p5Instance.p5.Image=="function"?this.m_p5Instance.p5:void 0}},{key:"checkP5",value:function(){return!!this.p5Instance}},{key:"getBlob",value:function(E){return new Promise(function(k,w){E.toBlob(function(_){_?k(_):w(new Error("Canvas could not be converted to Blob."))})})}},{key:"loadAsync",value:function(E){var k=this;return new Promise(function(w,_){k.p5Instance.loadImage(E,function(L){w(L)},function(){_(new Error("Could not load image from url ".concat(E)))})})}},{key:"rawToBlob",value:function(){var E=K()(we.a.mark(function k(w,_,L){var Y,ce,ve,De,Ce,Xe;return we.a.wrap(function(nt){for(;;)switch(nt.prev=nt.next){case 0:for(Y=Array.from(w),ce=document.createElement("canvas"),ve=ce.getContext("2d"),ce.width=_,ce.height=L,De=ve.createImageData(_,L),Ce=De.data,Xe=0;Xe<_*L*4;Xe+=1)Ce[Xe]=Y[Xe];return ve.putImageData(De,0,0),nt.abrupt("return",this.getBlob(ce));case 10:case"end":return nt.stop()}},k,this)}));return function(k,w,_){return E.apply(this,arguments)}}()},{key:"blobToP5Image",value:function(){var E=K()(we.a.mark(function k(w){return we.a.wrap(function(_){for(;;)switch(_.prev=_.next){case 0:if(!this.checkP5()||typeof URL>"u"){_.next=2;break}return _.abrupt("return",this.loadAsync(URL.createObjectURL(w)));case 2:return _.abrupt("return",null);case 3:case"end":return _.stop()}},k,this)}));return function(k){return E.apply(this,arguments)}}()}]),F}()),Fr=function(F,E){var k=arguments.length>2&&arguments[2]!==void 0?arguments[2]:function(){},w=F,_=document.createElement("video");return w.onplay=function(){var L=w.captureStream();_.srcObject=L,_.width=E,_.height=E,_.autoplay=!0,_.playsinline=!0,_.muted=!0,k()},_},an=function(F){var E=Tn()(F.shape,2),k=E[0],w=E[1],_=F.dataSync(),L=document.createElement("canvas");L.width=w,L.height=k;for(var Y=L.getContext("2d"),ce=Y.getImageData(0,0,L.width,L.height),ve=0;ve<w*k;ve+=1){var De=4*ve,Ce=3*ve;ce.data[De+0]=Math.floor(256*_[Ce+0]),ce.data[De+1]=Math.floor(256*_[Ce+1]),ce.data[De+2]=Math.floor(256*_[Ce+2]),ce.data[De+3]=255}Y.putImageData(ce,0,0);var Xe=L.toDataURL(),nt=document.createElement("img");return nt.src=Xe,nt.style.width=w,nt.style.height=k,F.dispose(),nt},Kt=function(F){var E=Math.min(F.shape[0],F.shape[1]),k=F.shape[0]/2-E/2,w=F.shape[1]/2-E/2;return F.slice([k,w,0],[E,E,3])},Zt=function(F){var E,k,w;if(w=F instanceof HTMLImageElement||F instanceof HTMLCanvasElement||F instanceof HTMLVideoElement||F instanceof ImageData?F:ke()(F)==="object"&&(F.elt instanceof HTMLImageElement||F.elt instanceof HTMLCanvasElement||F.elt instanceof HTMLVideoElement||F.elt instanceof ImageData)?F.elt:ke()(F)==="object"&&F.canvas instanceof HTMLCanvasElement?F.canvas:F,E=w.width,k=w.height,Nr.checkP5()){var _=Nr.p5Instance.createGraphics(E,k);return _.push(),_.translate(E,0),_.scale(-1,1),_.image(F,0,0,E,k),_.pop(),_}var L=document.createElement("canvas");L.width=E,L.height=k;var Y=L.getContext("2d");return Y.drawImage(w,0,0,E,k),Y.translate(E,0),Y.scale(-1,1),Y.drawImage(L,-1*E,0,E,k),L};function $n(F){var E=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;return I.tidy(function(){var k=I.browser.fromPixels(F);return E&&(k=I.image.resizeBilinear(k,E)),Kt(k).expandDims(0).toFloat().div(I.scalar(127)).sub(I.scalar(1))})}function Dn(F){return F instanceof HTMLVideoElement||F instanceof HTMLImageElement||F instanceof HTMLCanvasElement||F instanceof ImageData}function hr(F){var E,k,w;w=F instanceof HTMLImageElement||F instanceof HTMLCanvasElement||F instanceof HTMLVideoElement||F instanceof ImageData?F:ke()(F)==="object"&&(F.elt instanceof HTMLImageElement||F.elt instanceof HTMLCanvasElement||F.elt instanceof HTMLVideoElement||F.elt instanceof ImageData)?F.elt:ke()(F)==="object"&&F.canvas instanceof HTMLCanvasElement?F.canvas:F,E=w.width,k=w.height;var _=document.createElement("canvas");_.width=E,_.height=k;var L=_.getContext("2d");L.drawImage(w,0,0,E,k);var Y=L.getImageData(0,0,E,k);return Array.from(Y.data)}var wr={mobilenet:{version:2,alpha:1,topk:3}},gr=["mobilenet","darknet","darknet-tiny","doodlenet"],Qr=function(){function F(E,k,w,_){if(pe()(this,F),this.video=k,this.model=null,this.mapStringToIndex=[],typeof E=="string")if(gr.includes(E))switch(this.modelName=E,this.modelUrl=null,this.modelName){case"mobilenet":this.modelToUse=b,this.version=w.version||wr.mobilenet.version,this.alpha=w.alpha||wr.mobilenet.alpha,this.topk=w.topk||wr.mobilenet.topk;break;case"darknet":this.version="reference",this.modelToUse=$;break;case"darknet-tiny":this.version="tiny",this.modelToUse=$;break;case"doodlenet":this.modelToUse=U;break;default:this.modelToUse=null}else this.modelUrl=E,this.modelUrl.endsWith("/")&&(this.modelUrl+="model.json");this.ready=ot(this.loadModel(this.modelUrl),_)}return Te()(F,[{key:"loadModel",value:function(){var E=K()(we.a.mark(function k(w){return we.a.wrap(function(_){for(;;)switch(_.prev=_.next){case 0:if(!w){_.next=6;break}return _.next=3,this.loadModelFrom(w);case 3:this.model=_.sent,_.next=9;break;case 6:return _.next=8,this.modelToUse.load({version:this.version,alpha:this.alpha});case 8:this.model=_.sent;case 9:return _.abrupt("return",this);case 10:case"end":return _.stop()}},k,this)}));return function(k){return E.apply(this,arguments)}}()},{key:"loadModelFrom",value:function(){var E=K()(we.a.mark(function k(){var w,_,L,Y,ce,ve,De,Ce,Xe=arguments;return we.a.wrap(function(nt){for(;;)switch(nt.prev=nt.next){case 0:if(w=Xe.length>0&&Xe[0]!==void 0?Xe[0]:null,nt.prev=1,w===null){nt.next=7;break}return nt.next=5,Gt.a.get(w);case 5:L=nt.sent,_=L.data;case 7:if(_.ml5Specs&&(this.mapStringToIndex=_.ml5Specs.mapStringToIndex),this.mapStringToIndex.length!==0){nt.next=16;break}return Y=w.split("/"),ce=Y.slice(0,Y.length-1).join("/"),ve="".concat(ce,"/metadata.json"),nt.next=14,Gt.a.get(ve).catch(function(Et){console.log("Tried to fetch metadata.json, but it seems to be missing.",Et)});case 14:(De=nt.sent)&&(Ce=De.data).labels&&(this.mapStringToIndex=Ce.labels);case 16:return nt.next=18,I.loadLayersModel(w);case 18:return this.model=nt.sent,nt.abrupt("return",this.model);case 22:return nt.prev=22,nt.t0=nt.catch(1),console.error(nt.t0),nt.abrupt("return",nt.t0);case 26:case"end":return nt.stop()}},k,this,[[1,22]])}));return function(){return E.apply(this,arguments)}}()},{key:"classifyInternal",value:function(){var E=K()(we.a.mark(function k(w,_){var L,Y,ce,ve,De,Ce,Xe=this;return we.a.wrap(function(nt){for(;;)switch(nt.prev=nt.next){case 0:return nt.next=2,this.ready;case 2:return nt.next=4,I.nextFrame();case 4:if(!(w instanceof HTMLVideoElement&&w.readyState===0)){nt.next=8;break}return L=w,nt.next=8,new Promise(function(Et){L.onloadeddata=function(){return Et()}});case 8:if(!this.video||this.video.readyState!==0){nt.next=11;break}return nt.next=11,new Promise(function(Et){Xe.video.onloadeddata=function(){return Et()}});case 11:if(Y=[224,224],!this.modelUrl){nt.next=20;break}return nt.next=15,I.nextFrame();case 15:return ce=I.tidy(function(){var Et=$n(w,Y),At=Xe.model.predict(Et);return Array.from(At.as1D().dataSync())}),nt.next=18,ce.map(function(Et,At){return{label:Xe.mapStringToIndex.length>0&&Xe.mapStringToIndex[At]?Xe.mapStringToIndex[At]:At,confidence:Et}}).sort(function(Et,At){return At.confidence-Et.confidence});case 18:return ve=nt.sent,nt.abrupt("return",ve);case 20:return De=$n(w,Y),Ce=this.model.classify(De,_).then(function(Et){return Et.map(function(At){return{label:At.className,confidence:At.probability}})}),De.dispose(),nt.abrupt("return",Ce);case 24:case"end":return nt.stop()}},k,this)}));return function(k,w){return E.apply(this,arguments)}}()},{key:"classify",value:function(){var E=K()(we.a.mark(function k(w){var _,L,Y,ce,ve,De=arguments;return we.a.wrap(function(Ce){for(;;)switch(Ce.prev=Ce.next){case 0:if(_=De.length>1&&De[1]!==void 0?De[1]:null,L=De.length>2?De[2]:void 0,Y=this.video,ce=this.topk,typeof w!="function"){Ce.next=9;break}Y=this.video,ve=w,Ce.next=28;break;case 9:if(typeof w!="number"){Ce.next=14;break}Y=this.video,ce=w,Ce.next=28;break;case 14:if(!(w instanceof HTMLVideoElement||w instanceof HTMLImageElement||w instanceof HTMLCanvasElement||w instanceof ImageData)){Ce.next=18;break}Y=w,Ce.next=28;break;case 18:if(ke()(w)!=="object"||!(w.elt instanceof HTMLVideoElement||w.elt instanceof HTMLImageElement||w.elt instanceof HTMLCanvasElement||w.elt instanceof ImageData)){Ce.next=22;break}Y=w.elt,Ce.next=28;break;case 22:if(!(ke()(w)==="object"&&w.canvas instanceof HTMLCanvasElement)){Ce.next=26;break}Y=w.canvas,Ce.next=28;break;case 26:if(this.video instanceof HTMLVideoElement){Ce.next=28;break}throw new Error("No input image provided. If you want to classify a video, pass the video element in the constructor. ");case 28:return typeof _=="number"?ce=_:typeof _=="function"&&(ve=_),typeof L=="function"&&(ve=L),Ce.abrupt("return",ot(this.classifyInternal(Y,ce),ve));case 31:case"end":return Ce.stop()}},k,this)}));return function(k){return E.apply(this,arguments)}}()},{key:"predict",value:function(){var E=K()(we.a.mark(function k(w,_,L){return we.a.wrap(function(Y){for(;;)switch(Y.prev=Y.next){case 0:return Y.abrupt("return",this.classify(w,_||null,L));case 1:case"end":return Y.stop()}},k,this)}));return function(k,w,_){return E.apply(this,arguments)}}()}]),F}(),ti=function(F,E,k,w){var _,L={},Y=w,ce=F;if(typeof ce!="string")throw new Error('Please specify a model to use. E.g: "MobileNet"');ce.indexOf("http")===-1&&(ce=F.toLowerCase()),E instanceof HTMLVideoElement?_=E:ke()(E)==="object"&&E.elt instanceof HTMLVideoElement?_=E.elt:ke()(E)==="object"?L=E:typeof E=="function"&&(Y=E),ke()(k)==="object"?L=k:typeof k=="function"&&(Y=k);var ve=new Qr(ce,_,L,Y);return Y?ve:ve.ready},Mr=function(F,E){return(Mr=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(k,w){k.__proto__=w}||function(k,w){for(var _ in w)w.hasOwnProperty(_)&&(k[_]=w[_])})(F,E)},di=function(){return(di=Object.assign||function(F){for(var E,k=1,w=arguments.length;k<w;k++)for(var _ in E=arguments[k])Object.prototype.hasOwnProperty.call(E,_)&&(F[_]=E[_]);return F}).apply(this,arguments)};function Yr(F,E,k,w){return new(k||(k=Promise))(function(_,L){function Y(De){try{ve(w.next(De))}catch(Ce){L(Ce)}}function ce(De){try{ve(w.throw(De))}catch(Ce){L(Ce)}}function ve(De){De.done?_(De.value):new k(function(Ce){Ce(De.value)}).then(Y,ce)}ve((w=w.apply(F,E||[])).next())})}function Xr(F,E){var k,w,_,L,Y={label:0,sent:function(){if(1&_[0])throw _[1];return _[1]},trys:[],ops:[]};return L={next:ce(0),throw:ce(1),return:ce(2)},typeof Symbol=="function"&&(L[Symbol.iterator]=function(){return this}),L;function ce(ve){return function(De){return function(Ce){if(k)throw new TypeError("Generator is already executing.");for(;Y;)try{if(k=1,w&&(_=2&Ce[0]?w.return:Ce[0]?w.throw||((_=w.return)&&_.call(w),0):w.next)&&!(_=_.call(w,Ce[1])).done)return _;switch(w=0,_&&(Ce=[2&Ce[0],_.value]),Ce[0]){case 0:case 1:_=Ce;break;case 4:return Y.label++,{value:Ce[1],done:!1};case 5:Y.label++,w=Ce[1],Ce=[0];continue;case 7:Ce=Y.ops.pop(),Y.trys.pop();continue;default:if(!(_=(_=Y.trys).length>0&&_[_.length-1])&&(Ce[0]===6||Ce[0]===2)){Y=0;continue}if(Ce[0]===3&&(!_||Ce[1]>_[0]&&Ce[1]<_[3])){Y.label=Ce[1];break}if(Ce[0]===6&&Y.label<_[1]){Y.label=_[1],_=Ce;break}if(_&&Y.label<_[2]){Y.label=_[2],Y.ops.push(Ce);break}_[2]&&Y.ops.pop(),Y.trys.pop();continue}Ce=E.call(F,Y)}catch(Xe){Ce=[6,Xe],w=0}finally{k=_=0}if(5&Ce[0])throw Ce[1];return{value:Ce[0]?Ce[1]:void 0,done:!0}}([ve,De])}}}function fi(F){var E=typeof Symbol=="function"&&F[Symbol.iterator],k=0;return E?E.call(F):{next:function(){return F&&k>=F.length&&(F=void 0),{value:F&&F[k++],done:!F}}}}function oi(F,E){var k=typeof Symbol=="function"&&F[Symbol.iterator];if(!k)return F;var w,_,L=k.call(F),Y=[];try{for(;(E===void 0||E-- >0)&&!(w=L.next()).done;)Y.push(w.value)}catch(ce){_={error:ce}}finally{try{w&&!w.done&&(k=L.return)&&k.call(L)}finally{if(_)throw _.error}}return Y}function Ao(){for(var F=[],E=0;E<arguments.length;E++)F=F.concat(oi(arguments[E]));return F}var Wi=null;function Ei(F){return Wi==null&&(Wi=Object(I.backend)().epsilon()),Object(I.tidy)(function(){var E=Object(I.moments)(F),k=E.mean,w=E.variance;return F.sub(k).div(w.sqrt().add(Wi))})}var bt=function(){function F(E){var k=this;if(E==null)throw new Error("Required configuration object is missing for BrowserFftFeatureExtractor constructor");if(E.spectrogramCallback==null)throw new Error("spectrogramCallback cannot be null or undefined");if(!(E.numFramesPerSpectrogram>0))throw new Error("Invalid value in numFramesPerSpectrogram: "+E.numFramesPerSpectrogram);if(E.suppressionTimeMillis<0)throw new Error("Expected suppressionTimeMillis to be >= 0, but got "+E.suppressionTimeMillis);if(this.suppressionTimeMillis=E.suppressionTimeMillis,this.spectrogramCallback=E.spectrogramCallback,this.numFrames=E.numFramesPerSpectrogram,this.sampleRateHz=E.sampleRateHz||44100,this.fftSize=E.fftSize||1024,this.frameDurationMillis=this.fftSize/this.sampleRateHz*1e3,this.columnTruncateLength=E.columnTruncateLength||this.fftSize,this.overlapFactor=E.overlapFactor,this.includeRawAudio=E.includeRawAudio,I.util.assert(this.overlapFactor>=0&&this.overlapFactor<1,function(){return"Expected overlapFactor to be >= 0 and < 1, but got "+k.overlapFactor}),this.columnTruncateLength>this.fftSize)throw new Error("columnTruncateLength "+this.columnTruncateLength+" exceeds fftSize ("+this.fftSize+").");this.audioContextConstructor=window.AudioContext||window.webkitAudioContext}return F.prototype.start=function(E){return Yr(this,void 0,void 0,function(){var k,w,_;return Xr(this,function(L){switch(L.label){case 0:if(this.frameIntervalTask!=null)throw new Error("Cannot start already-started BrowserFftFeatureExtractor");return k=this,[4,function(Y){return Yr(this,void 0,void 0,function(){return Xr(this,function(ce){switch(ce.label){case 0:return[4,navigator.mediaDevices.getUserMedia({audio:Y==null||Y,video:!1})];case 1:return[2,ce.sent()]}})})}(E)];case 1:return k.stream=L.sent(),this.audioContext=new this.audioContextConstructor,this.audioContext.sampleRate!==this.sampleRateHz&&console.warn("Mismatch in sampling rate: Expected: "+this.sampleRateHz+"; Actual: "+this.audioContext.sampleRate),w=this.audioContext.createMediaStreamSource(this.stream),this.analyser=this.audioContext.createAnalyser(),this.analyser.fftSize=2*this.fftSize,this.analyser.smoothingTimeConstant=0,w.connect(this.analyser),this.freqDataQueue=[],this.freqData=new Float32Array(this.fftSize),this.includeRawAudio&&(this.timeDataQueue=[],this.timeData=new Float32Array(this.fftSize)),_=Math.max(1,Math.round(this.numFrames*(1-this.overlapFactor))),this.tracker=new ge(_,Math.round(this.suppressionTimeMillis/this.frameDurationMillis)),this.frameIntervalTask=setInterval(this.onAudioFrame.bind(this),this.fftSize/this.sampleRateHz*1e3),[2]}})})},F.prototype.onAudioFrame=function(){return Yr(this,void 0,void 0,function(){var E,k,w,_;return Xr(this,function(L){switch(L.label){case 0:return this.analyser.getFloatFrequencyData(this.freqData),this.freqData[0]===-1/0?[2]:(this.freqDataQueue.push(this.freqData.slice(0,this.columnTruncateLength)),this.includeRawAudio&&(this.analyser.getFloatTimeDomainData(this.timeData),this.timeDataQueue.push(this.timeData.slice())),this.freqDataQueue.length>this.numFrames&&this.freqDataQueue.shift(),this.tracker.tick()?(E=Lr(this.freqDataQueue),k=Mt(E,[1,this.numFrames,this.columnTruncateLength,1]),w=void 0,this.includeRawAudio&&(_=Lr(this.timeDataQueue),w=Mt(_,[1,this.numFrames*this.fftSize])),[4,this.spectrogramCallback(k,w)]):[3,2]);case 1:L.sent()&&this.tracker.suppress(),Object(I.dispose)([k,w]),L.label=2;case 2:return[2]}})})},F.prototype.stop=function(){return Yr(this,void 0,void 0,function(){return Xr(this,function(E){if(this.frameIntervalTask==null)throw new Error("Cannot stop because there is no ongoing streaming activity.");return clearInterval(this.frameIntervalTask),this.frameIntervalTask=null,this.analyser.disconnect(),this.audioContext.close(),this.stream!=null&&this.stream.getTracks().length>0&&this.stream.getTracks()[0].stop(),[2]})})},F.prototype.setConfig=function(E){throw new Error("setConfig() is not implemented for BrowserFftFeatureExtractor.")},F.prototype.getFeatures=function(){throw new Error("getFeatures() is not implemented for BrowserFftFeatureExtractor. Use the spectrogramCallback field of the constructor config instead.")},F}();function Lr(F){var E=F[0].length,k=new Float32Array(F.length*E);return F.forEach(function(w,_){return k.set(w,_*E)}),k}function Mt(F,E){var k=new Float32Array(I.util.sizeFromShape(E));return k.set(F,k.length-F.length),Object(I.tensor)(k,E)}var ge=function(){function F(E,k){var w=this;this.period=E,this.suppressionTime=k??0,this.counter=0,I.util.assert(this.period>0,function(){return"Expected period to be positive, but got "+w.period})}return F.prototype.tick=function(){return this.counter++,this.counter%this.period==0&&(this.suppressionOnset==null||this.counter-this.suppressionOnset>this.suppressionTime)},F.prototype.suppress=function(){this.suppressionOnset=this.counter},F}();function le(F){var E=0;F.forEach(function(_){E+=_.byteLength});var k=new Uint8Array(E),w=0;return F.forEach(function(_){k.set(new Uint8Array(_),w),w+=_.byteLength}),k.buffer}function ye(F){var E=0;F.forEach(function(_){return E+=_.length});var k=new Float32Array(E),w=0;return F.forEach(function(_){k.set(_,w),w+=_.length}),k}function _e(F){if(F==null)throw new Error("Received null or undefind string");for(var E=unescape(encodeURIComponent(F)),k=new Uint8Array(E.length),w=0;w<E.length;++w)k[w]=E.charCodeAt(w);return k.buffer}function et(F){if(F==null)throw new Error("Received null or undefind buffer");var E=new Uint8Array(F);return decodeURIComponent(escape(String.fromCharCode.apply(String,Ao(E))))}var gt="TFJSSCDS",Rt=1,fn=function(){function F(E){if(this.examples={},this.label2Ids={},E!=null)for(var k=function(ce){I.util.assert(ce!=null,function(){return"Received null or undefined buffer"});var ve=0,De=et(ce.slice(ve,gt.length));I.util.assert(De===gt,function(){return"Deserialization error: Invalid descriptor"}),ve+=gt.length,ve+=4;var Ce=new Uint32Array(ce,ve,1),Xe=ve+=4;ve=Xe+Ce[0];var nt=et(ce.slice(Xe,ve));return{manifest:JSON.parse(nt),data:ce.slice(ve)}}(E),w=0,_=0;_<k.manifest.length;++_){var L=k.manifest[_],Y=L.spectrogramNumFrames*L.spectrogramFrameSize;L.rawAudioNumSamples!=null&&(Y+=L.rawAudioNumSamples),Y*=4,this.addExample(An({spec:L,data:k.data.slice(w,w+Y)})),w+=Y}}return F.prototype.addExample=function(E){I.util.assert(E!=null,function(){return"Got null or undefined example"}),I.util.assert(E.label!=null&&E.label.length>0,function(){return"Expected label to be a non-empty string, but got "+JSON.stringify(E.label)});var k=function(){function w(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return w()+w()+"-"+w()+"-"+w()+"-"+w()+"-"+w()+w()+w()}();return this.examples[k]=E,E.label in this.label2Ids||(this.label2Ids[E.label]=[]),this.label2Ids[E.label].push(k),k},F.prototype.merge=function(E){var k,w,_,L;I.util.assert(E!==this,function(){return"Cannot merge a dataset into itself"});var Y=E.getVocabulary();try{for(var ce=fi(Y),ve=ce.next();!ve.done;ve=ce.next()){var De=ve.value,Ce=E.getExamples(De);try{for(var Xe=fi(Ce),nt=Xe.next();!nt.done;nt=Xe.next()){var Et=nt.value;this.addExample(Et.example)}}catch(At){_={error:At}}finally{try{nt&&!nt.done&&(L=Xe.return)&&L.call(Xe)}finally{if(_)throw _.error}}}}catch(At){k={error:At}}finally{try{ve&&!ve.done&&(w=ce.return)&&w.call(ce)}finally{if(k)throw k.error}}},F.prototype.getExampleCounts=function(){var E={};for(var k in this.examples){var w=this.examples[k];w.label in E||(E[w.label]=0),E[w.label]++}return E},F.prototype.getExamples=function(E){var k=this;I.util.assert(E!=null,function(){return"Expected label to be a string, but got "+JSON.stringify(E)}),I.util.assert(E in this.label2Ids,function(){return'No example of label "'+E+'" exists in dataset'});var w=[];return this.label2Ids[E].forEach(function(_){w.push({uid:_,example:k.examples[_]})}),w},F.prototype.getData=function(E,k){var w=this;I.util.assert(this.size()>0,function(){return"Cannot get spectrograms as tensors because the dataset is empty"});var _=this.getVocabulary();E!=null?I.util.assert(_.indexOf(E)!==-1,function(){return"Label "+E+" is not in the vocabulary ("+JSON.stringify(_)+")"}):I.util.assert(_.length>1,function(){return"One-hot encoding of labels requires the vocabulary to have at least two words, but it has only "+_.length+" word."}),k==null&&(k={});var L,Y,ce=this.getSortedUniqueNumFrames();ce.length===1?(L=k.numFrames==null?ce[0]:k.numFrames,Y=k.hopFrames==null?1:k.hopFrames):(L=k.numFrames,I.util.assert(L!=null&&Number.isInteger(L)&&L>0,function(){return"There are "+ce.length+" unique lengths among the "+w.size()+" examples of this Dataset, hence numFrames is required. But it is not provided."}),I.util.assert(L<=ce[0],function(){return"numFrames ("+L+") exceeds the minimum numFrames ("+ce[0]+") among the examples of the Dataset."}),Y=k.hopFrames,I.util.assert(Y!=null&&Number.isInteger(Y)&&Y>0,function(){return"There are "+ce.length+" unique lengths among the "+w.size()+" examples of this Dataset, hence hopFrames is required. But it is not provided."}));var ve=k.normalize==null||k.normalize;return Object(I.tidy)(function(){for(var De,Ce,Xe,nt=[],Et=[],At=[],rn=0;rn<_.length;++rn){var un=_[rn];if(E==null||un===E){var kn=w.label2Ids[un],En=function(Ci){var Va,Xa,Js=w.examples[Ci].spectrogram,_s=Js.frameSize;Xe==null?Xe=_s:I.util.assert(_s===Xe,function(){return"Mismatch in frameSize  ("+_s+" vs "+Xe+")"});var hu=Js.data.length/_s,du=null;un!=="_background_noise_"&&(du=Js.keyFrameIndex==null?qn(Js).dataSync()[0]:Js.keyFrameIndex);var pu=Object(I.tensor3d)(Js.data,[hu,_s,1]),ad=Ln(hu,du,L,Y),rh=function(dl){var Gu=Object(I.tidy)(function(){var Ba=pu.slice([dl[0],0,0],[dl[1]-dl[0],-1,-1]);return ve?Ei(Ba):Ba});k.getDataset?Et.push(Gu.dataSync()):nt.push(Gu),E==null&&At.push(rn)};try{for(var hl=fi(ad),tf=hl.next();!tf.done;tf=hl.next())rh(tf.value)}catch(dl){Va={error:dl}}finally{try{tf&&!tf.done&&(Xa=hl.return)&&Xa.call(hl)}finally{if(Va)throw Va.error}}Object(I.dispose)(pu)};try{for(var _n=fi(kn),Pn=_n.next();!Pn.done;Pn=_n.next())En(Pn.value)}catch(Ci){De={error:Ci}}finally{try{Pn&&!Pn.done&&(Ce=_n.return)&&Ce.call(_n)}finally{if(De)throw De.error}}}}k.augmentByMixingNoiseRatio!=null&&w.augmentByMixingNoise(k.getDataset?Et:nt,At,k.augmentByMixingNoiseRatio);var dn=k.shuffle==null||k.shuffle;if(k.getDataset){var cr=k.datasetBatchSize==null?32:k.datasetBatchSize,yr=k.datasetValidationSplit==null?.15:k.datasetValidationSplit;I.util.assert(yr>0&&yr<1,function(){return"Invalid dataset validation split: "+yr});var br=Et.map(function(Ci,Va){return[Ci,At[Va]]});I.util.shuffle(br),Et=br.map(function(Ci){return Ci[0]});var Br=br.map(function(Ci){return Ci[1]}),Or=function(Ci,Va,Xa){var Js,_s,hu,du,pu,ad,rh,hl;I.util.assert(Xa>0&&Xa<1,function(){return"validationSplit is expected to be >0 and <1, but got "+Xa});for(var tf=!Array.isArray(Ci[0]),dl=Va,Gu=[],Ba=0;Ba<dl.length;++Ba){var nf=dl[Ba];Gu[nf]==null&&(Gu[nf]=[]),Gu[nf].push(Ba)}var ih=Gu.length,sd=[],rf=[];for(Gu.map(function(ou){return I.util.shuffle(ou)}),Ba=0;Ba<ih;++Ba)for(var ds=Gu[Ba],oh=Math.round(ds.length*(1-Xa)),ud=0;ud<ds.length;++ud)ud<oh?sd.push(ds[ud]):rf.push(ds[ud]);if(tf){var cd=[],jc=[],xp=[],Ku=[];try{for(var Ds=fi(sd),Iu=Ds.next();!Iu.done;Iu=Ds.next()){var ps=Iu.value;cd.push(Ci[ps]),jc.push(Va[ps])}}catch(ou){Js={error:ou}}finally{try{Iu&&!Iu.done&&(_s=Ds.return)&&_s.call(Ds)}finally{if(Js)throw Js.error}}try{for(var pl=fi(rf),ah=pl.next();!ah.done;ah=pl.next())ps=ah.value,xp.push(Ci[ps]),Ku.push(Va[ps])}catch(ou){hu={error:ou}}finally{try{ah&&!ah.done&&(du=pl.return)&&du.call(pl)}finally{if(hu)throw hu.error}}return{trainXs:cd,trainYs:jc,valXs:xp,valYs:Ku}}cd=[],jc=[],xp=[],Ku=[];try{for(var ld=fi(sd),sh=ld.next();!sh.done;sh=ld.next())ps=sh.value,cd.push(Ci[ps]),jc.push(Va[ps])}catch(ou){pu={error:ou}}finally{try{sh&&!sh.done&&(ad=ld.return)&&ad.call(ld)}finally{if(pu)throw pu.error}}try{for(var wp=fi(rf),ml=wp.next();!ml.done;ml=wp.next())ps=ml.value,xp.push(Ci[ps]),Ku.push(Va[ps])}catch(ou){rh={error:ou}}finally{try{ml&&!ml.done&&(hl=wp.return)&&hl.call(wp)}finally{if(rh)throw rh.error}}return{trainXs:cd,trainYs:jc,valXs:xp,valYs:Ku}}(Et,Br,yr),hi=Or.trainXs,ki=Or.trainYs,xi=Or.valXs,xo=Or.valYs,Wo=I.data.array(hi).map(function(Ci){return Object(I.tensor3d)(Ci,[L,Xe,1])}),To=I.data.array(ki).map(function(Ci){return Object(I.oneHot)([Ci],_.length).squeeze([0])}),Do=I.data.zip({xs:Wo,ys:To});dn&&(Do=Do.shuffle(Et.length)),Do=Do.batch(cr).prefetch(4);var Mo=I.data.array(xi).map(function(Ci){return Object(I.tensor3d)(Ci,[L,Xe,1])}),ea=I.data.array(xo).map(function(Ci){return Object(I.oneHot)([Ci],_.length).squeeze([0])}),sa=I.data.zip({xs:Mo,ys:ea});return[Do,sa=sa.batch(cr).prefetch(4)]}if(dn){var ka=[];nt.forEach(function(Ci,Va){ka.push({x:Ci,y:At[Va]})}),I.util.shuffle(ka),nt=ka.map(function(Ci){return Ci.x}),At=ka.map(function(Ci){return Ci.y})}var Ys=E==null?Object(I.oneHot)(Object(I.tensor1d)(At,"int32"),_.length).asType("float32"):void 0;return{xs:Object(I.stack)(nt),ys:Ys}})},F.prototype.augmentByMixingNoise=function(E,k,w){var _,L;if(E==null||E.length===0)throw new Error("Cannot perform augmentation because data is null or empty");for(var Y=E[0]instanceof Float32Array,ce=this.getVocabulary(),ve=[],De=[],Ce=0;Ce<k.length;++Ce)ce[k[Ce]]==="_background_noise_"?ve.push(Ce):De.push(Ce);if(ve.length===0)throw new Error("Cannot perform augmentation by mixing with noise when there is no example with label _background_noise_");var Xe=[],nt=[],Et=function(un){var kn=ve[function(dn,cr){return Math.floor((cr-dn)*Math.random())+dn}(0,ve.length)],En=Y?Object(I.tensor1d)(E[un]):E[un],_n=Y?Object(I.tensor1d)(E[kn]):E[kn],Pn=Object(I.tidy)(function(){return Ei(En.add(_n.mul(w)))});Y?Xe.push(Pn.dataSync()):Xe.push(Pn),nt.push(k[un])};try{for(var At=fi(De),rn=At.next();!rn.done;rn=At.next())Et(rn.value)}catch(un){_={error:un}}finally{try{rn&&!rn.done&&(L=At.return)&&L.call(At)}finally{if(_)throw _.error}}console.log("Data augmentation: mixing noise: added "+Xe.length+" examples"),Xe.forEach(function(un){return E.push(un)}),k.push.apply(k,Ao(nt))},F.prototype.getSortedUniqueNumFrames=function(){for(var E,k,w=new Set,_=this.getVocabulary(),L=0;L<_.length;++L){var Y=_[L],ce=this.label2Ids[Y];try{for(var ve=fi(ce),De=ve.next();!De.done;De=ve.next()){var Ce=De.value,Xe=this.examples[Ce].spectrogram,nt=Xe.data.length/Xe.frameSize;w.add(nt)}}catch(At){E={error:At}}finally{try{De&&!De.done&&(k=ve.return)&&k.call(ve)}finally{if(E)throw E.error}}}var Et=Ao(w);return Et.sort(),Et},F.prototype.removeExample=function(E){if(!(E in this.examples))throw new Error("Nonexistent example UID: "+E);var k=this.examples[E].label;delete this.examples[E];var w=this.label2Ids[k].indexOf(E);this.label2Ids[k].splice(w,1),this.label2Ids[k].length===0&&delete this.label2Ids[k]},F.prototype.setExampleKeyFrameIndex=function(E,k){if(!(E in this.examples))throw new Error("Nonexistent example UID: "+E);var w=this.examples[E].spectrogram,_=w.data.length/w.frameSize;I.util.assert(k>=0&&k<_&&Number.isInteger(k),function(){return"Invalid keyFrameIndex: "+k+". Must be >= 0, < "+_+", and an integer."}),w.keyFrameIndex=k},F.prototype.size=function(){return Object.keys(this.examples).length},F.prototype.durationMillis=function(){var E=0;for(var k in this.examples){var w=this.examples[k].spectrogram,_=23.22|w.frameDurationMillis;E+=w.data.length/w.frameSize*_}return E},F.prototype.empty=function(){return this.size()===0},F.prototype.clear=function(){this.examples={}},F.prototype.getVocabulary=function(){var E=new Set;for(var k in this.examples){var w=this.examples[k];E.add(w.label)}var _=Ao(E);return _.sort(),_},F.prototype.serialize=function(E){var k,w,_,L,Y=this.getVocabulary();I.util.assert(!this.empty(),function(){return"Cannot serialize empty Dataset"}),E!=null&&(Array.isArray(E)||(E=[E]),E.forEach(function(kn){if(Y.indexOf(kn)===-1)throw new Error('Word label "'+kn+'" does not exist in the vocabulary of this dataset. The vocabulary is: '+JSON.stringify(Y)+".")}));var ce=[],ve=[];try{for(var De=fi(Y),Ce=De.next();!Ce.done;Ce=De.next()){var Xe=Ce.value;if(E==null||E.indexOf(Xe)!==-1){var nt=this.label2Ids[Xe];try{for(var Et=fi(nt),At=Et.next();!At.done;At=Et.next()){var rn=At.value,un=Jn(this.examples[rn]);ce.push(un.spec),ve.push(un.data)}}catch(kn){_={error:kn}}finally{try{At&&!At.done&&(L=Et.return)&&L.call(Et)}finally{if(_)throw _.error}}}}}catch(kn){k={error:kn}}finally{try{Ce&&!Ce.done&&(w=De.return)&&w.call(De)}finally{if(k)throw k.error}}return function(kn){var En=_e(JSON.stringify(kn.manifest)),_n=_e(gt),Pn=new Uint32Array([Rt]),dn=new Uint32Array([En.byteLength]);return le([le([_n,Pn.buffer,dn.buffer]),En,kn.data])}({manifest:ce,data:le(ve)})},F}();function Jn(F){var E=F.rawAudio!=null,k={label:F.label,spectrogramNumFrames:F.spectrogram.data.length/F.spectrogram.frameSize,spectrogramFrameSize:F.spectrogram.frameSize};F.spectrogram.keyFrameIndex!=null&&(k.spectrogramKeyFrameIndex=F.spectrogram.keyFrameIndex);var w=F.spectrogram.data.buffer.slice(0);return E&&(k.rawAudioNumSamples=F.rawAudio.data.length,k.rawAudioSampleRateHz=F.rawAudio.sampleRateHz,w=le([w,F.rawAudio.data.buffer])),{spec:k,data:w}}function An(F){var E={frameSize:F.spec.spectrogramFrameSize,data:new Float32Array(F.data.slice(0,4*F.spec.spectrogramFrameSize*F.spec.spectrogramNumFrames))};F.spec.spectrogramKeyFrameIndex!=null&&(E.keyFrameIndex=F.spec.spectrogramKeyFrameIndex);var k={label:F.spec.label,spectrogram:E};return F.spec.rawAudioNumSamples!=null&&(k.rawAudio={sampleRateHz:F.spec.rawAudioSampleRateHz,data:new Float32Array(F.data.slice(4*F.spec.spectrogramFrameSize*F.spec.spectrogramNumFrames))}),k}function Ln(F,E,k,w){if(I.util.assert(Number.isInteger(F)&&F>0,function(){return"snippetLength must be a positive integer, but got "+F}),E!=null&&I.util.assert(Number.isInteger(E)&&E>=0,function(){return"focusIndex must be a non-negative integer, but got "+E}),I.util.assert(Number.isInteger(k)&&k>0,function(){return"windowLength must be a positive integer, but got "+k}),I.util.assert(Number.isInteger(w)&&w>0,function(){return"windowHop must be a positive integer, but got "+w}),I.util.assert(k<=F,function(){return"windowLength ("+k+") exceeds snippetLength ("+F+")"}),I.util.assert(E<F,function(){return"focusIndex ("+E+") equals or exceeds snippetLength ("+F+")"}),k===F)return[[0,F]];var _=[];if(E==null){for(var L=0;L+k<=F;)_.push([L,L+k]),L+=w;return _}var Y=Math.floor(k/2),ce=E-Y;for(ce<0?ce=0:ce+k>F&&(ce=F-k);!(ce-w<0||E>=ce-w+k);)ce-=w;for(;ce+k<=F&&!(E<ce);)_.push([ce,ce+k]),ce+=w;return _}function qn(F){return Object(I.tidy)(function(){return function(E){return Object(I.tidy)(function(){var k=E.data.length/E.frameSize;return Object(I.tensor2d)(E.data,[k,E.frameSize]).mean(-1)})}(F).argMax()})}var Nt="0.3.9",Ot="tfjs-speech-commands-saved-model-metadata",pn="indexeddb://tfjs-speech-commands-model/",Ht={localStorage:typeof window>"u"?null:window.localStorage},Ue=function(){function F(E,k,w){this.MODEL_URL_PREFIX="https://storage.googleapis.com/tfjs-models/tfjs/speech-commands/v"+function(_){return _.split(".").slice(0,2).join(".")}(Nt)+"/browser_fft",this.SAMPLE_RATE_HZ=44100,this.FFT_SIZE=1024,this.DEFAULT_SUPPRESSION_TIME_MILLIS=0,this.streaming=!1,this.transferRecognizers={},I.util.assert(k==null&&w==null||k!=null&&w!=null,function(){return"modelURL and metadataURL must be both provided or both not provided."}),k==null?(E==null?E=F.DEFAULT_VOCABULARY_NAME:I.util.assert(F.VALID_VOCABULARY_NAMES.indexOf(E)!==-1,function(){return"Invalid vocabulary name: '"+E+"'"}),this.vocabulary=E,this.modelArtifactsOrURL=this.MODEL_URL_PREFIX+"/"+this.vocabulary+"/model.json",this.metadataOrURL=this.MODEL_URL_PREFIX+"/"+this.vocabulary+"/metadata.json"):(I.util.assert(E==null,function(){return"vocabulary name must be null or undefined when modelURL is provided"}),this.modelArtifactsOrURL=k,this.metadataOrURL=w),this.parameters={sampleRateHz:this.SAMPLE_RATE_HZ,fftSize:this.FFT_SIZE}}return F.prototype.listen=function(E,k){return Yr(this,void 0,void 0,function(){var w,_,L,Y,ce,ve=this;return Xr(this,function(De){switch(De.label){case 0:if(this.streaming)throw new Error("Cannot start streaming again when streaming is ongoing.");return[4,this.ensureModelLoaded()];case 1:if(De.sent(),k==null&&(k={}),w=k.probabilityThreshold==null?0:k.probabilityThreshold,k.includeEmbedding&&(w=0),I.util.assert(w>=0&&w<=1,function(){return"Invalid probabilityThreshold value: "+w}),_=k.invokeCallbackOnNoiseAndUnknown!=null&&k.invokeCallbackOnNoiseAndUnknown,k.includeEmbedding&&(_=!0),k.suppressionTimeMillis<0)throw new Error("suppressionTimeMillis is expected to be >= 0, but got "+k.suppressionTimeMillis);return L=k.overlapFactor==null?.5:k.overlapFactor,I.util.assert(L>=0&&L<1,function(){return"Expected overlapFactor to be >= 0 and < 1, but got "+L}),Y=function(Ce,Xe){return Yr(ve,void 0,void 0,function(){var nt,Et,At,rn,un,kn,En,_n,Pn,dn,cr;return Xr(this,function(yr){switch(yr.label){case 0:return Et=Ei(Ce),k.includeEmbedding?[4,this.ensureModelWithEmbeddingOutputCreated()]:[3,2];case 1:return yr.sent(),nt=oi(this.modelWithEmbeddingOutput.predict(Et),2),At=nt[0],rn=nt[1],[3,3];case 2:At=this.model.predict(Et),yr.label=3;case 3:return[4,At.data()];case 4:return un=yr.sent(),[4,(kn=At.argMax(-1)).data()];case 5:return En=yr.sent()[0],_n=Math.max.apply(Math,Ao(un)),Object(I.dispose)([At,kn,Et]),_n<w?[2,!1]:[3,6];case 6:return Pn=void 0,k.includeSpectrogram?(dn={},[4,Ce.data()]):[3,8];case 7:dn.data=yr.sent(),dn.frameSize=this.nonBatchInputShape[1],Pn=dn,yr.label=8;case 8:return cr=!0,_||this.words[En]!=="_background_noise_"&&this.words[En]!=="_unknown_"||(cr=!1),cr&&E({scores:un,spectrogram:Pn,embedding:rn}),[2,cr]}})})},ce=k.suppressionTimeMillis==null?this.DEFAULT_SUPPRESSION_TIME_MILLIS:k.suppressionTimeMillis,this.audioDataExtractor=new bt({sampleRateHz:this.parameters.sampleRateHz,numFramesPerSpectrogram:this.nonBatchInputShape[0],columnTruncateLength:this.nonBatchInputShape[1],suppressionTimeMillis:ce,spectrogramCallback:Y,overlapFactor:L}),[4,this.audioDataExtractor.start(k.audioTrackConstraints)];case 2:return De.sent(),this.streaming=!0,[2]}})})},F.prototype.ensureModelLoaded=function(){return Yr(this,void 0,void 0,function(){var E,k,w,_,L=this;return Xr(this,function(Y){switch(Y.label){case 0:return this.model!=null?[2]:[4,this.ensureMetadataLoaded()];case 1:return Y.sent(),typeof this.modelArtifactsOrURL!="string"?[3,3]:[4,Object(I.loadLayersModel)(this.modelArtifactsOrURL)];case 2:return E=Y.sent(),[3,5];case 3:return[4,Object(I.loadLayersModel)(I.io.fromMemory(this.modelArtifactsOrURL.modelTopology,this.modelArtifactsOrURL.weightSpecs,this.modelArtifactsOrURL.weightData))];case 4:E=Y.sent(),Y.label=5;case 5:if(E.inputs.length!==1)throw new Error("Expected model to have 1 input, but got a model with "+E.inputs.length+" inputs");if(E.inputs[0].shape.length!==4)throw new Error("Expected model to have an input shape of rank 4, but got an input shape of rank "+E.inputs[0].shape.length);if(E.inputs[0].shape[3]!==1)throw new Error("Expected model to have an input shape with 1 as the last dimension, but got input shape"+JSON.stringify(E.inputs[0].shape[3])+"}");if((k=E.outputShape).length!==2)throw new Error("Expected loaded model to have an output shape of rank 2,but received shape "+JSON.stringify(k));if(k[1]!==this.words.length)throw new Error("Mismatch between the last dimension of model's output shape ("+k[1]+") and number of words ("+this.words.length+").");return this.model=E,this.freezeModel(),this.nonBatchInputShape=E.inputs[0].shape.slice(1),this.elementsPerExample=1,E.inputs[0].shape.slice(1).forEach(function(ce){return L.elementsPerExample*=ce}),this.warmUpModel(),w=this.parameters.fftSize/this.parameters.sampleRateHz*1e3,_=E.inputs[0].shape[1],this.parameters.spectrogramDurationMillis=_*w,[2]}})})},F.prototype.ensureModelWithEmbeddingOutputCreated=function(){return Yr(this,void 0,void 0,function(){var E,k;return Xr(this,function(w){switch(w.label){case 0:return this.modelWithEmbeddingOutput!=null?[2]:[4,this.ensureModelLoaded()];case 1:for(w.sent(),k=this.model.layers.length-2;k>=0;--k)if(this.model.layers[k].getClassName()==="Dense"){E=this.model.layers[k];break}if(E==null)throw new Error("Failed to find second last dense layer in the original model.");return this.modelWithEmbeddingOutput=Object(I.model)({inputs:this.model.inputs,outputs:[this.model.outputs[0],E.output]}),[2]}})})},F.prototype.warmUpModel=function(){var E=this;Object(I.tidy)(function(){for(var k=Object(I.zeros)([1].concat(E.nonBatchInputShape)),w=0;w<3;++w)E.model.predict(k)})},F.prototype.ensureMetadataLoaded=function(){return Yr(this,void 0,void 0,function(){var E,k,w;return Xr(this,function(_){switch(_.label){case 0:return this.words!=null?[2]:typeof this.metadataOrURL!="string"?[3,2]:[4,function(L){return Yr(this,void 0,void 0,function(){return Xr(this,function(Y){return[2,new Promise(function(ce,ve){L.indexOf("http://")===0||L.indexOf("https://")===0?fetch(L).then(function(De){De.json().then(function(Ce){return ce(Ce)})}):L.indexOf("file://")===0?a(185).readFile(L.slice(7),{encoding:"utf-8"},function(De,Ce){return ce(JSON.parse(Ce))}):ve(new Error("Unsupported URL scheme in metadata URL: "+L+". Supported schemes are: http://, https://, and (node.js-only) file://"))})]})})}(this.metadataOrURL)];case 1:return k=_.sent(),[3,3];case 2:k=this.metadataOrURL,_.label=3;case 3:if((E=k).wordLabels==null){if((w=E.words)==null)throw new Error('Cannot find field "words" or "wordLabels" in metadata JSON file');this.words=w}else this.words=E.wordLabels;return[2]}})})},F.prototype.stopListening=function(){return Yr(this,void 0,void 0,function(){return Xr(this,function(E){switch(E.label){case 0:if(!this.streaming)throw new Error("Cannot stop streaming when streaming is not ongoing.");return[4,this.audioDataExtractor.stop()];case 1:return E.sent(),this.streaming=!1,[2]}})})},F.prototype.isListening=function(){return this.streaming},F.prototype.wordLabels=function(){return this.words},F.prototype.params=function(){return this.parameters},F.prototype.modelInputShape=function(){if(this.model==null)throw new Error("Model has not been loaded yet. Load model by calling ensureModelLoaded(), recognize(), or listen().");return this.model.inputs[0].shape},F.prototype.recognize=function(E,k){return Yr(this,void 0,void 0,function(){var w,_,L,Y,ce,ve,De,Ce,Xe,nt,Et,At,rn;return Xr(this,function(un){switch(un.label){case 0:return k==null&&(k={}),[4,this.ensureModelLoaded()];case 1:return un.sent(),E!=null?[3,3]:[4,this.recognizeOnline()];case 2:w=un.sent(),E=w.data,un.label=3;case 3:if(E instanceof I.Tensor)this.checkInputTensorShape(E),L=E,_=E.shape[0];else{if((E=E).length%this.elementsPerExample)throw new Error("The length of the input Float32Array "+E.length+" is not divisible by the number of tensor elements per per example expected by the model "+this.elementsPerExample+".");_=E.length/this.elementsPerExample,L=Object(I.tensor4d)(E,[_].concat(this.nonBatchInputShape))}return ce={scores:null},k.includeEmbedding?[4,this.ensureModelWithEmbeddingOutputCreated()]:[3,5];case 4:return un.sent(),ve=this.modelWithEmbeddingOutput.predict(L),Y=ve[0],ce.embedding=ve[1],[3,6];case 5:Y=this.model.predict(L),un.label=6;case 6:return _!==1?[3,8]:(De=ce,[4,Y.data()]);case 7:return De.scores=un.sent(),[3,10];case 8:return Ce=Object(I.unstack)(Y),Xe=Ce.map(function(kn){return kn.data()}),nt=ce,[4,Promise.all(Xe)];case 9:nt.scores=un.sent(),Object(I.dispose)(Ce),un.label=10;case 10:return k.includeSpectrogram?(Et=ce,At={},E instanceof I.Tensor?[4,E.data()]:[3,12]):[3,14];case 11:return rn=un.sent(),[3,13];case 12:rn=E,un.label=13;case 13:Et.spectrogram=(At.data=rn,At.frameSize=this.nonBatchInputShape[1],At),un.label=14;case 14:return[2,ce]}})})},F.prototype.recognizeOnline=function(){return Yr(this,void 0,void 0,function(){var E=this;return Xr(this,function(k){return[2,new Promise(function(w,_){E.audioDataExtractor=new bt({sampleRateHz:E.parameters.sampleRateHz,numFramesPerSpectrogram:E.nonBatchInputShape[0],columnTruncateLength:E.nonBatchInputShape[1],suppressionTimeMillis:0,spectrogramCallback:function(L){return Yr(E,void 0,void 0,function(){var Y,ce,ve;return Xr(this,function(De){switch(De.label){case 0:return Y=Ei(L),[4,this.audioDataExtractor.stop()];case 1:return De.sent(),ce=w,ve={},[4,Y.data()];case 2:return ce.apply(void 0,[(ve.data=De.sent(),ve.frameSize=this.nonBatchInputShape[1],ve)]),Y.dispose(),[2,!1]}})})},overlapFactor:0}),E.audioDataExtractor.start()})]})})},F.prototype.createTransfer=function(E){if(this.model==null)throw new Error("Model has not been loaded yet. Load model by calling ensureModelLoaded(), recognizer(), or listen().");I.util.assert(E!=null&&typeof E=="string"&&E.length>1,function(){return"Expected the name for a transfer-learning recognized to be a non-empty string, but got "+JSON.stringify(E)}),I.util.assert(this.transferRecognizers[E]==null,function(){return"There is already a transfer-learning model named '"+E+"'"});var k=new Mn(E,this.parameters,this.model);return this.transferRecognizers[E]=k,k},F.prototype.freezeModel=function(){var E,k;try{for(var w=fi(this.model.layers),_=w.next();!_.done;_=w.next())_.value.trainable=!1}catch(L){E={error:L}}finally{try{_&&!_.done&&(k=w.return)&&k.call(w)}finally{if(E)throw E.error}}},F.prototype.checkInputTensorShape=function(E){var k=this.model.inputs[0].shape.length;if(E.shape.length!==k)throw new Error("Expected input Tensor to have rank "+k+", but got rank "+E.shape.length+" that differs ");var w=E.shape.slice(1),_=this.model.inputs[0].shape.slice(1);if(!I.util.arraysEqual(w,_))throw new Error("Expected input to have shape [null,"+_+"], but got shape [null,"+w+"]")},F.VALID_VOCABULARY_NAMES=["18w","directional4w"],F.DEFAULT_VOCABULARY_NAME="18w",F}(),Mn=function(F){function E(k,w,_){var L=F.call(this)||this;return L.name=k,L.parameters=w,L.baseModel=_,I.util.assert(k!=null&&typeof k=="string"&&k.length>0,function(){return"The name of a transfer model must be a non-empty string, but got "+JSON.stringify(k)}),L.nonBatchInputShape=L.baseModel.inputs[0].shape.slice(1),L.words=null,L.dataset=new fn,L}return function(k,w){function _(){this.constructor=k}Mr(k,w),k.prototype=w===null?Object.create(w):(_.prototype=w.prototype,new _)}(E,F),E.prototype.collectExample=function(k,w){return Yr(this,void 0,void 0,function(){var _,L,Y,ce,ve=this;return Xr(this,function(De){if(I.util.assert(!this.streaming,function(){return"Cannot start collection of transfer-learning example because a streaming recognition or transfer-learning example collection is ongoing"}),I.util.assert(k!=null&&typeof k=="string"&&k.length>0,function(){return"Must provide a non-empty string when collecting transfer-learning example"}),w==null&&(w={}),w.durationMultiplier!=null&&w.durationSec!=null)throw new Error("durationMultiplier and durationSec are mutually exclusive, but are both specified.");return w.durationSec!=null?(I.util.assert(w.durationSec>0,function(){return"Expected durationSec to be > 0, but got "+w.durationSec}),L=this.parameters.fftSize/this.parameters.sampleRateHz,_=Math.ceil(w.durationSec/L)):w.durationMultiplier!=null?(I.util.assert(w.durationMultiplier>=1,function(){return"Expected duration multiplier to be >= 1, but got "+w.durationMultiplier}),_=Math.round(this.nonBatchInputShape[0]*w.durationMultiplier)):_=this.nonBatchInputShape[0],w.snippetDurationSec!=null&&(I.util.assert(w.snippetDurationSec>0,function(){return"snippetDurationSec is expected to be > 0, but got "+w.snippetDurationSec}),I.util.assert(w.onSnippet!=null,function(){return"onSnippet must be provided if snippetDurationSec is provided."})),w.onSnippet!=null&&I.util.assert(w.snippetDurationSec!=null,function(){return"snippetDurationSec must be provided if onSnippet is provided."}),Y=this.parameters.fftSize/this.parameters.sampleRateHz,ce=Y*_,this.streaming=!0,[2,new Promise(function(Ce){var Xe=w.snippetDurationSec==null?1:w.snippetDurationSec/ce,nt=1-Xe,Et=Math.round(1/Xe),At=0,rn=-1,un=[];ve.audioDataExtractor=new bt({sampleRateHz:ve.parameters.sampleRateHz,numFramesPerSpectrogram:_,columnTruncateLength:ve.nonBatchInputShape[1],suppressionTimeMillis:0,spectrogramCallback:function(kn,En){return Yr(ve,void 0,void 0,function(){var _n,Pn,dn,cr,yr,br,Br,Or,hi,ki,xi,xo,Wo,To,Do,Mo,ea,sa,ka,Ys;return Xr(this,function(Ci){switch(Ci.label){case 0:return w.onSnippet!=null?[3,7]:(_n=Ei(kn),dn=(Pn=this.dataset).addExample,cr={label:k},yr={},[4,_n.data()]);case 1:return cr.spectrogram=(yr.data=Ci.sent(),yr.frameSize=this.nonBatchInputShape[1],yr),w.includeRawAudio?(Br={},[4,En.data()]):[3,3];case 2:return Br.data=Ci.sent(),Br.sampleRateHz=this.audioDataExtractor.sampleRateHz,br=Br,[3,4];case 3:br=void 0,Ci.label=4;case 4:return dn.apply(Pn,[(cr.rawAudio=br,cr)]),_n.dispose(),[4,this.audioDataExtractor.stop()];case 5:return Ci.sent(),this.streaming=!1,this.collateTransferWords(),Or=Ce,hi={},[4,kn.data()];case 6:return Or.apply(void 0,[(hi.data=Ci.sent(),hi.frameSize=this.nonBatchInputShape[1],hi)]),[3,13];case 7:return[4,kn.data()];case 8:for(ki=Ci.sent(),rn===-1&&(rn=ki.length),xi=rn-1;ki[xi]!==0&&xi>=0;)xi--;return xo=rn-xi-1,rn=xi+1,Wo=ki.slice(ki.length-xo,ki.length),un.push(Wo),w.onSnippet!=null&&w.onSnippet({data:Wo,frameSize:this.nonBatchInputShape[1]}),At++!==Et?[3,13]:[4,this.audioDataExtractor.stop()];case 9:return Ci.sent(),this.streaming=!1,this.collateTransferWords(),To=function(Va){if(Va.length<2)throw new Error("Cannot normalize a Float32Array with fewer than 2 elements.");return Wi==null&&(Wi=Object(I.backend)().epsilon()),Object(I.tidy)(function(){var Xa=Object(I.moments)(Object(I.tensor1d)(Va)),Js=Xa.mean,_s=Xa.variance,hu=Js.arraySync(),du=Math.sqrt(_s.arraySync()),pu=Array.from(Va).map(function(ad){return(ad-hu)/(du+Wi)});return new Float32Array(pu)})}(ye(un)),Do={data:To,frameSize:this.nonBatchInputShape[1]},ea=(Mo=this.dataset).addExample,sa={label:k,spectrogram:Do},w.includeRawAudio?(Ys={},[4,En.data()]):[3,11];case 10:return Ys.data=Ci.sent(),Ys.sampleRateHz=this.audioDataExtractor.sampleRateHz,ka=Ys,[3,12];case 11:ka=void 0,Ci.label=12;case 12:ea.apply(Mo,[(sa.rawAudio=ka,sa)]),Ce(Do),Ci.label=13;case 13:return[2,!1]}})})},overlapFactor:nt,includeRawAudio:w.includeRawAudio}),ve.audioDataExtractor.start(w.audioTrackConstraints)})]})})},E.prototype.clearExamples=function(){var k=this;I.util.assert(this.words!=null&&this.words.length>0&&!this.dataset.empty(),function(){return"No transfer learning examples exist for model name "+k.name}),this.dataset.clear(),this.words=null},E.prototype.countExamples=function(){if(this.dataset.empty())throw new Error("No examples have been collected for transfer-learning model named '"+this.name+"' yet.");return this.dataset.getExampleCounts()},E.prototype.getExamples=function(k){return this.dataset.getExamples(k)},E.prototype.setExampleKeyFrameIndex=function(k,w){this.dataset.setExampleKeyFrameIndex(k,w)},E.prototype.removeExample=function(k){this.dataset.removeExample(k),this.collateTransferWords()},E.prototype.isDatasetEmpty=function(){return this.dataset.empty()},E.prototype.loadExamples=function(k,w){var _,L,Y,ce;w===void 0&&(w=!1);var ve=new fn(k);w&&this.clearExamples();var De=ve.getVocabulary();try{for(var Ce=fi(De),Xe=Ce.next();!Xe.done;Xe=Ce.next()){var nt=Xe.value,Et=ve.getExamples(nt);try{for(var At=fi(Et),rn=At.next();!rn.done;rn=At.next()){var un=rn.value;this.dataset.addExample(un.example)}}catch(kn){Y={error:kn}}finally{try{rn&&!rn.done&&(ce=At.return)&&ce.call(At)}finally{if(Y)throw Y.error}}}}catch(kn){_={error:kn}}finally{try{Xe&&!Xe.done&&(L=Ce.return)&&L.call(Ce)}finally{if(_)throw _.error}}this.collateTransferWords()},E.prototype.serializeExamples=function(k){return this.dataset.serialize(k)},E.prototype.collateTransferWords=function(){this.words=this.dataset.getVocabulary()},E.prototype.collectTransferDataAsTensors=function(k,w){var _=this.nonBatchInputShape[0];k=k||.25;var L=Math.round(k*_),Y=this.dataset.getData(null,di({numFrames:_,hopFrames:L},w));return{xs:Y.xs,ys:Y.ys}},E.prototype.collectTransferDataAsTfDataset=function(k,w,_,L){w===void 0&&(w=.15),_===void 0&&(_=32);var Y=this.nonBatchInputShape[0];k=k||.25;var ce=Math.round(k*Y);return this.dataset.getData(null,di({numFrames:Y,hopFrames:ce,getDataset:!0,datasetBatchSize:_,datasetValidationSplit:w},L))},E.prototype.train=function(k){return Yr(this,void 0,void 0,function(){var w,_=this;return Xr(this,function(L){switch(L.label){case 0:return I.util.assert(this.words!=null&&this.words.length>0,function(){return"Cannot train transfer-learning model '"+_.name+"' because no transfer learning example has been collected."}),I.util.assert(this.words.length>1,function(){return"Cannot train transfer-learning model '"+_.name+"' because only 1 word label ('"+JSON.stringify(_.words)+"') has been collected for transfer learning. Requires at least 2."}),k.fineTuningEpochs!=null&&I.util.assert(k.fineTuningEpochs>=0&&Number.isInteger(k.fineTuningEpochs),function(){return"If specified, fineTuningEpochs must be a non-negative integer, but received "+k.fineTuningEpochs}),k==null&&(k={}),this.model==null&&this.createTransferModelFromBaseModel(),this.secondLastBaseDenseLayer.trainable=!1,this.model.compile({loss:"categoricalCrossentropy",optimizer:k.optimizer||"sgd",metrics:["acc"]}),w=k.fitDatasetDurationMillisThreshold==null?6e4:k.fitDatasetDurationMillisThreshold,this.dataset.durationMillis()>w?(console.log("Detected large dataset: total duration = "+this.dataset.durationMillis()+" ms > "+w+" ms. Training transfer model using fitDataset() instead of fit()"),[4,this.trainOnDataset(k)]):[3,2];case 1:return[2,L.sent()];case 2:return[4,this.trainOnTensors(k)];case 3:return[2,L.sent()]}})})},E.prototype.trainOnDataset=function(k){return Yr(this,void 0,void 0,function(){var w,_,L,Y,ce,ve,De,Ce,Xe;return Xr(this,function(nt){switch(nt.label){case 0:return I.util.assert(k.epochs>0,function(){return"Invalid config.epochs"}),w=k.batchSize==null?32:k.batchSize,_=k.windowHopRatio||.25,L=oi(this.collectTransferDataAsTfDataset(_,k.validationSplit,w,{augmentByMixingNoiseRatio:k.augmentByMixingNoiseRatio}),2),Y=L[0],ce=L[1],ve=I.util.now(),[4,this.model.fitDataset(Y,{epochs:k.epochs,validationData:k.validationSplit>0?ce:null,callbacks:k.callback==null?null:[k.callback]})];case 1:return De=nt.sent(),console.log("fitDataset() took "+(I.util.now()-ve).toFixed(2)+" ms"),k.fineTuningEpochs!=null&&k.fineTuningEpochs>0?(Ce=I.util.now(),[4,this.fineTuningUsingTfDatasets(k,Y,ce)]):[3,3];case 2:return Xe=nt.sent(),console.log("fitDataset() (fine-tuning) took "+(I.util.now()-Ce).toFixed(2)+" ms"),[2,[De,Xe]];case 3:return[2,De]}})})},E.prototype.trainOnTensors=function(k){return Yr(this,void 0,void 0,function(){var w,_,L,Y,ce,ve,De,Ce,Xe,nt;return Xr(this,function(Et){switch(Et.label){case 0:w=k.windowHopRatio||.25,_=this.collectTransferDataAsTensors(w,{augmentByMixingNoiseRatio:k.augmentByMixingNoiseRatio}),L=_.xs,Y=_.ys,console.log("Training data: xs.shape = "+L.shape+", ys.shape = "+Y.shape),Et.label=1;case 1:return Et.trys.push([1,,6,7]),k.validationSplit!=null?(Ce=function(At,rn,un){return I.util.assert(un>0&&un<1,function(){return"validationSplit is expected to be >0 and <1, but got "+un}),Object(I.tidy)(function(){for(var kn=rn.argMax(-1).dataSync(),En=[],_n=0;_n<kn.length;++_n){var Pn=kn[_n];En[Pn]==null&&(En[Pn]=[]),En[Pn].push(_n)}var dn=En.length,cr=[],yr=[];for(En.map(function(hi){return I.util.shuffle(hi)}),_n=0;_n<dn;++_n)for(var br=En[_n],Br=Math.round(br.length*(1-un)),Or=0;Or<br.length;++Or)Or<Br?cr.push(br[Or]):yr.push(br[Or]);return{trainXs:Object(I.gather)(At,cr),trainYs:Object(I.gather)(rn,cr),valXs:Object(I.gather)(At,yr),valYs:Object(I.gather)(rn,yr)}})}(L,Y,k.validationSplit),ce=Ce.trainXs,ve=Ce.trainYs,De=[Ce.valXs,Ce.valYs]):(ce=L,ve=Y),[4,this.model.fit(ce,ve,{epochs:k.epochs==null?20:k.epochs,validationData:De,batchSize:k.batchSize,callbacks:k.callback==null?null:[k.callback]})];case 2:return Xe=Et.sent(),k.fineTuningEpochs!=null&&k.fineTuningEpochs>0?[4,this.fineTuningUsingTensors(k,ce,ve,De)]:[3,4];case 3:return nt=Et.sent(),[2,[Xe,nt]];case 4:return[2,Xe];case 5:return[3,7];case 6:return Object(I.dispose)([L,Y,ce,ve,De]),[7];case 7:return[2]}})})},E.prototype.fineTuningUsingTfDatasets=function(k,w,_){return Yr(this,void 0,void 0,function(){var L,Y,ce;return Xr(this,function(ve){switch(ve.label){case 0:return L=this.secondLastBaseDenseLayer.trainable,this.secondLastBaseDenseLayer.trainable=!0,Y=k.fineTuningOptimizer==null?"sgd":k.fineTuningOptimizer,this.model.compile({loss:"categoricalCrossentropy",optimizer:Y,metrics:["acc"]}),[4,this.model.fitDataset(w,{epochs:k.fineTuningEpochs,validationData:_,callbacks:k.callback==null?null:[k.callback]})];case 1:return ce=ve.sent(),this.secondLastBaseDenseLayer.trainable=L,[2,ce]}})})},E.prototype.fineTuningUsingTensors=function(k,w,_,L){return Yr(this,void 0,void 0,function(){var Y,ce,ve;return Xr(this,function(De){switch(De.label){case 0:return Y=this.secondLastBaseDenseLayer.trainable,this.secondLastBaseDenseLayer.trainable=!0,ce=k.fineTuningOptimizer==null?"sgd":k.fineTuningOptimizer,this.model.compile({loss:"categoricalCrossentropy",optimizer:ce,metrics:["acc"]}),[4,this.model.fit(w,_,{epochs:k.fineTuningEpochs,validationData:L,batchSize:k.batchSize,callbacks:k.fineTuningCallback==null?null:[k.fineTuningCallback]})];case 1:return ve=De.sent(),this.secondLastBaseDenseLayer.trainable=Y,[2,ve]}})})},E.prototype.evaluate=function(k){return Yr(this,void 0,void 0,function(){var w,_=this;return Xr(this,function(L){return I.util.assert(k.wordProbThresholds!=null&&k.wordProbThresholds.length>0,function(){return"Received null or empty wordProbThresholds"}),w=0,I.util.assert(this.words[w]==="_background_noise_",function(){return"Cannot perform evaluation when the first tag is not _background_noise_"}),[2,Object(I.tidy)(function(){for(var Y=[],ce=0,ve=_.collectTransferDataAsTensors(k.windowHopRatio),De=ve.xs,Ce=ve.ys.argMax(-1).dataSync(),Xe=_.model.predict(De),nt=Xe.slice([0,1],[Xe.shape[0],Xe.shape[1]-1]).max(-1),Et=Xe.shape[0],At=0;At<k.wordProbThresholds.length;++At){for(var rn=k.wordProbThresholds[At],un=nt.greater(Object(I.scalar)(rn)).dataSync(),kn=0,En=0,_n=0,Pn=0,dn=0;dn<Et;++dn)Ce[dn]===w?(kn++,un[dn]&&_n++):(En++,un[dn]&&Pn++);var cr=_n/kn,yr=Pn/En;Y.push({probThreshold:rn,fpr:cr,tpr:yr}),console.log("ROC thresh="+rn+": fpr="+cr.toFixed(4)+", tpr="+yr.toFixed(4)),At>0&&(ce+=Math.abs(Y[At-1].fpr-Y[At].fpr)*(Y[At-1].tpr+Y[At].tpr)/2)}return{rocCurve:Y,auc:ce}})]})})},E.prototype.createTransferModelFromBaseModel=function(){var k=this;I.util.assert(this.words!=null,function(){return"No word example is available for tranfer-learning model of name "+k.name});for(var w=this.baseModel.layers,_=w.length-2;_>=0&&w[_].getClassName().toLowerCase()!=="dense";)_--;if(_<0)throw new Error("Cannot find a hidden dense layer in the base model.");this.secondLastBaseDenseLayer=w[_];var L=this.secondLastBaseDenseLayer.output;this.transferHead=Object(I.sequential)(),this.transferHead.add(I.layers.dense({units:this.words.length,activation:"softmax",inputShape:L.shape.slice(1),name:"NewHeadDense"}));var Y=this.transferHead.apply(L);this.model=Object(I.model)({inputs:this.baseModel.inputs,outputs:Y})},E.prototype.modelInputShape=function(){return this.baseModel.inputs[0].shape},E.prototype.getMetadata=function(){return{tfjsSpeechCommandsVersion:Nt,modelName:this.name,timeStamp:new Date().toISOString(),wordLabels:this.wordLabels()}},E.prototype.save=function(k){return Yr(this,void 0,void 0,function(){var w,_,L;return Xr(this,function(Y){return w=k!=null,k=k||Gn(this.name),w||(_=Ht.localStorage.getItem(Ot),(L=_==null?{}:JSON.parse(_))[this.name]=this.getMetadata(),Ht.localStorage.setItem(Ot,JSON.stringify(L))),console.log("Saving model to "+k),[2,this.model.save(k)]})})},E.prototype.load=function(k){return Yr(this,void 0,void 0,function(){var w,_,L;return Xr(this,function(Y){switch(Y.label){case 0:if(w=k!=null,k=k||Gn(this.name),!w){if((_=JSON.parse(Ht.localStorage.getItem(Ot)))==null||_[this.name]==null)throw new Error("Cannot find metadata for transfer model named "+this.name+'"');this.words=_[this.name].wordLabels,console.log("Loaded word list for model named "+this.name+": "+this.words)}return L=this,[4,Object(I.loadLayersModel)(k)];case 1:return L.model=Y.sent(),console.log("Loaded model from "+k+":"),this.model.summary(),[2]}})})},E.prototype.createTransfer=function(k){throw new Error("Creating transfer-learned recognizer from a transfer-learned recognizer is not supported.")},E}(Ue);function Gn(F){return""+pn+F}function Zn(F,E,k,w){if(I.util.assert(k==null&&w==null||k!=null&&w!=null,function(){return"customModelURL and customMetadataURL must be both provided or both not provided."}),k!=null&&I.util.assert(E==null,function(){return"vocabulary name must be null or undefined when modelURL is provided."}),F==="BROWSER_FFT")return new Ue(E,k,w);throw F==="SOFT_FFT"?new Error("SOFT_FFT SpeechCommandRecognizer has not been implemented yet."):new Error("Invalid fftType: '"+F+"'")}var ir=function(){function F(E){pe()(this,F),this.options=E}return Te()(F,[{key:"load",value:function(){var E=K()(we.a.mark(function k(w){var _,L,Y;return we.a.wrap(function(ce){for(;;)switch(ce.prev=ce.next){case 0:return w?(_=w.split("/"),L=_.slice(0,_.length-1).join("/"),Y="".concat(L,"/metadata.json"),this.model=Zn("BROWSER_FFT",void 0,w,Y)):this.model=Zn("BROWSER_FFT"),ce.next=3,this.model.ensureModelLoaded();case 3:this.allLabels=this.model.wordLabels();case 4:case"end":return ce.stop()}},k,this)}));return function(k){return E.apply(this,arguments)}}()},{key:"classify",value:function(){var E=this,k=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.allLabels.length,w=arguments.length>1?arguments[1]:void 0;return this.model.listen(function(_){if(_.scores){var L=wn(_.scores,k,E.allLabels).map(function(Y){return{label:Y.className,confidence:Y.probability}});return w(null,L)}return w("ERROR: Cannot find scores in result: ".concat(_))},this.options).catch(function(_){return w("ERROR: ".concat(_.message))})}}]),F}();function zr(F,E){return vr.apply(this,arguments)}function vr(){return(vr=K()(we.a.mark(function F(E,k){var w;return we.a.wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return w=new ir(E),_.next=3,w.load(k);case 3:return _.abrupt("return",w);case 4:case"end":return _.stop()}},F)}))).apply(this,arguments)}var pi=["speechcommands18w"],fo=function(){function F(E,k,w){if(pe()(this,F),this.model=null,this.options=k,typeof E=="string")if(pi.includes(E))switch(this.modelName=E,this.modelUrl=null,this.modelName){case"speechcommands18w":this.modelToUse=re;break;default:this.modelToUse=null}else this.modelToUse=re,this.modelUrl=E;this.ready=ot(this.loadModel(k,this.modelUrl),w)}return Te()(F,[{key:"loadModel",value:function(){var E=K()(we.a.mark(function k(w){return we.a.wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return _.next=2,this.modelToUse.load(w,this.modelUrl);case 2:return this.model=_.sent,_.abrupt("return",this);case 4:case"end":return _.stop()}},k,this)}));return function(k){return E.apply(this,arguments)}}()},{key:"classifyInternal",value:function(){var E=K()(we.a.mark(function k(w,_){return we.a.wrap(function(L){for(;;)switch(L.prev=L.next){case 0:return L.next=2,this.ready;case 2:return L.next=4,I.nextFrame();case 4:return L.abrupt("return",this.model.classify(w,_));case 5:case"end":return L.stop()}},k,this)}));return function(k,w){return E.apply(this,arguments)}}()},{key:"classify",value:function(){var E=K()(we.a.mark(function k(){var w,_,L,Y,ce=arguments;return we.a.wrap(function(ve){for(;;)switch(ve.prev=ve.next){case 0:return w=ce.length>0&&ce[0]!==void 0?ce[0]:null,_=ce.length>1?ce[1]:void 0,L=this.topk,typeof w=="number"?L=w:typeof w=="function"&&(Y=w),typeof _=="function"&&(Y=_),ve.abrupt("return",this.classifyInternal(L,Y));case 6:case"end":return ve.stop()}},k,this)}));return function(){return E.apply(this,arguments)}}()}]),F}(),ui=function(F,E,k){var w={},_=k,L=F;if(typeof L!="string")throw new Error('Please specify a model to use. E.g: "SpeechCommands18w"');L.indexOf("http")===-1&&(L=F.toLowerCase()),ke()(E)==="object"?w=E:typeof E=="function"&&(_=E);var Y=new fo(L,w,_);return _?Y:Y.ready};function Zi(F,E){return F==null&&E==null?null:F==null?E.clone():E===null?F.clone():F.concat(E,0)}function Ti(F,E){for(var k=[],w=0;w<F.length;w++)k.push({value:F[w],index:w});k.sort(function(Y,ce){return ce.value-Y.value});var _=new Float32Array(E),L=new Int32Array(E);for(w=0;w<E;w++)_[w]=k[w].value,L[w]=k[w].index;return{values:_,indices:L}}var qr=function(){function F(){this.classDatasetMatrices={},this.classExampleCount={},this.labelToClassId={},this.nextClassId=0}return F.prototype.addExample=function(E,k){var w=this;if(this.exampleShape==null&&(this.exampleShape=E.shape),!Ye.util.arraysEqual(this.exampleShape,E.shape))throw new Error("Example shape provided, "+E.shape+" does not match previously provided example shapes "+this.exampleShape+".");this.clearTrainDatasetMatrix(),k in this.labelToClassId||(this.labelToClassId[k]=this.nextClassId++),Object(Ye.tidy)(function(){var _=w.normalizeVectorToUnitLength(E.flatten()),L=_.shape[0];if(w.classDatasetMatrices[k]==null)w.classDatasetMatrices[k]=_.as2D(1,L);else{var Y=w.classDatasetMatrices[k].as2D(w.classExampleCount[k],L).concat(_.as2D(1,L),0);w.classDatasetMatrices[k].dispose(),w.classDatasetMatrices[k]=Y}Object(Ye.keep)(w.classDatasetMatrices[k]),w.classExampleCount[k]==null&&(w.classExampleCount[k]=0),w.classExampleCount[k]++})},F.prototype.similarities=function(E){var k=this;return Object(Ye.tidy)(function(){var w=k.normalizeVectorToUnitLength(E.flatten()),_=w.shape[0];if(k.trainDatasetMatrix==null){var L=null;for(var Y in k.classDatasetMatrices)L=Zi(L,k.classDatasetMatrices[Y]);k.trainDatasetMatrix=L}if(k.trainDatasetMatrix==null)return console.warn("Cannot predict without providing training examples."),null;Object(Ye.keep)(k.trainDatasetMatrix);var ce=k.getNumExamples();return k.trainDatasetMatrix.as2D(ce,_).matMul(w.as2D(_,1)).as1D()})},F.prototype.predictClass=function(E,k){return k===void 0&&(k=3),function(w,_,L,Y){return new(L||(L=Promise))(function(ce,ve){function De(nt){try{Xe(Y.next(nt))}catch(Et){ve(Et)}}function Ce(nt){try{Xe(Y.throw(nt))}catch(Et){ve(Et)}}function Xe(nt){nt.done?ce(nt.value):new L(function(Et){Et(nt.value)}).then(De,Ce)}Xe((Y=Y.apply(w,_||[])).next())})}(this,void 0,void 0,function(){var w,_,L,Y,ce=this;return function(ve,De){var Ce,Xe,nt,Et,At={label:0,sent:function(){if(1&nt[0])throw nt[1];return nt[1]},trys:[],ops:[]};return Et={next:rn(0),throw:rn(1),return:rn(2)},typeof Symbol=="function"&&(Et[Symbol.iterator]=function(){return this}),Et;function rn(un){return function(kn){return function(En){if(Ce)throw new TypeError("Generator is already executing.");for(;At;)try{if(Ce=1,Xe&&(nt=2&En[0]?Xe.return:En[0]?Xe.throw||((nt=Xe.return)&&nt.call(Xe),0):Xe.next)&&!(nt=nt.call(Xe,En[1])).done)return nt;switch(Xe=0,nt&&(En=[2&En[0],nt.value]),En[0]){case 0:case 1:nt=En;break;case 4:return At.label++,{value:En[1],done:!1};case 5:At.label++,Xe=En[1],En=[0];continue;case 7:En=At.ops.pop(),At.trys.pop();continue;default:if(!(nt=(nt=At.trys).length>0&&nt[nt.length-1])&&(En[0]===6||En[0]===2)){At=0;continue}if(En[0]===3&&(!nt||En[1]>nt[0]&&En[1]<nt[3])){At.label=En[1];break}if(En[0]===6&&At.label<nt[1]){At.label=nt[1],nt=En;break}if(nt&&At.label<nt[2]){At.label=nt[2],At.ops.push(En);break}nt[2]&&At.ops.pop(),At.trys.pop();continue}En=De.call(ve,At)}catch(_n){En=[6,_n],Xe=0}finally{Ce=nt=0}if(5&En[0])throw En[1];return{value:En[0]?En[1]:void 0,done:!0}}([un,kn])}}}(this,function(ve){switch(ve.label){case 0:if(k<1)throw new Error("Please provide a positive integer k value to predictClass.");if(this.getNumExamples()===0)throw new Error("You have not added any examples to the KNN classifier. Please add examples before calling predictClass.");return w=Object(Ye.tidy)(function(){return ce.similarities(E).asType("float32")}),_=Math.min(k,this.getNumExamples()),Y=Ti,[4,w.data()];case 1:return L=Y.apply(void 0,[ve.sent(),_]).indices,w.dispose(),[2,this.calculateTopClass(L,_)]}})})},F.prototype.clearClass=function(E){if(this.classDatasetMatrices[E]==null)throw new Error("Cannot clear invalid class "+E);delete this.classDatasetMatrices[E],delete this.classExampleCount[E],this.clearTrainDatasetMatrix()},F.prototype.clearAllClasses=function(){for(var E in this.classDatasetMatrices)this.clearClass(E)},F.prototype.getClassExampleCount=function(){return this.classExampleCount},F.prototype.getClassifierDataset=function(){return this.classDatasetMatrices},F.prototype.getNumClasses=function(){return Object.keys(this.classExampleCount).length},F.prototype.setClassifierDataset=function(E){for(var k in this.clearTrainDatasetMatrix(),this.classDatasetMatrices=E,E)this.classExampleCount[k]=E[k].shape[0]},F.prototype.calculateTopClass=function(E,k){var w,_={};if(E==null)return{classIndex:this.labelToClassId[w],label:w,confidences:_};var L={},Y=0;for(var ce in this.classDatasetMatrices)Y+=this.classExampleCount[ce],L[ce]=Y;var ve={};for(var ce in this.classDatasetMatrices)ve[ce]=0;for(var De=0;De<E.length;De++){var Ce=E[De];for(var ce in this.classDatasetMatrices)if(Ce<L[ce]){ve[ce]++;break}}var Xe=0;for(var ce in this.classDatasetMatrices){var nt=ve[ce]/k;nt>Xe&&(Xe=nt,w=ce),_[ce]=nt}return{classIndex:this.labelToClassId[w],label:w,confidences:_}},F.prototype.clearTrainDatasetMatrix=function(){this.trainDatasetMatrix!=null&&(this.trainDatasetMatrix.dispose(),this.trainDatasetMatrix=null)},F.prototype.normalizeVectorToUnitLength=function(E){return Object(Ye.tidy)(function(){var k=E.norm();return Object(Ye.div)(E,k)})},F.prototype.getNumExamples=function(){var E=0;for(var k in this.classDatasetMatrices)E+=this.classExampleCount[k];return E},F.prototype.dispose=function(){for(var E in this.clearTrainDatasetMatrix(),this.classDatasetMatrices)this.classDatasetMatrices[E].dispose()},F}(),jr=function(){var F=K()(we.a.mark(function E(k,w,_){var L,Y;return we.a.wrap(function(ce){for(;;)switch(ce.prev=ce.next){case 0:(L=document.createElement("a")).style.display="none",document.body.appendChild(L),Y=new Blob([k],{type:_}),L.href=URL.createObjectURL(Y),L.download=w,L.click();case 7:case"end":return ce.stop()}},E)}));return function(E,k,w){return F.apply(this,arguments)}}(),jn=function(){var F=K()(we.a.mark(function E(k,w){return we.a.wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return _.abrupt("return",Gt.a.get(k).then(function(L){return L.data}).then(function(L){return w&&w(null,L),L}).catch(function(L){throw w&&w(L),console.error("There has been a problem loading the file: ".concat(L.message)),L}));case 1:case"end":return _.stop()}},E)}));return function(E,k){return F.apply(this,arguments)}}(),ri=function(){function F(){pe()(this,F),this.knnClassifier=new qr,this.mapStringToIndex=[]}return Te()(F,[{key:"addExample",value:function(E,k){var w,_;typeof k=="string"?w=this.mapStringToIndex.includes(k)?this.mapStringToIndex.indexOf(k):this.mapStringToIndex.push(k)-1:typeof k=="number"&&(w=k),_=Array.isArray(E)?I.tensor(E):E,this.knnClassifier.addExample(_,w)}},{key:"classify",value:function(){var E=K()(we.a.mark(function k(w,_,L){var Y,ce,ve;return we.a.wrap(function(De){for(;;)switch(De.prev=De.next){case 0:return Y=3,ce=L,typeof _=="number"?Y=_:typeof _=="function"&&(ce=_),ve=Array.isArray(w)?I.tensor(w):w,De.abrupt("return",ot(this.classifyInternal(ve,Y),ce));case 5:case"end":return De.stop()}},k,this)}));return function(k,w,_){return E.apply(this,arguments)}}()},{key:"classifyInternal",value:function(){var E=K()(we.a.mark(function k(w,_){var L,Y,ce,ve=this;return we.a.wrap(function(De){for(;;)switch(De.prev=De.next){case 0:if(!(this.knnClassifier.getNumClasses()<=0)){De.next=5;break}throw new Error("There is no example in any class");case 5:return De.next=7,this.knnClassifier.predictClass(w,_);case 7:return L=De.sent,this.mapStringToIndex.length>0&&((L.classIndex||L.classIndex===0)&&(Y=this.mapStringToIndex[L.classIndex])&&(L.label=Y),L.confidences&&(L.confidencesByLabel={},ce=L.confidences,Object.keys(ce).forEach(function(Ce){var Xe=ve.mapStringToIndex[Ce];L.confidencesByLabel[Xe]=ce[Ce]}))),De.abrupt("return",L);case 10:case"end":return De.stop()}},k,this)}));return function(k,w){return E.apply(this,arguments)}}()},{key:"clearLabel",value:function(E){var k;typeof E=="string"?this.mapStringToIndex.includes(E)&&(k=this.mapStringToIndex.indexOf(E)):typeof E=="number"&&(k=E),this.knnClassifier.clearClass(k)}},{key:"clearAllLabels",value:function(){this.mapStringToIndex=[],this.knnClassifier.clearAllClasses()}},{key:"getCountByLabel",value:function(){var E=this,k=this.knnClassifier.getClassExampleCount();if(this.mapStringToIndex.length>0){var w={};return Object.keys(k).forEach(function(_){if(E.mapStringToIndex[_]){var L=E.mapStringToIndex[_];w[L]=k[_]}}),w}return k}},{key:"getCount",value:function(){return this.knnClassifier.getClassExampleCount()}},{key:"getClassifierDataset",value:function(){return this.knnClassifier.getClassifierDataset()}},{key:"setClassifierDataset",value:function(E){this.knnClassifier.setClassifierDataset(E)}},{key:"getNumLabels",value:function(){return this.knnClassifier.getNumClasses()}},{key:"dispose",value:function(){this.knnClassifier.dispose()}},{key:"save",value:function(){var E=K()(we.a.mark(function k(w){var _,L,Y,ce=this;return we.a.wrap(function(ve){for(;;)switch(ve.prev=ve.next){case 0:return _=this.knnClassifier.getClassifierDataset(),this.mapStringToIndex.length>0&&Object.keys(_).forEach(function(De){ce.mapStringToIndex[De]&&(_[De].label=ce.mapStringToIndex[De])}),L=Object.keys(_).map(function(De){var Ce=_[De];return Ce?Ce.dataSync():null}),Y="myKNN.json",w&&(Y=w.endsWith(".json")?w:"".concat(w,".json")),ve.next=7,jr(JSON.stringify({dataset:_,tensors:L}),Y,"application/octet-stream");case 7:case"end":return ve.stop()}},k,this)}));return function(k){return E.apply(this,arguments)}}()},{key:"load",value:function(){var E=K()(we.a.mark(function k(w,_){var L,Y,ce,ve,De;return we.a.wrap(function(Ce){for(;;)switch(Ce.prev=Ce.next){case 0:if(ke()(w)!=="object"){Ce.next=4;break}L=w,Ce.next=7;break;case 4:return Ce.next=6,jn(w);case 6:L=Ce.sent;case 7:L&&(ce=(Y=L).dataset,ve=Y.tensors,this.mapStringToIndex=Object.keys(ce).map(function(Xe){return ce[Xe].label}),De=ve.map(function(Xe,nt){if(Xe){var Et=Object.keys(Xe).map(function(At){return Xe[At]});return I.tensor(Et,ce[nt].shape,ce[nt].dtype)}return null}).reduce(function(Xe,nt,Et){return Xe[Et]=nt,Xe},{}),this.knnClassifier.setClassifierDataset(De),_&&_());case 8:case"end":return Ce.stop()}},k,this)}));return function(k,w){return E.apply(this,arguments)}}()}]),F}(),Vi=function(){return new ri},Rr=function(){function F(E,k){pe()(this,F),this.videoElt=null,this.size=k,this.videoReady=!1,typeof HTMLVideoElement<"u"&&(E instanceof HTMLVideoElement?this.videoElt=E:E!==null&&ke()(E)==="object"&&E.elt instanceof HTMLVideoElement&&(this.videoElt=E.elt))}return Te()(F,[{key:"loadVideo",value:function(){var E=K()(we.a.mark(function k(){var w,_=this;return we.a.wrap(function(L){for(;;)switch(L.prev=L.next){case 0:return L.abrupt("return",new Promise(function(Y,ce){_.videoElt||ce(new Error("No video was passed to the constructor.")),_.video=document.createElement("video");var ve=navigator.userAgent;w=ve.indexOf("Firefox")>-1?_.videoElt.mozCaptureStream():_.videoElt.captureStream(),_.video.srcObject=w,_.size&&(_.video.width=_.size,_.video.height=_.size),_.video.autoplay=!0,_.video.playsinline=!0,_.video.muted=!0;var De=_.video.play();De!==void 0&&De.then(function(){_.videoReady=!0,Y(_.video)})}));case 1:case"end":return L.stop()}},k)}));return function(){return E.apply(this,arguments)}}()}]),F}(),ao=224,yo=[ao,ao],eo="https://storage.googleapis.com/tfjs-models/tfjs/mobilenet_v",bo={version:1,alpha:.25,topk:3,learningRate:1e-4,hiddenUnits:100,epochs:20,numLabels:2,batchSize:.4,layer:"conv_pw_13_relu"},Na={1:{.25:"https://tfhub.dev/google/imagenet/mobilenet_v1_025_224/classification/1",.5:"https://tfhub.dev/google/imagenet/mobilenet_v1_050_224/classification/1",.75:"https://tfhub.dev/google/imagenet/mobilenet_v1_075_224/classification/1",1:"https://tfhub.dev/google/imagenet/mobilenet_v1_100_224/classification/1"},2:{.5:"https://tfhub.dev/google/imagenet/mobilenet_v2_050_224/classification/2",.75:"https://tfhub.dev/google/imagenet/mobilenet_v2_075_224/classification/2",1:"https://tfhub.dev/google/imagenet/mobilenet_v2_100_224/classification/2"}},vs={1:"module_apply_default/MobilenetV1/Logits/global_pool",2:"module_apply_default/MobilenetV2/Logits/AvgPool"},Eh=function(){function F(E,k){pe()(this,F),this.mobilenet=null,this.topKPredictions=10,this.hasAnyTrainedClass=!1,this.customModel=null,this.jointModel=null,this.config={epochs:E.epochs||bo.epochs,version:E.version||bo.version,hiddenUnits:E.hiddenUnits||bo.hiddenUnits,numLabels:E.numLabels||bo.numLabels,learningRate:E.learningRate||bo.learningRate,batchSize:E.batchSize||bo.batchSize,layer:E.layer||bo.layer,alpha:E.alpha||bo.alpha},this.model=null,this.url=Na[this.config.version][this.config.alpha],this.normalizationOffset=I.scalar(127.5),this.mobilenetURL=E.mobilenetURL||"".concat(eo).concat(this.config.version,"_").concat(this.config.alpha,"_").concat(ao,"/model.json"),this.graphModelURL=E.graphModelURL||this.url,this.isPredicting=!1,this.mapStringToIndex=[],this.usageType=null,this.ready=ot(this.loadModel(),k)}return Te()(F,[{key:"loadModel",value:function(){var E=K()(we.a.mark(function k(){var w;return we.a.wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return _.next=2,I.loadLayersModel(this.mobilenetURL);case 2:if(this.mobilenet=_.sent,!this.graphModelURL.includes("https://tfhub.dev/")){_.next=9;break}return _.next=6,I.loadGraphModel(this.graphModelURL,{fromTFHub:!0});case 6:this.model=_.sent,_.next=12;break;case 9:return _.next=11,I.loadGraphModel(this.graphModelURL,{fromTFHub:!1});case 11:this.model=_.sent;case 12:return w=this.mobilenet.getLayer(this.config.layer),_.next=15,I.model({inputs:this.mobilenet.inputs,outputs:w.output});case 15:if(this.mobilenetFeatures=_.sent,!this.video){_.next=19;break}return _.next=19,this.mobilenetFeatures.predict($n(this.video,yo));case 19:return _.abrupt("return",this);case 20:case"end":return _.stop()}},k,this)}));return function(){return E.apply(this,arguments)}}()},{key:"classification",value:function(E){var k,w=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,_=arguments.length>2?arguments[2]:void 0;return this.usageType="classifier",ke()(w)==="object"?Object.assign(this.config,w):typeof w=="function"&&(k=w),typeof _=="function"&&(k=_),E&&ot(this.loadVideo(E),k),this}},{key:"regression",value:function(E,k){return this.usageType="regressor",E&&ot(this.loadVideo(E),k),this}},{key:"loadVideo",value:function(){var E=K()(we.a.mark(function k(w){var _,L;return we.a.wrap(function(Y){for(;;)switch(Y.prev=Y.next){case 0:if(_=null,w instanceof HTMLVideoElement?_=w:ke()(w)==="object"&&w.elt instanceof HTMLVideoElement&&(_=w.elt),!_){Y.next=7;break}return L=new Rr(_,ao),Y.next=6,L.loadVideo();case 6:this.video=Y.sent;case 7:return Y.abrupt("return",this);case 8:case"end":return Y.stop()}},k,this)}));return function(k){return E.apply(this,arguments)}}()},{key:"addImage",value:function(){var E=K()(we.a.mark(function k(w,_,L){var Y,ce,ve;return we.a.wrap(function(De){for(;;)switch(De.prev=De.next){case 0:return ve=L,w instanceof HTMLImageElement||w instanceof HTMLVideoElement||w instanceof HTMLCanvasElement||w.elt instanceof ImageData?Y=w:ke()(w)==="object"&&(w.elt instanceof HTMLImageElement||w.elt instanceof HTMLVideoElement||w.elt instanceof HTMLCanvasElement||w.elt instanceof ImageData)?Y=w.elt:typeof w!="string"&&typeof w!="number"||(Y=this.video,ce=w),typeof _=="string"||typeof _=="number"?ce=_:typeof _=="function"&&(ve=_),typeof ce=="string"&&(ce=this.mapStringToIndex.includes(ce)?this.mapStringToIndex.indexOf(ce):this.mapStringToIndex.push(ce)-1),De.abrupt("return",ot(this.addImageInternal(Y,ce),ve));case 5:case"end":return De.stop()}},k,this)}));return function(k,w,_){return E.apply(this,arguments)}}()},{key:"addImageInternal",value:function(){var E=K()(we.a.mark(function k(w,_){var L=this;return we.a.wrap(function(Y){for(;;)switch(Y.prev=Y.next){case 0:return Y.next=2,this.ready;case 2:return I.tidy(function(){var ce,ve=$n(w,yo),De=L.mobilenetFeatures.predict(ve);if(L.usageType==="classifier"?ce=I.tidy(function(){return I.oneHot(I.tensor1d([_],"int32"),L.config.numLabels)}):L.usageType==="regressor"&&(ce=I.tensor2d([[_]])),L.xs==null)L.xs=I.keep(De),L.ys=I.keep(ce),L.hasAnyTrainedClass=!0;else{var Ce=L.xs;L.xs=I.keep(Ce.concat(De,0));var Xe=L.ys;L.ys=I.keep(Xe.concat(ce,0)),Ce.dispose(),Xe.dispose(),ce.dispose()}}),Y.abrupt("return",this);case 4:case"end":return Y.stop()}},k,this)}));return function(k,w){return E.apply(this,arguments)}}()},{key:"train",value:function(){var E=K()(we.a.mark(function k(w){var _,L;return we.a.wrap(function(Y){for(;;)switch(Y.prev=Y.next){case 0:if(this.hasAnyTrainedClass){Y.next=2;break}throw new Error("Add some examples before training!");case 2:if(this.isPredicting=!1,this.usageType==="classifier"?(this.loss="categoricalCrossentropy",this.customModel=I.sequential({layers:[I.layers.flatten({inputShape:[7,7,256]}),I.layers.dense({units:this.config.hiddenUnits,activation:"relu",kernelInitializer:"varianceScaling",useBias:!0}),I.layers.dense({units:this.config.numLabels,kernelInitializer:"varianceScaling",useBias:!1,activation:"softmax"})]})):this.usageType==="regressor"&&(this.loss="meanSquaredError",this.customModel=I.sequential({layers:[I.layers.flatten({inputShape:[7,7,256]}),I.layers.dense({units:this.config.hiddenUnits,activation:"relu",kernelInitializer:"varianceScaling",useBias:!0}),I.layers.dense({units:1,useBias:!1,kernelInitializer:"Zeros",activation:"linear"})]})),this.jointModel=I.sequential(),this.jointModel.add(this.mobilenetFeatures),this.jointModel.add(this.customModel),_=I.train.adam(this.config.learningRate),this.customModel.compile({optimizer:_,loss:this.loss}),(L=Math.floor(this.xs.shape[0]*this.config.batchSize))>0){Y.next=12;break}throw new Error("Batch size is 0 or NaN. Please choose a non-zero fraction.");case 12:return Y.abrupt("return",this.customModel.fit(this.xs,this.ys,{batchSize:L,epochs:this.config.epochs,callbacks:{onBatchEnd:function(){var ce=K()(we.a.mark(function ve(De,Ce){return we.a.wrap(function(Xe){for(;;)switch(Xe.prev=Xe.next){case 0:return w(Ce.loss.toFixed(5)),Xe.next=3,I.nextFrame();case 3:case"end":return Xe.stop()}},ve)}));return function(ve,De){return ce.apply(this,arguments)}}(),onTrainEnd:function(){return w(null)}}}));case 13:case"end":return Y.stop()}},k,this)}));return function(k){return E.apply(this,arguments)}}()},{key:"classify",value:function(){var E=K()(we.a.mark(function k(w,_){var L,Y;return we.a.wrap(function(ce){for(;;)switch(ce.prev=ce.next){case 0:return w instanceof HTMLImageElement||w instanceof HTMLVideoElement||w instanceof HTMLCanvasElement||w instanceof ImageData?L=w:ke()(w)==="object"&&(w.elt instanceof HTMLImageElement||w.elt instanceof HTMLVideoElement||w.elt instanceof HTMLCanvasElement||w.elt instanceof ImageData)?L=w.elt:typeof w=="function"&&(L=this.video,Y=w),typeof _=="function"&&(Y=_),ce.abrupt("return",ot(this.classifyInternal(L),Y));case 3:case"end":return ce.stop()}},k,this)}));return function(k,w){return E.apply(this,arguments)}}()},{key:"classifyInternal",value:function(){var E=K()(we.a.mark(function k(w){var _,L,Y=this;return we.a.wrap(function(ce){for(;;)switch(ce.prev=ce.next){case 0:if(this.usageType==="classifier"){ce.next=2;break}throw new Error("Mobilenet Feature Extraction has not been set to be a classifier.");case 2:return ce.next=4,I.nextFrame();case 4:return this.isPredicting=!0,_=I.tidy(function(){var ve=$n(w,yo),De=Y.jointModel.predict(ve);return Array.from(De.as1D().dataSync())}),ce.next=8,_.map(function(ve,De){return{label:Y.mapStringToIndex.length>0&&Y.mapStringToIndex[De]?Y.mapStringToIndex[De]:De,confidence:ve}}).sort(function(ve,De){return De.confidence-ve.confidence});case 8:return L=ce.sent,ce.abrupt("return",L);case 10:case"end":return ce.stop()}},k,this)}));return function(k){return E.apply(this,arguments)}}()},{key:"predict",value:function(){var E=K()(we.a.mark(function k(w,_){var L,Y;return we.a.wrap(function(ce){for(;;)switch(ce.prev=ce.next){case 0:return w instanceof HTMLImageElement||w instanceof HTMLVideoElement||w instanceof HTMLCanvasElement||w instanceof ImageData?L=w:ke()(w)==="object"&&(w.elt instanceof HTMLImageElement||w.elt instanceof HTMLVideoElement||w.elt instanceof HTMLCanvasElement||w.elt instanceof ImageData)?L=w.elt:typeof w=="function"&&(L=this.video,Y=w),typeof _=="function"&&(Y=_),ce.abrupt("return",ot(this.predictInternal(L),Y));case 3:case"end":return ce.stop()}},k,this)}));return function(k,w){return E.apply(this,arguments)}}()},{key:"predictInternal",value:function(){var E=K()(we.a.mark(function k(w){var _,L,Y=this;return we.a.wrap(function(ce){for(;;)switch(ce.prev=ce.next){case 0:if(this.usageType==="regressor"){ce.next=2;break}throw new Error("Mobilenet Feature Extraction has not been set to be a regressor.");case 2:return ce.next=4,I.nextFrame();case 4:return this.isPredicting=!0,_=I.tidy(function(){var ve=$n(w,yo);return Y.jointModel.predict(ve).as1D()}),ce.next=8,_.data();case 8:return L=ce.sent,_.dispose(),ce.abrupt("return",{value:L[0]});case 11:case"end":return ce.stop()}},k,this)}));return function(k){return E.apply(this,arguments)}}()},{key:"load",value:function(){var E=K()(we.a.mark(function k(){var w,_,L,Y,ce,ve,De=this,Ce=arguments;return we.a.wrap(function(Xe){for(;;)switch(Xe.prev=Xe.next){case 0:if(w=Ce.length>0&&Ce[0]!==void 0?Ce[0]:null,_=Ce.length>1?Ce[1]:void 0,typeof w=="string"){Xe.next=11;break}return L=null,Y=null,Array.from(w).forEach(function(nt){if(nt.name.includes(".json")){L=nt;var Et=new FileReader;Et.onload=function(At){JSON.parse(At.target.result).ml5Specs&&(De.mapStringToIndex=JSON.parse(At.target.result).ml5Specs.mapStringToIndex)},Et.readAsText(nt)}else nt.name.includes(".bin")&&(Y=nt)}),Xe.next=8,I.loadLayersModel(I.io.browserFiles([L,Y]));case 8:this.jointModel=Xe.sent,Xe.next=20;break;case 11:return Xe.next=13,Gt.a.get(w);case 13:return ce=Xe.sent,(ve=ce.data).ml5Specs&&(this.mapStringToIndex=ve.ml5Specs.mapStringToIndex),Xe.next=18,I.loadLayersModel(w);case 18:this.jointModel=Xe.sent,_&&_();case 20:return Xe.abrupt("return",this.jointModel);case 21:case"end":return Xe.stop()}},k,this)}));return function(){return E.apply(this,arguments)}}()},{key:"save",value:function(){var E=K()(we.a.mark(function k(w,_){var L=this;return we.a.wrap(function(Y){for(;;)switch(Y.prev=Y.next){case 0:if(this.jointModel){Y.next=2;break}throw new Error("No model found.");case 2:this.jointModel.save(I.io.withSaveHandler(function(){var ce=K()(we.a.mark(function ve(De){var Ce;return we.a.wrap(function(Xe){for(;;)switch(Xe.prev=Xe.next){case 0:return Ce="model",_&&(Ce=_),L.weightsManifest={modelTopology:De.modelTopology,weightsManifest:[{paths:["./".concat(Ce,".weights.bin")],weights:De.weightSpecs}],ml5Specs:{mapStringToIndex:L.mapStringToIndex}},Xe.next=5,jr(De.weightData,"".concat(Ce,".weights.bin"),"application/octet-stream");case 5:return Xe.next=7,jr(JSON.stringify(L.weightsManifest),"".concat(Ce,".json"),"text/plain");case 7:w&&w();case 8:case"end":return Xe.stop()}},ve)}));return function(ve){return ce.apply(this,arguments)}}()));case 3:case"end":return Y.stop()}},k,this)}));return function(k,w){return E.apply(this,arguments)}}()},{key:"mobilenetInfer",value:function(E){var k=this,w=arguments.length>1&&arguments[1]!==void 0&&arguments[1],_=E;return _ instanceof I.Tensor||_ instanceof ImageData||_ instanceof HTMLImageElement||_ instanceof HTMLCanvasElement||_ instanceof HTMLVideoElement?I.tidy(function(){_ instanceof I.Tensor||(_=I.browser.fromPixels(_));var L=_.toFloat().sub(k.normalizationOffset).div(k.normalizationOffset),Y=L;(_.shape[0]!==ao||_.shape[1]!==ao)&&(Y=I.image.resizeBilinear(L,yo,!0));var ce,ve=Y.reshape([-1,ao,ao,3]);if(w){var De=vs[k.config.version];ce=k.model.execute(ve,De).squeeze([1,2])}else ce=k.model.predict(ve).slice([0,1],[-1,1e3]);return ce}):null}},{key:"infer",value:function(E,k){var w,_;if(E instanceof HTMLImageElement||E instanceof HTMLVideoElement||E instanceof HTMLCanvasElement||E instanceof ImageData)w=E;else{if(ke()(E)!=="object"||!(E.elt instanceof HTMLImageElement||E.elt instanceof HTMLVideoElement||E.elt instanceof HTMLCanvasElement||E.elt instanceof ImageData))throw new Error("No input image found.");w=E.elt}return _=k&&typeof k=="string"?k:"conv_preds",this.mobilenetInfer(w,_)}}]),F}(),qi=function(F,E,k){var w;if(typeof F!="string")throw new Error('Please specify a model to use. E.g: "MobileNet"');w=F.toLowerCase();var _={},L=k;if(ke()(E)==="object"?_=E:typeof E=="function"&&(L=E),w==="mobilenet")return new Eh(_,L);throw new Error("".concat(w," is not a valid model."))},ec=function(){console.log("%cword2vec has been disabled","color: #A155FF; font-size: 16px"),console.log("We've intentionally disabled the word2vec function after recognizing it has the potential to produce harmful outputs while using the model files included in our examples. We'll consider reenabling the word2vec function along with changes to address these issues in a future release of ml5.js. You can find further updates about this topic on our Twitter account (https://twitter.com/ml5js/status/1445762321444315147) and GitHub (https://github.com/ml5js/ml5-library/issues/1238).")},bu=a(58),bc=a.n(bu),Bu=a(57),xc=a.n(Bu),Dd=a(35),as=a.n(Dd),vf=["person","bicycle","car","motorbike","aeroplane","bus","train","truck","boat","traffic light","fire hydrant","stop sign","parking meter","bench","bird","cat","dog","horse","sheep","cow","elephant","bear","zebra","giraffe","backpack","umbrella","handbag","tie","suitcase","frisbee","skis","snowboard","sports ball","kite","baseball bat","baseball glove","skateboard","surfboard","tennis racket","bottle","wine glass","cup","fork","knife","spoon","bowl","banana","apple","sandwich","orange","broccoli","carrot","hot dog","pizza","donut","cake","chair","sofa","pottedplant","bed","diningtable","toilet","tvmonitor","laptop","mouse","remote","keyboard","cell phone","microwave","oven","toaster","sink","refrigerator","book","clock","vase","scissors","teddy bear","hair drier","toothbrush"];function Td(F){return new RegExp("^(?:[a-z]+:)?//","i").test(F)}var Pu={isAbsoluteURL:Td,getModelPath:function(F){return Td(F)||typeof window>"u"?F:window.location.pathname+F}},yf=function(F,E){var k=Math.min(F[3],E[3])-Math.max(F[1],E[1]),w=Math.min(F[2],E[2])-Math.max(F[0],E[0]);return k<0||w<0?0:k*w},Ch=function(F,E){return yf(F,E)/function(k,w){var _=yf(k,w);return(k[3]-k[1])*(k[2]-k[0])+(w[3]-w[1])*(w[2]-w[0])-_}(F,E)};function wc(F,E,k,w){return El.apply(this,arguments)}function El(){return(El=K()(we.a.mark(function F(E,k,w,_){return we.a.wrap(function(L){for(;;)switch(L.prev=L.next){case 0:return L.abrupt("return",I.tidy(function(){for(var Y=I.mul(k,w),ce=I.argMax(Y,-1),ve=I.max(Y,-1),De=I.greaterEqual(ve,I.scalar(_)).dataSync(),Ce=[],Xe=0;Xe<De.length;Xe+=1)De[Xe]&&Ce.push(Xe);if(Ce.length===0)return[null,null,null];var nt=I.tensor1d(Ce,"int32");return[I.gather(E.reshape([De.length,4]),nt),I.gather(ve.flatten(),nt),I.gather(ce.flatten(),nt)]}));case 1:case"end":return L.stop()}},F)}))).apply(this,arguments)}var Fa=function(F,E){return I.tidy(function(){var k=I.tensor1d([2]),w=I.sub(F,I.div(E,k)),_=I.add(F,I.div(E,k)),L=[w.shape[0],w.shape[1],w.shape[2],1];return I.concat([w.slice([0,0,0,1],L),w.slice([0,0,0,0],L),_.slice([0,0,0,1],L),_.slice([0,0,0,0],L)],3)})},Vc=function(F,E,k){return I.tidy(function(){for(var w=[],_=0;_<E.length;_+=1)w.push([E[_],[F[4*_],F[4*_+1],F[4*_+2],F[4*_+3]],_]);var L=[];return w.sort(function(Y,ce){return ce[0]-Y[0]}).forEach(function(Y){for(var ce=!0,ve=0;ve<L.length;ve+=1)if(Ch(Y[1],L[ve][1])>k){ce=!1;break}ce&&L.push(Y)}),[L.map(function(Y){return Y[2]}),L.map(function(Y){return Y[1]}),L.map(function(Y){return Y[0]})]})};function ua(F,E,k){return I.tidy(function(){var w=E.shape[0],_=I.reshape(E,[1,1,w,2]),L=F.shape.slice(1,3),Y=L[0],ce=L[1],ve=I.range(0,L[0]),De=I.range(0,L[1]);ve=I.tile(ve,[L[1]]),De=I.tile(I.expandDims(De,0),[L[0],1]),De=I.transpose(De).flatten();var Ce=I.transpose(I.stack([ve,De]));Ce=I.reshape(Ce,[L[0],L[1],1,2]),Ce=I.cast(Ce,F.dtype),F=I.reshape(F,[L[0],L[1],w,k+5]),L=I.cast(I.reshape(I.tensor1d(L),[1,1,1,2]),F.dtype);var Xe=I.sigmoid(F.slice([0,0,0,0],[Y,ce,w,2])),nt=I.exp(F.slice([0,0,0,2],[Y,ce,w,2])),Et=I.sigmoid(F.slice([0,0,0,4],[Y,ce,w,1])),At=I.softmax(F.slice([0,0,0,5],[Y,ce,w,k]));return[Xe=I.div(I.add(Xe,Ce),L),nt=I.div(I.mul(nt,_),L),Et,At]})}function tc(F){var E=function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}();return function(){var k,w=as()(F);if(E){var _=as()(this).constructor;k=Reflect.construct(w,arguments,_)}else k=w.apply(this,arguments);return xc()(this,k)}}var ss={modelUrl:"https://raw.githubusercontent.com/ml5js/ml5-data-and-training/master/models/YOLO/model.json",filterBoxesThreshold:.01,IOUThreshold:.4,classProbThreshold:.4},Ca=416,nc=function(F){bc()(k,F);var E=tc(k);function k(w,_,L){var Y;return pe()(this,k),(Y=E.call(this,w,Ca)).modelUrl=_.modelUrl||ss.modelUrl,Y.filterBoxesThreshold=_.filterBoxesThreshold||ss.filterBoxesThreshold,Y.IOUThreshold=_.IOUThreshold||ss.IOUThreshold,Y.classProbThreshold=_.classProbThreshold||ss.classProbThreshold,Y.modelReady=!1,Y.isPredicting=!1,Y.callback=L,Y.ready=ot(Y.loadModel(),Y.callback),_.disableDeprecationNotice||console.warn("WARNING! Function YOLO has been deprecated, please use the new ObjectDetector function instead"),Y}return Te()(k,[{key:"loadModel",value:function(){var w=K()(we.a.mark(function _(){var L;return we.a.wrap(function(Y){for(;;)switch(Y.prev=Y.next){case 0:if(!this.videoElt||this.video){Y.next=4;break}return Y.next=3,this.loadVideo();case 3:this.video=Y.sent;case 4:if(Pu.isAbsoluteURL(this.modelUrl)!==!0){Y.next=10;break}return Y.next=7,I.loadLayersModel(this.modelUrl);case 7:this.model=Y.sent,Y.next=15;break;case 10:return L=Pu.getModelPath(this.modelUrl),this.modelUrl="".concat(L,"/model.json"),Y.next=14,I.loadLayersModel(this.modelUrl);case 14:this.model=Y.sent;case 15:return this.modelReady=!0,Y.abrupt("return",this);case 17:case"end":return Y.stop()}},_,this)}));return function(){return w.apply(this,arguments)}}()},{key:"detect",value:function(){var w=K()(we.a.mark(function _(L,Y){var ce,ve;return we.a.wrap(function(De){for(;;)switch(De.prev=De.next){case 0:return De.next=2,this.ready;case 2:if(ve=Y,!Dn(L)){De.next=7;break}ce=L,De.next=21;break;case 7:if(ke()(L)!=="object"||!Dn(L.elt)){De.next=11;break}ce=L.elt,De.next=21;break;case 11:if(ke()(L)!=="object"||!Dn(L.canvas)){De.next=15;break}ce=L.canvas,De.next=21;break;case 15:if(typeof L!="function"){De.next=20;break}ce=this.video,ve=L,De.next=21;break;case 20:throw new Error("Detection subject not supported");case 21:return De.abrupt("return",ot(this.detectInternal(ce),ve));case 22:case"end":return De.stop()}},_,this)}));return function(_,L){return w.apply(this,arguments)}}()},{key:"detectInternal",value:function(){var w=K()(we.a.mark(function _(L){var Y,ce,ve,De,Ce,Xe,nt,Et,At,rn,un,kn=this;return we.a.wrap(function(En){for(;;)switch(En.prev=En.next){case 0:return En.next=2,this.ready;case 2:return En.next=4,I.nextFrame();case 4:return Y=I.tensor2d([[.57273,.677385],[1.87446,2.06253],[3.33843,5.47434],[7.88282,3.52778],[9.77052,9.16828]]),this.isPredicting=!0,ce=I.tidy(function(){var _n=$n(L,[Ca,Ca]),Pn=ua(kn.model.predict(_n),Y,80),dn=Tn()(Pn,4),cr=dn[0],yr=dn[1],br=dn[2],Br=dn[3];return[Fa(cr,yr),br,Br]}),ve=Tn()(ce,3),De=ve[0],Ce=ve[1],Xe=ve[2],En.next=9,wc(De,Ce,Xe,this.filterBoxesThreshold);case 9:if(nt=En.sent,Et=Tn()(nt,3),At=Et[0],rn=Et[1],un=Et[2],De.dispose(),Ce.dispose(),Xe.dispose(),At!=null){En.next=19;break}return En.abrupt("return",[]);case 19:return En.abrupt("return",I.tidy(function(){var _n=I.scalar(Ca),Pn=I.scalar(Ca),dn=I.stack([Pn,_n,Pn,_n]).reshape([1,4]),cr=I.mul(At,dn),yr=cr.dataSync(),br=rn.dataSync(),Br=Vc(yr,br,kn.IOUThreshold),Or=Tn()(Br,3),hi=Or[0],ki=Or[1],xi=Or[2],xo=[];return un.gather(I.tensor1d(hi,"int32")).dataSync().forEach(function(Wo,To){var Do=xi[To];if(!(Do<kn.classProbThreshold)){var Mo=vf[Wo],ea=Tn()(ki[To],4),sa=ea[0],ka=ea[1],Ys=ea[2],Ci=ea[3];sa=Math.max(0,sa),ka=Math.max(0,ka),Ys=Math.min(Ca,Ys)-sa;var Va={label:Mo,confidence:Do,x:ka,y:sa,width:Ci=Math.min(Ca,Ci)-ka,height:Ys,normalized:{x:ka/Ca,y:sa/Ca,width:Ci/Ca,height:Ys/Ca}};xo.push(Va)}}),kn.isPredicting=!1,_n.dispose(),Pn.dispose(),dn.dispose(),cr.dispose(),At.dispose(),rn.dispose(),un.dispose(),Y.dispose(),xo}));case 20:case"end":return En.stop()}},_,this)}));return function(_){return w.apply(this,arguments)}}()}]),k}(Rr),Cl=function(F,E,k){var w=null,_={},L=k;return F instanceof HTMLVideoElement?w=F:ke()(F)==="object"&&F.elt instanceof HTMLVideoElement?w=F.elt:typeof F=="function"?L=F:ke()(F)==="object"&&(_=F),ke()(E)==="object"?_=E:typeof E=="function"&&(L=E),new nc(w,_,L)},rc=a(242),cu={base:"lite_mobilenet_v2",modelUrl:void 0},Oh=function(){function F(E,k,w){pe()(this,F),this.video=E||null,this.modelReady=!1,this.isPredicting=!1,this.config={base:k.base||cu.base,modelUrl:k.modelUrl||cu.modelUrl},this.callback=w,this.ready=ot(this.loadModel(),this.callback)}return Te()(F,[{key:"loadModel",value:function(){var E=K()(we.a.mark(function k(){return we.a.wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return w.next=2,rc.load(this.config);case 2:return this.model=w.sent,this.modelReady=!0,w.abrupt("return",this);case 5:case"end":return w.stop()}},k,this)}));return function(){return E.apply(this,arguments)}}()},{key:"detectInternal",value:function(){var E=K()(we.a.mark(function k(w){var _,L;return we.a.wrap(function(Y){for(;;)switch(Y.prev=Y.next){case 0:return this.isPredicting=!0,Y.next=3,this.model.detect(w);case 3:return _=Y.sent,L=_.map(function(ce){return{label:ce.class,confidence:ce.score,x:ce.bbox[0],y:ce.bbox[1],width:ce.bbox[2],height:ce.bbox[3],normalized:{x:ce.bbox[0]/w.width,y:ce.bbox[1]/w.height,width:ce.bbox[2]/w.width,height:ce.bbox[3]/w.height}}}),this.isPredicting=!1,Y.abrupt("return",L);case 7:case"end":return Y.stop()}},k,this)}));return function(k){return E.apply(this,arguments)}}()},{key:"detect",value:function(){var E=K()(we.a.mark(function k(w,_){var L,Y;return we.a.wrap(function(ce){for(;;)switch(ce.prev=ce.next){case 0:return ce.next=2,this.ready;case 2:return ce.next=4,I.nextFrame();case 4:if(Y=_,!Dn(w)){ce.next=9;break}L=w,ce.next=23;break;case 9:if(ke()(w)!=="object"||!Dn(w.elt)){ce.next=13;break}L=w.elt,ce.next=23;break;case 13:if(ke()(w)!=="object"||!Dn(w.canvas)){ce.next=17;break}L=w.canvas,ce.next=23;break;case 17:if(typeof w!="function"){ce.next=22;break}L=this.video,Y=w,ce.next=23;break;case 22:throw new Error("Detection subject not supported");case 23:return ce.abrupt("return",ot(this.detectInternal(L),Y));case 24:case"end":return ce.stop()}},k,this)}));return function(k,w){return E.apply(this,arguments)}}()}]),F}(),bf=function(F,E,k){var w=null,_={},L=k;return F instanceof HTMLVideoElement?w=F:ke()(F)==="object"&&F.elt instanceof HTMLVideoElement?w=F.elt:typeof F=="function"?L=F:ke()(F)==="object"&&(_=F),ke()(E)==="object"?_=E:typeof E=="function"&&(L=E),new Oh(w,_,L)};function xf(F,E){var k=Object.keys(F);if(Object.getOwnPropertySymbols){var w=Object.getOwnPropertySymbols(F);E&&(w=w.filter(function(_){return Object.getOwnPropertyDescriptor(F,_).enumerable})),k.push.apply(k,w)}return k}var fa=Te()(function F(E,k,w,_){switch(pe()(this,F),this.video=k,this.modelNameOrUrl=E,this.options=w||{},this.callback=_,E){case"yolo":return this.model=new Cl(this.video,function(L){for(var Y=1;Y<arguments.length;Y++){var ce=arguments[Y]!=null?arguments[Y]:{};Y%2?xf(Object(ce),!0).forEach(function(ve){ee()(L,ve,ce[ve])}):Object.getOwnPropertyDescriptors?Object.defineProperties(L,Object.getOwnPropertyDescriptors(ce)):xf(Object(ce)).forEach(function(ve){Object.defineProperty(L,ve,Object.getOwnPropertyDescriptor(ce,ve))})}return L}({disableDeprecationNotice:!0},this.options),_),this;case"cocossd":default:return this.model=new bf(this.video,this.options,_),this}}),Ah=function(F,E,k,w){var _,L={},Y=w,ce=F;if(typeof ce!="string")throw new Error('Please specify a model to use. E.g: "YOLO"');ce.indexOf("http")===-1&&(ce=F.toLowerCase()),E instanceof HTMLVideoElement?_=E:ke()(E)==="object"&&E.elt instanceof HTMLVideoElement?_=E.elt:ke()(E)==="object"?L=E:typeof E=="function"&&(Y=E),ke()(k)==="object"?L=k:typeof k=="function"&&(Y=k);var ve=new fa(ce,_,L,Y);return ve.model.callback?ve.model:ve.model.ready},Nd=a(99),wf=a.n(Nd),kf=function(F,E){return(kf=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(k,w){k.__proto__=w}||function(k,w){for(var _ in w)w.hasOwnProperty(_)&&(k[_]=w[_])})(F,E)};function ys(F,E){function k(){this.constructor=F}kf(F,E),F.prototype=E===null?Object.create(E):(k.prototype=E.prototype,new k)}var Ef=function(){return(Ef=Object.assign||function(F){for(var E,k=1,w=arguments.length;k<w;k++)for(var _ in E=arguments[k])Object.prototype.hasOwnProperty.call(E,_)&&(F[_]=E[_]);return F}).apply(this,arguments)};function ar(F,E,k,w){return new(k||(k=Promise))(function(_,L){function Y(De){try{ve(w.next(De))}catch(Ce){L(Ce)}}function ce(De){try{ve(w.throw(De))}catch(Ce){L(Ce)}}function ve(De){De.done?_(De.value):new k(function(Ce){Ce(De.value)}).then(Y,ce)}ve((w=w.apply(F,E||[])).next())})}function xu(F,E){var k,w,_,L,Y={label:0,sent:function(){if(1&_[0])throw _[1];return _[1]},trys:[],ops:[]};return L={next:ce(0),throw:ce(1),return:ce(2)},typeof Symbol=="function"&&(L[Symbol.iterator]=function(){return this}),L;function ce(ve){return function(De){return function(Ce){if(k)throw new TypeError("Generator is already executing.");for(;Y;)try{if(k=1,w&&(_=2&Ce[0]?w.return:Ce[0]?w.throw||((_=w.return)&&_.call(w),0):w.next)&&!(_=_.call(w,Ce[1])).done)return _;switch(w=0,_&&(Ce=[2&Ce[0],_.value]),Ce[0]){case 0:case 1:_=Ce;break;case 4:return Y.label++,{value:Ce[1],done:!1};case 5:Y.label++,w=Ce[1],Ce=[0];continue;case 7:Ce=Y.ops.pop(),Y.trys.pop();continue;default:if(!(_=(_=Y.trys).length>0&&_[_.length-1])&&(Ce[0]===6||Ce[0]===2)){Y=0;continue}if(Ce[0]===3&&(!_||Ce[1]>_[0]&&Ce[1]<_[3])){Y.label=Ce[1];break}if(Ce[0]===6&&Y.label<_[1]){Y.label=_[1],_=Ce;break}if(_&&Y.label<_[2]){Y.label=_[2],Y.ops.push(Ce);break}_[2]&&Y.ops.pop(),Y.trys.pop();continue}Ce=E.call(F,Y)}catch(Xe){Ce=[6,Xe],w=0}finally{k=_=0}if(5&Ce[0])throw Ce[1];return{value:Ce[0]?Ce[1]:void 0,done:!0}}([ve,De])}}}var Tp=function(){function F(E,k){this.model=E,this.outputStride=k;var w=this.model.inputs[0].shape;Ye.util.assert(w[1]===-1&&w[2]===-1,function(){return"Input shape ["+w[1]+", "+w[2]+"] must both be equal to or -1"})}return F.prototype.predict=function(E){var k=this;return Object(Ye.tidy)(function(){var w=k.preprocessInput(Object(Ye.cast)(E,"float32")),_=Object(Ye.expandDims)(w,0),L=k.model.predict(_).map(function(ce){return Object(Ye.squeeze)(ce,[0])}),Y=k.nameOutputResults(L);return{heatmapScores:Object(Ye.sigmoid)(Y.heatmap),offsets:Y.offsets,displacementFwd:Y.displacementFwd,displacementBwd:Y.displacementBwd}})},F.prototype.dispose=function(){this.model.dispose()},F}(),Np=function(F){function E(){return F!==null&&F.apply(this,arguments)||this}return ys(E,F),E.prototype.preprocessInput=function(k){return Object(Ye.tidy)(function(){return Object(Ye.sub)(Object(Ye.div)(k,127.5),1)})},E.prototype.nameOutputResults=function(k){return{offsets:k[0],heatmap:k[1],displacementFwd:k[2],displacementBwd:k[3]}},E}(Tp);function Cf(F){return Math.floor(F/2)}var Ol=function(){function F(E,k){this.priorityQueue=new Array(E),this.numberOfElements=-1,this.getElementValue=k}return F.prototype.enqueue=function(E){this.priorityQueue[++this.numberOfElements]=E,this.swim(this.numberOfElements)},F.prototype.dequeue=function(){var E=this.priorityQueue[0];return this.exchange(0,this.numberOfElements--),this.sink(0),this.priorityQueue[this.numberOfElements+1]=null,E},F.prototype.empty=function(){return this.numberOfElements===-1},F.prototype.size=function(){return this.numberOfElements+1},F.prototype.all=function(){return this.priorityQueue.slice(0,this.numberOfElements+1)},F.prototype.max=function(){return this.priorityQueue[0]},F.prototype.swim=function(E){for(;E>0&&this.less(Cf(E),E);)this.exchange(E,Cf(E)),E=Cf(E)},F.prototype.sink=function(E){for(;2*E<=this.numberOfElements;){var k=2*E;if(k<this.numberOfElements&&this.less(k,k+1)&&k++,!this.less(E,k))break;this.exchange(E,k),E=k}},F.prototype.getValueAt=function(E){return this.getElementValue(this.priorityQueue[E])},F.prototype.less=function(E,k){return this.getValueAt(E)<this.getValueAt(k)},F.prototype.exchange=function(E,k){var w=this.priorityQueue[E];this.priorityQueue[E]=this.priorityQueue[k],this.priorityQueue[k]=w},F}();function Fd(F,E,k,w,_,L){for(var Y=L.shape,ce=Y[0],ve=Y[1],De=!0,Ce=Math.max(k-_,0),Xe=Math.min(k+_+1,ce),nt=Ce;nt<Xe;++nt){for(var Et=Math.max(w-_,0),At=Math.min(w+_+1,ve),rn=Et;rn<At;++rn)if(L.get(nt,rn,F)>E){De=!1;break}if(!De)break}return De}var Sh=["nose","leftEye","rightEye","leftEar","rightEar","leftShoulder","rightShoulder","leftElbow","rightElbow","leftWrist","rightWrist","leftHip","rightHip","leftKnee","rightKnee","leftAnkle","rightAnkle"],_h=Sh.length,Ii=Sh.reduce(function(F,E,k){return F[E]=k,F},{}),No=[["leftHip","leftShoulder"],["leftElbow","leftShoulder"],["leftElbow","leftWrist"],["leftHip","leftKnee"],["leftKnee","leftAnkle"],["rightHip","rightShoulder"],["rightElbow","rightShoulder"],["rightElbow","rightWrist"],["rightHip","rightKnee"],["rightKnee","rightAnkle"],["leftShoulder","rightShoulder"],["leftHip","rightHip"]].map(function(F){var E=F[0],k=F[1];return[Ii[E],Ii[k]]});function Dh(F,E,k,w){return{y:w.get(F,E,k),x:w.get(F,E,k+_h)}}function bm(F,E,k){var w=Dh(F.heatmapY,F.heatmapX,F.id,k),_=w.y,L=w.x;return{x:F.heatmapX*E+L,y:F.heatmapY*E+_}}function Of(F,E,k){return F<E?E:F>k?k:F}function Id(F,E){return{x:F.x+E.x,y:F.y+E.y}}var bs=[["nose","leftEye"],["leftEye","leftEar"],["nose","rightEye"],["rightEye","rightEar"],["nose","leftShoulder"],["leftShoulder","leftElbow"],["leftElbow","leftWrist"],["leftShoulder","leftHip"],["leftHip","leftKnee"],["leftKnee","leftAnkle"],["nose","rightShoulder"],["rightShoulder","rightElbow"],["rightElbow","rightWrist"],["rightShoulder","rightHip"],["rightHip","rightKnee"],["rightKnee","rightAnkle"]].map(function(F){var E=F[0],k=F[1];return[Ii[E],Ii[k]]}),ic=bs.map(function(F){return F[1]}),Rd=bs.map(function(F){return F[0]});function Fp(F,E,k,w){return{y:Of(Math.round(F.y/E),0,k-1),x:Of(Math.round(F.x/E),0,w-1)}}function Ip(F,E,k,w,_,L,Y,ce){ce===void 0&&(ce=2);for(var ve=w.shape,De=ve[0],Ce=ve[1],Xe=function(En,_n,Pn){var dn=Pn.shape[2]/2;return{y:Pn.get(_n.y,_n.x,En),x:Pn.get(_n.y,_n.x,dn+En)}}(F,Fp(E.position,L,De,Ce),Y),nt=Id(E.position,Xe),Et=0;Et<ce;Et++){var At=Fp(nt,L,De,Ce),rn=Dh(At.y,At.x,k,_);nt=Id({x:At.x*L,y:At.y*L},{x:rn.x,y:rn.y})}var un=Fp(nt,L,De,Ce),kn=w.get(un.y,un.x,k);return{position:nt,part:Sh[k],score:kn}}function xm(F,E,k,w,_,L){var Y=E.shape[2],ce=ic.length,ve=new Array(Y),De=F.part,Ce=F.score,Xe=bm(De,w,k);ve[De.id]={score:Ce,part:Sh[De.id],position:Xe};for(var nt=ce-1;nt>=0;--nt){var Et=ic[nt],At=Rd[nt];ve[Et]&&!ve[At]&&(ve[At]=Ip(nt,ve[Et],At,E,k,w,L))}for(nt=0;nt<ce;++nt)Et=Rd[nt],At=ic[nt],ve[Et]&&!ve[At]&&(ve[At]=Ip(nt,ve[Et],At,E,k,w,_));return ve}function wm(F,E,k,w){var _=k.x,L=k.y;return F.some(function(Y){var ce=Y.keypoints[w].position;return function(ve,De,Ce,Xe){var nt=Ce-ve,Et=Xe-De;return nt*nt+Et*Et}(L,_,ce.y,ce.x)<=E})}function qc(F,E,k){return k.reduce(function(w,_,L){var Y=_.position,ce=_.score;return wm(F,E,Y,L)||(w+=ce),w},0)/k.length}var za=1;function Th(F,E,k,w,_,L,Y,ce){Y===void 0&&(Y=.5),ce===void 0&&(ce=20);for(var ve=[],De=function(At,rn,un){for(var kn=un.shape,En=kn[0],_n=kn[1],Pn=kn[2],dn=new Ol(En*_n*Pn,function(Or){return Or.score}),cr=0;cr<En;++cr)for(var yr=0;yr<_n;++yr)for(var br=0;br<Pn;++br){var Br=un.get(cr,yr,br);Br<At||Fd(br,Br,cr,yr,rn,un)&&dn.enqueue({score:Br,part:{heatmapY:cr,heatmapX:yr,id:br}})}return dn}(Y,za,F),Ce=ce*ce;ve.length<L&&!De.empty();){var Xe=De.dequeue();if(!wm(ve,Ce,bm(Xe.part,_,E),Xe.part.id)){var nt=xm(Xe,F,E,_,k,w),Et=qc(ve,Ce,nt);ve.push({keypoints:nt,score:Et})}}return ve}function Ke(F){var E=F.shape,k=E[0],w=E[1],_=E[2];return Object(Ye.tidy)(function(){var L=Object(Ye.reshape)(F,[k*w,_]),Y=Object(Ye.argMax)(L,0),ce=Object(Ye.expandDims)(Object(Ye.div)(Y,Object(Ye.scalar)(w,"int32")),1),ve=Object(Ye.expandDims)(function(De,Ce){return Object(Ye.tidy)(function(){var Xe=Object(Ye.div)(De,Object(Ye.scalar)(Ce,"int32"));return Object(Ye.sub)(De,Object(Ye.mul)(Xe,Object(Ye.scalar)(Ce,"int32")))})}(Y,w),1);return Object(Ye.concat)([ce,ve],1)})}function Lu(F,E,k,w){return{y:w.get(F,E,k),x:w.get(F,E,k+_h)}}function Af(F,E,k){return Object(Ye.tidy)(function(){var w=function(_,L){for(var Y=[],ce=0;ce<_h;ce++){var ve=Lu(_.get(ce,0).valueOf(),_.get(ce,1).valueOf(),ce,L),De=ve.x,Ce=ve.y;Y.push(Ce),Y.push(De)}return Object(Ye.tensor2d)(Y,[_h,2])}(F,k);return Object(Ye.add)(Object(Ye.cast)(Object(Ye.mul)(F.toTensor(),Object(Ye.scalar)(E,"int32")),"float32"),w)})}function Md(F,E,k){return ar(this,void 0,void 0,function(){var w,_,L,Y,ce,ve,De,Ce,Xe,nt;return xu(this,function(Et){switch(Et.label){case 0:return w=0,_=Ke(F),[4,Promise.all([F.buffer(),E.buffer(),_.buffer()])];case 1:return L=Et.sent(),Y=L[0],ce=L[1],ve=L[2],[4,(De=Af(ve,k,ce)).buffer()];case 2:return Ce=Et.sent(),Xe=Array.from(function(At,rn){for(var un=rn.shape[0],kn=new Float32Array(un),En=0;En<un;En++){var _n=rn.get(En,0),Pn=rn.get(En,1);kn[En]=At.get(_n,Pn,En)}return kn}(Y,ve)),nt=Xe.map(function(At,rn){return w+=At,{position:{y:Ce.get(rn,0),x:Ce.get(rn,1)},part:Sh[rn],score:At}}),_.dispose(),De.dispose(),[2,{keypoints:nt,score:w/nt.length}]}})})}var So="https://storage.googleapis.com/tfjs-models/savedmodel/posenet/mobilenet/",_o="https://storage.googleapis.com/tfjs-models/savedmodel/posenet/resnet50/",Ko=[-123.15,-115.9,-103.06],Oa=function(F){function E(){return F!==null&&F.apply(this,arguments)||this}return ys(E,F),E.prototype.preprocessInput=function(k){return Object(Ye.add)(k,Ko)},E.prototype.nameOutputResults=function(k){var w=k[0],_=k[1];return{offsets:k[2],heatmap:k[3],displacementFwd:w,displacementBwd:_}},E}(Tp);function wu(F,E){return wt(F,E)?F:Math.floor(F/E)*E+1}function Aa(F){Ye.util.assert(typeof F=="number"||typeof F=="object",function(){return"Invalid inputResolution "+F+". Should be a number or an object with width and height"}),typeof F=="object"&&(Ye.util.assert(typeof F.width=="number",function(){return"inputResolution.width has a value of "+F.width+" which is invalid; it must be a number"}),Ye.util.assert(typeof F.height=="number",function(){return"inputResolution.height has a value of "+F.height+" which is invalid; it must be a number"}))}function kc(F,E){return Aa(F),typeof F=="object"?[wu(F.height,E),wu(F.width,E)]:[wu(F,E),wu(F,E)]}var tu=[8,16,32];function wt(F,E){return(F-1)%E==0}function ho(F){return F instanceof Ye.Tensor?[F.shape[0],F.shape[1]]:[F.height,F.width]}function ca(F,E){var k=E[0],w=E[1],_=ho(F),L=_[0],Y=_[1],ce=w/k,ve=[0,0,0,0],De=ve[0],Ce=ve[1],Xe=ve[2],nt=ve[3];return Y/L<ce?(De=0,Ce=0,Xe=Math.round(.5*(ce*L-Y)),nt=Math.round(.5*(ce*L-Y))):(De=Math.round(.5*(1/ce*Y-L)),Ce=Math.round(.5*(1/ce*Y-L)),Xe=0,nt=0),{resized:Object(Ye.tidy)(function(){var Et=function(At){return At instanceof Ye.Tensor?At:Ye.browser.fromPixels(At)}(F);return Et=Object(Ye.pad3d)(Et,[[De,Ce],[Xe,nt],[0,0]]),Ye.image.resizeBilinear(Et,[k,w])}),padding:{top:De,left:Xe,right:nt,bottom:Ce}}}function Ua(F,E,k,w,_){var L=E[0],Y=E[1],ce=k[0],ve=k[1],De=function(Ce,Xe,nt,Et,At){return Et===void 0&&(Et=0),At===void 0&&(At=0),nt===1&&Xe===1&&Et===0&&At===0?Ce:Ce.map(function(rn){return function(un,kn,En,_n,Pn){return _n===void 0&&(_n=0),Pn===void 0&&(Pn=0),{score:un.score,keypoints:un.keypoints.map(function(dn){var cr=dn.score,yr=dn.part,br=dn.position;return{score:cr,part:yr,position:{x:br.x*En+Pn,y:br.y*kn+_n}}})}}(rn,Xe,nt,Et,At)})}(F,(L+w.top+w.bottom)/ce,(Y+w.left+w.right)/ve,-w.top,-w.left);return _?function(Ce,Xe){return Xe<=0?Ce:Ce.map(function(nt){return function(Et,At){return{score:Et.score,keypoints:Et.keypoints.map(function(rn){var un=rn.score,kn=rn.part,En=rn.position;return{score:un,part:kn,position:{x:At-1-En.x,y:En.y}}})}}(nt,Xe)})}(De,Y):De}var ko={architecture:"MobileNetV1",outputStride:16,multiplier:.75,inputResolution:257},xs=["MobileNetV1","ResNet50"],fr={MobileNetV1:[8,16,32],ResNet50:[32,16]},Us={MobileNetV1:[.5,.75,1],ResNet50:[1]},nu=[1,2,4],Hc={flipHorizontal:!1},Ws={flipHorizontal:!1,maxDetections:5,scoreThreshold:.5,nmsRadius:20},Nh=function(){function F(E,k){(function(w){Ye.util.assert(typeof w=="number",function(){return"outputStride is not a number"}),Ye.util.assert(tu.indexOf(w)>=0,function(){return"outputStride of "+w+" is invalid. It must be either 8, 16, or 32"})})(E.outputStride),function(w,_){Ye.util.assert(typeof w[0]=="number"&&typeof w[1]=="number",function(){return"both resolution values must be a number but had values "+w}),Ye.util.assert(wt(w[0],_),function(){return"height of "+w[0]+" is invalid for output stride "+_+"."}),Ye.util.assert(wt(w[1],_),function(){return"width of "+w[1]+" is invalid for output stride "+_+"."})}(k,E.outputStride),this.baseModel=E,this.inputResolution=k}return F.prototype.estimateMultiplePoses=function(E,k){return k===void 0&&(k=Ws),ar(this,void 0,void 0,function(){var w,_,L,Y,ce,ve,De,Ce,Xe,nt,Et,At,rn,un,kn,En,_n,Pn,dn,cr,yr;return xu(this,function(br){switch(br.label){case 0:return w=Ef({},Ws,k),function(Br){var Or=Br.maxDetections,hi=Br.scoreThreshold,ki=Br.nmsRadius;if(Or<=0)throw new Error("Invalid maxDetections "+Or+". Should be > 0");if(hi<0||hi>1)throw new Error("Invalid scoreThreshold "+hi+". Should be in range [0.0, 1.0]");if(ki<=0)throw new Error("Invalid nmsRadius "+ki+".")}(k),_=this.baseModel.outputStride,L=this.inputResolution,Y=ho(E),ce=Y[0],ve=Y[1],De=ca(E,L),Ce=De.resized,Xe=De.padding,nt=this.baseModel.predict(Ce),Et=nt.heatmapScores,At=nt.offsets,rn=nt.displacementFwd,un=nt.displacementBwd,[4,function(Br){return ar(this,void 0,void 0,function(){return xu(this,function(Or){return[2,Promise.all(Br.map(function(hi){return hi.buffer()}))]})})}([Et,At,rn,un])];case 1:return kn=br.sent(),En=kn[0],_n=kn[1],Pn=kn[2],dn=kn[3],[4,Th(En,_n,Pn,dn,_,w.maxDetections,w.scoreThreshold,w.nmsRadius)];case 2:return cr=br.sent(),yr=Ua(cr,[ce,ve],L,Xe,w.flipHorizontal),Et.dispose(),At.dispose(),rn.dispose(),un.dispose(),Ce.dispose(),[2,yr]}})})},F.prototype.estimateSinglePose=function(E,k){return k===void 0&&(k=Hc),ar(this,void 0,void 0,function(){var w,_,L,Y,ce,ve,De,Ce,Xe,nt,Et,At,rn,un,kn,En;return xu(this,function(_n){switch(_n.label){case 0:return w=Ef({},Hc,k),_=this.baseModel.outputStride,L=this.inputResolution,Y=ho(E),ce=Y[0],ve=Y[1],De=ca(E,L),Ce=De.resized,Xe=De.padding,nt=this.baseModel.predict(Ce),Et=nt.heatmapScores,At=nt.offsets,rn=nt.displacementFwd,un=nt.displacementBwd,[4,Md(Et,At,_)];case 1:return kn=_n.sent(),En=Ua([kn],[ce,ve],L,Xe,w.flipHorizontal),Et.dispose(),At.dispose(),rn.dispose(),un.dispose(),Ce.dispose(),[2,En[0]]}})})},F.prototype.estimatePoses=function(E,k){return ar(this,void 0,void 0,function(){return xu(this,function(w){switch(w.label){case 0:return k.decodingMethod!=="single-person"?[3,2]:[4,this.estimateSinglePose(E,k)];case 1:return[2,[w.sent()]];case 2:return[2,this.estimateMultiplePoses(E,k)]}})})},F.prototype.dispose=function(){this.baseModel.dispose()},F}();function jd(F){return ar(this,void 0,void 0,function(){var E,k,w,_,L,Y,ce;return xu(this,function(ve){switch(ve.label){case 0:if(E=F.outputStride,k=F.quantBytes,w=F.multiplier,Ye==null)throw new Error(`Cannot find TensorFlow.js. If you are using a <script> tag, please also include @tensorflow/tfjs on the page before using this
        model.`);return _=function(De,Ce,Xe){var nt={1:"100",.75:"075",.5:"050"},Et="model-stride"+De+".json";return Xe===4?So+"float/"+nt[Ce]+"/"+Et:So+"quant"+Xe+"/"+nt[Ce]+"/"+Et}(E,w,k),[4,Object(jt.loadGraphModel)(F.modelUrl||_)];case 1:return L=ve.sent(),Y=new Np(L,E),ce=kc(F.inputResolution,Y.outputStride),[2,new Nh(Y,ce)]}})})}function Bd(F){return ar(this,void 0,void 0,function(){var E,k,w,_,L,Y;return xu(this,function(ce){switch(ce.label){case 0:if(E=F.outputStride,k=F.quantBytes,Ye==null)throw new Error(`Cannot find TensorFlow.js. If you are using a <script> tag, please also include @tensorflow/tfjs on the page before using this
        model.`);return w=function(ve,De){var Ce="model-stride"+ve+".json";return De===4?_o+"float/"+Ce:_o+"quant"+De+"/"+Ce}(E,k),[4,Object(jt.loadGraphModel)(F.modelUrl||w)];case 1:return _=ce.sent(),L=new Oa(_,E),Y=kc(F.inputResolution,L.outputStride),[2,new Nh(L,Y)]}})})}function lu(F){return F===void 0&&(F=ko),ar(this,void 0,void 0,function(){return xu(this,function(E){return(F=function(k){if((k=k||ko).architecture==null&&(k.architecture="MobileNetV1"),xs.indexOf(k.architecture)<0)throw new Error("Invalid architecture "+k.architecture+". Should be one of "+xs);if(k.inputResolution==null&&(k.inputResolution=257),Aa(k.inputResolution),k.outputStride==null&&(k.outputStride=16),fr[k.architecture].indexOf(k.outputStride)<0)throw new Error("Invalid outputStride "+k.outputStride+". Should be one of "+fr[k.architecture]+" for architecture "+k.architecture+".");if(k.multiplier==null&&(k.multiplier=1),Us[k.architecture].indexOf(k.multiplier)<0)throw new Error("Invalid multiplier "+k.multiplier+". Should be one of "+Us[k.architecture]+" for architecture "+k.architecture+".");if(k.quantBytes==null&&(k.quantBytes=4),nu.indexOf(k.quantBytes)<0)throw new Error("Invalid quantBytes "+k.quantBytes+". Should be one of "+nu+" for architecture "+k.architecture+".");if(k.architecture==="MobileNetV1"&&k.outputStride===32&&k.multiplier!==1)throw new Error("When using an output stride of 32, you must select 1 as the multiplier.");return k}(F)).architecture==="ResNet50"?[2,Bd(F)]:F.architecture==="MobileNetV1"?[2,jd(F)]:[2,null]})})}function Ki(F){var E=function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}();return function(){var k,w=as()(F);if(E){var _=as()(this).constructor;k=Reflect.construct(w,arguments,_)}else k=w.apply(this,arguments);return xc()(this,k)}}var ws={architecture:"MobileNetV1",outputStride:16,flipHorizontal:!1,minConfidence:.5,maxPoseDetections:5,scoreThreshold:.5,nmsRadius:20,detectionType:"multiple",inputResolution:256,multiplier:.75,quantBytes:2,modelUrl:null},Fh=function(F){bc()(k,F);var E=Ki(k);function k(w,_,L,Y){var ce;return pe()(this,k),(ce=E.call(this)).video=w,ce.modelUrl=_.modelUrl||null,ce.architecture=_.architecture||ws.architecture,ce.detectionType=L||_.detectionType||ws.detectionType,ce.outputStride=_.outputStride||ws.outputStride,ce.flipHorizontal=_.flipHorizontal||ws.flipHorizontal,ce.scoreThreshold=_.scoreThreshold||ws.scoreThreshold,ce.minConfidence=_.minConfidence||ws.minConfidence,ce.maxPoseDetections=_.maxPoseDetections||ws.maxPoseDetections,ce.multiplier=_.multiplier||ws.multiplier,ce.inputResolution=_.inputResolution||ws.inputResolution,ce.quantBytes=_.quantBytes||ws.quantBytes,ce.nmsRadius=_.nmsRadius||ws.nmsRadius,ce.ready=ot(ce.load(),Y),ce}return Te()(k,[{key:"load",value:function(){var w=K()(we.a.mark(function _(){var L,Y=this;return we.a.wrap(function(ce){for(;;)switch(ce.prev=ce.next){case 0:return L=this.architecture.toLowerCase()==="mobilenetv1"?{architecture:this.architecture,outputStride:this.outputStride,inputResolution:this.inputResolution,multiplier:this.multiplier,quantBytes:this.quantBytes,modelUrl:this.modelUrl}:{architecture:this.architecture,outputStride:this.outputStride,inputResolution:this.inputResolution,quantBytes:this.quantBytes},ce.next=3,lu(L);case 3:if(this.net=ce.sent,!this.video){ce.next=9;break}if(this.video.readyState!==0){ce.next=8;break}return ce.next=8,new Promise(function(ve){Y.video.onloadeddata=function(){return ve()}});case 8:this.detectionType==="single"?this.singlePose():this.multiPose();case 9:return ce.abrupt("return",this);case 10:case"end":return ce.stop()}},_,this)}));return function(){return w.apply(this,arguments)}}()},{key:"skeleton",value:function(w){return function(_,L){return No.reduce(function(Y,ce){var ve=ce[0],De=ce[1];return function(Ce,Xe,nt){return Ce<nt||Xe<nt}(_[ve].score,_[De].score,L)||Y.push([_[ve],_[De]]),Y},[])}(w,arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.minConfidence)}},{key:"mapParts",value:function(w){var _=JSON.parse(JSON.stringify(w));return _.keypoints.forEach(function(L){_[L.part]={x:L.position.x,y:L.position.y,confidence:L.score}}),_}},{key:"getInput",value:function(w){return w instanceof HTMLImageElement||w instanceof HTMLVideoElement||w instanceof HTMLCanvasElement||w instanceof ImageData?w:ke()(w)==="object"&&(w.elt instanceof HTMLImageElement||w.elt instanceof HTMLVideoElement||w.elt instanceof ImageData)?w.elt:ke()(w)==="object"&&w.canvas instanceof HTMLCanvasElement?w.canvas:this.video}},{key:"singlePose",value:function(){var w=K()(we.a.mark(function _(L,Y){var ce,ve,De,Ce,Xe=this;return we.a.wrap(function(nt){for(;;)switch(nt.prev=nt.next){case 0:return ce=this.getInput(L),nt.next=3,this.net.estimateSinglePose(ce,{flipHorizontal:this.flipHorizontal});case 3:if(ve=nt.sent,De=this.mapParts(ve),Ce=[{pose:De,skeleton:this.skeleton(ve.keypoints)}],this.emit("pose",Ce),!this.video){nt.next=9;break}return nt.abrupt("return",I.nextFrame().then(function(){return Xe.singlePose()}));case 9:return typeof Y=="function"&&Y(Ce),nt.abrupt("return",Ce);case 11:case"end":return nt.stop()}},_,this)}));return function(_,L){return w.apply(this,arguments)}}()},{key:"multiPose",value:function(){var w=K()(we.a.mark(function _(L,Y){var ce,ve,De,Ce,Xe=this;return we.a.wrap(function(nt){for(;;)switch(nt.prev=nt.next){case 0:return ce=this.getInput(L),nt.next=3,this.net.estimateMultiplePoses(ce,{flipHorizontal:this.flipHorizontal,maxDetections:this.maxPoseDetections,scoreThreshold:this.scoreThreshold,nmsRadius:this.nmsRadius});case 3:if(ve=nt.sent,De=ve.map(function(Et){return Xe.mapParts(Et)}),Ce=De.map(function(Et){return{pose:Et,skeleton:Xe.skeleton(Et.keypoints)}}),this.emit("pose",Ce),!this.video){nt.next=9;break}return nt.abrupt("return",I.nextFrame().then(function(){return Xe.multiPose()}));case 9:return typeof Y=="function"&&Y(Ce),nt.abrupt("return",Ce);case 11:case"end":return nt.stop()}},_,this)}));return function(_,L){return w.apply(this,arguments)}}()}]),k}(wf.a),oc=function(F,E,k){var w,_={},L=k,Y=null;return F instanceof HTMLVideoElement?w=F:ke()(F)==="object"&&F.elt instanceof HTMLVideoElement?w=F.elt:ke()(F)==="object"?_=F:typeof F=="function"&&(L=F),ke()(E)==="object"?_=E:typeof E=="string"&&(Y=E),typeof E=="function"&&(L=E),new Fh(w,_,Y,L)},us=function(){function F(E){pe()(this,F),this.urlPath=E.endsWith("/")?E:"".concat(E,"/"),this.variables={}}return Te()(F,[{key:"loadManifest",value:function(){var E=K()(we.a.mark(function k(){var w;return we.a.wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return _.prev=0,_.next=3,Gt.a.get(this.urlPath+"manifest.json");case 3:return w=_.sent,_.abrupt("return",w.data);case 7:throw _.prev=7,_.t0=_.catch(0),new Error("".concat("manifest.json"," not found at ").concat(this.urlPath,". ").concat(_.t0));case 10:case"end":return _.stop()}},k,this,[[0,7]])}));return function(){return E.apply(this,arguments)}}()},{key:"loadVariable",value:function(){var E=K()(we.a.mark(function k(w){var _,L,Y,ce,ve,De,Ce;return we.a.wrap(function(Xe){for(;;)switch(Xe.prev=Xe.next){case 0:return Xe.next=2,this.getCheckpointManifest();case 2:if(_=Xe.sent,w in _){Xe.next=5;break}throw new Error("Cannot load non-existent variable ".concat(w));case 5:return L=_[w],Y=L.filename,ce=L.shape,ve=this.urlPath+Y,Xe.prev=7,Xe.next=10,Gt.a.get(ve,{responseType:"arraybuffer"});case 10:return De=Xe.sent,Ce=new Float32Array(De.data),Xe.abrupt("return",I.tensor(Ce,ce));case 15:throw Xe.prev=15,Xe.t0=Xe.catch(7),new Error("Error loading variable ".concat(w," from URL ").concat(ve,": ").concat(Xe.t0));case 18:case"end":return Xe.stop()}},k,this,[[7,15]])}));return function(k){return E.apply(this,arguments)}}()},{key:"getCheckpointManifest",value:function(){var E=K()(we.a.mark(function k(){return we.a.wrap(function(w){for(;;)switch(w.prev=w.next){case 0:if(this.checkpointManifest){w.next=4;break}return w.next=3,this.loadManifest();case 3:this.checkpointManifest=w.sent;case 4:return w.abrupt("return",this.checkpointManifest);case 5:case"end":return w.stop()}},k,this)}));return function(){return E.apply(this,arguments)}}()},{key:"getKeys",value:function(){var E=K()(we.a.mark(function k(){var w;return we.a.wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return _.next=2,this.getCheckpointManifest();case 2:return w=_.sent,_.abrupt("return",Object.keys(w));case 4:case"end":return _.stop()}},k,this)}));return function(){return E.apply(this,arguments)}}()},{key:"getAllVariables",value:function(){var E=K()(we.a.mark(function k(){var w,_,L=this;return we.a.wrap(function(Y){for(;;)switch(Y.prev=Y.next){case 0:return Y.next=2,this.getKeys();case 2:return w=Y.sent,_=w.map(function(ce){return L.getVariable(ce)}),Y.next=6,Promise.all(_);case 6:return Y.abrupt("return",this.variables);case 7:case"end":return Y.stop()}},k,this)}));return function(){return E.apply(this,arguments)}}()},{key:"getVariable",value:function(){var E=K()(we.a.mark(function k(w){return we.a.wrap(function(_){for(;;)switch(_.prev=_.next){case 0:if(this.variables[w]){_.next=4;break}return _.next=3,this.loadVariable(w);case 3:this.variables[w]=_.sent;case 4:return _.abrupt("return",this.variables[w]);case 5:case"end":return _.stop()}},k,this)}));return function(k){return E.apply(this,arguments)}}()}]),F}();function ii(F){var E=function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}();return function(){var k,w=as()(F);if(E){var _=as()(this).constructor;k=Reflect.construct(w,arguments,_)}else k=w.apply(this,arguments);return xc()(this,k)}}var Po=200,Ih=function(F){return new Promise(function(E){var k=new Image(Po,Po);k.onload=function(){return E(k)},k.src=F.toDataURL()})},Pd=function(F){bc()(k,F);var E=ii(k);function k(w,_,L){var Y;return pe()(this,k),(Y=E.call(this,_,Po)).ready=!1,Y.variableDictionary={},Y.timesScalar=I.scalar(150),Y.plusScalar=I.scalar(127.5),Y.epsilonScalar=I.scalar(.001),Y.video=null,Y.ready=ot(Y.load(w),L),Y}return Te()(k,[{key:"load",value:function(){var w=K()(we.a.mark(function _(L){return we.a.wrap(function(Y){for(;;)switch(Y.prev=Y.next){case 0:if(!this.videoElt){Y.next=3;break}return Y.next=3,this.loadVideo();case 3:return Y.next=5,this.loadCheckpoints(L);case 5:return Y.abrupt("return",this);case 6:case"end":return Y.stop()}},_,this)}));return function(_){return w.apply(this,arguments)}}()},{key:"loadCheckpoints",value:function(){var w=K()(we.a.mark(function _(L){var Y;return we.a.wrap(function(ce){for(;;)switch(ce.prev=ce.next){case 0:return Y=new us(L),ce.next=3,Y.getAllVariables();case 3:this.variables=ce.sent;case 4:case"end":return ce.stop()}},_,this)}));return function(_){return w.apply(this,arguments)}}()},{key:"instanceNorm",value:function(w,_){var L=this;return I.tidy(function(){var Y=Tn()(w.shape,3),ce=Y[0],ve=Y[1],De=Y[2],Ce=I.moments(w,[0,1]),Xe=Ce.mean,nt=Ce.variance,Et=L.variables[k.getVariableName(_)],At=L.variables[k.getVariableName(_+1)],rn=L.epsilonScalar,un=I.div(I.sub(w.asType("float32"),Xe),I.sqrt(I.add(nt,rn)));return I.add(I.mul(At,un),Et).as3D(ce,ve,De)})}},{key:"convLayer",value:function(w,_,L,Y){var ce=I.conv2d(w,this.variables[k.getVariableName(Y)],[_,_],"same"),ve=this.instanceNorm(ce,Y+1);return L?I.relu(ve):ve}},{key:"residualBlock",value:function(w,_){var L=this.convLayer(w,1,!0,_),Y=this.convLayer(L,1,!1,_+3);return I.add(Y,w)}},{key:"convTransposeLayer",value:function(w,_,L,Y){var ce=Tn()(w.shape,2),ve=[ce[0]*L,ce[1]*L,_],De=I.conv2dTranspose(w,this.variables[k.getVariableName(Y)],ve,[L,L],"same"),Ce=this.instanceNorm(De,Y+1);return I.relu(Ce)}},{key:"transfer",value:function(){var w=K()(we.a.mark(function _(L,Y){var ce,ve;return we.a.wrap(function(De){for(;;)switch(De.prev=De.next){case 0:if(ve=Y,!(L instanceof HTMLVideoElement||L instanceof HTMLImageElement||L instanceof ImageData)){De.next=5;break}ce=L,De.next=18;break;case 5:if(!(L instanceof HTMLCanvasElement)){De.next=11;break}return De.next=8,Ih(L);case 8:ce=De.sent,De.next=18;break;case 11:if(!(ke()(L)==="object"&&L.elt instanceof HTMLCanvasElement)){De.next=17;break}return De.next=14,Ih(L.elt);case 14:ce=De.sent,De.next=18;break;case 17:ke()(L)==="object"&&(L.elt instanceof HTMLVideoElement||L.elt instanceof HTMLImageElement||L.elt instanceof ImageData)?ce=L.elt:typeof L=="function"&&(ce=this.video,ve=L);case 18:return De.abrupt("return",ot(this.transferInternal(ce),ve));case 19:case"end":return De.stop()}},_,this)}));return function(_,L){return w.apply(this,arguments)}}()},{key:"transferInternal",value:function(){var w=K()(we.a.mark(function _(L){var Y,ce,ve=this;return we.a.wrap(function(De){for(;;)switch(De.prev=De.next){case 0:return Y=I.browser.fromPixels(L),ce=an(I.tidy(function(){var Ce=ve.convLayer(Y,1,!0,0),Xe=ve.convLayer(Ce,2,!0,3),nt=ve.convLayer(Xe,2,!0,6),Et=ve.residualBlock(nt,9),At=ve.residualBlock(Et,15),rn=ve.residualBlock(At,21),un=ve.residualBlock(rn,27),kn=ve.residualBlock(un,33),En=ve.convTransposeLayer(kn,64,2,39),_n=ve.convTransposeLayer(En,32,2,42),Pn=ve.convLayer(_n,1,!1,45),dn=I.tanh(Pn),cr=I.mul(ve.timesScalar,dn),yr=I.add(ve.plusScalar,cr),br=I.clipByValue(yr,0,255);return I.div(br,I.scalar(255))})),Y.dispose(),De.next=5,I.nextFrame();case 5:return De.abrupt("return",ce);case 6:case"end":return De.stop()}},_)}));return function(_){return w.apply(this,arguments)}}()}],[{key:"getVariableName",value:function(w){return w===0?"Variable":"Variable_".concat(w)}}]),k}(Rr),Al=function(F,E,k){var w=k;typeof E=="function"&&(w=E);var _=new Pd(F,E,w);return w?_:_.ready},Rh=function(F){for(var E,k=Math.random(),w=0,_=0;_<F.length;_+=1)if(k<(w+=F[_])){E=_;break}return E},Ri=/cell_[0-9]|lstm_[0-9]/gi,bi=/weights|weight|kernel|kernels|w/gi,oa=/softmax/gi,Ld=function(){function F(E,k){pe()(this,F),this.ready=!1,this.model={},this.cellsAmount=0,this.cells=[],this.zeroState={c:[],h:[]},this.state={c:[],h:[]},this.vocab={},this.vocabSize=0,this.probabilities=[],this.defaults={seed:"a",length:20,temperature:.5,stateful:!1},this.ready=ot(this.loadCheckpoints(E),k)}return Te()(F,[{key:"resetState",value:function(){this.state=this.zeroState}},{key:"setState",value:function(E){this.state=E}},{key:"getState",value:function(){return this.state}},{key:"loadCheckpoints",value:function(){var E=K()(we.a.mark(function k(w){var _,L,Y=this;return we.a.wrap(function(ce){for(;;)switch(ce.prev=ce.next){case 0:return _=new us(w),ce.next=3,_.getAllVariables();case 3:return L=ce.sent,Object.keys(L).forEach(function(ve){ve.match(Ri)?ve.match(bi)?(Y.model["Kernel_".concat(ve.match(/[0-9]/)[0])]=L[ve],Y.cellsAmount+=1):Y.model["Bias_".concat(ve.match(/[0-9]/)[0])]=L[ve]:ve.match(oa)?ve.match(bi)?Y.model.fullyConnectedWeights=L[ve]:Y.model.fullyConnectedBiases=L[ve]:Y.model[ve]=L[ve]}),ce.next=7,this.loadVocab(w);case 7:return ce.next=9,this.initCells();case 9:return ce.abrupt("return",this);case 10:case"end":return ce.stop()}},k,this)}));return function(k){return E.apply(this,arguments)}}()},{key:"loadVocab",value:function(){var E=K()(we.a.mark(function k(w){var _,L;return we.a.wrap(function(Y){for(;;)switch(Y.prev=Y.next){case 0:return Y.prev=0,Y.next=3,Gt.a.get("".concat(w,"/vocab.json"));case 3:return _=Y.sent,L=_.data,this.vocab=L,this.vocabSize=Object.keys(L).length,Y.abrupt("return",this.vocab);case 10:return Y.prev=10,Y.t0=Y.catch(0),Y.abrupt("return",Y.t0);case 13:case"end":return Y.stop()}},k,this,[[0,10]])}));return function(k){return E.apply(this,arguments)}}()},{key:"initCells",value:function(){var E=K()(we.a.mark(function k(){var w,_,L,Y=this;return we.a.wrap(function(ce){for(;;)switch(ce.prev=ce.next){case 0:for(this.cells=[],this.zeroState={c:[],h:[]},w=I.tensor(1),_=function(ve){return function(De,Ce,Xe){return I.basicLSTMCell(w,Y.model["Kernel_".concat(ve)],Y.model["Bias_".concat(ve)],De,Ce,Xe)}},L=0;L<this.cellsAmount;L+=1)this.zeroState.c.push(I.zeros([1,this.model["Bias_".concat(L)].shape[0]/4])),this.zeroState.h.push(I.zeros([1,this.model["Bias_".concat(L)].shape[0]/4])),this.cells.push(_(L));this.state=this.zeroState;case 6:case"end":return ce.stop()}},k,this)}));return function(){return E.apply(this,arguments)}}()},{key:"generateInternal",value:function(){var E=K()(we.a.mark(function k(w){var _,L,Y,ce,ve,De,Ce,Xe,nt,Et,At,rn,un,kn,En,_n,Pn,dn,cr,yr=this;return we.a.wrap(function(br){for(;;)switch(br.prev=br.next){case 0:return br.next=2,this.ready;case 2:_=w.seed||this.defaults.seed,L=+w.length||this.defaults.length,Y=+w.temperature||this.defaults.temperature,w.stateful||this.defaults.stateful||(this.state=this.zeroState),ce=[],ve=Array.from(_),De=[],ve.forEach(function(Br){De.push(yr.vocab[Br])}),Ce=De[0],Xe=[],nt=0;case 14:if(!(nt<ve.length+L+-1)){br.next=36;break}return br.next=17,I.buffer([1,this.vocabSize]);case 17:return(Et=br.sent).set(1,0,Ce),At=Et.toTensor(),rn=void 0,this.model.embedding?(un=I.matMul(At,this.model.embedding),rn=I.multiRNNCell(this.cells,un,this.state.c,this.state.h)):rn=I.multiRNNCell(this.cells,At,this.state.c,this.state.h),this.state.c=rn[0],this.state.h=rn[1],kn=this.state.h[1],En=I.matMul(kn,this.model.fullyConnectedWeights),_n=I.add(En,this.model.fullyConnectedBiases),Pn=I.div(_n,I.tensor(Y)),dn=I.exp(Pn),br.next=31,I.div(dn,I.sum(dn)).data();case 31:Xe=br.sent,nt<ve.length-1?Ce=De[nt+1]:(Ce=Rh(Xe),ce.push(Ce));case 33:nt+=1,br.next=14;break;case 36:return cr="",ce.forEach(function(Br){var Or=Object.keys(yr.vocab).find(function(hi){return yr.vocab[hi]===Br});Or&&(cr+=Or)}),this.probabilities=Xe,br.abrupt("return",{sample:cr,state:this.state});case 40:case"end":return br.stop()}},k,this)}));return function(k){return E.apply(this,arguments)}}()},{key:"reset",value:function(){this.state=this.zeroState}},{key:"generate",value:function(){var E=K()(we.a.mark(function k(w,_){return we.a.wrap(function(L){for(;;)switch(L.prev=L.next){case 0:return this.reset(),L.abrupt("return",ot(this.generateInternal(w),_));case 2:case"end":return L.stop()}},k,this)}));return function(k,w){return E.apply(this,arguments)}}()},{key:"predict",value:function(){var E=K()(we.a.mark(function k(w,_){var L,Y,ce,ve,De,Ce,Xe,nt,Et,At,rn=this;return we.a.wrap(function(un){for(;;)switch(un.prev=un.next){case 0:return L=[],Y=w>0?w:.1,ce=this.state.h[1],ve=I.matMul(ce,this.model.fullyConnectedWeights),De=I.add(ve,this.model.fullyConnectedBiases),Ce=I.div(De,I.tensor(Y)),Xe=I.exp(Ce),un.next=9,I.div(Xe,I.sum(Xe)).data();case 9:return L=un.sent,nt=Rh(L),Et=Object.keys(this.vocab).find(function(kn){return rn.vocab[kn]===nt}),this.probabilities=L,_&&_(Et),At=Object.keys(this.vocab).map(function(kn){return{char:kn,probability:rn.probabilities[rn.vocab[kn]]}}),un.abrupt("return",{sample:Et,probabilities:At});case 16:case"end":return un.stop()}},k,this)}));return function(k,w){return E.apply(this,arguments)}}()},{key:"feed",value:function(){var E=K()(we.a.mark(function k(w,_){var L,Y,ce,ve,De,Ce,Xe,nt,Et=this;return we.a.wrap(function(At){for(;;)switch(At.prev=At.next){case 0:return At.next=2,this.ready;case 2:L=Array.from(w),Y=[],L.forEach(function(rn){Y.push(Et.vocab[rn])}),ce=Y[0],ve=0;case 7:if(!(ve<L.length)){At.next=21;break}return At.next=10,I.buffer([1,this.vocabSize]);case 10:(De=At.sent).set(1,0,ce),Ce=De.toTensor(),Xe=void 0,this.model.embedding?(nt=I.matMul(Ce,this.model.embedding),Xe=I.multiRNNCell(this.cells,nt,this.state.c,this.state.h)):Xe=I.multiRNNCell(this.cells,Ce,this.state.c,this.state.h),this.state.c=Xe[0],this.state.h=Xe[1],ce=Y[ve];case 18:ve+=1,At.next=7;break;case 21:_&&_();case 22:case"end":return At.stop()}},k,this)}));return function(k,w){return E.apply(this,arguments)}}()}]),F}(),zd=function(){var F=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"./",E=arguments.length>1?arguments[1]:void 0;return new Ld(F,E)},Ud=function(){function F(E){pe()(this,F),this.urlPath=E}return Te()(F,[{key:"getAllVariables",value:function(){var E=K()(we.a.mark(function k(){var w,_,L,Y,ce,ve,De,Ce,Xe,nt;return we.a.wrap(function(Et){for(;;)switch(Et.prev=Et.next){case 0:return Et.next=2,Gt.a.get(this.urlPath,{responseType:"arraybuffer"}).catch(function(At){throw new Error("No model found. Failed with error ".concat(At))});case 2:for(w=Et.sent,_=w.data,L=[],Y=0;Y<_.byteLength;)ce=new Uint8Array(_.slice(Y,Y+4)),Y+=4,ve=(ce[0]<<24)+(ce[1]<<16)+(ce[2]<<8)+ce[3],L.push(_.slice(Y,Y+ve)),Y+=ve;return De=JSON.parse(new TextDecoder("utf8").decode(L[0])),Ce=new Float32Array(L[1]),Xe=new Uint8Array(L[2]),nt={},Y=0,De.forEach(function(At){var rn=At.shape,un=At.name,kn=rn.reduce(function(Pn,dn){return Pn*dn}),En=Xe.slice(Y,Y+kn),_n=new Float32Array(En.length);En.forEach(function(Pn,dn){_n[dn]=Ce[Pn]}),nt[un]=I.tensor(_n,rn,"float32"),Y+=kn}),Et.abrupt("return",nt);case 14:case"end":return Et.stop()}},k,this)}));return function(){return E.apply(this,arguments)}}()}]),F}(),Rp=function(){function F(E,k){pe()(this,F),this.ready=ot(this.loadCheckpoints(E),k)}return Te()(F,[{key:"loadCheckpoints",value:function(){var E=K()(we.a.mark(function k(w){var _;return we.a.wrap(function(L){for(;;)switch(L.prev=L.next){case 0:return _=new Ud(w),L.next=3,_.getAllVariables();case 3:return this.variables=L.sent,L.abrupt("return",this);case 5:case"end":return L.stop()}},k,this)}));return function(k){return E.apply(this,arguments)}}()},{key:"transfer",value:function(){var E=K()(we.a.mark(function k(w,_){return we.a.wrap(function(L){for(;;)switch(L.prev=L.next){case 0:return L.abrupt("return",ot(this.transferInternal(w),_));case 1:case"end":return L.stop()}},k,this)}));return function(k,w){return E.apply(this,arguments)}}()},{key:"transferInternal",value:function(){var E=K()(we.a.mark(function k(w){var _,L=this;return we.a.wrap(function(Y){for(;;)switch(Y.prev=Y.next){case 0:return _=an(I.tidy(function(){var ce=I.browser.fromPixels(w),ve=ce.dataSync(),De=I.tensor3d(ve,ce.shape),Ce=I.div(De,I.scalar(255)),Xe=F.preprocess(Ce),nt=[],Et=L.variables["generator/encoder_1/conv2d/kernel"],At=L.variables["generator/encoder_1/conv2d/bias"],rn=F.conv2d(Xe,Et,At);nt.push(rn);for(var un=2;un<=8;un+=1){var kn="generator/encoder_".concat(un.toString());Et=L.variables["".concat(kn,"/conv2d/kernel")];var En=L.variables["".concat(kn,"/conv2d/bias")],_n=nt[nt.length-1],Pn=I.leakyRelu(_n,.2);rn=F.conv2d(Pn,Et,En);var dn=L.variables["".concat(kn,"/batch_normalization/gamma")],cr=L.variables["".concat(kn,"/batch_normalization/beta")],yr=F.batchnorm(rn,dn,cr);nt.push(yr)}for(var br=8;br>=2;br-=1){var Br=void 0;if(br===8)Br=nt[nt.length-1];else{var Or=br-1;Br=I.concat([nt[nt.length-1],nt[Or]],2)}var hi=I.relu(Br),ki="generator/decoder_".concat(br.toString());Et=L.variables["".concat(ki,"/conv2d_transpose/kernel")],At=L.variables["".concat(ki,"/conv2d_transpose/bias")],rn=F.deconv2d(hi,Et,At);var xi=L.variables["".concat(ki,"/batch_normalization/gamma")],xo=L.variables["".concat(ki,"/batch_normalization/beta")],Wo=F.batchnorm(rn,xi,xo);nt.push(Wo)}var To=I.concat([nt[nt.length-1],nt[0]],2),Do=I.relu(To);Et=L.variables["generator/decoder_1/conv2d_transpose/kernel"];var Mo=L.variables["generator/decoder_1/conv2d_transpose/bias"];rn=F.deconv2d(Do,Et,Mo),Do=I.tanh(rn),nt.push(Do);var ea=nt[nt.length-1];return F.deprocess(ea)})),Y.next=3,I.nextFrame();case 3:return Y.abrupt("return",_);case 4:case"end":return Y.stop()}},k)}));return function(k){return E.apply(this,arguments)}}()}],[{key:"preprocess",value:function(E){var k=I.tidy(function(){return I.sub(I.mul(E,I.scalar(2)),I.scalar(1))});return E.dispose(),k}},{key:"deprocess",value:function(E){var k=I.tidy(function(){return I.div(I.add(E,I.scalar(1)),I.scalar(2))});return E.dispose(),k}},{key:"batchnorm",value:function(E,k,w){var _=I.tidy(function(){var L=I.moments(E,[0,1]);return I.batchNorm(E,L.mean,L.variance,w,k,1e-5)});return E.dispose(),_}},{key:"conv2d",value:function(E,k){var w=k.clone(),_=I.tidy(function(){return I.conv2d(E,w,[2,2],"same")});return E.dispose(),w.dispose(),_}},{key:"deconv2d",value:function(E,k,w){var _=I.tidy(function(){var L=I.conv2dTranspose(E,k,[2*E.shape[0],2*E.shape[1],k.shape[2]],[2,2],"same");return I.add(L,w)});return E.dispose(),k.dispose(),w.dispose(),_}}]),F}(),zu=function(F,E){var k=new Rp(F,E);return E?k:k.ready},ks=a(241),$c=new Set(["alarm_clock","ambulance","angel","ant","antyoga","backpack","barn","basket","bear","bee","beeflower","bicycle","bird","book","brain","bridge","bulldozer","bus","butterfly","cactus","calendar","castle","cat","catbus","catpig","chair","couch","crab","crabchair","crabrabbitfacepig","cruise_ship","diving_board","dog","dogbunny","dolphin","duck","elephant","elephantpig","eye","face","fan","fire_hydrant","firetruck","flamingo","flower","floweryoga","frog","frogsofa","garden","hand","hedgeberry","hedgehog","helicopter","kangaroo","key","lantern","lighthouse","lion","lionsheep","lobster","map","mermaid","monapassport","monkey","mosquito","octopus","owl","paintbrush","palm_tree","parrot","passport","peas","penguin","pig","pigsheep","pineapple","pool","postcard","power_outlet","rabbit","rabbitturtle","radio","radioface","rain","rhinoceros","rifle","roller_coaster","sandwich","scorpion","sea_turtle","sheep","skull","snail","snowflake","speedboat","spider","squirrel","steak","stove","strawberry","swan","swing_set","the_mona_lisa","tiger","toothbrush","toothpaste","tractor","trombone","truck","whale","windmill","yoga","yogabicycle","everything"]),Is={modelPath:"https://storage.googleapis.com/quickdraw-models/sketchRNN/large_models/",modelPath_large:"https://storage.googleapis.com/quickdraw-models/sketchRNN/models/",modelPath_small:"https://storage.googleapis.com/quickdraw-models/sketchRNN/models/",PATH_END:".gen.json",temperature:.65,pixelFactor:3},ru=function(){function F(E,k){var w=!(arguments.length>2&&arguments[2]!==void 0)||arguments[2];pe()(this,F);var _=E;if(this.config={temperature:.65,pixelFactor:3,modelPath:Is.modelPath,modelPath_small:Is.modelPath_small,modelPath_large:Is.modelPath_large,PATH_END:Is.PATH_END},Pu.isAbsoluteURL(_)===!0){var L=Pu.getModelPath(_);this.config.modelPath=L}else{if(!$c.has(_))return console.log("no model found!"),this;_=(w?this.config.modelPath:this.config.modelPath_small)+_+this.config.PATH_END,this.config.modelPath=_}this.model=new ks.SketchRNN(this.config.modelPath),this.penState=this.model.zeroInput(),this.ready=ot(this.model.initialize(),k)}return Te()(F,[{key:"generateInternal",value:function(){var E=K()(we.a.mark(function k(w,_){var L,Y,ce,ve;return we.a.wrap(function(De){for(;;)switch(De.prev=De.next){case 0:return L=+w.temperature||this.config.temperature,Y=+w.pixelFactor||this.config.pixelFactor,De.next=4,this.ready;case 4:return this.rnnState||(this.rnnState=this.model.zeroState(),this.model.setPixelFactor(Y)),Array.isArray(_)&&_.length&&(this.rnnState=this.model.updateStrokes(_,this.rnnState)),this.rnnState=this.model.update(this.penState,this.rnnState),ce=this.model.getPDF(this.rnnState,L),this.penState=this.model.sample(ce),ve={dx:this.penState[0],dy:this.penState[1]},this.penState[2]===1?ve.pen="down":this.penState[3]===1?ve.pen="up":this.penState[4]===1&&(ve.pen="end"),De.abrupt("return",ve);case 12:case"end":return De.stop()}},k,this)}));return function(k,w){return E.apply(this,arguments)}}()},{key:"generate",value:function(){var E=K()(we.a.mark(function k(w,_,L){var Y,ce,ve,De;return we.a.wrap(function(Ce){for(;;)switch(Ce.prev=Ce.next){case 0:return typeof w=="function"?(ce={},ve=[],Y=w):Array.isArray(w)?(ce={},ve=w,Y=_):typeof _=="function"?(ce=w||{},ve=[],Y=_):(ce=w||{},ve=_||[],Y=L),De=ve.map(function(Xe){var nt=Xe.pen==="up"?1:0,Et=Xe.pen==="down"?1:0,At=Xe.pen==="end"?1:0;return[Xe.dx,Xe.dy,Et,nt,At]}),Ce.abrupt("return",ot(this.generateInternal(ce,De),Y));case 3:case"end":return Ce.stop()}},k,this)}));return function(k,w,_){return E.apply(this,arguments)}}()},{key:"reset",value:function(){this.penState=this.model.zeroInput(),this.rnnState&&(this.rnnState=this.model.zeroState())}}]),F}(),Mh=function(F,E){var k=!(arguments.length>2&&arguments[2]!==void 0)||arguments[2];return new ru(F,E,k)},Ni={modelPath:"https://raw.githubusercontent.com/zaidalyafeai/HostedModels/master/unet-128/model.json",imageSize:128,returnTensors:!1},Sf=function(){function F(E,k,w){pe()(this,F),this.modelReady=!1,this.isPredicting=!1,this.config={modelPath:k.modelPath!==void 0?k.modelPath:Ni.modelPath,imageSize:k.imageSize!==void 0?k.imageSize:Ni.imageSize,returnTensors:k.returnTensors!==void 0?k.returnTensors:Ni.returnTensors},this.ready=ot(this.loadModel(),w)}return Te()(F,[{key:"loadModel",value:function(){var E=K()(we.a.mark(function k(){return we.a.wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return w.next=2,I.loadLayersModel(this.config.modelPath);case 2:return this.model=w.sent,this.modelReady=!0,w.abrupt("return",this);case 5:case"end":return w.stop()}},k,this)}));return function(){return E.apply(this,arguments)}}()},{key:"segment",value:function(){var E=K()(we.a.mark(function k(w,_){var L,Y;return we.a.wrap(function(ce){for(;;)switch(ce.prev=ce.next){case 0:return ce.next=2,this.ready;case 2:return Y=_,w instanceof HTMLImageElement||w instanceof HTMLVideoElement||w instanceof HTMLCanvasElement||w instanceof ImageData?L=w:ke()(w)==="object"&&(w.elt instanceof HTMLImageElement||w.elt instanceof HTMLVideoElement||w.elt instanceof HTMLCanvasElement||w.elt instanceof ImageData)?L=w.elt:typeof w=="function"&&(L=this.video,Y=w),ce.abrupt("return",ot(this.segmentInternal(L),Y));case 5:case"end":return ce.stop()}},k,this)}));return function(k,w){return E.apply(this,arguments)}}()},{key:"convertToP5Image",value:function(){var E=K()(we.a.mark(function k(w){var _,L;return we.a.wrap(function(Y){for(;;)switch(Y.prev=Y.next){case 0:return Y.next=2,Nr.rawToBlob(w,this.config.imageSize,this.config.imageSize);case 2:return _=Y.sent,Y.next=5,Nr.blobToP5Image(_);case 5:return L=Y.sent,Y.abrupt("return",L);case 7:case"end":return Y.stop()}},k,this)}));return function(k){return E.apply(this,arguments)}}()},{key:"segmentInternal",value:function(){var E=K()(we.a.mark(function k(w){var _,L,Y,ce,ve,De,Ce,Xe,nt,Et,At,rn,un,kn,En=this;return we.a.wrap(function(_n){for(;;)switch(_n.prev=_n.next){case 0:return _n.next=2,this.ready;case 2:if(!(w instanceof HTMLVideoElement)){_n.next=5;break}return _n.next=5,I.nextFrame();case 5:return this.isPredicting=!0,_=I.tidy(function(){var Pn=I.browser.fromPixels(w).toFloat(),dn=I.image.resizeBilinear(Pn,[En.config.imageSize,En.config.imageSize]).div(I.scalar(255)),cr=dn.expandDims(0),yr=En.model.predict(cr),br=I.ones([128,128,1]).tile([1,1,1]);dn=dn.concat(br,2);var Br=yr.squeeze([0]),Or=(Br=(Br=Br.tile([1,1,4])).sub(.3).sign().relu().neg().add(1)).mul(dn),hi=yr.squeeze([0]),ki=(hi=(hi=hi.tile([1,1,4])).sub(.3).sign().relu()).mul(dn),xi=I.ones([128,128,1]).tile([1,1,1]).mul(255),xo=yr.squeeze([0]);return{featureMask:Or,backgroundMask:ki,segmentation:xo=(xo=I.cast(xo.tile([1,1,3]).sub(.3).sign().relu().mul(255),"int32")).concat(xi,2)}}),L=_.featureMask,Y=_.backgroundMask,ce=_.segmentation,this.isPredicting=!1,_n.next=10,I.browser.toPixels(L);case 10:return ve=_n.sent,_n.next=13,I.browser.toPixels(Y);case 13:return De=_n.sent,_n.next=16,I.browser.toPixels(ce);case 16:if(Ce=_n.sent,Xe=an(L),nt=an(Y),Et=F.dataURLtoBlob(Xe.src),At=F.dataURLtoBlob(nt.src),!Nr.checkP5()){_n.next=31;break}return _n.next=24,this.convertToP5Image(ve);case 24:return rn=_n.sent,_n.next=27,this.convertToP5Image(De);case 27:return un=_n.sent,_n.next=30,this.convertToP5Image(Ce);case 30:kn=_n.sent;case 31:return this.config.returnTensors||(L.dispose(),Y.dispose(),ce.dispose()),_n.abrupt("return",{segmentation:Ce,blob:{featureMask:Et,backgroundMask:At},tensor:{featureMask:L,backgroundMask:Y},raw:{featureMask:ve,backgroundMask:De},featureMask:rn,backgroundMask:un,mask:kn});case 33:case"end":return _n.stop()}},k,this)}));return function(k){return E.apply(this,arguments)}}()}],[{key:"dataURLtoBlob",value:function(E){for(var k=E.split(","),w=k[0].match(/:(.*?);/)[1],_=atob(k[1]),L=_.length,Y=new Uint8Array(L);L;)Y[L]=_.charCodeAt(L),L-=1;return new Blob([Y],{type:w})}}]),F}(),Gc=function(F,E,k){var w=null,_={},L=k;return F instanceof HTMLVideoElement?w=F:ke()(F)==="object"&&F.elt instanceof HTMLVideoElement?w=F.elt:typeof F=="function"?L=F:ke()(F)==="object"&&(_=F),ke()(E)==="object"?_=E:typeof E=="function"&&(L=E),new Sf(w,_,L)},Sl=function(){function F(E,k){var w=this;pe()(this,F),this.ready=!1,this.model={},this.latentDim=I.randomUniform([1,16]);var _=E.split("manifest.json"),L=Tn()(_,1)[0];Gt.a.get(E).then(function(Y){var ce=Y.data;w.ready=ot(w.loadCVAEModel(L+ce.model),k),w.labels=ce.labels,w.labelVector=Array(w.labels.length+1).fill(0)})}return Te()(F,[{key:"loadCVAEModel",value:function(){var E=K()(we.a.mark(function k(w){return we.a.wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return _.next=2,I.loadLayersModel(w);case 2:return this.model=_.sent,_.abrupt("return",this);case 4:case"end":return _.stop()}},k,this)}));return function(k){return E.apply(this,arguments)}}()},{key:"generate",value:function(){var E=K()(we.a.mark(function k(w,_){return we.a.wrap(function(L){for(;;)switch(L.prev=L.next){case 0:return L.abrupt("return",ot(this.generateInternal(w),_));case 1:case"end":return L.stop()}},k,this)}));return function(k,w){return E.apply(this,arguments)}}()},{key:"loadAsync",value:function(E){var k=this;return new Promise(function(w,_){k.ready||_(),loadImage(E,function(L){w(L)})})}},{key:"getBlob",value:function(E){var k=this;return new Promise(function(w,_){k.ready||_(),E.toBlob(function(L){w(L)})})}},{key:"generateInternal",value:function(){var E=K()(we.a.mark(function k(w){var _,L,Y,ce,ve,De,Ce,Xe,nt,Et,At,rn,un=this;return we.a.wrap(function(kn){for(;;)switch(kn.prev=kn.next){case 0:return _=I.tidy(function(){un.latentDim=I.randomUniform([1,16]);var En=un.labels.indexOf(w);if(En<0)return console.log("Wrong input of the label!"),[void 0,void 0];un.labelVector=un.labelVector.map(function(){return 0}),un.labelVector[En+1]=1;var _n=I.tensor([un.labelVector]),Pn=un.model.predict([un.latentDim,_n]);return Pn.reshape([Pn.shape[1],Pn.shape[2],Pn.shape[3]])}),kn.next=3,I.browser.toPixels(_);case 3:for(L=kn.sent,_.dispose(),Y=document.createElement("canvas"),ce=Y.getContext("2d"),ve=Tn()(_.shape,2),De=ve[0],Ce=ve[1],Y.width=De,Y.height=Ce,Xe=ce.createImageData(De,Ce),nt=Xe.data,Et=0;Et<De*Ce*4;Et+=1)nt[Et]=L[Et];return ce.putImageData(Xe,0,0),kn.t0=URL,kn.next=17,this.getBlob(Y);case 17:if(kn.t1=kn.sent,At=kn.t0.createObjectURL.call(kn.t0,kn.t1),!Nr.checkP5()){kn.next=23;break}return kn.next=22,this.loadAsync(At);case 22:rn=kn.sent;case 23:return kn.abrupt("return",{src:At,raws:L,image:rn});case 24:case"end":return kn.stop()}},k,this)}));return function(k){return E.apply(this,arguments)}}()}]),F}(),Wd=function(F,E){return new Sl(F,E)},Mp=function(){function F(E,k,w){pe()(this,F),this.model={},this.modelPath=E,this.modelInfo={},this.modelPathPrefix="",this.modelReady=!1,this.config={returnTensors:k.returnTensors||!1},this.ready=ot(this.loadModel(),w)}return Te()(F,[{key:"loadModel",value:function(){var E=K()(we.a.mark(function k(){var w,_,L,Y,ce,ve;return we.a.wrap(function(De){for(;;)switch(De.prev=De.next){case 0:return De.next=2,Gt.a.get(this.modelPath);case 2:return w=De.sent,_=w.data,this.modelInfo=_,L=this.modelPath.split("manifest.json"),Y=Tn()(L,1),ce=Y[0],ve=this.isAbsoluteURL(ce)?this.modelInfo.model:this.modelPathPrefix+this.modelInfo.model,De.next=9,I.loadLayersModel(ve);case 9:return this.model=De.sent,this.modelReady=!0,De.abrupt("return",this);case 12:case"end":return De.stop()}},k,this)}));return function(){return E.apply(this,arguments)}}()},{key:"generate",value:function(){var E=K()(we.a.mark(function k(w,_){return we.a.wrap(function(L){for(;;)switch(L.prev=L.next){case 0:return L.next=2,this.ready;case 2:return L.abrupt("return",ot(this.generateInternal(_),w));case 3:case"end":return L.stop()}},k,this)}));return function(k,w){return E.apply(this,arguments)}}()},{key:"compute",value:function(){var E=K()(we.a.mark(function k(w,_){var L,Y=this;return we.a.wrap(function(ce){for(;;)switch(ce.prev=ce.next){case 0:return L=I.tidy(function(){var ve;if(Array.isArray(_)===!1)ve=I.randomNormal([1,w]);else{for(var De=I.buffer([1,w]),Ce=0;Ce<w;Ce+=1)De.set(_[Ce],0,Ce);ve=De.toTensor()}return Y.model.predict(ve).squeeze().transpose([1,2,0]).div(I.scalar(2)).add(I.scalar(.5))}),ce.abrupt("return",L);case 2:case"end":return ce.stop()}},k)}));return function(k,w){return E.apply(this,arguments)}}()},{key:"generateInternal",value:function(){var E=K()(we.a.mark(function k(w){var _,L,Y,ce,ve,De,Ce,Xe,nt;return we.a.wrap(function(Et){for(;;)switch(Et.prev=Et.next){case 0:return _=this.modelInfo.modelLatentDim,Et.next=3,this.compute(_,w);case 3:return L=Et.sent,Et.next=6,I.browser.toPixels(L);case 6:return Y=Et.sent,ce=Tn()(L.shape,2),ve=ce[0],De=ce[1],Et.next=10,Nr.rawToBlob(Y,De,ve);case 10:if(Ce=Et.sent,!Nr.checkP5()){Et.next=15;break}return Et.next=14,Nr.blobToP5Image(Ce);case 14:Xe=Et.sent;case 15:return(nt={}).blob=Ce,nt.raw=Y,Nr.checkP5()&&(nt.image=Xe),this.config.returnTensors?nt.tensor=L:(nt.tensor=null,L.dispose()),Et.abrupt("return",nt);case 21:case"end":return Et.stop()}},k,this)}));return function(k){return E.apply(this,arguments)}}()},{key:"isAbsoluteURL",value:function(E){return!!new RegExp("^(?:[a-z]+:)?//","i").test(E)}}]),F}(),_l=function(F,E,k){var w,_={};if(typeof F!="string")throw new Error(`Please specify a path to a "manifest.json" file: 

         "models/face/manifest.json" 


         This "manifest.json" file should include:

         {
            "description": "DCGAN, human faces, 64x64",
            "model": "https://raw.githubusercontent.com/viztopia/ml5dcgan/master/model/model.json", // "https://github.com/viztopia/ml5dcgan/blob/master/model/model.json",
            "modelSize": 64,
            "modelLatentDim": 128 
         }
         `);typeof E=="function"?w=E:ke()(E)==="object"&&(_=E,w=k);var L=new Mp(F,_,w);return w?L:L.ready},jh=a(30),Lo=a.n(jh),Bh=a(132),Dl=0,Ph=function(){function F(E,k){pe()(this,F),this.ready=ot(this.loadModel(E),k)}return Te()(F,[{key:"loadModel",value:function(){var E=K()(we.a.mark(function k(w){var _,L,Y,ce;return we.a.wrap(function(ve){for(;;)switch(ve.prev=ve.next){case 0:if(_={model:null,metadata:null},w.toLowerCase()!=="moviereviews"){ve.next=6;break}_.model="https://storage.googleapis.com/tfjs-models/tfjs/sentiment_cnn_v1/model.json",_.metadata="https://storage.googleapis.com/tfjs-models/tfjs/sentiment_cnn_v1/metadata.json",ve.next=14;break;case 6:if(Pu.isAbsoluteURL(w)!==!0){ve.next=12;break}L=Pu.getModelPath(w),_.model="".concat(L,"/model.json"),_.metadata="".concat(L,"/metadata.json"),ve.next=14;break;case 12:return console.error("problem loading model"),ve.abrupt("return",this);case 14:return ve.next=16,I.loadLayersModel(_.model);case 16:return this.model=ve.sent,ve.next=19,Gt.a.get(_.metadata);case 19:return Y=ve.sent,ce=Y.data,this.indexFrom=ce.index_from,this.maxLen=ce.max_len,this.wordIndex=ce.word_index,this.vocabularySize=ce.vocabulary_size,ve.abrupt("return",this);case 26:case"end":return ve.stop()}},k,this)}));return function(k){return E.apply(this,arguments)}}()},{key:"predict",value:function(E){var k=this,w=function(ce,ve){var De=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"pre",Ce=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"pre",Xe=arguments.length>4&&arguments[4]!==void 0?arguments[4]:Dl;return ce.map(function(nt){if(nt.length>ve&&(Ce==="pre"?nt.splice(0,nt.length-ve):nt.splice(ve,nt.length-ve)),nt.length<ve){for(var Et=[],At=0;At<ve-nt.length;At+=1)Et.push(Xe);nt=De==="pre"?Et.concat(nt):nt.concat(Et)}return nt})}([E.trim().toLowerCase().replace(/[.,?!]/g,"").split(" ").map(function(ce){var ve=k.wordIndex[ce]+k.indexFrom;return ve>k.vocabularySize&&(ve=2),ve})],this.maxLen),_=I.tensor2d(w,[1,this.maxLen]),L=this.model.predict(_),Y=L.dataSync()[0];return L.dispose(),_.dispose(),{score:Y}}}]),F}(),Tl=function(F,E){return new Ph(F,E)};/**
    * @license
    * Copyright 2019 Google LLC. All Rights Reserved.
    * Licensed under the Apache License, Version 2.0 (the "License");
    * you may not use this file except in compliance with the License.
    * You may obtain a copy of the License at
    *
    * http://www.apache.org/licenses/LICENSE-2.0
    *
    * Unless required by applicable law or agreed to in writing, software
    * distributed under the License is distributed on an "AS IS" BASIS,
    * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    * See the License for the specific language governing permissions and
    * limitations under the License.
    * =============================================================================
    */function Kc(F,E,k,w){return new(k||(k=Promise))(function(_,L){function Y(De){try{ve(w.next(De))}catch(Ce){L(Ce)}}function ce(De){try{ve(w.throw(De))}catch(Ce){L(Ce)}}function ve(De){De.done?_(De.value):new k(function(Ce){Ce(De.value)}).then(Y,ce)}ve((w=w.apply(F,E||[])).next())})}function Ec(F,E){var k,w,_,L,Y={label:0,sent:function(){if(1&_[0])throw _[1];return _[1]},trys:[],ops:[]};return L={next:ce(0),throw:ce(1),return:ce(2)},typeof Symbol=="function"&&(L[Symbol.iterator]=function(){return this}),L;function ce(ve){return function(De){return function(Ce){if(k)throw new TypeError("Generator is already executing.");for(;Y;)try{if(k=1,w&&(_=2&Ce[0]?w.return:Ce[0]?w.throw||((_=w.return)&&_.call(w),0):w.next)&&!(_=_.call(w,Ce[1])).done)return _;switch(w=0,_&&(Ce=[2&Ce[0],_.value]),Ce[0]){case 0:case 1:_=Ce;break;case 4:return Y.label++,{value:Ce[1],done:!1};case 5:Y.label++,w=Ce[1],Ce=[0];continue;case 7:Ce=Y.ops.pop(),Y.trys.pop();continue;default:if(!(_=(_=Y.trys).length>0&&_[_.length-1])&&(Ce[0]===6||Ce[0]===2)){Y=0;continue}if(Ce[0]===3&&(!_||Ce[1]>_[0]&&Ce[1]<_[3])){Y.label=Ce[1];break}if(Ce[0]===6&&Y.label<_[1]){Y.label=_[1],_=Ce;break}if(_&&Y.label<_[2]){Y.label=_[2],Y.ops.push(Ce);break}_[2]&&Y.ops.pop(),Y.trys.pop();continue}Ce=E.call(F,Y)}catch(Xe){Ce=[6,Xe],w=0}finally{k=_=0}if(5&Ce[0])throw Ce[1];return{value:Ce[0]?Ce[1]:void 0,done:!0}}([ve,De])}}}var Lh=[["conv2d",2],["separableConv",1],["separableConv",2],["separableConv",1],["separableConv",2],["separableConv",1],["separableConv",2],["separableConv",1],["separableConv",1],["separableConv",1],["separableConv",1],["separableConv",1],["separableConv",1],["separableConv",1]],_f=[8,16,32];function Nl(F){Ye.util.assert(typeof F=="number",function(){return"outputStride is not a number"}),Ye.util.assert(_f.indexOf(F)>=0,function(){return"outputStride of "+F+" is invalid. It must be either 8, 16, or 32"})}var Cc={100:[["conv2d",2],["separableConv",1],["separableConv",2],["separableConv",1],["separableConv",2],["separableConv",1],["separableConv",2],["separableConv",1],["separableConv",1],["separableConv",1],["separableConv",1],["separableConv",1],["separableConv",2],["separableConv",1]],75:[["conv2d",2],["separableConv",1],["separableConv",2],["separableConv",1],["separableConv",2],["separableConv",1],["separableConv",2],["separableConv",1],["separableConv",1],["separableConv",1],["separableConv",1],["separableConv",1],["separableConv",1],["separableConv",1]],50:Lh,25:Lh},km=function(){function F(E,k){this.PREPROCESS_DIVISOR=Object(Ye.scalar)(127.5),this.ONE=Object(Ye.scalar)(1),this.modelWeights=E,this.convolutionDefinitions=k}return F.prototype.predict=function(E,k){var w=this,_=Object(Ye.div)(E.toFloat(),this.PREPROCESS_DIVISOR),L=Object(Ye.sub)(_,this.ONE);return function(Y,ce){var ve=1,De=1;return Y.map(function(Ce,Xe){var nt,Et,At=Ce[0],rn=Ce[1];return ve===ce?(nt=1,Et=De,De*=rn):(nt=rn,Et=1,ve*=rn),{blockId:Xe,convType:At,stride:nt,rate:Et,outputStride:ve}})}(this.convolutionDefinitions,k).reduce(function(Y,ce){var ve=ce.blockId,De=ce.stride,Ce=ce.convType,Xe=ce.rate;if(Ce==="conv2d")return w.conv(Y,De,ve);if(Ce==="separableConv")return w.separableConv(Y,De,ve,Xe);throw Error("Unknown conv type of "+Ce)},L)},F.prototype.convToOutput=function(E,k){return E.conv2d(this.weights(k),1,"same").add(this.convBias(k,!1))},F.prototype.conv=function(E,k,w){var _=this.weights("Conv2d_"+String(w));return E.conv2d(_,k,"same").add(this.convBias("Conv2d_"+String(w))).clipByValue(0,6)},F.prototype.separableConv=function(E,k,w,_){_===void 0&&(_=1);var L="Conv2d_"+String(w)+"_depthwise",Y="Conv2d_"+String(w)+"_pointwise";return E.depthwiseConv2D(this.depthwiseWeights(L),k,"same","NHWC",_).add(this.depthwiseBias(L)).clipByValue(0,6).conv2d(this.weights(Y),[1,1],"same").add(this.convBias(Y)).clipByValue(0,6)},F.prototype.weights=function(E){return this.modelWeights.weights(E)},F.prototype.convBias=function(E,k){return k===void 0&&(k=!0),this.modelWeights.convBias(E,k)},F.prototype.depthwiseBias=function(E){return this.modelWeights.depthwiseBias(E)},F.prototype.depthwiseWeights=function(E){return this.modelWeights.depthwiseWeights(E)},F.prototype.dispose=function(){this.modelWeights.dispose()},F}(),Fl="https://storage.googleapis.com/tfjs-models/savedmodel/",ra={1:{url:Fl+"posenet_mobilenet_100_partmap/",architecture:Cc[100]},.75:{url:Fl+"posenet_mobilenet_075_partmap/",architecture:Cc[75]},.5:{url:Fl+"posenet_mobilenet_050_partmap/",architecture:Cc[50]},.25:{url:Fl+"posenet_mobilenet_025_partmap/",architecture:Cc[25]}};function Sa(F,E){return Object(Ye.tidy)(function(){return F.greater(Object(Ye.scalar)(E)).toInt()})}function Ia(F,E){var k=E.shape,w=k[0],_=k[1],L=k[2];return Object(Ye.tidy)(function(){var Y=function(ve){var De=ve.shape[2],Ce=ve.argMax(2).reshape([-1]);return Object(Ye.oneHot)(Ce,De)}(E),ce=Object(Ye.range)(0,L,1,"int32").expandDims(1);return function(ve,De){return ve.mul(De)}(Y.matMul(ce).toInt().reshape([w,_]).add(Object(Ye.scalar)(1,"int32")),F).sub(Object(Ye.scalar)(1,"int32"))})}var Mi=function(){function F(E){this.graphModel=E}return F.prototype.weights=function(E){return this.getVariable("MobilenetV1/"+E+"/weights")},F.prototype.convBias=function(E,k){return this.getVariable("MobilenetV1/"+E+"/Conv2D_bias")},F.prototype.depthwiseBias=function(E){return this.getVariable("MobilenetV1/"+E+"/depthwise_bias")},F.prototype.depthwiseWeights=function(E){return this.getVariable("MobilenetV1/"+E+"/depthwise_weights")},F.prototype.getVariable=function(E){return this.graphModel.weights[""+E][0]},F.prototype.dispose=function(){this.graphModel.dispose()},F}();function Es(F){return F instanceof Ye.Tensor?F:Ye.browser.fromPixels(F)}function Oc(F,E,k){var w=E[0],_=E[1];k===void 0&&(k=!1);var L,Y,ce,ve,De,Ce,Xe=F.shape,nt=Xe[0],Et=Xe[1]/nt;if(Et>_/w){L=_;var At=w-(Y=Math.ceil(L/Et));ce=0,ve=0,De=Math.floor(At/2),Ce=w-(Y+De)}else{Y=w;var rn=_-(L=Math.ceil(w*Et));ce=Math.floor(rn/2),ve=_-(L+ce),De=0,Ce=0}return{resizedAndPadded:Object(Ye.tidy)(function(){var un;return un=k?F.reverse(1).resizeBilinear([Y,L]):F.resizeBilinear([Y,L]),Object(Ye.pad3d)(un,[[De,Ce],[ce,ve],[0,0]])}),paddedBy:[[De,Ce],[ce,ve]]}}function Ra(F,E,k,w){var _=E[0],L=E[1],Y=k[0],ce=k[1],ve=w[0],De=ve[0],Ce=ve[1],Xe=w[1],nt=Xe[0],Et=Xe[1];return Object(Ye.tidy)(function(){return function(At,rn,un){var kn=rn[0],En=rn[1],_n=un[0],Pn=_n[0],dn=_n[1],cr=un[1],yr=cr[0],br=cr[1],Br=At.shape,Or=Br[0],hi=Br[1],ki=Or-(Pn+dn),xi=hi-(yr+br);return Object(Ye.tidy)(function(){return Object(Ye.slice3d)(At,[Pn,yr,0],[ki,xi,At.shape[2]]).resizeBilinear([kn,En],!0)})}(F.resizeBilinear([Y,ce],!0),[_,L],[[De,Ce],[nt,Et]])})}var Ac=[353,257],Uu=function(){function F(E){this.mobileNet=E}return F.prototype.predictForSegmentation=function(E,k){var w=this;return k===void 0&&(k=16),Nl(k),Object(Ye.tidy)(function(){var _=w.mobileNet.predict(E,k);return w.mobileNet.convToOutput(_,"segment_2").sigmoid()})},F.prototype.predictForPartMap=function(E,k){var w=this;return k===void 0&&(k=16),Nl(k),Object(Ye.tidy)(function(){var _=w.mobileNet.predict(E,k),L=w.mobileNet.convToOutput(_,"segment_2"),Y=w.mobileNet.convToOutput(_,"part_heatmap_2");return{segmentScores:L.sigmoid(),partHeatmapScores:Y.sigmoid()}})},F.prototype.estimatePersonSegmentationActivation=function(E,k,w){var _=this;return k===void 0&&(k=16),w===void 0&&(w=.5),Nl(k),Object(Ye.tidy)(function(){var L=Es(E),Y=Oc(L,Ac),ce=Y.resizedAndPadded,ve=Y.paddedBy,De=_.predictForSegmentation(ce,k),Ce=ce.shape,Xe=Ce[0],nt=Ce[1],Et=L.shape;return Sa(Ra(De,[Et[0],Et[1]],[Xe,nt],ve).squeeze(),w)})},F.prototype.estimatePersonSegmentation=function(E,k,w){return k===void 0&&(k=16),w===void 0&&(w=.5),Kc(this,void 0,void 0,function(){var _,L,Y,ce,ve;return Ec(this,function(De){switch(De.label){case 0:return _=this.estimatePersonSegmentationActivation(E,k,w),L=_.shape,Y=L[0],ce=L[1],[4,_.data()];case 1:return ve=De.sent(),_.dispose(),[2,{height:Y,width:ce,data:ve}]}})})},F.prototype.estimatePartSegmentationActivation=function(E,k,w){var _=this;return k===void 0&&(k=16),w===void 0&&(w=.5),Nl(k),Object(Ye.tidy)(function(){var L=Es(E),Y=Oc(L,Ac),ce=Y.resizedAndPadded,ve=Y.paddedBy,De=_.predictForPartMap(ce,k),Ce=De.segmentScores,Xe=De.partHeatmapScores,nt=ce.shape,Et=nt[0],At=nt[1],rn=L.shape,un=rn[0],kn=rn[1],En=Ra(Ce,[un,kn],[Et,At],ve),_n=Ra(Xe,[un,kn],[Et,At],ve);return Ia(Sa(En.squeeze(),w),_n)})},F.prototype.estimatePartSegmentation=function(E,k,w){return k===void 0&&(k=16),w===void 0&&(w=.5),Kc(this,void 0,void 0,function(){var _,L,Y,ce,ve;return Ec(this,function(De){switch(De.label){case 0:return _=this.estimatePartSegmentationActivation(E,k,w),L=_.shape,Y=L[0],ce=L[1],[4,_.data()];case 1:return ve=De.sent(),_.dispose(),[2,{height:Y,width:ce,data:ve}]}})})},F.prototype.dispose=function(){this.mobileNet.dispose()},F}();function Df(F){return F===void 0&&(F=.75),Kc(this,void 0,void 0,function(){var E,k;return Ec(this,function(w){switch(w.label){case 0:if(Ye==null)throw new Error("Cannot find TensorFlow.js. If you are using a <script> tag, please also include @tensorflow/tfjs on the page before using this model.");return E=Object.keys(ra),Ye.util.assert(typeof F=="number",function(){return"got multiplier type of "+typeof F+" when it should be a number."}),Ye.util.assert(E.indexOf(F.toString())>=0,function(){return"invalid multiplier value of "+F+".  No checkpoint exists for that multiplier. Must be one of "+E.join(",")+"."}),[4,Tf.load(F)];case 1:return k=w.sent(),[2,new Uu(k)]}})})}var Tf={load:function(F){return Kc(void 0,void 0,void 0,function(){var E,k,w,_;return Ec(this,function(L){switch(L.label){case 0:return E=ra[F],k=E.url,[4,Object(jt.loadGraphModel)(k+"model.json")];case 1:return w=L.sent(),_=new Mi(w),[2,new km(_,E.architecture)]}})})}};function Xc(F,E){E===void 0&&(E=!0);for(var k=F.width,w=F.height,_=F.data,L=new Uint8ClampedArray(k*w*4),Y=0;Y<w*k;++Y){var ce=255*(E?1-_[Y]:_[Y]),ve=4*Y;L[ve+0]=0,L[ve+1]=0,L[ve+2]=0,L[ve+3]=Math.round(ce)}return new ImageData(L,k,w)}function Vd(F,E){for(var k=F.width,w=F.height,_=F.data,L=new Uint8ClampedArray(k*w*4),Y=0;Y<w*k;++Y){var ce=Math.round(_[Y]),ve=4*Y;if(ce===-1)L[ve+0]=255,L[ve+1]=255,L[ve+2]=255,L[ve+3]=255;else{var De=E[ce];if(!De)throw new Error("No color could be found for part id "+ce);L[ve+0]=De[0],L[ve+1]=De[1],L[ve+2]=De[2],L[ve+3]=255}}return new ImageData(L,k,w)}var Wu={multiplier:.75,outputStride:16,segmentationThreshold:.5,palette:{leftFace:{id:0,color:[110,64,170]},rightFace:{id:1,color:[106,72,183]},rightUpperLegFront:{id:2,color:[100,81,196]},rightLowerLegBack:{id:3,color:[92,91,206]},rightUpperLegBack:{id:4,color:[84,101,214]},leftLowerLegFront:{id:5,color:[75,113,221]},leftUpperLegFront:{id:6,color:[66,125,224]},leftUpperLegBack:{id:7,color:[56,138,226]},leftLowerLegBack:{id:8,color:[48,150,224]},rightFeet:{id:9,color:[40,163,220]},rightLowerLegFront:{id:10,color:[33,176,214]},leftFeet:{id:11,color:[29,188,205]},torsoFront:{id:12,color:[26,199,194]},torsoBack:{id:13,color:[26,210,182]},rightUpperArmFront:{id:14,color:[28,219,169]},rightUpperArmBack:{id:15,color:[33,227,155]},rightLowerArmBack:{id:16,color:[41,234,141]},leftLowerArmFront:{id:17,color:[51,240,128]},leftUpperArmFront:{id:18,color:[64,243,116]},leftUpperArmBack:{id:19,color:[79,246,105]},leftLowerArmBack:{id:20,color:[96,247,97]},rightHand:{id:21,color:[115,246,91]},rightLowerArmFront:{id:22,color:[134,245,88]},leftHand:{id:23,color:[155,243,88]}},returnTensors:!1},Em=function(){function F(E,k,w){pe()(this,F),this.video=E,this.model=null,this.modelReady=!1,this.modelPath="",this.config={multiplier:k.multiplier||Wu.multiplier,outputStride:k.outputStride||Wu.outputStride,segmentationThreshold:k.segmentationThreshold||Wu.segmentationThreshold,palette:k.palette||Wu.palette,returnTensors:k.returnTensors||Wu.returnTensors},this.ready=ot(this.loadModel(),w)}return Te()(F,[{key:"loadModel",value:function(){var E=K()(we.a.mark(function k(){return we.a.wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return w.next=2,Df(this.config.multiplier);case 2:return this.model=w.sent,this.modelReady=!0,w.abrupt("return",this);case 5:case"end":return w.stop()}},k,this)}));return function(){return E.apply(this,arguments)}}()},{key:"p5Color2RGB",value:function(E){var k=/\(([^)]+)\)/.exec(E.toString("rgb"))[1].split(","),w=Tn()(k,3);return[w[0],w[1],w[2]]}},{key:"convertToP5Image",value:function(){var E=K()(we.a.mark(function k(w,_,L){var Y,ce;return we.a.wrap(function(ve){for(;;)switch(ve.prev=ve.next){case 0:return ve.next=2,Nr.rawToBlob(w,_,L);case 2:return Y=ve.sent,ve.next=5,Nr.blobToP5Image(Y);case 5:return ce=ve.sent,ve.abrupt("return",ce);case 7:case"end":return ve.stop()}},k)}));return function(k,w,_){return E.apply(this,arguments)}}()},{key:"bodyPartsSpec",value:function(E){var k=this,w=E!==void 0||Object.keys(E).length>=24?E:this.config.palette,_=Nr.p5Instance;return _&&w!==void 0&&Object.keys(w).length>=24&&Object.keys(w).forEach(function(L){w[L].color instanceof _.Color&&(w[L].color=k.p5Color2RGB(w[L].color))}),w}},{key:"segmentWithPartsInternal",value:function(){var E=K()(we.a.mark(function k(w,_){var L,Y,ce,ve,De,Ce,Xe,nt,Et,At,rn,un=this;return we.a.wrap(function(kn){for(;;)switch(kn.prev=kn.next){case 0:return kn.next=2,this.ready;case 2:return kn.next=4,I.nextFrame();case 4:if(!this.video||this.video.readyState!==0){kn.next=7;break}return kn.next=7,new Promise(function(En){un.video.onloadeddata=function(){return En()}});case 7:return this.config.palette=_.palette||this.config.palette,this.config.outputStride=_.outputStride||this.config.outputStride,this.config.segmentationThreshold=_.segmentationThreshold||this.config.segmentationThreshold,kn.next=12,this.model.estimatePartSegmentation(w,this.config.outputStride,this.config.segmentationThreshold);case 12:return L=kn.sent,Y=this.bodyPartsSpec(this.config.palette),ce=Object.keys(Y).map(function(En){return Y[En].color}),(ve={segmentation:L,raw:{personMask:null,backgroundMask:null,partMask:null},tensor:{personMask:null,backgroundMask:null,partMask:null},personMask:null,backgroundMask:null,partMask:null,bodyParts:Y}).raw.backgroundMask=Xc(L,!0),ve.raw.personMask=Xc(L,!1),ve.raw.partMask=Vd(L,ce),De=I.tidy(function(){var En=I.browser.fromPixels(w),_n=I.ones([L.height,L.width,1]).tile([1,1,1]).mul(255);En=En.concat(_n,2);var Pn=I.tensor(L.data,[L.height,L.width,1]),dn=I.tensor(L.data,[L.height,L.width,1]),cr=I.tensor(Lo()(ve.raw.partMask.data),[L.height,L.width,4]);return{personMask:Pn=I.cast(Pn.add(.2).sign().relu().mul(En),"int32"),backgroundMask:dn=I.cast(dn.add(.2).sign().neg().relu().mul(En),"int32"),partMask:cr=I.cast(cr,"int32")}}),Ce=De.personMask,Xe=De.backgroundMask,nt=De.partMask,kn.next=22,I.browser.toPixels(Ce);case 22:return Et=kn.sent,kn.next=25,I.browser.toPixels(Xe);case 25:return At=kn.sent,kn.next=28,I.browser.toPixels(nt);case 28:if(rn=kn.sent,ve.personMask=Et,ve.backgroundMask=At,ve.partMask=rn,!Nr.checkP5()){kn.next=42;break}return kn.next=35,this.convertToP5Image(Et,L.width,L.height);case 35:return ve.personMask=kn.sent,kn.next=38,this.convertToP5Image(At,L.width,L.height);case 38:return ve.backgroundMask=kn.sent,kn.next=41,this.convertToP5Image(rn,L.width,L.height);case 41:ve.partMask=kn.sent;case 42:return this.config.returnTensors?(ve.tensor.personMask=Ce,ve.tensor.backgroundMask=Xe,ve.tensor.partMask=nt):(Ce.dispose(),Xe.dispose(),nt.dispose()),kn.abrupt("return",ve);case 44:case"end":return kn.stop()}},k,this)}));return function(k,w){return E.apply(this,arguments)}}()},{key:"segmentWithParts",value:function(){var E=K()(we.a.mark(function k(w,_,L){var Y,ce,ve;return we.a.wrap(function(De){for(;;)switch(De.prev=De.next){case 0:if(Y=this.video,ve=this.config,typeof w!="function"){De.next=7;break}Y=this.video,ce=w,De.next=25;break;case 7:if(!(w instanceof HTMLImageElement||w instanceof HTMLCanvasElement||w instanceof HTMLVideoElement||w instanceof ImageData)){De.next=11;break}Y=w,De.next=25;break;case 11:if(ke()(w)!=="object"||!(w.elt instanceof HTMLImageElement||w.elt instanceof HTMLCanvasElement||w.elt instanceof ImageData)){De.next=15;break}Y=w.elt,De.next=25;break;case 15:if(!(ke()(w)==="object"&&w.canvas instanceof HTMLCanvasElement)){De.next=19;break}Y=w.canvas,De.next=25;break;case 19:if(!(ke()(w)==="object"&&w.elt instanceof HTMLVideoElement)){De.next=23;break}Y=w.elt,De.next=25;break;case 23:if(this.video instanceof HTMLVideoElement){De.next=25;break}throw new Error("No input image provided. If you want to classify a video, pass the video element in the constructor. ");case 25:return ke()(_)==="object"?ve=_:typeof _=="function"&&(ce=_),typeof L=="function"&&(ce=L),De.abrupt("return",ot(this.segmentWithPartsInternal(Y,ve),ce));case 28:case"end":return De.stop()}},k,this)}));return function(k,w,_){return E.apply(this,arguments)}}()},{key:"segmentInternal",value:function(){var E=K()(we.a.mark(function k(w,_){var L,Y,ce,ve,De,Ce,Xe,nt=this;return we.a.wrap(function(Et){for(;;)switch(Et.prev=Et.next){case 0:return Et.next=2,this.ready;case 2:return Et.next=4,I.nextFrame();case 4:if(!this.video||this.video.readyState!==0){Et.next=7;break}return Et.next=7,new Promise(function(At){nt.video.onloadeddata=function(){return At()}});case 7:return this.config.outputStride=_.outputStride||this.config.outputStride,this.config.segmentationThreshold=_.segmentationThreshold||this.config.segmentationThreshold,Et.next=11,this.model.estimatePersonSegmentation(w,this.config.outputStride,this.config.segmentationThreshold);case 11:return L=Et.sent,(Y={segmentation:L,raw:{personMask:null,backgroundMask:null},tensor:{personMask:null,backgroundMask:null},personMask:null,backgroundMask:null}).raw.backgroundMask=Xc(L,!0),Y.raw.personMask=Xc(L,!1),ce=I.tidy(function(){var At=I.browser.fromPixels(w),rn=I.ones([L.height,L.width,1]).tile([1,1,1]).mul(255);At=At.concat(rn,2);var un=I.tensor(L.data,[L.height,L.width,1]),kn=I.tensor(L.data,[L.height,L.width,1]);return{personMask:un=I.cast(un.neg().add(1).mul(At),"int32"),backgroundMask:kn=I.cast(kn.mul(At),"int32")}}),ve=ce.personMask,De=ce.backgroundMask,Et.next=18,I.browser.toPixels(ve);case 18:return Ce=Et.sent,Et.next=21,I.browser.toPixels(De);case 21:if(Xe=Et.sent,!Nr.checkP5()){Et.next=31;break}return Et.next=25,this.convertToP5Image(Ce,L.width,L.height);case 25:return Y.personMask=Et.sent,Et.next=28,this.convertToP5Image(Xe,L.width,L.height);case 28:Y.backgroundMask=Et.sent,Et.next=33;break;case 31:Y.personMask=Ce,Y.backgroundMask=Xe;case 33:return this.config.returnTensors?(Y.tensor.personMask=ve,Y.tensor.backgroundMask=De):(ve.dispose(),De.dispose()),Et.abrupt("return",Y);case 35:case"end":return Et.stop()}},k,this)}));return function(k,w){return E.apply(this,arguments)}}()},{key:"segment",value:function(){var E=K()(we.a.mark(function k(w,_,L){var Y,ce,ve;return we.a.wrap(function(De){for(;;)switch(De.prev=De.next){case 0:if(Y=this.video,ve=this.config,typeof w!="function"){De.next=7;break}Y=this.video,ce=w,De.next=25;break;case 7:if(!(w instanceof HTMLImageElement||w instanceof HTMLCanvasElement||w instanceof HTMLVideoElement||w instanceof ImageData)){De.next=11;break}Y=w,De.next=25;break;case 11:if(ke()(w)!=="object"||!(w.elt instanceof HTMLImageElement||w.elt instanceof HTMLCanvasElement||w.elt instanceof ImageData)){De.next=15;break}Y=w.elt,De.next=25;break;case 15:if(!(ke()(w)==="object"&&w.canvas instanceof HTMLCanvasElement)){De.next=19;break}Y=w.canvas,De.next=25;break;case 19:if(!(ke()(w)==="object"&&w.elt instanceof HTMLVideoElement)){De.next=23;break}Y=w.elt,De.next=25;break;case 23:if(this.video instanceof HTMLVideoElement){De.next=25;break}throw new Error("No input image provided. If you want to classify a video, pass the video element in the constructor. ");case 25:return ke()(_)==="object"?ve=_:typeof _=="function"&&(ce=_),typeof L=="function"&&(ce=L),De.abrupt("return",ot(this.segmentInternal(Y,ve),ce));case 28:case"end":return De.stop()}},k,this)}));return function(k,w,_){return E.apply(this,arguments)}}()}]),F}(),qd=function(F,E,k){var w,_={},L=k;F instanceof HTMLVideoElement?w=F:ke()(F)==="object"&&F.elt instanceof HTMLVideoElement?w=F.elt:ke()(F)==="object"?_=F:typeof F=="function"&&(L=F),ke()(E)==="object"?_=E:typeof E=="function"&&(L=E);var Y=new Em(w,_,L);return L?Y:Y.ready},Il=function(){var F=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,E=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return Math.random()*(E-F)+F},jp=function(){var F,E,k,w,_,L,Y=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,ce=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;if(L)F=E,L=!1;else{do _=(k=Il(0,2)-1)*k+(w=Il(0,2)-1)*w;while(_>=1);F=k*(_=Math.sqrt(-2*Math.log(_)/_)),E=w*_,L=!0}return F*ce+Y},Nf=function(F,E){var k;if((arguments.length>2&&arguments[2]!==void 0&&arguments[2])===!0)k=Array.from({length:E},function(){return F[Math.floor(Math.random()*F.length)]});else{if(E>F.length)throw new RangeError("Sample size must be less than or equal to array length when sampling without replacement.");k=F.map(function(w){return[w,Math.random()]}).sort(function(w,_){return w[1]<_[1]?-1:1}).slice(0,E).map(function(w){return w[0]})}return k},Yc=function(){function F(){pe()(this,F),this.isTrained=!1,this.isCompiled=!1,this.isLayered=!1,this.model=null,this.init=this.init.bind(this),this.createModel=this.createModel.bind(this),this.addLayer=this.addLayer.bind(this),this.compile=this.compile.bind(this),this.setOptimizerFunction=this.setOptimizerFunction.bind(this),this.train=this.train.bind(this),this.trainInternal=this.trainInternal.bind(this),this.predict=this.predict.bind(this),this.classify=this.classify.bind(this),this.save=this.save.bind(this),this.load=this.load.bind(this),this.init()}return Te()(F,[{key:"init",value:function(){this.createModel()}},{key:"createModel",value:function(){switch((arguments.length>0&&arguments[0]!==void 0?arguments[0]:"sequential").toLowerCase()){case"sequential":default:return this.model=I.sequential(),this.model}}},{key:"addLayer",value:function(E){var k=E||{};this.model.add(k),this.model.layers.length>=2&&(this.isLayered=!0)}},{key:"compile",value:function(E){this.model.compile(E),this.isCompiled=!0}},{key:"setOptimizerFunction",value:function(E,k){return k.call(this,E)}},{key:"train",value:function(E,k){return ot(this.trainInternal(E),k)}},{key:"trainInternal",value:function(){var E=K()(we.a.mark(function k(w){var _,L,Y,ce,ve,De,Ce,Xe;return we.a.wrap(function(nt){for(;;)switch(nt.prev=nt.next){case 0:return L=(_=w).inputs,Y=_.outputs,ce=_.batchSize,ve=_.epochs,De=_.shuffle,Ce=_.validationSplit,Xe=_.whileTraining,nt.next=6,this.model.fit(L,Y,{batchSize:ce,epochs:ve,shuffle:De,validationSplit:Ce,callbacks:Xe});case 6:L.dispose(),Y.dispose(),this.isTrained=!0;case 9:case"end":return nt.stop()}},k,this)}));return function(k){return E.apply(this,arguments)}}()},{key:"predictSync",value:function(E){var k=this,w=I.tidy(function(){return k.model.predict(E)}),_=w.arraySync();return w.dispose(),E.dispose(),_}},{key:"predict",value:function(){var E=K()(we.a.mark(function k(w){var _,L,Y=this;return we.a.wrap(function(ce){for(;;)switch(ce.prev=ce.next){case 0:return _=I.tidy(function(){return Y.model.predict(w)}),ce.next=3,_.array();case 3:return L=ce.sent,_.dispose(),w.dispose(),ce.abrupt("return",L);case 7:case"end":return ce.stop()}},k)}));return function(k){return E.apply(this,arguments)}}()},{key:"classify",value:function(){var E=K()(we.a.mark(function k(w){return we.a.wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return _.abrupt("return",this.predict(w));case 1:case"end":return _.stop()}},k,this)}));return function(k){return E.apply(this,arguments)}}()},{key:"classifySync",value:function(E){return this.predictSync(E)}},{key:"save",value:function(){var E=K()(we.a.mark(function k(w,_){var L,Y,ce=this;return we.a.wrap(function(ve){for(;;)switch(ve.prev=ve.next){case 0:typeof w=="function"?(L="model",Y=w):typeof w=="string"?(L=w,typeof _=="function"&&(Y=_)):L="model",this.model.save(I.io.withSaveHandler(function(){var De=K()(we.a.mark(function Ce(Xe){return we.a.wrap(function(nt){for(;;)switch(nt.prev=nt.next){case 0:return ce.weightsManifest={modelTopology:Xe.modelTopology,weightsManifest:[{paths:["./".concat(L,".weights.bin")],weights:Xe.weightSpecs}]},nt.next=3,jr(Xe.weightData,"".concat(L,".weights.bin"),"application/octet-stream");case 3:return nt.next=5,jr(JSON.stringify(ce.weightsManifest),"".concat(L,".json"),"text/plain");case 5:Y&&Y();case 6:case"end":return nt.stop()}},Ce)}));return function(Ce){return De.apply(this,arguments)}}()));case 2:case"end":return ve.stop()}},k,this)}));return function(k,w){return E.apply(this,arguments)}}()},{key:"load",value:function(){var E=K()(we.a.mark(function k(){var w,_,L,Y,ce,ve,De,Ce,Xe,nt,Et,At=arguments;return we.a.wrap(function(rn){for(;;)switch(rn.prev=rn.next){case 0:if(w=At.length>0&&At[0]!==void 0?At[0]:null,_=At.length>1?At[1]:void 0,!(w instanceof FileList)){rn.next=13;break}return rn.next=5,Promise.all(Array.from(w).map(function(){var un=K()(we.a.mark(function kn(En){var _n;return we.a.wrap(function(Pn){for(;;)switch(Pn.prev=Pn.next){case 0:if(!En.name.includes(".json")||En.name.includes("_meta")){Pn.next=4;break}return Pn.abrupt("return",{name:"model",file:En});case 4:if(!En.name.includes(".json")||!En.name.includes("_meta.json")){Pn.next=11;break}return Pn.next=7,En.text();case 7:return _n=Pn.sent,Pn.abrupt("return",{name:"metadata",file:_n});case 11:if(!En.name.includes(".bin")){Pn.next=13;break}return Pn.abrupt("return",{name:"weights",file:En});case 13:return Pn.abrupt("return",{name:null,file:null});case 14:case"end":return Pn.stop()}},kn)}));return function(kn){return un.apply(this,arguments)}}()));case 5:return L=rn.sent,Y=L.find(function(un){return un.name==="model"}).file,ce=L.find(function(un){return un.name==="weights"}).file,rn.next=10,I.loadLayersModel(I.io.browserFiles([Y,ce]));case 10:this.model=rn.sent,rn.next=32;break;case 13:if(!(w instanceof Object)){rn.next=29;break}return rn.next=16,Gt.a.get(w.model,{responseType:"text"});case 16:return ve=rn.sent,De=JSON.stringify(ve.data),Ce=new File([De],"model.json",{type:"application/json"}),rn.next=21,Gt.a.get(w.weights,{responseType:"blob"});case 21:return Xe=rn.sent,nt=Xe.data,Et=new File([nt],"model.weights.bin",{type:"application/macbinary"}),rn.next=26,I.loadLayersModel(I.io.browserFiles([Ce,Et]));case 26:this.model=rn.sent,rn.next=32;break;case 29:return rn.next=31,I.loadLayersModel(w);case 31:this.model=rn.sent;case 32:return this.isCompiled=!0,this.isLayered=!0,this.isTrained=!0,_&&_(),rn.abrupt("return",this.model);case 37:case"end":return rn.stop()}},k,this)}));return function(){return E.apply(this,arguments)}}()},{key:"dispose",value:function(){this.model.dispose()}},{key:"mutate",value:function(){var E=this,k=arguments.length>0&&arguments[0]!==void 0?arguments[0]:.1,w=arguments.length>1?arguments[1]:void 0;I.tidy(function(){for(var _=E.model.getWeights(),L=[],Y=0;Y<_.length;Y+=1){for(var ce=_[Y],ve=_[Y].shape,De=ce.dataSync().slice(),Ce=0;Ce<De.length;Ce+=1)Math.random()<k&&(De[Ce]=w?w(De[Ce]):Math.min(Math.max(De[Ce]+jp(),-1),1));var Xe=I.tensor(De,ve);L[Y]=Xe}E.model.setWeights(L)})}},{key:"crossover",value:function(E){var k=this;return I.tidy(function(){for(var w=k.model.getWeights(),_=E.model.getWeights(),L=[],Y=0;Y<w.length;Y+=1){for(var ce=w[Y],ve=_[Y],De=w[Y].shape,Ce=ce.dataSync().slice(),Xe=ve.dataSync().slice(),nt=0;nt<Ce.length;nt+=1)Math.random()<.5&&(Ce[nt]=Xe[nt]);var Et=I.tensor(Ce,De);L[Y]=Et}k.model.setWeights(L)})}}]),F}();function Hd(F,E){var k=Object.keys(F);if(Object.getOwnPropertySymbols){var w=Object.getOwnPropertySymbols(F);E&&(w=w.filter(function(_){return Object.getOwnPropertyDescriptor(F,_).enumerable})),k.push.apply(k,w)}return k}function zh(F){for(var E=1;E<arguments.length;E++){var k=arguments[E]!=null?arguments[E]:{};E%2?Hd(Object(k),!0).forEach(function(w){ee()(F,w,k[w])}):Object.getOwnPropertyDescriptors?Object.defineProperties(F,Object.getOwnPropertyDescriptors(k)):Hd(Object(k)).forEach(function(w){Object.defineProperty(F,w,Object.getOwnPropertyDescriptor(k,w))})}return F}var ba=new(function(){function F(E){pe()(this,F),this.options=E||{}}return Te()(F,[{key:"normalizeValue",value:function(E,k,w){return(E-k)/(w-k)}},{key:"unnormalizeValue",value:function(E,k,w){return E*(w-k)+k}},{key:"getMin",value:function(E){return E.reduce(function(k,w){return Math.min(k,w)})}},{key:"getMax",value:function(E){return E.reduce(function(k,w){return Math.max(k,w)})}},{key:"isJsonOrString",value:function(E){try{JSON.parse(E)}catch{return!1}return!0}},{key:"zipArrays",value:function(E,k){return E.length!==k.length?(console.error("arrays do not have the same length"),[]):Lo()(new Array(E.length).fill(null)).map(function(w,_){return zh(zh({},E[_]),k[_])})}},{key:"createLabelsFromArrayValues",value:function(E,k){var w;return Array.isArray(E)&&(w=E.map(function(_,L){return"".concat(k,"_").concat(L)})),w}},{key:"formatDataAsObject",value:function(E,k){var w={};if(Array.isArray(E))return E.forEach(function(_,L){var Y=k[L];w[Y]=_}),w;if(ke()(E)==="object")return w=E;throw new Error("input provided is not supported or does not match your output label specifications")}},{key:"getDataType",value:function(E){var k=ke()(E);return k==="object"&&Array.isArray(E)&&(k="array"),k}}]),F}());function Rl(F,E){var k=Object.keys(F);if(Object.getOwnPropertySymbols){var w=Object.getOwnPropertySymbols(F);E&&(w=w.filter(function(_){return Object.getOwnPropertyDescriptor(F,_).enumerable})),k.push.apply(k,w)}return k}function Cs(F){for(var E=1;E<arguments.length;E++){var k=arguments[E]!=null?arguments[E]:{};E%2?Rl(Object(k),!0).forEach(function(w){ee()(F,w,k[w])}):Object.getOwnPropertyDescriptors?Object.defineProperties(F,Object.getOwnPropertyDescriptors(k)):Rl(Object(k)).forEach(function(w){Object.defineProperty(F,w,Object.getOwnPropertyDescriptor(k,w))})}return F}var Ml=function(){function F(){pe()(this,F),this.meta={inputUnits:null,outputUnits:null,inputs:{},outputs:{},isNormalized:!1},this.isMetadataReady=!1,this.isWarmedUp=!1,this.data={raw:[]},this.createMetadata=this.createMetadata.bind(this),this.getDataStats=this.getDataStats.bind(this),this.getInputMetaStats=this.getInputMetaStats.bind(this),this.getDataUnits=this.getDataUnits.bind(this),this.getInputMetaUnits=this.getInputMetaUnits.bind(this),this.getDTypesFromData=this.getDTypesFromData.bind(this),this.addData=this.addData.bind(this),this.convertRawToTensors=this.convertRawToTensors.bind(this),this.normalizeDataRaw=this.normalizeDataRaw.bind(this),this.normalizeInputData=this.normalizeInputData.bind(this),this.normalizeArray=this.normalizeArray.bind(this),this.unnormalizeArray=this.unnormalizeArray.bind(this),this.applyOneHotEncodingsToDataRaw=this.applyOneHotEncodingsToDataRaw.bind(this),this.getDataOneHot=this.getDataOneHot.bind(this),this.getInputMetaOneHot=this.getInputMetaOneHot.bind(this),this.createOneHotEncodings=this.createOneHotEncodings.bind(this),this.loadDataFromUrl=this.loadDataFromUrl.bind(this),this.loadJSON=this.loadJSON.bind(this),this.loadCSV=this.loadCSV.bind(this),this.loadBlob=this.loadBlob.bind(this),this.loadData=this.loadData.bind(this),this.saveData=this.saveData.bind(this),this.saveMeta=this.saveMeta.bind(this),this.loadMeta=this.loadMeta.bind(this),this.findEntries=this.findEntries.bind(this),this.formatRawData=this.formatRawData.bind(this),this.csvToJSON=this.csvToJSON.bind(this)}return Te()(F,[{key:"createMetadata",value:function(E){var k=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;return this.getDTypesFromData(E),this.getDataStats(E),this.getDataOneHot(E),this.getDataUnits(E,k),this.isMetadataReady=!0,Cs({},this.meta)}},{key:"getDataStats",value:function(E){var k=Object.assign({},this.meta),w=this.getInputMetaStats(E,k.inputs,"xs"),_=this.getInputMetaStats(E,k.outputs,"ys");return k.inputs=w,k.outputs=_,this.meta=Cs(Cs({},this.meta),k),k}},{key:"getInputMetaStats",value:function(E,k,w){var _=Object.assign({},k);return Object.keys(_).forEach(function(L){if(_[L].dtype==="string")_[L].min=0,_[L].max=1;else if(_[L].dtype==="number"){var Y=E.map(function(ve){return ve[w][L]});_[L].min=ba.getMin(Y),_[L].max=ba.getMax(Y)}else if(_[L].dtype==="array"){var ce=E.map(function(ve){return ve[w][L]}).flat();_[L].min=ba.getMin(ce),_[L].max=ba.getMax(ce)}}),_}},{key:"getDataUnits",value:function(E){var k,w=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,_=w!==null?w:void 0,L=Object.assign({},this.meta);k=_||[this.getInputMetaUnits(E,L.inputs)].flat();var Y=this.getInputMetaUnits(E,L.outputs);return L.inputUnits=k,L.outputUnits=Y,this.meta=Cs(Cs({},this.meta),L),L}},{key:"getInputMetaUnits",value:function(E,k){var w=0,_=Object.assign({},k);return Object.entries(_).forEach(function(L){var Y=L[1].dtype;if(Y==="number")w+=1;else if(Y==="string"){var ce=L[1].uniqueValues.length;w+=ce}else Y==="array"&&(w=[])}),w}},{key:"getDTypesFromData",value:function(E){var k=Cs(Cs({},this.meta),{},{inputs:{},outputs:{}}),w=E[0],_=Object.keys(w.xs),L=Object.keys(w.ys);return _.forEach(function(Y){k.inputs[Y]={dtype:ba.getDataType(w.xs[Y])}}),L.forEach(function(Y){k.outputs[Y]={dtype:ba.getDataType(w.ys[Y])}}),this.meta=k,k}},{key:"addData",value:function(E,k){this.data.raw.push({xs:E,ys:k})}},{key:"convertRawToTensors",value:function(E){var k=Object.assign({},this.meta),w=E.length;return I.tidy(function(){var _=[],L=[];return E.forEach(function(Y){var ce=Object.keys(k.inputs).map(function(De){return Y.xs[De]}).flat();_.push(ce);var ve=Object.keys(k.outputs).map(function(De){return Y.ys[De]}).flat();L.push(ve)}),{inputs:I.tensor(_.flat(),[w].concat(Lo()(k.inputUnits))),outputs:I.tensor(L.flat(),[w,k.outputUnits])}})}},{key:"normalizeDataRaw",value:function(E){var k=Object.assign({},this.meta),w=this.normalizeInputData(E,k.inputs,"xs"),_=this.normalizeInputData(E,k.outputs,"ys");return ba.zipArrays(w,_)}},{key:"normalizeInputData",value:function(E,k,w){var _=this,L=E.length,Y=Object.assign({},k),ce={};return Object.keys(Y).forEach(function(ve){var De={min:Y[ve].min,max:Y[ve].max},Ce=E.map(function(Xe){return Xe[w][ve]});Y[ve].dtype==="string"?(De.legend=Y[ve].legend,ce[ve]=_.normalizeArray(Ce,De)):Y[ve].dtype==="number"?ce[ve]=_.normalizeArray(Ce,De):Y[ve].dtype==="array"&&(ce[ve]=Ce.map(function(Xe){return _.normalizeArray(Xe,De)}))}),Lo()(new Array(L).fill(null)).map(function(ve,De){var Ce=ee()({},w,{});return Object.keys(Y).forEach(function(Xe){Ce[w][Xe]=ce[Xe][De]}),Ce})}},{key:"normalizeArray",value:function(E,k){var w=k.min,_=k.max;if(k.legend)return E.map(function(L){return k.legend[L]?k.legend[L]:L});if(E.every(function(L){return typeof L=="number"}))return E.map(function(L){return ba.normalizeValue(L,w,_)});throw new Error("error in inputArray of normalizeArray() function")}},{key:"unnormalizeArray",value:function(E,k){var w=k.min,_=k.max;if(k.legend)return E.map(function(L){var Y;return Object.entries(k.legend).forEach(function(ce){var ve=ce[0],De=ce[1];L.map(function(Ce,Xe){return Ce===De[Xe]}).every(function(Ce){return Ce===!0})&&(Y=ve)}),Y});if(E.every(function(L){return typeof L=="number"}))return E.map(function(L){return ba.unnormalizeValue(L,w,_)});throw new Error("error in inputArray of normalizeArray() function")}},{key:"applyOneHotEncodingsToDataRaw",value:function(E){var k=Object.assign({},this.meta);return E.map(function(w){var _=Cs({},w.xs),L=Cs({},w.ys);return Object.keys(k.inputs).forEach(function(Y){k.inputs[Y].legend&&(_[Y]=k.inputs[Y].legend[w.xs[Y]])}),Object.keys(k.outputs).forEach(function(Y){k.outputs[Y].legend&&(L[Y]=k.outputs[Y].legend[w.ys[Y]])}),{xs:_,ys:L}})}},{key:"getDataOneHot",value:function(E){var k=Object.assign({},this.meta),w=this.getInputMetaOneHot(E,k.inputs,"xs"),_=this.getInputMetaOneHot(E,k.outputs,"ys");return k.inputs=w,k.outputs=_,this.meta=Cs(Cs({},this.meta),k),k}},{key:"getInputMetaOneHot",value:function(E,k,w){var _=this,L=Object.assign({},k);return Object.entries(L).forEach(function(Y){var ce=Y[0];if(Y[1].dtype==="string"){var ve=Lo()(new Set(E.map(function(Ce){return Ce[w][ce]}))),De=_.createOneHotEncodings(ve);L[ce]=Cs(Cs({},L[ce]),De)}}),L}},{key:"createOneHotEncodings",value:function(E){return I.tidy(function(){var k={uniqueValues:E,legend:{}},w=E,_=w.map(function(Y,ce){return ce}),L=I.oneHot(I.tensor1d(_,"int32"),w.length).arraySync();return w.forEach(function(Y,ce){k.legend[Y]=L[ce]}),k})}},{key:"loadDataFromUrl",value:function(){var E=K()(we.a.mark(function k(w,_,L){var Y;return we.a.wrap(function(ce){for(;;)switch(ce.prev=ce.next){case 0:if(ce.prev=0,!w.endsWith(".csv")){ce.next=7;break}return ce.next=4,this.loadCSV(w,_,L);case 4:Y=ce.sent,ce.next=20;break;case 7:if(!w.endsWith(".json")){ce.next=13;break}return ce.next=10,this.loadJSON(w,_,L);case 10:Y=ce.sent,ce.next=20;break;case 13:if(!w.includes("blob")){ce.next=19;break}return ce.next=16,this.loadBlob(w,_,L);case 16:Y=ce.sent,ce.next=20;break;case 19:throw new Error("Not a valid data format. Must be csv or json");case 20:return ce.abrupt("return",Y);case 23:throw ce.prev=23,ce.t0=ce.catch(0),console.error(ce.t0),new Error(ce.t0);case 27:case"end":return ce.stop()}},k,this,[[0,23]])}));return function(k,w,_){return E.apply(this,arguments)}}()},{key:"loadJSON",value:function(){var E=K()(we.a.mark(function k(w,_,L){var Y,ce,ve,De;return we.a.wrap(function(Ce){for(;;)switch(Ce.prev=Ce.next){case 0:if(Ce.prev=0,!(w instanceof Object)){Ce.next=5;break}Y=Object.assign({},w),Ce.next=10;break;case 5:return Ce.next=7,Gt.a.get(w);case 7:ce=Ce.sent,ve=ce.data,Y=ve;case 10:return De=this.formatRawData(Y,_,L),Ce.abrupt("return",De);case 14:throw Ce.prev=14,Ce.t0=Ce.catch(0),console.error("error loading json"),new Error(Ce.t0);case 18:case"end":return Ce.stop()}},k,this,[[0,14]])}));return function(k,w,_){return E.apply(this,arguments)}}()},{key:"loadCSV",value:function(){var E=K()(we.a.mark(function k(w,_,L){var Y,ce,ve,De;return we.a.wrap(function(Ce){for(;;)switch(Ce.prev=Ce.next){case 0:return Ce.prev=0,Y=I.data.csv(w),Ce.next=4,Y.toArray();case 4:return ce=Ce.sent,ve={entries:ce},De=this.formatRawData(ve,_,L),Ce.abrupt("return",De);case 10:throw Ce.prev=10,Ce.t0=Ce.catch(0),console.error("error loading csv",Ce.t0),new Error(Ce.t0);case 14:case"end":return Ce.stop()}},k,this,[[0,10]])}));return function(k,w,_){return E.apply(this,arguments)}}()},{key:"loadBlob",value:function(){var E=K()(we.a.mark(function k(w,_,L){var Y,ce,ve,De,Ce,Xe;return we.a.wrap(function(nt){for(;;)switch(nt.prev=nt.next){case 0:return nt.prev=0,nt.next=3,Gt.a.get(w);case 3:if(Y=nt.sent,ce=Y.data,ve=ce,!ba.isJsonOrString(ve)){nt.next=13;break}return Ce=JSON.parse(ve),nt.next=10,this.loadJSON(Ce,_,L);case 10:De=nt.sent,nt.next=17;break;case 13:return Xe=this.csvToJSON(ve),nt.next=16,this.loadJSON(Xe,_,L);case 16:De=nt.sent;case 17:return nt.abrupt("return",De);case 20:throw nt.prev=20,nt.t0=nt.catch(0),console.log("mmm might be passing in a string or something!",nt.t0),new Error(nt.t0);case 24:case"end":return nt.stop()}},k,this,[[0,20]])}));return function(k,w,_){return E.apply(this,arguments)}}()},{key:"loadData",value:function(){var E=K()(we.a.mark(function k(){var w,_,L,Y,ce,ve,De=arguments;return we.a.wrap(function(Ce){for(;;)switch(Ce.prev=Ce.next){case 0:if(w=De.length>0&&De[0]!==void 0?De[0]:null,_=De.length>1?De[1]:void 0,Ce.prev=2,typeof w=="string"){Ce.next=17;break}if(Y=w[0],new FileReader().readAsText(Y),!Y.name.includes(".json")){Ce.next=14;break}return Ce.next=10,Y.text();case 10:ce=Ce.sent,L=JSON.parse(ce),Ce.next=15;break;case 14:console.log('data must be a json object containing an array called "data" or "entries');case 15:Ce.next=22;break;case 17:return Ce.next=19,Gt.a.get(w,{responseType:"text"});case 19:L=Ce.sent,ve=JSON.stringify(L.data),ba.isJsonOrString(ve)?L=JSON.parse(ve):console.log("Whoops! something went wrong. Either this kind of data is not supported yet or there is an issue with .loadData");case 22:this.data.raw=this.findEntries(L),!this.data.raw.length>0&&console.log('data must be a json object containing an array called "data" '),_&&_(),Ce.next=30;break;case 27:throw Ce.prev=27,Ce.t0=Ce.catch(2),new Error(Ce.t0);case 30:case"end":return Ce.stop()}},k,this,[[2,27]])}));return function(){return E.apply(this,arguments)}}()},{key:"saveData",value:function(){var E=K()(we.a.mark(function k(w){var _,L,Y,ce,ve,De;return we.a.wrap(function(Ce){for(;;)switch(Ce.prev=Ce.next){case 0:return _=new Date,L="".concat(String(_.getFullYear()),"-").concat(String(_.getMonth()+1),"-").concat(String(_.getDate())),Y="".concat(String(_.getHours()),"-").concat(String(_.getMinutes()),"-").concat(String(_.getSeconds())),ce="".concat(L,"_").concat(Y),ve=ce,w&&(ve=w),De={data:this.data.raw},Ce.next=9,jr(JSON.stringify(De),"".concat(ve,".json"),"text/plain");case 9:case"end":return Ce.stop()}},k,this)}));return function(k){return E.apply(this,arguments)}}()},{key:"saveMeta",value:function(){var E=K()(we.a.mark(function k(w,_){var L,Y;return we.a.wrap(function(ce){for(;;)switch(ce.prev=ce.next){case 0:return typeof w=="function"?(L="model",Y=w):typeof w=="string"?(L=w,typeof _=="function"&&(Y=_)):L="model",ce.next=3,jr(JSON.stringify(this.meta),"".concat(L,"_meta.json"),"text/plain");case 3:Y&&Y();case 4:case"end":return ce.stop()}},k,this)}));return function(k,w){return E.apply(this,arguments)}}()},{key:"loadMeta",value:function(){var E=K()(we.a.mark(function k(){var w,_,L,Y,ce,ve,De,Ce=arguments;return we.a.wrap(function(Xe){for(;;)switch(Xe.prev=Xe.next){case 0:if(w=Ce.length>0&&Ce[0]!==void 0?Ce[0]:null,_=Ce.length>1?Ce[1]:void 0,!(w instanceof FileList)){Xe.next=10;break}return Xe.next=5,Promise.all(Array.from(w).map(function(){var nt=K()(we.a.mark(function Et(At){var rn;return we.a.wrap(function(un){for(;;)switch(un.prev=un.next){case 0:if(!At.name.includes(".json")||At.name.includes("_meta")){un.next=4;break}return un.abrupt("return",{name:"model",file:At});case 4:if(!At.name.includes(".json")||!At.name.includes("_meta.json")){un.next=11;break}return un.next=7,At.text();case 7:return rn=un.sent,un.abrupt("return",{name:"metadata",file:rn});case 11:if(!At.name.includes(".bin")){un.next=13;break}return un.abrupt("return",{name:"weights",file:At});case 13:return un.abrupt("return",{name:null,file:null});case 14:case"end":return un.stop()}},Et)}));return function(Et){return nt.apply(this,arguments)}}()));case 5:L=Xe.sent,Y=JSON.parse(L.find(function(nt){return nt.name==="metadata"}).file),this.meta=Y,Xe.next=25;break;case 10:if(!(w instanceof Object)){Xe.next=19;break}return Xe.next=13,Gt.a.get(w.metadata,{responseType:"text"});case 13:ce=Xe.sent,ce=JSON.stringify(ce.data),ce=JSON.parse(ce),this.meta=ce,Xe.next=25;break;case 19:return ve="".concat(w.substring(0,w.lastIndexOf("/")),"/model_meta.json"),Xe.next=22,Gt.a.get(ve);case 22:De=(De=Xe.sent).data,this.meta=De;case 25:return this.isMetadataReady=!0,this.isWarmedUp=!0,_&&_(),Xe.abrupt("return",this.meta);case 29:case"end":return Xe.stop()}},k,this)}));return function(){return E.apply(this,arguments)}}()},{key:"formatRawData",value:function(E,k,w){var _=this.findEntries(E);!_.length>0&&console.log(`your data must be contained in an array in 

        a property called 'entries' or 'data' of your json object`);var L=_.map(function(Y,ce){var ve={xs:{},ys:{}};return k.forEach(function(De){Y[De]!==void 0?ve.xs[De]=Y[De]:console.error("the input label ".concat(De," does not exist at row ").concat(ce))}),w.forEach(function(De){Y[De]!==void 0?ve.ys[De]=Y[De]:console.error("the output label ".concat(De," does not exist at row ").concat(ce))}),ve});return this.data.raw=L,L}},{key:"csvToJSON",value:function(E){for(var k=E.split(`
`),w=[],_=k[0].split(","),L=function(ce){var ve={},De=k[ce].split(",");_.forEach(function(Ce,Xe){ve[Ce]=De[Xe]}),w.push(ve)},Y=1;Y<k.length;Y+=1)L(Y);return{entries:w}}},{key:"findEntries",value:function(E){var k=this,w=Object.assign({},E);return w.entries&&w.entries instanceof Array?w.entries:w.data&&w.data instanceof Array?w.data:(Object.keys(w).forEach(function(_){if(ke()(w[_])==="object")return k.findEntries(w[_])}),w)}},{key:"getData",value:function(){return this.data.raw}}]),F}();function Ff(F,E){var k=Object.keys(F);if(Object.getOwnPropertySymbols){var w=Object.getOwnPropertySymbols(F);E&&(w=w.filter(function(_){return Object.getOwnPropertyDescriptor(F,_).enumerable})),k.push.apply(k,w)}return k}var Uh=function(){function F(){pe()(this,F),this.config={height:300}}return Te()(F,[{key:"modelSummary",value:function(E,k){var w=function(_){for(var L=1;L<arguments.length;L++){var Y=arguments[L]!=null?arguments[L]:{};L%2?Ff(Object(Y),!0).forEach(function(ce){ee()(_,ce,Y[ce])}):Object.getOwnPropertyDescriptors?Object.defineProperties(_,Object.getOwnPropertyDescriptors(Y)):Ff(Object(Y)).forEach(function(ce){Object.defineProperty(_,ce,Object.getOwnPropertyDescriptor(Y,ce))})}return _}({},E);se.show.modelSummary(w,k)}},{key:"scatterplot",value:function(E,k,w){var _=w.map(function(Y){return{x:Y.xs[E],y:Y.ys[k]}}),L={xLabel:"X",yLabel:"Y",height:this.config.height};se.render.scatterplot({name:"debug mode"},_,L)}},{key:"scatterplotAll",value:function(E,k,w){var _=[];E.forEach(function(Y){k.forEach(function(ce){var ve=w.map(function(De){return{x:De.xs[Y],y:De.ys[ce]}});_=[].concat(Lo()(_),Lo()(ve))})});var L={xLabel:"X",yLabel:"Y",height:this.config.height};se.render.scatterplot({name:"debug mode"},_,L)}},{key:"barchart",value:function(E,k,w){var _=w.map(function(Y){return{value:Y.xs[E],index:Y.ys[k]}}),L={xLabel:"label",yLabel:"value",height:this.config.height};console.log(L),se.render.barchart({name:"Bar chart"},_)}},{key:"trainingVis",value:function(){return se.show.fitCallbacks({name:"Training Performance"},["loss","accuracy"],{height:this.config.height,callbacks:["onEpochEnd"]})}}]),F}();function $d(F,E){var k=Object.keys(F);if(Object.getOwnPropertySymbols){var w=Object.getOwnPropertySymbols(F);E&&(w=w.filter(function(_){return Object.getOwnPropertyDescriptor(F,_).enumerable})),k.push.apply(k,w)}return k}function If(F){for(var E=1;E<arguments.length;E++){var k=arguments[E]!=null?arguments[E]:{};E%2?$d(Object(k),!0).forEach(function(w){ee()(F,w,k[w])}):Object.getOwnPropertyDescriptors?Object.defineProperties(F,Object.getOwnPropertyDescriptors(k)):$d(Object(k)).forEach(function(w){Object.defineProperty(F,w,Object.getOwnPropertyDescriptor(k,w))})}return F}var jl={inputs:[],outputs:[],dataUrl:null,modelUrl:null,layers:[],task:null,debug:!1,learningRate:.2,hiddenUnits:16,noTraining:!1},Gd=function(){function F(E,k){pe()(this,F),this.callback=k,E.task==="imageClassification"&&(jl.learningRate=.02),this.options=If(If({},jl),E)||jl,this.neuralNetwork=new Yc,this.neuralNetworkData=new Ml,this.neuralNetworkVis=new Uh,this.data={training:[]},this.ready=!1,this.init=this.init.bind(this),this.addData=this.addData.bind(this),this.loadDataFromUrl=this.loadDataFromUrl.bind(this),this.loadDataInternal=this.loadDataInternal.bind(this),this.createMetaData=this.createMetaData.bind(this),this.prepareForTraining=this.prepareForTraining.bind(this),this.normalizeData=this.normalizeData.bind(this),this.normalizeInput=this.normalizeInput.bind(this),this.searchAndFormat=this.searchAndFormat.bind(this),this.formatInputItem=this.formatInputItem.bind(this),this.convertTrainingDataToTensors=this.convertTrainingDataToTensors.bind(this),this.formatInputsForPrediction=this.formatInputsForPrediction.bind(this),this.formatInputsForPredictionAll=this.formatInputsForPredictionAll.bind(this),this.isOneHotEncodedOrNormalized=this.isOneHotEncodedOrNormalized.bind(this),this.train=this.train.bind(this),this.trainInternal=this.trainInternal.bind(this),this.addLayer=this.addLayer.bind(this),this.createNetworkLayers=this.createNetworkLayers.bind(this),this.addDefaultLayers=this.addDefaultLayers.bind(this),this.compile=this.compile.bind(this),this.predict=this.predict.bind(this),this.predictMultiple=this.predictMultiple.bind(this),this.classify=this.classify.bind(this),this.classifyMultiple=this.classifyMultiple.bind(this),this.predictInternal=this.predictInternal.bind(this),this.classifyInternal=this.classifyInternal.bind(this),this.saveData=this.saveData.bind(this),this.loadData=this.loadData.bind(this),this.save=this.save.bind(this),this.load=this.load.bind(this),this.dispose=this.dispose.bind(this),this.mutate=this.mutate.bind(this),this.crossover=this.crossover.bind(this),this.init(this.callback)}return Te()(F,[{key:"init",value:function(E){this.options.noTraining===!0&&this.createLayersNoTraining(),this.options.dataUrl!==null?this.ready=this.loadDataFromUrl(this.options,E):this.options.modelUrl!==null?this.ready=this.load(this.options.modelUrl,E):this.ready=!0}},{key:"createLayersNoTraining",value:function(){var E=this.options,k=E.inputs,w=E.outputs;if(E.task==="classification")for(var _=0;_<w.length;_+=1){var L=new Array(k).fill(0);this.addData(L,[w[_]])}else{var Y=new Array(k).fill(0),ce=new Array(w).fill(0);this.addData(Y,ce)}this.neuralNetworkData.createMetadata(this.neuralNetworkData.data.raw),this.addDefaultLayers(this.options.task,this.neuralNetworkData.meta)}},{key:"copy",value:function(){var E=this,k=new F(this.options);return I.tidy(function(){for(var w=E.neuralNetwork.model.getWeights(),_=[],L=0;L<w.length;L+=1)_[L]=w[L].clone();return k.neuralNetwork.model.setWeights(_),k})}},{key:"addData",value:function(E,k){var w,_,L=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null,Y=this.options,ce=Y.inputs,ve=Y.outputs;if(L!==null?(w=L.inputLabels,_=L.outputLabels):ce.length>0&&ve.length>0?(ce.every(function(nt){return typeof nt=="string"})&&(w=ce),ve.every(function(nt){return typeof nt=="string"})&&(_=ve)):ke()(E)==="object"&&ke()(k)==="object"?(w=Object.keys(E),_=Object.keys(k)):(w=ba.createLabelsFromArrayValues(E,"input"),_=ba.createLabelsFromArrayValues(k,"output")),!(w instanceof Array))throw new Error("inputLabels must be an array");if(!(_ instanceof Array))throw new Error("outputLabels must be an array");var De=this.searchAndFormat(E),Ce=ba.formatDataAsObject(De,w),Xe=ba.formatDataAsObject(k,_);this.neuralNetworkData.addData(Ce,Xe)}},{key:"loadDataFromUrl",value:function(E,k){return ot(this.loadDataInternal(E),k)}},{key:"loadDataInternal",value:function(){var E=K()(we.a.mark(function k(w){var _,L,Y,ce;return we.a.wrap(function(ve){for(;;)switch(ve.prev=ve.next){case 0:return _=w.dataUrl,L=w.inputs,Y=w.outputs,ve.next=3,this.neuralNetworkData.loadDataFromUrl(_,L,Y);case 3:ce=ve.sent,this.createMetadata(ce),this.prepareForTraining(ce);case 6:case"end":return ve.stop()}},k,this)}));return function(k){return E.apply(this,arguments)}}()},{key:"createMetaData",value:function(E){var k,w=this.options.inputs;Array.isArray(w)&&w.length>0&&(k=w.every(function(_){return typeof _=="number"})&&w.length>0?w:null),this.neuralNetworkData.createMetadata(E,k)}},{key:"prepareForTraining",value:function(){var E=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,k=E===null?this.neuralNetworkData.data.raw:E,w=this.neuralNetworkData.applyOneHotEncodingsToDataRaw(k);return this.data.training=w,this.neuralNetworkData.isWarmedUp=!0,w}},{key:"normalizeData",value:function(){var E=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,k=E===null?this.neuralNetworkData.data.raw:E;this.neuralNetworkData.isMetadataReady||this.createMetaData(k),this.neuralNetworkData.isWarmedUp||this.prepareForTraining(k);var w=this.neuralNetworkData.normalizeDataRaw(k);return this.data.training=w,this.neuralNetworkData.meta.isNormalized=!0,w}},{key:"normalizeInput",value:function(E,k,w){var _=w[k],L=_.min,Y=_.max;return ba.normalizeValue(E,L,Y)}},{key:"searchAndFormat",value:function(E){var k,w=this;if(Array.isArray(E))k=E.map(function(L){return w.formatInputItem(L)});else if(ke()(E)==="object"){var _=Object.assign({},E);Object.keys(E).forEach(function(L){var Y=E[L];_[L]=w.formatInputItem(Y)}),k=_}return k}},{key:"formatInputItem",value:function(E){var k;return Dn(E)?k=E:ke()(E)==="object"&&Dn(E.elt)?k=E.elt:ke()(E)==="object"&&Dn(E.canvas)&&(k=E.canvas),k?hr(k):E}},{key:"convertTrainingDataToTensors",value:function(){var E=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,k=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,w=E===null?this.data.training:E,_=k===null?this.neuralNetworkData.meta:k;return this.neuralNetworkData.convertRawToTensors(w,_)}},{key:"formatInputsForPrediction",value:function(E,k,w){var _=this,L=[];return E instanceof Array?L=w.map(function(Y,ce){return _.isOneHotEncodedOrNormalized(E[ce],Y,k.inputs)}):E instanceof Object&&(L=w.map(function(Y){return _.isOneHotEncodedOrNormalized(E[Y],Y,k.inputs)})),L=L.flat()}},{key:"formatInputsForPredictionAll",value:function(E,k,w){var _,L=this;return E instanceof Array&&E.every(function(Y){return Array.isArray(Y)})?(_=E.map(function(Y){return L.formatInputsForPrediction(Y,k,w)}),I.tensor(_,[E.length,w.length])):(_=this.formatInputsForPrediction(E,k,w),I.tensor([_]))}},{key:"isOneHotEncodedOrNormalized",value:function(E,k,w){var _,L=E,Y=k;return typeof E!="number"?_=w[Y].legend[L]:(_=E,this.neuralNetworkData.meta.isNormalized&&(_=this.normalizeInput(E,Y,w))),_}},{key:"train",value:function(E,k,w){var _,L,Y;ke()(E)==="object"&&typeof k=="function"&&typeof w=="function"?(_=E,L=k,Y=w):ke()(E)==="object"&&typeof k=="function"?(_=E,L=null,Y=k):typeof E=="function"&&typeof k=="function"?(_={},L=E,Y=k):(_={},L=null,Y=E),this.trainInternal(_,L,Y)}},{key:"trainInternal",value:function(E,k,w){var _=If({epochs:10,batchSize:32,validationSplit:.1,whileTraining:null},E);if(this.options.debug===!0||this.options.debug==="true"?_.whileTraining=[this.neuralNetworkVis.trainingVis(),{onEpochEnd:k}]:_.whileTraining=[{onEpochEnd:k}],this.neuralNetworkData.isMetadataReady||this.createMetaData(this.neuralNetworkData.data.raw),this.neuralNetworkData.isWarmedUp||this.prepareForTraining(this.neuralNetworkData.data.raw),!_.inputs&&!_.outputs){var L=this.convertTrainingDataToTensors(),Y=L.inputs,ce=L.outputs;_.inputs=Y,_.outputs=ce}this.neuralNetwork.isLayered||(this.options.layers=this.createNetworkLayers(this.options.layers,this.neuralNetworkData.meta)),this.neuralNetwork.isLayered||(this.options.layers=this.addDefaultLayers(this.options.task,this.neuralNetworkData.meta)),this.neuralNetwork.isCompiled||this.compile(),this.neuralNetwork.train(_,w)}},{key:"addLayer",value:function(E){this.neuralNetwork.addLayer(E)}},{key:"createNetworkLayers",value:function(E,k){var w=this,_=Lo()(E),L=Object.assign({},k),Y=L.inputUnits,ce=L.outputUnits,ve=_.length;if(!(_.length>=2))return!1;_[0].inputShape=_[0].inputShape?_[0].inputShape:Y;var De=_[ve-1];return De.units=De.units?De.units:ce,_.forEach(function(Ce){w.addLayer(I.layers[Ce.type](Ce))}),_}},{key:"addDefaultLayers",value:function(E,k){var w;switch(E.toLowerCase()){case"classification":return w=[{type:"dense",units:this.options.hiddenUnits,activation:"relu"},{type:"dense",activation:"softmax"}],this.createNetworkLayers(w,k);case"regression":return w=[{type:"dense",units:this.options.hiddenUnits,activation:"relu"},{type:"dense",activation:"sigmoid"}],this.createNetworkLayers(w,k);case"imageclassification":return w=[{type:"conv2d",filters:8,kernelSize:5,strides:1,activation:"relu",kernelInitializer:"varianceScaling"},{type:"maxPooling2d",poolSize:[2,2],strides:[2,2]},{type:"conv2d",filters:16,kernelSize:5,strides:1,activation:"relu",kernelInitializer:"varianceScaling"},{type:"maxPooling2d",poolSize:[2,2],strides:[2,2]},{type:"flatten"},{type:"dense",kernelInitializer:"varianceScaling",activation:"softmax"}],this.createNetworkLayers(w,k);default:return console.log("no imputUnits or outputUnits defined"),w=[{type:"dense",units:this.options.hiddenUnits,activation:"relu"},{type:"dense",activation:"sigmoid"}],this.createNetworkLayers(w,k)}}},{key:"compile",value:function(){var E=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,k=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,w=k===null?this.options.learningRate:k,_={};E!==null?_=If({},E):this.options.task==="classification"||this.options.task==="imageClassification"?_={loss:"categoricalCrossentropy",optimizer:I.train.sgd,metrics:["accuracy"]}:this.options.task==="regression"&&(_={loss:"meanSquaredError",optimizer:I.train.adam,metrics:["accuracy"]}),_.optimizer=_.optimizer?this.neuralNetwork.setOptimizerFunction(w,_.optimizer):this.neuralNetwork.setOptimizerFunction(w,I.train.sgd),this.neuralNetwork.compile(_),this.options.debug&&this.neuralNetworkVis.modelSummary({name:"Model Summary"},this.neuralNetwork.model)}},{key:"predictSync",value:function(E){return this.predictSyncInternal(E)}},{key:"predict",value:function(E,k){return ot(this.predictInternal(E),k)}},{key:"predictMultiple",value:function(E,k){return ot(this.predictInternal(E),k)}},{key:"classifySync",value:function(E){return this.classifySyncInternal(E)}},{key:"classify",value:function(E,k){return ot(this.classifyInternal(E),k)}},{key:"classifyMultiple",value:function(E,k){return ot(this.classifyInternal(E),k)}},{key:"predictSyncInternal",value:function(E){var k=this.neuralNetworkData.meta,w=Object.keys(k.inputs),_=this.formatInputsForPredictionAll(E,k,w),L=this.neuralNetwork.predictSync(_);if(_.dispose(),k!==null){var Y=Object.keys(k.outputs),ce=L.map(function(ve){return Y.map(function(De,Ce){var Xe,nt,Et;if(k.isNormalized){var At=k.outputs[De],rn=At.min,un=At.max;nt=ba.unnormalizeValue(ve[Ce],rn,un),Et=ve[Ce]}else nt=ve[Ce];var kn=(Xe={},ee()(Xe,Y[Ce],nt),ee()(Xe,"label",De),ee()(Xe,"value",nt),Xe);return Et&&(kn.unNormalizedValue=Et),kn})});return ce.length<2?ce[0]:ce}return L}},{key:"predictInternal",value:function(){var E=K()(we.a.mark(function k(w){var _,L,Y,ce,ve,De;return we.a.wrap(function(Ce){for(;;)switch(Ce.prev=Ce.next){case 0:return _=this.neuralNetworkData.meta,L=Object.keys(_.inputs),Y=this.formatInputsForPredictionAll(w,_,L),Ce.next=5,this.neuralNetwork.predict(Y);case 5:if(ce=Ce.sent,Y.dispose(),_===null){Ce.next=13;break}if(ve=Object.keys(_.outputs),!((De=ce.map(function(Xe){return ve.map(function(nt,Et){var At,rn,un;if(_.isNormalized){var kn=_.outputs[nt],En=kn.min,_n=kn.max;rn=ba.unnormalizeValue(Xe[Et],En,_n),un=Xe[Et]}else rn=Xe[Et];var Pn=(At={},ee()(At,ve[Et],rn),ee()(At,"label",nt),ee()(At,"value",rn),At);return un&&(Pn.unNormalizedValue=un),Pn})})).length<2)){Ce.next=12;break}return Ce.abrupt("return",De[0]);case 12:return Ce.abrupt("return",De);case 13:return Ce.abrupt("return",ce);case 14:case"end":return Ce.stop()}},k,this)}));return function(k){return E.apply(this,arguments)}}()},{key:"classifySyncInternal",value:function(E){var k,w=this.neuralNetworkData.meta,_=Object.keys(w.inputs);if(this.options.task==="imageClassification"){if(k=this.searchAndFormat(E),k=Array.isArray(k)?k.flat():k[_[0]],w.isNormalized){var L=w.inputs[_[0]],Y=L.min,ce=L.max;k=this.neuralNetworkData.normalizeArray(Array.from(k),{min:Y,max:ce})}else k=Array.from(k);k=I.tensor([k],[1].concat(Lo()(w.inputUnits)))}else k=this.formatInputsForPredictionAll(E,w,_);var ve=this.neuralNetwork.classifySync(k);if(k.dispose(),w!==null){var De=Object.keys(w.outputs)[0],Ce=Object.entries(w.outputs[De].legend),Xe=ve.map(function(nt){return Ce.map(function(Et,At){var rn;return rn={},ee()(rn,Et[0],nt[At]),ee()(rn,"label",Et[0]),ee()(rn,"confidence",nt[At]),rn}).sort(function(Et,At){return At.confidence-Et.confidence})});return Xe.length<2?Xe[0]:Xe}return ve}},{key:"classifyInternal",value:function(){var E=K()(we.a.mark(function k(w){var _,L,Y,ce,ve,De,Ce,Xe,nt,Et;return we.a.wrap(function(At){for(;;)switch(At.prev=At.next){case 0:return _=this.neuralNetworkData.meta,L=Object.keys(_.inputs),this.options.task==="imageClassification"?(Y=this.searchAndFormat(w),Y=Array.isArray(Y)?Y.flat():Y[L[0]],_.isNormalized?(ce=_.inputs[L[0]],ve=ce.min,De=ce.max,Y=this.neuralNetworkData.normalizeArray(Array.from(Y),{min:ve,max:De})):Y=Array.from(Y),Y=I.tensor([Y],[1].concat(Lo()(_.inputUnits)))):Y=this.formatInputsForPredictionAll(w,_,L),At.next=5,this.neuralNetwork.classify(Y);case 5:if(Ce=At.sent,Y.dispose(),_===null){At.next=14;break}if(Xe=Object.keys(_.outputs)[0],nt=Object.entries(_.outputs[Xe].legend),!((Et=Ce.map(function(rn){return nt.map(function(un,kn){var En;return En={},ee()(En,un[0],rn[kn]),ee()(En,"label",un[0]),ee()(En,"confidence",rn[kn]),En}).sort(function(un,kn){return kn.confidence-un.confidence})})).length<2)){At.next=13;break}return At.abrupt("return",Et[0]);case 13:return At.abrupt("return",Et);case 14:return At.abrupt("return",Ce);case 15:case"end":return At.stop()}},k,this)}));return function(k){return E.apply(this,arguments)}}()},{key:"saveData",value:function(E){this.neuralNetworkData.saveData(E)}},{key:"loadData",value:function(){var E=K()(we.a.mark(function k(){var w,_,L=arguments;return we.a.wrap(function(Y){for(;;)switch(Y.prev=Y.next){case 0:w=L.length>0&&L[0]!==void 0?L[0]:null,_=L.length>1?L[1]:void 0,this.neuralNetworkData.loadData(w,_);case 3:case"end":return Y.stop()}},k,this)}));return function(){return E.apply(this,arguments)}}()},{key:"save",value:function(E,k){var w,_,L=this;typeof E=="function"?(w="model",_=E):typeof E=="string"?(w=E,typeof k=="function"&&(_=k)):w="model",this.neuralNetwork.save(w,function(){L.neuralNetworkData.saveMeta(w,_)})}},{key:"load",value:function(){var E=K()(we.a.mark(function k(){var w,_,L,Y=this,ce=arguments;return we.a.wrap(function(ve){for(;;)switch(ve.prev=ve.next){case 0:w=ce.length>0&&ce[0]!==void 0?ce[0]:null,(_=ce.length>1?ce[1]:void 0)&&(L=_),this.neuralNetwork.load(w,function(){return Y.neuralNetworkData.loadMeta(w,L),Y.neuralNetwork.model});case 4:case"end":return ve.stop()}},k,this)}));return function(){return E.apply(this,arguments)}}()},{key:"dispose",value:function(){this.neuralNetwork.dispose()}},{key:"mutate",value:function(E,k){this.neuralNetwork.mutate(E,k)}},{key:"crossover",value:function(E){var k=this.copy();return k.neuralNetwork.crossover(E.neuralNetwork),k}}]),F}(),Kd=function(F,E,k){var w,_;return F instanceof Object?(w=F,_=E):(w={inputs:F,outputs:E},_=k),new Gd(w,_)},tn=a(3);function Vs(F,E,k){if(k===void 0&&(k=!1),F.beginPath(),E.slice(1).forEach(function(L,Y){var ce=L.x,ve=L.y,De=E[Y];F.moveTo(De.x,De.y),F.lineTo(ce,ve)}),k){var w=E[E.length-1],_=E[0];if(!w||!_)return;F.moveTo(w.x,w.y),F.lineTo(_.x,_.y)}F.stroke()}var Un=a(5),Os=function(){function F(E,k){if(!Vu(E)||!Vu(k))throw new Error("Dimensions.constructor - expected width and height to be valid numbers, instead have "+JSON.stringify({width:E,height:k}));this._width=E,this._height=k}return Object.defineProperty(F.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(F.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),F.prototype.reverse=function(){return new F(1/this.width,1/this.height)},F}();function io(F,E){return F instanceof tn.Tensor&&F.shape.length===E}function Bl(F){return io(F,1)}function Rf(F){return io(F,2)}function nr(F){return io(F,3)}function $a(F){return io(F,4)}function xa(F){return F%1!=0}function Hi(F){return F%2==0}function ku(F,E){E===void 0&&(E=2);var k=Math.pow(10,E);return Math.floor(F*k)/k}function ac(F){return F&&F.width&&F.height}function qs(F,E){var k=F.width,w=F.height,_=E/Math.max(w,k);return new Os(Math.round(k*_),Math.round(w*_))}function sc(F){return F.reduce(function(E,k){return E.add(k)},new so(0,0)).div(new so(F.length,F.length))}function Xo(F,E,k){return Array(F).fill(0).map(function(w,_){return E+_*k})}function Vu(F){return!!F&&F!==1/0&&F!==-1/0&&!isNaN(F)||F===0}function Hs(F){return Vu(F)&&0<=F&&F<=1}var so=function(){function F(E,k){this._x=E,this._y=k}return Object.defineProperty(F.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(F.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),F.prototype.add=function(E){return new F(this.x+E.x,this.y+E.y)},F.prototype.sub=function(E){return new F(this.x-E.x,this.y-E.y)},F.prototype.mul=function(E){return new F(this.x*E.x,this.y*E.y)},F.prototype.div=function(E){return new F(this.x/E.x,this.y/E.y)},F.prototype.abs=function(){return new F(Math.abs(this.x),Math.abs(this.y))},F.prototype.magnitude=function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))},F.prototype.floor=function(){return new F(Math.floor(this.x),Math.floor(this.y))},F}(),cs=function(){function F(E,k){k===void 0&&(k=!0);var w=E||{},_=[w.left,w.top,w.right,w.bottom].every(Vu),L=[w.x,w.y,w.width,w.height].every(Vu);if(!L&&!_)throw new Error("Box.constructor - expected box to be IBoundingBox | IRect, instead have "+JSON.stringify(w));var Y=L?[w.x,w.y,w.width,w.height]:[w.left,w.top,w.right-w.left,w.bottom-w.top],ce=Y[0],ve=Y[1],De=Y[2],Ce=Y[3];F.assertIsValidBox({x:ce,y:ve,width:De,height:Ce},"Box.constructor",k),this._x=ce,this._y=ve,this._width=De,this._height=Ce}return F.isRect=function(E){return!!E&&[E.x,E.y,E.width,E.height].every(Vu)},F.assertIsValidBox=function(E,k,w){if(w===void 0&&(w=!1),!F.isRect(E))throw new Error(k+" - invalid box: "+JSON.stringify(E)+", expected object with properties x, y, width, height");if(!w&&(E.width<0||E.height<0))throw new Error(k+" - width ("+E.width+") and height ("+E.height+") must be positive numbers")},Object.defineProperty(F.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(F.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),Object.defineProperty(F.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(F.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),Object.defineProperty(F.prototype,"left",{get:function(){return this.x},enumerable:!0,configurable:!0}),Object.defineProperty(F.prototype,"top",{get:function(){return this.y},enumerable:!0,configurable:!0}),Object.defineProperty(F.prototype,"right",{get:function(){return this.x+this.width},enumerable:!0,configurable:!0}),Object.defineProperty(F.prototype,"bottom",{get:function(){return this.y+this.height},enumerable:!0,configurable:!0}),Object.defineProperty(F.prototype,"area",{get:function(){return this.width*this.height},enumerable:!0,configurable:!0}),Object.defineProperty(F.prototype,"topLeft",{get:function(){return new so(this.left,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(F.prototype,"topRight",{get:function(){return new so(this.right,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(F.prototype,"bottomLeft",{get:function(){return new so(this.left,this.bottom)},enumerable:!0,configurable:!0}),Object.defineProperty(F.prototype,"bottomRight",{get:function(){return new so(this.right,this.bottom)},enumerable:!0,configurable:!0}),F.prototype.round=function(){var E=[this.x,this.y,this.width,this.height].map(function(k){return Math.round(k)});return new F({x:E[0],y:E[1],width:E[2],height:E[3]})},F.prototype.floor=function(){var E=[this.x,this.y,this.width,this.height].map(function(k){return Math.floor(k)});return new F({x:E[0],y:E[1],width:E[2],height:E[3]})},F.prototype.toSquare=function(){var E=this.x,k=this.y,w=this.width,_=this.height,L=Math.abs(w-_);return w<_&&(E-=L/2,w+=L),_<w&&(k-=L/2,_+=L),new F({x:E,y:k,width:w,height:_})},F.prototype.rescale=function(E){var k=ac(E)?E.width:E,w=ac(E)?E.height:E;return new F({x:this.x*k,y:this.y*w,width:this.width*k,height:this.height*w})},F.prototype.pad=function(E,k){var w=[this.x-E/2,this.y-k/2,this.width+E,this.height+k];return new F({x:w[0],y:w[1],width:w[2],height:w[3]})},F.prototype.clipAtImageBorders=function(E,k){var w=this.x,_=this.y,L=this.right,Y=this.bottom,ce=Math.max(w,0),ve=Math.max(_,0),De=L-ce,Ce=Y-ve;return new F({x:ce,y:ve,width:Math.min(De,E-ce),height:Math.min(Ce,k-ve)}).floor()},F.prototype.shift=function(E,k){var w=this.width,_=this.height;return new F({x:this.x+E,y:this.y+k,width:w,height:_})},F.prototype.padAtBorders=function(E,k){var w=this.width+1,_=this.height+1,L=w,Y=_,ce=this.left,ve=this.top,De=this.right,Ce=this.bottom;return De>k&&(L=-De+k+w,De=k),Ce>E&&(Y=-Ce+E+_,Ce=E),ce<1&&(Y=2-ce,ce=1),ve<1&&(Y=2-ve,ve=1),{dy:1,edy:Y,dx:1,edx:L,y:ve,ey:Ce,x:ce,ex:De,w,h:_}},F.prototype.calibrate=function(E){return new F({left:this.left+E.left*this.width,top:this.top+E.top*this.height,right:this.right+E.right*this.width,bottom:this.bottom+E.bottom*this.height}).toSquare().round()},F}(),_a=function(F){function E(k,w,_,L,Y){return Y===void 0&&(Y=!1),F.call(this,{left:k,top:w,right:_,bottom:L},Y)||this}return Object(Un.c)(E,F),E}(cs),ls=function(){function F(E,k,w,_,L){this._imageDims=new Os(L.width,L.height),this._score=E,this._classScore=k,this._className=w,this._box=new cs(_).rescale(this._imageDims)}return Object.defineProperty(F.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(F.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),Object.defineProperty(F.prototype,"className",{get:function(){return this._className},enumerable:!0,configurable:!0}),Object.defineProperty(F.prototype,"box",{get:function(){return this._box},enumerable:!0,configurable:!0}),Object.defineProperty(F.prototype,"imageDims",{get:function(){return this._imageDims},enumerable:!0,configurable:!0}),Object.defineProperty(F.prototype,"imageWidth",{get:function(){return this.imageDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(F.prototype,"imageHeight",{get:function(){return this.imageDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(F.prototype,"relativeBox",{get:function(){return new cs(this._box).rescale(this.imageDims.reverse())},enumerable:!0,configurable:!0}),F.prototype.forSize=function(E,k){return new F(this.score,this.classScore,this.className,this.relativeBox,{width:E,height:k})},F}(),Yo=function(F){function E(k,w,_){return F.call(this,k,k,"",w,_)||this}return Object(Un.c)(E,F),E.prototype.forSize=function(k,w){var _=F.prototype.forSize.call(this,k,w);return new E(_.score,_.relativeBox,_.imageDims)},E}(ls);function $s(F,E,k){k===void 0&&(k=!0);var w=Math.max(0,Math.min(F.right,E.right)-Math.max(F.left,E.left))*Math.max(0,Math.min(F.bottom,E.bottom)-Math.max(F.top,E.top));return k?w/(F.area+E.area-w):w/Math.min(F.area,E.area)}function Eu(F){var E=F.map(function(ce){return ce.x}),k=F.map(function(ce){return ce.y}),w=E.reduce(function(ce,ve){return ve<ce?ve:ce},1/0),_=k.reduce(function(ce,ve){return ve<ce?ve:ce},1/0),L=E.reduce(function(ce,ve){return ce<ve?ve:ce},0),Y=k.reduce(function(ce,ve){return ce<ve?ve:ce},0);return new _a(w,_,L,Y)}function qu(F,E,k,w){w===void 0&&(w=!0);for(var _=E.map(function(ce,ve){return{score:ce,boxIndex:ve}}).sort(function(ce,ve){return ce.score-ve.score}).map(function(ce){return ce.boxIndex}),L=[],Y=function(){var ce=_.pop();L.push(ce);for(var ve=_,De=[],Ce=0;Ce<ve.length;Ce++){var Xe=ve[Ce],nt=F[ce],Et=F[Xe];De.push($s(nt,Et,w))}_=_.filter(function(At,rn){return De[rn]<=k})};_.length>0;)Y();return L}function uc(F,E){return tn.tidy(function(){var k=E[0],w=E[1],_=E[2],L=tn.fill(Object(Un.e)(F.shape.slice(0,3),[1]),k),Y=tn.fill(Object(Un.e)(F.shape.slice(0,3),[1]),w),ce=tn.fill(Object(Un.e)(F.shape.slice(0,3),[1]),_),ve=tn.concat([L,Y,ce],3);return tn.sub(F,ve)})}function Cu(F,E){return E===void 0&&(E=!1),tn.tidy(function(){var k=F.shape.slice(1),w=k[0],_=k[1];if(w===_)return F;var L=Math.abs(w-_),Y=Math.round(L*(E?.5:1)),ce=w>_?2:1,ve=function(nt){var Et=F.shape.slice();return Et[ce]=nt,tn.fill(Et,0)},De=ve(Y),Ce=L-De.shape[ce],Xe=[E&&Ce?ve(Ce):null,F,De].filter(function(nt){return!!nt}).map(function(nt){return nt.toFloat()});return tn.concat(Xe,ce)})}function Jc(F){for(var E=F.slice(),k=E.length-1;k>0;k--){var w=Math.floor(Math.random()*(k+1)),_=E[k];E[k]=E[w],E[w]=_}return E}function Qc(F){return 1/(1+Math.exp(-F))}function Wh(F){return Math.log(F/(1-F))}var Zc=function(F){function E(k,w,_,L,Y){return Y===void 0&&(Y=!1),F.call(this,{x:k,y:w,width:_,height:L},Y)||this}return Object(Un.c)(E,F),E}(cs),Gs=function(){function F(E,k,w){w===void 0&&(w=new so(0,0));var _=k.width,L=k.height;this._imgDims=new Os(_,L),this._shift=w,this._positions=E.map(function(Y){return Y.mul(new so(_,L)).add(w)})}return Object.defineProperty(F.prototype,"shift",{get:function(){return new so(this._shift.x,this._shift.y)},enumerable:!0,configurable:!0}),Object.defineProperty(F.prototype,"imageWidth",{get:function(){return this._imgDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(F.prototype,"imageHeight",{get:function(){return this._imgDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(F.prototype,"positions",{get:function(){return this._positions},enumerable:!0,configurable:!0}),Object.defineProperty(F.prototype,"relativePositions",{get:function(){var E=this;return this._positions.map(function(k){return k.sub(E._shift).div(new so(E.imageWidth,E.imageHeight))})},enumerable:!0,configurable:!0}),F.prototype.forSize=function(E,k){return new this.constructor(this.relativePositions,{width:E,height:k})},F.prototype.shiftBy=function(E,k){return new this.constructor(this.relativePositions,this._imgDims,new so(E,k))},F.prototype.shiftByPoint=function(E){return this.shiftBy(E.x,E.y)},F.prototype.align=function(E,k){if(k===void 0&&(k={}),E){var w=E instanceof Yo?E.box.floor():new cs(E);return this.shiftBy(w.x,w.y).align(null,k)}var _=Object.assign({},{useDlibAlignment:!1,minBoxPadding:.2},k),L=_.useDlibAlignment,Y=_.minBoxPadding;return L?this.alignDlib():this.alignMinBbox(Y)},F.prototype.alignDlib=function(){var E=this.getRefPointsForAlignment(),k=E[0],w=E[1],_=E[2],L=function(Xe){return _.sub(Xe).magnitude()},Y=(L(k)+L(w))/2,ce=Math.floor(Y/.45),ve=sc(E),De=Math.floor(Math.max(0,ve.x-.5*ce)),Ce=Math.floor(Math.max(0,ve.y-.43*ce));return new Zc(De,Ce,Math.min(ce,this.imageWidth+De),Math.min(ce,this.imageHeight+Ce))},F.prototype.alignMinBbox=function(E){var k=Eu(this.positions);return k.pad(k.width*E,k.height*E)},F.prototype.getRefPointsForAlignment=function(){throw new Error("getRefPointsForAlignment not implemented by base class")},F}(),Ou=function(F){function E(){return F!==null&&F.apply(this,arguments)||this}return Object(Un.c)(E,F),E.prototype.getRefPointsForAlignment=function(){var k=this.positions;return[k[0],k[1],sc([k[3],k[4]])]},E}(Gs),Au=function(F){function E(){return F!==null&&F.apply(this,arguments)||this}return Object(Un.c)(E,F),E.prototype.getJawOutline=function(){return this.positions.slice(0,17)},E.prototype.getLeftEyeBrow=function(){return this.positions.slice(17,22)},E.prototype.getRightEyeBrow=function(){return this.positions.slice(22,27)},E.prototype.getNose=function(){return this.positions.slice(27,36)},E.prototype.getLeftEye=function(){return this.positions.slice(36,42)},E.prototype.getRightEye=function(){return this.positions.slice(42,48)},E.prototype.getMouth=function(){return this.positions.slice(48,68)},E.prototype.getRefPointsForAlignment=function(){return[this.getLeftEye(),this.getRightEye(),this.getMouth()].map(sc)},E}(Gs),iu=function(){function F(E,k){this._label=E,this._distance=k}return Object.defineProperty(F.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(F.prototype,"distance",{get:function(){return this._distance},enumerable:!0,configurable:!0}),F.prototype.toString=function(E){return E===void 0&&(E=!0),this.label+(E?" ("+ku(this.distance)+")":"")},F}(),Vh=function(F){function E(k,w){var _=F.call(this,k)||this;return _._label=w,_}return Object(Un.c)(E,F),E.assertIsValidLabeledBox=function(k,w){if(cs.assertIsValidBox(k,w),!Vu(k.label))throw new Error(w+" - expected property label ("+k.label+") to be a number")},Object.defineProperty(E.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),E}(cs),Mf=function(){function F(E,k){if(typeof E!="string")throw new Error("LabeledFaceDescriptors - constructor expected label to be a string");if(!Array.isArray(k)||k.some(function(w){return!(w instanceof Float32Array)}))throw new Error("LabeledFaceDescriptors - constructor expected descriptors to be an array of Float32Array");this._label=E,this._descriptors=k}return Object.defineProperty(F.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(F.prototype,"descriptors",{get:function(){return this._descriptors},enumerable:!0,configurable:!0}),F.prototype.toJSON=function(){return{label:this.label,descriptors:this.descriptors.map(function(E){return Array.from(E)})}},F.fromJSON=function(E){var k=E.descriptors.map(function(w){return new Float32Array(w)});return new F(E.label,k)},F}(),jf=function(F){function E(k,w,_,L){var Y=F.call(this,k,w)||this;return Y._score=_,Y._classScore=L,Y}return Object(Un.c)(E,F),E.assertIsValidPredictedBox=function(k,w){if(Vh.assertIsValidLabeledBox(k,w),!Hs(k.score)||!Hs(k.classScore))throw new Error(w+" - expected properties score ("+k.score+") and ("+k.classScore+") to be a number between [0, 1]")},Object.defineProperty(E.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(E.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),E}(Vh);function Pl(F){return F.detection instanceof Yo}function Bf(F,E){var k={detection:E};return Object.assign({},F,k)}function Q(){var F=window.fetch||function(){throw new Error("fetch - missing fetch implementation for browser environment")};return{Canvas:HTMLCanvasElement,CanvasRenderingContext2D,Image:HTMLImageElement,ImageData,Video:HTMLVideoElement,createCanvasElement:function(){return document.createElement("canvas")},createImageElement:function(){return document.createElement("img")},fetch:F,readFile:function(){throw new Error("readFile - filesystem not available for browser environment")}}}var G=a(131),C=a(178);function N(){return typeof window=="object"&&typeof document<"u"&&typeof HTMLImageElement<"u"&&typeof HTMLCanvasElement<"u"&&typeof HTMLVideoElement<"u"&&typeof ImageData<"u"&&typeof CanvasRenderingContext2D<"u"}var te,Be=a(177);function Ge(F){te=F}function ft(){N()&&Ge(Q()),Object(Be.a)()&&Ge(Object(C.a)())}var Tt,Wt={getEnv:function(){if(!te)throw new Error("getEnv - environment is not defined, check isNodejs() and isBrowser()");return te},setEnv:Ge,initialize:ft,createBrowserEnv:Q,createFileSystem:G.a,createNodejsEnv:C.a,monkeyPatch:function(F){if(te||ft(),!te)throw new Error("monkeyPatch - environment is not defined, check isNodejs() and isBrowser()");var E=F.Canvas,k=E===void 0?te.Canvas:E,w=F.Image,_=w===void 0?te.Image:w;te.Canvas=k,te.Image=_,te.createCanvasElement=F.createCanvasElement||function(){return new k},te.createImageElement=F.createImageElement||function(){return new _},te.ImageData=F.ImageData||te.ImageData,te.Video=F.Video||te.Video,te.fetch=F.fetch||te.fetch,te.readFile=F.readFile||te.readFile},isBrowser:N,isNodejs:Be.a};function ct(F){return Wt.isNodejs()||typeof F!="string"?F:document.getElementById(F)}function bn(F){var E=Wt.getEnv(),k=E.Canvas;if(F instanceof E.CanvasRenderingContext2D)return F;var w=ct(F);if(!(w instanceof k))throw new Error("resolveContext2d - expected canvas to be of instance of Canvas");var _=w.getContext("2d");if(!_)throw new Error("resolveContext2d - canvas 2d context is null");return _}ft(),function(F){F.TOP_LEFT="TOP_LEFT",F.TOP_RIGHT="TOP_RIGHT",F.BOTTOM_LEFT="BOTTOM_LEFT",F.BOTTOM_RIGHT="BOTTOM_RIGHT"}(Tt||(Tt={}));var Sn=function(){return function(F){F===void 0&&(F={});var E=F.anchorPosition,k=F.backgroundColor,w=F.fontColor,_=F.fontSize,L=F.fontStyle,Y=F.padding;this.anchorPosition=E||Tt.TOP_LEFT,this.backgroundColor=k||"rgba(0, 0, 0, 0.5)",this.fontColor=w||"rgba(255, 255, 255, 1)",this.fontSize=_||14,this.fontStyle=L||"Georgia",this.padding=Y||4}}(),Nn=function(){function F(E,k,w){w===void 0&&(w={}),this.text=typeof E=="string"?[E]:E instanceof F?E.text:E,this.anchor=k,this.options=new Sn(w)}return F.prototype.measureWidth=function(E){var k=this.options.padding;return this.text.map(function(w){return E.measureText(w).width}).reduce(function(w,_){return w<_?_:w},0)+2*k},F.prototype.measureHeight=function(){var E=this.options,k=E.fontSize,w=E.padding;return this.text.length*k+2*w},F.prototype.getUpperLeft=function(E,k){var w=this.options.anchorPosition,_=w===Tt.BOTTOM_RIGHT||w===Tt.TOP_RIGHT,L=w===Tt.BOTTOM_LEFT||w===Tt.BOTTOM_RIGHT,Y=this.measureWidth(E),ce=this.measureHeight(),ve=_?this.anchor.x-Y:this.anchor.x,De=L?this.anchor.y-ce:this.anchor.y;if(k){var Ce=k.width,Xe=k.height;return{x:Math.max(Math.min(ve,Ce-Y),0),y:Math.max(Math.min(De,Xe-ce),0)}}return{x:ve,y:De}},F.prototype.draw=function(E){var k=ct(E),w=bn(k),_=this.options,L=_.backgroundColor,Y=_.fontColor,ce=_.fontSize,ve=_.fontStyle,De=_.padding;w.font=ce+"px "+ve;var Ce=this.measureWidth(w),Xe=this.measureHeight();w.fillStyle=L;var nt=this.getUpperLeft(w,k);w.fillRect(nt.x,nt.y,Ce,Xe),w.fillStyle=Y,this.text.forEach(function(Et,At){var rn=De+nt.x,un=De+nt.y+(At+1)*ce;w.fillText(Et,rn,un)})},F}(),Wn=function(){return function(F){F===void 0&&(F={});var E=F.boxColor,k=F.lineWidth,w=F.label,_=F.drawLabelOptions;this.boxColor=E||"rgba(0, 0, 255, 1)",this.lineWidth=k||2,this.label=w;var L={anchorPosition:Tt.BOTTOM_LEFT,backgroundColor:this.boxColor};this.drawLabelOptions=new Sn(Object.assign({},L,_))}}(),Rn=function(){function F(E,k){k===void 0&&(k={}),this.box=new cs(E),this.options=new Wn(k)}return F.prototype.draw=function(E){var k=bn(E),w=this.options,_=w.boxColor,L=w.lineWidth,Y=this.box,ce=Y.x,ve=Y.y,De=Y.width,Ce=Y.height;k.strokeStyle=_,k.lineWidth=L,k.strokeRect(ce,ve,De,Ce);var Xe=this.options.label;Xe&&new Nn([Xe],{x:ce-L/2,y:ve},this.options.drawLabelOptions).draw(E)},F}();function tr(F,E){(Array.isArray(E)?E:[E]).forEach(function(k){var w=k instanceof Yo?k.score:Pl(k)?k.detection.score:void 0,_=k instanceof Yo?k.box:Pl(k)?k.detection.box:new cs(k),L=w?""+ku(w):void 0;new Rn(_,{label:L}).draw(F)})}function rr(F){var E=Wt.getEnv(),k=E.Image,w=E.Video;return F instanceof k&&F.complete||F instanceof w&&F.readyState>=3}function dr(F){return new Promise(function(E,k){if(F instanceof Wt.getEnv().Canvas||rr(F))return E();function w(L){L.currentTarget&&(L.currentTarget.removeEventListener("load",w),L.currentTarget.removeEventListener("error",_),E(L))}function _(L){L.currentTarget&&(L.currentTarget.removeEventListener("load",w),L.currentTarget.removeEventListener("error",_),k(L))}F.addEventListener("load",w),F.addEventListener("error",_)})}function Tr(F){return new Promise(function(E,k){if(!(F instanceof Blob))return k("bufferToImage - expected buf to be of type: Blob");var w=new FileReader;w.onload=function(){if(typeof w.result!="string")return k("bufferToImage - expected reader.result to be a string, in onload");var _=Wt.getEnv().createImageElement();_.onload=function(){return E(_)},_.onerror=k,_.src=w.result},w.onerror=k,w.readAsDataURL(F)})}function Vr(F){var E=Wt.getEnv(),k=E.Image,w=E.Video;return F instanceof k?new Os(F.naturalWidth,F.naturalHeight):F instanceof w?new Os(F.videoWidth,F.videoHeight):new Os(F.width,F.height)}function xr(F){var E=F.width,k=F.height,w=(0,Wt.getEnv().createCanvasElement)();return w.width=E,w.height=k,w}function $r(F,E){var k=Wt.getEnv().ImageData;if(!(F instanceof k||rr(F)))throw new Error("createCanvasFromMedia - media has not finished loading yet");var w=E||Vr(F),_=w.width,L=w.height,Y=xr({width:_,height:L});return F instanceof k?bn(Y).putImageData(F,0,0):bn(Y).drawImage(F,0,0,_,L),Y}function Wr(F,E){return Object(Un.b)(this,void 0,void 0,function(){var k,w,_,L,Y,ce;return Object(Un.d)(this,function(ve){switch(ve.label){case 0:return k=E||Wt.getEnv().createCanvasElement(),w=F.shape.slice($a(F)?1:0),_=w[0],L=w[1],Y=w[2],ce=tn.tidy(function(){return F.as3D(_,L,Y).toInt()}),[4,tn.browser.toPixels(ce,k)];case 1:return ve.sent(),ce.dispose(),[2,k]}})})}function ai(F){var E=Wt.getEnv(),k=E.Image,w=E.Canvas,_=E.Video;return F instanceof k||F instanceof w||F instanceof _}function li(F,E,k){k===void 0&&(k=!1);var w=Wt.getEnv(),_=w.Image,L=w.Canvas;if(!(F instanceof _||F instanceof L))throw new Error("imageToSquare - expected arg0 to be HTMLImageElement | HTMLCanvasElement");var Y=Vr(F),ce=E/Math.max(Y.height,Y.width),ve=ce*Y.width,De=ce*Y.height,Ce=xr({width:E,height:E}),Xe=F instanceof L?F:$r(F),nt=Math.abs(ve-De)/2,Et=k&&ve<De?nt:0,At=k&&De<ve?nt:0;return bn(Ce).drawImage(Xe,Et,At,ve,De),Ce}var Hr=function(){function F(E,k){var w=this;if(k===void 0&&(k=!1),this._imageTensors=[],this._canvases=[],this._treatAsBatchInput=!1,this._inputDimensions=[],!Array.isArray(E))throw new Error("NetInput.constructor - expected inputs to be an Array of TResolvedNetInput or to be instanceof tf.Tensor4D, instead have "+E);this._treatAsBatchInput=k,this._batchSize=E.length,E.forEach(function(_,L){if(nr(_))return w._imageTensors[L]=_,void(w._inputDimensions[L]=_.shape);if($a(_)){var Y=_.shape[0];if(Y!==1)throw new Error("NetInput - tf.Tensor4D with batchSize "+Y+" passed, but not supported in input array");return w._imageTensors[L]=_,void(w._inputDimensions[L]=_.shape.slice(1))}var ce=_ instanceof Wt.getEnv().Canvas?_:$r(_);w._canvases[L]=ce,w._inputDimensions[L]=[ce.height,ce.width,3]})}return Object.defineProperty(F.prototype,"imageTensors",{get:function(){return this._imageTensors},enumerable:!0,configurable:!0}),Object.defineProperty(F.prototype,"canvases",{get:function(){return this._canvases},enumerable:!0,configurable:!0}),Object.defineProperty(F.prototype,"isBatchInput",{get:function(){return this.batchSize>1||this._treatAsBatchInput},enumerable:!0,configurable:!0}),Object.defineProperty(F.prototype,"batchSize",{get:function(){return this._batchSize},enumerable:!0,configurable:!0}),Object.defineProperty(F.prototype,"inputDimensions",{get:function(){return this._inputDimensions},enumerable:!0,configurable:!0}),Object.defineProperty(F.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(F.prototype,"reshapedInputDimensions",{get:function(){var E=this;return Xo(this.batchSize,0,1).map(function(k,w){return E.getReshapedInputDimensions(w)})},enumerable:!0,configurable:!0}),F.prototype.getInput=function(E){return this.canvases[E]||this.imageTensors[E]},F.prototype.getInputDimensions=function(E){return this._inputDimensions[E]},F.prototype.getInputHeight=function(E){return this._inputDimensions[E][0]},F.prototype.getInputWidth=function(E){return this._inputDimensions[E][1]},F.prototype.getReshapedInputDimensions=function(E){if(typeof this.inputSize!="number")throw new Error("getReshapedInputDimensions - inputSize not set, toBatchTensor has not been called yet");return qs({width:this.getInputWidth(E),height:this.getInputHeight(E)},this.inputSize)},F.prototype.toBatchTensor=function(E,k){var w=this;return k===void 0&&(k=!0),this._inputSize=E,tn.tidy(function(){var _=Xo(w.batchSize,0,1).map(function(L){var Y=w.getInput(L);if(Y instanceof tn.Tensor){var ce=$a(Y)?Y:Y.expandDims();return(ce=Cu(ce,k)).shape[1]===E&&ce.shape[2]===E||(ce=tn.image.resizeBilinear(ce,[E,E])),ce.as3D(E,E,3)}if(Y instanceof Wt.getEnv().Canvas)return tn.browser.fromPixels(li(Y,E,k));throw new Error("toBatchTensor - at batchIdx "+L+", expected input to be instanceof tf.Tensor or instanceof HTMLCanvasElement, instead have "+Y)});return tn.stack(_.map(function(L){return L.toFloat()})).as4D(w.batchSize,E,E,3)})},F}();function ni(F){return Object(Un.b)(this,void 0,void 0,function(){var E,k,w;return Object(Un.d)(this,function(_){switch(_.label){case 0:if(F instanceof Hr)return[2,F];if(!(E=Array.isArray(F)?F:[F]).length)throw new Error("toNetInput - empty array passed as input");return k=function(L){return Array.isArray(F)?" at input index "+L+":":""},(w=E.map(ct)).forEach(function(L,Y){if(!ai(L)&&!nr(L)&&!$a(L))throw typeof E[Y]=="string"?new Error("toNetInput -"+k(Y)+" string passed, but could not resolve HTMLElement for element id "+E[Y]):new Error("toNetInput -"+k(Y)+" expected media to be of type HTMLImageElement | HTMLVideoElement | HTMLCanvasElement | tf.Tensor3D, or to be an element id");if($a(L)){var ce=L.shape[0];if(ce!==1)throw new Error("toNetInput -"+k(Y)+" tf.Tensor4D with batchSize "+ce+" passed, but not supported in input array")}}),[4,Promise.all(w.map(function(L){return ai(L)&&dr(L)}))];case 1:return _.sent(),[2,new Hr(w,Array.isArray(F))]}})})}function to(F,E){return Object(Un.b)(this,void 0,void 0,function(){var k,w,_,L,Y,ce;return Object(Un.d)(this,function(ve){switch(ve.label){case 0:return k=Wt.getEnv().Canvas,w=F,F instanceof k?[3,5]:[4,ni(F)];case 1:if((_=ve.sent()).batchSize>1)throw new Error("extractFaces - batchSize > 1 not supported");return(L=_.getInput(0))instanceof k?(Y=L,[3,4]):[3,2];case 2:return[4,Wr(L)];case 3:Y=ve.sent(),ve.label=4;case 4:w=Y,ve.label=5;case 5:return ce=bn(w),[2,E.map(function(De){return De instanceof Yo?De.forSize(w.width,w.height).box.floor():De}).map(function(De){return De.clipAtImageBorders(w.width,w.height)}).map(function(De){var Ce=De.x,Xe=De.y,nt=De.width,Et=De.height,At=xr({width:nt,height:Et});return bn(At).putImageData(ce.getImageData(Ce,Xe,nt,Et),0,0),At})]}})})}function Qi(F,E){return Object(Un.b)(this,void 0,void 0,function(){return Object(Un.d)(this,function(k){if(!nr(F)&&!$a(F))throw new Error("extractFaceTensors - expected image tensor to be 3D or 4D");if($a(F)&&F.shape[0]>1)throw new Error("extractFaceTensors - batchSize > 1 not supported");return[2,tn.tidy(function(){var w=F.shape.slice($a(F)?1:0),_=w[0],L=w[1],Y=w[2];return E.map(function(ce){return ce instanceof Yo?ce.forSize(L,_).box:ce}).map(function(ce){return ce.clipAtImageBorders(L,_)}).map(function(ce){var ve=ce.x,De=ce.y,Ce=ce.width,Xe=ce.height;return tn.slice3d(F.as3D(_,L,Y),[De,ve,0],[Xe,Ce,Y])})})]})})}function zo(F,E){return Object(Un.b)(this,void 0,void 0,function(){var k;return Object(Un.d)(this,function(w){switch(w.label){case 0:return[4,(0,Wt.getEnv().fetch)(F,E)];case 1:if(!((k=w.sent()).status<400))throw new Error("failed to fetch: ("+k.status+") "+k.statusText+", from url: "+k.url);return[2,k]}})})}function ji(F){return Object(Un.b)(this,void 0,void 0,function(){var E,k;return Object(Un.d)(this,function(w){switch(w.label){case 0:return[4,zo(F)];case 1:return[4,(E=w.sent()).blob()];case 2:if(!(k=w.sent()).type.startsWith("image/"))throw new Error("fetchImage - expected blob type to be of type image/*, instead have: "+k.type+", for url: "+E.url);return[2,Tr(k)]}})})}function no(F){return Object(Un.b)(this,void 0,void 0,function(){return Object(Un.d)(this,function(E){switch(E.label){case 0:return[4,zo(F)];case 1:return[2,E.sent().json()]}})})}function ia(F){return Object(Un.b)(this,void 0,void 0,function(){var E;return Object(Un.d)(this,function(k){switch(k.label){case 0:return E=Float32Array.bind,[4,zo(F)];case 1:return[4,k.sent().arrayBuffer()];case 2:return[2,new(E.apply(Float32Array,[void 0,k.sent()]))]}})})}function jo(F,E){var k=E+"-weights_manifest.json";if(!F)return{modelBaseUri:"",manifestUri:k};if(F==="/")return{modelBaseUri:"/",manifestUri:"/"+k};var w=F.startsWith("http://")?"http://":F.startsWith("https://")?"https://":"",_=(F=F.replace(w,"")).split("/").filter(function(ce){return ce}),L=F.endsWith(".json")?_[_.length-1]:k,Y=w+(F.endsWith(".json")?_.slice(0,_.length-1):_).join("/");return{modelBaseUri:Y=F.startsWith("/")?"/"+Y:Y,manifestUri:Y==="/"?"/"+L:Y+"/"+L}}function Jo(F,E){return Object(Un.b)(this,void 0,void 0,function(){var k,w,_,L;return Object(Un.d)(this,function(Y){switch(Y.label){case 0:return k=jo(F,E),w=k.manifestUri,_=k.modelBaseUri,[4,no(w)];case 1:return L=Y.sent(),[2,tn.io.loadWeights(L,_)]}})})}function Fi(F,E,k){k===void 0&&(k=!1);var w=k?Vr(E):E,_=w.width,L=w.height;return F.width=_,F.height=L,{width:_,height:L}}var Di=function(){function F(E){this._name=E,this._params=void 0,this._paramMappings=[]}return Object.defineProperty(F.prototype,"params",{get:function(){return this._params},enumerable:!0,configurable:!0}),Object.defineProperty(F.prototype,"paramMappings",{get:function(){return this._paramMappings},enumerable:!0,configurable:!0}),Object.defineProperty(F.prototype,"isLoaded",{get:function(){return!!this.params},enumerable:!0,configurable:!0}),F.prototype.getParamFromPath=function(E){var k=this.traversePropertyPath(E);return k.obj[k.objProp]},F.prototype.reassignParamFromPath=function(E,k){var w=this.traversePropertyPath(E),_=w.obj,L=w.objProp;_[L].dispose(),_[L]=k},F.prototype.getParamList=function(){var E=this;return this._paramMappings.map(function(k){var w=k.paramPath;return{path:w,tensor:E.getParamFromPath(w)}})},F.prototype.getTrainableParams=function(){return this.getParamList().filter(function(E){return E.tensor instanceof tn.Variable})},F.prototype.getFrozenParams=function(){return this.getParamList().filter(function(E){return!(E.tensor instanceof tn.Variable)})},F.prototype.variable=function(){var E=this;this.getFrozenParams().forEach(function(k){var w=k.path,_=k.tensor;E.reassignParamFromPath(w,_.variable())})},F.prototype.freeze=function(){var E=this;this.getTrainableParams().forEach(function(k){var w=k.path,_=k.tensor,L=tn.tensor(_.dataSync());_.dispose(),E.reassignParamFromPath(w,L)})},F.prototype.dispose=function(E){E===void 0&&(E=!0),this.getParamList().forEach(function(k){if(E&&k.tensor.isDisposed)throw new Error("param tensor has already been disposed for path "+k.path);k.tensor.dispose()}),this._params=void 0},F.prototype.serializeParams=function(){return new Float32Array(this.getParamList().map(function(E){var k=E.tensor;return Array.from(k.dataSync())}).reduce(function(E,k){return E.concat(k)}))},F.prototype.load=function(E){return Object(Un.b)(this,void 0,void 0,function(){return Object(Un.d)(this,function(k){switch(k.label){case 0:return E instanceof Float32Array?(this.extractWeights(E),[2]):[4,this.loadFromUri(E)];case 1:return k.sent(),[2]}})})},F.prototype.loadFromUri=function(E){return Object(Un.b)(this,void 0,void 0,function(){var k;return Object(Un.d)(this,function(w){switch(w.label){case 0:if(E&&typeof E!="string")throw new Error(this._name+".loadFromUri - expected model uri");return[4,Jo(E,this.getDefaultModelName())];case 1:return k=w.sent(),this.loadFromWeightMap(k),[2]}})})},F.prototype.loadFromDisk=function(E){return Object(Un.b)(this,void 0,void 0,function(){var k,w,_,L,Y,ce,ve,De,Ce,Xe;return Object(Un.d)(this,function(nt){switch(nt.label){case 0:if(E&&typeof E!="string")throw new Error(this._name+".loadFromDisk - expected model file path");return k=Wt.getEnv().readFile,w=jo(E,this.getDefaultModelName()),_=w.manifestUri,L=w.modelBaseUri,Y=function(Et){return Promise.all(Et.map(function(At){return k(At).then(function(rn){return rn.buffer})}))},ce=tn.io.weightsLoaderFactory(Y),Ce=(De=JSON).parse,[4,k(_)];case 1:return ve=Ce.apply(De,[nt.sent().toString()]),[4,ce(ve,L)];case 2:return Xe=nt.sent(),this.loadFromWeightMap(Xe),[2]}})})},F.prototype.loadFromWeightMap=function(E){var k=this.extractParamsFromWeigthMap(E),w=k.paramMappings,_=k.params;this._paramMappings=w,this._params=_},F.prototype.extractWeights=function(E){var k=this.extractParams(E),w=k.paramMappings,_=k.params;this._paramMappings=w,this._params=_},F.prototype.traversePropertyPath=function(E){if(!this.params)throw new Error("traversePropertyPath - model has no loaded params");var k=E.split("/").reduce(function(L,Y){if(!L.nextObj.hasOwnProperty(Y))throw new Error("traversePropertyPath - object does not have property "+Y+", for path "+E);return{obj:L.nextObj,objProp:Y,nextObj:L.nextObj[Y]}},{nextObj:this.params}),w=k.obj,_=k.objProp;if(!(w&&_&&w[_]instanceof tn.Tensor))throw new Error("traversePropertyPath - parameter is not a tensor, for path "+E);return{obj:w,objProp:_}},F}();function mo(F,E,k){return tn.tidy(function(){var w=tn.separableConv2d(F,E.depthwise_filter,E.pointwise_filter,k,"same");return w=tn.add(w,E.bias)})}function la(F,E,k){return k===void 0&&(k=!1),tn.tidy(function(){var w=tn.relu(k?tn.add(tn.conv2d(F,E.conv0.filters,[2,2],"same"),E.conv0.bias):mo(F,E.conv0,[2,2])),_=mo(w,E.conv1,[1,1]),L=mo(tn.relu(tn.add(w,_)),E.conv2,[1,1]);return tn.relu(tn.add(w,tn.add(_,L)))})}function ha(F,E,k,w){return k===void 0&&(k=!1),w===void 0&&(w=!0),tn.tidy(function(){var _=tn.relu(k?tn.add(tn.conv2d(F,E.conv0.filters,w?[2,2]:[1,1],"same"),E.conv0.bias):mo(F,E.conv0,w?[2,2]:[1,1])),L=mo(_,E.conv1,[1,1]),Y=mo(tn.relu(tn.add(_,L)),E.conv2,[1,1]),ce=mo(tn.relu(tn.add(_,tn.add(L,Y))),E.conv3,[1,1]);return tn.relu(tn.add(_,tn.add(L,tn.add(Y,ce))))})}function aa(F,E,k,w){return k===void 0&&(k="same"),w===void 0&&(w=!1),tn.tidy(function(){var _=tn.add(tn.conv2d(F,E.filters,[1,1],k),E.bias);return w?tn.relu(_):_})}function Qo(F,E){Object.keys(F).forEach(function(k){E.some(function(w){return w.originalPath===k})||F[k].dispose()})}function Za(F,E){return function(k,w,_,L){var Y=tn.tensor4d(F(k*w*_*_),[_,_,k,w]),ce=tn.tensor1d(F(w));return E.push({paramPath:L+"/filters"},{paramPath:L+"/bias"}),{filters:Y,bias:ce}}}function da(F,E){return function(k,w,_){var L=tn.tensor2d(F(k*w),[k,w]),Y=tn.tensor1d(F(w));return E.push({paramPath:_+"/weights"},{paramPath:_+"/bias"}),{weights:L,bias:Y}}}var go=function(){return function(F,E,k){this.depthwise_filter=F,this.pointwise_filter=E,this.bias=k}}();function wa(F,E){return function(k,w,_){var L=tn.tensor4d(F(9*k),[3,3,k,1]),Y=tn.tensor4d(F(k*w),[1,1,k,w]),ce=tn.tensor1d(F(w));return E.push({paramPath:_+"/depthwise_filter"},{paramPath:_+"/pointwise_filter"},{paramPath:_+"/bias"}),new go(L,Y,ce)}}function Su(F){return function(E){var k=F(E+"/depthwise_filter",4),w=F(E+"/pointwise_filter",4),_=F(E+"/bias",1);return new go(k,w,_)}}function fs(F,E){return function(k,w,_){var L=F[k];if(!io(L,w))throw new Error("expected weightMap["+k+"] to be a Tensor"+w+"D, instead have "+L);return E.push({originalPath:k,paramPath:_||k}),L}}function Ma(F){var E=F;return{extractWeights:function(k){var w=E.slice(0,k);return E=E.slice(k),w},getRemainingWeights:function(){return E}}}function Fo(F,E){var k=Za(F,E),w=wa(F,E);function _(L,Y,ce,ve){return ve===void 0&&(ve=!1),{conv0:ve?k(L,Y,3,ce+"/conv0"):w(L,Y,ce+"/conv0"),conv1:w(Y,Y,ce+"/conv1"),conv2:w(Y,Y,ce+"/conv2")}}return{extractDenseBlock3Params:_,extractDenseBlock4Params:function(L,Y,ce,ve){ve===void 0&&(ve=!1);var De=_(L,Y,ce,ve);return{conv0:De.conv0,conv1:De.conv1,conv2:De.conv2,conv3:w(Y,Y,ce+"/conv3")}}}}function cc(F){return function(E){return{filters:F(E+"/filters",4),bias:F(E+"/bias",1)}}}function Ks(F,E){var k=fs(F,E),w=cc(k),_=Su(k);return{extractDenseBlock3Params:function(L,Y){return Y===void 0&&(Y=!1),{conv0:Y?w(L+"/conv0"):_(L+"/conv0"),conv1:_(L+"/conv1"),conv2:_(L+"/conv2")}},extractDenseBlock4Params:function(L,Y){return Y===void 0&&(Y=!1),{conv0:Y?w(L+"/conv0"):_(L+"/conv0"),conv1:_(L+"/conv1"),conv2:_(L+"/conv2"),conv3:_(L+"/conv3")}}}}var Rs=function(F){function E(){return F.call(this,"FaceFeatureExtractor")||this}return Object(Un.c)(E,F),E.prototype.forwardInput=function(k){var w=this.params;if(!w)throw new Error("FaceFeatureExtractor - load model before inference");return tn.tidy(function(){var _=ha(uc(k.toBatchTensor(112,!0),[122.782,117.001,104.298]).div(tn.scalar(255)),w.dense0,!0);return _=ha(_=ha(_=ha(_,w.dense1),w.dense2),w.dense3),_=tn.avgPool(_,[7,7],[2,2],"valid")})},E.prototype.forward=function(k){return Object(Un.b)(this,void 0,void 0,function(){var w;return Object(Un.d)(this,function(_){switch(_.label){case 0:return w=this.forwardInput,[4,ni(k)];case 1:return[2,w.apply(this,[_.sent()])]}})})},E.prototype.getDefaultModelName=function(){return"face_feature_extractor_model"},E.prototype.extractParamsFromWeigthMap=function(k){return function(w){var _=[],L=Ks(w,_).extractDenseBlock4Params,Y={dense0:L("dense0",!0),dense1:L("dense1"),dense2:L("dense2"),dense3:L("dense3")};return Qo(w,_),{params:Y,paramMappings:_}}(k)},E.prototype.extractParams=function(k){return function(w){var _=[],L=Ma(w),Y=L.extractWeights,ce=L.getRemainingWeights,ve=Fo(Y,_).extractDenseBlock4Params,De=ve(3,32,"dense0",!0),Ce=ve(32,64,"dense1"),Xe=ve(64,128,"dense2"),nt=ve(128,256,"dense3");if(ce().length!==0)throw new Error("weights remaing after extract: "+ce().length);return{paramMappings:_,params:{dense0:De,dense1:Ce,dense2:Xe,dense3:nt}}}(k)},E}(Di);function Zo(F,E){return tn.tidy(function(){return tn.add(tn.matMul(F,E.weights),E.bias)})}function Ms(F){var E={},k={};return Object.keys(F).forEach(function(w){(w.startsWith("fc")?k:E)[w]=F[w]}),{featureExtractorMap:E,classifierMap:k}}var Io=function(F){function E(k,w){var _=F.call(this,k)||this;return _._faceFeatureExtractor=w,_}return Object(Un.c)(E,F),Object.defineProperty(E.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),E.prototype.runNet=function(k){var w=this,_=this.params;if(!_)throw new Error(this._name+" - load model before inference");return tn.tidy(function(){var L=k instanceof Hr?w.faceFeatureExtractor.forwardInput(k):k;return Zo(L.as2D(L.shape[0],-1),_.fc)})},E.prototype.dispose=function(k){k===void 0&&(k=!0),this.faceFeatureExtractor.dispose(k),F.prototype.dispose.call(this,k)},E.prototype.loadClassifierParams=function(k){var w=this.extractClassifierParams(k),_=w.params,L=w.paramMappings;this._params=_,this._paramMappings=L},E.prototype.extractClassifierParams=function(k){return function(w,_,L){var Y=[],ce=Ma(w),ve=ce.extractWeights,De=ce.getRemainingWeights,Ce=da(ve,Y)(_,L,"fc");if(De().length!==0)throw new Error("weights remaing after extract: "+De().length);return{paramMappings:Y,params:{fc:Ce}}}(k,this.getClassifierChannelsIn(),this.getClassifierChannelsOut())},E.prototype.extractParamsFromWeigthMap=function(k){var w=Ms(k),_=w.featureExtractorMap,L=w.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(_),function(Y){var ce=[],ve=fs(Y,ce),De={fc:function(Ce){return{weights:ve(Ce+"/weights",2),bias:ve(Ce+"/bias",1)}}("fc")};return Qo(Y,ce),{params:De,paramMappings:ce}}(L)},E.prototype.extractParams=function(k){var w=this.getClassifierChannelsIn(),_=this.getClassifierChannelsOut(),L=_*w+_,Y=k.slice(0,k.length-L),ce=k.slice(k.length-L);return this.faceFeatureExtractor.extractWeights(Y),this.extractClassifierParams(ce)},E}(Di),As=["neutral","happy","sad","angry","fearful","disgusted","surprised"],hs=function(){function F(E){var k=this;if(E.length!==7)throw new Error("FaceExpressions.constructor - expected probabilities.length to be 7, have: "+E.length);As.forEach(function(w,_){k[w]=E[_]})}return F.prototype.asSortedArray=function(){var E=this;return As.map(function(k){return{expression:k,probability:E[k]}}).sort(function(k,w){return w.probability-k.probability})},F}(),oo=function(F){function E(k){return k===void 0&&(k=new Rs),F.call(this,"FaceExpressionNet",k)||this}return Object(Un.c)(E,F),E.prototype.forwardInput=function(k){var w=this;return tn.tidy(function(){return tn.softmax(w.runNet(k))})},E.prototype.forward=function(k){return Object(Un.b)(this,void 0,void 0,function(){var w;return Object(Un.d)(this,function(_){switch(_.label){case 0:return w=this.forwardInput,[4,ni(k)];case 1:return[2,w.apply(this,[_.sent()])]}})})},E.prototype.predictExpressions=function(k){return Object(Un.b)(this,void 0,void 0,function(){var w,_,L,Y,ce=this;return Object(Un.d)(this,function(ve){switch(ve.label){case 0:return[4,ni(k)];case 1:return w=ve.sent(),[4,this.forwardInput(w)];case 2:return _=ve.sent(),[4,Promise.all(tn.unstack(_).map(function(De){return Object(Un.b)(ce,void 0,void 0,function(){var Ce;return Object(Un.d)(this,function(Xe){switch(Xe.label){case 0:return[4,De.data()];case 1:return Ce=Xe.sent(),De.dispose(),[2,Ce]}})})}))];case 3:return L=ve.sent(),_.dispose(),Y=L.map(function(De){return new hs(De)}),[2,w.isBatchInput?Y:Y[0]]}})})},E.prototype.getDefaultModelName=function(){return"face_expression_model"},E.prototype.getClassifierChannelsIn=function(){return 256},E.prototype.getClassifierChannelsOut=function(){return 7},E}(Io);function Ss(F){return F.expressions instanceof hs}function Ga(F,E){var k={expressions:E};return Object.assign({},F,k)}function Xs(F,E,k,w){k===void 0&&(k=.1),(Array.isArray(E)?E:[E]).forEach(function(_){var L=_ instanceof hs?_:Ss(_)?_.expressions:void 0;if(!L)throw new Error("drawFaceExpressions - expected faceExpressions to be FaceExpressions | WithFaceExpressions<{}> or array thereof");var Y=L.asSortedArray().filter(function(ve){return ve.probability>k}),ce=Pl(_)?_.detection.box.bottomLeft:w||new so(0,0);new Nn(Y.map(function(ve){return ve.expression+" ("+ku(ve.probability)+")"}),ce).draw(F)})}function Sc(F){return Pl(F)&&F.landmarks instanceof Gs&&F.unshiftedLandmarks instanceof Gs&&F.alignedRect instanceof Yo}function Uo(F,E){var k=F.detection.box,w=E.shiftBy(k.x,k.y),_=w.align(),L=F.detection.imageDims,Y={landmarks:w,unshiftedLandmarks:E,alignedRect:new Yo(F.detection.score,_.rescale(L.reverse()),L)};return Object.assign({},F,Y)}var es=function(){return function(F){F===void 0&&(F={});var E=F.drawLines,k=E===void 0||E,w=F.drawPoints,_=w===void 0||w,L=F.lineWidth,Y=F.lineColor,ce=F.pointSize,ve=F.pointColor;this.drawLines=k,this.drawPoints=_,this.lineWidth=L||1,this.pointSize=ce||2,this.lineColor=Y||"rgba(0, 255, 255, 1)",this.pointColor=ve||"rgba(255, 0, 255, 1)"}}(),ja=function(){function F(E,k){k===void 0&&(k={}),this.faceLandmarks=E,this.options=new es(k)}return F.prototype.draw=function(E){var k=bn(E),w=this.options,_=w.drawLines,L=w.drawPoints,Y=w.lineWidth,ce=w.lineColor,ve=w.pointSize,De=w.pointColor;_&&this.faceLandmarks instanceof Au&&(k.strokeStyle=ce,k.lineWidth=Y,Vs(k,this.faceLandmarks.getJawOutline()),Vs(k,this.faceLandmarks.getLeftEyeBrow()),Vs(k,this.faceLandmarks.getRightEyeBrow()),Vs(k,this.faceLandmarks.getNose()),Vs(k,this.faceLandmarks.getLeftEye(),!0),Vs(k,this.faceLandmarks.getRightEye(),!0),Vs(k,this.faceLandmarks.getMouth(),!0)),L&&(k.strokeStyle=De,k.fillStyle=De,this.faceLandmarks.positions.forEach(function(Ce){k.beginPath(),k.arc(Ce.x,Ce.y,ve,0,2*Math.PI),k.fill()}))},F}();function lc(F,E){(Array.isArray(E)?E:[E]).forEach(function(k){var w=k instanceof Gs?k:Sc(k)?k.landmarks:void 0;if(!w)throw new Error("drawFaceLandmarks - expected faceExpressions to be FaceLandmarks | WithFaceLandmarks<WithFaceDetection<{}>> or array thereof");new ja(w).draw(F)})}function el(F,E){var k=[],w=Ma(F),_=w.extractWeights,L=w.getRemainingWeights,Y=function(At,rn){var un=Za(At,rn),kn=wa(At,rn);return{extractConvParams:un,extractSeparableConvParams:kn,extractReductionBlockParams:function(En,_n,Pn){return{separable_conv0:kn(En,_n,Pn+"/separable_conv0"),separable_conv1:kn(_n,_n,Pn+"/separable_conv1"),expansion_conv:un(En,_n,1,Pn+"/expansion_conv")}},extractMainBlockParams:function(En,_n){return{separable_conv0:kn(En,En,_n+"/separable_conv0"),separable_conv1:kn(En,En,_n+"/separable_conv1"),separable_conv2:kn(En,En,_n+"/separable_conv2")}}}}(_,k),ce=Y.extractConvParams,ve=Y.extractSeparableConvParams,De=Y.extractReductionBlockParams,Ce=Y.extractMainBlockParams,Xe={conv_in:ce(3,32,3,"entry_flow/conv_in"),reduction_block_0:De(32,64,"entry_flow/reduction_block_0"),reduction_block_1:De(64,128,"entry_flow/reduction_block_1")},nt={};Xo(E,0,1).forEach(function(At){nt["main_block_"+At]=Ce(128,"middle_flow/main_block_"+At)});var Et={reduction_block:De(128,256,"exit_flow/reduction_block"),separable_conv:ve(256,512,"exit_flow/separable_conv")};if(L().length!==0)throw new Error("weights remaing after extract: "+L().length);return{paramMappings:k,params:{entry_flow:Xe,middle_flow:nt,exit_flow:Et}}}function ci(F,E){var k=[],w=function(Xe,nt){var Et=fs(Xe,nt),At=cc(Et),rn=Su(Et);return{extractConvParams:At,extractSeparableConvParams:rn,extractReductionBlockParams:function(un){return{separable_conv0:rn(un+"/separable_conv0"),separable_conv1:rn(un+"/separable_conv1"),expansion_conv:At(un+"/expansion_conv")}},extractMainBlockParams:function(un){return{separable_conv0:rn(un+"/separable_conv0"),separable_conv1:rn(un+"/separable_conv1"),separable_conv2:rn(un+"/separable_conv2")}}}}(F,k),_=w.extractConvParams,L=w.extractSeparableConvParams,Y=w.extractReductionBlockParams,ce=w.extractMainBlockParams,ve={conv_in:_("entry_flow/conv_in"),reduction_block_0:Y("entry_flow/reduction_block_0"),reduction_block_1:Y("entry_flow/reduction_block_1")},De={};Xo(E,0,1).forEach(function(Xe){De["main_block_"+Xe]=ce("middle_flow/main_block_"+Xe)});var Ce={reduction_block:Y("exit_flow/reduction_block"),separable_conv:L("exit_flow/separable_conv")};return Qo(F,k),{params:{entry_flow:ve,middle_flow:De,exit_flow:Ce},paramMappings:k}}function Xd(F,E,k){return tn.add(tn.conv2d(F,E.filters,k,"same"),E.bias)}function tl(F,E,k){k===void 0&&(k=!0);var w=k?tn.relu(F):F;return w=mo(w,E.separable_conv0,[1,1]),w=mo(tn.relu(w),E.separable_conv1,[1,1]),w=tn.maxPool(w,[3,3],[2,2],"same"),w=tn.add(w,Xd(F,E.expansion_conv,[2,2]))}var Ll,vg=function(F){function E(k){var w=F.call(this,"TinyXception")||this;return w._numMainBlocks=k,w}return Object(Un.c)(E,F),E.prototype.forwardInput=function(k){var w=this,_=this.params;if(!_)throw new Error("TinyXception - load model before inference");return tn.tidy(function(){var L=uc(k.toBatchTensor(112,!0),[122.782,117.001,104.298]).div(tn.scalar(256)),Y=tn.relu(Xd(L,_.entry_flow.conv_in,[2,2]));return Y=tl(Y=tl(Y,_.entry_flow.reduction_block_0,!1),_.entry_flow.reduction_block_1),Xo(w._numMainBlocks,0,1).forEach(function(ce){Y=function(ve,De){var Ce=mo(tn.relu(ve),De.separable_conv0,[1,1]);return Ce=mo(tn.relu(Ce),De.separable_conv1,[1,1]),Ce=mo(tn.relu(Ce),De.separable_conv2,[1,1]),Ce=tn.add(Ce,ve)}(Y,_.middle_flow["main_block_"+ce])}),Y=tl(Y,_.exit_flow.reduction_block),Y=tn.relu(mo(Y,_.exit_flow.separable_conv,[1,1]))})},E.prototype.forward=function(k){return Object(Un.b)(this,void 0,void 0,function(){var w;return Object(Un.d)(this,function(_){switch(_.label){case 0:return w=this.forwardInput,[4,ni(k)];case 1:return[2,w.apply(this,[_.sent()])]}})})},E.prototype.getDefaultModelName=function(){return"tiny_xception_model"},E.prototype.extractParamsFromWeigthMap=function(k){return ci(k,this._numMainBlocks)},E.prototype.extractParams=function(k){return el(k,this._numMainBlocks)},E}(Di);(function(F){F.FEMALE="female",F.MALE="male"})(Ll||(Ll={}));var yg=function(F){function E(k){k===void 0&&(k=new vg(2));var w=F.call(this,"AgeGenderNet")||this;return w._faceFeatureExtractor=k,w}return Object(Un.c)(E,F),Object.defineProperty(E.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),E.prototype.runNet=function(k){var w=this,_=this.params;if(!_)throw new Error(this._name+" - load model before inference");return tn.tidy(function(){var L=k instanceof Hr?w.faceFeatureExtractor.forwardInput(k):k,Y=tn.avgPool(L,[7,7],[2,2],"valid").as2D(L.shape[0],-1);return{age:Zo(Y,_.fc.age).as1D(),gender:Zo(Y,_.fc.gender)}})},E.prototype.forwardInput=function(k){var w=this;return tn.tidy(function(){var _=w.runNet(k),L=_.age,Y=_.gender;return{age:L,gender:tn.softmax(Y)}})},E.prototype.forward=function(k){return Object(Un.b)(this,void 0,void 0,function(){var w;return Object(Un.d)(this,function(_){switch(_.label){case 0:return w=this.forwardInput,[4,ni(k)];case 1:return[2,w.apply(this,[_.sent()])]}})})},E.prototype.predictAgeAndGender=function(k){return Object(Un.b)(this,void 0,void 0,function(){var w,_,L,Y,ce,ve,De=this;return Object(Un.d)(this,function(Ce){switch(Ce.label){case 0:return[4,ni(k)];case 1:return w=Ce.sent(),[4,this.forwardInput(w)];case 2:return _=Ce.sent(),L=tn.unstack(_.age),Y=tn.unstack(_.gender),ce=L.map(function(Xe,nt){return{ageTensor:Xe,genderTensor:Y[nt]}}),[4,Promise.all(ce.map(function(Xe){var nt=Xe.ageTensor,Et=Xe.genderTensor;return Object(Un.b)(De,void 0,void 0,function(){var At,rn,un,kn,En;return Object(Un.d)(this,function(_n){switch(_n.label){case 0:return[4,nt.data()];case 1:return At=_n.sent()[0],[4,Et.data()];case 2:return rn=_n.sent()[0],kn=(un=rn>.5)?Ll.MALE:Ll.FEMALE,En=un?rn:1-rn,nt.dispose(),Et.dispose(),[2,{age:At,gender:kn,genderProbability:En}]}})})}))];case 3:return ve=Ce.sent(),_.age.dispose(),_.gender.dispose(),[2,w.isBatchInput?ve:ve[0]]}})})},E.prototype.getDefaultModelName=function(){return"age_gender_model"},E.prototype.dispose=function(k){k===void 0&&(k=!0),this.faceFeatureExtractor.dispose(k),F.prototype.dispose.call(this,k)},E.prototype.loadClassifierParams=function(k){var w=this.extractClassifierParams(k),_=w.params,L=w.paramMappings;this._params=_,this._paramMappings=L},E.prototype.extractClassifierParams=function(k){return function(w){var _=[],L=Ma(w),Y=L.extractWeights,ce=L.getRemainingWeights,ve=da(Y,_),De=ve(512,1,"fc/age"),Ce=ve(512,2,"fc/gender");if(ce().length!==0)throw new Error("weights remaing after extract: "+ce().length);return{paramMappings:_,params:{fc:{age:De,gender:Ce}}}}(k)},E.prototype.extractParamsFromWeigthMap=function(k){var w=Ms(k),_=w.featureExtractorMap,L=w.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(_),function(Y){var ce=[],ve=fs(Y,ce);function De(Xe){return{weights:ve(Xe+"/weights",2),bias:ve(Xe+"/bias",1)}}var Ce={fc:{age:De("fc/age"),gender:De("fc/gender")}};return Qo(Y,ce),{params:Ce,paramMappings:ce}}(L)},E.prototype.extractParams=function(k){var w=k.slice(0,k.length-1539),_=k.slice(k.length-1539);return this.faceFeatureExtractor.extractWeights(w),this.extractClassifierParams(_)},E}(Di),Cm=function(F){function E(){return F!==null&&F.apply(this,arguments)||this}return Object(Un.c)(E,F),E.prototype.postProcess=function(k,w,_){var L=_.map(function(ce){var ve=ce.width,De=ce.height,Ce=w/Math.max(De,ve);return{width:ve*Ce,height:De*Ce}}),Y=L.length;return tn.tidy(function(){var ce=function(De,Ce){return tn.stack([tn.fill([68],De),tn.fill([68],Ce)],1).as2D(1,136).as1D()},ve=function(De,Ce){var Xe=L[De],nt=Xe.width,Et=Xe.height;return Ce(nt,Et)?Math.abs(nt-Et)/2:0};return k.mul(tn.fill([Y,136],w)).sub(tn.stack(Array.from(Array(Y),function(De,Ce){return ce(function(Xe){return ve(Xe,function(nt,Et){return nt<Et})}(Ce),function(Xe){return ve(Xe,function(nt,Et){return Et<nt})}(Ce))}))).div(tn.stack(Array.from(Array(Y),function(De,Ce){return ce(L[Ce].width,L[Ce].height)})))})},E.prototype.forwardInput=function(k){var w=this;return tn.tidy(function(){var _=w.runNet(k);return w.postProcess(_,k.inputSize,k.inputDimensions.map(function(L){return{height:L[0],width:L[1]}}))})},E.prototype.forward=function(k){return Object(Un.b)(this,void 0,void 0,function(){var w;return Object(Un.d)(this,function(_){switch(_.label){case 0:return w=this.forwardInput,[4,ni(k)];case 1:return[2,w.apply(this,[_.sent()])]}})})},E.prototype.detectLandmarks=function(k){return Object(Un.b)(this,void 0,void 0,function(){var w,_,L,Y=this;return Object(Un.d)(this,function(ce){switch(ce.label){case 0:return[4,ni(k)];case 1:return w=ce.sent(),_=tn.tidy(function(){return tn.unstack(Y.forwardInput(w))}),[4,Promise.all(_.map(function(ve,De){return Object(Un.b)(Y,void 0,void 0,function(){var Ce,Xe,nt,Et,At;return Object(Un.d)(this,function(rn){switch(rn.label){case 0:return nt=(Xe=Array).from,[4,ve.data()];case 1:return Ce=nt.apply(Xe,[rn.sent()]),Et=Ce.filter(function(un,kn){return Hi(kn)}),At=Ce.filter(function(un,kn){return!Hi(kn)}),[2,new Au(Array(68).fill(0).map(function(un,kn){return new so(Et[kn],At[kn])}),{height:w.getInputHeight(De),width:w.getInputWidth(De)})]}})})}))];case 2:return L=ce.sent(),_.forEach(function(ve){return ve.dispose()}),[2,w.isBatchInput?L:L[0]]}})})},E.prototype.getClassifierChannelsOut=function(){return 136},E}(Io),Om=function(F){function E(k){return k===void 0&&(k=new Rs),F.call(this,"FaceLandmark68Net",k)||this}return Object(Un.c)(E,F),E.prototype.getDefaultModelName=function(){return"face_landmark_68_model"},E.prototype.getClassifierChannelsIn=function(){return 256},E}(Cm),bg=function(F){function E(){return F.call(this,"TinyFaceFeatureExtractor")||this}return Object(Un.c)(E,F),E.prototype.forwardInput=function(k){var w=this.params;if(!w)throw new Error("TinyFaceFeatureExtractor - load model before inference");return tn.tidy(function(){var _=la(uc(k.toBatchTensor(112,!0),[122.782,117.001,104.298]).div(tn.scalar(255)),w.dense0,!0);return _=la(_=la(_,w.dense1),w.dense2),_=tn.avgPool(_,[14,14],[2,2],"valid")})},E.prototype.forward=function(k){return Object(Un.b)(this,void 0,void 0,function(){var w;return Object(Un.d)(this,function(_){switch(_.label){case 0:return w=this.forwardInput,[4,ni(k)];case 1:return[2,w.apply(this,[_.sent()])]}})})},E.prototype.getDefaultModelName=function(){return"face_feature_extractor_tiny_model"},E.prototype.extractParamsFromWeigthMap=function(k){return function(w){var _=[],L=Ks(w,_).extractDenseBlock3Params,Y={dense0:L("dense0",!0),dense1:L("dense1"),dense2:L("dense2")};return Qo(w,_),{params:Y,paramMappings:_}}(k)},E.prototype.extractParams=function(k){return function(w){var _=[],L=Ma(w),Y=L.extractWeights,ce=L.getRemainingWeights,ve=Fo(Y,_).extractDenseBlock3Params,De=ve(3,32,"dense0",!0),Ce=ve(32,64,"dense1"),Xe=ve(64,128,"dense2");if(ce().length!==0)throw new Error("weights remaing after extract: "+ce().length);return{paramMappings:_,params:{dense0:De,dense1:Ce,dense2:Xe}}}(k)},E}(Di),Am=function(F){function E(k){return k===void 0&&(k=new bg),F.call(this,"FaceLandmark68TinyNet",k)||this}return Object(Un.c)(E,F),E.prototype.getDefaultModelName=function(){return"face_landmark_68_tiny_model"},E.prototype.getClassifierChannelsIn=function(){return 128},E}(Cm),xg=function(F){function E(){return F!==null&&F.apply(this,arguments)||this}return Object(Un.c)(E,F),E}(Om);function Pf(F,E,k,w,_){_===void 0&&(_="same");var L=E.conv,Y=L.filters,ce=L.bias,ve=tn.conv2d(F,Y,k,_);return ve=function(De,Ce){return tn.add(tn.mul(De,Ce.weights),Ce.biases)}(ve=tn.add(ve,ce),E.scale),w?tn.relu(ve):ve}function Yd(F,E){return Pf(F,E,[1,1],!1)}function wg(F,E){return Pf(F,E,[2,2],!0,"valid")}function kg(F,E){function k(_,L,Y,ce){var ve=function(Ce,Xe,nt){var Et=F(Ce),At=Et.length/(Xe*nt*nt);if(xa(At))throw new Error("depth has to be an integer: "+At+", weights.length: "+Et.length+", numFilters: "+Xe+", filterSize: "+nt);return tn.tidy(function(){return tn.transpose(tn.tensor4d(Et,[Xe,At,nt,nt]),[2,3,1,0])})}(_,L,Y),De=tn.tensor1d(F(L));return E.push({paramPath:ce+"/filters"},{paramPath:ce+"/bias"}),{filters:ve,bias:De}}function w(_,L,Y,ce){return{conv:k(_,L,Y,ce+"/conv"),scale:function(ve,De){var Ce=tn.tensor1d(F(ve)),Xe=tn.tensor1d(F(ve));return E.push({paramPath:De+"/weights"},{paramPath:De+"/biases"}),{weights:Ce,biases:Xe}}(L,ce+"/scale")}}return{extractConvLayerParams:w,extractResidualLayerParams:function(_,L,Y,ce,ve){return ve===void 0&&(ve=!1),{conv1:w((ve?.5:1)*_,L,Y,ce+"/conv1"),conv2:w(_,L,Y,ce+"/conv2")}}}}function Eg(F,E){var k=fs(F,E);function w(_){return{conv:{filters:k(_+"/conv/filters",4),bias:k(_+"/conv/bias",1)},scale:function(L){return{weights:k(L+"/scale/weights",1),biases:k(L+"/scale/biases",1)}}(_)}}return{extractConvLayerParams:w,extractResidualLayerParams:function(_){return{conv1:w(_+"/conv1"),conv2:w(_+"/conv2")}}}}function _c(F,E){var k=function(w,_){return Pf(w,_,[1,1],!0)}(F,E.conv1);return k=Yd(k,E.conv2),k=tn.add(k,F),k=tn.relu(k)}function Lf(F,E){var k=wg(F,E.conv1);k=Yd(k,E.conv2);var w=tn.avgPool(F,2,2,"valid"),_=tn.zeros(w.shape),L=w.shape[3]!==k.shape[3];if(w.shape[1]!==k.shape[1]||w.shape[2]!==k.shape[2]){var Y=Object(Un.e)(k.shape);Y[1]=1;var ce=tn.zeros(Y);k=tn.concat([k,ce],1);var ve=Object(Un.e)(k.shape);ve[2]=1;var De=tn.zeros(ve);k=tn.concat([k,De],2)}return w=L?tn.concat([w,_],3):w,k=tn.add(w,k),k=tn.relu(k)}var Jd=function(F){function E(){return F.call(this,"FaceRecognitionNet")||this}return Object(Un.c)(E,F),E.prototype.forwardInput=function(k){var w=this.params;if(!w)throw new Error("FaceRecognitionNet - load model before inference");return tn.tidy(function(){var _=wg(uc(k.toBatchTensor(150,!0).toFloat(),[122.782,117.001,104.298]).div(tn.scalar(256)),w.conv32_down),L=(_=Lf(_=_c(_=_c(_=Lf(_=_c(_=_c(_=Lf(_=_c(_=_c(_=_c(_=Lf(_=_c(_=_c(_=_c(_=tn.maxPool(_,3,2,"valid"),w.conv32_1),w.conv32_2),w.conv32_3),w.conv64_down),w.conv64_1),w.conv64_2),w.conv64_3),w.conv128_down),w.conv128_1),w.conv128_2),w.conv256_down),w.conv256_1),w.conv256_2),w.conv256_down_out)).mean([1,2]);return tn.matMul(L,w.fc)})},E.prototype.forward=function(k){return Object(Un.b)(this,void 0,void 0,function(){var w;return Object(Un.d)(this,function(_){switch(_.label){case 0:return w=this.forwardInput,[4,ni(k)];case 1:return[2,w.apply(this,[_.sent()])]}})})},E.prototype.computeFaceDescriptor=function(k){return Object(Un.b)(this,void 0,void 0,function(){var w,_,L,Y=this;return Object(Un.d)(this,function(ce){switch(ce.label){case 0:return[4,ni(k)];case 1:return w=ce.sent(),_=tn.tidy(function(){return tn.unstack(Y.forwardInput(w))}),[4,Promise.all(_.map(function(ve){return ve.data()}))];case 2:return L=ce.sent(),_.forEach(function(ve){return ve.dispose()}),[2,w.isBatchInput?L:L[0]]}})})},E.prototype.getDefaultModelName=function(){return"face_recognition_model"},E.prototype.extractParamsFromWeigthMap=function(k){return function(w){var _=[],L=Eg(w,_),Y=L.extractConvLayerParams,ce=L.extractResidualLayerParams,ve=Y("conv32_down"),De=ce("conv32_1"),Ce=ce("conv32_2"),Xe=ce("conv32_3"),nt=ce("conv64_down"),Et=ce("conv64_1"),At=ce("conv64_2"),rn=ce("conv64_3"),un=ce("conv128_down"),kn=ce("conv128_1"),En=ce("conv128_2"),_n=ce("conv256_down"),Pn=ce("conv256_1"),dn=ce("conv256_2"),cr=ce("conv256_down_out"),yr=w.fc;if(_.push({originalPath:"fc",paramPath:"fc"}),!Rf(yr))throw new Error("expected weightMap[fc] to be a Tensor2D, instead have "+yr);var br={conv32_down:ve,conv32_1:De,conv32_2:Ce,conv32_3:Xe,conv64_down:nt,conv64_1:Et,conv64_2:At,conv64_3:rn,conv128_down:un,conv128_1:kn,conv128_2:En,conv256_down:_n,conv256_1:Pn,conv256_2:dn,conv256_down_out:cr,fc:yr};return Qo(w,_),{params:br,paramMappings:_}}(k)},E.prototype.extractParams=function(k){return function(w){var _=Ma(w),L=_.extractWeights,Y=_.getRemainingWeights,ce=[],ve=kg(L,ce),De=ve.extractConvLayerParams,Ce=ve.extractResidualLayerParams,Xe=De(4704,32,7,"conv32_down"),nt=Ce(9216,32,3,"conv32_1"),Et=Ce(9216,32,3,"conv32_2"),At=Ce(9216,32,3,"conv32_3"),rn=Ce(36864,64,3,"conv64_down",!0),un=Ce(36864,64,3,"conv64_1"),kn=Ce(36864,64,3,"conv64_2"),En=Ce(36864,64,3,"conv64_3"),_n=Ce(147456,128,3,"conv128_down",!0),Pn=Ce(147456,128,3,"conv128_1"),dn=Ce(147456,128,3,"conv128_2"),cr=Ce(589824,256,3,"conv256_down",!0),yr=Ce(589824,256,3,"conv256_1"),br=Ce(589824,256,3,"conv256_2"),Br=Ce(589824,256,3,"conv256_down_out"),Or=tn.tidy(function(){return tn.transpose(tn.tensor2d(L(32768),[128,256]),[1,0])});if(ce.push({paramPath:"fc"}),Y().length!==0)throw new Error("weights remaing after extract: "+Y().length);return{params:{conv32_down:Xe,conv32_1:nt,conv32_2:Et,conv32_3:At,conv64_down:rn,conv64_1:un,conv64_2:kn,conv64_3:En,conv128_down:_n,conv128_1:Pn,conv128_2:dn,conv256_down:cr,conv256_1:yr,conv256_2:br,conv256_down_out:Br,fc:Or},paramMappings:ce}}(k)},E}(Di);function Sm(F){var E=new Jd;return E.extractWeights(F),E}function _m(F,E){var k={descriptor:E};return Object.assign({},F,k)}function T0(F){return typeof F.age=="number"}function Dm(F,E){var k={age:E};return Object.assign({},F,k)}function qh(F){return(F.gender===Ll.MALE||F.gender===Ll.FEMALE)&&Hs(F.genderProbability)}function zf(F,E,k){var w={gender:E,genderProbability:k};return Object.assign({},F,w)}var Dc=function(){function F(E){var k=E===void 0?{}:E,w=k.minFaceSize,_=k.scaleFactor,L=k.maxNumScales,Y=k.scoreThresholds,ce=k.scaleSteps;if(this._name="MtcnnOptions",this._minFaceSize=w||20,this._scaleFactor=_||.709,this._maxNumScales=L||10,this._scoreThresholds=Y||[.6,.7,.7],this._scaleSteps=ce,typeof this._minFaceSize!="number"||this._minFaceSize<0)throw new Error(this._name+" - expected minFaceSize to be a number > 0");if(typeof this._scaleFactor!="number"||this._scaleFactor<=0||this._scaleFactor>=1)throw new Error(this._name+" - expected scaleFactor to be a number between 0 and 1");if(typeof this._maxNumScales!="number"||this._maxNumScales<0)throw new Error(this._name+" - expected maxNumScales to be a number > 0");if(!Array.isArray(this._scoreThresholds)||this._scoreThresholds.length!==3||this._scoreThresholds.some(function(ve){return typeof ve!="number"}))throw new Error(this._name+" - expected scoreThresholds to be an array of numbers of length 3");if(this._scaleSteps&&(!Array.isArray(this._scaleSteps)||this._scaleSteps.some(function(ve){return typeof ve!="number"})))throw new Error(this._name+" - expected scaleSteps to be an array of numbers")}return Object.defineProperty(F.prototype,"minFaceSize",{get:function(){return this._minFaceSize},enumerable:!0,configurable:!0}),Object.defineProperty(F.prototype,"scaleFactor",{get:function(){return this._scaleFactor},enumerable:!0,configurable:!0}),Object.defineProperty(F.prototype,"maxNumScales",{get:function(){return this._maxNumScales},enumerable:!0,configurable:!0}),Object.defineProperty(F.prototype,"scoreThresholds",{get:function(){return this._scoreThresholds},enumerable:!0,configurable:!0}),Object.defineProperty(F.prototype,"scaleSteps",{get:function(){return this._scaleSteps},enumerable:!0,configurable:!0}),F}();function Tm(F,E){function k(L,Y,ce,ve,De){var Ce=tn.tensor4d(F(L*Y*ce*ce),[ce,ce,L,Y]),Xe=tn.tensor1d(F(Y));return E.push({paramPath:ve+"/filters"},{paramPath:ve+"/"+(De?"batch_norm_offset":"bias")}),{filters:Ce,bias:Xe}}function w(L,Y,ce,ve){var De=k(L,Y,ce,ve,!0);return{filters:De.filters,batch_norm_offset:De.bias}}function _(L,Y,ce){return{depthwise_conv:function(ve,De){var Ce=tn.tensor4d(F(9*ve),[3,3,ve,1]),Xe=tn.tensor1d(F(ve)),nt=tn.tensor1d(F(ve)),Et=tn.tensor1d(F(ve)),At=tn.tensor1d(F(ve));return E.push({paramPath:De+"/filters"},{paramPath:De+"/batch_norm_scale"},{paramPath:De+"/batch_norm_offset"},{paramPath:De+"/batch_norm_mean"},{paramPath:De+"/batch_norm_variance"}),{filters:Ce,batch_norm_scale:Xe,batch_norm_offset:nt,batch_norm_mean:Et,batch_norm_variance:At}}(L,ce+"/depthwise_conv"),pointwise_conv:w(L,Y,1,ce+"/pointwise_conv")}}return{extractMobilenetV1Params:function(){return{conv_0:w(3,32,3,"mobilenetv1/conv_0"),conv_1:_(32,64,"mobilenetv1/conv_1"),conv_2:_(64,128,"mobilenetv1/conv_2"),conv_3:_(128,128,"mobilenetv1/conv_3"),conv_4:_(128,256,"mobilenetv1/conv_4"),conv_5:_(256,256,"mobilenetv1/conv_5"),conv_6:_(256,512,"mobilenetv1/conv_6"),conv_7:_(512,512,"mobilenetv1/conv_7"),conv_8:_(512,512,"mobilenetv1/conv_8"),conv_9:_(512,512,"mobilenetv1/conv_9"),conv_10:_(512,512,"mobilenetv1/conv_10"),conv_11:_(512,512,"mobilenetv1/conv_11"),conv_12:_(512,1024,"mobilenetv1/conv_12"),conv_13:_(1024,1024,"mobilenetv1/conv_13")}},extractPredictionLayerParams:function(){return{conv_0:w(1024,256,1,"prediction_layer/conv_0"),conv_1:w(256,512,3,"prediction_layer/conv_1"),conv_2:w(512,128,1,"prediction_layer/conv_2"),conv_3:w(128,256,3,"prediction_layer/conv_3"),conv_4:w(256,128,1,"prediction_layer/conv_4"),conv_5:w(128,256,3,"prediction_layer/conv_5"),conv_6:w(256,64,1,"prediction_layer/conv_6"),conv_7:w(64,128,3,"prediction_layer/conv_7"),box_predictor_0:{box_encoding_predictor:k(512,12,1,"prediction_layer/box_predictor_0/box_encoding_predictor"),class_predictor:k(512,9,1,"prediction_layer/box_predictor_0/class_predictor")},box_predictor_1:{box_encoding_predictor:k(1024,24,1,"prediction_layer/box_predictor_1/box_encoding_predictor"),class_predictor:k(1024,18,1,"prediction_layer/box_predictor_1/class_predictor")},box_predictor_2:{box_encoding_predictor:k(512,24,1,"prediction_layer/box_predictor_2/box_encoding_predictor"),class_predictor:k(512,18,1,"prediction_layer/box_predictor_2/class_predictor")},box_predictor_3:{box_encoding_predictor:k(256,24,1,"prediction_layer/box_predictor_3/box_encoding_predictor"),class_predictor:k(256,18,1,"prediction_layer/box_predictor_3/class_predictor")},box_predictor_4:{box_encoding_predictor:k(256,24,1,"prediction_layer/box_predictor_4/box_encoding_predictor"),class_predictor:k(256,18,1,"prediction_layer/box_predictor_4/class_predictor")},box_predictor_5:{box_encoding_predictor:k(128,24,1,"prediction_layer/box_predictor_5/box_encoding_predictor"),class_predictor:k(128,18,1,"prediction_layer/box_predictor_5/class_predictor")}}}}}function Nm(F){var E=[],k=function(ce,ve){var De=fs(ce,ve);function Ce(At,rn,un){return{filters:De(At+"/Conv2d_"+rn+"_pointwise/weights",4,un+"/filters"),batch_norm_offset:De(At+"/Conv2d_"+rn+"_pointwise/convolution_bn_offset",1,un+"/batch_norm_offset")}}function Xe(At){var rn="mobilenetv1/conv_"+At,un="MobilenetV1/Conv2d_"+At+"_depthwise",kn=rn+"/depthwise_conv",En=rn+"/pointwise_conv";return{depthwise_conv:{filters:De(un+"/depthwise_weights",4,kn+"/filters"),batch_norm_scale:De(un+"/BatchNorm/gamma",1,kn+"/batch_norm_scale"),batch_norm_offset:De(un+"/BatchNorm/beta",1,kn+"/batch_norm_offset"),batch_norm_mean:De(un+"/BatchNorm/moving_mean",1,kn+"/batch_norm_mean"),batch_norm_variance:De(un+"/BatchNorm/moving_variance",1,kn+"/batch_norm_variance")},pointwise_conv:Ce("MobilenetV1",At,En)}}function nt(At,rn){return{filters:De(At+"/weights",4,rn+"/filters"),bias:De(At+"/biases",1,rn+"/bias")}}function Et(At){return{box_encoding_predictor:nt("Prediction/BoxPredictor_"+At+"/BoxEncodingPredictor","prediction_layer/box_predictor_"+At+"/box_encoding_predictor"),class_predictor:nt("Prediction/BoxPredictor_"+At+"/ClassPredictor","prediction_layer/box_predictor_"+At+"/class_predictor")}}return{extractMobilenetV1Params:function(){return{conv_0:Ce("MobilenetV1",0,"mobilenetv1/conv_0"),conv_1:Xe(1),conv_2:Xe(2),conv_3:Xe(3),conv_4:Xe(4),conv_5:Xe(5),conv_6:Xe(6),conv_7:Xe(7),conv_8:Xe(8),conv_9:Xe(9),conv_10:Xe(10),conv_11:Xe(11),conv_12:Xe(12),conv_13:Xe(13)}},extractPredictionLayerParams:function(){return{conv_0:Ce("Prediction",0,"prediction_layer/conv_0"),conv_1:Ce("Prediction",1,"prediction_layer/conv_1"),conv_2:Ce("Prediction",2,"prediction_layer/conv_2"),conv_3:Ce("Prediction",3,"prediction_layer/conv_3"),conv_4:Ce("Prediction",4,"prediction_layer/conv_4"),conv_5:Ce("Prediction",5,"prediction_layer/conv_5"),conv_6:Ce("Prediction",6,"prediction_layer/conv_6"),conv_7:Ce("Prediction",7,"prediction_layer/conv_7"),box_predictor_0:Et(0),box_predictor_1:Et(1),box_predictor_2:Et(2),box_predictor_3:Et(3),box_predictor_4:Et(4),box_predictor_5:Et(5)}}}}(F,E),w=k.extractMobilenetV1Params,_=k.extractPredictionLayerParams,L=F["Output/extra_dim"];if(E.push({originalPath:"Output/extra_dim",paramPath:"output_layer/extra_dim"}),!nr(L))throw new Error("expected weightMap['Output/extra_dim'] to be a Tensor3D, instead have "+L);var Y={mobilenetv1:w(),prediction_layer:_(),output_layer:{extra_dim:L}};return Qo(F,E),{params:Y,paramMappings:E}}function _u(F,E,k){return tn.tidy(function(){var w=tn.conv2d(F,E.filters,k,"same");return w=tn.add(w,E.batch_norm_offset),tn.clipByValue(w,0,6)})}var Fm=.0010000000474974513;function Hh(F,E){return tn.tidy(function(){var k=null,w=_u(F,E.conv_0,[2,2]);if([E.conv_1,E.conv_2,E.conv_3,E.conv_4,E.conv_5,E.conv_6,E.conv_7,E.conv_8,E.conv_9,E.conv_10,E.conv_11,E.conv_12,E.conv_13].forEach(function(_,L){var Y=L+1,ce=function(ve){return[2,4,6,12].some(function(De){return De===ve})?[2,2]:[1,1]}(Y);w=_u(w=function(ve,De,Ce){return tn.tidy(function(){var Xe=tn.depthwiseConv2d(ve,De.filters,Ce,"same");return Xe=tn.batchNorm(Xe,De.batch_norm_mean,De.batch_norm_variance,De.batch_norm_offset,De.batch_norm_scale,Fm),tn.clipByValue(Xe,0,6)})}(w,_.depthwise_conv,ce),_.pointwise_conv,[1,1]),Y===11&&(k=w)}),k===null)throw new Error("mobileNetV1 - output of conv layer 11 is null");return{out:w,conv11:k}})}function Qd(F,E,k){var w=F.arraySync(),_=Math.min(w[E][0],w[E][2]),L=Math.min(w[E][1],w[E][3]),Y=Math.max(w[E][0],w[E][2]),ce=Math.max(w[E][1],w[E][3]),ve=Math.min(w[k][0],w[k][2]),De=Math.min(w[k][1],w[k][3]),Ce=Math.max(w[k][0],w[k][2]),Xe=Math.max(w[k][1],w[k][3]),nt=(Y-_)*(ce-L),Et=(Ce-ve)*(Xe-De);if(nt<=0||Et<=0)return 0;var At=Math.max(_,ve),rn=Math.max(L,De),un=Math.min(Y,Ce),kn=Math.min(ce,Xe),En=Math.max(un-At,0)*Math.max(kn-rn,0);return En/(nt+Et-En)}function N0(F,E){var k=function(Ce){var Xe=tn.unstack(tn.transpose(Ce,[1,0])),nt=[tn.sub(Xe[2],Xe[0]),tn.sub(Xe[3],Xe[1])];return{sizes:nt,centers:[tn.add(Xe[0],tn.div(nt[0],tn.scalar(2))),tn.add(Xe[1],tn.div(nt[1],tn.scalar(2)))]}}(F),w=k.sizes,_=k.centers,L=tn.unstack(tn.transpose(E,[1,0])),Y=tn.div(tn.mul(tn.exp(tn.div(L[2],tn.scalar(5))),w[0]),tn.scalar(2)),ce=tn.add(tn.mul(tn.div(L[0],tn.scalar(10)),w[0]),_[0]),ve=tn.div(tn.mul(tn.exp(tn.div(L[3],tn.scalar(5))),w[1]),tn.scalar(2)),De=tn.add(tn.mul(tn.div(L[1],tn.scalar(10)),w[1]),_[1]);return tn.transpose(tn.stack([tn.sub(ce,Y),tn.sub(De,ve),tn.add(ce,Y),tn.add(De,ve)]),[1,0])}function Zd(F,E){return tn.tidy(function(){var k=F.shape[0];return{boxPredictionEncoding:tn.reshape(aa(F,E.box_encoding_predictor),[k,-1,1,4]),classPrediction:tn.reshape(aa(F,E.class_predictor),[k,-1,3])}})}var Tc=function(){function F(E){var k=E===void 0?{}:E,w=k.minConfidence,_=k.maxResults;if(this._name="SsdMobilenetv1Options",this._minConfidence=w||.5,this._maxResults=_||100,typeof this._minConfidence!="number"||this._minConfidence<=0||this._minConfidence>=1)throw new Error(this._name+" - expected minConfidence to be a number between 0 and 1");if(typeof this._maxResults!="number")throw new Error(this._name+" - expected maxResults to be a number")}return Object.defineProperty(F.prototype,"minConfidence",{get:function(){return this._minConfidence},enumerable:!0,configurable:!0}),Object.defineProperty(F.prototype,"maxResults",{get:function(){return this._maxResults},enumerable:!0,configurable:!0}),F}(),ep=function(F){function E(){return F.call(this,"SsdMobilenetv1")||this}return Object(Un.c)(E,F),E.prototype.forwardInput=function(k){var w=this.params;if(!w)throw new Error("SsdMobilenetv1 - load model before inference");return tn.tidy(function(){var _=k.toBatchTensor(512,!1).toFloat(),L=Hh(tn.sub(tn.mul(_,tn.scalar(.007843137718737125)),tn.scalar(1)),w.mobilenetv1),Y=function(ce,ve,De){return tn.tidy(function(){var Ce=_u(_u(ce,De.conv_0,[1,1]),De.conv_1,[2,2]),Xe=_u(_u(Ce,De.conv_2,[1,1]),De.conv_3,[2,2]),nt=_u(_u(Xe,De.conv_4,[1,1]),De.conv_5,[2,2]),Et=_u(_u(nt,De.conv_6,[1,1]),De.conv_7,[2,2]),At=Zd(ve,De.box_predictor_0),rn=Zd(ce,De.box_predictor_1),un=Zd(Ce,De.box_predictor_2),kn=Zd(Xe,De.box_predictor_3),En=Zd(nt,De.box_predictor_4),_n=Zd(Et,De.box_predictor_5);return{boxPredictions:tn.concat([At.boxPredictionEncoding,rn.boxPredictionEncoding,un.boxPredictionEncoding,kn.boxPredictionEncoding,En.boxPredictionEncoding,_n.boxPredictionEncoding],1),classPredictions:tn.concat([At.classPrediction,rn.classPrediction,un.classPrediction,kn.classPrediction,En.classPrediction,_n.classPrediction],1)}})}(L.out,L.conv11,w.prediction_layer);return function(ce,ve,De){return tn.tidy(function(){var Ce=ce.shape[0],Xe=N0(tn.reshape(tn.tile(De.extra_dim,[Ce,1,1]),[-1,4]),tn.reshape(ce,[-1,4]));Xe=tn.reshape(Xe,[Ce,Xe.shape[0]/Ce,4]);var nt=tn.sigmoid(tn.slice(ve,[0,0,1],[-1,-1,-1])),Et=tn.slice(nt,[0,0,0],[-1,-1,1]);return Et=tn.reshape(Et,[Ce,Et.shape[1]]),{boxes:tn.unstack(Xe),scores:tn.unstack(Et)}})}(Y.boxPredictions,Y.classPredictions,w.output_layer)})},E.prototype.forward=function(k){return Object(Un.b)(this,void 0,void 0,function(){var w;return Object(Un.d)(this,function(_){switch(_.label){case 0:return w=this.forwardInput,[4,ni(k)];case 1:return[2,w.apply(this,[_.sent()])]}})})},E.prototype.locateFaces=function(k,w){return w===void 0&&(w={}),Object(Un.b)(this,void 0,void 0,function(){var _,L,Y,ce,ve,De,Ce,Xe,nt,Et,At,rn,un,kn,En,_n,Pn,dn,cr,yr;return Object(Un.d)(this,function(br){switch(br.label){case 0:return _=new Tc(w),L=_.maxResults,Y=_.minConfidence,[4,ni(k)];case 1:for(ce=br.sent(),ve=this.forwardInput(ce),De=ve.boxes,Ce=ve.scores,Xe=De[0],nt=Ce[0],Et=1;Et<De.length;Et++)De[Et].dispose(),Ce[Et].dispose();return un=(rn=Array).from,[4,nt.data()];case 2:return At=un.apply(rn,[br.sent()]),kn=function(Br,Or,hi,ki,xi){var xo=Br.shape[0],Wo=Math.min(hi,xo),To=function(Mo){return Mo<=ki?1:0},Do=[];return Or.map(function(Mo,ea){return{score:Mo,boxIndex:ea}}).filter(function(Mo){return Mo.score>xi}).sort(function(Mo,ea){return ea.score-Mo.score}).forEach(function(Mo){if(!(Do.length>=Wo)){for(var ea=Mo.score,sa=Do.length-1;sa>=0;--sa){var ka=Qd(Br,Mo.boxIndex,Do[sa]);if(ka!==0&&(Mo.score*=To(ka),Mo.score<=xi))break}ea===Mo.score&&Do.push(Mo.boxIndex)}}),Do}(Xe,At,L,.5,Y),En=ce.getReshapedInputDimensions(0),_n=ce.inputSize,Pn=_n/En.width,dn=_n/En.height,cr=Xe.arraySync(),yr=kn.map(function(Br){var Or=[Math.max(0,cr[Br][0]),Math.min(1,cr[Br][2])].map(function(To){return To*dn}),hi=Or[0],ki=Or[1],xi=[Math.max(0,cr[Br][1]),Math.min(1,cr[Br][3])].map(function(To){return To*Pn}),xo=xi[0],Wo=xi[1];return new Yo(At[Br],new Zc(xo,hi,Wo-xo,ki-hi),{height:ce.getInputHeight(0),width:ce.getInputWidth(0)})}),Xe.dispose(),nt.dispose(),[2,yr]}})})},E.prototype.getDefaultModelName=function(){return"ssd_mobilenetv1_model"},E.prototype.extractParamsFromWeigthMap=function(k){return Nm(k)},E.prototype.extractParams=function(k){return function(w){var _=[],L=Ma(w),Y=L.extractWeights,ce=L.getRemainingWeights,ve=Tm(Y,_),De=ve.extractMobilenetV1Params,Ce=ve.extractPredictionLayerParams,Xe=De(),nt=Ce(),Et={extra_dim:tn.tensor3d(Y(20472),[1,5118,4])};if(_.push({paramPath:"output_layer/extra_dim"}),ce().length!==0)throw new Error("weights remaing after extract: "+ce().length);return{params:{mobilenetv1:Xe,prediction_layer:nt,output_layer:Et},paramMappings:_}}(k)},E}(Di);function Cg(F){var E=new ep;return E.extractWeights(F),E}function Og(F){return Cg(F)}var Im,bv=function(F){function E(){return F!==null&&F.apply(this,arguments)||this}return Object(Un.c)(E,F),E}(ep),xv=.4,uo=[new so(.738768,.874946),new so(2.42204,2.65704),new so(4.30971,7.04493),new so(10.246,4.59428),new so(12.6868,11.8741)],Ag=[new so(1.603231,2.094468),new so(6.041143,7.080126),new so(2.882459,3.518061),new so(4.266906,5.178857),new so(9.041765,10.66308)],Sg=[117.001,114.697,97.404],Bp=function(F){return typeof F=="number"};function _g(F){if(!F)throw new Error("invalid config: "+F);if(typeof F.withSeparableConvs!="boolean")throw new Error("config.withSeparableConvs has to be a boolean, have: "+F.withSeparableConvs);if(!Bp(F.iouThreshold)||F.iouThreshold<0||F.iouThreshold>1)throw new Error("config.iouThreshold has to be a number between [0, 1], have: "+F.iouThreshold);if(!Array.isArray(F.classes)||!F.classes.length||!F.classes.every(function(E){return typeof E=="string"}))throw new Error("config.classes has to be an array class names: string[], have: "+JSON.stringify(F.classes));if(!Array.isArray(F.anchors)||!F.anchors.length||!F.anchors.map(function(E){return E||{}}).every(function(E){return Bp(E.x)&&Bp(E.y)}))throw new Error("config.anchors has to be an array of { x: number, y: number }, have: "+JSON.stringify(F.anchors));if(F.meanRgb&&(!Array.isArray(F.meanRgb)||F.meanRgb.length!==3||!F.meanRgb.every(Bp)))throw new Error("config.meanRgb has to be an array of shape [number, number, number], have: "+JSON.stringify(F.meanRgb))}function tp(F){return tn.tidy(function(){var E=tn.mul(F,tn.scalar(.10000000149011612));return tn.add(tn.relu(tn.sub(F,E)),E)})}function nl(F,E){return tn.tidy(function(){var k=tn.pad(F,[[0,0],[1,1],[1,1],[0,0]]);return k=tn.conv2d(k,E.conv.filters,[1,1],"valid"),k=tn.sub(k,E.bn.sub),k=tn.mul(k,E.bn.truediv),tp(k=tn.add(k,E.conv.bias))})}function rl(F,E){return tn.tidy(function(){var k=tn.pad(F,[[0,0],[1,1],[1,1],[0,0]]);return k=tn.separableConv2d(k,E.depthwise_filter,E.pointwise_filter,[1,1],"valid"),tp(k=tn.add(k,E.bias))})}function Dg(F,E){var k=Za(F,E),w=wa(F,E);return{extractConvParams:k,extractConvWithBatchNormParams:function(_,L,Y){return{conv:k(_,L,3,Y+"/conv"),bn:function(ce,ve){var De=tn.tensor1d(F(ce)),Ce=tn.tensor1d(F(ce));return E.push({paramPath:ve+"/sub"},{paramPath:ve+"/truediv"}),{sub:De,truediv:Ce}}(L,Y+"/bn")}},extractSeparableConvParams:w}}function Tg(F,E){var k=fs(F,E);function w(_){return{filters:k(_+"/filters",4),bias:k(_+"/bias",1)}}return{extractConvParams:w,extractConvWithBatchNormParams:function(_){return{conv:w(_+"/conv"),bn:function(L){return{sub:k(L+"/sub",1),truediv:k(L+"/truediv",1)}}(_+"/bn")}},extractSeparableConvParams:Su(k)}}(function(F){F[F.XS=224]="XS",F[F.SM=320]="SM",F[F.MD=416]="MD",F[F.LG=608]="LG"})(Im||(Im={}));var $h=function(){function F(E){var k=E===void 0?{}:E,w=k.inputSize,_=k.scoreThreshold;if(this._name="TinyYolov2Options",this._inputSize=w||416,this._scoreThreshold=_||.5,typeof this._inputSize!="number"||this._inputSize%32!=0)throw new Error(this._name+" - expected inputSize to be a number divisible by 32");if(typeof this._scoreThreshold!="number"||this._scoreThreshold<=0||this._scoreThreshold>=1)throw new Error(this._name+" - expected scoreThreshold to be a number between 0 and 1")}return Object.defineProperty(F.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(F.prototype,"scoreThreshold",{get:function(){return this._scoreThreshold},enumerable:!0,configurable:!0}),F}(),Uf=function(F){function E(k){var w=F.call(this,"TinyYolov2")||this;return _g(k),w._config=k,w}return Object(Un.c)(E,F),Object.defineProperty(E.prototype,"config",{get:function(){return this._config},enumerable:!0,configurable:!0}),Object.defineProperty(E.prototype,"withClassScores",{get:function(){return this.config.withClassScores||this.config.classes.length>1},enumerable:!0,configurable:!0}),Object.defineProperty(E.prototype,"boxEncodingSize",{get:function(){return 5+(this.withClassScores?this.config.classes.length:0)},enumerable:!0,configurable:!0}),E.prototype.runTinyYolov2=function(k,w){var _=nl(k,w.conv0);return _=nl(_=tn.maxPool(_,[2,2],[2,2],"same"),w.conv1),_=nl(_=tn.maxPool(_,[2,2],[2,2],"same"),w.conv2),_=nl(_=tn.maxPool(_,[2,2],[2,2],"same"),w.conv3),_=nl(_=tn.maxPool(_,[2,2],[2,2],"same"),w.conv4),_=nl(_=tn.maxPool(_,[2,2],[2,2],"same"),w.conv5),aa(_=nl(_=nl(_=tn.maxPool(_,[2,2],[1,1],"same"),w.conv6),w.conv7),w.conv8,"valid",!1)},E.prototype.runMobilenet=function(k,w){var _=this.config.isFirstLayerConv2d?tp(aa(k,w.conv0,"valid",!1)):rl(k,w.conv0);return _=rl(_=tn.maxPool(_,[2,2],[2,2],"same"),w.conv1),_=rl(_=tn.maxPool(_,[2,2],[2,2],"same"),w.conv2),_=rl(_=tn.maxPool(_,[2,2],[2,2],"same"),w.conv3),_=rl(_=tn.maxPool(_,[2,2],[2,2],"same"),w.conv4),_=rl(_=tn.maxPool(_,[2,2],[2,2],"same"),w.conv5),_=tn.maxPool(_,[2,2],[1,1],"same"),_=w.conv6?rl(_,w.conv6):_,aa(_=w.conv7?rl(_,w.conv7):_,w.conv8,"valid",!1)},E.prototype.forwardInput=function(k,w){var _=this,L=this.params;if(!L)throw new Error("TinyYolov2 - load model before inference");return tn.tidy(function(){var Y=k.toBatchTensor(w,!1).toFloat();return Y=(Y=_.config.meanRgb?uc(Y,_.config.meanRgb):Y).div(tn.scalar(256)),_.config.withSeparableConvs?_.runMobilenet(Y,L):_.runTinyYolov2(Y,L)})},E.prototype.forward=function(k,w){return Object(Un.b)(this,void 0,void 0,function(){var _;return Object(Un.d)(this,function(L){switch(L.label){case 0:return _=this.forwardInput,[4,ni(k)];case 1:return[4,_.apply(this,[L.sent(),w])];case 2:return[2,L.sent()]}})})},E.prototype.detect=function(k,w){return w===void 0&&(w={}),Object(Un.b)(this,void 0,void 0,function(){var _,L,Y,ce,ve,De,Ce,Xe,nt,Et,At,rn,un,kn=this;return Object(Un.d)(this,function(En){switch(En.label){case 0:return _=new $h(w),L=_.inputSize,Y=_.scoreThreshold,[4,ni(k)];case 1:return ce=En.sent(),[4,this.forwardInput(ce,L)];case 2:return ve=En.sent(),De=tn.tidy(function(){return tn.unstack(ve)[0].expandDims()}),Ce={width:ce.getInputWidth(0),height:ce.getInputHeight(0)},[4,this.extractBoxes(De,ce.getReshapedInputDimensions(0),Y)];case 3:return Xe=En.sent(),ve.dispose(),De.dispose(),nt=Xe.map(function(_n){return _n.box}),Et=Xe.map(function(_n){return _n.score}),At=Xe.map(function(_n){return _n.classScore}),rn=Xe.map(function(_n){return kn.config.classes[_n.label]}),un=qu(nt.map(function(_n){return _n.rescale(L)}),Et,this.config.iouThreshold,!0),[2,un.map(function(_n){return new ls(Et[_n],At[_n],rn[_n],nt[_n],Ce)})]}})})},E.prototype.getDefaultModelName=function(){return""},E.prototype.extractParamsFromWeigthMap=function(k){return function(w,_){var L,Y=[],ce=Tg(w,Y),ve=ce.extractConvParams,De=ce.extractConvWithBatchNormParams,Ce=ce.extractSeparableConvParams;if(_.withSeparableConvs){var Xe=_.filterSizes&&_.filterSizes.length||9;L={conv0:_.isFirstLayerConv2d?ve("conv0"):Ce("conv0"),conv1:Ce("conv1"),conv2:Ce("conv2"),conv3:Ce("conv3"),conv4:Ce("conv4"),conv5:Ce("conv5"),conv6:Xe>7?Ce("conv6"):void 0,conv7:Xe>8?Ce("conv7"):void 0,conv8:ve("conv8")}}else L={conv0:De("conv0"),conv1:De("conv1"),conv2:De("conv2"),conv3:De("conv3"),conv4:De("conv4"),conv5:De("conv5"),conv6:De("conv6"),conv7:De("conv7"),conv8:ve("conv8")};return Qo(w,Y),{params:L,paramMappings:Y}}(k,this.config)},E.prototype.extractParams=function(k){var w=this.config.filterSizes||E.DEFAULT_FILTER_SIZES,_=w?w.length:void 0;if(_!==7&&_!==8&&_!==9)throw new Error("TinyYolov2 - expected 7 | 8 | 9 convolutional filters, but found "+_+" filterSizes in config");return function(L,Y,ce,ve){var De,Ce=Ma(L),Xe=Ce.extractWeights,nt=Ce.getRemainingWeights,Et=[],At=Dg(Xe,Et),rn=At.extractConvParams,un=At.extractConvWithBatchNormParams,kn=At.extractSeparableConvParams;if(Y.withSeparableConvs){var En=ve[0],_n=ve[1],Pn=ve[2],dn=ve[3],cr=ve[4],yr=ve[5],br=ve[6],Br=ve[7],Or=ve[8];De={conv0:Y.isFirstLayerConv2d?rn(En,_n,3,"conv0"):kn(En,_n,"conv0"),conv1:kn(_n,Pn,"conv1"),conv2:kn(Pn,dn,"conv2"),conv3:kn(dn,cr,"conv3"),conv4:kn(cr,yr,"conv4"),conv5:kn(yr,br,"conv5"),conv6:Br?kn(br,Br,"conv6"):void 0,conv7:Or?kn(Br,Or,"conv7"):void 0,conv8:rn(Or||Br||br,5*ce,1,"conv8")}}else En=ve[0],_n=ve[1],Pn=ve[2],dn=ve[3],cr=ve[4],yr=ve[5],br=ve[6],Br=ve[7],Or=ve[8],De={conv0:un(En,_n,"conv0"),conv1:un(_n,Pn,"conv1"),conv2:un(Pn,dn,"conv2"),conv3:un(dn,cr,"conv3"),conv4:un(cr,yr,"conv4"),conv5:un(yr,br,"conv5"),conv6:un(br,Br,"conv6"),conv7:un(Br,Or,"conv7"),conv8:rn(Or,5*ce,1,"conv8")};if(nt().length!==0)throw new Error("weights remaing after extract: "+nt().length);return{params:De,paramMappings:Et}}(k,this.config,this.boxEncodingSize,w)},E.prototype.extractBoxes=function(k,w,_){return Object(Un.b)(this,void 0,void 0,function(){var L,Y,ce,ve,De,Ce,Xe,nt,Et,At,rn,un,kn,En,_n,Pn,dn,cr,yr,br,Br,Or,hi,ki,xi,xo,Wo,To,Do,Mo=this;return Object(Un.d)(this,function(ea){switch(ea.label){case 0:return L=w.width,Y=w.height,ce=Math.max(L,Y),ve=ce/L,De=ce/Y,Ce=k.shape[1],Xe=this.config.anchors.length,nt=tn.tidy(function(){var sa=k.reshape([Ce,Ce,Xe,Mo.boxEncodingSize]);return[sa.slice([0,0,0,0],[Ce,Ce,Xe,4]),sa.slice([0,0,0,4],[Ce,Ce,Xe,1]),Mo.withClassScores?tn.softmax(sa.slice([0,0,0,5],[Ce,Ce,Xe,Mo.config.classes.length]),3):tn.scalar(0)]}),Et=nt[0],At=nt[1],rn=nt[2],un=[],[4,At.array()];case 1:return kn=ea.sent(),[4,Et.array()];case 2:En=ea.sent(),_n=0,ea.label=3;case 3:if(!(_n<Ce))return[3,12];Pn=0,ea.label=4;case 4:if(!(Pn<Ce))return[3,11];dn=0,ea.label=5;case 5:return dn<Xe?(cr=Qc(kn[_n][Pn][dn][0]),!_||cr>_?(yr=(Pn+Qc(En[_n][Pn][dn][0]))/Ce*ve,br=(_n+Qc(En[_n][Pn][dn][1]))/Ce*De,Br=Math.exp(En[_n][Pn][dn][2])*this.config.anchors[dn].x/Ce*ve,Or=Math.exp(En[_n][Pn][dn][3])*this.config.anchors[dn].y/Ce*De,hi=yr-Br/2,ki=br-Or/2,xi={row:_n,col:Pn,anchor:dn},this.withClassScores?[4,this.extractPredictedClass(rn,xi)]:[3,7]):[3,9]):[3,10];case 6:return Do=ea.sent(),[3,8];case 7:Do={classScore:1,label:0},ea.label=8;case 8:Wo=(xo=Do).classScore,To=xo.label,un.push(Object(Un.a)({box:new _a(hi,ki,hi+Br,ki+Or),score:cr,classScore:cr*Wo,label:To},xi)),ea.label=9;case 9:return dn++,[3,5];case 10:return Pn++,[3,4];case 11:return _n++,[3,3];case 12:return Et.dispose(),At.dispose(),rn.dispose(),[2,un]}})})},E.prototype.extractPredictedClass=function(k,w){return Object(Un.b)(this,void 0,void 0,function(){var _,L,Y,ce;return Object(Un.d)(this,function(ve){switch(ve.label){case 0:return _=w.row,L=w.col,Y=w.anchor,[4,k.array()];case 1:return ce=ve.sent(),[2,Array(this.config.classes.length).fill(0).map(function(De,Ce){return ce[_][L][Y][Ce]}).map(function(De,Ce){return{classScore:De,label:Ce}}).reduce(function(De,Ce){return De.classScore>Ce.classScore?De:Ce})]}})})},E.DEFAULT_FILTER_SIZES=[3,16,32,64,128,256,512,1024,1024],E}(Di),Gh=function(F){function E(k){k===void 0&&(k=!0);var w=Object.assign({},{withSeparableConvs:k,iouThreshold:xv,classes:["face"]},k?{anchors:Ag,meanRgb:Sg}:{anchors:uo,withClassScores:!0});return F.call(this,w)||this}return Object(Un.c)(E,F),Object.defineProperty(E.prototype,"withSeparableConvs",{get:function(){return this.config.withSeparableConvs},enumerable:!0,configurable:!0}),Object.defineProperty(E.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),E.prototype.locateFaces=function(k,w){return Object(Un.b)(this,void 0,void 0,function(){return Object(Un.d)(this,function(_){switch(_.label){case 0:return[4,this.detect(k,w)];case 1:return[2,_.sent().map(function(L){return new Yo(L.score,L.relativeBox,{width:L.imageWidth,height:L.imageHeight})})]}})})},E.prototype.getDefaultModelName=function(){return this.withSeparableConvs?"tiny_yolov2_separable_conv_model":"tiny_yolov2_model"},E.prototype.extractParamsFromWeigthMap=function(k){return F.prototype.extractParamsFromWeigthMap.call(this,k)},E}(Uf);function wv(F,E){E===void 0&&(E=!0);var k=new Gh(E);return k.extractWeights(F),k}var Pp=function(F){function E(){var k=F!==null&&F.apply(this,arguments)||this;return k._name="TinyFaceDetectorOptions",k}return Object(Un.c)(E,F),E}($h),il=function(){function F(){}return F.prototype.then=function(E){return Object(Un.b)(this,void 0,void 0,function(){var k;return Object(Un.d)(this,function(w){switch(w.label){case 0:return k=E,[4,this.run()];case 1:return[2,k.apply(void 0,[w.sent()])]}})})},F.prototype.run=function(){return Object(Un.b)(this,void 0,void 0,function(){return Object(Un.d)(this,function(E){throw new Error("ComposableTask - run is not implemented")})})},F}();function Du(F,E,k,w,_){return _===void 0&&(_=function(L){return L.alignedRect}),Object(Un.b)(this,void 0,void 0,function(){var L,Y,ce,ve,De;return Object(Un.d)(this,function(Ce){switch(Ce.label){case 0:return L=F.map(function(Xe){return Sc(Xe)?_(Xe):Xe.detection}),(ce=w)?[3,5]:E instanceof tn.Tensor?[4,Qi(E,L)]:[3,2];case 1:return ve=Ce.sent(),[3,4];case 2:return[4,to(E,L)];case 3:ve=Ce.sent(),Ce.label=4;case 4:ce=ve,Ce.label=5;case 5:return[4,k(Y=ce)];case 6:return De=Ce.sent(),Y.forEach(function(Xe){return Xe instanceof tn.Tensor&&Xe.dispose()}),[2,De]}})})}function zl(F,E,k,w,_){return Object(Un.b)(this,void 0,void 0,function(){var L=this;return Object(Un.d)(this,function(Y){return[2,Du([F],E,function(ce){return Object(Un.b)(L,void 0,void 0,function(){return Object(Un.d)(this,function(ve){return[2,k(ce[0])]})})},w,_)]})})}var Ul=2,Wl=12;function Ng(F){var E=Ma(F),k=E.extractWeights,w=E.getRemainingWeights,_=[],L=function(nt,Et){var At=Za(nt,Et),rn=da(nt,Et);function un(En,_n){var Pn=tn.tensor1d(nt(En));return Et.push({paramPath:_n}),Pn}function kn(En,_n,Pn){return Pn===void 0&&(Pn=!1),{conv1:At(En[0],En[1],3,_n+"/conv1"),prelu1_alpha:un(En[1],_n+"/prelu1_alpha"),conv2:At(En[1],En[2],3,_n+"/conv2"),prelu2_alpha:un(En[2],_n+"/prelu2_alpha"),conv3:At(En[2],En[3],Pn?2:3,_n+"/conv3"),prelu3_alpha:un(En[3],_n+"/prelu3_alpha")}}return{extractPNetParams:function(){var En=kn([3,10,16,32],"pnet"),_n=At(32,2,1,"pnet/conv4_1"),Pn=At(32,4,1,"pnet/conv4_2");return Object(Un.a)(Object(Un.a)({},En),{conv4_1:_n,conv4_2:Pn})},extractRNetParams:function(){var En=kn([3,28,48,64],"rnet",!0),_n=rn(576,128,"rnet/fc1"),Pn=un(128,"rnet/prelu4_alpha"),dn=rn(128,2,"rnet/fc2_1"),cr=rn(128,4,"rnet/fc2_2");return Object(Un.a)(Object(Un.a)({},En),{fc1:_n,prelu4_alpha:Pn,fc2_1:dn,fc2_2:cr})},extractONetParams:function(){var En=kn([3,32,64,64],"onet"),_n=At(64,128,2,"onet/conv4"),Pn=un(128,"onet/prelu4_alpha"),dn=rn(1152,256,"onet/fc1"),cr=un(256,"onet/prelu5_alpha"),yr=rn(256,2,"onet/fc2_1"),br=rn(256,4,"onet/fc2_2"),Br=rn(256,10,"onet/fc2_3");return Object(Un.a)(Object(Un.a)({},En),{conv4:_n,prelu4_alpha:Pn,fc1:dn,prelu5_alpha:cr,fc2_1:yr,fc2_2:br,fc2_3:Br})}}}(k,_),Y=L.extractPNetParams,ce=L.extractRNetParams,ve=L.extractONetParams,De=Y(),Ce=ce(),Xe=ve();if(w().length!==0)throw new Error("weights remaing after extract: "+w().length);return{params:{pnet:De,rnet:Ce,onet:Xe},paramMappings:_}}function Lp(F){var E=[],k=function(De,Ce){var Xe=fs(De,Ce);function nt(un){return{filters:Xe(un+"/weights",4,un+"/filters"),bias:Xe(un+"/bias",1)}}function Et(un){return{weights:Xe(un+"/weights",2),bias:Xe(un+"/bias",1)}}function At(un){return Xe(un,1)}function rn(un){return{conv1:nt(un+"/conv1"),prelu1_alpha:At(un+"/prelu1_alpha"),conv2:nt(un+"/conv2"),prelu2_alpha:At(un+"/prelu2_alpha"),conv3:nt(un+"/conv3"),prelu3_alpha:At(un+"/prelu3_alpha")}}return{extractPNetParams:function(){var un=rn("pnet"),kn=nt("pnet/conv4_1"),En=nt("pnet/conv4_2");return Object(Un.a)(Object(Un.a)({},un),{conv4_1:kn,conv4_2:En})},extractRNetParams:function(){var un=rn("rnet"),kn=Et("rnet/fc1"),En=At("rnet/prelu4_alpha"),_n=Et("rnet/fc2_1"),Pn=Et("rnet/fc2_2");return Object(Un.a)(Object(Un.a)({},un),{fc1:kn,prelu4_alpha:En,fc2_1:_n,fc2_2:Pn})},extractONetParams:function(){var un=rn("onet"),kn=nt("onet/conv4"),En=At("onet/prelu4_alpha"),_n=Et("onet/fc1"),Pn=At("onet/prelu5_alpha"),dn=Et("onet/fc2_1"),cr=Et("onet/fc2_2"),yr=Et("onet/fc2_3");return Object(Un.a)(Object(Un.a)({},un),{conv4:kn,prelu4_alpha:En,fc1:_n,prelu5_alpha:Pn,fc2_1:dn,fc2_2:cr,fc2_3:yr})}}}(F,E),w=k.extractPNetParams,_=k.extractRNetParams,L=k.extractONetParams,Y=w(),ce=_(),ve=L();return Qo(F,E),{params:{pnet:Y,rnet:ce,onet:ve},paramMappings:E}}function Tu(F,E){var k=E[0],w=E[1];return{height:Math.floor(k*F),width:Math.floor(w*F)}}var Hu=function(F){function E(k,w,_,L){return F.call(this,{left:k,top:w,right:_,bottom:L},!0)||this}return Object(Un.c)(E,F),E}(cs);function Fg(F){return tn.tidy(function(){return tn.mul(tn.sub(F,tn.scalar(127.5)),tn.scalar(.0078125))})}function np(F,E){return tn.tidy(function(){return tn.add(tn.relu(F),tn.mul(E,tn.neg(tn.relu(tn.neg(F)))))})}function Rm(F,E,k){return k===void 0&&(k=!1),tn.tidy(function(){var w=aa(F,E.conv1,"valid");return w=np(w,E.prelu1_alpha),w=np(w=aa(w=tn.maxPool(w,k?[2,2]:[3,3],[2,2],"same"),E.conv2,"valid"),E.prelu2_alpha),w=np(w=aa(w=k?w:tn.maxPool(w,[3,3],[2,2],"valid"),E.conv3,"valid"),E.prelu3_alpha)})}function kv(F,E,k,w,_){_.stage1=[];var L=E.map(function(Ce){return tn.tidy(function(){var Xe={scale:Ce},nt=function(kn,En){return tn.tidy(function(){var _n=Tu(En,kn.shape.slice(1)),Pn=_n.height,dn=_n.width,cr=Fg(tn.image.resizeBilinear(kn,[Pn,dn]));return tn.transpose(cr,[0,2,1,3])})}(F,Ce),Et=Date.now(),At=function(kn,En){return tn.tidy(function(){var _n=Rm(kn,En,!0),Pn=aa(_n,En.conv4_1,"valid"),dn=tn.expandDims(tn.max(Pn,3),3);return{prob:tn.softmax(tn.sub(Pn,dn),3),regions:aa(_n,En.conv4_2,"valid")}})}(nt,w),rn=At.prob,un=At.regions;return Xe.pnet=Date.now()-Et,{scoresTensor:tn.unstack(tn.unstack(rn,3)[1])[0],regionsTensor:tn.unstack(un)[0],scale:Ce,statsForScale:Xe}})}).map(function(Ce){var Xe=Ce.scoresTensor,nt=Ce.regionsTensor,Et=Ce.scale,At=Ce.statsForScale,rn=function(En,_n,Pn,dn){for(var cr=[],yr=En.arraySync(),br=0;br<En.shape[0];br++)for(var Br=0;Br<En.shape[1];Br++)yr[br][Br]>=dn&&cr.push(new so(Br,br));return cr.map(function(Or){var hi=new _a(Math.round((Or.y*Ul+1)/Pn),Math.round((Or.x*Ul+1)/Pn),Math.round((Or.y*Ul+Wl)/Pn),Math.round((Or.x*Ul+Wl)/Pn)),ki=yr[Or.y][Or.x],xi=_n.arraySync();return{cell:hi,score:ki,region:new Hu(xi[Or.y][Or.x][0],xi[Or.y][Or.x][1],xi[Or.y][Or.x][2],xi[Or.y][Or.x][3])}})}(Xe,nt,Et,k);if(Xe.dispose(),nt.dispose(),!rn.length)return _.stage1.push(At),[];var un=Date.now(),kn=qu(rn.map(function(En){return En.cell}),rn.map(function(En){return En.score}),.5);return At.nms=Date.now()-un,At.numBoxes=kn.length,_.stage1.push(At),kn.map(function(En){return rn[En]})}).reduce(function(Ce,Xe){return Ce.concat(Xe)},[]),Y=[],ce=[];if(L.length>0){var ve=Date.now(),De=qu(L.map(function(Ce){return Ce.cell}),L.map(function(Ce){return Ce.score}),.7);_.stage1_nms=Date.now()-ve,ce=De.map(function(Ce){return L[Ce].score}),Y=De.map(function(Ce){return L[Ce]}).map(function(Ce){var Xe=Ce.cell,nt=Ce.region;return new _a(Xe.left+nt.left*Xe.width,Xe.top+nt.top*Xe.height,Xe.right+nt.right*Xe.width,Xe.bottom+nt.bottom*Xe.height).toSquare().round()})}return{boxes:Y,scores:ce}}function F0(F,E,k){var w=k.width,_=k.height;return Object(Un.b)(this,void 0,void 0,function(){var L,Y,ce,ve=this;return Object(Un.d)(this,function(De){switch(De.label){case 0:return L=bn(F),[4,Promise.all(E.map(function(Ce){return Object(Un.b)(ve,void 0,void 0,function(){var Xe,nt,Et,At,rn,un,kn,En;return Object(Un.d)(this,function(_n){return Xe=Ce.padAtBorders(F.height,F.width),nt=Xe.y,Et=Xe.ey,At=Xe.x,rn=Xe.ex,un=At-1,kn=nt-1,En=L.getImageData(un,kn,rn-un,Et-kn),[2,Wt.isNodejs()?$r(En):createImageBitmap(En)]})})}))];case 1:return Y=De.sent(),ce=[],Y.forEach(function(Ce){var Xe=bn(xr({width:w,height:_}));Xe.drawImage(Ce,0,0,w,_);for(var nt=Xe.getImageData(0,0,w,_).data,Et=[],At=0;At<nt.length;At+=4)Et.push(nt[At+2]),Et.push(nt[At+1]),Et.push(nt[At]);ce.push(Et)}),[2,ce.map(function(Ce){return tn.tidy(function(){return Fg(tn.transpose(tn.tensor4d(Ce,[1,w,_,3]),[0,2,1,3]).toFloat())})})]}})})}function Vl(F,E,k,w,_){return Object(Un.b)(this,void 0,void 0,function(){var L,Y,ce,ve,De,Ce,Xe,nt,Et,At,rn,un,kn,En;return Object(Un.d)(this,function(_n){switch(_n.label){case 0:return L=Date.now(),[4,F0(F,E,{width:24,height:24})];case 1:return Y=_n.sent(),_.stage2_extractImagePatches=Date.now()-L,L=Date.now(),ce=Y.map(function(Pn){var dn=function(cr,yr){return tn.tidy(function(){var br=Rm(cr,yr),Br=np(Zo(tn.reshape(br,[br.shape[0],yr.fc1.weights.shape[0]]),yr.fc1),yr.prelu4_alpha),Or=Zo(Br,yr.fc2_1),hi=tn.expandDims(tn.max(Or,1),1),ki=tn.softmax(tn.sub(Or,hi),1),xi=Zo(Br,yr.fc2_2);return{scores:tn.unstack(ki,1)[1],regions:xi}})}(Pn,w);return Pn.dispose(),dn}),_.stage2_rnet=Date.now()-L,ve=ce.length>1?tn.concat(ce.map(function(Pn){return Pn.scores})):ce[0].scores,Xe=(Ce=Array).from,[4,ve.data()];case 2:return De=Xe.apply(Ce,[_n.sent()]),ve.dispose(),nt=De.map(function(Pn,dn){return{score:Pn,idx:dn}}).filter(function(Pn){return Pn.score>k}).map(function(Pn){return Pn.idx}),Et=nt.map(function(Pn){return E[Pn]}),At=nt.map(function(Pn){return De[Pn]}),rn=[],un=[],Et.length>0&&(L=Date.now(),kn=qu(Et,At,.7),_.stage2_nms=Date.now()-L,En=kn.map(function(Pn){var dn=ce[nt[Pn]].regions.arraySync();return new Hu(dn[0][0],dn[0][1],dn[0][2],dn[0][3])}),un=kn.map(function(Pn){return At[Pn]}),rn=kn.map(function(Pn,dn){return Et[Pn].calibrate(En[dn])})),ce.forEach(function(Pn){Pn.regions.dispose(),Pn.scores.dispose()}),[2,{boxes:rn,scores:un}]}})})}function Kh(F,E,k,w,_){return Object(Un.b)(this,void 0,void 0,function(){var L,Y,ce,ve,De,Ce,Xe,nt,Et,At,rn,un,kn,En,_n;return Object(Un.d)(this,function(Pn){switch(Pn.label){case 0:return L=Date.now(),[4,F0(F,E,{width:48,height:48})];case 1:return Y=Pn.sent(),_.stage3_extractImagePatches=Date.now()-L,L=Date.now(),ce=Y.map(function(dn){var cr=function(yr,br){return tn.tidy(function(){var Br=Rm(yr,br);Br=np(Br=aa(Br=tn.maxPool(Br,[2,2],[2,2],"same"),br.conv4,"valid"),br.prelu4_alpha);var Or=np(Zo(tn.reshape(Br,[Br.shape[0],br.fc1.weights.shape[0]]),br.fc1),br.prelu5_alpha),hi=Zo(Or,br.fc2_1),ki=tn.expandDims(tn.max(hi,1),1),xi=tn.softmax(tn.sub(hi,ki),1),xo=Zo(Or,br.fc2_2),Wo=Zo(Or,br.fc2_3);return{scores:tn.unstack(xi,1)[1],regions:xo,points:Wo}})}(dn,w);return dn.dispose(),cr}),_.stage3_onet=Date.now()-L,ve=ce.length>1?tn.concat(ce.map(function(dn){return dn.scores})):ce[0].scores,Xe=(Ce=Array).from,[4,ve.data()];case 2:return De=Xe.apply(Ce,[Pn.sent()]),ve.dispose(),nt=De.map(function(dn,cr){return{score:dn,idx:cr}}).filter(function(dn){return dn.score>k}).map(function(dn){return dn.idx}),Et=nt.map(function(dn){var cr=ce[dn].regions.arraySync();return new Hu(cr[0][0],cr[0][1],cr[0][2],cr[0][3])}),At=nt.map(function(dn,cr){return E[dn].calibrate(Et[cr])}),rn=nt.map(function(dn){return De[dn]}),un=[],kn=[],En=[],At.length>0&&(L=Date.now(),_n=qu(At,rn,.7,!1),_.stage3_nms=Date.now()-L,un=_n.map(function(dn){return At[dn]}),kn=_n.map(function(dn){return rn[dn]}),En=_n.map(function(dn,cr){return Array(5).fill(0).map(function(yr,br){var Br=ce[dn].points.arraySync();return new so(Br[0][br]*(un[cr].width+1)+un[cr].left,Br[0][br+5]*(un[cr].height+1)+un[cr].top)})})),ce.forEach(function(dn){dn.regions.dispose(),dn.scores.dispose(),dn.points.dispose()}),[2,{boxes:un,scores:kn,points:En}]}})})}var Wf=function(F){function E(){return F.call(this,"Mtcnn")||this}return Object(Un.c)(E,F),E.prototype.load=function(k){return Object(Un.b)(this,void 0,void 0,function(){return Object(Un.d)(this,function(w){return console.warn("mtcnn is deprecated and will be removed soon"),[2,F.prototype.load.call(this,k)]})})},E.prototype.loadFromDisk=function(k){return Object(Un.b)(this,void 0,void 0,function(){return Object(Un.d)(this,function(w){return console.warn("mtcnn is deprecated and will be removed soon"),[2,F.prototype.loadFromDisk.call(this,k)]})})},E.prototype.forwardInput=function(k,w){return w===void 0&&(w={}),Object(Un.b)(this,void 0,void 0,function(){var _,L,Y,ce,ve,De,Ce,Xe,nt,Et,At,rn,un,kn,En,_n,Pn,dn,cr,yr,br;return Object(Un.d)(this,function(Br){switch(Br.label){case 0:if(!(_=this.params))throw new Error("Mtcnn - load model before inference");if(!(L=k.canvases[0]))throw new Error("Mtcnn - inputCanvas is not defined, note that passing tensors into Mtcnn.forwardInput is not supported yet.");return Y={},ce=Date.now(),ve=tn.tidy(function(){return function(Or){return tn.tidy(function(){return tn.stack(tn.unstack(Or,3).reverse(),3)})}(tn.expandDims(tn.browser.fromPixels(L)).toFloat())}),De=function(Or){return ve.dispose(),Y.total=Date.now()-ce,Or},Ce=ve.shape.slice(1),Xe=Ce[0],nt=Ce[1],Et=new Dc(w),At=Et.minFaceSize,rn=Et.scaleFactor,un=Et.maxNumScales,kn=Et.scoreThresholds,En=Et.scaleSteps,_n=(En||function(Or,hi,ki){for(var xi=ki[0],xo=ki[1],Wo=Wl/Or,To=[],Do=Math.min(xi,xo)*Wo,Mo=0;Do>=12;)To.push(Wo*Math.pow(hi,Mo)),Do*=hi,Mo+=1;return To}(At,rn,[Xe,nt])).filter(function(Or){var hi=Tu(Or,[Xe,nt]);return Math.min(hi.width,hi.height)>Wl}).slice(0,un),Y.scales=_n,Y.pyramid=_n.map(function(Or){return Tu(Or,[Xe,nt])}),Pn=Date.now(),[4,kv(ve,_n,kn[0],_.pnet,Y)];case 1:return dn=Br.sent(),Y.total_stage1=Date.now()-Pn,dn.boxes.length?(Y.stage2_numInputBoxes=dn.boxes.length,Pn=Date.now(),[4,Vl(L,dn.boxes,kn[1],_.rnet,Y)]):[2,De({results:[],stats:Y})];case 2:return cr=Br.sent(),Y.total_stage2=Date.now()-Pn,cr.boxes.length?(Y.stage3_numInputBoxes=cr.boxes.length,Pn=Date.now(),[4,Kh(L,cr.boxes,kn[2],_.onet,Y)]):[2,De({results:[],stats:Y})];case 3:return yr=Br.sent(),Y.total_stage3=Date.now()-Pn,br=yr.boxes.map(function(Or,hi){return Uo(Bf({},new Yo(yr.scores[hi],new Zc(Or.left/nt,Or.top/Xe,Or.width/nt,Or.height/Xe),{height:Xe,width:nt})),new Ou(yr.points[hi].map(function(ki){return ki.sub(new so(Or.left,Or.top)).div(new so(Or.width,Or.height))}),{width:Or.width,height:Or.height}))}),[2,De({results:br,stats:Y})]}})})},E.prototype.forward=function(k,w){return w===void 0&&(w={}),Object(Un.b)(this,void 0,void 0,function(){var _;return Object(Un.d)(this,function(L){switch(L.label){case 0:return _=this.forwardInput,[4,ni(k)];case 1:return[4,_.apply(this,[L.sent(),w])];case 2:return[2,L.sent().results]}})})},E.prototype.forwardWithStats=function(k,w){return w===void 0&&(w={}),Object(Un.b)(this,void 0,void 0,function(){var _;return Object(Un.d)(this,function(L){switch(L.label){case 0:return _=this.forwardInput,[4,ni(k)];case 1:return[2,_.apply(this,[L.sent(),w])]}})})},E.prototype.getDefaultModelName=function(){return"mtcnn_model"},E.prototype.extractParamsFromWeigthMap=function(k){return Lp(k)},E.prototype.extractParams=function(k){return Ng(k)},E}(Di),Vf=.4,Ig=[new so(1.603231,2.094468),new so(6.041143,7.080126),new so(2.882459,3.518061),new so(4.266906,5.178857),new so(9.041765,10.66308)],Mm=[117.001,114.697,97.404],qf=function(F){function E(){var k={withSeparableConvs:!0,iouThreshold:Vf,classes:["face"],anchors:Ig,meanRgb:Mm,isFirstLayerConv2d:!0,filterSizes:[3,16,32,64,128,256,512]};return F.call(this,k)||this}return Object(Un.c)(E,F),Object.defineProperty(E.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),E.prototype.locateFaces=function(k,w){return Object(Un.b)(this,void 0,void 0,function(){return Object(Un.d)(this,function(_){switch(_.label){case 0:return[4,this.detect(k,w)];case 1:return[2,_.sent().map(function(L){return new Yo(L.score,L.relativeBox,{width:L.imageWidth,height:L.imageHeight})})]}})})},E.prototype.getDefaultModelName=function(){return"tiny_face_detector_model"},E.prototype.extractParamsFromWeigthMap=function(k){return F.prototype.extractParamsFromWeigthMap.call(this,k)},E}(Uf),ro={ssdMobilenetv1:new ep,tinyFaceDetector:new qf,tinyYolov2:new Gh,mtcnn:new Wf,faceLandmark68Net:new Om,faceLandmark68TinyNet:new Am,faceRecognitionNet:new Jd,faceExpressionNet:new oo,ageGenderNet:new yg},ql=function(F,E){return ro.ssdMobilenetv1.locateFaces(F,E)},Xh=function(F,E){return ro.tinyFaceDetector.locateFaces(F,E)},I0=function(F,E){return ro.tinyYolov2.locateFaces(F,E)},R0=function(F,E){return ro.mtcnn.forward(F,E)},zp=function(F){return ro.faceLandmark68Net.detectLandmarks(F)},Hl=function(F){return ro.faceLandmark68TinyNet.detectLandmarks(F)},ol=function(F){return ro.faceRecognitionNet.computeFaceDescriptor(F)},rp=function(F){return ro.faceExpressionNet.predictExpressions(F)},Yh=function(F){return ro.ageGenderNet.predictAgeAndGender(F)},Hf=function(F){return ro.ssdMobilenetv1.load(F)},$l=function(F){return ro.tinyFaceDetector.load(F)},Gl=function(F){return ro.mtcnn.load(F)},Nu=function(F){return ro.tinyYolov2.load(F)},Jh=function(F){return ro.faceLandmark68Net.load(F)},$f=function(F){return ro.faceLandmark68TinyNet.load(F)},al=function(F){return ro.faceRecognitionNet.load(F)},Nc=function(F){return ro.faceExpressionNet.load(F)},Gf=function(F){return ro.ageGenderNet.load(F)},Up=Hf,Kf=ql,Fc=zp,ts=function(F){function E(k,w,_){var L=F.call(this)||this;return L.parentTask=k,L.input=w,L.extractedFaces=_,L}return Object(Un.c)(E,F),E}(il),fc=function(F){function E(){return F!==null&&F.apply(this,arguments)||this}return Object(Un.c)(E,F),E.prototype.run=function(){return Object(Un.b)(this,void 0,void 0,function(){var k,w,_=this;return Object(Un.d)(this,function(L){switch(L.label){case 0:return[4,this.parentTask];case 1:return[4,Du(k=L.sent(),this.input,function(Y){return Object(Un.b)(_,void 0,void 0,function(){return Object(Un.d)(this,function(ce){switch(ce.label){case 0:return[4,Promise.all(Y.map(function(ve){return ro.faceExpressionNet.predictExpressions(ve)}))];case 1:return[2,ce.sent()]}})})},this.extractedFaces)];case 2:return w=L.sent(),[2,k.map(function(Y,ce){return Ga(Y,w[ce])})]}})})},E.prototype.withAgeAndGender=function(){return new jm(this,this.input)},E}(ts),Fu=function(F){function E(){return F!==null&&F.apply(this,arguments)||this}return Object(Un.c)(E,F),E.prototype.run=function(){return Object(Un.b)(this,void 0,void 0,function(){var k,w;return Object(Un.d)(this,function(_){switch(_.label){case 0:return[4,this.parentTask];case 1:return(k=_.sent())?[4,zl(k,this.input,function(L){return ro.faceExpressionNet.predictExpressions(L)},this.extractedFaces)]:[2];case 2:return w=_.sent(),[2,Ga(k,w)]}})})},E.prototype.withAgeAndGender=function(){return new Bm(this,this.input)},E}(ts),fu=function(F){function E(){return F!==null&&F.apply(this,arguments)||this}return Object(Un.c)(E,F),E.prototype.withAgeAndGender=function(){return new ip(this,this.input)},E.prototype.withFaceDescriptors=function(){return new hc(this,this.input)},E}(fc),Qh=function(F){function E(){return F!==null&&F.apply(this,arguments)||this}return Object(Un.c)(E,F),E.prototype.withAgeAndGender=function(){return new Ro(this,this.input)},E.prototype.withFaceDescriptor=function(){return new Xf(this,this.input)},E}(Fu),Wp=function(F){function E(k,w,_){var L=F.call(this)||this;return L.parentTask=k,L.input=w,L.extractedFaces=_,L}return Object(Un.c)(E,F),E}(il),jm=function(F){function E(){return F!==null&&F.apply(this,arguments)||this}return Object(Un.c)(E,F),E.prototype.run=function(){return Object(Un.b)(this,void 0,void 0,function(){var k,w,_=this;return Object(Un.d)(this,function(L){switch(L.label){case 0:return[4,this.parentTask];case 1:return[4,Du(k=L.sent(),this.input,function(Y){return Object(Un.b)(_,void 0,void 0,function(){return Object(Un.d)(this,function(ce){switch(ce.label){case 0:return[4,Promise.all(Y.map(function(ve){return ro.ageGenderNet.predictAgeAndGender(ve)}))];case 1:return[2,ce.sent()]}})})},this.extractedFaces)];case 2:return w=L.sent(),[2,k.map(function(Y,ce){var ve=w[ce],De=ve.age;return Dm(zf(Y,ve.gender,ve.genderProbability),De)})]}})})},E.prototype.withFaceExpressions=function(){return new fc(this,this.input)},E}(Wp),Bm=function(F){function E(){return F!==null&&F.apply(this,arguments)||this}return Object(Un.c)(E,F),E.prototype.run=function(){return Object(Un.b)(this,void 0,void 0,function(){var k,w,_,L,Y;return Object(Un.d)(this,function(ce){switch(ce.label){case 0:return[4,this.parentTask];case 1:return(k=ce.sent())?[4,zl(k,this.input,function(ve){return ro.ageGenderNet.predictAgeAndGender(ve)},this.extractedFaces)]:[2];case 2:return w=ce.sent(),_=w.age,L=w.gender,Y=w.genderProbability,[2,Dm(zf(k,L,Y),_)]}})})},E.prototype.withFaceExpressions=function(){return new Fu(this,this.input)},E}(Wp),ip=function(F){function E(){return F!==null&&F.apply(this,arguments)||this}return Object(Un.c)(E,F),E.prototype.withFaceExpressions=function(){return new fu(this,this.input)},E.prototype.withFaceDescriptors=function(){return new hc(this,this.input)},E}(jm),Ro=function(F){function E(){return F!==null&&F.apply(this,arguments)||this}return Object(Un.c)(E,F),E.prototype.withFaceExpressions=function(){return new Qh(this,this.input)},E.prototype.withFaceDescriptor=function(){return new Xf(this,this.input)},E}(Bm),op=function(F){function E(k,w){var _=F.call(this)||this;return _.parentTask=k,_.input=w,_}return Object(Un.c)(E,F),E}(il),hc=function(F){function E(){return F!==null&&F.apply(this,arguments)||this}return Object(Un.c)(E,F),E.prototype.run=function(){return Object(Un.b)(this,void 0,void 0,function(){var k;return Object(Un.d)(this,function(w){switch(w.label){case 0:return[4,this.parentTask];case 1:return[4,Du(k=w.sent(),this.input,function(_){return Promise.all(_.map(function(L){return ro.faceRecognitionNet.computeFaceDescriptor(L)}))},null,function(_){return _.landmarks.align(null,{useDlibAlignment:!0})})];case 2:return[2,w.sent().map(function(_,L){return _m(k[L],_)})]}})})},E.prototype.withFaceExpressions=function(){return new fu(this,this.input)},E.prototype.withAgeAndGender=function(){return new ip(this,this.input)},E}(op),Xf=function(F){function E(){return F!==null&&F.apply(this,arguments)||this}return Object(Un.c)(E,F),E.prototype.run=function(){return Object(Un.b)(this,void 0,void 0,function(){var k,w;return Object(Un.d)(this,function(_){switch(_.label){case 0:return[4,this.parentTask];case 1:return(k=_.sent())?[4,zl(k,this.input,function(L){return ro.faceRecognitionNet.computeFaceDescriptor(L)},null,function(L){return L.landmarks.align(null,{useDlibAlignment:!0})})]:[2];case 2:return w=_.sent(),[2,_m(k,w)]}})})},E.prototype.withFaceExpressions=function(){return new Qh(this,this.input)},E.prototype.withAgeAndGender=function(){return new Ro(this,this.input)},E}(op),Yf=function(F){function E(k,w,_){var L=F.call(this)||this;return L.parentTask=k,L.input=w,L.useTinyLandmarkNet=_,L}return Object(Un.c)(E,F),Object.defineProperty(E.prototype,"landmarkNet",{get:function(){return this.useTinyLandmarkNet?ro.faceLandmark68TinyNet:ro.faceLandmark68Net},enumerable:!0,configurable:!0}),E}(il),ap=function(F){function E(){return F!==null&&F.apply(this,arguments)||this}return Object(Un.c)(E,F),E.prototype.run=function(){return Object(Un.b)(this,void 0,void 0,function(){var k,w,_,L,Y,ce=this;return Object(Un.d)(this,function(ve){switch(ve.label){case 0:return[4,this.parentTask];case 1:return k=ve.sent(),w=k.map(function(De){return De.detection}),this.input instanceof tn.Tensor?[4,Qi(this.input,w)]:[3,3];case 2:return L=ve.sent(),[3,5];case 3:return[4,to(this.input,w)];case 4:L=ve.sent(),ve.label=5;case 5:return _=L,[4,Promise.all(_.map(function(De){return ce.landmarkNet.detectLandmarks(De)}))];case 6:return Y=ve.sent(),_.forEach(function(De){return De instanceof tn.Tensor&&De.dispose()}),[2,k.map(function(De,Ce){return Uo(De,Y[Ce])})]}})})},E.prototype.withFaceExpressions=function(){return new fu(this,this.input)},E.prototype.withAgeAndGender=function(){return new ip(this,this.input)},E.prototype.withFaceDescriptors=function(){return new hc(this,this.input)},E}(Yf),Vp=function(F){function E(){return F!==null&&F.apply(this,arguments)||this}return Object(Un.c)(E,F),E.prototype.run=function(){return Object(Un.b)(this,void 0,void 0,function(){var k,w,_,L,Y;return Object(Un.d)(this,function(ce){switch(ce.label){case 0:return[4,this.parentTask];case 1:return(k=ce.sent())?(w=k.detection,this.input instanceof tn.Tensor?[4,Qi(this.input,[w])]:[3,3]):[2];case 2:return L=ce.sent(),[3,5];case 3:return[4,to(this.input,[w])];case 4:L=ce.sent(),ce.label=5;case 5:return _=L,[4,this.landmarkNet.detectLandmarks(_[0])];case 6:return Y=ce.sent(),_.forEach(function(ve){return ve instanceof tn.Tensor&&ve.dispose()}),[2,Uo(k,Y)]}})})},E.prototype.withFaceExpressions=function(){return new Qh(this,this.input)},E.prototype.withAgeAndGender=function(){return new Ro(this,this.input)},E.prototype.withFaceDescriptor=function(){return new Xf(this,this.input)},E}(Yf),qp=function(F){function E(k,w){w===void 0&&(w=new Tc);var _=F.call(this)||this;return _.input=k,_.options=w,_}return Object(Un.c)(E,F),E}(il),Hp=function(F){function E(){return F!==null&&F.apply(this,arguments)||this}return Object(Un.c)(E,F),E.prototype.run=function(){return Object(Un.b)(this,void 0,void 0,function(){var k,w,_,L;return Object(Un.d)(this,function(Y){switch(Y.label){case 0:return w=(k=this).input,(_=k.options)instanceof Dc?[4,ro.mtcnn.forward(w,_)]:[3,2];case 1:return[2,Y.sent().map(function(ce){return ce.detection})];case 2:if(!(L=_ instanceof Pp?function(ce){return ro.tinyFaceDetector.locateFaces(ce,_)}:_ instanceof Tc?function(ce){return ro.ssdMobilenetv1.locateFaces(ce,_)}:_ instanceof $h?function(ce){return ro.tinyYolov2.locateFaces(ce,_)}:null))throw new Error("detectFaces - expected options to be instance of TinyFaceDetectorOptions | SsdMobilenetv1Options | MtcnnOptions | TinyYolov2Options");return[2,L(w)]}})})},E.prototype.runAndExtendWithFaceDetections=function(){var k=this;return new Promise(function(w){return Object(Un.b)(k,void 0,void 0,function(){var _;return Object(Un.d)(this,function(L){switch(L.label){case 0:return[4,this.run()];case 1:return _=L.sent(),[2,w(_.map(function(Y){return Bf({},Y)}))]}})})})},E.prototype.withFaceLandmarks=function(k){return k===void 0&&(k=!1),new ap(this.runAndExtendWithFaceDetections(),this.input,k)},E.prototype.withFaceExpressions=function(){return new fc(this.runAndExtendWithFaceDetections(),this.input)},E.prototype.withAgeAndGender=function(){return new jm(this.runAndExtendWithFaceDetections(),this.input)},E}(qp),Rg=function(F){function E(){return F!==null&&F.apply(this,arguments)||this}return Object(Un.c)(E,F),E.prototype.run=function(){return Object(Un.b)(this,void 0,void 0,function(){var k,w;return Object(Un.d)(this,function(_){switch(_.label){case 0:return[4,new Hp(this.input,this.options)];case 1:return k=_.sent(),w=k[0],k.forEach(function(L){L.score>w.score&&(w=L)}),[2,w]}})})},E.prototype.runAndExtendWithFaceDetection=function(){var k=this;return new Promise(function(w){return Object(Un.b)(k,void 0,void 0,function(){var _;return Object(Un.d)(this,function(L){switch(L.label){case 0:return[4,this.run()];case 1:return _=L.sent(),[2,w(_?Bf({},_):void 0)]}})})})},E.prototype.withFaceLandmarks=function(k){return k===void 0&&(k=!1),new Vp(this.runAndExtendWithFaceDetection(),this.input,k)},E.prototype.withFaceExpressions=function(){return new Fu(this.runAndExtendWithFaceDetection(),this.input)},E.prototype.withAgeAndGender=function(){return new Bm(this.runAndExtendWithFaceDetection(),this.input)},E}(qp);function $p(F,E){return E===void 0&&(E=new Tc),new Rg(F,E)}function Kl(F,E){return E===void 0&&(E=new Tc),new Hp(F,E)}function Gp(F,E){return Object(Un.b)(this,void 0,void 0,function(){return Object(Un.d)(this,function(k){switch(k.label){case 0:return console.warn("allFacesSsdMobilenetv1 is deprecated and will be removed soon, use the high level api instead"),[4,Kl(F,new Tc(E?{minConfidence:E}:{})).withFaceLandmarks().withFaceDescriptors()];case 1:return[2,k.sent()]}})})}function Zh(F,E){return E===void 0&&(E={}),Object(Un.b)(this,void 0,void 0,function(){return Object(Un.d)(this,function(k){switch(k.label){case 0:return console.warn("allFacesTinyYolov2 is deprecated and will be removed soon, use the high level api instead"),[4,Kl(F,new $h(E)).withFaceLandmarks().withFaceDescriptors()];case 1:return[2,k.sent()]}})})}function Kp(F,E){return E===void 0&&(E={}),Object(Un.b)(this,void 0,void 0,function(){return Object(Un.d)(this,function(k){switch(k.label){case 0:return console.warn("allFacesMtcnn is deprecated and will be removed soon, use the high level api instead"),[4,Kl(F,new Dc(E)).withFaceLandmarks().withFaceDescriptors()];case 1:return[2,k.sent()]}})})}var Pm=Gp;function Lm(F,E){if(F.length!==E.length)throw new Error("euclideanDistance: arr1.length !== arr2.length");var k=Array.from(F),w=Array.from(E);return Math.sqrt(k.map(function(_,L){return _-w[L]}).reduce(function(_,L){return _+Math.pow(L,2)},0))}var sp=function(){function F(E,k){k===void 0&&(k=.6),this._distanceThreshold=k;var w=Array.isArray(E)?E:[E];if(!w.length)throw new Error("FaceRecognizer.constructor - expected atleast one input");var _=1,L=function(){return"person "+_++};this._labeledDescriptors=w.map(function(Y){if(Y instanceof Mf)return Y;if(Y instanceof Float32Array)return new Mf(L(),[Y]);if(Y.descriptor&&Y.descriptor instanceof Float32Array)return new Mf(L(),[Y.descriptor]);throw new Error("FaceRecognizer.constructor - expected inputs to be of type LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array | Array<LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array>")})}return Object.defineProperty(F.prototype,"labeledDescriptors",{get:function(){return this._labeledDescriptors},enumerable:!0,configurable:!0}),Object.defineProperty(F.prototype,"distanceThreshold",{get:function(){return this._distanceThreshold},enumerable:!0,configurable:!0}),F.prototype.computeMeanDistance=function(E,k){return k.map(function(w){return Lm(w,E)}).reduce(function(w,_){return w+_},0)/(k.length||1)},F.prototype.matchDescriptor=function(E){var k=this;return this.labeledDescriptors.map(function(w){var _=w.descriptors,L=w.label;return new iu(L,k.computeMeanDistance(E,_))}).reduce(function(w,_){return w.distance<_.distance?w:_})},F.prototype.findBestMatch=function(E){var k=this.matchDescriptor(E);return k.distance<this.distanceThreshold?k:new iu("unknown",k.distance)},F.prototype.toJSON=function(){return{distanceThreshold:this.distanceThreshold,labeledDescriptors:this.labeledDescriptors.map(function(E){return E.toJSON()})}},F.fromJSON=function(E){return new F(E.labeledDescriptors.map(function(k){return Mf.fromJSON(k)}),E.distanceThreshold)},F}();function zm(F){var E=new Wf;return E.extractWeights(F),E}function Xp(F){var E=new qf;return E.extractWeights(F),E}function Mg(F,E){var k=new Os(E.width,E.height),w=k.width,_=k.height;if(w<=0||_<=0)throw new Error("resizeResults - invalid dimensions: "+JSON.stringify({width:w,height:_}));if(Array.isArray(F))return F.map(function(ce){return Mg(ce,{width:w,height:_})});if(Sc(F)){var L=F.detection.forSize(w,_),Y=F.unshiftedLandmarks.forSize(L.box.width,L.box.height);return Uo(Bf(F,L),Y)}return Pl(F)?Bf(F,F.detection.forSize(w,_)):F instanceof Gs||F instanceof Yo?F.forSize(w,_):F}var sl={withLandmarks:!0,withDescriptors:!0,minConfidence:.5,withTinyNet:!0,MODEL_URLS:{Mobilenetv1Model:"https://raw.githubusercontent.com/ml5js/ml5-data-and-models/main/models/faceapi/ssd_mobilenetv1_model-weights_manifest.json",TinyFaceDetectorModel:"https://raw.githubusercontent.com/ml5js/ml5-data-and-models/main/models/faceapi/tiny_face_detector_model-weights_manifest.json",FaceLandmarkModel:"https://raw.githubusercontent.com/ml5js/ml5-data-and-models/main/models/faceapi/face_landmark_68_model-weights_manifest.json",FaceLandmark68TinyNet:"https://raw.githubusercontent.com/ml5js/ml5-data-and-models/main/models/faceapi/face_landmark_68_tiny_model-weights_manifest.json",FaceRecognitionModel:"https://raw.githubusercontent.com/ml5js/ml5-data-and-models/main/models/faceapi/face_recognition_model-weights_manifest.json"}},M0=function(){function F(E,k,w){pe()(this,F),this.video=E,this.model=null,this.modelReady=!1,this.detectorOptions=null,this.config={minConfidence:this.checkUndefined(k.minConfidence,sl.minConfidence),withLandmarks:this.checkUndefined(k.withLandmarks,sl.withLandmarks),withDescriptors:this.checkUndefined(k.withDescriptors,sl.withDescriptors),withTinyNet:this.checkUndefined(k.withTinyNet,sl.withTinyNet),MODEL_URLS:{Mobilenetv1Model:this.checkUndefined(k.Mobilenetv1Model,sl.MODEL_URLS.Mobilenetv1Model),TinyFaceDetectorModel:this.checkUndefined(k.TinyFaceDetectorModel,sl.MODEL_URLS.TinyFaceDetectorModel),FaceLandmarkModel:this.checkUndefined(k.FaceLandmarkModel,sl.MODEL_URLS.FaceLandmarkModel),FaceLandmark68TinyNet:this.checkUndefined(k.FaceLandmark68TinyNet,sl.MODEL_URLS.FaceLandmark68TinyNet),FaceRecognitionModel:this.checkUndefined(k.FaceRecognitionModel,sl.MODEL_URLS.FaceRecognitionModel)}},this.ready=ot(this.loadModel(),w)}return Te()(F,[{key:"loadModel",value:function(){var E=K()(we.a.mark(function k(){var w,_,L,Y,ce,ve,De,Ce=this;return we.a.wrap(function(Xe){for(;;)switch(Xe.prev=Xe.next){case 0:if(w=["Mobilenetv1Model","TinyFaceDetectorModel","FaceLandmarkModel","FaceLandmark68TinyNet","FaceRecognitionModel"],Object.keys(this.config.MODEL_URLS).forEach(function(nt){w.includes(nt)&&(Ce.config.MODEL_URLS[nt]=Pu.getModelPath(Ce.config.MODEL_URLS[nt]))}),_=this.config.MODEL_URLS,L=_.Mobilenetv1Model,Y=_.TinyFaceDetectorModel,ce=_.FaceLandmarkModel,ve=_.FaceRecognitionModel,De=_.FaceLandmark68TinyNet,this.model=W,this.config.withTinyNet===!0?this.detectorOptions=new Pp({minConfidence:this.minConfidence,inputSize:512}):this.detectorOptions=new Tc({minConfidence:this.minConfidence}),this.config.withTinyNet!==!0){Xe.next=12;break}return Xe.next=8,this.model.loadFaceLandmarkTinyModel(De);case 8:return Xe.next=10,this.model.loadTinyFaceDetectorModel(Y);case 10:Xe.next=16;break;case 12:return Xe.next=14,this.model.loadFaceLandmarkModel(ce);case 14:return Xe.next=16,this.model.loadSsdMobilenetv1Model(L);case 16:return Xe.next=18,this.model.loadFaceRecognitionModel(ve);case 18:return this.modelReady=!0,Xe.abrupt("return",this);case 20:case"end":return Xe.stop()}},k,this)}));return function(){return E.apply(this,arguments)}}()},{key:"detect",value:function(){var E=K()(we.a.mark(function k(w,_,L){var Y,ce,ve;return we.a.wrap(function(De){for(;;)switch(De.prev=De.next){case 0:if(Y=this.video,ve=this.config,typeof w!="function"){De.next=7;break}Y=this.video,ce=w,De.next=21;break;case 7:if(!(w instanceof HTMLImageElement||w instanceof HTMLCanvasElement||w instanceof HTMLVideoElement||w instanceof ImageData)){De.next=11;break}Y=w,De.next=21;break;case 11:if(ke()(w)!=="object"||!(w.elt instanceof HTMLImageElement||w.elt instanceof HTMLCanvasElement||w.elt instanceof HTMLVideoElement||w.elt instanceof ImageData)){De.next=15;break}Y=w.elt,De.next=21;break;case 15:if(!(ke()(w)==="object"&&w.canvas instanceof HTMLCanvasElement)){De.next=19;break}Y=w.canvas,De.next=21;break;case 19:if(this.video instanceof HTMLVideoElement){De.next=21;break}throw new Error("No input image provided. If you want to classify a video, pass the video element in the constructor. ");case 21:return ke()(_)==="object"?ve=_:typeof _=="function"&&(ce=_),typeof L=="function"&&(ce=L),De.abrupt("return",ot(this.detectInternal(Y,ve),ce));case 24:case"end":return De.stop()}},k,this)}));return function(k,w,_){return E.apply(this,arguments)}}()},{key:"detectInternal",value:function(){var E=K()(we.a.mark(function k(w,_){var L,Y,ce,ve,De=this;return we.a.wrap(function(Ce){for(;;)switch(Ce.prev=Ce.next){case 0:return Ce.next=2,this.ready;case 2:return Ce.next=4,I.nextFrame();case 4:if(!this.video||this.video.readyState!==0){Ce.next=7;break}return Ce.next=7,new Promise(function(Xe){De.video.onloadeddata=function(){return Xe()}});case 7:if(this.config=this.setReturnOptions(_),L=this.config,Y=L.withLandmarks,ce=L.withDescriptors,!Y){Ce.next=21;break}if(!ce){Ce.next=16;break}return Ce.next=13,this.model.detectAllFaces(w,this.detectorOptions).withFaceLandmarks(this.config.withTinyNet).withFaceDescriptors();case 13:ve=Ce.sent,Ce.next=19;break;case 16:return Ce.next=18,this.model.detectAllFaces(w,this.detectorOptions).withFaceLandmarks(this.config.withTinyNet);case 18:ve=Ce.sent;case 19:Ce.next=30;break;case 21:if(Y){Ce.next=27;break}return Ce.next=24,this.model.detectAllFaces(w);case 24:ve=Ce.sent,Ce.next=30;break;case 27:return Ce.next=29,this.model.detectAllFaces(w,this.detectorOptions).withFaceLandmarks(this.config.withTinyNet).withFaceDescriptors();case 29:ve=Ce.sent;case 30:return ve=this.resizeResults(ve,w.width,w.height),ve=this.landmarkParts(ve),Ce.abrupt("return",ve);case 33:case"end":return Ce.stop()}},k,this)}));return function(k,w){return E.apply(this,arguments)}}()},{key:"detectSingle",value:function(){var E=K()(we.a.mark(function k(w,_,L){var Y,ce,ve;return we.a.wrap(function(De){for(;;)switch(De.prev=De.next){case 0:if(Y=this.video,ve=this.config,typeof w!="function"){De.next=7;break}Y=this.video,ce=w,De.next=21;break;case 7:if(!(w instanceof HTMLImageElement||w instanceof HTMLCanvasElement||w instanceof HTMLVideoElement||w instanceof ImageData)){De.next=11;break}Y=w,De.next=21;break;case 11:if(ke()(w)!=="object"||!(w.elt instanceof HTMLImageElement||w.elt instanceof HTMLCanvasElement||w.elt instanceof HTMLVideoElement||w.elt instanceof ImageData)){De.next=15;break}Y=w.elt,De.next=21;break;case 15:if(!(ke()(w)==="object"&&w.canvas instanceof HTMLCanvasElement)){De.next=19;break}Y=w.canvas,De.next=21;break;case 19:if(this.video instanceof HTMLVideoElement){De.next=21;break}throw new Error("No input image provided. If you want to classify a video, pass the video element in the constructor. ");case 21:return ke()(_)==="object"?ve=_:typeof _=="function"&&(ce=_),typeof L=="function"&&(ce=L),De.abrupt("return",ot(this.detectSingleInternal(Y,ve),ce));case 24:case"end":return De.stop()}},k,this)}));return function(k,w,_){return E.apply(this,arguments)}}()},{key:"detectSingleInternal",value:function(){var E=K()(we.a.mark(function k(w,_){var L,Y,ce,ve,De=this;return we.a.wrap(function(Ce){for(;;)switch(Ce.prev=Ce.next){case 0:return Ce.next=2,this.ready;case 2:return Ce.next=4,I.nextFrame();case 4:if(!this.video||this.video.readyState!==0){Ce.next=7;break}return Ce.next=7,new Promise(function(Xe){De.video.onloadeddata=function(){return Xe()}});case 7:if(this.config=this.setReturnOptions(_),L=this.config,Y=L.withLandmarks,ce=L.withDescriptors,!Y){Ce.next=21;break}if(!ce){Ce.next=16;break}return Ce.next=13,this.model.detectSingleFace(w,this.detectorOptions).withFaceLandmarks(this.config.withTinyNet).withFaceDescriptor();case 13:ve=Ce.sent,Ce.next=19;break;case 16:return Ce.next=18,this.model.detectSingleFace(w,this.detectorOptions).withFaceLandmarks(this.config.withTinyNet);case 18:ve=Ce.sent;case 19:Ce.next=30;break;case 21:if(Y){Ce.next=27;break}return Ce.next=24,this.model.detectSingleFace(w);case 24:ve=Ce.sent,Ce.next=30;break;case 27:return Ce.next=29,this.model.detectSingleFace(w,this.detectorOptions).withFaceLandmarks(this.config.withTinyNet).withFaceDescriptor();case 29:ve=Ce.sent;case 30:return ve=this.resizeResults(ve,w.width,w.height),ve=this.landmarkParts(ve),Ce.abrupt("return",ve);case 33:case"end":return Ce.stop()}},k,this)}));return function(k,w){return E.apply(this,arguments)}}()},{key:"checkUndefined",value:function(E,k){return E!==void 0?E:k}},{key:"setReturnOptions",value:function(E){var k=this,w=Object.assign({},this.config);return["withLandmarks","withDescriptors"].forEach(function(_){E[_]!==void 0?k.config[_]=E[_]:w[_]=k.config[_]}),w}},{key:"resizeResults",value:function(E,k,w){if(k===void 0||w===void 0)throw new Error("width and height must be defined");return this.model.resizeResults(E,{width:k,height:w})}},{key:"landmarkParts",value:function(E){var k;if(Array.isArray(E)===!0)k=E.map(function(_){var L=Object.assign({},_);if(L.landmarks){var Y=L.landmarks;L.parts={mouth:Y.getMouth(),nose:Y.getNose(),leftEye:Y.getLeftEye(),leftEyeBrow:Y.getLeftEyeBrow(),rightEye:Y.getRightEye(),rightEyeBrow:Y.getRightEyeBrow(),jawOutline:Y.getJawOutline()}}else L.parts={mouth:[],nose:[],leftEye:[],leftEyeBrow:[],rightEye:[],rightEyeBrow:[],jawOutline:[]};return L});else if((k=Object.assign({},E)).landmarks){var w=E.landmarks;k.parts={mouth:w.getMouth(),nose:w.getNose(),leftEye:w.getLeftEye(),leftEyeBrow:w.getLeftEyeBrow(),rightEye:w.getRightEye(),rightEyeBrow:w.getRightEyeBrow()}}else k.parts={mouth:[],nose:[],leftEye:[],leftEyeBrow:[],rightEye:[],rightEyeBrow:[]};return k}}]),F}(),jg=function(F,E,k){var w,_={},L=k;F instanceof HTMLVideoElement?w=F:ke()(F)==="object"&&F.elt instanceof HTMLVideoElement?w=F.elt:ke()(F)==="object"?_=F:typeof F=="function"&&(L=F),ke()(E)==="object"?(_=E,console.log(_)):typeof E=="function"&&(L=E);var Y=new M0(w,_,L);return L?Y:Y.ready},up={k:3,maxIter:5,threshold:.5};function Bg(F){return Xl.apply(this,arguments)}function Xl(){return(Xl=K()(we.a.mark(function F(E){var k,w;return we.a.wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return k=I.data.csv(E),_.next=3,k.toArray();case 3:return w=_.sent,_.abrupt("return",w);case 5:case"end":return _.stop()}},F)}))).apply(this,arguments)}function Pg(F){return cp.apply(this,arguments)}function cp(){return(cp=K()(we.a.mark(function F(E){var k,w;return we.a.wrap(function(_){for(;;)switch(_.prev=_.next){case 0:if(typeof E!="string"){_.next=6;break}return _.next=3,Bg(E);case 3:k=_.sent,_.next=7;break;case 6:k=E;case 7:return w=k.map(function(L){return Object.values(L)}),_.abrupt("return",w);case 9:case"end":return _.stop()}},F)}))).apply(this,arguments)}var Yp=function(){function F(E,k,w){pe()(this,F),this.config={k:k.k||up.k,maxIter:k.maxIter||up.maxIter,threshold:k.threshold||up.threshold},this.ready=ot(this.load(E),w)}return Te()(F,[{key:"load",value:function(){var E=K()(we.a.mark(function k(w){var _=this;return we.a.wrap(function(L){for(;;)switch(L.prev=L.next){case 0:return L.next=2,Pg(w);case 2:return this.dataset=L.sent,I.tidy(function(){_.dataTensor=I.tensor2d(_.dataset),_.dataset.forEach(function(Y){var ce=I.tensor1d(Object.values(Y));Y.tensor=ce}),_.centroids=I.tensor2d(Nf(_.dataset,_.config.k,!1)),_.fit()}),L.abrupt("return",this);case 5:case"end":return L.stop()}},k,this)}));return function(k){return E.apply(this,arguments)}}()},{key:"fit",value:function(){this.getClosestCentroids(),this.recenterCentroids();for(var E=F.getEuclidianDistance(this.centroids,this.centroidsOld),k=0;E>this.config.threshold&&k<this.config.maxIter;)this.getClosestCentroids(),this.recenterCentroids(),E=F.getEuclidianDistance(this.centroids,this.centroidsOld),k+=1}},{key:"getClosestCentroids",value:function(){var E=this;this.dataset.forEach(function(k){var w=E.closestCentroid(k.tensor);k.centroid=w})}},{key:"closestCentroid",value:function(E){var k=this;return I.tidy(function(){return k.centroids.squaredDifference(E).sum(1).sqrt().argMin().arraySync()})}},{key:"classify",value:function(E){var k=this;return I.tidy(function(){var w=I.tensor1d(Object.values(E));return k.closestCentroid(w)})}},{key:"recenterCentroids",value:function(){var E=this,k=I.tidy(function(){return E.centroidsOld=E.centroids,I.stack(E.centroids.unstack().map(function(w,_){var L=E.dataset.filter(function(Y){return Y.centroid===_}).map(function(Y){return Y.tensor});return L.length===0?w:L.length===1?L[0]:I.tidy(function(){return I.stack(L).mean(0)})}))});this.centroids=k}}],[{key:"getEuclidianDistance",value:function(E,k){return I.tidy(function(){return I.squaredDifference(E,k).sum().sqrt().dataSync()})[0]}}]),F}(),Lg=function(F,E,k){return new Yp(F,E,k)};function zg(F){return Um.apply(this,arguments)}function Um(){return(Um=K()(we.a.mark(function F(E){var k,w;return we.a.wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return k=I.data.csv(E),_.next=3,k.toArray();case 3:return w=_.sent,_.abrupt("return",w);case 5:case"end":return _.stop()}},F)}))).apply(this,arguments)}function Ug(F){return Wg.apply(this,arguments)}function Wg(){return(Wg=K()(we.a.mark(function F(E){var k,w;return we.a.wrap(function(_){for(;;)switch(_.prev=_.next){case 0:if(typeof E!="string"){_.next=6;break}return _.next=3,zg(E);case 3:k=_.sent,_.next=7;break;case 6:k=E;case 7:return w=k.map(function(L){return Object.values(L)}),_.abrupt("return",w);case 9:case"end":return _.stop()}},F)}))).apply(this,arguments)}var Jf={eps:50,minPts:3},j0=function(){function F(E,k,w){pe()(this,F),this.config={eps:k.eps||Jf.eps,minPts:k.minPts||Jf.minPts},this.lastClusterId=0,this.status=[],this.ready=ot(this.load(E),w)}return Te()(F,[{key:"load",value:function(){var E=K()(we.a.mark(function k(w){var _=this;return we.a.wrap(function(L){for(;;)switch(L.prev=L.next){case 0:return L.next=2,Ug(w);case 2:return this.dataset=L.sent,I.tidy(function(){_.dataTensor=I.tensor2d(_.dataset),_.dataset.forEach(function(Y){var ce=I.tensor1d(Object.values(Y));Y.tensor=ce}),_.fit()}),L.abrupt("return",this);case 5:case"end":return L.stop()}},k,this)}));return function(k){return E.apply(this,arguments)}}()},{key:"fit",value:function(){var E=this;this.dataset.forEach(function(k,w){if(k.status===void 0){k.status=0;var _=E.getNeighboursIndices(k);_.length<E.config.minPts?k.status=0:(E.incrementClusterId(),E.extend(w,_))}})}},{key:"extend",value:function(E,k){var w=this;this.dataset[E].clusterid=this.getClusterId(),this.dataset[E].status=this.dataset[E].clusterid,k.forEach(function(_){if(w.dataset[_].status===void 0){w.dataset[_].status=0;var L=w.getNeighboursIndices(w.dataset[_]);L.length>=w.config.minPts&&w.extend(_,L)}w.dataset[_].status<1&&(w.dataset[_].status=w.dataset[E].clusterid,w.dataset[_].clusterid=w.dataset[E].clusterid)})}},{key:"getClusterId",value:function(){return this.lastClusterId}},{key:"incrementClusterId",value:function(){this.lastClusterId+=1}},{key:"getNeighboursIndices",value:function(E){var k=this;try{return I.tidy(function(){var w=I.squaredDifference(E.tensor,k.dataTensor).sum(1).sqrt().topk(k.dataTensor.shape[0],!0),_=w.values,L=w.indices;return I.stack([_.asType("float32"),L.asType("float32")],1).arraySync().filter(function(Y){return Y[0]<=k.config.eps}).reduce(function(Y,ce){return Y.push(ce[1]),Y},[])})||[]}catch(w){console.log("error ".concat(w))}return[]}}]),F}(),Vg=function(F,E,k){return new j0(F,E,k)},ul={hosoda:"https://raw.githubusercontent.com/leemengtaiwan/tfjs-models/master/cartoongan/tfjs_json_models/hosoda/model.json",miyazaki:"https://raw.githubusercontent.com/Derek-Wds/training_CartoonGAN/master/tfModels/Miyazaki/model.json"},Wm=function(){function F(E,k){pe()(this,F),this.config={modelUrl:E.modelUrl?E.modelUrl:ul.miyazaki,returnTensors:!!E.returnTensors&&E.returnTensors},this.model={},this.ready=!1,this.ready=ot(this.loadModel(this.config.modelUrl),k)}return Te()(F,[{key:"loadModel",value:function(){var E=K()(we.a.mark(function k(w){return we.a.wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return _.next=2,I.loadGraphModel(w);case 2:return this.model=_.sent,_.abrupt("return",this);case 4:case"end":return _.stop()}},k,this)}));return function(k){return E.apply(this,arguments)}}()},{key:"generate",value:function(){var E=K()(we.a.mark(function k(w,_){var L,Y;return we.a.wrap(function(ce){for(;;)switch(ce.prev=ce.next){case 0:if(Y=_,!Dn(w)){ce.next=5;break}L=w,ce.next=19;break;case 5:if(ke()(w)!=="object"||!Dn(w.elt)){ce.next=9;break}L=w.elt,ce.next=19;break;case 9:if(ke()(w)!=="object"||!Dn(w.canvas)){ce.next=13;break}L=w.canvas,ce.next=19;break;case 13:if(typeof w!="function"){ce.next=18;break}L=this.video,Y=w,ce.next=19;break;case 18:throw new Error("Detection subject not supported");case 19:return ce.abrupt("return",ot(this.generateInternal(L),Y));case 20:case"end":return ce.stop()}},k,this)}));return function(k,w){return E.apply(this,arguments)}}()},{key:"generateInternal",value:function(){var E=K()(we.a.mark(function k(w){var _,L,Y,ce;return we.a.wrap(function(ve){for(;;)switch(ve.prev=ve.next){case 0:return ve.next=2,this.ready;case 2:return ve.next=4,I.nextFrame();case 4:if((_=I.browser.fromPixels(w).resizeBilinear([256,256])).shape[0]===256&&_.shape[1]===256){ve.next=9;break}throw new Error("Input size should be ".concat(256,"*").concat(256," but ").concat(_.shape," is found"));case 9:if(_.shape[2]===3){ve.next=11;break}throw new Error("Input color channel number should be 3 but ".concat(_.shape[2]," is found"));case 11:if(_=_.sub(127.5).div(127.5).reshape([1,256,256,3]),L=I.ones([256,256,1]).tile([1,1,1]).mul(255),Y=(Y=(Y=this.model.predict(_)).add(1).mul(127.5).reshape([256,256,3]).floor()).concat(L,2),ce=this.resultFinalize(Y),!this.config.returnTensors){ve.next=19;break}return ve.abrupt("return",ce);case 19:return _.dispose(),Y.dispose(),ve.abrupt("return",ce);case 22:case"end":return ve.stop()}},k,this)}));return function(k){return E.apply(this,arguments)}}()},{key:"resultFinalize",value:function(){var E=K()(we.a.mark(function k(w){var _,L,Y,ce;return we.a.wrap(function(ve){for(;;)switch(ve.prev=ve.next){case 0:return _=w,ve.next=3,w.data();case 3:return L=ve.sent,ve.next=6,Nr.rawToBlob(L,w.shape[0],w.shape[1]);case 6:return Y=ve.sent,ve.next=9,Nr.blobToP5Image(Y);case 9:if(ce=ve.sent,!this.config.returnTensors){ve.next=12;break}return ve.abrupt("return",{tensor:_,raw:L,blob:Y,image:ce});case 12:return ve.abrupt("return",{raw:L,blob:Y,image:ce});case 13:case"end":return ve.stop()}},k,this)}));return function(k){return E.apply(this,arguments)}}()}]),F}(),qg=function(F,E){var k=ke()(F)==="object"?F:{},w=typeof F=="function"?F:E;return typeof F=="string"&&(k.modelUrl=F),new Wm(k,w)};/**
    * @license
    * Copyright 2021 Google LLC. All Rights Reserved.
    * Licensed under the Apache License, Version 2.0 (the "License");
    * you may not use this file except in compliance with the License.
    * You may obtain a copy of the License at
    *
    * http://www.apache.org/licenses/LICENSE-2.0
    *
    * Unless required by applicable law or agreed to in writing, software
    * distributed under the License is distributed on an "AS IS" BASIS,
    * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    * See the License for the specific language governing permissions and
    * limitations under the License.
    * =============================================================================
    */function Qf(F,E,k,w){return new(k||(k=Promise))(function(_,L){function Y(De){try{ve(w.next(De))}catch(Ce){L(Ce)}}function ce(De){try{ve(w.throw(De))}catch(Ce){L(Ce)}}function ve(De){var Ce;De.done?_(De.value):(Ce=De.value,Ce instanceof k?Ce:new k(function(Xe){Xe(Ce)})).then(Y,ce)}ve((w=w.apply(F,E||[])).next())})}function cl(F,E){var k,w,_,L,Y={label:0,sent:function(){if(1&_[0])throw _[1];return _[1]},trys:[],ops:[]};return L={next:ce(0),throw:ce(1),return:ce(2)},typeof Symbol=="function"&&(L[Symbol.iterator]=function(){return this}),L;function ce(ve){return function(De){return function(Ce){if(k)throw new TypeError("Generator is already executing.");for(;Y;)try{if(k=1,w&&(_=2&Ce[0]?w.return:Ce[0]?w.throw||((_=w.return)&&_.call(w),0):w.next)&&!(_=_.call(w,Ce[1])).done)return _;switch(w=0,_&&(Ce=[2&Ce[0],_.value]),Ce[0]){case 0:case 1:_=Ce;break;case 4:return Y.label++,{value:Ce[1],done:!1};case 5:Y.label++,w=Ce[1],Ce=[0];continue;case 7:Ce=Y.ops.pop(),Y.trys.pop();continue;default:if(!(_=(_=Y.trys).length>0&&_[_.length-1])&&(Ce[0]===6||Ce[0]===2)){Y=0;continue}if(Ce[0]===3&&(!_||Ce[1]>_[0]&&Ce[1]<_[3])){Y.label=Ce[1];break}if(Ce[0]===6&&Y.label<_[1]){Y.label=_[1],_=Ce;break}if(_&&Y.label<_[2]){Y.label=_[2],Y.ops.push(Ce);break}_[2]&&Y.ops.pop(),Y.trys.pop();continue}Ce=E.call(F,Y)}catch(Xe){Ce=[6,Xe],w=0}finally{k=_=0}if(5&Ce[0])throw Ce[1];return{value:Ce[0]?Ce[1]:void 0,done:!0}}([ve,De])}}}var Jp=function(F){for(var E=[],k=0,w=F;k<w.length;k++){var _=w[k];E.push(_)}return E},Vm=function(){this.parent=null,this.children={},this.end=!1,this.word=[[],0,0]},dc=function(){function F(){this.root=new Vm}return F.prototype.insert=function(E,k,w){for(var _=this.root,L=Jp(E),Y=0;Y<L.length;Y++)_.children[L[Y]]||(_.children[L[Y]]=new Vm,_.children[L[Y]].parent=_,_.children[L[Y]].word[0]=_.word[0].concat(L[Y])),_=_.children[L[Y]],Y===L.length-1&&(_.end=!0,_.word[1]=k,_.word[2]=w)},F.prototype.commonPrefixSearch=function(E){for(var k=[],w=this.root.children[E[0]],_=0;_<E.length&&w;_++)w.end&&k.push(w.word),w=w.children[E[_+1]];return k.length||k.push([[E[0]],0,0]),k},F}(),qm="",Hg=6,Yl=function(){function F(E,k){k===void 0&&(k=Hg),this.vocabulary=E,this.reservedSymbolsCount=k,this.trie=new dc;for(var w=this.reservedSymbolsCount;w<this.vocabulary.length;w++)this.trie.insert(this.vocabulary[w][0],this.vocabulary[w][1],w)}return F.prototype.encode=function(E){var k=[],w=[],_=[];E=function(dn){var cr=dn.normalize("NFKC");return cr.length>0?qm+cr.replace(/ /g,qm):cr}(E);for(var L=Jp(E),Y=0;Y<=L.length;Y++)k.push({}),w.push(0),_.push(0);for(Y=0;Y<L.length;Y++)for(var ce=this.trie.commonPrefixSearch(L.slice(Y)),ve=0;ve<ce.length;ve++){var De=ce[ve],Ce={key:De[0],score:De[1],index:De[2]};k[Y+(Xe=De[0].length)][Y]==null&&(k[Y+Xe][Y]=[]),k[Y+Xe][Y].push(Ce)}for(var Xe=0;Xe<=L.length;Xe++)for(var nt in k[Xe]){var Et=k[Xe][nt];for(ve=0;ve<Et.length;ve++){var At=Et[ve],rn=At.score+_[Xe-At.key.length];(_[Xe]===0||rn>=_[Xe])&&(_[Xe]=rn,w[Xe]=Et[ve].index)}}for(var un=[],kn=w.length-1;kn>0;)un.push(w[kn]),kn-=this.vocabulary[w[kn]][0].length;var En=[],_n=!1;for(Y=0;Y<un.length;Y++){var Pn=un[Y];_n&&Pn===0||En.push(Pn),_n=Pn===0}return En.reverse()},F}();function B0(F){return Qf(this,void 0,void 0,function(){var E;return cl(this,function(k){switch(k.label){case 0:return[4,ed(F)];case 1:return E=k.sent(),[2,new Yl(E)]}})})}function ed(F){return Qf(this,void 0,void 0,function(){return cl(this,function(E){switch(E.label){case 0:return[4,Ye.util.fetch(F)];case 1:return[2,E.sent().json()]}})})}function td(F){return Qf(this,void 0,void 0,function(){var E;return cl(this,function(k){switch(k.label){case 0:return[4,(E=new Jl).load(F)];case 1:return k.sent(),[2,E]}})})}var Jl=function(){function F(){}return F.prototype.loadModel=function(E){return Qf(this,void 0,void 0,function(){return cl(this,function(k){return[2,E?Object(jt.loadGraphModel)(E):Object(jt.loadGraphModel)("https://tfhub.dev/tensorflow/tfjs-model/universal-sentence-encoder-lite/1/default/1",{fromTFHub:!0})]})})},F.prototype.load=function(E){return E===void 0&&(E={}),Qf(this,void 0,void 0,function(){var k,w,_;return cl(this,function(L){switch(L.label){case 0:return[4,Promise.all([this.loadModel(E.modelUrl),ed(E.vocabUrl||"https://storage.googleapis.com/tfjs-models/savedmodel/universal_sentence_encoder/vocab.json")])];case 1:return k=L.sent(),w=k[0],_=k[1],this.model=w,this.tokenizer=new Yl(_),[2]}})})},F.prototype.embed=function(E){return Qf(this,void 0,void 0,function(){var k,w,_,L,Y,ce,ve,De,Ce=this;return cl(this,function(Xe){switch(Xe.label){case 0:for(typeof E=="string"&&(E=[E]),k=E.map(function(nt){return Ce.tokenizer.encode(nt)}),w=k.map(function(nt,Et){return nt.map(function(At,rn){return[Et,rn]})}),_=[],L=0;L<w.length;L++)_=_.concat(w[L]);return Y=Object(Ye.tensor2d)(_,[_.length,2],"int32"),ce=Object(Ye.tensor1d)(Ye.util.flatten(k),"int32"),ve={indices:Y,values:ce},[4,this.model.executeAsync(ve)];case 1:return De=Xe.sent(),Y.dispose(),ce.dispose(),[2,De]}})})},F}(),$g={withTokenizer:!1},Zf=function(){function F(E,k){pe()(this,F),this.model=null,this.tokenizer=null,this.config={withTokenizer:E.withTokenizer||$g.withTokenizer},ot(this.loadModel(),k)}return Te()(F,[{key:"loadModel",value:function(){var E=K()(we.a.mark(function k(){return we.a.wrap(function(w){for(;;)switch(w.prev=w.next){case 0:if(this.config.withTokenizer!==!0){w.next=4;break}return w.next=3,B0();case 3:this.tokenizer=w.sent;case 4:return w.next=6,td();case 6:return this.model=w.sent,w.abrupt("return",this);case 8:case"end":return w.stop()}},k,this)}));return function(){return E.apply(this,arguments)}}()},{key:"predict",value:function(E,k){return ot(this.predictInternal(E),k)}},{key:"predictInternal",value:function(){var E=K()(we.a.mark(function k(w){var _,L;return we.a.wrap(function(Y){for(;;)switch(Y.prev=Y.next){case 0:return Y.prev=0,Y.next=3,this.model.embed(w);case 3:return _=Y.sent,Y.next=6,_.array();case 6:return L=Y.sent,_.dispose(),Y.abrupt("return",L);case 11:return Y.prev=11,Y.t0=Y.catch(0),console.error(Y.t0),Y.abrupt("return",Y.t0);case 15:case"end":return Y.stop()}},k,this,[[0,11]])}));return function(k){return E.apply(this,arguments)}}()},{key:"encode",value:function(E,k){return ot(this.encodeInternal(E),k)}},{key:"encodeInternal",value:function(){var E=K()(we.a.mark(function k(w){return we.a.wrap(function(_){for(;;)switch(_.prev=_.next){case 0:if(this.config.withTokenizer!==!0){_.next=2;break}return _.abrupt("return",this.tokenizer.encode(w));case 2:return console.error('withTokenizer must be set to true - please pass "withTokenizer:true" as an option in the constructor'),_.abrupt("return",!1);case 4:case"end":return _.stop()}},k,this)}));return function(k){return E.apply(this,arguments)}}()}]),F}(),pc=function(F,E){var k=ke()(F)==="object"?F:{};return new Zf(k,typeof F=="function"?F:E)};/**
    * @license
    * Copyright 2020 Google LLC. All Rights Reserved.
    * Licensed under the Apache License, Version 2.0 (the "License");
    * you may not use this file except in compliance with the License.
    * You may obtain a copy of the License at
    *
    * http://www.apache.org/licenses/LICENSE-2.0
    *
    * Unless required by applicable law or agreed to in writing, software
    * distributed under the License is distributed on an "AS IS" BASIS,
    * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    * See the License for the specific language governing permissions and
    * limitations under the License.
    * =============================================================================
    */const nd=F=>{F.startEndTensor.dispose(),F.startPoint.dispose(),F.endPoint.dispose()},lp=F=>({startEndTensor:F,startPoint:Object(Ye.slice)(F,[0,0],[-1,2]),endPoint:Object(Ye.slice)(F,[0,2],[-1,2])}),Qp=(F,E)=>{const k=Object(Ye.mul)(F.startPoint,E),w=Object(Ye.mul)(F.endPoint,E),_=Object(Ye.concat2d)([k,w],1);return lp(_)},Hm={strides:[8,16],anchors:[2,6]},Gg=6;function ns(F,E){let k,w,_;if(F.topLeft instanceof Ye.Tensor&&F.bottomRight instanceof Ye.Tensor){const[Y,ce]=Object(Ye.tidy)(()=>[Object(Ye.concat)([Object(Ye.sub)(E-1,F.topLeft.slice(0,1)),F.topLeft.slice(1,1)]),Object(Ye.concat)([Object(Ye.sub)(E-1,F.bottomRight.slice(0,1)),F.bottomRight.slice(1,1)])]);k=Y,w=ce,F.landmarks!=null&&(_=Object(Ye.tidy)(()=>{const ve=Object(Ye.sub)(Object(Ye.tensor1d)([E-1,0]),F.landmarks),De=Object(Ye.tensor1d)([1,-1]);return Object(Ye.mul)(ve,De)}))}else{const[Y,ce]=F.topLeft,[ve,De]=F.bottomRight;k=[E-1-Y,ce],w=[E-1-ve,De],F.landmarks!=null&&(_=F.landmarks.map(Ce=>[E-1-Ce[0],Ce[1]]))}const L={topLeft:k,bottomRight:w};return _!=null&&(L.landmarks=_),F.probability!=null&&(L.probability=F.probability instanceof Ye.Tensor?F.probability.clone():F.probability),L}function Kg(F,E){return Object(Ye.tidy)(()=>{let k;return k=F.hasOwnProperty("box")?F.box:F,Qp(k,E).startEndTensor.squeeze()})}class rd{constructor(E,k,w,_,L,Y){this.blazeFaceModel=E,this.width=k,this.height=w,this.maxFaces=_,this.anchorsData=function(ce,ve,De){const Ce=[];for(let Xe=0;Xe<De.strides.length;Xe++){const nt=De.strides[Xe],Et=Math.floor((ve+nt-1)/nt),At=Math.floor((ce+nt-1)/nt),rn=De.anchors[Xe];for(let un=0;un<Et;un++){const kn=nt*(un+.5);for(let En=0;En<At;En++){const _n=nt*(En+.5);for(let Pn=0;Pn<rn;Pn++)Ce.push([_n,kn])}}}return Ce}(k,w,Hm),this.anchors=Object(Ye.tensor2d)(this.anchorsData),this.inputSizeData=[k,w],this.inputSize=Object(Ye.tensor1d)([k,w]),this.iouThreshold=L,this.scoreThreshold=Y}async getBoundingBoxes(E,k,w=!0){const[_,L,Y]=Object(Ye.tidy)(()=>{const rn=E.resizeBilinear([this.width,this.height]),un=Object(Ye.mul)(Object(Ye.sub)(rn.div(255),.5),2),kn=this.blazeFaceModel.predict(un).squeeze(),En=function(Pn,dn,cr){const yr=Object(Ye.slice)(Pn,[0,1],[-1,2]),br=Object(Ye.add)(yr,dn),Br=Object(Ye.slice)(Pn,[0,3],[-1,2]),Or=Object(Ye.div)(Br,cr),hi=Object(Ye.div)(br,cr),ki=Object(Ye.div)(Or,2),xi=Object(Ye.sub)(hi,ki),xo=Object(Ye.add)(hi,ki),Wo=Object(Ye.mul)(xi,cr),To=Object(Ye.mul)(xo,cr);return Object(Ye.concat2d)([Wo,To],1)}(kn,this.anchors,this.inputSize),_n=Object(Ye.slice)(kn,[0,0],[-1,1]);return[kn,En,Object(Ye.sigmoid)(_n).squeeze()]}),ce=console.warn;console.warn=()=>{};const ve=Ye.image.nonMaxSuppression(L,Y,this.maxFaces,this.iouThreshold,this.scoreThreshold);console.warn=ce;const De=await ve.array();ve.dispose();let Ce=De.map(rn=>Object(Ye.slice)(L,[rn,0],[1,-1]));k||(Ce=await Promise.all(Ce.map(async rn=>{const un=await rn.array();return rn.dispose(),un})));const Xe=E.shape[1],nt=E.shape[2];let Et;Et=k?Object(Ye.div)([nt,Xe],this.inputSize):[nt/this.inputSizeData[0],Xe/this.inputSizeData[1]];const At=[];for(let rn=0;rn<Ce.length;rn++){const un=Ce[rn],kn=Object(Ye.tidy)(()=>{const En=lp(un instanceof Ye.Tensor?un:Object(Ye.tensor2d)(un));if(!w)return En;const _n=De[rn];let Pn;return Pn=k?this.anchors.slice([_n,0],[1,2]):this.anchorsData[_n],{box:En,landmarks:Object(Ye.slice)(_,[_n,Gg-1],[1,-1]).squeeze().reshape([Gg,-1]),probability:Object(Ye.slice)(Y,[_n],[1]),anchor:Pn}});At.push(kn)}return L.dispose(),Y.dispose(),_.dispose(),{boxes:At,scaleFactor:Et}}async estimateFaces(E,k=!1,w=!1,_=!0){const[,L]=function(De){return De instanceof Ye.Tensor?[De.shape[0],De.shape[1]]:[De.height,De.width]}(E),Y=Object(Ye.tidy)(()=>(E instanceof Ye.Tensor||(E=Ye.browser.fromPixels(E)),E.toFloat().expandDims(0))),{boxes:ce,scaleFactor:ve}=await this.getBoundingBoxes(Y,k,_);return Y.dispose(),k?ce.map(De=>{const Ce=Kg(De,ve);let Xe={topLeft:Ce.slice([0],[2]),bottomRight:Ce.slice([2],[2])};if(_){const{landmarks:nt,probability:Et,anchor:At}=De,rn=nt.add(At).mul(ve);Xe.landmarks=rn,Xe.probability=Et}return w&&(Xe=ns(Xe,L)),Xe}):Promise.all(ce.map(async De=>{const Ce=Kg(De,ve);let Xe;if(_){const[nt,Et,At]=await Promise.all([De.landmarks,Ce,De.probability].map(async _n=>_n.array())),rn=De.anchor,[un,kn]=ve,En=nt.map(_n=>[(_n[0]+rn[0])*un,(_n[1]+rn[1])*kn]);Xe={topLeft:Et.slice(0,2),bottomRight:Et.slice(2),landmarks:En,probability:At},nd(De.box),De.landmarks.dispose(),De.probability.dispose()}else{const nt=await Ce.array();Xe={topLeft:nt.slice(0,2),bottomRight:nt.slice(2)}}return Ce.dispose(),w&&(Xe=ns(Xe,L)),Xe}))}}const Xg="https://tfhub.dev/tensorflow/tfjs-model/blazeface/1/default/1",Zp={silhouette:[10,338,297,332,284,251,389,356,454,323,361,288,397,365,379,378,400,377,152,148,176,149,150,136,172,58,132,93,234,127,162,21,54,103,67,109],lipsUpperOuter:[61,185,40,39,37,0,267,269,270,409,291],lipsLowerOuter:[146,91,181,84,17,314,405,321,375,291],lipsUpperInner:[78,191,80,81,82,13,312,311,310,415,308],lipsLowerInner:[78,95,88,178,87,14,317,402,318,324,308],rightEyeUpper0:[246,161,160,159,158,157,173],rightEyeLower0:[33,7,163,144,145,153,154,155,133],rightEyeUpper1:[247,30,29,27,28,56,190],rightEyeLower1:[130,25,110,24,23,22,26,112,243],rightEyeUpper2:[113,225,224,223,222,221,189],rightEyeLower2:[226,31,228,229,230,231,232,233,244],rightEyeLower3:[143,111,117,118,119,120,121,128,245],rightEyebrowUpper:[156,70,63,105,66,107,55,193],rightEyebrowLower:[35,124,46,53,52,65],leftEyeUpper0:[466,388,387,386,385,384,398],leftEyeLower0:[263,249,390,373,374,380,381,382,362],leftEyeUpper1:[467,260,259,257,258,286,414],leftEyeLower1:[359,255,339,254,253,252,256,341,463],leftEyeUpper2:[342,445,444,443,442,441,413],leftEyeLower2:[446,261,448,449,450,451,452,453,464],leftEyeLower3:[372,340,346,347,348,349,350,357,465],leftEyebrowUpper:[383,300,293,334,296,336,285,417],leftEyebrowLower:[265,353,276,283,282,295],midwayBetweenEyes:[168],noseTip:[1],noseBottom:[2],noseRightCorner:[98],noseLeftCorner:[327],rightCheek:[205],leftCheek:[425]};function Ql(F){F!=null&&F.startPoint!=null&&(F.startEndTensor.dispose(),F.startPoint.dispose(),F.endPoint.dispose())}function fp(F,E,k){return{startEndTensor:F,startPoint:E??Object(Ye.slice)(F,[0,0],[-1,2]),endPoint:k??Object(Ye.slice)(F,[0,2],[-1,2])}}function ll(F){return Object(Ye.tidy)(()=>{const E=Object(Ye.sub)(F.endPoint,F.startPoint);return Object(Ye.abs)(E)})}function Yg(F,E=1.5){return Object(Ye.tidy)(()=>{const k=function(ce){return Object(Ye.tidy)(()=>{const ve=Object(Ye.div)(Object(Ye.sub)(ce.endPoint,ce.startPoint),2);return Object(Ye.add)(ce.startPoint,ve)})}(F),w=ll(F),_=Object(Ye.mul)(Object(Ye.div)(w,2),E),L=Object(Ye.sub)(k,_),Y=Object(Ye.add)(k,_);return fp(Object(Ye.concat2d)([L,Y],1),L,Y)})}const em=468,tm=.25;class $m{constructor(E,k,w,_,L,Y){this.regionsOfInterest=[],this.runsWithoutFaceDetector=0,this.boundingBoxDetector=E,this.meshDetector=k,this.meshWidth=w,this.meshHeight=_,this.maxContinuousChecks=L,this.maxFaces=Y}async predict(E){if(this.shouldUpdateRegionsOfInterest()){const{boxes:_,scaleFactor:L}=await this.boundingBoxDetector.getBoundingBoxes(E,!0,!1);if(_.length===0)return L.dispose(),this.clearAllRegionsOfInterest(),null;const Y=_.map(ce=>Yg(function(ve,De){const Ce=Object(Ye.mul)(ve.startPoint,De),Xe=Object(Ye.mul)(ve.endPoint,De);return fp(Object(Ye.concat2d)([Ce,Xe],1))}(ce,L)));_.forEach(Ql),this.updateRegionsOfInterest(Y),this.runsWithoutFaceDetector=0}else this.runsWithoutFaceDetector++;return Object(Ye.tidy)(()=>this.regionsOfInterest.map((k,w)=>{const _=function(Xe,nt,Et){const At=nt.shape[1],rn=nt.shape[2],un=Xe.startEndTensor;return Object(Ye.tidy)(()=>{const kn=Object(Ye.concat2d)([un.slice([0,1],[-1,1]),un.slice([0,0],[-1,1]),un.slice([0,3],[-1,1]),un.slice([0,2],[-1,1])],0),En=Object(Ye.div)(kn.transpose(),[At,rn,At,rn]);return Ye.image.cropAndResize(nt,En,[0],Et)})}(k,E,[this.meshHeight,this.meshWidth]).div(255),[,L,Y]=this.meshDetector.predict(_),ce=Object(Ye.reshape)(Y,[-1,3]),ve=Object(Ye.div)(ll(k),[this.meshWidth,this.meshHeight]),De=Object(Ye.mul)(ce,ve.concat(Object(Ye.tensor2d)([1],[1,1]),1)).add(k.startPoint.concat(Object(Ye.tensor2d)([0],[1,1]),1)),Ce=this.calculateLandmarksBoundingBox(De);return Ql(this.regionsOfInterest[w]),this.regionsOfInterest[w]=Ce,{coords:ce,scaledCoords:De,box:Ce,flag:L.squeeze()}}))}updateRegionsOfInterest(E){for(let k=0;k<E.length;k++){const w=E[k],_=this.regionsOfInterest[k];let L=0;if(_&&_.startPoint){const[Y,ce,ve,De]=w.startEndTensor.arraySync()[0],[Ce,Xe,nt,Et]=_.startEndTensor.arraySync()[0],At=Math.max(Y,Ce),rn=Math.max(ce,Xe),un=(Math.min(ve,nt)-At)*(Math.min(De,Et)-rn);L=un/((ve-Y)*(De-ce)+(nt-Ce)*(Et-ce)-un)}L>tm?Ql(w):(this.regionsOfInterest[k]=w,Ql(_))}for(let k=E.length;k<this.regionsOfInterest.length;k++)Ql(this.regionsOfInterest[k]);this.regionsOfInterest=this.regionsOfInterest.slice(0,E.length)}clearRegionOfInterest(E){this.regionsOfInterest[E]!=null&&(Ql(this.regionsOfInterest[E]),this.regionsOfInterest=[...this.regionsOfInterest.slice(0,E),...this.regionsOfInterest.slice(E+1)])}clearAllRegionsOfInterest(){for(let E=0;E<this.regionsOfInterest.length;E++)Ql(this.regionsOfInterest[E]);this.regionsOfInterest=[]}shouldUpdateRegionsOfInterest(){const E=this.regionsOfInterest.length,k=E===0;return this.maxFaces===1||k?k:E!==this.maxFaces&&this.runsWithoutFaceDetector>=this.maxContinuousChecks}calculateLandmarksBoundingBox(E){const k=E.slice([0,0],[em,1]),w=E.slice([0,1],[em,1]);return Yg(fp(Object(Ye.stack)([k.min(),w.min(),k.max(),w.max()]).expandDims(0)))}}const Ic=[[.499976992607117,.652534008026123],[.500025987625122,.547487020492554],[.499974012374878,.602371990680695],[.482113003730774,.471979022026062],[.500150978565216,.527155995368958],[.499909996986389,.498252987861633],[.499523013830185,.40106201171875],[.289712011814117,.380764007568359],[.499954998493195,.312398016452789],[.499987006187439,.269918978214264],[.500023007392883,.107050001621246],[.500023007392883,.666234016418457],[.5000159740448,.679224014282227],[.500023007392883,.692348003387451],[.499976992607117,.695277988910675],[.499976992607117,.70593398809433],[.499976992607117,.719385027885437],[.499976992607117,.737019002437592],[.499967992305756,.781370997428894],[.499816000461578,.562981009483337],[.473773002624512,.573909997940063],[.104906998574734,.254140973091125],[.365929991006851,.409575998783112],[.338757991790771,.41302502155304],[.311120003461838,.409460008144379],[.274657994508743,.389131009578705],[.393361985683441,.403706014156342],[.345234006643295,.344011008739471],[.370094001293182,.346076011657715],[.319321990013123,.347265005111694],[.297903001308441,.353591024875641],[.24779200553894,.410809993743896],[.396889001131058,.842755019664764],[.280097991228104,.375599980354309],[.106310002505779,.399955987930298],[.2099249958992,.391353011131287],[.355807989835739,.534406006336212],[.471751004457474,.65040397644043],[.474155008792877,.680191993713379],[.439785003662109,.657229006290436],[.414617002010345,.66654098033905],[.450374007225037,.680860996246338],[.428770989179611,.682690978050232],[.374971002340317,.727805018424988],[.486716985702515,.547628998756409],[.485300987958908,.527395009994507],[.257764995098114,.314490020275116],[.401223003864288,.455172002315521],[.429818987846375,.548614978790283],[.421351999044418,.533740997314453],[.276895999908447,.532056987285614],[.483370006084442,.499586999416351],[.33721199631691,.282882988452911],[.296391993761063,.293242990970612],[.169294998049736,.193813979625702],[.447580009698868,.302609980106354],[.392390012741089,.353887975215912],[.354490011930466,.696784019470215],[.067304998636246,.730105042457581],[.442739009857178,.572826027870178],[.457098007202148,.584792017936707],[.381974011659622,.694710969924927],[.392388999462128,.694203019142151],[.277076005935669,.271932005882263],[.422551989555359,.563233017921448],[.385919004678726,.281364023685455],[.383103013038635,.255840003490448],[.331431001424789,.119714021682739],[.229923993349075,.232002973556519],[.364500999450684,.189113974571228],[.229622006416321,.299540996551514],[.173287004232407,.278747975826263],[.472878992557526,.666198015213013],[.446828007698059,.668527007102966],[.422762006521225,.673889994621277],[.445307999849319,.580065965652466],[.388103008270264,.693961024284363],[.403039008378983,.706539988517761],[.403629004955292,.693953037261963],[.460041999816895,.557139039039612],[.431158006191254,.692366003990173],[.452181994915009,.692366003990173],[.475387006998062,.692366003990173],[.465828001499176,.779190003871918],[.472328990697861,.736225962638855],[.473087012767792,.717857003211975],[.473122000694275,.704625964164734],[.473033010959625,.695277988910675],[.427942007780075,.695277988910675],[.426479011774063,.703539967536926],[.423162013292313,.711845993995667],[.4183090031147,.720062971115112],[.390094995498657,.639572978019714],[.013953999616206,.560034036636353],[.499913990497589,.58014702796936],[.413199990987778,.69539999961853],[.409626007080078,.701822996139526],[.468080013990402,.601534962654114],[.422728985548019,.585985004901886],[.463079988956451,.593783974647522],[.37211999297142,.47341400384903],[.334562003612518,.496073007583618],[.411671012639999,.546965003013611],[.242175996303558,.14767599105835],[.290776997804642,.201445996761322],[.327338010072708,.256527006626129],[.399509996175766,.748921036720276],[.441727995872498,.261676013469696],[.429764986038208,.187834024429321],[.412198007106781,.108901023864746],[.288955003023148,.398952007293701],[.218936994671822,.435410976409912],[.41278201341629,.398970007896423],[.257135003805161,.355440020561218],[.427684992551804,.437960982322693],[.448339998722076,.536936044692993],[.178560003638268,.45755398273468],[.247308000922203,.457193970680237],[.286267012357712,.467674970626831],[.332827985286713,.460712015628815],[.368755996227264,.447206974029541],[.398963987827301,.432654976844788],[.476410001516342,.405806005001068],[.189241006970406,.523923993110657],[.228962004184723,.348950982093811],[.490725994110107,.562400996685028],[.404670000076294,.485132992267609],[.019469000399113,.401564002037048],[.426243007183075,.420431017875671],[.396993011236191,.548797011375427],[.266469985246658,.376977026462555],[.439121007919312,.51895797252655],[.032313998788595,.644356966018677],[.419054001569748,.387154996395111],[.462783008813858,.505746960639954],[.238978996872902,.779744982719421],[.198220998048782,.831938028335571],[.107550002634525,.540755033493042],[.183610007166862,.740257024765015],[.134409993886948,.333683013916016],[.385764002799988,.883153975009918],[.490967005491257,.579378008842468],[.382384985685349,.508572995662689],[.174399003386497,.397670984268188],[.318785011768341,.39623498916626],[.343364000320435,.400596976280212],[.396100014448166,.710216999053955],[.187885001301765,.588537991046906],[.430987000465393,.944064974784851],[.318993002176285,.898285031318665],[.266247987747192,.869701027870178],[.500023007392883,.190576016902924],[.499976992607117,.954452991485596],[.366169989109039,.398822009563446],[.393207013607025,.39553701877594],[.410373002290726,.391080021858215],[.194993004202843,.342101991176605],[.388664990663528,.362284004688263],[.365961998701096,.355970978736877],[.343364000320435,.355356991291046],[.318785011768341,.35834002494812],[.301414996385574,.363156020641327],[.058132998645306,.319076001644135],[.301414996385574,.387449026107788],[.499987989664078,.618434011936188],[.415838003158569,.624195992946625],[.445681989192963,.566076993942261],[.465844005346298,.620640993118286],[.49992299079895,.351523995399475],[.288718998432159,.819945991039276],[.335278987884521,.852819979190826],[.440512001514435,.902418971061707],[.128294005990028,.791940987110138],[.408771991729736,.373893976211548],[.455606997013092,.451801002025604],[.499877005815506,.908990025520325],[.375436991453171,.924192011356354],[.11421000212431,.615022003650665],[.448662012815475,.695277988910675],[.4480200111866,.704632043838501],[.447111994028091,.715808033943176],[.444831997156143,.730794012546539],[.430011987686157,.766808986663818],[.406787008047104,.685672998428345],[.400738000869751,.681069016456604],[.392399996519089,.677703022956848],[.367855995893478,.663918972015381],[.247923001646996,.601333022117615],[.452769994735718,.420849978923798],[.43639200925827,.359887003898621],[.416164010763168,.368713974952698],[.413385987281799,.692366003990173],[.228018000721931,.683571994304657],[.468268007040024,.352671027183533],[.411361992359161,.804327011108398],[.499989002943039,.469825029373169],[.479153990745544,.442654013633728],[.499974012374878,.439637005329132],[.432112008333206,.493588984012604],[.499886006116867,.866917014122009],[.49991300702095,.821729004383087],[.456548988819122,.819200992584229],[.344549000263214,.745438992977142],[.37890899181366,.574010014533997],[.374292999505997,.780184984207153],[.319687992334366,.570737957954407],[.357154995203018,.604269981384277],[.295284003019333,.621580958366394],[.447750002145767,.862477004528046],[.410986006259918,.508723020553589],[.31395098567009,.775308012962341],[.354128003120422,.812552988529205],[.324548006057739,.703992962837219],[.189096003770828,.646299958229065],[.279776990413666,.71465802192688],[.1338230073452,.682700991630554],[.336768001317978,.644733011722565],[.429883986711502,.466521978378296],[.455527991056442,.548622965812683],[.437114000320435,.558896005153656],[.467287987470627,.529924988746643],[.414712011814117,.335219979286194],[.37704598903656,.322777986526489],[.344107985496521,.320150971412659],[.312875986099243,.32233202457428],[.283526003360748,.333190023899078],[.241245999932289,.382785975933075],[.102986000478268,.468762993812561],[.267612010240555,.424560010433197],[.297879010438919,.433175981044769],[.333433985710144,.433878004550934],[.366427004337311,.426115989685059],[.396012008190155,.416696012020111],[.420121014118195,.41022801399231],[.007561000064015,.480777025222778],[.432949006557465,.569517970085144],[.458638995885849,.479089021682739],[.473466008901596,.545744001865387],[.476087987422943,.563830018043518],[.468472003936768,.555056989192963],[.433990985155106,.582361996173859],[.483518004417419,.562983989715576],[.482482999563217,.57784903049469],[.42645001411438,.389798998832703],[.438998997211456,.39649498462677],[.450067013502121,.400434017181396],[.289712011814117,.368252992630005],[.276670008897781,.363372981548309],[.517862021923065,.471948027610779],[.710287988185883,.380764007568359],[.526226997375488,.573909997940063],[.895093023777008,.254140973091125],[.634069979190826,.409575998783112],[.661242008209229,.41302502155304],[.688880026340485,.409460008144379],[.725341975688934,.389131009578705],[.606630027294159,.40370500087738],[.654766023159027,.344011008739471],[.629905998706818,.346076011657715],[.680678009986877,.347265005111694],[.702096998691559,.353591024875641],[.75221198797226,.410804986953735],[.602918028831482,.842862963676453],[.719901978969574,.375599980354309],[.893692970275879,.399959981441498],[.790081977844238,.391354024410248],[.643998026847839,.534487962722778],[.528249025344849,.65040397644043],[.525849997997284,.680191040039062],[.560214996337891,.657229006290436],[.585384011268616,.66654098033905],[.549625992774963,.680860996246338],[.57122802734375,.682691991329193],[.624852001667023,.72809898853302],[.513050019741058,.547281980514526],[.51509702205658,.527251958847046],[.742246985435486,.314507007598877],[.598631024360657,.454979002475739],[.570338010787964,.548575043678284],[.578631997108459,.533622980117798],[.723087012767792,.532054007053375],[.516445994377136,.499638974666595],[.662801027297974,.282917976379395],[.70362401008606,.293271005153656],[.830704987049103,.193813979625702],[.552385985851288,.302568018436432],[.607609987258911,.353887975215912],[.645429015159607,.696707010269165],[.932694971561432,.730105042457581],[.557260990142822,.572826027870178],[.542901992797852,.584792017936707],[.6180260181427,.694710969924927],[.607590973377228,.694203019142151],[.722943007946014,.271963000297546],[.577413976192474,.563166975975037],[.614082992076874,.281386971473694],[.616907000541687,.255886018276215],[.668509006500244,.119913995265961],[.770092010498047,.232020974159241],[.635536015033722,.189248979091644],[.77039098739624,.299556016921997],[.826722025871277,.278755009174347],[.527121007442474,.666198015213013],[.553171992301941,.668527007102966],[.577238023281097,.673889994621277],[.554691970348358,.580065965652466],[.611896991729736,.693961024284363],[.59696102142334,.706539988517761],[.596370995044708,.693953037261963],[.539958000183105,.557139039039612],[.568841993808746,.692366003990173],[.547818005084991,.692366003990173],[.52461302280426,.692366003990173],[.534089982509613,.779141008853912],[.527670979499817,.736225962638855],[.526912987232208,.717857003211975],[.526877999305725,.704625964164734],[.526966989040375,.695277988910675],[.572058022022247,.695277988910675],[.573521018028259,.703539967536926],[.57683801651001,.711845993995667],[.581691026687622,.720062971115112],[.609944999217987,.639909982681274],[.986046016216278,.560034036636353],[.5867999792099,.69539999961853],[.590372025966644,.701822996139526],[.531915009021759,.601536989212036],[.577268004417419,.585934996604919],[.536915004253387,.593786001205444],[.627542972564697,.473352015018463],[.665585994720459,.495950996875763],[.588353991508484,.546862006187439],[.757824003696442,.14767599105835],[.709249973297119,.201507985591888],[.672684013843536,.256581008434296],[.600408971309662,.74900496006012],[.55826598405838,.261672019958496],[.570303976535797,.187870979309082],[.588165998458862,.109044015407562],[.711045026779175,.398952007293701],[.781069993972778,.435405015945435],[.587247014045715,.398931980133057],[.742869973182678,.355445981025696],[.572156012058258,.437651991844177],[.55186802148819,.536570012569427],[.821442008018494,.457556009292603],[.752701997756958,.457181990146637],[.71375697851181,.467626988887787],[.66711300611496,.460672974586487],[.631101012229919,.447153985500336],[.6008620262146,.432473003864288],[.523481011390686,.405627012252808],[.810747981071472,.523926019668579],[.771045982837677,.348959028720856],[.509127020835876,.562718033790588],[.595292985439301,.485023975372314],[.980530977249146,.401564002037048],[.573499977588654,.420000016689301],[.602994978427887,.548687994480133],[.733529984951019,.376977026462555],[.560611009597778,.519016981124878],[.967685997486115,.644356966018677],[.580985009670258,.387160003185272],[.537728011608124,.505385041236877],[.760966002941132,.779752969741821],[.801778972148895,.831938028335571],[.892440974712372,.54076099395752],[.816350996494293,.740260004997253],[.865594983100891,.333687007427216],[.614073991775513,.883246004581451],[.508952975273132,.579437971115112],[.617941975593567,.508316040039062],[.825608015060425,.397674977779388],[.681214988231659,.39623498916626],[.656635999679565,.400596976280212],[.603900015354156,.710216999053955],[.81208598613739,.588539004325867],[.56801301240921,.944564998149872],[.681007981300354,.898285031318665],[.733752012252808,.869701027870178],[.633830010890961,.398822009563446],[.606792986392975,.39553701877594],[.589659988880157,.391062021255493],[.805015981197357,.342108011245728],[.611334979534149,.362284004688263],[.634037971496582,.355970978736877],[.656635999679565,.355356991291046],[.681214988231659,.35834002494812],[.698584973812103,.363156020641327],[.941866993904114,.319076001644135],[.698584973812103,.387449026107788],[.584177017211914,.624107003211975],[.554318010807037,.566076993942261],[.534153997898102,.62064003944397],[.711217999458313,.819975018501282],[.664629995822906,.852871000766754],[.559099972248077,.902631998062134],[.871706008911133,.791940987110138],[.591234028339386,.373893976211548],[.544341027736664,.451583981513977],[.624562978744507,.924192011356354],[.88577002286911,.615028977394104],[.551338016986847,.695277988910675],[.551980018615723,.704632043838501],[.552887976169586,.715808033943176],[.555167973041534,.730794012546539],[.569944024085999,.767035007476807],[.593203008174896,.685675978660583],[.599261999130249,.681069016456604],[.607599973678589,.677703022956848],[.631937980651855,.663500010967255],[.752032995223999,.601315021514893],[.547226011753082,.420395016670227],[.563543975353241,.359827995300293],[.583841025829315,.368713974952698],[.586614012718201,.692366003990173],[.771915018558502,.683578014373779],[.531597018241882,.352482974529266],[.588370978832245,.804440975189209],[.52079701423645,.442565023899078],[.567984998226166,.493479013442993],[.543282985687256,.819254994392395],[.655317008495331,.745514988899231],[.621008992195129,.574018001556396],[.625559985637665,.78031200170517],[.680198013782501,.570719003677368],[.64276397228241,.604337990283966],[.704662978649139,.621529996395111],[.552012026309967,.862591981887817],[.589071989059448,.508637011051178],[.685944974422455,.775357007980347],[.645735025405884,.812640011310577],[.675342977046967,.703978002071381],[.810858011245728,.646304965019226],[.72012197971344,.714666962623596],[.866151988506317,.682704985141754],[.663187026977539,.644596993923187],[.570082008838654,.466325998306274],[.544561982154846,.548375964164734],[.562758982181549,.558784961700439],[.531987011432648,.530140042304993],[.585271000862122,.335177004337311],[.622952997684479,.32277899980545],[.655896008014679,.320163011550903],[.687132000923157,.322345972061157],[.716481983661652,.333200991153717],[.758756995201111,.382786989212036],[.897013008594513,.468769013881683],[.732392013072968,.424547016620636],[.70211398601532,.433162987232208],[.66652500629425,.433866024017334],[.633504986763,.426087975502014],[.603875994682312,.416586995124817],[.579657971858978,.409945011138916],[.992439985275269,.480777025222778],[.567192018032074,.569419980049133],[.54136598110199,.478899002075195],[.526564002037048,.546118021011353],[.523913025856018,.563830018043518],[.531529009342194,.555056989192963],[.566035985946655,.582329034805298],[.51631098985672,.563053965568542],[.5174720287323,.577877044677734],[.573594987392426,.389806985855103],[.560697972774506,.395331978797913],[.549755990505219,.399751007556915],[.710287988185883,.368252992630005],[.723330020904541,.363372981548309]],nm="https://tfhub.dev/mediapipe/tfjs-model/facemesh/1/default/1",Jg=192,fl=192;async function hp({maxContinuousChecks:F=5,detectionConfidence:E=.9,maxFaces:k=10,iouThreshold:w=.3,scoreThreshold:_=.75}={}){const[L,Y]=await Promise.all([async function(ce,ve,De){return async function({maxFaces:Ce=10,inputWidth:Xe=128,inputHeight:nt=128,iouThreshold:Et=.3,scoreThreshold:At=.75}={}){const rn=await Object(jt.loadGraphModel)(Xg,{fromTFHub:!0});return new rd(rn,Xe,nt,Ce,Et,At)}({maxFaces:ce,iouThreshold:ve,scoreThreshold:De})}(k,w,_),async function(){return Object(jt.loadGraphModel)(nm,{fromTFHub:!0})}()]);return new dp(L,Y,F,E,k)}function eh(F,E){if(F.mesh instanceof Ye.Tensor){const[k,w,_,L]=Object(Ye.tidy)(()=>{const Y=Object(Ye.tensor1d)([E-1,0,0]),ce=Object(Ye.tensor1d)([1,-1,1]);return Object(Ye.tidy)(()=>[Object(Ye.concat)([Object(Ye.sub)(E-1,F.boundingBox.topLeft.slice(0,1)),F.boundingBox.topLeft.slice(1,1)]),Object(Ye.concat)([Object(Ye.sub)(E-1,F.boundingBox.bottomRight.slice(0,1)),F.boundingBox.bottomRight.slice(1,1)]),Object(Ye.sub)(Y,F.mesh).mul(ce),Object(Ye.sub)(Y,F.scaledMesh).mul(ce)])});return Object.assign({},F,{boundingBox:{topLeft:k,bottomRight:w},mesh:_,scaledMesh:L})}return Object.assign({},F,{boundingBox:{topLeft:[E-1-F.boundingBox.topLeft[0],F.boundingBox.topLeft[1]],bottomRight:[E-1-F.boundingBox.bottomRight[0],F.boundingBox.bottomRight[1]]},mesh:F.mesh.map(k=>{const w=k.slice(0);return w[0]=E-1-k[0],w}),scaledMesh:F.scaledMesh.map(k=>{const w=k.slice(0);return w[0]=E-1-k[0],w})})}class dp{constructor(E,k,w,_,L){this.pipeline=new $m(E,k,Jg,fl,w,L),this.detectionConfidence=_}static getAnnotations(){return Zp}static getUVCoords(){return Ic}async estimateFaces(E,k=!1,w=!1){const[,_]=function(ve){return ve instanceof Ye.Tensor?[ve.shape[0],ve.shape[1]]:[ve.height,ve.width]}(E),L=Object(Ye.tidy)(()=>(E instanceof Ye.Tensor||(E=Ye.browser.fromPixels(E)),E.toFloat().expandDims(0))),Y=Object(Ye.env)().get("WEBGL_PACK_DEPTHWISECONV");Object(Ye.env)().set("WEBGL_PACK_DEPTHWISECONV",!0);const ce=await this.pipeline.predict(L);return Object(Ye.env)().set("WEBGL_PACK_DEPTHWISECONV",Y),L.dispose(),ce!=null&&ce.length>0?Promise.all(ce.map(async(ve,De)=>{const{coords:Ce,scaledCoords:Xe,box:nt,flag:Et}=ve;let At=[Et];k||(At=At.concat([Ce,Xe,nt.startPoint,nt.endPoint]));const rn=await Promise.all(At.map(async yr=>yr.array())),un=rn[0];if(Et.dispose(),un<this.detectionConfidence&&this.pipeline.clearRegionOfInterest(De),k){const yr={faceInViewConfidence:un,mesh:Ce,scaledMesh:Xe,boundingBox:{topLeft:nt.startPoint.squeeze(),bottomRight:nt.endPoint.squeeze()}};return w?eh(yr,_):yr}const[kn,En,_n,Pn]=rn.slice(1);Xe.dispose(),Ce.dispose();let dn={faceInViewConfidence:un,boundingBox:{topLeft:_n,bottomRight:Pn},mesh:kn,scaledMesh:En};w&&(dn=eh(dn,_));const cr={};for(const yr in Zp)cr[yr]=Zp[yr].map(br=>dn.scaledMesh[br]);return dn.annotations=cr,dn})):[]}}function rs(F){var E=function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}();return function(){var k,w=as()(F);if(E){var _=as()(this).constructor;k=Reflect.construct(w,arguments,_)}else k=w.apply(this,arguments);return xc()(this,k)}}var rm=function(F){bc()(k,F);var E=rs(k);function k(w,_,L){var Y;return pe()(this,k),(Y=E.call(this)).video=w,Y.model=null,Y.modelReady=!1,Y.config=_,Y.ready=ot(Y.loadModel(),L),Y}return Te()(k,[{key:"loadModel",value:function(){var w=K()(we.a.mark(function _(){var L=this;return we.a.wrap(function(Y){for(;;)switch(Y.prev=Y.next){case 0:return Y.next=2,hp(this.config);case 2:if(this.model=Y.sent,this.modelReady=!0,!this.video||this.video.readyState!==0){Y.next=7;break}return Y.next=7,new Promise(function(ce){L.video.onloadeddata=function(){ce()}});case 7:return this.video&&this.predict(),Y.abrupt("return",this);case 9:case"end":return Y.stop()}},_,this)}));return function(){return w.apply(this,arguments)}}()},{key:"predict",value:function(){var w=K()(we.a.mark(function _(L,Y){var ce,ve,De,Ce,Xe=this;return we.a.wrap(function(nt){for(;;)switch(nt.prev=nt.next){case 0:if(ce=this.getInput(L)){nt.next=3;break}throw new Error("No input image found.");case 3:return ve=this.config.flipHorizontal,nt.next=6,this.model.estimateFaces(ce,ve);case 6:if(De=nt.sent,Ce=De,this.emit("predict",Ce),this.emit("face",Ce),!this.video){nt.next=12;break}return nt.abrupt("return",I.nextFrame().then(function(){return Xe.predict()}));case 12:return typeof Y=="function"&&Y(Ce),nt.abrupt("return",Ce);case 14:case"end":return nt.stop()}},_,this)}));return function(_,L){return w.apply(this,arguments)}}()},{key:"getInput",value:function(w){return w instanceof HTMLImageElement||w instanceof HTMLVideoElement||w instanceof HTMLCanvasElement||w instanceof ImageData?w:ke()(w)==="object"&&(w.elt instanceof HTMLImageElement||w.elt instanceof HTMLVideoElement||w.elt instanceof ImageData)?w.elt:ke()(w)==="object"&&w.canvas instanceof HTMLCanvasElement?w.canvas:this.video}}]),k}(Nd.EventEmitter),Gm=function(F,E,k){var w,_={},L=k;F instanceof HTMLVideoElement?w=F:ke()(F)==="object"&&F.elt instanceof HTMLVideoElement?w=F.elt:ke()(F)==="object"?_=F:typeof F=="function"&&(L=F),ke()(E)==="object"?_=E:typeof E=="function"&&(L=E);var Y=new rm(w,_,L);return L?Y:Y.ready};/**
    * @license
    * Copyright 2020 Google LLC. All Rights Reserved.
    * Licensed under the Apache License, Version 2.0 (the "License");
    * you may not use this file except in compliance with the License.
    * You may obtain a copy of the License at
    *
    * http://www.apache.org/licenses/LICENSE-2.0
    *
    * Unless required by applicable law or agreed to in writing, software
    * distributed under the License is distributed on an "AS IS" BASIS,
    * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    * See the License for the specific language governing permissions and
    * limitations under the License.
    * =============================================================================
    */function pp(F){return[Math.abs(F.endPoint[0]-F.startPoint[0]),Math.abs(F.endPoint[1]-F.startPoint[1])]}function mp(F){return[F.startPoint[0]+(F.endPoint[0]-F.startPoint[0])/2,F.startPoint[1]+(F.endPoint[1]-F.startPoint[1])/2]}function Km(F,E=1.5){const k=mp(F),w=pp(F),_=[E*w[0]/2,E*w[1]/2];return{startPoint:[k[0]-_[0],k[1]-_[1]],endPoint:[k[0]+_[0],k[1]+_[1]],palmLandmarks:F.palmLandmarks}}function Qg(F){const E=mp(F),k=pp(F),w=Math.max(...k)/2;return{startPoint:[E[0]-w,E[1]-w],endPoint:[E[0]+w,E[1]+w],palmLandmarks:F.palmLandmarks}}function P0(F,E){const k=[F.endPoint[0]-F.startPoint[0],F.endPoint[1]-F.startPoint[1]],w=[k[0]*E[0],k[1]*E[1]];return{startPoint:[F.startPoint[0]+w[0],F.startPoint[1]+w[1]],endPoint:[F.endPoint[0]+w[0],F.endPoint[1]+w[1]],palmLandmarks:F.palmLandmarks}}class Rc{constructor(E,k,w,_,L,Y){this.model=E,this.width=k,this.height=w,this.iouThreshold=L,this.scoreThreshold=Y,this.anchors=_.map(ce=>[ce.x_center,ce.y_center]),this.anchorsTensor=Object(Ye.tensor2d)(this.anchors),this.inputSizeTensor=Object(Ye.tensor1d)([k,w]),this.doubleInputSizeTensor=Object(Ye.tensor1d)([2*k,2*w])}normalizeBoxes(E){return Object(Ye.tidy)(()=>{const k=Object(Ye.slice)(E,[0,0],[-1,2]),w=Object(Ye.slice)(E,[0,2],[-1,2]),_=Object(Ye.add)(Object(Ye.div)(k,this.inputSizeTensor),this.anchorsTensor),L=Object(Ye.div)(w,this.doubleInputSizeTensor),Y=Object(Ye.mul)(Object(Ye.sub)(_,L),this.inputSizeTensor),ce=Object(Ye.mul)(Object(Ye.add)(_,L),this.inputSizeTensor);return Object(Ye.concat2d)([Y,ce],1)})}normalizeLandmarks(E,k){return Object(Ye.tidy)(()=>{const w=Object(Ye.add)(Object(Ye.div)(E.reshape([-1,7,2]),this.inputSizeTensor),this.anchors[k]);return Object(Ye.mul)(w,this.inputSizeTensor)})}getBoundingBoxes(E){return Object(Ye.tidy)(()=>{const k=Object(Ye.mul)(Object(Ye.sub)(E,.5),2),w=Object(Ye.env)().get("WEBGL_PACK_DEPTHWISECONV");Object(Ye.env)().set("WEBGL_PACK_DEPTHWISECONV",!0);const _=this.model.predict(k).squeeze();Object(Ye.env)().set("WEBGL_PACK_DEPTHWISECONV",w);const L=Object(Ye.sigmoid)(Object(Ye.slice)(_,[0,0],[-1,1])).squeeze(),Y=Object(Ye.slice)(_,[0,1],[-1,4]),ce=this.normalizeBoxes(Y),ve=console.warn;console.warn=()=>{};const De=Ye.image.nonMaxSuppression(ce,L,1,this.iouThreshold,this.scoreThreshold).arraySync();if(console.warn=ve,De.length===0)return null;const Ce=De[0],Xe=Object(Ye.slice)(ce,[Ce,0],[1,-1]),nt=Object(Ye.slice)(_,[Ce,5],[1,14]);return{boxes:Xe,palmLandmarks:this.normalizeLandmarks(nt,Ce).reshape([-1,2])}})}estimateHandBounds(E){const k=E.shape[1],w=E.shape[2],_=Object(Ye.tidy)(()=>E.resizeBilinear([this.width,this.height]).div(255)),L=this.getBoundingBoxes(_);if(L===null)return _.dispose(),null;const Y=L.boxes.arraySync(),ce=Y[0].slice(0,2),ve=Y[0].slice(2,4),De=L.palmLandmarks.arraySync();return _.dispose(),L.boxes.dispose(),L.palmLandmarks.dispose(),function(Ce,Xe){return{startPoint:[Ce.startPoint[0]*Xe[0],Ce.startPoint[1]*Xe[1]],endPoint:[Ce.endPoint[0]*Xe[0],Ce.endPoint[1]*Xe[1]],palmLandmarks:Ce.palmLandmarks.map(nt=>[nt[0]*Xe[0],nt[1]*Xe[1]])}}({startPoint:ce,endPoint:ve,palmLandmarks:De},[w/this.width,k/this.height])}}const th={thumb:[1,2,3,4],indexFinger:[5,6,7,8],middleFinger:[9,10,11,12],ringFinger:[13,14,15,16],pinky:[17,18,19,20],palmBase:[0]};function L0(F,E){return function(k){return k-2*Math.PI*Math.floor((k+Math.PI)/(2*Math.PI))}(Math.PI/2-Math.atan2(-(E[1]-F[1]),E[0]-F[0]))}const Zg=(F,E)=>[[1,0,F],[0,1,E],[0,0,1]];function Mc(F,E){let k=0;for(let w=0;w<F.length;w++)k+=F[w]*E[w];return k}function Ka(F,E){const k=[];for(let w=0;w<F.length;w++)k.push(F[w][E]);return k}function id(F,E){const k=[],w=F.length;for(let _=0;_<w;_++){k.push([]);for(let L=0;L<w;L++)k[_].push(Mc(F[_],Ka(E,L)))}return k}function gp(F,E){const k=Math.cos(F),w=Math.sin(F),_=[[k,-w,0],[w,k,0],[0,0,1]];return id(id(Zg(E[0],E[1]),_),Zg(-E[0],-E[1]))}function im(F,E){return[Mc(F,E[0]),Mc(F,E[1])]}const e0=.8,om=[0,-.4],Zl=3,Ev=[0,-.1],am=1.65,Wa=[0,5,9,13,17,1,2],vp=0,nh=2;class sm{constructor(E,k,w,_,L,Y){this.regionsOfInterest=[],this.runsWithoutHandDetector=0,this.boundingBoxDetector=E,this.meshDetector=k,this.maxContinuousChecks=L,this.detectionConfidence=Y,this.meshWidth=w,this.meshHeight=_,this.maxHandsNumber=1}getBoxForPalmLandmarks(E,k){const w=E.map(_=>im([..._,1],k));return Km(Qg(P0(this.calculateLandmarksBoundingBox(w),om)),Zl)}getBoxForHandLandmarks(E){const k=Km(Qg(P0(this.calculateLandmarksBoundingBox(E),Ev)),am),w=[];for(let _=0;_<Wa.length;_++)w.push(E[Wa[_]].slice(0,2));return k.palmLandmarks=w,k}transformRawCoords(E,k,w,_){const L=pp(k),Y=[L[0]/this.meshWidth,L[1]/this.meshHeight],ce=E.map(Et=>[Y[0]*(Et[0]-this.meshWidth/2),Y[1]*(Et[1]-this.meshHeight/2),Et[2]]),ve=gp(w,[0,0]),De=ce.map(Et=>[...im(Et,ve),Et[2]]),Ce=function(Et){const At=[[Et[0][0],Et[1][0]],[Et[0][1],Et[1][1]]],rn=[Et[0][2],Et[1][2]],un=[-Mc(At[0],rn),-Mc(At[1],rn)];return[At[0].concat(un[0]),At[1].concat(un[1]),[0,0,1]]}(_),Xe=[...mp(k),1],nt=[Mc(Xe,Ce[0]),Mc(Xe,Ce[1])];return De.map(Et=>[Et[0]+nt[0],Et[1]+nt[1],Et[2]])}async estimateHand(E){const k=this.shouldUpdateRegionsOfInterest();if(k===!0){const dn=this.boundingBoxDetector.estimateHandBounds(E);if(dn===null)return E.dispose(),this.regionsOfInterest=[],null;this.updateRegionsOfInterest(dn,!0),this.runsWithoutHandDetector=0}else this.runsWithoutHandDetector++;const w=this.regionsOfInterest[0],_=L0(w.palmLandmarks[vp],w.palmLandmarks[nh]),L=mp(w),Y=[L[0]/E.shape[2],L[1]/E.shape[1]];let ce;const ve=Object(Ye.getBackend)();if(ve==="webgl")ce=function(dn,cr,yr,br){const Br=dn.shape,Or=Br[1],hi=Br[2],ki=Math.sin(cr),xi=Math.cos(cr),xo=Math.floor(hi*(typeof br=="number"?br:br[0])),Wo=Math.floor(Or*(typeof br=="number"?br:br[1])),To={variableNames:["Image"],outputShape:Br,userCode:`
      void main() {
        ivec4 coords = getOutputCoords();
        int x = coords[2];
        int y = coords[1];
        int coordX = int(float(x - ${xo}) * ${xi} -
          float(y - ${Wo}) * ${ki});
        int coordY = int(float(x - ${xo}) * ${ki} +
          float(y - ${Wo}) * ${xi});
        coordX = int(coordX + ${xo});
        coordY = int(coordY + ${Wo});

        ${typeof yr=="number"?`float outputValue = ${yr.toFixed(2)};`:`
      vec3 fill = vec3(${yr.join(",")});
      float outputValue = fill[coords[3]];`}

        if(coordX > 0 && coordX < ${hi} && coordY > 0 && coordY < ${Or}) {
          outputValue = getImage(coords[0], coordY, coordX, coords[3]);
        }

      setOutput(outputValue);
    }`};return Object(Ye.backend)().compileAndRun(To,[dn])}(E,_,0,Y);else{if(ve!=="cpu")throw new Error(`Handpose is not yet supported by the ${ve} backend - rotation kernel is not defined.`);ce=function(dn,cr,yr,br){const Br=Object(Ye.backend)(),Or=Object(Ye.buffer)(dn.shape,dn.dtype),[hi,ki,xi,xo]=dn.shape,Wo=xi*(typeof br=="number"?br:br[0]),To=ki*(typeof br=="number"?br:br[1]),Do=Math.sin(-cr),Mo=Math.cos(-cr),ea=Br.readSync(dn.dataId);for(let sa=0;sa<hi;sa++)for(let ka=0;ka<ki;ka++)for(let Ys=0;Ys<xi;Ys++)for(let Ci=0;Ci<xo;Ci++){const Va=[hi,ka,Ys,Ci],Xa=Va[2],Js=Va[1];let _s=(Xa-Wo)*Mo-(Js-To)*Do,hu=(Xa-Wo)*Do+(Js-To)*Mo;_s=Math.round(_s+Wo),hu=Math.round(hu+To);let du=yr;typeof yr!="number"&&(du=Ci===3?255:yr[Ci]),_s>=0&&_s<xi&&hu>=0&&hu<ki&&(du=ea[sa*xi*ki*xo+hu*(xi*xo)+_s*xo+Ci]);const pu=sa*xi*ki*xo+ka*(xi*xo)+Ys*xo+Ci;Or.values[pu]=du}return Or.toTensor()}(E,_,0,Y)}const De=gp(-_,L);let Ce;const Xe=function(dn,cr,yr){const br=cr.shape[1],Br=cr.shape[2],Or=[[dn.startPoint[1]/br,dn.startPoint[0]/Br,dn.endPoint[1]/br,dn.endPoint[0]/Br]];return Ye.image.cropAndResize(cr,Or,[0],yr)}(Ce=k===!0?this.getBoxForPalmLandmarks(w.palmLandmarks,De):w,ce,[this.meshWidth,this.meshHeight]),nt=Xe.div(255);Xe.dispose(),ce.dispose();const Et=Object(Ye.env)().get("WEBGL_PACK_DEPTHWISECONV");Object(Ye.env)().set("WEBGL_PACK_DEPTHWISECONV",!0);const[At,rn]=this.meshDetector.predict(nt);Object(Ye.env)().set("WEBGL_PACK_DEPTHWISECONV",Et),nt.dispose();const un=At.dataSync()[0];if(At.dispose(),un<this.detectionConfidence)return rn.dispose(),this.regionsOfInterest=[],null;const kn=Object(Ye.reshape)(rn,[-1,3]),En=kn.arraySync();rn.dispose(),kn.dispose();const _n=this.transformRawCoords(En,Ce,_,De),Pn=this.getBoxForHandLandmarks(_n);return this.updateRegionsOfInterest(Pn,!1),{landmarks:_n,handInViewConfidence:un,boundingBox:{topLeft:Pn.startPoint,bottomRight:Pn.endPoint}}}calculateLandmarksBoundingBox(E){const k=E.map(_=>_[0]),w=E.map(_=>_[1]);return{startPoint:[Math.min(...k),Math.min(...w)],endPoint:[Math.max(...k),Math.max(...w)]}}updateRegionsOfInterest(E,k){if(k)this.regionsOfInterest=[E];else{const w=this.regionsOfInterest[0];let _=0;if(w!=null&&w.startPoint!=null){const[L,Y]=E.startPoint,[ce,ve]=E.endPoint,[De,Ce]=w.startPoint,[Xe,nt]=w.endPoint,Et=Math.max(L,De),At=Math.max(Y,Ce),rn=(Math.min(ce,Xe)-Et)*(Math.min(ve,nt)-At);_=rn/((ce-L)*(ve-Y)+(Xe-De)*(nt-Y)-rn)}this.regionsOfInterest[0]=_>e0?w:E}}shouldUpdateRegionsOfInterest(){return this.regionsOfInterest.length!==this.maxHandsNumber||this.runsWithoutHandDetector>=this.maxContinuousChecks}}const yp=256,Xm=256;async function Ym({maxContinuousChecks:F=1/0,detectionConfidence:E=.8,iouThreshold:k=.3,scoreThreshold:w=.5}={}){const[_,L,Y]=await Promise.all([async function(){return Ye.util.fetch("https://tfhub.dev/mediapipe/tfjs-model/handskeleton/1/default/1/anchors.json?tfjs-format=file").then(De=>De.json())}(),async function(){return Object(jt.loadGraphModel)("https://tfhub.dev/mediapipe/tfjs-model/handdetector/1/default/1",{fromTFHub:!0})}(),async function(){return Object(jt.loadGraphModel)("https://tfhub.dev/mediapipe/tfjs-model/handskeleton/1/default/1",{fromTFHub:!0})}()]),ce=new Rc(L,yp,Xm,_,k,w),ve=new sm(ce,Y,yp,Xm,F,E);return new ef(ve)}class ef{constructor(E){this.pipeline=E}static getAnnotations(){return th}async estimateHands(E,k=!1){const[,w]=function(ve){return ve instanceof Ye.Tensor?[ve.shape[0],ve.shape[1]]:[ve.height,ve.width]}(E),_=Object(Ye.tidy)(()=>(E instanceof Ye.Tensor||(E=Ye.browser.fromPixels(E)),E.toFloat().expandDims(0))),L=await this.pipeline.estimateHand(_);if(_.dispose(),L===null)return[];let Y=L;k===!0&&(Y=function(ve,De){const{handInViewConfidence:Ce,landmarks:Xe,boundingBox:nt}=ve;return{handInViewConfidence:Ce,landmarks:Xe.map(Et=>[De-1-Et[0],Et[1],Et[2]]),boundingBox:{topLeft:[De-1-nt.topLeft[0],nt.topLeft[1]],bottomRight:[De-1-nt.bottomRight[0],nt.bottomRight[1]]}}}(L,w));const ce={};for(const ve of Object.keys(th))ce[ve]=th[ve].map(De=>Y.landmarks[De]);return[{handInViewConfidence:Y.handInViewConfidence,boundingBox:Y.boundingBox,landmarks:Y.landmarks,annotations:ce}]}}function $u(F){var E=function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}();return function(){var k,w=as()(F);if(E){var _=as()(this).constructor;k=Reflect.construct(w,arguments,_)}else k=w.apply(this,arguments);return xc()(this,k)}}var t0=function(F){bc()(k,F);var E=$u(k);function k(w,_,L){var Y;return pe()(this,k),(Y=E.call(this)).video=w,Y.model=null,Y.modelReady=!1,Y.config=_,Y.ready=ot(Y.loadModel(),L),Y}return Te()(k,[{key:"loadModel",value:function(){var w=K()(we.a.mark(function _(){var L=this;return we.a.wrap(function(Y){for(;;)switch(Y.prev=Y.next){case 0:return Y.next=2,Ym(this.config);case 2:if(this.model=Y.sent,this.modelReady=!0,!this.video||this.video.readyState!==0){Y.next=7;break}return Y.next=7,new Promise(function(ce){L.video.onloadeddata=function(){ce()}});case 7:return this.video&&this.predict(),Y.abrupt("return",this);case 9:case"end":return Y.stop()}},_,this)}));return function(){return w.apply(this,arguments)}}()},{key:"predict",value:function(){var w=K()(we.a.mark(function _(L,Y){var ce,ve,De,Ce,Xe=this;return we.a.wrap(function(nt){for(;;)switch(nt.prev=nt.next){case 0:if(ce=this.getInput(L)){nt.next=3;break}throw new Error("No input image found.");case 3:return ve=this.config.flipHorizontal,nt.next=6,this.model.estimateHands(ce,ve);case 6:if(De=nt.sent,Ce=De,this.emit("predict",Ce),this.emit("hand",Ce),!this.video){nt.next=12;break}return nt.abrupt("return",I.nextFrame().then(function(){return Xe.predict()}));case 12:return typeof Y=="function"&&Y(Ce),nt.abrupt("return",Ce);case 14:case"end":return nt.stop()}},_,this)}));return function(_,L){return w.apply(this,arguments)}}()},{key:"getInput",value:function(w){return w instanceof HTMLImageElement||w instanceof HTMLVideoElement||w instanceof HTMLCanvasElement||w instanceof ImageData?w:ke()(w)==="object"&&(w.elt instanceof HTMLImageElement||w.elt instanceof HTMLVideoElement||w.elt instanceof ImageData)?w.elt:ke()(w)==="object"&&w.canvas instanceof HTMLCanvasElement?w.canvas:this.video}}]),k}(Nd.EventEmitter),n0=function(F,E,k){var w,_={},L=k;F instanceof HTMLVideoElement?w=F:ke()(F)==="object"&&F.elt instanceof HTMLVideoElement?w=F.elt:ke()(F)==="object"?_=F:typeof F=="function"&&(L=F),ke()(E)==="object"?_=E:typeof E=="function"&&(L=E);var Y=new t0(w,_,L);return L?Y:Y.ready},od=function(){console.log(`

 Thank you for using ml5.js v`.concat(Bh.a,` 

Please read our community statement to ensure 
that the use of this software reflects the values 
of the ml5.js community:
 https://ml5js.org/about

Reporting: 
 https://github.com/ml5js/ml5-library/issues
 Email: info@ml5js.org 
`))},bp=function(){var F=K()(we.a.mark(function E(){var k;return we.a.wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return(k=new Image).crossOrigin="",k.src="https://cdn.jsdelivr.net/gh/ml5js/ml5-library@main/assets/bird.jpg",w.next=5,new Promise(function(_){k.onload=_});case 5:return w.abrupt("return",k);case 6:case"end":return w.stop()}},E)}));return function(){return F.apply(this,arguments)}}(),z0=function(){var F=K()(we.a.mark(function E(){var k,w,_;return we.a.wrap(function(L){for(;;)switch(L.prev=L.next){case 0:for(k=new Uint8ClampedArray(2e4),w=0;w<k.length;w+=4)k[w+0]=0,k[w+1]=190,k[w+2]=0,k[w+3]=255;return _=new ImageData(k,200),L.abrupt("return",_);case 4:case"end":return L.stop()}},E)}));return function(){return F.apply(this,arguments)}}();function Jm(F,E){var k=Object.keys(F);if(Object.getOwnPropertySymbols){var w=Object.getOwnPropertySymbols(F);E&&(w=w.filter(function(_){return Object.getOwnPropertyDescriptor(F,_).enumerable})),k.push.apply(k,w)}return k}function um(F){for(var E=1;E<arguments.length;E++){var k=arguments[E]!=null?arguments[E]:{};E%2?Jm(Object(k),!0).forEach(function(w){ee()(F,w,k[w])}):Object.getOwnPropertyDescriptors?Object.defineProperties(F,Object.getOwnPropertyDescriptors(k)):Jm(Object(k)).forEach(function(w){Object.defineProperty(F,w,Object.getOwnPropertyDescriptor(k,w))})}return F}var Ir={charRNN:zd,CVAE:Wd,cartoon:qg,DCGAN:_l,featureExtractor:qi,imageClassifier:ti,kmeans:Lg,dbscan:Vg,soundClassifier:ui,pitchDetection:Ut,pix2pix:zu,poseNet:oc,sketchRNN:Mh,styleTransfer:Al,word2vec:ec,YOLO:Cl,CocoSsd:bf,objectDetector:Ah,uNet:Gc,sentiment:Tl,bodyPix:qd,faceApi:jg,universalSentenceEncoder:pc,facemesh:Gm,handpose:n0};od(),A.default=Object.assign({p5Utils:Nr},function(F){if(typeof window>"u"||window.p5===void 0||window.p5.prototype===void 0||window.p5.prototype.registerPreloadMethod===void 0)return F;var E=F;return Object.keys(F).forEach(function(k){var w=F[k];E[k]=function(){for(var _=null,L=arguments.length,Y=new Array(L),ce=0;ce<L;ce++)Y[ce]=arguments[ce];var ve=Y.length;return typeof Y[ve-1]=="function"&&(_=Y[ve-1],ve-=1),w.apply(F,[].concat(Lo()(Y.slice(0,ve)),[function(){try{_&&_()}catch(De){console.error(De)}return window._decrementPreload?window._decrementPreload():null}]))},window.p5.prototype.registerPreloadMethod("".concat(k),F)}),F}(Ir),um(um({KNNClassifier:Vi,communityStatement:od},B),{},{tf:I,tfvis:se,version:Bh.a,neuralNetwork:Kd,testingUtils:q}))},function(Oe,A){},function(Oe,A){},function(Oe,A){},function(Oe,A){Oe.exports=function(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)},Oe.exports.__esModule=!0,Oe.exports.default=Oe.exports},function(Oe,A){Oe.exports=function(a){if(typeof Symbol<"u"&&a[Symbol.iterator]!=null||a["@@iterator"]!=null)return Array.from(a)},Oe.exports.__esModule=!0,Oe.exports.default=Oe.exports},function(Oe,A,a){var b=a(186);Oe.exports=function($){if(Array.isArray($))return b($)},Oe.exports.__esModule=!0,Oe.exports.default=Oe.exports},function(Oe,A,a){function b(W){return new Uint8Array(atob(W).split("").map(function(q){return q.charCodeAt(0)}))}Object.defineProperty(A,"__esModule",{value:!0}),A.stringToUint8array=b,A.stringToArray=function(W){var q=b(W);return new Int16Array(q.buffer)};var $=!1,U=0;function B(){if($)return $=!1,U;var W=2*Math.random()-1,q=2*Math.random()-1,P=W*W+q*q;if(P===0||P>1)return B();var ee=Math.sqrt(-2*Math.log(P)/P);return U=q*ee,$=!0,W*ee}function re(W,q){return Math.random()*(q-W)+W}function J(W,q){return W+B()*q}function R(W,q){q===void 0&&(q=2);var P=q;function ee(Ut,Xt){return[Ut[0]-Xt[0],Ut[1]-Xt[1]]}function I(Ut,Xt){return Ut[0]*Xt[0]+Ut[1]*Xt[1]}function se(Ut){return Ut[0]*Ut[0]+Ut[1]*Ut[1]}function ie(Ut,Xt){return se(ee(Ut,Xt))}var K,de,pe,Ae,Te=W.length,je=[],we=P*P,ot=[],_t=[];for(ot[0]=W[0],K=de=1,Ae=0;K<Te;K++)ie(W[K],W[Ae])<we||(ot[de++]=W[K],Ae=K);for(Ae<Te-1&&(ot[de++]=W[Te-1]),_t[0]=_t[de-1]=1,function Ut(Xt,ke,Ft,Gt,jt){if(!(Gt<=Ft+1)){for(var Ye,ln,nn,Bt,Pt=Ft,gn=0,Dt=Xt*Xt,St=[ke[Ft],ke[Gt]],wn=ee(St[1],St[0]),Bn=se(wn),Hn=Ft+1;Hn<Gt;Hn++)(nn=I(ee(ke[Hn],St[0]),wn))<=0?Bt=ie(ke[Hn],St[0]):Bn<=nn?Bt=ie(ke[Hn],St[1]):(ln=nn/Bn,Ye=[St[0][0]+ln*wn[0],St[0][1]+ln*wn[1]],Bt=ie(ke[Hn],Ye)),Bt<=gn||(Pt=Hn,gn=Bt);gn>Dt&&(jt[Pt]=1,Ut(Xt,ke,Ft,Pt,jt),Ut(Xt,ke,Pt,Gt,jt))}}(P,ot,0,de-1,_t),K=pe=0;K<de;K++)_t[K]&&(je[pe++]=ot[K]);return je}A.gaussRandom=B,A.randf=re,A.randi=function(W,q){return Math.floor(Math.random()*(q-W)+W)},A.randn=J,A.birandn=function(W,q,P,ee,I){var se=J(0,1),ie=J(0,1);return[Math.sqrt(1-I*I)*P*se+I*P*ie+W,ee*ie+q]},A.sampleSoftmax=function(W){var q,P=re(0,1),ee=W.length,I=0;for(q=0;q<ee;q++)if((I+=W[q])>=P)return q;return console.log("error sampling pi index"),-1},A.simplifyLine=R,A.simplifyLines=function(W,q){var P=[],ee=2;q&&(ee=q);for(var I=0;I<W.length;I++)P.push(R(W[I],ee));return P},A.linesToStrokes=function(W){var q,P,ee,I,se,ie,K,de,pe,Ae,Te=0,je=0,we=[];for(K=0;K<W.length;K++)if((pe=W[K].length)>1)for(de=0;de<pe;de++)q=(Ae=W[K][de])[0],P=Ae[1],de===pe-1?(ie=1,se=0):(ie=0,se=1),ee=q-Te,I=P-je,Te=q,je=P,we.push([ee,I,se,ie,0]);return we.push([0,0,0,0,1]),we.slice(1)},A.lineToStroke=function(W,q){var P,ee,I,se,ie,K,de,pe,Ae,Te,je,we=[];if(Ae=q[0],Te=q[1],(I=W.length)>1)for(je=0;je<I;je++)de=(se=W[je])[0],pe=se[1],je===I-1?(ee=1,P=0):(ee=0,P=1),ie=de-Ae,K=pe-Te,Ae=de,Te=pe,we.push([ie,K,P,ee,0]);return we}},function(Oe,A,a){var b=this&&this.__awaiter||function(J,R,W,q){return new(W||(W=Promise))(function(P,ee){function I(K){try{ie(q.next(K))}catch(de){ee(de)}}function se(K){try{ie(q.throw(K))}catch(de){ee(de)}}function ie(K){K.done?P(K.value):new W(function(de){de(K.value)}).then(I,se)}ie((q=q.apply(J,R||[])).next())})},$=this&&this.__generator||function(J,R){var W,q,P,ee,I={label:0,sent:function(){if(1&P[0])throw P[1];return P[1]},trys:[],ops:[]};return ee={next:se(0),throw:se(1),return:se(2)},typeof Symbol=="function"&&(ee[Symbol.iterator]=function(){return this}),ee;function se(ie){return function(K){return function(de){if(W)throw new TypeError("Generator is already executing.");for(;I;)try{if(W=1,q&&(P=2&de[0]?q.return:de[0]?q.throw||((P=q.return)&&P.call(q),0):q.next)&&!(P=P.call(q,de[1])).done)return P;switch(q=0,P&&(de=[2&de[0],P.value]),de[0]){case 0:case 1:P=de;break;case 4:return I.label++,{value:de[1],done:!1};case 5:I.label++,q=de[1],de=[0];continue;case 7:de=I.ops.pop(),I.trys.pop();continue;default:if(!(P=(P=I.trys).length>0&&P[P.length-1])&&(de[0]===6||de[0]===2)){I=0;continue}if(de[0]===3&&(!P||de[1]>P[0]&&de[1]<P[3])){I.label=de[1];break}if(de[0]===6&&I.label<P[1]){I.label=P[1],P=de;break}if(P&&I.label<P[2]){I.label=P[2],I.ops.push(de);break}P[2]&&I.ops.pop(),I.trys.pop();continue}de=R.call(J,I)}catch(pe){de=[6,pe],q=0}finally{W=P=0}if(5&de[0])throw de[1];return{value:de[0]?de[1]:void 0,done:!0}}([ie,K])}}};Object.defineProperty(A,"__esModule",{value:!0});var U=a(0),B=a(255),re=function(){function J(R){this.NMIXTURE=20,this.checkpointURL=R,this.initialized=!1}return J.prototype.isInitialized=function(){return this.initialized},J.prototype.instantiateFromJSON=function(R,W,q){var P;this.forgetBias=U.scalar(1),this.info=R,this.setPixelFactor(2),this.weightDims=W,this.numUnits=this.weightDims[0][0],this.weights=[];for(var ee=0;ee<q.length;ee++){for(var I=(P=new Float32Array(B.stringToArray(q[ee]))).length,se=0;se<I;se++)P[se]=10*P[se]/32767;this.weights.push(P)}this.outputKernel=U.tensor2d(this.weights[0],[this.weightDims[0][0],this.weightDims[0][1]]),this.outputBias=U.tensor1d(this.weights[1]);var ie=U.tensor2d(this.weights[2],[this.weightDims[2][0],this.weightDims[2][1]]),K=U.tensor2d(this.weights[3],[this.weightDims[3][0],this.weightDims[3][1]]);this.lstmKernel=U.concat2d([ie,K],0),this.lstmBias=U.tensor1d(this.weights[4]),this.rawVars=[this.outputKernel,this.outputBias,this.lstmKernel,this.lstmBias]},J.prototype.initialize=function(){return b(this,void 0,void 0,function(){var R;return $(this,function(W){switch(W.label){case 0:return this.dispose(),[4,fetch(this.checkpointURL).then(function(q){return q.json()})];case 1:return R=W.sent(),this.instantiateFromJSON(R[0],R[1],R[2]),this.initialized=!0,console.log("Initialized SketchRNN."),[2]}})})},J.prototype.dispose=function(){if(this.rawVars){for(var R=0;R<this.rawVars.length;R++)this.rawVars[R].dispose();this.rawVars=void 0}this.forgetBias&&(this.forgetBias.dispose(),this.forgetBias=void 0),this.initialized=!1},J.prototype.setPixelFactor=function(R){this.pixelFactor=R,this.scaleFactor=this.info.scale_factor/this.pixelFactor},J.prototype.update=function(R,W){var q=this,P=U.tidy(function(){var ie=q.numUnits,K=q.scaleFactor,de=[R[0]/K,R[1]/K,R[2],R[3],R[4]],pe=U.tensor2d(de,[1,5]),Ae=U.tensor2d(W.c,[1,ie]),Te=U.tensor2d(W.h,[1,ie]),je=U.basicLSTMCell(q.forgetBias,q.lstmKernel,q.lstmBias,pe,Ae,Te);return U.concat(je,1)}),ee=P.dataSync();P.dispose();var I=ee.slice(0,this.numUnits),se=ee.slice(this.numUnits,2*this.numUnits);return{c:new Float32Array(I),h:new Float32Array(se)}},J.prototype.updateStrokes=function(R,W,q){var P=this,ee=U.tidy(function(){var K,de,pe,Ae,Te,je=P.numUnits,we=P.scaleFactor,ot=R.length;q&&(ot=q),pe=U.tensor2d(W.c,[1,je]),Ae=U.tensor2d(W.h,[1,je]);for(var _t=0;_t<ot;_t++)K=[R[_t][0]/we,R[_t][1]/we,R[_t][2],R[_t][3],R[_t][4]],de=U.tensor2d(K,[1,5]),pe=(Te=U.basicLSTMCell(P.forgetBias,P.lstmKernel,P.lstmBias,de,pe,Ae))[0],Ae=Te[1];return U.concat(Te,1)}),I=ee.dataSync();ee.dispose();var se=I.slice(0,this.numUnits),ie=I.slice(this.numUnits,2*this.numUnits);return{c:new Float32Array(se),h:new Float32Array(ie)}},J.prototype.getPDF=function(R,W,q){var P=this;W===void 0&&(W=.65);var ee=W,I=.5+.5*ee;q&&(I=q);var se=this.NMIXTURE,ie=U.tidy(function(){var de=P.numUnits,pe=U.tensor2d(R.h,[1,de]),Ae=U.scalar(Math.sqrt(ee)),Te=U.scalar(I),je=U.add(U.matMul(pe,P.outputKernel),P.outputBias).squeeze(),we=U.split(je,[3,6*se]),ot=we[0],_t=we[1],Ut=U.split(_t,6),Xt=Ut[0],ke=Ut[1],Ft=Ut[2],Gt=Ut[3],jt=Ut[4],Ye=Ut[5],ln=U.softmax(ot.div(Te)),nn=[U.softmax(Xt.div(Te)),ke,Ft,U.exp(Gt).mul(Ae),U.exp(jt).mul(Ae),U.tanh(Ye),ln];return U.concat(nn)}),K=ie.dataSync();return ie.dispose(),{pi:new Float32Array(K.slice(0,se)),muX:new Float32Array(K.slice(1*se,2*se)),muY:new Float32Array(K.slice(2*se,3*se)),sigmaX:new Float32Array(K.slice(3*se,4*se)),sigmaY:new Float32Array(K.slice(4*se,15*se)),corr:new Float32Array(K.slice(5*se,6*se)),pen:new Float32Array(K.slice(6*se,6*se+3))}},J.prototype.zeroState=function(){return{c:new Float32Array(this.numUnits),h:new Float32Array(this.numUnits)}},J.prototype.copyState=function(R){return{c:new Float32Array(R.c),h:new Float32Array(R.h)}},J.prototype.zeroInput=function(){return[0,0,1,0,0]},J.prototype.sample=function(R){var W=B.sampleSoftmax(R.pi),q=R.muX[W],P=R.muY[W],ee=R.sigmaX[W],I=R.sigmaY[W],se=R.corr[W],ie=[0,0,0];ie[B.sampleSoftmax(R.pen)]=1;var K=B.birandn(q,P,ee,I,se);return[K[0]*this.scaleFactor,K[1]*this.scaleFactor,ie[0],ie[1],ie[2]]},J.prototype.simplifyLine=function(R,W){return B.simplifyLine(R,W)},J.prototype.simplifyLines=function(R,W){return B.simplifyLines(R,W)},J.prototype.linesToStroke=function(R){return B.linesToStrokes(R)},J.prototype.lineToStroke=function(R,W){return B.lineToStroke(R,W)},J}();A.SketchRNN=re},function(Oe,A,a){Object.defineProperty(A,"__esModule",{value:!0});var b=a(256);A.SketchRNN=b.SketchRNN},function(Oe,A){Oe.exports=function(a){if(a===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a},Oe.exports.__esModule=!0,Oe.exports.default=Oe.exports},function(Oe,A){function a(b,$){return Oe.exports=a=Object.setPrototypeOf||function(U,B){return U.__proto__=B,U},Oe.exports.__esModule=!0,Oe.exports.default=Oe.exports,a(b,$)}Oe.exports=a,Oe.exports.__esModule=!0,Oe.exports.default=Oe.exports},function(Oe,A){Oe.exports=function(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)},Oe.exports.__esModule=!0,Oe.exports.default=Oe.exports},function(Oe,A){Oe.exports=function(a,b){var $=a==null?null:typeof Symbol<"u"&&a[Symbol.iterator]||a["@@iterator"];if($!=null){var U,B,re=[],J=!0,R=!1;try{for($=$.call(a);!(J=(U=$.next()).done)&&(re.push(U.value),!b||re.length!==b);J=!0);}catch(W){R=!0,B=W}finally{try{J||$.return==null||$.return()}finally{if(R)throw B}}return re}},Oe.exports.__esModule=!0,Oe.exports.default=Oe.exports},function(Oe,A){Oe.exports=function(a){if(Array.isArray(a))return a},Oe.exports.__esModule=!0,Oe.exports.default=Oe.exports},function(Oe,A,a){Oe.exports=function(b){return typeof b=="object"&&b.isAxiosError===!0}},function(Oe,A,a){Oe.exports=function(b){return function($){return b.apply(null,$)}}},function(Oe,A,a){var b=a(188);function $(U){if(typeof U!="function")throw new TypeError("executor must be a function.");var B;this.promise=new Promise(function(J){B=J});var re=this;U(function(J){re.reason||(re.reason=new b(J),B(re.reason))})}$.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},$.source=function(){var U;return{token:new $(function(B){U=B}),cancel:U}},Oe.exports=$},function(Oe){Oe.exports={name:"axios",version:"0.21.4",description:"Promise based HTTP client for the browser and node.js",main:"index.js",scripts:{test:"grunt test",start:"node ./sandbox/server.js",build:"NODE_ENV=production grunt build",preversion:"npm test",version:"npm run build && grunt version && git add -A dist && git add CHANGELOG.md bower.json package.json",postversion:"git push && git push --tags",examples:"node ./examples/server.js",coveralls:"cat coverage/lcov.info | ./node_modules/coveralls/bin/coveralls.js",fix:"eslint --fix lib/**/*.js"},repository:{type:"git",url:"https://github.com/axios/axios.git"},keywords:["xhr","http","ajax","promise","node"],author:"Matt Zabriskie",license:"MIT",bugs:{url:"https://github.com/axios/axios/issues"},homepage:"https://axios-http.com",devDependencies:{coveralls:"^3.0.0","es6-promise":"^4.2.4",grunt:"^1.3.0","grunt-banner":"^0.6.0","grunt-cli":"^1.2.0","grunt-contrib-clean":"^1.1.0","grunt-contrib-watch":"^1.0.0","grunt-eslint":"^23.0.0","grunt-karma":"^4.0.0","grunt-mocha-test":"^0.13.3","grunt-ts":"^6.0.0-beta.19","grunt-webpack":"^4.0.2","istanbul-instrumenter-loader":"^1.0.0","jasmine-core":"^2.4.1",karma:"^6.3.2","karma-chrome-launcher":"^3.1.0","karma-firefox-launcher":"^2.1.0","karma-jasmine":"^1.1.1","karma-jasmine-ajax":"^0.1.13","karma-safari-launcher":"^1.0.0","karma-sauce-launcher":"^4.3.6","karma-sinon":"^1.0.5","karma-sourcemap-loader":"^0.3.8","karma-webpack":"^4.0.2","load-grunt-tasks":"^3.5.2",minimist:"^1.2.0",mocha:"^8.2.1",sinon:"^4.5.0","terser-webpack-plugin":"^4.2.3",typescript:"^4.0.5","url-search-params":"^0.10.0",webpack:"^4.44.2","webpack-dev-server":"^3.11.0"},browser:{"./lib/adapters/http.js":"./lib/adapters/xhr.js"},jsdelivr:"dist/axios.min.js",unpkg:"dist/axios.min.js",typings:"./index.d.ts",dependencies:{"follow-redirects":"^1.14.0"},bundlesize:[{path:"./dist/axios.min.js",threshold:"5kB"}],_resolved:"https://registry.npmjs.org/axios/-/axios-0.21.4.tgz",_integrity:"sha512-ut5vewkiu8jjGBdqpM44XxjuCjq9LAKeHVmoVfHVzy8eHgxxq8SbAVQNovDA8mVi05kP0Ea/n/UzcSHcTJQfNg==",_from:"axios@0.21.4"}},function(Oe,A,a){var b=a(266),$={};["object","boolean","number","function","string","symbol"].forEach(function(J,R){$[J]=function(W){return typeof W===J||"a"+(R<1?"n ":" ")+J}});var U={},B=b.version.split(".");function re(J,R){for(var W=R?R.split("."):B,q=J.split("."),P=0;P<3;P++){if(W[P]>q[P])return!0;if(W[P]<q[P])return!1}return!1}$.transitional=function(J,R,W){var q=R&&re(R);function P(ee,I){return"[Axios v"+b.version+"] Transitional option '"+ee+"'"+I+(W?". "+W:"")}return function(ee,I,se){if(J===!1)throw new Error(P(I," has been removed in "+R));return q&&!U[I]&&(U[I]=!0,console.warn(P(I," has been deprecated since v"+R+" and will be removed in the near future"))),!J||J(ee,I,se)}},Oe.exports={isOlderVersion:re,assertOptions:function(J,R,W){if(typeof J!="object")throw new TypeError("options must be an object");for(var q=Object.keys(J),P=q.length;P-- >0;){var ee=q[P],I=R[ee];if(I){var se=J[ee],ie=se===void 0||I(se,ee,J);if(ie!==!0)throw new TypeError("option "+ee+" must be "+ie)}else if(W!==!0)throw Error("Unknown option "+ee)}},validators:$}},function(Oe,A,a){var b=a(36);Oe.exports=b.isStandardBrowserEnv()?function(){var $,U=/(msie|trident)/i.test(navigator.userAgent),B=document.createElement("a");function re(J){var R=J;return U&&(B.setAttribute("href",R),R=B.href),B.setAttribute("href",R),{href:B.href,protocol:B.protocol?B.protocol.replace(/:$/,""):"",host:B.host,search:B.search?B.search.replace(/^\?/,""):"",hash:B.hash?B.hash.replace(/^#/,""):"",hostname:B.hostname,port:B.port,pathname:B.pathname.charAt(0)==="/"?B.pathname:"/"+B.pathname}}return $=re(window.location.href),function(J){var R=b.isString(J)?re(J):J;return R.protocol===$.protocol&&R.host===$.host}}():function(){return!0}},function(Oe,A,a){var b=a(36),$=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];Oe.exports=function(U){var B,re,J,R={};return U&&b.forEach(U.split(`
`),function(W){if(J=W.indexOf(":"),B=b.trim(W.substr(0,J)).toLowerCase(),re=b.trim(W.substr(J+1)),B){if(R[B]&&$.indexOf(B)>=0)return;R[B]=B==="set-cookie"?(R[B]?R[B]:[]).concat([re]):R[B]?R[B]+", "+re:re}}),R}},function(Oe,A,a){Oe.exports=function(b,$){return $?b.replace(/\/+$/,"")+"/"+$.replace(/^\/+/,""):b}},function(Oe,A,a){Oe.exports=function(b){return/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(b)}},function(Oe,A,a){var b=a(271),$=a(270);Oe.exports=function(U,B){return U&&!b(B)?$(U,B):B}},function(Oe,A,a){var b=a(36);Oe.exports=b.isStandardBrowserEnv()?{write:function($,U,B,re,J,R){var W=[];W.push($+"="+encodeURIComponent(U)),b.isNumber(B)&&W.push("expires="+new Date(B).toGMTString()),b.isString(re)&&W.push("path="+re),b.isString(J)&&W.push("domain="+J),R===!0&&W.push("secure"),document.cookie=W.join("; ")},read:function($){var U=document.cookie.match(new RegExp("(^|;\\s*)("+$+")=([^;]*)"));return U?decodeURIComponent(U[3]):null},remove:function($){this.write($,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}}},function(Oe,A,a){var b=a(191);Oe.exports=function($,U,B){var re=B.config.validateStatus;B.status&&re&&!re(B.status)?U(b("Request failed with status code "+B.status,B.config,null,B.request,B)):$(B)}},function(Oe,A,a){var b=a(36);Oe.exports=function($,U){b.forEach($,function(B,re){re!==U&&re.toUpperCase()===U.toUpperCase()&&($[U]=B,delete $[re])})}},function(Oe,A,a){var b=a(36),$=a(136);Oe.exports=function(U,B,re){var J=this||$;return b.forEach(re,function(R){U=R.call(J,U,B)}),U}},function(Oe,A,a){var b=a(36),$=a(276),U=a(190),B=a(136);function re(J){J.cancelToken&&J.cancelToken.throwIfRequested()}Oe.exports=function(J){return re(J),J.headers=J.headers||{},J.data=$.call(J,J.data,J.headers,J.transformRequest),J.headers=b.merge(J.headers.common||{},J.headers[J.method]||{},J.headers),b.forEach(["delete","get","head","post","put","patch","common"],function(R){delete J.headers[R]}),(J.adapter||B.adapter)(J).then(function(R){return re(J),R.data=$.call(J,R.data,R.headers,J.transformResponse),R},function(R){return U(R)||(re(J),R&&R.response&&(R.response.data=$.call(J,R.response.data,R.response.headers,J.transformResponse))),Promise.reject(R)})}},function(Oe,A,a){var b=a(36);function $(){this.handlers=[]}$.prototype.use=function(U,B,re){return this.handlers.push({fulfilled:U,rejected:B,synchronous:!!re&&re.synchronous,runWhen:re?re.runWhen:null}),this.handlers.length-1},$.prototype.eject=function(U){this.handlers[U]&&(this.handlers[U]=null)},$.prototype.forEach=function(U){b.forEach(this.handlers,function(B){B!==null&&U(B)})},Oe.exports=$},function(Oe,A,a){var b=a(36),$=a(194),U=a(278),B=a(277),re=a(189),J=a(267),R=J.validators;function W(q){this.defaults=q,this.interceptors={request:new U,response:new U}}W.prototype.request=function(q){typeof q=="string"?(q=arguments[1]||{}).url=arguments[0]:q=q||{},(q=re(this.defaults,q)).method?q.method=q.method.toLowerCase():this.defaults.method?q.method=this.defaults.method.toLowerCase():q.method="get";var P=q.transitional;P!==void 0&&J.assertOptions(P,{silentJSONParsing:R.transitional(R.boolean,"1.0.0"),forcedJSONParsing:R.transitional(R.boolean,"1.0.0"),clarifyTimeoutError:R.transitional(R.boolean,"1.0.0")},!1);var ee=[],I=!0;this.interceptors.request.forEach(function(Te){typeof Te.runWhen=="function"&&Te.runWhen(q)===!1||(I=I&&Te.synchronous,ee.unshift(Te.fulfilled,Te.rejected))});var se,ie=[];if(this.interceptors.response.forEach(function(Te){ie.push(Te.fulfilled,Te.rejected)}),!I){var K=[B,void 0];for(Array.prototype.unshift.apply(K,ee),K=K.concat(ie),se=Promise.resolve(q);K.length;)se=se.then(K.shift(),K.shift());return se}for(var de=q;ee.length;){var pe=ee.shift(),Ae=ee.shift();try{de=pe(de)}catch(Te){Ae(Te);break}}try{se=B(de)}catch(Te){return Promise.reject(Te)}for(;ie.length;)se=se.then(ie.shift(),ie.shift());return se},W.prototype.getUri=function(q){return q=re(this.defaults,q),$(q.url,q.params,q.paramsSerializer).replace(/^\?/,"")},b.forEach(["delete","get","head","options"],function(q){W.prototype[q]=function(P,ee){return this.request(re(ee||{},{method:q,url:P,data:(ee||{}).data}))}}),b.forEach(["post","put","patch"],function(q){W.prototype[q]=function(P,ee,I){return this.request(re(I||{},{method:q,url:P,data:ee}))}}),Oe.exports=W},function(Oe,A,a){var b=a(36),$=a(195),U=a(279),B=a(189);function re(R){var W=new U(R),q=$(U.prototype.request,W);return b.extend(q,U.prototype,W),b.extend(q,W),q}var J=re(a(136));J.Axios=U,J.create=function(R){return re(B(J.defaults,R))},J.Cancel=a(188),J.CancelToken=a(265),J.isCancel=a(190),J.all=function(R){return Promise.all(R)},J.spread=a(264),J.isAxiosError=a(263),Oe.exports=J,Oe.exports.default=J},function(Oe,A,a){var b=function($){var U,B=Object.prototype,re=B.hasOwnProperty,J=typeof Symbol=="function"?Symbol:{},R=J.iterator||"@@iterator",W=J.asyncIterator||"@@asyncIterator",q=J.toStringTag||"@@toStringTag";function P(Bt,Pt,gn){return Object.defineProperty(Bt,Pt,{value:gn,enumerable:!0,configurable:!0,writable:!0}),Bt[Pt]}try{P({},"")}catch{P=function(Pt,gn,Dt){return Pt[gn]=Dt}}function ee(Bt,Pt,gn,Dt){var St=Pt&&Pt.prototype instanceof Ae?Pt:Ae,wn=Object.create(St.prototype),Bn=new Ye(Dt||[]);return wn._invoke=function(Hn,hn,Ve){var Qe=se;return function(He,pt){if(Qe===K)throw new Error("Generator is already running");if(Qe===de){if(He==="throw")throw pt;return nn()}for(Ve.method=He,Ve.arg=pt;;){var Lt=Ve.delegate;if(Lt){var zt=Ft(Lt,Ve);if(zt){if(zt===pe)continue;return zt}}if(Ve.method==="next")Ve.sent=Ve._sent=Ve.arg;else if(Ve.method==="throw"){if(Qe===se)throw Qe=de,Ve.arg;Ve.dispatchException(Ve.arg)}else Ve.method==="return"&&Ve.abrupt("return",Ve.arg);Qe=K;var Tn=I(Hn,hn,Ve);if(Tn.type==="normal"){if(Qe=Ve.done?de:ie,Tn.arg===pe)continue;return{value:Tn.arg,done:Ve.done}}Tn.type==="throw"&&(Qe=de,Ve.method="throw",Ve.arg=Tn.arg)}}}(Bt,gn,Bn),wn}function I(Bt,Pt,gn){try{return{type:"normal",arg:Bt.call(Pt,gn)}}catch(Dt){return{type:"throw",arg:Dt}}}$.wrap=ee;var se="suspendedStart",ie="suspendedYield",K="executing",de="completed",pe={};function Ae(){}function Te(){}function je(){}var we={};P(we,R,function(){return this});var ot=Object.getPrototypeOf,_t=ot&&ot(ot(ln([])));_t&&_t!==B&&re.call(_t,R)&&(we=_t);var Ut=je.prototype=Ae.prototype=Object.create(we);function Xt(Bt){["next","throw","return"].forEach(function(Pt){P(Bt,Pt,function(gn){return this._invoke(Pt,gn)})})}function ke(Bt,Pt){var gn;this._invoke=function(Dt,St){function wn(){return new Pt(function(Bn,Hn){(function hn(Ve,Qe,He,pt){var Lt=I(Bt[Ve],Bt,Qe);if(Lt.type!=="throw"){var zt=Lt.arg,Tn=zt.value;return Tn&&typeof Tn=="object"&&re.call(Tn,"__await")?Pt.resolve(Tn.__await).then(function(xn){hn("next",xn,He,pt)},function(xn){hn("throw",xn,He,pt)}):Pt.resolve(Tn).then(function(xn){zt.value=xn,He(zt)},function(xn){return hn("throw",xn,He,pt)})}pt(Lt.arg)})(Dt,St,Bn,Hn)})}return gn=gn?gn.then(wn,wn):wn()}}function Ft(Bt,Pt){var gn=Bt.iterator[Pt.method];if(gn===U){if(Pt.delegate=null,Pt.method==="throw"){if(Bt.iterator.return&&(Pt.method="return",Pt.arg=U,Ft(Bt,Pt),Pt.method==="throw"))return pe;Pt.method="throw",Pt.arg=new TypeError("The iterator does not provide a 'throw' method")}return pe}var Dt=I(gn,Bt.iterator,Pt.arg);if(Dt.type==="throw")return Pt.method="throw",Pt.arg=Dt.arg,Pt.delegate=null,pe;var St=Dt.arg;return St?St.done?(Pt[Bt.resultName]=St.value,Pt.next=Bt.nextLoc,Pt.method!=="return"&&(Pt.method="next",Pt.arg=U),Pt.delegate=null,pe):St:(Pt.method="throw",Pt.arg=new TypeError("iterator result is not an object"),Pt.delegate=null,pe)}function Gt(Bt){var Pt={tryLoc:Bt[0]};1 in Bt&&(Pt.catchLoc=Bt[1]),2 in Bt&&(Pt.finallyLoc=Bt[2],Pt.afterLoc=Bt[3]),this.tryEntries.push(Pt)}function jt(Bt){var Pt=Bt.completion||{};Pt.type="normal",delete Pt.arg,Bt.completion=Pt}function Ye(Bt){this.tryEntries=[{tryLoc:"root"}],Bt.forEach(Gt,this),this.reset(!0)}function ln(Bt){if(Bt){var Pt=Bt[R];if(Pt)return Pt.call(Bt);if(typeof Bt.next=="function")return Bt;if(!isNaN(Bt.length)){var gn=-1,Dt=function St(){for(;++gn<Bt.length;)if(re.call(Bt,gn))return St.value=Bt[gn],St.done=!1,St;return St.value=U,St.done=!0,St};return Dt.next=Dt}}return{next:nn}}function nn(){return{value:U,done:!0}}return Te.prototype=je,P(Ut,"constructor",je),P(je,"constructor",Te),Te.displayName=P(je,q,"GeneratorFunction"),$.isGeneratorFunction=function(Bt){var Pt=typeof Bt=="function"&&Bt.constructor;return!!Pt&&(Pt===Te||(Pt.displayName||Pt.name)==="GeneratorFunction")},$.mark=function(Bt){return Object.setPrototypeOf?Object.setPrototypeOf(Bt,je):(Bt.__proto__=je,P(Bt,q,"GeneratorFunction")),Bt.prototype=Object.create(Ut),Bt},$.awrap=function(Bt){return{__await:Bt}},Xt(ke.prototype),P(ke.prototype,W,function(){return this}),$.AsyncIterator=ke,$.async=function(Bt,Pt,gn,Dt,St){St===void 0&&(St=Promise);var wn=new ke(ee(Bt,Pt,gn,Dt),St);return $.isGeneratorFunction(Pt)?wn:wn.next().then(function(Bn){return Bn.done?Bn.value:wn.next()})},Xt(Ut),P(Ut,q,"Generator"),P(Ut,R,function(){return this}),P(Ut,"toString",function(){return"[object Generator]"}),$.keys=function(Bt){var Pt=[];for(var gn in Bt)Pt.push(gn);return Pt.reverse(),function Dt(){for(;Pt.length;){var St=Pt.pop();if(St in Bt)return Dt.value=St,Dt.done=!1,Dt}return Dt.done=!0,Dt}},$.values=ln,Ye.prototype={constructor:Ye,reset:function(Bt){if(this.prev=0,this.next=0,this.sent=this._sent=U,this.done=!1,this.delegate=null,this.method="next",this.arg=U,this.tryEntries.forEach(jt),!Bt)for(var Pt in this)Pt.charAt(0)==="t"&&re.call(this,Pt)&&!isNaN(+Pt.slice(1))&&(this[Pt]=U)},stop:function(){this.done=!0;var Bt=this.tryEntries[0].completion;if(Bt.type==="throw")throw Bt.arg;return this.rval},dispatchException:function(Bt){if(this.done)throw Bt;var Pt=this;function gn(hn,Ve){return wn.type="throw",wn.arg=Bt,Pt.next=hn,Ve&&(Pt.method="next",Pt.arg=U),!!Ve}for(var Dt=this.tryEntries.length-1;Dt>=0;--Dt){var St=this.tryEntries[Dt],wn=St.completion;if(St.tryLoc==="root")return gn("end");if(St.tryLoc<=this.prev){var Bn=re.call(St,"catchLoc"),Hn=re.call(St,"finallyLoc");if(Bn&&Hn){if(this.prev<St.catchLoc)return gn(St.catchLoc,!0);if(this.prev<St.finallyLoc)return gn(St.finallyLoc)}else if(Bn){if(this.prev<St.catchLoc)return gn(St.catchLoc,!0)}else{if(!Hn)throw new Error("try statement without catch or finally");if(this.prev<St.finallyLoc)return gn(St.finallyLoc)}}}},abrupt:function(Bt,Pt){for(var gn=this.tryEntries.length-1;gn>=0;--gn){var Dt=this.tryEntries[gn];if(Dt.tryLoc<=this.prev&&re.call(Dt,"finallyLoc")&&this.prev<Dt.finallyLoc){var St=Dt;break}}St&&(Bt==="break"||Bt==="continue")&&St.tryLoc<=Pt&&Pt<=St.finallyLoc&&(St=null);var wn=St?St.completion:{};return wn.type=Bt,wn.arg=Pt,St?(this.method="next",this.next=St.finallyLoc,pe):this.complete(wn)},complete:function(Bt,Pt){if(Bt.type==="throw")throw Bt.arg;return Bt.type==="break"||Bt.type==="continue"?this.next=Bt.arg:Bt.type==="return"?(this.rval=this.arg=Bt.arg,this.method="return",this.next="end"):Bt.type==="normal"&&Pt&&(this.next=Pt),pe},finish:function(Bt){for(var Pt=this.tryEntries.length-1;Pt>=0;--Pt){var gn=this.tryEntries[Pt];if(gn.finallyLoc===Bt)return this.complete(gn.completion,gn.afterLoc),jt(gn),pe}},catch:function(Bt){for(var Pt=this.tryEntries.length-1;Pt>=0;--Pt){var gn=this.tryEntries[Pt];if(gn.tryLoc===Bt){var Dt=gn.completion;if(Dt.type==="throw"){var St=Dt.arg;jt(gn)}return St}}throw new Error("illegal catch attempt")},delegateYield:function(Bt,Pt,gn){return this.delegate={iterator:ln(Bt),resultName:Pt,nextLoc:gn},this.method==="next"&&(this.arg=U),pe}},$}(Oe.exports);try{regeneratorRuntime=b}catch{typeof globalThis=="object"?globalThis.regeneratorRuntime=b:Function("r","regeneratorRuntime = r")(b)}},function(Oe,A,a){/** @license See the LICENSE file. */Object.defineProperty(A,"__esModule",{value:!0}),A.version="1.5.1"},function(Oe,A,a){/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/var b=this&&this.__awaiter||function(re,J,R,W){return new(R||(R=Promise))(function(q,P){function ee(ie){try{se(W.next(ie))}catch(K){P(K)}}function I(ie){try{se(W.throw(ie))}catch(K){P(K)}}function se(ie){ie.done?q(ie.value):new R(function(K){K(ie.value)}).then(ee,I)}se((W=W.apply(re,J||[])).next())})};Object.defineProperty(A,"__esModule",{value:!0});const $=a(137),U=a(46),B=a(110);A.valuesDistribution=function(re,J){return b(this,void 0,void 0,function*(){const R=U.getDrawArea(re),W=yield B.tensorStats(J),q=yield J.data();$.histogram(R,q,{height:150,stats:W})})}},function(Oe,A,a){/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/var b=this&&this.__awaiter||function(B,re,J,R){return new(J||(J=Promise))(function(W,q){function P(se){try{I(R.next(se))}catch(ie){q(ie)}}function ee(se){try{I(R.throw(se))}catch(ie){q(ie)}}function I(se){se.done?W(se.value):new J(function(ie){ie(se.value)}).then(P,ee)}I((R=R.apply(B,re||[])).next())})};Object.defineProperty(A,"__esModule",{value:!0});const $=a(46),U=a(109);A.perClassAccuracy=function(B,re,J){return b(this,void 0,void 0,function*(){const R=$.getDrawArea(B),W=[];for(let q=0;q<re.length;q++){const P=J?J[q]:q.toString(),ee=re[q];W.push([P,ee.accuracy,ee.count])}return U.table(R,{headers:["Class","Accuracy","# Samples"],values:W})})}},function(Oe,A,a){/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/var b=this&&this.__awaiter||function(q,P,ee,I){return new(ee||(ee=Promise))(function(se,ie){function K(Ae){try{pe(I.next(Ae))}catch(Te){ie(Te)}}function de(Ae){try{pe(I.throw(Ae))}catch(Te){ie(Te)}}function pe(Ae){Ae.done?se(Ae.value):new ee(function(Te){Te(Ae.value)}).then(K,de)}pe((I=I.apply(q,P||[])).next())})};Object.defineProperty(A,"__esModule",{value:!0});const $=a(137),U=a(46),B=a(109),re=a(64),J=a(110);function R(q){let P;return Array.isArray(q.outputShape[0])?P=`[${q.outputShape.map(ee=>W(ee)).join(", ")}]`:P=W(q.outputShape),{name:q.name,trainable:q.trainable,parameters:q.countParams(),outputShape:P}}function W(q){const P=q.slice();return P.length===0?"Scalar":(P[0]===null&&(P[0]="batch"),`[${P.join(",")}]`)}A.modelSummary=function(q,P){return b(this,void 0,void 0,function*(){const ee=U.getDrawArea(q),I=function(se){return{layers:se.layers.map(R)}}(P).layers.map(se=>[se.name,se.outputShape,se.parameters,se.trainable]);B.table(ee,{headers:["Layer Name","Output Shape","# Of Params","Trainable"],values:I})})},A.layer=function(q,P){return b(this,void 0,void 0,function*(){const ee=U.getDrawArea(q),I=yield function(pe){return b(this,void 0,void 0,function*(){const Ae=pe.getWeights(),Te=pe.weights,je=Ae.map(J.tensorStats),we=yield Promise.all(je),ot=Ae.map(_t=>_t.shape);return Ae.map((_t,Ut)=>({name:Te[Ut].name,stats:we[Ut],shape:W(ot[Ut]),weight:_t}))})}(P),se=re.subSurface(ee,"layer-weights-info"),ie=I.map(pe=>[pe.name,pe.shape,pe.stats.min,pe.stats.max,pe.weight.size,pe.stats.numZeros,pe.stats.numNans,pe.stats.numInfs]);B.table(se,{headers:["Weight Name","Shape","Min","Max","# Params","# Zeros","# NaNs","# Infinity"],values:ie});const K=re.subSurface(ee,"select-layer"),de=re.subSurface(ee,"param-distribution");(function(pe,Ae,Te){const je=`<div><button>Show Values Distribution for:</button>${`
    <select>
      ${pe.map(_t=>`<option value=${_t}>${_t}</option>`)}
    </select>
  `}</div>`;Ae.innerHTML=je;const we=Ae.querySelector("button"),ot=Ae.querySelector("select");we.addEventListener("click",()=>{Te(ot.selectedOptions[0].label)})})(I.map(pe=>pe.name),K,pe=>b(this,void 0,void 0,function*(){const Ae=yield I.filter(Te=>Te.name===pe)[0].weight.data();$.histogram(de,Ae,{height:150,width:460,stats:!1})}))})}},function(Oe,A,a){/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/var b=this&&this.__awaiter||function(q,P,ee,I){return new(ee||(ee=Promise))(function(se,ie){function K(Ae){try{pe(I.next(Ae))}catch(Te){ie(Te)}}function de(Ae){try{pe(I.throw(Ae))}catch(Te){ie(Te)}}function pe(Ae){Ae.done?se(Ae.value):new ee(function(Te){Te(Ae.value)}).then(K,de)}pe((I=I.apply(q,P||[])).next())})};Object.defineProperty(A,"__esModule",{value:!0});const $=a(196),U=a(46),B=a(64);function re(q,P,ee,I={}){return b(this,void 0,void 0,function*(){const se=U.getDrawArea(q),ie={};for(const Ae of ee)if(/val_/.test(Ae)){const Te=Ae.replace("val_","");J(ie,Te);const je=R(P,Ae,ee.indexOf(Ae));ie[Te].series.push(Ae),ie[Te].values.push(je)}else{const Te=R(P,Ae,ee.indexOf(Ae));J(ie,Ae),ie[Ae].series.push(Ae),ie[Ae].values.push(Te)}const K=Object.keys(ie),de=Object.assign({},{xLabel:"Iteration",yLabel:"Value"},I),pe=[];for(const Ae of K){const Te=B.subSurface(se,Ae),je=ie[Ae].series,we=ie[Ae].values;je.every(_t=>!!_t.match("acc"))&&(de.zoomToFitAccuracy?de.zoomToFit=!0:(de.yAxisDomain=[0,1],delete de.zoomToFit));const ot=$.linechart(Te,{values:we,series:je},de);pe.push(ot)}yield Promise.all(pe)})}function J(q,P){q[P]==null&&(q[P]={series:[],values:[]})}function R(q,P,ee){if(Array.isArray(q)){const I=Array.isArray(q[0])?q[ee]:q,se=[];for(let ie=0;ie<I.length;ie++){const K=I[ie];se.push({x:ie,y:K[P]})}return se}return q.history[P].map((I,se)=>({x:se,y:I}))}function W(q,P,ee){return q[P]==null&&(q[P]={}),q[P][ee]==null&&(q[P][ee]=[]),q[P][ee]}A.history=re,A.fitCallbacks=function(q,P,ee={}){const I={},se=ee.callbacks||["onEpochEnd","onBatchEnd"],ie=U.getDrawArea(q),K=Object.assign({},ee);delete K.callbacks;const de={};return se.forEach(pe=>{de[pe]=function(Ae){return(Te,je)=>b(this,void 0,void 0,function*(){/batch/i.test(Ae)?K.xLabel="Batch":/epoch/i.test(Ae)&&(K.xLabel="Epoch");const we=[],ot=[];for(const _t of P)if(je[_t]!=null){ot.push(_t);const Ut=W(I,Ae,_t);Ut.push({[_t]:je[_t]}),we.push(Ut)}re(B.subSurface(ie,Ae,{title:Ae}),we,ot,K),yield U.nextFrame()})}(pe)}),de}},function(Oe,A,a){/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/var b=this&&this.__awaiter||function(W,q,P,ee){return new(P||(P=Promise))(function(I,se){function ie(pe){try{de(ee.next(pe))}catch(Ae){se(Ae)}}function K(pe){try{de(ee.throw(pe))}catch(Ae){se(Ae)}}function de(pe){pe.done?I(pe.value):new P(function(Ae){Ae(pe.value)}).then(ie,K)}de((ee=ee.apply(W,q||[])).next())})},$=this&&this.__importDefault||function(W){return W&&W.__esModule?W:{default:W}};Object.defineProperty(A,"__esModule",{value:!0});const U=$(a(88)),B=a(64),re=a(111),J=a(46);A.scatterplot=function(W,q,P={}){return b(this,void 0,void 0,function*(){let ee=q.values;const I=q.series==null?[]:q.series,se=[];(ee=Array.isArray(ee[0])?ee:[ee]).forEach((pe,Ae)=>{const Te=I[Ae]!=null?I[Ae]:`Series ${Ae+1}`,je=pe.map(we=>Object.assign({},we,{series:Te}));se.push(...je)}),P.seriesColors!=null&&re.assert(P.seriesColors.length===ee.length,"Must have an equal number of series colors as there are data series");const ie=J.getDrawArea(W),K=Object.assign({},R,P),de={width:K.width||B.getDefaultWidth(ie),height:K.height||B.getDefaultHeight(ie),padding:0,autosize:{type:"fit",contains:"padding",resize:!0},config:{axis:{labelFontSize:K.fontSize,titleFontSize:K.fontSize},text:{fontSize:K.fontSize},legend:{labelFontSize:K.fontSize,titleFontSize:K.fontSize}},data:{values:se},mark:{type:"point",clip:!0,tooltip:{content:"data"}},encoding:{x:{field:"x",type:K.xType,title:K.xLabel,scale:K.zoomToFit?{zero:!1}:K.xAxisDomain!=null?{domain:K.xAxisDomain}:void 0},y:{field:"y",type:K.yType,title:K.yLabel,scale:K.zoomToFit?{zero:!1}:K.yAxisDomain!=null?{domain:K.yAxisDomain}:void 0},color:{field:"series",type:"nominal",scale:{range:K.seriesColors}},shape:{field:"series",type:"nominal"}}};return yield U.default(ie,de,{actions:!1,mode:"vega-lite",defaultStyle:!1}),Promise.resolve()})};const R={xLabel:"x",yLabel:"y",xType:"quantitative",yType:"quantitative",zoomToFit:!1,fontSize:11}},function(Oe,A,a){/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/var b=this&&this.__awaiter||function(ee,I,se,ie){return new(se||(se=Promise))(function(K,de){function pe(je){try{Te(ie.next(je))}catch(we){de(we)}}function Ae(je){try{Te(ie.throw(je))}catch(we){de(we)}}function Te(je){je.done?K(je.value):new se(function(we){we(je.value)}).then(pe,Ae)}Te((ie=ie.apply(ee,I||[])).next())})},$=this&&this.__importStar||function(ee){if(ee&&ee.__esModule)return ee;var I={};if(ee!=null)for(var se in ee)Object.hasOwnProperty.call(ee,se)&&(I[se]=ee[se]);return I.default=ee,I},U=this&&this.__importDefault||function(ee){return ee&&ee.__esModule?ee:{default:ee}};Object.defineProperty(A,"__esModule",{value:!0});const B=$(a(0)),re=U(a(88)),J=a(64),R=a(111),W=a(46);function q(ee,I,se){const ie=ee instanceof B.Tensor?ee.shape:[ee.length,ee[0].length];se===0?R.assert(ie[0]===I.length,`Length of xTickLabels (${I.length}) must match number of rows (${ie[0]})`):se===1&&R.assert(ie[1]===I.length,`Length of yTickLabels (${I.length}) must match number of columns (${ie[1]})`)}A.heatmap=function(ee,I,se={}){return b(this,void 0,void 0,function*(){const ie=Object.assign({},P,se),K=W.getDrawArea(ee);let de=I.values;ie.rowMajor&&(de=yield function(Ut){return b(this,void 0,void 0,function*(){let Xt,ke;Ut instanceof B.Tensor?(Xt=Ut.shape,ke=Ut.transpose()):(Xt=[Ut.length,Ut[0].length],ke=B.tidy(()=>B.tensor2d(Ut).transpose())),R.assert(ke.rank===2,"Input to renderHeatmap must be a 2d array or Tensor2d");const Ft=yield ke.array();ke.dispose();const Gt=[Ft.length,Ft[0].length];return R.assert(Xt[0]===Gt[1]&&Xt[1]===Gt[0],`Unexpected transposed shape. Original ${Xt} : Transposed ${Gt}`),Ft})}(I.values));const{xTickLabels:pe,yTickLabels:Ae}=I;pe!=null&&q(de,pe,0),Ae!=null&&q(de,Ae,1);const Te=[];if(de instanceof B.Tensor){R.assert(de.rank===2,"Input to renderHeatmap must be a 2d array or Tensor2d");const Ut=yield de.data(),[Xt,ke]=de.shape;for(let Ft=0;Ft<Xt;Ft++){const Gt=pe?`${pe[Ft]}@tfidx@${Ft}`:Ft;for(let jt=0;jt<ke;jt++){const Ye=Ae?`${Ae[jt]}@tfidx@${jt}`:jt,ln=Ut[Ft*ke+jt];Te.push({x:Gt,y:Ye,value:ln})}}}else{const Ut=de;for(let Xt=0;Xt<Ut.length;Xt++){const ke=pe?`${pe[Xt]}@tfidx@${Xt}`:Xt;for(let Ft=0;Ft<Ut[Xt].length;Ft++){const Gt=Ae?`${Ae[Ft]}@tfidx@${Ft}`:Ft,jt=Ut[Xt][Ft];Te.push({x:ke,y:Gt,value:jt})}}}const je={actions:!1,mode:"vega-lite",defaultStyle:!1},we={width:ie.width||J.getDefaultWidth(K),height:ie.height||J.getDefaultHeight(K),padding:0,autosize:{type:"fit",contains:"padding",resize:!0},config:{axis:{labelFontSize:ie.fontSize,titleFontSize:ie.fontSize},text:{fontSize:ie.fontSize},legend:{labelFontSize:ie.fontSize,titleFontSize:ie.fontSize},scale:{bandPaddingInner:0,bandPaddingOuter:0}},data:{values:Te},mark:{type:"rect",tooltip:!0},encoding:{x:{field:"x",type:ie.xType,title:ie.xLabel,sort:!1},y:{field:"y",type:ie.yType,title:ie.yLabel,sort:!1},fill:{field:"value",type:"quantitative"}}},ot=new RegExp("@tfidx@\\d+$");let _t;switch(pe&&(we.encoding.x.axis={labelExpr:"replace(datum.value, regexp(/@tfidx@\\d+$/), '')"}),Ae&&(we.encoding.y.axis={labelExpr:"replace(datum.value, regexp(/@tfidx@\\d+$/), '')"}),(pe||Ae)&&(je.tooltip={sanitize:Ut=>String(Ut).replace(ot,"")}),ie.colorMap){case"blues":_t=["#f7fbff","#4292c6"];break;case"greyscale":_t=["#000000","#ffffff"];break;case"viridis":default:_t="viridis"}if(_t!=="viridis"&&(we.encoding.fill.scale={range:_t}),ie.domain){const Ut=we.encoding.fill;Ut.scale!=null?Ut.scale=Object.assign({},Ut.scale,{domain:ie.domain}):Ut.scale={domain:ie.domain}}yield re.default(K,we,je)})};const P={xLabel:null,yLabel:null,xType:"ordinal",yType:"ordinal",colorMap:"viridis",fontSize:12,domain:null,rowMajor:!1}},function(Oe,A,a){/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/var b=this&&this.__awaiter||function(R,W,q,P){return new(q||(q=Promise))(function(ee,I){function se(de){try{K(P.next(de))}catch(pe){I(pe)}}function ie(de){try{K(P.throw(de))}catch(pe){I(pe)}}function K(de){de.done?ee(de.value):new q(function(pe){pe(de.value)}).then(se,ie)}K((P=P.apply(R,W||[])).next())})},$=this&&this.__importDefault||function(R){return R&&R.__esModule?R:{default:R}};Object.defineProperty(A,"__esModule",{value:!0});const U=$(a(88)),B=a(64),re=a(46);A.confusionMatrix=function(R,W,q={}){return b(this,void 0,void 0,function*(){const P=Object.assign({},J,q),ee=re.getDrawArea(R),I=[],se=W.values,ie=W.tickLabels||[],K=ie.length===0;let de=!0;for(let Te=0;Te<se.length;Te++){const je=K?`Class ${Te}`:ie[Te];K&&ie.push(je);for(let we=0;we<se[Te].length;we++){const ot=K?`Class ${we}`:ie[we],_t=se[Te][we];Te!==we||P.shadeDiagonal?(I.push({label:je,prediction:ot,count:_t,scaleCount:_t}),_t!==0&&(de=!1)):I.push({label:je,prediction:ot,count:_t,noFill:!0})}}if(!P.shadeDiagonal&&de)for(const Te of I)Te.noFill===!0&&(Te.noFill=!1,Te.scaleCount=Te.count);const pe={width:P.width||B.getDefaultWidth(ee),height:P.height||B.getDefaultHeight(ee),padding:0,autosize:{type:"fit",contains:"padding",resize:!0},config:{axis:{labelFontSize:P.fontSize,titleFontSize:P.fontSize},text:{fontSize:P.fontSize},legend:{labelFontSize:P.fontSize,titleFontSize:P.fontSize}},data:{values:I},encoding:{x:{field:"prediction",type:"ordinal",title:P.xLabel||"prediction",scale:{domain:ie}},y:{field:"label",type:"ordinal",title:P.yLabel||"label",scale:{domain:ie}}},layer:[{transform:[{filter:"datum.noFill != true"}],mark:{type:"rect"},encoding:{color:{field:"scaleCount",type:"quantitative",scale:{range:P.colorMap}},tooltip:[{field:"label",type:"nominal"},{field:"prediction",type:"nominal"},{field:"count",type:"quantitative"}]}}]};P.shadeDiagonal===!1&&pe.layer.push({transform:[{filter:"datum.noFill == true"}],mark:{type:"rect",fill:"white"},encoding:{tooltip:[{field:"label",type:"nominal"},{field:"prediction",type:"nominal"},{field:"count",type:"quantitative"}]}}),P.showTextOverlay&&pe.layer.push({mark:{type:"text",baseline:"middle"},encoding:{text:{field:"count",type:"nominal"}}});const Ae=typeof P.colorMap=="string"?{scheme:P.colorMap}:P.colorMap;pe.layer[0].encoding.color.scale.range=Ae,yield U.default(ee,pe,{actions:!1,mode:"vega-lite",defaultStyle:!1})})};const J={xLabel:null,yLabel:null,xType:"nominal",yType:"nominal",shadeDiagonal:!0,fontSize:12,showTextOverlay:!0,height:400,colorMap:["#f7fbff","#4292c6"]}},function(Oe,A,a){/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Object.defineProperty(A,"__esModule",{value:!0});const b=a(138),$=a(102);A.Tabs=class extends b.Component{render(){const{tabNames:B,activeTab:re,handleClick:J}=this.props,R=B.length>0?B.map(q=>b.h(U,{key:q,id:q,handleClick:J,isActive:q===re},q)):null,W=$.css({overflowX:"scroll",overflowY:"hidden",whiteSpace:"nowrap",borderBottomStyle:"solid",borderBottomWidth:"1px",borderColor:"#eee",paddingBottom:"1rem",marginTop:"1rem"});return b.h("div",{className:`${W} visor-tabs`},R)}};class U extends b.Component{render(){const{children:re,isActive:J,handleClick:R,id:W}=this.props,q=$.css({borderBottomColor:J?"#357EDD":"#AAAAAA",borderBottomWidth:"1px",borderBottomStyle:"solid",cursor:"pointer",":hover":{color:"#357EDD"},display:"inline-block",marginRight:"1rem",padding:".5rem",fontSize:"1rem",fontWeight:"bold"});return b.h("a",{className:`${q} tf-tab`,"data-isactive":J,onClick:()=>R(W)},re)}}},function(Oe,A,a){/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Object.defineProperty(A,"__esModule",{value:!0});const b=a(138),$=a(102);class U extends b.Component{componentDidMount(){const{name:re,tab:J}=this.props;this.props.registerSurface(re,J,this)}componentDidUpdate(){return!1}render(){const{name:re,visible:J,styles:R}=this.props,W=Object.assign({},U.defaultStyles,R),{width:q,height:P}=W;let{maxHeight:ee,maxWidth:I}=W;ee=P===U.defaultStyles.height?ee:P,I=q===U.defaultStyles.width?I:q;const se=$.css({display:J?"block":"none",backgroundColor:"white",marginTop:"10px",marginBottom:"10px",boxShadow:"0 0 6px -3px #777",padding:"10px !important",height:P,width:q,maxHeight:ee,maxWidth:I,overflow:"auto"}),ie=$.css({backgroundColor:"white",boxSizing:"border-box",borderBottom:"1px solid #357EDD",lineHeight:"2em",marginBottom:"20px",fontWeight:"600",textAlign:"center"}),K=$.css({boxSizing:"border-box"});return b.h("div",{className:`${se} tf-surface`,ref:de=>this.container=de,"data-visible":J},b.h("div",{className:`${ie} tf-label`,ref:de=>this.label=de},re),b.h("div",{className:`${K} tf-draw-area`,ref:de=>this.drawArea=de}))}}U.defaultStyles={maxWidth:"550px",maxHeight:"580px",height:"auto",width:"auto"},A.SurfaceComponent=U},function(Oe,A,a){/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Object.defineProperty(A,"__esModule",{value:!0});const b=a(138),$=a(102),U=a(291),B=a(290);class re extends b.Component{static render(W,q,P){return b.render(b.h(re,Object.assign({},P)),W,q)}constructor(W){super(W),this.surfaces=new Map;const q=W.startOpen==null||W.startOpen;this.state={isOpen:q,isFullscreen:!1,activeTab:null,tabs:new Set},this.keyHandler=this.keyHandler.bind(this)}close(){this.setState({isOpen:!1})}open(){this.setState({isOpen:!0})}toggle(){this.setState({isOpen:!this.state.isOpen})}toggleFullScreen(){this.setState({isFullscreen:!this.state.isFullscreen})}isOpen(){return this.state.isOpen}isFullscreen(){return this.state.isFullscreen}getSurface(W,q){const P=this.surfaceId(W,q);let ee;if(!this.surfaces.has(P))throw Error(`Surface not found with id: ${P}`);return{container:(ee=this.surfaces.get(P)).container,label:ee.label,drawArea:ee.drawArea}}bindKeys(){document.addEventListener("keydown",this.keyHandler,!1)}unbindKeys(){document.removeEventListener("keydown",this.keyHandler)}surfaceId(W,q){return W+q}setTabs(W){const q=W.map(I=>I.tab),P=this.state.tabs;let ee;for(const I of q)P.has(I)||(P.add(I),ee=I);ee!=null&&this.setState({tabs:P,activeTab:ee})}getTabs(){return this.state.tabs}registerSurface(W,q,P){const ee=this.surfaceId(W,q);this.surfaces.set(ee,P)}keyHandler(W){W.keyCode===192&&(W.shiftKey?this.toggleFullScreen():this.toggle())}setActiveTab(W){this.setState({activeTab:W})}componentDidMount(){this.bindKeys()}componentWillMount(){this.setTabs(this.props.surfaceList)}componentWillReceiveProps(W){this.setTabs(W.surfaceList)}render(){const{isOpen:W,isFullscreen:q,activeTab:P}=this.state,{surfaceList:ee}=this.props,I=Array.from(this.getTabs().values()),se=q?"90vw":"550px",ie=$.css({width:se,height:"100%",backgroundColor:"#fafafa",boxSizing:"border-box",padding:"10px",position:"fixed",top:"0px",transition:"right 0.5s cubic-bezier(0.645, 0.045, 0.355, 1), width 0.5s cubic-bezier(0.645, 0.045, 0.355, 1)",boxShadow:"0 2px 5px rgba(0, 0, 0, 0.12), 0 2px 5px rgba(0, 0, 0, 0.24)",overflow:"auto",fontFamily:"sans-serif",fontSize:"14px",zIndex:1e3}),K=$.css({right:"0"}),de=$.css({right:`calc(-${se} - 10px)`}),pe=W?K:de,Ae=$.css({});return b.h("div",{className:`${ie} ${pe} visor`,"data-isopen":W,"data-isfullscreen":q},b.h(J,{fullScreenHandler:this.toggleFullScreen.bind(this),closeHandler:this.close.bind(this),isFullScreen:q}),b.h(B.Tabs,{tabNames:I,activeTab:P,handleClick:this.setActiveTab.bind(this)}),b.h("div",{className:`${Ae} visor-surfaces`},ee.map(Te=>b.h(U.SurfaceComponent,{key:Te.name+Te.tab,name:Te.name,tab:Te.tab,styles:Te.styles,registerSurface:this.registerSurface.bind(this),visible:P===Te.tab}))))}}function J(R){const{isFullScreen:W,fullScreenHandler:q,closeHandler:P}=R,ee=$.css({display:"flex",backgroundColor:"white",border:"1px solid white",padding:"6px",paddingTop:"10px",marginBottom:"10px",borderRadius:"6px",marginTop:"-16px"}),I=$.css({fontSize:".875rem",borderRadius:".25rem",paddingLeft:"1rem",paddingRight:"1rem",paddingTop:".5rem",paddingBottom:".5rem",textDecoration:"none",transition:"color .15s ease-in",color:"#111"}),se=$.css({marginLeft:"auto"});return b.h("div",{className:`${ee} visor-controls`},b.h("button",{className:`${I}`,onClick:q},W?"Minimize":"Maximize"),b.h("button",{className:`${I} ${se}`,onClick:P},"Hide"))}A.VisorComponent=re},function(Oe,A,a){function b(B,re){return B.charCodeAt(re++)+(B.charCodeAt(re++)<<8)+(B.charCodeAt(re++)<<16)+(B.charCodeAt(re)<<24)}function $(B,re){return B.charCodeAt(re++)+(B.charCodeAt(re++)<<8)}function U(B,re){return(65535&(B|=0))*(re|=0)+(((B>>>16)*re&65535)<<16)|0}Object.defineProperty(A,"__esModule",{value:!0}),A.default=function(B,re){for(var J=1540483477,R=re^B.length,W=B.length,q=0;W>=4;){var P=b(B,q);P=U(P,J),P=U(P^=P>>>24,J),R=U(R,J),R^=P,q+=4,W-=4}switch(W){case 3:R^=$(B,q),R=U(R^=B.charCodeAt(q+2)<<16,J);break;case 2:R=U(R^=$(B,q),J);break;case 1:R=U(R^=B.charCodeAt(q),J)}return R=U(R^=R>>>13,J),(R^=R>>>15)>>>0}},function(Oe,A,a){a.r(A);var b=/[A-Z]/g,$=/^ms-/,U={};function B(re){return"-"+re.toLowerCase()}A.default=function(re){if(U.hasOwnProperty(re))return U[re];var J=re.replace(b,B);return U[re]=$.test(J)?"-"+J:J}},function(Oe,A,a){Object.defineProperty(A,"__esModule",{value:!0}),A.default=function($){return(0,b.default)($)};var b=function($){return $&&$.__esModule?$:{default:$}}(a(294));Oe.exports=A.default},function(Oe,A,a){Object.defineProperty(A,"__esModule",{value:!0}),A.default=function(R,W,q,P){if(typeof W=="string"&&re.hasOwnProperty(R)){var ee=function(ie,K){if((0,$.default)(ie))return ie;for(var de=ie.split(/,(?![^()]*(?:\([^()]*\))?\))/g),pe=0,Ae=de.length;pe<Ae;++pe){var Te=de[pe],je=[Te];for(var we in K){var ot=(0,b.default)(we);if(Te.indexOf(ot)>-1&&ot!=="order")for(var _t=K[we],Ut=0,Xt=_t.length;Ut<Xt;++Ut)je.unshift(Te.replace(ot,J[_t[Ut]]+ot))}de[pe]=je.join(",")}return de.join(",")}(W,P),I=ee.split(/,(?![^()]*(?:\([^()]*\))?\))/g).filter(function(ie){return!/-moz-|-ms-/.test(ie)}).join(",");if(R.indexOf("Webkit")>-1)return I;var se=ee.split(/,(?![^()]*(?:\([^()]*\))?\))/g).filter(function(ie){return!/-webkit-|-ms-/.test(ie)}).join(",");return R.indexOf("Moz")>-1?se:(q["Webkit"+(0,U.default)(R)]=I,q["Moz"+(0,U.default)(R)]=se,ee)}};var b=B(a(295)),$=B(a(101)),U=B(a(199));function B(R){return R&&R.__esModule?R:{default:R}}var re={transition:!0,transitionProperty:!0,WebkitTransition:!0,WebkitTransitionProperty:!0,MozTransition:!0,MozTransitionProperty:!0},J={Webkit:"-webkit-",Moz:"-moz-",ms:"-ms-"};Oe.exports=A.default},function(Oe,A,a){Object.defineProperty(A,"__esModule",{value:!0}),A.default=function(B,re){if($.hasOwnProperty(B)&&U.hasOwnProperty(re))return b.map(function(J){return J+re})};var b=["-webkit-","-moz-",""],$={maxHeight:!0,maxWidth:!0,width:!0,height:!0,columnWidth:!0,minWidth:!0,minHeight:!0},U={"min-content":!0,"max-content":!0,"fill-available":!0,"fit-content":!0,"contain-floats":!0};Oe.exports=A.default},function(Oe,A,a){Object.defineProperty(A,"__esModule",{value:!0}),A.default=function(b,$){if(b==="position"&&$==="sticky")return["-webkit-sticky","sticky"]},Oe.exports=A.default},function(Oe,A,a){Object.defineProperty(A,"__esModule",{value:!0}),A.default=function(U,B){if(typeof B=="string"&&!(0,b.default)(B)&&B.indexOf("image-set(")>-1)return $.map(function(re){return B.replace(/image-set\(/g,re+"image-set(")})};var b=function(U){return U&&U.__esModule?U:{default:U}}(a(101)),$=["-webkit-",""];Oe.exports=A.default},function(Oe,A,a){Object.defineProperty(A,"__esModule",{value:!0}),A.default=function(B,re){if(typeof re=="string"&&!(0,b.default)(re)&&U.test(re))return $.map(function(J){return J+re})};var b=function(B){return B&&B.__esModule?B:{default:B}}(a(101)),$=["-webkit-","-moz-",""],U=/linear-gradient|radial-gradient|repeating-linear-gradient|repeating-radial-gradient/;Oe.exports=A.default},function(Oe,A,a){Object.defineProperty(A,"__esModule",{value:!0}),A.default=function(U,B,re){U==="flexDirection"&&typeof B=="string"&&(B.indexOf("column")>-1?re.WebkitBoxOrient="vertical":re.WebkitBoxOrient="horizontal",B.indexOf("reverse")>-1?re.WebkitBoxDirection="reverse":re.WebkitBoxDirection="normal"),$.hasOwnProperty(U)&&(re[$[U]]=b[B]||B)};var b={"space-around":"justify","space-between":"justify","flex-start":"start","flex-end":"end","wrap-reverse":"multiple",wrap:"multiple"},$={alignItems:"WebkitBoxAlign",justifyContent:"WebkitBoxPack",flexWrap:"WebkitBoxLines"};Oe.exports=A.default},function(Oe,A,a){Object.defineProperty(A,"__esModule",{value:!0}),A.default=function($,U){if($==="display"&&b.hasOwnProperty(U))return b[U]};var b={flex:["-webkit-box","-moz-box","-ms-flexbox","-webkit-flex","flex"],"inline-flex":["-webkit-inline-box","-moz-inline-box","-ms-inline-flexbox","-webkit-inline-flex","inline-flex"]};Oe.exports=A.default},function(Oe,A,a){Object.defineProperty(A,"__esModule",{value:!0}),A.default=function(U,B){if(typeof B=="string"&&!(0,b.default)(B)&&B.indexOf("filter(")>-1)return $.map(function(re){return B.replace(/filter\(/g,re+"filter(")})};var b=function(U){return U&&U.__esModule?U:{default:U}}(a(101)),$=["-webkit-",""];Oe.exports=A.default},function(Oe,A,a){Object.defineProperty(A,"__esModule",{value:!0}),A.default=function(U,B){if(typeof B=="string"&&!(0,b.default)(B)&&B.indexOf("cross-fade(")>-1)return $.map(function(re){return B.replace(/cross-fade\(/g,re+"cross-fade(")})};var b=function(U){return U&&U.__esModule?U:{default:U}}(a(101)),$=["-webkit-",""];Oe.exports=A.default},function(Oe,A,a){Object.defineProperty(A,"__esModule",{value:!0}),A.default=function(U,B){if(U==="cursor"&&$.hasOwnProperty(B))return b.map(function(re){return re+B})};var b=["-webkit-","-moz-",""],$={"zoom-in":!0,"zoom-out":!0,grab:!0,grabbing:!0};Oe.exports=A.default},function(Oe,A,a){Object.defineProperty(A,"__esModule",{value:!0}),A.default=function(b,$,U,B,re){for(var J=0,R=b.length;J<R;++J){var W=b[J]($,U,B,re);if(W)return W}},Oe.exports=A.default},function(Oe,A,a){Object.defineProperty(A,"__esModule",{value:!0}),A.default=function($,U,B){if($.hasOwnProperty(U))for(var re=$[U],J=0,R=re.length;J<R;++J)B[re[J]+(0,b.default)(U)]=B[U]};var b=function($){return $&&$.__esModule?$:{default:$}}(a(199));Oe.exports=A.default},function(Oe,A,a){Object.defineProperty(A,"__esModule",{value:!0});var b=["Webkit"],$=["Moz"],U=["ms"],B=["Webkit","Moz"],re=["Webkit","ms"],J=["Webkit","Moz","ms"];A.default={plugins:[],prefixMap:{appearance:B,userSelect:J,textEmphasisPosition:b,textEmphasis:b,textEmphasisStyle:b,textEmphasisColor:b,boxDecorationBreak:b,clipPath:b,maskImage:b,maskMode:b,maskRepeat:b,maskPosition:b,maskClip:b,maskOrigin:b,maskSize:b,maskComposite:b,mask:b,maskBorderSource:b,maskBorderMode:b,maskBorderSlice:b,maskBorderWidth:b,maskBorderOutset:b,maskBorderRepeat:b,maskBorder:b,maskType:b,textDecorationStyle:b,textDecorationSkip:b,textDecorationLine:b,textDecorationColor:b,filter:b,fontFeatureSettings:b,breakAfter:J,breakBefore:J,breakInside:J,columnCount:B,columnFill:B,columnGap:B,columnRule:B,columnRuleColor:B,columnRuleStyle:B,columnRuleWidth:B,columns:B,columnSpan:B,columnWidth:B,writingMode:re,flex:b,flexBasis:b,flexDirection:b,flexGrow:b,flexFlow:b,flexShrink:b,flexWrap:b,alignContent:b,alignItems:b,alignSelf:b,justifyContent:b,order:b,transform:b,transformOrigin:b,transformOriginX:b,transformOriginY:b,backfaceVisibility:b,perspective:b,perspectiveOrigin:b,transformStyle:b,transformOriginZ:b,animation:b,animationDelay:b,animationDirection:b,animationFillMode:b,animationDuration:b,animationIterationCount:b,animationName:b,animationPlayState:b,animationTimingFunction:b,backdropFilter:b,fontKerning:b,scrollSnapType:re,scrollSnapPointsX:re,scrollSnapPointsY:re,scrollSnapDestination:re,scrollSnapCoordinate:re,shapeImageThreshold:b,shapeImageMargin:b,shapeImageOutside:b,hyphens:J,flowInto:re,flowFrom:re,regionFragment:re,textAlignLast:$,tabSize:$,wrapFlow:U,wrapThrough:U,wrapMargin:U,gridTemplateColumns:U,gridTemplateRows:U,gridTemplateAreas:U,gridTemplate:U,gridAutoColumns:U,gridAutoRows:U,gridAutoFlow:U,grid:U,gridRowStart:U,gridColumnStart:U,gridRowEnd:U,gridRow:U,gridColumn:U,gridColumnEnd:U,gridColumnGap:U,gridRowGap:U,gridArea:U,gridGap:U,textSizeAdjust:re,borderImage:b,borderImageOutset:b,borderImageRepeat:b,borderImageSlice:b,borderImageSource:b,borderImageWidth:b,transitionDelay:b,transitionDuration:b,transitionProperty:b,transitionTimingFunction:b}},Oe.exports=A.default},function(Oe,A,a){Object.defineProperty(A,"__esModule",{value:!0}),A.default=function(pe){for(var Ae in pe){var Te=pe[Ae],je=(0,U.default)(K,Ae,Te,pe,de);je&&(pe[Ae]=je),(0,$.default)(de,Ae,pe)}return pe};var b=ie(a(308)),$=ie(a(307)),U=ie(a(306)),B=ie(a(305)),re=ie(a(304)),J=ie(a(303)),R=ie(a(302)),W=ie(a(301)),q=ie(a(300)),P=ie(a(299)),ee=ie(a(298)),I=ie(a(297)),se=ie(a(296));function ie(pe){return pe&&pe.__esModule?pe:{default:pe}}var K=[re.default,B.default,J.default,W.default,q.default,P.default,ee.default,I.default,se.default,R.default],de=b.default.prefixMap},function(Oe,A,a){Object.defineProperty(A,"__esModule",{value:!0});var b=Object.assign||function(W){for(var q=1;q<arguments.length;q++){var P=arguments[q];for(var ee in P)Object.prototype.hasOwnProperty.call(P,ee)&&(W[ee]=P[ee])}return W};A.PluginSet=J,A.fallbacks=function(W){if(Object.keys(W.style).map(function(ee){return Array.isArray(W.style[ee])}).indexOf(!0)>=0){var q=W.style,P=Object.keys(q).reduce(function(ee,I){return ee[I]=Array.isArray(q[I])?q[I].join("; "+(0,U.processStyleName)(I)+": "):q[I],ee},{});return(0,$.default)({},W,{style:P})}return W},A.contentWrap=function(W){if(W.style.content){var q=W.style.content;return R.indexOf(q)>=0||/^(attr|calc|counters?|url)\(/.test(q)?W:q.charAt(0)!==q.charAt(q.length-1)||q.charAt(0)!=='"'&&q.charAt(0)!=="'"?b({},W,{style:b({},W.style,{content:'"'+q+'"'})}):W}return W},A.prefixes=function(W){return(0,$.default)({},W,{style:(0,B.default)(b({},W.style))})};var $=re(a(139)),U=a(201),B=re(a(309));function re(W){return W&&W.__esModule?W:{default:W}}function J(W){this.fns=W||[]}(0,$.default)(J.prototype,{add:function(){for(var W=this,q=arguments.length,P=Array(q),ee=0;ee<q;ee++)P[ee]=arguments[ee];P.forEach(function(I){W.fns.indexOf(I)>=0||(W.fns=[I].concat(W.fns))})},remove:function(W){this.fns=this.fns.filter(function(q){return q!==W})},clear:function(){this.fns=[]},transform:function(W){return this.fns.reduce(function(q,P){return P(q)},W)}});var R=["normal","none","counter","open-quote","close-quote","no-open-quote","no-close-quote","initial","inherit"]},function(Oe,A,a){Object.defineProperty(A,"__esModule",{value:!0});var b=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(B){return typeof B}:function(B){return B&&typeof Symbol=="function"&&B.constructor===Symbol&&B!==Symbol.prototype?"symbol":typeof B};function $(B){if(function(ee){return ee==null||ee===!1||(ee===void 0?"undefined":b(ee))==="object"&&Object.keys(ee).length===0}(B))return null;if((B===void 0?"undefined":b(B))!=="object")return B;for(var re={},J=Object.keys(B),R=!1,W=0;W<J.length;W++){var q=B[J[W]],P=U(q);P!==null&&P===q||(R=!0),P!==null&&(re[J[W]]=P)}return Object.keys(re).length===0?null:R?re:B}function U(B){return Array.isArray(B)?function(re){var J=!1,R=[];return re.forEach(function(W){var q=U(W);q!==null&&q===W||(J=!0),q!==null&&R.push(q)}),R.length==0?null:J?R:re}(B):$(B)}A.default=U},function(Oe,A,a){Oe.exports=function(b){var $={};return function(U){return $.hasOwnProperty(U)||($[U]=b.call(this,U)),$[U]}}},function(Oe,A,a){var b=/([A-Z])/g;Oe.exports=function($){return $.replace(b,"-$1").toLowerCase()}},function(Oe,A,a){var b=a(313),$=/^ms-/;Oe.exports=function(U){return b(U).replace($,"-ms-")}},function(Oe,A,a){function b(U){return function(){return U}}var $=function(){};$.thatReturns=b,$.thatReturnsFalse=b(!1),$.thatReturnsTrue=b(!0),$.thatReturnsNull=b(null),$.thatReturnsThis=function(){return this},$.thatReturnsArgument=function(U){return U},Oe.exports=$},function(Oe,A,a){Object.defineProperty(A,"__esModule",{value:!0});var b={animationIterationCount:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridRow:!0,gridRowStart:!0,gridRowEnd:!0,gridColumn:!0,gridColumnStart:!0,gridColumnEnd:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},$=["Webkit","ms","Moz","O"];Object.keys(b).forEach(function(B){$.forEach(function(re){b[function(J,R){return J+R.charAt(0).toUpperCase()+R.substring(1)}(re,B)]=b[B]})});var U={isUnitlessNumber:b,shorthandPropertyExpansions:{background:{backgroundAttachment:!0,backgroundColor:!0,backgroundImage:!0,backgroundPositionX:!0,backgroundPositionY:!0,backgroundRepeat:!0},backgroundPosition:{backgroundPositionX:!0,backgroundPositionY:!0},border:{borderWidth:!0,borderStyle:!0,borderColor:!0},borderBottom:{borderBottomWidth:!0,borderBottomStyle:!0,borderBottomColor:!0},borderLeft:{borderLeftWidth:!0,borderLeftStyle:!0,borderLeftColor:!0},borderRight:{borderRightWidth:!0,borderRightStyle:!0,borderRightColor:!0},borderTop:{borderTopWidth:!0,borderTopStyle:!0,borderTopColor:!0},font:{fontStyle:!0,fontVariant:!0,fontWeight:!0,fontSize:!0,lineHeight:!0,fontFamily:!0},outline:{outlineWidth:!0,outlineStyle:!0,outlineColor:!0}}};A.default=U},function(Oe,A,a){Object.defineProperty(A,"__esModule",{value:!0});var b=$(a(316));$(a(200));function $(B){return B&&B.__esModule?B:{default:B}}var U=b.default.isUnitlessNumber;A.default=function(B,re,J){return re==null||typeof re=="boolean"||re===""?"":isNaN(re)||re===0||U.hasOwnProperty(B)&&U[B]?""+re:(typeof re=="string"&&(re=re.trim()),re+"px")}},function(Oe,A,a){var b=/-(.)/g;Oe.exports=function($){return $.replace(b,function(U,B){return B.toUpperCase()})}},function(Oe,A,a){var b=a(318),$=/^-ms-/;Oe.exports=function(U){return b(U.replace($,"ms-"))}},function(Oe,A,a){Object.defineProperty(A,"__esModule",{value:!0}),A.StyleSheet=W;var b=function(q){return q&&q.__esModule?q:{default:q}}(a(139));function $(q){return q[q.length-1]}function U(q){if(q.sheet)return q.sheet;for(var P=0;P<document.styleSheets.length;P++)if(document.styleSheets[P].ownerNode===q)return document.styleSheets[P]}var B=typeof window<"u",re=!1,J=function(){if(B){var q=document.createElement("div");return q.innerHTML="<!--[if lt IE 10]><i></i><![endif]-->",q.getElementsByTagName("i").length===1}}();function R(){var q=document.createElement("style");return q.type="text/css",q.setAttribute("data-glamor",""),q.appendChild(document.createTextNode("")),(document.head||document.getElementsByTagName("head")[0]).appendChild(q),q}function W(){var q=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},P=q.speedy,ee=P===void 0?!re:P,I=q.maxLength,se=I===void 0?B&&J?4e3:65e3:I;this.isSpeedy=ee,this.sheet=void 0,this.tags=[],this.maxLength=se,this.ctr=0}(0,b.default)(W.prototype,{getSheet:function(){return U($(this.tags))},inject:function(){var q=this;if(this.injected)throw new Error("already injected stylesheet!");B?this.tags[0]=R():this.sheet={cssRules:[],insertRule:function(P){q.sheet.cssRules.push({cssText:P})}},this.injected=!0},speedy:function(q){if(this.ctr!==0)throw new Error("cannot change speedy mode after inserting any rule to sheet. Either call speedy("+q+") earlier in your app, or call flush() before speedy("+q+")");this.isSpeedy=!!q},_insert:function(q){try{var P=this.getSheet();P.insertRule(q,q.indexOf("@import")!==-1?0:P.cssRules.length)}catch{}},insert:function(q){if(B)if(this.isSpeedy&&this.getSheet().insertRule)this._insert(q);else if(q.indexOf("@import")!==-1){var P=$(this.tags);P.insertBefore(document.createTextNode(q),P.firstChild)}else $(this.tags).appendChild(document.createTextNode(q));else this.sheet.insertRule(q,q.indexOf("@import")!==-1?0:this.sheet.cssRules.length);return this.ctr++,B&&this.ctr%this.maxLength==0&&this.tags.push(R()),this.ctr-1},delete:function(q){return this.replace(q,"")},flush:function(){B?(this.tags.forEach(function(q){return q.parentNode.removeChild(q)}),this.tags=[],this.sheet=null,this.ctr=0):this.sheet.cssRules=[],this.injected=!1},rules:function(){if(!B)return this.sheet.cssRules;var q=[];return this.tags.forEach(function(P){return q.splice.apply(q,[q.length,0].concat(function(ee){if(Array.isArray(ee)){for(var I=0,se=Array(ee.length);I<ee.length;I++)se[I]=ee[I];return se}return Array.from(ee)}(Array.from(U(P).cssRules))))}),q}})},function(Oe,A,a){a.r(A),a.d(A,"default",function(){return J});var b=a(null),$=a(87),U=a(null),B=a(null),re=a(null);function J(){var R=[],W=B.c;function q(P){if(P!=null&&!isNaN(P=+P))return W((Object(b.c)(R,P,1)-1)/(R.length-1))}return q.domain=function(P){if(!arguments.length)return R.slice();R=[];for(let ee of P)ee==null||isNaN(ee=+ee)||R.push(ee);return R.sort($.a),q},q.interpolator=function(P){return arguments.length?(W=P,q):W},q.range=function(){return R.map((P,ee)=>W(ee/(R.length-1)))},q.quantiles=function(P){return Array.from({length:P+1},(ee,I)=>Object(U.b)(R,I/P))},q.copy=function(){return J(W).domain(R)},re.b.apply(q,arguments)}},function(Oe,A,a){a.r(A),a.d(A,"default",function(){return J});var b=a(null),$=a(null),U=a(null),B=a(null);function re(R){return Math.sign(R)*R*R}function J(){var R,W=Object(b.a)(),q=[0,1],P=!1;function ee(I){var se=function(ie){return Math.sign(ie)*Math.sqrt(Math.abs(ie))}(W(I));return isNaN(se)?R:P?Math.round(se):se}return ee.invert=function(I){return W.invert(re(I))},ee.domain=function(I){return arguments.length?(W.domain(I),ee):W.domain()},ee.range=function(I){return arguments.length?(W.range((q=Array.from(I,B.a)).map(re)),ee):q.slice()},ee.rangeRound=function(I){return ee.range(I).round(!0)},ee.round=function(I){return arguments.length?(P=!!I,ee):P},ee.clamp=function(I){return arguments.length?(W.clamp(I),ee):W.clamp()},ee.unknown=function(I){return arguments.length?(R=I,ee):R},ee.copy=function(){return J(W.domain(),q).round(P).clamp(W.clamp()).unknown(R)},$.a.apply(ee,arguments),Object(U.b)(ee)}},function(Oe,A,a){const b=a(47),$=a(113),{ANY:U}=$,B=a(112),re=a(48),J=(q,P,ee)=>{if(q===P)return!0;if(q.length===1&&q[0].semver===U){if(P.length===1&&P[0].semver===U)return!0;q=ee.includePrerelease?[new $(">=0.0.0-0")]:[new $(">=0.0.0")]}if(P.length===1&&P[0].semver===U){if(ee.includePrerelease)return!0;P=[new $(">=0.0.0")]}const I=new Set;let se,ie,K,de,pe,Ae,Te;for(const ot of q)ot.operator===">"||ot.operator===">="?se=R(se,ot,ee):ot.operator==="<"||ot.operator==="<="?ie=W(ie,ot,ee):I.add(ot.semver);if(I.size>1||se&&ie&&((K=re(se.semver,ie.semver,ee))>0||K===0&&(se.operator!==">="||ie.operator!=="<=")))return null;for(const ot of I){if(se&&!B(ot,String(se),ee)||ie&&!B(ot,String(ie),ee))return null;for(const _t of P)if(!B(ot,String(_t),ee))return!1;return!0}let je=!(!ie||ee.includePrerelease||!ie.semver.prerelease.length)&&ie.semver,we=!(!se||ee.includePrerelease||!se.semver.prerelease.length)&&se.semver;je&&je.prerelease.length===1&&ie.operator==="<"&&je.prerelease[0]===0&&(je=!1);for(const ot of P){if(Te=Te||ot.operator===">"||ot.operator===">=",Ae=Ae||ot.operator==="<"||ot.operator==="<=",se){if(we&&ot.semver.prerelease&&ot.semver.prerelease.length&&ot.semver.major===we.major&&ot.semver.minor===we.minor&&ot.semver.patch===we.patch&&(we=!1),ot.operator===">"||ot.operator===">="){if((de=R(se,ot,ee))===ot&&de!==se)return!1}else if(se.operator===">="&&!B(se.semver,String(ot),ee))return!1}if(ie){if(je&&ot.semver.prerelease&&ot.semver.prerelease.length&&ot.semver.major===je.major&&ot.semver.minor===je.minor&&ot.semver.patch===je.patch&&(je=!1),ot.operator==="<"||ot.operator==="<="){if((pe=W(ie,ot,ee))===ot&&pe!==ie)return!1}else if(ie.operator==="<="&&!B(ie.semver,String(ot),ee))return!1}if(!ot.operator&&(ie||se)&&K!==0)return!1}return!(se&&Ae&&!ie&&K!==0)&&!(ie&&Te&&!se&&K!==0)&&!we&&!je},R=(q,P,ee)=>{if(!q)return P;const I=re(q.semver,P.semver,ee);return I>0?q:I<0||P.operator===">"&&q.operator===">="?P:q},W=(q,P,ee)=>{if(!q)return P;const I=re(q.semver,P.semver,ee);return I<0?q:I>0||P.operator==="<"&&q.operator==="<="?P:q};Oe.exports=(q,P,ee={})=>{if(q===P)return!0;q=new b(q,ee),P=new b(P,ee);let I=!1;e:for(const se of q.set){for(const ie of P.set){const K=J(se,ie,ee);if(I=I||K!==null,K)continue e}if(I)return!1}return!0}},function(Oe,A,a){const b=a(112),$=a(48);Oe.exports=(U,B,re)=>{const J=[];let R=null,W=null;const q=U.sort((se,ie)=>$(se,ie,re));for(const se of q)b(se,B,re)?(W=se,R||(R=se)):(W&&J.push([R,W]),W=null,R=null);R&&J.push([R,null]);const P=[];for(const[se,ie]of J)se===ie?P.push(se):ie||se!==q[0]?ie?se===q[0]?P.push(`<=${ie}`):P.push(`${se} - ${ie}`):P.push(`>=${se}`):P.push("*");const ee=P.join(" || "),I=typeof B.raw=="string"?B.raw:String(B);return ee.length<I.length?ee:B}},function(Oe,A,a){const b=a(47);Oe.exports=($,U,B)=>($=new b($,B),U=new b(U,B),$.intersects(U))},function(Oe,A,a){const b=a(140);Oe.exports=($,U,B)=>b($,U,"<",B)},function(Oe,A,a){const b=a(140);Oe.exports=($,U,B)=>b($,U,">",B)},function(Oe,A,a){const b=a(47);Oe.exports=($,U)=>{try{return new b($,U).range||"*"}catch{return null}}},function(Oe,A,a){const b=a(32),$=a(47),U=a(114);Oe.exports=(B,re)=>{B=new $(B,re);let J=new b("0.0.0");if(B.test(J)||(J=new b("0.0.0-0"),B.test(J)))return J;J=null;for(let R=0;R<B.set.length;++R){let W=null;B.set[R].forEach(q=>{const P=new b(q.semver.version);switch(q.operator){case">":P.prerelease.length===0?P.patch++:P.prerelease.push(0),P.raw=P.format();case"":case">=":W&&!U(P,W)||(W=P);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${q.operator}`)}}),!W||J&&!U(J,W)||(J=W)}return J&&B.test(J)?J:null}},function(Oe,A,a){const b=a(32),$=a(47);Oe.exports=(U,B,re)=>{let J=null,R=null,W=null;try{W=new $(B,re)}catch{return null}return U.forEach(q=>{W.test(q)&&(J&&R.compare(q)!==1||(R=new b(J=q,re)))}),J}},function(Oe,A,a){const b=a(32),$=a(47);Oe.exports=(U,B,re)=>{let J=null,R=null,W=null;try{W=new $(B,re)}catch{return null}return U.forEach(q=>{W.test(q)&&(J&&R.compare(q)!==-1||(R=new b(J=q,re)))}),J}},function(Oe,A,a){const b=a(47);Oe.exports=($,U)=>new b($,U).set.map(B=>B.map(re=>re.value).join(" ").trim().split(" "))},function(Oe,A,a){Oe.exports=function(b){b.prototype[Symbol.iterator]=function*(){for(let $=this.head;$;$=$.next)yield $.value}}},function(Oe,A,a){function b(J){var R=this;if(R instanceof b||(R=new b),R.tail=null,R.head=null,R.length=0,J&&typeof J.forEach=="function")J.forEach(function(P){R.push(P)});else if(arguments.length>0)for(var W=0,q=arguments.length;W<q;W++)R.push(arguments[W]);return R}function $(J,R,W){var q=R===J.head?new re(W,null,R,J):new re(W,R,R.next,J);return q.next===null&&(J.tail=q),q.prev===null&&(J.head=q),J.length++,q}function U(J,R){J.tail=new re(R,J.tail,null,J),J.head||(J.head=J.tail),J.length++}function B(J,R){J.head=new re(R,null,J.head,J),J.tail||(J.tail=J.head),J.length++}function re(J,R,W,q){if(!(this instanceof re))return new re(J,R,W,q);this.list=q,this.value=J,R?(R.next=this,this.prev=R):this.prev=null,W?(W.prev=this,this.next=W):this.next=null}Oe.exports=b,b.Node=re,b.create=b,b.prototype.removeNode=function(J){if(J.list!==this)throw new Error("removing node which does not belong to this list");var R=J.next,W=J.prev;return R&&(R.prev=W),W&&(W.next=R),J===this.head&&(this.head=R),J===this.tail&&(this.tail=W),J.list.length--,J.next=null,J.prev=null,J.list=null,R},b.prototype.unshiftNode=function(J){if(J!==this.head){J.list&&J.list.removeNode(J);var R=this.head;J.list=this,J.next=R,R&&(R.prev=J),this.head=J,this.tail||(this.tail=J),this.length++}},b.prototype.pushNode=function(J){if(J!==this.tail){J.list&&J.list.removeNode(J);var R=this.tail;J.list=this,J.prev=R,R&&(R.next=J),this.tail=J,this.head||(this.head=J),this.length++}},b.prototype.push=function(){for(var J=0,R=arguments.length;J<R;J++)U(this,arguments[J]);return this.length},b.prototype.unshift=function(){for(var J=0,R=arguments.length;J<R;J++)B(this,arguments[J]);return this.length},b.prototype.pop=function(){if(this.tail){var J=this.tail.value;return this.tail=this.tail.prev,this.tail?this.tail.next=null:this.head=null,this.length--,J}},b.prototype.shift=function(){if(this.head){var J=this.head.value;return this.head=this.head.next,this.head?this.head.prev=null:this.tail=null,this.length--,J}},b.prototype.forEach=function(J,R){R=R||this;for(var W=this.head,q=0;W!==null;q++)J.call(R,W.value,q,this),W=W.next},b.prototype.forEachReverse=function(J,R){R=R||this;for(var W=this.tail,q=this.length-1;W!==null;q--)J.call(R,W.value,q,this),W=W.prev},b.prototype.get=function(J){for(var R=0,W=this.head;W!==null&&R<J;R++)W=W.next;if(R===J&&W!==null)return W.value},b.prototype.getReverse=function(J){for(var R=0,W=this.tail;W!==null&&R<J;R++)W=W.prev;if(R===J&&W!==null)return W.value},b.prototype.map=function(J,R){R=R||this;for(var W=new b,q=this.head;q!==null;)W.push(J.call(R,q.value,this)),q=q.next;return W},b.prototype.mapReverse=function(J,R){R=R||this;for(var W=new b,q=this.tail;q!==null;)W.push(J.call(R,q.value,this)),q=q.prev;return W},b.prototype.reduce=function(J,R){var W,q=this.head;if(arguments.length>1)W=R;else{if(!this.head)throw new TypeError("Reduce of empty list with no initial value");q=this.head.next,W=this.head.value}for(var P=0;q!==null;P++)W=J(W,q.value,P),q=q.next;return W},b.prototype.reduceReverse=function(J,R){var W,q=this.tail;if(arguments.length>1)W=R;else{if(!this.tail)throw new TypeError("Reduce of empty list with no initial value");q=this.tail.prev,W=this.tail.value}for(var P=this.length-1;q!==null;P--)W=J(W,q.value,P),q=q.prev;return W},b.prototype.toArray=function(){for(var J=new Array(this.length),R=0,W=this.head;W!==null;R++)J[R]=W.value,W=W.next;return J},b.prototype.toArrayReverse=function(){for(var J=new Array(this.length),R=0,W=this.tail;W!==null;R++)J[R]=W.value,W=W.prev;return J},b.prototype.slice=function(J,R){(R=R||this.length)<0&&(R+=this.length),(J=J||0)<0&&(J+=this.length);var W=new b;if(R<J||R<0)return W;J<0&&(J=0),R>this.length&&(R=this.length);for(var q=0,P=this.head;P!==null&&q<J;q++)P=P.next;for(;P!==null&&q<R;q++,P=P.next)W.push(P.value);return W},b.prototype.sliceReverse=function(J,R){(R=R||this.length)<0&&(R+=this.length),(J=J||0)<0&&(J+=this.length);var W=new b;if(R<J||R<0)return W;J<0&&(J=0),R>this.length&&(R=this.length);for(var q=this.length,P=this.tail;P!==null&&q>R;q--)P=P.prev;for(;P!==null&&q>J;q--,P=P.prev)W.push(P.value);return W},b.prototype.splice=function(J,R,...W){J>this.length&&(J=this.length-1),J<0&&(J=this.length+J);for(var q=0,P=this.head;P!==null&&q<J;q++)P=P.next;var ee=[];for(q=0;P&&q<R;q++)ee.push(P.value),P=this.removeNode(P);for(P===null&&(P=this.tail),P!==this.head&&P!==this.tail&&(P=P.prev),q=0;q<W.length;q++)P=$(this,P,W[q]);return ee},b.prototype.reverse=function(){for(var J=this.head,R=this.tail,W=J;W!==null;W=W.prev){var q=W.prev;W.prev=W.next,W.next=q}return this.head=R,this.tail=J,this};try{a(333)(b)}catch{}},function(Oe,A,a){const b=a(334),$=Symbol("max"),U=Symbol("length"),B=Symbol("lengthCalculator"),re=Symbol("allowStale"),J=Symbol("maxAge"),R=Symbol("dispose"),W=Symbol("noDisposeOnSet"),q=Symbol("lruList"),P=Symbol("cache"),ee=Symbol("updateAgeOnGet"),I=()=>1,se=(Te,je,we)=>{const ot=Te[P].get(je);if(ot){const _t=ot.value;if(ie(Te,_t)){if(de(Te,ot),!Te[re])return}else we&&(Te[ee]&&(ot.value.now=Date.now()),Te[q].unshiftNode(ot));return _t.value}},ie=(Te,je)=>{if(!je||!je.maxAge&&!Te[J])return!1;const we=Date.now()-je.now;return je.maxAge?we>je.maxAge:Te[J]&&we>Te[J]},K=Te=>{if(Te[U]>Te[$])for(let je=Te[q].tail;Te[U]>Te[$]&&je!==null;){const we=je.prev;de(Te,je),je=we}},de=(Te,je)=>{if(je){const we=je.value;Te[R]&&Te[R](we.key,we.value),Te[U]-=we.length,Te[P].delete(we.key),Te[q].removeNode(je)}};class pe{constructor(je,we,ot,_t,Ut){this.key=je,this.value=we,this.length=ot,this.now=_t,this.maxAge=Ut||0}}const Ae=(Te,je,we,ot)=>{let _t=we.value;ie(Te,_t)&&(de(Te,we),Te[re]||(_t=void 0)),_t&&je.call(ot,_t.value,_t.key,Te)};Oe.exports=class{constructor(Te){if(typeof Te=="number"&&(Te={max:Te}),Te||(Te={}),Te.max&&(typeof Te.max!="number"||Te.max<0))throw new TypeError("max must be a non-negative number");this[$]=Te.max||1/0;const je=Te.length||I;if(this[B]=typeof je!="function"?I:je,this[re]=Te.stale||!1,Te.maxAge&&typeof Te.maxAge!="number")throw new TypeError("maxAge must be a number");this[J]=Te.maxAge||0,this[R]=Te.dispose,this[W]=Te.noDisposeOnSet||!1,this[ee]=Te.updateAgeOnGet||!1,this.reset()}set max(Te){if(typeof Te!="number"||Te<0)throw new TypeError("max must be a non-negative number");this[$]=Te||1/0,K(this)}get max(){return this[$]}set allowStale(Te){this[re]=!!Te}get allowStale(){return this[re]}set maxAge(Te){if(typeof Te!="number")throw new TypeError("maxAge must be a non-negative number");this[J]=Te,K(this)}get maxAge(){return this[J]}set lengthCalculator(Te){typeof Te!="function"&&(Te=I),Te!==this[B]&&(this[B]=Te,this[U]=0,this[q].forEach(je=>{je.length=this[B](je.value,je.key),this[U]+=je.length})),K(this)}get lengthCalculator(){return this[B]}get length(){return this[U]}get itemCount(){return this[q].length}rforEach(Te,je){je=je||this;for(let we=this[q].tail;we!==null;){const ot=we.prev;Ae(this,Te,we,je),we=ot}}forEach(Te,je){je=je||this;for(let we=this[q].head;we!==null;){const ot=we.next;Ae(this,Te,we,je),we=ot}}keys(){return this[q].toArray().map(Te=>Te.key)}values(){return this[q].toArray().map(Te=>Te.value)}reset(){this[R]&&this[q]&&this[q].length&&this[q].forEach(Te=>this[R](Te.key,Te.value)),this[P]=new Map,this[q]=new b,this[U]=0}dump(){return this[q].map(Te=>!ie(this,Te)&&{k:Te.key,v:Te.value,e:Te.now+(Te.maxAge||0)}).toArray().filter(Te=>Te)}dumpLru(){return this[q]}set(Te,je,we){if((we=we||this[J])&&typeof we!="number")throw new TypeError("maxAge must be a number");const ot=we?Date.now():0,_t=this[B](je,Te);if(this[P].has(Te)){if(_t>this[$])return de(this,this[P].get(Te)),!1;const Xt=this[P].get(Te).value;return this[R]&&(this[W]||this[R](Te,Xt.value)),Xt.now=ot,Xt.maxAge=we,Xt.value=je,this[U]+=_t-Xt.length,Xt.length=_t,this.get(Te),K(this),!0}const Ut=new pe(Te,je,_t,ot,we);return Ut.length>this[$]?(this[R]&&this[R](Te,je),!1):(this[U]+=Ut.length,this[q].unshift(Ut),this[P].set(Te,this[q].head),K(this),!0)}has(Te){if(!this[P].has(Te))return!1;const je=this[P].get(Te).value;return!ie(this,je)}get(Te){return se(this,Te,!0)}peek(Te){return se(this,Te,!1)}pop(){const Te=this[q].tail;return Te?(de(this,Te),Te.value):null}del(Te){de(this,this[P].get(Te))}load(Te){this.reset();const je=Date.now();for(let we=Te.length-1;we>=0;we--){const ot=Te[we],_t=ot.e||0;if(_t===0)this.set(ot.k,ot.v);else{const Ut=_t-je;Ut>0&&this.set(ot.k,ot.v,Ut)}}}prune(){this[P].forEach((Te,je)=>se(this,je,!1))}}},function(Oe,A,a){const b=a(32),$=a(89),{re:U,t:B}=a(90);Oe.exports=(re,J)=>{if(re instanceof b)return re;if(typeof re=="number"&&(re=String(re)),typeof re!="string")return null;let R=null;if((J=J||{}).rtl){let W;for(;(W=U[B.COERCERTL].exec(re))&&(!R||R.index+R[0].length!==re.length);)R&&W.index+W[0].length===R.index+R[0].length||(R=W),U[B.COERCERTL].lastIndex=W.index+W[1].length+W[2].length;U[B.COERCERTL].lastIndex=-1}else R=re.match(U[B.COERCE]);return R===null?null:$(`${R[2]}.${R[3]||"0"}.${R[4]||"0"}`,J)}},function(Oe,A,a){const b=a(144);Oe.exports=($,U)=>$.sort((B,re)=>b(re,B,U))},function(Oe,A,a){const b=a(144);Oe.exports=($,U)=>$.sort((B,re)=>b(B,re,U))},function(Oe,A,a){const b=a(48);Oe.exports=($,U)=>b($,U,!0)},function(Oe,A,a){const b=a(48);Oe.exports=($,U,B)=>b(U,$,B)},function(Oe,A,a){const b=a(89);Oe.exports=($,U)=>{const B=b($,U);return B&&B.prerelease.length?B.prerelease:null}},function(Oe,A,a){const b=a(32);Oe.exports=($,U)=>new b($,U).patch},function(Oe,A,a){const b=a(32);Oe.exports=($,U)=>new b($,U).minor},function(Oe,A,a){const b=a(32);Oe.exports=($,U)=>new b($,U).major},function(Oe,A,a){const b=a(89),$=a(145);Oe.exports=(U,B)=>{if($(U,B))return null;{const re=b(U),J=b(B),R=re.prerelease.length||J.prerelease.length,W=R?"pre":"",q=R?"prerelease":"";for(const P in re)if((P==="major"||P==="minor"||P==="patch")&&re[P]!==J[P])return W+P;return q}}},function(Oe,A,a){const b=a(32);Oe.exports=($,U,B,re)=>{typeof B=="string"&&(re=B,B=void 0);try{return new b($,B).inc(U,re).version}catch{return null}}},function(Oe,A,a){const b=a(89);Oe.exports=($,U)=>{const B=b($.trim().replace(/^[=v]+/,""),U);return B?B.version:null}},function(Oe,A,a){const b=a(89);Oe.exports=($,U)=>{const B=b($,U);return B?B.version:null}},function(Oe,A,a){/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/var b=this&&this.__awaiter||function(W,q,P,ee){return new(P||(P=Promise))(function(I,se){function ie(pe){try{de(ee.next(pe))}catch(Ae){se(Ae)}}function K(pe){try{de(ee.throw(pe))}catch(Ae){se(Ae)}}function de(pe){pe.done?I(pe.value):new P(function(Ae){Ae(pe.value)}).then(ie,K)}de((ee=ee.apply(W,q||[])).next())})},$=this&&this.__importDefault||function(W){return W&&W.__esModule?W:{default:W}};Object.defineProperty(A,"__esModule",{value:!0});const U=$(a(88)),B=a(64),re=a(46);A.barchart=function(W,q,P={}){return b(this,void 0,void 0,function*(){const ee=re.getDrawArea(W),I=q,se=Object.assign({},J,P);if(R.has(ee)){const _t=R.get(ee);if(re.shallowEquals(se,_t.lastOptions)){yield re.nextFrame();const Ut=_t.view,Xt=Ut.changeset().remove(()=>!0).insert(I);return void(yield Ut.change("values",Xt).runAsync())}}const{xLabel:ie,yLabel:K,xType:de,yType:pe}=se;let Ae=null;ie!=null&&(Ae={title:ie});let Te,je=null;K!=null&&(je={title:K}),Te=se.color!=null?Array.isArray(se.color)?{field:"index",type:"nominal",scale:{range:se.color}}:{value:se.color}:{value:"#4C78A0"};const we={width:se.width||B.getDefaultWidth(ee),height:se.height||B.getDefaultHeight(ee),padding:0,autosize:{type:"fit",contains:"padding",resize:!0},config:{axis:{labelFontSize:se.fontSize,titleFontSize:se.fontSize},text:{fontSize:se.fontSize},legend:{labelFontSize:se.fontSize,titleFontSize:se.fontSize}},data:{values:I,name:"values"},mark:{type:"bar",tooltip:!0},encoding:{x:{field:"index",type:de,axis:Ae},y:{field:"value",type:pe,axis:je},color:Te}};yield re.nextFrame();const ot=yield U.default(ee,we,{actions:!1,mode:"vega-lite",defaultStyle:!1});R.set(ee,{view:ot.view,lastOptions:se})})};const J={xLabel:"",yLabel:"",xType:"ordinal",yType:"quantitative",fontSize:11},R=new Map},function(Oe,A,a){/**
* @license
* Copyright 2018 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Object.defineProperty(A,"__esModule",{value:!0});var b=a(25),$=a(103),U=a(33),B=a(74);function re(J){$.env().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(J+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}A.enableProdMode=function(){$.env().set("PROD",!0)},A.enableDebugMode=function(){$.env().set("DEBUG",!0)},A.disableDeprecationWarnings=function(){$.env().set("DEPRECATION_WARNINGS_ENABLED",!1),console.warn("TensorFlow.js deprecation warnings have been disabled.")},A.deprecationWarn=re,U.setDeprecationWarningFn(re),A.disposeVariables=function(){b.ENGINE.disposeVariables()},A.engine=function(){return b.ENGINE},A.memory=function(){return b.ENGINE.memory()},A.profile=function(J){return b.ENGINE.profile(J)},A.tidy=function(J,R){return b.ENGINE.tidy(J,R)},A.dispose=function(J){B.getTensorsInContainer(J).forEach(function(R){return R.dispose()})},A.keep=function(J){return b.ENGINE.keep(J)},A.time=function(J){return b.ENGINE.time(J)},A.setBackend=function(J){return b.ENGINE.setBackend(J)},A.ready=function(){return b.ENGINE.ready()},A.getBackend=function(){return b.ENGINE.backendName},A.removeBackend=function(J){b.ENGINE.removeBackend(J)},A.findBackend=function(J){return b.ENGINE.findBackend(J)},A.findBackendFactory=function(J){return b.ENGINE.findBackendFactory(J)},A.registerBackend=function(J,R,W){return W===void 0&&(W=1),b.ENGINE.registerBackend(J,R,W)},A.backend=function(){return b.ENGINE.backend},A.setPlatform=function(J,R){$.env().setPlatform(J,R)}},function(Oe,A,a){Object.defineProperty(A,"__esModule",{value:!0});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var b=a(350);A.warnDeprecation=function(){b.deprecationWarn("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon")},A.xAs4D=function($){return $.rank===0||$.rank===1?$.as4D(1,1,1,$.size):$.rank===2?$.as4D(1,1,$.shape[0],$.shape[1]):$.rank===3?$.as4D(1,$.shape[0],$.shape[1],$.shape[2]):$}},function(Oe,A,a){/**
* @license
* Copyright 2020 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Object.defineProperty(A,"__esModule",{value:!0});var b=a(25),$=a(29),U=a(21),B=a(351),re=a(28);function J(W,q,P,ee,I,se){se==null&&(se=.001);var ie,K,de=$.convertToTensor(W,"x","batchNorm"),pe=$.convertToTensor(q,"mean","batchNorm"),Ae=$.convertToTensor(P,"variance","batchNorm");I!=null&&(ie=$.convertToTensor(I,"scale","batchNorm")),ee!=null&&(K=$.convertToTensor(ee,"offset","batchNorm")),U.assert(pe.rank===Ae.rank,function(){return"Batch normalization gradient requires mean and variance to have equal ranks."}),U.assert(K==null||pe.rank===K.rank,function(){return"Batch normalization gradient requires mean and offset to have equal ranks."}),U.assert(ie==null||pe.rank===ie.rank,function(){return"Batch normalization gradient requires mean and scale to have equal ranks."});var Te={x:de,scale:ie,offset:K,mean:pe,variance:Ae},je={varianceEpsilon:se};return b.ENGINE.runKernelFunc(function(we,ot){var _t=B.xAs4D(de),Ut=we.batchNormalization(_t,R(pe),R(Ae),se,R(ie),R(K));return ot([de,pe,Ae,ie]),Ut},Te,null,"FusedBatchNorm",je).reshape(de.shape)}function R(W){return W==null?null:W.rank===0?W.as1D():W.rank===1?W:W.rank===2?W.as4D(1,1,W.shape[0],W.shape[1]):W.rank===3?W.as4D(1,W.shape[0],W.shape[1],W.shape[2]):W}A.batchNormalization=re.op({batchNormalization_:function(W,q,P,ee,I,se){return ee===void 0&&(ee=.001),B.warnDeprecation(),J(W,q,P,se,I,ee)}}),A.batchNorm=re.op({batchNorm_:J})},function(Oe,A,a){Object.defineProperty(A,"__esModule",{value:!0});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var b=a(352);a(33).Tensor.prototype.batchNorm=function($,U,B,re,J){return b.batchNorm(this,$,U,B,re,J)}},function(Oe,A,a){/**
* @license
* Copyright 2020 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Object.defineProperty(A,"__esModule",{value:!0});var b=a(25),$=a(73),U=a(29),B=a(28);A.pad=B.op({pad_:function(re,J,R){R===void 0&&(R=0);var W=U.convertToTensor(re,"x","pad");if(W.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var q={paddings:J,constantValue:R},P={x:W};return b.ENGINE.runKernelFunc(function(ee,I){return I([W]),ee.pad(W,J,R)},P,null,$.PadV2,q)}})},function(Oe,A,a){/**
* @license
* Copyright 2020 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Object.defineProperty(A,"__esModule",{value:!0});var b=a(354);a(33).Tensor.prototype.pad=function($,U){return b.pad(this,$,U)}},function(Oe,A,a){/**
* @license
* Copyright 2018 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Object.defineProperty(A,"__esModule",{value:!0});var b=a(25),$=a(29),U=a(21),B=a(28);A.transpose=B.op({transpose_:function(re,J){var R=$.convertToTensor(re,"x","transpose");if(J==null&&(J=R.shape.map(function(q,P){return P}).reverse()),U.assert(R.rank===J.length,function(){return"Error in transpose: rank of input "+R.rank+" must match length of perm "+J+"."}),J.forEach(function(q){U.assert(q>=0&&q<R.rank,function(){return"All entries in 'perm' must be between 0 and "+(R.rank-1)+" but got "+J})}),R.rank<=1)return R.clone();var W={perm:J};return b.ENGINE.runKernelFunc(function(q){return q.transpose(R,J)},{x:R},null,"Transpose",W)}})},function(Oe,A,a){/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Object.defineProperty(A,"__esModule",{value:!0});var b=a(356);a(33).Tensor.prototype.transpose=function($){return b.transpose(this,$)}},function(Oe,A,a){/**
* @license
* Copyright 2020 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Object.defineProperty(A,"__esModule",{value:!0});var b=a(25),$=a(73),U=a(29),B=a(28);A.oneHot=B.op({oneHot_:function(re,J,R,W){if(R===void 0&&(R=1),W===void 0&&(W=0),J<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+J);var q=U.convertToTensor(re,"indices","oneHot","int32"),P=q.shape.concat([J]),ee={indices:q=q.flatten()},I={depth:J,onValue:R,offValue:W};return b.ENGINE.runKernelFunc(function(se,ie){return ie([q]),se.oneHot(q,J,R,W)},ee,null,$.OneHot,I).reshape(P)}})},function(Oe,A,a){/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Object.defineProperty(A,"__esModule",{value:!0});var b=a(358);a(33).Tensor.prototype.oneHot=function($,U,B){return U===void 0&&(U=1),B===void 0&&(B=0),b.oneHot(this,$,U,B)}},function(Oe,A,a){/**
* @license
* Copyright 2020 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Object.defineProperty(A,"__esModule",{value:!0});var b=a(25),$=a(73),U=a(29),B=a(21),re=a(28);A.tile=re.op({tile_:function(J,R){var W=U.convertToTensor(J,"x","tile",null);B.assert(W.rank===R.length,function(){return"Error in transpose: rank of input "+W.rank+" must match length of reps "+R+"."});var q=[W],P={x:W},ee={reps:R};return b.ENGINE.runKernelFunc(function(I,se){var ie=I.tile(W,R);return se([W]),ie},P,null,$.Tile,ee,q)}})},function(Oe,A,a){/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Object.defineProperty(A,"__esModule",{value:!0});var b=a(360);a(33).Tensor.prototype.tile=function($){return b.tile(this,$)}},function(Oe,A,a){/**
* @license
* Copyright 2020 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Object.defineProperty(A,"__esModule",{value:!0});var b=a(25),$=a(73),U=a(74),B=a(29),re=a(147),J=a(28),R=a(91);A.squaredDifference=J.op({squaredDifference_:function(W,q){var P,ee=B.convertToTensor(W,"a","squaredDifference"),I=B.convertToTensor(q,"b","squaredDifference");P=U.makeTypesMatch(ee,I),ee=P[0],I=P[1],re.assertAndGetBroadcastShape(ee.shape,I.shape);var se={a:ee,b:I},ie=[ee,I];return b.ENGINE.runKernelFunc(function(K,de){var pe=K.squaredDifference(ee,I);return de([ee,I]),pe},se,function(K,de){var pe=de[0],Ae=de[1],Te=R.scalar(2);return{a:function(){return K.mul(pe.sub(Ae).mul(Te))},b:function(){return K.mul(Ae.sub(pe).mul(Te))}}},$.SquaredDifference,{},ie,[])}})},function(Oe,A,a){/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Object.defineProperty(A,"__esModule",{value:!0});var b=a(362);a(33).Tensor.prototype.squaredDifference=function($){return b.squaredDifference(this,$)}},function(Oe,A,a){/**
* @license
* Copyright 2017 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Object.defineProperty(A,"__esModule",{value:!0});var b=a(21);A.assertParamsConsistent=function($,U){var B=$[0].length;$.forEach(function(J,R){b.assert(J.length===B,function(){return"Error in concat"+B+"D: rank of tensors["+R+"] must be the same as the rank of the rest ("+B+")"})}),b.assert(U>=0&&U<B,function(){return"Error in concat"+B+"D: axis must be between 0 and "+(B-1)+"."});var re=$[0];$.forEach(function(J,R){for(var W=0;W<B;W++)b.assert(W===U||J[W]===re[W],function(){return"Error in concat"+B+"D: Shape of tensors["+R+"] ("+J+") does not match the shape of the rest ("+re+") along the non-concatenated axis "+R+"."})})},A.computeOutShape=function($,U){for(var B=$[0].slice(),re=1;re<$.length;re++)B[U]+=$[re][U];return B}},function(Oe,A,a){/**
* @license
* Copyright 2018 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Object.defineProperty(A,"__esModule",{value:!0});var b=a(25),$=a(29),U=a(21),B=a(21),re=a(364),J=a(28),R=a(91);A.concat=J.op({concat_:function(W,q){q===void 0&&(q=0),U.assert(W.length>=1,function(){return"Pass at least one tensor to concat"});var P=$.convertToTensorArray(W,"tensors","concat");P[0].dtype==="complex64"&&P.forEach(function(K){if(K.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype `+K.dtype+". ")}),q=B.parseAxisParam(q,P[0].shape)[0];var ee=re.computeOutShape(P.map(function(K){return K.shape}),q);if(U.sizeFromShape(ee)===0)return R.tensor([],ee);if((P=P.filter(function(K){return K.size>0})).length===1)return P[0];var I=P.map(function(K){return K.shape});re.assertParamsConsistent(I,q);var se=P,ie={axis:q};return b.ENGINE.runKernelFunc(function(K){return K.concat(P,q)},se,function(K){var de=I.map(function(pe){return pe[q]});return A.split(K,de,q).map(function(pe){return function(){return pe}})},"Concat",ie)}}),A.concat1d=J.op({concat1d_:function(W){return A.concat(W,0)}}),A.concat2d=J.op({concat2d_:function(W,q){return A.concat(W,q)}}),A.concat3d=J.op({concat3d_:function(W,q){return A.concat(W,q)}}),A.concat4d=J.op({concat4d_:function(W,q){return A.concat(W,q)}}),A.split=J.op({split_:function(W,q,P){P===void 0&&(P=0);var ee,I=$.convertToTensor(W,"x","split");return P=B.parseAxisParam(P,I.shape)[0],typeof q=="number"?(U.assert(I.shape[P]%q==0,function(){return"Number of splits must evenly divide the axis."}),ee=new Array(q).fill(I.shape[P]/q)):(U.assert(I.shape[P]===q.reduce(function(se,ie){return se+ie}),function(){return"The sum of sizes must match the size of the axis dimension."}),ee=q),b.ENGINE.runKernelFunc(function(se){return se.split(I,ee,P)},{$x:I},function(se){return{$x:function(){return A.concat(se,P)}}})}})},function(Oe,A,a){/**
* @license
* Copyright 2017 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Object.defineProperty(A,"__esModule",{value:!0});var b=a(21);function $(B,re){for(var J=0;J<B.length;++J)if(B[B.length-J-1]!==re-1-J)return!1;return!0}function U(B,re,J){for(var R=B.length+re.length,W=[],q=0,P=0,ee=0;ee<R;ee++)J.indexOf(ee)===-1?W.push(B[q++]):W.push(re[P++]);return W}A.axesAreInnerMostDims=$,A.combineLocations=U,A.computeOutAndReduceShapes=function(B,re){for(var J=[],R=B.length,W=0;W<R;W++)re.indexOf(W)===-1&&J.push(B[W]);return[J,re.map(function(q){return B[q]})]},A.expandShapeToKeepDim=function(B,re){return U(B,re.map(function(J){return 1}),re)},A.assertAxesAreInnerMostDims=function(B,re,J){b.assert($(re,J),function(){return B+" supports only inner-most axes for now. Got axes "+re+" and rank-"+J+" input."})},A.getAxesPermutation=function(B,re){if($(B,re))return null;for(var J=[],R=0;R<re;++R)B.indexOf(R)===-1&&J.push(R);return B.forEach(function(W){return J.push(W)}),J},A.getUndoAxesPermutation=function(B){return B.map(function(re,J){return[J,re]}).sort(function(re,J){return re[1]-J[1]}).map(function(re){return re[0]})},A.getInnerMostAxes=function(B,re){for(var J=[],R=re-B;R<re;++R)J.push(R);return J}},function(Oe,A,a){/**
* @license
* Copyright 2018 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/var b=this&&this.__awaiter||function(P,ee,I,se){return new(I||(I=Promise))(function(ie,K){function de(Te){try{Ae(se.next(Te))}catch(je){K(je)}}function pe(Te){try{Ae(se.throw(Te))}catch(je){K(je)}}function Ae(Te){Te.done?ie(Te.value):new I(function(je){je(Te.value)}).then(de,pe)}Ae((se=se.apply(P,ee||[])).next())})},$=this&&this.__generator||function(P,ee){var I,se,ie,K,de={label:0,sent:function(){if(1&ie[0])throw ie[1];return ie[1]},trys:[],ops:[]};return K={next:pe(0),throw:pe(1),return:pe(2)},typeof Symbol=="function"&&(K[Symbol.iterator]=function(){return this}),K;function pe(Ae){return function(Te){return function(je){if(I)throw new TypeError("Generator is already executing.");for(;de;)try{if(I=1,se&&(ie=2&je[0]?se.return:je[0]?se.throw||((ie=se.return)&&ie.call(se),0):se.next)&&!(ie=ie.call(se,je[1])).done)return ie;switch(se=0,ie&&(je=[2&je[0],ie.value]),je[0]){case 0:case 1:ie=je;break;case 4:return de.label++,{value:je[1],done:!1};case 5:de.label++,se=je[1],je=[0];continue;case 7:je=de.ops.pop(),de.trys.pop();continue;default:if(!(ie=(ie=de.trys).length>0&&ie[ie.length-1])&&(je[0]===6||je[0]===2)){de=0;continue}if(je[0]===3&&(!ie||je[1]>ie[0]&&je[1]<ie[3])){de.label=je[1];break}if(je[0]===6&&de.label<ie[1]){de.label=ie[1],ie=je;break}if(ie&&de.label<ie[2]){de.label=ie[2],de.ops.push(je);break}ie[2]&&de.ops.pop(),de.trys.pop();continue}je=ee.call(P,de)}catch(we){je=[6,we],se=0}finally{I=ie=0}if(5&je[0])throw je[1];return{value:je[0]?je[1]:void 0,done:!0}}([Ae,Te])}}};Object.defineProperty(A,"__esModule",{value:!0});var U=a(25),B=a(33),re=a(29),J=a(21),R=a(366),W=a(365),q=a(28);A.buffer=function(P,ee,I){return ee===void 0&&(ee="float32"),ee=ee||"float32",J.assertNonNegativeIntegerDimensions(P),new B.TensorBuffer(P,ee,I)},A.print=function(P,ee){ee===void 0&&(ee=!1),console.log(P.toString(ee))},A.batchToSpaceND=q.op({batchToSpaceND_:function(P,ee,I){var se=re.convertToTensor(P,"x","batchToSpaceND"),ie=ee.reduce(function(K,de){return K*de});return J.assert(se.rank>=1+ee.length,function(){return"input rank is "+se.rank+" but should be > than blockShape.length "+ee.length}),J.assert(I.length===ee.length,function(){return"crops.length is "+I.length+" but should be equal to blockShape.length  "+ee.length}),J.assert(se.shape[0]%ie==0,function(){return"input tensor batch is "+se.shape[0]+" but is not divisible by the product of the elements of blockShape "+ee.join(" * ")+" === "+ie}),U.ENGINE.runKernelFunc(function(K){return K.batchToSpaceND(se,ee,I)},{$x:se},function(K){return{$x:function(){return K.spaceToBatchND(ee,I)}}})}}),A.cast=q.op({cast_:function(P,ee){var I=re.convertToTensor(P,"x","cast");if(!J.isValidDtype(ee))throw new Error("Failed to cast to unknown dtype "+ee);if(ee==="string"&&I.dtype!=="string"||ee!=="string"&&I.dtype==="string")throw new Error("Only strings can be casted to strings");var se={dtype:ee};return U.ENGINE.runKernelFunc(function(ie){return ie.cast(I,ee)},{x:I},function(ie){return{x:function(){return ie.clone()}}},"Cast",se)}}),A.cumsum=q.op({cumsum_:function(P,ee,I,se){ee===void 0&&(ee=0),I===void 0&&(I=!1),se===void 0&&(se=!1);var ie=re.convertToTensor(P,"x","cumsum");ee|=0;var K=R.getAxesPermutation([ee],ie.rank),de=ie;K!=null&&(de=ie.transpose(K));var pe=R.getInnerMostAxes(1,ie.rank)[0],Ae=U.ENGINE.runKernelFunc(function(Te){return Te.cumsum(de,pe,I,se)},{permutedX:de},function(Te){return{permutedX:function(){return Te.cumsum(ee,I,!se)}}});return K!=null&&(Ae=Ae.transpose(K)),Ae}}),A.depthToSpace=q.op({depthToSpace_:function(P,ee,I){I===void 0&&(I="NHWC");var se=re.convertToTensor(P,"x","depthToSpace"),ie=I==="NHWC"?se.shape[1]:se.shape[2],K=I==="NHWC"?se.shape[2]:se.shape[3],de=I==="NHWC"?se.shape[3]:se.shape[1];return J.assert(ie*ee>=0,function(){return`Negative dimension size caused by overflow when multiplying
      `+ie+" and "+ee+`  for depthToSpace with input shape
      `+se.shape}),J.assert(K*ee>=0,function(){return`Negative dimension size caused by overflow when multiplying
      `+K+" and "+ee+` for depthToSpace with input shape
          `+se.shape}),J.assert(de%(ee*ee)==0,function(){return"Dimension size must be evenly divisible by "+ee*ee+" but is "+de+" for depthToSpace with input shape "+se.shape}),U.ENGINE.runKernelFunc(function(pe){return pe.depthToSpace(se,ee,I)},{$x:se})}}),A.expandDims=q.op({expandDims_:function(P,ee){ee===void 0&&(ee=0);var I=re.convertToTensor(P,"x","expandDims",null);J.assert(ee<=I.rank,function(){return"Axis must be <= rank of the tensor"});var se=I.shape.slice();return ee<0&&(J.assert(-(I.rank+1)<=ee,function(){return"Axis must be in the interval ["+-(I.rank+1)+", "+I.rank+"]"}),ee=I.rank+ee+1),se.splice(ee,0,1),A.reshape(I,se)}}),A.reshape=q.op({reshape_:function(P,ee){var I=re.convertToTensor(P,"x","reshape",null);ee=J.inferFromImplicitShape(ee,I.size),J.assert(I.size===J.sizeFromShape(ee),function(){return"new shape and old shape must have the same number of elements."});var se={shape:ee};return U.ENGINE.runKernelFunc(function(ie){return ie.reshape(I,ee)},{x:I},function(ie){return{x:function(){return ie.reshape(I.shape)}}},"Reshape",se)}}),A.spaceToBatchND=q.op({spaceToBatchND_:function(P,ee,I){var se=re.convertToTensor(P,"x","spaceToBatchND");return J.assert(se.rank>=1+ee.length,function(){return"input rank "+se.rank+" should be > than [blockShape] "+ee.length}),J.assert(I.length===ee.length,function(){return"paddings.shape[0] "+I.length+" must be equal to [blockShape] "+ee.length}),J.assert(se.shape.reduce(function(ie,K,de){return de>0&&de<=ee.length?ie&&(K+I[de-1][0]+I[de-1][1])%ee[de-1]==0:ie},!0),function(){return"input spatial dimensions "+se.shape.slice(1)+" with paddings "+I.toString()+" must be divisible by blockShapes "+ee.toString()}),U.ENGINE.runKernelFunc(function(ie){return ie.spaceToBatchND(se,ee,I)},{$x:se},function(ie){return{$x:function(){return ie.batchToSpaceND(ee,I)}}})}}),A.squeeze=q.op({squeeze_:function(P,ee){var I=re.convertToTensor(P,"x","squeeze");return A.reshape(I,J.squeezeShape(I.shape,ee).newShape)}}),A.stack=q.op({stack_:function(P,ee){ee===void 0&&(ee=0);var I=re.convertToTensorArray(P,"tensors","stack");if(J.assert(I.length>=1,function(){return"Pass at least one tensor to tf.stack"}),I.length===1)return I[0].expandDims(ee);var se=I[0].rank,ie=I[0].shape,K=I[0].dtype;J.assert(ee<=se,function(){return"Axis must be <= rank of the tensor"}),I.forEach(function(pe){J.assertShapesMatch(ie,pe.shape,"All tensors passed to stack must have matching shapes")}),I.forEach(function(pe){J.assert(K===pe.dtype,function(){return"All tensors passed to stack must have matching dtypes"})});var de=I.map(function(pe){return pe.expandDims(ee)});return W.concat(de,ee)}}),A.unstack=q.op({unstack_:function(P,ee){ee===void 0&&(ee=0),ee=ee||0;var I=re.convertToTensor(P,"x","unstack");J.assert(ee>=-I.shape.length&&ee<I.shape.length,function(){return"Axis = "+ee+" is not in [-"+I.shape.length+", "+I.shape.length+")"}),ee<0&&(ee+=I.shape.length);var se={axis:ee};return U.ENGINE.runKernelFunc(function(ie){return ie.unstack(I,ee)},{x:I},function(ie){return{x:function(){return A.stack(ie,ee)}}},"Unpack",se)}}),A.setdiff1dAsync=function(P,ee){return b(this,void 0,void 0,function(){var I,se,ie,K,de,pe,Ae,Te,je,we;return $(this,function(ot){switch(ot.label){case 0:return I=re.convertToTensor(P,"x","setdiff1d"),se=re.convertToTensor(ee,"y","setdiff1d"),J.assert(I.dtype===se.dtype,function(){return"x and y should have the same dtype, but got x ("+I.dtype+") and y ("+se.dtype+")."}),J.assert(I.rank===1,function(){return"x should be 1D tensor, but got x ("+I.shape+")."}),J.assert(se.rank===1,function(){return"y should be 1D tensor, but got y ("+se.shape+")."}),[4,I.data()];case 1:return ie=ot.sent(),[4,se.data()];case 2:for(K=ot.sent(),de=new Set(K),pe=0,je=0;je<ie.length;je++)de.has(ie[je])||pe++;for(Ae=new B.TensorBuffer([pe],I.dtype),Te=new B.TensorBuffer([pe],"int32"),je=0,we=0;je<ie.length;je++)de.has(ie[je])||(Ae.values[we]=ie[je],Te.values[we]=je,we++);return[2,[Ae.toTensor(),Te.toTensor()]]}})})}},function(Oe,A,a){/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Object.defineProperty(A,"__esModule",{value:!0});var b=a(367);A.whereImpl=function($,U){for(var B=[],re=0;re<U.length;re++)U[re]&&B.push(re);var J=b.buffer($,"int32"),R=b.buffer([B.length,$.length],"int32");for(re=0;re<B.length;re++){var W=J.indexToLoc(B[re]),q=re*$.length;R.values.set(W,q)}return R.toTensor()}},function(Oe,A,a){/**
* @license
* Copyright 2018 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/var b=this&&this.__awaiter||function(P,ee,I,se){return new(I||(I=Promise))(function(ie,K){function de(Te){try{Ae(se.next(Te))}catch(je){K(je)}}function pe(Te){try{Ae(se.throw(Te))}catch(je){K(je)}}function Ae(Te){Te.done?ie(Te.value):new I(function(je){je(Te.value)}).then(de,pe)}Ae((se=se.apply(P,ee||[])).next())})},$=this&&this.__generator||function(P,ee){var I,se,ie,K,de={label:0,sent:function(){if(1&ie[0])throw ie[1];return ie[1]},trys:[],ops:[]};return K={next:pe(0),throw:pe(1),return:pe(2)},typeof Symbol=="function"&&(K[Symbol.iterator]=function(){return this}),K;function pe(Ae){return function(Te){return function(je){if(I)throw new TypeError("Generator is already executing.");for(;de;)try{if(I=1,se&&(ie=2&je[0]?se.return:je[0]?se.throw||((ie=se.return)&&ie.call(se),0):se.next)&&!(ie=ie.call(se,je[1])).done)return ie;switch(se=0,ie&&(je=[2&je[0],ie.value]),je[0]){case 0:case 1:ie=je;break;case 4:return de.label++,{value:je[1],done:!1};case 5:de.label++,se=je[1],je=[0];continue;case 7:je=de.ops.pop(),de.trys.pop();continue;default:if(!(ie=(ie=de.trys).length>0&&ie[ie.length-1])&&(je[0]===6||je[0]===2)){de=0;continue}if(je[0]===3&&(!ie||je[1]>ie[0]&&je[1]<ie[3])){de.label=je[1];break}if(je[0]===6&&de.label<ie[1]){de.label=ie[1],ie=je;break}if(ie&&de.label<ie[2]){de.label=ie[2],de.ops.push(je);break}ie[2]&&de.ops.pop(),de.trys.pop();continue}je=ee.call(P,de)}catch(we){je=[6,we],se=0}finally{I=ie=0}if(5&je[0])throw je[1];return{value:je[0]?je[1]:void 0,done:!0}}([Ae,Te])}}};Object.defineProperty(A,"__esModule",{value:!0});var U=a(368),B=a(25),re=a(29),J=a(21),R=a(147),W=a(28),q=a(91);A.logicalAnd=W.op({logicalAnd_:function(P,ee){var I=re.convertToTensor(P,"a","logicalAnd","bool"),se=re.convertToTensor(ee,"b","logicalAnd","bool");return R.assertAndGetBroadcastShape(I.shape,se.shape),B.ENGINE.runKernelFunc(function(ie){return ie.logicalAnd(I,se)},{a:I,b:se},null,"LogicalAnd")}}),A.logicalNot=W.op({logicalNot_:function(P){var ee=re.convertToTensor(P,"x","logicalNot","bool");return B.ENGINE.runKernelFunc(function(I){return I.logicalNot(ee)},{$x:ee})}}),A.logicalOr=W.op({logicalOr_:function(P,ee){var I=re.convertToTensor(P,"a","logicalOr","bool"),se=re.convertToTensor(ee,"b","logicalOr","bool");return R.assertAndGetBroadcastShape(I.shape,se.shape),B.ENGINE.runKernelFunc(function(ie){return ie.logicalOr(I,se)},{$a:I,$b:se})}}),A.logicalXor=W.op({logicalXor_:function(P,ee){var I=re.convertToTensor(P,"a","logicalXor","bool"),se=re.convertToTensor(ee,"b","logicalXor","bool");return R.assertAndGetBroadcastShape(I.shape,se.shape),A.logicalOr(P,ee).logicalAnd(A.logicalAnd(P,ee).logicalNot())}}),A.where=W.op({where_:function(P,ee,I){var se=re.convertToTensor(ee,"a","where"),ie=re.convertToTensor(I,"b","where"),K=re.convertToTensor(P,"condition","where","bool");return J.assertShapesMatch(se.shape,ie.shape,"Error in where: "),K.rank===1?J.assert(K.shape[0]===se.shape[0],function(){return"The first dimension of `a` must match the size of `condition`."}):J.assertShapesMatch(K.shape,ie.shape,"Error in where: "),B.ENGINE.runKernelFunc(function(de,pe){var Ae=de.select(K,se,ie);return pe([K]),Ae},{$condition:K,$a:se,$b:ie},function(de,pe){var Ae=pe[0];return{$condition:function(){return q.zerosLike(Ae).toFloat()},$a:function(){return de.mul(Ae.cast(de.dtype))},$b:function(){return de.mul(Ae.logicalNot().cast(de.dtype))}}})}}),A.whereAsync=function(P){return b(this,void 0,void 0,function(){var ee,I,se;return $(this,function(ie){switch(ie.label){case 0:return[4,(ee=re.convertToTensor(P,"condition","whereAsync","bool")).data()];case 1:return I=ie.sent(),se=U.whereImpl(ee.shape,I),P!==ee&&ee.dispose(),[2,se]}})})}},function(Oe,A,a){/**
* @license
* Copyright 2020 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Object.defineProperty(A,"__esModule",{value:!0});var b=a(74),$=a(29),U=a(205),B=a(369),re=a(28),J=a(91);A.divNoNan=re.op({divNoNan_:function(R,W){var q,P=$.convertToTensor(R,"a","div"),ee=$.convertToTensor(W,"b","div");P=(q=b.makeTypesMatch(P,ee))[0],ee=q[1];var I=U.div(P,ee),se=J.zerosLike(I),ie=ee.equal(se);return B.where(ie,se,I)}})},function(Oe,A,a){/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Object.defineProperty(A,"__esModule",{value:!0});var b=a(370);a(33).Tensor.prototype.divNoNan=function($){return b.divNoNan(this,$)}},function(Oe,A,a){/**
* @license
* Copyright 2018 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Object.defineProperty(A,"__esModule",{value:!0});var b=a(25),$=a(29),U=a(21),B=a(28),re=a(91);A.abs=B.op({abs_:function(J){var R=$.convertToTensor(J,"x","abs");return R.dtype==="complex64"?b.ENGINE.runKernelFunc(function(W){return W.complexAbs(R)},{$x:R}):b.ENGINE.runKernelFunc(function(W,q){var P=W.abs(R);return q([R]),P},{x:R},function(W,q){var P=q[0];return{x:function(){return W.mul(P.toFloat().step(-1))}}},"Abs")}}),A.acos=B.op({acos_:function(J){var R=$.convertToTensor(J,"x","acos");return b.ENGINE.runKernelFunc(function(W,q){var P=W.acos(R);return q([R]),P},{$x:R},function(W,q){var P=q[0];return{$x:function(){return W.divStrict(re.scalar(1).sub(P.toFloat().square()).sqrt()).neg()}}})}}),A.acosh=B.op({acosh_:function(J){var R=$.convertToTensor(J,"x","acosh");return b.ENGINE.runKernelFunc(function(W,q){var P=W.acosh(R);return q([R]),P},{$x:R},function(W,q){var P=q[0];return{$x:function(){return W.divStrict(P.toFloat().square().sub(1).sqrt())}}})}}),A.asin=B.op({asin_:function(J){var R=$.convertToTensor(J,"x","asin");return b.ENGINE.runKernelFunc(function(W,q){var P=W.asin(R);return q([R]),P},{$x:R},function(W,q){var P=q[0];return{$x:function(){return W.divStrict(re.scalar(1).sub(P.toFloat().square()).sqrt())}}})}}),A.asinh=B.op({asinh_:function(J){var R=$.convertToTensor(J,"x","asinh");return b.ENGINE.runKernelFunc(function(W,q){var P=W.asinh(R);return q([R]),P},{$x:R},function(W,q){var P=q[0];return{$x:function(){return W.divStrict(re.scalar(1).add(P.toFloat().square()).sqrt())}}})}}),A.atan=B.op({atan_:function(J){var R=$.convertToTensor(J,"x","atan");return b.ENGINE.runKernelFunc(function(W,q){var P=W.atan(R);return q([R]),P},{$x:R},function(W,q){var P=q[0];return{$x:function(){return W.div(P.toFloat().square().add(1))}}})}}),A.atanh=B.op({atanh_:function(J){var R=$.convertToTensor(J,"x","atanh");return b.ENGINE.runKernelFunc(function(W,q){var P=W.atanh(R);return q([R]),P},{$x:R},function(W,q){var P=q[0];return{$x:function(){return W.div(re.scalar(1).sub(P.toFloat().square()))}}})}}),A.ceil=B.op({ceil_:function(J){var R=$.convertToTensor(J,"x","ceil");return b.ENGINE.runKernelFunc(function(W){return W.ceil(R)},{$x:R},function(W){return{$x:function(){return re.zerosLike(W)}}})}}),A.clipByValue=B.op({clipByValue_:function(J,R,W){var q=$.convertToTensor(J,"x","clipByValue");U.assert(R<=W,function(){return"Error in clip: min ("+R+") must be less than or equal to max ("+W+")."});var P=[q],ee={min:R,max:W};return b.ENGINE.runKernelFunc(function(I,se){var ie=I.clip(q,R,W);return se([q]),ie},{x:q},function(I,se){var ie=se[0];return{x:function(){return I.where(ie.greaterEqual(R).logicalAnd(ie.lessEqual(W)),re.zerosLike(I))}}},"ClipByValue",ee,P)}}),A.cos=B.op({cos_:function(J){var R=$.convertToTensor(J,"x","cos"),W=[R];return b.ENGINE.runKernelFunc(function(q,P){var ee=q.cos(R);return P([R]),ee},{x:R},function(q,P){var ee=P[0];return{x:function(){return ee.toFloat().sin().neg().mul(q)}}},"Cos",{},W)}}),A.cosh=B.op({cosh_:function(J){var R=$.convertToTensor(J,"x","cosh");return b.ENGINE.runKernelFunc(function(W,q){var P=W.cosh(R);return q([R]),P},{$x:R},function(W,q){var P=q[0];return{$x:function(){return P.toFloat().sinh().mulStrict(W)}}})}}),A.erf=B.op({erf_:function(J){var R=$.convertToTensor(J,"x","erf");return U.assert(R.dtype==="int32"||R.dtype==="float32",function(){return"Input dtype must be `int32` or `float32`."}),R.dtype==="int32"&&(R=R.toFloat()),b.ENGINE.runKernelFunc(function(W,q){var P=W.erf(R);return q([R]),P},{$x:R},function(W,q){var P=q[0];return{$x:function(){return W.mul(P.square().neg().exp().mul(2/Math.sqrt(Math.PI)))}}})}}),A.exp=B.op({exp_:function(J){var R=$.convertToTensor(J,"x","exp");return b.ENGINE.runKernelFunc(function(W,q){var P=W.exp(R);return q([P]),P},{x:R},function(W,q){return{x:function(){return W.mulStrict(q[0])}}},"Exp",{},[],[!0])}}),A.expm1=B.op({expm1_:function(J){var R=$.convertToTensor(J,"x","expm1");return b.ENGINE.runKernelFunc(function(W,q){var P=W.expm1(R);return q([R]),P},{$x:R},function(W,q){var P=q[0];return{$x:function(){return W.mul(P.exp())}}})}}),A.floor=B.op({floor_:function(J){var R=$.convertToTensor(J,"x","floor");return b.ENGINE.runKernelFunc(function(W){return W.floor(R)},{$x:R},function(W){return{$x:function(){return re.zerosLike(W)}}})}}),A.log=B.op({log_:function(J){var R=$.convertToTensor(J,"x","log"),W=[R];return b.ENGINE.runKernelFunc(function(q,P){var ee=q.log(R);return P([R]),ee},{x:R},function(q,P){var ee=P[0];return{x:function(){return q.div(ee.toFloat())}}},"Log",{},W)}}),A.log1p=B.op({log1p_:function(J){var R=$.convertToTensor(J,"x","log1p");return b.ENGINE.runKernelFunc(function(W,q){var P=W.log1p(R);return q([R]),P},{$x:R},function(W,q){var P=q[0];return{$x:function(){return W.div(P.add(1))}}})}}),A.logSigmoid=B.op({logSigmoid_:function(J){var R=$.convertToTensor(J,"x","logSigmoid");return b.ENGINE.runKernelFunc(function(W,q){var P=W.softplus(R.neg()).neg();return q([R]),P},{$x:R},function(W,q){var P=q[0];return{$x:function(){return W.mul(P.neg().sigmoid())}}})}}),A.neg=B.op({neg_:function(J){var R=$.convertToTensor(J,"x","neg"),W=[R];return b.ENGINE.runKernelFunc(function(q){return q.neg(R)},{x:R},function(q){return{x:function(){return q.neg()}}},"Neg",{},W)}}),A.reciprocal=B.op({reciprocal_:function(J){var R=$.convertToTensor(J,"x","reciprocal");return b.ENGINE.runKernelFunc(function(W,q){var P=W.reciprocal(R);return q([R]),P},{$x:R},function(W,q){var P=q[0];return{$x:function(){return W.div(P.square().neg())}}})}}),A.round=B.op({round_:function(J){var R=$.convertToTensor(J,"x","round");return b.ENGINE.runKernelFunc(function(W){return W.round(R)},{$x:R},function(W){return{$x:function(){return re.zerosLike(W)}}})}}),A.rsqrt=B.op({rsqrt_:function(J){var R=$.convertToTensor(J,"x","rsqrt"),W=[R];return b.ENGINE.runKernelFunc(function(q,P){var ee=q.rsqrt(R);return P([R]),ee},{x:R},function(q,P){var ee=P[0];return{x:function(){return q.div(ee.pow(1.5).mul(2)).neg()}}},"Rsqrt",{},W)}}),A.sigmoid=B.op({sigmoid_:function(J){var R=$.convertToTensor(J,"x","sigmoid");return b.ENGINE.runKernelFunc(function(W,q){var P=W.sigmoid(R);return q([P]),P},{x:R},function(W,q){var P=q[0];return{x:function(){return W.mul(P.mul(re.scalar(1).sub(P)))}}},"Sigmoid")}}),A.sign=B.op({sign_:function(J){var R=$.convertToTensor(J,"x","sign");return b.ENGINE.runKernelFunc(function(W){return W.sign(R)},{$x:R},function(W){return{$x:function(){return re.zerosLike(W)}}})}}),A.isNaN=B.op({isNaN_:function(J){var R=$.convertToTensor(J,"x","isNaN");return b.ENGINE.runKernelFunc(function(W){return W.isNaN(R)},{$x:R},function(W){return{$x:function(){return re.zerosLike(W)}}})}}),A.isInf=B.op({isInf_:function(J){var R=$.convertToTensor(J,"x","isInf");return b.ENGINE.runKernelFunc(function(W){return W.isInf(R)},{$x:R},function(W){return{$x:function(){return re.zerosLike(W)}}})}}),A.isFinite=B.op({isFinite_:function(J){var R=$.convertToTensor(J,"x","isFinite");return b.ENGINE.runKernelFunc(function(W){return W.isFinite(R)},{$x:R},function(W){return{$x:function(){return re.zerosLike(W)}}})}}),A.sin=B.op({sin_:function(J){var R=$.convertToTensor(J,"x","sin"),W=[R];return b.ENGINE.runKernelFunc(function(q,P){var ee=q.sin(R);return P([R]),ee},{x:R},function(q,P){var ee=P[0];return{x:function(){return ee.toFloat().cos().mul(q)}}},"Sin",{},W)}}),A.sinh=B.op({sinh_:function(J){var R=$.convertToTensor(J,"x","sinh");return b.ENGINE.runKernelFunc(function(W,q){var P=W.sinh(R);return q([R]),P},{$x:R},function(W,q){var P=q[0];return{$x:function(){return P.toFloat().cosh().mulStrict(W)}}})}}),A.softplus=B.op({softplus_:function(J){var R=$.convertToTensor(J,"x","softplus");return b.ENGINE.runKernelFunc(function(W,q){var P=W.softplus(R);return q([R]),P},{$x:R},function(W,q){var P=q[0];return{$x:function(){return W.mul(P.sigmoid())}}})}}),A.sqrt=B.op({sqrt_:function(J){var R=$.convertToTensor(J,"x","sqrt");return b.ENGINE.runKernelFunc(function(W,q){var P=W.sqrt(R);return q([R]),P},{$x:R},function(W,q){var P=q[0];return{$x:function(){return W.div(P.toFloat().sqrt().mul(2))}}})}}),A.step=B.op({step_:function(J,R){R===void 0&&(R=0);var W=$.convertToTensor(J,"x","step");return b.ENGINE.runKernelFunc(function(q){return q.step(W,R)},{$x:W},function(q){return{$x:function(){return re.zerosLike(q)}}})}}),A.tan=B.op({tan_:function(J){var R=$.convertToTensor(J,"x","tan");return b.ENGINE.runKernelFunc(function(W,q){var P=W.tan(R);return q([R]),P},{$x:R},function(W,q){var P=q[0];return{$x:function(){return W.div(P.cos().square())}}})}}),A.tanh=B.op({tanh_:function(J){var R=$.convertToTensor(J,"x","tanh");return b.ENGINE.runKernelFunc(function(W,q){var P=W.tanh(R);return q([P]),P},{x:R},function(W,q){var P=q[0];return{x:function(){return re.scalar(1).sub(P.square()).mulStrict(W)}}},"Tanh",{},null,[!0])}})},function(Oe,A,a){Object.defineProperty(A,"__esModule",{value:!0});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var b=a(25),$=a(29),U=a(21),B=a(28);A.complex=B.op({complex_:function(re,J){var R=$.convertToTensor(re,"real","complex"),W=$.convertToTensor(J,"imag","complex");return U.assertShapesMatch(R.shape,W.shape,"real and imag shapes, "+R.shape+" and "+W.shape+", must match in call to tf.complex()."),b.ENGINE.runKernelFunc(function(q){return q.complex(R,W)},{$real:R,$imag:W})}}),A.real=B.op({real_:function(re){var J=$.convertToTensor(re,"input","real");return b.ENGINE.runKernelFunc(function(R){return R.real(J)},{$input:J})}}),A.imag=B.op({imag_:function(re){var J=$.convertToTensor(re,"input","imag");return b.ENGINE.runKernelFunc(function(R){return R.imag(J)},{$input:J})}})},function(Oe,A,a){/**
* @license
* Copyright 2018 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Object.defineProperty(A,"__esModule",{value:!0});var b=a(25),$=a(74),U=a(29),B=a(21),re=a(206),J=a(147),R=a(28),W=a(91),q=a(372);A.addStrict=R.op({addStrict_:function(P,ee){var I=U.convertToTensor(P,"a","addStrict"),se=U.convertToTensor(ee,"b","addStrict");return B.assertShapesMatch(I.shape,se.shape,"Error in addStrict: "),I.add(se)}}),A.atan2=R.op({atan2_:function(P,ee){var I,se=U.convertToTensor(P,"a","atan2"),ie=U.convertToTensor(ee,"b","atan2");I=$.makeTypesMatch(se,ie),se=I[0],ie=I[1];var K=J.assertAndGetBroadcastShape(se.shape,ie.shape);return b.ENGINE.runKernelFunc(function(de,pe){var Ae=de.atan2(se,ie);return pe([se,ie]),Ae},{$a:se,$b:ie},function(de,pe){var Ae=pe[0],Te=pe[1];return{$a:function(){var je=re.add(Ae.square(),Te.square()),we=de.mul(Te.div(je)),ot=J.getReductionAxes(Ae.shape,K);return ot.length>0&&(we=we.sum(ot)),we.reshape(Ae.shape)},$b:function(){var je=re.add(Ae.square(),Te.square()),we=q.neg(de.mul(Ae.div(je))),ot=J.getReductionAxes(Te.shape,K);return ot.length>0&&(we=we.sum(ot)),we.reshape(Te.shape)}}})}}),A.divStrict=R.op({divStrict_:function(P,ee){var I=U.convertToTensor(P,"a","div"),se=U.convertToTensor(ee,"b","div");return B.assertShapesMatch(I.shape,se.shape,"Error in divideStrict: "),I.div(se)}}),A.floorDiv=R.op({floorDiv_:function(P,ee){var I,se=U.convertToTensor(P,"a","floorDiv"),ie=U.convertToTensor(ee,"b","floorDiv");I=$.makeTypesMatch(se,ie),se=I[0],ie=I[1];var K=J.assertAndGetBroadcastShape(se.shape,ie.shape);return b.ENGINE.runKernelFunc(function(de,pe){var Ae=de.floorDiv(se,ie);return pe([se,ie]),Ae},{a:se,b:ie},function(de,pe){var Ae=pe[0],Te=pe[1];return{a:function(){var je=de.div(Te.toFloat()),we=J.getReductionAxes(Ae.shape,K);return we.length>0?je.sum(we).reshape(Ae.shape):je},b:function(){var je=de.mul(Ae.toFloat()),we=J.getReductionAxes(Te.shape,K);we.length>0&&(je=je.sum(we).reshape(Te.shape));var ot=Te.square();return je.div(ot.toFloat()).neg()}}},"FloorDiv")}}),A.maximum=R.op({maximum_:function(P,ee){var I,se=U.convertToTensor(P,"a","maximum"),ie=U.convertToTensor(ee,"b","maximum");return I=$.makeTypesMatch(se,ie),se=I[0],ie=I[1],se.dtype==="bool"&&(se=se.toInt(),ie=ie.toInt()),J.assertAndGetBroadcastShape(se.shape,ie.shape),b.ENGINE.runKernelFunc(function(K,de){var pe=K.maximum(se,ie);return de([se,ie]),pe},{a:se,b:ie},function(K,de){var pe=de[0],Ae=de[1];return{a:function(){return K.mul(pe.greaterEqual(Ae).toFloat())},b:function(){return K.mul(pe.less(Ae).toFloat())}}},"Maximum")}}),A.maximumStrict=R.op({maximumStrict_:function(P,ee){var I=U.convertToTensor(P,"a","maximumStrict"),se=U.convertToTensor(ee,"b","maximumStrict");return B.assertShapesMatch(I.shape,se.shape,"Error in maximumStrict: "),I.maximum(se)}}),A.minimum=R.op({minimum_:function(P,ee){var I,se=U.convertToTensor(P,"a","minimum"),ie=U.convertToTensor(ee,"b","minimum");return I=$.makeTypesMatch(se,ie),se=I[0],ie=I[1],se.dtype==="bool"&&(se=se.toInt(),ie=ie.toInt()),J.assertAndGetBroadcastShape(se.shape,ie.shape),b.ENGINE.runKernelFunc(function(K,de){var pe=K.minimum(se,ie);return de([se,ie]),pe},{a:se,b:ie},function(K,de){var pe=de[0],Ae=de[1];return{a:function(){return K.mul(pe.lessEqual(Ae).toFloat())},b:function(){return K.mul(pe.greater(Ae).toFloat())}}},"Minimum")}}),A.minimumStrict=R.op({minimumStrict_:function(P,ee){var I=U.convertToTensor(P,"a","minimumStrict"),se=U.convertToTensor(ee,"b","minimumStrict");return B.assertShapesMatch(I.shape,se.shape,"Error in minimumStrict: "),I.minimum(se)}}),A.mod=R.op({mod_:function(P,ee){var I,se=U.convertToTensor(P,"a","mod"),ie=U.convertToTensor(ee,"b","mod");I=$.makeTypesMatch(se,ie),se=I[0],ie=I[1];var K=J.assertAndGetBroadcastShape(se.shape,ie.shape);return b.ENGINE.runKernelFunc(function(de,pe){var Ae=de.mod(se,ie);return pe([se,ie]),Ae},{$a:se,$b:ie},function(de,pe){var Ae=pe[0],Te=pe[1];return{$a:function(){var je=J.getReductionAxes(Ae.shape,K);return je.length>0?de.sum(je).reshape(Ae.shape):de},$b:function(){var je=de.mul(Ae.div(Te).floor().neg()),we=J.getReductionAxes(Te.shape,K);return we.length>0?je.sum(we).reshape(Te.shape):je}}})}}),A.modStrict=R.op({modStrict_:function(P,ee){var I=U.convertToTensor(P,"a","modStrict"),se=U.convertToTensor(ee,"b","modStrict");return B.assertShapesMatch(I.shape,se.shape,"Error in modStrict: "),I.mod(se)}}),A.mul=R.op({mul_:function(P,ee){var I,se=U.convertToTensor(P,"a","mul"),ie=U.convertToTensor(ee,"b","mul");I=$.makeTypesMatch(se,ie),se=I[0],ie=I[1];var K=J.assertAndGetBroadcastShape(se.shape,ie.shape);return b.ENGINE.runKernelFunc(function(de,pe){var Ae=de.multiply(se,ie);return pe([se,ie]),Ae},{a:se,b:ie},function(de,pe){var Ae=pe[0],Te=pe[1];return{a:function(){var je=de.mul(Te.toFloat()),we=J.getReductionAxes(Ae.shape,K);return we.length>0?je.sum(we).reshape(Ae.shape):je},b:function(){var je=de.mul(Ae.toFloat()),we=J.getReductionAxes(Te.shape,K);return we.length>0?je.sum(we).reshape(Te.shape):je}}},"Mul")}}),A.mulStrict=R.op({mulStrict_:function(P,ee){var I=U.convertToTensor(P,"a","mul"),se=U.convertToTensor(ee,"b","mul");return B.assertShapesMatch(I.shape,se.shape,"Error in multiplyStrict: "),I.mul(se)}}),A.pow=R.op({pow_:function(P,ee){var I,se=U.convertToTensor(P,"base","pow"),ie=U.convertToTensor(ee,"exp","pow");I=$.makeTypesMatch(se,ie),se=I[0],ie=I[1];var K=J.assertAndGetBroadcastShape(se.shape,ie.shape),de=[se,ie];return b.ENGINE.runKernelFunc(function(pe,Ae){var Te=pe.pow(se,ie);return Ae([se,ie,Te]),Te},{a:se,b:ie},function(pe,Ae){var Te=Ae[0],je=Ae[1],we=Ae[2];return{a:function(){var ot=je.toFloat(),_t=pe.mul(ot.mul(Te.pow(ot.sub(W.scalar(1))))),Ut=J.getReductionAxes(Te.shape,K);return Ut.length>0&&(_t=_t.sum(Ut)),_t.reshape(Te.shape)},b:function(){var ot=Te.greater(0),_t=Te.log().where(ot,W.zerosLike(Te)),Ut=pe.mul(we.mul(_t)),Xt=J.getReductionAxes(je.shape,K);return Xt.length>0&&(Ut=Ut.sum(Xt)),Ut.reshape(je.shape)}}},"Pow",{},de,[!0])}}),A.powStrict=R.op({powStrict_:function(P,ee){return B.assertShapesMatch(P.shape,ee.shape,"Error in powStrict: "),P.pow(ee)}}),A.squaredDifferenceStrict=R.op({squaredDifferenceStrict_:function(P,ee){var I=U.convertToTensor(P,"a","squaredDifferenceStrict"),se=U.convertToTensor(ee,"b","squaredDifferenceStrict");return B.assertShapesMatch(I.shape,se.shape,"Error in squaredDifferenceStrict: "),I.squaredDifference(se)}}),A.sub=R.op({sub_:function(P,ee){var I,se=U.convertToTensor(P,"a","sub"),ie=U.convertToTensor(ee,"b","sub");I=$.makeTypesMatch(se,ie),se=I[0],ie=I[1];var K=J.assertAndGetBroadcastShape(se.shape,ie.shape);return b.ENGINE.runKernelFunc(function(de){return de.subtract(se,ie)},{a:se,b:ie},function(de){return{a:function(){var pe=de,Ae=J.getReductionAxes(se.shape,K);return Ae.length>0&&(pe=pe.sum(Ae)),pe.reshape(se.shape)},b:function(){var pe=de,Ae=J.getReductionAxes(ie.shape,K);return Ae.length>0&&(pe=pe.sum(Ae)),pe.neg().reshape(ie.shape)}}},"Sub")}}),A.subStrict=R.op({subStrict_:function(P,ee){var I=U.convertToTensor(P,"a","subStrict"),se=U.convertToTensor(ee,"b","subStrict");return B.assertShapesMatch(I.shape,se.shape,"Error in subStrict: "),I.sub(se)}})},function(Oe,A,a){/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Object.defineProperty(A,"__esModule",{value:!0});var b=a(205);a(33).Tensor.prototype.div=function($){return b.div(this,$)}},function(Oe,A,a){/**
* @license
* Copyright 2020 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Object.defineProperty(A,"__esModule",{value:!0});var b=a(25),$=a(73),U=a(29),B=a(28);A.broadcastTo=B.op({broadcastTo_:function(re,J){var R=U.convertToTensor(re,"broadcastTo","x"),W=R.shape;if(J.some(function(de){return!(de>0)||de%1!=0}))throw new Error("broadcastTo(): Invalid broadcast shape ["+J+"].");if(J.length<R.rank)throw new Error("broadcastTo(): shape.length="+J.length+" < input.rank="+R.rank+".");if(J.length>R.rank){for(var q=R.shape.slice();q.length<J.length;)q.unshift(1);R=R.reshape(q)}for(var P=R.shape,ee=Array.from(J),I=J.length-1;I>=0;I--)if(P[I]===J[I])ee[I]=1;else if(R.shape[I]!==1)throw new Error("broadcastTo(): ["+W+"] cannot be broadcast to ["+J+"].");var se=ee.map(function(de,pe){return de>1?pe:-1}).filter(function(de){return de>=0});if(se.length===0)return R.clone();var ie={x:R},K={shape:J,inputShape:P};return b.ENGINE.runKernelFunc(function(de){return de.tile(R,ee)},ie,function(de){return{x:function(){return de.sum(se,!0)}}},$.BroadcastTo,K)}})},function(Oe,A,a){/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Object.defineProperty(A,"__esModule",{value:!0});var b=a(376);a(33).Tensor.prototype.broadcastTo=function($){return b.broadcastTo(this,$)}},function(Oe,A,a){/**
* @license
* Copyright 2017 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/var b,$,U,B;Object.defineProperty(A,"__esModule",{value:!0}),function(R){R.R0="R0",R.R1="R1",R.R2="R2",R.R3="R3",R.R4="R4",R.R5="R5",R.R6="R6"}(A.Rank||(A.Rank={})),function(R){R.float32="float32",R.int32="int32",R.bool="int32",R.complex64="complex64"}(b||(b={})),function(R){R.float32="float32",R.int32="int32",R.bool="bool",R.complex64="complex64"}($||($={})),function(R){R.float32="float32",R.int32="float32",R.bool="float32",R.complex64="complex64"}(U||(U={})),function(R){R.float32="complex64",R.int32="complex64",R.bool="complex64",R.complex64="complex64"}(B||(B={}));var re={float32:U,int32:b,bool:$,complex64:B};function J(R,W){if(R==="string"||W==="string"){if(R==="string"&&W==="string")return"string";throw new Error("Can not upcast "+R+" with "+W)}return re[R][W]}A.upcastType=J,A.sumOutType=function(R){return J(R,"int32")}},function(Oe,A,a){/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Object.defineProperty(A,"__esModule",{value:!0});var b=a(21),$=20,U=3,B=7;function re(W,q,P){var ee;return ee=Array.isArray(W)?parseFloat(W[0].toFixed(B))+" + "+parseFloat(W[1].toFixed(B))+"j":b.isString(W)?"'"+W+"'":P==="bool"?J(W):parseFloat(W.toFixed(B)).toString(),b.rightPad(ee,q)}function J(W){return W===0?"false":"true"}function R(W){for(var q=[],P=0;P<W.length;P+=2)q.push([W[P],W[P+1]]);return q}A.tensorToString=function(W,q,P,ee){var I=b.computeStrides(q),se=function(pe,Ae,Te,je){var we=b.sizeFromShape(Ae),ot=je[je.length-1],_t=new Array(ot).fill(0),Ut=Ae.length,Xt=Te==="complex64"?R(pe):pe;if(Ut>1)for(var ke=0;ke<we/ot;ke++)for(var Ft=ke*ot,Gt=0;Gt<ot;Gt++)_t[Gt]=Math.max(_t[Gt],re(Xt[Ft+Gt],0,Te).length);return _t}(W,q,P,I),ie=q.length,K=function pe(Ae,Te,je,we,ot,_t){_t===void 0&&(_t=!0);var Ut=je==="complex64"?2:1,Xt=Te[0],ke=Te.length;if(ke===0){if(je==="complex64"){var Ft=R(Ae);return[re(Ft[0],0,je)]}return je==="bool"?[J(Ae[0])]:[Ae[0].toString()]}if(ke===1){if(Xt>$){var Gt=U*Ut,jt=Array.from(Ae.slice(0,Gt)),Ye=Array.from(Ae.slice((Xt-U)*Ut,Xt*Ut));return je==="complex64"&&(jt=R(jt),Ye=R(Ye)),["["+jt.map(function(hn,Ve){return re(hn,ot[Ve],je)}).join(", ")+", ..., "+Ye.map(function(hn,Ve){return re(hn,ot[Xt-U+Ve],je)}).join(", ")+"]"]}var ln=je==="complex64"?R(Ae):Array.from(Ae);return["["+ln.map(function(hn,Ve){return re(hn,ot[Ve],je)}).join(", ")+"]"]}var nn=Te.slice(1),Bt=we.slice(1),Pt=we[0]*Ut,gn=[];if(Xt>$){for(var Dt=0;Dt<U;Dt++){var St=Dt*Pt,wn=St+Pt;gn.push.apply(gn,pe(Ae.slice(St,wn),nn,je,Bt,ot,!1))}gn.push("...");for(var Dt=Xt-U;Dt<Xt;Dt++){var St=Dt*Pt,wn=St+Pt;gn.push.apply(gn,pe(Ae.slice(St,wn),nn,je,Bt,ot,Dt===Xt-1))}}else for(var Dt=0;Dt<Xt;Dt++){var St=Dt*Pt,wn=St+Pt;gn.push.apply(gn,pe(Ae.slice(St,wn),nn,je,Bt,ot,Dt===Xt-1))}var Bn=ke===2?",":"";gn[0]="["+gn[0]+Bn;for(var Dt=1;Dt<gn.length-1;Dt++)gn[Dt]=" "+gn[Dt]+Bn;for(var Hn=`,
`,Dt=2;Dt<ke;Dt++)Hn+=`
`;return gn[gn.length-1]=" "+gn[gn.length-1]+"]"+(_t?"":Hn),gn}(W,q,P,I,se),de=["Tensor"];return ee&&(de.push("  dtype: "+P),de.push("  rank: "+ie),de.push("  shape: ["+q+"]"),de.push("  values:")),de.push(K.map(function(pe){return"    "+pe}).join(`
`)),de.join(`
`)}},function(Oe,A,a){/**
* @license
* Copyright 2017 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Object.defineProperty(A,"__esModule",{value:!0});var b=a(21);A.getFilteredNodesXToY=function($,U,B){for(var re={},J={},R=0;R<U.length;R++)re[U[R].id]=!0;for(R=0;R<$.length;R++){var W=(de=$[R]).inputs;for(var q in W){for(var P=W[q],ee=!1,I=0;I<U.length;I++)if(re[P.id]){de.outputs.forEach(function(je){return re[je.id]=!0}),ee=!0,J[de.id]=!0;break}if(ee)break}}var se={};se[B.id]=!0;var ie={};for(R=$.length-1;R>=0;R--)for(W=(de=$[R]).inputs,I=0;I<de.outputs.length;I++)if(se[de.outputs[I].id]){for(var q in W)se[W[q].id]=!0,ie[de.id]=!0;break}var K=[];for(R=0;R<$.length;R++){var de;if(J[(de=$[R]).id]&&ie[de.id]){var pe={};for(var q in de.inputs){var Ae=de.inputs[q];re[Ae.id]&&(pe[q]=Ae)}var Te=Object.assign({},de);Te.inputs=pe,Te.outputs=de.outputs,K.push(Te)}}return K},A.backpropagateGradients=function($,U,B){for(var re=function(R){var W=U[R],q=[];if(W.outputs.forEach(function(se){var ie=$[se.id];ie!=null?q.push(ie):q.push(null)}),W.gradient==null)throw new Error("Cannot compute gradient: gradient function not found for "+W.kernelName+".");var P=W.gradient(q),ee=function(se){if(!(se in P))throw new Error("Cannot backprop through input "+se+". Available gradients found: "+Object.keys(P)+".");var ie=B(function(){return P[se]()});if(ie.dtype!=="float32")throw new Error("Error in gradient for op "+W.kernelName+". The gradient of input "+se+" must have 'float32' dtype, but has '"+ie.dtype+"'");var K=W.inputs[se];if(!b.arraysEqual(ie.shape,K.shape))throw new Error("Error in gradient for op "+W.kernelName+". The gradient of input '"+se+"' has shape '"+ie.shape+"', which does not match the shape of the input '"+K.shape+"'");if($[K.id]==null)$[K.id]=ie;else{var de=$[K.id];$[K.id]=de.add(ie),de.dispose()}};for(var I in W.inputs)ee(I)},J=U.length-1;J>=0;J--)re(J)}},function(Oe,A,a){/**
* @license
* Copyright 2018 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Object.defineProperty(A,"__esModule",{value:!0});var b=a(21),$=function(){function re(J,R){this.backendTimer=J,this.logger=R,R==null&&(this.logger=new B)}return re.prototype.profileKernel=function(J,R,W){var q,P=this,ee=this.backendTimer.time(function(){q=W()});return q.forEach(function(I){I.data().then(function(se){U(se,I.dtype,J),ee.then(function(ie){var K="";ie.getExtraProfileInfo!=null&&(K=ie.getExtraProfileInfo()),P.logger.logKernelProfile(J,I,se,ie.kernelMs,R,K)})})}),q},re}();function U(re,J,R){if(J!=="float32")return!1;for(var W=0;W<re.length;W++){var q=re[W];if(isNaN(q)||!isFinite(q))return console.warn("Found "+q+" in the result of '"+R+"'"),!0}return!1}A.Profiler=$,A.checkComputationForErrors=U;var B=function(){function re(){}return re.prototype.logKernelProfile=function(J,R,W,q,P,ee){var I=typeof q=="number"?b.rightPad(q+"ms",9):q.error,se=b.rightPad(J,25),ie=R.rank,K=R.size,de=b.rightPad(R.shape.toString(),14),pe="";for(var Ae in P){var Te=P[Ae].shape||R.shape,je=Te.length;pe+=Ae+": "+je+"D "+(je>0?Te:"")+" "}console.log("%c"+se+"	%c"+I+"	%c"+ie+"D "+de+"	%c"+K+"	%c"+pe+"	%c"+ee,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")},re}();A.Logger=B},function(Oe,A,a){/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Object.defineProperty(A,"__esModule",{value:!0});var b=new Map,$=new Map;function U(B,re){return re+"_"+B}A.getKernel=function(B,re){var J=U(B,re);return b.get(J)},A.getGradient=function(B){return $.get(B)},A.getKernelsForBackend=function(B){for(var re=b.entries(),J=[];;){var R=re.next(),W=R.done,q=R.value;if(W)break;var P=q[0],ee=q[1];P.split("_")[0]===B&&J.push(ee)}return J},A.registerKernel=function(B){var re=B.kernelName,J=B.backendName,R=U(re,J);if(b.has(R))throw new Error("The kernel '"+re+"' for backend '"+J+"' is already registered");b.set(R,B)},A.registerGradient=function(B){var re=B.kernelName;$.has(re)&&console.warn("Overriding the gradient for '"+re+"'"),$.set(re,B)},A.unregisterKernel=function(B,re){var J=U(B,re);if(!b.has(J))throw new Error("The kernel '"+B+"' for backend '"+re+"' is not registered");b.delete(J)},A.unregisterGradient=function(B){if(!$.has(B))throw new Error("The gradient '"+B+"' for backend is not registered");$.delete(B)}},function(Oe,A,a){Object.defineProperty(A,"__esModule",{value:!0});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var b=a(206);a(33).Tensor.prototype.add=function($){return b.add(this,$)}},function(Oe,A,a){Object.defineProperty(A,"__esModule",{value:!0}),a(383),a(377),a(375),a(371),a(363),a(361),a(359),a(357),a(355),a(353)},function(Oe,A){},function(Oe,A){},function(Oe,A){},function(Oe,A){},function(Oe,A){},function(Oe,A){},function(Oe,A,a){(function(b,$){(function(U,B){if(!U.setImmediate){var re,J=1,R={},W=!1,q=U.document,P=Object.getPrototypeOf&&Object.getPrototypeOf(U);P=P&&P.setTimeout?P:U,{}.toString.call(U.process)==="[object process]"?re=function(se){$.nextTick(function(){I(se)})}:function(){if(U.postMessage&&!U.importScripts){var se=!0,ie=U.onmessage;return U.onmessage=function(){se=!1},U.postMessage("","*"),U.onmessage=ie,se}}()?function(){var se="setImmediate$"+Math.random()+"$",ie=function(K){K.source===U&&typeof K.data=="string"&&K.data.indexOf(se)===0&&I(+K.data.slice(se.length))};U.addEventListener?U.addEventListener("message",ie,!1):U.attachEvent("onmessage",ie),re=function(K){U.postMessage(se+K,"*")}}():U.MessageChannel?function(){var se=new MessageChannel;se.port1.onmessage=function(ie){I(ie.data)},re=function(ie){se.port2.postMessage(ie)}}():q&&"onreadystatechange"in q.createElement("script")?function(){var se=q.documentElement;re=function(ie){var K=q.createElement("script");K.onreadystatechange=function(){I(ie),K.onreadystatechange=null,se.removeChild(K),K=null},se.appendChild(K)}}():re=function(se){setTimeout(I,0,se)},P.setImmediate=function(se){typeof se!="function"&&(se=new Function(""+se));for(var ie=new Array(arguments.length-1),K=0;K<ie.length;K++)ie[K]=arguments[K+1];var de={callback:se,args:ie};return R[J]=de,re(J),J++},P.clearImmediate=ee}function ee(se){delete R[se]}function I(se){if(W)setTimeout(I,0,se);else{var ie=R[se];if(ie){W=!0;try{(function(K){var de=K.callback,pe=K.args;switch(pe.length){case 0:de();break;case 1:de(pe[0]);break;case 2:de(pe[0],pe[1]);break;case 3:de(pe[0],pe[1],pe[2]);break;default:de.apply(B,pe)}})(ie)}finally{ee(se),W=!1}}}}})(typeof self>"u"?b===void 0?this:b:self)}).call(this,a(59),a(75))},function(Oe,A){var a={}.toString;Oe.exports=Array.isArray||function(b){return a.call(b)=="[object Array]"}},function(Oe,A){/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */A.read=function(a,b,$,U,B){var re,J,R=8*B-U-1,W=(1<<R)-1,q=W>>1,P=-7,ee=$?B-1:0,I=$?-1:1,se=a[b+ee];for(ee+=I,re=se&(1<<-P)-1,se>>=-P,P+=R;P>0;re=256*re+a[b+ee],ee+=I,P-=8);for(J=re&(1<<-P)-1,re>>=-P,P+=U;P>0;J=256*J+a[b+ee],ee+=I,P-=8);if(re===0)re=1-q;else{if(re===W)return J?NaN:1/0*(se?-1:1);J+=Math.pow(2,U),re-=q}return(se?-1:1)*J*Math.pow(2,re-U)},A.write=function(a,b,$,U,B,re){var J,R,W,q=8*re-B-1,P=(1<<q)-1,ee=P>>1,I=B===23?Math.pow(2,-24)-Math.pow(2,-77):0,se=U?0:re-1,ie=U?1:-1,K=b<0||b===0&&1/b<0?1:0;for(b=Math.abs(b),isNaN(b)||b===1/0?(R=isNaN(b)?1:0,J=P):(J=Math.floor(Math.log(b)/Math.LN2),b*(W=Math.pow(2,-J))<1&&(J--,W*=2),(b+=J+ee>=1?I/W:I*Math.pow(2,1-ee))*W>=2&&(J++,W/=2),J+ee>=P?(R=0,J=P):J+ee>=1?(R=(b*W-1)*Math.pow(2,B),J+=ee):(R=b*Math.pow(2,ee-1)*Math.pow(2,B),J=0));B>=8;a[$+se]=255&R,se+=ie,R/=256,B-=8);for(J=J<<B|R,q+=B;q>0;a[$+se]=255&J,se+=ie,J/=256,q-=8);a[$+se-ie]|=128*K}},function(Oe,A,a){A.byteLength=function(P){var ee=R(P),I=ee[0],se=ee[1];return 3*(I+se)/4-se},A.toByteArray=function(P){var ee,I,se=R(P),ie=se[0],K=se[1],de=new U(function(Te,je,we){return 3*(je+we)/4-we}(0,ie,K)),pe=0,Ae=K>0?ie-4:ie;for(I=0;I<Ae;I+=4)ee=$[P.charCodeAt(I)]<<18|$[P.charCodeAt(I+1)]<<12|$[P.charCodeAt(I+2)]<<6|$[P.charCodeAt(I+3)],de[pe++]=ee>>16&255,de[pe++]=ee>>8&255,de[pe++]=255&ee;return K===2&&(ee=$[P.charCodeAt(I)]<<2|$[P.charCodeAt(I+1)]>>4,de[pe++]=255&ee),K===1&&(ee=$[P.charCodeAt(I)]<<10|$[P.charCodeAt(I+1)]<<4|$[P.charCodeAt(I+2)]>>2,de[pe++]=ee>>8&255,de[pe++]=255&ee),de},A.fromByteArray=function(P){for(var ee,I=P.length,se=I%3,ie=[],K=0,de=I-se;K<de;K+=16383)ie.push(q(P,K,K+16383>de?de:K+16383));return se===1?(ee=P[I-1],ie.push(b[ee>>2]+b[ee<<4&63]+"==")):se===2&&(ee=(P[I-2]<<8)+P[I-1],ie.push(b[ee>>10]+b[ee>>4&63]+b[ee<<2&63]+"=")),ie.join("")};for(var b=[],$=[],U=typeof Uint8Array<"u"?Uint8Array:Array,B="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",re=0,J=B.length;re<J;++re)b[re]=B[re],$[B.charCodeAt(re)]=re;function R(P){var ee=P.length;if(ee%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var I=P.indexOf("=");return I===-1&&(I=ee),[I,I===ee?0:4-I%4]}function W(P){return b[P>>18&63]+b[P>>12&63]+b[P>>6&63]+b[63&P]}function q(P,ee,I){for(var se,ie=[],K=ee;K<I;K+=3)se=(P[K]<<16&16711680)+(P[K+1]<<8&65280)+(255&P[K+2]),ie.push(W(se));return ie.join("")}$["-".charCodeAt(0)]=62,$["_".charCodeAt(0)]=63},function(Oe,A){var a={}.hasOwnProperty;Oe.exports=function(b,$){return a.call(b,$)}},function(Oe,A){Oe.exports=function(a,b){return{enumerable:!(1&a),configurable:!(2&a),writable:!(4&a),value:b}}},function(Oe,A,a){var b=a(149);Oe.exports=function($,U){if(!b($))return $;var B,re;if(U&&typeof(B=$.toString)=="function"&&!b(re=B.call($))||typeof(B=$.valueOf)=="function"&&!b(re=B.call($))||!U&&typeof(B=$.toString)=="function"&&!b(re=B.call($)))return re;throw TypeError("Can't convert object to primitive value")}},function(Oe,A,a){var b=a(149),$=a(150).document,U=b($)&&b($.createElement);Oe.exports=function(B){return U?$.createElement(B):{}}},function(Oe,A,a){Oe.exports=!a(148)&&!a(208)(function(){return Object.defineProperty(a(398)("div"),"a",{get:function(){return 7}}).a!=7})},function(Oe,A,a){var b=a(149);Oe.exports=function($){if(!b($))throw TypeError($+" is not an object!");return $}},function(Oe,A,a){var b=a(400),$=a(399),U=a(397),B=Object.defineProperty;A.f=a(148)?Object.defineProperty:function(re,J,R){if(b(re),J=U(J,!0),b(R),$)try{return B(re,J,R)}catch{}if("get"in R||"set"in R)throw TypeError("Accessors not supported!");return"value"in R&&(re[J]=R.value),re}},function(Oe,A,a){var b=a(401),$=a(396);Oe.exports=a(148)?function(U,B,re){return b.f(U,B,$(1,re))}:function(U,B,re){return U[B]=re,U}},function(Oe,A){Oe.exports=function(a){if(typeof a!="function")throw TypeError(a+" is not a function!");return a}},function(Oe,A,a){var b=a(403);Oe.exports=function($,U,B){if(b($),U===void 0)return $;switch(B){case 1:return function(re){return $.call(U,re)};case 2:return function(re,J){return $.call(U,re,J)};case 3:return function(re,J,R){return $.call(U,re,J,R)}}return function(){return $.apply(U,arguments)}}},function(Oe,A,a){var b=a(150),$=a(209),U=a(404),B=a(402),re=a(395),J=function(R,W,q){var P,ee,I,se=R&J.F,ie=R&J.G,K=R&J.S,de=R&J.P,pe=R&J.B,Ae=R&J.W,Te=ie?$:$[W]||($[W]={}),je=Te.prototype,we=ie?b:K?b[W]:(b[W]||{}).prototype;for(P in ie&&(q=W),q)(ee=!se&&we&&we[P]!==void 0)&&re(Te,P)||(I=ee?we[P]:q[P],Te[P]=ie&&typeof we[P]!="function"?q[P]:pe&&ee?U(I,b):Ae&&we[P]==I?function(ot){var _t=function(Ut,Xt,ke){if(this instanceof ot){switch(arguments.length){case 0:return new ot;case 1:return new ot(Ut);case 2:return new ot(Ut,Xt)}return new ot(Ut,Xt,ke)}return ot.apply(this,arguments)};return _t.prototype=ot.prototype,_t}(I):de&&typeof I=="function"?U(Function.call,I):I,de&&((Te.virtual||(Te.virtual={}))[P]=I,R&J.R&&je&&!je[P]&&B(je,P,I)))};J.F=1,J.G=2,J.S=4,J.P=8,J.B=16,J.W=32,J.U=64,J.R=128,Oe.exports=J},function(Oe,A,a){var b=a(405);b(b.G,{global:a(150)})},function(Oe,A,a){a(406),Oe.exports=a(209).global},function(Oe,A,a){var b=function($){var U,B=Object.prototype,re=B.hasOwnProperty,J=typeof Symbol=="function"?Symbol:{},R=J.iterator||"@@iterator",W=J.asyncIterator||"@@asyncIterator",q=J.toStringTag||"@@toStringTag";function P(Bt,Pt,gn){return Object.defineProperty(Bt,Pt,{value:gn,enumerable:!0,configurable:!0,writable:!0}),Bt[Pt]}try{P({},"")}catch{P=function(Pt,gn,Dt){return Pt[gn]=Dt}}function ee(Bt,Pt,gn,Dt){var St=Pt&&Pt.prototype instanceof Ae?Pt:Ae,wn=Object.create(St.prototype),Bn=new Ye(Dt||[]);return wn._invoke=function(Hn,hn,Ve){var Qe=se;return function(He,pt){if(Qe===K)throw new Error("Generator is already running");if(Qe===de){if(He==="throw")throw pt;return nn()}for(Ve.method=He,Ve.arg=pt;;){var Lt=Ve.delegate;if(Lt){var zt=Ft(Lt,Ve);if(zt){if(zt===pe)continue;return zt}}if(Ve.method==="next")Ve.sent=Ve._sent=Ve.arg;else if(Ve.method==="throw"){if(Qe===se)throw Qe=de,Ve.arg;Ve.dispatchException(Ve.arg)}else Ve.method==="return"&&Ve.abrupt("return",Ve.arg);Qe=K;var Tn=I(Hn,hn,Ve);if(Tn.type==="normal"){if(Qe=Ve.done?de:ie,Tn.arg===pe)continue;return{value:Tn.arg,done:Ve.done}}Tn.type==="throw"&&(Qe=de,Ve.method="throw",Ve.arg=Tn.arg)}}}(Bt,gn,Bn),wn}function I(Bt,Pt,gn){try{return{type:"normal",arg:Bt.call(Pt,gn)}}catch(Dt){return{type:"throw",arg:Dt}}}$.wrap=ee;var se="suspendedStart",ie="suspendedYield",K="executing",de="completed",pe={};function Ae(){}function Te(){}function je(){}var we={};P(we,R,function(){return this});var ot=Object.getPrototypeOf,_t=ot&&ot(ot(ln([])));_t&&_t!==B&&re.call(_t,R)&&(we=_t);var Ut=je.prototype=Ae.prototype=Object.create(we);function Xt(Bt){["next","throw","return"].forEach(function(Pt){P(Bt,Pt,function(gn){return this._invoke(Pt,gn)})})}function ke(Bt,Pt){var gn;this._invoke=function(Dt,St){function wn(){return new Pt(function(Bn,Hn){(function hn(Ve,Qe,He,pt){var Lt=I(Bt[Ve],Bt,Qe);if(Lt.type!=="throw"){var zt=Lt.arg,Tn=zt.value;return Tn&&typeof Tn=="object"&&re.call(Tn,"__await")?Pt.resolve(Tn.__await).then(function(xn){hn("next",xn,He,pt)},function(xn){hn("throw",xn,He,pt)}):Pt.resolve(Tn).then(function(xn){zt.value=xn,He(zt)},function(xn){return hn("throw",xn,He,pt)})}pt(Lt.arg)})(Dt,St,Bn,Hn)})}return gn=gn?gn.then(wn,wn):wn()}}function Ft(Bt,Pt){var gn=Bt.iterator[Pt.method];if(gn===U){if(Pt.delegate=null,Pt.method==="throw"){if(Bt.iterator.return&&(Pt.method="return",Pt.arg=U,Ft(Bt,Pt),Pt.method==="throw"))return pe;Pt.method="throw",Pt.arg=new TypeError("The iterator does not provide a 'throw' method")}return pe}var Dt=I(gn,Bt.iterator,Pt.arg);if(Dt.type==="throw")return Pt.method="throw",Pt.arg=Dt.arg,Pt.delegate=null,pe;var St=Dt.arg;return St?St.done?(Pt[Bt.resultName]=St.value,Pt.next=Bt.nextLoc,Pt.method!=="return"&&(Pt.method="next",Pt.arg=U),Pt.delegate=null,pe):St:(Pt.method="throw",Pt.arg=new TypeError("iterator result is not an object"),Pt.delegate=null,pe)}function Gt(Bt){var Pt={tryLoc:Bt[0]};1 in Bt&&(Pt.catchLoc=Bt[1]),2 in Bt&&(Pt.finallyLoc=Bt[2],Pt.afterLoc=Bt[3]),this.tryEntries.push(Pt)}function jt(Bt){var Pt=Bt.completion||{};Pt.type="normal",delete Pt.arg,Bt.completion=Pt}function Ye(Bt){this.tryEntries=[{tryLoc:"root"}],Bt.forEach(Gt,this),this.reset(!0)}function ln(Bt){if(Bt){var Pt=Bt[R];if(Pt)return Pt.call(Bt);if(typeof Bt.next=="function")return Bt;if(!isNaN(Bt.length)){var gn=-1,Dt=function St(){for(;++gn<Bt.length;)if(re.call(Bt,gn))return St.value=Bt[gn],St.done=!1,St;return St.value=U,St.done=!0,St};return Dt.next=Dt}}return{next:nn}}function nn(){return{value:U,done:!0}}return Te.prototype=je,P(Ut,"constructor",je),P(je,"constructor",Te),Te.displayName=P(je,q,"GeneratorFunction"),$.isGeneratorFunction=function(Bt){var Pt=typeof Bt=="function"&&Bt.constructor;return!!Pt&&(Pt===Te||(Pt.displayName||Pt.name)==="GeneratorFunction")},$.mark=function(Bt){return Object.setPrototypeOf?Object.setPrototypeOf(Bt,je):(Bt.__proto__=je,P(Bt,q,"GeneratorFunction")),Bt.prototype=Object.create(Ut),Bt},$.awrap=function(Bt){return{__await:Bt}},Xt(ke.prototype),P(ke.prototype,W,function(){return this}),$.AsyncIterator=ke,$.async=function(Bt,Pt,gn,Dt,St){St===void 0&&(St=Promise);var wn=new ke(ee(Bt,Pt,gn,Dt),St);return $.isGeneratorFunction(Pt)?wn:wn.next().then(function(Bn){return Bn.done?Bn.value:wn.next()})},Xt(Ut),P(Ut,q,"Generator"),P(Ut,R,function(){return this}),P(Ut,"toString",function(){return"[object Generator]"}),$.keys=function(Bt){var Pt=[];for(var gn in Bt)Pt.push(gn);return Pt.reverse(),function Dt(){for(;Pt.length;){var St=Pt.pop();if(St in Bt)return Dt.value=St,Dt.done=!1,Dt}return Dt.done=!0,Dt}},$.values=ln,Ye.prototype={constructor:Ye,reset:function(Bt){if(this.prev=0,this.next=0,this.sent=this._sent=U,this.done=!1,this.delegate=null,this.method="next",this.arg=U,this.tryEntries.forEach(jt),!Bt)for(var Pt in this)Pt.charAt(0)==="t"&&re.call(this,Pt)&&!isNaN(+Pt.slice(1))&&(this[Pt]=U)},stop:function(){this.done=!0;var Bt=this.tryEntries[0].completion;if(Bt.type==="throw")throw Bt.arg;return this.rval},dispatchException:function(Bt){if(this.done)throw Bt;var Pt=this;function gn(hn,Ve){return wn.type="throw",wn.arg=Bt,Pt.next=hn,Ve&&(Pt.method="next",Pt.arg=U),!!Ve}for(var Dt=this.tryEntries.length-1;Dt>=0;--Dt){var St=this.tryEntries[Dt],wn=St.completion;if(St.tryLoc==="root")return gn("end");if(St.tryLoc<=this.prev){var Bn=re.call(St,"catchLoc"),Hn=re.call(St,"finallyLoc");if(Bn&&Hn){if(this.prev<St.catchLoc)return gn(St.catchLoc,!0);if(this.prev<St.finallyLoc)return gn(St.finallyLoc)}else if(Bn){if(this.prev<St.catchLoc)return gn(St.catchLoc,!0)}else{if(!Hn)throw new Error("try statement without catch or finally");if(this.prev<St.finallyLoc)return gn(St.finallyLoc)}}}},abrupt:function(Bt,Pt){for(var gn=this.tryEntries.length-1;gn>=0;--gn){var Dt=this.tryEntries[gn];if(Dt.tryLoc<=this.prev&&re.call(Dt,"finallyLoc")&&this.prev<Dt.finallyLoc){var St=Dt;break}}St&&(Bt==="break"||Bt==="continue")&&St.tryLoc<=Pt&&Pt<=St.finallyLoc&&(St=null);var wn=St?St.completion:{};return wn.type=Bt,wn.arg=Pt,St?(this.method="next",this.next=St.finallyLoc,pe):this.complete(wn)},complete:function(Bt,Pt){if(Bt.type==="throw")throw Bt.arg;return Bt.type==="break"||Bt.type==="continue"?this.next=Bt.arg:Bt.type==="return"?(this.rval=this.arg=Bt.arg,this.method="return",this.next="end"):Bt.type==="normal"&&Pt&&(this.next=Pt),pe},finish:function(Bt){for(var Pt=this.tryEntries.length-1;Pt>=0;--Pt){var gn=this.tryEntries[Pt];if(gn.finallyLoc===Bt)return this.complete(gn.completion,gn.afterLoc),jt(gn),pe}},catch:function(Bt){for(var Pt=this.tryEntries.length-1;Pt>=0;--Pt){var gn=this.tryEntries[Pt];if(gn.tryLoc===Bt){var Dt=gn.completion;if(Dt.type==="throw"){var St=Dt.arg;jt(gn)}return St}}throw new Error("illegal catch attempt")},delegateYield:function(Bt,Pt,gn){return this.delegate={iterator:ln(Bt),resultName:Pt,nextLoc:gn},this.method==="next"&&(this.arg=U),pe}},$}(Oe.exports);try{regeneratorRuntime=b}catch{typeof globalThis=="object"?globalThis.regeneratorRuntime=b:Function("r","regeneratorRuntime = r")(b)}},function(Oe,A,a){for(var b=a(155),$=a(82),U=a(38),B=a(16),re=a(42),J=a(96),R=a(19),W=R("iterator"),q=R("toStringTag"),P=J.Array,ee={CSSRuleList:!0,CSSStyleDeclaration:!1,CSSValueList:!1,ClientRectList:!1,DOMRectList:!1,DOMStringList:!1,DOMTokenList:!0,DataTransferItemList:!1,FileList:!1,HTMLAllCollection:!1,HTMLCollection:!1,HTMLFormElement:!1,HTMLSelectElement:!1,MediaList:!0,MimeTypeArray:!1,NamedNodeMap:!1,NodeList:!0,PaintRequestList:!1,Plugin:!1,PluginArray:!1,SVGLengthList:!1,SVGNumberList:!1,SVGPathSegList:!1,SVGPointList:!1,SVGStringList:!1,SVGTransformList:!1,SourceBufferList:!1,StyleSheetList:!0,TextTrackCueList:!1,TextTrackList:!1,TouchList:!1},I=$(ee),se=0;se<I.length;se++){var ie,K=I[se],de=ee[K],pe=B[K],Ae=pe&&pe.prototype;if(Ae&&(Ae[W]||re(Ae,W,P),Ae[q]||re(Ae,q,K),J[K]=P,de))for(ie in b)Ae[ie]||U(Ae,ie,b[ie],!0)}},function(Oe,A,a){var b=a(8),$=a(152);b(b.G+b.B,{setImmediate:$.set,clearImmediate:$.clear})},function(Oe,A,a){var b=a(16),$=a(8),U=a(120),B=[].slice,re=/MSIE .\./.test(U),J=function(R){return function(W,q){var P=arguments.length>2,ee=!!P&&B.call(arguments,2);return R(P?function(){(typeof W=="function"?W:Function(W)).apply(this,ee)}:W,q)}};$($.G+$.B+$.F*re,{setTimeout:J(b.setTimeout),setInterval:J(b.setInterval)})},function(Oe,A,a){a(411),a(410),a(409),Oe.exports=a(24)},function(Oe,A,a){var b=a(8),$=a(24),U=a(16),B=a(104),re=a(216);b(b.P+b.R,"Promise",{finally:function(J){var R=B(this,$.Promise||U.Promise),W=typeof J=="function";return this.then(W?function(q){return re(R,J()).then(function(){return q})}:J,W?function(q){return re(R,J()).then(function(){throw q})}:J)}})},function(Oe,A,a){a(218),a(413),Oe.exports=a(24).Promise.finally},function(Oe,A,a){var b=a(8),$=a(210)(!0);b(b.S,"Object",{entries:function(U){return $(U)}})},function(Oe,A,a){a(415),Oe.exports=a(24).Object.entries},function(Oe,A,a){var b=a(8),$=a(210)(!1);b(b.S,"Object",{values:function(U){return $(U)}})},function(Oe,A,a){a(417),Oe.exports=a(24).Object.values},function(Oe,A,a){var b=a(8),$=a(212),U=a(41),B=a(53),re=a(158);b(b.S,"Object",{getOwnPropertyDescriptors:function(J){for(var R,W,q=U(J),P=B.f,ee=$(q),I={},se=0;ee.length>se;)(W=P(q,R=ee[se++]))!==void 0&&re(I,R,W);return I}})},function(Oe,A,a){a(419),Oe.exports=a(24).Object.getOwnPropertyDescriptors},function(Oe,A,a){a(239)("asyncIterator")},function(Oe,A,a){a(421),Oe.exports=a(174).f("asyncIterator")},function(Oe,A,a){a(97)("trimRight",function(b){return function(){return b(this,2)}},"trimEnd")},function(Oe,A,a){a(423),Oe.exports=a(24).String.trimRight},function(Oe,A,a){a(97)("trimLeft",function(b){return function(){return b(this,1)}},"trimStart")},function(Oe,A,a){a(425),Oe.exports=a(24).String.trimLeft},function(Oe,A,a){var b=a(8),$=a(211),U=a(120),B=/Version\/10\.\d+(\.\d+)?( Mobile\/\w+)? Safari\//.test(U);b(b.P+b.F*B,"String",{padEnd:function(re){return $(this,re,arguments.length>1?arguments[1]:void 0,!1)}})},function(Oe,A,a){a(427),Oe.exports=a(24).String.padEnd},function(Oe,A,a){var b=a(8),$=a(211),U=a(120),B=/Version\/10\.\d+(\.\d+)?( Mobile\/\w+)? Safari\//.test(U);b(b.P+b.F*B,"String",{padStart:function(re){return $(this,re,arguments.length>1?arguments[1]:void 0,!0)}})},function(Oe,A,a){a(429),Oe.exports=a(24).String.padStart},function(Oe,A,a){var b=a(126),$=a(13),U=a(22),B=a(56),re=a(19)("isConcatSpreadable");Oe.exports=function J(R,W,q,P,ee,I,se,ie){for(var K,de,pe=ee,Ae=0,Te=!!se&&B(se,ie,3);Ae<P;){if(Ae in q){if(K=Te?Te(q[Ae],Ae,W):q[Ae],de=!1,$(K)&&(de=(de=K[re])!==void 0?!!de:b(K)),de&&I>0)pe=J(R,W,K,U(K.length),pe,I-1)-1;else{if(pe>=9007199254740991)throw TypeError();R[pe]=K}pe++}Ae++}return pe}},function(Oe,A,a){var b=a(8),$=a(431),U=a(34),B=a(22),re=a(55),J=a(224);b(b.P,"Array",{flatMap:function(R){var W,q,P=U(this);return re(R),W=B(P.length),q=J(P,0),$(q,P,P,W,0,1,R,arguments[1]),q}}),a(77)("flatMap")},function(Oe,A,a){a(432),Oe.exports=a(24).Array.flatMap},function(Oe,A,a){var b=a(8),$=a(128)(!0);b(b.P,"Array",{includes:function(U){return $(this,U,arguments.length>1?arguments[1]:void 0)}}),a(77)("includes")},function(Oe,A,a){a(434),Oe.exports=a(24).Array.includes},function(Oe,A,a){var b=a(8),$=a(170);$&&b(b.S,"Reflect",{setPrototypeOf:function(U,B){$.check(U,B);try{return $.set(U,B),!0}catch{return!1}}})},function(Oe,A,a){var b=a(26),$=a(53),U=a(78),B=a(43),re=a(8),J=a(85),R=a(14),W=a(13);re(re.S,"Reflect",{set:function q(P,ee,I){var se,ie,K=arguments.length<4?P:arguments[3],de=$.f(R(P),ee);if(!de){if(W(ie=U(P)))return q(ie,ee,I,K);de=J(0)}if(B(de,"value")){if(de.writable===!1||!W(K))return!1;if(se=$.f(K,ee)){if(se.get||se.set||se.writable===!1)return!1;se.value=I,b.f(K,ee,se)}else b.f(K,ee,J(0,I));return!0}return de.set!==void 0&&(de.set.call(K,I),!0)}})},function(Oe,A,a){var b=a(8),$=a(14),U=Object.preventExtensions;b(b.S,"Reflect",{preventExtensions:function(B){$(B);try{return U&&U(B),!0}catch{return!1}}})},function(Oe,A,a){var b=a(8);b(b.S,"Reflect",{ownKeys:a(212)})},function(Oe,A,a){var b=a(8),$=a(14),U=Object.isExtensible;b(b.S,"Reflect",{isExtensible:function(B){return $(B),!U||U(B)}})},function(Oe,A,a){var b=a(8);b(b.S,"Reflect",{has:function($,U){return U in $}})},function(Oe,A,a){var b=a(8),$=a(78),U=a(14);b(b.S,"Reflect",{getPrototypeOf:function(B){return $(U(B))}})},function(Oe,A,a){var b=a(53),$=a(8),U=a(14);$($.S,"Reflect",{getOwnPropertyDescriptor:function(B,re){return b.f(U(B),re)}})},function(Oe,A,a){var b=a(53),$=a(78),U=a(43),B=a(8),re=a(13),J=a(14);B(B.S,"Reflect",{get:function R(W,q){var P,ee,I=arguments.length<3?W:arguments[2];return J(W)===I?W[q]:(P=b.f(W,q))?U(P,"value")?P.value:P.get!==void 0?P.get.call(I):void 0:re(ee=$(W))?R(ee,q,I):void 0}})},function(Oe,A,a){var b=a(8),$=a(14),U=function(B){this._t=$(B),this._i=0;var re,J=this._k=[];for(re in B)J.push(re)};a(226)(U,"Object",function(){var B,re=this._k;do if(this._i>=re.length)return{value:void 0,done:!0};while(!((B=re[this._i++])in this._t));return{value:B,done:!1}}),b(b.S,"Reflect",{enumerate:function(B){return new U(B)}})},function(Oe,A,a){var b=a(8),$=a(53).f,U=a(14);b(b.S,"Reflect",{deleteProperty:function(B,re){var J=$(U(B),re);return!(J&&!J.configurable)&&delete B[re]}})},function(Oe,A,a){var b=a(26),$=a(8),U=a(14),B=a(66);$($.S+$.F*a(15)(function(){Reflect.defineProperty(b.f({},1,{value:1}),1,{value:2})}),"Reflect",{defineProperty:function(re,J,R){U(re),J=B(J,!0),U(R);try{return b.f(re,J,R),!0}catch{return!1}}})},function(Oe,A,a){var b=a(8),$=a(80),U=a(55),B=a(14),re=a(13),J=a(15),R=a(233),W=(a(16).Reflect||{}).construct,q=J(function(){function ee(){}return!(W(function(){},[],ee)instanceof ee)}),P=!J(function(){W(function(){})});b(b.S+b.F*(q||P),"Reflect",{construct:function(ee,I){U(ee),B(I);var se=arguments.length<3?ee:U(arguments[2]);if(P&&!q)return W(ee,I,se);if(ee==se){switch(I.length){case 0:return new ee;case 1:return new ee(I[0]);case 2:return new ee(I[0],I[1]);case 3:return new ee(I[0],I[1],I[2]);case 4:return new ee(I[0],I[1],I[2],I[3])}var ie=[null];return ie.push.apply(ie,I),new(R.apply(ee,ie))}var K=se.prototype,de=$(re(K)?K:Object.prototype),pe=Function.apply.call(ee,de,I);return re(pe)?pe:de}})},function(Oe,A,a){var b=a(8),$=a(55),U=a(14),B=(a(16).Reflect||{}).apply,re=Function.apply;b(b.S+b.F*!a(15)(function(){B(function(){})}),"Reflect",{apply:function(J,R,W){var q=$(J),P=U(W);return B?B(q,R,P):re.call(q,R,P)}})},function(Oe,A,a){a(60)("Float64",8,function(b){return function($,U,B){return b(this,$,U,B)}})},function(Oe,A,a){a(60)("Float32",4,function(b){return function($,U,B){return b(this,$,U,B)}})},function(Oe,A,a){a(60)("Uint32",4,function(b){return function($,U,B){return b(this,$,U,B)}})},function(Oe,A,a){a(60)("Int32",4,function(b){return function($,U,B){return b(this,$,U,B)}})},function(Oe,A,a){a(60)("Uint16",2,function(b){return function($,U,B){return b(this,$,U,B)}})},function(Oe,A,a){a(60)("Int16",2,function(b){return function($,U,B){return b(this,$,U,B)}})},function(Oe,A,a){a(60)("Uint8",1,function(b){return function($,U,B){return b(this,$,U,B)}},!0)},function(Oe,A,a){a(60)("Uint8",1,function(b){return function($,U,B){return b(this,$,U,B)}})},function(Oe,A,a){a(60)("Int8",1,function(b){return function($,U,B){return b(this,$,U,B)}})},function(Oe,A,a){var b=a(8);b(b.G+b.W+b.F*!a(118).ABV,{DataView:a(151).DataView})},function(Oe,A,a){var b=a(8),$=a(118),U=a(151),B=a(14),re=a(81),J=a(22),R=a(13),W=a(16).ArrayBuffer,q=a(104),P=U.ArrayBuffer,ee=U.DataView,I=$.ABV&&W.isView,se=P.prototype.slice,ie=$.VIEW;b(b.G+b.W+b.F*(W!==P),{ArrayBuffer:P}),b(b.S+b.F*!$.CONSTR,"ArrayBuffer",{isView:function(K){return I&&I(K)||R(K)&&ie in K}}),b(b.P+b.U+b.F*a(15)(function(){return!new P(2).slice(1,void 0).byteLength}),"ArrayBuffer",{slice:function(K,de){if(se!==void 0&&de===void 0)return se.call(B(this),K);for(var pe=B(this).byteLength,Ae=re(K,pe),Te=re(de===void 0?pe:de,pe),je=new(q(this,P))(J(Te-Ae)),we=new ee(this),ot=new ee(je),_t=0;Ae<Te;)ot.setUint8(_t++,we.getUint8(Ae++));return je}}),a(95)("ArrayBuffer")},function(Oe,A,a){var b=a(214),$=a(76);a(119)("WeakSet",function(U){return function(){return U(this,arguments.length>0?arguments[0]:void 0)}},{add:function(U){return b.def($(this,"WeakSet"),U,!0)}},b,!1,!0)},function(Oe,A,a){var b,$=a(16),U=a(51)(0),B=a(38),re=a(65),J=a(235),R=a(214),W=a(13),q=a(76),P=a(76),ee=!$.ActiveXObject&&"ActiveXObject"in $,I=re.getWeak,se=Object.isExtensible,ie=R.ufstore,K=function(Ae){return function(){return Ae(this,arguments.length>0?arguments[0]:void 0)}},de={get:function(Ae){if(W(Ae)){var Te=I(Ae);return Te===!0?ie(q(this,"WeakMap")).get(Ae):Te?Te[this._i]:void 0}},set:function(Ae,Te){return R.def(q(this,"WeakMap"),Ae,Te)}},pe=Oe.exports=a(119)("WeakMap",K,de,R,!0,!0);P&&ee&&(J((b=R.getConstructor(K,"WeakMap")).prototype,de),re.NEED=!0,U(["delete","has","get","set"],function(Ae){var Te=pe.prototype,je=Te[Ae];B(Te,Ae,function(we,ot){if(W(we)&&!se(we)){this._f||(this._f=new b);var _t=this._f[Ae](we,ot);return Ae=="set"?this:_t}return je.call(this,we,ot)})}))},function(Oe,A,a){var b=a(215),$=a(76);Oe.exports=a(119)("Set",function(U){return function(){return U(this,arguments.length>0?arguments[0]:void 0)}},{add:function(U){return b.def($(this,"Set"),U=U===0?0:U,U)}},b)},function(Oe,A,a){var b=a(215),$=a(76);Oe.exports=a(119)("Map",function(U){return function(){return U(this,arguments.length>0?arguments[0]:void 0)}},{get:function(U){var B=b.getEntry($(this,"Map"),U);return B&&B.v},set:function(U,B){return b.def($(this,"Map"),U===0?0:U,B)}},b,!0)},function(Oe,A){Oe.exports=function(a){try{return{e:!1,v:a()}}catch(b){return{e:!0,v:b}}}},function(Oe,A,a){var b=a(16),$=a(152).set,U=b.MutationObserver||b.WebKitMutationObserver,B=b.process,re=b.Promise,J=a(62)(B)=="process";Oe.exports=function(){var R,W,q,P=function(){var ie,K;for(J&&(ie=B.domain)&&ie.exit();R;){K=R.fn,R=R.next;try{K()}catch(de){throw R?q():W=void 0,de}}W=void 0,ie&&ie.enter()};if(J)q=function(){B.nextTick(P)};else if(!U||b.navigator&&b.navigator.standalone)if(re&&re.resolve){var ee=re.resolve(void 0);q=function(){ee.then(P)}}else q=function(){$.call(b,P)};else{var I=!0,se=document.createTextNode("");new U(P).observe(se,{characterData:!0}),q=function(){se.data=I=!I}}return function(ie){var K={fn:ie,next:void 0};W&&(W.next=K),R||(R=K,q()),W=K}}},function(Oe,A,a){var b=a(161),$=a(14),U=a(104),B=a(153),re=a(22),J=a(123),R=a(154),W=a(15),q=Math.min,P=[].push,ee=!W(function(){});a(122)("split",2,function(I,se,ie,K){var de;return de="abbc".split(/(b)*/)[1]=="c"||"test".split(/(?:)/,-1).length!=4||"ab".split(/(?:ab)*/).length!=2||".".split(/(.?)(.?)/).length!=4||".".split(/()()/).length>1||"".split(/.?/).length?function(pe,Ae){var Te=String(this);if(pe===void 0&&Ae===0)return[];if(!b(pe))return ie.call(Te,pe,Ae);for(var je,we,ot,_t=[],Ut=(pe.ignoreCase?"i":"")+(pe.multiline?"m":"")+(pe.unicode?"u":"")+(pe.sticky?"y":""),Xt=0,ke=Ae===void 0?4294967295:Ae>>>0,Ft=new RegExp(pe.source,Ut+"g");(je=R.call(Ft,Te))&&!((we=Ft.lastIndex)>Xt&&(_t.push(Te.slice(Xt,je.index)),je.length>1&&je.index<Te.length&&P.apply(_t,je.slice(1)),ot=je[0].length,Xt=we,_t.length>=ke));)Ft.lastIndex===je.index&&Ft.lastIndex++;return Xt===Te.length?!ot&&Ft.test("")||_t.push(""):_t.push(Te.slice(Xt)),_t.length>ke?_t.slice(0,ke):_t}:"0".split(void 0,0).length?function(pe,Ae){return pe===void 0&&Ae===0?[]:ie.call(this,pe,Ae)}:ie,[function(pe,Ae){var Te=I(this),je=pe==null?void 0:pe[se];return je!==void 0?je.call(pe,Te,Ae):de.call(String(Te),pe,Ae)},function(pe,Ae){var Te=K(de,pe,this,Ae,de!==ie);if(Te.done)return Te.value;var je=$(pe),we=String(this),ot=U(je,RegExp),_t=je.unicode,Ut=(je.ignoreCase?"i":"")+(je.multiline?"m":"")+(je.unicode?"u":"")+(ee?"y":"g"),Xt=new ot(ee?je:"^(?:"+je.source+")",Ut),ke=Ae===void 0?4294967295:Ae>>>0;if(ke===0)return[];if(we.length===0)return J(Xt,we)===null?[we]:[];for(var Ft=0,Gt=0,jt=[];Gt<we.length;){Xt.lastIndex=ee?Gt:0;var Ye,ln=J(Xt,ee?we:we.slice(Gt));if(ln===null||(Ye=q(re(Xt.lastIndex+(ee?0:Gt)),we.length))===Ft)Gt=B(we,Gt,_t);else{if(jt.push(we.slice(Ft,Gt)),jt.length===ke)return jt;for(var nn=1;nn<=ln.length-1;nn++)if(jt.push(ln[nn]),jt.length===ke)return jt;Gt=Ft=Ye}}return jt.push(we.slice(Ft)),jt}]})},function(Oe,A,a){var b=a(14),$=a(234),U=a(123);a(122)("search",1,function(B,re,J,R){return[function(W){var q=B(this),P=W==null?void 0:W[re];return P!==void 0?P.call(W,q):new RegExp(W)[re](String(q))},function(W){var q=R(J,W,this);if(q.done)return q.value;var P=b(W),ee=String(this),I=P.lastIndex;$(I,0)||(P.lastIndex=0);var se=U(P,ee);return $(P.lastIndex,I)||(P.lastIndex=I),se===null?-1:se.index}]})},function(Oe,A,a){var b=a(14),$=a(34),U=a(22),B=a(54),re=a(153),J=a(123),R=Math.max,W=Math.min,q=Math.floor,P=/\$([$&`']|\d\d?|<[^>]*>)/g,ee=/\$([$&`']|\d\d?)/g,I=function(se){return se===void 0?se:String(se)};a(122)("replace",2,function(se,ie,K,de){return[function(Ae,Te){var je=se(this),we=Ae==null?void 0:Ae[ie];return we!==void 0?we.call(Ae,je,Te):K.call(String(je),Ae,Te)},function(Ae,Te){var je=de(K,Ae,this,Te);if(je.done)return je.value;var we=b(Ae),ot=String(this),_t=typeof Te=="function";_t||(Te=String(Te));var Ut=we.global;if(Ut){var Xt=we.unicode;we.lastIndex=0}for(var ke=[];;){var Ft=J(we,ot);if(Ft===null||(ke.push(Ft),!Ut))break;String(Ft[0])===""&&(we.lastIndex=re(ot,U(we.lastIndex),Xt))}for(var Gt="",jt=0,Ye=0;Ye<ke.length;Ye++){Ft=ke[Ye];for(var ln=String(Ft[0]),nn=R(W(B(Ft.index),ot.length),0),Bt=[],Pt=1;Pt<Ft.length;Pt++)Bt.push(I(Ft[Pt]));var gn=Ft.groups;if(_t){var Dt=[ln].concat(Bt,nn,ot);gn!==void 0&&Dt.push(gn);var St=String(Te.apply(void 0,Dt))}else St=pe(ln,ot,nn,Bt,gn,Te);nn>=jt&&(Gt+=ot.slice(jt,nn)+St,jt=nn+ln.length)}return Gt+ot.slice(jt)}];function pe(Ae,Te,je,we,ot,_t){var Ut=je+Ae.length,Xt=we.length,ke=ee;return ot!==void 0&&(ot=$(ot),ke=P),K.call(_t,ke,function(Ft,Gt){var jt;switch(Gt.charAt(0)){case"$":return"$";case"&":return Ae;case"`":return Te.slice(0,je);case"'":return Te.slice(Ut);case"<":jt=ot[Gt.slice(1,-1)];break;default:var Ye=+Gt;if(Ye===0)return Ft;if(Ye>Xt){var ln=q(Ye/10);return ln===0?Ft:ln<=Xt?we[ln-1]===void 0?Gt.charAt(1):we[ln-1]+Gt.charAt(1):Ft}jt=we[Ye-1]}return jt===void 0?"":jt})}})},function(Oe,A,a){var b=a(14),$=a(22),U=a(153),B=a(123);a(122)("match",1,function(re,J,R,W){return[function(q){var P=re(this),ee=q==null?void 0:q[J];return ee!==void 0?ee.call(q,P):new RegExp(q)[J](String(P))},function(q){var P=W(R,q,this);if(P.done)return P.value;var ee=b(q),I=String(this);if(!ee.global)return B(ee,I);var se=ee.unicode;ee.lastIndex=0;for(var ie,K=[],de=0;(ie=B(ee,I))!==null;){var pe=String(ie[0]);K[de]=pe,pe===""&&(ee.lastIndex=U(I,$(ee.lastIndex),se)),de++}return de===0?null:K}]})},function(Oe,A,a){a(219);var b=a(14),$=a(124),U=a(27),B=/./.toString,re=function(J){a(38)(RegExp.prototype,"toString",J,!0)};a(15)(function(){return B.call({source:"a",flags:"b"})!="/a/b"})?re(function(){var J=b(this);return"/".concat(J.source,"/","flags"in J?J.flags:!U&&J instanceof RegExp?$.call(J):void 0)}):B.name!="toString"&&re(function(){return B.call(this)})},function(Oe,A,a){var b=a(16),$=a(168),U=a(26).f,B=a(79).f,re=a(161),J=a(124),R=b.RegExp,W=R,q=R.prototype,P=/a/g,ee=/a/g,I=new R(P)!==P;if(a(27)&&(!I||a(15)(function(){return ee[a(19)("match")]=!1,R(P)!=P||R(ee)==ee||R(P,"i")!="/a/i"}))){R=function(de,pe){var Ae=this instanceof R,Te=re(de),je=pe===void 0;return!Ae&&Te&&de.constructor===R&&je?de:$(I?new W(Te&&!je?de.source:de,pe):W((Te=de instanceof R)?de.source:de,Te&&je?J.call(de):pe),Ae?this:q,R)};for(var se=function(de){de in R||U(R,de,{configurable:!0,get:function(){return W[de]},set:function(pe){W[de]=pe}})},ie=B(W),K=0;ie.length>K;)se(ie[K++]);q.constructor=R,R.prototype=q,a(38)(b,"RegExp",R)}a(95)("RegExp")},function(Oe,A,a){a(95)("Array")},function(Oe,A,a){var b=a(8),$=a(51)(6),U="findIndex",B=!0;U in[]&&Array(1)[U](function(){B=!1}),b(b.P+b.F*B,"Array",{findIndex:function(re){return $(this,re,arguments.length>1?arguments[1]:void 0)}}),a(77)(U)},function(Oe,A,a){var b=a(8),$=a(51)(5),U=!0;"find"in[]&&Array(1).find(function(){U=!1}),b(b.P+b.F*U,"Array",{find:function(B){return $(this,B,arguments.length>1?arguments[1]:void 0)}}),a(77)("find")},function(Oe,A,a){var b=a(8);b(b.P,"Array",{fill:a(156)}),a(77)("fill")},function(Oe,A,a){var b=a(8);b(b.P,"Array",{copyWithin:a(222)}),a(77)("copyWithin")},function(Oe,A,a){var b=a(8),$=a(41),U=a(54),B=a(22),re=[].lastIndexOf,J=!!re&&1/[1].lastIndexOf(1,-0)<0;b(b.P+b.F*(J||!a(49)(re)),"Array",{lastIndexOf:function(R){if(J)return re.apply(this,arguments)||0;var W=$(this),q=B(W.length),P=q-1;for(arguments.length>1&&(P=Math.min(P,U(arguments[1]))),P<0&&(P=q+P);P>=0;P--)if(P in W&&W[P]===R)return P||0;return-1}})},function(Oe,A,a){var b=a(8),$=a(128)(!1),U=[].indexOf,B=!!U&&1/[1].indexOf(1,-0)<0;b(b.P+b.F*(B||!a(49)(U)),"Array",{indexOf:function(re){return B?U.apply(this,arguments)||0:$(this,re,arguments[1])}})},function(Oe,A,a){var b=a(8),$=a(223);b(b.P+b.F*!a(49)([].reduceRight,!0),"Array",{reduceRight:function(U){return $(this,U,arguments.length,arguments[1],!0)}})},function(Oe,A,a){var b=a(8),$=a(223);b(b.P+b.F*!a(49)([].reduce,!0),"Array",{reduce:function(U){return $(this,U,arguments.length,arguments[1],!1)}})},function(Oe,A,a){var b=a(8),$=a(51)(4);b(b.P+b.F*!a(49)([].every,!0),"Array",{every:function(U){return $(this,U,arguments[1])}})},function(Oe,A,a){var b=a(8),$=a(51)(3);b(b.P+b.F*!a(49)([].some,!0),"Array",{some:function(U){return $(this,U,arguments[1])}})},function(Oe,A,a){var b=a(8),$=a(51)(2);b(b.P+b.F*!a(49)([].filter,!0),"Array",{filter:function(U){return $(this,U,arguments[1])}})},function(Oe,A,a){var b=a(8),$=a(51)(1);b(b.P+b.F*!a(49)([].map,!0),"Array",{map:function(U){return $(this,U,arguments[1])}})},function(Oe,A,a){var b=a(13),$=a(126),U=a(19)("species");Oe.exports=function(B){var re;return $(B)&&(typeof(re=B.constructor)!="function"||re!==Array&&!$(re.prototype)||(re=void 0),b(re)&&(re=re[U])===null&&(re=void 0)),re===void 0?Array:re}},function(Oe,A,a){var b=a(8),$=a(51)(0),U=a(49)([].forEach,!0);b(b.P+b.F*!U,"Array",{forEach:function(B){return $(this,B,arguments[1])}})},function(Oe,A,a){var b=a(8),$=a(55),U=a(34),B=a(15),re=[].sort,J=[1,2,3];b(b.P+b.F*(B(function(){J.sort(void 0)})||!B(function(){J.sort(null)})||!a(49)(re)),"Array",{sort:function(R){return R===void 0?re.call(U(this)):re.call(U(this),$(R))}})},function(Oe,A,a){var b=a(8),$=a(171),U=a(62),B=a(81),re=a(22),J=[].slice;b(b.P+b.F*a(15)(function(){$&&J.call($)}),"Array",{slice:function(R,W){var q=re(this.length),P=U(this);if(W=W===void 0?q:W,P=="Array")return J.call(this,R,W);for(var ee=B(R,q),I=B(W,q),se=re(I-ee),ie=new Array(se),K=0;K<se;K++)ie[K]=P=="String"?this.charAt(ee+K):this[ee+K];return ie}})},function(Oe,A,a){var b=a(8),$=a(41),U=[].join;b(b.P+b.F*(a(107)!=Object||!a(49)(U)),"Array",{join:function(B){return U.call($(this),B===void 0?",":B)}})},function(Oe,A,a){var b=a(8),$=a(158);b(b.S+b.F*a(15)(function(){function U(){}return!(Array.of.call(U)instanceof U)}),"Array",{of:function(){for(var U=0,B=arguments.length,re=new(typeof this=="function"?this:Array)(B);B>U;)$(re,U,arguments[U++]);return re.length=B,re}})},function(Oe,A,a){var b=a(56),$=a(8),U=a(34),B=a(225),re=a(159),J=a(22),R=a(158),W=a(157);$($.S+$.F*!a(125)(function(q){Array.from(q)}),"Array",{from:function(q){var P,ee,I,se,ie=U(q),K=typeof this=="function"?this:Array,de=arguments.length,pe=de>1?arguments[1]:void 0,Ae=pe!==void 0,Te=0,je=W(ie);if(Ae&&(pe=b(pe,de>2?arguments[2]:void 0,2)),je==null||K==Array&&re(je))for(ee=new K(P=J(ie.length));P>Te;Te++)R(ee,Te,Ae?pe(ie[Te],Te):ie[Te]);else for(se=je.call(ie),ee=new K;!(I=se.next()).done;Te++)R(ee,Te,Ae?B(se,pe,[I.value,Te],!0):I.value);return ee.length=Te,ee}})},function(Oe,A,a){var b=a(8);b(b.S,"Array",{isArray:a(126)})},function(Oe,A,a){var b=a(14),$=a(66);Oe.exports=function(U){if(U!=="string"&&U!=="number"&&U!=="default")throw TypeError("Incorrect hint");return $(b(this),U!="number")}},function(Oe,A,a){var b=a(19)("toPrimitive"),$=Date.prototype;b in $||a(42)($,b,a(494))},function(Oe,A,a){var b=Date.prototype,$=b.toString,U=b.getTime;new Date(NaN)+""!="Invalid Date"&&a(38)(b,"toString",function(){var B=U.call(this);return B==B?$.call(this):"Invalid Date"})},function(Oe,A,a){var b=a(15),$=Date.prototype.getTime,U=Date.prototype.toISOString,B=function(re){return re>9?re:"0"+re};Oe.exports=b(function(){return U.call(new Date(-5e13-1))!="0385-07-25T07:06:39.999Z"})||!b(function(){U.call(new Date(NaN))})?function(){if(!isFinite($.call(this)))throw RangeError("Invalid time value");var re=this,J=re.getUTCFullYear(),R=re.getUTCMilliseconds(),W=J<0?"-":J>9999?"+":"";return W+("00000"+Math.abs(J)).slice(W?-6:-4)+"-"+B(re.getUTCMonth()+1)+"-"+B(re.getUTCDate())+"T"+B(re.getUTCHours())+":"+B(re.getUTCMinutes())+":"+B(re.getUTCSeconds())+"."+(R>99?R:"0"+B(R))+"Z"}:U},function(Oe,A,a){var b=a(8),$=a(497);b(b.P+b.F*(Date.prototype.toISOString!==$),"Date",{toISOString:$})},function(Oe,A,a){var b=a(8),$=a(34),U=a(66);b(b.P+b.F*a(15)(function(){return new Date(NaN).toJSON()!==null||Date.prototype.toJSON.call({toISOString:function(){return 1}})!==1}),"Date",{toJSON:function(B){var re=$(this),J=U(re);return typeof J!="number"||isFinite(J)?re.toISOString():null}})},function(Oe,A,a){var b=a(8);b(b.S,"Date",{now:function(){return new Date().getTime()}})},function(Oe,A,a){a(37)("sup",function(b){return function(){return b(this,"sup","","")}})},function(Oe,A,a){a(37)("sub",function(b){return function(){return b(this,"sub","","")}})},function(Oe,A,a){a(37)("strike",function(b){return function(){return b(this,"strike","","")}})},function(Oe,A,a){a(37)("small",function(b){return function(){return b(this,"small","","")}})},function(Oe,A,a){a(37)("link",function(b){return function($){return b(this,"a","href",$)}})},function(Oe,A,a){a(37)("italics",function(b){return function(){return b(this,"i","","")}})},function(Oe,A,a){a(37)("fontsize",function(b){return function($){return b(this,"font","size",$)}})},function(Oe,A,a){a(37)("fontcolor",function(b){return function($){return b(this,"font","color",$)}})},function(Oe,A,a){a(37)("fixed",function(b){return function(){return b(this,"tt","","")}})},function(Oe,A,a){a(37)("bold",function(b){return function(){return b(this,"b","","")}})},function(Oe,A,a){a(37)("blink",function(b){return function(){return b(this,"blink","","")}})},function(Oe,A,a){a(37)("big",function(b){return function(){return b(this,"big","","")}})},function(Oe,A,a){a(37)("anchor",function(b){return function($){return b(this,"a","name",$)}})},function(Oe,A,a){var b=a(8),$=a(22),U=a(162),B="".startsWith;b(b.P+b.F*a(160)("startsWith"),"String",{startsWith:function(re){var J=U(this,re,"startsWith"),R=$(Math.min(arguments.length>1?arguments[1]:void 0,J.length)),W=String(re);return B?B.call(J,W,R):J.slice(R,R+W.length)===W}})},function(Oe,A,a){var b=a(8);b(b.P,"String",{repeat:a(167)})},function(Oe,A,a){var b=a(8),$=a(162);b(b.P+b.F*a(160)("includes"),"String",{includes:function(U){return!!~$(this,U,"includes").indexOf(U,arguments.length>1?arguments[1]:void 0)}})},function(Oe,A,a){var b=a(8),$=a(22),U=a(162),B="".endsWith;b(b.P+b.F*a(160)("endsWith"),"String",{endsWith:function(re){var J=U(this,re,"endsWith"),R=arguments.length>1?arguments[1]:void 0,W=$(J.length),q=R===void 0?W:Math.min($(R),W),P=String(re);return B?B.call(J,P,q):J.slice(q-P.length,q)===P}})},function(Oe,A,a){var b=a(8),$=a(164)(!1);b(b.P,"String",{codePointAt:function(U){return $(this,U)}})},function(Oe,A,a){var b=a(164)(!0);a(163)(String,"String",function($){this._t=String($),this._i=0},function(){var $,U=this._t,B=this._i;return B>=U.length?{value:void 0,done:!0}:($=b(U,B),this._i+=$.length,{value:$,done:!1})})},function(Oe,A,a){a(97)("trim",function(b){return function(){return b(this,3)}})},function(Oe,A,a){var b=a(8),$=a(41),U=a(22);b(b.S,"String",{raw:function(B){for(var re=$(B.raw),J=U(re.length),R=arguments.length,W=[],q=0;J>q;)W.push(String(re[q++])),q<R&&W.push(String(arguments[q]));return W.join("")}})},function(Oe,A,a){var b=a(8),$=a(81),U=String.fromCharCode,B=String.fromCodePoint;b(b.S+b.F*(!!B&&B.length!=1),"String",{fromCodePoint:function(re){for(var J,R=[],W=arguments.length,q=0;W>q;){if(J=+arguments[q++],$(J,1114111)!==J)throw RangeError(J+" is not a valid code point");R.push(J<65536?U(J):U(55296+((J-=65536)>>10),J%1024+56320))}return R.join("")}})},function(Oe,A,a){var b=a(8);b(b.S,"Math",{trunc:function($){return($>0?Math.floor:Math.ceil)($)}})},function(Oe,A,a){var b=a(8),$=a(165),U=Math.exp;b(b.S,"Math",{tanh:function(B){var re=$(B=+B),J=$(-B);return re==1/0?1:J==1/0?-1:(re-J)/(U(B)+U(-B))}})},function(Oe,A,a){var b=a(8),$=a(165),U=Math.exp;b(b.S+b.F*a(15)(function(){return!Math.sinh(-2e-17)!=-2e-17}),"Math",{sinh:function(B){return Math.abs(B=+B)<1?($(B)-$(-B))/2:(U(B-1)-U(-B-1))*(Math.E/2)}})},function(Oe,A,a){var b=a(8);b(b.S,"Math",{sign:a(166)})},function(Oe,A,a){var b=a(8);b(b.S,"Math",{log2:function($){return Math.log($)/Math.LN2}})},function(Oe,A,a){var b=a(8);b(b.S,"Math",{log1p:a(227)})},function(Oe,A,a){var b=a(8);b(b.S,"Math",{log10:function($){return Math.log($)*Math.LOG10E}})},function(Oe,A,a){var b=a(8),$=Math.imul;b(b.S+b.F*a(15)(function(){return $(4294967295,5)!=-5||$.length!=2}),"Math",{imul:function(U,B){var re=+U,J=+B,R=65535&re,W=65535&J;return 0|R*W+((65535&re>>>16)*W+R*(65535&J>>>16)<<16>>>0)}})},function(Oe,A,a){var b=a(8),$=Math.abs;b(b.S,"Math",{hypot:function(U,B){for(var re,J,R=0,W=0,q=arguments.length,P=0;W<q;)P<(re=$(arguments[W++]))?(R=R*(J=P/re)*J+1,P=re):R+=re>0?(J=re/P)*J:re;return P===1/0?1/0:P*Math.sqrt(R)}})},function(Oe,A,a){var b=a(166),$=Math.pow,U=$(2,-52),B=$(2,-23),re=$(2,127)*(2-B),J=$(2,-126);Oe.exports=Math.fround||function(R){var W,q,P=Math.abs(R),ee=b(R);return P<J?ee*function(I){return I+1/U-1/U}(P/J/B)*J*B:(q=(W=(1+B/U)*P)-(W-P))>re||q!=q?ee*(1/0):ee*q}},function(Oe,A,a){var b=a(8);b(b.S,"Math",{fround:a(532)})},function(Oe,A,a){var b=a(8),$=a(165);b(b.S+b.F*($!=Math.expm1),"Math",{expm1:$})},function(Oe,A,a){var b=a(8),$=Math.exp;b(b.S,"Math",{cosh:function(U){return($(U=+U)+$(-U))/2}})},function(Oe,A,a){var b=a(8);b(b.S,"Math",{clz32:function($){return($>>>=0)?31-Math.floor(Math.log($+.5)*Math.LOG2E):32}})},function(Oe,A,a){var b=a(8),$=a(166);b(b.S,"Math",{cbrt:function(U){return $(U=+U)*Math.pow(Math.abs(U),1/3)}})},function(Oe,A,a){var b=a(8),$=Math.atanh;b(b.S+b.F*!($&&1/$(-0)<0),"Math",{atanh:function(U){return(U=+U)==0?U:Math.log((1+U)/(1-U))/2}})},function(Oe,A,a){var b=a(8),$=Math.asinh;b(b.S+b.F*!($&&1/$(0)>0),"Math",{asinh:function U(B){return isFinite(B=+B)&&B!=0?B<0?-U(-B):Math.log(B+Math.sqrt(B*B+1)):B}})},function(Oe,A,a){var b=a(8),$=a(227),U=Math.sqrt,B=Math.acosh;b(b.S+b.F*!(B&&Math.floor(B(Number.MAX_VALUE))==710&&B(1/0)==1/0),"Math",{acosh:function(re){return(re=+re)<1?NaN:re>9490626562425156e-8?Math.log(re)+Math.LN2:$(re-1+U(re-1)*U(re+1))}})},function(Oe,A,a){var b=a(8),$=a(231);b(b.S+b.F*(Number.parseInt!=$),"Number",{parseInt:$})},function(Oe,A,a){var b=a(8),$=a(230);b(b.S+b.F*(Number.parseFloat!=$),"Number",{parseFloat:$})},function(Oe,A,a){var b=a(8);b(b.S,"Number",{MIN_SAFE_INTEGER:-9007199254740991})},function(Oe,A,a){var b=a(8);b(b.S,"Number",{MAX_SAFE_INTEGER:9007199254740991})},function(Oe,A,a){var b=a(8),$=a(228),U=Math.abs;b(b.S,"Number",{isSafeInteger:function(B){return $(B)&&U(B)<=9007199254740991}})},function(Oe,A,a){var b=a(8);b(b.S,"Number",{isNaN:function($){return $!=$}})},function(Oe,A,a){var b=a(8);b(b.S,"Number",{isInteger:a(228)})},function(Oe,A,a){var b=a(8),$=a(16).isFinite;b(b.S,"Number",{isFinite:function(U){return typeof U=="number"&&$(U)}})},function(Oe,A,a){var b=a(8);b(b.S,"Number",{EPSILON:Math.pow(2,-52)})},function(Oe,A,a){var b=a(8),$=a(15),U=a(229),B=1 .toPrecision;b(b.P+b.F*($(function(){return B.call(1,void 0)!=="1"})||!$(function(){B.call({})})),"Number",{toPrecision:function(re){var J=U(this,"Number#toPrecision: incorrect invocation!");return re===void 0?B.call(J):B.call(J,re)}})},function(Oe,A,a){var b=a(8),$=a(54),U=a(229),B=a(167),re=1 .toFixed,J=Math.floor,R=[0,0,0,0,0,0],W="Number.toFixed: incorrect invocation!",q=function(se,ie){for(var K=-1,de=ie;++K<6;)de+=se*R[K],R[K]=de%1e7,de=J(de/1e7)},P=function(se){for(var ie=6,K=0;--ie>=0;)K+=R[ie],R[ie]=J(K/se),K=K%se*1e7},ee=function(){for(var se=6,ie="";--se>=0;)if(ie!==""||se===0||R[se]!==0){var K=String(R[se]);ie=ie===""?K:ie+B.call("0",7-K.length)+K}return ie},I=function(se,ie,K){return ie===0?K:ie%2==1?I(se,ie-1,K*se):I(se*se,ie/2,K)};b(b.P+b.F*(!!re&&(8e-5 .toFixed(3)!=="0.000"||.9 .toFixed(0)!=="1"||1.255 .toFixed(2)!=="1.25"||0xde0b6b3a7640080 .toFixed(0)!=="1000000000000000128")||!a(15)(function(){re.call({})})),"Number",{toFixed:function(se){var ie,K,de,pe,Ae=U(this,W),Te=$(se),je="",we="0";if(Te<0||Te>20)throw RangeError(W);if(Ae!=Ae)return"NaN";if(Ae<=-1e21||Ae>=1e21)return String(Ae);if(Ae<0&&(je="-",Ae=-Ae),Ae>1e-21)if(K=(ie=function(ot){for(var _t=0,Ut=ot;Ut>=4096;)_t+=12,Ut/=4096;for(;Ut>=2;)_t+=1,Ut/=2;return _t}(Ae*I(2,69,1))-69)<0?Ae*I(2,-ie,1):Ae/I(2,ie,1),K*=4503599627370496,(ie=52-ie)>0){for(q(0,K),de=Te;de>=7;)q(1e7,0),de-=7;for(q(I(10,de,1),0),de=ie-1;de>=23;)P(1<<23),de-=23;P(1<<de),q(1,1),P(2),we=ee()}else q(0,K),q(1<<-ie,0),we=ee()+B.call("0",Te);return we=Te>0?je+((pe=we.length)<=Te?"0."+B.call("0",Te-pe)+we:we.slice(0,pe-Te)+"."+we.slice(pe-Te)):je+we}})},function(Oe,A,a){var b=a(16),$=a(43),U=a(62),B=a(168),re=a(66),J=a(15),R=a(79).f,W=a(53).f,q=a(26).f,P=a(97).trim,ee=b.Number,I=ee,se=ee.prototype,ie=U(a(80)(se))=="Number",K="trim"in String.prototype,de=function(je){var we=re(je,!1);if(typeof we=="string"&&we.length>2){var ot,_t,Ut,Xt=(we=K?we.trim():P(we,3)).charCodeAt(0);if(Xt===43||Xt===45){if((ot=we.charCodeAt(2))===88||ot===120)return NaN}else if(Xt===48){switch(we.charCodeAt(1)){case 66:case 98:_t=2,Ut=49;break;case 79:case 111:_t=8,Ut=55;break;default:return+we}for(var ke,Ft=we.slice(2),Gt=0,jt=Ft.length;Gt<jt;Gt++)if((ke=Ft.charCodeAt(Gt))<48||ke>Ut)return NaN;return parseInt(Ft,_t)}}return+we};if(!ee(" 0o1")||!ee("0b1")||ee("+0x1")){ee=function(je){var we=arguments.length<1?0:je,ot=this;return ot instanceof ee&&(ie?J(function(){se.valueOf.call(ot)}):U(ot)!="Number")?B(new I(de(we)),ot,ee):de(we)};for(var pe,Ae=a(27)?R(I):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger".split(","),Te=0;Ae.length>Te;Te++)$(I,pe=Ae[Te])&&!$(ee,pe)&&q(ee,pe,W(I,pe));ee.prototype=se,se.constructor=ee,a(38)(b,"Number",ee)}},function(Oe,A,a){var b=a(8),$=a(230);b(b.G+b.F*(parseFloat!=$),{parseFloat:$})},function(Oe,A,a){var b=a(8),$=a(231);b(b.G+b.F*(parseInt!=$),{parseInt:$})},function(Oe,A,a){var b=a(13),$=a(78),U=a(19)("hasInstance"),B=Function.prototype;U in B||a(26).f(B,U,{value:function(re){if(typeof this!="function"||!b(re))return!1;if(!b(this.prototype))return re instanceof this;for(;re=$(re);)if(this.prototype===re)return!0;return!1}})},function(Oe,A,a){var b=a(26).f,$=Function.prototype,U=/^\s*function ([^ (]*)/;"name"in $||a(27)&&b($,"name",{configurable:!0,get:function(){try{return(""+this).match(U)[1]}catch{return""}}})},function(Oe,A,a){var b=a(8);b(b.P,"Function",{bind:a(233)})},function(Oe,A,a){var b=a(105),$={};$[a(19)("toStringTag")]="z",$+""!="[object z]"&&a(38)(Object.prototype,"toString",function(){return"[object "+b(this)+"]"},!0)},function(Oe,A,a){var b=a(8);b(b.S,"Object",{setPrototypeOf:a(170).set})},function(Oe,A,a){var b=a(8);b(b.S,"Object",{is:a(234)})},function(Oe,A,a){var b=a(8);b(b.S+b.F,"Object",{assign:a(235)})},function(Oe,A,a){var b=a(13);a(52)("isExtensible",function($){return function(U){return!!b(U)&&(!$||$(U))}})},function(Oe,A,a){var b=a(13);a(52)("isSealed",function($){return function(U){return!b(U)||!!$&&$(U)}})},function(Oe,A,a){var b=a(13);a(52)("isFrozen",function($){return function(U){return!b(U)||!!$&&$(U)}})},function(Oe,A,a){var b=a(13),$=a(65).onFreeze;a(52)("preventExtensions",function(U){return function(B){return U&&b(B)?U($(B)):B}})},function(Oe,A,a){var b=a(13),$=a(65).onFreeze;a(52)("seal",function(U){return function(B){return U&&b(B)?U($(B)):B}})},function(Oe,A,a){var b=a(13),$=a(65).onFreeze;a(52)("freeze",function(U){return function(B){return U&&b(B)?U($(B)):B}})},function(Oe,A,a){a(52)("getOwnPropertyNames",function(){return a(236).f})},function(Oe,A,a){var b=a(34),$=a(82);a(52)("keys",function(){return function(U){return $(b(U))}})},function(Oe,A,a){var b=a(34),$=a(78);a(52)("getPrototypeOf",function(){return function(U){return $(b(U))}})},function(Oe,A,a){var b=a(41),$=a(53).f;a(52)("getOwnPropertyDescriptor",function(){return function(U,B){return $(b(U),B)}})},function(Oe,A,a){var b=a(8);b(b.S+b.F*!a(27),"Object",{defineProperties:a(237)})},function(Oe,A,a){var b=a(8);b(b.S+b.F*!a(27),"Object",{defineProperty:a(26).f})},function(Oe,A,a){var b=a(8);b(b.S,"Object",{create:a(80)})},function(Oe,A,a){var b=a(82),$=a(127),U=a(106);Oe.exports=function(B){var re=b(B),J=$.f;if(J)for(var R,W=J(B),q=U.f,P=0;W.length>P;)q.call(B,R=W[P++])&&re.push(R);return re}},function(Oe,A,a){Oe.exports=a(129)("native-function-to-string",Function.toString)},function(Oe,A,a){var b=a(16),$=a(43),U=a(27),B=a(8),re=a(38),J=a(65).KEY,R=a(15),W=a(129),q=a(98),P=a(84),ee=a(19),I=a(174),se=a(239),ie=a(575),K=a(126),de=a(14),pe=a(13),Ae=a(34),Te=a(41),je=a(66),we=a(85),ot=a(80),_t=a(236),Ut=a(53),Xt=a(127),ke=a(26),Ft=a(82),Gt=Ut.f,jt=ke.f,Ye=_t.f,ln=b.Symbol,nn=b.JSON,Bt=nn&&nn.stringify,Pt=ee("_hidden"),gn=ee("toPrimitive"),Dt={}.propertyIsEnumerable,St=W("symbol-registry"),wn=W("symbols"),Bn=W("op-symbols"),Hn=Object.prototype,hn=typeof ln=="function"&&!!Xt.f,Ve=b.QObject,Qe=!Ve||!Ve.prototype||!Ve.prototype.findChild,He=U&&R(function(){return ot(jt({},"a",{get:function(){return jt(this,"a",{value:7}).a}})).a!=7})?function(Kt,Zt,$n){var Dn=Gt(Hn,Zt);Dn&&delete Hn[Zt],jt(Kt,Zt,$n),Dn&&Kt!==Hn&&jt(Hn,Zt,Dn)}:jt,pt=function(Kt){var Zt=wn[Kt]=ot(ln.prototype);return Zt._k=Kt,Zt},Lt=hn&&typeof ln.iterator=="symbol"?function(Kt){return typeof Kt=="symbol"}:function(Kt){return Kt instanceof ln},zt=function(Kt,Zt,$n){return Kt===Hn&&zt(Bn,Zt,$n),de(Kt),Zt=je(Zt,!0),de($n),$(wn,Zt)?($n.enumerable?($(Kt,Pt)&&Kt[Pt][Zt]&&(Kt[Pt][Zt]=!1),$n=ot($n,{enumerable:we(0,!1)})):($(Kt,Pt)||jt(Kt,Pt,we(1,{})),Kt[Pt][Zt]=!0),He(Kt,Zt,$n)):jt(Kt,Zt,$n)},Tn=function(Kt,Zt){de(Kt);for(var $n,Dn=ie(Zt=Te(Zt)),hr=0,wr=Dn.length;wr>hr;)zt(Kt,$n=Dn[hr++],Zt[$n]);return Kt},xn=function(Kt){var Zt=Dt.call(this,Kt=je(Kt,!0));return!(this===Hn&&$(wn,Kt)&&!$(Bn,Kt))&&(!(Zt||!$(this,Kt)||!$(wn,Kt)||$(this,Pt)&&this[Pt][Kt])||Zt)},Kn=function(Kt,Zt){if(Kt=Te(Kt),Zt=je(Zt,!0),Kt!==Hn||!$(wn,Zt)||$(Bn,Zt)){var $n=Gt(Kt,Zt);return!$n||!$(wn,Zt)||$(Kt,Pt)&&Kt[Pt][Zt]||($n.enumerable=!0),$n}},be=function(Kt){for(var Zt,$n=Ye(Te(Kt)),Dn=[],hr=0;$n.length>hr;)$(wn,Zt=$n[hr++])||Zt==Pt||Zt==J||Dn.push(Zt);return Dn},Yn=function(Kt){for(var Zt,$n=Kt===Hn,Dn=Ye($n?Bn:Te(Kt)),hr=[],wr=0;Dn.length>wr;)!$(wn,Zt=Dn[wr++])||$n&&!$(Hn,Zt)||hr.push(wn[Zt]);return hr};hn||(re((ln=function(){if(this instanceof ln)throw TypeError("Symbol is not a constructor!");var Kt=P(arguments.length>0?arguments[0]:void 0),Zt=function($n){this===Hn&&Zt.call(Bn,$n),$(this,Pt)&&$(this[Pt],Kt)&&(this[Pt][Kt]=!1),He(this,Kt,we(1,$n))};return U&&Qe&&He(Hn,Kt,{configurable:!0,set:Zt}),pt(Kt)}).prototype,"toString",function(){return this._k}),Ut.f=Kn,ke.f=zt,a(79).f=_t.f=be,a(106).f=xn,Xt.f=Yn,U&&!a(83)&&re(Hn,"propertyIsEnumerable",xn,!0),I.f=function(Kt){return pt(ee(Kt))}),B(B.G+B.W+B.F*!hn,{Symbol:ln});for(var Dr="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),pr=0;Dr.length>pr;)ee(Dr[pr++]);for(var Nr=Ft(ee.store),Fr=0;Nr.length>Fr;)se(Nr[Fr++]);B(B.S+B.F*!hn,"Symbol",{for:function(Kt){return $(St,Kt+="")?St[Kt]:St[Kt]=ln(Kt)},keyFor:function(Kt){if(!Lt(Kt))throw TypeError(Kt+" is not a symbol!");for(var Zt in St)if(St[Zt]===Kt)return Zt},useSetter:function(){Qe=!0},useSimple:function(){Qe=!1}}),B(B.S+B.F*!hn,"Object",{create:function(Kt,Zt){return Zt===void 0?ot(Kt):Tn(ot(Kt),Zt)},defineProperty:zt,defineProperties:Tn,getOwnPropertyDescriptor:Kn,getOwnPropertyNames:be,getOwnPropertySymbols:Yn});var an=R(function(){Xt.f(1)});B(B.S+B.F*an,"Object",{getOwnPropertySymbols:function(Kt){return Xt.f(Ae(Kt))}}),nn&&B(B.S+B.F*(!hn||R(function(){var Kt=ln();return Bt([Kt])!="[null]"||Bt({a:Kt})!="{}"||Bt(Object(Kt))!="{}"})),"JSON",{stringify:function(Kt){for(var Zt,$n,Dn=[Kt],hr=1;arguments.length>hr;)Dn.push(arguments[hr++]);if($n=Zt=Dn[1],(pe(Zt)||Kt!==void 0)&&!Lt(Kt))return K(Zt)||(Zt=function(wr,gr){if(typeof $n=="function"&&(gr=$n.call(this,wr,gr)),!Lt(gr))return gr}),Dn[1]=Zt,Bt.apply(nn,Dn)}}),ln.prototype[gn]||a(42)(ln.prototype,gn,ln.prototype.valueOf),q(ln,"Symbol"),q(Math,"Math",!0),q(b.JSON,"JSON",!0)},function(Oe,A,a){a(577),a(574),a(573),a(572),a(571),a(570),a(569),a(568),a(567),a(566),a(565),a(564),a(563),a(562),a(561),a(560),a(559),a(558),a(557),a(556),a(555),a(554),a(553),a(552),a(551),a(550),a(549),a(548),a(547),a(546),a(545),a(544),a(543),a(542),a(541),a(540),a(539),a(538),a(537),a(536),a(535),a(534),a(533),a(531),a(530),a(529),a(528),a(527),a(526),a(525),a(524),a(523),a(522),a(521),a(520),a(519),a(518),a(517),a(516),a(515),a(514),a(513),a(512),a(511),a(510),a(509),a(508),a(507),a(506),a(505),a(504),a(503),a(502),a(501),a(500),a(499),a(498),a(496),a(495),a(493),a(492),a(491),a(490),a(489),a(488),a(487),a(485),a(484),a(483),a(482),a(481),a(480),a(479),a(478),a(477),a(476),a(475),a(474),a(473),a(155),a(472),a(220),a(471),a(219),a(470),a(469),a(468),a(467),a(218),a(464),a(463),a(462),a(461),a(460),a(459),a(458),a(457),a(456),a(455),a(454),a(453),a(452),a(451),a(450),a(449),a(448),a(447),a(446),a(445),a(444),a(443),a(442),a(441),a(440),a(439),a(438),a(437),a(436),Oe.exports=a(24)},function(Oe,A,a){a(578),a(435),a(433),a(430),a(428),a(426),a(424),a(422),a(420),a(418),a(416),a(414),a(412),a(408)},function(Oe,A,a){a(579);var b=function($){return $&&$.__esModule?$:{default:$}}(a(407));b.default._babelPolyfill&&typeof console<"u"&&console.warn&&console.warn("@babel/polyfill is loaded more than once on this page. This is probably not desirable/intended and may have consequences if different versions of the polyfills are applied sequentially. If you do need to load the polyfill more than once, use @babel/polyfill/noConflict instead to bypass the warning."),b.default._babelPolyfill=!0},function(Oe,A,a){a(580),Oe.exports=a(248)},function(Oe,A,a){var b={},$={},U=34,B=10,re=13;function J(P){return new Function("d","return {"+P.map(function(ee,I){return JSON.stringify(ee)+": d["+I+'] || ""'}).join(",")+"}")}function R(P){var ee=Object.create(null),I=[];return P.forEach(function(se){for(var ie in se)ie in ee||I.push(ee[ie]=ie)}),I}function W(P,ee){var I=P+"",se=I.length;return se<ee?new Array(ee-se+1).join(0)+I:I}function q(P){var ee=P.getUTCHours(),I=P.getUTCMinutes(),se=P.getUTCSeconds(),ie=P.getUTCMilliseconds();return isNaN(P)?"Invalid Date":function(K){return K<0?"-"+W(-K,6):K>9999?"+"+W(K,6):W(K,4)}(P.getUTCFullYear())+"-"+W(P.getUTCMonth()+1,2)+"-"+W(P.getUTCDate(),2)+(ie?"T"+W(ee,2)+":"+W(I,2)+":"+W(se,2)+"."+W(ie,3)+"Z":se?"T"+W(ee,2)+":"+W(I,2)+":"+W(se,2)+"Z":I||ee?"T"+W(ee,2)+":"+W(I,2)+"Z":"")}A.a=function(P){var ee=new RegExp('["'+P+`
\r]`),I=P.charCodeAt(0);function se(pe,Ae){var Te,je=[],we=pe.length,ot=0,_t=0,Ut=we<=0,Xt=!1;function ke(){if(Ut)return $;if(Xt)return Xt=!1,b;var Gt,jt,Ye=ot;if(pe.charCodeAt(Ye)===U){for(;ot++<we&&pe.charCodeAt(ot)!==U||pe.charCodeAt(++ot)===U;);return(Gt=ot)>=we?Ut=!0:(jt=pe.charCodeAt(ot++))===B?Xt=!0:jt===re&&(Xt=!0,pe.charCodeAt(ot)===B&&++ot),pe.slice(Ye+1,Gt-1).replace(/""/g,'"')}for(;ot<we;){if((jt=pe.charCodeAt(Gt=ot++))===B)Xt=!0;else if(jt===re)Xt=!0,pe.charCodeAt(ot)===B&&++ot;else if(jt!==I)continue;return pe.slice(Ye,Gt)}return Ut=!0,pe.slice(Ye,we)}for(pe.charCodeAt(we-1)===B&&--we,pe.charCodeAt(we-1)===re&&--we;(Te=ke())!==$;){for(var Ft=[];Te!==b&&Te!==$;)Ft.push(Te),Te=ke();Ae&&(Ft=Ae(Ft,_t++))==null||je.push(Ft)}return je}function ie(pe,Ae){return pe.map(function(Te){return Ae.map(function(je){return de(Te[je])}).join(P)})}function K(pe){return pe.map(de).join(P)}function de(pe){return pe==null?"":pe instanceof Date?q(pe):ee.test(pe+="")?'"'+pe.replace(/"/g,'""')+'"':pe}return{parse:function(pe,Ae){var Te,je,we=se(pe,function(ot,_t){if(Te)return Te(ot,_t-1);je=ot,Te=Ae?function(Ut,Xt){var ke=J(Ut);return function(Ft,Gt){return Xt(ke(Ft),Gt,Ut)}}(ot,Ae):J(ot)});return we.columns=je||[],we},parseRows:se,format:function(pe,Ae){return Ae==null&&(Ae=R(pe)),[Ae.map(de).join(P)].concat(ie(pe,Ae)).join(`
`)},formatBody:function(pe,Ae){return Ae==null&&(Ae=R(pe)),ie(pe,Ae).join(`
`)},formatRows:function(pe){return pe.map(K).join(`
`)},formatRow:K,formatValue:de}}}]).default})})(t5);var oV=t5.exports;export{oV as m};
